       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.           MLKUT006.                                  00020000
       AUTHOR.               SCOTT JACKSON.                             00030000
       INSTALLATION.         KOHLS DEPARTMENT STORES.                   00040000
       DATE-WRITTEN          10/17/2008.                                00050000
       DATE-COMPILED.                                                   00060000
                                                                        00070000
      ******************************************************************00080000
      *   PROGRAM PROCESSES APPROVED DAILY DA TRANSACTIONS TO ML.       00090000
      *                                                                 00100000
      *   MLKUT006 - SELECTION OF ML FINANCIALS FOR PRIOR WEEKS EIR     00110000
      *            - NO UPDATES ARE PROCESSED IN THIS MODULE            00120000
      *            - FILE RPT2 IS CREATED WITH THE ML FINANCIALS FOUND  00130000
      *              TO QUALIFY FOR REDISTRIBUTION.                     00140000
      *            - RPT2 FILE IS PROCESSED INTO DAKUP206 WHICH PERFORMS00150000
      *              THE ACTUAL DA BRAND UPDATES ( DAT_BRND_PRRTN )     00160000
      *                                                                 00170000
      *CHANGE HISTORY:                                                  00180000
      * PROJ   DATE       PGMR       DESCRIPTION                        00190000
      * ------ ---------- ---------- ---------------------------------- 00200000
      *        10/17/08   S.JACKSON  INSTALL                            00210000
RONNA *        02/16/10   R.MCDONALD FIX FOR INC000001150647            00220000
256842*        05/13/21   SRINIVASAN INCREASED THE LENGTH OF LABLE SEQ  00221003
256842*                              NUMBER FROM 4 TO 5 TO AVOID THE    00222003
256842*                              TRUNCATION OF LABLE SEQ NUMBER     00223003
256842*                              WHICH IS GREATER THAN 4 DIGITS.    00224003
256842*                              CHANGE NUMBER : CHG0256842         00225003
      ******************************************************************00230000
                                                                        00240000
       ENVIRONMENT DIVISION.                                            00250000
       CONFIGURATION SECTION.                                           00260000
       SOURCE-COMPUTER. IBM-3090.                                       00270000
       OBJECT-COMPUTER. IBM-3090.                                       00280000
       INPUT-OUTPUT SECTION.                                            00290000
       FILE-CONTROL.                                                    00300000
                                                                        00310000
           SELECT IN-DA-FILE                 ASSIGN TO INP01.           00320000
                                                                        00330000
           SELECT WKLY-DTE-FILE              ASSIGN TO INP02.           00340000
                                                                        00350000
      *    SELECT IN-ORACLE-SRC-CTL          ASSIGN TO INP03.           00360000
                                                                        00370000
           SELECT EXCLUSIVE-BRND-FILE        ASSIGN TO INP04.           00380000
                                                                        00390000
           SELECT DA-REPORT-FILE             ASSIGN TO RPT01.           00400000
                                                                        00410000
           SELECT DA-REPORT-FILE2            ASSIGN TO RPT02.           00420000
                                                                        00430000
       DATA DIVISION.                                                   00440000
       FILE SECTION.                                                    00450000
                                                                        00460000
       FD  IN-DA-FILE                                                   00470000
           LABEL RECORDS ARE STANDARD                                   00480000
           RECORDING MODE IS F                                          00490000
           BLOCK CONTAINS 0 RECORDS.                                    00500000
       01  IN-DA-RECORD             PIC X(350).                         00510000
                                                                        00520000
       FD  WKLY-DTE-FILE                                                00530000
           LABEL RECORDS ARE STANDARD                                   00540000
           RECORDING MODE IS F                                          00550000
           BLOCK CONTAINS 0 RECORDS.                                    00560000
       01  WKLY-DTE-RECORD          PIC X(50).                          00570000
                                                                        00580000
      *FD  IN-ORACLE-SRC-CTL                                            00590000
      *    LABEL RECORDS ARE STANDARD                                   00600000
      *    RECORDING MODE IS F                                          00610000
      *    BLOCK CONTAINS 0 RECORDS.                                    00620000
      *01  IN-ORA-SRC-CTL-RECORD.                                       00630000
      *    05  IOC-SRC-SYSTEM       PIC X(04).                          00640000
      *    05  FILLER               PIC X(01).                          00650000
      *    05  IOC-USER-NAME        PIC X(08).                          00660000
      *    05  FILLER               PIC X(01).                          00670000
      *    05  IOC-USER-LGTH        PIC 9(02).                          00680000
      *    05  FILLER               PIC X(01).                          00690000
      *    05  IOC-PASSWORD         PIC X(08).                          00700000
      *    05  FILLER               PIC X(01).                          00710000
      *    05  IOC-PASSWORD-LGTH    PIC 9(02).                          00720000
      *    05  FILLER               PIC X(01).                          00730000
      *    05  IOC-REST-RECORD      PIC X(51).                          00740000
                                                                        00750000
       FD  EXCLUSIVE-BRND-FILE                                          00760000
           LABEL RECORDS ARE STANDARD                                   00770000
           RECORDING MODE IS F                                          00780000
           BLOCK CONTAINS 0 RECORDS.                                    00790000
       01  EXCL-BRND-DFLT           PIC X(80).                          00800000
                                                                        00810000
       FD  DA-REPORT-FILE                                               00820000
           LABEL RECORDS ARE STANDARD                                   00830000
           RECORDING MODE IS F                                          00840000
           BLOCK CONTAINS 0 RECORDS.                                    00850000
       01  DETAIL-REPORT-REC            PIC X(132).                     00860000
                                                                        00870000
       FD  DA-REPORT-FILE2                                              00880000
           LABEL RECORDS ARE STANDARD                                   00890000
           RECORDING MODE IS F                                          00900000
           BLOCK CONTAINS 0 RECORDS.                                    00910000
       01  DETAIL-REPORT-REC2           PIC X(300).                     00920000
                                                                        00930000
      /*****************************************************************00940000
       WORKING-STORAGE SECTION.                                         00950000
      ******************************************************************00960000
       01  PC-PROGRAM-CONSTANTS.                                        00970000
           05  PC-PROGRAM-NAME              PIC X(08)  VALUE            00980000
                                                       'MLKUT006'.      00990000
           05  PC-MESSAGES.                                             01000000
               10  PC-SQL-ABEND-MESSAGE     PIC X(23)  VALUE            01010000
               '** ABEND -> SQLERROR = '.                               01020000
               10  PC-PROGRAM-MESSAGE       PIC X(23)  VALUE            01030000
               '** PROGRAM        ** = '.                               01040000
               10  PC-PARAGRAPH-MESSAGE     PIC X(23)  VALUE            01050000
               '** PARAGRAPH-NAME ** = '.                               01060000
               10  PC-DB2-OPER-MESSAGE      PIC X(23)  VALUE            01070000
               '** DB2 OPERATION  ** = '.                               01080000
           05  PC-AP-APPROVAL-STAT-CDE      PIC X(02)  VALUE '60'.      01090000
           05  PC-MAX-EXCL-RECS             PIC S9(4)  VALUE +999.      01100000
           05  PC-BRAND-ALLOCATION-VERBIAGE PIC X(20)      VALUE ' '.   01110000
               88  PC-ALLOCATE-A        VALUE 'EQUAL DISTRIBUTION  '.   01120000
               88  PC-ALLOCATE-B        VALUE 'POSITIVE ONLY DIST  '.   01130000
               88  PC-ALLOCATE-C        VALUE 'NEGATIVE ONLY DIST  '.   01140000
               88  PC-ALLOCATE-D        VALUE 'POSITIVE IN-RANGE   '.   01150000
               88  PC-ALLOCATE-E        VALUE 'NEGATIVE IN-RANGE   '.   01160000
               88  PC-ALLOCATE-F        VALUE 'EQUAL DIST-ZERO INV '.   01170000
               88  PC-ALLOCATE-G        VALUE 'EQUAL POS-IN RANGE  '.   01180000
               88  PC-ALLOCATE-H        VALUE 'SINGLE BRAND ONLY   '.   01190000
               88  PC-ALLOCATE-I        VALUE 'SINGLE BRAND UNKNOWN'.   01200000
               88  PC-ALLOCATE-J        VALUE 'SINGLE BRAND DEFAULT'.   01210000
               88  PC-ALLOCATE-K        VALUE 'DEFAULT-BAD DBVCOMBO'.   01220000
      *        88  PC-ALLOCATE-L        VALUE 'NEGATIVE OUT-RANGE  '.   01230000
                                                                        01240000
        01 PV-PROGRAM-VARIABLES.                                        01250000
           05  PV-ADVANCE                   PIC S9(01)     VALUE +1.    01260000
           05  PV-PAGE-COUNT                PIC 9(04)      VALUE 0.     01270000
           05  PV-LINE-COUNT                PIC 9(04)      VALUE 0.     01280000
           05  PV-MAX-LINE-COUNT            PIC 9(04)      VALUE 50.    01290000
           05  PV-ABEND-PARAGRAPH           PIC X(40)      VALUE SPACE. 01300000
           05  PV-ABEND-CODE   COMP  SYNC   PIC S9(04)     VALUE +0000. 01310000
           05  PV-FSCL-MN-END-DTE           PIC X(10)      VALUE SPACE. 01320000
           05  PV-FSCL-WK-END-DTE           PIC X(10)      VALUE SPACE. 01330000
           05  PV-FSCL-YR-NBR-DTE           PIC X(04)      VALUE SPACE. 01340000
           05  PV-EFF-DTE                   PIC X(04)      VALUE SPACE. 01350000
           05  PV-HOLD-DATE                 PIC X(10)      VALUE SPACE. 01360000
           05  PV-PARTN-NBR                 PIC S9(4) COMP VALUE 0.     01370000
           05  PV-PART1                     PIC S9(4) COMP VALUE 0.     01380000
           05  PV-PART2                     PIC S9(4) COMP VALUE 0.     01390000
           05  PV-DKEY                      PIC S9(9) COMP VALUE 0.     01400000
           05  PV-ENT-ID                    PIC S9(9) COMP VALUE 0.     01410000
           05  PV-DEPT-NBR                  PIC S9(4)V COMP-3 VALUE 0.  01420000
           05  PV-SCL-NBR                   PIC S9(4)V COMP-3 VALUE 0.  01430000
256842     05  PV-TEMP-LBL                  PIC S9(5) COMP VALUE 0.     01440003
256842     05  PV-TEMP-EXCL-LBL             PIC S9(5) COMP VALUE 0.     01450003
           05  PV-VND-NBR                   PIC S9(9) COMP VALUE 0.     01460000
           05  PV-PERCENTAGE-VARIABLES.                                 01470000
               10  PV-TEMP-PCT          PIC S9(03)V9(4) COMP  VALUE 0.  01480000
               10  PV-ACCUM-PCT         PIC S9(04)V9(4) COMP  VALUE 0.  01490000
               10  PV-ADJUST-PCT        PIC S9(03)V9(4) COMP  VALUE 0.  01500000
      *        10  PV-TEMP-PCT          PIC S9(03)V9(2) COMP  VALUE 0.  01510000
      *        10  PV-ACCUM-PCT         PIC S9(04)V9(2) COMP  VALUE 0.  01520000
      *        10  PV-ADJUST-PCT        PIC S9(03)V9(2) COMP  VALUE 0.  01530000
           05  PV-MARKUP-PCT-VARIABLES.                                 01540000
               10  PV-MIN-MKUP-TARGET       PIC S9(4)V9(7) COMP-3.      01550000
               10  PV-MAX-MKUP-TARGET       PIC S9(4)V9(7) COMP-3.      01560000
               10  PV-MIN-MKUP-TARGET-NBR   PIC S9(3)V999  COMP.        01570000
               10  PV-MAX-MKUP-TARGET-NBR   PIC S9(3)V999  COMP.        01580000
           05  PV-PART-NUMBER               PIC 9(04)      VALUE ZERO.  01590000
           05  PV-PART-DISPLAY              PIC X(04)      VALUE SPACE. 01600000
           05  PV-FSCL-MN-NAME.                                         01610000
               10  PV-FSCL-MONTH-1-3        PIC X(03)      VALUE SPACE. 01620000
               10  PV-FSCL-MONTH-4-9        PIC X(06)      VALUE SPACE. 01630000
           05  PV-CRE-TMST.                                             01640000
               10  PV-WK-END-DTE            PIC X(10).                  01650000
               10  FILLER                   PIC X(16)                   01660000
                                            VALUE '-00.00.00.000000'.   01670000
      *    1100-INIT                                                    01680000
      *    INITIALIZE SS-SUBSCRIPTS                                     01690000
      *               PA-ML-ACCUMULATORS                                01700000
      *               PA-DA-ACCUMULATORS                                01710000
      *               PS-PROGRAM-SWITCHES                               01720000
      *               PV-PROGRAM-VARIABLES                              01730000
      *               ML-DPT-BRND-VND-TABLE                             01740000
      *               DEBIT-ALLOW-PRRTN-TABLE.                          01750000
      *                                                                 01760000
      *    DATE FORMATS                                                 01770000
      *    DARD100 DATE 2008-09-25.00.00.00                             01780000
      *    ORACLE  DATE 08-SEP-25                                       01790000
           05  PV-DATE-AREA.                                            01800000
               10  PV-DA100-EFF-DTE.                                    01810000
                   15  PV-DA100-DATE.                                   01820000
                       20  PV-DA100-CC      PIC X(02).                  01830000
                       20  PV-DA100-YY      PIC X(02).                  01840000
                       20  FILLER           PIC X(01)   VALUE '-'.      01850000
                       20  PV-DA100-MM      PIC X(02).                  01860000
                       20  FILLER           PIC X(01)   VALUE '-'.      01870000
                       20  PV-DA100-DD      PIC X(02).                  01880000
                   15  PV-DA100-TMST        PIC X(09).                  01890000
               10  PV-ORACLE-DTE.                                       01900000
                   15  PV-ORACLE-DD     PIC X(02)   VALUE SPACES.       01910000
                   15  FILLER           PIC X(01)   VALUE '-'.          01920000
                   15  PV-ORACLE-MON    PIC X(03)   VALUE SPACES.       01930000
                   15  FILLER           PIC X(01)   VALUE '-'.          01940000
                   15  PV-ORACLE-YY     PIC X(02)   VALUE SPACES.       01950000
                                                                        01960000
           05  PV-DA-TEMP.                                              01970000
               10  PV-DA-TEMP-DR-ALW-NBR    PIC  X(16)     VALUE SPACE. 01980000
               10  PV-DA-TEMP-DEPT-NBR      PIC  9(4)      VALUE ZERO.  01990000
               10  PV-DA-TEMP-ENT-ID-NBR    PIC  9(10)     VALUE ZERO.  02000000
      *        10  PV-DA-TEMP-MAJ-CL-NBR    PIC  9(4)      VALUE ZERO.  02010000
               10  PV-DA-TEMP-SUB-CL-NBR    PIC  9(4)      VALUE ZERO.  02020000
               10  PV-DA-TEMP-LBL-SEQ-NBR   PIC  9(9)      VALUE ZERO.  02030000
                                                                        02040000
      *01  DCLIMT00017.                                                 02050000
      *    10 IMT00017-DEPT-BRND-VND-ID     PIC  S9(9) COMP.            02060000
      *    10 IMT00017-DEPT-NBR             PIC  S9(4)V COMP-3.         02070000
      *    10 IMT00017-LBL-SEQ-NBR          PIC  S9(4) COMP.            02080000
      *    10 IMT00017-ENT-ID               PIC  S9(9) COMP.            02090000
      *    10 IMT00017-EFF-BEG-DTE          PIC   X(10).                02100000
      *    10 IMT00017-EFF-END-DTE          PIC   X(10).                02110000
      *                                                                 02120000
           05  PV-HOLD-AREA.                                            02130000
               10  PV-HOLD-DEPT             PIC S9(4)V COMP-3 VALUE +0. 02140000
               10  PV-HOLD-ENT-ID           PIC S9(9)  COMP   VALUE +0. 02150000
               10  PV-HOLD-SCL              PIC S9(4)V COMP-3 VALUE +0. 02160000
256842         10  PV-HOLD-LBL-SEQ-NBR      PIC S9(5)  COMP VALUE ZERO. 02170003
               10  PV-HOLD-BRND-VND-ID      PIC S9(9)  COMP VALUE ZERO. 02180000
                                                                        02190000
           05  PV-CSR-HOLD-AREA.                                        02200000
               10  BV-CSR-DBV-KEY           PIC  S9(9) COMP.            02210000
               10  BV-CSR-DEPT-NBR          PIC  S9(4)V COMP-3.         02220000
CHG1 **        10  BV-CSR-SUB-CL-NBR        PIC  S9(4)V COMP-3.         02230000
               10  BV-CSR-END-INV-RTL       PIC  S9(11)V9(2) COMP-3.    02240000
               10  BV-CSR-END-INV-CST       PIC  S9(11)V9(2) COMP-3.    02250000
                                                                        02260000
           05  PV-CALC-WORK-AREA.                                       02270000
               10  PV-RTL-AMT               PIC S9(09)V99  VALUE +0.    02280000
               10  PV-COST-AMT              PIC S9(09)V99  VALUE +0.    02290000
               10  PV-PCTG            PIC S9(04)V9(4) COMP VALUE 0.     02300000
               10  PV-DA100-PCTG      PIC S9(03)V9(4) COMP VALUE 0.     02310000
      *        10  PV-PCTG            PIC S9(04)V9(2) COMP VALUE 0.     02320000
      *        10  PV-DA100-PCTG      PIC S9(03)V9(2) COMP VALUE 0.     02330000
               10  PV-DA-RTL-AMT-TOTAL      PIC S9(09)V99 COMP-3.       02340000
               10  PV-DA-CST-AMT-TOTAL      PIC S9(09)V99 COMP-3.       02350000
RPT2           10  PV-DA-COST-TEMP          PIC S9(09)V99 COMP-3.       02360000
RPT2           10  PV-DA-RTL-TEMP           PIC S9(09)V99 COMP-3.       02370000
      *                                                                 02380000
SQL    01  SQLSTATE              PIC S9(9) COMPUTATIONAL.               02390000
      *                                                                 02400000
                                                                        02410000
       01  PS-PROGRAM-SWITCHES.                                         02420000
           05  PS-INP03-DONE-SW             PIC X(01)      VALUE 'N'.   02430000
               88  INP03-PROCESS-COMPLETE                  VALUE 'Y'.   02440000
           05  PS-DBV-DKEY-SW               PIC X(01)      VALUE 'N'.   02450000
               88  PS-RELATIONSHIP-NOT-EXISTS              VALUE 'Y'.   02460000
               88  PS-DBV-DKEY-FOUND                       VALUE 'N'.   02470000
           05  PS-VALID-DATE-SW             PIC X(01)      VALUE 'N'.   02480000
               88  PS-EMPTY-DATE-FILE                      VALUE 'Y'.   02490000
           05  PS-DATE-PARTN-SW             PIC X(01)      VALUE 'N'.   02500000
               88  PS-NO-DATES-LEFT                        VALUE 'Y'.   02510000
               88  PS-MORE-DATES                           VALUE 'N'.   02520000
           05  PS-EXCLUSIVE-BRAND-SW        PIC X(01)      VALUE 'Y'.   02530000
               88  PS-MORE-EXCL-BRANDS-LEFT                VALUE 'N'.   02540000
               88  PS-END-OF-EXCL-BRAND-FILE               VALUE 'Y'.   02550000
           05  PS-DEFAULT-BRAND-SW          PIC X(01)      VALUE 'N'.   02560000
               88  DEFAULT-BRAND-FOUND                     VALUE 'Y'.   02570000
               88  PS-NO-DEFAULT-BRAND                     VALUE 'N'.   02580000
           05  PS-UNKNOWN-BRAND-SW          PIC X(01)      VALUE 'N'.   02590000
               88  ASSIGN-UNKNOWN-BRAND                    VALUE 'Y'.   02600000
           05  PS-CUM-TARGET-SW             PIC X(01)      VALUE 'N'.   02610000
               88  PS-ROW-FOUND                            VALUE 'Y'.   02620000
               88  PS-ROW-NOT-FOUND                        VALUE 'N'.   02630000
     *** INITIAL BV CURSOR FETCH                                        02640000
      *    05  PS-BV-CURSOR-SW              PIC X(01)      VALUE 'Y'.   02650000
      *        88  PS-NO-CSR-ROWS-EXTRACTED                VALUE 'N'.   02660000
      *        88  PS-CSR-ROWS-FOUND                       VALUE 'Y'.   02670000
     *** AFTER ALL BV CURSOR ROWS FETCHED                               02680000
           05  PS-BV-TRANS-LEFT-SW          PIC X(01)      VALUE 'Y'.   02690000
               88  PS-NO-MORE-BV-TRANS-LEFT                VALUE 'N'.   02700000
               88  PS-MORE-BV-TRANS-LEFT                   VALUE 'Y'.   02710000
           05  PS-ML-TABLE-LOAD-SW          PIC X(01)      VALUE 'N'.   02720000
               88  PS-ML-TABLE-LOADED                      VALUE 'Y'.   02730000
               88  PS-MORE-ML-TABLE-ROWS                   VALUE 'N'.   02740000
           05  PS-PCT-ADJUST-SW             PIC X(01)      VALUE 'N'.   02750000
               88  PS-PERCENT-ADJUSTED                     VALUE 'Y'.   02760000
               88  PS-PERCENT-UNBALANCED                   VALUE 'N'.   02770000
           05  PS-BRAND-ALLOCATION-SW       PIC X(01)      VALUE ' '.   02780000
               88  PS-ALLOCATE-ALL-EVEN                    VALUE 'A'.   02790000
               88  PS-ALLOCATE-POS-DIST                    VALUE 'B'.   02800000
               88  PS-ALLOCATE-NEG-DIST-ABS                VALUE 'C'.   02810000
               88  PS-ALLOCATE-IN-RANGE-POS-DIST           VALUE 'D'.   02820000
               88  PS-ALLOCATE-IN-RANGE-NEG-ABS            VALUE 'E'.   02830000
               88  PS-ALLOCATE-IN-RANGE-ZERO-EVEN          VALUE 'F'.   02840000
               88  PS-ALLOCATE-IN-RANGE-POS-EVEN           VALUE 'G'.   02850000
               88  PS-ALLOCATE-SINGLE-BRAND                VALUE 'H'.   02860000
               88  PS-ALLOCATE-UNKNOWN-BRAND               VALUE 'I'.   02870000
               88  PS-ALLOCATE-DEFAULT-BRAND               VALUE 'J'.   02880000
               88  PS-ALLOCATE-DEFAULT-ERROR               VALUE 'K'.   02890000
      *        88  PS-ALLOCATE-NEG-ABS-OUT-RANGE           VALUE 'L'.   02900000
                                                                        02910000
       01  PS-DA-TRANS-LEFT-SW          PIC X(01)          VALUE 'Y'.   02920000
           88  PS-NO-MORE-DA-TRANS-LEFT                    VALUE 'N'.   02930000
           88  PS-MORE-DA-TRANS-LEFT                       VALUE 'Y'.   02940000
                                                                        02950000
       01  SS-SUBSCRIPTS.                                               02960000
           05  SS-PARTN-NBR                 PIC S9(04)     COMP SYNC    02970000
                                                           VALUE ZERO.  02980000
           05  SS-ML-BV                     PIC S9(04)     COMP SYNC    02990000
                                                           VALUE ZERO.  03000000
           05  SS-EXCL                      PIC S9(04)     COMP SYNC    03010000
                                                           VALUE ZERO.  03020000
           05  SS-DA                        PIC S9(04)     COMP SYNC    03030000
                                                           VALUE ZERO.  03040000
       01  PA-ML-ACCUMULATORS.                                          03050000
           05  PA-ML-BRAND-COUNT            PIC 9(07)      VALUE  0.    03060000
           05  PA-ML-QUALIFY-COUNT          PIC 9(04)      VALUE  0.    03070000
           05  PA-ML-NEG-EIR-COUNT          PIC 9(04)      VALUE  0.    03080000
           05  PA-ML-ZERO-EIR-COUNT         PIC 9(04)      VALUE  0.    03090000
           05  PA-ML-IN-RANGE-COUNT         PIC 9(04)      VALUE  0.    03100000
           05  PA-ML-IN-RANGE-POS           PIC 9(04)      VALUE  0.    03110000
           05  PA-ML-IN-RANGE-NEG           PIC 9(04)      VALUE  0.    03120000
           05  PA-ML-IN-RANGE-ZERO          PIC 9(04)      VALUE  0.    03130000
           05  PA-ML-OUT-RANGE-COUNT        PIC 9(04)      VALUE  0.    03140000
           05  PA-ML-INV-RTL-POS-TOTAL      PIC S9(09)V99  VALUE +0.    03150000
           05  PA-ML-INV-RTL-NEG-TOTAL      PIC S9(09)V99  VALUE +0.    03160000
           05  PA-ML-IN-RANGE-POS-TOTAL     PIC S9(09)V99  VALUE +0.    03170000
           05  PA-ML-IN-RANGE-NEG-TOTAL     PIC S9(09)V99  VALUE +0.    03180000
           05  PA-ML-INV-RTL-TOTAL          PIC S9(09)V99  VALUE +0.    03190000
           05  PA-ML-INV-COST-TOTAL         PIC S9(09)V99  VALUE +0.    03200000
                                                                        03210000
       01  PA-DA-ACCUMULATORS.                                          03220000
           05  PA-DA-ROWS-FETCHED           PIC 9(07)      VALUE  0.    03230000
           05  PA-DA-BRAND-COUNT            PIC 9(07)      VALUE  0.    03240000
      *    05  PA-DA-PCT-ACCUM        PIC S9(04)V9(4) COMP VALUE  0.    03250000
           05  PA-DA-PCT-ACCUM        PIC S9(04)V9(2) COMP VALUE  0.    03260000
                                                                        03270000
       01  PA-PROGRAM-ACCUMULATORS.                                     03280000
           05  PA-RECORDS-READ              PIC 9(07)      VALUE  0.    03290000
           05  PA-RECORDS-WRITTEN           PIC 9(07)      VALUE  0.    03300000
           05  PA-BRAND-COMBINATIONS        PIC 9(07)      VALUE  0.    03310000
                                                                        03320000
       01  DETAIL-INTERIM-RECORD.                                       03330000
PCT   *    05  ML-DA-PCT-DTL        PIC S9(03)V99999        VALUE 0.    03340000
PCT        05  ML-DA-PCT-DTL        PIC S9(03)V99           VALUE 0.    03350000
           05  ML-DBV-DKEY-DTL      PIC  S9(9)              VALUE 0.    03360000
           05  ML-DEPT-NBR-DTL      PIC   9(4)              VALUE 0.    03370000
           05  ML-SCL-NBR-DTL       PIC   9(4)              VALUE 0.    03380000
           05  ML-VND-NBR-DTL       PIC  S9(9)              VALUE 0.    03390000
256842     05  ML-LBL-SEQ-NBR-DTL   PIC  S9(5)              VALUE 0.    03400003
           05  ML-END-INV-RTL-DTL   PIC  S9(11)V9(2)        VALUE 0.    03410000
           05  ML-END-INV-COST2-DTL PIC  S9(11)V9(2)        VALUE 0.    03420000
           05  ML-MKUP-PCT-DTL      PIC  S9(04)V9(7)        VALUE 0.    03430000
           05  ML-NEG-INV-IND-DTL   PIC   9(1)              VALUE 0.    03440000
           05  ML-ZERO-INV-IND-DTL  PIC   9(1)              VALUE 0.    03450000
           05  ML-OUT-RANGE-IND-DTL PIC   9(1)              VALUE 0.    03460000
                                                                        03470000
      * PARTITIONS USED FOR MLT_WKLY_SUM EXTRACTION                     03480000
       01  PREV-WK-PARTITIONS.                                          03490000
           05  PFW-PARTN               OCCURS 2 TIMES                   03500000
                                       PIC  S9(4) COMP   VALUE ZERO.    03510000
                                                                        03520000
      * DEPT/SCL COMBINATIONS ON FILE ARE DEFAULTED TO A SPECIFIC BRAND 03530000
      *1---5----1----5----1----5----1----5----1----5----1----5          03540000
      *0015 0050 0051 000002496 SIMPLY VERA VERA WANG                   03550000
       01  EXCLUSIVE-DEFAULT-ASSIGNMENT.                                03560000
           05  DFLT-DEPT-NBR           PIC 9(04)    VALUE ZERO.         03570000
           05  FILLER                  PIC X(01)    VALUE SPACES.       03580000
           05  DFLT-MCL-NBR            PIC 9(04)    VALUE ZERO.         03590000
           05  FILLER                  PIC X(01)    VALUE SPACES.       03600000
           05  DFLT-SCL-NBR            PIC 9(04)    VALUE ZERO.         03610000
           05  FILLER                  PIC X(01)    VALUE SPACES.       03620000
           05  DFLT-LBL-SEQ-NBR        PIC 9(09)    VALUE ZERO.         03630000
           05  FILLER                  PIC X(01)    VALUE SPACES.       03640000
           05  DFLT-BRAND-NAME         PIC X(20)    VALUE SPACES.       03650000
           05  FILLER                  PIC X(35)    VALUE SPACES.       03660000
                                                                        03670000
      * THIS TABLE IS LOADED/SEARCHED FOR DEFAULT BRAND USAGE           03680000
       01  EXCL-BRAND-TABLE.                                            03690000
           05  EXCL-BRAND-ENTRIES  OCCURS    999 TIMES.                 03700000
               10  EXCL-DEPT           PIC 9(04)  VALUE ZERO.           03710000
      *        10  EXCL-MCL            PIC 9(04)  VALUE ZERO.           03720000
               10  EXCL-SCL            PIC 9(04)  VALUE ZERO.           03730000
               10  EXCL-BRAND          PIC 9(10)  VALUE ZERO.           03740000
               10  EXCL-BRAND-NAME     PIC X(25)  VALUE SPACE.          03750000
                                                                        03760000
TABLES******************************************************************03770000
      *                                                                 03780000
      * WORKING STORAGE TABLES FOR ML FINANCIAL EXTRACS AND DA PRORATION03790000
      *                                                                 03800000
      ******************************************************************03810000
      *                                                                 03820000
TABLES*    THE ML-DPT-BRND-VND TABLE CONTAINS ALL BRAND DATA FINANCIALS 03830000
      *    THAT QUALIFY BASED ON THE DEPT AND VENDOR COMBO FROM DA.     03840000
      *    FURTHER EDITS PERFORMED ON ENTRIES TO FILTER OUT DATA        03850000
                                                                        03860000
       01  ML-DPT-BRND-VND-TABLE.                                       03870000
           05  ML-DBV-ENTRIES OCCURS 160 TIMES.                         03880000
               10  ML-INCL-IND          PIC   9(1)              VALUE 0.03890000
PCT  **        10  ML-DA-PCT            PIC   9(3)V9(4) COMP    VALUE 0.03900000
PCT            10  ML-DA-PCT            PIC   9(3)V9(2) COMP    VALUE 0.03910000
               10  ML-DBV-DKEY          PIC  S9(9) COMP         VALUE 0.03920000
               10  ML-DEPT-NBR          PIC  S9(4)V COMP-3      VALUE 0.03930000
               10  ML-SCL-NBR           PIC  S9(4)V COMP-3      VALUE 0.03940000
               10  ML-VND-NBR           PIC  S9(9) COMP         VALUE 0.03950000
256842         10  ML-LBL-SEQ-NBR       PIC  S9(5) COMP         VALUE 0.03960003
               10  ML-END-INV-RTL-AMT   PIC  S9(11)V9(2) COMP-3 VALUE 0.03970000
               10  ML-END-INV-COST2-AMT PIC  S9(11)V9(2) COMP-3 VALUE 0.03980000
               10  ML-MKUP-PCT          PIC  S9(04)V9(7) COMP-3 VALUE 0.03990000
               10  ML-NEG-INV-IND       PIC   9(1)              VALUE 0.04000000
               10  ML-ZERO-INV-IND      PIC   9(1)              VALUE 0.04010000
               10  ML-OUT-RANGE-IND     PIC   9(1)              VALUE 0.04020000
                                                                        04030000
      ***************************************************************** 04040000
      *  STANDARD 133 BYTE REPORT HEADINGS                             *04050000
      ***************************************************************** 04060000
           COPY DPWS133O.                                               04070000
      ***************************************************************** 04080000
      *  DA REPORT 1                                                    04090000
      ***************************************************************** 04100000
       01  HEADER1.                                                     04110000
           05  FILLER                  PIC X(45)   VALUE SPACES.        04120000
           05  FILLER                  PIC X(42)   VALUE                04130000
               ' DEBIT ALLOWANCE - BRAND LEVEL PRORATION '.             04140000
           05  FILLER                  PIC X(45)   VALUE SPACES.        04150000
       01  HEADER2.                                                     04160000
           05  FILLER                  PIC X(09)   VALUE 'DEPT-SCL:'.   04170000
           05  HEADER-DEPT             PIC Z999    VALUE ZEROES.        04180000
           05  FILLER                  PIC X(01)   VALUE '-'.           04190000
           05  HEADER-SCL              PIC 99      VALUE ZEROES.        04200000
           05  FILLER                  PIC X(02)   VALUE SPACES.        04210000
           05  FILLER                  PIC X(08)   VALUE 'VENDOR: '.    04220000
           05  HEADER-VENDOR           PIC X(30)   VALUE SPACES.        04230000
           05  FILLER                  PIC X(65)   VALUE SPACES.        04240000
      *                                                                 04250000
       01  HEADER2-DA.                                                  04260000
           05  FILLER                  PIC X(11)   VALUE 'DA NUMBER: '. 04270000
           05  HEADER-DA-NBR           PIC X(16)   VALUE SPACE.         04280000
           05  FILLER                  PIC X(02)   VALUE SPACES.        04290000
           05  FILLER                  PIC X(08)   VALUE '(TARGET '.    04300000
           05  FILLER                  PIC X(08)   VALUE 'MKUP %: '.    04310000
           05  HEADER-MIN-TARGET       PIC -9(3).9 VALUE ZERO.          04320000
           05  FILLER                  PIC X(03)   VALUE ' - '.         04330000
           05  HEADER-MAX-TARGET       PIC  9(3).9- VALUE ZERO.         04340000
           05  FILLER                  PIC X(07)   VALUE ')      '.     04350000
           05  FILLER                  PIC X(08)   VALUE ' ENDING '.    04360000
           05  FILLER                  PIC X(09)   VALUE 'INVENTORY'.   04370000
           05  FILLER                  PIC X(08)   VALUE ' AMOUNTS'.    04380000
           05  FILLER                  PIC X(20)   VALUE SPACES.        04390000
           05  FILLER                  PIC X(04)   VALUE 'VALI'.        04400000
           05  FILLER                  PIC X(10)   VALUE 'DATION CRI'.  04410000
           05  FILLER                  PIC X(05)   VALUE 'TERIA'.       04420000
      *                                                                 04430000
       01  HEADER3.                                                     04440000
           05  FILLER                  PIC   X(01)   VALUE SPACES.      04450000
           05  ML-RPT-BRAND-PCT        PIC   X(06)   VALUE '  PCT '.    04460000
           05  FILLER                  PIC   X(02)   VALUE SPACES.      04470000
      *    05  ML-RPT-DR-ALW-NBR        PIC  X(09)  VALUE 'DA NUMBER'.  04480000
           05  ML-RPT-VND-NBR           PIC  X(09)  VALUE '  ENT-ID '.  04490000
           05  FILLER                   PIC  X(05)  VALUE SPACES.       04500000
           05  ML-RPT-DBV-DKEY         PIC   X(10)   VALUE ' DBV DKEY '.04510000
           05  FILLER                   PIC  X(02)  VALUE SPACES.       04520000
           05  ML-RPT-LBL-SEQ-NBR       PIC  X(10)  VALUE 'BRAND NBR '. 04530000
           05  FILLER                   PIC  X(01)  VALUE SPACES.       04540000
           05  ML-RPT-BRAND             PIC  X(10)  VALUE '     BRAND'. 04550000
           05  ML-RPT-BRAND-NAME        PIC  X(10)  VALUE ' NAME     '. 04560000
           05  FILLER                   PIC  X(04)   VALUE SPACES.      04570000
           05  ML-RPT-END-INV-RTL-AMT   PIC  X(10)   VALUE 'ENDINV RTL'.04580000
           05  FILLER                   PIC  X(06)   VALUE SPACES.      04590000
           05  ML-RPT-END-INV-COST2-AMT PIC  X(10)   VALUE 'ENDINV CST'.04600000
           05  FILLER                   PIC  X(05)   VALUE SPACES.      04610000
           05  ML-RPT-MKUP-PCT          PIC  X(08)   VALUE 'MKUP%   '.  04620000
           05  FILLER                   PIC  X(05)   VALUE SPACES.      04630000
           05  ML-RPT-NEG-INV-IND       PIC  X(03)   VALUE 'NEG'.       04640000
           05  FILLER                   PIC  X(03)   VALUE SPACES.      04650000
           05  ML-RPT-ZERO-INV-IND      PIC  X(04)   VALUE 'ZERO'.      04660000
           05  FILLER                   PIC  X(02)   VALUE SPACES.      04670000
           05  ML-RPT-OUT-RANGE-IND     PIC  X(03)   VALUE 'CUM'.       04680000
                                                                        04690000
       01  HEADER4.                                                     04700000
           05  ML-RPT-INCL-IND         PIC   X(01)   VALUE SPACES.      04710000
           05  ML-BRAND-PCTS           PIC   X(06)   VALUE '------'.    04720000
           05  FILLER                  PIC   X(01)   VALUE SPACES.      04730000
    ***    05  ML-RPT-DR-ALW-NBR        PIC   X(09)   VALUE '---------'.04740000
           05  ML-RPT-VND-NBR           PIC   X(09)   VALUE '---------'.04750000
           05  FILLER                   PIC   X(06)   VALUE SPACES.     04760000
           05  ML-RPT-DBV-DKEY         PIC   X(10)   VALUE '----------'.04770000
           05  FILLER                   PIC   X(02)   VALUE SPACES.     04780000
           05  ML-RPT-LBL-SEQ           PIC   X(09)   VALUE '---------'.04790000
           05  FILLER                   PIC   X(01)   VALUE SPACES.     04800000
           05  ML-RPT-BRAND             PIC  X(10)  VALUE '----------'. 04810000
           05  ML-RPT-BRAND-NAME        PIC  X(11)  VALUE '-----------'.04820000
           05  FILLER                   PIC  X(01)   VALUE SPACES.      04830000
           05  ML-RPT-END-INV-RTL-AMT   PIC  X(10)   VALUE '----------'.04840000
           05  ML-RPT-END-INV-RTL-AMT2  PIC  X(07)   VALUE '-------'.   04850000
           05  FILLER                   PIC  X(01)   VALUE SPACES.      04860000
           05  ML-RPT-END-INV-COST2-AMT PIC  X(10)   VALUE '----------'.04870000
           05  ML-RPT-END-INV-COST2-AM2 PIC  X(05)   VALUE '-----'.     04880000
           05  FILLER                   PIC  X(01)   VALUE SPACES.      04890000
           05  ML-RPT-MKUP-PCT          PIC  X(10)   VALUE '----------'.04900000
           05  FILLER                   PIC  X(05)   VALUE SPACES.      04910000
           05  ML-RPT-NEG-INV-IND       PIC  X(03)   VALUE '---'.       04920000
           05  FILLER                   PIC  X(03)   VALUE SPACES.      04930000
           05  ML-RPT-ZERO-INV-IND      PIC  X(03)   VALUE '---'.       04940000
           05  FILLER                   PIC  X(02)   VALUE SPACES.      04950000
           05  ML-RPT-OUT-RANGE-IND     PIC  X(03)   VALUE '---'.       04960000
                                                                        04970000
                                                                        04980000
       01  DETAIL-RECORD.                                               04990000
           05  ML-DTL-INCL-IND         PIC   X(01)   VALUE SPACES.      05000000
           05  ML-DTL-BRAND-PCT        PIC   ZZ9.99  VALUE ZERO.        05010000
           05  FILLER                  PIC   X(01)   VALUE SPACES.      05020000
      *    05  ML-DTL-DR-ALW-NBR       PIC   X(16).                     05030000
           05  ML-DTL-VND-NBR          PIC   ZZZZZZZZ9.                 05040000
           05  FILLER                   PIC  X(06)   VALUE SPACES.      05050000
           05  ML-DTL-DBV-DKEY         PIC   ZZZZZZZZZ9 VALUE ZERO.     05060000
           05  FILLER                   PIC  X(02)   VALUE SPACES.      05070000
           05  ML-DTL-LBL-SEQ           PIC  ZZZZZZZZ9  VALUE ZERO.     05080000
           05  FILLER                   PIC  X(01)   VALUE SPACES.      05090000
           05  ML-DTL-BRAND-NAME        PIC  X(20)   VALUE SPACES.      05100000
           05  FILLER                   PIC  X(04)   VALUE SPACES.      05110000
           05  ML-DTL-END-INV-RTL-AMT   PIC  ZZZ,ZZZ,ZZZ.99- VALUE ZERO.05120000
           05  FILLER                   PIC  X(01)   VALUE SPACES.      05130000
           05  ML-DTL-END-INV-COST2-AMT PIC  ZZZ,ZZZ,ZZZ.99- VALUE ZERO.05140000
           05  FILLER                   PIC  X(03)   VALUE SPACES.      05150000
           05  ML-DTL-MKUP-PCT          PIC ZZZ9.999-.                  05160000
           05  FILLER                   PIC  X(06)   VALUE SPACES.      05170000
           05  ML-DTL-NEG-INV-IND       PIC  X(01)   VALUE SPACES.      05180000
           05  FILLER                   PIC  X(03)   VALUE SPACES.      05190000
           05  ML-DTL-ZERO-INV-IND      PIC  X(01)   VALUE SPACES.      05200000
           05  FILLER                   PIC  X(02)   VALUE SPACES.      05210000
           05  ML-DTL-OUT-RANGE-IND     PIC  X(01)   VALUE SPACES.      05220000
           05  FILLER                   PIC  X(06)   VALUE SPACES.      05230000
                                                                        05240000
      ***************************************************************** 05250000
      *  DA REPORT 2  .CSV                                              05260000
      ***************************************************************** 05270000
       01  RPT2-HEADER.                                                 05280000
           05  RPT2-FSCL-WK-DTE        PIC X(10)   VALUE 'FISCAL WK '.  05290000
           05  FILLER                  PIC X(1)    VALUE ','.           05300000
           05  RPT2-DEPT               PIC X(4)    VALUE 'DEPT'.        05310000
           05  FILLER                  PIC X(1)    VALUE ','.           05320000
           05  RPT2-TARGET-MIN         PIC X(9)    VALUE 'MIN MKUP%'.   05330000
           05  FILLER                  PIC X(1)    VALUE ','.           05340000
           05  RPT2-TARGET-MAX         PIC X(9)    VALUE 'MAX RANGE'.   05350000
           05  FILLER                  PIC X(1)    VALUE ','.           05360000
           05  RPT2-VENDOR             PIC X(30)   VALUE 'VENDOR'.      05370000
           05  FILLER                  PIC X(1)    VALUE ','.           05380000
           05  RPT2-SCL                PIC X(4)    VALUE ' SCL'.        05390000
           05  FILLER                  PIC X(1)    VALUE ','.           05400000
           05  RPT2-DA-NBR             PIC X(16)                        05410000
                                VALUE 'DA NUMBER       '.               05420000
           05  FILLER                  PIC X(1)    VALUE ','.           05430000
           05  RPT2-LBL-SEQ-NBR        PIC X(16)                        05440000
                                VALUE 'LBL SEQ NBR     '.               05450000
           05  FILLER                  PIC X(1)    VALUE ','.           05460000
           05  RPT2-BRAND-NAME         PIC X(30)                        05470000
                                VALUE 'BRAND NAME                    '. 05480000
           05  FILLER                  PIC X(1)    VALUE ','.           05490000
           05  RPT2-BRAND-PCT          PIC X(8)    VALUE 'BRAND % '.    05500000
           05  FILLER                  PIC X(1)    VALUE ','.           05510000
           05  RPT2-EXCEPTION-NEG      PIC X(3)    VALUE 'NEG'.         05520000
           05  FILLER                  PIC X(1)    VALUE ','.           05530000
           05  RPT2-EXCEPTION-ZERO     PIC X(4)    VALUE 'ZERO'.        05540000
           05  FILLER                  PIC X(1)    VALUE ','.           05550000
           05  RPT2-EXCEPTION-RANGE    PIC X(3)    VALUE 'CUM'.         05560000
           05  FILLER                  PIC X(1)    VALUE ','.           05570000
           05  RPT2-EIRRTL-BASIS       PIC X(13)                        05580000
                                              VALUE 'ML EIR BASIS '.    05590000
           05  FILLER                  PIC X(1)    VALUE ','.           05600000
           05  RPT2-EIRCOST-BASIS      PIC X(13)                        05610000
                                              VALUE 'ML EIC BASIS '.    05620000
           05  FILLER                  PIC X(1)    VALUE ','.           05630000
           05  RPT2-MKUP-PCT           PIC X(8)    VALUE 'MKUP%   '.    05640000
           05  FILLER                  PIC X(1)    VALUE ','.           05650000
           05  RPT2-DA-COST            PIC X(13)                        05660000
                                VALUE 'DA COST AMT  '.                  05670000
           05  FILLER                  PIC X(1)    VALUE ','.           05680000
           05  RPT2-DA-RTL             PIC X(13)                        05690000
                                VALUE 'DA RTL AMT   '.                  05700000
           05  FILLER                  PIC X(1)    VALUE ','.           05710000
           05  RPT2-EIRRTL-APPLIED     PIC X(13)                        05720000
                                              VALUE 'DA EIR APPLY '.    05730000
           05  FILLER                  PIC X(1)    VALUE ','.           05740000
           05  RPT2-EIRCOST-APPLIED    PIC X(13)                        05750000
                                              VALUE 'DA EIC APPLY '.    05760000
           05  FILLER                  PIC X(1)    VALUE ','.           05770000
           05  RPT2-ALLOCATION         PIC X(20)                        05780000
                                       VALUE 'ALLOCATION METHOD   '.    05790000
           05  FILLER                  PIC X(1)    VALUE ','.           05800000
           05  RPT2-DA-PRRTN           PIC X(8)    VALUE SPACE.         05810000
           05  FILLER                  PIC X(19)   VALUE SPACES.        05820000
      *                                                                 05830000
      *01  RPT2-DETAIL.                                                 05840000
      *    05  RPT2-FSCL-WK-DTL        PIC X(10)      VALUE SPACES.     05850000
      *    05  FILLER                  PIC X(1)       VALUE ','.        05860000
      *    05  RPT2-DEPT-DTL           PIC ZZZ9       VALUE ZERO.       05870000
      *    05  FILLER                  PIC X(1)       VALUE ','.        05880000
      *    05  RPT2-TARGET-MIN-DTL     PIC ZZZ9.999-  VALUE ZERO.       05890000
      *    05  FILLER                  PIC X(1)       VALUE ','.        05900000
      *    05  RPT2-TARGET-MAX-DTL     PIC ZZZ9.999-  VALUE ZERO.       05910000
      *    05  FILLER                  PIC X(1)       VALUE ','.        05920000
      *    05  RPT2-VENDOR-DTL         PIC X(30)      VALUE SPACE.      05930000
      *    05  FILLER                  PIC X(1)       VALUE ','.        05940000
      *    05  RPT2-SCL-DTL            PIC ZZZ9       VALUE ZERO.       05950000
      *    05  FILLER                  PIC X(1)       VALUE ','.        05960000
      *    05  RPT2-DA-NBR-DTL         PIC X(16)      VALUE SPACE.      05970000
      *    05  FILLER                  PIC X(1)       VALUE ','.        05980000
      *    05  RPT2-LBL-SEQ-NBR-DTL    PIC Z9(15)     VALUE ZERO.       05990000
      *    05  FILLER                  PIC X(1)    VALUE ','.           06000000
      *    05  RPT2-BRAND-NAME-DTL     PIC X(30)      VALUE SPACE.      06010000
      *    05  FILLER                  PIC X(1)       VALUE ','.        06020000
      *    05  RPT2-BRAND-PCT-NEW      PIC Z99.9999   VALUE ZERO.       06030000
      *    05  FILLER                  PIC X(1)       VALUE ','.        06040000
      *    05  FILLER                  PIC X(1)       VALUE SPACE.      06050000
      *    05  RPT2-EXCEPTION-NEG-DTL  PIC X(1)       VALUE SPACE.      06060000
      *    05  FILLER                  PIC X(1)       VALUE SPACE.      06070000
      *    05  FILLER                  PIC X(1)       VALUE ','.        06080000
      *    05  FILLER                  PIC X(2)       VALUE SPACE.      06090000
      *    05  RPT2-EXCEPTION-ZERO-DTL PIC X(1)       VALUE SPACE.      06100000
      *    05  FILLER                  PIC X(1)       VALUE SPACE.      06110000
      *    05  FILLER                  PIC X(1)       VALUE ','.        06120000
      *    05  FILLER                  PIC X(1)       VALUE SPACE.      06130000
      *    05  RPT2-EXCEPTION-CUM-DTL  PIC X(1)       VALUE SPACE.      06140000
      *    05  FILLER                  PIC X(1)       VALUE SPACE.      06150000
      *    05  FILLER                  PIC X(1)       VALUE ','.        06160000
      *    05  RPT2-EIRRTL-BASIS-DTL   PIC  ZZZZZZZZZ.99- VALUE ZERO.   06170000
      *    05  FILLER                  PIC X(1)       VALUE ','.        06180000
      *    05  RPT2-EIRCOST-BASIS-DTL  PIC  ZZZZZZZZZ.99- VALUE ZERO.   06190000
      *    05  FILLER                  PIC X(1)       VALUE ','.        06200000
      *    05  RPT2-MKUP-PCT-DTL       PIC ZZ9.999-   VALUE ZERO.       06210000
      *    05  FILLER                  PIC X(1)       VALUE ','.        06220000
      *    05  RPT2-DA-COST-DTL        PIC ZZZZZZZZZZ.99 VALUE ZERO.    06230000
      *    05  FILLER                  PIC X(1)       VALUE ','.        06240000
      *    05  RPT2-DA-RTL-DTL         PIC ZZZZZZZZZZ.99 VALUE ZERO.    06250000
      *    05  FILLER                  PIC X(1)       VALUE ','.        06260000
      *    05  RPT2-EIRRTL-APPLIED-DTL PIC  ZZZZZZZZZ.99- VALUE ZERO.   06270000
      *    05  FILLER                  PIC X(1)    VALUE ','.           06280000
      *    05  RPT2-EIRCOST-APPLIED-DTL PIC ZZZZZZZZZ.99- VALUE ZERO.   06290000
      *    05  FILLER                  PIC X(1)    VALUE ','.           06300000
      *    05  RPT2-ALLOCATION-METHOD  PIC X(20)   VALUE SPACE.         06310000
      *                                                                 06320000
      *                                                                 06330000
                                                                        06340000
      *----------------------------------------------------------------*06350000
      *    ORACLE DECLARE SECTION                                       06360000
      *----------------------------------------------------------------*06370000
      *    EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     06380000
      *                                                                 06390000
      *    1---5----1----5----1----0----1                               06400000
      *    IIII UUUUUUUU LL PPPPPPPP LL                                 06410000
      *01  TST  DATEAM   06 TEAMDA   06                                 06420000
      *01  LRN  READONLY 08 READONLY 08                                 06430000
      *01  QA   DATEAM   06 DATEAM   06                                 06440000
      *01  PRDT READONLY 08 READONLY 08                                 06450000
      *01  PRD           00          00                                 06460000
      *01  USERNAME                       PIC X(10)      VARYING.       06470000
      *01  USERNAME-ARR                   PIC X(10)      VARYING.       06480000
      *01  USERNAME-LEN                   PIC X(10)      VARYING.       06490000
      *01  PASSWD                         PIC X(10)      VARYING.       06500000
      *01  PC-ENT01-TYPE-CDE              PIC X(02)      VALUE '01'.    06510000
      *01  PV-ORACLE-ID                   PIC X(1)       VALUE '/'.     06520000
      ******************************************************************06530000
      * COBOL DECLARATION FOR DB2 DATE ATTRIBUTE TABLE                  06540000
      ******************************************************************06550000
           EXEC SQL                                                     06560000
               INCLUDE TDTATTR                                          06570000
           END-EXEC.                                                    06580000
      ******************************************************************06590000
      * COBOL DECLARATION FOR DB2 VENDOR TABLE                          06600000
      ******************************************************************06610000
           EXEC SQL                                                     06620000
               INCLUDE TENTNME                                          06630000
           END-EXEC.                                                    06640000
      ******************************************************************06650000
      * COBOL DECLARATION FOR DB2 LABEL (IMT_LBL) TABLE                 06660000
      ******************************************************************06670000
           EXEC SQL                                                     06680000
               INCLUDE IMT00000                                         06690000
           END-EXEC.                                                    06700000
      ******************************************************************06710000
      * COBOL DECLARATION FOR DB2 BRAND TABLE                           06720000
      ******************************************************************06730000
           EXEC SQL                                                     06740000
               INCLUDE TVSCHVL                                          06750000
           END-EXEC.                                                    06760000
      ******************************************************************06770000
      * COBOL DECLARATION FOR DB2 IMT_DEPT_BRND_VND TABLE               06780000
      ******************************************************************06790000
           EXEC SQL                                                     06800000
               INCLUDE IMT00017                                         06810000
           END-EXEC.                                                    06820000
      *01  DCLIMT00017.                                                 06830000
      *    10 IMT00017-DEPT-BRND-VND-ID     PIC  S9(9) COMP.            06840000
      *    10 IMT00017-DEPT-NBR             PIC  S9(4)V COMP-3.         06850000
      *    10 IMT00017-LBL-SEQ-NBR          PIC  S9(4) COMP.            06860000
      *    10 IMT00017-ENT-ID               PIC  S9(9) COMP.            06870000
      *    10 IMT00017-EFF-BEG-DTE          PIC   X(10).                06880000
      *    10 IMT00017-EFF-END-DTE          PIC   X(10).                06890000
      ******************************************************************06900000
      * COBOL DECLARATION FOR DB2 PARTITION CONTROL MLT_PARTN_CNTL      06910000
      ******************************************************************06920000
           EXEC SQL                                                     06930000
               INCLUDE MLT00003                                         06940000
           END-EXEC.                                                    06950000
      ******************************************************************06960000
      * COBOL DECLARATION FOR DB2 WEEKLY BRAND VENDOR TABLE MLT_WKLY_SUM06970000
      ******************************************************************06980000
           EXEC SQL                                                     06990000
               INCLUDE MLT00005                                         07000000
           END-EXEC.                                                    07010000
      ******************************************************************07020000
      * COBOL DECLARATION FOR DB2 UNKNOWN DKEY TABLE MLT_UNKN_BRND_VND  07030000
      ******************************************************************07040000
           EXEC SQL                                                     07050000
               INCLUDE MLT00011                                         07060000
           END-EXEC.                                                    07070000
      ******************************************************************07080000
      * COBOL DECLARATION FOR DB2 DEPT MKUP RANGE MLT_CUM_MKUP_TGT      07090000
      ******************************************************************07100000
           EXEC SQL                                                     07110000
               INCLUDE MLT00013                                         07120000
           END-EXEC.                                                    07130000
      ******************************************************************07140000
      * COBOL DECLARATION FOR DB2 CORP MKUP RANGE MLT_CORP_GLBL_DFLT    07150000
      ******************************************************************07160000
           EXEC SQL                                                     07170000
               INCLUDE MLT00014                                         07180000
           END-EXEC.                                                    07190000
      ******************************************************************07200000
      * COBOL DECLARATION FOR ORACLE DEBIT ALLOW TABLE                  07210000
      ******************************************************************07220000
      *    EXEC SQL                                                     07230000
      *        INCLUDE TDAALW                                           07240000
      *    END-EXEC.                                                    07250000
      ******************************************************************07260000
      * COBOL DECLARATION FOR ORACLE BRAND PRORATION TABLE              07270000
      ******************************************************************07280000
      *    EXEC SQL                                                     07290000
      *        INCLUDE DAT_BRND_PRRTN                                   07300000
      *    END-EXEC.                                                    07310000
      *                                                                 07320000
      *    EXEC SQL                                                     07330000
      *        INCLUDE DAT00001                                         07340000
      *    END-EXEC.                                                    07350000
      ******************************************************************07360000
      * COBOL DECLARATION FOR TABLE K_DA01.DAT_BRND_PRRTN              *07370000
      ******************************************************************07380000
      *01  DAT00001.                                                    07390000
      *    10  DR-ALW-NBR                     PIC X(16).                07400000
      *    10  LBL-SEQ-NBR                    PIC S9(10) COMP-3.        07410000
      *    10  EFF-BEG-TMST                   PIC X(19).                07420000
      *    10  EFF-END-TMST                   PIC X(19).                07430000
      *    10  PRRTN-PCT                      PIC S9(3)V9(2) COMP-3.    07440000
      *    10  CRE-BY-USR-ID                  PIC X(8).                 07450000
      ******************************************************************07460000
      * THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 6       *07470000
      ******************************************************************07480000
      ***************************************************************** 07490000
      *    PARTITION DATE SELECTION CURSOR                              07500000
      *    THE INPUT DATE WILL BE USED TO RETRIEVE THE ML PARTITIONS    07510000
      *    THAT RELATE TO THE INPUT WEEKE-END-DATE'S PRIOR WEEK PARTS.  07520000
      *                                                                 07530000
      *    THE PRIOR WEEK IS WHAT DA EIR PRORATION IS BASED UPON        07540000
      ***************************************************************** 07550000
      * JOIN OF DATE ATTRIBUTE AND PARTITION CONTROL TABLES             07560000
                                                                        07570000
           EXEC SQL                                                     07580000
               DECLARE DATE_CSR CURSOR FOR                              07590000
                  SELECT PARTN_NBR                                      07600000
                       , FSCL_WK_END_DTE                                07610000
                    FROM MLT_PARTN_CNTL A                               07620000
                        ,TDTATTR        B                               07630000
                   WHERE TBL_TM_LVL_CDE  = 'W'                          07640000
                     AND FSCL_DTE = KY_DTE                              07650000
                     AND KY_DTE = (                                     07660000
                         SELECT PFW_END_DTE                             07670000
                           FROM TDTATTR                                 07680000
                          WHERE KY_DTE = :PV-FSCL-WK-END-DTE)           07690000
           END-EXEC.                                                    07700000
      *                                                                 07710000
      ***************************************************************** 07720000
      *    BRAND VENDOR FINANCIAL EXTRACT CURSOR (MLT_WKLY_SUM)         07730000
      *  - CRITERIA FOR SELECTION IS BASED ON PRIOR WEEKS PARTITIONS    07740000
      *                                                                 07750000
      *NOTE: DA'S ARE CREATED AT A DEPT/SCL BUT DIRECTION WAS TO BASE   07760000
      *      EIR ON THE DEPT-LEVEL ALLOCATION.                          07770000
      ****** UNCOMMENT SUB_CL_NBR CRITERIA BELOW IF REQUIRED (SCL****)  07780000
      ***************************************************************** 07790000
                                                                        07800000
           EXEC SQL                                                     07810000
               DECLARE BRAND_VENDOR_CSR CURSOR FOR                      07820000
      *                                                                 07830000
                SELECT ML_LO_MDSE_LVL_ID                                07840000
                     , DEPT_NBR                                         07850000
CHG1 **              , SUB_CL_NBR                                       07860000
                     , SUM(END_INV_RTL_AMT)                             07870000
                     , SUM(END_INV_COST2_AMT)                           07880000
                  FROM MLT_WKLY_SUM                                     07890000
                 WHERE PARTN_NBR IN (:PV-PART1, :PV-PART2)              07900000
                   AND DEPT_NBR      = :PV-HOLD-DEPT                    07910000
CHG1 **            AND SUB_CL_NBR    = :PV-HOLD-SCL                     07920000
                   AND ML_LO_MDSE_LVL_ID IN                             07930000
                       (                                                07940000
                       SELECT DEPT_BRND_VND_ID                          07950000
                         FROM IMT_DEPT_BRND_VND                         07960000
                        WHERE DEPT_NBR      = :PV-HOLD-DEPT             07970000
                          AND ENT_ID        = :PV-HOLD-ENT-ID           07980000
                          AND EFF_BEG_DTE  <= :PV-FSCL-WK-END-DTE       07990000
                          AND (EFF_END_DTE >= :PV-FSCL-WK-END-DTE       08000000
                           OR  EFF_END_DTE IS NULL))                    08010000
                 GROUP BY DEPT_NBR                                      08020000
CHG1 **                  ,SUB_CL_NBR                                    08030000
                         ,ML_LO_MDSE_LVL_ID                             08040000
                 ORDER BY DEPT_NBR                                      08050000
CHG1 **                 , SUB_CL_NBR                                    08060000
                        , ML_LO_MDSE_LVL_ID                             08070000
           END-EXEC.                                                    08080000
      *                                                                 08090000
      *    EXEC SQL END DECLARE SECTION END-EXEC.                       08100000
      *                                                                 08110000
      *                                                                 08120000
      * ORA COMMUNICATION AREA                                          08130000
      *                                                                 08140000
        01       SQLCA.                                                 08150000
                 05  SQLCAID               PIC X(8).                    08160000
                 05  SQLCABC               PIC S9(9) COMPUTATIONAL.     08170000
                 05  SQLCODE               PIC S9(9) COMPUTATIONAL.     08180000
                 05  SQLERRM.                                           08190000
                     49 SQLERRML           PIC S9(4) COMPUTATIONAL.     08200000
                     49 SQLERRMC           PIC X(70).                   08210000
                 05  SQLERRP               PIC X(8).                    08220000
                 05  SQLERRD OCCURS 6 TIMES                             08230000
                                           PIC S9(9) COMPUTATIONAL.     08240000
                 05  SQLWARN.                                           08250000
                     10 SQLWARN0           PIC X(1).                    08260000
                     10 SQLWARN1           PIC X(1).                    08270000
                     10 SQLWARN2           PIC X(1).                    08280000
                     10 SQLWARN3           PIC X(1).                    08290000
                     10 SQLWARN4           PIC X(1).                    08300000
                     10 SQLWARN5           PIC X(1).                    08310000
                     10 SQLWARN6           PIC X(1).                    08320000
                     10 SQLWARN7           PIC X(1).                    08330000
                 05  SQLEXT                PIC X(8).                    08340000
      *                                                                 08350000
      * ORA COMMUNICATION AREA2                                         08360000
      *                                                                 08370000
           COPY SQLCA2.                                                 08380000
      *                                                                 08390000
      *                                                                 08400000
      * DA DETAIL AND DATE COPYBOOKS                                    08410000
           COPY DARD100.                                                08420000
           COPY DARD104.                                                08430000
           COPY DARD111.                                                08440000
      *                                                                 08450000
      *                                                                 08460000
       EJECT                                                            08470000
      *----------------------------------------------------------------*08480000
       PROCEDURE DIVISION.                                              08490000
                                                                        08500000
      *----------------------------------------------------------------*08510000
      *    MAINLINE-LOGIC                                              *08520000
      *----------------------------------------------------------------*08530000
                                                                        08540000
       0000-MAINLINE-LOGIC.                                             08550000
                                                                        08560000
           PERFORM 1000-INITIALIZATION.                                 08570000
                                                                        08580000
           IF PS-NO-MORE-DA-TRANS-LEFT                                  08590000
               DISPLAY '*** NO INPUT RECORDS - PROCESSING ENDED ***'    08600000
           ELSE                                                         08610000
               PERFORM 1200-PREPARE-TABLES                              08620000
      *        PERFORM 7000-ORACLE-LOGON                                08630000
           END-IF.                                                      08640000
                                                                        08650000
           IF PS-MORE-DA-TRANS-LEFT                                     08660000
               PERFORM 2000-PROCESS-TDAALWS                             08670000
                   UNTIL PS-NO-MORE-DA-TRANS-LEFT                       08680000
           END-IF.                                                      08690000
                                                                        08700000
           PERFORM 9900-EOJ-LOGIC.                                      08710000
                                                                        08720000
           STOP RUN.                                                    08730000
      *                                                                 08740000
                                                                        08750000
      /----------------------------------------------------------------*08760000
      *    LOGON TO ORACLE, AND DECLARE THE ORACLE CURSORS.            *08770000
      *----------------------------------------------------------------*08780000
       1000-INITIALIZATION.                                             08790000
                                                                        08800000
           OPEN INPUT   IN-DA-FILE                                      08810000
                        WKLY-DTE-FILE                                   08820000
      *                 IN-ORACLE-SRC-CTL                               08830000
                        EXCLUSIVE-BRND-FILE.                            08840000
           OPEN OUTPUT  DA-REPORT-FILE                                  08850000
                        DA-REPORT-FILE2.                                08860000
                                                                        08870000
           INITIALIZE PA-PROGRAM-ACCUMULATORS                           08880000
                      PS-PROGRAM-SWITCHES                               08890000
                      EXCL-BRAND-TABLE                                  08900000
                      EXCLUSIVE-DEFAULT-ASSIGNMENT.                     08910000
                                                                        08920000
           PERFORM 1100-INIT-VARIABLES                                  08930000
                                                                        08940000
           PERFORM 9000-READ-DA-FILE.                                   08950000
                                                                        08960000
      /----------------------------------------------------------------*08970000
      *    SET UP TABLES/INDEXES FOR PROCESSING                       * 08980000
      *----------------------------------------------------------------*08990000
       1100-INIT-VARIABLES.                                             09000000
      *                                                                 09010000
           INITIALIZE PA-ML-ACCUMULATORS                                09020000
                      PA-DA-ACCUMULATORS                                09030000
                      ML-DPT-BRND-VND-TABLE.                            09040000
                                                                        09050000
      /----------------------------------------------------------------*09060000
      * PROCESS INPUT CONTROL FILES AND LOAD TO INTERNAL TABLES         09070000
      *    1. INPUT DATE CONTROL FILE                                   09080000
      *    2. EXCLUSIVE BRAND - DEFAULT BRAND ASSIGNED TO DPT/SCL COMBO 09090000
      *----------------------------------------------------------------*09100000
       1200-PREPARE-TABLES.                                             09110000
                                                                        09120000
      * WRITE THE INITIAL HEADER RECORDS                                09130000
           ADD 1 TO PV-PAGE-COUNT                                       09140000
           MOVE PV-PAGE-COUNT TO DP133O-PAGE-NUMBER.                    09150000
           MOVE DP133O-STANDRD-HEADER-133-COLS                          09160000
               TO DETAIL-REPORT-REC.                                    09170000
           WRITE DETAIL-REPORT-REC                                      09180000
               AFTER ADVANCING PAGE.                                    09190000
           MOVE +9 TO PV-LINE-COUNT.                                    09200000
                                                                        09210000
           WRITE DETAIL-REPORT-REC FROM HEADER1                         09220000
                   AFTER ADVANCING 2.                                   09230000
      * WRITE THE INITIAL HEADER RECORDS                                09240000
                                                                        09250000
           WRITE DETAIL-REPORT-REC2 FROM RPT2-HEADER                    09260000
                  AFTER ADVANCING PV-ADVANCE.                           09270000
                                                                        09280000
           PERFORM 9100-READ-WKLY-DTE-FILE.                             09290000
           IF PS-EMPTY-DATE-FILE                                        09300000
               DISPLAY '*** EMPTY DATE CONTROL FILE ***'                09310000
               DISPLAY '** PROGRAM ABEND **'                            09320000
               DISPLAY 'MLKUT006  - EMPTY DEFAULT BRAND FILE'           09330000
               MOVE +4003              TO PV-ABEND-CODE                 09340000
               PERFORM 9999-ABEND                                       09350000
           ELSE                                                         09360000
               PERFORM 5000-PROCESS-DATE-FILE                           09370000
           END-IF.                                                      09380000
                                                                        09390000
           PERFORM 9200-READ-EXCLSV-BRND-LIST.                          09400000
           IF PS-END-OF-EXCL-BRAND-FILE                                 09410000
               DISPLAY '*** EMPTY EXCLUSIVE-BRND-DEFAULT-FILE ***'      09420000
               DISPLAY '** PROGRAM ABEND **'                            09430000
               DISPLAY 'MLKUT006  - EMPTY DEFAULT BRAND FILE'           09440000
               MOVE +4003              TO PV-ABEND-CODE                 09450000
               PERFORM 9999-ABEND                                       09460000
           ELSE                                                         09470000
               PERFORM 3200-PROCESS-DFLT-BRAND-FILE                     09480000
           END-IF.                                                      09490000
                                                                        09500000
                                                                        09510000
      *----------------------------------------------------------------*09520000
      * 2000-PROCESS-TDAALWS - FILE CONTAINING APPROVED DA'S            09530000
      *   - DEBIT ALLOWANCE FILE HAS BEEN READ                          09540000
      *   - CHECK IF DEPT/SCL IS ON LIST OF 'DEFAULTED' BRAND LIST      09550000
      *   - THE DEFAULT BRAND WILL BE USED REGARDLESS OF OTHER EDITS    09560000
      *----------------------------------------------------------------*09570000
       2000-PROCESS-TDAALWS.                                            09580000
                                                                        09590000
           MOVE '2000-PROCESS-TDAALWS' TO PV-ABEND-PARAGRAPH.           09600000
                                                                        09610000
           MOVE DA100-DEPT-NBR       TO  PV-DA-TEMP-DEPT-NBR.           09620000
           MOVE DA100-SUB-CL-NBR     TO  PV-DA-TEMP-SUB-CL-NBR.         09630000
           MOVE DA100-ENT-ID         TO  PV-DA-TEMP-ENT-ID-NBR.         09640000
           MOVE DA100-EFF-DTE        TO  PV-DA100-EFF-DTE.              09650000
                                                                        09660000
           PERFORM 3600-CALC-DA-RTL.                                    09670000
      *                                                                 09680000
           MOVE PV-DA-TEMP-DEPT-NBR    TO  PV-HOLD-DEPT.                09690000
           MOVE PV-DA-TEMP-SUB-CL-NBR  TO  PV-HOLD-SCL.                 09700000
           MOVE PV-DA-TEMP-ENT-ID-NBR  TO  PV-HOLD-ENT-ID.              09710000
      *                                                                 09720000
           PERFORM 5900-DEPT-CUM-MKUP-TARGET                            09730000
           IF PS-ROW-NOT-FOUND                                          09740000
               PERFORM 5950-SELECT-DEFAULT-CORP-MKUP                    09750000
           END-IF.                                                      09760000
      *                                                                 09770000
      *                   PROCESSING OPTIONS                            09780000
      *                                                                 09790000
      * 1.'EXCLUSIVE' BRAND - LBL_SEQ_NBR SET TO DEFAULT SETTING        09800000
      * 2  VALIDATE DEPT/VENDOR/EXCLUSIVE BRAND DEFAULT EXISTENCE       09810000
CHG2  *    IF FOUND ON IMT_DEPT_BRND_VND (KNOWN COMBINATIONS)           09820000
      *       A. ASSIGN DEFAULT LBL_SEQ_NBR & BYPASS ML/BV EXTRACTION   09830000
CHG2  *    ELSE                                                         09840000
CHG2  *       B. EXAMINE ALL DBV/BRAND COMBOS THAT APPLY TO DEPT/VENDOR 09850000
CHG2  *    END-IF                                                       09860000
CHG2  *                                                                 09870000
           PERFORM 3300-CHECK-EXCLUSIVE-DEFAULT.                        09880000
CHG2  *                                                                 09890000
CHG2  *    ORIGINAL LOGIC (ALLOWED INVALID DBV COMBO FOR SOME DEFAULTS) 09900000
CHG2  *    IF DEFAULT-BRAND-FOUND                                       09910000
CHG2  *        PERFORM 3400-ASSIGN-DEFAULT-BRAND                        09920000
CHG2  *    ELSE                                                         09930000
CHG2  *        PERFORM 2100-BRAND-PROCESSING                            09940000
CHG2  *    END-IF.                                                      09950000
                                                                        09960000
CHG2  ******************************************************************09970000
CHG2  *                 UPDATED LOGIC                                   09980000
CHG2  ******************************************************************09990000
CHG2  * ENSURE DEFAULT BRAND ASSIGNMENT (FOR DEPT/ENT) IS VALID         10000000
CHG2       IF DEFAULT-BRAND-FOUND                                       10010000
CHG2           MOVE PV-HOLD-DEPT           TO  PV-DEPT-NBR              10020000
CHG2           MOVE PV-HOLD-ENT-ID         TO  PV-ENT-ID                10030000
CHG2           MOVE PV-TEMP-EXCL-LBL       TO  PV-TEMP-LBL              10040000
CHG2           PERFORM 6100-GET-KNOWN-DKEY                              10050000
CHG2                                                                    10060000
CHG2           IF PS-DBV-DKEY-FOUND                                     10070000
CHG2                PERFORM 3400-ASSIGN-DEFAULT-BRAND                   10080000
CHG2           ELSE                                                     10090000
CHG2               IF PS-RELATIONSHIP-NOT-EXISTS                        10100000
CHG2                    SET PS-NO-DEFAULT-BRAND TO TRUE                 10110000
CHG2                    PERFORM 2100-BRAND-PROCESSING                   10120000
CHG2               END-IF                                               10130000
CHG2           END-IF                                                   10140000
           ELSE                                                         10150000
               PERFORM 2100-BRAND-PROCESSING                            10160000
           END-IF.                                                      10170000
      *                                                                 10180000
      * AFTER ALL ML ROWS HAVE BEEN INTERROGATED, PROCESS VALID BRANDS  10190000
      * APPLY PRORATION% TO QUALIFIED BRANDS, UPDATE RPT2 ML% TO APPLY  10200000
           PERFORM 2400-BRAND-INCLUSION-EDITS                           10210000
      *                                                                 10220000
           PERFORM 8000-CREATE-DETAIL-REPORT.                           10230000
      *    PERFORM 2600-PREP-DA-TABLE-AND-RPT.                          10240000
      *    PERFORM 2700-APPLY-DAT-PRRTN-UPDATES.                        10250000
      *                                                                 10260000
           PERFORM 1100-INIT-VARIABLES.                                 10270000
           PERFORM 9000-READ-DA-FILE.                                   10280000
                                                                        10290000
      *----------------------------------------------------------------*10300000
      *----------------------------------------------------------------*10310000
      *----------------------------------------------------------------*10320000
       2100-BRAND-PROCESSING.                                           10330000
      *                                                                 10340000
      *    DISPLAY  '2100-BRAND-PROCESSING'.                            10350000
                                                                        10360000
           MOVE PFW-PARTN(1)           TO  PV-PART1.                    10370000
           MOVE PFW-PARTN(2)           TO  PV-PART2.                    10380000
      *                                                                 10390000
           MOVE 'N' TO PS-ML-TABLE-LOAD-SW                              10400000
           PERFORM 5500-OPEN-ML-BV-CSR.                                 10410000
           DISPLAY ' OPEN CSR FOR DA # : ', DA100-DR-ALW-NBR.           10420000
           PERFORM 5600-FETCH-ML-BV-CSR.                                10430000
      *    DISPLAY '    INITIAL FETCH'.                                 10440000
                                                                        10450000
      *    VERIFY IF THE INTIAL FETCH FOUND ANY ROWS                    10460000
                                                                        10470000
CHG        IF PS-NO-MORE-BV-TRANS-LEFT                                  10480000
               DISPLAY 'NO ROWS FETCHED - WILL BE UNKNOWN BRAND'        10490000
               PERFORM 3500-ASSIGN-UNKNOWN-VENDOR                       10500000
           ELSE                                                         10510000
TEMP2          PERFORM 2200-PROCESS-ML-INVENTORY                        10520000
                   VARYING SS-ML-BV FROM 1 BY 1                         10530000
                     UNTIL PS-NO-MORE-BV-TRANS-LEFT                     10540000
           END-IF.                                                      10550000
                                                                        10560000
           DISPLAY '>INTO CLOSE CSR DA # : ', DA100-DR-ALW-NBR.         10570000
           PERFORM 5700-CLOSE-ML-BV-CURSOR.                             10580000
      *                                                                 10590000
      *----------------------------------------------------------------*10600000
      *2200-PROCESS-ML-INVENTORY.                                       10610000
      *- POPULATE TABLE VALUES. EDIT ROW DATA FOR VALIDITITY            10620000
      *- ACCUMULATE INVENTORY DOLLARS AND TRACK BYPASS CANDIDATES       10630000
      *-                                                                10640000
      *- EACH DBV ROW IS INTERROGATED & FLAGGED FOR INCLUSION/EXCLUSION.10650000
      *  3 EDIT CRITERIA DETERMINE HOW TO PROCESS SUBJECT BRANDS. AS    10660000
      *  EACH BRAND IS REVIEWED, A VALUE OF 0 OR 1 IS SET ON INTERNAL   10670000
      *- TABLE: ML-DPT-BRND-VND-TABLE. ALL ROWS MUST BE PROCESSED BEFORE10680000
      *- THE FINAL DETERMINATION FOR INCLUSION CAN BE MADE              10690000
      *                                                                 10700000
      *  INCLUSION CRITERIA.   IF IND=0 (INCLUDE), IF IND=1 (EXCLUDE)   10710000
      *  ==================    =======================================  10720000
      *  1) ML-NEG-INV-IND     NEG-INV  : EIR$ ARE NEGATIVE (< $0.00)   10730000
      *  2) ML-ZERO-INV-IND    EIR$ = $0.00                             10740000
      *  3) ML-OUT-RANGE-IND   CALCED DBV MKUP% VS.TO DEPT TARGET       10750000
      *                                                                 10760000
      *----------------------------------------------------------------*10770000
      *DPT SCL  ENTID    LBL     EIR$        EIC$    MKUP   NEG 0 CUM   10780000
      *263-31   10593   2164 315725.86- 1126345.14-  3322.   X     X    10790000
      *263-31   10593   2149      0.00      452.66-   100.      X  X    10800000
      *263-31   10593  38833   1220.00      399.22     51.              10810000
      *----------------------------------------------------------------*10820000
       2200-PROCESS-ML-INVENTORY.                                       10830000
      *                                                                 10840000
      *    DISPLAY  '    2200-PROCESS-ML-INVENTORY'.                    10850000
      *                                                                 10860000
            MOVE BV-CSR-DBV-KEY       TO ML-DBV-DKEY(SS-ML-BV).         10870000
            MOVE BV-CSR-DEPT-NBR      TO ML-DEPT-NBR(SS-ML-BV).         10880000
SUB****     MOVE BV-CSR-SUB-CL-NBR    TO ML-SCL-NBR(SS-ML-BV).          10890000
            MOVE PV-HOLD-ENT-ID       TO ML-VND-NBR(SS-ML-BV).          10900000
      *                                                                 10910000
            MOVE BV-CSR-END-INV-RTL   TO ML-END-INV-RTL-AMT(SS-ML-BV)   10920000
            MOVE BV-CSR-END-INV-CST   TO ML-END-INV-COST2-AMT(SS-ML-BV) 10930000
            ADD  BV-CSR-END-INV-RTL   TO PA-ML-INV-RTL-TOTAL.           10940000
            ADD  BV-CSR-END-INV-CST   TO PA-ML-INV-COST-TOTAL.          10950000
      *                                                                 10960000
      *    ML NEGATIVE/ZERO EIR$ AND CUM MKUP% EDITS                    10970000
           PERFORM 2300-ML-BRAND-EDITS.                                 10980000
      *                                                                 10990000
           PERFORM 5600-FETCH-ML-BV-CSR.                                11000000
      *                                                                 11010000
      *----------------------------------------------------------------*11020000
      * 2300-ML-BRAND-EDITS                                             11030000
      * BRAND-LEVEL EDITS TO DETERMINE INCLUSION FOR DA PRORATION       11040000
      *                                                                 11050000
      * 1) TRACK NEGATIVE AND ZERO EIR ROWS    (2350-EIR-BASIS-EDIT)    11060000
      * 2) CALCED MKUP% COMPARED TO TARGET CUM (2375-CALC-MKUP-PCT-EDIT)11070000
      *----------------------------------------------------------------*11080000
       2300-ML-BRAND-EDITS.                                             11090000
      *                                                                 11100000
      *    DISPLAY  '        2300-ML-BRAND-EDITS'.                      11110000
      *    TRACK NEGATIVE AND ZERO EIR ROWS (FOR BRAND-LEVEL INCLUSION) 11120000
           PERFORM 2350-EIR-BASIS-EDIT.                                 11130000
      *                                                                 11140000
      *    CALCULATED BRAND ROW'S MKUP % AND COMPARE TO TARGET CUM      11150000
           PERFORM 2375-CALC-MKUP-PCT-EDIT.                             11160000
      *                                                                 11170000
      *----------------------------------------------------------------*11180000
      * 2350-EIR-BASIS.                                                 11190000
      * 1. ADD 1 TO <NEG EIR$> -OR- ZERO EIR$ -OR- OUT-RANGE COUNTERS   11200000
      * 2. ADD 1 TO ML-TABLE-INDICATOR FOR BRAND. USED AS INCLUDE IND   11210000
      * 3. ADD $ TO RELATED <NEG EIR$> AND/OR ZERO EIR$ ACCUMULATORS    11220000
      * 4. ADD $ TO TOTAL ACCUMULATOR                                   11230000
      *----------------------------------------------------------------*11240000
      *                                                                 11250000
       2350-EIR-BASIS-EDIT.                                             11260000
      *                                                                 11270000
      * CHECK NEGATIVE EIR$                                             11280000
           IF ML-END-INV-RTL-AMT(SS-ML-BV) < 0                          11290000
      *        ADD 1 BRAND COUNT W/ NEG EIR                             11300000
               ADD 1 TO PA-ML-NEG-EIR-COUNT                             11310000
      *                 ADD 1 BRAND'S TABLE-SW INDICATING NEGATIVE EIR  11320000
                        ML-NEG-INV-IND(SS-ML-BV)                        11330000
               ADD ML-END-INV-RTL-AMT (SS-ML-BV) TO                     11340000
      *            ADD EIR$ TO ACCUMULATED TOTAL FOR DA# THAT ARE NEG   11350000
                   PA-ML-INV-RTL-NEG-TOTAL                              11360000
      *                                                                 11370000
      * CHECK ZERO EIR$                                                 11380000
           ELSE                                                         11390000
               IF ML-END-INV-RTL-AMT(SS-ML-BV) = 0                      11400000
      *            ADD 1 BRAND COUNT W/ ZERO EIR                        11410000
                   ADD 1 TO PA-ML-ZERO-EIR-COUNT                        11420000
      *                     ADD 1 BRAND'S TABLE-SW INDICATING ZERO EIR  11430000
                            ML-ZERO-INV-IND(SS-ML-BV)                   11440000
      * POSTIVE EIR$                                                    11450000
               ELSE                                                     11460000
                   ADD ML-END-INV-RTL-AMT (SS-ML-BV) TO                 11470000
      *            ADD EIR$ TO ACCUMULATED TOTAL FOR DA# THAT ARE NEG   11480000
                       PA-ML-INV-RTL-POS-TOTAL                          11490000
               END-IF                                                   11500000
           END-IF.                                                      11510000
      *                                                                 11520000
      * ADD EIR TO TOTAL ACCUMULATOR                                    11530000
      *    ADD ML-END-INV-RTL-AMT (SS-ML-BV) TO                         11540000
      *        PA-ML-INV-RTL-TOTAL.                                     11550000
      *                                                                 11560000
      *----------------------------------------------------------------*11570000
      * CALCULATED BRAND ROW'S MKUP %  COMPARE TO DEPARTMENT MKUP TARGET11580000
      *----------------------------------------------------------------*11590000
       2375-CALC-MKUP-PCT-EDIT.                                         11600000
      *                                                                 11610000
      *  SET DEFAULTS IF EIR AND/OR EIC = 0                             11620000
      *                                                                 11630000
           IF ML-END-INV-RTL-AMT(SS-ML-BV) = 0                          11640000
               MOVE 100 TO ML-MKUP-PCT(SS-ML-BV)                        11650000
           ELSE                                                         11660000
               IF ML-END-INV-COST2-AMT(SS-ML-BV) = 0                    11670000
                   MOVE 0 TO ML-MKUP-PCT(SS-ML-BV)                      11680000
               ELSE                                                     11690000
                   COMPUTE ML-MKUP-PCT(SS-ML-BV) =                      11700000
                       ( 1 - (ML-END-INV-COST2-AMT(SS-ML-BV) /          11710000
                              ML-END-INV-RTL-AMT(SS-ML-BV) ) ) * 100    11720000
               END-IF                                                   11730000
           END-IF.                                                      11740000
      *                                                                 11750000
           IF (ML-MKUP-PCT(SS-ML-BV) >= PV-MIN-MKUP-TARGET AND          11760000
               ML-MKUP-PCT(SS-ML-BV) <= PV-MAX-MKUP-TARGET)             11770000
                                                                        11780000
               ADD 1 TO PA-ML-IN-RANGE-COUNT                            11790000
      * IN-RANGE (ZERO)                                                 11800000
               IF ML-END-INV-RTL-AMT(SS-ML-BV) = ZERO                   11810000
                    ADD 1 TO  PA-ML-IN-RANGE-ZERO                       11820000
      *                       ML-ZERO-INV-IND(SS-ML-BV)                 11830000
      *  ADD ML-END-INV-RTL-AMT(SS-ML-BV) TO PA-IN-RANGE-EIR            11840000
      * IN-RANGE (NEG)                                                  11850000
               ELSE                                                     11860000
                   IF ML-END-INV-RTL-AMT(SS-ML-BV) < ZERO               11870000
                       ADD 1 TO  PA-ML-IN-RANGE-NEG                     11880000
      *                          ML-IN-RANGE-IND(SS-ML-BV)              11890000
                       ADD ML-END-INV-RTL-AMT(SS-ML-BV) TO              11900000
                           PA-ML-IN-RANGE-NEG-TOTAL                     11910000
      * IN-RANGE (POS)                                                  11920000
                   ELSE                                                 11930000
                       ADD 1 TO  PA-ML-IN-RANGE-POS                     11940000
      *                ADD ML-END-INV-RTL-AMT(SS-ML-BV) TO              11950000
      *                    PA-ML-INV-RTL-POS-TOTAL                      11960000
                       ADD ML-END-INV-RTL-AMT(SS-ML-BV) TO              11970000
                           PA-ML-IN-RANGE-POS-TOTAL                     11980000
                   END-IF                                               11990000
               END-IF                                                   12000000
           ELSE                                                         12010000
               ADD 1 TO PA-ML-OUT-RANGE-COUNT                           12020000
               ADD 1 TO ML-OUT-RANGE-IND(SS-ML-BV)                      12030000
           END-IF.                                                      12040000
                                                                        12050000
      /----------------------------------------------------------------*12060000
      /----------------------------------------------------------------*12070000
      * 2400-BRAND-INCLUSION-EDITS.                                     12080000
      *  REVIEW ML BRAND ROWS, EDITS PARAMETERS DETERMINE ACCEPTABILITY 12090000
      /----------------------------------------------------------------*12100000
      *    PERFORM 2400-BRAND-INCLUSION-EDITS.                          12110000
      *    PERFORM 2500-ASSIGN-BRAND-PCT                                12120000
      *    PERFORM 2600-APPLY-DA-PRORATION-UPDATES.                     12130000
      /-------------------------------------------------PRORATE METHOD-*12140000
      *  A. ALL BRANDS OUTSIDE CUM RANGE DEFAULT                        12150000
      *     1. ALL BRANDS HAVE NEG EIR$             ALL-NEG-ABS-VALUE   12160000
      *     2. ALL BRANDS HAVE ZERO EIR$            ALL-ROWS-EVENLY     12170000
      *     3. ALL/SOME BRANDS HAVE POS EIR$        ALL-POS-EIR-ROWS    12180000
      *  B. ALL/SOME BRANDS WITHIN CUM RANGE                            12190000
      *     1. IN-RANGE BRANDS W/NEG EIR$      IN-RANGE-NEG-ABS-VALUE   12200000
      *     2. ALL BRANDS HAVE ZERO EIR$       IN-RANGE-EVEN-DISTRIBUTE 12210000
      *     3. ALL/SOME BRANDS POS EIR$        IN-RANGE-POS-EIR-ROWS    12220000
      *----------------------------------------------------------------*12230000
       2400-BRAND-INCLUSION-EDITS.                                      12240000
      *                                                                 12250000
      *    SET ALLOCATION METHOD FOR BRANDS MEETING INCLUSION CRITERIA  12260000
           PERFORM 2450-SET-ALLOCATION-METHOD.                          12270000
      *                                                                 12280000
           DISPLAY '   ALLOCATION METHOD IND: ', PS-BRAND-ALLOCATION-SW.12290000
      *                                                                 12300000
      *    APPLY % TO QUALIFIED BRANDS AND PREPARE FOR DAT_PRRTN UPDATE 12310000
           PERFORM 2500-ASSIGN-BRAND-PCT.                               12320000
      *                                                                 12330000
           INITIALIZE PV-PERCENTAGE-VARIABLES.                          12340000
      *                                                                 12350000
      /----------------------------------------------------------------*12360000
      *    SET SWITCHES TO BASE ALLOCATION METHOD                     * 12370000
      *----------------------------------------------------------------*12380000
       2450-SET-ALLOCATION-METHOD.                                      12390000
      *                                                                 12400000
      *   SET SS-ML-BV TO 1.                                            12410000
      *                                                                 12420000
            IF  PA-ML-BRAND-COUNT = 1   OR                              12430000
                DEFAULT-BRAND-FOUND     OR                              12440000
                ASSIGN-UNKNOWN-BRAND                                    12450000
                                                                        12460000
                   SET PS-ALLOCATE-SINGLE-BRAND TO TRUE                 12470000
            ELSE                                                        12480000
1              IF PA-ML-BRAND-COUNT  = PA-ML-OUT-RANGE-COUNT            12490000
2                  IF  PA-ML-BRAND-COUNT = PA-ML-NEG-EIR-COUNT          12500000
                       SET PS-ALLOCATE-NEG-DIST-ABS TO TRUE             12510000
3                  ELSE                                                 12520000
                       IF  PA-ML-BRAND-COUNT  = PA-ML-ZERO-EIR-COUNT    12530000
4                          SET PS-ALLOCATE-ALL-EVEN TO TRUE             12540000
                       ELSE                                             12550000
5                           SET PS-ALLOCATE-POS-DIST TO TRUE            12560000
                       END-IF                                           12570000
                   END-IF                                               12580000
6              ELSE                                                     12590000
                   IF  PA-ML-IN-RANGE-COUNT   = PA-ML-IN-RANGE-NEG      12600000
7                      SET PS-ALLOCATE-IN-RANGE-NEG-ABS  TO TRUE        12610000
8                  ELSE                                                 12620000
                       IF  PA-ML-IN-RANGE-COUNT = PA-ML-IN-RANGE-ZERO   12630000
9                          SET PS-ALLOCATE-IN-RANGE-ZERO-EVEN TO TRUE   12640000
10                     ELSE                                             12650000
                           IF  PA-ML-IN-RANGE-COUNT <= PA-ML-BRAND-COUNT12660000
11                           SET PS-ALLOCATE-IN-RANGE-POS-DIST TO TRUE  12670000
                           END-IF                                       12680000
                       END-IF                                           12690000
                   END-IF                                               12700000
               END-IF                                                   12710000
           END-IF.                                                      12720000
                                                                        12730000
      /----------------------------------------------------------------*12740000
      * ASSIGN PCT TO QUALIFIED ML BV ROWS (BASED ON ALLOCATION METHOD) 12750000
      *----------------------------------------------------------------*12760000
       2500-ASSIGN-BRAND-PCT.                                           12770000
                                                                        12780000
           MOVE ZERO TO PV-PCTG                                         12790000
                        PV-ACCUM-PCT.                                   12800000
                                                                        12810000
      *    EVALUATE PS-BRAND-ALLOCATION-SW                              12820000
           EVALUATE TRUE                                                12830000
              WHEN PS-ALLOCATE-ALL-EVEN                                 12840000
                       PERFORM 2510-EVEN-PRORATION                      12850000
              WHEN PS-ALLOCATE-POS-DIST                                 12860000
---->                  PERFORM 2510-EVEN-PRORATION                      12870000
              WHEN PS-ALLOCATE-NEG-DIST-ABS                             12880000
                       PERFORM 2520-NEG-EIR-PRORATION                   12890000
              WHEN PS-ALLOCATE-IN-RANGE-POS-EVEN                        12900000
                       PERFORM 2530-IN-RANGE-POS-PRORATION              12910000
              WHEN PS-ALLOCATE-IN-RANGE-NEG-ABS                         12920000
                       PERFORM 2540-IN-RANGE-NEG-PRORATION              12930000
              WHEN PS-ALLOCATE-IN-RANGE-ZERO-EVEN                       12940000
                       PERFORM 2550-IN-RANGE-ZERO-PRORATION             12950000
              WHEN PS-ALLOCATE-SINGLE-BRAND                             12960000
                       PERFORM 2560-SINGLE-BRAND-PROCESSING             12970000
              WHEN PS-ALLOCATE-IN-RANGE-POS-DIST                        12980000
                       PERFORM 2530-IN-RANGE-POS-PRORATION              12990000
              WHEN OTHER                                                13000000
      *            PS-ALLOCATE-SINGLE-BRAND                             13010000
      *            PS-ALLOCATE-UNKNOWN-BRAND                            13020000
      *            PS-ALLOCATE-POS-EIR-DIST                             13030000
                   DISPLAY 'MLKUT006 - % ALLOCATION METHOD NOT FOUND'   13040000
                   DISPLAY '** PROGRAM ABEND **'                        13050000
                   MOVE +4004              TO PV-ABEND-CODE             13060000
                   PERFORM 9999-ABEND                                   13070000
           END-EVALUATE.                                                13080000
                                                                        13090000
      *----------------------------------------------------------------*13100000
      * 2510-EVEN-PRORATION.                                            13110000
      * EACH BRAND GETS AN EVEN SHARE OF THE DISTRIBUTION               13120000
      *     INCLUDES THE FOLLOWING CONDITIONS                           13130000
      *        A. ALL OUT OF RANGE AND ALL EIR POS                      13140000
      *        B. ALL OUT OF RANGE AND ALL EIR ZERO                     13150000
      *----------------------------------------------------------------*13160000
       2510-EVEN-PRORATION.                                             13170000
      *                                                                 13180000
      *    ALL OUT OF RANGE AND ALL EIR ZERO (DIST EVENLY)              13190000
           PERFORM VARYING SS-ML-BV FROM 1 BY 1                         13200000
               UNTIL SS-ML-BV > PA-ML-BRAND-COUNT                       13210000
      *                                                                 13220000
                   COMPUTE PV-PCTG ROUNDED     =                        13230000
                          (1 / PA-ML-BRAND-COUNT) * 100                 13240000
                   MOVE PV-PCTG            TO PV-TEMP-PCT               13250000
                   MOVE PV-TEMP-PCT        TO ML-DA-PCT(SS-ML-BV)       13260000
                   ADD ML-DA-PCT(SS-ML-BV) TO PV-ACCUM-PCT              13270000
           END-PERFORM.                                                 13280000
      *    ENSURE % = 100 (ADJUST LAST ENTRY)                           13290000
           PERFORM 2590-FINAL-PCT-ADJ.                                  13300000
      *----------------------------------------------------------------*13310000
      * 2520-NEG-EIR-PRORATION                                          13320000
      * EACH BRAND HAS NEG-EIR. APPLY % TO TOTAL (ABSOLUTE VALUE)       13330000
      *     INCLUDES THE FOLLOWING CONDITIONS                           13340000
      *        A. ALL ROWS OUT OF RANGE AND ALL EIR NEG                 13350000
      *----------------------------------------------------------------*13360000
       2520-NEG-EIR-PRORATION.                                          13370000
      *                                                                 13380000
           PERFORM VARYING SS-ML-BV FROM 1 BY 1                         13390000
               UNTIL SS-ML-BV > PA-ML-BRAND-COUNT                       13400000
                   IF ML-END-INV-RTL-AMT(SS-ML-BV) < 0                  13410000
                       COMPUTE PV-PCTG ROUNDED =                        13420000
                             ((ML-END-INV-RTL-AMT(SS-ML-BV) /           13430000
                               PA-ML-INV-RTL-NEG-TOTAL) * 100 )         13440000
                       MOVE PV-PCTG      TO PV-TEMP-PCT                 13450000
                       MOVE PV-TEMP-PCT  TO ML-DA-PCT(SS-ML-BV)         13460000
                       ADD ML-DA-PCT(SS-ML-BV) TO PV-ACCUM-PCT          13470000
                   END-IF                                               13480000
           END-PERFORM.                                                 13490000
      * ENSURE % = 100                                                  13500000
           PERFORM 2590-FINAL-PCT-ADJ.                                  13510000
      *----------------------------------------------------------------*13520000
      * 2530-IN-RANGE-POS-PRORATION                                     13530000
      * PROCESS ONLY BRANDS WITH A POSTIVE EIR POSITITON THAT HAVE A    13540000
      * CUM MKUP PCT THAT IS IN THE CUM MIN-MAX TARGET RANGE            13550000
      *                                                                 13560000
      * INCLUDES THE FOLLOWING CONDITIONS                               13570000
      *    A. POS EIR AND IN CUM RANGE FOR DEPARTMENT                   13580000
      *    B. BRANDS OUT-OF-RANGE ARE FLAGGED BY A 1 IN ML-OUT-RANGE-IND13590000
      *----------------------------------------------------------------*13600000
       2530-IN-RANGE-POS-PRORATION.                                     13610000
      *    INCLUDE IN RANGE ROWS WITH A POS EIR (DIST BASED ON % OF ALL)13620000
           PERFORM VARYING SS-ML-BV FROM 1 BY 1                         13630000
               UNTIL SS-ML-BV > PA-ML-BRAND-COUNT                       13640000
                   IF ML-OUT-RANGE-IND(SS-ML-BV) = 0                    13650000
                       IF ML-END-INV-RTL-AMT(SS-ML-BV) > 0              13660000
                           COMPUTE PV-TEMP-PCT  =                       13670000
                                 ((ML-END-INV-RTL-AMT(SS-ML-BV) /       13680000
                                   PA-ML-IN-RANGE-POS-TOTAL) * 100 )    13690000
                              MOVE PV-TEMP-PCT  TO ML-DA-PCT(SS-ML-BV)  13700000
                              ADD ML-DA-PCT(SS-ML-BV) TO PV-ACCUM-PCT   13710000
                        END-IF                                          13720000
                   END-IF                                               13730000
           END-PERFORM.                                                 13740000
      * ENSURE % = 100                                                  13750000
           PERFORM 2590-FINAL-PCT-ADJ.                                  13760000
      *----------------------------------------------------------------*13770000
      * 2540-IN-RANGE-NEG-PRORATION                                     13780000
      * PROCESS ONLY BRANDS WITH A NEGATIVE EIR THAT FALL WITH DEPT CUM 13790000
      * INCLUDES THE FOLLOWING CONDITIONS                               13800000
      *    A. BRANDS IN-RANGE HAVE A DEFAULT 0 IN ML-OUT-RANGE-IND(IDX) 13810000
      *    B. NEG EIR INV POSITION                                      13820000
      *----------------------------------------------------------------*13830000
      *        10  ML-NEG-INV-IND       PIC   9(1)              VALUE 0.13840000
      *        10  ML-ZERO-INV-IND      PIC   9(1)              VALUE 0.13850000
      *        10  ML-OUT-RANGE-IND     PIC   9(1)              VALUE 0.13860000
       2540-IN-RANGE-NEG-PRORATION.                                     13870000
      *    SOME IN RANGE W/ NEG EIR (DIST % OF ALL QUALIFIED/ABSOLUTE)  13880000
             PERFORM VARYING SS-ML-BV FROM 1 BY 1                       13890000
               UNTIL SS-ML-BV > PA-ML-BRAND-COUNT                       13900000
      *                                                                 13910000
               IF ML-OUT-RANGE-IND(SS-ML-BV) = 0                        13920000
                   IF ML-END-INV-RTL-AMT(SS-ML-BV) < 0                  13930000
                       COMPUTE PV-TEMP-PCT  =                           13940000
                                ((ML-END-INV-RTL-AMT(SS-ML-BV) /        13950000
                                  PA-ML-IN-RANGE-NEG-TOTAL) * 100 )     13960000
                       COMPUTE ML-DA-PCT(SS-ML-BV) =                    13970000
                                 (PV-TEMP-PCT  * -1)                    13980000
                       ADD ML-DA-PCT(SS-ML-BV) TO PV-ACCUM-PCT          13990000
                   END-IF                                               14000000
               END-IF                                                   14010000
           END-PERFORM.                                                 14020000
           PERFORM 2590-FINAL-PCT-ADJ.                                  14030000
      *----------------------------------------------------------------*14040000
      * 2550-IN-RANGE-ZERO-PRORATION                                    14050000
      * PROCESS ONLY BRANDS WITH A ZERO EIR THAT FALL WITH DEPT CUM     14060000
      * INCLUDES THE FOLLOWING CONDITIONS                               14070000
      *    A. BRANDS IN-RANGE HAVE A DEFAULT 0 IN ML-OUT-RANGE-IND(IDX) 14080000
      *    B. ZERO EIR INV POSITION                                     14090000
      *----------------------------------------------------------------*14100000
       2550-IN-RANGE-ZERO-PRORATION.                                    14110000
      *    IF  PA-ML-IN-RANGE-COUNT = PA-ML-IN-RANGE-ZERO               14120000
      *    PROCESS ONLY ROWS WITHIN CUM RANGE AND HAVE ZERO EIR         14130000
             PERFORM VARYING SS-ML-BV FROM 1 BY 1                       14140000
               UNTIL SS-ML-BV > PA-ML-BRAND-COUNT                       14150000
      *                                                                 14160000
                  IF ML-OUT-RANGE-IND(SS-ML-BV) = 0                     14170000
                      IF ML-END-INV-RTL-AMT(SS-ML-BV) = 0               14180000
      * IN-RANGE / EIR$ = 0                                             14190000
                           COMPUTE PV-TEMP-PCT  =                       14200000
                                  (1 / PA-ML-IN-RANGE-ZERO) * 100       14210000
                           MOVE PV-TEMP-PCT  TO ML-DA-PCT(SS-ML-BV)     14220000
                           ADD ML-DA-PCT(SS-ML-BV) TO PV-ACCUM-PCT      14230000
                      END-IF                                            14240000
                  END-IF                                                14250000
           END-PERFORM.                                                 14260000
      * ENSURE % = 100                                                  14270000
           PERFORM 2590-FINAL-PCT-ADJ.                                  14280000
      *----------------------------------------------------------------*14290000
      * 2560-SINGLE-BRAND-PROCESSING                                    14300000
      * APPLY 100% TO A SINGLE BRAND REGARDLESS OF OTHER EDITS, INCLUDES14310000
      *    1. DEFAULT EXCLUSIVE BRAND 100% - IGNORE OTHER EDITS         14320000
      *    2. NO ROWS FETCHED - ASSIGN UNKNOWN BRAND 100%               14330000
      *    3. SINGLE ROW FETCHED ASSIGN BRAND 100% REGARDLEWSS OF EDITS 14340000
      ****                                                              14350000
      **** IF DEFAULT OR UNKNOWN, THEN NO ML$ WERE EXTRACTED            14360000
      ****                                                              14370000
      *----------------------------------------------------------------*14380000
       2560-SINGLE-BRAND-PROCESSING.                                    14390000
      *                                                                 14400000
      *    DISPLAY  '        2560-SINGLE-BRAND-PROCESSING'.             14410000
           MOVE 1 TO SS-ML-BV.                                          14420000
      *                                                                 14430000
               MOVE DA100-ENT-ID        TO PV-ENT-ID                    14440000
               MOVE DA100-DEPT-NBR      TO PV-DEPT-NBR                  14450000
               MOVE DA100-SUB-CL-NBR    TO PV-SCL-NBR                   14460000
      *                                                                 14470000
               IF DEFAULT-BRAND-FOUND                                   14480000
                   SET PS-ALLOCATE-DEFAULT-BRAND TO TRUE                14490000
                   MOVE PV-TEMP-EXCL-LBL TO PV-TEMP-LBL                 14500000
                                                                        14510000
                   PERFORM 6100-GET-KNOWN-DKEY                          14520000
                                                                        14530000
                   IF PS-DBV-DKEY-FOUND                                 14540000
                       MOVE PV-DKEY       TO ML-DBV-DKEY(SS-ML-BV)      14550000
                   ELSE                                                 14560000
                     IF PS-RELATIONSHIP-NOT-EXISTS                      14570000
                        SET PS-ALLOCATE-DEFAULT-ERROR TO TRUE           14580000
                        MOVE ZEROES    TO ML-DBV-DKEY(SS-ML-BV)         14590000
                     END-IF                                             14600000
                   END-IF                                               14610000
      *                                                                 14620000
                   MOVE PV-TEMP-LBL   TO ML-LBL-SEQ-NBR(SS-ML-BV)       14630000
                   MOVE PV-ENT-ID     TO ML-VND-NBR(SS-ML-BV)           14640000
                   MOVE PV-DEPT-NBR   TO ML-DEPT-NBR(SS-ML-BV)          14650000
                   MOVE PV-SCL-NBR    TO ML-SCL-NBR(SS-ML-BV)           14660000
                   MOVE ZEROS         TO ML-END-INV-RTL-AMT(SS-ML-BV)   14670000
                                         ML-END-INV-COST2-AMT(SS-ML-BV) 14680000
                   MOVE 0             TO ML-MKUP-PCT(SS-ML-BV)          14690000
                   MOVE 100           TO ML-DA-PCT(SS-ML-BV)            14700000
                   MOVE 'N'           TO PS-DEFAULT-BRAND-SW            14710000
               ELSE                                                     14720000
                   IF ASSIGN-UNKNOWN-BRAND                              14730000
                       SET PS-ALLOCATE-UNKNOWN-BRAND TO TRUE            14740000
                       MOVE 2230            TO PV-TEMP-LBL              14750000
                       PERFORM 6150-GET-UNKNOWN-DKEY                    14760000
                       MOVE PV-TEMP-LBL     TO ML-LBL-SEQ-NBR(SS-ML-BV) 14770000
                       MOVE PV-DKEY         TO ML-DBV-DKEY(SS-ML-BV)    14780000
      *                                                                 14790000
                       MOVE PV-ENT-ID       TO ML-VND-NBR(SS-ML-BV)     14800000
                       MOVE PV-DEPT-NBR     TO ML-DEPT-NBR(SS-ML-BV)    14810000
                       MOVE PV-SCL-NBR      TO ML-SCL-NBR(SS-ML-BV)     14820000
                       MOVE ZEROS     TO ML-END-INV-RTL-AMT(SS-ML-BV)   14830000
                                         ML-END-INV-COST2-AMT(SS-ML-BV) 14840000
                       MOVE 0               TO ML-MKUP-PCT(SS-ML-BV)    14850000
                       MOVE 100             TO ML-DA-PCT(SS-ML-BV)      14860000
                   ELSE                                                 14870000
                       MOVE ML-DBV-DKEY(SS-ML-BV)   TO PV-DKEY          14880000
                       PERFORM 5850-SELECT-BRAND-INFO                   14890000
                       MOVE PV-TEMP-LBL    TO ML-LBL-SEQ-NBR(SS-ML-BV)  14900000
                       MOVE 100            TO ML-DA-PCT(SS-ML-BV)       14910000
                   END-IF                                               14920000
               END-IF.                                                  14930000
      *                                                                 14940000
               MOVE 1            TO PA-ML-BRAND-COUNT.                  14950000
               MOVE 1            TO ML-INCL-IND(SS-ML-BV).              14960000
               MOVE 0            TO ML-NEG-INV-IND(SS-ML-BV).           14970000
               MOVE 0            TO ML-ZERO-INV-IND(SS-ML-BV).          14980000
               MOVE 0            TO ML-OUT-RANGE-IND(SS-ML-BV).         14990000
               SET PS-DBV-DKEY-FOUND TO TRUE.                           15000000
      *                                                                 15010000
      *----------------------------------------------------------------*15020000
      * 2590-FINAL-PCT-ADJ.                                             15030000
      ****  ENSURE PCT = 100%                                           15040000
      *----------------------------------------------------------------*15050000
       2590-FINAL-PCT-ADJ.                                              15060000
      *    ENSURE % = 100 (ADJUST FIRST QUALIFIED TABLE ENTRY)          15070000
      *                                                                 15080000
           SET PS-PERCENT-UNBALANCED TO TRUE.                           15090000
      *                                                                 15100000
           IF PV-ACCUM-PCT > 100                                        15110000
               COMPUTE PV-ADJUST-PCT =  (PV-ACCUM-PCT - 100)            15120000
           ELSE                                                         15130000
              IF PV-ACCUM-PCT < 100                                     15140000
                  COMPUTE PV-ADJUST-PCT = (100 - PV-ACCUM-PCT)          15150000
              END-IF                                                    15160000
           END-IF.                                                      15170000
                                                                        15180000
           PERFORM VARYING SS-ML-BV FROM 1 BY 1                         15190000
               UNTIL SS-ML-BV = PA-ML-BRAND-COUNT                       15200000
                  OR PS-PERCENT-ADJUSTED                                15210000
                                                                        15220000
               IF ML-DA-PCT(SS-ML-BV)   > 0                             15230000
                   IF PV-ADJUST-PCT     > 0                             15240000
                       IF PV-ADJUST-PCT >= ML-DA-PCT(SS-ML-BV)          15250000
                           CONTINUE                                     15260000
                       ELSE                                             15270000
                           ADD PV-ADJUST-PCT TO ML-DA-PCT(SS-ML-BV)     15280000
                           SET PS-PERCENT-ADJUSTED TO TRUE              15290000
                       END-IF                                           15300000
                   ELSE                                                 15310000
                       IF PV-ADJUST-PCT   < 0                           15320000
                           IF (ML-DA-PCT(SS-ML-BV) +                    15330000
                               PV-ADJUST-PCT)  <= 0                     15340000
                               CONTINUE                                 15350000
                           ELSE                                         15360000
                               ADD PV-ADJUST-PCT TO ML-DA-PCT(SS-ML-BV) 15370000
                               SET PS-PERCENT-ADJUSTED TO TRUE          15380000
                           END-IF                                       15390000
                       END-IF                                           15400000
                   END-IF                                               15410000
               END-IF                                                   15420000
           END-PERFORM.                                                 15430000
                                                                        15440000
           IF PV-ACCUM-PCT + PV-ADJUST-PCT > 100                        15450000
      *        ADD PV-ADJUST-PCT TO ML-DA-PCT(SS-ML-BV)                 15460000
               DISPLAY ' ERROR IN FINAL ADJUSTING ENTRY '               15470000
           END-IF.                                                      15480000
                                                                        15490000
                                                                        15500000
      *----------------------------------------------------------------*15510000
      *                                                                 15520000
      * WRITE A REPORT AS EACH ML ROW IS INTERROGATED FOR INCLUSION     15530000
      * LOAD DA PRORATION TABLE FOR UPDATE OF ORACLE DAT_PRRTN_PCT      15540000
      *                                                                 15550000
      *----------------------------------------------------------------*15560000
      /----------------------------------------------------------------*15570000
      *    SET UP TABLES/INDEXES FOR PROCESSING                       * 15580000
      *----------------------------------------------------------------*15590000
       3100-FORMAT-DATES.                                               15600000
                                                                        15610000
            MOVE PV-PARTN-NBR   TO PFW-PARTN(SS-PARTN-NBR).             15620000
                                                                        15630000
            MOVE PV-PARTN-NBR   TO PV-PART-NUMBER.                      15640000
            MOVE PV-PART-NUMBER TO PV-PART-DISPLAY.                     15650000
                                                                        15660000
            DISPLAY '  PREV FSCL-WK PARTS USED : ', PV-PART-DISPLAY.    15670000
                                                                        15680000
      /----------------------------------------------------------------*15690000
      *    REFORMAT DB2 DATE TO ORACLE FORMAT                         * 15700000
      *----------------------------------------------------------------*15710000
       3150-REFORMAT-DATES.                                             15720000
                                                                        15730000
            MOVE PV-DA100-DATE TO PV-HOLD-DATE.                         15740000
            PERFORM 6000-GET-MONTH-NAME.                                15750000
                                                                        15760000
            MOVE PV-DA100-DD       TO PV-ORACLE-DD.                     15770000
            MOVE PV-DA100-YY       TO PV-ORACLE-YY.                     15780000
            MOVE PV-FSCL-MONTH-1-3 TO PV-ORACLE-MON.                    15790000
                                                                        15800000
      *    DATE FORMATS                                                 15810000
      *    DARD100 DATE 2008-09-25.00.00.00                             15820000
      *    ORACLE  DATE 08-SEP-25                                       15830000
      *    05  PV-DATE-AREA.                                            15840000
      *        10  PV-DA100-EFF-DTE.                                    15850000
      *            15  PV-DA100-DATE.                                   15860000
      *                20  PV-DA100-CC      PIC X(02).                  15870000
      *                20  PV-DA100-YY      PIC X(02).                  15880000
      *                20  FILLER           PIC X(01)   VALUE '-'.      15890000
      *                20  PV-DA100-MM      PIC X(02).                  15900000
      *                20  FILLER           PIC X(01)   VALUE '-'.      15910000
      *                20  PV-DA100-DD      PIC X(02).                  15920000
      *            15  PV-DA100-TMST        PIC X(09).                  15930000
      *        10  PV-ORACLE-DTE.                                       15940000
      *            15  PV-ORACLE-DD     PIC X(02)   VALUE SPACES.       15950000
      *            15  FILLER           PIC X(01)   VALUE '-'.          15960000
      *            15  PV-ORACLE-MON    PIC X(03)   VALUE SPACES.       15970000
      *            15  FILLER           PIC X(01)   VALUE '-'.          15980000
      *            15  PV-ORACLE-CC     PIC X(02)   VALUE SPACES.       15990000
                                                                        16000000
      /----------------------------------------------------------------*16010000
      *LOAD INTERNAL BRAND TABLE CONTAINING DEFAULT BRAND ASSIGNMENT   *16020000
      *----------------------------------------------------------------*16030000
       3200-PROCESS-DFLT-BRAND-FILE.                                    16040000
                                                                        16050000
           SET PS-MORE-EXCL-BRANDS-LEFT TO TRUE.                        16060000
                                                                        16070000
           PERFORM VARYING SS-EXCL FROM +1 BY +1                        16080000
             UNTIL SS-EXCL > PC-MAX-EXCL-RECS OR                        16090000
                   PS-END-OF-EXCL-BRAND-FILE                            16100000
                                                                        16110000
TEMP2          IF (DFLT-DEPT-NBR NUMERIC AND                            16120000
                   DFLT-SCL-NBR  NUMERIC)                               16130000
                  MOVE DFLT-DEPT-NBR    TO EXCL-DEPT(SS-EXCL)           16140000
 ******           MOVE DFLT-MCL-NBR     TO EXCL-MCL(SS-EXCL)            16150000
                  MOVE DFLT-SCL-NBR     TO EXCL-SCL(SS-EXCL)            16160000
                  MOVE DFLT-LBL-SEQ-NBR TO EXCL-BRAND(SS-EXCL)          16170000
                  MOVE DFLT-BRAND-NAME  TO EXCL-BRAND-NAME(SS-EXCL)     16180000
               ELSE                                                     16190000
                   DISPLAY '** PROGRAM ABEND **'                        16200000
                   DISPLAY 'MLKUT006  - INVALID DFLT BRAND FILE'        16210000
                   DISPLAY '            DPT/SCL NOT NUMERIC'            16220000
                   MOVE +4003              TO PV-ABEND-CODE             16230000
                   PERFORM 9999-ABEND                                   16240000
               END-IF                                                   16250000
                                                                        16260000
               PERFORM 9200-READ-EXCLSV-BRND-LIST                       16270000
                                                                        16280000
           END-PERFORM.                                                 16290000
                                                                        16300000
           IF SS-EXCL > PC-MAX-EXCL-RECS                                16310000
               DISPLAY '** PROGRAM ABEND **'                            16320000
               DISPLAY 'MLKUT006  - EXCLUSIVE BRAND TABLE SIZE EXCEEDED'16330000
               MOVE +4004              TO PV-ABEND-CODE                 16340000
               PERFORM 9999-ABEND                                       16350000
           END-IF.                                                      16360000
                                                                        16370000
      *----------------------------------------------------------------*16380000
      * 3300-CHECK-EXCLUSIVE-DEFAULT FOR DEFAULT SETTINGS               16390000
      *----------------------------------------------------------------*16400000
       3300-CHECK-EXCLUSIVE-DEFAULT.                                    16410000
                                                                        16420000
           MOVE ZEROS TO PV-TEMP-EXCL-LBL.                              16430000
                                                                        16440000
           PERFORM VARYING SS-EXCL FROM 1 BY 1 UNTIL                    16450000
               SS-EXCL > PC-MAX-EXCL-RECS OR                            16460000
               EXCL-DEPT (SS-EXCL) > PV-DA-TEMP-DEPT-NBR OR             16470000
               DEFAULT-BRAND-FOUND                                      16480000
                                                                        16490000
               IF (EXCL-DEPT (SS-EXCL) = PV-DA-TEMP-DEPT-NBR   AND      16500000
                   EXCL-SCL  (SS-EXCL) = PV-DA-TEMP-SUB-CL-NBR)         16510000
                                                                        16520000
                   MOVE  EXCL-BRAND(SS-EXCL) TO PV-TEMP-EXCL-LBL        16530000
                                                                        16540000
                   MOVE 'Y' TO PS-DEFAULT-BRAND-SW                      16550000
               END-IF                                                   16560000
                                                                        16570000
           END-PERFORM.                                                 16580000
                                                                        16590000
                                                                        16600000
      *----------------------------------------------------------------*16610000
      * 3400-ASSIGN-DEFAULT-BRAND  ( BASED ON DPT/SCL )                 16620000
      *   A BRAND IS ASSIGNED REGARDLESS OF ML-BV FINANCIAL POSITION    16630000
      *----------------------------------------------------------------*16640000
       3400-ASSIGN-DEFAULT-BRAND.                                       16650000
                                                                        16660000
      *    GET ML-DKEY                                                  16670000
      *    MOVE ROW TO ML-BV TABLE FOR REPORTING                        16680000
      *    PERFORM 6100-GET-DKEY.                                       16690000
      *                                                                 16700000
           DISPLAY ' DA NUMBER: ', PV-DA-TEMP-DR-ALW-NBR.               16710000
           DISPLAY 'DEFAULT BRAND ASSIGNMENT FOR DEPT/SCL: ',           16720000
             PV-DA-TEMP-DEPT-NBR, '-', PV-DA-TEMP-SUB-CL-NBR.           16730000
           DISPLAY 'DEFAULT BRAND :',  PV-TEMP-EXCL-LBL.                16740000
                                                                        16750000
      *    SET DEFAULT-BRAND-FOUND TO TRUE.                             16760000
      *                                                                 16770000
      *                                                                 16780000
      *    DA-PRORATION-TABLE                                           16790000
TEMP1 *    ADD 1 TO SS-DA.                                              16800000
TEMP2 *    MOVE SS-EXCL TO SS-DA.                                       16810000
      *                                                                 16820000
      *    MOVE EXCL-DEPT-SCL(SS-EXCL)                                  16830000
      *    MOVE EXCL-BRAND(SS-EXCL)   TO DA-LBL-SEQ-NBR(SS-DA).         16840000
      *    DATE                                                         16850000
      *    DARD100 DATE 2008-09-25.00.00.00                             16860000
      *    ORA DATE 08-SEP-25                                           16870000
      *    PERFORM 3150-REFORMAT-DATES.                                 16880000
      *    MOVE PV-ORACLE-DTE         TO DA-EFF-BEG-TMST(SS-DA).        16890000
      *    MOVE 100                   TO DA-PRRTN-PCT(SS-DA).           16900000
                                                                        16910000
      *----------------------------------------------------------------*16920000
      * 3500-ASSIGN-UNKNOWN-VENDOR ( BASED ON DPT/SCL )                 16930000
      *   A BRAND IS ASSIGNED REGARDLESS OF ML-BV FINANCIAL POSITION    16940000
      *----------------------------------------------------------------*16950000
       3500-ASSIGN-UNKNOWN-VENDOR.                                      16960000
      *                                                                 16970000
           DISPLAY '***** UNKNOWN DFLT BRAND ASSIGNMENT FOR DEPT/SCL: ',16980000
             PV-DA-TEMP-DEPT-NBR, '-', PV-DA-TEMP-SUB-CL-NBR.           16990000
           SET ASSIGN-UNKNOWN-BRAND TO TRUE.                            17000000
      *                                                                 17010000
      *    GET ML-DKEY                                                  17020000
      *    MOVE ROW TO ML-BV TABLE FOR REPORTING                        17030000
      *    ADD 1 TO SS-DA.                                              17040000
      *                                                                 17050000
      *    MOVE PV-DA-TEMP-DR-ALW-NBR TO DA-DR-ALW-NBR(SS-DA).          17060000
      *    MOVE 2230                  TO DA-LBL-SEQ-NBR(SS-DA).         17070000
      *DARD100 DATE 2008-09-25.00.00.00                                 17080000
      *ORA DATE 08-SEP-25                                               17090000
      *    PERFORM 3150-REFORMAT-DATES.                                 17100000
      *    MOVE PV-ORACLE-DTE         TO DA-EFF-BEG-TMST(SS-DA).        17110000
      *    MOVE 100                   TO DA-PRRTN-PCT(SS-DA).           17120000
      *                                                                 17130000
      *                                                                 17140000
      *                                                                 17150000
      *----------------------------------------------------------------*17160000
      * 3600-CALC-BRAND-DOLLARS                                         17170000
      *   BASED ON DA VALUES, APPLY THE DOLLARS TO EACH BRAND'S PCT     17180000
      *----------------------------------------------------------------*17190000
       3600-CALC-DA-RTL.                                                17200000
      *                                                                 17210000
      *-- CALCULATE RETAIL FOR MARKDOWN ALLOWANCE, ASSET RECOVERY,      17220000
      *-- AND MKDN ALW PROFIT ASST - CST/RTL                            17230000
      *                                                                 17240000
           MOVE DA100-NET-CST-AMT TO PV-DA-CST-AMT-TOTAL                17250000
                                                                        17260000
           COMPUTE PV-DA100-PCTG = (1 - (DA100-MKUP-PCT / 100))         17270000
           COMPUTE PV-DA-RTL-AMT-TOTAL ROUNDED =                        17280000
                       DA100-NET-CST-AMT /                              17290000
                       PV-DA100-PCTG.                                   17300000
                                                                        17310000
           MOVE PV-DA-CST-AMT-TOTAL TO DA111-DA-COST-DTL.               17320000
           MOVE PV-DA-RTL-AMT-TOTAL TO DA111-DA-RTL-DTL.                17330000
                                                                        17340000
      *                                                                 17350000
      * DAT COST AND RETAIL TOTALS                                      17360000
      *    PV-DA-CST-AMT-TOTAL                                          17370000
      *    PV-DA-RTL-AMT-TOTAL                                          17380000
                                                                        17390000
      *----------------------------------------------------------------*17400000
      * 3700-GET ALLOCATION-VERBIAGE FOR REPORT 2                       17410000
      *----------------------------------------------------------------*17420000
       3700-GET-ALLOCATION-VERBIAGE.                                    17430000
                                                                        17440000
           EVALUATE TRUE                                                17450000
                                                                        17460000
               WHEN PS-ALLOCATE-ALL-EVEN                                17470000
                    SET PC-ALLOCATE-A     TO TRUE                       17480000
               WHEN PS-ALLOCATE-POS-DIST                                17490000
                    SET PC-ALLOCATE-B     TO TRUE                       17500000
               WHEN PS-ALLOCATE-NEG-DIST-ABS                            17510000
                    SET PC-ALLOCATE-C     TO TRUE                       17520000
               WHEN PS-ALLOCATE-IN-RANGE-POS-DIST                       17530000
                    SET PC-ALLOCATE-D     TO TRUE                       17540000
               WHEN PS-ALLOCATE-IN-RANGE-NEG-ABS                        17550000
                    SET PC-ALLOCATE-E     TO TRUE                       17560000
               WHEN PS-ALLOCATE-IN-RANGE-ZERO-EVEN                      17570000
                    SET PC-ALLOCATE-F     TO TRUE                       17580000
               WHEN PS-ALLOCATE-IN-RANGE-POS-EVEN                       17590000
                    SET PC-ALLOCATE-G     TO TRUE                       17600000
               WHEN PS-ALLOCATE-SINGLE-BRAND                            17610000
                    SET PC-ALLOCATE-H     TO TRUE                       17620000
               WHEN PS-ALLOCATE-UNKNOWN-BRAND                           17630000
                    SET PC-ALLOCATE-I     TO TRUE                       17640000
               WHEN PS-ALLOCATE-DEFAULT-BRAND                           17650000
                    SET PC-ALLOCATE-J     TO TRUE                       17660000
               WHEN PS-ALLOCATE-DEFAULT-ERROR                           17670000
                    SET PC-ALLOCATE-K     TO TRUE                       17680000
           END-EVALUATE.                                                17690000
                                                                        17700000
      *----------------------------------------------------------------*17710000
      * 5000-PROCESS-DATE-FILE TO RETRIEVE PREVIOUS WEEK PARTITIONS     17720000
      *----------------------------------------------------------------*17730000
       5000-PROCESS-DATE-FILE.                                          17740000
                                                                        17750000
           MOVE '5000-PROCESS-DATE-FILE' TO PV-ABEND-PARAGRAPH.         17760000
                                                                        17770000
           MOVE DA104-OPN-FSCL-MN-DTE TO PV-FSCL-MN-END-DTE             17780000
           MOVE DA104-OPN-FSCL-WK-DTE TO PV-FSCL-WK-END-DTE             17790000
                                         PV-WK-END-DTE                  17800000
           MOVE DA104-OPN-FSCL-YR-NBR TO PV-FSCL-YR-NBR-DTE.            17810000
           DISPLAY 'CURRENT ML FSCL-WK-END  : ', PV-FSCL-WK-END-DTE.    17820000
                                                                        17830000
           PERFORM 5100-OPEN-DATE-CSR.                                  17840000
           PERFORM 5200-FETCH-DATE-CSR                                  17850000
               UNTIL PS-NO-DATES-LEFT.                                  17860000
           PERFORM 5300-CLOSE-DATE-CURSOR.                              17870000
                                                                        17880000
       EJECT                                                            17890000
                                                                        17900000
      *----------------------------------------------------------------*17910000
      * 5100-OPEN-DATE-CSR                                              17920000
      *----------------------------------------------------------------*17930000
       5100-OPEN-DATE-CSR.                                              17940000
                                                                        17950000
           MOVE '5100-OPEN-DATE-CSR' TO PV-ABEND-PARAGRAPH.             17960000
                                                                        17970000
           EXEC SQL                                                     17980000
               OPEN DATE_CSR                                            17990000
           END-EXEC.                                                    18000000
                                                                        18010000
           EVALUATE TRUE                                                18020000
             WHEN SQLCODE = ZEROS                                       18030000
               CONTINUE                                                 18040000
      *      WHEN SQLCODE = 1403                                        18050000
      *      WHEN SQLCODE = +100                                        18060000
      *        SET PS-NO-DATES-LEFT TO TRUE                             18070000
      *        CONTINUE                                                 18080000
             WHEN OTHER                                                 18090000
               DISPLAY PV-ABEND-PARAGRAPH                               18100000
               PERFORM 9999-SQL-ERROR                                   18110000
           END-EVALUATE.                                                18120000
                                                                        18130000
       EJECT                                                            18140000
      *----------------------------------------------------------------*18150000
      *5200-FETCH-DATE-CSR                                              18160000
      *    FETCH A ROW FROM THE DATE CURSOR (RETRIEVE 2 PARTITION NBRS) 18170000
      *----------------------------------------------------------------*18180000
       5200-FETCH-DATE-CSR.                                             18190000
                                                                        18200000
           MOVE '5200-FETCH-DATE-CSR' TO PV-ABEND-PARAGRAPH.            18210000
                                                                        18220000
           EXEC SQL                                                     18230000
               FETCH DATE_CSR                                           18240000
               INTO :PV-PARTN-NBR                                       18250000
                   ,:DTATTR-FSCL-WK-END-DTE                             18260000
           END-EXEC.                                                    18270000
                                                                        18280000
           EVALUATE TRUE                                                18290000
             WHEN SQLCODE = ZEROS                                       18300000
                   ADD 1 TO SS-PARTN-NBR                                18310000
                   PERFORM 3100-FORMAT-DATES                            18320000
      *      WHEN SQLCODE = 1403                                        18330000
             WHEN SQLCODE = +100                                        18340000
               SET PS-NO-DATES-LEFT TO TRUE                             18350000
             WHEN OTHER                                                 18360000
               DISPLAY PV-ABEND-PARAGRAPH                               18370000
               PERFORM 9999-SQL-ERROR                                   18380000
           END-EVALUATE.                                                18390000
                                                                        18400000
       EJECT                                                            18410000
      *----------------------------------------------------------------*18420000
      *5300-CLOSE-DATE-CURSOR                                         * 18430000
      *----------------------------------------------------------------*18440000
       5300-CLOSE-DATE-CURSOR.                                          18450000
                                                                        18460000
           MOVE '5300-CLOSE-DATE-CURSOR' TO PV-ABEND-PARAGRAPH.         18470000
                                                                        18480000
           EXEC SQL                                                     18490000
               CLOSE DATE_CSR                                           18500000
           END-EXEC.                                                    18510000
                                                                        18520000
           EVALUATE TRUE                                                18530000
             WHEN SQLCODE = ZEROS                                       18540000
               CONTINUE                                                 18550000
             WHEN OTHER                                                 18560000
               DISPLAY PV-ABEND-PARAGRAPH                               18570000
               PERFORM 9999-SQL-ERROR                                   18580000
           END-EVALUATE.                                                18590000
                                                                        18600000
       EJECT                                                            18610000
      *----------------------------------------------------------------*18620000
      * 5500-OPEN-ML-BV-CSR                                             18630000
      *    SELECT ML BRAND VENDOR FINANCIALS FOR BRAND-LEVEL PRORATION  18640000
      *----------------------------------------------------------------*18650000
       5500-OPEN-ML-BV-CSR.                                             18660000
                                                                        18670000
           EXEC SQL                                                     18680000
               OPEN BRAND_VENDOR_CSR                                    18690000
           END-EXEC.                                                    18700000
                                                                        18710000
           EVALUATE TRUE                                                18720000
             WHEN SQLCODE = ZEROS                                       18730000
               CONTINUE                                                 18740000
     **      WHEN SQLCODE = 1403                                        18750000
     **      WHEN SQLCODE = +100                                        18760000
     **        SET PS-NO-DATES-LEFT TO TRUE                             18770000
     **        CONTINUE                                                 18780000
             WHEN OTHER                                                 18790000
               DISPLAY PV-ABEND-PARAGRAPH                               18800000
               PERFORM 9999-SQL-ERROR                                   18810000
           END-EVALUATE.                                                18820000
                                                                        18830000
       EJECT                                                            18840000
      *----------------------------------------------------------------*18850000
      *    FETCH-BRAND-VENDOR-CSR                                      *18860000
      *      FETCH A ROW FROM THE CURSOR                               *18870000
      *----------------------------------------------------------------*18880000
       5600-FETCH-ML-BV-CSR.                                            18890000
                                                                        18900000
           MOVE '5600-FETCH-MKL-BV-CSR' TO PV-ABEND-PARAGRAPH.          18910000
           EXEC SQL                                                     18920000
               FETCH BRAND_VENDOR_CSR                                   18930000
               INTO :BV-CSR-DBV-KEY                                     18940000
                  , :BV-CSR-DEPT-NBR                                    18950000
SCL****           , :BV-CSR-SUB-CL-NBR                                  18960000
                  , :BV-CSR-END-INV-RTL                                 18970000
                  , :BV-CSR-END-INV-CST                                 18980000
           END-EXEC.                                                    18990000
                                                                        19000000
           EVALUATE TRUE                                                19010000
             WHEN SQLCODE = ZEROS                                       19020000
               ADD 1 TO PA-ML-BRAND-COUNT                               19030000
               SET PS-MORE-BV-TRANS-LEFT TO TRUE                        19040000
      *      WHEN SQLCODE = 1403                                        19050000
             WHEN SQLCODE = +100                                        19060000
               SET PS-NO-MORE-BV-TRANS-LEFT TO TRUE                     19070000
             WHEN OTHER                                                 19080000
               DISPLAY PV-ABEND-PARAGRAPH                               19090000
               PERFORM 9999-SQL-ERROR                                   19100000
           END-EVALUATE.                                                19110000
                                                                        19120000
       EJECT                                                            19130000
      *----------------------------------------------------------------*19140000
      *    CLOSE-BRAND-CURSOR                                         * 19150000
      *----------------------------------------------------------------*19160000
       5700-CLOSE-ML-BV-CURSOR.                                         19170000
                                                                        19180000
           MOVE '5700-CLOSE-ML-BV-CSR-CURSOR' TO PV-ABEND-PARAGRAPH.    19190000
                                                                        19200000
           EXEC SQL                                                     19210000
               CLOSE BRAND_VENDOR_CSR                                   19220000
           END-EXEC.                                                    19230000
                                                                        19240000
           EVALUATE TRUE                                                19250000
             WHEN SQLCODE = ZEROS                                       19260000
               CONTINUE                                                 19270000
             WHEN OTHER                                                 19280000
               DISPLAY PV-ABEND-PARAGRAPH                               19290000
               PERFORM 9999-SQL-ERROR                                   19300000
           END-EVALUATE.                                                19310000
                                                                        19320000
       EJECT                                                            19330000
      *----------------------------------------------------------------*19340000
      *    SELECT-VENDOR-INFO                                  *        19350000
      *----------------------------------------------------------------*19360000
       5800-SELECT-VENDOR-INFO.                                         19370000
                                                                        19380000
      *    MOVE ML-VND-NBR(SS-ML-BV)     TO PV-VND-NBR                  19390000
                                                                        19400000
           MOVE '5800-SELECT-VENDOR-INFO' TO PV-ABEND-PARAGRAPH.        19410000
                                                                        19420000
           EXEC SQL                                                     19430000
               SELECT ENT_NAME_DESC                                     19440000
                INTO :ENTNME-ENT-NAME-DESC                              19450000
               FROM TENTNME                                             19460000
               WHERE ENT_ID = :PV-VND-NBR                               19470000
                 AND TYPE_CDE = '01'                                    19480000
                                                                        19490000
           END-EXEC.                                                    19500000
                                                                        19510000
           EVALUATE TRUE                                                19520000
             WHEN SQLCODE = ZEROS                                       19530000
               INSPECT ENTNME-ENT-NAME-DESC                             19540000
                                REPLACING ALL ',' BY ' '                19550000
             WHEN OTHER                                                 19560000
               DISPLAY PV-ABEND-PARAGRAPH                               19570000
               PERFORM 9999-SQL-ERROR                                   19580000
           END-EVALUATE.                                                19590000
                                                                        19600000
       EJECT                                                            19610000
                                                                        19620000
      *----------------------------------------------------------------*19630000
      *    SELECT-BRAND-INFO                                         *  19640000
      *----------------------------------------------------------------*19650000
       5850-SELECT-BRAND-INFO.                                          19660000
                                                                        19670000
      *    MOVE ML-DBV-DKEY(SS-ML-BV)    TO PV-DKEY.                    19680000
      *    MOVE ML-LBL-SEQ-NBR(SS-ML-BV) TO PV-DKEY.                    19690000
                                                                        19700000
           MOVE '5850-SELECT-BRAND-INFO' TO PV-ABEND-PARAGRAPH.         19710000
                                                                        19720000
           EXEC SQL                                                     19730000
               SELECT CHARTC_VAL_DESC                                   19740000
                     ,B.LBL_SEQ_NBR                                     19750000
                     ,LBL_TYP_CDE                                       19760000
                 INTO :VSCHVL-CHARTC-VAL-DESC                           19770000
                     ,:IMT00000-LBL-SEQ-NBR                             19780000
                     ,:IMT00000-LBL-TYP-CDE                             19790000
                 FROM IMT_DEPT_BRND_VND A                               19800000
                    , IMT_LBL B                                         19810000
                    , TVSCHVL C                                         19820000
                WHERE DEPT_BRND_VND_ID = :PV-DKEY                       19830000
                  AND A.LBL_SEQ_NBR = B.LBL_SEQ_NBR                     19840000
                  AND B.LBL_SEQ_NBR = C.CHARTC_SEQ_NBR                  19850000
                  AND CHARTC_CDE = 3                                    19860000
                  AND  (EFF_BEG_DTE <= :PV-FSCL-WK-END-DTE              19870000
                  AND  (EFF_END_DTE >= :PV-FSCL-WK-END-DTE              19880000
                   OR   EFF_END_DTE IS NULL))                           19890000
           END-EXEC.                                                    19900000
                                                                        19910000
           EVALUATE TRUE                                                19920000
             WHEN SQLCODE = ZEROS                                       19930000
               INSPECT VSCHVL-CHARTC-VAL-DESC                           19940000
                                REPLACING ALL ',' BY ' '                19950000
             WHEN SQLCODE = +100                                        19960000
               MOVE 'BRAND NAME NOT FOUND' TO VSCHVL-CHARTC-VAL-DESC    19970000
             WHEN OTHER                                                 19980000
               DISPLAY PV-ABEND-PARAGRAPH                               19990000
               PERFORM 9999-SQL-ERROR                                   20000000
           END-EVALUATE.                                                20010000
                                                                        20020000
       EJECT                                                            20030000
                                                                        20040000
                                                                        20050000
      *----------------------------------------------------------------*20060000
      *    SELECT-BRAND-NAME ONLY                                    *  20070000
      *----------------------------------------------------------------*20080000
       5855-SELECT-BRAND-NAME.                                          20090000
                                                                        20100000
           MOVE ML-LBL-SEQ-NBR(SS-ML-BV) TO PV-DKEY.                    20110000
                                                                        20120000
           MOVE '5855-SELECT-BRAND-NAME' TO PV-ABEND-PARAGRAPH.         20130000
                                                                        20140000
           EXEC SQL                                                     20150000
               SELECT CHARTC_VAL_DESC                                   20160000
                 INTO :VSCHVL-CHARTC-VAL-DESC                           20170000
                 FROM TVSCHVL                                           20180000
                WHERE CHARTC_SEQ_NBR   = :PV-DKEY                       20190000
                  AND CHARTC_CDE = 3                                    20200000
           END-EXEC.                                                    20210000
                                                                        20220000
           EVALUATE TRUE                                                20230000
             WHEN SQLCODE = ZEROS                                       20240000
               INSPECT VSCHVL-CHARTC-VAL-DESC                           20250000
                                REPLACING ALL ',' BY ' '                20260000
             WHEN SQLCODE = +100                                        20270000
               MOVE 'BRAND NAME NOT FOUND' TO VSCHVL-CHARTC-VAL-DESC    20280000
             WHEN OTHER                                                 20290000
               DISPLAY PV-ABEND-PARAGRAPH                               20300000
               PERFORM 9999-SQL-ERROR                                   20310000
           END-EVALUATE.                                                20320000
                                                                        20330000
       EJECT                                                            20340000
                                                                        20350000
      *----------------------------------------------------------------*20360000
      *    SELECT-CUM-MKUP-TARGET                                    *  20370000
      *----------------------------------------------------------------*20380000
       5900-DEPT-CUM-MKUP-TARGET.                                       20390000
                                                                        20400000
           MOVE '5900-DEPT-CUM-MKUP-TARGET' TO PV-ABEND-PARAGRAPH.      20410000
                                                                        20420000
           EXEC SQL                                                     20430000
              SELECT  MIN_CUM_MKUP_PCT                                  20440000
                     ,MAX_CUM_MKUP_PCT                                  20450000
                INTO :MLT00013-MIN-CUM-MKUP-PCT                         20460000
                    ,:MLT00013-MAX-CUM-MKUP-PCT                         20470000
                FROM  MLT_CUM_MKUP_TGT                                  20480000
               WHERE  DEPT_NBR = :PV-HOLD-DEPT                          20490000
                  AND  (EFF_BEG_DTE <= :PV-FSCL-WK-END-DTE              20500000
                  AND  (EFF_END_DTE >= :PV-FSCL-WK-END-DTE              20510000
                   OR   EFF_END_DTE IS NULL))                           20520000
           END-EXEC.                                                    20530000
                                                                        20540000
           EVALUATE TRUE                                                20550000
             WHEN SQLCODE = ZEROS                                       20560000
                 SET PS-ROW-FOUND TO TRUE                               20570000
                 MOVE MLT00013-MIN-CUM-MKUP-PCT  TO PV-MIN-MKUP-TARGET  20580000
                 MOVE MLT00013-MAX-CUM-MKUP-PCT  TO PV-MAX-MKUP-TARGET  20590000
RONNA        WHEN SQLCODE = +100                                        20600000
RONNA            SET PS-ROW-NOT-FOUND TO TRUE                           20610000
             WHEN OTHER                                                 20620000
               DISPLAY PV-ABEND-PARAGRAPH                               20630000
               PERFORM 9999-SQL-ERROR                                   20640000
           END-EVALUATE.                                                20650000
                                                                        20660000
       EJECT                                                            20670000
                                                                        20680000
      *----------------------------------------------------------------*20690000
      *    SELECT-CORP-DEFAULT-MKUP                                  *  20700000
      *----------------------------------------------------------------*20710000
       5950-SELECT-DEFAULT-CORP-MKUP.                                   20720000
                                                                        20730000
           MOVE '5950-SELECT-DEFAULT-CORP-MKUP' TO PV-ABEND-PARAGRAPH.  20740000
                                                                        20750000
           EXEC SQL                                                     20760000
              SELECT  MIN_CUM_MKUP_PCT                                  20770000
                     ,MAX_CUM_MKUP_PCT                                  20780000
                INTO :MLT00014-MIN-CUM-MKUP-PCT                         20790000
                    ,:MLT00014-MAX-CUM-MKUP-PCT                         20800000
                FROM  MLT_CORP_GLBL_DFLT                                20810000
               WHERE  (EFF_BEG_DTE <= :PV-FSCL-WK-END-DTE               20820000
                 AND  (EFF_END_DTE >= :PV-FSCL-WK-END-DTE               20830000
                  OR   EFF_END_DTE IS NULL))                            20840000
           END-EXEC.                                                    20850000
                                                                        20860000
           EVALUATE TRUE                                                20870000
             WHEN SQLCODE = ZEROS                                       20880000
                 SET PS-ROW-FOUND TO TRUE                               20890000
                 MOVE MLT00014-MIN-CUM-MKUP-PCT  TO PV-MIN-MKUP-TARGET  20900000
                 MOVE MLT00014-MAX-CUM-MKUP-PCT  TO PV-MAX-MKUP-TARGET  20910000
             WHEN OTHER                                                 20920000
               DISPLAY PV-ABEND-PARAGRAPH                               20930000
               PERFORM 9999-SQL-ERROR                                   20940000
           END-EVALUATE.                                                20950000
                                                                        20960000
       EJECT                                                            20970000
                                                                        20980000
      /----------------------------------------------------------------*20990000
      *    FOR DATE CONVERSION ORACLE VS. DB2                           21000000
      *                                                                 21010000
      *----------------------------------------------------------------*21020000
       6000-GET-MONTH-NAME.                                             21030000
                                                                        21040000
           EXEC SQL                                                     21050000
             SELECT FSCL_MN_NM                                          21060000
               INTO :DTATTR-FSCL-MN-NM                                  21070000
               FROM TDTATTR                                             21080000
              WHERE KY_DTE = :PV-HOLD-DATE                              21090000
           END-EXEC.                                                    21100000
      *                                                                 21110000
                                                                        21120000
           EVALUATE TRUE                                                21130000
             WHEN SQLCODE = ZEROS                                       21140000
                 MOVE DTATTR-FSCL-MN-NM TO PV-FSCL-MN-NAME              21150000
               CONTINUE                                                 21160000
     **      WHEN SQLCODE = 1403                                        21170000
      *      WHEN SQLCODE = +100                                        21180000
      *        SET PS-NO-DATES-LEFT TO TRUE                             21190000
     **        CONTINUE                                                 21200000
             WHEN OTHER                                                 21210000
               DISPLAY PV-ABEND-PARAGRAPH                               21220000
               PERFORM 9999-SQL-ERROR                                   21230000
           END-EVALUATE.                                                21240000
                                                                        21250000
       EJECT                                                            21260000
      /----------------------------------------------------------------*21270000
      *  GET THE UNKNOWN DKEY                                           21280000
      *                                                                 21290000
      *----------------------------------------------------------------*21300000
       6100-GET-KNOWN-DKEY.                                             21310000
                                                                        21320000
           DISPLAY '6100-GET-KNOWN-DKEY'.                               21330000
                                                                        21340000
           MOVE 'N' TO  PS-DBV-DKEY-SW.                                 21350000
                                                                        21360000
           EXEC SQL                                                     21370000
             SELECT  DEPT_BRND_VND_ID                                   21380000
               INTO :IMT00017-DEPT-BRND-VND-ID                          21390000
               FROM  IMT_DEPT_BRND_VND                                  21400000
              WHERE  DEPT_NBR    = :PV-DEPT-NBR                         21410000
                AND  ENT_ID      = :PV-ENT-ID                           21420000
                AND  LBL_SEQ_NBR = :PV-TEMP-LBL                         21430000
                AND  (EFF_BEG_DTE <= :PV-FSCL-WK-END-DTE                21440000
                AND  (EFF_END_DTE >= :PV-FSCL-WK-END-DTE                21450000
                 OR   EFF_END_DTE IS NULL))                             21460000
          END-EXEC.                                                     21470000
                                                                        21480000
           EVALUATE TRUE                                                21490000
             WHEN SQLCODE = ZEROS                                       21500000
                 MOVE IMT00017-DEPT-BRND-VND-ID TO PV-DKEY              21510000
                 SET PS-DBV-DKEY-FOUND TO TRUE                          21520000
               CONTINUE                                                 21530000
     **      WHEN SQLCODE = 1403                                        21540000
             WHEN SQLCODE = +100                                        21550000
                 SET PS-RELATIONSHIP-NOT-EXISTS TO TRUE                 21560000
     **        CONTINUE                                                 21570000
             WHEN OTHER                                                 21580000
               DISPLAY PV-ABEND-PARAGRAPH                               21590000
               PERFORM 9999-SQL-ERROR                                   21600000
           END-EVALUATE.                                                21610000
                                                                        21620000
      /----------------------------------------------------------------*21630000
      *  GET THE UNKNOWN DKEY                                           21640000
      *                                                                 21650000
      *----------------------------------------------------------------*21660000
       6150-GET-UNKNOWN-DKEY.                                           21670000
           DISPLAY '***** 6150-GET-UNKNOWN-DKEY'.                       21680000
                                                                        21690000
           EXEC SQL                                                     21700000
             SELECT  UNKN_BRND_VND_ID                                   21710000
               INTO :MLT00011-UNKN-BRND-VND-ID                          21720000
               FROM  MLT_UNKN_BRND_VND                                  21730000
             WHERE DEPT_NBR    = :PV-DEPT-NBR                           21740000
               AND ENT_ID      = :PV-ENT-ID                             21750000
               AND LBL_SEQ_NBR = :PV-TEMP-LBL                           21760000
*********      AND CRE_TMST   <= :PV-CRE-TMST                           21770000
         END-EXEC.                                                      21780000
                                                                        21790000
           EVALUATE TRUE                                                21800000
             WHEN SQLCODE = ZEROS                                       21810000
                 MOVE MLT00011-UNKN-BRND-VND-ID TO PV-DKEY              21820000
               CONTINUE                                                 21830000
      *      WHEN SQLCODE = 1403                                        21840000
             WHEN SQLCODE = +100                                        21850000
                 MOVE ZERO TO PV-DKEY                                   21860000
             WHEN OTHER                                                 21870000
               DISPLAY PV-ABEND-PARAGRAPH                               21880000
               PERFORM 9999-SQL-ERROR                                   21890000
           END-EVALUATE.                                                21900000
                                                                        21910000
       8000-CREATE-DETAIL-REPORT.                                       21920000
                                                                        21930000
           INITIALIZE DETAIL-RECORD                                     21940000
                      DETAIL-INTERIM-RECORD.                            21950000
                                                                        21960000
           PERFORM 8100-PROCESS-HEADER.                                 21970000
                                                                        21980000
           PERFORM 8200-PROCESS-DETAIL                                  21990000
              VARYING SS-ML-BV FROM 1 BY 1                              22000000
                   UNTIL SS-ML-BV > PA-ML-BRAND-COUNT.                  22010000
                                                                        22020000
      *----------------------------------------------------------------*22030000
      *  PROCESS THE HEADER RECORDS                                     22040000
      *----------------------------------------------------------------*22050000
       8100-PROCESS-HEADER.                                             22060000
                                                                        22070000
      *    ADD 9 TO PV-LINE-COUNT.                                      22080000
                                                                        22090000
           IF PV-LINE-COUNT >= PV-MAX-LINE-COUNT                        22100000
               ADD 1 TO PV-PAGE-COUNT                                   22110000
               MOVE PV-PAGE-COUNT TO DP133O-PAGE-NUMBER                 22120000
               MOVE DP133O-STANDRD-HEADER-133-COLS                      22130000
                   TO DETAIL-REPORT-REC                                 22140000
               WRITE DETAIL-REPORT-REC                                  22150000
                   AFTER ADVANCING PAGE                                 22160000
               MOVE +9 TO PV-LINE-COUNT                                 22170000
                                                                        22180000
               WRITE DETAIL-REPORT-REC FROM HEADER1                     22190000
                   AFTER ADVANCING PV-ADVANCE                           22200000
                                                                        22210000
      *        WRITE DETAIL-REPORT-REC2 FROM RPT2-HEADER                22220000
      *            AFTER ADVANCING PV-ADVANCE                           22230000
           END-IF.                                                      22240000
                                                                        22250000
           MOVE DA100-DR-ALW-NBR         TO HEADER-DA-NBR               22260000
RPT2                                        DA111-DA-NBR-DTL.           22270000
           MOVE DA100-DEPT-NBR           TO HEADER-DEPT                 22280000
RPT2                                        DA111-DEPT-DTL.             22290000
           MOVE DA100-SUB-CL-NBR         TO HEADER-SCL                  22300000
RPT2                                        DA111-SCL-DTL.              22310000
                                                                        22320000
           MOVE DA100-ENT-ID             TO PV-VND-NBR                  22330000
           MOVE PV-VND-NBR               TO ML-VND-NBR-DTL.             22340000
           MOVE ML-VND-NBR-DTL           TO ML-DTL-VND-NBR.             22350000
                                                                        22360000
           MOVE PV-MIN-MKUP-TARGET       TO PV-MIN-MKUP-TARGET-NBR.     22370000
           MOVE PV-MAX-MKUP-TARGET       TO PV-MAX-MKUP-TARGET-NBR.     22380000
           MOVE PV-MIN-MKUP-TARGET-NBR   TO HEADER-MIN-TARGET           22390000
RPT2                                        DA111-TARGET-MIN-DTL.       22400000
           MOVE PV-MAX-MKUP-TARGET-NBR   TO HEADER-MAX-TARGET           22410000
RPT2                                        DA111-TARGET-MAX-DTL.       22420000
                                                                        22430000
           PERFORM 5800-SELECT-VENDOR-INFO.                             22440000
           MOVE ENTNME-ENT-NAME-DESC    TO HEADER-VENDOR                22450000
RPT2                                       DA111-VENDOR-DTL.            22460000
                                                                        22470000
           WRITE DETAIL-REPORT-REC FROM HEADER2                         22480000
               AFTER ADVANCING 2 LINES.                                 22490000
                                                                        22500000
           WRITE DETAIL-REPORT-REC FROM HEADER2-DA                      22510000
               AFTER ADVANCING PV-ADVANCE.                              22520000
                                                                        22530000
           WRITE DETAIL-REPORT-REC FROM HEADER3                         22540000
               AFTER ADVANCING PV-ADVANCE.                              22550000
                                                                        22560000
           WRITE DETAIL-REPORT-REC FROM HEADER4                         22570000
               AFTER ADVANCING PV-ADVANCE.                              22580000
                                                                        22590000
      *----------------------------------------------------------------*22600000
      *  PROCESS THE DETAIL RECORDS                                     22610000
      *----------------------------------------------------------------*22620000
       8200-PROCESS-DETAIL.                                             22630000
                                                                        22640000
               MOVE ML-DBV-DKEY(SS-ML-BV)  TO ML-DBV-DKEY-DTL           22650000
               MOVE ML-DBV-DKEY-DTL        TO ML-DTL-DBV-DKEY.          22660000
      *                                                                 22670000
               MOVE ML-DEPT-NBR(SS-ML-BV)  TO ML-DEPT-NBR-DTL.          22680000
               MOVE ML-DEPT-NBR-DTL        TO HEADER-DEPT.              22690000
      *                                                                 22700000
               MOVE ML-SCL-NBR(SS-ML-BV)   TO ML-SCL-NBR-DTL.           22710000
               MOVE ML-SCL-NBR-DTL         TO HEADER-SCL.               22720000
      *                                                                 22730000
      *        MOVE PV-DA-TEMP-DR-ALW-NBR    TO ML-DTL-DR-ALW-NBR.      22740000
      *                                                                 22750000
               MOVE ML-END-INV-RTL-AMT(SS-ML-BV) TO ML-END-INV-RTL-DTL. 22760000
               MOVE ML-END-INV-RTL-DTL     TO ML-DTL-END-INV-RTL-AMT    22770000
RPT2                                          DA111-EIRRTL-BASIS-DTL.   22780000
                                                                        22790000
               MOVE ML-END-INV-COST2-AMT(SS-ML-BV)                      22800000
                                            TO ML-END-INV-COST2-DTL.    22810000
               MOVE ML-END-INV-COST2-DTL    TO ML-DTL-END-INV-COST2-AMT 22820000
RPT2                                           DA111-EIRCOST-BASIS-DTL. 22830000
                                                                        22840000
               MOVE ML-MKUP-PCT(SS-ML-BV)   TO ML-MKUP-PCT-DTL.         22850000
               MOVE ML-MKUP-PCT-DTL         TO ML-DTL-MKUP-PCT          22860000
RPT2                                           DA111-MKUP-PCT-DTL.      22870000
                                                                        22880000
               IF ML-INCL-IND(SS-ML-BV) = 1                             22890000
                   MOVE '*' TO ML-DTL-INCL-IND                          22900000
               ELSE                                                     22910000
                   MOVE ' ' TO ML-DTL-INCL-IND                          22920000
               END-IF.                                                  22930000
      *                                                                 22940000
               IF ML-NEG-INV-IND(SS-ML-BV) = 1                          22950000
                   MOVE 'X' TO ML-DTL-NEG-INV-IND                       22960000
RPT2                           DA111-EXCEPTION-NEG-DTL                  22970000
               ELSE                                                     22980000
                   MOVE ' ' TO ML-DTL-NEG-INV-IND                       22990000
RPT2                           DA111-EXCEPTION-NEG-DTL                  23000000
               END-IF.                                                  23010000
      *                                                                 23020000
               IF ML-ZERO-INV-IND(SS-ML-BV) = 1                         23030000
                   MOVE 'X' TO ML-DTL-ZERO-INV-IND                      23040000
RPT2                           DA111-EXCEPTION-ZERO-DTL                 23050000
               ELSE                                                     23060000
                   MOVE ' ' TO ML-DTL-ZERO-INV-IND                      23070000
RPT2                           DA111-EXCEPTION-ZERO-DTL                 23080000
               END-IF.                                                  23090000
      *                                                                 23100000
               IF ML-OUT-RANGE-IND(SS-ML-BV) = 1                        23110000
                   MOVE 'X' TO ML-DTL-OUT-RANGE-IND                     23120000
RPT2                           DA111-EXCEPTION-CUM-DTL                  23130000
               ELSE                                                     23140000
                   MOVE ' ' TO ML-DTL-OUT-RANGE-IND                     23150000
RPT2                           DA111-EXCEPTION-CUM-DTL                  23160000
               END-IF.                                                  23170000
                                                                        23180000
               IF ML-DBV-DKEY(SS-ML-BV) = 0                             23190000
                   PERFORM 5855-SELECT-BRAND-NAME                       23200000
                   MOVE VSCHVL-CHARTC-VAL-DESC TO ML-DTL-BRAND-NAME     23210000
RPT2                                              DA111-BRAND-NAME-DTL  23220000
                   MOVE ML-LBL-SEQ-NBR(SS-ML-BV)                        23230000
                                               TO DA111-LBL-SEQ-NBR-DTL 23240000
                   MOVE 'N' TO PS-UNKNOWN-BRAND-SW                      23250000
               ELSE                                                     23260000
                   MOVE ML-DBV-DKEY(SS-ML-BV)   TO PV-DKEY              23270000
                   PERFORM 5850-SELECT-BRAND-INFO                       23280000
                   MOVE VSCHVL-CHARTC-VAL-DESC TO ML-DTL-BRAND-NAME     23290000
RPT2                                              DA111-BRAND-NAME-DTL  23300000
                   MOVE IMT00000-LBL-SEQ-NBR   TO                       23310000
                                               ML-LBL-SEQ-NBR(SS-ML-BV) 23320000
                                               ML-LBL-SEQ-NBR-DTL       23330000
                   MOVE ML-LBL-SEQ-NBR-DTL     TO ML-DTL-LBL-SEQ        23340000
                                                  DA111-LBL-SEQ-NBR-DTL 23350000
               END-IF.                                                  23360000
                                                                        23370000
RPT2           MOVE PV-FSCL-WK-END-DTE TO DA111-FSCL-WK-DTL             23380000
      *                                                                 23390000
      *        CONVERT ALLOCATION METHOD TO A DESCRIPTIVE COMMENT       23400000
               PERFORM 3700-GET-ALLOCATION-VERBIAGE                     23410000
RPT2           MOVE PC-BRAND-ALLOCATION-VERBIAGE                        23420000
                                          TO DA111-ALLOCATION-METHOD    23430000
      *                                                                 23440000
      *        REPORT ON ESTIMATED ML ALLOCATION OF DA DOLLARS          23450000
      *        USE DA VALUES FROM 3600-CALC-BRAND-DOLLARS.              23460000
               MOVE ML-DA-PCT(SS-ML-BV)   TO  ML-DA-PCT-DTL.            23470000
               MOVE ML-DA-PCT-DTL         TO  ML-DTL-BRAND-PCT          23480000
RPT2                                          DA111-BRAND-PCT-NEW.      23490000
      *                                                                 23500000
      *        DA VALUES FROM 3600-CALC-BRAND-DOLLARS.                  23510000
      *         PV-DA-RTL-AMT-TOTAL                                     23520000
      *         PV-DA-CST-AMT-TOTAL                                     23530000
RPT2           COMPUTE PV-DA-COST-TEMP ROUNDED =                        23540000
                  (PV-DA-CST-AMT-TOTAL * ML-DA-PCT(SS-ML-BV) / 100 )    23550000
                                                                        23560000
RPT2           COMPUTE PV-DA-RTL-TEMP ROUNDED  =                        23570000
                  (PV-DA-RTL-AMT-TOTAL * ML-DA-PCT(SS-ML-BV) / 100 )    23580000
                                                                        23590000
RPT2           MOVE PV-DA-RTL-TEMP    TO  DA111-EIRRTL-APPLIED-DTL      23600000
RPT2           MOVE PV-DA-COST-TEMP   TO  DA111-EIRCOST-APPLIED-DTL     23610000
      *                                                                 23620000
           WRITE DETAIL-REPORT-REC FROM DETAIL-RECORD                   23630000
               AFTER ADVANCING PV-ADVANCE.                              23640000
           ADD PV-ADVANCE TO PV-LINE-COUNT.                             23650000
                                                                        23660000
           WRITE DETAIL-REPORT-REC2 FROM DA111-DETAIL                   23670000
               AFTER ADVANCING PV-ADVANCE.                              23680000
           ADD PV-ADVANCE TO PV-LINE-COUNT.                             23690000
                                                                        23700000
                                                                        23710000
      *----------------------------------------------------------------*23720000
      *    READ DA TRANSACTION PROCESS FILE                             23730000
      *----------------------------------------------------------------*23740000
       9000-READ-DA-FILE.                                               23750000
                                                                        23760000
           READ IN-DA-FILE INTO DARD100-RECORD                          23770000
              AT END                                                    23780000
                 SET PS-NO-MORE-DA-TRANS-LEFT TO TRUE.                  23790000
                                                                        23800000
      *----------------------------------------------------------------*23810000
      *    READ WEEKLY DATE FILE                                        23820000
      *----------------------------------------------------------------*23830000
       9100-READ-WKLY-DTE-FILE.                                         23840000
                                                                        23850000
           READ WKLY-DTE-FILE INTO DARD104-RECORD                       23860000
              AT END                                                    23870000
                   SET PS-EMPTY-DATE-FILE TO TRUE.                      23880000
      *                                                                 23890000
           IF PS-EMPTY-DATE-FILE                                        23900000
               DISPLAY 'EMPTY DATES FILE ',                             23910000
           ELSE                                                         23920000
               DISPLAY 'PROCESS DATES: ',                               23930000
                      '  YEAR: ', DA104-OPN-FSCL-YR-NBR,                23940000
                      ' MONTH: ', DA104-OPN-FSCL-MN-DTE,                23950000
                      '  WEEK: ', DA104-OPN-FSCL-WK-DTE                 23960000
           END-IF.                                                      23970000
                                                                        23980000
      ******************************************************************23990000
      * 9200-READ-EXCLSV-BRND-LIST.                                     24000000
      * THE ROUTINE READS IN A CONTROL FILE OF DEFAULT BRANDS ASSIGNED  24010000
      * TO SPECIFIC DEPT / SCL COMBINATIONS REGARDLESS OF ML / VENDOR   24020000
      ******************************************************************24030000
       9200-READ-EXCLSV-BRND-LIST.                                      24040000
                                                                        24050000
           READ EXCLUSIVE-BRND-FILE INTO EXCLUSIVE-DEFAULT-ASSIGNMENT   24060000
              AT END                                                    24070000
                 SET PS-END-OF-EXCL-BRAND-FILE TO TRUE.                 24080000
                                                                        24090000
      ******************************************************************24100000
      * 9300-READ-ORACLE-SRC-CTL.                                       24110000
      *     THE ROUTINE READS IN THE ORACLE SOURCE CONTROL CARD DACC010.24120000
      * THE CARD DEFINES WHICH ORACLE ENVIRONMENT WE ARE PROCESSING     24130000
      * FROM.                                                           24140000
      ******************************************************************24150000
      *9300-READ-ORACLE-SRC-CTL.                                        24160000
      *                                                                 24170000
      *    READ IN-ORACLE-SRC-CTL NEXT                                  24180000
      *        AT END  MOVE 'Y'     TO PS-INP03-DONE-SW.                24190000
      *----------------------------------------------------------------*24200000
      * 9000-READ-ORACLE-SRC-CTL.                                       24210000
      *----------------------------------------------------------------*24220000
       9900-EOJ-LOGIC.                                                  24230000
     **    PERFORM 1300-CLOSE-TDAALW-CURSOR.                            24240000
                                                                        24250000
           CLOSE IN-DA-FILE                                             24260000
                 WKLY-DTE-FILE                                          24270000
      *          IN-ORACLE-SRC-CTL                                      24280000
                 EXCLUSIVE-BRND-FILE                                    24290000
                 DA-REPORT-FILE.                                        24300000
                                                                        24310000
           DISPLAY 'RECORDS READ    ' PA-RECORDS-READ.                  24320000
           DISPLAY 'RECORDS WRITTEN ' PA-RECORDS-WRITTEN.               24330000
           DISPLAY '**------ END MLKUT006 ------**'.                    24340000
                                                                        24350000
       9999-ABEND.                                                      24360000
                                                                        24370000
           CALL 'ILBOABN0'             USING PV-ABEND-CODE.             24380000
                                                                        24390000
       9999-SQL-ERROR.                                                  24400000
                                                                        24410000
           MOVE SQLCODE    TO SQLCODE2.                                 24420000
           MOVE SQLERRD(3) TO SQLERRD3.                                 24430000
           DISPLAY '** ABEND **       ** = SQLERROR'.                   24440000
           DISPLAY '** PROGRAM        ** = MLKUT006'.                   24450000
           DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  24460000
           DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  24470000
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   24480000
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  24490000
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                24500000
                                                                        24510000
      *    MOVE SPACES TO WS-MSG-TEXT.                                  24520000
      *    GET FULL TEXT OF ERROR MESSAGE                               24530000
                                                                        24540000
      *    CALL 'SQLGLM' USING WS-MSG-TEXT,                             24550000
      *                        WS-MAX-SIZE,                             24560000
      *                        WS-MSG-LENGTH.                           24570000
      *    DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.               24580000
                                                                        24590000
           MOVE +4013 TO PV-ABEND-CODE.                                 24600000
           CALL 'ILBOABN0' USING PV-ABEND-CODE.                         24610000
                                                                        24620000
      *---------------------------------------------------------------* 24630000
      *    END OF SOURCE CODE FOR MLKUT006                            * 24640000
      *---------------------------------------------------------------* 24650000
