       IDENTIFICATION DIVISION.                                         00020000
       PROGRAM-ID.    TFKCS431.                                         00040000
       AUTHOR.        JACK KRAMER.                                      00050000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
       DATE-WRITTEN.  SEPTEMBER 1996.                                   00070000
       DATE-COMPILED.                                                   00080000
      *---------------------------------------------------------------* 00100000
      *    P431 - TRANSFER ITEM INQUIRY                               * 00110000
      *                                                               * 00120000
      *    THIS PROGRAM GENERATES A TRANSFER LINE ITEM DETAIL LIST.   * 00130000
      *    IT USES MULTIPLE MAPS; ONE DISPLAYS INFORMATION FOR        * 00140000
      *    NON-RETAIL TRANSFERS, THE OTHER FOR RETAIL TRANSFERS. BOTH * 00150000
      *    MAPS DEFINE THE ENTIRE 19 LINES OF THE SCREEN, SO THERE IS * 00160000
      *    NO NEED TO SEND MULTIPLE MAPS, IT'S ONE OR THE OTHER.      * 00170000
      *                                                               * 00180000
      *---------------------------------------------------------------* 00190000
      *  1/20/2003 - RAY GRAF                                           00200000
      *   PROCESS NONINTELLIGENT SKU.                                   00210000
      ******************************************************************00220000
080204**DATE:08/02/2004 CHANGED BY: RAY GRAF                            00230000
080204**     CHANGE PRINTER DESTINATION TO NEW 8 CHARACTER FORMAT       00231000
      ***************************************************************** 00232000
100404**DATE:10/04/0404 CHANGED BY: RAY GRAF                            00233000
100404**     EXPAND STORE LOCATION.  MAKE DOMAIN COMPLIANT.             00234000
      ***************************************************************** 00235000
033005**DATE:03/30/2005 CHANGED BY: RAY GRAF                            00236000
033005**     INCLUDE DEF/DAMAGE - SORT 1 AS RETAIL TYPE TRANSFER        00237000
      ***************************************************************** 00238000
SR3403**DATE:02/29/2012 CHANGED BY: TEJA KARWEER                        00239000
SR3403**     LARGE RETAIL AMOUNT FIELD EXPANSION                        00239100
SR3403***************************************************************** 00239200
      * DATE:        09/24/2021                                         00239399
      * WR/IR#:      CHG0261678                                         00239499
      * PROGRAMMER:  GERMAN BANDA                                       00239599
      * DESCRIPTION: CHANGE CALL OF DPKUT100 TO                         00239699
      *              CALL DP010I-NUMERIC-EDIT-ROUTINE                   00239799
      *              MAKING THE CALL DYNAMIC VS STATIC                  00239899
      *----------------------------------------------------------------*00239999
CICS  * CHANGED 11/17/2022    BY JIM HUNTER      WR: CHG0278345         00240099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00241099
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00242099
CICS  *-----------------------------------------------------------------00243099
       ENVIRONMENT DIVISION.                                            00250000
       DATA DIVISION.                                                   00260000
       WORKING-STORAGE SECTION.                                         00280000
                                                                        00290000
       01  DK-DB2-KEYS.                                                 00300000
           05  DK-STORE-NBR             PIC S9(04)  COMP  VALUE +0.     00310000
           05  DK-XFER-SEQ-NBR          PIC S9(09)  COMP  VALUE +0.     00320000
           05  DK-XFER-DKEY-ID          PIC S9(09)  COMP  VALUE +0.     00330000
       01  PC-PROGRAM-CONSTANTS.                                        00340000
           05  PC-099                   PIC  9(03)  VALUE 099.          00350000
           05  PC-100                   PIC  9(03)  VALUE 100.          00360000
           05  PC-POSITIVE-RECEIPT      PIC  X(02)  VALUE 'PR'.         00370000
           05  PC-ASSUMPTIVE-RECEIPT    PIC  X(02)  VALUE 'AR'.         00380000
           05  PC-VOIDED                PIC  X(02)  VALUE 'VD'.         00390000
           05  PC-OFFSITE-STORAGE       PIC  X(02)  VALUE '07'.         00400000
           05  PC-INTER-APPL-CODES.                                     00410000
               10  PC-INTER-APPL-CRIT-SPEC                              00420000
                                              PIC  X(01)  VALUE '1'.    00430000
               10  PC-INTER-APPL-LIST         PIC  X(01)  VALUE '2'.    00440000
               10  PC-INTER-APPL-HDR-INQ      PIC  X(01)  VALUE '3'.    00450000
               10  PC-INTER-APPL-DSCRP        PIC  X(01)  VALUE '4'.    00460000
           05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00470000
                                                          'TFKM431 '.   00480000
           05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00490000
                                                          'TFKCS431'.   00500000
           05  PC-RETAIL-ITEM-MAP-NAME        PIC  X(08)  VALUE         00510000
                                                          'TF431A'.     00520000
           05  PC-NON-RETAIL-ITEM-MAP-NAME    PIC  X(08)  VALUE         00530000
                                                          'TF431B'.     00540000
           05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00550000
           05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 3.      00560000
           05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15     00570000
                                                          COMP SYNC.    00580000
           05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00590000
                                                          COMP SYNC.    00600000
           05 PC-INIT                   PIC  X(04)  VALUE 'INIT'.       00610000
           05 PC-PUT                    PIC  X(04)  VALUE 'PUT'.        00620000
           05 PC-TERM                   PIC  X(04)  VALUE 'TERM'.       00630000
           05 PC-TOP-OF-PAGE            PIC  X(01)  VALUE '1'.          00640000
           05 PC-SINGLE-SPACE           PIC  X(01)  VALUE ' '.          00650000
           05 PC-DOUBLE-SPACE           PIC  X(01)  VALUE '0'.          00660000
           05  PC-ZERO                        PIC S9(04)  VALUE +0      00670000
                                                          COMP.         00680000
           05  PC-LINE-MAX                    PIC S9(02)  VALUE +60     00690000
                                                          COMP-3.       00700000
           05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00710000
                                                          +1000000      00720000
                                                          COMP-3.       00730000
           05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00740000
                                                          COMP-3.       00750000
           05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00760000
           05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00770000
           05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00780000
           05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00790000
      *                                                                 00800000
           05  PC-TSYMSG-NUMBERS.                                       00810000
               10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00820000
               10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00830000
               10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00840000
               10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00850000
               10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00860000
               10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00870000
               10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00880000
               10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00890000
               10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00900000
               10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00910000
               10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00920000
               10  PC-TSYMSG-00098            PIC  9(05)  VALUE 00098.  00930000
               10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00940000
               10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00950000
               10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00960000
               10  PC-TSYMSG-01271            PIC  9(05)  VALUE 01271.  00970000
               10  PC-TSYMSG-01399            PIC  9(05)  VALUE 01399.  00980000
               10  PC-TSYMSG-01400            PIC  9(05)  VALUE 01400.  00990000
               10  PC-TSYMSG-01406            PIC  9(05)  VALUE 01406.  01000000
               10  PC-TSYMSG-01414            PIC  9(05)  VALUE 01414.  01010000
               10  PC-TSYMSG-01416            PIC  9(05)  VALUE 01416.  01020000
               10  PC-TSYMSG-01572            PIC  9(05)  VALUE 01572.  01030000
               10  PC-TSYMSG-01581            PIC  9(05)  VALUE 01581.  01040000
               10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01050000
      *                                                                 01060000
       01  PS-PROGRAM-SWITCHES.                                         01070000
           05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01080000
               88  PS-NO-ERROR                            VALUE 'Y'.    01090000
               88  PS-ERROR                               VALUE 'N'.    01100000
           05  PS-SELECTED-ITEM-FOUND-SW      PIC  X(01)  VALUE 'Y'.    01110000
               88  PS-SELECTED-ITEM-FOUND                 VALUE 'Y'.    01120000
               88  PS-SELECTED-ITEM-NOT-FOUND             VALUE 'N'.    01130000
           05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01140000
               88  PS-COMMAREA-VALID                      VALUE 'Y'.    01150000
               88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01160000
           05  PS-TRANSFER-FOUND-SW     PIC X.                          01170000
               88  PS-TRANSFER-FOUND             VALUE 'Y'.             01180000
               88  PS-TRANSFER-NOT-FOUND         VALUE 'N'.             01190000
           05  PS-FIRST-LINE-SW               PIC  X(01)  VALUE 'N'.    01200000
               88  PS-FIRST-LINE                          VALUE 'Y'.    01210000
               88  PS-NOT-FIRST-LINE                      VALUE 'N'.    01220000
           05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.   01230000
               88  PS-LIST-END                             VALUE 'Y'.   01240000
               88  PS-NO-LIST-END                          VALUE 'N'.   01250000
      *                                                                 01260000
       01  PV-PROGRAM-VARIABLES.                                        01270000
           05  PV-LINE-COUNT                  PIC  S9(03)  VALUE +0.    01280000
           05  PV-PAGE-COUNT                  PIC  S9(03)  VALUE +0.    01290000
           05  PV-CURRENT-MAP-NAME            PIC  X(08)  VALUE         01300000
                                                          'TF431A'.     01310000
           05  PV-DPT-CL-SUBCL.                                         01350000
               10  PV-DEPT                    PIC 999.                  01360000
               10  FILLER                     PIC X(01)   VALUE SPACE.  01370000
               10  PV-GROUP-1.                                          01380000
                   15 PV-CLASS-1              PIC 99      VALUE ZEROS.  01390000
                   15 FILLER                  PIC X(01)   VALUE SPACE.  01400000
                   15 PV-SUBCLASS-1           PIC 99      VALUE ZEROS.  01410000
                   15 FILLER                  PIC X(02)   VALUE SPACE.  01420000
               10  PV-GROUP-2 REDEFINES PV-GROUP-1.                     01430000
                   15 PV-CLASS-2              PIC  99.                  01440000
                   15 PV-FILLER-2A            PIC  X(01).               01450000
                   15 PV-SUBCLASS-2           PIC  999.                 01460000
                   15 PV-FILLER-2B            PIC  X(01).               01470000
               10  PV-GROUP-3 REDEFINES PV-GROUP-1.                     01480000
                   15 PV-CLASS-3              PIC  999.                 01490000
                   15 PV-FILLER-3A            PIC  X(01).               01500000
                   15 PV-SUBCLASS-3           PIC  99.                  01510000
                   15 PV-FILLER-3B            PIC  X(01).               01520000
               10  PV-GROUP-4 REDEFINES PV-GROUP-1.                     01530000
                   15 PV-CLASS-4              PIC  999.                 01540000
                   15 PV-FILLER-4A            PIC  X(01).               01550000
                   15 PV-SUBCLASS-4           PIC  999.                 01560000
           05  PV-XFER-NBR.                                             01570000
100404*        10  PV-XFER-FROM-STORE-NBR     PIC 9(03).                01580000
100404         10  PV-XFER-FROM-STORE-NBR     PIC 9(04).                01581000
               10                             PIC X    VALUE '-'.       01590000
               10  PV-XFER-SEQ-NBR            PIC 9(06).                01600000
           05  PV-UPC                         PIC 99B99999B99999B9.     01610000
           05  FILLER REDEFINES PV-UPC.                                 01620000
               10                             PIC XX.                   01630000
               10  PV-UPC-DASH-1              PIC X.                    01640000
               10                             PIC X(05).                01650000
               10  PV-UPC-DASH-2              PIC X.                    01660000
               10                             PIC X(05).                01670000
               10  PV-UPC-DASH-3              PIC X.                    01680000
               10                             PIC X.                    01690000
           05  PV-HOLD-UPC-NBR.                                         01700000
               10  FILLER                      PIC X(03).               01710000
               10  PV-KOHLS-UPC-DIGIT          PIC X(01).               01720000
               10  FILLER                      PIC X(02).               01730000
               10  PV-KOHLS-DEPT               PIC 9(03).               01740000
               10  PV-KOHLS-CL.                                         01750000
                   15  PV-KOHLS-CL-1           PIC X(01).               01760000
                   15  PV-KOHLS-CL-2           PIC X(01).               01770000
               10  PV-KOHLS-CL-9 REDEFINES PV-KOHLS-CL                  01780000
                                               PIC 9(02).               01790000
               10  PV-KOHLS-DUMMY-SKU          PIC X(03).               01800000
               10  PV-KOHLS-CHECKDIGIT         PIC X(01).               01810000
           05  PV-HOLD-UPC-NBR-9 REDEFINES PV-HOLD-UPC-NBR              01820000
                                               PIC 9(15).               01830000
           05  PV-SUB                         PIC S9(04)  VALUE +0      01840000
                                                          COMP SYNC.    01850000
           05  PV-SAVE-SUB                    PIC S9(04)  VALUE +0      01860000
                                                          COMP SYNC.    01870000
           05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01880000
                                                          COMP SYNC.    01890000
           05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01900000
                                                          COMP-3.       01910000
           05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01920000
                                                          COMP-3.       01930000
           05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01940000
                                                          COMP-3.       01950000
           05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01960000
                                                          COMP-3.       01970000
           05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01980000
                                                          COMP-3.       01990000
           05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02000000
                                                          COMP-3.       02010000
           05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      02020000
                                                          COMP-3.       02030000
           05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02040000
                                                          COMP SYNC.    02050000
           05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02060000
                                                          COMP SYNC.    02070000
           05  PV-ITEM                        PIC S9(04)  VALUE +0      02080000
                                                          COMP SYNC.    02090000
           05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02100000
                                                          COMP SYNC.    02110000
           05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02120000
                                                          COMP SYNC.    02130000
           05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02140000
                                                          COMP SYNC.    02150000
           05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02160000
                                                          COMP SYNC.    02170000
           05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02180000
                                                          COMP SYNC.    02190000
           05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02200000
                                                          COMP SYNC.    02210000
           05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02220000
                                                          COMP SYNC.    02230000
           05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02240000
                                                          COMP SYNC.    02250000
           05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02260000
                                                          COMP SYNC.    02270000
           05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02280000
                                                          COMP SYNC.    02290000
           05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02300000
                                                          COMP SYNC.    02310000
           05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      02320000
                                                          COMP SYNC.    02330000
           05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0.     02340000
                                                                        02350000
           05  PV-ABSTIME                      PIC S9(16)  VALUE +0     02360000
                                                           COMP SYNC.   02370000
      *--- REPORT LINE DEFINITIONS FOR THE DRS REPORT                   02380000
      *                                                                 02390000
           COPY DPWS132O.                                               02400000
       01  HL2-HEADING-LINE-2.                                          02410000
           05  FILLER                          PIC  X(55)  VALUE SPACE. 02420000
           05  FILLER                          PIC  X(30)  VALUE        02430000
               'TRANSFER ITEM INQUIRY'.                                 02440000
      *                                                                 02450000
       01  HL3-HEADING-LINE-3.                                          02460000
           05  FILLER                          PIC  X(02)  VALUE SPACE. 02470000
           05  FILLER                          PIC  X(17)  VALUE        02480000
                'TRANSFER NO....:'.                                     02490000
100404*    05  HL3-XFER-NBR                    PIC  999B999999.         02500000
100404     05  HL3-XFER-NBR                    PIC  9999B999999.        02501000
           05  FILLER REDEFINES HL3-XFER-NBR.                           02510000
100404*        10                              PIC X(03).               02520000
100404         10                              PIC X(04).               02521000
               10  HL3-XFER-NBR-DASH           PIC X.                   02530000
               10                              PIC X(06).               02540000
       01  HL4-HEADING-LINE-4.                                          02550000
           05  FILLER                          PIC  X(02)  VALUE SPACE. 02560000
           05  FILLER                          PIC  X(17)  VALUE        02570000
                'TRANSFER STATUS:'.                                     02580000
           05  HL4-XFER-STATUS                 PIC  X(20).              02590000
       01  HL5A-HEADING-LINE-5A.                                        02600000
SR3403     05  FILLER                          PIC  X(45)  VALUE SPACE. 02610099
SR3403     05  FILLER                          PIC  X(16)  VALUE        02620099
             '--TRANSFER--'.                                            02630000
SR3403     05  FILLER                          PIC  X(19)  VALUE        02640099
             '--RECEIVED--'.                                            02650000
           05  FILLER                          PIC  X(05)  VALUE 'FILE'.02660000
       01  HL5B-HEADING-LINE-5B.                                        02670000
           05  FILLER                          PIC  X(55)  VALUE SPACE. 02680000
           05  FILLER                          PIC  X(07)  VALUE        02690000
             'TRN REC'.                                                 02700000
       01  HL6A-HEADING-LINE-6A.                                        02710000
           05  FILLER                          PIC  X(09)  VALUE SPACE. 02720000
           05  FILLER                          PIC  X(05)  VALUE 'LN'.  02730000
           05  FILLER                          PIC  X(14)  VALUE        02740000
             'D/M/S'.                                                   02750000
           05  FILLER                          PIC  X(16)  VALUE 'UPC'. 02760000
SR3403     05  FILLER                          PIC  X(16)  VALUE        02770099
SR3403       'QTY     PRICE'.                                           02780099
SR3403     05  FILLER                          PIC  X(19)  VALUE        02790099
SR3403       'QTY     PRICE'.                                           02800099
           05  FILLER                          PIC  X(10)  VALUE        02810000
             'PRICE'.                                                   02820000
       01  HL6B-HEADING-LINE-6B.                                        02830000
           05  FILLER                          PIC  X(09)  VALUE SPACE. 02840000
           05  FILLER                          PIC  X(05)  VALUE 'LN'.  02850000
           05  FILLER                          PIC  X(41)  VALUE        02860000
             'LN ITEM DESCRIPTION'.                                     02870000
           05  FILLER                          PIC  X(10)  VALUE        02880000
             'QTY QTY'.                                                 02890000
       01  DL1A-DETAIL-LINE-1A.                                         02900000
           05  FILLER                          PIC  X(04)  VALUE SPACE. 02910000
           05  DL1A-ACTION                     PIC  X(03)  VALUE SPACE. 02920000
           05  FILLER                          PIC  X(01)  VALUE SPACE. 02930000
           05  DL1A-LINE                       PIC  ZZ9.                02940000
           05  FILLER                          PIC  X(03)  VALUE SPACE. 02950000
      *************************************************************     02960000
           05  DL1A-DPT-CL-SUBCL.                                       02970000
               10  DL1A-DEPT                  PIC 999.                  02980000
               10  FILLER                     PIC X(01)   VALUE SPACE.  02990000
               10  DL1A-GROUP-1.                                        03000000
                   15 DL1A-CLASS-1            PIC 99      VALUE ZEROS.  03010000
                   15 FILLER                  PIC X(01)   VALUE SPACE.  03020000
                   15 DL1A-SUBCLASS-1         PIC 99      VALUE ZEROS.  03030000
                   15 FILLER                  PIC X(02)   VALUE SPACE.  03040000
               10  DL1A-GROUP-2 REDEFINES DL1A-GROUP-1.                 03050000
                   15 DL1A-CLASS-2            PIC  99.                  03060000
                   15 DL1A-FILLER-2A          PIC  X(01).               03070000
                   15 DL1A-SUBCLASS-2         PIC  999.                 03080000
                   15 DL1A-FILLER-2B          PIC  X(01).               03090000
               10  DL1A-GROUP-3 REDEFINES DL1A-GROUP-1.                 03100000
                   15 DL1A-CLASS-3            PIC  999.                 03110000
                   15 DL1A-FILLER-3A          PIC  X(01).               03120000
                   15 DL1A-SUBCLASS-3         PIC  99.                  03130000
                   15 DL1A-FILLER-3B          PIC  X(01).               03140000
               10  DL1A-GROUP-4 REDEFINES DL1A-GROUP-1.                 03150000
                   15 DL1A-CLASS-4            PIC  999.                 03160000
                   15 DL1A-FILLER-4A          PIC  X(01).               03170000
                   15 DL1A-SUBCLASS-4         PIC  999.                 03180000
      *************************************************************     03190000
           05  FILLER                          PIC  X(02)  VALUE SPACE. 03200000
           05  DL1A-UPC                        PIC  99B99999B99999B9.   03210000
           05  FILLER REDEFINES DL1A-UPC.                               03220000
               10                              PIC X(02).               03230000
               10  DL1A-UPC-DASH-1             PIC X.                   03240000
               10                              PIC X(05).               03250000
               10  DL1A-UPC-DASH-2             PIC X.                   03260000
               10                              PIC X(05).               03270000
               10  DL1A-UPC-DASH-3             PIC X.                   03280000
               10                              PIC X(01).               03290000
           05  FILLER                          PIC  X(01)  VALUE SPACE. 03300000
           05  DL1A-TQTY                       PIC  ZZ9.                03310000
           05  FILLER                          PIC  X(02)  VALUE SPACE. 03320000
SR3403     05  DL1A-TPRICE                     PIC  ZZZZZ.99.           03331000
           05  FILLER                          PIC  X(03)  VALUE SPACE. 03340000
           05  DL1A-RQTY                       PIC  ZZ9.                03350000
           05  FILLER                          PIC  X(02)  VALUE SPACE. 03360000
SR3403     05  DL1A-RPRICE                     PIC  ZZZZZ.99.           03371000
           05  FILLER                          PIC  X(03)  VALUE SPACE. 03380000
SR3403     05  DL1A-FPRICE                     PIC  ZZZZZ.99.           03391000
           05  FILLER                          PIC  X(03)  VALUE SPACE. 03400000
       01  DL1B-DETAIL-LINE-1B.                                         03410000
           05  FILLER                          PIC  X(04)  VALUE SPACE. 03420000
           05  DL1B-ACTION                     PIC  X(03)  VALUE SPACE. 03430000
           05  FILLER                          PIC  X(01)  VALUE SPACE. 03440000
           05  DL1B-LINE                       PIC  ZZ9.                03450000
           05  FILLER                          PIC  X(03)  VALUE SPACE. 03460000
           05  DL1B-DESCRIPTION                PIC  X(40)  VALUE SPACE. 03470000
           05  FILLER                          PIC  X(01)  VALUE SPACE. 03480000
           05  DL1B-TQTY                       PIC  ZZ9.                03490000
           05  FILLER                          PIC  X(01)  VALUE SPACE. 03500000
           05  DL1B-RQTY                       PIC  ZZ9.                03510000
       01  BL-BLANK-LINE.                                               03520000
           05  FILLER                          PIC  X(80)  VALUE SPACE. 03530000
      ******************************************************************03540000
      **  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **03550000
      **  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **03560000
      **  APPLICATION-SPECIFIC COMMAREA.                              **03570000
      ******************************************************************03580000
       01  LQW-LIST-QUEUE-WORK-AREA.                                    03590000
               10  LQW-BLOCK-MODIFIED-SW           PIC  X(01).          03600000
                   88  LQW-BLOCK-NOT-MODIFIED      VALUE 'N'.           03610000
                   88  LQW-BLOCK-MODIFIED          VALUE 'Y'.           03620000
               10  LQW-ITEM-ARRAY.                                      03630000
                   15  LQW-ITEM-ENTRIES OCCURS 15 TIMES                 03640000
                                              INDEXED BY LQW-IDX.       03650000
                       20  LQW-LIST-ITEM-NUMBER                         03660000
                                                           PIC S9(09)   03670000
                                                           COMP-3.      03680000
                       20  LQW-TEMP-SELECTED-SW    PIC  X(01).          03690000
                           88  LQW-VALID-SELECT    VALUE ' '            03700000
                                                         'S'.           03710000
                           88  LQW-TEMP-NO-SELECT  VALUE ' '.           03720000
                           88  LQW-TEMP-SELECT     VALUE 'S'.           03730000
                       20  LQW-SELECTED-SW         PIC  X(01).          03740000
                           88  LQW-DESELECT        VALUE ' '.           03750000
                           88  LQW-SELECT          VALUE 'S'.           03760000
                       20  LQW-ACTION              PIC  X(03).          03770000
                       20  LQW-LINE                PIC  9(03).          03780000
                       20  LQW-DPT-CL-SUBCL.                            03790000
                           25  LQW-DEPT            PIC 9(03).           03800000
                           25  LQW-CLASS           PIC 9(03).           03810000
                           25  LQW-SUBCLASS        PIC 9(03).           03820000
                       20  LQW-UPC                 PIC S9(13)  COMP-3.  03830000
                       20  LQW-XFER-QTY            PIC 9(05)   COMP-3.  03840000
                       20  LQW-RECV-QTY            PIC 9(05)   COMP-3.  03850000
SR3403                 20  LQW-XFER-PRICE          PIC 9(05)V99 COMP-3. 03861000
SR3403                 20  LQW-RECV-PRICE          PIC 9(05)V99 COMP-3. 03871000
SR3403                 20  LQW-FILE-PRICE          PIC 9(05)V99 COMP-3. 03881000
                       20  LQW-DESCRIPTION.                             03890000
                           25  LQW-DESCRIPTION-1   PIC X(20).           03900000
                           25  LQW-DESCRIPTION-2   PIC X(20).           03910000
                                                                        03920000
           EJECT                                                        03930000
      *---------------------------------------------------------------* 03940000
      *    MAP LAYOUT                                                 * 03950000
      *---------------------------------------------------------------* 03960000
      *                                                                 03970000
       01  MD-MAP-DATA-AREA                      PIC X(2000).           03980000
       01  MR-MAP-REDEFINITION  REDEFINES MD-MAP-DATA-AREA.             03990000
           05  MR-A-RETAIL.                                             04000000
               10 FILLER                      PIC X(12).                04010000
      *                                                                 04020000
               10 MR-A-STARTL                 PIC S9(04) COMP.          04030000
               10 MR-A-STARTA                 PIC  X(01).               04040000
               10 MR-A-STARTC                 PIC  X(01).               04050000
               10 MR-A-STARTH                 PIC  X(01).               04060000
               10 MR-A-START                  PIC 9(05).                04070000
      *                                                                 04080000
               10 MR-A-ENDL                   PIC S9(04) COMP.          04090000
               10 MR-A-ENDA                   PIC  X(01).               04100000
               10 MR-A-ENDC                   PIC  X(01).               04110000
               10 MR-A-ENDH                   PIC  X(01).               04120000
               10 MR-A-END                    PIC 9(05).                04130000
      *                                                                 04140000
               10 MR-A-TOTALL                 PIC S9(04) COMP.          04150000
               10 MR-A-TOTALA                 PIC  X(01).               04160000
               10 MR-A-TOTALC                 PIC  X(01).               04170000
               10 MR-A-TOTALH                 PIC  X(01).               04180000
               10 MR-A-TOTAL                  PIC 9(05).                04190000
      *                                                                 04200000
               10 MR-A-XFER-NBRL              PIC S9(04) COMP.          04210000
               10 MR-A-XFER-NBRA              PIC  X(01).               04220000
               10 MR-A-XFER-NBRC              PIC  X(01).               04230000
               10 MR-A-XFER-NBRH              PIC  X(01).               04240000
100404*        10 MR-A-XFER-NBR               PIC X(10).                04250000
100404         10 MR-A-XFER-NBR               PIC X(11).                04251000
      *                                                                 04260000
               10 MR-A-STATUS-CODEL           PIC S9(04) COMP.          04270000
               10 MR-A-STATUS-CODEA           PIC  X(01).               04280000
               10 MR-A-STATUS-CODEC           PIC  X(01).               04290000
               10 MR-A-STATUS-CODEH           PIC  X(01).               04300000
               10 MR-A-STATUS-CODE            PIC X(02).                04310000
      *                                                                 04320000
               10 MR-A-STATUS-DESCL           PIC S9(04) COMP.          04330000
               10 MR-A-STATUS-DESCA           PIC  X(01).               04340000
               10 MR-A-STATUS-DESCC           PIC  X(01).               04350000
               10 MR-A-STATUS-DESCH           PIC  X(01).               04360000
               10 MR-A-STATUS-DESC            PIC X(20).                04370000
      *                                                                 04380000
               10 MR-A-SCROLL-AREA            OCCURS 15 TIMES.          04390000
                   15 MR-A-SELECTL            PIC S9(04) COMP.          04400000
                   15 MR-A-SELECTA            PIC  X(01).               04410000
                   15 MR-A-SELECTC            PIC  X(01).               04420000
                   15 MR-A-SELECTH            PIC  X(01).               04430000
                   15 MR-A-SELECT             PIC  X(01).               04440000
                                                                        04450000
                   15 MR-A-ACTIONL            PIC S9(04) COMP.          04460000
                   15 MR-A-ACTIONA            PIC  X(01).               04470000
                   15 MR-A-ACTIONC            PIC  X(01).               04480000
                   15 MR-A-ACTIONH            PIC  X(01).               04490000
                   15 MR-A-ACTION             PIC  X(03).               04500000
                                                                        04510000
                   15 MR-A-LINE-NBRL          PIC S9(04) COMP.          04520000
                   15 MR-A-LINE-NBRA          PIC  X(01).               04530000
                   15 MR-A-LINE-NBRC          PIC  X(01).               04540000
                   15 MR-A-LINE-NBRH          PIC  X(01).               04550000
                   15 MR-A-LINE-NBR-X.                                  04560000
                       20  MR-A-LINE-NBR PIC ZZ9.                       04570000
                                                                        04580000
                   15 MR-A-DPT-CL-SUBCLL      PIC S9(04) COMP.          04590000
                   15 MR-A-DPT-CL-SUBCLA      PIC  X(01).               04600000
                   15 MR-A-DPT-CL-SUBCLC      PIC  X(01).               04610000
                   15 MR-A-DPT-CL-SUBCLH      PIC  X(01).               04620000
                   15 MR-A-DPT-CL-SUBCL       PIC  X(11).               04630000
                                                                        04640000
                   15 MR-A-UPCL               PIC S9(04) COMP.          04650000
                   15 MR-A-UPCA               PIC  X(01).               04660000
                   15 MR-A-UPCC               PIC  X(01).               04670000
                   15 MR-A-UPCH               PIC  X(01).               04680000
                   15 MR-A-UPC                PIC  X(16).               04690000
                                                                        04700000
                   15 MR-A-TQTYL              PIC S9(04) COMP.          04710000
                   15 MR-A-TQTYA              PIC  X(01).               04720000
                   15 MR-A-TQTYC              PIC  X(01).               04730000
                   15 MR-A-TQTYH              PIC  X(01).               04740000
                   15 MR-A-TQTY-X.                                      04750000
                       20 MR-A-TQTY           PIC  ZZZ.                 04760000
                                                                        04770000
                   15 MR-A-TPRICEL            PIC S9(04) COMP.          04780000
                   15 MR-A-TPRICEA            PIC  X(01).               04790000
                   15 MR-A-TPRICEC            PIC  X(01).               04800000
                   15 MR-A-TPRICEH            PIC  X(01).               04810000
                   15 MR-A-TPRICE-X.                                    04820000
SR3403                 20 MR-A-TPRICE         PIC  ZZZZZ.ZZ.            04831000
                                                                        04840000
                   15 MR-A-RQTYL              PIC S9(04) COMP.          04850000
                   15 MR-A-RQTYA              PIC  X(01).               04860000
                   15 MR-A-RQTYC              PIC  X(01).               04870000
                   15 MR-A-RQTYH              PIC  X(01).               04880000
                   15 MR-A-RQTY-X.                                      04890000
                       20 MR-A-RQTY           PIC  ZZZ.                 04900000
                                                                        04910000
                   15 MR-A-RPRICEL            PIC S9(04) COMP.          04920000
                   15 MR-A-RPRICEA            PIC  X(01).               04930000
                   15 MR-A-RPRICEC            PIC  X(01).               04940000
                   15 MR-A-RPRICEH            PIC  X(01).               04950000
                   15 MR-A-RPRICE-X.                                    04960000
SR3403                 20 MR-A-RPRICE         PIC  ZZZZZ.ZZ.            04971000
                                                                        04980000
                   15 MR-A-FPRICEL            PIC S9(04) COMP.          04990000
                   15 MR-A-FPRICEA            PIC  X(01).               05000000
                   15 MR-A-FPRICEC            PIC  X(01).               05010000
                   15 MR-A-FPRICEH            PIC  X(01).               05020000
                   15 MR-A-FPRICE-X.                                    05030000
SR3403                 20 MR-A-FPRICE         PIC  ZZZZZ.ZZ.            05041000
           05  MR-B-NON-RETAIL  REDEFINES MR-A-RETAIL.                  05050000
               10 FILLER                      PIC X(12).                05060000
      *                                                                 05070000
               10 MR-B-STARTL                 PIC S9(04) COMP.          05080000
               10 MR-B-STARTA                 PIC  X(01).               05090000
               10 MR-B-STARTC                 PIC  X(01).               05100000
               10 MR-B-STARTH                 PIC  X(01).               05110000
               10 MR-B-START                  PIC 9(05).                05120000
      *                                                                 05130000
               10 MR-B-ENDL                   PIC S9(04) COMP.          05140000
               10 MR-B-ENDA                   PIC  X(01).               05150000
               10 MR-B-ENDC                   PIC  X(01).               05160000
               10 MR-B-ENDH                   PIC  X(01).               05170000
               10 MR-B-END                    PIC 9(05).                05180000
      *                                                                 05190000
               10 MR-B-TOTALL                 PIC S9(04) COMP.          05200000
               10 MR-B-TOTALA                 PIC  X(01).               05210000
               10 MR-B-TOTALC                 PIC  X(01).               05220000
               10 MR-B-TOTALH                 PIC  X(01).               05230000
               10 MR-B-TOTAL                  PIC 9(05).                05240000
      *                                                                 05250000
               10 MR-B-XFER-NBRL              PIC S9(04) COMP.          05260000
               10 MR-B-XFER-NBRA              PIC  X(01).               05270000
               10 MR-B-XFER-NBRC              PIC  X(01).               05280000
               10 MR-B-XFER-NBRH              PIC  X(01).               05290000
100404*        10 MR-B-XFER-NBR               PIC X(10).                05300000
100404         10 MR-B-XFER-NBR               PIC X(11).                05301000
      *                                                                 05310000
               10 MR-B-STATUS-CODEL           PIC S9(04) COMP.          05320000
               10 MR-B-STATUS-CODEA           PIC  X(01).               05330000
               10 MR-B-STATUS-CODEC           PIC  X(01).               05340000
               10 MR-B-STATUS-CODEH           PIC  X(01).               05350000
               10 MR-B-STATUS-CODE            PIC X(02).                05360000
      *                                                                 05370000
               10 MR-B-STATUS-DESCL           PIC S9(04) COMP.          05380000
               10 MR-B-STATUS-DESCA           PIC  X(01).               05390000
               10 MR-B-STATUS-DESCC           PIC  X(01).               05400000
               10 MR-B-STATUS-DESCH           PIC  X(01).               05410000
               10 MR-B-STATUS-DESC            PIC X(20).                05420000
      *                                                                 05430000
               10 MR-B-SCROLL-AREA            OCCURS 15 TIMES.          05440000
                   15 MR-B-SELECTL            PIC S9(04) COMP.          05450000
                   15 MR-B-SELECTA            PIC  X(01).               05460000
                   15 MR-B-SELECTC            PIC  X(01).               05470000
                   15 MR-B-SELECTH            PIC  X(01).               05480000
                   15 MR-B-SELECT             PIC  X(01).               05490000
                                                                        05500000
                   15 MR-B-ACTIONL            PIC S9(04) COMP.          05510000
                   15 MR-B-ACTIONA            PIC  X(01).               05520000
                   15 MR-B-ACTIONC            PIC  X(01).               05530000
                   15 MR-B-ACTIONH            PIC  X(01).               05540000
                   15 MR-B-ACTION             PIC  X(03).               05550000
                                                                        05560000
                   15 MR-B-LINE-NBRL          PIC S9(04) COMP.          05570000
                   15 MR-B-LINE-NBRA          PIC  X(01).               05580000
                   15 MR-B-LINE-NBRC          PIC  X(01).               05590000
                   15 MR-B-LINE-NBRH          PIC  X(01).               05600000
                   15 MR-B-LINE-NBR-X.                                  05610000
                       20  MR-B-LINE-NBR PIC ZZ9.                       05620000
                                                                        05630000
                   15 MR-B-DESCL              PIC S9(04) COMP.          05640000
                   15 MR-B-DESCA              PIC  X(01).               05650000
                   15 MR-B-DESCC              PIC  X(01).               05660000
                   15 MR-B-DESCH              PIC  X(01).               05670000
                   15 MR-B-DESC.                                        05680000
                       20 MR-B-DESC1          PIC  X(20).               05690000
                       20 MR-B-DESC2          PIC  X(20).               05700000
                                                                        05710000
                   15 MR-B-TQTYL              PIC S9(04) COMP.          05720000
                   15 MR-B-TQTYA              PIC  X(01).               05730000
                   15 MR-B-TQTYC              PIC  X(01).               05740000
                   15 MR-B-TQTYH              PIC  X(01).               05750000
                   15 MR-B-TQTY-X.                                      05760000
                       20 MR-B-TQTY           PIC  ZZ9.                 05770000
                                                                        05780000
                   15 MR-B-RQTYL              PIC S9(04) COMP.          05790000
                   15 MR-B-RQTYA              PIC  X(01).               05800000
                   15 MR-B-RQTYC              PIC  X(01).               05810000
                   15 MR-B-RQTYH              PIC  X(01).               05820000
                   15 MR-B-RQTY-X.                                      05830000
                       20 MR-B-RQTY           PIC  ZZ9.                 05840000
                                                                        05850000
           EJECT                                                        05860000
      *---------------------------------------------------------------* 05870000
      *    ATTRIBUTE SETTINGS COPYBOOK.                               * 05880000
      *---------------------------------------------------------------* 05890000
                                                                        05900000
           COPY DPWS015.                                                05910000
                                                                        05920000
      *---------------------------------------------------------------* 05930000
      *    FUNCTION KEYS COPYBOOK.                                    * 05940000
      *---------------------------------------------------------------* 05950000
                                                                        05960000
           COPY DPWS016.                                                05970000
                                                                        05980000
      *---------------------------------------------------------------* 05990000
      *    NUMERIC EDIT LAYOUT.                                       * 06000000
      *---------------------------------------------------------------* 06010000
                                                                        06020000
           COPY DPWS010I.                                               06030000
       EJECT                                                            06040000
      *---------------------------------------------------------------* 06050000
      *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 06060099
      *---------------------------------------------------------------* 06070000
                                                                        06080000
           COPY DPWS030.                                                06090000
CICS       COPY DPWS930.                                                06091099
       EJECT                                                            06100000
      *---------------------------------------------------------------* 06110000
      *    STANDARD COMMAREA.                                         * 06120000
      *---------------------------------------------------------------* 06130000
                                                                        06140000
           COPY DPWS020.                                                06150000
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                06160000
                                                                        06170000
      *---------------------------------------------------------------* 06180000
      * INTER-APPLICATION COMMAREA.                                   * 06190000
      *   TFWS001 - IS THE INPUT LAYOUT USED THROUGHOUT THE TRANSFER  * 06200000
      *             INQUIRY SYSTEM.                                   * 06210000
      *   TFWS003 - IS THE LAYOUT FOR THE TEMP STORAGE QUEUE.         * 06220000
      *---------------------------------------------------------------* 06230000
                                                                        06240000
               10  INTER-APPL-COMM-AREA       PIC X(200).               06250000
           COPY TFWS001.                                                06260000
           COPY TFWS003.                                                06270000
      *---------------------------------------------------------------* 06280000
      *  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 06290000
      *---------------------------------------------------------------* 06300000
               10  ASC-SPECIFIC-COMMAREA.                               06310000
                   15  ASC-INTER-APPL-CRITERIA.                         06320000
                       20  ASC-CRIT-INT-APPL-FORMAT-IND                 06330000
                                                 PIC X.                 06340000
100404*                20  ASC-CRIT-XFER-NBR-9   PIC 9(09).             06350000
100404                 20  ASC-CRIT-XFER-NBR-9   PIC 9(10).             06351000
                       20  ASC-CRIT-XFER-NBR                            06360000
                             REDEFINES ASC-CRIT-XFER-NBR-9.             06370000
100404*                    25  ASC-CRIT-XFER-FROM-STORE PIC 9(03).      06380000
100404                     25  ASC-CRIT-XFER-FROM-STORE PIC 9(04).      06381000
                           25  ASC-CRIT-XFER-SEQ-NBR    PIC 9(06).      06390000
                       20  ASC-CRIT-XFER-TYPE    PIC X(02).             06400000
                       20  ASC-CRIT-XFER-STAT    PIC X(02).             06410000
100404*                20  ASC-CRIT-XFER-FROM    PIC 9(03).             06420000
100404*                20  ASC-CRIT-XFER-TO      PIC 9(03).             06430000
100404*>               20  FILLER                PIC 9(06).             06431000
                       20  ASC-CRIT-COMP-FROM-DATE                      06440000
                                                 PIC X(08).             06450000
                       20  ASC-CRIT-COMP-TO-DATE                        06460000
                                                 PIC X(08).             06470000
                       20  ASC-CRIT-RECV-FROM-DATE                      06480000
                                                 PIC X(08).             06490000
                       20  ASC-CRIT-RECV-TO-DATE                        06500000
                                                 PIC X(08).             06510000
                       20  ASC-CRIT-DEPT         PIC 9(03) COMP-3.      06520000
                       20  ASC-CRIT-CLASS        PIC 9(03) COMP-3.      06530000
                       20  ASC-CRIT-UPC          PIC 9(13) COMP-3.      06540000
                       20  ASC-CRIT-CALLBACK-NBR PIC 9(04).             06550000
                       20  ASC-CRIT-APPROVAL-NBR PIC 9(09).             06560000
                       20  ASC-CRIT-COMP-BY-INIT PIC X.                 06570000
                       20  ASC-CRIT-COMP-BY-NM   PIC X(20).             06580000
                       20  ASC-CRIT-RECV-BY-INIT PIC X.                 06590000
                       20  ASC-CRIT-RECV-BY-NM   PIC X(20).             06600000
                       20  ASC-CRIT-DISPLAY-TOT  PIC X.                 06610000
                       20  ASC-CRIT-CRIT-SORT-ORDER.                    06620000
                           25 ASC-CRIT-TYPE-SORT-NR       PIC 9(01).    06630000
                           25 ASC-CRIT-STATUS-SORT-NR     PIC 9(01).    06640000
                           25 ASC-CRIT-FROM-STR-SORT-NR   PIC 9(01).    06650000
                           25 ASC-CRIT-TO-STR-SORT-NR     PIC 9(01).    06660000
                           25 ASC-CRIT-COMP-DTE-SORT-NR   PIC 9(01).    06670000
                           25 ASC-CRIT-RECV-DTE-SORT-NR   PIC 9(01).    06680000
                           25 ASC-CRIT-CALLBCK-NR-SORT-NR               06690000
                                                          PIC 9(01).    06700000
                           25 ASC-CRIT-APPRV-NR-SORT-NR PIC 9(01).      06710000
                           25                             PIC X(03).    06720000
                       20  ASC-CRIT-ORIG-APPL-FORMAT-IND                06730000
                                                          PIC X.        06740000
                   15  ASC-ACTION-REQUEST-SW     PIC X(01).             06750000
                       88  ASC-PRINT-DOC-REQUEST        VALUE 'D'.      06760000
                       88  ASC-PRINT-LIST-REQUEST       VALUE 'L'.      06770000
                       88  ASC-ADD-ITEM-REQUEST         VALUE 'A'.      06780000
                       88  ASC-NO-ACTION-REQUEST        VALUE 'N'.      06790000
                   15  ASC-DISCREPANCY-SW        PIC X(01).             06800000
                       88  ASC-DISCREPANCY-EXISTS       VALUE 'Y'.      06810000
                       88  ASC-NO-DISCREPANCY-EXISTS    VALUE 'N'.      06820000
                   15  ASC-LIST-KEYS.                                   06830000
                       20  ASC-XFER-DKEY-ID                PIC S9(09)   06840000
                                                           COMP.        06850000
                   15  ASC-XFER-TYPE                       PIC 9(02).   06860000
                       88  ASC-NON-RETAIL-XFER             VALUE 6.     06870000
                       88  ASC-RETAIL-XFER                 VALUE        06880000
033005                                                 0 THRU 5, 7.     06890000
033005*                                                1 THRU 5, 7.     06891000
100404*            15  ASC-XFER-TO-STORE                   PIC 9(03).   06900000
100404             15  ASC-XFER-TO-STORE                   PIC 9(04).   06901000
100404*            15  ASC-FROM-STORE-NBR                  PIC 9(03).   06910000
100404             15  ASC-FROM-STORE-NBR                  PIC 9(04).   06911000
                   15  ASC-XFER-SEQ-NBR                    PIC 9(06).   06920000
                   15  ASC-XFER-STATUS           PIC X(02).             06930000
                   15  ASC-XFER-STATUS-DESC                PIC X(20).   06940000
                   15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                06950000
                       20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  06960000
                           88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   06970000
                           88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   06980000
                                                                        06990000
                       20  ASC-ITEM-ARRAY.                              07000000
                           25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.        07010000
                               30  ASC-LIST-ITEM-NUMBER                 07020000
                                                           PIC S9(09)   07030000
                                                           COMP-3.      07040000
                               30  ASC-TEMP-SELECTED-SW    PIC  X(01).  07050000
                                   88  ASC-VALID-SELECT    VALUE ' '    07060000
                                                                 'S'    07070000
                                                                 'B'    07080000
                                                                 'E'.   07090000
                                   88  ASC-TEMP-NO-SELECT  VALUE ' '.   07100000
                                   88  ASC-TEMP-SELECT     VALUE 'S'.   07110000
                                   88  ASC-TEMP-BEGIN      VALUE 'B'.   07120000
                                   88  ASC-TEMP-END        VALUE 'E'.   07130000
                               30  ASC-SELECTED-SW         PIC  X(01).  07140000
                                   88  ASC-NO-SELECT       VALUE ' '.   07150000
                                   88  ASC-SELECT          VALUE 'S'.   07160000
                                   88  ASC-BEGIN           VALUE 'B'.   07170000
                                   88  ASC-END             VALUE 'E'.   07180000
                               30  ASC-ACTION              PIC  X(03).  07190000
                               30  ASC-LINE                PIC  9(03).  07200000
                               30  ASC-DPT-CL-SUBCL.                    07210000
                                   35  ASC-DEPT            PIC 9(03).   07220000
                                   35  ASC-CLASS           PIC 9(03).   07230000
                                   35  ASC-SUBCLASS        PIC 9(03).   07240000
                               30  ASC-UPC                 PIC 9(13)    07250000
                                                              COMP-3.   07260000
                               30  ASC-XFER-QTY            PIC 9(05)    07270000
                                                              COMP-3.   07280000
                               30  ASC-RECV-QTY            PIC 9(05)    07290000
                                                              COMP-3.   07300000
SR3403                         30  ASC-XFER-PRICE          PIC 9(05)V99 07311000
                                                              COMP-3.   07320000
SR3403                         30  ASC-RECV-PRICE          PIC 9(05)V99 07331000
                                                              COMP-3.   07340000
SR3403                         30  ASC-FILE-PRICE          PIC 9(05)V99 07351000
                                                              COMP-3.   07360000
                               30  ASC-DESCRIPTION.                     07370000
                                   35  ASC-DESCRIPTION-1   PIC X(20).   07380000
                                   35  ASC-DESCRIPTION-2   PIC X(20).   07390000
                                                                        07400000
                   15  ASC-BLK-SUB                         PIC S9(04)   07410000
                                                                COMP    07420000
                                                                SYNC.   07430000
                   15  ASC-ITEM-SUB                        PIC S9(04)   07440000
                                                                COMP    07450000
                                                                SYNC.   07460000
                   15  ASC-SEL-SUB                         PIC S9(04)   07470000
                                                               COMP.    07480000
                   15  ASC-SEL-ITEM                        PIC S9(04)   07490000
                                                               COMP.    07500000
                   15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   07510000
                                                               COMP-3.  07520000
                   15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   07530000
                                                                COMP-3. 07540000
                   15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   07550000
                                                                COMP-3. 07560000
                   15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   07570000
                                                                COMP-3. 07580000
                   15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   07590000
                                                                COMP-3. 07600000
                   15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   07610000
                                                                COMP-3. 07620000
                   15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   07630000
                                                                COMP    07640000
                                                                SYNC.   07650000
                   15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   07660000
                                                                COMP-3. 07670000
                   15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   07680000
                                                                COMP-3. 07690000
                   15  ASC-ADJUSTMENTS-SW                  PIC  X(01).  07700000
                       88  ASC-ADJUSTMENTS-EXIST             VALUE 'Y'. 07710000
                       88  ASC-NO-ADJUSTMENTS-EXIST          VALUE 'N'. 07720000
                   15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  07730000
                       88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 07740000
                   15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  07750000
                       88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   07760000
                       88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   07770000
                   15  ASC-ITEMS-LEFT-INDICATOR-2          PIC  X(01).  07780000
                       88  ASC-ITEMS-LEFT-ON-DB-2          VALUE 'Y'.   07790000
                       88  ASC-NO-ITEMS-LEFT-ON-DB-2       VALUE 'N'.   07800000
                   15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  07810000
                       88  ASC-UPDATE-TSQ                  VALUE 'Y'.   07820000
                       88  ASC-NO-TSQ-UPDATE               VALUE ' '.   07830000
                   15  ASC-LIST-QUEUE-NAME.                             07840000
                       20  ASC-LIST-TERM-ID                PIC  X(04).  07850000
                       20  ASC-LIST-TASK-NUMBER            PIC S9(05)   07860000
                                                                COMP-3. 07870000
                       20  ASC-LIST-SEQ                    PIC  9(01).  07880000
                   15  ASC-SEL-QUEUE-IN-NAME.                           07890000
                       20  ASC-SEL-IN-TERM-ID              PIC  X(04).  07900000
                       20  ASC-SEL-IN-TASK-NUMBER          PIC S9(05)   07910000
                                                                COMP-3. 07920000
                       20  ASC-SEL-IN-SEQ                  PIC  9(01).  07930000
                   15  ASC-SEL-QUEUE-OUT-NAME.                          07940000
                       20  ASC-SEL-OUT-TERM-ID             PIC  X(04).  07950000
                       20  ASC-SEL-OUT-TASK-NUMBER         PIC S9(05)   07960000
                                                                COMP-3. 07970000
                       20  ASC-SEL-OUT-SEQ                 PIC  9(01).  07980000
                                                                        07990000
                   15  ASC-START-ITEM-REQUEST.                          08000000
                       20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  08010000
           EJECT                                                        08020000
                                                                        08021000
      *----------------------------------------------------------------*08022000
      *  RF COPYBOOK TO FORMAT PRINTER DESTINATION                      08023000
      *----------------------------------------------------------------*08024000
080204     COPY RFWS009.                                                08025000
                                                                        08026000
      *---------------------------------------------------------------* 08030000
      *   TFWS002 - IS THE OUTPUT TEMP STORAGE LAYOUT.                * 08040000
      *---------------------------------------------------------------* 08050000
      *                                                                 08060000
           COPY TFWS002.                                                08070000
      *                                                                 08080000
      *  LAYOUT FOR THE DRS (DYNAMIC REPORT SYSTEM) COMMAREA            08090000
      *                                                                 08100000
           COPY  DRRD001O.                                              08110000
                                                                        08120000
      *                                                                 08130000
      *  LAYOUT FOR THE DRS (DYNAMIC REPORT SYSTEM) DETAIL LINES        08140000
      *                                                                 08150000
           COPY  DRRD002O.                                              08160000
                                                                        08170000
      *---------------------------------------------------------------* 08180000
      *    ABEND PROCESSING COPYBOOK.                                 * 08190000
      *---------------------------------------------------------------* 08200000
                                                                        08210000
           COPY DPWS013.                                                08220000
                                                                        08230000
       EJECT                                                            08240000
      *---------------------------------------------------------------* 08250000
      *    DB2 AREA FOR TFFMSTR(TRANSFER TABLE)                         08260000
      *---------------------------------------------------------------* 08270000
           EXEC SQL                                                     08280000
                INCLUDE TTFMSTR                                         08290000
           END-EXEC.                                                    08300000
      *---------------------------------------------------------------* 08310000
      *    DB2 AREA FOR TTFITEM (TRANSFER ITEM TABLE)                   08320000
      *---------------------------------------------------------------* 08330000
           EXEC SQL                                                     08340000
                INCLUDE TTFITEM                                         08350000
           END-EXEC.                                                    08360000
      *---------------------------------------------------------------* 08370000
      *    DB2 AREA FOR TTFITRC (TRANSFER ITEM RECEIPT TABLE)           08380000
      *---------------------------------------------------------------* 08390000
           EXEC SQL                                                     08400000
                INCLUDE TTFITRC                                         08410000
           END-EXEC.                                                    08420000
      *---------------------------------------------------------------* 08430000
      *    DB2 AREA FOR TTFDSCP  (TRANSFER DISCREPANCY TABLE)           08440000
      *---------------------------------------------------------------* 08450000
           EXEC SQL                                                     08460000
                INCLUDE TTFDSCP                                         08470000
           END-EXEC.                                                    08480000
      *---------------------------------------------------------------* 08490000
      *    DB2 AREA FOR TTFSTAT (TRANSFER STATUS TABLE)                 08500000
      *---------------------------------------------------------------* 08510000
           EXEC SQL                                                     08520000
                INCLUDE TTFSTAT                                         08530000
           END-EXEC.                                                    08540000
      *---------------------------------------------------------------* 08550000
      *    DB2 AREA FOR TTFSTCD (TRANSFER STATUS CODE TABLE)            08560000
      *---------------------------------------------------------------* 08570000
           EXEC SQL                                                     08580000
                INCLUDE TTFSTCD                                         08590000
           END-EXEC.                                                    08600000
      *---------------------------------------------------------------* 08610000
      *    DB2 AREA FOR TTFAJRS (TRANSFER ADJUSTMENT REASON CODE TABLE) 08620000
      *---------------------------------------------------------------* 08630000
           EXEC SQL                                                     08640000
                INCLUDE TTFAJRS                                         08650000
           END-EXEC.                                                    08660000
      *---------------------------------------------------------------* 08670000
      *    DB2 AREA FOR TTFITPS (TRANSFER ITEM POSTING TABLE)         * 08680000
      *---------------------------------------------------------------* 08690000
           EXEC SQL                                                     08700000
                INCLUDE TTFITPS                                         08710000
           END-EXEC.                                                    08720000
      *---------------------------------------------------------------* 08730000
      *    DB2 AREA FOR TSKXREF (SKU CROSS REFERENCE TABLE)           * 08740000
      *---------------------------------------------------------------* 08750000
           EXEC SQL                                                     08760000
                INCLUDE TSKXREF                                         08770000
           END-EXEC.                                                    08780000
      *---------------------------------------------------------------* 08790000
      *    DB2 AREA FOR COMMUNICATIONS                                * 08800000
      *---------------------------------------------------------------* 08810000
           EXEC SQL                                                     08820000
                INCLUDE SQLCA                                           08830000
           END-EXEC.                                                    08840000
                                                                        08850000
      *---------------------------------------------------------------* 08860000
      *    CURSOR TO RETRIEVE TRANSFER ITEMS                          * 08870000
      *---------------------------------------------------------------* 08880000
                                                                        08890000
           EXEC SQL                                                     08900000
                DECLARE XFER-ITEM-CSR CURSOR                            08910000
                FOR SELECT                                              08920000
                      XFER_LNE_NBR                                      08930000
                    , CPLD_RTL_PRIC_AMT                                 08940000
                    , KOHLS_UPC_NBR                                     08950000
                    , NRTL_1ST_LNE_DESC                                 08960000
                    , NRTL_2ND_LNE_DESC                                 08970000
                    , XFER_PRIC_AMT                                     08980000
                    , XFER_QTY                                          08990000
                    , ITM_NBR                                           09000000
                FROM                                                    09010000
                      TTFITEM A                                         09020000
                WHERE                                                   09030000
                      XFER_DKEY_ID     = :DK-XFER-DKEY-ID               09040000
                ORDER BY                                                09050000
                      XFER_LNE_NBR                                      09060000
100404         WITH UR                                                  09061000
           END-EXEC.                                                    09070000
                                                                        09080000
      *---------------------------------------------------------------* 09090000
      *    CURSOR TO RETRIEVE TRANSFER RECEIPT ITEMS                  * 09100000
      *---------------------------------------------------------------* 09110000
                                                                        09120000
           EXEC SQL                                                     09130000
                DECLARE XFER-RECEIPT-CSR CURSOR                         09140000
                FOR SELECT                                              09150000
                      RCVD_XFER_PRIC_AMT                                09160000
                    , RCVD_XFER_QTY                                     09170000
                FROM                                                    09180000
                      TTFITRC I                                         09190000
                     ,TTFSTAT S                                         09200000
                WHERE                                                   09210000
                      I.XFER_DKEY_ID     = :DK-XFER-DKEY-ID        AND  09220000
                      S.XFER_DKEY_ID     = I.XFER_DKEY_ID          AND  09230000
                      S.XFER_STAT_CDE    = :PC-POSITIVE-RECEIPT    AND  09240000
                      S.XFER_STAT_TMST   = I.XFER_RCPT_TMST        AND  09250000
                      RCVD_XFER_PRIC_AMT <> :TFITEM-XFER-PRIC-AMT  AND  09260000
      *               RCVD_XFER_PRIC_AMT > :PC-ZERO                AND  09270000
                      RCVD_XFER_QTY      > :PC-ZERO                AND  09280000
                      XFER_LNE_NBR       = :TFITEM-XFER-LNE-NBR         09290000
                ORDER BY                                                09300000
                      RCVD_XFER_PRIC_AMT                                09310000
100404          WITH UR                                                 09311000
           END-EXEC.                                                    09320000
                                                                        09330000
                                                                        09340000
       EJECT                                                            09350000
       LINKAGE SECTION.                                                 09360000
                                                                        09370000
       01  DFHCOMMAREA.                                                 09380000
           05  FILLER                         OCCURS  1 TO 4072 TIMES   09390000
                                              DEPENDING ON EIBCALEN.    09400000
               10  FILLER                     PIC X.                    09410000
                                                                        09420000
       EJECT                                                            09430000
       PROCEDURE DIVISION.                                              09440000
      ******************************************************************09450000
      **  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **09460000
      **  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **09470000
      **  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **09480000
      ******************************************************************09490000
       0000-MAIN-MODULE.                                                09500000
           INITIALIZE DP030-CICS-API-FIELDS.                            09510000
           MOVE +1                       TO DP030-NUMBER-OF-MAPS.       09520000
           MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          09530000
           SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       09540000
           IF ASC-NON-RETAIL-XFER                                       09550000
               MOVE PC-NON-RETAIL-ITEM-MAP-NAME TO DP030-MAP-NAME (1)   09560000
               MOVE LENGTH OF MR-B-NON-RETAIL TO DP030-MAP-LENGTH (1)   09570000
           ELSE                                                         09580000
               MOVE PC-RETAIL-ITEM-MAP-NAME   TO DP030-MAP-NAME (1)     09590000
               MOVE LENGTH OF MR-A-RETAIL     TO DP030-MAP-LENGTH (1)   09600000
           END-IF.                                                      09610000
           MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     09620000
           PERFORM 0001-CALL-CICS-ARCH-API.                             09630000
      *                                                                 09640000
           PERFORM 1000-CONTROL-PROCESSING                              09650000
      *                                                                 09660000
           MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     09670000
           PERFORM 0001-CALL-CICS-ARCH-API.                             09680000
                                                                        09690000
      ******************************************************************09700000
      **  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **09710000
      **  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **09720000
      ******************************************************************09730000
       0001-CALL-CICS-ARCH-API.                                         09740000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      09750099
                                          DFHCOMMAREA                   09760099
                                          DP030-CICS-API-FIELDS         09770099
                                          DP020-STANDARD-COMMAREA       09780099
                                          MD-MAP-DATA-AREA.             09790099
      *                                                                 09800000
           IF  DP030-RC-CALL-SUCCESSFUL                                 09810000
               CONTINUE                                                 09820000
           ELSE                                                         09830000
               SET DP013-NO-ROLLBACK                                    09840000
                   DP013-XCTL-DISPLAY-RESTART                           09850000
                   DP013-CICS-ABEND      TO TRUE                        09860000
               MOVE '0001-CALL-CICS-ARCH-API'                           09870000
                                         TO DP013-PARAGRAPH             09880000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O09881099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      09882099
               MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      09910000
               PERFORM DP013-0000-PROCESS-ABEND                         09920000
           END-IF.                                                      09930000
      *----------------------------------------------------------------*09940000
      * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *09950000
      * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *09960000
      *                                                                *09970000
      * NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *09980000
      *  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *09990000
      *  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *10000000
      *  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *10010000
      *----------------------------------------------------------------*10020000
                                                                        10030000
       1000-CONTROL-PROCESSING.                                         10040000
                                                                        10050000
           EVALUATE TRUE                                                10060000
               WHEN DP020-NEXT-ACT-INITIAL                              10070000
                   INITIALIZE ASC-SPECIFIC-COMMAREA                     10080000
                   MOVE EIBTRMID         TO ASC-LIST-TERM-ID            10090000
                                            ASC-SEL-OUT-TERM-ID         10100000
                   MOVE DP020-SRC-TASK-NUMBER                           10110000
                                         TO ASC-LIST-TASK-NUMBER        10120000
                                            ASC-SEL-OUT-TASK-NUMBER     10130000
                   MOVE PC-LIST-QUEUE-SEQ                               10140000
                                         TO ASC-LIST-SEQ                10150000
                   MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-OUT-SEQ             10160000
                   PERFORM 1100-PROCESS-INTER-APPL-COMM                 10170000
      ***-----$TEMPLATE NOTE$-------------------------------------------10180000
      *** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,10190000
      *** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  10200000
      *** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.10210000
      ***---------------------------------------------------------------10220000
                   IF  PS-COMMAREA-NOT-VALID                            10230000
      ***              MOVE PC-TSYMSG-99901                             10240000
      ***                                TO DP020-MSG-NUMBER            10250000
      ***              SET DP020-MSG-FATAL                              10260000
      ***                                TO TRUE                        10270000
                       SET DP020-NEXT-ACT-APPL-ERROR                    10280000
                                         TO TRUE                        10290000
                   ELSE                                                 10300000
                       SET PS-TRANSFER-NOT-FOUND        TO TRUE         10310000
                       PERFORM 5000-GET-TRANSFER                        10320000
                       IF PS-TRANSFER-FOUND                             10330000
                           PERFORM 2050-DELETE-LIST-QUEUE               10340000
                           PERFORM 4000-BUILD-INITIAL-PANEL             10350000
                       ELSE                                             10360000
                           SET DP020-NEXT-ACT-APPL-ERROR TO TRUE        10370000
                           MOVE PC-TSYMSG-00148                         10380000
                                         TO DP020-MSG-NUMBER            10390000
                           SET DP020-MSG-WARNING TO TRUE                10400000
                       END-IF                                           10410000
                   END-IF                                               10420000
                                                                        10430000
               WHEN DP020-NEXT-ACT-READ-MAP                             10440000
                   MOVE ASC-ITEM-AT-TOP-OF-PANEL                        10450000
                                         TO PV-TOP-ITEM                 10460000
                   PERFORM 2000-PROCESS-PANEL                           10470000
                                                                        10480000
               WHEN DP020-NEXT-ACT-RETURN                               10490000
                   IF ASC-PRINT-LIST-REQUEST        AND                 10500000
                         TF001-PRINT-YES            AND                 10510000
                         TF001-PRINTER-DEST NOT = SPACES                10520000
                       PERFORM 6300-PRINT-LIST                          10530000
                       MOVE PC-TSYMSG-00098                             10540000
                                         TO DP020-MSG-NUMBER            10550000
                       SET DP020-MSG-INFORMATIONAL  TO TRUE             10560000
                   ELSE                                                 10570000
                       IF ASC-PRINT-DOC-REQUEST     AND                 10580000
                             TF001-PRINT-DOC                            10590000
                           MOVE PC-TSYMSG-01400                         10600000
                                         TO DP020-MSG-NUMBER            10610000
                           SET DP020-MSG-INFORMATIONAL  TO TRUE         10620000
                       END-IF                                           10630000
                   END-IF                                               10640000
                   IF ASC-ADD-ITEM-REQUEST     AND                      10650000
                                 TF001-ADD-ITEM                         10660000
                       MOVE PC-TSYMSG-01271                             10670000
                                         TO DP020-MSG-NUMBER            10680000
                       SET DP020-MSG-INFORMATIONAL  TO TRUE             10690000
                       MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL    10700000
                       PERFORM 2050-DELETE-LIST-QUEUE                   10710000
                       PERFORM 4000-BUILD-INITIAL-PANEL                 10720000
                   ELSE                                                 10730000
                       MOVE ASC-ITEM-AT-TOP-OF-PANEL                    10740000
                                         TO PV-TOP-ITEM                 10750000
                       MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL    10760000
                       PERFORM 6000-REFRESH-PANEL-FROM-TEMP             10770000
                       PERFORM 3000-EDIT-DATA-IN-COMMAREA               10780000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10790000
                   END-IF                                               10800000
                   SET ASC-NO-ACTION-REQUEST            TO TRUE         10810000
                                                                        10820000
               WHEN OTHER                                               10830000
                   SET DP013-LOGIC-ABEND TO TRUE                        10840000
                   SET DP013-NO-ROLLBACK TO TRUE                        10850000
                   MOVE '1000-CONTROL-PROCESSING'                       10860000
                                         TO DP013-PARAGRAPH             10870000
                   MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    10880000
                                         TO DP013-MESSAGE-TEXT(1)       10890000
                   PERFORM DP013-0000-PROCESS-ABEND                     10900000
           END-EVALUATE.                                                10910000
                                                                        10920000
       EJECT                                                            10930000
      *----------------------------------------------------------------*10940000
      * DETERMINE THE TRANSFER NUMBER TO BE DISPLAYED.                 *10950000
      *----------------------------------------------------------------*10960000
                                                                        10970000
       1100-PROCESS-INTER-APPL-COMM.                                    10980000
                                                                        10990000
           SET PS-COMMAREA-VALID         TO TRUE.                       11000000
           MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     11010000
           EVALUATE DP020-INT-APPL-FORMAT-IND                           11020000
               WHEN PC-INTER-APPL-LIST                                  11030000
                   SET ASC-USE-SELECTION-QUEUE TO TRUE                  11040000
                   IF TF001-XFER-NBR > ZERO                             11050000
                       MOVE TF001-INTER-APPL-COMMAREA                   11060000
                                         TO ASC-INTER-APPL-CRITERIA     11070000
                   END-IF                                               11080000
                   MOVE TF001-NUMBER-OF-TS-ITEMS                        11090000
                                     TO ASC-NUMBER-OF-TS-ITEMS          11100000
                   MOVE TF001-SEL-QUEUE-NAME                            11110000
                                     TO ASC-SEL-QUEUE-IN-NAME           11120000
                   PERFORM 1120-PREPARE-LIST-ENTRY                      11130000
               WHEN PC-INTER-APPL-HDR-INQ                               11140000
               WHEN PC-INTER-APPL-CRIT-SPEC                             11150000
               WHEN PC-INTER-APPL-DSCRP                                 11160000
                   IF TF001-XFER-NBR > ZERO                             11170000
                       MOVE TF001-INTER-APPL-COMMAREA                   11180000
                                         TO ASC-INTER-APPL-CRITERIA     11190000
                       MOVE ASC-CRIT-XFER-FROM-STORE TO                 11200000
                                                     ASC-FROM-STORE-NBR 11210000
                       MOVE ASC-CRIT-XFER-SEQ-NBR    TO                 11220000
                                                       ASC-XFER-SEQ-NBR 11230000
                   ELSE                                                 11240000
                       MOVE PC-TSYMSG-00148                             11250000
                                         TO DP020-MSG-NUMBER            11260000
                       SET PS-COMMAREA-NOT-VALID                        11270000
                           DP020-MSG-FATAL           TO TRUE            11280000
                   END-IF                                               11290000
               WHEN OTHER                                               11300000
                   MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER            11310000
                   SET PS-COMMAREA-NOT-VALID                            11320000
                       DP020-MSG-FATAL           TO TRUE                11330000
           END-EVALUATE.                                                11340000
                                                                        11350000
       EJECT                                                            11360000
      *----------------------------------------------------------------*11370000
      *    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *11380000
      *----------------------------------------------------------------*11390000
                                                                        11400000
       1120-PREPARE-LIST-ENTRY.                                         11410000
                                                                        11420000
           MOVE TF002-MAX-ITEMS TO ASC-SEL-SUB.                         11430000
           MOVE ZERO            TO ASC-SEL-ITEM.                        11440000
           PERFORM 2160-GET-NEXT-TRANSFER.                              11450000
      *----------------------------------------------------------------*11460000
      * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *11470000
      * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *11480000
      * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *11490000
      * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *11500000
      * FUNCTION KEYS CAN GET THIS FAR.                                *11510000
      *----------------------------------------------------------------*11520000
                                                                        11530000
       2000-PROCESS-PANEL.                                              11540000
           EVALUATE TRUE                                                11550000
                                                                        11560000
               WHEN DP020-SRC-AID = DP016-CLEAR                         11570000
                   MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    11580000
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11590000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11600000
                                                                        11610000
               WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    11620000
                   MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    11630000
                   PERFORM 2050-DELETE-LIST-QUEUE                       11640000
                   PERFORM 4000-BUILD-INITIAL-PANEL                     11650000
                                                                        11660000
      *---  HDR INQ  -----------------------------------------------*   11670000
               WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              11680000
                   SET DP030-CONTINUE-GO TO TRUE                        11690000
                   INITIALIZE TF001-INTER-APPL-COMMAREA                 11700000
                   MOVE ASC-FROM-STORE-NBR  TO ASC-CRIT-XFER-FROM-STORE 11710000
                   MOVE ASC-XFER-SEQ-NBR    TO ASC-CRIT-XFER-SEQ-NBR    11720000
                   MOVE ASC-INTER-APPL-CRITERIA                         11730000
                                         TO TF001-INTER-APPL-COMMAREA   11740000
                                                                        11750000
      *---  PRINT DOC  ---------------------------------------------*   11760000
               WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              11770000
                   IF ASC-XFER-STATUS = PC-VOIDED                       11780000
                       SET ASC-NO-ACTION-REQUEST                        11790000
                           DP030-OVERRIDE-GO                            11800000
                           DP020-MSG-WARNING      TO TRUE               11810000
                       MOVE PC-TSYMSG-01399       TO DP020-MSG-NUMBER   11820000
                   ELSE                                                 11830000
                       SET ASC-PRINT-DOC-REQUEST  TO TRUE               11840000
                       INITIALIZE TF001-INTER-APPL-COMMAREA             11850000
080204                 MOVE DP020-LOCATION-NBR                          11851000
080204                                    TO RFWS009-STORE-NBR          11852000
080204                 MOVE RFWS009-STORE-PRINTER-DEST                  11853000
080204                                    TO TF001-PRINTER-DEST         11854000
                       MOVE ASC-FROM-STORE-NBR                          11880000
                                          TO ASC-CRIT-XFER-FROM-STORE   11890000
                       MOVE ASC-XFER-SEQ-NBR                            11900000
                                          TO ASC-CRIT-XFER-SEQ-NBR      11910000
                       MOVE ASC-CRIT-XFER-NBR-9   TO TF001-XFER-NBR     11920000
                   END-IF                                               11930000
                                                                        11940000
      *---  DISCREPANCY  -------------------------------------------*   11950000
               WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              11960000
                   SET ASC-NO-ACTION-REQUEST     TO TRUE                11970000
                   EVALUATE ASC-XFER-STATUS                             11980000
                     WHEN PC-POSITIVE-RECEIPT                           11990000
                       IF ASC-NON-RETAIL-XFER                           12000000
                           SET DP030-OVERRIDE-GO TO TRUE                12010000
      *   DISCREPANCY SCREEN IS NOT AVAILABLE FOR NON-RETAIL            12020000
                           MOVE PC-TSYMSG-01572  TO DP020-MSG-NUMBER    12030000
                           SET DP020-MSG-WARNING TO TRUE                12040000
                       ELSE                                             12050000
                           IF ASC-DISCREPANCY-EXISTS                    12060000
                               SET DP030-CONTINUE-GO TO TRUE            12070000
                               INITIALIZE TF001-INTER-APPL-COMMAREA     12080000
                               MOVE ASC-FROM-STORE-NBR                  12090000
                                            TO ASC-CRIT-XFER-FROM-STORE 12100000
                               MOVE ASC-XFER-SEQ-NBR                    12110000
                                            TO ASC-CRIT-XFER-SEQ-NBR    12120000
                               MOVE ASC-INTER-APPL-CRITERIA             12130000
                                         TO TF001-INTER-APPL-COMMAREA   12140000
                               MOVE ASC-XFER-DKEY-ID                    12150000
                                         TO TF001-DKEY-ID               12160000
                           ELSE                                         12170000
                               SET DP030-OVERRIDE-GO TO TRUE            12180000
      *   TRANSFER HAS NO DISCREPANCIES                                 12190000
                               MOVE PC-TSYMSG-01414 TO DP020-MSG-NUMBER 12200000
                               SET DP020-MSG-WARNING TO TRUE            12210000
                               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN     12220000
                           END-IF                                       12230000
                       END-IF                                           12240000
                                                                        12250000
                     WHEN PC-VOIDED                                     12260000
                       SET DP030-OVERRIDE-GO TO TRUE                    12270000
      *   INVALID REQUEST; TRANSFER IS IN VOIDED STATUS                 12280000
                       MOVE ASC-XFER-STATUS  TO DP020-MSG-TEXT          12290000
                       MOVE PC-TSYMSG-01581  TO DP020-MSG-NUMBER        12300000
                       SET DP020-MSG-WARNING TO TRUE                    12310000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             12320000
                                                                        12330000
                     WHEN OTHER                                         12340000
                       SET DP030-OVERRIDE-GO TO TRUE                    12350000
      *   TRANSFER HAS NOT REACHED ITS DESTINATION                      12360000
                       MOVE PC-TSYMSG-01416  TO DP020-MSG-NUMBER        12370000
                       SET DP020-MSG-WARNING TO TRUE                    12380000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             12390000
                   END-EVALUATE                                         12400000
                                                                        12410000
      *---  CRITERIA  ----------------------------------------------*   12420000
               WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              12430000
                   SET ASC-NO-ACTION-REQUEST     TO TRUE                12440000
                   IF ASC-CRIT-ORIG-APPL-FORMAT-IND =                   12450000
                                       PC-INTER-APPL-CRIT-SPEC          12460000
                       MOVE PC-TSYMSG-00148                             12470000
                                         TO DP020-MSG-NUMBER            12480000
                       SET DP020-MSG-WARNING TO TRUE                    12490000
                       SET DP030-OVERRIDE-GO TO TRUE                    12500000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             12510000
                   ELSE                                                 12520000
                       SET DP030-CONTINUE-GO TO TRUE                    12530000
                       INITIALIZE TF001-INTER-APPL-COMMAREA             12540000
                       MOVE ASC-INTER-APPL-CRITERIA                     12550000
                                         TO TF001-INTER-APPL-COMMAREA   12560000
                   END-IF                                               12570000
                                                                        12580000
      *---  PRINT LIST  --------------------------------------------*   12590000
               WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              12600000
                   SET ASC-PRINT-LIST-REQUEST TO TRUE                   12610000
                   INITIALIZE TF001-DRS-DATA                            12620000
080204             MOVE DP020-LOCATION-NBR                              12621000
080204                              TO RFWS009-STORE-NBR                12622000
080204             MOVE RFWS009-STORE-PRINTER-DEST                      12623000
080204                              TO TF001-PRINTER-DEST               12624000
                                                                        12650000
      *---  ADD ITM  -----------------------------------------------*   12660000
               WHEN DP020-FK-LOCAL-FUNC-07 (DP020-SRC-AID)              12670000
                 IF ASC-XFER-TYPE = PC-OFFSITE-STORAGE                  12680000
                     SET DP030-OVERRIDE-GO TO TRUE                      12690000
      *   NOT ALLOWED FOR OFFSITE STORAGE TRANSFER TYPE                 12700000
                     MOVE 'OFFSITE STORAGE' TO DP020-MSG-TEXT           12710000
                     MOVE PC-TSYMSG-01406  TO DP020-MSG-NUMBER          12720000
                     SET DP020-MSG-FATAL   TO TRUE                      12730000
                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               12740000
                 ELSE                                                   12750000
                   EVALUATE ASC-XFER-STATUS                             12760000
                       WHEN PC-POSITIVE-RECEIPT                         12770000
                           INITIALIZE TF001-INTER-APPL-COMMAREA         12780000
                           MOVE ASC-XFER-DKEY-ID                        12790000
                                      TO TF001-DKEY-ID                  12800000
                           SET DP030-CONTINUE-GO                        12810000
                               ASC-ADD-ITEM-REQUEST   TO TRUE           12820000
                                                                        12830000
                       WHEN PC-VOIDED                                   12840000
                           SET DP030-OVERRIDE-GO TO TRUE                12850000
      *   INVALID REQUEST; TRANSFER IS IN VOIDED STATUS                 12860000
                           MOVE ASC-XFER-STATUS  TO DP020-MSG-TEXT      12870000
                           MOVE PC-TSYMSG-01581  TO DP020-MSG-NUMBER    12880000
                           SET DP020-MSG-WARNING TO TRUE                12890000
                           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         12900000
                                                                        12910000
                       WHEN OTHER                                       12920000
                           SET DP030-OVERRIDE-GO TO TRUE                12930000
                           MOVE PC-TSYMSG-01416  TO DP020-MSG-NUMBER    12940000
                           SET DP020-MSG-WARNING TO TRUE                12950000
                           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         12960000
                   END-EVALUATE                                         12970000
                 END-IF                                                 12980000
                                                                        12990000
               WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             13000000
                   IF  ASC-USE-SELECTION-QUEUE                          13010000
                       PERFORM 2160-GET-NEXT-TRANSFER                   13020000
                       IF PS-LIST-END                                   13030000
                           MOVE ZERO    TO ASC-ITEM-AT-TOP-OF-PANEL     13040000
                           PERFORM 3200-RESET-ATTRIBUTES                13050000
                           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         13060000
                           SET PS-NO-LIST-END TO TRUE                   13070000
                       ELSE                                             13080000
                           SET DP030-ERASE                 TO TRUE      13090000
                           SET DP030-SEND-MAP-AND-DATA(1)  TO TRUE      13100000
                           SET PS-TRANSFER-NOT-FOUND        TO TRUE     13110000
                           PERFORM 5000-GET-TRANSFER                    13120000
                           IF PS-TRANSFER-FOUND                         13130000
                               PERFORM 2050-DELETE-LIST-QUEUE           13140000
                               PERFORM 3200-RESET-ATTRIBUTES            13150000
                               PERFORM 4000-BUILD-INITIAL-PANEL         13160000
                           ELSE                                         13170000
                               MOVE PC-TSYMSG-00148                     13180000
                                         TO DP020-MSG-NUMBER            13190000
                               SET DP020-MSG-WARNING TO TRUE            13200000
                           END-IF                                       13210000
                       END-IF                                           13220000
                   ELSE                                                 13230000
                       MOVE PC-TSYMSG-00070                             13240000
                                        TO DP020-MSG-NUMBER             13250000
                       SET DP020-MSG-INFORMATIONAL TO TRUE              13260000
                   END-IF                                               13270000
                                                                        13280000
               WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             13290000
                   IF  ASC-USE-SELECTION-QUEUE                          13300000
                       PERFORM 2170-GET-PREV-TRANSFER                   13310000
                       IF PS-LIST-END                                   13320000
                           MOVE ZERO    TO ASC-ITEM-AT-TOP-OF-PANEL     13330000
                           PERFORM 3200-RESET-ATTRIBUTES                13340000
                           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         13350000
                           SET PS-NO-LIST-END TO TRUE                   13360000
                       ELSE                                             13370000
                           SET DP030-ERASE                 TO TRUE      13380000
                           SET DP030-SEND-MAP-AND-DATA(1)  TO TRUE      13390000
                           SET PS-TRANSFER-NOT-FOUND       TO TRUE      13400000
                           PERFORM 5000-GET-TRANSFER                    13410000
                           IF PS-TRANSFER-FOUND                         13420000
                               PERFORM 2050-DELETE-LIST-QUEUE           13430000
                               PERFORM 3200-RESET-ATTRIBUTES            13440000
                               PERFORM 4000-BUILD-INITIAL-PANEL         13450000
                           ELSE                                         13460000
                               MOVE PC-TSYMSG-00148                     13470000
                                         TO DP020-MSG-NUMBER            13480000
                               SET DP020-MSG-WARNING TO TRUE            13490000
                           END-IF                                       13500000
                       END-IF                                           13510000
                   ELSE                                                 13520000
                       MOVE PC-TSYMSG-00069                             13530000
                                        TO DP020-MSG-NUMBER             13540000
                       SET DP020-MSG-INFORMATIONAL TO TRUE              13550000
                   END-IF                                               13560000
                                                                        13570000
               WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    13580000
                   SET ASC-NO-ACTION-REQUEST     TO TRUE                13590000
                   PERFORM 2140-DESELECT-ALL-ITEMS                      13600000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13610000
                                                                        13620000
               WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  13630000
                   SET ASC-NO-ACTION-REQUEST     TO TRUE                13640000
                   PERFORM 2150-SELECT-ALL-ITEMS                        13650000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13660000
                                                                        13670000
               WHEN OTHER                                               13680000
                   SET ASC-NO-ACTION-REQUEST     TO TRUE                13690000
                   PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 13700000
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   13710000
                   IF  PS-NO-ERROR                                      13720000
                       SET DP030-CONTINUE-GO                            13730000
                                       TO TRUE                          13740000
                       PERFORM 2100-CHECK-FUNCTION-KEY                  13750000
                   ELSE                                                 13760000
                       SET DP030-OVERRIDE-GO                            13770000
                                       TO TRUE                          13780000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             13790000
                   END-IF                                               13800000
           END-EVALUATE.                                                13810000
       EJECT                                                            13820000
      *----------------------------------------------------------------*13830000
      *  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *13840000
      *----------------------------------------------------------------*13850000
       2050-DELETE-LIST-QUEUE.                                          13860000
                                                                        13870000
           EXEC CICS                                                    13880000
               DELETEQ TS                                               13890000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          13900000
                   RESP  (PV-CICS-RESP)                                 13910000
           END-EXEC.                                                    13920000
                                                                        13930000
           IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       13940000
              (PV-CICS-RESP = DFHRESP(QIDERR))                          13950000
               CONTINUE                                                 13960000
           ELSE                                                         13970000
               SET DP013-CICS-ABEND      TO TRUE                        13980000
               SET DP013-NO-ROLLBACK     TO TRUE                        13990000
                                                                        14000000
               MOVE '2050-DELETE-LIST-QUEUE'                            14010000
                                         TO DP013-PARAGRAPH             14020000
               MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    14030000
                                         TO DP013-MESSAGE-TEXT (1)      14040000
               PERFORM DP013-0000-PROCESS-ABEND                         14050000
           END-IF.                                                      14060000
                                                                        14070000
           MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  14080000
       EJECT                                                            14090000
      *----------------------------------------------------------------*14100000
      * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*14110000
      * NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *14120000
      * CICS ARCHITECTURE API.                                         *14130000
      *----------------------------------------------------------------*14140000
       2100-CHECK-FUNCTION-KEY.                                         14150000
           EVALUATE TRUE                                                14160000
                                                                        14170000
      *---  LINE DTL  ----------------------------------------------*   14180000
               WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              14190000
                   IF ASC-NUMBER-OF-SELECTED-ITEMS < +1                 14200000
                       MOVE PC-TSYMSG-00057   TO DP020-MSG-NUMBER       14210000
                       SET DP020-MSG-FATAL    TO TRUE                   14220000
                       MOVE -1                TO MR-A-SELECTL (1)       14230000
                       SET DP030-OVERRIDE-GO                            14240000
                           DP030-SET-CURSOR-APPL-1                      14250000
                                              TO TRUE                   14260000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             14270000
                   ELSE                                                 14280000
                       EVALUATE ASC-XFER-STATUS ALSO TRUE               14290000
                         WHEN PC-POSITIVE-RECEIPT ALSO ANY              14300000
                         WHEN ANY        ALSO ASC-ADJUSTMENTS-EXIST     14310000
                           INITIALIZE TF003-INTER-APPL-COMMAREA         14320000
                           MOVE ASC-XFER-DKEY-ID                        14330000
                                      TO TF003-XFER-DKEY-ID             14340000
                           MOVE ASC-NUMBER-OF-SELECTED-ITEMS            14350000
                                      TO TF003-NUMBER-OF-SELECTED-ITEMS 14360000
                           PERFORM 5050-PREPARE-SEL-QUEUE-OUT           14370000
                           SET DP030-CONTINUE-GO TO TRUE                14380000
                                                                        14390000
                         WHEN PC-VOIDED  ALSO ANY                       14400000
                           SET DP030-OVERRIDE-GO TO TRUE                14410000
      *   INVALID REQUEST; TRANSFER IS IN VOIDED STATUS                 14420000
                           MOVE ASC-XFER-STATUS  TO DP020-MSG-TEXT      14430000
                           MOVE PC-TSYMSG-01581  TO DP020-MSG-NUMBER    14440000
                           SET DP020-MSG-WARNING TO TRUE                14450000
                           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         14460000
                                                                        14470000
                         WHEN OTHER                                     14480000
                           SET DP030-OVERRIDE-GO TO TRUE                14490000
                           MOVE PC-TSYMSG-01416  TO DP020-MSG-NUMBER    14500000
                           SET DP020-MSG-WARNING TO TRUE                14510000
                           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         14520000
                       END-EVALUATE                                     14530000
                   END-IF                                               14540000
                                                                        14550000
               WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  14560000
                   MOVE +1               TO PV-TOP-ITEM                 14570000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14580000
                                                                        14590000
               WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   14600000
                   PERFORM 2110-BROWSE-BACKWARD                         14610000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14620000
                                                                        14630000
               WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   14640000
                   PERFORM 2120-BROWSE-FORWARD                          14650000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14660000
                                                                        14670000
               WHEN DP020-SRC-AID = DP016-ENTER                         14680000
                   PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   14690000
                   IF  PS-ERROR                                         14700000
                       CONTINUE                                         14710000
                   ELSE                                                 14720000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             14730000
                   END-IF                                               14740000
                                                                        14750000
               WHEN OTHER                                               14760000
                   SET DP013-NO-ROLLBACK                                14770000
                       DP013-XCTL-DISPLAY-RESTART                       14780000
                       DP013-CICS-ABEND  TO TRUE                        14790000
                   MOVE '2100-CHECK-FUNCTION-KEY'                       14800000
                                         TO DP013-PARAGRAPH             14810000
                   MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      14820000
                                         TO DP013-MESSAGE-TEXT (1)      14830000
                   PERFORM DP013-0000-PROCESS-ABEND                     14840000
           END-EVALUATE.                                                14850000
      *                                                                 14860000
      *----------------------------------------------------------------*14870000
      *    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *14880000
      *    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *14890000
      *    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *14900000
      *    MESSAGE.                                                    *14910000
      *----------------------------------------------------------------*14920000
                                                                        14930000
       2110-BROWSE-BACKWARD.                                            14940000
           SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    14950000
               GIVING PV-TOP-ITEM.                                      14960000
      *                                                                 14970000
           IF   (PV-TOP-ITEM < +1)                                      14980000
      *      OR (PV-TOP-ITEM = +1))                                     14990000
               MOVE +1                   TO PV-TOP-ITEM                 15000000
      *        -- TOP OF LIST --                                        15010000
               MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            15020000
               SET DP020-MSG-INFORMATIONAL TO TRUE                      15030000
           END-IF.                                                      15040000
                                                                        15050000
       EJECT                                                            15060000
      *----------------------------------------------------------------*15070000
      *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *15080000
      *    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *15090000
      *    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *15100000
      *----------------------------------------------------------------*15110000
                                                                        15120000
       2120-BROWSE-FORWARD.                                             15130000
                                                                        15140000
           ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              15150000
               GIVING PV-TOP-ITEM.                                      15160000
           IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   15170000
               MOVE ASC-ITEM-AT-TOP-OF-PANEL                            15180000
                                         TO PV-TOP-ITEM                 15190000
      *        -- BOTTOM OF LIST --                                     15200000
               MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            15210000
               SET DP020-MSG-INFORMATIONAL                              15220000
                                         TO TRUE                        15230000
           ELSE                                                         15240000
               COMPUTE PV-BOTTOM-ITEM =                                 15250000
                   PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 15260000
               IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            15270000
      *            -- BOTTOM OF LIST --                                 15280000
                   MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            15290000
                   SET DP020-MSG-INFORMATIONAL                          15300000
                                         TO TRUE                        15310000
               END-IF                                                   15320000
           END-IF.                                                      15330000
       EJECT                                                            15340000
      *----------------------------------------------------------------*15350000
      *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *15360000
      *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *15370000
      *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *15380000
      *    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *15390000
      *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *15400000
      *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *15410000
      *----------------------------------------------------------------*15420000
                                                                        15430000
       2130-CHECK-FOR-JUMP-BROWSE.                                      15440000
           SET PS-NO-ERROR               TO TRUE.                       15450000
           IF (ASC-START-ITEM-REQUEST = SPACE)                          15460000
               MOVE ASC-ITEM-AT-TOP-OF-PANEL                            15470000
                                         TO PV-TOP-ITEM                 15480000
           ELSE                                                         15490000
               MOVE ASC-START-ITEM-REQUEST                              15500000
                                         TO DP010I-UNEDITED-FIELD       15510000
               MOVE +5                   TO DP010I-MAXIMUM-DIGITS       15520000
               MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     15530000
               SET DP010I-NEGATIVE-NOT-ALLOWED                          15540000
                                         TO TRUE                        15550000
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         15561099
                         USING DP010I-NUMERIC-EDIT-AREA                 15562099
                                                                        15570000
               IF  NOT DP010I-ERROR-DETECTED                            15580000
                   MOVE DP010I-NUMERIC-FIELD                            15590000
                                         TO  ASC-START-ITEM-REQUEST-N   15600000
                   IF  ASC-START-ITEM-REQUEST-N > ZERO                  15610000
                       IF  ASC-START-ITEM-REQUEST-N >                   15620000
                                                ASC-NUMBER-OF-ITEMS-READ15630000
                           MOVE SPACE TO ASC-START-ITEM-REQUEST         15640000
                           COMPUTE PV-TOP-ITEM =                        15650000
                                   ASC-NUMBER-OF-ITEMS-READ             15660000
                                   - PC-ITEMS-PER-PANEL + 1             15670000
                           IF  PV-TOP-ITEM < +1                         15680000
                               MOVE +1   TO PV-TOP-ITEM                 15690000
                               MOVE PC-TSYMSG-00070                     15700000
                                         TO DP020-MSG-NUMBER            15710000
                               SET DP020-MSG-INFORMATIONAL              15720000
                                         TO TRUE                        15730000
                           END-IF                                       15740000
                       ELSE                                             15750000
                           MOVE ASC-START-ITEM-REQUEST-N                15760000
                                         TO PV-TOP-ITEM                 15770000
                           MOVE SPACE    TO ASC-START-ITEM-REQUEST      15780000
                           COMPUTE PV-BOTTOM-ITEM =                     15790000
                               PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     15800000
                           IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ15810000
      *                        -- BOTTOM OF LIST --                     15820000
                               MOVE PC-TSYMSG-00070                     15830000
                                         TO DP020-MSG-NUMBER            15840000
                               SET DP020-MSG-INFORMATIONAL              15850000
                                         TO TRUE                        15860000
                           END-IF                                       15870000
                       END-IF                                           15880000
                   ELSE                                                 15890000
      *                --- VALUE OUT OF RANGE ----                      15900000
                       MOVE PC-TSYMSG-00101                             15910000
                                         TO DP020-MSG-NUMBER            15920000
                       MOVE -1           TO MR-A-STARTL                 15930000
                       SET DP030-SET-CURSOR-APPL-1                      15940000
                                         TO TRUE                        15950000
                       MOVE DP015-REVERSE                               15960000
                                         TO MR-A-STARTH                 15970000
                       MOVE DP015-RED    TO MR-A-STARTC                 15980000
                       MOVE DP015-UNP-NUM-BRT-MDT                       15990000
                                         TO MR-A-STARTA                 16000000
                       SET DP020-MSG-FATAL                              16010000
                                         TO TRUE                        16020000
                       SET PS-ERROR      TO TRUE                        16030000
                   END-IF                                               16040000
                                                                        16050000
               ELSE                                                     16060000
                   MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            16070000
                   MOVE -1               TO MR-A-STARTL                 16080000
                   SET DP030-SET-CURSOR-APPL-1 TO TRUE                  16090000
                   MOVE DP015-REVERSE    TO MR-A-STARTH                 16100000
                   MOVE DP015-RED        TO MR-A-STARTC                 16110000
                   MOVE DP015-UNP-NUM-BRT-MDT                           16120000
                                         TO MR-A-STARTA                 16130000
                   SET DP020-MSG-FATAL   TO TRUE                        16140000
                   SET PS-ERROR          TO TRUE                        16150000
               END-IF                                                   16160000
           END-IF.                                                      16170000
       EJECT                                                            16180000
      *----------------------------------------------------------------*16190000
      *    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *16200000
      *    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *16210000
      *----------------------------------------------------------------*16220000
       2140-DESELECT-ALL-ITEMS.                                         16230000
           MOVE +1                       TO ASC-BLK-SUB.                16240000
                                                                        16250000
           PERFORM 2141-CLEAR-SELECTED-INDS                             16260000
               VARYING ASC-ITEM-SUB                                     16270000
               FROM 1 BY 1                                              16280000
               UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16290000
                                                                        16300000
           ADD +1                        TO ASC-BLK-SUB.                16310000
                                                                        16320000
           PERFORM 2141-CLEAR-SELECTED-INDS                             16330000
               VARYING ASC-ITEM-SUB                                     16340000
               FROM 1 BY 1                                              16350000
               UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16360000
                                                                        16370000
           MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16380000
                                         TO PV-LIST-ITEM-NUMBER.        16390000
                                                                        16400000
           COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16410000
               1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    16420000
                                                                        16430000
           IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     16440000
              (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      16450000
               MOVE +1                   TO ASC-BLK-SUB                 16460000
                                                                        16470000
               PERFORM 5100-WRITE-TEMP-STORAGE                          16480000
                                                                        16490000
               MOVE +1                   TO PV-BLOCK-NUMBER             16500000
                                                                        16510000
               COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16520000
                   PV-FIRST-BLOCK-IN-ARRAY - 1                          16530000
                                                                        16540000
               PERFORM                                                  16550000
                   UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       16560000
                                                                        16570000
                   PERFORM 4410-READ-TEMP-STORAGE                       16580000
                                                                        16590000
                   PERFORM 2141-CLEAR-SELECTED-INDS                     16600000
                       VARYING ASC-ITEM-SUB FROM 1 BY 1                 16610000
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16620000
                                                                        16630000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      16640000
                                                                        16650000
                   ADD +1                TO PV-BLOCK-NUMBER             16660000
                                                                        16670000
               END-PERFORM                                              16680000
                                                                        16690000
               COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16700000
                   PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16710000
                                                                        16720000
               PERFORM                                                  16730000
                   UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16740000
                         ASC-HIGHEST-BLOCK-WRITTEN                      16750000
                                                                        16760000
                   MOVE PV-NEXT-BLOCK-IN-ARRAY                          16770000
                                         TO PV-BLOCK-NUMBER             16780000
                                                                        16790000
                   PERFORM 4410-READ-TEMP-STORAGE                       16800000
                                                                        16810000
                   PERFORM 2141-CLEAR-SELECTED-INDS                     16820000
                       VARYING ASC-ITEM-SUB                             16830000
                       FROM 1 BY 1                                      16840000
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16850000
                                                                        16860000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      16870000
                                                                        16880000
                   ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16890000
                                                                        16900000
               END-PERFORM                                              16910000
                                                                        16920000
               MOVE PV-FIRST-BLOCK-IN-ARRAY                             16930000
                                         TO PV-BLOCK-NUMBER             16940000
                                                                        16950000
               PERFORM 4410-READ-TEMP-STORAGE                           16960000
           END-IF.                                                      16970000
                                                                        16980000
                                                                        16990000
           MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 17000000
           MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.17010000
           MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  17020000
                                                                        17030000
           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        17040000
                                                                        17050000
       EJECT                                                            17060000
      *----------------------------------------------------------------*17070000
      *    MARK EACH ITEM AS BEING NOT SELECTED.                       *17080000
      *----------------------------------------------------------------*17090000
                                                                        17100000
       2141-CLEAR-SELECTED-INDS.                                        17110000
                                                                        17120000
           IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           17130000
                   NOT EQUAL ZERO                                       17140000
               IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17150000
                   SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17160000
                       ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    17170000
                       ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  17180000
                                         TO TRUE                        17190000
               END-IF                                                   17200000
           END-IF.                                                      17210000
                                                                        17220000
       EJECT                                                            17230000
      *----------------------------------------------------------------*17240000
      *  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *17250000
      *  FOR ALL ITEMS.                                                *17260000
      *----------------------------------------------------------------*17270000
                                                                        17280000
       2150-SELECT-ALL-ITEMS.                                           17290000
                                                                        17300000
           MOVE +1                       TO ASC-BLK-SUB.                17310000
                                                                        17320000
           PERFORM 2151-SET-SELECTED-INDS                               17330000
               VARYING ASC-ITEM-SUB                                     17340000
               FROM 1 BY 1                                              17350000
               UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17360000
                                                                        17370000
           ADD +1                        TO ASC-BLK-SUB.                17380000
                                                                        17390000
           PERFORM 2151-SET-SELECTED-INDS                               17400000
               VARYING ASC-ITEM-SUB                                     17410000
               FROM 1 BY 1                                              17420000
               UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17430000
                                                                        17440000
           MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17450000
                                         TO PV-LIST-ITEM-NUMBER.        17460000
                                                                        17470000
           COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17480000
               1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    17490000
                                                                        17500000
           IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     17510000
              (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    17520000
               MOVE +1                   TO ASC-BLK-SUB                 17530000
                                                                        17540000
               PERFORM 5100-WRITE-TEMP-STORAGE                          17550000
                                                                        17560000
               MOVE +1                   TO PV-BLOCK-NUMBER             17570000
                                                                        17580000
               COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17590000
                   PV-FIRST-BLOCK-IN-ARRAY - 1                          17600000
                                                                        17610000
               PERFORM                                                  17620000
                   UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       17630000
                                                                        17640000
                   PERFORM 4410-READ-TEMP-STORAGE                       17650000
                                                                        17660000
                   PERFORM 2151-SET-SELECTED-INDS                       17670000
                       VARYING ASC-ITEM-SUB                             17680000
                       FROM 1 BY 1                                      17690000
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17700000
                                                                        17710000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      17720000
                                                                        17730000
                   ADD +1                TO PV-BLOCK-NUMBER             17740000
                                                                        17750000
               END-PERFORM                                              17760000
                                                                        17770000
               COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17780000
                   PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17790000
                                                                        17800000
               PERFORM                                                  17810000
                   UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17820000
                         ASC-HIGHEST-BLOCK-WRITTEN                      17830000
                                                                        17840000
                   MOVE PV-NEXT-BLOCK-IN-ARRAY                          17850000
                                         TO PV-BLOCK-NUMBER             17860000
                                                                        17870000
                   PERFORM 4410-READ-TEMP-STORAGE                       17880000
                                                                        17890000
                   PERFORM 2151-SET-SELECTED-INDS                       17900000
                       VARYING ASC-ITEM-SUB                             17910000
                       FROM 1 BY 1                                      17920000
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17930000
                                                                        17940000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      17950000
                                                                        17960000
                   ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17970000
                                                                        17980000
               END-PERFORM                                              17990000
                                                                        18000000
               MOVE PV-FIRST-BLOCK-IN-ARRAY                             18010000
                                         TO PV-BLOCK-NUMBER             18020000
                                                                        18030000
               PERFORM 4410-READ-TEMP-STORAGE                           18040000
           END-IF.                                                      18050000
                                                                        18060000
                                                                        18070000
      *    MOVE ASC-NUMBER-OF-ITEMS-READ TO                             18080000
      *                      ASC-NUMBER-OF-SELECTED-ITEMS.              18090000
                                                                        18100000
           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        18110000
                                                                        18120000
       EJECT                                                            18130000
      *----------------------------------------------------------------*18140000
      *    MARK EACH ITEM AS BEING SELECTED.                           *18150000
      *----------------------------------------------------------------*18160000
                                                                        18170000
       2151-SET-SELECTED-INDS.                                          18180000
                                                                        18190000
           IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           18200000
                   NOT EQUAL ZERO                                       18210000
               IF ASC-NON-RETAIL-XFER                                   18220000
                   IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          18230000
                       SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   18240000
                           ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   18250000
                                     TO TRUE                            18260000
                       SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              18270000
                                     TO TRUE                            18280000
                       ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   18290000
                   END-IF                                               18300000
               ELSE                                                     18310000
                   IF NOT (ASC-XFER-PRICE (ASC-BLK-SUB ASC-ITEM-SUB)    18320000
                       NOT = ASC-RECV-PRICE  (ASC-BLK-SUB ASC-ITEM-SUB) 18330000
                     AND (ASC-RECV-PRICE    (ASC-BLK-SUB ASC-ITEM-SUB)  18340000
                        NOT = ZERO                                      18350000
                     OR  ASC-RECV-QTY      (ASC-BLK-SUB ASC-ITEM-SUB)   18360000
                        NOT = ZERO))                                    18370000
                     IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        18380000
                       SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   18390000
                           ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   18400000
                                     TO TRUE                            18410000
                       SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              18420000
                                     TO TRUE                            18430000
                       ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   18440000
                     END-IF                                             18450000
                   END-IF                                               18460000
               END-IF                                                   18470000
           END-IF.                                                      18480000
      *----------------------------------------------------------------*18490000
      *    GET THE NEXT TRANSFER NBR IF A LIST OF TRTANSFERS IS BEING  *18500000
      *    PROCESSED.                                                  *18510000
      *----------------------------------------------------------------*18520000
                                                                        18530000
       2160-GET-NEXT-TRANSFER.                                          18540000
                                                                        18550000
           ADD +1                       TO ASC-SEL-SUB.                 18560000
           IF  ASC-SEL-SUB > TF002-MAX-ITEMS                            18570000
               ADD +1                   TO ASC-SEL-ITEM                 18580000
               MOVE +1                  TO ASC-SEL-SUB                  18590000
           END-IF.                                                      18600000
           IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                18610000
               PERFORM 9100-READ-SEL-QUEUE-IN                           18620000
               IF  TF002-ITEM (ASC-SEL-SUB) > ZERO                      18630000
                   MOVE TF002-TRANSFER-NBR (ASC-SEL-SUB)                18640000
                                        TO PV-XFER-NBR                  18650000
                   MOVE PV-XFER-FROM-STORE-NBR TO                       18660000
                                                 ASC-FROM-STORE-NBR     18670000
                   MOVE PV-XFER-SEQ-NBR       TO                        18680000
                                                 ASC-XFER-SEQ-NBR       18690000
                   SET TF002-INQ (ASC-SEL-SUB) TO TRUE                  18700000
                   PERFORM 9200-REWRITE-SEL-QUEUE-IN                    18710000
               ELSE                                                     18720000
                   SUBTRACT +1 FROM ASC-SEL-SUB                         18730000
                   MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             18740000
                   SET DP020-MSG-INFORMATIONAL TO TRUE                  18750000
                   SET PS-LIST-END             TO TRUE                  18760000
               END-IF                                                   18770000
           ELSE                                                         18780000
               SUBTRACT +1 FROM ASC-SEL-ITEM                            18790000
               MOVE TF002-MAX-ITEMS     TO ASC-SEL-SUB                  18800000
               MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             18810000
               SET DP020-MSG-INFORMATIONAL TO TRUE                      18820000
               SET PS-LIST-END             TO TRUE                      18830000
           END-IF.                                                      18840000
      *----------------------------------------------------------------*18850000
      *    GET THE PREVIOUS TRANSFER IF A LIST OF TRANSFERS IS BEING   *18860000
      *    PROCESSED.                                                  *18870000
      *----------------------------------------------------------------*18880000
                                                                        18890000
       2170-GET-PREV-TRANSFER.                                          18900000
                                                                        18910000
           SUBTRACT +1 FROM ASC-SEL-SUB.                                18920000
           IF  ASC-SEL-SUB < +1                                         18930000
               SUBTRACT +1 FROM ASC-SEL-ITEM                            18940000
               MOVE TF002-MAX-ITEMS     TO ASC-SEL-SUB                  18950000
           END-IF.                                                      18960000
                                                                        18970000
           IF  ASC-SEL-ITEM > ZERO                                      18980000
               PERFORM 9100-READ-SEL-QUEUE-IN                           18990000
               MOVE TF002-TRANSFER-NBR (ASC-SEL-SUB)                    19000000
                                        TO PV-XFER-NBR                  19010000
               MOVE PV-XFER-FROM-STORE-NBR TO                           19020000
                                             ASC-FROM-STORE-NBR         19030000
               MOVE PV-XFER-SEQ-NBR       TO                            19040000
                                             ASC-XFER-SEQ-NBR           19050000
           ELSE                                                         19060000
               MOVE +1                  TO ASC-SEL-ITEM                 19070000
                                           ASC-SEL-SUB                  19080000
               MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             19090000
               SET DP020-MSG-INFORMATIONAL TO TRUE                      19100000
               SET PS-LIST-END             TO TRUE                      19110000
           END-IF.                                                      19120000
       EJECT                                                            19130000
      ******************************************************************19140000
      ** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **19150000
      ** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **19160000
      ******************************************************************19170000
       2200-MOVE-SCREEN-TO-COMMAREA.                                    19180000
                                                                        19190000
           MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             19200000
           MOVE +1                       TO PV-SUB.                     19210000
      *                                                                 19220000
           PERFORM 3100-SET-SUBSCRIPTS.                                 19230000
           IF  MR-A-STARTL > ZERO                                       19240000
               MOVE MR-A-START       TO ASC-START-ITEM-REQUEST          19250000
           ELSE                                                         19260000
               IF  MR-A-STARTA = DP015-ERASE-EOF                        19270000
                   INITIALIZE ASC-START-ITEM-REQUEST                    19280000
               END-IF                                                   19290000
           END-IF.                                                      19300000
           PERFORM 2210-MOVE-LINES-TO-COMMAREA                          19310000
               VARYING PV-SUB                                           19320000
               FROM 1 BY 1                                              19330000
               UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      19340000
      ******************************************************************19350000
      ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**19360000
      ******************************************************************19370000
       2210-MOVE-LINES-TO-COMMAREA.                                     19380000
           IF  MR-A-SELECTL (PV-SUB) > ZERO                             19390000
               SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             19400000
               MOVE MR-A-SELECT (PV-SUB)                                19410000
                                         TO ASC-TEMP-SELECTED-SW        19420000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      19430000
           ELSE                                                         19440000
               IF  MR-A-SELECTA (PV-SUB) = DP015-ERASE-EOF              19450000
                       SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     19460000
                       MOVE SPACE        TO ASC-TEMP-SELECTED-SW        19470000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      19480000
               END-IF                                                   19490000
           END-IF.                                                      19500000
           ADD +1                        TO ASC-ITEM-SUB.               19510000
           IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        19520000
               ADD +1                    TO ASC-BLK-SUB                 19530000
               MOVE +1                   TO ASC-ITEM-SUB                19540000
           END-IF.                                                      19550000
      ******************************************************************19560000
      ** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **19570000
      ** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **19580000
      ******************************************************************19590000
       3000-EDIT-DATA-IN-COMMAREA.                                      19600000
           SET PS-NO-ERROR               TO TRUE.                       19610000
           PERFORM 3200-RESET-ATTRIBUTES.                               19620000
           MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     19630000
      **                                                                19640000
      * CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              19650000
      * EDITTING IS DONE FROM THE BOTTOM UP.                            19660000
      **                                                                19670000
           COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       19680000
               ASC-ITEMS-DISPLAYED - 1.                                 19690000
           PERFORM 3100-SET-SUBSCRIPTS.                                 19700000
           PERFORM 3300-EDIT-SELECTIONS                                 19710000
               VARYING PV-SUB                                           19720000
               FROM PV-SUB BY -1                                        19730000
               UNTIL PV-SUB < +1.                                       19740000
           IF  PS-NO-ERROR                                              19750000
               PERFORM 3400-CHECK-RANGE-SEQUENCE                        19760000
           END-IF.                                                      19770000
      *                                                                 19780000
           IF  ((PS-NO-ERROR)                                           19790000
             AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   19800000
             AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    19810000
                   PERFORM 3500-MARK-RANGE-AS-SELECTED                  19820000
           END-IF.                                                      19830000
                                                                        19840000
       EJECT                                                            19850000
      *----------------------------------------------------------------*19860000
      *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *19870000
      *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*19880000
      *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *19890000
      *                                                                *19900000
      *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *19910000
      *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *19920000
      *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *19930000
      *    US IN THE 2ND BLOCK OF THE ARRAY.                           *19940000
      *----------------------------------------------------------------*19950000
                                                                        19960000
       3100-SET-SUBSCRIPTS.                                             19970000
                                                                        19980000
           COMPUTE ASC-ITEM-SUB =                                       19990000
               (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        20000000
                                                                        20010000
           IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         20020000
               PERFORM                                                  20030000
                 UNTIL ASC-ITEM-SUB NOT > PC-ITEMS-PER-PANEL            20040000
                   SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB        20050000
               END-PERFORM                                              20060000
               MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               20070000
           ELSE                                                         20080000
               MOVE +1                     TO ASC-BLK-SUB               20090000
           END-IF.                                                      20100000
      ******************************************************************20110000
      ** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **20120000
      ******************************************************************20130000
                                                                        20140000
       3200-RESET-ATTRIBUTES.                                           20150000
           MOVE DP015-UNP-ALP-NOR-OFF    TO MR-A-STARTA.                20160000
           MOVE DP015-GREEN              TO MR-A-STARTC.                20170000
           MOVE DP015-UNDERLINE          TO MR-A-STARTH.                20180000
      *                                                                 20190000
           PERFORM                                                      20200000
               VARYING PV-SUB                                           20210000
               FROM 1 BY 1                                              20220000
               UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        20230000
               IF ASC-NON-RETAIL-XFER                                   20240000
                   MOVE DP015-UNP-ALP-NOR-OFF                           20250000
                                         TO MR-B-SELECTA (PV-SUB)       20260000
                   MOVE DP015-GREEN      TO MR-B-SELECTC (PV-SUB)       20270000
                   MOVE DP015-UNDERLINE  TO MR-B-SELECTH (PV-SUB)       20280000
               ELSE                                                     20290000
                   MOVE DP015-UNP-ALP-NOR-OFF                           20300000
                                         TO MR-A-SELECTA (PV-SUB)       20310000
                   MOVE DP015-GREEN      TO MR-A-SELECTC (PV-SUB)       20320000
                   MOVE DP015-UNDERLINE  TO MR-A-SELECTH (PV-SUB)       20330000
               END-IF                                                   20340000
           END-PERFORM.                                                 20350000
      ******************************************************************20360000
      ** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **20370000
      ** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **20380000
      ** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **20390000
      ** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **20400000
      ******************************************************************20410000
       3300-EDIT-SELECTIONS.                                            20420000
           EVALUATE TRUE                                                20430000
               WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     20440000
                   = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         20450000
                       CONTINUE                                         20460000
               WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         20470000
                   IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        20480000
                       ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   20490000
                       MOVE ASC-TEMP-SELECTED-SW                        20500000
                                            (ASC-BLK-SUB ASC-ITEM-SUB)  20510000
                                      TO ASC-SELECTED-SW                20520000
                                            (ASC-BLK-SUB ASC-ITEM-SUB)  20530000
                   END-IF                                               20540000
               WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     20550000
                       = SPACE                                          20560000
                   EVALUATE TRUE                                        20570000
                       WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       20580000
                           SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS20590000
                           MOVE SPACE TO ASC-SELECTED-SW                20600000
                                            (ASC-BLK-SUB ASC-ITEM-SUB)  20610000
                       WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        20620000
                           MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    20630000
                           MOVE SPACE TO ASC-SELECTED-SW                20640000
                                            (ASC-BLK-SUB ASC-ITEM-SUB)  20650000
                       WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          20660000
                           MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      20670000
                           MOVE SPACE TO ASC-SELECTED-SW                20680000
                                            (ASC-BLK-SUB ASC-ITEM-SUB)  20690000
                   END-EVALUATE                                         20700000
               WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           20710000
                   IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            20720000
                       SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    20730000
                   END-IF                                               20740000
                   PERFORM 3310-EDIT-RANGE                              20750000
               WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             20760000
                   IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            20770000
                       SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    20780000
                   END-IF                                               20790000
                   PERFORM 3310-EDIT-RANGE                              20800000
               WHEN OTHER                                               20810000
                   MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           20820000
                   SET DP020-MSG-FATAL    TO TRUE                       20830000
                   IF ASC-NON-RETAIL-XFER                               20840000
                       MOVE -1            TO MR-B-SELECTL (PV-SUB)      20850000
                       SET DP030-SET-CURSOR-APPL-1                      20860000
                                          TO TRUE                       20870000
                       MOVE DP015-RED     TO MR-B-SELECTC (PV-SUB)      20880000
                       MOVE DP015-REVERSE TO MR-B-SELECTH (PV-SUB)      20890000
                   ELSE                                                 20900000
                       MOVE -1            TO MR-A-SELECTL (PV-SUB)      20910000
                       SET DP030-SET-CURSOR-APPL-1                      20920000
                                          TO TRUE                       20930000
                       MOVE DP015-RED     TO MR-A-SELECTC (PV-SUB)      20940000
                       MOVE DP015-REVERSE TO MR-A-SELECTH (PV-SUB)      20950000
                   END-IF                                               20960000
                   SET PS-ERROR TO TRUE                                 20970000
                   IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            20980000
                       SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     20990000
                       MOVE SPACE         TO ASC-SELECTED-SW            21000000
                                              (ASC-BLK-SUB ASC-ITEM-SUB)21010000
                   END-IF                                               21020000
           END-EVALUATE.                                                21030000
                                                                        21040000
           SUBTRACT +1             FROM PV-ITEM-IN-USE.                 21050000
           SUBTRACT +1 FROM ASC-ITEM-SUB.                               21060000
           IF  ASC-ITEM-SUB < 1                                         21070000
               SUBTRACT +1 FROM ASC-BLK-SUB                             21080000
               MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                21090000
           END-IF.                                                      21100000
      ******************************************************************21110000
      ** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **21120000
      ** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **21130000
      ** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**21140000
      ** THE ENDING.                                                  **21150000
      ******************************************************************21160000
       3310-EDIT-RANGE.                                                 21170000
           IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                21180000
               IF  ASC-START-OF-SELECTED-RANGE = ZERO                   21190000
                   MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)21200000
                                         TO ASC-SELECTED-SW             21210000
                                              (ASC-BLK-SUB ASC-ITEM-SUB)21220000
                   MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 21230000
               ELSE                                                     21240000
                   IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     21250000
                       CONTINUE                                         21260000
                   ELSE                                                 21270000
      *                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        21280000
                       MOVE PC-TSYMSG-00054                             21290000
                                         TO DP020-MSG-NUMBER            21300000
                       SET DP020-MSG-FATAL                              21310000
                                         TO TRUE                        21320000
                       MOVE -1           TO MR-A-SELECTL (PV-SUB)       21330000
                       SET DP030-SET-CURSOR-APPL-1                      21340000
                                         TO TRUE                        21350000
                       MOVE DP015-RED    TO MR-A-SELECTC (PV-SUB)       21360000
                       MOVE DP015-UNDERLINE                             21370000
                                         TO MR-A-SELECTH (PV-SUB)       21380000
                       SET PS-ERROR      TO TRUE                        21390000
                   END-IF                                               21400000
               END-IF                                                   21410000
           ELSE                                                         21420000
               IF  ASC-END-OF-SELECTED-RANGE = ZERO                     21430000
                   MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 21440000
                                         TO ASC-SELECTED-SW             21450000
                                           (ASC-BLK-SUB ASC-ITEM-SUB)   21460000
                   MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   21470000
               ELSE                                                     21480000
                   IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       21490000
                       CONTINUE                                         21500000
                   ELSE                                                 21510000
      *                -- ONLY ONE END-OF-RANGE ALLOWED --              21520000
                       MOVE PC-TSYMSG-00055                             21530000
                                         TO DP020-MSG-NUMBER            21540000
                       SET DP020-MSG-FATAL                              21550000
                                         TO TRUE                        21560000
                       MOVE -1           TO MR-A-SELECTL (PV-SUB)       21570000
                       SET DP030-SET-CURSOR-APPL-1                      21580000
                                         TO TRUE                        21590000
                       SET PS-ERROR      TO TRUE                        21600000
                   END-IF                                               21610000
               END-IF                                                   21620000
           END-IF.                                                      21630000
      *                                                                 21640000
      ******************************************************************21650000
      ** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **21660000
      ** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **21670000
      ******************************************************************21680000
       3400-CHECK-RANGE-SEQUENCE.                                       21690000
           IF  ASC-START-OF-SELECTED-RANGE > ZERO                       21700000
             AND  ASC-END-OF-SELECTED-RANGE > ZERO                      21710000
             AND  ASC-START-OF-SELECTED-RANGE >                         21720000
                                               ASC-END-OF-SELECTED-RANGE21730000
      *        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                21740000
               MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 21750000
               SET DP020-MSG-FATAL TO TRUE                              21760000
               SET PS-ERROR TO TRUE                                     21770000
               PERFORM 3410-POSITION-AT-ERROR                           21780000
           END-IF.                                                      21790000
      ******************************************************************21800000
      ** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **21810000
      ** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **21820000
      ** SHOULD BE POSITIONED ON A RANGE ERROR.                       **21830000
      ******************************************************************21840000
       3410-POSITION-AT-ERROR.                                          21850000
           SET DP030-SET-CURSOR-APPL-1                                  21860000
                                         TO TRUE.                       21870000
           COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 21880000
                          - PV-TOP-ITEM + 1.                            21890000
           IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21900000
               CONTINUE                                                 21910000
           ELSE                                                         21920000
               MOVE -1                   TO MR-A-SELECTL (PV-SUB)       21930000
               MOVE DP015-REVERSE        TO MR-A-SELECTH (PV-SUB)       21940000
               MOVE DP015-RED            TO MR-A-SELECTC (PV-SUB)       21950000
           END-IF.                                                      21960000
      *                                                                 21970000
       EJECT                                                            21980000
      *----------------------------------------------------------------*21990000
      *    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *22000000
      *    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *22010000
      *    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *22020000
      *----------------------------------------------------------------*22030000
                                                                        22040000
       3500-MARK-RANGE-AS-SELECTED.                                     22050000
           MOVE +1                       TO  ASC-BLK-SUB.               22060000
           PERFORM 3510-MARK-SELECTED-INDS                              22070000
               VARYING ASC-ITEM-SUB                                     22080000
               FROM 1 BY 1                                              22090000
               UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 22100000
                                                                        22110000
           ADD +1                        TO ASC-BLK-SUB.                22120000
           PERFORM 3510-MARK-SELECTED-INDS                              22130000
               VARYING ASC-ITEM-SUB                                     22140000
               FROM 1 BY 1                                              22150000
               UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 22160000
                                                                        22170000
           MOVE ASC-LIST-ITEM-NUMBER(1 1)                               22180000
                                         TO  PV-LIST-ITEM-NUMBER.       22190000
           COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            22200000
               1 + ((PV-LIST-ITEM-NUMBER - 1) /                         22210000
                     PC-ITEMS-PER-PANEL).                               22220000
                                                                        22230000
           MOVE ASC-START-OF-SELECTED-RANGE                             22240000
                                         TO PV-START-OF-SELECTED-RANGE. 22250000
           COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            22260000
               1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  22270000
                     PC-ITEMS-PER-PANEL).                               22280000
                                                                        22290000
           MOVE ASC-END-OF-SELECTED-RANGE                               22300000
                                         TO  PV-END-OF-SELECTED-RANGE.  22310000
           COMPUTE PV-LAST-BLOCK-IN-RANGE =                             22320000
               1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    22330000
                     PC-ITEMS-PER-PANEL).                               22340000
           COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             22350000
               PV-FIRST-BLOCK-IN-ARRAY + 1.                             22360000
                                                                        22370000
           IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    22380000
              (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        22390000
               MOVE +1                   TO ASC-BLK-SUB                 22400000
               PERFORM 5100-WRITE-TEMP-STORAGE                          22410000
               COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         22420000
                   PV-FIRST-BLOCK-IN-ARRAY - 1                          22430000
                                                                        22440000
               PERFORM                                                  22450000
                   UNTIL PV-FIRST-BLOCK-IN-RANGE >                      22460000
                         PV-PREV-BLOCK-IN-ARRAY                         22470000
                   MOVE PV-FIRST-BLOCK-IN-RANGE                         22480000
                                         TO PV-BLOCK-NUMBER             22490000
                   PERFORM 4410-READ-TEMP-STORAGE                       22500000
                   PERFORM 3510-MARK-SELECTED-INDS                      22510000
                       VARYING ASC-ITEM-SUB                             22520000
                       FROM 1 BY 1                                      22530000
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          22540000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      22550000
                   ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     22560000
               END-PERFORM                                              22570000
                                                                        22580000
               COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         22590000
                   PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     22600000
               PERFORM                                                  22610000
                   UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       22620000
                         PV-LAST-BLOCK-IN-RANGE                         22630000
                   MOVE PV-NEXT-BLOCK-IN-ARRAY                          22640000
                                         TO PV-BLOCK-NUMBER             22650000
                   PERFORM 4410-READ-TEMP-STORAGE                       22660000
                   PERFORM 3510-MARK-SELECTED-INDS                      22670000
                       VARYING ASC-ITEM-SUB                             22680000
                       FROM 1 BY 1                                      22690000
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          22700000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      22710000
                   ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      22720000
               END-PERFORM                                              22730000
                                                                        22740000
               MOVE PV-FIRST-BLOCK-IN-ARRAY                             22750000
                                         TO PV-BLOCK-NUMBER             22760000
               PERFORM 4410-READ-TEMP-STORAGE                           22770000
           END-IF.                                                      22780000
                                                                        22790000
           MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 22800000
                                            ASC-END-OF-SELECTED-RANGE.  22810000
                                                                        22820000
       EJECT                                                            22830000
      *----------------------------------------------------------------*22840000
      * SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *22850000
      *----------------------------------------------------------------*22860000
                                                                        22870000
       3510-MARK-SELECTED-INDS.                                         22880000
                                                                        22890000
           IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         22900000
                                      ASC-ITEM-SUB) >                   22910000
               ASC-START-OF-SELECTED-RANGE)                             22920000
           OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         22930000
                                      ASC-ITEM-SUB) =                   22940000
               ASC-START-OF-SELECTED-RANGE)                             22950000
                                                                        22960000
               IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     22970000
                                          ASC-ITEM-SUB) <               22980000
                   ASC-END-OF-SELECTED-RANGE)                           22990000
               OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     23000000
                                          ASC-ITEM-SUB) =               23010000
                   ASC-END-OF-SELECTED-RANGE)                           23020000
                                                                        23030000
                   IF ASC-NON-RETAIL-XFER                               23040000
                     IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        23050000
                       SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   23060000
                           ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   23070000
                                     TO TRUE                            23080000
                       SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              23090000
                                     TO TRUE                            23100000
                       ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    23110000
                     END-IF                                             23120000
                   ELSE                                                 23130000
                     IF NOT (ASC-XFER-PRICE (ASC-BLK-SUB ASC-ITEM-SUB)  23140000
                       NOT = ASC-RECV-PRICE  (ASC-BLK-SUB ASC-ITEM-SUB) 23150000
                     AND (ASC-RECV-PRICE    (ASC-BLK-SUB ASC-ITEM-SUB)  23160000
                        NOT = ZERO                                      23170000
                     OR  ASC-RECV-QTY      (ASC-BLK-SUB ASC-ITEM-SUB)   23180000
                        NOT = ZERO))                                    23190000
                     IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        23200000
                       SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   23210000
                           ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   23220000
                                     TO TRUE                            23230000
                       SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              23240000
                                     TO TRUE                            23250000
                       ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    23260000
                     END-IF                                             23270000
                     END-IF                                             23280000
                   END-IF                                               23290000
               END-IF                                                   23300000
           END-IF.                                                      23310000
                                                                        23320000
       EJECT                                                            23330000
      *----------------------------------------------------------------*23340000
      *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *23350000
      *    INITIALIZE ALL COUNTERS AND FLAGS.                          *23360000
      *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *23370000
      *    DISPLAY THE PANEL TO USER.                                  *23380000
      *----------------------------------------------------------------*23390000
                                                                        23400000
       4000-BUILD-INITIAL-PANEL.                                        23410000
                                                                        23420000
           INITIALIZE                  ASC-BLOCK-ENTRIES (1)            23430000
                                       ASC-BLOCK-ENTRIES (2).           23440000
           MOVE +1                 TO ASC-BLK-SUB.                      23450000
           SET ASC-ITEMS-LEFT-ON-DB                                     23460000
               ASC-NO-ADJUSTMENTS-EXIST  TO TRUE.                       23470000
                                                                        23480000
           MOVE +0                 TO ASC-ITEM-SUB                      23490000
                                      ASC-NUMBER-OF-ITEMS-READ          23500000
                                      ASC-NUMBER-OF-SELECTED-ITEMS      23510000
                                      ASC-HIGHEST-BLOCK-WRITTEN         23520000
                                      ASC-START-OF-SELECTED-RANGE       23530000
                                      ASC-END-OF-SELECTED-RANGE         23540000
                                      ASC-ITEM-AT-TOP-OF-PANEL.         23550000
           MOVE ASC-XFER-DKEY-ID   TO DK-XFER-DKEY-ID.                  23560000
           PERFORM 4010-OPEN-CURSOR.                                    23570000
                                                                        23580000
           PERFORM 4300-READ-ITEMS-FROM-DB.                             23590000
                                                                        23600000
           PERFORM 4020-CLOSE-CURSOR.                                   23610000
                                                                        23620000
           MOVE +1                   TO  PV-TOP-ITEM                    23630000
           IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          23640000
               SET DP020-MSG-FATAL   TO  TRUE                           23650000
               MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               23660000
           ELSE                                                         23670000
               MOVE -1               TO MR-A-SELECTL (1)                23680000
               SET DP030-SET-CURSOR-APPL-1                              23690000
                                         TO TRUE                        23700000
           END-IF.                                                      23710000
           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        23720000
       EJECT                                                            23730000
      *----------------------------------------------------------------*23740000
      * OPEN THE TRANSFER ITEM CURSOR.                                 *23750000
      *----------------------------------------------------------------*23760000
                                                                        23770000
       4010-OPEN-CURSOR.                                                23780000
           PERFORM                                                      23790000
               WITH TEST AFTER                                          23800000
               VARYING PV-RETRY-COUNTER                                 23810000
               FROM 1 BY 1                                              23820000
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               23830000
                         OR (SQLCODE = ZERO))                           23840000
                   EXEC SQL                                             23850000
                        OPEN XFER-ITEM-CSR                              23860000
                   END-EXEC                                             23870000
                                                                        23880000
               EVALUATE TRUE                                            23890000
                   WHEN SQLCODE = ZERO                                  23900000
                   WHEN SQLCODE = -904                                  23910000
                   WHEN SQLCODE = -913                                  23920000
                       CONTINUE                                         23930000
                   WHEN OTHER                                           23940000
                       MOVE '4010-OPEN-CURSOR'                          23970000
                                         TO DP013-PARAGRAPH             23980000
                       MOVE 'OPEN TRANSFER ITEM CURSOR - '              23990000
                                         TO DP013-MESSAGE-TEXT (1)      24000000
                       MOVE SQLCA        TO DP013-SQLCA                 24010000
                       MOVE 'TTFITEM '   TO DP013-DB2-TABLE-NAME (1)    24020000
                       SET DP013-DB2-ABEND                              24030000
                           DP013-XCTL-DISPLAY-RESTART TO TRUE           24040000
                       PERFORM DP013-0000-PROCESS-ABEND                 24050000
               END-EVALUATE                                             24060000
           END-PERFORM.                                                 24070000
      *                                                                 24080000
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        24090000
               MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             24100000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   24110000
                                         TO DP013-MESSAGE-TEXT (1)      24120000
               MOVE SQLCA                TO DP013-SQLCA                 24130000
               MOVE 'TTFITEM '           TO DP013-DB2-TABLE-NAME (1)    24140000
               SET DP013-DB2-ABEND                                      24150000
                   DP013-XCTL-DISPLAY-RESTART                           24160000
                                         TO TRUE                        24170000
               PERFORM DP013-0000-PROCESS-ABEND                         24180000
           END-IF.                                                      24190000
                                                                        24200000
       EJECT                                                            24210000
      *----------------------------------------------------------------*24220000
      * CLOSE THE TRANSFER ITEM CURSOR.                                *24230000
      *----------------------------------------------------------------*24240000
                                                                        24250000
       4020-CLOSE-CURSOR.                                               24260000
           EXEC SQL                                                     24270000
               CLOSE XFER-ITEM-CSR                                      24280000
           END-EXEC                                                     24290000
      *                                                                 24300000
           EVALUATE TRUE                                                24310000
               WHEN SQLCODE = ZERO                                      24320000
                   CONTINUE                                             24330000
               WHEN OTHER                                               24340000
                   MOVE '4020-CLOSE-CURSOR'                             24370000
                                     TO DP013-PARAGRAPH                 24380000
                   MOVE 'CLOSE TRANSFER ITEM CURSOR '                   24390000
                                     TO DP013-MESSAGE-TEXT (1)          24400000
                   MOVE SQLCA        TO DP013-SQLCA                     24410000
                   MOVE 'TTFITEM '   TO DP013-DB2-TABLE-NAME (1)        24420000
                   SET DP013-DB2-ABEND                                  24430000
                       DP013-XCTL-DISPLAY-RESTART TO TRUE               24440000
                   PERFORM DP013-0000-PROCESS-ABEND                     24450000
           END-EVALUATE.                                                24460000
                                                                        24470000
       EJECT                                                            24480000
      *----------------------------------------------------------------*24490000
      *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *24500000
      *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *24510000
      *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *24520000
      *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *24530000
      *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *24540000
      *                                                                *24550000
      *    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *24560000
      *    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *24570000
      *    UPON INITIALIZATION.                                        *24580000
      *----------------------------------------------------------------*24590000
                                                                        24600000
       4300-READ-ITEMS-FROM-DB.                                         24610000
                                                                        24620000
           PERFORM                                                      24630000
               VARYING PV-READ-COUNT                                    24640000
               FROM 1 BY 1                                              24650000
               UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    24660000
                  OR (ASC-NO-ITEMS-LEFT-ON-DB))                         24670000
                                                                        24680000
               PERFORM 4310-FETCH                                       24690000
                                                                        24700000
               IF  ASC-ITEMS-LEFT-ON-DB                                 24710000
                   IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                24720000
                       ADD +1            TO ASC-ITEM-SUB                24730000
                   ELSE                                                 24740000
                       ADD +1            TO ASC-BLK-SUB                 24750000
                       MOVE +1           TO ASC-ITEM-SUB                24760000
                                                                        24770000
                       IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         24780000
                           MOVE +1       TO ASC-BLK-SUB                 24790000
                           SET ASC-BLOCK-MODIFIED (1)                   24800000
                                         TO TRUE                        24810000
                           PERFORM 5100-WRITE-TEMP-STORAGE              24820000
                           MOVE ASC-BLOCK-ENTRIES                       24830000
                                     (PC-MAX-BLOCKS-IN-ARRAY)           24840000
                                      TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 24850000
                           ADD +1        TO ASC-BLK-SUB                 24860000
                           INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   24870000
                           SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      24880000
                                         TO TRUE                        24890000
                       END-IF                                           24900000
                   END-IF                                               24910000
                   ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    24920000
                   MOVE ASC-NUMBER-OF-ITEMS-READ                        24930000
                                         TO ASC-LIST-ITEM-NUMBER        24940000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 24950000
                   MOVE TFITEM-XFER-LNE-NBR              TO             24960000
                           ASC-LINE          (ASC-BLK-SUB ASC-ITEM-SUB) 24970000
                   MOVE SKXREF-DEPT                      TO             24980000
                           ASC-DEPT          (ASC-BLK-SUB ASC-ITEM-SUB) 24990000
                   MOVE SKXREF-CLASS                     TO             25000000
                           ASC-CLASS         (ASC-BLK-SUB ASC-ITEM-SUB) 25010000
                   MOVE SKXREF-SUBCLASS                  TO             25020000
                           ASC-SUBCLASS      (ASC-BLK-SUB ASC-ITEM-SUB) 25030000
                   MOVE TFITEM-KOHLS-UPC-NBR             TO             25040000
                           ASC-UPC           (ASC-BLK-SUB ASC-ITEM-SUB) 25050000
                   MOVE TFITEM-XFER-QTY                  TO             25060000
                           ASC-XFER-QTY      (ASC-BLK-SUB ASC-ITEM-SUB) 25070000
                   MOVE TFITEM-XFER-PRIC-AMT             TO             25080000
                           ASC-XFER-PRICE    (ASC-BLK-SUB ASC-ITEM-SUB) 25090000
                   MOVE TFITEM-CPLD-RTL-PRIC-AMT         TO             25100000
                           ASC-FILE-PRICE    (ASC-BLK-SUB ASC-ITEM-SUB) 25110000
                   MOVE TFITEM-NRTL-1ST-LNE-DESC         TO             25120000
                           ASC-DESCRIPTION-1 (ASC-BLK-SUB ASC-ITEM-SUB) 25130000
                   MOVE TFITEM-NRTL-2ND-LNE-DESC         TO             25140000
                           ASC-DESCRIPTION-2 (ASC-BLK-SUB ASC-ITEM-SUB) 25150000
                   PERFORM 5300-READ-ADJUSTMENTS                        25160000
                   PERFORM 5400-READ-ITEM-RECEIPT                       25170000
                   MOVE TFITRC-RCVD-XFER-QTY             TO             25180000
                           ASC-RECV-QTY      (ASC-BLK-SUB ASC-ITEM-SUB) 25190000
                   MOVE TFITRC-RCVD-XFER-PRIC-AMT        TO             25200000
                           ASC-RECV-PRICE    (ASC-BLK-SUB ASC-ITEM-SUB) 25210000
                                                                        25220000
                   SET ASC-ITEMS-LEFT-ON-DB-2            TO TRUE        25230000
                                                                        25240000
                   PERFORM 5500-OPEN-RECEIPT-CURSOR                     25250000
                                                                        25260000
                   PERFORM 5600-READ-RECEIPT-ITEMS                      25270000
                                                                        25280000
                   PERFORM 5700-CLOSE-RECEIPT-CURSOR                    25290000
                                                                        25300000
               END-IF                                                   25310000
           END-PERFORM.                                                 25320000
                                                                        25330000
           IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          25340000
               MOVE +1               TO ASC-BLK-SUB                     25350000
               PERFORM 5100-WRITE-TEMP-STORAGE                          25360000
               ADD +1                TO ASC-BLK-SUB                     25370000
               PERFORM 5100-WRITE-TEMP-STORAGE                          25380000
                                                                        25390000
               MOVE 1                TO ASC-BLK-SUB                     25400000
                                        PV-BLOCK-NUMBER                 25410000
               PERFORM 4410-READ-TEMP-STORAGE                           25420000
               IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             25430000
                   MOVE 2            TO ASC-BLK-SUB                     25440000
                                        PV-BLOCK-NUMBER                 25450000
                   PERFORM 4410-READ-TEMP-STORAGE                       25460000
               END-IF                                                   25470000
           END-IF.                                                      25480000
       EJECT                                                            25490000
      *----------------------------------------------------------------*25500000
      *    FETCH THE TRANSFER ITEM CURSOR.                             *25510000
      *----------------------------------------------------------------*25520000
                                                                        25530000
       4310-FETCH.                                                      25540000
                                                                        25550000
           EXEC SQL                                                     25560000
               FETCH XFER-ITEM-CSR                                      25570000
               INTO                                                     25580000
                      :TFITEM-XFER-LNE-NBR                              25590000
                    , :TFITEM-CPLD-RTL-PRIC-AMT                         25600000
                    , :TFITEM-KOHLS-UPC-NBR                             25610000
                    , :TFITEM-NRTL-1ST-LNE-DESC                         25620000
                    , :TFITEM-NRTL-2ND-LNE-DESC                         25630000
                    , :TFITEM-XFER-PRIC-AMT                             25640000
                    , :TFITEM-XFER-QTY                                  25650000
                    , :TFITEM-ITM-NBR                                   25660000
           END-EXEC                                                     25670000
                                                                        25680000
           EVALUATE TRUE                                                25690000
               WHEN SQLCODE = ZERO                                      25700000
                    PERFORM 4320-SELECT-DEPT-CLASS                      25710000
               WHEN SQLCODE = +100                                      25720000
                    SET ASC-NO-ITEMS-LEFT-ON-DB                         25730000
                                         TO TRUE                        25740000
               WHEN OTHER                                               25750000
                    MOVE '4310-FETCH-CURSOR'                            25770000
                                     TO DP013-PARAGRAPH                 25780000
                    MOVE 'FETCH TRANSFER ITEM CURSOR'                   25790000
                                     TO DP013-MESSAGE-TEXT (1)          25800000
                    MOVE 'TTFITEM '  TO DP013-DB2-TABLE-NAME (1)        25810000
                    MOVE SQLCA       TO DP013-SQLCA                     25820000
                    SET DP013-DB2-ABEND                                 25830000
                                     TO TRUE                            25840000
                    PERFORM DP013-0000-PROCESS-ABEND                    25850000
           END-EVALUATE.                                                25860000
                                                                        25870000
       EJECT                                                            25880000
                                                                        25890000
       4320-SELECT-DEPT-CLASS.                                          25900000
           INITIALIZE DCLTSKXREF.                                       25910000
                                                                        25920000
           EXEC SQL                                                     25930000
               SELECT  DEPT                                             25940000
                      ,CLASS                                            25950000
                      ,SUBCLASS                                         25960000
                 INTO  :SKXREF-DEPT                                     25970000
                      ,:SKXREF-CLASS                                    25980000
                      ,:SKXREF-SUBCLASS                                 25990000
                 FROM  TSKXREF                                          26000000
                WHERE  ITM_NBR  =  :TFITEM-ITM-NBR                      26010000
           END-EXEC.                                                    26020000
                                                                        26030000
           EVALUATE TRUE                                                26040000
               WHEN SQLCODE = ZERO                                      26050000
                    CONTINUE                                            26060000
               WHEN SQLCODE = +100                                      26070000
                   MOVE TFITEM-KOHLS-UPC-NBR TO PV-HOLD-UPC-NBR-9       26080000
                   MOVE PV-KOHLS-DEPT TO SKXREF-DEPT                    26090000
                   MOVE PV-KOHLS-CL-9 TO SKXREF-SUBCLASS                26100000
                   MOVE ZERO          TO PV-KOHLS-CL-2                  26110000
                   MOVE PV-KOHLS-CL-9 TO SKXREF-CLASS                   26120000
               WHEN OTHER                                               26130000
                    MOVE '4320-SELECT-DEPT-CLASS'                       26150000
                                     TO DP013-PARAGRAPH                 26160000
                    MOVE 'SELECT DEPARTMENT'                            26170000
                                     TO DP013-MESSAGE-TEXT (1)          26180000
                    MOVE 'TSKXREF '  TO DP013-DB2-TABLE-NAME (1)        26190000
                    MOVE SQLCA       TO DP013-SQLCA                     26200000
                    SET DP013-DB2-ABEND                                 26210000
                                     TO TRUE                            26220000
                    PERFORM DP013-0000-PROCESS-ABEND                    26230000
           END-EVALUATE.                                                26240000
                                                                        26250000
      *----------------------------------------------------------------*26260000
      * MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *26270000
      *----------------------------------------------------------------*26280000
                                                                        26290000
       4400-MOVE-COMMAREA-TO-SCREEN.                                    26300000
           IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             26310000
               AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          26320000
               OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          26330000
                   MOVE +1    TO ASC-BLK-SUB                            26340000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      26350000
                   ADD +1     TO ASC-BLK-SUB                            26360000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      26370000
                   DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             26380000
                       GIVING PV-BLOCK-NUMBER                           26390000
                       REMAINDER PV-REMAINDER                           26400000
                   IF  PV-REMAINDER > ZERO                              26410000
                       ADD +1 TO PV-BLOCK-NUMBER                        26420000
                   END-IF                                               26430000
                   MOVE +1    TO ASC-BLK-SUB                            26440000
                   PERFORM 4410-READ-TEMP-STORAGE                       26450000
                   ADD +1     TO ASC-BLK-SUB                            26460000
                                 PV-BLOCK-NUMBER                        26470000
                   PERFORM 4410-READ-TEMP-STORAGE                       26480000
           END-IF.                                                      26490000
           MOVE +1            TO ASC-BLK-SUB.                           26500000
           COMPUTE ASC-ITEM-SUB =                                       26510000
               ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              26520000
               + PC-ITEMS-PER-PANEL).                                   26530000
      *                                                                 26540000
           IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        26550000
               ADD +1         TO ASC-BLK-SUB                            26560000
               SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            26570000
           END-IF.                                                      26580000
      *                                                                 26590000
           COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           26600000
               ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                26610000
           MOVE +1                       TO PV-SAVE-SUB.                26620000
           PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        26630000
           PERFORM 4420-FORMAT-LIST-LINES                               26640000
               VARYING PV-SUB                                           26650000
               FROM PC-ITEMS-PER-PANEL BY -1                            26660000
               UNTIL PV-SUB < +1.                                       26670000
      *                                                                 26680000
           COMPUTE ASC-ITEMS-DISPLAYED =                                26690000
               ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          26700000
           MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    26710000
                                            MR-A-START.                 26720000
           MOVE ASC-ITEM-AT-BOT-OF-PANEL TO MR-A-END.                   26730000
           MOVE ASC-NUMBER-OF-ITEMS-READ TO MR-A-TOTAL.                 26740000
           MOVE ASC-FROM-STORE-NBR       TO PV-XFER-FROM-STORE-NBR.     26750000
           MOVE ASC-XFER-SEQ-NBR         TO PV-XFER-SEQ-NBR.            26760000
           MOVE PV-XFER-NBR              TO MR-A-XFER-NBR.              26770000
           MOVE ASC-XFER-STATUS          TO MR-A-STATUS-CODE.           26780000
           MOVE ASC-XFER-STATUS-DESC     TO MR-A-STATUS-DESC.           26790000
      *                                                                 26800000
           IF  DP020-MSG-NUMBER-X = SPACE                               26810000
               IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  26820000
      *            --- MORE ITEMS TO DISPLAY ----                       26830000
                   MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            26840000
                   SET DP020-MSG-INFORMATIONAL TO TRUE                  26850000
               END-IF                                                   26860000
           END-IF.                                                      26870000
           IF ASC-NON-RETAIL-XFER                                       26880000
               MOVE PC-NON-RETAIL-ITEM-MAP-NAME                         26890000
                                       TO DP030-MAP-NAME (1)            26900000
               MOVE LENGTH OF MR-B-NON-RETAIL                           26910000
                                       TO DP030-MAP-LENGTH (1)          26920000
           ELSE                                                         26930000
               MOVE PC-RETAIL-ITEM-MAP-NAME                             26940000
                                       TO DP030-MAP-NAME (1)            26950000
               MOVE LENGTH OF MR-A-RETAIL                               26960000
                                       TO DP030-MAP-LENGTH (1)          26970000
           END-IF.                                                      26980000
                                                                        26990000
      *----------------------------------------------------------------*27000000
      *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *27010000
      *----------------------------------------------------------------*27020000
                                                                        27030000
       4410-READ-TEMP-STORAGE.                                          27040000
                                                                        27050000
           EXEC CICS                                                    27060000
               READQ TS                                                 27070000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          27080000
                   INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               27090000
                   ITEM  (PV-BLOCK-NUMBER)                              27100000
                   RESP  (PV-CICS-RESP)                                 27110000
           END-EXEC.                                                    27120000
                                                                        27130000
           IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       27140000
             OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     27150000
               CONTINUE                                                 27160000
           ELSE                                                         27170000
               SET DP013-CICS-ABEND     TO TRUE                         27180000
               SET DP013-NO-ROLLBACK    TO TRUE                         27190000
               MOVE '4410-READ-TEMP-STORAGE'                            27200000
                                        TO DP013-PARAGRAPH              27210000
               MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      27220000
                                        TO DP013-MESSAGE-TEXT(1)        27230000
               PERFORM DP013-0000-PROCESS-ABEND                         27240000
           END-IF.                                                      27250000
                                                                        27260000
           SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             27270000
      *                                                                 27280000
           IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         27290000
               INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               27300000
           END-IF.                                                      27310000
       EJECT                                                            27320000
      *----------------------------------------------------------------*27330000
      *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *27340000
      *----------------------------------------------------------------*27350000
                                                                        27360000
       4420-FORMAT-LIST-LINES.                                          27370000
           IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      27380000
               SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                27390000
               IF ASC-NON-RETAIL-XFER                                   27400000
                   MOVE DP015-ASK-DRK-OFF  TO MR-B-SELECTA (PV-SUB)     27410000
                   MOVE DP015-HL-OFF       TO MR-B-SELECTH (PV-SUB)     27420000
                   MOVE SPACE          TO MR-B-SELECT (PV-SUB)          27430000
                                          MR-B-ACTION (PV-SUB)          27440000
                                          MR-B-LINE-NBR-X (PV-SUB)      27450000
                                          MR-B-DESC   (PV-SUB)          27460000
                                          MR-B-TQTY-X (PV-SUB)          27470000
                                          MR-B-RQTY-X (PV-SUB)          27480000
               ELSE                                                     27490000
                   MOVE DP015-ASK-DRK-OFF  TO MR-A-SELECTA (PV-SUB)     27500000
                   MOVE DP015-HL-OFF       TO MR-A-SELECTH (PV-SUB)     27510000
                   MOVE SPACE          TO MR-A-SELECT (PV-SUB)          27520000
                                          MR-A-ACTION (PV-SUB)          27530000
                                          MR-A-LINE-NBR-X (PV-SUB)      27540000
                                          MR-A-DPT-CL-SUBCL (PV-SUB)    27550000
                                          MR-A-UPC    (PV-SUB)          27560000
                                          MR-A-TQTY-X (PV-SUB)          27570000
                                          MR-A-RQTY-X (PV-SUB)          27580000
                                          MR-A-TPRICE-X (PV-SUB)        27590000
                                          MR-A-RPRICE-X (PV-SUB)        27600000
                                          MR-A-FPRICE-X (PV-SUB)        27610000
               END-IF                                                   27620000
           ELSE                                                         27630000
               IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      27640000
                                                         > SPACE        27650000
                   IF ASC-NON-RETAIL-XFER                               27660000
                       MOVE ASC-TEMP-SELECTED-SW                        27670000
                                            (ASC-BLK-SUB ASC-ITEM-SUB)  27680000
                                       TO MR-B-SELECT (PV-SUB)          27690000
                   ELSE                                                 27700000
                       MOVE ASC-TEMP-SELECTED-SW                        27710000
                                            (ASC-BLK-SUB ASC-ITEM-SUB)  27720000
                                       TO MR-A-SELECT (PV-SUB)          27730000
                   END-IF                                               27740000
               ELSE                                                     27750000
                   IF ASC-NON-RETAIL-XFER                               27760000
                       MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)  27770000
                                       TO MR-B-SELECT (PV-SUB)          27780000
                   ELSE                                                 27790000
                       MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)  27800000
                                       TO MR-A-SELECT (PV-SUB)          27810000
                   END-IF                                               27820000
               END-IF                                                   27830000
      *                                                                 27840000
               IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           27850000
                   IF ASC-NON-RETAIL-XFER                               27860000
                       MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)  27870000
                                       TO MR-B-SELECT (PV-SUB)          27880000
                       MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)       27890000
                                       TO MR-B-ACTION (PV-SUB)          27900000
                       MOVE ASC-LINE     (ASC-BLK-SUB ASC-ITEM-SUB)     27910000
                                       TO MR-B-LINE-NBR (PV-SUB)        27920000
                       MOVE ASC-DESCRIPTION (ASC-BLK-SUB ASC-ITEM-SUB)  27930000
                                       TO MR-B-DESC   (PV-SUB)          27940000
                       MOVE ASC-XFER-QTY    (ASC-BLK-SUB ASC-ITEM-SUB)  27950000
                                       TO MR-B-TQTY   (PV-SUB)          27960000
                       MOVE ASC-RECV-QTY    (ASC-BLK-SUB ASC-ITEM-SUB)  27970000
                                       TO MR-B-RQTY   (PV-SUB)          27980000
                   ELSE                                                 27990000
                       MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)  28000000
                                       TO MR-A-SELECT (PV-SUB)          28010000
                       MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)       28020000
                                       TO MR-A-ACTION (PV-SUB)          28030000
                       IF ASC-XFER-PRICE    (ASC-BLK-SUB ASC-ITEM-SUB)  28040000
                          = ASC-RECV-PRICE  (ASC-BLK-SUB ASC-ITEM-SUB)  28050000
                       OR (ASC-RECV-PRICE    (ASC-BLK-SUB ASC-ITEM-SUB) 28060000
                          = ZERO                                        28070000
                       AND ASC-RECV-QTY      (ASC-BLK-SUB ASC-ITEM-SUB) 28080000
                          = ZERO)                                       28090000
                       OR PV-SUB = 1                                    28100000
                           MOVE ASC-LINE    (ASC-BLK-SUB ASC-ITEM-SUB)  28110000
                                       TO MR-A-LINE-NBR (PV-SUB)        28120000
                           MOVE ASC-DEPT    (ASC-BLK-SUB ASC-ITEM-SUB)  28130000
                                       TO PV-DEPT                       28140000
      *************************************************************     28150000
                                                                        28160000
                           IF ASC-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)      28170000
                                                       < PC-100 AND     28180000
                            ASC-SUBCLASS (ASC-BLK-SUB ASC-ITEM-SUB)     28190000
                                                       < PC-100         28200000
                            MOVE ASC-CLASS                              28210000
                            (ASC-BLK-SUB ASC-ITEM-SUB) TO PV-CLASS-1    28220000
                            MOVE ASC-SUBCLASS                           28230000
                            (ASC-BLK-SUB ASC-ITEM-SUB) TO PV-SUBCLASS-1 28240000
                           ELSE IF                                      28250000
                            ASC-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)        28260000
                                                       < PC-100 AND     28270000
                            ASC-SUBCLASS (ASC-BLK-SUB ASC-ITEM-SUB)     28280000
                                                       > PC-099         28290000
                            MOVE ASC-CLASS                              28300000
                            (ASC-BLK-SUB ASC-ITEM-SUB) TO PV-CLASS-2    28310000
                            MOVE ASC-SUBCLASS                           28320000
                            (ASC-BLK-SUB ASC-ITEM-SUB) TO PV-SUBCLASS-2 28330000
                            MOVE SPACES TO PV-FILLER-2A                 28340000
                                           PV-FILLER-2B                 28350000
                           ELSE IF                                      28360000
                            ASC-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)        28370000
                                                       > PC-099 AND     28380000
                            ASC-SUBCLASS (ASC-BLK-SUB ASC-ITEM-SUB)     28390000
                                                       < PC-100         28400000
                            MOVE ASC-CLASS                              28410000
                            (ASC-BLK-SUB ASC-ITEM-SUB) TO PV-CLASS-3    28420000
                            MOVE ASC-SUBCLASS                           28430000
                            (ASC-BLK-SUB ASC-ITEM-SUB) TO PV-SUBCLASS-3 28440000
                            MOVE SPACES TO PV-FILLER-3A                 28450000
                                           PV-FILLER-3B                 28460000
                           ELSE IF                                      28470000
                            ASC-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)        28480000
                                                       > PC-099 AND     28490000
                            ASC-SUBCLASS (ASC-BLK-SUB ASC-ITEM-SUB)     28500000
                                                       > PC-099         28510000
                            MOVE ASC-CLASS                              28520000
                            (ASC-BLK-SUB ASC-ITEM-SUB) TO PV-CLASS-4    28530000
                            MOVE ASC-SUBCLASS                           28540000
                            (ASC-BLK-SUB ASC-ITEM-SUB) TO PV-SUBCLASS-4 28550000
                            MOVE SPACES TO PV-FILLER-4A                 28560000
                           END-IF                                       28570000
                           END-IF                                       28580000
                           END-IF                                       28590000
                           END-IF                                       28600000
                           MOVE PV-DPT-CL-SUBCL                         28610000
                                    TO MR-A-DPT-CL-SUBCL (PV-SUB)       28620000
      *************************************************************     28630000
                           MOVE ASC-UPC     (ASC-BLK-SUB ASC-ITEM-SUB)  28640000
                                       TO PV-UPC                        28650000
                           MOVE '-'    TO PV-UPC-DASH-1                 28660000
                                          PV-UPC-DASH-2                 28670000
                                          PV-UPC-DASH-3                 28680000
                           MOVE PV-UPC TO MR-A-UPC   (PV-SUB)           28690000
                           MOVE ASC-FILE-PRICE                          28700000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 28710000
                                       TO MR-A-FPRICE  (PV-SUB)         28720000
                           IF (ASC-XFER-PRICE                           28730000
                                            (ASC-BLK-SUB ASC-ITEM-SUB)  28740000
                              = ASC-RECV-PRICE                          28750000
                                            (ASC-BLK-SUB ASC-ITEM-SUB)  28760000
                           OR ASC-RECV-PRICE                            28770000
                                            (ASC-BLK-SUB ASC-ITEM-SUB)  28780000
                              = ZERO)                                   28790000
                           AND ASC-XFER-QTY                             28800000
                                            (ASC-BLK-SUB ASC-ITEM-SUB)  28810000
                              > ZERO                                    28820000
                               MOVE ASC-XFER-QTY                        28830000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 28840000
                                       TO MR-A-TQTY  (PV-SUB)           28850000
                               MOVE ASC-XFER-PRICE                      28860000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 28870000
                                       TO MR-A-TPRICE  (PV-SUB)         28880000
                           ELSE                                         28890000
                               MOVE SPACE  TO MR-A-TQTY-X   (PV-SUB)    28900000
                                              MR-A-TPRICE-X (PV-SUB)    28910000
                           END-IF                                       28920000
                       ELSE                                             28930000
                           MOVE SPACE  TO MR-A-LINE-NBR-X   (PV-SUB)    28940000
                                          MR-A-DPT-CL-SUBCL (PV-SUB)    28950000
                                          MR-A-UPC          (PV-SUB)    28960000
                                          MR-A-TQTY-X       (PV-SUB)    28970000
                                          MR-A-TPRICE-X     (PV-SUB)    28980000
                                          MR-A-FPRICE-X     (PV-SUB)    28990000
                       END-IF                                           29000000
                       IF ASC-RECV-QTY (ASC-BLK-SUB ASC-ITEM-SUB)       29010000
                                  > 0                                   29020000
                          MOVE ASC-RECV-QTY (ASC-BLK-SUB ASC-ITEM-SUB)  29030000
                                           TO MR-A-RQTY  (PV-SUB)       29040000
                          MOVE ASC-RECV-PRICE (ASC-BLK-SUB ASC-ITEM-SUB)29050000
                                           TO MR-A-RPRICE  (PV-SUB)     29060000
                       ELSE                                             29070000
                           MOVE SPACE      TO MR-A-RQTY-X   (PV-SUB)    29080000
                                              MR-A-RPRICE-X (PV-SUB)    29090000
                       END-IF                                           29100000
                   END-IF                                               29110000
               END-IF                                                   29120000
               IF NOT ASC-NON-RETAIL-XFER                               29130000
                   IF ASC-XFER-PRICE (ASC-BLK-SUB ASC-ITEM-SUB)         29140000
                      NOT = ASC-RECV-PRICE  (ASC-BLK-SUB ASC-ITEM-SUB)  29150000
                   AND (ASC-RECV-PRICE    (ASC-BLK-SUB ASC-ITEM-SUB)    29160000
                      NOT = ZERO                                        29170000
                   OR  ASC-RECV-QTY      (ASC-BLK-SUB ASC-ITEM-SUB)     29180000
                      NOT = ZERO)                                       29190000
                       MOVE DP015-ASK-DRK-OFF  TO MR-A-SELECTA (PV-SUB) 29200000
                       MOVE DP015-HL-OFF       TO MR-A-SELECTH (PV-SUB) 29210000
                   ELSE                                                 29220000
                       MOVE PV-SUB             TO PV-SAVE-SUB           29230000
                   END-IF                                               29240000
               END-IF                                                   29250000
               IF  DP030-SET-CURSOR-TRAILER                             29260000
                   IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)29270000
                       > SPACE)                                         29280000
                     OR (PV-SUB = 1))                                   29290000
                      SET DP030-SET-CURSOR-APPL-1 TO TRUE               29300000
                       IF ASC-NON-RETAIL-XFER                           29310000
                          MOVE -1          TO MR-B-SELECTL (PV-SUB)     29320000
                       ELSE                                             29330000
                          MOVE -1          TO MR-A-SELECTL (PV-SAVE-SUB)29340000
                       END-IF                                           29350000
                   END-IF                                               29360000
               END-IF                                                   29370000
      *                                                                 29380000
           END-IF.                                                      29390000
           SUBTRACT +1 FROM ASC-ITEM-SUB                                29400000
           IF  ASC-ITEM-SUB < + 1                                       29410000
               MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  29420000
               MOVE +1                 TO ASC-BLK-SUB                   29430000
           END-IF.                                                      29440000
       EJECT                                                            29450000
      ******************************************************************29460000
      ** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **29470000
      ** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **29480000
      ** ISSUE A WARNING.                                             **29490000
      ******************************************************************29500000
       4430-CHECK-FOR-BEGIN-AND-END.                                    29510000
           IF  ASC-START-OF-SELECTED-RANGE > ZERO                       29520000
               IF  ASC-END-OF-SELECTED-RANGE = ZERO                     29530000
      *            -- NO END-OF-RANGE SPECFIED ---                      29540000
                   MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            29550000
                   SET DP020-MSG-WARNING TO TRUE                        29560000
                   PERFORM 4431-POSITION-AT-WARNING                     29570000
               END-IF                                                   29580000
           ELSE                                                         29590000
               IF  ASC-END-OF-SELECTED-RANGE > ZERO                     29600000
      *            -- NO BEGINNING-OF-RANGE SPECFIED ---                29610000
                   MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            29620000
                   SET DP020-MSG-WARNING TO TRUE                        29630000
                   PERFORM 4431-POSITION-AT-WARNING                     29640000
               END-IF                                                   29650000
           END-IF.                                                      29660000
      ******************************************************************29670000
      ** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **29680000
      ** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **29690000
      ** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **29700000
      ** POSITION THE CURSOR THERE.                                   **29710000
      ******************************************************************29720000
       4431-POSITION-AT-WARNING.                                        29730000
           COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 29740000
                          - PV-TOP-ITEM + 1.                            29750000
           IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      29760000
               CONTINUE                                                 29770000
           ELSE                                                         29780000
               SET DP030-SET-CURSOR-APPL-1                              29790000
                                         TO TRUE                        29800000
               IF ASC-NON-RETAIL-XFER                                   29810000
                   MOVE DP015-REVERSE  TO MR-B-SELECTH (PV-SUB)         29820000
                   MOVE DP015-YELLOW   TO MR-B-SELECTC (PV-SUB)         29830000
                   MOVE -1             TO MR-B-SELECTL (PV-SUB)         29840000
               ELSE                                                     29850000
                   MOVE DP015-REVERSE  TO MR-A-SELECTH (PV-SUB)         29860000
                   MOVE DP015-YELLOW   TO MR-A-SELECTC (PV-SUB)         29870000
                   MOVE -1             TO MR-A-SELECTL (PV-SUB)         29880000
               END-IF                                                   29890000
           END-IF.                                                      29900000
      *                                                                 29910000
           COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   29920000
                          - PV-TOP-ITEM + 1.                            29930000
           IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      29940000
               CONTINUE                                                 29950000
           ELSE                                                         29960000
               SET DP030-SET-CURSOR-APPL-1                              29970000
                                         TO TRUE                        29980000
               IF ASC-NON-RETAIL-XFER                                   29990000
                   MOVE DP015-REVERSE  TO MR-B-SELECTH (PV-SUB)         30000000
                   MOVE DP015-YELLOW   TO MR-B-SELECTC (PV-SUB)         30010000
                   MOVE -1             TO MR-B-SELECTL (PV-SUB)         30020000
               ELSE                                                     30030000
                   MOVE DP015-REVERSE  TO MR-A-SELECTH (PV-SUB)         30040000
                   MOVE DP015-YELLOW   TO MR-A-SELECTC (PV-SUB)         30050000
                   MOVE -1             TO MR-A-SELECTL (PV-SUB)         30060000
               END-IF                                                   30070000
           END-IF.                                                      30080000
       EJECT                                                            30090000
      *----------------------------------------------------------------*30100000
      * SELECT DATA FROM THE TRANSFER TABLES                            30110000
      *----------------------------------------------------------------*30120000
       5000-GET-TRANSFER.                                               30130000
           MOVE ASC-XFER-SEQ-NBR            TO DK-XFER-SEQ-NBR.         30140000
           MOVE ASC-FROM-STORE-NBR          TO DK-STORE-NBR.            30150000
           PERFORM                                                      30160000
               WITH TEST AFTER                                          30170000
               VARYING PV-RETRY-COUNTER                                 30180000
               FROM 1 BY 1                                              30190000
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               30200000
                         OR (SQLCODE = ZERO)                            30210000
                         OR (SQLCODE = +100))                           30220000
      *                                                                 30230000
               EXEC SQL                                                 30240000
                   SELECT X.XFER_DKEY_ID                                30250000
                         ,X.XFER_TYP_CDE                                30260000
                         ,X.TO_STR_NBR                                  30270000
                         ,S.XFER_STAT_CDE                               30280000
                         ,SC.XFER_STAT_DESC                             30290000
                   INTO   :TFMSTR-XFER-DKEY-ID                          30300000
                         ,:TFMSTR-XFER-TYP-CDE                          30310000
                         ,:TFMSTR-TO-STR-NBR                            30320000
                         ,:TFSTAT-XFER-STAT-CDE                         30330000
                         ,:TFSTCD-XFER-STAT-DESC                        30340000
                   FROM   TTFMSTR X                                     30350000
                         ,TTFSTAT S                                     30360000
                         ,TTFSTCD SC                                    30370000
                   WHERE  X.XFER_SEQ_NBR   = :DK-XFER-SEQ-NBR     AND   30380000
                          X.FR_STR_NBR     = :DK-STORE-NBR        AND   30390000
                          S.XFER_DKEY_ID   = X.XFER_DKEY_ID       AND   30400000
                          S.XFER_STAT_CDE  = SC.XFER_STAT_CDE     AND   30410000
                          S.XFER_STAT_TMST =                            30420000
                  (SELECT                                               30430000
                   MAX(S.XFER_STAT_TMST)                                30440000
                   FROM TTFSTAT S                                       30450000
                       ,TTFMSTR X                                       30460000
                   WHERE  X.XFER_SEQ_NBR   = :DK-XFER-SEQ-NBR     AND   30470000
                          X.FR_STR_NBR     = :DK-STORE-NBR        AND   30480000
                          S.XFER_DKEY_ID   = X.XFER_DKEY_ID       AND   30490000
                          S.XFER_STAT_CDE  IN ('PR', 'AR', 'CM', 'VD')) 30500000
               END-EXEC                                                 30510000
                                                                        30520000
               EVALUATE TRUE                                            30530000
                   WHEN SQLCODE = ZERO                                  30540000
                      SET PS-TRANSFER-FOUND     TO TRUE                 30550000
                      MOVE TFMSTR-XFER-DKEY-ID  TO ASC-XFER-DKEY-ID     30560000
                                                   DK-XFER-DKEY-ID      30570000
                      MOVE TFMSTR-XFER-TYP-CDE  TO ASC-XFER-TYPE        30580000
                      MOVE TFSTAT-XFER-STAT-CDE                         30590000
                                                TO ASC-XFER-STATUS      30600000
                      MOVE TFSTCD-XFER-STAT-DESC                        30610000
                                                TO ASC-XFER-STATUS-DESC 30620000
                      IF ASC-XFER-STATUS = PC-POSITIVE-RECEIPT          30630000
                          PERFORM 7100-CHECK-XFER-DISCREPANCY           30640000
                      END-IF                                            30650000
                   WHEN SQLCODE = +100                                  30660000
                   WHEN SQLCODE = -904                                  30670000
                   WHEN SQLCODE = -913                                  30680000
                       CONTINUE                                         30690000
                   WHEN OTHER                                           30700000
                       MOVE '5000-GET-TRANSFER'                         30730000
                                         TO DP013-PARAGRAPH             30740000
                       MOVE 'SELECT TRANSFER DATA'                      30750000
                                         TO DP013-MESSAGE-TEXT (1)      30760000
                       MOVE SQLCA        TO DP013-SQLCA                 30770000
                       MOVE 'TTFMSTR'    TO DP013-DB2-TABLE-NAME (1)    30780000
                       MOVE 'TTFSTAT'    TO DP013-DB2-TABLE-NAME (2)    30790000
                       MOVE 'TTFSTCD'    TO DP013-DB2-TABLE-NAME (3)    30800000
                       SET DP013-DB2-ABEND                              30810000
                           DP013-XCTL-DISPLAY-RESTART                   30820000
                                         TO TRUE                        30830000
                       PERFORM DP013-0000-PROCESS-ABEND                 30840000
               END-EVALUATE                                             30850000
           END-PERFORM.                                                 30860000
      *                                                                 30870000
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        30880000
               MOVE '5000-GET-TRANSFER'                                 30890000
                                         TO DP013-PARAGRAPH             30900000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     30910000
                                         TO DP013-MESSAGE-TEXT (1)      30920000
               MOVE 'TRANSFER DATA'      TO DP013-MESSAGE-TEXT (2)      30930000
               MOVE SQLCA                TO DP013-SQLCA                 30940000
               MOVE 'TTFMSTR '           TO DP013-DB2-TABLE-NAME (1)    30950000
               MOVE 'TTFSTAT'            TO DP013-DB2-TABLE-NAME (2)    30960000
               MOVE 'TTFSTCD'            TO DP013-DB2-TABLE-NAME (3)    30970000
               SET DP013-DB2-ABEND                                      30980000
                   DP013-XCTL-DISPLAY-RESTART                           30990000
                                         TO TRUE                        31000000
               PERFORM DP013-0000-PROCESS-ABEND                         31010000
           END-IF.                                                      31020000
       EJECT                                                            31030000
      *----------------------------------------------------------------*31040000
      * PREPARE THE INTER-APPLICATION COMMAREA WITH THE SELECTED ITEM. *31050000
      *----------------------------------------------------------------*31060000
                                                                        31070000
       5050-PREPARE-SEL-QUEUE-OUT.                                      31080000
                                                                        31090000
           MOVE +1                   TO  ASC-BLK-SUB.                   31100000
           PERFORM 5100-WRITE-TEMP-STORAGE.                             31110000
           ADD +1                    TO  ASC-BLK-SUB.                   31120000
           PERFORM 5100-WRITE-TEMP-STORAGE.                             31130000
                                                                        31140000
           MOVE ASC-SEL-QUEUE-OUT-NAME TO TF003-SEL-QUEUE-NAME.         31150000
           PERFORM 6010-DELETE-SEL-QUEUE-OUT.                           31160000
                                                                        31170000
           SET ASC-UPDATE-TSQ        TO  TRUE.                          31180000
                                                                        31190000
           SET TF002-IDX             TO  1.                             31200000
           MOVE ZERO                 TO TF003-NUMBER-OF-TS-ITEMS.       31210000
           INITIALIZE TF002-SELECTED-ITEM-ARRAY.                        31220000
                                                                        31230000
           PERFORM 5200-FILL-SEL-QUEUE-OUT-RECORD                       31240000
                   VARYING PV-ITEM                                      31250000
                   FROM 1 BY 1                                          31260000
                   UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     31270000
                                                                        31280000
           IF  TF002-IDX > 1                                            31290000
               PERFORM 5205-WRITE-SEL-QUEUE-OUT                         31300000
               ADD +1                TO TF003-NUMBER-OF-TS-ITEMS        31310000
           END-IF.                                                      31320000
       EJECT                                                            31330000
      *----------------------------------------------------------------*31340000
      *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *31350000
      *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *31360000
      *----------------------------------------------------------------*31370000
                                                                        31380000
       5100-WRITE-TEMP-STORAGE.                                         31390000
           MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     31400000
                                         TO PV-LIST-ITEM-NUMBER.        31410000
           COMPUTE PV-BLOCK-NUMBER =                                    31420000
               1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    31430000
                                                                        31440000
           IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             31450000
           OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             31460000
               IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      31470000
                   PERFORM 5105-REWRITE-ASC-LISTQ                       31480000
               END-IF                                                   31490000
           ELSE                                                         31500000
               COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       31510000
               ASC-HIGHEST-BLOCK-WRITTEN + 1                            31520000
               PERFORM 5110-WRITE-ASC-LISTQ                             31530000
               ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   31540000
           END-IF.                                                      31550000
                                                                        31560000
           SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             31570000
      ******************************************************************31580000
      ** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **31590000
      ** SPECIFIC COMMAREA.                                           **31600000
      ******************************************************************31610000
       5105-REWRITE-ASC-LISTQ.                                          31620000
           EXEC CICS                                                    31630000
               WRITEQ TS                                                31640000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          31650000
                   FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31660000
                   ITEM  (PV-BLOCK-NUMBER)                              31670000
                   REWRITE                                              31680000
                   RESP  (PV-CICS-RESP)                                 31690000
           END-EXEC.                                                    31700000
                                                                        31710000
           IF  PV-CICS-RESP = DFHRESP(NORMAL)                           31720000
               CONTINUE                                                 31730000
           ELSE                                                         31740000
               SET DP013-CICS-ABEND            TO TRUE                  31750000
               SET DP013-NO-ROLLBACK           TO TRUE                  31760000
               MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       31770000
               MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     31780000
                                               TO DP013-MESSAGE-TEXT(1) 31790000
               PERFORM DP013-0000-PROCESS-ABEND                         31800000
           END-IF.                                                      31810000
                                                                        31820000
      ******************************************************************31830000
      ** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **31840000
      ** SPECIFIC COMMAREA.                                           **31850000
      ******************************************************************31860000
       5110-WRITE-ASC-LISTQ.                                            31870000
           EXEC CICS                                                    31880000
               WRITEQ TS                                                31890000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          31900000
                   FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31910000
                   ITEM  (PV-BLOCK-NUMBER)                              31920000
                   RESP  (PV-CICS-RESP)                                 31930000
           END-EXEC.                                                    31940000
           IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      31950000
               SET DP013-CICS-ABEND      TO TRUE                        31960000
               SET DP013-NO-ROLLBACK     TO TRUE                        31970000
               MOVE '5110-WRITE-ASC-LISTQ'                              31980000
                                         TO DP013-PARAGRAPH             31990000
               MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           32000000
                                         TO DP013-MESSAGE-TEXT(1)       32010000
               PERFORM DP013-0000-PROCESS-ABEND                         32020000
           END-IF.                                                      32030000
       EJECT                                                            32040000
      *----------------------------------------------------------------*32050000
      * READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *32060000
      * TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *32070000
      *----------------------------------------------------------------*32080000
                                                                        32090000
       5200-FILL-SEL-QUEUE-OUT-RECORD.                                  32100000
                                                                        32110000
           PERFORM 6112-READ-LIST-QUEUE.                                32120000
                                                                        32130000
           IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       32140000
               PERFORM                                                  32150000
               VARYING LQW-IDX                                          32160000
               FROM 1 BY 1                                              32170000
               UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            32180000
                 OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          32190000
                                                                        32200000
                   IF  LQW-SELECT (LQW-IDX)                             32210000
                       MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              32220000
                                         TO TF002-ITEM (TF002-IDX)      32230000
                       MOVE LQW-LINE (LQW-IDX)                          32240000
                                         TO TF002-LINE-NBR              32250000
                                              (TF002-IDX)               32260000
                       MOVE SPACE        TO TF002-ACTION-SW (TF002-IDX) 32270000
                       SET TF002-IDX UP BY 1                            32280000
                       IF  TF002-IDX > TF002-MAX-ITEMS                  32290000
                           PERFORM 5205-WRITE-SEL-QUEUE-OUT             32300000
                           ADD +1        TO TF003-NUMBER-OF-TS-ITEMS    32310000
                           INITIALIZE TF002-SELECTED-ITEM-ARRAY         32320000
                           SET TF002-IDX TO  1                          32330000
                       END-IF                                           32340000
                   END-IF                                               32350000
               END-PERFORM                                              32360000
           END-IF.                                                      32370000
                                                                        32380000
      *----------------------------------------------------------------*32390000
      *    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *32400000
      *----------------------------------------------------------------*32410000
                                                                        32420000
       5205-WRITE-SEL-QUEUE-OUT.                                        32430000
                                                                        32440000
           MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            32450000
                                         TO TF002-SELECTED-ITEMS.       32460000
                                                                        32470000
           EXEC CICS                                                    32480000
                WRITEQ TS                                               32490000
                    QUEUE (ASC-SEL-QUEUE-OUT-NAME)                      32500000
                    FROM  (TF002-TRANSFER-SEL-REC)                      32510000
                    ITEM  (PV-SEL-QUEUE-ITEM)                           32520000
                    RESP  (PV-CICS-RESP)                                32530000
           END-EXEC.                                                    32540000
                                                                        32550000
           IF  PV-CICS-RESP = DFHRESP (NORMAL)                          32560000
               CONTINUE                                                 32570000
           ELSE                                                         32580000
               SET DP013-CICS-ABEND      TO TRUE                        32590000
               SET DP013-NO-ROLLBACK     TO TRUE                        32600000
               MOVE '5205-WRITE-SEL-QUEUE-OUT'                          32610000
                                         TO DP013-PARAGRAPH             32620000
               MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          32630000
                                         TO DP013-MESSAGE-TEXT(1)       32640000
               PERFORM DP013-0000-PROCESS-ABEND                         32650000
           END-IF.                                                      32660000
       EJECT                                                            32670000
      *----------------------------------------------------------------*32680000
      * READ THE TRANSFER ITEM POSTING TABLE FOR THE LINE NUMBER BEING *32690000
      * PROCESSED TO DETERMINE IF THERE IS A MANUAL ADJUSTMENT.        *32700000
      *----------------------------------------------------------------*32710000
       5300-READ-ADJUSTMENTS.                                           32720000
           PERFORM                                                      32730000
               WITH TEST AFTER                                          32740000
               VARYING PV-RETRY-COUNTER                                 32750000
               FROM 1 BY 1                                              32760000
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               32770000
                         OR (SQLCODE = ZERO)                            32780000
                         OR (SQLCODE = +100))                           32790000
      *                                                                 32800000
               EXEC SQL                                                 32810000
                   SELECT DISTINCT P.XFER_LNE_NBR                       32820000
                       INTO  :TFITPS-XFER-LNE-NBR                       32830000
                       FROM  TTFITPS P                                  32840000
                           , TTFAJRS A                                  32850000
      *                    , TTFITEM I                                  32860000
                       WHERE P.XFER_LNE_NBR  = :TFITEM-XFER-LNE-NBR AND 32870000
                             P.ADJ_RSN_CDE   = A.ADJ_RSN_CDE  AND       32880000
                             P.XFER_DKEY_ID  = :DK-XFER-DKEY-ID AND     32890000
      *                      I.XFER_DKEY_ID  = :DK-XFER-DKEY-ID AND     32900000
                             A.SYS_RSN_IND   = 'N'                      32910000
               END-EXEC                                                 32920000
                                                                        32930000
               EVALUATE TRUE                                            32940000
                   WHEN SQLCODE = ZERO                                  32950000
                      MOVE 'ADJ'         TO ASC-ACTION                  32960000
                                         (ASC-BLK-SUB ASC-ITEM-SUB)     32970000
                      SET ASC-ADJUSTMENTS-EXIST    TO TRUE              32980000
                   WHEN SQLCODE = +100                                  32990000
                   WHEN SQLCODE = -904                                  33000000
                   WHEN SQLCODE = -913                                  33010000
                       CONTINUE                                         33020000
                   WHEN OTHER                                           33030000
                       MOVE '5300-READ-ADJUSTMENTS'                     33060000
                                         TO DP013-PARAGRAPH             33070000
                       MOVE 'SELECT TRANSFER DATA'                      33080000
                                         TO DP013-MESSAGE-TEXT (1)      33090000
                       MOVE SQLCA        TO DP013-SQLCA                 33100000
                       MOVE 'TTFITEM'    TO DP013-DB2-TABLE-NAME (1)    33110000
                       MOVE 'TTFAJRS'    TO DP013-DB2-TABLE-NAME (2)    33120000
                       MOVE 'TTFITPS'    TO DP013-DB2-TABLE-NAME (3)    33130000
                       SET DP013-DB2-ABEND                              33140000
                           DP013-XCTL-DISPLAY-RESTART                   33150000
                                         TO TRUE                        33160000
                       PERFORM DP013-0000-PROCESS-ABEND                 33170000
               END-EVALUATE                                             33180000
           END-PERFORM.                                                 33190000
      *                                                                 33200000
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        33210000
               MOVE '5300-READ-ADJUSTMENTS'                             33220000
                                         TO DP013-PARAGRAPH             33230000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     33240000
                                         TO DP013-MESSAGE-TEXT (1)      33250000
               MOVE 'TRANSFER DATA'      TO DP013-MESSAGE-TEXT (2)      33260000
               MOVE SQLCA                TO DP013-SQLCA                 33270000
               MOVE 'TTFITEM '           TO DP013-DB2-TABLE-NAME (1)    33280000
               MOVE 'TTFAJRS'            TO DP013-DB2-TABLE-NAME (2)    33290000
               MOVE 'TTFITPS'            TO DP013-DB2-TABLE-NAME (3)    33300000
               SET DP013-DB2-ABEND                                      33310000
                   DP013-XCTL-DISPLAY-RESTART                           33320000
                                         TO TRUE                        33330000
               PERFORM DP013-0000-PROCESS-ABEND                         33340000
           END-IF.                                                      33350000
       EJECT                                                            33360000
      *----------------------------------------------------------------*33370000
      *  GET THE TOTAL RECIEVED QTY & PRICE.                           *33380000
      *----------------------------------------------------------------*33390000
       5400-READ-ITEM-RECEIPT.                                          33400000
           PERFORM WITH TEST AFTER                                      33410000
               VARYING PV-RETRY-COUNTER FROM 1 BY 1                     33420000
                 UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                33430000
                    OR SQLCODE = ZERO                                   33440000
                    OR SQLCODE = +100                                   33450000
               EXEC SQL                                                 33460000
                   SELECT  RCVD_XFER_PRIC_AMT                           33470000
                         , RCVD_XFER_QTY                                33480000
                       INTO :TFITRC-RCVD-XFER-PRIC-AMT                  33490000
                           ,:TFITRC-RCVD-XFER-QTY                       33500000
                       FROM TTFITRC I                                   33510000
                           ,TTFSTAT S                                   33520000
                   WHERE                                                33530000
                      I.XFER_DKEY_ID     = :DK-XFER-DKEY-ID        AND  33540000
                      S.XFER_DKEY_ID     = :DK-XFER-DKEY-ID        AND  33550000
                      S.XFER_STAT_CDE    = :PC-POSITIVE-RECEIPT    AND  33560000
                      S.XFER_STAT_TMST   = I.XFER_RCPT_TMST        AND  33570000
                      RCVD_XFER_PRIC_AMT = :TFITEM-XFER-PRIC-AMT   AND  33580000
                      XFER_LNE_NBR       = :TFITEM-XFER-LNE-NBR         33590000
               END-EXEC                                                 33600000
               EVALUATE TRUE                                            33610000
                   WHEN SQLCODE = ZERO                                  33620000
                   WHEN SQLCODE = +100                                  33630000
                   WHEN SQLCODE = -904                                  33640000
                   WHEN SQLCODE = -913                                  33650000
                       CONTINUE                                         33660000
                   WHEN OTHER                                           33670000
                       MOVE '5400-READ-ITEM-RECEIPT'                    33700000
                                         TO DP013-PARAGRAPH             33710000
                       MOVE 'READ DATA FROM TTFITEM'                    33720000
                                         TO DP013-MESSAGE-TEXT (1)      33730000
                       MOVE SQLCA        TO DP013-SQLCA                 33740000
                       MOVE 'TTFITRC'    TO DP013-DB2-TABLE-NAME (1)    33750000
                       SET DP013-DB2-ABEND                              33760000
                           DP013-XCTL-DISPLAY-RESTART                   33770000
                                         TO TRUE                        33780000
                       PERFORM DP013-0000-PROCESS-ABEND                 33790000
               END-EVALUATE                                             33800000
           END-PERFORM.                                                 33810000
      *                                                                 33820000
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        33830000
               MOVE '5400-READ-ITEM-RECEIPT'                            33840000
                                         TO DP013-PARAGRAPH             33850000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     33860000
                                         TO DP013-MESSAGE-TEXT (1)      33870000
               MOVE 'DATA FROM TTFITRC'  TO DP013-MESSAGE-TEXT (2)      33880000
               MOVE SQLCA                TO DP013-SQLCA                 33890000
               MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)    33900000
               SET DP013-DB2-ABEND                                      33910000
                   DP013-XCTL-DISPLAY-RESTART                           33920000
                                         TO TRUE                        33930000
               PERFORM DP013-0000-PROCESS-ABEND                         33940000
           END-IF.                                                      33950000
           IF SQLCODE = +100                                            33960000
               MOVE ZEROES               TO TFITRC-RCVD-XFER-QTY        33970000
                                            TFITRC-RCVD-XFER-PRIC-AMT   33980000
           END-IF.                                                      33990000
       EJECT                                                            34000000
      *----------------------------------------------------------------*34010000
      * OPEN THE TRANSFER RECEIPT CURSOR.                              *34020000
      *----------------------------------------------------------------*34030000
                                                                        34040000
       5500-OPEN-RECEIPT-CURSOR.                                        34050000
           PERFORM                                                      34060000
               WITH TEST AFTER                                          34070000
               VARYING PV-RETRY-COUNTER                                 34080000
               FROM 1 BY 1                                              34090000
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               34100000
                         OR (SQLCODE = ZERO))                           34110000
                   EXEC SQL                                             34120000
                        OPEN XFER-RECEIPT-CSR                           34130000
                   END-EXEC                                             34140000
                                                                        34150000
               EVALUATE TRUE                                            34160000
                   WHEN SQLCODE = ZERO                                  34170000
                   WHEN SQLCODE = -904                                  34180000
                   WHEN SQLCODE = -913                                  34190000
                       CONTINUE                                         34200000
                   WHEN OTHER                                           34210000
                       MOVE '5500-OPEN-RECEIPT-CURSOR'                  34240000
                                         TO DP013-PARAGRAPH             34250000
                       MOVE 'OPEN TRANSFER ITEM CURSOR - '              34260000
                                         TO DP013-MESSAGE-TEXT (1)      34270000
                       MOVE SQLCA        TO DP013-SQLCA                 34280000
                       MOVE 'TTFITRC '   TO DP013-DB2-TABLE-NAME (1)    34290000
                       SET DP013-DB2-ABEND                              34300000
                           DP013-XCTL-DISPLAY-RESTART TO TRUE           34310000
                       PERFORM DP013-0000-PROCESS-ABEND                 34320000
               END-EVALUATE                                             34330000
           END-PERFORM.                                                 34340000
      *                                                                 34350000
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        34360000
               MOVE '5500-OPEN-RECEIPT-CURSOR'                          34370000
                                         TO DP013-PARAGRAPH             34380000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   34390000
                                         TO DP013-MESSAGE-TEXT (1)      34400000
               MOVE SQLCA                TO DP013-SQLCA                 34410000
               MOVE 'TTFITRC '           TO DP013-DB2-TABLE-NAME (1)    34420000
               SET DP013-DB2-ABEND                                      34430000
                   DP013-XCTL-DISPLAY-RESTART                           34440000
                                         TO TRUE                        34450000
               PERFORM DP013-0000-PROCESS-ABEND                         34460000
           END-IF.                                                      34470000
                                                                        34480000
       EJECT                                                            34490000
      *----------------------------------------------------------------*34500000
      *    READ THE ITEMS FROM THE TRANSFER RECEIPT DATABASE WHERE     *34510000
      *    THE RECEIPT PRICE IS NOT EQUAL TO THE TRANSFER PRICE AND    *34520000
      *    CONTINUE BUILDING THE BLOCKS IN THE ARRAY.                  *34530000
      *----------------------------------------------------------------*34540000
                                                                        34550000
       5600-READ-RECEIPT-ITEMS.                                         34560000
                                                                        34570000
           PERFORM                                                      34580000
               VARYING PV-READ-COUNT                                    34590000
               FROM 1 BY 1                                              34600000
               UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    34610000
                  OR (ASC-NO-ITEMS-LEFT-ON-DB-2))                       34620000
                                                                        34630000
               PERFORM 5650-FETCH-RECEIPT-CURSOR                        34640000
                                                                        34650000
               IF  ASC-ITEMS-LEFT-ON-DB-2                               34660000
                   IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                34670000
                       ADD +1            TO ASC-ITEM-SUB                34680000
                   ELSE                                                 34690000
                       ADD +1            TO ASC-BLK-SUB                 34700000
                       MOVE +1           TO ASC-ITEM-SUB                34710000
                                                                        34720000
                       IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         34730000
                           MOVE +1       TO ASC-BLK-SUB                 34740000
                           SET ASC-BLOCK-MODIFIED (1)                   34750000
                                         TO TRUE                        34760000
                           PERFORM 5100-WRITE-TEMP-STORAGE              34770000
                           MOVE ASC-BLOCK-ENTRIES                       34780000
                                     (PC-MAX-BLOCKS-IN-ARRAY)           34790000
                                      TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 34800000
                           ADD +1        TO ASC-BLK-SUB                 34810000
                           INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   34820000
                           SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      34830000
                                         TO TRUE                        34840000
                       END-IF                                           34850000
                   END-IF                                               34860000
                   ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    34870000
                   MOVE ASC-NUMBER-OF-ITEMS-READ                        34880000
                                         TO ASC-LIST-ITEM-NUMBER        34890000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 34900000
                   MOVE TFITEM-XFER-LNE-NBR              TO             34910000
                           ASC-LINE          (ASC-BLK-SUB ASC-ITEM-SUB) 34920000
                   MOVE SKXREF-DEPT                      TO             34930000
                           ASC-DEPT          (ASC-BLK-SUB ASC-ITEM-SUB) 34940000
                   MOVE SKXREF-CLASS                     TO             34950000
                           ASC-CLASS         (ASC-BLK-SUB ASC-ITEM-SUB) 34960000
                   MOVE SKXREF-SUBCLASS                  TO             34970000
                           ASC-SUBCLASS      (ASC-BLK-SUB ASC-ITEM-SUB) 34980000
                   MOVE TFITEM-KOHLS-UPC-NBR             TO             34990000
                           ASC-UPC           (ASC-BLK-SUB ASC-ITEM-SUB) 35000000
                   MOVE TFITEM-XFER-QTY                  TO             35010000
                           ASC-XFER-QTY      (ASC-BLK-SUB ASC-ITEM-SUB) 35020000
                   MOVE TFITRC-RCVD-XFER-QTY             TO             35030000
                           ASC-RECV-QTY      (ASC-BLK-SUB ASC-ITEM-SUB) 35040000
                   MOVE TFITEM-XFER-PRIC-AMT             TO             35050000
                           ASC-XFER-PRICE    (ASC-BLK-SUB ASC-ITEM-SUB) 35060000
                   MOVE TFITRC-RCVD-XFER-PRIC-AMT        TO             35070000
                           ASC-RECV-PRICE    (ASC-BLK-SUB ASC-ITEM-SUB) 35080000
                   MOVE TFITEM-CPLD-RTL-PRIC-AMT         TO             35090000
                           ASC-FILE-PRICE    (ASC-BLK-SUB ASC-ITEM-SUB) 35100000
                   MOVE TFITEM-NRTL-1ST-LNE-DESC         TO             35110000
                           ASC-DESCRIPTION-1 (ASC-BLK-SUB ASC-ITEM-SUB) 35120000
                   MOVE TFITEM-NRTL-2ND-LNE-DESC         TO             35130000
                           ASC-DESCRIPTION-2 (ASC-BLK-SUB ASC-ITEM-SUB) 35140000
                                                                        35150000
               END-IF                                                   35160000
           END-PERFORM.                                                 35170000
      *----------------------------------------------------------------*35180000
      *    FETCH THE TRANSFER RECEIPT CURSOR.                          *35190000
      *----------------------------------------------------------------*35200000
                                                                        35210000
       5650-FETCH-RECEIPT-CURSOR.                                       35220000
                                                                        35230000
           EXEC SQL                                                     35240000
               FETCH XFER-RECEIPT-CSR                                   35250000
               INTO   :TFITRC-RCVD-XFER-PRIC-AMT                        35260000
                    , :TFITRC-RCVD-XFER-QTY                             35270000
           END-EXEC                                                     35280000
                                                                        35290000
           EVALUATE TRUE                                                35300000
               WHEN SQLCODE = ZERO                                      35310000
                    CONTINUE                                            35320000
               WHEN SQLCODE = +100                                      35330000
                    SET ASC-NO-ITEMS-LEFT-ON-DB-2                       35340000
                                         TO TRUE                        35350000
               WHEN OTHER                                               35360000
                    MOVE '5650-FETCH-RECEIPT-CURSOR'                    35380000
                                     TO DP013-PARAGRAPH                 35390000
                    MOVE 'FETCH TRANSFER ITEM CURSOR'                   35400000
                                     TO DP013-MESSAGE-TEXT (1)          35410000
                    MOVE 'TTFITEM '  TO DP013-DB2-TABLE-NAME (1)        35420000
                    MOVE SQLCA       TO DP013-SQLCA                     35430000
                    SET DP013-DB2-ABEND                                 35440000
                                     TO TRUE                            35450000
                    PERFORM DP013-0000-PROCESS-ABEND                    35460000
           END-EVALUATE.                                                35470000
                                                                        35480000
       EJECT                                                            35490000
      *----------------------------------------------------------------*35500000
      * CLOSE THE TRANSFER RECEIPT CURSOR.                             *35510000
      *----------------------------------------------------------------*35520000
                                                                        35530000
       5700-CLOSE-RECEIPT-CURSOR.                                       35540000
           EXEC SQL                                                     35550000
               CLOSE XFER-RECEIPT-CSR                                   35560000
           END-EXEC                                                     35570000
      *                                                                 35580000
           EVALUATE TRUE                                                35590000
               WHEN SQLCODE = ZERO                                      35600000
                   CONTINUE                                             35610000
               WHEN OTHER                                               35620000
                   MOVE '5700-CLOSE-RECEIPT-CURSOR'                     35650000
                                     TO DP013-PARAGRAPH                 35660000
                   MOVE 'CLOSE TRANSFER RECEIPT CURSOR '                35670000
                                     TO DP013-MESSAGE-TEXT (1)          35680000
                   MOVE SQLCA        TO DP013-SQLCA                     35690000
                   MOVE 'TTFITRC '   TO DP013-DB2-TABLE-NAME (1)        35700000
                   SET DP013-DB2-ABEND                                  35710000
                       DP013-XCTL-DISPLAY-RESTART TO TRUE               35720000
                   PERFORM DP013-0000-PROCESS-ABEND                     35730000
           END-EVALUATE.                                                35740000
                                                                        35750000
       EJECT                                                            35760000
      ******************************************************************35770000
      ** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **35780000
      ** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **35790000
      ** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **35800000
      ** THE USER.                                                    **35810000
      ******************************************************************35820000
       6000-REFRESH-PANEL-FROM-TEMP.                                    35830000
           IF  ASC-UPDATE-TSQ                                           35840000
               SET ASC-NO-TSQ-UPDATE TO TRUE                            35850000
               MOVE ZERO                 TO PV-SAVE-ITEM                35860000
                                            PV-SEL-QUEUE-ITEM           35870000
               MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        35880000
                                         TO PV-HOLD-SELECTED-ITEMS      35890000
               MOVE +1                   TO PV-ITEMS-PROCESSED          35900000
               PERFORM 6100-UPDATE-TSQ                                  35910000
                   UNTIL PV-ITEMS-PROCESSED >                           35920000
                                           PV-HOLD-SELECTED-ITEMS       35930000
               PERFORM 6010-DELETE-SEL-QUEUE-OUT                        35940000
               INITIALIZE ASC-BLOCK-ENTRIES (1)                         35950000
                          ASC-BLOCK-ENTRIES (2)                         35960000
           END-IF.                                                      35970000
                                                                        35980000
      *----------------------------------------------------------------*35990000
      *    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *36000000
      *----------------------------------------------------------------*36010000
       6010-DELETE-SEL-QUEUE-OUT.                                       36020000
                                                                        36030000
           EXEC CICS                                                    36040000
               DELETEQ TS                                               36050000
                   QUEUE (ASC-SEL-QUEUE-OUT-NAME)                       36060000
                   RESP  (PV-CICS-RESP)                                 36070000
           END-EXEC.                                                    36080000
      *                                                                 36090000
           IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      36100000
              (PV-CICS-RESP = DFHRESP(QIDERR)))                         36110000
               CONTINUE                                                 36120000
           ELSE                                                         36130000
               SET DP013-CICS-ABEND TO TRUE                             36140000
               SET DP013-NO-ROLLBACK TO TRUE                            36150000
               MOVE '6010-DELETE-SEL-QUEUE-OUT'                         36160000
                              TO DP013-PARAGRAPH                        36170000
               MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         36180000
                              TO DP013-MESSAGE-TEXT (1)                 36190000
               PERFORM DP013-0000-PROCESS-ABEND                         36200000
           END-IF.                                                      36210000
                                                                        36220000
      *----------------------------------------------------------------*36230000
      *    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *36240000
      *    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *36250000
      *    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *36260000
      *    THE TEMP QUEUE.                                             *36270000
      *----------------------------------------------------------------*36280000
                                                                        36290000
       6100-UPDATE-TSQ.                                                 36300000
                                                                        36310000
           ADD 1                     TO  PV-SEL-QUEUE-ITEM.             36320000
           PERFORM 6105-READ-SEL-QUEUE-OUT.                             36330000
           PERFORM                                                      36340000
               VARYING TF002-IDX                                        36350000
               FROM 1 BY 1                                              36360000
               UNTIL ((PV-ITEMS-PROCESSED >                             36370000
                                    PV-HOLD-SELECTED-ITEMS)             36380000
               OR (TF002-IDX GREATER THAN TF002-MAX-ITEMS))             36390000
               IF  TF002-ACTION-SW (TF002-IDX) > SPACE                  36400000
                   PERFORM 6110-PROCESS-ITEMS                           36410000
               END-IF                                                   36420000
               ADD +1                TO PV-ITEMS-PROCESSED              36430000
           END-PERFORM.                                                 36440000
           PERFORM 6111-WRITE-LIST-QUEUE.                               36450000
      *----------------------------------------------------------------*36460000
      *    READ THE LIST QUEUE RECORD.                                 *36470000
      *----------------------------------------------------------------*36480000
                                                                        36490000
       6105-READ-SEL-QUEUE-OUT.                                         36500000
                                                                        36510000
           EXEC CICS                                                    36520000
                READQ TS                                                36530000
                    QUEUE (ASC-SEL-QUEUE-OUT-NAME)                      36540000
                    INTO  (TF002-TRANSFER-SEL-REC)                      36550000
                    ITEM  (PV-SEL-QUEUE-ITEM)                           36560000
                    RESP  (PV-CICS-RESP)                                36570000
           END-EXEC.                                                    36580000
      *                                                                 36590000
           IF  PV-CICS-RESP = DFHRESP (NORMAL)                          36600000
               CONTINUE                                                 36610000
           ELSE                                                         36620000
               SET DP013-CICS-ABEND      TO  TRUE                       36630000
               SET DP013-NO-ROLLBACK     TO  TRUE                       36640000
               MOVE '6105-READ-SEL-QUEUE-OUT'                           36650000
                                         TO  DP013-PARAGRAPH            36660000
               MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           36670000
                                         TO  DP013-MESSAGE-TEXT(1)      36680000
               PERFORM DP013-0000-PROCESS-ABEND                         36690000
           END-IF.                                                      36700000
       EJECT                                                            36710000
      *----------------------------------------------------------------*36720000
      *    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*36730000
      *    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*36740000
      *    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *36750000
      *----------------------------------------------------------------*36760000
                                                                        36770000
       6110-PROCESS-ITEMS.                                              36780000
                                                                        36790000
           COMPUTE PV-ITEM = 1 + ((TF002-ITEM (TF002-IDX) - 1)          36800000
                           / PC-ITEMS-PER-PANEL).                       36810000
                                                                        36820000
           IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           36830000
               IF  PV-SAVE-ITEM NOT EQUAL ZERO                          36840000
                   PERFORM 6111-WRITE-LIST-QUEUE                        36850000
               END-IF                                                   36860000
               MOVE PV-ITEM          TO PV-SAVE-ITEM                    36870000
                                                                        36880000
               PERFORM 6112-READ-LIST-QUEUE                             36890000
               IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               36900000
                   CONTINUE                                             36910000
               END-IF                                                   36920000
           END-IF.                                                      36930000
                                                                        36940000
           COMPUTE PV-SUB = (TF002-ITEM (TF002-IDX)                     36950000
                          - LQW-LIST-ITEM-NUMBER (1)) + 1.              36960000
           SET LQW-DESELECT (PV-SUB) TO    TRUE                         36970000
           MOVE LQW-SELECTED-SW (PV-SUB)                                36980000
                                     TO LQW-TEMP-SELECTED-SW (PV-SUB).  36990000
           SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                37000000
                                                                        37010000
      *----------------------------------------------------------------*37020000
      *    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *37030000
      *----------------------------------------------------------------*37040000
                                                                        37050000
       6111-WRITE-LIST-QUEUE.                                           37060000
                                                                        37070000
           EXEC CICS                                                    37080000
               WRITEQ TS                                                37090000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          37100000
                   FROM  (LQW-LIST-QUEUE-WORK-AREA)                     37110000
                   ITEM  (PV-SAVE-ITEM)                                 37120000
                   REWRITE                                              37130000
                   RESP  (PV-CICS-RESP)                                 37140000
           END-EXEC.                                                    37150000
      *                                                                 37160000
           IF  PV-CICS-RESP = DFHRESP (NORMAL)                          37170000
               CONTINUE                                                 37180000
           ELSE                                                         37190000
               SET DP013-CICS-ABEND  TO  TRUE                           37200000
               SET DP013-NO-ROLLBACK TO  TRUE                           37210000
               MOVE '6111-WRITE-LIST-QUEUE'                             37220000
                                     TO  DP013-PARAGRAPH                37230000
               MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  37240000
                                     TO  DP013-MESSAGE-TEXT(1)          37250000
               PERFORM DP013-0000-PROCESS-ABEND                         37260000
           END-IF.                                                      37270000
                                                                        37280000
       EJECT                                                            37290000
      *----------------------------------------------------------------*37300000
      *    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*37310000
      *----------------------------------------------------------------*37320000
                                                                        37330000
       6112-READ-LIST-QUEUE.                                            37340000
                                                                        37350000
           EXEC CICS                                                    37360000
               READQ TS                                                 37370000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          37380000
                   INTO  (LQW-LIST-QUEUE-WORK-AREA)                     37390000
                   ITEM  (PV-ITEM)                                      37400000
                   RESP  (PV-CICS-RESP)                                 37410000
           END-EXEC.                                                    37420000
      *                                                                 37430000
           IF  PV-CICS-RESP = DFHRESP (NORMAL)                          37440000
               CONTINUE                                                 37450000
           ELSE                                                         37460000
               SET DP013-CICS-ABEND        TO TRUE                      37470000
               SET DP013-NO-ROLLBACK       TO TRUE                      37480000
               MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           37490000
               MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    37500000
                                           TO DP013-MESSAGE-TEXT(1)     37510000
               PERFORM DP013-0000-PROCESS-ABEND                         37520000
           END-IF.                                                      37530000
                                                                        37540000
       EJECT                                                            37550000
      *----------------------------------------------------------------*37560000
      * PRODUCE THE LIST REPORT USING THE DRS FACILITY.                *37570000
      *----------------------------------------------------------------*37580000
       6300-PRINT-LIST.                                                 37590000
                                                                        37600000
           PERFORM 6310-INITIALIZE.                                     37610000
           MOVE PC-PUT                 TO DRS01-DRRB-FUNC.              37620000
           SET PS-FIRST-LINE           TO TRUE.                         37630000
           PERFORM 6320-READ-LIST-QUEUE                                 37640000
                   VARYING PV-ITEM                                      37650000
                   FROM 1 BY 1                                          37660000
                   UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     37670000
                                                                        37680000
           MOVE PC-TERM                TO DRS01-DRRB-FUNC.              37690000
           PERFORM 8000-LINK-TO-DRS.                                    37700000
                                                                        37710000
      *----------------------------------------------------------------*37720000
      * INITIALIZE VARIABLES FOR DRS PRINTING.                         *37730000
      *----------------------------------------------------------------*37740000
       6310-INITIALIZE.                                                 37750000
           PERFORM 8100-FORMAT-TIME.                                    37760000
                                                                        37770000
           IF TF001-PRINTER-DEST = 'XXXX'                               37780000
               MOVE 'R'                TO DRS02-DRIB-CLASS              37790000
               MOVE 'N'                TO DRS02-DRIB-HOLD               37800000
               MOVE 'LOCAL'            TO DRS02-DRIB-DEST               37810000
           ELSE                                                         37820000
               MOVE 'A'                TO DRS02-DRIB-CLASS              37830000
               MOVE 'N'                TO DRS02-DRIB-HOLD               37840000
               MOVE TF001-PRINTER-DEST TO DRS02-DRIB-DEST               37850000
           END-IF.                                                      37860000
                                                                        37870000
           MOVE PC-INIT                TO DRS01-DRRB-FUNC.              37880000
           MOVE DRS02-DRIB-HEADER      TO DRS01-COMM-DRIB-HDR.          37890000
           MOVE DRS02-DRIB-ATTRIB      TO DRS01-COMM-DRIB-AT1.          37900000
                                                                        37910000
           PERFORM 8000-LINK-TO-DRS.                                    37920000
                                                                        37930000
           MOVE PC-CURRENT-PROGRAM-NAME TO DP132O-PROGRAM-NAME.         37940000
           MOVE 1                       TO DP132O-REPORT-NUMBER.        37950000
           MOVE ASC-CRIT-XFER-NBR-9     TO HL3-XFER-NBR.                37960000
           MOVE '-'                     TO HL3-XFER-NBR-DASH.           37970000
           MOVE ASC-XFER-STATUS-DESC    TO HL4-XFER-STATUS.             37980000
           MOVE 99                      TO PV-LINE-COUNT.               37990000
           MOVE 0                       TO PV-PAGE-COUNT.               38000000
      *----------------------------------------------------------------*38010000
      * READ A LIST QUEUE RECORD AND GENERATE THE DRS REPORT DETAIL    *38020000
      * LINE FOR ALL ENTRIES IN THE BLOCK.                             *38030000
      *----------------------------------------------------------------*38040000
                                                                        38050000
       6320-READ-LIST-QUEUE.                                            38060000
                                                                        38070000
           PERFORM 6112-READ-LIST-QUEUE.                                38080000
                                                                        38090000
           IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       38100000
               PERFORM 6330-PRINT-REPORT                                38110000
                 VARYING LQW-IDX                                        38120000
                   FROM 1 BY 1                                          38130000
                   UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL        38140000
                     OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO      38150000
           END-IF.                                                      38160000
       EJECT                                                            38170000
      *----------------------------------------------------------------*38180000
      * MOVE THE APPROPRIATE FIELDS (DEPENDING ON THE TRANSFER TYPE)   *38190000
      * TO THE DETAIL LINE AND PRINT.                                  *38200000
      *----------------------------------------------------------------*38210000
       6330-PRINT-REPORT.                                               38220000
           IF PV-LINE-COUNT > PC-LINE-MAX                               38230000
               PERFORM 8200-PRINT-HEADINGS                              38240000
           END-IF.                                                      38250000
           EVALUATE TRUE                                                38260000
             WHEN ASC-RETAIL-XFER                                       38270000
               MOVE SPACES               TO DL1A-DETAIL-LINE-1A         38280000
               IF LQW-XFER-PRICE (LQW-IDX) = LQW-RECV-PRICE (LQW-IDX) OR38290000
                  LQW-RECV-PRICE (LQW-IDX) = ZERO                   OR  38300000
                  PS-FIRST-LINE                                         38310000
                   MOVE LQW-LINE        (LQW-IDX)                       38320000
                                         TO DL1A-LINE                   38330000
                   MOVE LQW-ACTION      (LQW-IDX)                       38340000
                                         TO DL1A-ACTION                 38350000
                   MOVE LQW-DEPT        (LQW-IDX)                       38360000
                                         TO DL1A-DEPT                   38370000
                   IF LQW-CLASS (LQW-IDX) < PC-100 AND                  38380000
                      LQW-SUBCLASS (LQW-IDX) < PC-100                   38390000
                       MOVE LQW-CLASS (LQW-IDX) TO DL1A-CLASS-1         38400000
                       MOVE LQW-SUBCLASS (LQW-IDX) TO DL1A-SUBCLASS-1   38410000
                   ELSE IF                                              38420000
                      LQW-CLASS (LQW-IDX) < PC-100 AND                  38430000
                      LQW-SUBCLASS (LQW-IDX) > PC-099                   38440000
                       MOVE LQW-CLASS (LQW-IDX)    TO DL1A-CLASS-2      38450000
                       MOVE LQW-SUBCLASS (LQW-IDX) TO DL1A-SUBCLASS-2   38460000
                       MOVE SPACES TO DL1A-FILLER-2A                    38470000
                                      DL1A-FILLER-2B                    38480000
                   ELSE IF                                              38490000
                      LQW-CLASS (LQW-IDX) > PC-099 AND                  38500000
                      LQW-SUBCLASS (LQW-IDX) < PC-100                   38510000
                       MOVE LQW-CLASS (LQW-IDX)    TO DL1A-CLASS-3      38520000
                       MOVE LQW-SUBCLASS (LQW-IDX) TO DL1A-SUBCLASS-3   38530000
                       MOVE SPACES TO DL1A-FILLER-3A                    38540000
                                      DL1A-FILLER-3B                    38550000
                   ELSE IF                                              38560000
                      LQW-CLASS (LQW-IDX) > PC-099 AND                  38570000
                      LQW-SUBCLASS (LQW-IDX) > PC-099                   38580000
                       MOVE LQW-CLASS (LQW-IDX)    TO DL1A-CLASS-4      38590000
                       MOVE LQW-SUBCLASS (LQW-IDX) TO DL1A-SUBCLASS-4   38600000
                       MOVE SPACES TO DL1A-FILLER-4A                    38610000
                   END-IF                                               38620000
                   END-IF                                               38630000
                   END-IF                                               38640000
                   END-IF                                               38650000
                   MOVE LQW-UPC         (LQW-IDX)                       38660000
                                         TO DL1A-UPC                    38670000
                   MOVE '-'              TO DL1A-UPC-DASH-1             38680000
                                            DL1A-UPC-DASH-2             38690000
                                            DL1A-UPC-DASH-3             38700000
                   IF LQW-XFER-QTY    (LQW-IDX) > 0                     38710000
                       MOVE LQW-XFER-QTY    (LQW-IDX)                   38720000
                                         TO DL1A-TQTY                   38730000
                       MOVE LQW-XFER-PRICE  (LQW-IDX)                   38740000
                                         TO DL1A-TPRICE                 38750000
                   END-IF                                               38760000
               END-IF                                                   38770000
               IF LQW-RECV-QTY    (LQW-IDX) > 0                         38780000
                   MOVE LQW-RECV-QTY    (LQW-IDX)                       38790000
                                         TO DL1A-RQTY                   38800000
                   MOVE LQW-RECV-PRICE  (LQW-IDX)                       38810000
                                         TO DL1A-RPRICE                 38820000
               END-IF                                                   38830000
               MOVE LQW-FILE-PRICE  (LQW-IDX)                           38840000
                                         TO DL1A-FPRICE                 38850000
               MOVE DL1A-DETAIL-LINE-1A                                 38860000
                                         TO DRS01-COMM-DATA             38870000
             WHEN OTHER                                                 38880000
               MOVE SPACES               TO DL1B-DETAIL-LINE-1B         38890000
                   MOVE LQW-ACTION      (LQW-IDX)                       38900000
                                         TO DL1B-ACTION                 38910000
                   MOVE LQW-LINE        (LQW-IDX)                       38920000
                                         TO DL1B-LINE                   38930000
                   MOVE LQW-DESCRIPTION (LQW-IDX)                       38940000
                                         TO DL1B-DESCRIPTION            38950000
                   MOVE LQW-XFER-QTY    (LQW-IDX)                       38960000
                                         TO DL1B-TQTY                   38970000
                   MOVE LQW-RECV-QTY    (LQW-IDX)                       38980000
                                         TO DL1B-RQTY                   38990000
                   MOVE DL1B-DETAIL-LINE-1B                             39000000
                                         TO DRS01-COMM-DATA             39010000
           END-EVALUATE.                                                39020000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               39030000
           PERFORM 8000-LINK-TO-DRS.                                    39040000
           ADD 1                       TO PV-LINE-COUNT.                39050000
           IF PS-FIRST-LINE                                             39060000
               SET PS-NOT-FIRST-LINE   TO TRUE                          39070000
           END-IF.                                                      39080000
      *----------------------------------------------------------------*39090000
      *    DETERMINE WHETHER THERE IS A TRANSFER DISCREPANCY.          *39100000
      *----------------------------------------------------------------*39110000
                                                                        39120000
       7100-CHECK-XFER-DISCREPANCY.                                     39130000
           SET ASC-NO-DISCREPANCY-EXISTS  TO TRUE.                      39140000
           PERFORM                                                      39150000
               WITH TEST AFTER                                          39160000
               VARYING PV-RETRY-COUNTER                                 39170000
               FROM 1 BY 1                                              39180000
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               39190000
                         OR (SQLCODE = ZERO)                            39200000
                         OR (SQLCODE = +100))                           39210000
      *                                                                 39220000
               EXEC SQL                                                 39230000
                   SELECT RCVD_AT_STR_NBR                               39240000
                   INTO   :TFDSCP-RCVD-AT-STR-NBR                       39250000
                   FROM   TTFDSCP D                                     39260000
                         ,TTFSTAT S                                     39270000
                   WHERE  D.XFER_DKEY_ID   = :DK-XFER-DKEY-ID  AND      39280000
                          S.XFER_DKEY_ID   = :DK-XFER-DKEY-ID  AND      39290000
                          S.XFER_STAT_CDE  = :PC-POSITIVE-RECEIPT       39300000
                                                                AND     39310000
                          S.XFER_STAT_TMST = D.RCV_XFER_BEG_TMST        39320000
               END-EXEC                                                 39330000
                                                                        39340000
               EVALUATE TRUE                                            39350000
                   WHEN SQLCODE = ZERO                                  39360000
                       SET ASC-DISCREPANCY-EXISTS TO TRUE               39370000
                   WHEN SQLCODE = +100                                  39380000
                       PERFORM 7150-CHECK-ITEM-DISCREPANCY              39390000
                   WHEN SQLCODE = -904                                  39400000
                   WHEN SQLCODE = -913                                  39410000
                       CONTINUE                                         39420000
                   WHEN OTHER                                           39430000
                       MOVE '7100-CHECK-XFER-DISCREPANCY'               39460000
                                         TO DP013-PARAGRAPH             39470000
                       MOVE 'SELECT DISCREPANCY ROW'                    39480000
                                         TO DP013-MESSAGE-TEXT (1)      39490000
                       MOVE SQLCA        TO DP013-SQLCA                 39500000
                       MOVE 'TTFDSCP'    TO DP013-DB2-TABLE-NAME (1)    39510000
                       SET DP013-DB2-ABEND                              39520000
                           DP013-XCTL-DISPLAY-RESTART                   39530000
                                         TO TRUE                        39540000
                       PERFORM DP013-0000-PROCESS-ABEND                 39550000
               END-EVALUATE                                             39560000
           END-PERFORM.                                                 39570000
      *                                                                 39580000
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        39590000
               MOVE '7100-CHECK-XFER-DISCREPANCY'                       39600000
                                         TO DP013-PARAGRAPH             39610000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     39620000
                                         TO DP013-MESSAGE-TEXT (1)      39630000
               MOVE 'DISCREPANCY DATA'   TO DP013-MESSAGE-TEXT (2)      39640000
               MOVE SQLCA                TO DP013-SQLCA                 39650000
               MOVE 'TTFDSCP'            TO DP013-DB2-TABLE-NAME (1)    39660000
               SET DP013-DB2-ABEND                                      39670000
                   DP013-XCTL-DISPLAY-RESTART                           39680000
                                         TO TRUE                        39690000
               PERFORM DP013-0000-PROCESS-ABEND                         39700000
           END-IF.                                                      39710000
       EJECT                                                            39720000
      *----------------------------------------------------------------*39730000
      *    DETERMINE WHETHER THERE IS A TRANSFER ITEM DISCREPANCY.     *39740000
      *----------------------------------------------------------------*39750000
                                                                        39760000
       7150-CHECK-ITEM-DISCREPANCY.                                     39770000
           PERFORM                                                      39780000
               WITH TEST AFTER                                          39790000
               VARYING PV-RETRY-COUNTER                                 39800000
               FROM 1 BY 1                                              39810000
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               39820000
                         OR (SQLCODE = ZERO)                            39830000
                         OR (SQLCODE = +100))                           39840000
      *                                                                 39850000
               EXEC SQL                                                 39860000
                   SELECT DISTINCT R.XFER_DKEY_ID                       39870000
                   INTO   :TFITRC-XFER-DKEY-ID                          39880000
                   FROM                                                 39890000
                         TTFITRC R                                      39900000
                       , TTFSTAT S                                      39910000
                   WHERE                                                39920000
                       R.XFER_DKEY_ID    = :DK-XFER-DKEY-ID       AND   39930000
                       S.XFER_DKEY_ID    = :DK-XFER-DKEY-ID       AND   39940000
                       S.XFER_STAT_CDE   = :PC-POSITIVE-RECEIPT   AND   39950000
                       S.XFER_STAT_TMST  = R.XFER_RCPT_TMST       AND   39960000
                       R.XFER_ITM_DSCRP_IND = 'Y'                       39970000
               END-EXEC                                                 39980000
                                                                        39990000
               EVALUATE TRUE                                            40000000
                   WHEN SQLCODE = ZERO                                  40010000
                       SET ASC-DISCREPANCY-EXISTS                       40020000
                                         TO TRUE                        40030000
                   WHEN SQLCODE = +100                                  40040000
                   WHEN SQLCODE = -904                                  40050000
                   WHEN SQLCODE = -913                                  40060000
                       CONTINUE                                         40070000
                   WHEN OTHER                                           40080000
                       MOVE '7150-CHECK-ITEM-DISCREPANCY'               40110000
                                         TO DP013-PARAGRAPH             40120000
                       MOVE 'SELECT ITEM RECEIPT ROW'                   40130000
                                         TO DP013-MESSAGE-TEXT (1)      40140000
                       MOVE SQLCA        TO DP013-SQLCA                 40150000
                       MOVE 'TTFITRC'    TO DP013-DB2-TABLE-NAME (1)    40160000
                       MOVE 'TTFSTAT'    TO DP013-DB2-TABLE-NAME (2)    40170000
                       SET DP013-DB2-ABEND                              40180000
                           DP013-XCTL-DISPLAY-RESTART                   40190000
                                         TO TRUE                        40200000
                       PERFORM DP013-0000-PROCESS-ABEND                 40210000
               END-EVALUATE                                             40220000
           END-PERFORM.                                                 40230000
      *                                                                 40240000
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        40250000
               MOVE '7150-CHECK-ITEM-DISCREPANCY'                       40260000
                                         TO DP013-PARAGRAPH             40270000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     40280000
                                         TO DP013-MESSAGE-TEXT (1)      40290000
               MOVE 'ITEM RECEIPT DATA'  TO DP013-MESSAGE-TEXT (2)      40300000
               MOVE SQLCA                TO DP013-SQLCA                 40310000
               MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)    40320000
               MOVE 'TTFSTAT'            TO DP013-DB2-TABLE-NAME (2)    40330000
               SET DP013-DB2-ABEND                                      40340000
                   DP013-XCTL-DISPLAY-RESTART                           40350000
                                         TO TRUE                        40360000
               PERFORM DP013-0000-PROCESS-ABEND                         40370000
           END-IF.                                                      40380000
       EJECT                                                            40390000
      *                                                                 40400000
      *----------------------------------------------------------------*40410000
      * THIS MODULE EXECUTES A LINK TO DRS (DYNAMIC REPORT SYSTEM).     40420000
      *----------------------------------------------------------------*40430000
       8000-LINK-TO-DRS.                                                40440000
                                                                        40450000
           EXEC CICS                                                    40460000
               LINK                                                     40470000
                   PROGRAM   ('DRS1INTC')                               40480000
                   COMMAREA  (DRS01-COMMAREA)                           40490000
           END-EXEC.                                                    40500000
                                                                        40510000
      *----------------------------------------------------------------*40520000
      * FORMAT THE REPORT HEADING DATE AND TIME FIELDS.                 40530000
      *----------------------------------------------------------------*40540000
       8100-FORMAT-TIME.                                                40550000
                                                                        40560000
           EXEC CICS                                                    40570000
               ASKTIME ABSTIME (PV-ABSTIME)                             40580000
           END-EXEC.                                                    40590000
                                                                        40600000
           EXEC CICS                                                    40610000
               FORMATTIME ABSTIME  (PV-ABSTIME)                         40620000
                          MMDDYY   (DP132O-RUN-DATE)                    40630000
                          DATESEP  ('/')                                40640000
                          TIME     (DP132O-RUN-TIME)                    40650000
                          TIMESEP  (':')                                40660000
           END-EXEC.                                                    40670000
                                                                        40680000
       EJECT                                                            40690000
      *----------------------------------------------------------------*40700000
      *  PRINT THE REPORT HEADING LINES.                                40710000
      *----------------------------------------------------------------*40720000
       8200-PRINT-HEADINGS.                                             40730000
           ADD 1                       TO PV-PAGE-COUNT.                40740000
           MOVE PV-PAGE-COUNT          TO DP132O-PAGE-NUMBER.           40750000
           MOVE DP132O-STANDRD-HEADER-132-COLS                          40760000
                                       TO DRS01-COMM-DATA.              40770000
           MOVE PC-TOP-OF-PAGE         TO DRS01-COMM-CTL.               40780000
           PERFORM 8000-LINK-TO-DRS.                                    40790000
                                                                        40800000
           MOVE HL2-HEADING-LINE-2     TO DRS01-COMM-DATA.              40810000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               40820000
           PERFORM 8000-LINK-TO-DRS.                                    40830000
                                                                        40840000
           MOVE HL3-HEADING-LINE-3     TO DRS01-COMM-DATA.              40850000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               40860000
           PERFORM 8000-LINK-TO-DRS.                                    40870000
                                                                        40880000
           MOVE HL4-HEADING-LINE-4     TO DRS01-COMM-DATA.              40890000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               40900000
           PERFORM 8000-LINK-TO-DRS.                                    40910000
                                                                        40920000
           EVALUATE TRUE                                                40930000
               WHEN ASC-RETAIL-XFER                                     40940000
                   MOVE HL5A-HEADING-LINE-5A                            40950000
                                       TO DRS01-COMM-DATA               40960000
                   MOVE PC-SINGLE-SPACE                                 40970000
                                       TO DRS01-COMM-CTL                40980000
                   PERFORM 8000-LINK-TO-DRS                             40990000
                                                                        41000000
                   MOVE HL6A-HEADING-LINE-6A                            41010000
                                       TO DRS01-COMM-DATA               41020000
                   MOVE PC-SINGLE-SPACE                                 41030000
                                       TO DRS01-COMM-CTL                41040000
                   PERFORM 8000-LINK-TO-DRS                             41050000
               WHEN OTHER                                               41060000
                   MOVE HL5B-HEADING-LINE-5B                            41070000
                                       TO DRS01-COMM-DATA               41080000
                   MOVE PC-SINGLE-SPACE                                 41090000
                                       TO DRS01-COMM-CTL                41100000
                   PERFORM 8000-LINK-TO-DRS                             41110000
                                                                        41120000
                   MOVE HL6B-HEADING-LINE-6B                            41130000
                                       TO DRS01-COMM-DATA               41140000
                   MOVE PC-SINGLE-SPACE                                 41150000
                                       TO DRS01-COMM-CTL                41160000
                   PERFORM 8000-LINK-TO-DRS                             41170000
           END-EVALUATE.                                                41180000
                                                                        41190000
           MOVE BL-BLANK-LINE          TO DRS01-COMM-DATA.              41200000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               41210000
           PERFORM 8000-LINK-TO-DRS.                                    41220000
           MOVE 7                        TO PV-LINE-COUNT.              41230000
           SET PS-FIRST-LINE           TO TRUE.                         41240000
                                                                        41250000
       EJECT                                                            41260000
      *----------------------------------------------------------------*41270000
      * READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *41280000
      *----------------------------------------------------------------*41290000
                                                                        41300000
       9100-READ-SEL-QUEUE-IN.                                          41310000
           EXEC CICS                                                    41320000
               READQ TS                                                 41330000
                   QUEUE (ASC-SEL-QUEUE-IN-NAME)                        41340000
                   INTO  (TF002-TRANSFER-SEL-REC)                       41350000
                   ITEM  (ASC-SEL-ITEM)                                 41360000
                   RESP  (PV-CICS-RESP)                                 41370000
           END-EXEC.                                                    41380000
                                                                        41390000
           IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       41400000
               CONTINUE                                                 41410000
           ELSE                                                         41420000
               SET DP013-LOGIC-ABEND                                    41430000
                   DP013-NO-ROLLBACK     TO TRUE                        41440000
               MOVE '9100-READ-SEL-QUEUE-IN'                            41450000
                                         TO DP013-PARAGRAPH             41460000
               MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   41470000
                                         TO DP013-MESSAGE-TEXT (1)      41480000
               PERFORM DP013-0000-PROCESS-ABEND                         41490000
           END-IF.                                                      41500000
      *----------------------------------------------------------------*41510000
      * UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *41520000
      *----------------------------------------------------------------*41530000
       9200-REWRITE-SEL-QUEUE-IN.                                       41540000
           EXEC CICS                                                    41550000
                WRITEQ TS                                               41560000
                    QUEUE  (ASC-SEL-QUEUE-IN-NAME)                      41570000
                    FROM   (TF002-TRANSFER-SEL-REC)                     41580000
                    ITEM   (ASC-SEL-ITEM)                               41590000
                    RESP   (PV-CICS-RESP)                               41600000
                    REWRITE                                             41610000
           END-EXEC.                                                    41620000
                                                                        41630000
           IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   41640000
               SET DP013-CICS-ABEND                                     41650000
                   DP013-NO-ROLLBACK     TO TRUE                        41660000
               MOVE '9200-REWRITE-SEL-QUEUE-IN'                         41670000
                                         TO DP013-PARAGRAPH             41680000
               MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   41690000
                                         TO DP013-MESSAGE-TEXT (1)      41700000
               PERFORM DP013-0000-PROCESS-ABEND                         41710000
           END-IF.                                                      41720000
                                                                        41730000
       EJECT                                                            41740000
      *----------------------------------------------------------------*41750000
      *    ABEND PROCESSOR MODULE                                      *41760000
      *----------------------------------------------------------------*41770000
                                                                        41780000
           COPY DPPD013.                                                41790000
