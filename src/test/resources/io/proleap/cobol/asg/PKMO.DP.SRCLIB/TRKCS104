000100*-----------------------*                                         07/11/95
000200 IDENTIFICATION DIVISION.                                         TRKCS104
000300*-----------------------*                                            LV001
000400 PROGRAM-ID.    TRKCS104.                                         TRKCS104
000500 AUTHOR.        STEPHANIE HERON.                                  TRKCS104
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          TRKCS104
000700 DATE-WRITTEN.  03-10-95.                                         TRKCS104
000800 DATE-COMPILED.                                                   TRKCS104
000900*----------------------------------------------------------------*TRKCS104
001000*                                                                *TRKCS104
001100*    Y104 - SHIPMENT FORECASTING CRITERIA SPECIFICATION          *TRKCS104
001200*                                                                *TRKCS104
001300*    THERE ARE 9 DATA ENTERABLE FIELDS ON THIS SELECTION SCREEN: *TRKCS104
001400*          DEPARTMENT, PURCHASE ORDER NUMBER, FREIGHT BILL       *TRKCS104
001500*          (PRO NUMBER), OPER UNIT, FACILITY, SCAC, ESTIMATED    *TRKCS104
001600*          TIME OF ARRIVAL, ENDING DATE, AND TRAILER NUMBER.     *TRKCS104
001700*                                                                *TRKCS104
001800*    VALIDATION CONSISTS OF:  PURCHASE ORDER MUST BE ON THE      *TRKCS104
001900*    SHPTPO TABLE, FREIGHT BILL MUST EXIST ON THE SHIPMT TABLE,  *TRKCS104
002000*    OPERATING UNIT AND FACILITY MUST BE ON THE TFCLTY TABLE,    *TRKCS104
002100*    SCAC MUST BE ON THE VENDOR TABLE, ETA, ETA ENDING DATE      *TRKCS104
002200*    MUST BE IN THE FORMAT CCYYMMDD AND DEPARTMENT NUMBER MUST   *TRKCS104
002300*    BE ON TPURCHS.                                              *TRKCS104
002400*                                                                *TRKCS104
002500*    IF VALID INFORMATION IS ENTERED AND PF17 PRESSED, THE       *TRKCS104
002600*    PROGRAM WILL XCTL TO TRLSHFRC, THE SHIPMENT DELIVERY        *TRKCS104
002700*    FORECAST LIST.  IF PF18 IS PRESSED, TRLSHSUM, THE SHIPMENT  *TRKCS104
002800*    SUMMARY BY ETA WILL BE EXECUTED.                            *TRKCS104
002900*                                                                *TRKCS104
003000*----------------------------------------------------------------*TRKCS104
273427* CHANGED 08/16/2022    BY BARB SCHULTZ    WR: CHG0273427         TRKCS104
273427* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     TRKCS104
273427* MAKING THE CALL DYNAMIC VS STATIC.                              TRKCS104
003000*----------------------------------------------------------------*TRKCS104
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
003100                                                                  TRKCS104
003200                                                                  TRKCS104
003300                                                                  TRKCS104
003400 ENVIRONMENT DIVISION.                                            TRKCS104
003500                                                                  TRKCS104
003600                                                                  TRKCS104
003700                                                                  TRKCS104
003800 DATA DIVISION.                                                   TRKCS104
003900                                                                  TRKCS104
004000                                                                  TRKCS104
004100 WORKING-STORAGE SECTION.                                         TRKCS104
004200*                                                                 TRKCS104
004300 01  PC-PROGRAM-CONSTANTS.                                        TRKCS104
004400     05  PC-CURRENT-MAP-NAME          PIC X(08) VALUE 'TR104A  '. TRKCS104
004500     05  PC-CURRENT-MAPSET-NAME       PIC X(08) VALUE 'TRKM104 '. TRKCS104
004600     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'TRKCS104'. TRKCS104
004700     05  PC-Y                           PIC X(01) VALUE 'Y'.      TRKCS104
004800     05  PC-DPKUT500                    PIC X(08) VALUE           TRKCS104
004900         'DPKUT500'.                                              TRKCS104
005200     05  PC-RCKUT023                    PIC X(08)   VALUE         TRKCS104
005300         'RCKUT023'.                                              TRKCS104
005400     05  PC-TRAILER-CRIT-SPEC           PIC X(01) VALUE '1'.      TRKCS104
005500     05  PC-MAX-RETRIES                 PIC 9(02) VALUE 3.        TRKCS104
005600     05  PC-TSYMSG-NUMBERS.                                       TRKCS104
005700         10 PC-TSYMSG-00004             PIC 9(05) VALUE 00004.    TRKCS104
005800*           PRESS F2 TO CONFIRM REQUEST                           TRKCS104
005900         10 PC-TSYMSG-00005             PIC 9(05) VALUE 00005.    TRKCS104
006000*           INVALID VALUE                                         TRKCS104
006100         10 PC-TSYMSG-00007             PIC 9(05) VALUE 00007.    TRKCS104
006200*           REQUIRED ENTRY                                        TRKCS104
006300         10 PC-TSYMSG-00008             PIC 9(05) VALUE 00008.    TRKCS104
006400*           MUST BE NUMERIC                                       TRKCS104
006500         10 PC-TSYMSG-00009             PIC 9(05) VALUE 00009.    TRKCS104
006600*           INVALID DATE                                          TRKCS104
006700         10 PC-TSYMSG-00017             PIC 9(05) VALUE 00017.    TRKCS104
006800*           STORE DOES NOT EXIST                                  TRKCS104
006900         10 PC-TSYMSG-00032             PIC 9(05) VALUE 00032.    TRKCS104
007000*           DEPARTMENT DOES NOT EXIST                             TRKCS104
007100         10 PC-TSYMSG-00036             PIC 9(05) VALUE 00036.    TRKCS104
007200*           AT LEAST ONE LINE MUST BE ENTERED                     TRKCS104
007300         10 PC-TSYMSG-00045             PIC 9(05) VALUE 00045.    TRKCS104
007400*           INVALID FUNCTION KEY                                  TRKCS104
007500         10 PC-TSYMSG-00051             PIC 9(05) VALUE 00051.    TRKCS104
007600*           NO END OF RANGE HAS BEEN SPECIFIED                    TRKCS104
007700         10 PC-TSYMSG-00053             PIC 9(05) VALUE 00053.    TRKCS104
007800*           NO START OF RANGE HAS BEEN SPECIFIED                  TRKCS104
007900         10 PC-TSYMSG-00052             PIC 9(05) VALUE 00052.    TRKCS104
008000*           END OF RANGE PRECEDES SART OF RANGE                   TRKCS104
008100         10 PC-TSYMSG-00083             PIC 9(05) VALUE 00083.    TRKCS104
008200*           PURCHASE ORDER DOES NOT EXIST                         TRKCS104
008300         10 PC-TSYMSG-00148             PIC 9(05) VALUE 00148.    TRKCS104
008400*           DATA DOES NOT EXIST                                   TRKCS104
008500                                                                  TRKCS104
008600 01  PS-PROGRAM-SWITCHES.                                         TRKCS104
008700     05  PS-ERROR-SW                    PIC X(01) VALUE 'N'.      TRKCS104
008800         88  PS-ERROR                             VALUE 'Y'.      TRKCS104
008900         88  PS-NO-ERROR                          VALUE 'N'.      TRKCS104
009000     05  PS-ASTERISK-FOUND-SW           PIC X(01) VALUE 'N'.      TRKCS104
009100         88  PS-ASTERISK-FOUND                    VALUE 'Y'.      TRKCS104
009200         88  PS-NO-ASTERISK-FOUND                 VALUE 'N'.      TRKCS104
009300     05  PS-VALID-DEPT-SW               PIC X(01) VALUE 'N'.      TRKCS104
009400         88  PS-VALID-DEPT                        VALUE 'Y'.      TRKCS104
009500         88  PS-INVALID-DEPT                      VALUE 'N'.      TRKCS104
009600     05  PS-VALID-PO-NBR-SW             PIC X(01) VALUE 'N'.      TRKCS104
009700         88  PS-VALID-PO-NBR                      VALUE 'Y'.      TRKCS104
009800         88  PS-INVALID-PO-NBR                    VALUE 'N'.      TRKCS104
009900     05  PS-VALID-PRO-NBR-SW            PIC X(01) VALUE 'N'.      TRKCS104
010000         88  PS-VALID-PRO-NBR                     VALUE 'Y'.      TRKCS104
010100         88  PS-INVALID-PRO-NBR                   VALUE 'N'.      TRKCS104
010200     05  PS-VALID-OPER-UNIT-SW          PIC X(01) VALUE 'N'.      TRKCS104
010300         88  PS-VALID-OPER-UNIT                   VALUE 'Y'.      TRKCS104
010400         88  PS-INVALID-OPER-UNIT                 VALUE 'N'.      TRKCS104
010500     05  PS-VALID-FACILITY-SW           PIC X(01) VALUE 'N'.      TRKCS104
010600         88  PS-VALID-FACILITY                    VALUE 'Y'.      TRKCS104
010700         88  PS-INVALID-FACILITY                  VALUE 'N'.      TRKCS104
010800     05  PS-VALID-SCAC-SW               PIC X(01) VALUE 'N'.      TRKCS104
010900         88  PS-VALID-SCAC                        VALUE 'Y'.      TRKCS104
011000         88  PS-INVALID-SCAC                      VALUE 'N'.      TRKCS104
011100     05  PS-VALID-DATE-SW               PIC X(01) VALUE 'N'.      TRKCS104
011200         88  PS-VALID-DATE                        VALUE 'Y'.      TRKCS104
011300         88  PS-INVALID-DATE                      VALUE 'N'.      TRKCS104
011400     05  PS-VALID-ETA-DTE-SW            PIC X(01) VALUE 'N'.      TRKCS104
011500         88  PS-VALID-ETA-DTE                     VALUE 'Y'.      TRKCS104
011600         88  PS-INVALID-ETA-DTE                   VALUE 'N'.      TRKCS104
011700     05  PS-VALID-ETA-TO-DTE-SW         PIC X(01) VALUE 'N'.      TRKCS104
011800         88  PS-VALID-ETA-TO-DTE                  VALUE 'Y'.      TRKCS104
011900         88  PS-INVALID-ETA-TO-DTE                VALUE 'N'.      TRKCS104
012000     05  PS-VALID-DATE-RANGE-SW         PIC X(01) VALUE 'N'.      TRKCS104
012100         88  PS-VALID-DATE-RANGE                  VALUE 'Y'.      TRKCS104
012200         88  PS-INVALID-DATE-RANGE                VALUE 'N'.      TRKCS104
012300                                                                  TRKCS104
012400 01  PV-PROGRAM-VARIABLES.                                        TRKCS104
012500     05  PV-RETRY-COUNTER               PIC S9(04) VALUE +0       TRKCS104
012600                                                    COMP SYNC.    TRKCS104
012700     05  PV-DB2-COUNT                   PIC S9(09) COMP-3.        TRKCS104
012800     05  PV-DB2-DATE.                                             TRKCS104
012900         10  PV-DB2-DATE-CCYY           PIC X(4) VALUE ZEROES.    TRKCS104
013000         10  FILLER                     PIC X.                    TRKCS104
013100         10  PV-DB2-DATE-MM             PIC X(2) VALUE ZEROES.    TRKCS104
013200         10  FILLER                     PIC X.                    TRKCS104
013300         10  PV-DB2-DATE-DD             PIC X(2) VALUE ZEROES.    TRKCS104
013400     05  PV-LOCATION.                                             TRKCS104
013500         10  FILLER                     PIC X(01) VALUE '0'.      TRKCS104
013600         10  PV-DP020-LOCATION          PIC X(03) VALUE '000'.    TRKCS104
013700     05  PV-INPUT-DATE.                                           TRKCS104
013800         10  PV-INPUT-DATE-MM           PIC 9(2) VALUE ZEROES.    TRKCS104
013900         10  PV-INPUT-DATE-DD           PIC 9(2) VALUE ZEROES.    TRKCS104
014000         10  PV-INPUT-DATE-CCYY         PIC 9(4) VALUE ZEROES.    TRKCS104
014100         10  FILLER REDEFINES PV-INPUT-DATE-CCYY.                 TRKCS104
014200             15  PV-INPUT-DATE-CC       PIC 9(2).                 TRKCS104
014300             15  PV-INPUT-DATE-YY       PIC 9(2).                 TRKCS104
014400     05  PV-VALID-DATE.                                           TRKCS104
014500         10  PV-VALID-DATE-MM           PIC X(2) VALUE SPACES.    TRKCS104
014600         10  PV-VALID-DATE-DD           PIC X(2) VALUE SPACES.    TRKCS104
014700         10  PV-VALID-DATE-CCYY         PIC X(4) VALUE SPACES.    TRKCS104
014800         10  FILLER REDEFINES PV-VALID-DATE-CCYY.                 TRKCS104
014900             15  PV-VALID-DATE-CC       PIC X(2).                 TRKCS104
015000             15  PV-VALID-DATE-YY       PIC X(2).                 TRKCS104
015100     05  PV-VALID-ETA-DTE               PIC X(8) VALUE SPACES.    TRKCS104
015200     05  PV-VALID-ETA-TO-DTE            PIC X(8) VALUE SPACES.    TRKCS104
015300     05  PV-OPER-UNT-ID                 PIC S9(04) VALUE ZEROS    TRKCS104
015400                                                     COMP.        TRKCS104
015500     05  PV-FCLTY-ID                    PIC S9(04) VALUE ZEROS    TRKCS104
015600                                                     COMP.        TRKCS104
015700     05  PV-PO-NBR                      PIC S9(09) VALUE ZEROS    TRKCS104
015800                                                     COMP.        TRKCS104
015900     05  PV-PURCHS-DEPT                 PIC X(3)  VALUE SPACES.           
016000                                                                  TRKCS104
016100*----------------------------------------------------------------*TRKCS104
016200*    MAP LAYOUT                                                  *TRKCS104
016300*----------------------------------------------------------------*TRKCS104
016400                                                                  TRKCS104
016500     COPY TRKM104.                                                TRKCS104
016600     EJECT                                                        TRKCS104
016700*----------------------------------------------------------------*TRKCS104
016800*    ATTRIBUTE SETTINGS COPYBOOK.                                *TRKCS104
016900*----------------------------------------------------------------*TRKCS104
017000                                                                  TRKCS104
017100     COPY DPWS015.                                                TRKCS104
017200                                                                  TRKCS104
017300***************************************************************** TRKCS104
017400*    COPY BOOKS FOR THE VALIDATION ROUTINE FOR THE FREIGHT BILL   TRKCS104
017500*    BILL OF LADING, AND VEHICLE NUMBER                           TRKCS104
017600***************************************************************** TRKCS104
017700     COPY RCWS023.                                                TRKCS104
017800                                                                  TRKCS104
017900*----------------------------------------------------------------*TRKCS104
018000*    FUNCTION KEYS COPYBOOK                                      *TRKCS104
018100*----------------------------------------------------------------*TRKCS104
018200                                                                  TRKCS104
018300     COPY DPWS016.                                                TRKCS104
018400 EJECT                                                            TRKCS104
018500***************************************************************** TRKCS104
018600*    CURRENT DATE AND TIME COPYBOOK.                              TRKCS104
018700***************************************************************** TRKCS104
018800                                                                  TRKCS104
018900     COPY DPWS017.                                                TRKCS104
019000                                                                  TRKCS104
019100******************************************************************TRKCS104
019200** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **TRKCS104
019300** SUB-ROUTINE (DPKUT100).                                      **TRKCS104
019400******************************************************************TRKCS104
019500     COPY DPWS010I.                                               TRKCS104
019600 EJECT                                                            TRKCS104
019700******************************************************************TRKCS104
019800** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **TRKCS104
019900** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **TRKCS104
020000******************************************************************TRKCS104
020100     COPY DPWS030.                                                TRKCS104
CICS       COPY DPWS930.                                                TRKCS104
020200 EJECT                                                            TRKCS104
020300***************************************************************** TRKCS104
020400*    STANDARD COMMAREA.                                           TRKCS104
020500***************************************************************** TRKCS104
020600                                                                  TRKCS104
020700                                                                  TRKCS104
020800     COPY DPWS020.                                                TRKCS104
020900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                TRKCS104
021000                                                                  TRKCS104
021100***************************************************************** TRKCS104
021200*    INTER-APPLICATION COMMAREA.                                  TRKCS104
021300***************************************************************** TRKCS104
021400                                                                  TRKCS104
021500         10  INTER-APPL-COMM-AREA PIC X(200).                     TRKCS104
021600     COPY TRWS001.                                                TRKCS104
021700     COPY RCWS012.                                                TRKCS104
021800***************************************************************** TRKCS104
021900*    SPECIFIC COMMMAREA FOR TRKCS104.                             TRKCS104
022000***************************************************************** TRKCS104
022100         10  ASC-SPECIFIC-COMMAREA.                               TRKCS104
022200             15  FILLER                      PIC X(02).           TRKCS104
022300             15  ASC-REQUEST-DATA.                                TRKCS104
022400                                                                  TRKCS104
022500                 20  ASC-DEPT                PIC X(04).           TRKCS104
022600                 20  ASC-DEPT-N      REDEFINES                    TRKCS104
022700                     ASC-DEPT                PIC 9(04).           TRKCS104
022800** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                  TRKCS104
022800                 20  ASC-PO-NBR              PIC X(08).           TRKCS104
022900                 20  ASC-PO-NBR-N  REDEFINES                      TRKCS104
023000                     ASC-PO-NBR              PIC 9(08).           TRKCS104
023100                 20  ASC-PRO-NBR             PIC X(22).           TRKCS104
023200                 20  ASC-BOL-NBR             PIC X(30).           TRKCS104
023300                 20  ASC-OPER-UNT-ID         PIC X(04).           TRKCS104
023400                 20  ASC-OPER-UNT-ID-N    REDEFINES               TRKCS104
023500                     ASC-OPER-UNT-ID         PIC 9(04).           TRKCS104
023600                 20  ASC-FCLTY-ID            PIC X(04).           TRKCS104
023700                 20  ASC-FCLTY-ID-N    REDEFINES                  TRKCS104
023800                     ASC-FCLTY-ID            PIC 9(04).           TRKCS104
023900                 20  ASC-FCLTY-NME           PIC X(25).           TRKCS104
024000                 20  ASC-SCAC                PIC X(04).           TRKCS104
024100                 20  ASC-ETA-DTE.                                 TRKCS104
024200                     25  ASC-ETA-MM          PIC X(02).           TRKCS104
024300                     25  ASC-ETA-DD          PIC X(02).           TRKCS104
024400                     25  ASC-ETA-CCYY.                            TRKCS104
024500                         30  ASC-ETA-CC      PIC X(02).           TRKCS104
024600                         30  ASC-ETA-YY      PIC X(02).           TRKCS104
024700                 20  ASC-ETA-TO-DTE.                              TRKCS104
024800                     25  ASC-ETA-TO-MM       PIC X(02).           TRKCS104
024900                     25  ASC-ETA-TO-DD       PIC X(02).           TRKCS104
025000                     25  ASC-ETA-TO-CCYY.                         TRKCS104
025100                         30  ASC-ETA-TO-CC PIC X(02).             TRKCS104
025200                         30  ASC-ETA-TO-YY PIC X(02).             TRKCS104
025300                 20  ASC-TRLR-NBR            PIC X(10).           TRKCS104
025400             15  ASC-CONFIRM-DATE-RANGE-SW PIC X(01).             TRKCS104
025500                 88  ASC-CONFIRM-DATE-RANGE             VALUE 'Y'.TRKCS104
025600                 88  ASC-DONT-CONFIRM-DATE-RANGE        VALUE 'N'.TRKCS104
025700             15  ASC-SAVE-INTER-APPL-COMM    PIC X(200).          TRKCS104
025800             15  ASC-RESTORE-SW              PIC X(01).           TRKCS104
025900                 88  ASC-RESTORE-COMMAREA               VALUE 'Y'.TRKCS104
026000                 88  ASC-DONT-RESTORE-COMMAREA          VALUE 'N'.TRKCS104
026100             15  FILLER                      PIC X(171).          TRKCS104
026200     EJECT                                                        TRKCS104
026300*----------------------------------------------------------------*TRKCS104
026400*    ABEND PROCESSING COPYBOOK.                                  *TRKCS104
026500*----------------------------------------------------------------*TRKCS104
026600                                                                  TRKCS104
026700     COPY DPWS013.                                                TRKCS104
026800 EJECT                                                            TRKCS104
026900***************************************************************** TRKCS104
027000*    DB2 COMMUNICATION AREA                                       TRKCS104
027100***************************************************************** TRKCS104
027200                                                                  TRKCS104
027300     EXEC SQL                                                     TRKCS104
027400         INCLUDE SQLCA                                            TRKCS104
027500     END-EXEC.                                                    TRKCS104
027600 EJECT                                                            TRKCS104
027700                                                                  TRKCS104
027800***************************************************************** TRKCS104
027900*    DB2 TABLE USED IN VALIDATING PURCHASE ORDER NUMBER         * TRKCS104
028000***************************************************************** TRKCS104
028100                                                                  TRKCS104
028200     EXEC SQL                                                     TRKCS104
028300         INCLUDE TSHPTPO                                          TRKCS104
028400     END-EXEC.                                                    TRKCS104
028500 EJECT                                                            TRKCS104
028600                                                                  TRKCS104
028700***************************************************************** TRKCS104
028800*    DB2 TABLE USED IN VALIDATING DEPARTMENT NUMBER             * TRKCS104
028900***************************************************************** TRKCS104
029000                                                                  TRKCS104
029100     EXEC SQL                                                     TRKCS104
029200         INCLUDE TPURCHS                                          TRKCS104
029300     END-EXEC.                                                    TRKCS104
029400 EJECT                                                            TRKCS104
029500                                                                  TRKCS104
029600***************************************************************** TRKCS104
029700*    DB2 TABLE USED IN VALIDATING FREIGHT BILL (PRO NUMBER)     * TRKCS104
029800***************************************************************** TRKCS104
029900                                                                  TRKCS104
030000     EXEC SQL                                                     TRKCS104
030100         INCLUDE TSHIPMT                                          TRKCS104
030200     END-EXEC.                                                    TRKCS104
030300 EJECT                                                            TRKCS104
030400                                                                  TRKCS104
030500***************************************************************** TRKCS104
030600*    DB2 TABLE USED IN VALIDATING SCAC                          * TRKCS104
030700***************************************************************** TRKCS104
030800                                                                  TRKCS104
030900     EXEC SQL                                                     TRKCS104
031000         INCLUDE TEXTENT                                          TRKCS104
031100     END-EXEC.                                                    TRKCS104
031200 EJECT                                                            TRKCS104
031300                                                                  TRKCS104
031400***************************************************************** TRKCS104
031500*    DB2 AREA FOR THE STORE TABLE                                *TRKCS104
031600***************************************************************** TRKCS104
031700                                                                  TRKCS104
031800     EXEC SQL                                                     TRKCS104
031900         INCLUDE TFACLTY                                          TRKCS104
032000     END-EXEC.                                                    TRKCS104
032100                                                                  TRKCS104
032200***************************************************************** TRKCS104
032300*    DB2 AREA FOR THE FACILITY LOCATION TABLE                    *TRKCS104
032400***************************************************************** TRKCS104
032500                                                                  TRKCS104
032600     EXEC SQL                                                     TRKCS104
032700         INCLUDE TFLAREA                                          TRKCS104
032800     END-EXEC.                                                    TRKCS104
032900                                                                  TRKCS104
033000***************************************************************** TRKCS104
033100*    DB2 CURSOR USED IN VALIDATING PURCHASE ORDER NUMBER          TRKCS104
033200***************************************************************** TRKCS104
033300                                                                  TRKCS104
033400     EXEC SQL                                                     TRKCS104
033500         DECLARE SHPTPO_CSR CURSOR FOR                            TRKCS104
033600          SELECT PO_NBR                                           TRKCS104
033700            FROM TSHPTPO                                          TRKCS104
033800           WHERE PO_NBR = :PV-PO-NBR                              TRKCS104
033900     END-EXEC.                                                    TRKCS104
034000                                                                  TRKCS104
034100***************************************************************** TRKCS104
034200*    DB2 CURSOR USED IN VALIDATING DEPARTMENT NUMBER              TRKCS104
034300***************************************************************** TRKCS104
034400                                                                  TRKCS104
034500     EXEC SQL                                                     TRKCS104
034600         DECLARE DEPT_CSR CURSOR FOR                              TRKCS104
034700          SELECT DEPT_NBR                                         TRKCS104
034800            FROM TPURCHS                                          TRKCS104
034900           WHERE DEPT_NBR = :PV-PURCHS-DEPT                       TRKCS104
035000             AND VER_STATUS_CDE = 'A'                                     
035100     END-EXEC.                                                    TRKCS104
035200                                                                  TRKCS104
035300***************************************************************** TRKCS104
035400*    DB2 CURSOR USED IN VALIDATING FREIGHT BILL                   TRKCS104
035500***************************************************************** TRKCS104
035600                                                                  TRKCS104
035700     EXEC SQL                                                     TRKCS104
035800         DECLARE SHIPMT_CSR CURSOR FOR                            TRKCS104
035900          SELECT PRO_NBR                                          TRKCS104
036000            FROM TSHIPMT                                          TRKCS104
036100           WHERE PRO_NBR = :ASC-PRO-NBR                           TRKCS104
036200     END-EXEC.                                                    TRKCS104
036300 EJECT                                                            TRKCS104
036400***************************************************************** TRKCS104
036500*    COPY BOOKS FOR THE CALENDAR ROUTINE                          TRKCS104
036600***************************************************************** TRKCS104
036700                                                                  TRKCS104
036800     COPY DPWS500.                                                TRKCS104
036900                                                                  TRKCS104
037000 EJECT                                                            TRKCS104
037100 LINKAGE SECTION.                                                 TRKCS104
037200                                                                  TRKCS104
037300 01  DFHCOMMAREA.                                                 TRKCS104
037400     05  FILLER                         OCCURS  1 TO 4072 TIMES   TRKCS104
037500                                        DEPENDING ON EIBCALEN.    TRKCS104
037600         10  FILLER                     PIC X.                    TRKCS104
037700                                                                  TRKCS104
037800                                                                  TRKCS104
037900 PROCEDURE DIVISION.                                              TRKCS104
038000***************************************************************** TRKCS104
038100** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** TRKCS104
038200** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** TRKCS104
038300** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** TRKCS104
038400**                                                             ** TRKCS104
038500** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** TRKCS104
038600** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** TRKCS104
038700***************************************************************** TRKCS104
038800 0000-MAIN-MODULE.                                                TRKCS104
038900     INITIALIZE DP030-CICS-API-FIELDS.                            TRKCS104
039000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       TRKCS104
039100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          TRKCS104
039200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         TRKCS104
039300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       TRKCS104
039400     MOVE LENGTH OF TR104AI        TO DP030-MAP-LENGTH (1).       TRKCS104
039500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     TRKCS104
039600     PERFORM 0001-CALL-CICS-ARCH-API.                             TRKCS104
039700*                                                                 TRKCS104
039800     PERFORM 1000-CONTROL-PROCESSING                              TRKCS104
039900*                                                                 TRKCS104
040000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     TRKCS104
040100     PERFORM 0001-CALL-CICS-ARCH-API.                             TRKCS104
040200                                                                  TRKCS104
040300 0001-CALL-CICS-ARCH-API.                                         TRKCS104
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
040500                                    DFHCOMMAREA                           
040600                                    DP030-CICS-API-FIELDS                 
040700                                    DP020-STANDARD-COMMAREA               
040800                                    TR104AI.                              
040900*                                                                 TRKCS104
041000     IF  DP030-RC-CALL-SUCCESSFUL                                 TRKCS104
041100         CONTINUE                                                 TRKCS104
041200     ELSE                                                         TRKCS104
041300         SET DP013-NO-ROLLBACK                                    TRKCS104
041400             DP013-XCTL-DISPLAY-RESTART                           TRKCS104
041500             DP013-CICS-ABEND      TO TRUE                        TRKCS104
041600         MOVE 'BEFORE 0000-MAIN-MODULE'                           TRKCS104
041700                                   TO DP013-PARAGRAPH             TRKCS104
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
042000         MOVE DP030-RETURN-CODE                                   TRKCS104
042100                                   TO DP013-MESSAGE-TEXT (3)      TRKCS104
042200         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS104
042300     END-IF.                                                      TRKCS104
042400 EJECT                                                            TRKCS104
042500*----------------------------------------------------------------*TRKCS104
042600*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *TRKCS104
042700*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *TRKCS104
042800*----------------------------------------------------------------*TRKCS104
042900                                                                  TRKCS104
043000 1000-CONTROL-PROCESSING.                                         TRKCS104
043100                                                                  TRKCS104
043200     EVALUATE TRUE                                                TRKCS104
043300         WHEN DP020-NEXT-ACT-INITIAL                              TRKCS104
043400             INITIALIZE ASC-SPECIFIC-COMMAREA                     TRKCS104
043500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 TRKCS104
043600             PERFORM 4000-BUILD-INITIAL-PANEL                     TRKCS104
043700                                                                  TRKCS104
043800         WHEN DP020-NEXT-ACT-READ-MAP                             TRKCS104
043900             PERFORM 2000-FKEY-PROCESSING                         TRKCS104
044000                                                                  TRKCS104
044100         WHEN DP020-NEXT-ACT-RETURN                               TRKCS104
044200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 TRKCS104
044300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   TRKCS104
044400                                                                  TRKCS104
044500         WHEN OTHER                                               TRKCS104
044600             SET DP013-LOGIC-ABEND                                TRKCS104
044700                 DP013-NO-ROLLBACK TO TRUE                        TRKCS104
044800             MOVE '1000-CONTROL-PROCESSING'                       TRKCS104
044900                                   TO  DP013-PARAGRAPH            TRKCS104
045000             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   TRKCS104
045100                                   TO  DP013-MESSAGE-TEXT(1)      TRKCS104
045200             MOVE DP020-NEXT-APPL-ACTIVITY                        TRKCS104
045300                                   TO DP013-MESSAGE-TEXT(2)       TRKCS104
045400             PERFORM DP013-0000-PROCESS-ABEND                     TRKCS104
045500     END-EVALUATE.                                                TRKCS104
045600                                                                  TRKCS104
045700*----------------------------------------------------------------*TRKCS104
045800* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *TRKCS104
045900*----------------------------------------------------------------*TRKCS104
046000                                                                  TRKCS104
046100 1100-PROCESS-INTER-APPL-COMM.                                    TRKCS104
046200                                                                  TRKCS104
046300     EVALUATE DP020-INT-APPL-FORMAT-IND                           TRKCS104
046400         WHEN PC-TRAILER-CRIT-SPEC                                TRKCS104
046500             MOVE RC012-OPER-UNT-ID                               TRKCS104
046600                                  TO ASC-OPER-UNT-ID-N            TRKCS104
046700             MOVE RC012-FCLTY-ID  TO ASC-FCLTY-ID-N               TRKCS104
046800             MOVE RC012-PO-NBR    TO ASC-PO-NBR-N                 TRKCS104
046900             MOVE RC012-BOL-NBR   TO ASC-BOL-NBR                  TRKCS104
047000             MOVE RC012-PRO-NBR   TO ASC-PRO-NBR                  TRKCS104
047100             MOVE RC012-OWNER-SCAC-ID                             TRKCS104
047200                                  TO ASC-SCAC                     TRKCS104
047300             MOVE RC012-VEH-NBR   TO ASC-TRLR-NBR                 TRKCS104
047400             MOVE RC012-ARRIVAL-DTE                               TRKCS104
047500                                  TO PV-DB2-DATE                  TRKCS104
047600             MOVE PV-DB2-DATE-CCYY                                TRKCS104
047700                                  TO ASC-ETA-CCYY                 TRKCS104
047800             MOVE PV-DB2-DATE-MM  TO ASC-ETA-MM                   TRKCS104
047900             MOVE PV-DB2-DATE-DD  TO ASC-ETA-DD                   TRKCS104
048000                                                                  TRKCS104
048100         WHEN OTHER                                               TRKCS104
048200             MOVE DP020-LOCATION  TO PV-DP020-LOCATION            TRKCS104
048300             MOVE PV-LOCATION     TO ASC-OPER-UNT-ID              TRKCS104
048400             MOVE DP020-FCLTY-ID  TO ASC-FCLTY-ID-N               TRKCS104
048500     END-EVALUATE.                                                TRKCS104
048600                                                                  TRKCS104
048700                                                                  TRKCS104
048800*----------------------------------------------------------------*TRKCS104
048900* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*TRKCS104
049000* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*TRKCS104
049100* EDITS.                                                         *TRKCS104
049200*----------------------------------------------------------------*TRKCS104
049300                                                                  TRKCS104
049400 2000-FKEY-PROCESSING.                                            TRKCS104
049500                                                                  TRKCS104
049600     EVALUATE TRUE                                                TRKCS104
049700                                                                  TRKCS104
049800         WHEN DP020-SRC-AID = DP016-CLEAR                         TRKCS104
049900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   TRKCS104
050000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 TRKCS104
050100                                                                  TRKCS104
050200         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     TRKCS104
050300             INITIALIZE ASC-SPECIFIC-COMMAREA                     TRKCS104
050400             PERFORM 4000-BUILD-INITIAL-PANEL                     TRKCS104
050500             PERFORM 3200-RESET-ATTRIBUTES                        TRKCS104
050600                                                                  TRKCS104
050700         WHEN OTHER                                               TRKCS104
050800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 TRKCS104
050900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   TRKCS104
051000             IF  PS-NO-ERROR                                      TRKCS104
051100                 SET DP030-CONTINUE-GO TO TRUE                    TRKCS104
051200                 PERFORM 2100-CHECK-FUNCTION-KEY                  TRKCS104
051300             ELSE                                                 TRKCS104
051400                 SET DP030-OVERRIDE-GO TO TRUE                    TRKCS104
051500             END-IF                                               TRKCS104
051600     END-EVALUATE.                                                TRKCS104
051700******************************************************************TRKCS104
051800** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **TRKCS104
051900** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **TRKCS104
052000** FROM THE CICS ARCHITECTURE API.                              **TRKCS104
052100******************************************************************TRKCS104
052200 2100-CHECK-FUNCTION-KEY.                                         TRKCS104
052300     EVALUATE TRUE                                                TRKCS104
052400         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 TRKCS104
052500             PERFORM 2110-PREPARE-INTER-APPL-COMM                 TRKCS104
052600                                                                  TRKCS104
052700         WHEN DP020-SRC-AID = DP016-ENTER                         TRKCS104
052800             CONTINUE                                             TRKCS104
052900                                                                  TRKCS104
053000         WHEN OTHER                                               TRKCS104
053100             SET DP013-NO-ROLLBACK                                TRKCS104
053200                 DP013-XCTL-DISPLAY-RESTART                       TRKCS104
053300                 DP013-CICS-ABEND  TO TRUE                        TRKCS104
053400             MOVE '2100-CHECK-FUNCTION-KEY'                       TRKCS104
053500                                   TO DP013-PARAGRAPH             TRKCS104
053600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      TRKCS104
053700                                   TO DP013-MESSAGE-TEXT (1)      TRKCS104
053800             PERFORM DP013-0000-PROCESS-ABEND                     TRKCS104
053900     END-EVALUATE.                                                TRKCS104
054000******************************************************************TRKCS104
054100** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **TRKCS104
054200** INTER-APPLICATION COMMAREA.                                  **TRKCS104
054300******************************************************************TRKCS104
054400 2110-PREPARE-INTER-APPL-COMM.                                    TRKCS104
054500                                                                  TRKCS104
054600     INITIALIZE TR001-INTER-APPL-COMMAREA.                        TRKCS104
054700     MOVE ASC-OPER-UNT-ID       TO  TR001-OPER-UNT-ID.            TRKCS104
054800     MOVE ASC-FCLTY-ID          TO  TR001-FCLTY-ID.               TRKCS104
054900     MOVE ASC-FCLTY-NME         TO  TR001-FCLTY-NME.              TRKCS104
055000     MOVE ASC-SCAC              TO  TR001-SCAC.                   TRKCS104
055100     MOVE ASC-PRO-NBR           TO  TR001-PRO-NBR.                TRKCS104
055200     MOVE ASC-BOL-NBR           TO  TR001-BOL-NBR.                TRKCS104
055300     MOVE ASC-TRLR-NBR          TO  TR001-TRLR-NBR.               TRKCS104
055400     MOVE ASC-PO-NBR            TO  TR001-PO-NBR.                 TRKCS104
055500     MOVE ASC-DEPT-N            TO  TR001-DEPT.                   TRKCS104
055600     MOVE ASC-ETA-DTE           TO  TR001-ETA-DTE.                TRKCS104
055700     MOVE ASC-ETA-TO-DTE        TO  TR001-ETA-TO-DTE.             TRKCS104
055800                                                                  TRKCS104
055900 EJECT                                                            TRKCS104
056000*----------------------------------------------------------------*TRKCS104
056100* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*TRKCS104
056200* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *TRKCS104
056300* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *TRKCS104
056400*----------------------------------------------------------------*TRKCS104
056500                                                                  TRKCS104
056600 2200-MOVE-SCREEN-TO-COMMAREA.                                    TRKCS104
056700                                                                  TRKCS104
056800     IF ADEPTL > ZEROES                                           TRKCS104
056900        MOVE ADEPTI              TO ASC-DEPT                      TRKCS104
057000     ELSE                                                         TRKCS104
057100        IF ADEPTF = DP015-ERASE-EOF                               TRKCS104
057200           MOVE SPACES           TO ASC-DEPT                      TRKCS104
057300        END-IF                                                    TRKCS104
057400     END-IF.                                                      TRKCS104
057500                                                                  TRKCS104
057600     IF APOL > ZERO                                               TRKCS104
057700        MOVE APOI                TO ASC-PO-NBR                    TRKCS104
057800     ELSE                                                         TRKCS104
057900        IF APOF = DP015-ERASE-EOF                                 TRKCS104
058000           MOVE SPACE            TO ASC-PO-NBR                    TRKCS104
058100        END-IF                                                    TRKCS104
058200     END-IF.                                                      TRKCS104
058300                                                                  TRKCS104
058400     IF APROL > ZERO                                              TRKCS104
058500        MOVE APROI               TO ASC-PRO-NBR                   TRKCS104
058600     ELSE                                                         TRKCS104
058700        IF APROF = DP015-ERASE-EOF                                TRKCS104
058800           MOVE SPACE            TO ASC-PRO-NBR                   TRKCS104
058900        END-IF                                                    TRKCS104
059000     END-IF.                                                      TRKCS104
059100                                                                  TRKCS104
059200     IF ABOLL > ZERO                                              TRKCS104
059300        MOVE ABOLI               TO ASC-BOL-NBR                   TRKCS104
059400     ELSE                                                         TRKCS104
059500        IF ABOLF = DP015-ERASE-EOF                                TRKCS104
059600           MOVE SPACE            TO ASC-BOL-NBR                   TRKCS104
059700        END-IF                                                    TRKCS104
059800     END-IF.                                                      TRKCS104
059900                                                                  TRKCS104
060000     IF AOPERL > ZERO                                             TRKCS104
060100        MOVE AOPERI              TO ASC-OPER-UNT-ID               TRKCS104
060200     ELSE                                                         TRKCS104
060300        IF AOPERF = DP015-ERASE-EOF                               TRKCS104
060400           MOVE SPACE            TO ASC-OPER-UNT-ID               TRKCS104
060500        END-IF                                                    TRKCS104
060600     END-IF.                                                      TRKCS104
060700                                                                  TRKCS104
060800     IF AFCLTYL > ZERO                                            TRKCS104
060900        MOVE AFCLTYI             TO ASC-FCLTY-ID                  TRKCS104
061000     ELSE                                                         TRKCS104
061100        IF AFCLTYF = DP015-ERASE-EOF                              TRKCS104
061200           MOVE SPACE            TO ASC-FCLTY-ID                  TRKCS104
061300        END-IF                                                    TRKCS104
061400     END-IF.                                                      TRKCS104
061500                                                                  TRKCS104
061600     IF ASCACL > ZERO                                             TRKCS104
061700        MOVE ASCACI              TO ASC-SCAC                      TRKCS104
061800     ELSE                                                         TRKCS104
061900        IF ASCACF = DP015-ERASE-EOF                               TRKCS104
062000           MOVE SPACE            TO ASC-SCAC                      TRKCS104
062100        END-IF                                                    TRKCS104
062200     END-IF.                                                      TRKCS104
062300                                                                  TRKCS104
062400     IF AETAMML > ZERO                                            TRKCS104
062500        MOVE AETAMMI             TO ASC-ETA-MM                    TRKCS104
062600     ELSE                                                         TRKCS104
062700        IF AETAMMF = DP015-ERASE-EOF                              TRKCS104
062800           MOVE SPACE            TO ASC-ETA-MM                    TRKCS104
062900        END-IF                                                    TRKCS104
063000     END-IF.                                                      TRKCS104
063100                                                                  TRKCS104
063200     IF AETADDL > ZERO                                            TRKCS104
063300        MOVE AETADDI             TO ASC-ETA-DD                    TRKCS104
063400     ELSE                                                         TRKCS104
063500        IF AETADDF = DP015-ERASE-EOF                              TRKCS104
063600           MOVE SPACE            TO ASC-ETA-DD                    TRKCS104
063700        END-IF                                                    TRKCS104
063800     END-IF.                                                      TRKCS104
063900                                                                  TRKCS104
064000     IF AETAYYL > ZERO                                            TRKCS104
064100        MOVE AETAYYI             TO ASC-ETA-CCYY                  TRKCS104
064200     ELSE                                                         TRKCS104
064300        IF AETAYYF = DP015-ERASE-EOF                              TRKCS104
064400           MOVE SPACE            TO ASC-ETA-CCYY                  TRKCS104
064500        END-IF                                                    TRKCS104
064600     END-IF.                                                      TRKCS104
064700                                                                  TRKCS104
064800     IF ATOMML > ZERO                                             TRKCS104
064900        MOVE ATOMMI              TO ASC-ETA-TO-MM                 TRKCS104
065000     ELSE                                                         TRKCS104
065100        IF ATOMMF = DP015-ERASE-EOF                               TRKCS104
065200           MOVE SPACE            TO ASC-ETA-TO-MM                 TRKCS104
065300        END-IF                                                    TRKCS104
065400     END-IF.                                                      TRKCS104
065500                                                                  TRKCS104
065600     IF ATODDL > ZERO                                             TRKCS104
065700        MOVE ATODDI              TO ASC-ETA-TO-DD                 TRKCS104
065800     ELSE                                                         TRKCS104
065900        IF ATODDF = DP015-ERASE-EOF                               TRKCS104
066000           MOVE SPACE            TO ASC-ETA-TO-DD                 TRKCS104
066100        END-IF                                                    TRKCS104
066200     END-IF.                                                      TRKCS104
066300                                                                  TRKCS104
066400     IF ATOYYL > ZERO                                             TRKCS104
066500        MOVE ATOYYI              TO ASC-ETA-TO-CCYY               TRKCS104
066600     ELSE                                                         TRKCS104
066700        IF ATOYYF = DP015-ERASE-EOF                               TRKCS104
066800           MOVE SPACE            TO ASC-ETA-TO-CCYY               TRKCS104
066900        END-IF                                                    TRKCS104
067000     END-IF.                                                      TRKCS104
067100                                                                  TRKCS104
067200     IF AVEHNOL > ZERO                                            TRKCS104
067300        MOVE AVEHNOI             TO ASC-TRLR-NBR                  TRKCS104
067400     ELSE                                                         TRKCS104
067500        IF AVEHNOF = DP015-ERASE-EOF                              TRKCS104
067600           MOVE SPACE            TO ASC-TRLR-NBR                  TRKCS104
067700        END-IF                                                    TRKCS104
067800     END-IF.                                                      TRKCS104
067900                                                                  TRKCS104
068000*----------------------------------------------------------------*TRKCS104
068100* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *TRKCS104
068200* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *TRKCS104
068300* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*TRKCS104
068400* IN THE DESTINATION PROGRAM, NOT HERE.                          *TRKCS104
068500*----------------------------------------------------------------*TRKCS104
068600                                                                  TRKCS104
068700 3000-EDIT-DATA-IN-COMMAREA.                                      TRKCS104
068800     PERFORM 3200-RESET-ATTRIBUTES.                               TRKCS104
068900*                                                                 TRKCS104
069000     SET PS-NO-ERROR TO TRUE.                                     TRKCS104
069100                                                                  TRKCS104
069200     IF  ASC-ETA-TO-DTE GREATER THAN SPACES                       TRKCS104
069300         PERFORM 3360-VALIDATE-ETA-TO-DTE                         TRKCS104
069400         IF  PS-INVALID-ETA-TO-DTE                                TRKCS104
069500             MOVE DP015-RED      TO ATOMMC                        TRKCS104
069600                                    ATODDC                        TRKCS104
069700                                    ATOYYC                        TRKCS104
069800             MOVE DP015-REVERSE  TO ATOMMH                        TRKCS104
069900                                    ATODDH                        TRKCS104
070000                                    ATOYYH                        TRKCS104
070100             MOVE -1             TO ATOMML                        TRKCS104
070200             MOVE PC-TSYMSG-00009                                 TRKCS104
070300                                 TO DP020-MSG-NUMBER              TRKCS104
070400             SET DP020-MSG-FATAL TO TRUE                          TRKCS104
070500             SET PS-ERROR        TO TRUE                          TRKCS104
070600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  TRKCS104
070700         END-IF                                                   TRKCS104
070800     END-IF.                                                      TRKCS104
070900                                                                  TRKCS104
071000     IF  ASC-ETA-DTE GREATER THAN SPACES                          TRKCS104
071100         PERFORM 3350-VALIDATE-ETA-DTE                            TRKCS104
071200         IF  PS-INVALID-ETA-DTE                                   TRKCS104
071300             MOVE DP015-RED      TO AETAMMC                       TRKCS104
071400                                    AETADDC                       TRKCS104
071500                                    AETAYYC                       TRKCS104
071600             MOVE DP015-REVERSE  TO AETAMMH                       TRKCS104
071700                                    AETADDH                       TRKCS104
071800                                    AETAYYH                       TRKCS104
071900             MOVE -1             TO AETAMML                       TRKCS104
072000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  TRKCS104
072100             MOVE PC-TSYMSG-00009                                 TRKCS104
072200                                 TO DP020-MSG-NUMBER              TRKCS104
072300             SET DP020-MSG-FATAL TO TRUE                          TRKCS104
072400             SET PS-ERROR        TO TRUE                          TRKCS104
072500         END-IF                                                   TRKCS104
072600     END-IF.                                                      TRKCS104
072700                                                                  TRKCS104
072800     IF  (ASC-ETA-DTE      NOT = SPACES                           TRKCS104
072900     AND  ASC-ETA-TO-DTE       = SPACES  )                        TRKCS104
073000          MOVE DP015-RED         TO ATOMMC                        TRKCS104
073100                                    ATODDC                        TRKCS104
073200                                    ATOYYC                        TRKCS104
073300          MOVE DP015-REVERSE     TO ATOMMH                        TRKCS104
073400                                    ATODDH                        TRKCS104
073500                                    ATOYYH                        TRKCS104
073600          MOVE -1                TO ATOMML                        TRKCS104
073700          SET DP030-SET-CURSOR-APPL-1 TO TRUE                     TRKCS104
073800          MOVE PC-TSYMSG-00051   TO DP020-MSG-NUMBER              TRKCS104
073900          SET DP020-MSG-FATAL    TO TRUE                          TRKCS104
074000          SET PS-ERROR           TO TRUE                          TRKCS104
074100     END-IF.                                                      TRKCS104
074200                                                                  TRKCS104
074300     IF  (ASC-ETA-DTE          = SPACES                           TRKCS104
074400     AND  ASC-ETA-TO-DTE NOT = SPACES    )                        TRKCS104
074500          MOVE DP015-RED         TO AETAMMC                       TRKCS104
074600                                    AETADDC                       TRKCS104
074700                                    AETAYYC                       TRKCS104
074800          MOVE DP015-REVERSE     TO AETAMMH                       TRKCS104
074900                                    AETADDH                       TRKCS104
075000                                    AETAYYH                       TRKCS104
075100          MOVE -1                TO AETAMML                       TRKCS104
075200          MOVE PC-TSYMSG-00053   TO DP020-MSG-NUMBER              TRKCS104
075300          SET DP030-SET-CURSOR-APPL-1 TO TRUE                     TRKCS104
075400          SET DP020-MSG-FATAL    TO TRUE                          TRKCS104
075500          SET PS-ERROR           TO TRUE                          TRKCS104
075600     END-IF.                                                      TRKCS104
075700                                                                  TRKCS104
075800     IF PS-VALID-ETA-DTE AND                                      TRKCS104
075900        PS-VALID-ETA-TO-DTE                                       TRKCS104
076000         PERFORM 3370-VALIDATE-DATE-RANGE                         TRKCS104
076100         IF  PS-INVALID-DATE-RANGE                                TRKCS104
076200             MOVE DP015-RED      TO AETAMMC                       TRKCS104
076300                                    AETADDC                       TRKCS104
076400                                    AETAYYC                       TRKCS104
076500                                    ATOMMC                        TRKCS104
076600                                    ATODDC                        TRKCS104
076700                                    ATOYYC                        TRKCS104
076800             MOVE DP015-REVERSE  TO AETAMMH                       TRKCS104
076900                                    AETADDH                       TRKCS104
077000                                    AETAYYH                       TRKCS104
077100                                    ATOMMH                        TRKCS104
077200                                    ATODDH                        TRKCS104
077300                                    ATOYYH                        TRKCS104
077400             MOVE -1             TO AETAMML                       TRKCS104
077500             MOVE PC-TSYMSG-00052                                 TRKCS104
077600                                 TO DP020-MSG-NUMBER              TRKCS104
077700             SET DP020-MSG-FATAL TO TRUE                          TRKCS104
077800             SET PS-ERROR        TO TRUE                          TRKCS104
077900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  TRKCS104
078000         END-IF                                                   TRKCS104
078100     END-IF.                                                      TRKCS104
078200                                                                  TRKCS104
078300     IF  ASC-SCAC GREATER THAN SPACES                             TRKCS104
078400         PERFORM 3340-VALIDATE-SCAC                               TRKCS104
078500         IF  PS-INVALID-SCAC                                      TRKCS104
078600             MOVE DP015-RED      TO ASCACC                        TRKCS104
078700             MOVE DP015-REVERSE  TO ASCACH                        TRKCS104
078800             MOVE -1             TO ASCACL                        TRKCS104
078900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  TRKCS104
079000             MOVE PC-TSYMSG-00148                                 TRKCS104
079100                                 TO DP020-MSG-NUMBER              TRKCS104
079200             SET DP020-MSG-FATAL TO TRUE                          TRKCS104
079300             SET PS-ERROR        TO TRUE                          TRKCS104
079400         END-IF                                                   TRKCS104
079500     END-IF.                                                      TRKCS104
079600                                                                  TRKCS104
079700     IF  ASC-OPER-UNT-ID    > SPACES                              TRKCS104
079800         MOVE ASC-OPER-UNT-ID    TO DP010I-UNEDITED-FIELD         TRKCS104
079900         MOVE LENGTH OF ASC-OPER-UNT-ID                           TRKCS104
080000                                 TO DP010I-MAXIMUM-DIGITS         TRKCS104
080100         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       TRKCS104
080200         SET DP010I-NEGATIVE-NOT-ALLOWED                          TRKCS104
080300                                 TO TRUE                          TRKCS104
273427         CALL DP010I-NUMERIC-EDIT-ROUTINE                         TRKCS104
273427              USING DP010I-NUMERIC-EDIT-AREA                      TRKCS104
080500         IF  DP010I-ERROR-DETECTED                                TRKCS104
080600             SET PS-ERROR                                         TRKCS104
080700                 DP020-MSG-FATAL TO TRUE                          TRKCS104
080800             MOVE PC-TSYMSG-00008                                 TRKCS104
080900                                 TO DP020-MSG-NUMBER              TRKCS104
081000             MOVE DP015-UNP-ALP-BRT-OFF                           TRKCS104
081100                                 TO AOPERA                        TRKCS104
081200             MOVE DP015-RED      TO AOPERC                        TRKCS104
081300             MOVE DP015-REVERSE  TO AOPERH                        TRKCS104
081400             MOVE -1             TO AOPERL                        TRKCS104
081500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  TRKCS104
081600         ELSE                                                     TRKCS104
081700             MOVE DP010I-NUMERIC-FIELD                            TRKCS104
081800                                 TO ASC-OPER-UNT-ID-N             TRKCS104
081900                                    PV-OPER-UNT-ID                TRKCS104
082000             MOVE ASC-OPER-UNT-ID                                 TRKCS104
082100                                 TO AOPERO                        TRKCS104
082200             PERFORM 3900-VALIDATE-OPER-UNT-ID                    TRKCS104
082300         END-IF                                                   TRKCS104
082400     END-IF.                                                      TRKCS104
082500                                                                  TRKCS104
082600     IF  ASC-FCLTY-ID > SPACES                                    TRKCS104
082700         MOVE ASC-FCLTY-ID       TO DP010I-UNEDITED-FIELD         TRKCS104
082800         MOVE LENGTH OF ASC-FCLTY-ID                              TRKCS104
082900                                 TO DP010I-MAXIMUM-DIGITS         TRKCS104
083000         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       TRKCS104
083100         SET DP010I-NEGATIVE-NOT-ALLOWED                          TRKCS104
083200                                 TO TRUE                          TRKCS104
273427         CALL DP010I-NUMERIC-EDIT-ROUTINE                         TRKCS104
273427              USING DP010I-NUMERIC-EDIT-AREA                      TRKCS104
083400         IF  DP010I-ERROR-DETECTED                                TRKCS104
083500             SET PS-ERROR                                         TRKCS104
083600                 DP020-MSG-FATAL TO TRUE                          TRKCS104
083700             MOVE PC-TSYMSG-00008                                 TRKCS104
083800                                 TO DP020-MSG-NUMBER              TRKCS104
083900             MOVE DP015-UNP-ALP-BRT-OFF                           TRKCS104
084000                                 TO AFCLTYA                       TRKCS104
084100             MOVE DP015-RED      TO AFCLTYC                       TRKCS104
084200             MOVE DP015-REVERSE  TO AFCLTYH                       TRKCS104
084300             MOVE -1             TO AFCLTYL                       TRKCS104
084400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  TRKCS104
084500         ELSE                                                     TRKCS104
084600             MOVE DP010I-NUMERIC-FIELD                            TRKCS104
084700                                 TO ASC-FCLTY-ID-N                TRKCS104
084800                                    PV-FCLTY-ID                   TRKCS104
084900             MOVE ASC-FCLTY-ID TO AFCLTYO                         TRKCS104
085000         END-IF                                                   TRKCS104
085100     END-IF.                                                      TRKCS104
085200                                                                  TRKCS104
085300     IF ASC-FCLTY-ID-N      > ZEROS AND                           TRKCS104
085400        ASC-OPER-UNT-ID-N > ZEROS                                 TRKCS104
085500         PERFORM 3800-VALIDATE-FCLTY-ID                           TRKCS104
085600     ELSE                                                         TRKCS104
085700         MOVE SPACES TO ASC-FCLTY-NME                             TRKCS104
085800                        AFDESCO                                   TRKCS104
085900     END-IF.                                                      TRKCS104
086000                                                                  TRKCS104
086100     IF  ASC-DEPT GREATER THAN SPACES                             TRKCS104
086200         PERFORM 3380-VALIDATE-DEPT                               TRKCS104
086300         IF  PS-INVALID-DEPT                                      TRKCS104
086400             MOVE DP015-RED      TO ADEPTC                        TRKCS104
086500             MOVE DP015-REVERSE  TO ADEPTH                        TRKCS104
086600             MOVE -1             TO ADEPTL                        TRKCS104
086700             MOVE PC-TSYMSG-00032                                 TRKCS104
086800                                 TO DP020-MSG-NUMBER              TRKCS104
086900             SET DP020-MSG-FATAL TO TRUE                          TRKCS104
087000             SET PS-ERROR        TO TRUE                          TRKCS104
087100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  TRKCS104
087200         END-IF                                                   TRKCS104
087300     END-IF.                                                      TRKCS104
087400                                                                  TRKCS104
087500     IF ASC-TRLR-NBR > SPACES AND PS-NO-ERROR                     TRKCS104
087600        MOVE ASC-TRLR-NBR      TO RC023-VEHICLE                   TRKCS104
087700        CALL PC-RCKUT023 USING RC023-FORMAT-DATA-AREA             TRKCS104
087800        MOVE RC023-VEHICLE     TO ASC-TRLR-NBR                    TRKCS104
087900                                  AVEHNOO                         TRKCS104
088000      END-IF.                                                     TRKCS104
088100                                                                  TRKCS104
088200     IF  ASC-PO-NBR GREATER THAN SPACES                           TRKCS104
088300         MOVE ASC-PO-NBR        TO DP010I-UNEDITED-FIELD          TRKCS104
022800** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                  TRKCS104
088400         MOVE +8                TO DP010I-MAXIMUM-DIGITS          TRKCS104
088500         MOVE +0                TO DP010I-MAXIMUM-DECIMALS        TRKCS104
088600                                                                  TRKCS104
088700         SET DP010I-NEGATIVE-NOT-ALLOWED                          TRKCS104
088800                                     TO TRUE                      TRKCS104
088900                                                                  TRKCS104
273427         CALL DP010I-NUMERIC-EDIT-ROUTINE                         TRKCS104
273427              USING DP010I-NUMERIC-EDIT-AREA                      TRKCS104
089100                                                                  TRKCS104
089200         IF DP010I-ERROR-DETECTED                                 TRKCS104
089300             MOVE DP015-RED      TO APOC                          TRKCS104
089400             MOVE DP015-REVERSE  TO APOH                          TRKCS104
089500             MOVE -1             TO APOL                          TRKCS104
089600             MOVE PC-TSYMSG-00008                                 TRKCS104
089700                                 TO DP020-MSG-NUMBER              TRKCS104
089800             SET DP020-MSG-FATAL TO TRUE                          TRKCS104
089900             SET PS-ERROR        TO TRUE                          TRKCS104
090000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  TRKCS104
090100         ELSE                                                     TRKCS104
090200             MOVE DP010I-NUMERIC-FIELD                            TRKCS104
090300                                     TO ASC-PO-NBR-N              TRKCS104
090400                                        PV-PO-NBR                 TRKCS104
090500         END-IF                                                   TRKCS104
090600     END-IF.                                                      TRKCS104
090700                                                                  TRKCS104
090800     IF (DP020-SRC-AID EQUAL DP016-PF17) OR                       TRKCS104
090900        (DP020-SRC-AID EQUAL DP016-PF18) AND                      TRKCS104
091000        PS-NO-ERROR                                               TRKCS104
091100          PERFORM 3300-VALIDATION                                 TRKCS104
091200     END-IF.                                                      TRKCS104
091300                                                                  TRKCS104
091400                                                                  TRKCS104
091500     IF  PS-NO-ERROR                                              TRKCS104
091600         MOVE -1         TO ADEPTL                                TRKCS104
091700         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      TRKCS104
091800     END-IF.                                                      TRKCS104
091900                                                                  TRKCS104
092000     IF (PS-NO-ERROR   AND                                        TRKCS104
092100         DP020-SRC-AID EQUAL DP016-PF17)                          TRKCS104
092200         IF (ASC-DEPT          GREATER THAN SPACES OR             TRKCS104
092300             ASC-PO-NBR        GREATER THAN SPACES OR             TRKCS104
092400             ASC-PRO-NBR       GREATER THAN SPACES OR             TRKCS104
092500*            ASC-OPER-UNT-ID GREATER THAN SPACES OR               TRKCS104
092600*            ASC-FCLTY-ID      GREATER THAN SPACES OR             TRKCS104
092700             ASC-SCAC          GREATER THAN SPACES)               TRKCS104
092800             CONTINUE                                             TRKCS104
092900         ELSE                                                     TRKCS104
093000             MOVE DP015-RED      TO ADEPTC                        TRKCS104
093100             MOVE DP015-REVERSE  TO ADEPTH                        TRKCS104
093200             MOVE -1             TO ADEPTL                        TRKCS104
093300             MOVE PC-TSYMSG-00036                                 TRKCS104
093400                                 TO DP020-MSG-NUMBER              TRKCS104
093500             SET DP020-MSG-FATAL TO TRUE                          TRKCS104
093600             SET PS-ERROR        TO TRUE                          TRKCS104
093700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  TRKCS104
093800         END-IF                                                   TRKCS104
093900     END-IF.                                                      TRKCS104
094000                                                                  TRKCS104
094100     IF (PS-NO-ERROR) AND                                         TRKCS104
094200       ((DP020-SRC-AID EQUAL DP016-PF18)                          TRKCS104
094300                      OR                                          TRKCS104
094400        (DP020-SRC-AID EQUAL DP016-PF2 AND                        TRKCS104
094500         ASC-CONFIRM-DATE-RANGE))                                 TRKCS104
094600         IF ASC-OPER-UNT-ID GREATER THAN SPACES                   TRKCS104
094700             MOVE DP016-PF18     TO DP020-SRC-AID                 TRKCS104
094800         ELSE                                                     TRKCS104
094900             MOVE DP015-RED      TO AOPERC                        TRKCS104
095000             MOVE DP015-REVERSE  TO AOPERH                        TRKCS104
095100             MOVE -1             TO AOPERL                        TRKCS104
095200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  TRKCS104
095300             MOVE PC-TSYMSG-00007                                 TRKCS104
095400                                 TO DP020-MSG-NUMBER              TRKCS104
095500             SET DP020-MSG-FATAL TO TRUE                          TRKCS104
095600             SET PS-ERROR        TO TRUE                          TRKCS104
095700         END-IF                                                   TRKCS104
095800     END-IF.                                                      TRKCS104
095900 EJECT                                                            TRKCS104
096000                                                                  TRKCS104
096100 3300-VALIDATION.                                                 TRKCS104
096200*----------------------------------------------------------------*TRKCS104
096300*    ENSURE THE PURCHASE ORDER NUMBER ENTERED ON THE SCREEN IS   *TRKCS104
096400*    CURRENTLY ON THE SHPTPO DATABASE.                           *TRKCS104
096500*                                                                *TRKCS104
096600*----------------------------------------------------------------*TRKCS104
096700                                                                  TRKCS104
096800     IF  ASC-PRO-NBR GREATER THAN SPACES AND                      TRKCS104
096900         ASC-SCAC      GREATER THAN SPACES                        TRKCS104
097000         IF EXTENT-CARR-MAN-PRO-IND = PC-Y                        TRKCS104
097100             CONTINUE                                             TRKCS104
097200         ELSE                                                     TRKCS104
097300             PERFORM 3320-VALIDATE-PRO-NBR                        TRKCS104
097400             IF  PS-INVALID-PRO-NBR                               TRKCS104
097500                 MOVE DP015-RED  TO APROC                         TRKCS104
097600                 MOVE DP015-REVERSE                               TRKCS104
097700                                 TO APROH                         TRKCS104
097800                 MOVE -1         TO APROL                         TRKCS104
097900                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              TRKCS104
098000                 MOVE PC-TSYMSG-00148                             TRKCS104
098100                                 TO DP020-MSG-NUMBER              TRKCS104
098200                 SET DP020-MSG-FATAL                              TRKCS104
098300                                 TO TRUE                          TRKCS104
098400                 SET PS-ERROR    TO TRUE                          TRKCS104
098500             END-IF                                               TRKCS104
098600         END-IF                                                   TRKCS104
098700     END-IF.                                                      TRKCS104
098800                                                                  TRKCS104
098900     IF  ASC-PO-NBR GREATER THAN SPACES                           TRKCS104
099000         PERFORM 3310-VALIDATE-PO-NBR                             TRKCS104
099100         IF  PS-INVALID-PO-NBR                                    TRKCS104
099200             MOVE DP015-RED      TO APOC                          TRKCS104
099300             MOVE DP015-REVERSE  TO APOH                          TRKCS104
099400             MOVE -1             TO APOL                          TRKCS104
099500             MOVE PC-TSYMSG-00083                                 TRKCS104
099600                                 TO DP020-MSG-NUMBER              TRKCS104
099700             SET DP020-MSG-FATAL TO TRUE                          TRKCS104
099800             SET PS-ERROR        TO TRUE                          TRKCS104
099900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  TRKCS104
100000         END-IF                                                   TRKCS104
100100     END-IF.                                                      TRKCS104
100200                                                                  TRKCS104
100300                                                                  TRKCS104
100400 3310-VALIDATE-PO-NBR.                                            TRKCS104
100500*----------------------------------------------------------------*TRKCS104
100600*    ENSURE THE PURCHASE ORDER NUMBER ENTERED ON THE SCREEN IS   *TRKCS104
100700*    CURRENTLY ON THE SHPTPO DATABASE.                           *TRKCS104
100800*                                                                *TRKCS104
100900*    PERFORMED FROM 3300-EDIT-DATA-IN-COMMAREA.                  *TRKCS104
101000*----------------------------------------------------------------*TRKCS104
101100                                                                  TRKCS104
101200      MOVE ASC-PO-NBR         TO APOO.                            TRKCS104
101300      PERFORM 3312-OPEN-SHPTPO-CSR.                               TRKCS104
101400      PERFORM 3314-FETCH-SHPTPO-CSR.                              TRKCS104
101500      PERFORM 3316-CLOSE-SHPTPO-CSR.                              TRKCS104
101600                                                                  TRKCS104
101700 EJECT                                                            TRKCS104
101800                                                                  TRKCS104
101900 3312-OPEN-SHPTPO-CSR.                                            TRKCS104
102000*----------------------------------------------------------------*TRKCS104
102100*    OPEN THE SHPTPO CURSOR.                                     *TRKCS104
102200*                                                                *TRKCS104
102300*    PERFORMED FROM 3310-VALIDATE-PO-NBR.                        *TRKCS104
102400*----------------------------------------------------------------*TRKCS104
102500                                                                  TRKCS104
102600     EXEC SQL                                                     TRKCS104
102700         OPEN SHPTPO_CSR                                          TRKCS104
102800     END-EXEC.                                                    TRKCS104
102900                                                                  TRKCS104
103000     EVALUATE TRUE                                                TRKCS104
103100         WHEN SQLCODE = ZERO                                      TRKCS104
103200             CONTINUE                                             TRKCS104
103300         WHEN OTHER                                               TRKCS104
103400             MOVE '3312-OPEN-SHPTPO-CSR'                          TRKCS104
103500                                 TO DP013-PARAGRAPH               TRKCS104
103600             MOVE 'OPEN SHPTPO CURSOR'                            TRKCS104
103700                                 TO DP013-MESSAGE-TEXT(1)         TRKCS104
103800             MOVE SQLCA          TO DP013-SQLCA                   TRKCS104
103900             MOVE 'TSHPTPO'      TO DP013-DB2-TABLE-NAME (1)      TRKCS104
104000             SET DP013-DB2-ABEND TO TRUE                          TRKCS104
104100             SET DP013-NO-ROLLBACK                                TRKCS104
104200                                 TO TRUE                          TRKCS104
104300             SET DP013-XCTL-DISPLAY-RESTART                       TRKCS104
104400                                 TO TRUE                          TRKCS104
104500             PERFORM DP013-0000-PROCESS-ABEND                     TRKCS104
104600     END-EVALUATE.                                                TRKCS104
104700                                                                  TRKCS104
104800 EJECT                                                            TRKCS104
104900                                                                  TRKCS104
105000 3314-FETCH-SHPTPO-CSR.                                           TRKCS104
105100*----------------------------------------------------------------*TRKCS104
105200*    FETCHES THE SHPTPO CURSOR.                                  *TRKCS104
105300*                                                                *TRKCS104
105400*    PERFORMED FROM 3310-VALIDATE-PO-NBR.                        *TRKCS104
105500*----------------------------------------------------------------*TRKCS104
105600                                                                  TRKCS104
105700     EXEC SQL                                                     TRKCS104
105800         FETCH SHPTPO_CSR                                         TRKCS104
105900          INTO :SHPTPO-PO-NBR                                     TRKCS104
106000     END-EXEC.                                                    TRKCS104
106100                                                                  TRKCS104
106200     EVALUATE TRUE                                                TRKCS104
106300         WHEN SQLCODE = ZERO                                      TRKCS104
106400              SET PS-VALID-PO-NBR                                 TRKCS104
106500                                 TO TRUE                          TRKCS104
106600         WHEN SQLCODE = +100                                      TRKCS104
106700              SET PS-INVALID-PO-NBR                               TRKCS104
106800                                 TO TRUE                          TRKCS104
106900         WHEN OTHER                                               TRKCS104
107000             MOVE '3314-FETCH-SHPTPO-CSR'                         TRKCS104
107100                                 TO DP013-PARAGRAPH               TRKCS104
107200             MOVE 'FETCH SHPTPO CURSOR'                           TRKCS104
107300                                 TO DP013-MESSAGE-TEXT(1)         TRKCS104
107400             MOVE SQLCA          TO DP013-SQLCA                   TRKCS104
107500             MOVE 'TSHPTPO'      TO DP013-DB2-TABLE-NAME (1)      TRKCS104
107600             SET DP013-DB2-ABEND TO TRUE                          TRKCS104
107700             SET DP013-NO-ROLLBACK                                TRKCS104
107800                                 TO TRUE                          TRKCS104
107900             SET DP013-XCTL-DISPLAY-RESTART                       TRKCS104
108000                                 TO TRUE                          TRKCS104
108100             PERFORM DP013-0000-PROCESS-ABEND                     TRKCS104
108200     END-EVALUATE.                                                TRKCS104
108300                                                                  TRKCS104
108400 EJECT                                                            TRKCS104
108500                                                                  TRKCS104
108600 3316-CLOSE-SHPTPO-CSR.                                           TRKCS104
108700*----------------------------------------------------------------*TRKCS104
108800*    CLOSE THE SHPTPO CURSOR.                                    *TRKCS104
108900*                                                                *TRKCS104
109000*    PERFORMED FROM 3310-VALIDATE-PO-NBR.                        *TRKCS104
109100*----------------------------------------------------------------*TRKCS104
109200                                                                  TRKCS104
109300     EXEC SQL                                                     TRKCS104
109400         CLOSE SHPTPO_CSR                                         TRKCS104
109500     END-EXEC.                                                    TRKCS104
109600                                                                  TRKCS104
109700     EVALUATE TRUE                                                TRKCS104
109800         WHEN SQLCODE = ZERO                                      TRKCS104
109900             CONTINUE                                             TRKCS104
110000         WHEN OTHER                                               TRKCS104
110100             MOVE '3316-CLOSE-SHPTPO-CSR'                         TRKCS104
110200                                 TO DP013-PARAGRAPH               TRKCS104
110300             MOVE 'CLOSE SHPTPO CURSOR'                           TRKCS104
110400                                 TO DP013-MESSAGE-TEXT(1)         TRKCS104
110500             MOVE SQLCA          TO DP013-SQLCA                   TRKCS104
110600             MOVE 'TSHPTPO'      TO DP013-DB2-TABLE-NAME (1)      TRKCS104
110700             SET DP013-DB2-ABEND TO TRUE                          TRKCS104
110800             SET DP013-NO-ROLLBACK                                TRKCS104
110900                                 TO TRUE                          TRKCS104
111000             SET DP013-XCTL-DISPLAY-RESTART                       TRKCS104
111100                                 TO TRUE                          TRKCS104
111200             PERFORM DP013-0000-PROCESS-ABEND                     TRKCS104
111300     END-EVALUATE.                                                TRKCS104
111400                                                                  TRKCS104
111500 EJECT                                                            TRKCS104
111600                                                                  TRKCS104
111700 3320-VALIDATE-PRO-NBR.                                           TRKCS104
111800*----------------------------------------------------------------*TRKCS104
111900*    ENSURE THE FREIGHT BILL ENTERED ON THE SCREEN IS CURRENTLY  *TRKCS104
112000*    ON THE SHIPMT DATABASE.                                     *TRKCS104
112100*                                                                *TRKCS104
112200*    PERFORMED FROM 3300-EDIT-DATA-IN-COMMAREA.                  *TRKCS104
112300*----------------------------------------------------------------*TRKCS104
112400                                                                  TRKCS104
112500     PERFORM 3322-OPEN-SHIPMT-CSR.                                TRKCS104
112600                                                                  TRKCS104
112700     PERFORM 3324-FETCH-SHIPMT-CSR.                               TRKCS104
112800                                                                  TRKCS104
112900     PERFORM 3326-CLOSE-SHIPMT-CSR.                               TRKCS104
113000                                                                  TRKCS104
113100 EJECT                                                            TRKCS104
113200                                                                  TRKCS104
113300 3322-OPEN-SHIPMT-CSR.                                            TRKCS104
113400*----------------------------------------------------------------*TRKCS104
113500*    OPEN THE SHIPMT CURSOR.                                     *TRKCS104
113600*                                                                *TRKCS104
113700*    PERFORMED FROM 3320-VALIDATE-PRO-NBR.                       *TRKCS104
113800*----------------------------------------------------------------*TRKCS104
113900                                                                  TRKCS104
114000     EXEC SQL                                                     TRKCS104
114100         OPEN SHIPMT_CSR                                          TRKCS104
114200     END-EXEC.                                                    TRKCS104
114300                                                                  TRKCS104
114400     EVALUATE TRUE                                                TRKCS104
114500         WHEN SQLCODE = ZERO                                      TRKCS104
114600             CONTINUE                                             TRKCS104
114700         WHEN OTHER                                               TRKCS104
114800             MOVE '3322-OPEN-SHIPMT-CSR'                          TRKCS104
114900                                 TO DP013-PARAGRAPH               TRKCS104
115000             MOVE 'OPEN SHIPMT CURSOR'                            TRKCS104
115100                                 TO DP013-MESSAGE-TEXT(1)         TRKCS104
115200             MOVE SQLCA          TO DP013-SQLCA                   TRKCS104
115300             MOVE 'TSHIPMT'      TO DP013-DB2-TABLE-NAME (1)      TRKCS104
115400             SET DP013-DB2-ABEND TO TRUE                          TRKCS104
115500             SET DP013-NO-ROLLBACK                                TRKCS104
115600                                 TO TRUE                          TRKCS104
115700             SET DP013-XCTL-DISPLAY-RESTART                       TRKCS104
115800                                 TO TRUE                          TRKCS104
115900             PERFORM DP013-0000-PROCESS-ABEND                     TRKCS104
116000     END-EVALUATE.                                                TRKCS104
116100                                                                  TRKCS104
116200 EJECT                                                            TRKCS104
116300                                                                  TRKCS104
116400 3324-FETCH-SHIPMT-CSR.                                           TRKCS104
116500*----------------------------------------------------------------*TRKCS104
116600*    FETCHES THE SHIPMT CURSOR.                                  *TRKCS104
116700*                                                                *TRKCS104
116800*    PERFORMED FROM 3320-VALIDATE-PRO-NBR.                       *TRKCS104
116900*----------------------------------------------------------------*TRKCS104
117000                                                                  TRKCS104
117100     EXEC SQL                                                     TRKCS104
117200         FETCH SHIPMT_CSR                                         TRKCS104
117300          INTO :SHIPMT-PRO-NBR                                    TRKCS104
117400     END-EXEC.                                                    TRKCS104
117500                                                                  TRKCS104
117600     EVALUATE TRUE                                                TRKCS104
117700         WHEN SQLCODE = ZERO                                      TRKCS104
117800              SET PS-VALID-PRO-NBR                                TRKCS104
117900                                 TO TRUE                          TRKCS104
118000         WHEN SQLCODE = +100                                      TRKCS104
118100              SET PS-INVALID-PRO-NBR                              TRKCS104
118200                                 TO TRUE                          TRKCS104
118300         WHEN OTHER                                               TRKCS104
118400             MOVE '3324-FETCH-SHIPMT-CSR'                         TRKCS104
118500                                 TO DP013-PARAGRAPH               TRKCS104
118600             MOVE 'FETCH SHIPMT CURSOR'                           TRKCS104
118700                                 TO DP013-MESSAGE-TEXT(1)         TRKCS104
118800             MOVE SQLCA          TO DP013-SQLCA                   TRKCS104
118900             MOVE 'TSHIPMT'      TO DP013-DB2-TABLE-NAME (1)      TRKCS104
119000             SET DP013-DB2-ABEND TO TRUE                          TRKCS104
119100             SET DP013-NO-ROLLBACK                                TRKCS104
119200                                 TO TRUE                          TRKCS104
119300             SET DP013-XCTL-DISPLAY-RESTART                       TRKCS104
119400                                 TO TRUE                          TRKCS104
119500             PERFORM DP013-0000-PROCESS-ABEND                     TRKCS104
119600     END-EVALUATE.                                                TRKCS104
119700                                                                  TRKCS104
119800 EJECT                                                            TRKCS104
119900                                                                  TRKCS104
120000 3326-CLOSE-SHIPMT-CSR.                                           TRKCS104
120100*----------------------------------------------------------------*TRKCS104
120200*    CLOSE THE SHIPMT CURSOR.                                    *TRKCS104
120300*                                                                *TRKCS104
120400*    PERFORMED FROM 3320-VALIDATE-PRO-NBR.                       *TRKCS104
120500*----------------------------------------------------------------*TRKCS104
120600                                                                  TRKCS104
120700     EXEC SQL                                                     TRKCS104
120800         CLOSE SHIPMT_CSR                                         TRKCS104
120900     END-EXEC.                                                    TRKCS104
121000                                                                  TRKCS104
121100     EVALUATE TRUE                                                TRKCS104
121200         WHEN SQLCODE = ZERO                                      TRKCS104
121300             CONTINUE                                             TRKCS104
121400         WHEN OTHER                                               TRKCS104
121500             MOVE '3326-CLOSE-SHIPMT-CSR'                         TRKCS104
121600                                 TO DP013-PARAGRAPH               TRKCS104
121700             MOVE 'CLOSE SHIPMT CURSOR'                           TRKCS104
121800                                 TO DP013-MESSAGE-TEXT(1)         TRKCS104
121900             MOVE SQLCA          TO DP013-SQLCA                   TRKCS104
122000             MOVE 'TSHIPMT'      TO DP013-DB2-TABLE-NAME (1)      TRKCS104
122100             SET DP013-DB2-ABEND TO TRUE                          TRKCS104
122200             SET DP013-NO-ROLLBACK                                TRKCS104
122300                                 TO TRUE                          TRKCS104
122400             SET DP013-XCTL-DISPLAY-RESTART                       TRKCS104
122500                                 TO TRUE                          TRKCS104
122600             PERFORM DP013-0000-PROCESS-ABEND                     TRKCS104
122700     END-EVALUATE.                                                TRKCS104
122800                                                                  TRKCS104
122900 EJECT                                                            TRKCS104
123000                                                                  TRKCS104
123100 3340-VALIDATE-SCAC.                                              TRKCS104
123200*----------------------------------------------------------------*TRKCS104
123300*    ENSURE THE STANDARD CARRIER ALPHA CODE (SCAC) ENTERED ON    *TRKCS104
123400*    THE SCREEN IS SET UP ON THE VENDOR DATABASE.                *TRKCS104
123500*                                                                *TRKCS104
123600*    PERFORMED FROM 3300-EDIT-DATA-IN-COMMAREA.                  *TRKCS104
123700*----------------------------------------------------------------*TRKCS104
123800                                                                  TRKCS104
123900     PERFORM WITH TEST AFTER                                      TRKCS104
124000         VARYING PV-RETRY-COUNTER                                 TRKCS104
124100         FROM 1 BY 1                                              TRKCS104
124200         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 TRKCS104
124300                 OR SQLCODE = 0                                   TRKCS104
124400                 OR SQLCODE = +100)                               TRKCS104
124500                                                                  TRKCS104
124600         EXEC SQL                                                 TRKCS104
124700             SELECT SCAC_CDE,                                     TRKCS104
124800                    CARR_MAN_PRO_IND                              TRKCS104
124900             INTO   :EXTENT-SCAC-CDE,                             TRKCS104
125000                    :EXTENT-CARR-MAN-PRO-IND                      TRKCS104
125100             FROM   TEXTENT                                       TRKCS104
125200             WHERE  SCAC_CDE    = :ASC-SCAC                       TRKCS104
125300             AND    CARRIER_IND = :PC-Y                           TRKCS104
125400         END-EXEC                                                 TRKCS104
125500                                                                  TRKCS104
125600         EVALUATE TRUE                                            TRKCS104
125700             WHEN SQLCODE = ZERO                                  TRKCS104
125800             WHEN SQLCODE = +100                                  TRKCS104
125900             WHEN SQLCODE = -904                                  TRKCS104
126000             WHEN SQLCODE = -913                                  TRKCS104
126100                 CONTINUE                                         TRKCS104
126200             WHEN SQLWARN0 NOT = SPACES                           TRKCS104
126300             WHEN SQLCODE NOT EQUAL ZERO                          TRKCS104
126400                 MOVE '3340-VALIDATE-SCAC'                        TRKCS104
126500                                 TO DP013-PARAGRAPH               TRKCS104
126600                 MOVE 'VALIDATE SCAC'                             TRKCS104
126700                                 TO DP013-MESSAGE-TEXT(1)         TRKCS104
126800                 MOVE SQLCA      TO DP013-SQLCA                   TRKCS104
126900                 MOVE 'TEXTENT'  TO DP013-DB2-TABLE-NAME(1)       TRKCS104
127000                 SET DP013-DB2-ABEND                              TRKCS104
127100                                 TO TRUE                          TRKCS104
127200                 SET DP013-NO-ROLLBACK                            TRKCS104
127300                                 TO TRUE                          TRKCS104
127400                 SET DP013-XCTL-DISPLAY-RESTART                   TRKCS104
127500                                 TO TRUE                          TRKCS104
127600                 PERFORM DP013-0000-PROCESS-ABEND                 TRKCS104
127700         END-EVALUATE                                             TRKCS104
127800     END-PERFORM.                                                 TRKCS104
127900                                                                  TRKCS104
128000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         TRKCS104
128100         MOVE '3340-VALIDATE-SCAC'                                TRKCS104
128200                                 TO DP013-PARAGRAPH               TRKCS104
128300         MOVE 'VALIDATE SCAC'    TO DP013-MESSAGE-TEXT(1)         TRKCS104
128400         MOVE 'MAX NUMBER OF RETRIES EXCEEDED'                    TRKCS104
128500                                 TO DP013-MESSAGE-TEXT(2)         TRKCS104
128600         MOVE SQLCA              TO DP013-SQLCA                   TRKCS104
128700         MOVE 'TEXTENT'          TO DP013-DB2-TABLE-NAME(1)       TRKCS104
128800         SET DP013-DB2-ABEND     TO TRUE                          TRKCS104
128900         SET DP013-NO-ROLLBACK   TO TRUE                          TRKCS104
129000         SET DP013-XCTL-DISPLAY-RESTART                           TRKCS104
129100                                 TO TRUE                          TRKCS104
129200         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS104
129300     END-IF.                                                      TRKCS104
129400                                                                  TRKCS104
129500     EVALUATE TRUE                                                TRKCS104
129600         WHEN SQLCODE = ZERO                                      TRKCS104
129700              SET PS-VALID-SCAC  TO TRUE                          TRKCS104
129800         WHEN SQLCODE = +100                                      TRKCS104
129900              SET PS-INVALID-SCAC                                 TRKCS104
130000                                 TO TRUE                          TRKCS104
130100     END-EVALUATE.                                                TRKCS104
130200                                                                  TRKCS104
130300 EJECT                                                            TRKCS104
130400                                                                  TRKCS104
130500 3350-VALIDATE-ETA-DTE.                                           TRKCS104
130600*----------------------------------------------------------------*TRKCS104
130700*    ENSURE THE ESTIMATED TIME OF ARRIVAL ENTERED ON THE SCREEN  *TRKCS104
130800*    IS IN VALID MM DD CCYY FORMAT.  IF THE CCYY IS NOT ENTERED, *TRKCS104
130900*    THE CURRENT CCYY IS USED.                                   *TRKCS104
131000*                                                                *TRKCS104
131100*    PERFORMED FROM 3300-EDIT-DATA-IN-COMMAREA.                  *TRKCS104
131200*----------------------------------------------------------------*TRKCS104
131300                                                                  TRKCS104
131400     MOVE ASC-ETA-MM             TO PV-INPUT-DATE-MM              TRKCS104
131500                                    PV-VALID-DATE-MM.             TRKCS104
131600     MOVE ASC-ETA-DD             TO PV-INPUT-DATE-DD              TRKCS104
131700                                    PV-VALID-DATE-DD.             TRKCS104
131800                                                                  TRKCS104
131900     IF ASC-ETA-CCYY GREATER THAN SPACES                          TRKCS104
132000         MOVE ASC-ETA-CCYY       TO PV-INPUT-DATE-CCYY            TRKCS104
132100                                    PV-VALID-DATE-CCYY            TRKCS104
132200     ELSE                                                         TRKCS104
132300         MOVE DP017-CURRENT-YMD-YYYY                              TRKCS104
132400                                 TO PV-INPUT-DATE-CCYY            TRKCS104
132500                                    PV-VALID-DATE-CCYY            TRKCS104
132600     END-IF.                                                      TRKCS104
132700                                                                  TRKCS104
132800     PERFORM 3700-VALIDATE-DATE.                                  TRKCS104
132900                                                                  TRKCS104
133000     IF PS-VALID-DATE                                             TRKCS104
133100         MOVE PV-INPUT-DATE-MM   TO AETAMMO                       TRKCS104
133200                                    ASC-ETA-MM                    TRKCS104
133300         MOVE PV-INPUT-DATE-DD   TO AETADDO                       TRKCS104
133400                                    ASC-ETA-DD                    TRKCS104
133500         MOVE PV-INPUT-DATE-CCYY TO AETAYYO                       TRKCS104
133600                                    ASC-ETA-CCYY                  TRKCS104
133700         PERFORM 3500-CALL-DATE-RTN                               TRKCS104
133800                                                                  TRKCS104
133900         IF DPG54-DATE-VALID                                      TRKCS104
134000             SET PS-VALID-ETA-DTE  TO TRUE                        TRKCS104
134100             MOVE DPG55-GREG-CC-DATE                              TRKCS104
134200                                   TO PV-VALID-ETA-DTE            TRKCS104
134300         ELSE                                                     TRKCS104
134400             SET PS-INVALID-ETA-DTE                               TRKCS104
134500                                   TO TRUE                        TRKCS104
134600         END-IF                                                   TRKCS104
134700     ELSE                                                         TRKCS104
134800         SET PS-INVALID-ETA-DTE    TO TRUE                        TRKCS104
134900     END-IF.                                                      TRKCS104
135000                                                                  TRKCS104
135100 EJECT                                                            TRKCS104
135200                                                                  TRKCS104
135300 3360-VALIDATE-ETA-TO-DTE.                                        TRKCS104
135400*----------------------------------------------------------------*TRKCS104
135500*    ENSURE THE ESTIMATED TIME OF ARRIVAL TO DATE ENTERED ON THE *TRKCS104
135600*    SCREEN IS IN VALID MM DD CCYY FORMAT.  IF THE CCYY IS NOT   *TRKCS104
135700*    ENTERED, THE CURRENT CCYY IS USED.                          *TRKCS104
135800*                                                                *TRKCS104
135900*    PERFORMED FROM 3300-EDIT-DATA-IN-COMMAREA.                  *TRKCS104
136000*----------------------------------------------------------------*TRKCS104
136100                                                                  TRKCS104
136200     MOVE ASC-ETA-TO-MM          TO PV-INPUT-DATE-MM              TRKCS104
136300                                    PV-VALID-DATE-MM.             TRKCS104
136400     MOVE ASC-ETA-TO-DD          TO PV-INPUT-DATE-DD              TRKCS104
136500                                    PV-VALID-DATE-DD.             TRKCS104
136600                                                                  TRKCS104
136700     IF ASC-ETA-TO-CCYY GREATER THAN SPACES                       TRKCS104
136800         MOVE ASC-ETA-TO-CCYY    TO PV-INPUT-DATE-CCYY            TRKCS104
136900                                    PV-VALID-DATE-CCYY            TRKCS104
137000     ELSE                                                         TRKCS104
137100         MOVE DP017-CURRENT-YMD-YYYY                              TRKCS104
137200                                 TO PV-INPUT-DATE-CCYY            TRKCS104
137300                                    PV-VALID-DATE-CCYY            TRKCS104
137400     END-IF.                                                      TRKCS104
137500                                                                  TRKCS104
137600     PERFORM 3700-VALIDATE-DATE.                                  TRKCS104
137700                                                                  TRKCS104
137800     IF PS-VALID-DATE                                             TRKCS104
137900         MOVE PV-INPUT-DATE-MM   TO ATOMMO                        TRKCS104
138000                                    ASC-ETA-TO-MM                 TRKCS104
138100         MOVE PV-INPUT-DATE-DD   TO ATODDO                        TRKCS104
138200                                    ASC-ETA-TO-DD                 TRKCS104
138300         MOVE PV-INPUT-DATE-CCYY TO ATOYYO                        TRKCS104
138400                                    ASC-ETA-TO-CCYY               TRKCS104
138500         PERFORM 3500-CALL-DATE-RTN                               TRKCS104
138600                                                                  TRKCS104
138700         IF DPG54-DATE-VALID                                      TRKCS104
138800             SET PS-VALID-ETA-TO-DTE                              TRKCS104
138900                                 TO TRUE                          TRKCS104
139000             MOVE DPG55-GREG-CC-DATE                              TRKCS104
139100                                   TO PV-VALID-ETA-TO-DTE         TRKCS104
139200         ELSE                                                     TRKCS104
139300             SET PS-INVALID-ETA-TO-DTE                            TRKCS104
139400                                 TO TRUE                          TRKCS104
139500         END-IF                                                   TRKCS104
139600     ELSE                                                         TRKCS104
139700         SET PS-INVALID-ETA-TO-DTE                                TRKCS104
139800                                 TO TRUE                          TRKCS104
139900     END-IF.                                                      TRKCS104
140000                                                                  TRKCS104
140100 EJECT                                                            TRKCS104
140200                                                                  TRKCS104
140300 3370-VALIDATE-DATE-RANGE.                                        TRKCS104
140400*----------------------------------------------------------------*TRKCS104
140500*    ENSURE THE ESTIMATED TIME OF ARRIVAL START DATE IS GREATER  *TRKCS104
140600*    THAN OR EQUAL TO THE END DATE.  IF THE END DATE IS MORE     *TRKCS104
140700*    THAN 30 DAYS IN THE FUTURE, THE USER MUST PRESS F2 TO       *TRKCS104
140800*    CONFIRM THAT THEY WANT TO EXECUTE THIS TRANSACTION.         *TRKCS104
140900*                                                                *TRKCS104
141000*    PERFORMED FROM 3300-EDIT-DATA-IN-COMMAREA.                  *TRKCS104
141100*----------------------------------------------------------------*TRKCS104
141200                                                                  TRKCS104
141300     PERFORM 3600-CALL-DATE-RANGE-RTN.                            TRKCS104
141400                                                                  TRKCS104
141500     IF DPG54-DATE-VALID                                          TRKCS104
141600         IF DPG55-DAYS-DIFFERENCE GREATER THAN ZERO               TRKCS104
141700             SET PS-INVALID-DATE-RANGE                            TRKCS104
141800                                 TO TRUE                          TRKCS104
141900             SET ASC-DONT-CONFIRM-DATE-RANGE                      TRKCS104
142000                                 TO TRUE                          TRKCS104
142100         ELSE                                                     TRKCS104
142200             IF DP020-SRC-AID = DP016-PF17                        TRKCS104
142300                 SET PS-VALID-DATE-RANGE                          TRKCS104
142400                                 TO TRUE                          TRKCS104
142500             ELSE                                                 TRKCS104
142600                 IF DPG55-DAYS-DIFFERENCE LESS THAN -30           TRKCS104
142700                     SET PS-VALID-DATE-RANGE                      TRKCS104
142800                                 TO TRUE                          TRKCS104
142900                     IF ASC-CONFIRM-DATE-RANGE                    TRKCS104
143000                         CONTINUE                                 TRKCS104
143100                     ELSE                                         TRKCS104
143200                         SET ASC-CONFIRM-DATE-RANGE               TRKCS104
143300                                 TO TRUE                          TRKCS104
143400                         SET DP020-MSG-WARNING                    TRKCS104
143500                                 TO TRUE                          TRKCS104
143600                         MOVE PC-TSYMSG-00004                     TRKCS104
143700                                 TO DP020-MSG-NUMBER              TRKCS104
143800                         SET PS-ERROR                             TRKCS104
143900                                 TO TRUE                          TRKCS104
144000                         MOVE -1 TO AETAMML                       TRKCS104
144100                         SET DP030-SET-CURSOR-APPL-1 TO TRUE      TRKCS104
144200                     END-IF                                       TRKCS104
144300                 ELSE                                             TRKCS104
144400                     SET PS-VALID-DATE-RANGE                      TRKCS104
144500                                 TO TRUE                          TRKCS104
144600                     SET ASC-DONT-CONFIRM-DATE-RANGE              TRKCS104
144700                                 TO TRUE                          TRKCS104
144800                 END-IF                                           TRKCS104
144900             END-IF                                               TRKCS104
145000         END-IF                                                   TRKCS104
145100     ELSE                                                         TRKCS104
145200         SET PS-INVALID-DATE-RANGE                                TRKCS104
145300                                 TO TRUE                          TRKCS104
145400         SET ASC-DONT-CONFIRM-DATE-RANGE                          TRKCS104
145500                                 TO TRUE                          TRKCS104
145600     END-IF.                                                      TRKCS104
145700                                                                  TRKCS104
145800 EJECT                                                            TRKCS104
145900 3380-VALIDATE-DEPT.                                              TRKCS104
146000*----------------------------------------------------------------*TRKCS104
146100*    ENSURE THE DEPARTMENT NUMBER ENTERED ON THE SCREEN IS       *TRKCS104
146200*    CURRENTLY ON THE TPURCHS DATABASE.                          *TRKCS104
146300*                                                                *TRKCS104
146400*    PERFORMED FROM 3300-EDIT-DATA-IN-COMMAREA.                  *TRKCS104
146500*----------------------------------------------------------------*TRKCS104
146600                                                                  TRKCS104
146700     MOVE ASC-DEPT               TO DP010I-UNEDITED-FIELD.        TRKCS104
146800     MOVE LENGTH OF ASC-DEPT     TO DP010I-MAXIMUM-DIGITS.        TRKCS104
146900     MOVE ZERO                   TO DP010I-MAXIMUM-DECIMALS.      TRKCS104
147000     SET DP010I-NEGATIVE-NOT-ALLOWED                              TRKCS104
147100                                 TO TRUE.                         TRKCS104
147200                                                                  TRKCS104
273427     CALL DP010I-NUMERIC-EDIT-ROUTINE                             TRKCS104
273427          USING DP010I-NUMERIC-EDIT-AREA.                         TRKCS104
147400                                                                  TRKCS104
147500     IF  DP010I-ERROR-DETECTED                                    TRKCS104
147600         SET PS-INVALID-DEPT     TO TRUE                          TRKCS104
147700     ELSE                                                         TRKCS104
147800         MOVE DP010I-NUMERIC-FIELD                                TRKCS104
147900                                 TO ASC-DEPT-N                    TRKCS104
148000         MOVE ASC-DEPT-N         TO ADEPTO                        TRKCS104
148100         SET PS-VALID-DEPT       TO TRUE                          TRKCS104
148200         MOVE ASC-DEPT-N(2:3)    TO PV-PURCHS-DEPT                        
148300* WILL BE REMOVED WHEN DEPT-NBR IS NOT VAILDATED ON TPURCHS               
148400         IF ASC-DEPT-N(1:1) > 0                                           
148500             SET PS-INVALID-DEPT  TO TRUE                                 
148600         END-IF                                                           
148700     END-IF.                                                      TRKCS104
148800                                                                  TRKCS104
148900     IF PS-VALID-DEPT                                             TRKCS104
149000         PERFORM 3382-OPEN-DEPT-CSR                               TRKCS104
149100         PERFORM 3384-FETCH-DEPT-CSR                              TRKCS104
149200         PERFORM 3386-CLOSE-DEPT-CSR                              TRKCS104
149300     END-IF.                                                      TRKCS104
149400                                                                  TRKCS104
149500 EJECT                                                            TRKCS104
149600                                                                  TRKCS104
149700 3382-OPEN-DEPT-CSR.                                              TRKCS104
149800*----------------------------------------------------------------*TRKCS104
149900*    OPEN THE DEPT CURSOR.                                       *TRKCS104
150000*                                                                *TRKCS104
150100*    PERFORMED FROM 3380-VALIDATE-DEPT.                          *TRKCS104
150200*----------------------------------------------------------------*TRKCS104
150300                                                                  TRKCS104
150400     EXEC SQL                                                     TRKCS104
150500         OPEN DEPT_CSR                                            TRKCS104
150600     END-EXEC.                                                    TRKCS104
150700                                                                  TRKCS104
150800     EVALUATE TRUE                                                TRKCS104
150900         WHEN SQLCODE = ZERO                                      TRKCS104
151000             CONTINUE                                             TRKCS104
151100         WHEN OTHER                                               TRKCS104
151200             MOVE '3382-OPEN-DEPT-CSR'                            TRKCS104
151300                                 TO DP013-PARAGRAPH               TRKCS104
151400             MOVE 'OPEN DEPT CURSOR'                              TRKCS104
151500                                 TO DP013-MESSAGE-TEXT(1)         TRKCS104
151600             MOVE SQLCA          TO DP013-SQLCA                   TRKCS104
151700             MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)      TRKCS104
151800             SET DP013-DB2-ABEND TO TRUE                          TRKCS104
151900             SET DP013-NO-ROLLBACK                                TRKCS104
152000                                 TO TRUE                          TRKCS104
152100             SET DP013-XCTL-DISPLAY-RESTART                       TRKCS104
152200                                 TO TRUE                          TRKCS104
152300             PERFORM DP013-0000-PROCESS-ABEND                     TRKCS104
152400     END-EVALUATE.                                                TRKCS104
152500                                                                  TRKCS104
152600 EJECT                                                            TRKCS104
152700                                                                  TRKCS104
152800 3384-FETCH-DEPT-CSR.                                             TRKCS104
152900*----------------------------------------------------------------*TRKCS104
153000*    FETCHES THE DEPT CURSOR.                                    *TRKCS104
153100*                                                                *TRKCS104
153200*    PERFORMED FROM 3380-VALIDATE-DEPT.                          *TRKCS104
153300*----------------------------------------------------------------*TRKCS104
153400                                                                  TRKCS104
153500     EXEC SQL                                                     TRKCS104
153600         FETCH DEPT_CSR                                           TRKCS104
153700          INTO :PURCHS-DEPT-NBR                                   TRKCS104
153800     END-EXEC.                                                    TRKCS104
153900                                                                  TRKCS104
154000     EVALUATE TRUE                                                TRKCS104
154100         WHEN SQLCODE = ZERO                                      TRKCS104
154200              SET PS-VALID-DEPT                                   TRKCS104
154300                                 TO TRUE                          TRKCS104
154400         WHEN SQLCODE = +100                                      TRKCS104
154500              SET PS-INVALID-DEPT                                 TRKCS104
154600                                 TO TRUE                          TRKCS104
154700         WHEN OTHER                                               TRKCS104
154800             MOVE '3384-FETCH-DEPT-CSR'                           TRKCS104
154900                                 TO DP013-PARAGRAPH               TRKCS104
155000             MOVE 'FETCH DEPT CURSOR'                             TRKCS104
155100                                 TO DP013-MESSAGE-TEXT(1)         TRKCS104
155200             MOVE SQLCA          TO DP013-SQLCA                   TRKCS104
155300             MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)      TRKCS104
155400             SET DP013-DB2-ABEND TO TRUE                          TRKCS104
155500             SET DP013-NO-ROLLBACK                                TRKCS104
155600                                 TO TRUE                          TRKCS104
155700             SET DP013-XCTL-DISPLAY-RESTART                       TRKCS104
155800                                 TO TRUE                          TRKCS104
155900             PERFORM DP013-0000-PROCESS-ABEND                     TRKCS104
156000     END-EVALUATE.                                                TRKCS104
156100                                                                  TRKCS104
156200 3386-CLOSE-DEPT-CSR.                                             TRKCS104
156300*----------------------------------------------------------------*TRKCS104
156400*    CLOSE THE DEPT CURSOR.                                      *TRKCS104
156500*                                                                *TRKCS104
156600*    PERFORMED FROM 3380-VALIDATE-DEPT.                          *TRKCS104
156700*----------------------------------------------------------------*TRKCS104
156800                                                                  TRKCS104
156900     EXEC SQL                                                     TRKCS104
157000         CLOSE DEPT_CSR                                           TRKCS104
157100     END-EXEC.                                                    TRKCS104
157200                                                                  TRKCS104
157300     EVALUATE TRUE                                                TRKCS104
157400         WHEN SQLCODE = ZERO                                      TRKCS104
157500             CONTINUE                                             TRKCS104
157600         WHEN OTHER                                               TRKCS104
157700             MOVE '3386-CLOSE-DEPT-CSR'                           TRKCS104
157800                                 TO DP013-PARAGRAPH               TRKCS104
157900             MOVE 'CLOSE DEPT CURSOR'                             TRKCS104
158000                                 TO DP013-MESSAGE-TEXT(1)         TRKCS104
158100             MOVE SQLCA          TO DP013-SQLCA                   TRKCS104
158200             MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)      TRKCS104
158300             SET DP013-DB2-ABEND TO TRUE                          TRKCS104
158400             SET DP013-NO-ROLLBACK                                TRKCS104
158500                                 TO TRUE                          TRKCS104
158600             SET DP013-XCTL-DISPLAY-RESTART                       TRKCS104
158700                                 TO TRUE                          TRKCS104
158800             PERFORM DP013-0000-PROCESS-ABEND                     TRKCS104
158900     END-EVALUATE.                                                TRKCS104
159000                                                                  TRKCS104
159100******************************************************************TRKCS104
159200** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **TRKCS104
159300** MAP.                                                         **TRKCS104
159400******************************************************************TRKCS104
159500 3200-RESET-ATTRIBUTES.                                           TRKCS104
159600     MOVE DP015-UNP-ALP-NOR-OFF    TO ADEPTA                      TRKCS104
159700                                      APOA                        TRKCS104
159800                                      APROA                       TRKCS104
159900                                      ABOLA                       TRKCS104
160000                                      AOPERA                      TRKCS104
160100                                      AFCLTYA                     TRKCS104
160200                                      ASCACA                      TRKCS104
160300                                      AETAMMA                     TRKCS104
160400                                      AETADDA                     TRKCS104
160500                                      AETAYYA                     TRKCS104
160600                                      ATOMMA                      TRKCS104
160700                                      ATODDA                      TRKCS104
160800                                      ATOYYA                      TRKCS104
160900     MOVE DP015-GREEN              TO ADEPTC                      TRKCS104
161000                                      APOC                        TRKCS104
161100                                      APROC                       TRKCS104
161200                                      ABOLC                       TRKCS104
161300                                      AOPERC                      TRKCS104
161400                                      AFCLTYC                     TRKCS104
161500                                      ASCACC                      TRKCS104
161600                                      AETAMMC                     TRKCS104
161700                                      AETADDC                     TRKCS104
161800                                      AETAYYC                     TRKCS104
161900                                      ATOMMC                      TRKCS104
162000                                      ATODDC                      TRKCS104
162100                                      ATOYYC                      TRKCS104
162200       MOVE DP015-UNDERLINE        TO ADEPTH                      TRKCS104
162300                                      APOH                        TRKCS104
162400                                      APROH                       TRKCS104
162500                                      ABOLH                       TRKCS104
162600                                      AOPERH                      TRKCS104
162700                                      AFCLTYH                     TRKCS104
162800                                      ASCACH                      TRKCS104
162900                                      AETAMMH                     TRKCS104
163000                                      AETADDH                     TRKCS104
163100                                      AETAYYH                     TRKCS104
163200                                      ATOMMH                      TRKCS104
163300                                      ATODDH                      TRKCS104
163400                                      ATOYYH.                     TRKCS104
163500 3600-CALL-DATE-RANGE-RTN.                                        TRKCS104
163600*----------------------------------------------------------------*TRKCS104
163700*    SETS ALL THE PROPER INDICATORS FOR A DATE VALIDATION AND    *TRKCS104
163800*    DATE RANGE COMPARISON.                                      *TRKCS104
163900*                                                                *TRKCS104
164000*    PERFORMED FROM 3300-EDIT-DATA-IN-COMMAREA.                  *TRKCS104
164100*----------------------------------------------------------------*TRKCS104
164200                                                                  TRKCS104
164300     SET DPG51-ACTUAL-CALENDAR-ONLY                               TRKCS104
164400                                 TO TRUE.                         TRKCS104
164500     SET DPG52-LK-DTE-GREG-CC    TO TRUE.                         TRKCS104
164600     SET DPG53-LK-CMPR-DTE-GREG-CC                                TRKCS104
164700                                 TO TRUE.                         TRKCS104
164800                                                                  TRKCS104
164900     MOVE PV-VALID-ETA-DTE       TO DPG52-LK-DATE-INPUT.          TRKCS104
165000     MOVE PV-VALID-ETA-TO-DTE    TO DPG53-LK-CMPR-DATE-INPUT.     TRKCS104
165100                                                                  TRKCS104
165200     CALL PC-DPKUT500  USING DPG51 DPG52                          TRKCS104
165300                             DPG53 DPG54                          TRKCS104
165400                             DPG55 DPG56.                         TRKCS104
165500                                                                  TRKCS104
165600 EJECT                                                            TRKCS104
165700                                                                  TRKCS104
165800 3500-CALL-DATE-RTN.                                              TRKCS104
165900*----------------------------------------------------------------*TRKCS104
166000*    SETS ALL THE PROPER INDICATORS FOR A DATE VALIDATION        *TRKCS104
166100*                                                                *TRKCS104
166200*    PERFORMED BY 3350-VALIDATE-ETA-DATE.                        *TRKCS104
166300*----------------------------------------------------------------*TRKCS104
166400                                                                  TRKCS104
166500     SET DPG51-ACTUAL-CALENDAR-ONLY                               TRKCS104
166600                                 TO TRUE.                         TRKCS104
166700     SET DPG52-LK-DTE-GREG-CC    TO TRUE.                         TRKCS104
166800                                                                  TRKCS104
166900     MOVE PV-INPUT-DATE          TO DPG52-LK-DATE-INPUT.          TRKCS104
167000                                                                  TRKCS104
167100     CALL PC-DPKUT500  USING DPG51 DPG52                          TRKCS104
167200                             DPG53 DPG54                          TRKCS104
167300                             DPG55 DPG56.                         TRKCS104
167400                                                                  TRKCS104
167500 EJECT                                                            TRKCS104
167600                                                                  TRKCS104
167700 3700-VALIDATE-DATE.                                              TRKCS104
167800*----------------------------------------------------------------*TRKCS104
167900*    TAKES THE DATE FIELDS ENTERED AND ADDS LEADING ZEROS IF     *TRKCS104
168000*    NEEDED.  IF THE FIELDS ENTERED ON THE SCREEN ARE NOT NUMERIC*TRKCS104
168100*    A SWITCH IS SET.                                            *TRKCS104
168200*                                                                *TRKCS104
168300*    PERFORMED BY 3350-VALIDATE-ETA-DATE.                        *TRKCS104
168400*----------------------------------------------------------------*TRKCS104
168500                                                                  TRKCS104
168600     SET PS-VALID-DATE           TO TRUE.                         TRKCS104
168700                                                                  TRKCS104
168800     MOVE PV-VALID-DATE-MM       TO DP010I-UNEDITED-FIELD.        TRKCS104
168900     MOVE +2                     TO DP010I-MAXIMUM-DIGITS.        TRKCS104
169000     MOVE +0                     TO DP010I-MAXIMUM-DECIMALS.      TRKCS104
169100                                                                  TRKCS104
169200     SET DP010I-NEGATIVE-NOT-ALLOWED                              TRKCS104
169300                                 TO TRUE.                         TRKCS104
169400                                                                  TRKCS104
273427     CALL DP010I-NUMERIC-EDIT-ROUTINE                             TRKCS104
273427          USING DP010I-NUMERIC-EDIT-AREA.                         TRKCS104
169600                                                                  TRKCS104
169700     IF DP010I-ERROR-DETECTED                                     TRKCS104
169800         SET PS-INVALID-DATE     TO TRUE                          TRKCS104
169900     ELSE                                                         TRKCS104
170000         MOVE DP010I-NUMERIC-FIELD                                TRKCS104
170100                                 TO PV-INPUT-DATE-MM              TRKCS104
170200     END-IF.                                                      TRKCS104
170300                                                                  TRKCS104
170400     MOVE PV-VALID-DATE-DD       TO DP010I-UNEDITED-FIELD.        TRKCS104
170500     MOVE +2                     TO DP010I-MAXIMUM-DIGITS.        TRKCS104
170600     MOVE +0                     TO DP010I-MAXIMUM-DECIMALS.      TRKCS104
170700                                                                  TRKCS104
170800     SET DP010I-NEGATIVE-NOT-ALLOWED                              TRKCS104
170900                                 TO TRUE.                         TRKCS104
171000                                                                  TRKCS104
273427     CALL DP010I-NUMERIC-EDIT-ROUTINE                             TRKCS104
273427          USING DP010I-NUMERIC-EDIT-AREA.                         TRKCS104
171200                                                                  TRKCS104
171300     IF DP010I-ERROR-DETECTED                                     TRKCS104
171400         SET PS-INVALID-DATE     TO TRUE                          TRKCS104
171500     ELSE                                                         TRKCS104
171600         MOVE DP010I-NUMERIC-FIELD                                TRKCS104
171700                                 TO PV-INPUT-DATE-DD              TRKCS104
171800     END-IF.                                                      TRKCS104
171900                                                                  TRKCS104
172000     MOVE PV-VALID-DATE-CCYY     TO DP010I-UNEDITED-FIELD.        TRKCS104
172100     MOVE +4                     TO DP010I-MAXIMUM-DIGITS.        TRKCS104
172200     MOVE +0                     TO DP010I-MAXIMUM-DECIMALS.      TRKCS104
172300                                                                  TRKCS104
172400     SET DP010I-NEGATIVE-NOT-ALLOWED                              TRKCS104
172500                                 TO TRUE.                         TRKCS104
172600                                                                  TRKCS104
273427     CALL DP010I-NUMERIC-EDIT-ROUTINE                             TRKCS104
273427          USING DP010I-NUMERIC-EDIT-AREA.                         TRKCS104
172800                                                                  TRKCS104
172900     IF DP010I-ERROR-DETECTED                                     TRKCS104
173000         SET PS-INVALID-DATE     TO TRUE                          TRKCS104
173100     ELSE                                                         TRKCS104
173200         MOVE DP010I-NUMERIC-FIELD                                TRKCS104
173300                                 TO PV-INPUT-DATE-CCYY            TRKCS104
173400     END-IF.                                                      TRKCS104
173500                                                                  TRKCS104
173600*                                                                 TRKCS104
173700*----------------------------------------------------------------*TRKCS104
173800*  CHECK THE STORE TABLE TO VERIFY THAT THE FACILITY             *TRKCS104
173900*  ENTERED ON THE MAP IS VALID.                                  *TRKCS104
174000*----------------------------------------------------------------*TRKCS104
174100*                                                                 TRKCS104
174200                                                                  TRKCS104
174300 3800-VALIDATE-FCLTY-ID.                                          TRKCS104
174400                                                                  TRKCS104
174500     PERFORM                                                      TRKCS104
174600         WITH TEST AFTER                                          TRKCS104
174700         VARYING PV-RETRY-COUNTER                                 TRKCS104
174800         FROM 1 BY 1                                              TRKCS104
174900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               TRKCS104
175000                   OR (SQLCODE = ZERO)                            TRKCS104
175100                   OR (SQLCODE = +100))                           TRKCS104
175200                                                                  TRKCS104
175300         EXEC SQL                                                 TRKCS104
175400            SELECT  FCLTY_ID                                      TRKCS104
175500                   ,FCLTY_NME                                     TRKCS104
175600              INTO :FACLTY-FCLTY-ID                               TRKCS104
175700                  ,:FACLTY-FCLTY-NME                              TRKCS104
175800              FROM  TFACLTY                                       TRKCS104
175900             WHERE  OPER_UNT_ID = :PV-OPER-UNT-ID                 TRKCS104
176000               AND  FCLTY_ID    = :PV-FCLTY-ID                    TRKCS104
176100         END-EXEC                                                 TRKCS104
176200                                                                  TRKCS104
176300         EVALUATE TRUE                                            TRKCS104
176400             WHEN SQLCODE = ZERO                                  TRKCS104
176500                 MOVE FACLTY-FCLTY-NME                            TRKCS104
176600                                 TO ASC-FCLTY-NME                 TRKCS104
176700                                    AFDESCO                       TRKCS104
176800                                                                  TRKCS104
176900             WHEN SQLCODE = +100                                  TRKCS104
177000             WHEN SQLCODE = -904                                  TRKCS104
177100             WHEN SQLCODE = -913                                  TRKCS104
177200                 CONTINUE                                         TRKCS104
177300                                                                  TRKCS104
177400             WHEN SQLWARN0 NOT = SPACES                           TRKCS104
177500             WHEN SQLCODE < ZERO                                  TRKCS104
177600             WHEN SQLCODE > ZERO                                  TRKCS104
177700                 MOVE '3800-VALIDATE-FCLTY-ID'                    TRKCS104
177800                                 TO DP013-PARAGRAPH               TRKCS104
177900                 MOVE 'SELECT STORE NUMBER'                       TRKCS104
178000                                 TO DP013-MESSAGE-TEXT (1)        TRKCS104
178100                 MOVE SQLCA      TO DP013-SQLCA                   TRKCS104
178200                 MOVE 'TFACLTY'  TO DP013-DB2-TABLE-NAME (1)      TRKCS104
178300                 SET DP013-DB2-ABEND                              TRKCS104
178400                                 TO TRUE                          TRKCS104
178500                 SET DP013-XCTL-DISPLAY-RESTART                   TRKCS104
178600                                 TO TRUE                          TRKCS104
178700                 PERFORM DP013-0000-PROCESS-ABEND                 TRKCS104
178800         END-EVALUATE                                             TRKCS104
178900     END-PERFORM.                                                 TRKCS104
179000                                                                  TRKCS104
179100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        TRKCS104
179200         MOVE '3800-VALIDATE-FCLTY-ID'                            TRKCS104
179300                                 TO DP013-PARAGRAPH               TRKCS104
179400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     TRKCS104
179500                                 TO DP013-MESSAGE-TEXT (1)        TRKCS104
179600         MOVE 'STORE NUMBER  '   TO DP013-MESSAGE-TEXT (2)        TRKCS104
179700         MOVE SQLCA              TO DP013-SQLCA                   TRKCS104
179800         MOVE 'TFACLTY'          TO DP013-DB2-TABLE-NAME (1)      TRKCS104
179900         SET DP013-DB2-ABEND     TO TRUE                          TRKCS104
180000         SET DP013-XCTL-DISPLAY-RESTART                           TRKCS104
180100                                 TO TRUE                          TRKCS104
180200         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS104
180300     END-IF.                                                      TRKCS104
180400                                                                  TRKCS104
180500     IF SQLCODE = +100                                            TRKCS104
180600         SET PS-ERROR                                             TRKCS104
180700             DP020-MSG-FATAL     TO TRUE                          TRKCS104
180800         MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER              TRKCS104
180900         MOVE DP015-UNP-ALP-BRT-OFF                               TRKCS104
181000                                 TO AFCLTYA                       TRKCS104
181100         MOVE DP015-RED          TO AFCLTYC                       TRKCS104
181200         MOVE DP015-REVERSE      TO AFCLTYH                       TRKCS104
181300         MOVE -1                 TO AFCLTYL                       TRKCS104
181400         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      TRKCS104
181500     END-IF.                                                      TRKCS104
181600                                                                  TRKCS104
181700*----------------------------------------------------------------*TRKCS104
181800*  CHECK THE OPER UNIT TABLE TO VERIFY THE OPER UNIT             *TRKCS104
181900*  ENTERED ON THE MAP IS VALID.                                  *TRKCS104
182000*----------------------------------------------------------------*TRKCS104
182100                                                                  TRKCS104
182200 3900-VALIDATE-OPER-UNT-ID.                                       TRKCS104
182300                                                                  TRKCS104
182400     PERFORM                                                      TRKCS104
182500         WITH TEST AFTER                                          TRKCS104
182600         VARYING PV-RETRY-COUNTER                                 TRKCS104
182700         FROM 1 BY 1                                              TRKCS104
182800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               TRKCS104
182900                   OR (SQLCODE = ZERO)                            TRKCS104
183000                   OR (SQLCODE = +100)                            TRKCS104
183100                   OR (SQLCODE = -811))                           TRKCS104
183200                                                                  TRKCS104
183300         EXEC SQL                                                 TRKCS104
183400            SELECT  OPER_UNT_ID                                   TRKCS104
183500              INTO :FACLTY-OPER-UNT-ID                            TRKCS104
183600              FROM  TFACLTY                                       TRKCS104
183700             WHERE  OPER_UNT_ID = :PV-OPER-UNT-ID                 TRKCS104
183800         END-EXEC                                                 TRKCS104
183900                                                                  TRKCS104
184000         EVALUATE TRUE                                            TRKCS104
184100             WHEN SQLCODE = ZERO                                  TRKCS104
184200             WHEN SQLCODE = +100                                  TRKCS104
184300             WHEN SQLCODE = -811                                  TRKCS104
184400             WHEN SQLCODE = -904                                  TRKCS104
184500             WHEN SQLCODE = -913                                  TRKCS104
184600                 CONTINUE                                         TRKCS104
184700             WHEN SQLWARN0 NOT = SPACES                           TRKCS104
184800             WHEN SQLCODE < ZERO                                  TRKCS104
184900             WHEN SQLCODE > ZERO                                  TRKCS104
185000                 MOVE '3900-VALIDATE-FCLTY-ID'                    TRKCS104
185100                                 TO DP013-PARAGRAPH               TRKCS104
185200                 MOVE 'SELECT STORE NUMBER'                       TRKCS104
185300                                 TO DP013-MESSAGE-TEXT (1)        TRKCS104
185400                 MOVE SQLCA      TO DP013-SQLCA                   TRKCS104
185500                 MOVE 'TFACLTY'  TO DP013-DB2-TABLE-NAME (1)      TRKCS104
185600                 SET DP013-DB2-ABEND                              TRKCS104
185700                                 TO TRUE                          TRKCS104
185800                 SET DP013-XCTL-DISPLAY-RESTART                   TRKCS104
185900                                 TO TRUE                          TRKCS104
186000                 PERFORM DP013-0000-PROCESS-ABEND                 TRKCS104
186100         END-EVALUATE                                             TRKCS104
186200     END-PERFORM.                                                 TRKCS104
186300                                                                  TRKCS104
186400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        TRKCS104
186500         MOVE '3900-VALIDATE-FCLTY-ID'                            TRKCS104
186600                                 TO DP013-PARAGRAPH               TRKCS104
186700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     TRKCS104
186800                                 TO DP013-MESSAGE-TEXT (1)        TRKCS104
186900         MOVE 'STORE NUMBER  '   TO DP013-MESSAGE-TEXT (2)        TRKCS104
187000         MOVE SQLCA              TO DP013-SQLCA                   TRKCS104
187100         MOVE 'TFACLTY'          TO DP013-DB2-TABLE-NAME (1)      TRKCS104
187200         SET DP013-DB2-ABEND     TO TRUE                          TRKCS104
187300         SET DP013-XCTL-DISPLAY-RESTART                           TRKCS104
187400                                 TO TRUE                          TRKCS104
187500         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS104
187600     END-IF.                                                      TRKCS104
187700                                                                  TRKCS104
187800     IF SQLCODE = +100                                            TRKCS104
187900         SET PS-ERROR                                             TRKCS104
188000             DP020-MSG-FATAL     TO TRUE                          TRKCS104
188100         MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER              TRKCS104
188200         MOVE DP015-UNP-ALP-BRT-OFF                               TRKCS104
188300                                 TO AOPERA                        TRKCS104
188400         MOVE DP015-RED          TO AOPERC                        TRKCS104
188500         MOVE DP015-REVERSE      TO AOPERH                        TRKCS104
188600         MOVE -1                 TO AOPERL                        TRKCS104
188700         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      TRKCS104
188800     END-IF.                                                      TRKCS104
188900                                                                  TRKCS104
189000 EJECT                                                            TRKCS104
189100                                                                  TRKCS104
189200*----------------------------------------------------------------*TRKCS104
189300*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *TRKCS104
189400*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *TRKCS104
189500*  IT HERE.                                                      *TRKCS104
189600*----------------------------------------------------------------*TRKCS104
189700 4000-BUILD-INITIAL-PANEL.                                        TRKCS104
189800     MOVE ASC-OPER-UNT-ID-N        TO FACLTY-OPER-UNT-ID.         TRKCS104
189900     MOVE ASC-FCLTY-ID-N           TO FACLTY-FCLTY-ID.            TRKCS104
190000                                                                  TRKCS104
190100     PERFORM 4010-GET-FCLTY-NAME.                                 TRKCS104
190200                                                                  TRKCS104
190300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        TRKCS104
190400                                                                  TRKCS104
190500     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       TRKCS104
190600     MOVE -1                       TO ADEPTL.                     TRKCS104
190700                                                                  TRKCS104
190800*----------------------------------------------------------------*TRKCS104
190900*    GET THE FACILITY NAME                                       *TRKCS104
191000*----------------------------------------------------------------*TRKCS104
191100 4010-GET-FCLTY-NAME.                                             TRKCS104
191200                                                                  TRKCS104
191300     PERFORM                                                      TRKCS104
191400         WITH TEST AFTER                                          TRKCS104
191500         VARYING PV-RETRY-COUNTER                                 TRKCS104
191600         FROM 1 BY 1                                              TRKCS104
191700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               TRKCS104
191800             OR (SQLCODE = +0)                                    TRKCS104
191900             OR (SQLCODE = +100))                                 TRKCS104
192000                                                                  TRKCS104
192100         EXEC SQL                                                 TRKCS104
192200              SELECT FCLTY_NME                                    TRKCS104
192300                INTO :FACLTY-FCLTY-NME                            TRKCS104
192400                FROM TFACLTY                                      TRKCS104
192500               WHERE OPER_UNT_ID = :FACLTY-OPER-UNT-ID            TRKCS104
192600                 AND FCLTY_ID    = :FACLTY-FCLTY-ID               TRKCS104
192700         END-EXEC                                                 TRKCS104
192800                                                                  TRKCS104
192900         EVALUATE TRUE                                            TRKCS104
193000             WHEN SQLCODE = +0                                    TRKCS104
193100                  MOVE FACLTY-FCLTY-NME                           TRKCS104
193200                                  TO ASC-FCLTY-NME                TRKCS104
193300                                                                  TRKCS104
193400             WHEN SQLCODE = +100                                  TRKCS104
193500                  MOVE SPACES     TO ASC-FCLTY-NME                TRKCS104
193600                                                                  TRKCS104
193700             WHEN SQLCODE = -904                                  TRKCS104
193800             WHEN SQLCODE = -913                                  TRKCS104
193900                  CONTINUE                                        TRKCS104
194000                                                                  TRKCS104
194100             WHEN SQLWARN0 NOT = SPACES                           TRKCS104
194200             WHEN SQLCODE < +0                                    TRKCS104
194300             WHEN SQLCODE > +0                                    TRKCS104
194400                  MOVE '4010-GET-FCLTY-NAME'                      TRKCS104
194500                                  TO DP013-PARAGRAPH              TRKCS104
194600                  MOVE 'UNSUCCESSFUL SELECT ON FACILITY TABLE'    TRKCS104
194700                                  TO DP013-MESSAGE-TEXT (1)       TRKCS104
194800                  MOVE SQLCA      TO DP013-SQLCA                  TRKCS104
194900                  MOVE 'TFACLTY ' TO DP013-DB2-TABLE-NAME (1)     TRKCS104
195000                  SET DP013-DB2-ABEND                             TRKCS104
195100                      DP013-XCTL-DISPLAY-RESTART                  TRKCS104
195200                                  TO TRUE                         TRKCS104
195300                  PERFORM DP013-0000-PROCESS-ABEND                TRKCS104
195400         END-EVALUATE                                             TRKCS104
195500     END-PERFORM.                                                 TRKCS104
195600                                                                  TRKCS104
195700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        TRKCS104
195800         MOVE '4010-GET-FCLTY-NAME'                               TRKCS104
195900                                  TO DP013-PARAGRAPH              TRKCS104
196000         MOVE 'MAX RETRIES EXCEEDED ON SELECT FACILITY TABLE'     TRKCS104
196100                                  TO DP013-MESSAGE-TEXT (1)       TRKCS104
196200         MOVE SQLCA               TO DP013-SQLCA                  TRKCS104
196300         MOVE 'TFACLTY'           TO DP013-DB2-TABLE-NAME (1)     TRKCS104
196400         SET DP013-DB2-ABEND                                      TRKCS104
196500             DP013-XCTL-DISPLAY-RESTART                           TRKCS104
196600                                  TO TRUE                         TRKCS104
196700         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS104
196800     END-IF.                                                      TRKCS104
196900                                                                  TRKCS104
197000/                                                                 TRKCS104
197100*                                                                 TRKCS104
197200*----------------------------------------------------------------*TRKCS104
197300*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *TRKCS104
197400*----------------------------------------------------------------*TRKCS104
197500 4400-MOVE-COMMAREA-TO-SCREEN.                                    TRKCS104
197600                                                                  TRKCS104
197700     MOVE ASC-DEPT-N            TO ADEPTO.                        TRKCS104
197800     MOVE ASC-PO-NBR            TO APOO.                          TRKCS104
197900     MOVE ASC-PRO-NBR           TO APROO.                         TRKCS104
198000     MOVE ASC-BOL-NBR           TO ABOLO.                         TRKCS104
198100     MOVE ASC-OPER-UNT-ID       TO AOPERO.                        TRKCS104
198200     MOVE ASC-FCLTY-ID          TO AFCLTYO.                       TRKCS104
198300     MOVE ASC-FCLTY-NME         TO AFDESCO.                       TRKCS104
198400     MOVE ASC-SCAC              TO ASCACO.                        TRKCS104
198500     MOVE ASC-ETA-MM            TO AETAMMO.                       TRKCS104
198600     MOVE ASC-ETA-DD            TO AETADDO.                       TRKCS104
198700     MOVE ASC-ETA-CCYY          TO AETAYYO.                       TRKCS104
198800     MOVE ASC-ETA-TO-MM         TO ATOMMO.                        TRKCS104
198900     MOVE ASC-ETA-TO-DD         TO ATODDO.                        TRKCS104
199000     MOVE ASC-ETA-TO-CCYY       TO ATOYYO.                        TRKCS104
199100     MOVE ASC-TRLR-NBR          TO AVEHNOO.                       TRKCS104
199200                                                                  TRKCS104
199300 EJECT                                                            TRKCS104
199400*----------------------------------------------------------------*TRKCS104
199500*    ABEND PROCESSOR MODULE                                      *TRKCS104
199600*----------------------------------------------------------------*TRKCS104
199700                                                                  TRKCS104
199800     COPY DPPD013.                                                TRKCS104
