000100******************************************************************00020005
000200 IDENTIFICATION DIVISION.                                         00030005
000300******************************************************************00040005
000400 PROGRAM-ID.         EPKUT072.                                    00050005
000500 AUTHOR.             BARB SCHULTZ.                                00060005
000600 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00070005
000700 DATE-WRITTEN.       APRIL 2006.                                  00080005
000800 DATE-COMPILED.                                                   00090005
000900                                                                  00100005
001000******************************************************************00110005
001100* THIS PROGRAM REMOVES DUPLICATE BIN RANGES FROM THE BIN FILE    *00120005
001200* CREATED IN EPKUT070.                                           *00130005
001300*                                                                *00140005
001800******************************************************************00190005
001900 ENVIRONMENT DIVISION.                                            00200005
002000******************************************************************00210005
002100                                                                  00220005
002200 CONFIGURATION SECTION.                                           00230005
002300                                                                  00240005
002400 SOURCE-COMPUTER.    IBM-3090.                                    00250005
002500 OBJECT-COMPUTER.    IBM-3090.                                    00260005
002600                                                                  00270005
002700 INPUT-OUTPUT SECTION.                                            00280005
002800                                                                  00290005
002900 FILE-CONTROL.                                                    00300005
003000                                                                  00310005
003100     SELECT INPUT-BIN-FILE       ASSIGN TO INP01.                 00320005
003200     SELECT AJB-BIN-FILE         ASSIGN TO OUT01.                 00340005
003300                                                                  00350005
003400******************************************************************00360005
003500 DATA DIVISION.                                                   00370005
003600******************************************************************00380005
003700                                                                  00390005
003800 FILE SECTION.                                                    00400005
003900                                                                  00410005
004000 FD  INPUT-BIN-FILE                                               00420005
004100     RECORDING MODE IS F                                          00430005
004200     BLOCK CONTAINS 0 RECORDS                                     00440005
004300     LABEL RECORDS ARE OMITTED.                                   00450005
004400                                                                  00460005
004500 01  INPUT-BIN-RECORD            PIC  X(80).                      00470005
004600                                                                  00480005
004700 FD  AJB-BIN-FILE                                                 00560005
004800     RECORDING MODE IS F                                          00570005
004900     BLOCK CONTAINS 0 RECORDS                                     00580005
005000     LABEL RECORDS ARE OMITTED.                                   00590005
005100                                                                  00600005
005200 01  AJB-BIN-RECORD              PIC  X(80).                      00610005
005300                                                                  00620005
005400 WORKING-STORAGE SECTION.                                         00630005
005500                                                                  00640005
005600 01  ABEND-CODE                  PIC S9(04)     VALUE +0  COMP.   00650005
005700                                                                  00660005
005800******************************************************************00670005
005900*PC - PROGRAM CONSTANTS                                           00680005
006000******************************************************************00690005
006100 01  PROGRAM-CONSTANTS.                                           00700005
006200     05  PC-PROGRAM-NAME         PIC X(08)   VALUE 'EPKUT072'.    00710005
006300                                                                  00720005
006400******************************************************************00730005
006500*PV - PROGRAM VARIABLES                                           00740005
006600******************************************************************00750005
006700 01  PROGRAM-VARIABLES.                                           00760005
006800     05  PV-PARAGRAPH-NAME       PIC X(30).                       00770005
006900     05  PV-ABEND-CODE           PIC S9(4) COMP VALUE ZERO.       00780005
007000         88  PV-RECS-OUT-OF-SEQ-ERROR           VALUE 4007.       00790005
007100         88  PV-TRAILER-CNT-ERROR               VALUE 4008.       00800005
008800                                                                  00991019
008900******************************************************************01000005
009000*PA - PROGRAM ACCUMULATORS                                        01010005
009100******************************************************************01020005
009200 01  PROGRAM-ACCUMULATORS.                                        01030005
009300     05  PA-BIN-RCDS-READ        PIC S9(11)     COMP-3            01040005
009400                                                VALUE ZEROES.     01050005
009500     05  PA-RECORDS-WRITTEN      PIC S9(11)     COMP-3            01060005
009600                                                VALUE ZEROES.     01070005
009300     05  PA-DIS-BIN-RCDS-READ    PIC S9(11)     COMP-3            01100005
009400                                                VALUE ZEROES.     01110005
009300     05  PA-TOT-RCDS-READ        PIC S9(11)     COMP-3            01120005
009400                                                VALUE ZEROES.     01130005
010500     05  PA-ERROR-FILE           PIC  9(11)     VALUE ZEROES.     01140027
009900                                                                  01160005
010000******************************************************************01170005
010100*PS - PROGRAM SWITCHES                                            01180005
010200******************************************************************01190005
010300 01  PROGRAM-SWITCHES.                                            01200005
010400     05  PS-INPUT-BIN-EOF-SW     PIC X(01)      VALUE 'N'.        01210005
010500         88  PS-INPUT-BIN-EOF                   VALUE 'Y'.        01220005
011200                                                                  01400005
011300******************************************************************01410005
011400*EXCEPTION MESSAGE RECORD LAYOUT                                 *01420005
011500******************************************************************01430005
011600 01  EXCEPTION-MESSAGE-LINE.                                      01440005
011700     05 EXC-MSG-COMMENT          PIC X(40)      VALUE SPACES.     01450005
011800     05 EXC-MSG-REC-NMBR         PIC ZZZZZZ9-   VALUE ZEROES.     01460005
011900     05 EXC-MSG-RECORD           PIC X(60)      VALUE SPACES.     01470005
012000                                                                  01480005
012100******************************************************************01490005
012200*  INPUT BIN FILE RECORD LAYOUT                                  *01500005
012300******************************************************************01510005
000400 01  PV-INP-BIN-FILE-RCD.                                         01524005
000500     05  PV-INP-BIN-LOW-NO      PIC X(19).                        01525005
000600     05  PV-INP-BIN-HIGH-NO     PIC X(19).                        01526005
000700     05  PV-INP-BIN-CARD-LENGTH PIC 9(02) VALUE ZERO.             01527005
000800     05  PV-INP-BIN-LENGTH      PIC 9(02) VALUE ZERO.             01528005
000900     05  PV-INP-BIN-BIN-NO      PIC X(19).                        01529005
001000     05  PV-INP-BIN-ICA-NO      PIC 9(06) VALUE ZERO.             01529105
001100     05  PV-INP-BIN-COUNTRY     PIC X(06) VALUE SPACES.           01529205
001200     05  PV-INP-BIN-TYPE        PIC X.                            01529305
001300     05  FILLER                 PIC X(05) VALUE SPACES.           01529405
001400     05  PV-INP-END-CHAR        PIC X(01) VALUE 'E'.              01529505
012500                                                                  01530005
012100******************************************************************01540005
012200*  SAVE BIN FILE RECORD LAYOUT                                  * 01550005
012300******************************************************************01560005
000400 01  PV-SAVE-BIN-FILE-RCD.                                        01570005
000500     05  PV-SAVE-BIN-LOW-NO      PIC X(19).                       01571005
000600     05  PV-SAVE-BIN-HIGH-NO     PIC X(19).                       01572005
000700     05  PV-SAVE-BIN-CARD-LENGTH PIC 9(02) VALUE ZERO.            01573005
000800     05  PV-SAVE-BIN-LENGTH      PIC 9(02) VALUE ZERO.            01574005
000900     05  PV-SAVE-BIN-BIN-NO      PIC X(19).                       01575005
001000     05  PV-SAVE-BIN-ICA-NO      PIC 9(06) VALUE ZERO.            01576005
001100     05  PV-SAVE-BIN-COUNTRY     PIC X(06) VALUE SPACES.          01577005
001200     05  PV-SAVE-BIN-TYPE        PIC X.                           01578005
001300     05  FILLER                 PIC X(05) VALUE SPACES.           01579005
001400     05  PV-SAVE-END-CHAR        PIC X(01) VALUE 'E'.             01579105
012500                                                                  01580005
013100******************************************************************01690005
013200 PROCEDURE DIVISION.                                              01700005
013300******************************************************************01710005
013400* 1000-MAINLINE-PROCESSING                                       *01720005
013500*    CONTROLS FLOW OF THE PROGRAM                                *01730005
013600******************************************************************01740005
013700 1000-MAINLINE-PROCESSING.                                        01750005
013800                                                                  01760005
013900     PERFORM 2000-INITIALIZE.                                     01770005
014000                                                                  01780005
014100     PERFORM 3000-PROCESS-INPUT-BIN-FILE                          01790005
014200         UNTIL PS-INPUT-BIN-EOF.                                  01800005
014300                                                                  01810005
014400     PERFORM 6000-END-OF-JOB-ROUTINE.                             01870005
014500                                                                  01880005
014600     GOBACK.                                                      01890005
014700 EJECT                                                            01900005
014800                                                                  01910005
014900******************************************************************01920005
015000* 2000-INITIALIZE                                                *01930005
015100* OPEN ALL FILES.                                                *01940005
015200* READ THE FIRST RECORD IN THE INPUT BIN FILE AND VERIFY THAT IT *01950005
015300* IS A FILE HEADER RECORD.                                       *01960005
015400******************************************************************01970005
015500 2000-INITIALIZE.                                                 01980005
015600                                                                  01990005
015700     OPEN INPUT INPUT-BIN-FILE                                    02000005
015800         OUTPUT AJB-BIN-FILE.                                     02010005
015900                                                                  02020005
016000     DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME              02030005
016100     DISPLAY ' '.                                                 02040005
016200                                                                  02050005
016300     PERFORM 7000-READ-INPUT-BIN-FILE.                            02080005
           MOVE PV-INP-BIN-FILE-RCD TO PV-SAVE-BIN-FILE-RCD.            02080224
029910     PERFORM 9000-WRITE-AJB-BIN-FILE.                             02081005
016300     PERFORM 7000-READ-INPUT-BIN-FILE.                            02082005
016400                                                                  02090005
016500     IF PS-INPUT-BIN-EOF                                          02100005
016600         DISPLAY ' '                                              02110005
016700         DISPLAY 'INPUT BIN FILE IS EMPTY'                        02120005
016800         DISPLAY ' '                                              02130005
017700     END-IF.                                                      02240005
017800                                                                  02250005
014900******************************************************************02260005
014100*  PROCESS THE INPUT BIN FILE                                     02261007
017800*  - HERE ANY OVERLAPPING RANGES WILL BE REMOVED.                 02262011
017800*                                                                 02263011
017800*    FOR EXAMPLE, IF THE RECORDS ARE:                             02264011
017800*    0076720616400808000000EXPL                                   02265011
017800*    0181510816400808000000MAC3                                   02266011
017800*    0076730816400808010000EXPL                                   02267011
017800*    0181520816400808020000MAC3                                   02268011
017800*                                                                 02269011
017800*    THE WAY TO READ THESE:                                       02270011
017800*    SEQ#  BIN LEN ACCT LEN  BIN          NETWORK                 02271011
017800*    007672   06    16       400808000000 EXPL                    02272011
017800*    018151   08    16       400808000000 MAC3                    02273011
017800*    007673   08    16       400808010000 EXPL                    02274011
017800*    018152   08    16       400808020000 MAC3                    02275011
017800*                                                                 02275111
017800*                                                                 02275211
017800*    THE FIRST RECORD SAYS ANY 16 DIGIT ACCOUNT STARTING          02275311
017800*    WITH A 6 DIGIT BIN OF 400808 IS A RANGE.                     02275411
017800*    THE SECOND RECORD SAYS ANY 16 DIGIT ACCOUNT STARTING         02275511
017800*    WITH A 8 DIGIT BIN OF 40080800 IS A RANGE.                   02275611
017800*    THE THIRD RECORD SAYS ANY 16 DIGIT ACCOUNT STARTING          02275711
017800*    WITH A 8 DIGIT BIN OF 40080801 IS A RANGE.                   02275811
017800*                                                                 02275911
017800*    THE FIRST RECORD INCLUDES THE NEXT 3 SO THOSE SHOULD         02276011
017800*    BE REMOVED, LEAVING ONLY THE FIRST ONE.                      02276111
017800*                                                                 02276211
017800*    THEY SHOULD BE EDITED DOWN TO THIS:                          02277011
017800*    0076720616400808000000EXPL                                   02278011
017800*                                                                 02279011
015400******************************************************************02280005
014100 3000-PROCESS-INPUT-BIN-FILE.                                     02291007
                                                                        02300005
029830     IF PV-SAVE-BIN-BIN-NO (1:PV-SAVE-BIN-LENGTH) =               02716022
029830        PV-INP-BIN-BIN-NO (1:PV-SAVE-BIN-LENGTH)                  02717022
030900           IF PV-SAVE-BIN-TYPE = PV-INP-BIN-TYPE                  02719029
031100              CONTINUE                                            02720029
031300           ELSE                                                   02721029
                    ADD 1 TO PA-ERROR-FILE                              02722029
031500              MOVE 'INPUT FILE IS INVALID'                        02724029
032000                                      TO EXC-MSG-COMMENT          02725029
032000              MOVE PV-INP-BIN-FILE-RCD TO EXC-MSG-RECORD          02726029
032000              DISPLAY EXCEPTION-MESSAGE-LINE                      02727029
029900           END-IF                                                 02729329
           ELSE                                                         02729722
029910        PERFORM 9000-WRITE-AJB-BIN-FILE                           02729822
029900     END-IF.                                                      02729922
035700                                                                  02730024
016300     PERFORM 7000-READ-INPUT-BIN-FILE.                            02740008
035700                                                                  06640005
035000******************************************************************06650005
035100* 6000-END-OF-JOB-ROUTINE                                        *06660005
035200******************************************************************06670005
035300 6000-END-OF-JOB-ROUTINE.                                         06680005
035400                                                                  06690005
035500     CLOSE INPUT-BIN-FILE                                         06700007
035600           AJB-BIN-FILE.                                          06710007
035700                                                                  06720005
035800     DISPLAY ' '.                                                 06730005
035900     DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME.             06740005
036000     DISPLAY 'NUMBER OF INPUT BIN RECORDS READ:            '      06750005
036100             PA-BIN-RCDS-READ.                                    06760005
036200     DISPLAY 'NUMBER OF AJB BIN RECORDS WRITTEN:          '       06830005
036300             PA-RECORDS-WRITTEN.                                  06840005
           DISPLAY 'NUMBER OF ERROR RECORDS:' PA-ERROR-FILE.            06841028
036400     DISPLAY ' '.                                                 06850005
036500                                                                  06860005
036600******************************************************************06870005
036700* 7000-READ-INPUT-BIN-FILE                                       *06880005
036800******************************************************************06890005
036900 7000-READ-INPUT-BIN-FILE.                                        06900005
037000                                                                  06910005
037100     READ INPUT-BIN-FILE INTO PV-INP-BIN-FILE-RCD                 06920005
037200         AT END                                                   06930005
037300             SET PS-INPUT-BIN-EOF TO TRUE                         06940005
037400     END-READ.                                                    06950005
037500                                                                  06960005
037600     IF NOT PS-INPUT-BIN-EOF                                      06970005
037700         ADD +1 TO PA-BIN-RCDS-READ                               06980005
037800     END-IF.                                                      06990005
037900                                                                  07000005
038000******************************************************************07150005
038100* 9000-WRITE-AJB-BIN-FILE                                        *07160005
038200******************************************************************07170005
038300 9000-WRITE-AJB-BIN-FILE.                                         07180005
038400                                                                  07190005
038500     WRITE AJB-BIN-RECORD FROM PV-INP-BIN-FILE-RCD.               07200009
                                                                        07201009
           MOVE PV-INP-BIN-FILE-RCD TO PV-SAVE-BIN-FILE-RCD             07202019
038600     ADD +1 TO PA-RECORDS-WRITTEN.                                07210005
038700                                                                  07220005
038800******************************************************************07230005
038900* 9999-ABEND.                                                    *07240005
039000******************************************************************07250005
039100 9999-ABEND.                                                      07260005
039200                                                                  07270005
039300     DISPLAY '** ABEND        **'.                                07280005
039400     DISPLAY '** PROGRAM      ** = ' PC-PROGRAM-NAME.             07290005
039500     DISPLAY '** PARAGRAPH    ** = ' PV-PARAGRAPH-NAME.           07300005
039600                                                                  07310005
039700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07320005
039800                                                                  07330005
