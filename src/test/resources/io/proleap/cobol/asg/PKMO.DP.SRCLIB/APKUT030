000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.     APKUT030.                                        00020001
000300 AUTHOR.         NANCY EILBES                                     00030001
000400*DATE-WRITTEN.   MARCH 2001.                                      00040001
000500*DATE-COMPILED.                                                   00050001
000600*************************************************************     00060001
000700*    COBOL 2  WITH SQL                                      *     00070001
000800*                                                           *     00080001
000900*    CALCULATE DUE DATES FOR UNJOURNALIZED RECEIPTS         *     00090007
001000*                                                           *     00100001
001100*    THE PURPOSE OF THIS PROGRAM IS TO CALCULATE A DUE DATE *     00110001
001200*    AND AN OPEN TO PAY DATE FOR EACH UNJOURNALIZED RECEIPT *     00120005
001300*    RECORD BASED ON THE DATE OF RECEIPT.  THESE DATES WILL *     00130001
001400*    THEN BE USED TO SUMMARIZE THE COSTS BY DATE AND REPORT *     00140001
001500*    AN AGING OF THE RECEIPT DOLLARS BASED ON WHEN THEY ARE *     00150005
001600*    ESTIMATED TO BE DUE.                                   *     00160001
001700*                                                           *     00170001
001800*************************************************************     00180001
001900*                                                           *     00190001
002000*    TPAYTRM - PAYMENT TERMS TABLE                          *     00200001
002100*    TPOAGMT - PURCHASE ORDER AGREEMENT TABLE               *     00210001
002200*                                                           *     00220001
002300* INPUT:                                                    *     00230001
002400* 1.  UNJRNLD-EXTRACT-FILE               (APRD042)          *     00240007
002500*                                                           *     00250001
002600* OUTPUT                                                    *     00260001
002700* 1.  AGED-UNJRNLD-FILE                  (APRD003)          *     00270007
002800*                                                           *     00280001
002900*************************************************************     00290001
003000* CHANGE LOG:                                               *     00300001
003100*                                                           *     00310007
003200* 02/06/2003                                                *     00320007
003300*    CHANGE MADE: ARKPO PHASE3 PROJECT.                     *     00330007
003400*    UPDATED THE PROGRAM TITLE TO MATCH THE SPEC TITLE.     *     00340007
003500*    UPDATED PGM COMMENT BLOCK WITH THE FILENAMES. INCREASED*     00350007
003600*    THE SIZE OF W/S PO FIELDS FROM 7 TO 9 BYTES.           *     00360007
003700* MADE BY:  MIKE BESKE                          WR#: 23500  *     00370007
003800*                                                           *     00380008
003900* 05/21/2004  CHANGED MADE: STORE CONSTRAINTS PROJECT       *     00390008
004000*             RECOMPILED THIS PROGRAM TO PICK UP THE APRD042*     00400008
004100*             COPYBOOK MODIFICATIONS.                       *     00410008
004200*             MADE BY: MIKE BESKE             WR/IR #:25805 *     00420008
003800*                                                           *     00431009
003900* 09/07/2021  CHANGED MADE: RECOMPILE FOR APRD042           *     00432009
004200*             MADE BY: JEAN KURK              CHG0260549    *     00435009
004400*************************************************************     00440001
004500                                                                  00450001
004600 ENVIRONMENT DIVISION.                                            00460001
004700                                                                  00470001
004800 INPUT-OUTPUT SECTION.                                            00480001
004900                                                                  00490001
005000 FILE-CONTROL.                                                    00500001
005100                                                                  00510001
005200     SELECT UNJRNLD-EXTRACT-FILE ASSIGN TO UT-S-INP01.            00520005
005300                                                                  00530001
005400     SELECT AGED-UNJRNLD-FILE ASSIGN TO OUT01.                    00540005
005500                                                                  00550001
005600 DATA DIVISION.                                                   00560001
005700                                                                  00570001
005800 FILE SECTION.                                                    00580001
005900                                                                  00590001
006000 FD  UNJRNLD-EXTRACT-FILE                                         00600005
006100     LABEL RECORDS  ARE STANDARD                                  00610001
006200     RECORDING MODE IS  F                                         00620001
006300     DATA RECORD    IS  UNJRNLD-EXTRACT-RECORD.                   00630005
006400                                                                  00640001
006500 01  UNJRNLD-EXTRACT-RECORD        PIC X(120).                    00650005
006600                                                                  00660001
006700 FD  AGED-UNJRNLD-FILE                                            00670005
006800     RECORDING MODE IS F                                          00680001
006900     LABEL RECORDS ARE STANDARD                                   00690001
007000     BLOCK CONTAINS 0 RECORDS                                     00700001
007100     DATA RECORD IS AGED-UNJRNLD-RECORD.                          00710005
007200                                                                  00720001
007300 01  AGED-UNJRNLD-RECORD         PIC X(135).                      00730005
007400                                                                  00740001
007500                                                                  00750001
007600/                                                                 00760001
007700 WORKING-STORAGE SECTION.                                         00770001
007800                                                                  00780001
007900 01  FILLER                        PIC X(25) VALUE                00790001
008000                             'WS FOR APKUT030 BEGINS==>'.         00800001
008100 01  ABEND-CODE                    PIC S9(4) COMP SYNC            00810001
008200                                             VALUE ZEROS.         00820001
008300     88 AP-EMPTY-FILE              VALUE +4005.                   00830001
008400     88 AP-DB2-ERROR               VALUE +4013.                   00840001
008500     88 AC-DATE-ERROR              VALUE +4019.                   00850003
008600                                                                  00860001
008700                                                                  00870001
008800                                                                  00880001
008900 01  PV-ABEND-FILEDS.                                             00890001
009000     05  PV-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUT030'. 00900001
009100     05  PV-ABEND-SQLCODE             PIC X(4)  VALUE SPACES.     00910001
009200     05  PV-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     00920001
009300     05  PV-ABEND-OPERATION           PIC X(50) VALUE SPACES.     00930001
009400     05  PV-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     00940001
009500     05  PV-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     00950001
009600     05  PV-ABEND-STATUS              PIC XX    VALUE SPACES.     00960001
009700     05  PV-ABEND-MESSAGE-1           PIC X(127) VALUE SPACES.    00970004
009800     05  PV-ABEND-MESSAGE-2           PIC X(127) VALUE SPACES.    00980004
009900                                                                  00990001
010000 01  PV-PROGRAM-VARIABLES.                                        01000002
010100     05  PV-SAVE-REC-DATE             PIC X(10) VALUE SPACES.     01010005
010200     05  PV-SAVE-DUE-DATE             PIC X(10) VALUE SPACES.     01020005
010300     05  PV-SAVE-OTP-DATE             PIC X(10) VALUE SPACES.     01030005
010400     05  PV-PO-BEING-PROCESSED        PIC X(9).                   01040007
010500     05  PV-NUMERIC-PO REDEFINES PV-PO-BEING-PROCESSED            01050002
010600                                      PIC 9(9).                   01060007
010700     05  PV-SELECT-PO                 PIC S9(9) COMP.             01070005
010800     05  PV-DISC-EXTENDED-DAYS        PIC S9(4) COMP.             01080005
010900*                                                                 01090001
011000 01  PV-PROGRAM-COUNTERS.                                         01100001
011100     05  PV-INPUT-COUNT               PIC 9(9)  VALUE ZEROS.      01110005
011200     05  PV-AGED-UNJRNLD-REC-CNT      PIC 9(9) VALUE ZEROS.       01120005
011300                                                                  01130001
011400 01  PV-SWITCHES.                                                 01140001
011500     05  END-OF-FILE-SW               PIC X(01) VALUE 'N'.        01150005
011600         88  END-OF-FILE                        VALUE 'Y'.        01160005
011700                                                                  01170001
011800*----------------------------------------------------------------*01180001
011900*  UNJOURNALIZED EXTRACT COPYBOOK                                *01190005
012000*----------------------------------------------------------------*01200001
012100     COPY APRD042.                                                01210001
012200                                                                  01220001
012300*----------------------------------------------------------------*01230001
012400*  UNJOURNALIZED AGED COPYBOOK                                   *01240005
012500*----------------------------------------------------------------*01250001
012600     COPY APRD003.                                                01260001
012700                                                                  01270001
012800     COPY DPWS004.                                                01280001
012900                                                                  01290001
013000*----------------------------------------------------------------*01300001
013100*  WORKING STORAGE AREA FOR PROCEDURE DIVISION COPYBOOK APPD051  *01310001
013200*----------------------------------------------------------------*01320001
013300     COPY APWS051.                                                01330001
013400                                                                  01340001
013500*----------------------------------------------------------------*01350001
013600*  WORKING STORAGE AREA FOR DPKUT500, DATE MANIPULATION ROUTINE  *01360001
013700*----------------------------------------------------------------*01370001
013800     COPY DPWS500.                                                01380001
013900                                                                  01390001
014000******************************************************************01400001
014100*  COMMUNICATIONS AREA2 FOR DB2                                   01410001
014200******************************************************************01420001
014300     COPY SQLCA2.                                                 01430001
014400                                                                  01440001
014500     EXEC SQL                                                     01450001
014600          INCLUDE SQLCA                                           01460001
014700     END-EXEC.                                                    01470001
014800                                                                  01480001
014900     EXEC SQL                                                     01490001
015000          INCLUDE TPAYTRM                                         01500001
015100     END-EXEC.                                                    01510001
015200                                                                  01520001
015300     EXEC SQL                                                     01530001
015400          INCLUDE TPOAGMT                                         01540001
015500     END-EXEC.                                                    01550001
015600                                                                  01560001
015700                                                                  01570001
015800 PROCEDURE DIVISION.                                              01580001
015900                                                                  01590001
016000 A100-MAINLINE.                                                   01600001
016100                                                                  01610001
016200     PERFORM B100-INITIALIZATION.                                 01620001
016300                                                                  01630001
016400     PERFORM B200-PROCESSING                                      01640001
016500        UNTIL END-OF-FILE.                                        01650001
016600                                                                  01660001
016700     PERFORM B300-END-OF-JOB.                                     01670001
016800                                                                  01680001
016900     GOBACK.                                                      01690001
017000        EJECT                                                     01700001
017100*---------------------------------------------------------------* 01710005
017200*    OPEN FILES AND PERFORM INITIAL READ                          01720005
017300*                                                                 01730001
017400*---------------------------------------------------------------* 01740005
017500 B100-INITIALIZATION.                                             01750005
017600                                                                  01760005
017700     OPEN  INPUT UNJRNLD-EXTRACT-FILE                             01770005
017800          OUTPUT AGED-UNJRNLD-FILE.                               01780005
017900                                                                  01790001
018000     PERFORM R100-READ-UNJRNLD-EXTRACT.                           01800005
018100                                                                  01810001
018200     INITIALIZE DCLTPAYTRM                                        01820006
018300                DCLTPOAGMT                                        01830002
018400                PV-PO-BEING-PROCESSED                             01840002
018500                PV-SELECT-PO                                      01850002
018600                PV-SAVE-REC-DATE.                                 01860002
018700                                                                  01870001
018800                                                                  01880001
018900*---------------------------------------------------------------* 01890002
019000*  PROCESS UNJOURNALIZED RECORDS AND CALCULATE DUE DATE AND     * 01900005
019100*  OTP DATES BASED ON THE RECEIVING DATE.                       * 01910005
019200*---------------------------------------------------------------* 01920002
019300 B200-PROCESSING.                                                 01930002
019400                                                                  01940002
019500     IF  AP042-PO-NBR = PV-PO-BEING-PROCESSED                     01950002
019600         IF  AP042-REC-DTE = PV-SAVE-REC-DATE                     01960003
019700             PERFORM C100-CREATE-AGED-RECORD                      01970002
019800         ELSE                                                     01980002
019900             MOVE AP042-REC-DTE TO PV-SAVE-REC-DATE               01990003
020000             PERFORM C200-CALCULATE-DUE-DATE                      02000002
020100             PERFORM C300-CALCULATE-OTP-DATE                      02010002
020200             PERFORM C100-CREATE-AGED-RECORD                      02020002
020300         END-IF                                                   02030002
020400     ELSE                                                         02040002
020500        MOVE AP042-PO-NBR  TO PV-PO-BEING-PROCESSED               02050002
020600        MOVE PV-NUMERIC-PO TO PV-SELECT-PO                        02060002
020700        PERFORM S100-SELECT-PO-TERMS                              02070002
020800        PERFORM C200-CALCULATE-DUE-DATE                           02080002
020900        PERFORM C300-CALCULATE-OTP-DATE                           02090002
021000        PERFORM C100-CREATE-AGED-RECORD                           02100002
021100     END-IF.                                                      02110002
021200                                                                  02120002
021300     PERFORM R100-READ-UNJRNLD-EXTRACT.                           02130005
021400 EJECT                                                            02140002
021500 B300-END-OF-JOB.                                                 02150002
021600                                                                  02160002
021700     DISPLAY '*----------------------------------------------*'.  02170002
021800     DISPLAY 'PROGRAM APKUT030 RECORD COUNTS '                    02180002
021900     DISPLAY 'TOTAL UNJOURNALIZED RECORDS READ    = '             02190005
022000              PV-INPUT-COUNT                                      02200002
022100     DISPLAY 'TOTAL AGED UNJOURNALIZED RECORDS  = '               02210005
022200              PV-AGED-UNJRNLD-REC-CNT                             02220005
022300     DISPLAY '*----------------------------------------------*'.  02230002
022400                                                                  02240002
022500     CLOSE UNJRNLD-EXTRACT-FILE                                   02250005
022600           AGED-UNJRNLD-FILE.                                     02260005
022700                                                                  02270002
022800*---------------------------------------------------------------* 02280002
022900*     POPULATE THE APRD003 FIELDS AND WRITE OUT THE RECORD.     * 02290002
023000*---------------------------------------------------------------* 02300002
023100 C100-CREATE-AGED-RECORD.                                         02310002
023200                                                                  02320002
023300     MOVE AP042-VND-NBR             TO AP003-VND-NBR.             02330003
023400     MOVE AP042-ENT-NM-DESC         TO AP003-ENT-NM-DESC.         02340003
023500     MOVE AP042-PO-NBR              TO AP003-PO-NBR.              02350003
023600     MOVE AP042-REC-SEQ-NBR         TO AP003-REC-SEQ-NBR.         02360003
023700     MOVE AP042-REC-DTE             TO AP003-REC-DTE.             02370003
023800     MOVE AP042-VRFD-DTE            TO AP003-VRFD-DTE.            02380003
023900     MOVE AP042-CALCD-VRFD-RTL-AMT  TO AP003-RTL-AMT.             02390003
024000     MOVE AP042-CALCD-VRFD-COST-AMT TO AP003-COST-AMT.            02400003
024100     MOVE APPD051-DISCOUNT-DAYS     TO AP003-DUE-DAYS.            02410003
024200     MOVE APPD051-EXTENDED-DAYS     TO AP003-EXTENDED-DAYS.       02420003
024300     MOVE APPD051-EOM-IND           TO AP003-EOM-IND.             02430003
024400     MOVE PV-SAVE-DUE-DATE          TO AP003-CALC-DUE-DTE.        02440003
024500     MOVE PV-SAVE-OTP-DATE          TO AP003-CALC-OTP-DTE.        02450003
024600                                                                  02460002
024700     PERFORM W100-WRITE-AGED-UNJRNLD.                             02470005
024800                                                                  02480001
024900*---------------------------------------------------------------* 02490002
025000*     USE THE PO TERMS AND THE RECEIVING DATE TO CALCULATE THE  * 02500005
025100*     ESTIMATED PAYMENT DUE DATE USING THE ROUTINE IN COPYBOOK  * 02510005
025200*     APPD051.                                                  * 02520005
025300*---------------------------------------------------------------* 02530002
025400 C200-CALCULATE-DUE-DATE.                                         02540002
025500                                                                  02550001
025600     MOVE AP042-REC-DTE TO APPD051-INVOICE-DATE.                  02560002
025700     MOVE ZEROS         TO APPD051-FLOAT-DAYS.                    02570002
025800                                                                  02580001
025900     IF  PAYTRM-DUE-DAY-FR-DTE-TXT = 'EOM'                        02590002
026000         MOVE 'Y' TO APPD051-EOM-IND                              02600002
026100     ELSE                                                         02610002
026200         MOVE 'N' TO APPD051-EOM-IND                              02620002
026300     END-IF.                                                      02630002
026400                                                                  02640002
026500     IF  PAYTRM-DISCOUNT-PCT = 0                                  02650002
026600         MOVE PAYTRM-DUE-DAY-QTY TO APPD051-DISCOUNT-DAYS         02660002
026700     ELSE                                                         02670002
026800         MOVE PAYTRM-DISCOUNT-DAYS-QTY TO APPD051-DISCOUNT-DAYS   02680002
026900     END-IF.                                                      02690002
027000                                                                  02700002
027100     MOVE POAGMT-DISC-PAY-DAY-QTY TO APPD051-EXTENDED-DAYS.       02710002
027200                                                                  02720002
027300                                                                  02730002
027400     PERFORM CALC-PAYMENT-DUE-DATE.                               02740002
027500                                                                  02750001
027600     MOVE APPD051-RETURN-DATE-CCYY-MM-DD   TO PV-SAVE-DUE-DATE.   02760002
027700                                                                  02770001
027800     COPY APPD051.                                                02780001
027900                                                                  02790001
028000*---------------------------------------------------------------* 02800002
028100*  USING THE DUE DATE CALCULATED ABOVE, DETERMINE THE DAY OF    * 02810002
028200*  WEEK AND ADD THE APPROPRIATE NUMBER OF DAYS TO CONVERT THE   * 02820002
028300*  DUE DATE TO THE OTP DATE (I.E. PAY CYCLE DAY - WEDNESDAY)    * 02830002
028400*---------------------------------------------------------------* 02840002
028500 C300-CALCULATE-OTP-DATE.                                         02850002
028600                                                                  02860002
028700     INITIALIZE DPG51                                             02870002
028800                DPG52                                             02880002
028900                DPG53                                             02890002
029000                DPG54                                             02900002
029100                DPG55                                             02910002
029200                DPG56.                                            02920002
029300                                                                  02930002
029400     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     02940002
029500     MOVE PV-SAVE-DUE-DATE           TO DPG52-LK-DATE-INPUT.      02950002
029600                                                                  02960002
029700     PERFORM Z900-CALL-CALENDAR-ROUTINE.                          02970002
029800                                                                  02980002
029900     EVALUATE TRUE                                                02990002
030000         WHEN DPG55-NUMERIC-WEEK-DAY-SUN                          03000002
030100             MOVE 3                   TO DPG51-INCR-DECR-DAYS-9   03010002
030200             SET DPG51-INCREMENT-DATE TO TRUE                     03020002
030300         WHEN DPG55-NUMERIC-WEEK-DAY-MON                          03030002
030400             MOVE 2                   TO DPG51-INCR-DECR-DAYS-9   03040002
030500             SET DPG51-INCREMENT-DATE TO TRUE                     03050002
030600         WHEN DPG55-NUMERIC-WEEK-DAY-TUE                          03060002
030700             MOVE 1                   TO DPG51-INCR-DECR-DAYS-9   03070002
030800             SET DPG51-INCREMENT-DATE TO TRUE                     03080002
030900         WHEN DPG55-NUMERIC-WEEK-DAY-WED                          03090002
031000             MOVE 0                   TO DPG51-INCR-DECR-DAYS-9   03100002
031100             SET DPG51-INCREMENT-DATE TO TRUE                     03110002
031200         WHEN DPG55-NUMERIC-WEEK-DAY-THU                          03120002
031300             MOVE 6                   TO DPG51-INCR-DECR-DAYS-9   03130002
031400             SET DPG51-INCREMENT-DATE TO TRUE                     03140002
031500         WHEN DPG55-NUMERIC-WEEK-DAY-FRI                          03150002
031600             MOVE 5                   TO DPG51-INCR-DECR-DAYS-9   03160002
031700             SET DPG51-INCREMENT-DATE TO TRUE                     03170002
031800         WHEN DPG55-NUMERIC-WEEK-DAY-SAT                          03180002
031900             MOVE 4                   TO DPG51-INCR-DECR-DAYS-9   03190002
032000             SET DPG51-INCREMENT-DATE TO TRUE                     03200002
032100     END-EVALUATE.                                                03210002
032200                                                                  03220002
032300     IF DPG51-INCR-DECR-DAYS-9 > 0                                03230002
032400         SET DPG52-LK-DTE-ISO-FMT     TO TRUE                     03240002
032500         MOVE PV-SAVE-DUE-DATE        TO DPG52-LK-DATE-INPUT      03250002
032600         PERFORM Z900-CALL-CALENDAR-ROUTINE                       03260002
032700         MOVE DPG55-DB2-ISO-DATE-FMT  TO PV-SAVE-OTP-DATE         03270002
032800     ELSE                                                         03280002
032900         MOVE PV-SAVE-DUE-DATE        TO PV-SAVE-OTP-DATE         03290002
033000     END-IF.                                                      03300002
033100                                                                  03310002
033200*---------------------------------------------------------------* 03320005
033300*     READ THE UNJOURNALIZED EXTRACT FILE                       * 03330005
033400*---------------------------------------------------------------* 03340005
033500 R100-READ-UNJRNLD-EXTRACT.                                       03350005
033600                                                                  03360005
033700     IF NOT END-OF-FILE                                           03370001
033800        READ UNJRNLD-EXTRACT-FILE INTO AP042-EXTRACT-FILE         03380005
033900          AT END  SET END-OF-FILE TO TRUE.                        03390002
034000                                                                  03400001
034100     IF NOT END-OF-FILE                                           03410001
034200        ADD 1 TO PV-INPUT-COUNT.                                  03420001
034300                                                                  03430001
034400*---------------------------------------------------------------* 03440005
034500*  PERFORM SQL TO SELECT THE PO PAYMENT TERMS.                  * 03450005
034600*---------------------------------------------------------------* 03460005
034700 S100-SELECT-PO-TERMS.                                            03470001
034800                                                                  03480001
034900     EXEC SQL                                                     03490001
035000         SELECT                                                   03500001
035100             PA.DISC_PAY_DAY_QTY                                  03510001
035200            ,PT.DISCOUNT_PCT                                      03520001
035300            ,PT.DUE_DAY_QTY                                       03530001
035400            ,PT.DISCOUNT_DAYS_QTY                                 03540001
035500            ,PT.DUE_DAY_FR_DTE_TXT                                03550001
035600         INTO                                                     03560001
035700             :POAGMT-DISC-PAY-DAY-QTY                             03570001
035800            ,:PAYTRM-DISCOUNT-PCT                                 03580001
035900            ,:PAYTRM-DUE-DAY-QTY                                  03590001
036000            ,:PAYTRM-DISCOUNT-DAYS-QTY                            03600001
036100            ,:PAYTRM-DUE-DAY-FR-DTE-TXT                           03610001
036200         FROM                                                     03620001
036300             TPOAGMT PA,                                          03630001
036400             TPAYTRM PT                                           03640001
036500         WHERE PA.PO_NBR         = :PV-SELECT-PO                  03650002
036600           AND PA.PAYT_TERM_ID   = PT.PAY_TERM_ID                 03660001
036700           AND PA.AGRMT_TYP_ID   = '2'                            03670001
036800           AND PA.VER_STATUS_CDE = 'A'                            03680001
036900     END-EXEC.                                                    03690001
037000                                                                  03700001
037100     EVALUATE TRUE                                                03710001
037200         WHEN SQLCODE = ZERO                                      03720001
037300              CONTINUE                                            03730001
037400                                                                  03740001
037500         WHEN SQLWARN0 NOT = SPACES                               03750001
037600         WHEN SQLCODE  NOT = ZERO                                 03760001
037700             MOVE 'S100-SELECT-PO-TERMS' TO PV-ABEND-PARAGRAPH    03770003
037800             MOVE 'UNSUCCESSFUL SELECT'  TO PV-ABEND-OPERATION    03780003
037900             MOVE 'TPOAGMT'              TO PV-ABEND-STRUCTURE-1  03790003
038000             MOVE 'TPAYTRM'              TO PV-ABEND-STRUCTURE-2  03800003
038100             PERFORM Z998-DB2-ABEND                               03810001
038200     END-EVALUATE.                                                03820001
038300                                                                  03830001
038400     EXEC SQL                                                     03840001
038500         SELECT  PA.DISC_PAY_DAY_QTY                              03850001
038600           INTO :PV-DISC-EXTENDED-DAYS                            03860001
038700           FROM  TPOAGMT PA                                       03870001
038800          WHERE  PA.PO_NBR         = :PV-SELECT-PO                03880003
038900             AND  PA.VER_STATUS_CDE = 'A'                         03890003
039000            AND  PA.AGRMT_TYP_ID   = '5'                          03900001
039100            AND  PA.TYP_CDE        =  1                           03910001
039200     END-EXEC.                                                    03920001
039300                                                                  03930001
039400     EVALUATE TRUE                                                03940001
039500         WHEN SQLCODE = ZERO                                      03950001
039600              ADD PV-DISC-EXTENDED-DAYS TO POAGMT-DISC-PAY-DAY-QTY03960001
039700         WHEN SQLCODE = +100                                      03970001
039800              CONTINUE                                            03980001
039900         WHEN SQLWARN0 NOT = SPACES                               03990001
040000         WHEN SQLCODE  NOT = ZERO                                 04000001
040100             MOVE 'S100-SELECT-PO-TERMS' TO PV-ABEND-PARAGRAPH    04010003
040200             MOVE 'UNSUCCESSFUL SELECT'  TO PV-ABEND-OPERATION    04020003
040300             MOVE 'TPOAGMT'              TO PV-ABEND-STRUCTURE-1  04030003
040400             MOVE SPACES                 TO PV-ABEND-STRUCTURE-2  04040003
040500             PERFORM Z998-DB2-ABEND                               04050001
040600     END-EVALUATE.                                                04060001
040700 EJECT                                                            04070001
040800                                                                  04080001
040900*---------------------------------------------------------------* 04090006
041000*  WRITE THE UNJOUNRALIZED AGED RECORD TO THE OUTPUT FILE.      * 04100006
041100*---------------------------------------------------------------* 04110006
041200 W100-WRITE-AGED-UNJRNLD.                                         04120005
041300                                                                  04130001
041400     WRITE AGED-UNJRNLD-RECORD FROM AP003-UNJRNLD-DUEDATE-RECORD. 04140005
041500     ADD 1 TO PV-AGED-UNJRNLD-REC-CNT.                            04150005
041600                                                                  04160001
041700                                                                  04170001
041800                                                                  04180002
041900*---------------------------------------------------------------* 04190005
042000*    CALENDAR ROUTINE                                           * 04200005
042100*---------------------------------------------------------------* 04210005
042200 Z900-CALL-CALENDAR-ROUTINE.                                      04220002
042300                                                                  04230002
042400     SET DPG51-FISCAL-454-CALENDAR     TO TRUE.                   04240002
042500                                                                  04250002
042600     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    04260002
042700                                             DPG54 DPG55 DPG56.   04270002
042800                                                                  04280002
042900     IF DPG54-SEVERE-ERROR OR DPG54-WARNING-ERROR                 04290002
043000         MOVE 'Z900-CALL-CALENDAR-ROUTINE'                        04300002
043100                                       TO PV-ABEND-PARAGRAPH      04310003
043200         MOVE DPG54-ERROR-MESSAGE      TO PV-ABEND-MESSAGE-1      04320003
043300         MOVE DPG52-DB2-ISO-DATE-FMT   TO PV-ABEND-MESSAGE-2      04330003
043400         SET AC-DATE-ERROR             TO TRUE                    04340002
043500         PERFORM Z999-ABEND                                       04350003
043600     END-IF.                                                      04360002
043700                                                                  04370002
043800                                                                  04380002
043900                                                                  04390001
044000*---------------------------------------------------------------* 04400005
044100*     PROCESS DB2 ABENDS                                        * 04410005
044200*---------------------------------------------------------------* 04420005
044300 Z998-DB2-ABEND.                                                  04430004
044400                                                                  04440001
044500     DISPLAY '*** DB2 ERROR '.                                    04450001
044600     DISPLAY '*** SQL CODE = '  PV-ABEND-SQLCODE.                 04460001
044700     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 04470001
044800     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               04480001
044900     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               04490001
045000     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             04500001
045100     IF PV-ABEND-STRUCTURE-2 > SPACES                             04510001
045200         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2.         04520001
045300                                                                  04530001
045400     COPY DPPD004.                                                04540001
045500                                                                  04550001
045600     MOVE +4013                    TO ABEND-CODE.                 04560001
045700                                                                  04570001
045800     CALL 'ILBOABN0' USING ABEND-CODE.                            04580001
045900                                                                  04590003
046000*----------------------------------------------------------------*04600003
046100*    GENERIC ABEND ROUTINE                                        04610003
046200*----------------------------------------------------------------*04620003
046300 Z999-ABEND.                                                      04630003
046400                                                                  04640003
046500     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 04650003
046600     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               04660003
046700     DISPLAY PV-ABEND-MESSAGE-1.                                  04670004
046800     DISPLAY PV-ABEND-MESSAGE-2.                                  04680004
046900                                                                  04690003
047000     CALL 'ILBOABN0' USING ABEND-CODE.                            04700003
047100                                                                  04710003
