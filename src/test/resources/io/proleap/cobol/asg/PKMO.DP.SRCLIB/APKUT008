000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT008.                                        00020000
000300 AUTHOR.         NANCY EILBES.                                    00030000
000400 DATE-WRITTEN.   01/30/2019.                                      00040000
000500 DATE-COMPILED.                                                   00050000
000600******************************************************************00060000
000700*    COBOL 2 WITH DB2                                            *00070000
000710* CONVERT AP LEGACY INTEGRATION FILE TO TEXT                     *00071000
000720*                                                                *00072000
000730* REFORMATS AP LEGACY TRANSACTIONS TO TEXT FORMAT TO PREPARE     *00073000
000740* FOR INTEGRATION TO ORACLE FUSION.                              *00074000
000750*                                                                *00075000
000760* FOR EACH RECORD ON THE INPUT FILE, EVERY FIELD THAT IS NEEDED  *00076000
000770* FOR THE ORACLE INVOICE IMPORT PROCESS IS MAPPED TO THE         *00077000
000780* APPROPRIATE FIELD ON THE OUTPUT RECORD.  PACKED DECIMAL FIELDS *00078000
000790* ARE CONVERTED TO TEXT REPRESENTATION WITH HARD DECIMAL POINTS. *00079000
000800* COMMENTS ARE CREATED FOR EACH DISCOUNT FIELD, AS EACH WILL     *00080000
000810* BECOME A SEPARATE MISC LINE ON THE INVOICE IN ORACLE.          *00081000
000820*                                                                *00082000
000830* INPUT:                                                         *00083000
000831*  1. LEGACY AP TRANSACTIONS                  COPYBOOK APRD040   *00083100
000832*                                                                *00083200
000833* OUTPUT:                                                        *00083300
000834*  1. ORACLE FUSION INTEGRATION FILE          COPYBOOK APRD010   *00083400
000835*  2. INTEGRATION COUNT EMAIL                                    *00083500
000836*----------------------------------------------------------------*00083600
000837* CHANGE LOG:                                                    *00083700
000838* DATE  03/27/2019                                               *00083800
000839*     CHANGE MADE: ERP PROJECT.  INITIAL VERSION.                *00083900
000840*     MADE BY: NANCY EILBES            WR/IR #: CHG0220043       *00084000
000850* DATE  05/29/2019                                               *00085000
000860*     CHANGE MADE: ERP PROJECT. POST SIT1 TESTING - ADDED LOGIC  *00086000
000870*     TO REPLACE INVALID CHARACTERS IN THE COMMENTS WITH VALID   *00087000
000880*     CHARACTERS - PARAGRAPH C200-REPLACE-INVALID-CHARS.         *00088000
000890*     MADE BY: NANCY EILBES            WR/IR #: CHG0223653       *00089000
000900* DATE  06/07/2019                                               *00090000
000910*     CHANGE MADE: ERP PROJECT. POST SIT2 TESTING - ADDED EMAIL  *00091000
000920*     OUTPUT FILE TO INFORM SUPPORT TEAM OF THE VOLUME OF        *00092000
000930*     INVOICES BEING INTEGRATED.                                 *00093000
000931*     MADE BY: NANCY EILBES            WR/IR #: CHG0225145       *00093100
000932* DATE  09/04/2019                                               *00093200
000933*     CHANGE MADE: ADDED LOGIC TO REPLACE QUOTATION MARKS FOUND  *00093300
000934*     IN THE COMMENT FIELD WITH SPACES.  THIS CHARACTER CAUSES   *00093400
000935*     ISSUES WITH THE ORACLE INTAGRATION.                        *00093500
000936*     MADE BY: NANCY EILBES            WR/IR #: CHG0230733       *00093600
000937* DATE  04/03/2020                                               *00093700
000938*     CHANGE MADE: ADDED LOGIC TO MOVE 'CD' TO THE NEW PAY GROUP *00093800
000939*     FIELD WHEN THE PO TYPE CODE IS CONSUMER DIRECT.  INCREASED *00093900
000940*     RECORD LENGTH ON TEXT FILE TO 422.                         *00094000
000950*     MADE BY: NANCY EILBES            WR/IR #: CHG0242385       *00095000
000960* DATE  09/10/2020                                               *00096000
000970*     CHANGE MADE: COMMENTED LOGIC THAT MOVES 'CD' TO PAY GROUP  *00097000
000980*     FIELD WHEN THE PO TYPE CODE IS CONSUMER DIRECT. THE USE OF *00098000
000990*     THIS PAY GROUP IS BEING SUSPENDED FOR HOLIDAY.             *00099000
000991*     MADE BY: NANCY EILBES            WR/IR #: CHG0248747       *00099100
000992* DATE  12/17/2020                                               *00099200
000993*     CHANGE MADE: ADDED LOGIC TO REPLACE ANY QUOTE MARKS X'7F'  *00099300
000994*     FOUND IN THE INVOICE NUMBER WITH A BLANK CHARACTER.  THE   *00099400
000995*     QUOTE CAUSED THE ERP INVOICE INTEGRATION TO FAIL.          *00099500
000996*     MADE BY: NANCY EILBES            WR/IR #: CHG0252108       *00099600
000997* DATE  05/25/2021                                               *00099701
000998*     CHANGE MADE: ADDED LOGIC TO REPLACE ANY LOW-VALUES X'00'   *00099801
000999*     FOUND IN THE INVOICE NUMBER WITH A BLANK CHARACTER.  THE   *00099901
001000*     NULL CAUSED THE ERP INVOICE INTEGRATION TO FAIL.           *00100001
001001*     MADE BY: NANCY EILBES            WR/IR #: CHG0257165       *00100101
001002******************************************************************00100201
001003   EJECT                                                          00100301
001004 ENVIRONMENT DIVISION.                                            00100401
001010 CONFIGURATION SECTION.                                           00101001
001100 SOURCE-COMPUTER.    IBM-3090.                                    00110000
001200 OBJECT-COMPUTER.    IBM-3090.                                    00120000
001300                                                                  00130000
001400 INPUT-OUTPUT SECTION.                                            00140000
001500 FILE-CONTROL.                                                    00150000
001600     SELECT TRANSACTION-FILE ASSIGN TO UT-S-INP01.                00160000
001700     SELECT INTEGRATION-FILE ASSIGN TO UT-S-OUT01.                00170000
001800     SELECT EMAIL-FILE       ASSIGN TO UT-S-OUT02.                00180000
001900                                                                  00190000
002000 DATA DIVISION.                                                   00200000
002100 FILE SECTION.                                                    00210000
002200                                                                  00220000
002300 FD  TRANSACTION-FILE                                             00230000
002400     RECORDING MODE IS F                                          00240000
002500     LABEL RECORDS ARE STANDARD                                   00250000
002600     BLOCK CONTAINS 0 RECORDS                                     00260000
002700     DATA RECORD IS APTRAN-REC.                                   00270000
002800 01  APTRAN-REC.                                                  00280000
002900     05  FILLER                       PIC  X(500).                00290000
003000                                                                  00300000
003100 FD  INTEGRATION-FILE                                             00310000
003200     RECORDING MODE IS F                                          00320000
003300     LABEL RECORDS ARE STANDARD                                   00330000
003400     BLOCK CONTAINS 0 RECORDS                                     00340000
003500     DATA RECORD IS INTEGRATION-REC.                              00350000
003600 01  INTEGRATION-REC.                                             00360000
003700     05  FILLER                       PIC  X(422).                00370000
003800                                                                  00380000
003900 FD  EMAIL-FILE                                                   00390000
004000     RECORDING MODE IS F                                          00400000
004100     BLOCK CONTAINS 0 RECORDS                                     00410000
004110     LABEL RECORDS ARE STANDARD.                                  00411000
004120                                                                  00412000
004130 01  EMAIL-FILE-REC                  PIC X(80).                   00413000
004140                                                                  00414000
004150 EJECT                                                            00415000
004160 WORKING-STORAGE SECTION.                                         00416000
004170                                                                  00417000
004180 01  EOF-SW                           PIC X     VALUE 'N'.        00418000
004190     88  IN-EOF                                 VALUE 'Y'.        00419000
004200                                                                  00420000
004300 01  PROGRAM-VARIABLES.                                           00430000
004400     05  PV-DESRC100                PIC  X(100).                  00440000
004500     05  PV-DESC REDEFINES PV-DESRC100.                           00450000
004600         10  PV-DESC-COMMENT        PIC  X(15).                   00460000
004700         10  PV-DESC-AUTH-NBR       PIC  X(10).                   00470000
004800         10  PV-DESC-TXT            PIC  X(75).                   00480000
004900     05  AP-TRAN-RECORDS-IN         PIC S9(07) COMP-3 VALUE +0.   00490000
005000     05  PV-TEXT-REC-OUT            PIC S9(07) COMP-3 VALUE +0.   00500000
005100     05  PRT-AP-TRAN-RECORDS-IN     PIC  9(07) VALUE ZERO.        00510000
005200     05  PRT-TEXT-REC-OUT           PIC  9(07) VALUE ZERO.        00520000
005300     05  PV-WORK-AMOUNT             PIC S9(9)V99 COMP-3.          00530000
005310     05  PV-VENDOR-CHECK         PIC  X(09).                      00531000
005320         88  PV-SAM-VENDOR            VALUE '102518706',          00532000
005330                                            '788923787',          00533000
005340                                            '001367051',          00534000
005350                                            '000320432',          00535000
005360                                            '001191055'.          00536000
005370*** SAM VENDORS ARE AXCESS FOR MEN, LIZ CLAIBORNE, MARVELLA,      00537000
005380***                 RTVCH AND TRIFARI.                            00538000
005390                                                                  00539000
005391 01  COMMENT-BLOCK.                                               00539100
005392     05  COMMENT-ALLOW-PCT           PIC Z9.99.                   00539200
005393     05  FILLER                      PIC X(2)  VALUE '% '.        00539300
005394     05  COMMENT-ALLOW-CDE           PIC X(3).                    00539400
005395                                                                  00539500
005396 01  PC-PROGRAM-CONSTANTS.                                        00539600
005397     05  PC-NSD-CDE              PIC X(03)  VALUE 'NSD'.          00539700
005398     05  PC-TRD-CDE              PIC X(03)  VALUE 'TRD'.          00539800
005399     05  PC-MOS-CDE              PIC X(03)  VALUE 'MOS'.          00539900
005400     05  PC-ADV-CDE              PIC X(03)  VALUE 'ADV'.          00540000
005401     05  PC-SAM-CDE              PIC X(03)  VALUE 'SAM'.          00540100
005402     05  PC-TERM-CDE             PIC X(03)  VALUE 'PAY'.          00540200
005403     05  PC-COOP-CDE             PIC X(03)  VALUE 'COP'.          00540300
005404     05  PC-ALW-CDE              PIC X(03)  VALUE 'ALW'.          00540400
005405     05  PC-MISC-CDE             PIC X(03)  VALUE 'MSC'.          00540500
005406     05  PC-BLANK-LINES          PIC X(80) VALUE SPACES.          00540600
005407     05  PC-EMAIL-LINE-1.                                         00540700
005408         10  PC-EMAIL-LINE-1-SP  PIC X(10) VALUE SPACES.          00540800
005409         10  PC-EMAIL-LINE-1-MSG PIC X(70) VALUE                  00540900
005410         'THE TOTAL NUMBER OF INVOICES WRITTEN TO THE API032  '.  00541000
005411     05  PC-EMAIL-LINE-2.                                         00541100
005412         10  PC-EMAIL-LINE-2-SP  PIC X(10) VALUE SPACES.          00541200
005413         10  PC-EMAIL-LINE-2-TAG PIC X(19) VALUE                  00541300
005414         'INTEGRATION FILE = '.                                   00541400
005415         10  PC-EMAIL-LINE-2-AMT PIC Z,ZZZ,ZZ9.                   00541500
005416*----------------------------------------------------------------*00541600
005417*  AP TRANSACTION FILE LAYOUT                                    *00541700
005418*----------------------------------------------------------------*00541800
005419     COPY APRD040.                                                00541900
005420                                                                  00542000
005421*----------------------------------------------------------------*00542100
005422*  INTEGRATION FILE LAYOUT                                       *00542200
005423*----------------------------------------------------------------*00542300
005424     COPY APRD010.                                                00542400
005425                                                                  00542500
005426 EJECT                                                            00542600
005427 PROCEDURE DIVISION.                                              00542700
005428 A100-MAIN.                                                       00542800
005429                                                                  00542900
005430     PERFORM B100-INITIALIZE.                                     00543000
005440                                                                  00544000
005450     PERFORM B200-PROCESS                                         00545000
005460       UNTIL IN-EOF.                                              00546000
005470                                                                  00547000
005480     PERFORM B300-END-OF-JOB.                                     00548000
005490                                                                  00549000
005500     GOBACK.                                                      00550000
005510 EJECT                                                            00551000
005520*----------------------------------------------------------------*00552000
005530*    INITIALIZATION PROCESSING                                   *00553000
005540*    CALLED FROM A100-MAIN                                       *00554000
005550*----------------------------------------------------------------*00555000
005560 B100-INITIALIZE.                                                 00556000
005570                                                                  00557000
005580     OPEN INPUT  TRANSACTION-FILE                                 00558000
005590          OUTPUT INTEGRATION-FILE                                 00559000
005600                 EMAIL-FILE.                                      00560000
005700                                                                  00570000
005800     PERFORM R100-READ-INPUT.                                     00580000
005900                                                                  00590000
006000** WRITE OPENING LINE OF EMAIL                                    00600000
006100                                                                  00610000
006200     WRITE EMAIL-FILE-REC FROM PC-BLANK-LINES.                    00620000
006300     WRITE EMAIL-FILE-REC FROM PC-EMAIL-LINE-1.                   00630000
006400                                                                  00640000
006500 EJECT                                                            00650000
006600 B200-PROCESS.                                                    00660000
006700                                                                  00670000
006800     INITIALIZE AP010-TEXT-FILE.                                  00680000
006900                                                                  00690000
007000     MOVE AP040-VND-NBR         TO  AP010-VND-NBR.                00700000
007100     MOVE AP040-DOC-NBR         TO  AP010-INVC-NBR.               00710000
007110     INSPECT AP010-INVC-NBR REPLACING ALL X'7F' BY ' '.           00711000
007111     INSPECT AP010-INVC-NBR REPLACING ALL X'00' BY ' '.           00711100
007120     MOVE AP040-DOC-DTE         TO  AP010-INVC-DTE.               00712000
007130                                                                  00713000
007140* FORMAT INVOICE SOURCE USING ORIGIN CODE, TRANCODE               00714000
007150     MOVE AP040-ORGN-CDE        TO  AP010-ORGN-CDE.               00715000
007160     MOVE AP040-AP-TRN-CDE      TO  AP010-AP-TRN-CDE.             00716000
007170                                                                  00717000
007180     MOVE AP040-PO-NBR          TO  AP010-KOHLS-MDS-PO-NBR.       00718000
007190     MOVE AP040-DEPT-NBR        TO  AP010-KOHLS-MDS-DEPT-NBR.     00719000
007200                                                                  00720000
007300*-----------------------------------------------------------------00730000
007310*  DISCONTINUE THE USE OF CD PAY GROUP AS OF 9/10/2020 TO PREPARE 00731000
007320*  FOR HOLIDAY.  LEAVING LOGIC IN PLACE IN CASE IT NEEDS TO BE    00732000
007330*  REVIVED AT A LATER DATE.                                       00733000
007340*  WITH THE CODE COMMENTED, ALL INVOICES WILL HAVE SPACES IN      00734000
007350*  THE PAY GROUP FIELD.                                           00735000
007360*-----------------------------------------------------------------00736000
007370*    IF AP040-PO-TYP-CDE = 'CD'                                   00737000
007380*       MOVE 'CD' TO AP010-PAY-GROUP                              00738000
007390** ADD LOGIC HERE TO MODIFY DUE DATE IF NEEDED                    00739000
007400*       MOVE AP040-PYMT-DUE-DTE TO AP010-PYMT-DUE-DTE             00740000
007401*    ELSE                                                         00740100
007402        MOVE SPACES TO AP010-PAY-GROUP.                           00740200
007403        MOVE AP040-PYMT-DUE-DTE TO AP010-PYMT-DUE-DTE.            00740300
007404*    END-IF.                                                      00740400
007405                                                                  00740500
007406* SET INVOICE TYPE.                                               00740600
007407     IF AP040-NET-COST-AMT < 0                                    00740700
007408        SET AP010-CREDIT-MEMO TO TRUE                             00740800
007409     ELSE                                                         00740900
007410        SET AP010-STANDARD    TO TRUE                             00741000
007420     END-IF.                                                      00742000
007430                                                                  00743000
007440     MOVE AP040-TRN-TYP-CDE     TO  AP010-TRN-TYP-CDE.            00744000
007450     MOVE AP040-ENTR-DTE        TO  AP010-ENTR-DTE.               00745000
007460     MOVE AP040-GL-ACCT-NBR     TO  AP010-GL-ACCT-NBR.            00746000
007470     MOVE AP040-DEPTID          TO  AP010-DEPTID.                 00747000
007480     INSPECT AP010-DEPTID REPLACING ALL X'00' BY ' '.             00748000
007490     MOVE AP040-STR-NBR         TO  AP010-LOC-NBR.                00749000
007500     MOVE SPACE                 TO  AP010-FILLER-1.               00750000
007600                                                                  00760000
007700     MOVE AP040-NET-COST-AMT    TO  AP010-NET-COST-AMT.           00770000
007800     MOVE AP040-GRO-COST-AMT    TO  AP010-GRO-COST-AMT.           00780000
007900     MOVE AP040-FRGT-AMT        TO  AP010-FRGT-AMT.               00790000
007901     MOVE AP040-MISC-CHRG-AMT   TO  AP010-MISC-CHRG-AMT.          00790100
007902                                                                  00790200
007903     PERFORM C100-FORMAT-ALLOWANCES.                              00790300
007904                                                                  00790400
007905                                                                  00790500
007906** ADD AUTHORIZATION TO COMMENTS WHEN ONE IS PROVIDED             00790600
007907     IF AP040-AUTH-NBR = SPACES                                   00790700
007908         MOVE AP040-RSN-TXT       TO PV-DESRC100                  00790800
007909     ELSE                                                         00790900
007910         IF AP040-RSN-2ND-LNE-TXT = SPACES                        00791000
007920            MOVE 'AUTHORIZATION:' TO PV-DESC-COMMENT              00792000
007930            MOVE AP040-AUTH-NBR   TO PV-DESC-AUTH-NBR             00793000
007940            MOVE AP040-RSN-1ST-LNE-TXT                            00794000
007950                                  TO PV-DESC-TXT                  00795000
007960         ELSE                                                     00796000
007970            MOVE 'AUTHORIZATION:' TO PV-DESC-COMMENT              00797000
007980            MOVE AP040-AUTH-NBR   TO PV-DESC-AUTH-NBR             00798000
007990            MOVE AP040-RSN-TXT    TO PV-DESC-TXT                  00799000
008000         END-IF                                                   00800000
008100     END-IF.                                                      00810000
008200     MOVE PV-DESRC100             TO  AP010-RSN-TXT.              00820000
008300     PERFORM C200-REPLACE-INVALID-CHARS.                          00830000
008400                                                                  00840000
008500     PERFORM W100-WRITE-OUTPUT.                                   00850000
008600                                                                  00860000
008601     PERFORM R100-READ-INPUT.                                     00860100
008602 EJECT                                                            00860200
008603*---------------------------------------------------------------* 00860300
008604*  END OF PROGRAM PROCESSING:                                   * 00860400
008605*  1)  DISPLAYS RECORD COUNTS AND TOTALS.                       * 00860500
008606*  2)  CLOSES INPUT AND OUTPUT FILES.                           * 00860600
008607*---------------------------------------------------------------* 00860700
008608 B300-END-OF-JOB.                                                 00860800
008609                                                                  00860900
008610     MOVE PV-TEXT-REC-OUT TO PC-EMAIL-LINE-2-AMT.                 00861000
008611     WRITE EMAIL-FILE-REC FROM PC-EMAIL-LINE-2.                   00861100
008612                                                                  00861200
008613     MOVE AP-TRAN-RECORDS-IN        TO PRT-AP-TRAN-RECORDS-IN.    00861300
008614     MOVE PV-TEXT-REC-OUT           TO PRT-TEXT-REC-OUT.          00861400
008615                                                                  00861500
008616     DISPLAY '*-----------------------------------------*'        00861600
008617     DISPLAY 'PROGRAM APKUT008 RECORD COUNTS:'.                   00861700
008618     DISPLAY 'AP TRAN RECORDS  IN  = ' PRT-AP-TRAN-RECORDS-IN.    00861800
008619     DISPLAY 'TEXT RECORDS OUT     = ' PRT-TEXT-REC-OUT.          00861900
008620     DISPLAY '*-----------------------------------------*'        00862000
008630                                                                  00863000
008640     CLOSE TRANSACTION-FILE                                       00864000
008650           INTEGRATION-FILE                                       00865000
008651           EMAIL-FILE.                                            00865100
008652 EJECT.                                                           00865200
008653*---------------------------------------------------------------* 00865300
008654* SIGN IS REVERSED ON ALL DISCOUNTS SO THEY WILL BE NETTED OUT  * 00865400
008655* OF GROSS AMOUNT WHEN INVOICE IS IMPORTED TO ORACLE FUSION.    * 00865500
008656* FOR EACH NON-ZERO DISCOUNT, A LINE-COMMENT IS FORMATTED.      * 00865600
008657*---------------------------------------------------------------* 00865700
008658 C100-FORMAT-ALLOWANCES.                                          00865800
008659                                                                  00865900
008660     IF  AP040-TERM-DISC-AMT NOT EQUAL ZERO                       00866000
008661         MULTIPLY AP040-TERM-DISC-AMT BY -1 GIVING PV-WORK-AMOUNT 00866100
008662         MOVE PV-WORK-AMOUNT        TO  AP010-TERM-DISC-AMT       00866200
008663         MOVE PC-TERM-CDE           TO COMMENT-ALLOW-CDE          00866300
008664         COMPUTE COMMENT-ALLOW-PCT = AP040-TERM-DISC-PCT * 100    00866400
008665         MOVE COMMENT-BLOCK         TO AP010-TERM-DISC-DESC       00866500
008666     ELSE                                                         00866600
008667         MOVE AP040-TERM-DISC-AMT   TO  AP010-TERM-DISC-AMT       00866700
008668         MOVE SPACES                TO AP010-TERM-DISC-DESC       00866800
008669     END-IF.                                                      00866900
008670                                                                  00867000
008671     IF  AP040-NW-STR-DISC-AMT NOT EQUAL ZERO                     00867100
008672         MULTIPLY AP040-NW-STR-DISC-AMT                           00867200
008673               BY -1 GIVING PV-WORK-AMOUNT                        00867300
008674         MOVE PV-WORK-AMOUNT        TO AP010-NW-STR-DISC-AMT      00867400
008675         MOVE AP040-VND-NBR         TO PV-VENDOR-CHECK            00867500
008676         IF  PV-SAM-VENDOR                                        00867600
008677             MOVE PC-SAM-CDE        TO COMMENT-ALLOW-CDE          00867700
008678         ELSE                                                     00867800
008679             MOVE PC-NSD-CDE        TO COMMENT-ALLOW-CDE          00867900
008680         END-IF                                                   00868000
008681         COMPUTE COMMENT-ALLOW-PCT = AP040-NW-STR-DISC-PCT * 100  00868100
008682         MOVE COMMENT-BLOCK         TO AP010-NW-STR-DISC-DESC     00868200
008683     ELSE                                                         00868300
008684         MOVE AP040-NW-STR-DISC-AMT TO AP010-NW-STR-DISC-AMT      00868400
008685         MOVE SPACES                TO AP010-NW-STR-DISC-DESC     00868500
008686     END-IF.                                                      00868600
008687                                                                  00868700
008688     IF  AP040-TRD-DISC-AMT  NOT EQUAL ZERO                       00868800
008689         MULTIPLY AP040-TRD-DISC-AMT BY -1 GIVING PV-WORK-AMOUNT  00868900
008690         MOVE PV-WORK-AMOUNT        TO AP010-TRD-DISC-AMT         00869000
008691         MOVE PC-TRD-CDE            TO COMMENT-ALLOW-CDE          00869100
008692         COMPUTE COMMENT-ALLOW-PCT = AP040-TRD-DISC-PCT * 100     00869200
008693         MOVE COMMENT-BLOCK         TO AP010-TRD-DISC-DESC        00869300
008694     ELSE                                                         00869400
008695         MOVE AP040-TRD-DISC-AMT    TO AP010-TRD-DISC-AMT         00869500
008696         MOVE SPACES                TO AP010-TRD-DISC-DESC        00869600
008697     END-IF.                                                      00869700
008698                                                                  00869800
008699     IF  AP040-MOS-DISC-AMT  NOT EQUAL ZERO                       00869900
008700         MULTIPLY AP040-MOS-DISC-AMT BY -1 GIVING PV-WORK-AMOUNT  00870000
008701         MOVE PV-WORK-AMOUNT        TO AP010-MOS-DISC-AMT         00870100
008702         MOVE PC-MOS-CDE            TO COMMENT-ALLOW-CDE          00870200
008703         COMPUTE COMMENT-ALLOW-PCT = AP040-MOS-DISC-PCT * 100     00870300
008704         MOVE COMMENT-BLOCK         TO AP010-MOS-DISC-DESC        00870400
008705     ELSE                                                         00870500
008706         MOVE AP040-MOS-DISC-AMT    TO AP010-MOS-DISC-AMT         00870600
008707         MOVE SPACES                TO AP010-MOS-DISC-DESC        00870700
008708     END-IF.                                                      00870800
008709                                                                  00870900
008710     IF  AP040-ADV-DISC-AMT  NOT EQUAL ZERO                       00871000
008711         MULTIPLY AP040-ADV-DISC-AMT BY -1 GIVING PV-WORK-AMOUNT  00871100
008712         MOVE PV-WORK-AMOUNT        TO AP010-ADV-DISC-AMT         00871200
008713         MOVE PC-ADV-CDE            TO COMMENT-ALLOW-CDE          00871300
008714         COMPUTE COMMENT-ALLOW-PCT = AP040-ADV-DISC-PCT * 100     00871400
008715         MOVE COMMENT-BLOCK         TO AP010-ADV-DISC-DESC        00871500
008716     ELSE                                                         00871600
008717         MOVE AP040-ADV-DISC-AMT    TO AP010-ADV-DISC-AMT         00871700
008718         MOVE SPACES                TO AP010-ADV-DISC-DESC        00871800
008719     END-IF.                                                      00871900
008720                                                                  00872000
008730     IF  AP040-COOP-DISC-AMT NOT EQUAL ZERO                       00873000
008740         MULTIPLY AP040-COOP-DISC-AMT BY -1 GIVING PV-WORK-AMOUNT 00874000
008750         MOVE PV-WORK-AMOUNT        TO AP010-COOP-DISC-AMT        00875000
008751         MOVE PC-COOP-CDE           TO COMMENT-ALLOW-CDE          00875100
008752         COMPUTE COMMENT-ALLOW-PCT = AP040-COOP-DISC-PCT * 100    00875200
008753         MOVE COMMENT-BLOCK         TO AP010-COOP-DISC-DESC       00875300
008754     ELSE                                                         00875400
008755         MOVE AP040-COOP-DISC-AMT   TO AP010-COOP-DISC-AMT        00875500
008756         MOVE SPACES                TO AP010-COOP-DISC-DESC       00875600
008757     END-IF.                                                      00875700
008758                                                                  00875800
008759     IF  AP040-ALW-DISC-AMT  NOT EQUAL ZERO                       00875900
008760         MULTIPLY AP040-ALW-DISC-AMT BY -1 GIVING PV-WORK-AMOUNT  00876000
008761         MOVE PV-WORK-AMOUNT        TO AP010-ALW-DISC-AMT         00876100
008762         MOVE PC-ALW-CDE            TO COMMENT-ALLOW-CDE          00876200
008763         COMPUTE COMMENT-ALLOW-PCT = AP040-ALW-DISC-PCT * 100     00876300
008764         MOVE COMMENT-BLOCK         TO AP010-ALW-DISC-DESC        00876400
008765     ELSE                                                         00876500
008766         MOVE AP040-ALW-DISC-AMT    TO AP010-ALW-DISC-AMT         00876600
008767         MOVE SPACES                TO AP010-ALW-DISC-DESC        00876700
008768     END-IF.                                                      00876800
008769                                                                  00876900
008770     IF  AP040-MSC-DISC-AMT  NOT EQUAL ZERO                       00877000
008771         MULTIPLY AP040-MSC-DISC-AMT BY -1 GIVING PV-WORK-AMOUNT  00877100
008772         MOVE PV-WORK-AMOUNT        TO AP010-MSC-DISC-AMT         00877200
008773         MOVE PC-MISC-CDE           TO COMMENT-ALLOW-CDE          00877300
008774         COMPUTE COMMENT-ALLOW-PCT = AP040-MSC-DISC-PCT * 100     00877400
008775         MOVE COMMENT-BLOCK         TO AP010-MSC-DISC-DESC        00877500
008776     ELSE                                                         00877600
008777         MOVE AP040-MSC-DISC-AMT    TO AP010-MSC-DISC-AMT         00877700
008778         MOVE SPACES                TO AP010-MSC-DISC-DESC        00877800
008779     END-IF.                                                      00877900
008780                                                                  00878000
008781 EJECT.                                                           00878100
008782*---------------------------------------------------------------* 00878200
008783* INSPECT THE COMMENT FIELD AND REPLACE ANY SPECIAL OR NON-PRINT* 00878300
008784* CHARACTERS WITH SPACES.                                       * 00878400
008785*---------------------------------------------------------------* 00878500
008786 C200-REPLACE-INVALID-CHARS.                                      00878600
008787                                                                  00878700
008788     INSPECT AP010-RSN-TXT                                        00878800
008789             REPLACING ALL ',' BY ' '.                            00878900
008790     INSPECT AP010-RSN-TXT                                        00879000
008791             REPLACING ALL X'0D25' BY '  '.                       00879100
008792     INSPECT AP010-RSN-TXT                                        00879200
008793             REPLACING ALL X'0D15' BY '  '.                       00879300
008794     INSPECT AP010-RSN-TXT                                        00879400
008795             REPLACING ALL '`' BY "'".                            00879500
008796     INSPECT AP010-RSN-TXT                                        00879600
008797             REPLACING ALL '' BY '('.                            00879700
008798     INSPECT AP010-RSN-TXT                                        00879800
008799             REPLACING ALL 'Ù' BY ')'.                            00879900
008800     INSPECT AP010-RSN-TXT                                        00880000
008801             REPLACING ALL 'µ' BY ' '.                            00880100
008802     INSPECT AP010-RSN-TXT                                        00880200
008803             REPLACING ALL X'B7' BY ' '.                          00880300
008804     INSPECT AP010-RSN-TXT                                        00880400
008805             REPLACING ALL X'B8' BY ' '.                          00880500
008806     INSPECT AP010-RSN-TXT                                        00880600
008807             REPLACING ALL '~' BY ' '.                            00880700
008808     INSPECT AP010-RSN-TXT                                        00880800
008809             REPLACING ALL '<' BY '('.                            00880900
008810     INSPECT AP010-RSN-TXT                                        00881000
008811             REPLACING ALL '>' BY ')'.                            00881100
008812     INSPECT AP010-RSN-TXT                                        00881200
008813             REPLACING ALL '|' BY ' '.                            00881300
008814     INSPECT AP010-RSN-TXT                                        00881400
008815             REPLACING ALL '!' BY ' '.                            00881500
008816     INSPECT AP010-RSN-TXT                                        00881600
008817             REPLACING ALL X'00' BY ' '.                          00881700
008818     INSPECT AP010-RSN-TXT                                        00881800
008819             REPLACING ALL X'05' BY ' '.                          00881900
008820     INSPECT AP010-RSN-TXT                                        00882000
008821             REPLACING ALL X'1E' BY ' '.                          00882100
008822     INSPECT AP010-RSN-TXT                                        00882200
008823             REPLACING ALL X'32' BY ' '.                          00882300
008824     INSPECT AP010-RSN-TXT                                        00882400
008825             REPLACING ALL X'AB' BY ' '.                          00882500
008826     INSPECT AP010-RSN-TXT                                        00882600
008827             REPLACING ALL X'9B' BY ' '.                          00882700
008828     INSPECT AP010-RSN-TXT                                        00882800
008829             REPLACING ALL X'15' BY ' '.                          00882900
008830     INSPECT AP010-RSN-TXT                                        00883000
008831             REPLACING ALL X'41' BY ' '.                          00883100
008832     INSPECT AP010-RSN-TXT                                        00883200
008833             REPLACING ALL X'FD' BY ' '.                          00883300
008834     INSPECT AP010-RSN-TXT                                        00883400
008835             REPLACING ALL X'B3' BY ' '.                          00883500
008836     INSPECT AP010-RSN-TXT                                        00883600
008837             REPLACING ALL X'0D' BY ' '.                          00883700
008838     INSPECT AP010-RSN-TXT                                        00883800
008839             REPLACING ALL '"' BY ' '.                            00883900
008840     INSPECT AP010-RSN-TXT                                        00884001
008841             REPLACING ALL X'00' BY ' '.                          00884101
008842                                                                  00884200
008843                                                                  00884300
008844 R100-READ-INPUT.                                                 00884400
008845                                                                  00884500
008846     READ TRANSACTION-FILE INTO AP040-TRANSACTION-FILE            00884600
008847         AT END SET IN-EOF TO TRUE.                               00884700
008848                                                                  00884800
008849     IF  IN-EOF                                                   00884900
008850         CONTINUE                                                 00885000
008851     ELSE                                                         00885100
008852         ADD 1 TO AP-TRAN-RECORDS-IN                              00885200
008853     END-IF.                                                      00885300
008854                                                                  00885400
008855 EJECT.                                                           00885500
008856                                                                  00885600
008857 EJECT.                                                           00885700
008858 W100-WRITE-OUTPUT.                                               00885800
008859                                                                  00885900
008860     WRITE INTEGRATION-REC FROM AP010-TEXT-FILE.                  00886000
008861                                                                  00886100
008862     ADD 1 TO PV-TEXT-REC-OUT.                                    00886200
008870 EJECT.                                                           00887000
