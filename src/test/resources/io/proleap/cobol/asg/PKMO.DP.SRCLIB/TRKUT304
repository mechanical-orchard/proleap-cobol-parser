000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.    TRKUT304.                                         00040002
000500 AUTHOR.        GERMAN BANDA.                                     00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   NOVEMBER 2021.                                    00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000* THIS PROGRAM WILL READ A FILE OF PO HEADER/DETAIL               00100048
001010* AND VENDOR/DC DATA.                                             00101048
001100* THE PROGRAM WILL READ THE FILE AND CHECK MUTIPLE PARAMETERS TO  00110048
001200* DETERMINE IF THE DC LOCATION FOR THE ALLOCAION SHOULD BE UPDATED00120048
001300* TO A THIRD PARTY LOCATION.(GEODIS/DC821)                        00130048
001600*                                                                 00160000
001610* CHECK PARM - SPHIC1 SEPHORA PROCESS CHECK FOR PO INSTRUCTION    00161048
001620*  "Y" - CHECK SEPH3PTVDP PARM INCLUDING PO INSTRUCTION TABLES    00162051
001630*  "N" - CHECK SEPH3PTVDP PARM NOT INCLUDING PO INSTRUCTION TABLES00163051
001640* CHECK PARM SEPH3PTVDP SEPHORA THIRD PARTY VND DPT PO PROCESS    00164048
001641*       ROW FOUND - RETURN WST_DC_CONVERT_PARM_NAME -             00164148
001642*          CURRENTLY SET TO SEPH3PTDCC                            00164248
001643*       SET PS-PO-PROCESS-YES                                     00164348
001644* CHECK PARM - SEPH3PTDCC SEPHORA THIRD PARTY DC CONVERSION VALUES00164448
001645*       FOR DC LOCATION , RETURN 3RD PARTY LOCATION               00164548
001646*                                                                 00164648
001647* FOR EACH SEPHORA PO FOUND BASED ON THE PARM, DETERMINE THE      00164748
001648* PREVIOUS ITEM QUANTITY AND UPDATE THE FOLLOWING NEW FIELDS      00164848
001649*    TR302-PREV-ITEM-QTY-N                                        00164948
001650*    TR302-THRD-PRTY-PO-PRCS-IND = 'Y'                            00165048
001660* THE INPUT FILE WILL ONLY CONTAIN ANY UPDATED ALLOCATIONS        00166048
001670* FOR THE 3RD PARTY PROCESS, WE ARE ROLLING UP ALL THE ACTIVE PARM00167048
001680* LOCATIONS TO A SINGLE GEODIS LOACTION. IN ORDER TO DETERMINE THE00168048
001690* NET INCREASE OR DECREASE IN ITEM QTY, A NEW RECORD WILL BE      00169048
001691* WRITTEN TO THE OUTPUT FILE FOR EACH ALLOCATION FOR THE PO/DEST  00169148
001692*  EXAMPLE:                                                       00169249
001693*                                                                 00169349
001694* INITIAL ALLOCATION                                              00169449
001695* PO        DC   QTY PREV QTY                                     00169549
001696* 13854539  810  100   0                                          00169649
001697* 13854539  830  400   0                                          00169749
001698* 13854539  840  300   0                                          00169849
001699* -----------------                                               00169949
001700* 13854539  821  100   0 RECORD UPDATED TO 821 AND WRITTEN        00170049
001701* 13854539  821  400   0 RECORD UPDATED TO 821 AND WRITTEN        00170149
001702* 13854539  821  300   0 RECORD UPDATED TO 821 AND WRITTEN        00170249
001703*                                                                 00170349
001704* ALLOCATION CHANGE ONLY FOR DC 830                               00170449
001705* 13854539  830  250  - SINGLE RECORD ON INPUT FILE               00170549
001706*                                                                 00170649
001708* 13854539  821  100   100 NEW RECORD CREATED AND WRITTEN         00170849
001709* 13854539  821  250   400 RECORD UPDATED TO 821 AND WRITTEN      00170949
001710* 13854539  821  300   300 NEW RECORD CREATED AND WRITTEN         00171049
001711* -----------------                                               00171149
001712* RECORDS IN  1                                                   00171249
001713* RECORDS OUT 3                                                   00171349
001720******************************************************************00172049
001800 ENVIRONMENT DIVISION.                                            00180000
001900 CONFIGURATION SECTION.                                           00190000
002000                                                                  00200000
002100 SOURCE-COMPUTER.        IBM-3090.                                00210000
002200 OBJECT-COMPUTER.        IBM-3090.                                00220000
002300                                                                  00230000
002400 INPUT-OUTPUT SECTION.                                            00240000
002500 FILE-CONTROL.                                                    00250000
002600                                                                  00260000
002700     SELECT TMS-PO-HDR-DTL-FILE-IN                                00270000
002800         ASSIGN TO INP01.                                         00280000
002900                                                                  00290000
003000     SELECT TMS-PO-HDR-DTL-FILE-OUT                               00300000
003100         ASSIGN TO OUT01.                                         00310000
003200                                                                  00320000
003230                                                                  00323057
003300******************************************************************00330000
003400 DATA DIVISION.                                                   00340000
003500 FILE SECTION.                                                    00350000
003600                                                                  00360000
003700 FD  TMS-PO-HDR-DTL-FILE-IN                                       00370000
003800     RECORDING MODE F                                             00380000
003900     LABEL RECORDS ARE STANDARD                                   00390000
004000     BLOCK CONTAINS 0 RECORDS.                                    00400000
004100                                                                  00410000
004200 01  TMS-PO-HDR-DTL-RECORD-IN              PIC X(300).            00420000
004300                                                                  00430000
004400 FD  TMS-PO-HDR-DTL-FILE-OUT                                      00440000
004500     RECORDING MODE F                                             00450000
004600     LABEL RECORDS ARE STANDARD                                   00460000
004700     BLOCK CONTAINS 0 RECORDS.                                    00470000
004800                                                                  00480000
004900 01  TMS-PO-HDR-DTL-RECORD-OUT             PIC X(300).            00490000
005070                                                                  00507055
005100******************************************************************00510000
005200 WORKING-STORAGE SECTION.                                         00520000
005300******************************************************************00530000
005400******************************************************************00540000
005500* PO HEADER AND PO/DC DETAIL FILE LAYOUT                          00550000
005600******************************************************************00560000
005700     COPY TRRD302.                                                00570000
005800                                                                  00580000
005900******************************************************************00590000
006000******************************************************************00600000
006100* DB2 FORMATTED MESSAGE AREA                                      00610000
006200******************************************************************00620000
006300     COPY DPWS004.                                                00630000
006400                                                                  00640000
006500******************************************************************00650000
006600*    TKRPRPM TABLE                                                00660000
006700******************************************************************00670000
006800     EXEC SQL                                                     00680000
006900          INCLUDE TKRPRPM                                         00690000
007000     END-EXEC.                                                    00700000
007100******************************************************************00710000
007200*  SQL AND COBOL DECLARATIONS FOR WST_INTGRTN_TYP                 00720000
007300******************************************************************00730000
007400     EXEC SQL                                                     00740000
007500          INCLUDE WST00008                                        00750000
007600     END-EXEC.                                                    00760000
007700******************************************************************00770000
007800*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_DEFN                   00780000
007900******************************************************************00790000
008000     EXEC SQL                                                     00800000
008100          INCLUDE WST00009                                        00810000
008200     END-EXEC.                                                    00820000
008300******************************************************************00830000
008400*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_ELEM                   00840000
008500******************************************************************00850000
008600     EXEC SQL                                                     00860000
008700          INCLUDE WST00010                                        00870000
008800     END-EXEC.                                                    00880000
008900                                                                  00890000
009000*                                                                 00900000
009100******************************************************************00910000
009200*  SQL AND COBOL DECLARATIONS FOR TPURCHS                         00920000
009300******************************************************************00930000
009400     EXEC SQL                                                     00940000
009500          INCLUDE TPURCHS                                         00950000
009600     END-EXEC.                                                    00960000
009700                                                                  00970000
009800*                                                                 00980000
009810******************************************************************00981042
009820*  SQL AND COBOL DECLARATIONS FOR TPLNSHP                         00982042
009830******************************************************************00983042
009840     EXEC SQL                                                     00984042
009850          INCLUDE TPLNSHP                                         00985042
009860     END-EXEC.                                                    00986042
009870                                                                  00987042
009880*                                                                 00988042
009900******************************************************************00990000
010000*  SQL AND COBOL DECLARATIONS FOR TPOINST - PO INSTRUCTION        01000000
010100******************************************************************01010000
010200     EXEC SQL                                                     01020000
010300          INCLUDE TPOINST                                         01030000
010400     END-EXEC.                                                    01040000
010500                                                                  01050000
010600*                                                                 01060000
010700******************************************************************01070000
010800*  SQL AND COBOL DECLARATIONS FOR TINSTCD - PO INSTRUCTION CODE   01080000
010900******************************************************************01090000
011000     EXEC SQL                                                     01100000
011100          INCLUDE TINSTCD                                         01110000
011200     END-EXEC.                                                    01120000
011300                                                                  01130000
011400*                                                                 01140000
011410******************************************************************01141009
011420*  DB2 AREA FOR TRT_MANU_PO_HIST                                  01142009
011430******************************************************************01143009
011440     EXEC SQL                                                     01144009
011450          INCLUDE TRT00001                                        01145009
011460     END-EXEC.                                                    01146009
011470                                                                  01147009
011480*                                                                 01148009
011490******************************************************************01149022
011491*  DB2 AREA FOR TRT_MANU_PO_EXTR                                  01149122
011492******************************************************************01149222
011493     EXEC SQL                                                     01149322
011494          INCLUDE TRT00000                                        01149469
011495     END-EXEC.                                                    01149522
011496                                                                  01149622
011497*                                                                 01149722
011500******************************************************************01150000
011600* COMMUNICATIONS AREA FOR DB2                                     01160000
011700******************************************************************01170000
011800     EXEC SQL                                                     01180000
011900          INCLUDE SQLCA                                           01190000
012000     END-EXEC.                                                    01200000
012100                                                                  01210000
012200*---------------------------------------------------------------* 01220000
012300******************************************************************01230000
012400 01 ABEND-CODE                       PIC S9(04)    VALUE +0       01240000
012500                                                   COMP SYNC.     01250000
012600                                                                  01260000
012700 01 PS-PROGRAM-SWITCHES.                                          01270000
012800     05  PS-END-OF-FILE-SW             PIC  X(01)  VALUE 'N'.     01280000
012900         88  PS-END-OF-FILE                        VALUE 'Y'.     01290000
013000         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     01300000
013100     05  PS-FIRST-TIME-CHECK-SW        PIC  X(01)  VALUE 'N'.     01310000
013200         88  PS-FIRST-TIME-CHECK-YES               VALUE 'Y'.     01320000
013300         88  PS-FIRST-TIME-CHECK-NO                VALUE 'N'.     01330000
013400     05  PS-CHECK-PO-INSTR-TEXT-SW     PIC  X(01)  VALUE 'B'.     01340050
013500         88  PS-CHECK-PO-INSTR-TEXT-YES            VALUE 'Y'.     01350000
013600         88  PS-CHECK-PO-INSTR-TEXT-NO             VALUE 'N'.     01360000
013700         88  PS-CHECK-PO-INSTR-BYPASS              VALUE 'B'.     01370000
013800     05  PS-PO-PROCESS-SW              PIC  X(01)  VALUE 'N'.     01380000
013900         88  PS-PO-PROCESS-YES                     VALUE 'Y'.     01390000
014000         88  PS-PO-PROCESS-NO                      VALUE 'N'.     01400000
014100     05  PS-DC-LOCATION-SW             PIC  X(01)  VALUE 'N'.     01410000
014200         88  PS-DC-LOCATION-FOUND                  VALUE 'Y'.     01420000
014300         88  PS-DC-LOCATION-NOT-FND                VALUE 'N'.     01430000
014310     05  PS-HIST-QTY-FOUND-SW          PIC  X(01)  VALUE 'N'.     01431021
014320         88  PS-HIST-QTY-FOUND-YES                 VALUE 'Y'.     01432021
014330         88  PS-HIST-QTY-FOUND-NO                  VALUE 'N'.     01433021
014340     05  PS-NO-DCQTY-CHG-CSR-SW        PIC  X(01)  VALUE 'N'.     01434024
014350         88  PS-END-NO-DCQTY-CHG-YES               VALUE 'Y'.     01435024
014360         88  PS-END-NO-DCQTY-CHG-NO                VALUE 'N'.     01436024
014400                                                                  01440000
014500 01 PC-PROGRAM-CONSTANTS.                                         01450000
014600     05  PC-A                        PIC  X(01)    VALUE 'A'.     01460000
014700     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'TRKUT304'. 01470002
014900     05  PC-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  01490000
015010     05  PC-DC                        PIC X(02)    VALUE 'DC'.    01501034
015200                                                                  01520000
015300 01 PV-PROGRAM-VARIABLES.                                         01530000
015400     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01540000
015500     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01550000
015700     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01570000
016410     05  PV-REQ-LATE-DELY-DTE        PIC X(10)  VALUE SPACES.     01641030
016800     05  PV-DISPLAY-SQLCODE          PIC -999.                    01680000
016801                                                                  01680142
016810 01  PV-REFORMATED-DATE.                                          01681042
016820     05  PV-REFORMAT-MONTH             PIC X(02)  VALUE SPACES.   01682042
016830     05  FILLER                        PIC X(01)  VALUE '/'.      01683042
016840     05  PV-REFORMAT-DAY               PIC X(02)  VALUE SPACES.   01684042
016850     05  FILLER                        PIC X(01)  VALUE '/'.      01685042
016860     05  PV-REFORMAT-YEAR              PIC X(04)  VALUE SPACES.   01686042
016900                                                                  01690000
017000 01  PV-SAVE-FIELDS.                                              01700000
017100     05  PV-SAVE-PO-NBR              PIC ZZZZZZZZZZ VALUE ZEROES. 01710000
017200     05  PV-SAVE-DC-NBR              PIC  9(4)     VALUE ZEROES.  01720000
017300     05  PV-DCSPLIT-WORK-QTY         PIC  9(10)    VALUE ZEROES.  01730000
017400*                                                                 01740000
017500     05  PV-SAVE-RECORD.                                          01750000
017600         10 FILLER                   PIC   X(14)  VALUE SPACES.   01760000
017700         10 PV-DC-NBR                PIC   9(4)   VALUE ZEROES.   01770000
017800         10 FILLER                   PIC   X(40)  VALUE SPACES.   01780000
017900         10 PV-DEST-NAME             PIC   9(4)   VALUE ZEROES.   01790000
018000         10 FILLER                   PIC   X(50)  VALUE SPACES.   01800000
018100         10 PV-REQ-ITEM-QTY          PIC   9(10)  VALUE ZEROES.   01810000
018200         10 FILLER                   PIC   X(40)  VALUE SPACES.   01820056
018210         10 PV-PO-STATUS-CDE         PIC   X(02)  VALUE SPACES.   01821056
018220         10 FILLER                   PIC   X(02)  VALUE SPACES.   01822056
018230         10 PV-CHANGES-IND           PIC   X(01)  VALUE SPACES.   01823056
018240         10 PV-DC-QTY-CHG-IND        PIC   X(01)  VALUE SPACES.   01824056
018250         10 PV-PO-STATUS-CHG-IND     PIC   X(01)  VALUE SPACES.   01825056
018260         10 PV-DC-DROP-IND           PIC   X(01)  VALUE SPACES.   01826056
018270         10 FILLER                   PIC   X(106) VALUE SPACES.   01827062
018280         10 PV-PREV-ITEM-QTY         PIC   9(10)  VALUE ZEROES.   01828063
018290         10 PV-THRD-PRTY-PRCS-IND    PIC   X(01)  VALUE SPACES.   01829061
018291         10 FILLER                   PIC   X(13)  VALUE SPACES.   01829162
018300                                                                  01830000
018400                                                                  01840000
018500  01 DB2-KEYS.                                                    01850000
018600     05  DK-PO-NBR                 PIC  S9(9) COMP.               01860000
018700     05  DK-OPER-UNT-ID            PIC  S9(4) COMP.               01870000
018800                                                                  01880000
018900 01 COUNTERS.                                                     01890000
019000     05  PV-READ-COUNTER             PIC  S9(9) COMP-3.           01900000
019100     05  PV-PO-RECORD-WRITE-COUNT    PIC  S9(9) COMP-3.           01910000
019200                                                                  01920000
019210*---------------------------------------------------------------* 01921024
019220* CURSOR FOR THE PREVIOUS TRT_MANU_PO_EXTR ROWS                   01922078
019221* IF THERE IS UPDATE TO ONLY ONE DC ON A PO, ONLY THAT RECORD     01922178
019222* WILL BE PASSED,  ALSO ONLY THE ONE ROW/TIMESTAMP WILL BE UPDATE 01922278
019223* ON THE DATABASE.  CURSOR WILL RETURN THE OTHER ROWS             01922378
019230*---------------------------------------------------------------* 01923024
019250     EXEC SQL                                                     01925024
019260          DECLARE NO_DCQTY_CHG_CSR CURSOR WITH HOLD FOR           01926031
019270           SELECT PO_NBR                                          01927033
019280                 ,DC_NBR                                          01928033
019290                 ,ENT_ID                                          01929033
019300                 ,STRT_SHIP_DTE                                   01930033
019310                 ,CNCL_DTE                                        01931033
019311                 ,NW_STR_PO_IND                                   01931133
019312                 ,DC_ALLOC_QTY                                    01931233
019313                 ,STR_ALLOC_PO_IND                                01931333
019314                 ,PO_STAT_CDE                                     01931433
019315                 ,DC_QTY_CHGD_CDE                                 01931533
019316                 ,PO_STAT_CHGD_IND                                01931633
019317                 ,DC_DROP_IND                                     01931733
019318                 ,MANU_DAT_LOD_TMST                               01931833
019319                 ,LAST_UPD_TMST                                   01931933
019320                 ,ENT_NM                                          01932033
019321                 ,SEASET_SHRT_NM                                  01932133
019322                 ,DTE_CHGD_IND                                    01932233
019323                 ,NW_STR_PO_CHGD_IND                              01932333
019324                 ,SEASET_CHGD_IND                                 01932433
019325                 ,STR_ALLOC_CHGD_IND                              01932533
019326                 ,INIT_PO_LOD_IND                                 01932633
019327                 ,(CNCL_DTE + 1 YEARS)                            01932733
019328                 ,DEPT_NBR                                        01932833
019329                 ,DEPT_NBR_CHGD_IND                               01932933
019330                 ,MIN_CL_NBR                                      01933033
019331                 ,MIN_CL_NBR_CHGD_IND                             01933133
019332           FROM                                                   01933224
019333                  TRT_MANU_PO_EXTR                                01933324
019334           WHERE                                                  01933424
019335                  PO_NBR            = :DK-PO-NBR                  01933530
019338            AND   MANU_DAT_LOD_TMST < :TRT00000-MANU-DAT-LOD-TMST 01933876
019339           ORDER BY PO_NBR, DC_NBR                                01933976
019340     END-EXEC.                                                    01934076
019341                                                                  01934176
019350*---------------------------------------------------------------* 01935037
019400******************************************************************01940000
019500 PROCEDURE DIVISION.                                              01950000
019600******************************************************************01960000
019700******************************************************************01970000
019800* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01980000
019900*      PROGRAM.                                                   01990000
020000******************************************************************02000000
020100 0000-PROGRAM-MAINLINE.                                           02010000
020200                                                                  02020000
020300     DISPLAY '***** TRKUT304 STARTED *****'.                      02030002
020400                                                                  02040000
020500     PERFORM 1000-INITIALIZE.                                     02050000
020600                                                                  02060000
020700     PERFORM 2000-PROCESS-PO-FILE-IN                              02070000
020800         UNTIL PS-END-OF-FILE.                                    02080000
020900                                                                  02090000
021000     PERFORM 9000-EOJ-ROUTINE.                                    02100000
021100                                                                  02110000
021200     STOP RUN.                                                    02120000
021300                                                                  02130000
021400******************************************************************02140000
021500* DO FIRST TIME PROGRAM INITIALIZATION TASKS.                     02150000
021600*    -- OPEN INPUT FILE                                           02160000
021700*    -- OPEN OUTPUT FILE                                          02170000
021900*    -- READ INPUT FILE                                           02190000
022000******************************************************************02200000
022100 1000-INITIALIZE.                                                 02210000
022200                                                                  02220000
022300     INITIALIZE COUNTERS.                                         02230000
022400     OPEN INPUT  TMS-PO-HDR-DTL-FILE-IN.                          02240000
022500     OPEN OUTPUT TMS-PO-HDR-DTL-FILE-OUT.                         02250071
022610                                                                  02261055
022700     PERFORM 7000-READ-PO-HDR-DTL-FILE-IN.                        02270000
022800                                                                  02280000
022900     IF PS-END-OF-FILE                                            02290000
023000         DISPLAY '** FILE IS EMPTY **'                            02300000
023100     ELSE                                                         02310000
023200         PERFORM 1200-SEL-PO-INSTR-PARM                           02320000
023400         DISPLAY 'SPHIC1 = Y JOIN POINST'                         02340050
023410         DISPLAY 'SPHIC1 = N NO PO INST '                         02341050
023420         DISPLAY 'SPHIC1 = B BYPSS CHECK'                         02342050
023430         DISPLAY 'SPCL INSTRCT  PARM = ' PS-CHECK-PO-INSTR-TEXT-SW02343050
023700     END-IF.                                                      02370000
023800                                                                  02380000
023900******************************************************************02390000
024000* PARM WILL BE USED TO DETERMINE IF WE NEED TO                    02400049
024100* PERFORM FOR THE EXISTENCE OF A SPECIFIC TEXT VALUE WITHIN THE   02410000
024200* SPECIAL INSTRUCTIONS FOR THE PO                                 02420000
024300******************************************************************02430000
024400 1200-SEL-PO-INSTR-PARM.                                          02440000
024500                                                                  02450000
024600     EXEC SQL                                                     02460000
024700        SELECT FUNC_TXT                                           02470000
024800          INTO :KRPRPM-FUNC-TXT                                   02480000
024900        FROM   TKRPRPM                                            02490000
025000        WHERE  SYS_PRC_FUNC_CDE  = 'SPHIC1'                       02500000
025100          AND  INTFC_SYS_CDE     = 'KHL'                          02510000
025200          AND  LOC_ID            = 090                            02520000
025300          AND  FUNC_PRC_STAT_CDE = 'AC'                           02530000
025400          AND  FUNC_BEG_TMST     <= CURRENT TIMESTAMP             02540000
025500          AND  FUNC_END_TMST     >= CURRENT TIMESTAMP             02550000
025600     END-EXEC                                                     02560000
025700                                                                  02570000
025800     EVALUATE TRUE                                                02580000
025900         WHEN SQLCODE = ZERO                                      02590000
026000             IF KRPRPM-FUNC-TXT = 'Y'                             02600000
026100                SET PS-CHECK-PO-INSTR-TEXT-YES  TO TRUE           02610000
026200             ELSE                                                 02620000
026300                SET PS-CHECK-PO-INSTR-TEXT-NO   TO TRUE           02630000
026400             END-IF                                               02640000
026500         WHEN SQLCODE = +100                                      02650000
026600             SET PS-CHECK-PO-INSTR-BYPASS  TO TRUE                02660000
026700         WHEN SQLWARN0 NOT = SPACES                               02670000
026800         WHEN SQLCODE < ZERO                                      02680000
026900         WHEN SQLCODE > ZERO                                      02690000
027000             MOVE '1200-SEL-PO-INSTR-PARM '                       02700000
027100                                          TO PV-PARAGRAPH-NAME    02710000
027200             MOVE 'SELECT TKRPRPM ' TO PV-DB2-OPERATION-ATTEMPTED 02720000
027300             DISPLAY 'PARM SPHIC1 '                               02730000
027400             PERFORM 9100-SQL-ABEND                               02740000
027500     END-EVALUATE.                                                02750000
027600                                                                  02760000
027700                                                                  02770000
027800******************************************************************02780000
027900* BEGIN RETRIEVING THE NECESSARY DATA                             02790000
028000******************************************************************02800000
028100 2000-PROCESS-PO-FILE-IN.                                         02810000
028500                                                                  02850000
028600     IF TR302-PO-NBR  = PV-SAVE-PO-NBR                            02860000
028700        IF PS-PO-PROCESS-YES                                      02870000
028710           DISPLAY 'PO/DC 3RD PARTY' TR302-PO-NBR '/' TR302-DC-NBR02871047
028800           MOVE TR302-DC-NBR TO DK-OPER-UNT-ID                    02880000
028900           PERFORM 4400-SEL-DC-3RD-PARTY-LOC                      02890000
029100           IF PS-DC-LOCATION-FOUND                                02910005
029110              IF TR302-DC-QTY-CHG-INCREASE OR                     02911009
029120                 TR302-DC-QTY-CHG-DECREASE                        02912009
029130                 PERFORM 5000-SEL-PREV-SPLIT-HIST                 02913021
029131              ELSE                                                02913138
029132                 IF TR302-INIT-PO-LOD-YES                         02913241
029133                    MOVE +0 TO TR302-PREV-ITEM-QTY                02913341
029134                 ELSE                                             02913441
029135                    MOVE TR302-REQ-ITEM-QTY  TO                   02913541
029136                                TR302-PREV-ITEM-QTY               02913638
029140                 END-IF                                           02914041
029150              END-IF                                              02915041
029151                                                                  02915155
029152**       *********************************************************02915278
029153**       WRITE ZERO UNIT RECORDS FOR RDC FOR THIRD PARTY PROCESS  02915378
029154**       *********************************************************02915478
029156              MOVE TR302-TMS-PO-HDR-DTL-RECORD                    02915656
029157                                      TO PV-SAVE-RECORD           02915756
029158              MOVE 'Y' TO PV-CHANGES-IND                          02915856
029159              MOVE 'D' TO PV-DC-QTY-CHG-IND                       02915956
029160              MOVE +0 TO PV-REQ-ITEM-QTY                          02916070
029161              PERFORM 8100-WRITE-PO-DTL-CANCEL-REC                02916170
029180**       *********************************************************02918078
029200              MOVE PV-SAVE-DC-NBR  TO TR302-DC-NBR                02920055
029201                                      TR302-DEST-NAME-NBR         02920155
029202              SET TR302-THRD-PRTY-PO-PRCS-YES  TO TRUE            02920217
029206              PERFORM 8000-WRITE-PO-DTL-REC-OUT                   02920635
029207                                                                  02920735
029208              IF PS-FIRST-TIME-CHECK-YES                          02920825
029209                 PERFORM 6000-PRCS-NO-DC-QTY-CHG                  02920925
029210                 SET PS-FIRST-TIME-CHECK-NO TO TRUE               02921025
029211              END-IF                                              02921125
029212           ELSE                                                   02921235
029213              PERFORM 8000-WRITE-PO-DTL-REC-OUT                   02921335
029220           END-IF                                                 02922005
029500        ELSE                                                      02950000
029700           PERFORM 8000-WRITE-PO-DTL-REC-OUT                      02970000
029800        END-IF                                                    02980000
029900     ELSE                                                         02990000
029910        SET PS-FIRST-TIME-CHECK-YES TO TRUE                       02991024
030000        MOVE TR302-PO-NBR  TO PV-SAVE-PO-NBR                      03000000
030400        PERFORM 2100-PROCESS-DC-SPLITS                            03040000
030500     END-IF                                                       03050000
030600                                                                  03060000
030700     PERFORM 7000-READ-PO-HDR-DTL-FILE-IN.                        03070000
030800                                                                  03080000
030900******************************************************************03090000
031000* SUM CERTAIN VENDOR ALLOCATIONS FOR DC SPLITS                    03100000
031100******************************************************************03110000
031200 2100-PROCESS-DC-SPLITS.                                          03120000
031300                                                                  03130000
031500                                                                  03150000
031600     SET PS-PO-PROCESS-NO  TO TRUE                                03160000
031700     IF PS-CHECK-PO-INSTR-TEXT-YES                                03170000
031800        PERFORM 4000-SEL-3RD-PRTY-VND-POINST                      03180000
031900     ELSE                                                         03190000
032000        IF PS-CHECK-PO-INSTR-TEXT-NO                              03200000
032100           PERFORM 4200-SEL-3RD-PARTY-VND-DPT                     03210000
032200        END-IF                                                    03220000
032300     END-IF.                                                      03230000
032400                                                                  03240000
032500     IF PS-PO-PROCESS-YES                                         03250000
032600        DISPLAY 'PO/DC 3RD PARTY' TR302-PO-NBR '/' TR302-DC-NBR   03260047
032610        MOVE TR302-DC-NBR TO DK-OPER-UNT-ID                       03261001
032700        PERFORM 4400-SEL-DC-3RD-PARTY-LOC                         03270000
032800        IF PS-DC-LOCATION-FOUND                                   03280000
032802           IF TR302-DC-QTY-CHG-INCREASE OR                        03280210
032803              TR302-DC-QTY-CHG-DECREASE                           03280310
032804                PERFORM 5000-SEL-PREV-SPLIT-HIST                  03280421
032805           ELSE                                                   03280539
032806              IF TR302-INIT-PO-LOD-YES                            03280641
032807                 MOVE +0 TO TR302-PREV-ITEM-QTY                   03280741
032808              ELSE                                                03280841
032809                 MOVE TR302-REQ-ITEM-QTY  TO                      03280941
032810                                TR302-PREV-ITEM-QTY               03281039
032811              END-IF                                              03281141
032812           END-IF                                                 03281241
032814                                                                  03281478
032816           MOVE TR302-TMS-PO-HDR-DTL-RECORD                       03281678
032817                                   TO PV-SAVE-RECORD              03281778
032818           MOVE 'Y' TO PV-CHANGES-IND                             03281878
032819           MOVE 'D' TO PV-DC-QTY-CHG-IND                          03281978
032820           MOVE +0 TO PV-REQ-ITEM-QTY                             03282078
032821           PERFORM 8100-WRITE-PO-DTL-CANCEL-REC                   03282178
032822                                                                  03282278
032825           MOVE PV-SAVE-DC-NBR  TO TR302-DC-NBR                   03282555
032826                                   TR302-DEST-NAME-NBR            03282655
032827           SET TR302-THRD-PRTY-PO-PRCS-YES TO TRUE                03282741
032831           PERFORM 8000-WRITE-PO-DTL-REC-OUT                      03283141
032832                                                                  03283241
032833           IF PS-FIRST-TIME-CHECK-YES                             03283341
032834              PERFORM 6000-PRCS-NO-DC-QTY-CHG                     03283441
032835              SET PS-FIRST-TIME-CHECK-NO TO TRUE                  03283541
032836           END-IF                                                 03283641
032837        ELSE                                                      03283741
032838           PERFORM 8000-WRITE-PO-DTL-REC-OUT                      03283841
032839        END-IF                                                    03283903
032840     ELSE                                                         03284046
032850           PERFORM 8000-WRITE-PO-DTL-REC-OUT                      03285046
034300     END-IF.                                                      03430000
034400                                                                  03440000
035100******************************************************************03510000
035200* CHECK VALID VENDOR/DEPARTMENTS TO BE PROCESSED BY A THIRD PARTY 03520000
035300* SEPHORA THIRD PARTY VENDOR DEPARTMENT                           03530000
035400* KRPRPM-FUNC-TXT = 'Y' THEN JOIN THRU THE PO INSTRUCTIONS TABLES 03540000
035500******************************************************************03550000
035600 4000-SEL-3RD-PRTY-VND-POINST.                                    03560000
035700                                                                  03570000
035800     MOVE TR302-PO-NBR    TO   DK-PO-NBR                          03580000
035900                                                                  03590000
036000     EXEC SQL                                                     03600000
036100        SELECT M.PO_NBR                                           03610000
036200             , M.ENT_ID                                           03620000
036300             , M.DEPT_NBR                                         03630000
036400             , E.ATTR_ELEM_TXT AS WST_DC_CONVERT_PARM_NAME        03640048
036500        INTO  :PURCHS-PO-NBR                                      03650000
036600            , :PURCHS-ENT-ID                                      03660000
036700            , :PURCHS-DEPT-NBR                                    03670000
036800            , :WST00008-INTGRTN-TYP-CDE                           03680000
036900        FROM                                                      03690000
037000             WST_INTGRTN_TYP  A                                   03700000
037100           , WST_ATTR_DEFN    B                                   03710000
037200           , WST_ATTR_ELEM    C      -- VENDOR NUMBER             03720000
037300           , WST_ATTR_ELEM    D      -- DEPARTMENT NUMBER         03730000
037400           , WST_ATTR_ELEM    E      -- WST DC CONVERT PARM NAME  03740000
037500           , WST_ATTR_ELEM    F      -- PO INSTRUCTION TYPE CODE  03750000
037600           , WST_ATTR_ELEM    G      -- PO INSTRUCTION START POSIT03760000
037700           , WST_ATTR_ELEM    H      -- PO INSTRUCTION TEXT LENGTH03770000
037800           , WST_ATTR_ELEM    I      -- PO INSTRUCTION TEXT VALUE 03780000
037900           , WST_ATTR_ELEM    J      -- BEGIN TIMESTAMP           03790000
038000           , WST_ATTR_ELEM    K      -- END TIMESTAMP             03800000
038100           , WST_ATTR_ELEM    L      -- AC/IN CODE                03810000
038200           , TPURCHS          M                                   03820000
038300           , TPOINST          N                                   03830000
038400           , TINSTCD          O                                   03840000
038500         WHERE                                                    03850000
038600               A.INTGRTN_TYP_CDE   = 'SEPH3PTVDP'                 03860000
038700           AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE            03870000
038800           AND B.ATTR_DEFN_SEQ_NBR = 1                            03880000
038900           AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE            03890000
039000           AND C.ATTR_DEFN_SEQ_NBR = 1                            03900000
039100           AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE            03910000
039200           AND D.ATTR_DEFN_SEQ_NBR = 2                            03920000
039300           AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE            03930000
039400           AND E.ATTR_DEFN_SEQ_NBR = 3                            03940000
039500           AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE            03950000
039600           AND F.ATTR_DEFN_SEQ_NBR = 4                            03960000
039700           AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE            03970000
039800           AND G.ATTR_DEFN_SEQ_NBR = 5                            03980000
039900           AND B.INTGRTN_TYP_CDE   = H.INTGRTN_TYP_CDE            03990000
040000           AND H.ATTR_DEFN_SEQ_NBR = 6                            04000000
040100           AND B.INTGRTN_TYP_CDE   = I.INTGRTN_TYP_CDE            04010000
040200           AND I.ATTR_DEFN_SEQ_NBR = 7                            04020000
040300           AND B.INTGRTN_TYP_CDE   = J.INTGRTN_TYP_CDE            04030000
040400           AND J.ATTR_DEFN_SEQ_NBR = 8                            04040000
040500           AND B.INTGRTN_TYP_CDE   = K.INTGRTN_TYP_CDE            04050000
040600           AND K.ATTR_DEFN_SEQ_NBR = 9                            04060000
040700           AND B.INTGRTN_TYP_CDE   = L.INTGRTN_TYP_CDE            04070000
040800           AND L.ATTR_DEFN_SEQ_NBR = 10                           04080000
040900           AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR          04090000
041000           AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR          04100000
041100           AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR          04110000
041200           AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR          04120000
041300           AND C.ATTR_ELEM_SEQ_NBR = H.ATTR_ELEM_SEQ_NBR          04130000
041400           AND C.ATTR_ELEM_SEQ_NBR = I.ATTR_ELEM_SEQ_NBR          04140000
041500           AND C.ATTR_ELEM_SEQ_NBR = J.ATTR_ELEM_SEQ_NBR          04150000
041600           AND C.ATTR_ELEM_SEQ_NBR = K.ATTR_ELEM_SEQ_NBR          04160000
041700           AND C.ATTR_ELEM_SEQ_NBR = L.ATTR_ELEM_SEQ_NBR          04170000
041800           AND J.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP            04180000
041900           AND K.ATTR_ELEM_TMST   >= CURRENT TIMESTAMP            04190000
042000           AND L.ATTR_ELEM_TXT     = 'AC'                         04200000
042100           AND M.PO_NBR            = :DK-PO-NBR                   04210000
042200           AND M.VER_STATUS_CDE    = 'A'                          04220000
042300           AND M.ENT_ID            = C.ATTR_ELEM_NBR              04230000
042400           AND M.DEPT_NBR          = D.ATTR_ELEM_TXT              04240000
042500           AND N.PO_NBR            = M.PO_NBR                     04250000
042600           AND N.RECIP_CDE         = F.ATTR_ELEM_TXT              04260000
042700           AND O.INSTR_NBR         = N.INSTR_NBR                  04270000
042800           AND SUBSTR(O.INSTR_DESC,G.ATTR_ELEM_NBR,               04280000
042900                      H.ATTR_ELEM_NBR) = I.ATTR_ELEM_TXT          04290000
043000        ORDER BY 1                                                04300000
043100        WITH UR                                                   04310000
043200     END-EXEC.                                                    04320000
043300                                                                  04330000
043400     EVALUATE TRUE                                                04340000
043500         WHEN SQLCODE = ZERO                                      04350000
043600             SET PS-PO-PROCESS-YES TO TRUE                        04360000
043700         WHEN SQLCODE = +100                                      04370000
043800             SET PS-PO-PROCESS-NO  TO TRUE                        04380000
044200         WHEN SQLWARN0 NOT = SPACES                               04420000
044300         WHEN SQLCODE < ZERO                                      04430000
044400         WHEN SQLCODE > ZERO                                      04440000
044500             MOVE '4000-SEL-3RD-PRTY-VND-POINST'                  04450000
044600                                          TO PV-PARAGRAPH-NAME    04460000
044700             MOVE 'PARM SEPH3PTVDP' TO PV-DB2-OPERATION-ATTEMPTED 04470000
044800             DISPLAY 'PO NBR  = ' DK-PO-NBR                       04480000
044900             PERFORM 9100-SQL-ABEND                               04490000
045000     END-EVALUATE.                                                04500000
045100                                                                  04510000
045200                                                                  04520000
045300******************************************************************04530000
045400* CHECK VALID VENDOR/DEPARTMENTS TO BE PROCESSED BY A THIRD PARTY 04540000
045500* SEPHORA THIRD PARTY VENDOR DEPARTMENT                           04550000
045600* KRPRPM-FUNC-TXT = 'N' THEN DO NOT JOIN THRU THE PO INSTRUCTIONS 04560000
045700* TABLES                                                          04570000
045800******************************************************************04580000
045900 4200-SEL-3RD-PARTY-VND-DPT.                                      04590000
046000                                                                  04600000
046100     MOVE TR302-PO-NBR    TO   DK-PO-NBR                          04610000
046200                                                                  04620000
046300     EXEC SQL                                                     04630000
046400        SELECT M.PO_NBR                                           04640000
046500             , M.ENT_ID                                           04650000
046600             , M.DEPT_NBR                                         04660000
046700             , E.ATTR_ELEM_TXT AS WST_DC_CONVERT_PARM_NAME        04670000
046800        INTO  :PURCHS-PO-NBR                                      04680000
046900            , :PURCHS-ENT-ID                                      04690000
047000            , :PURCHS-DEPT-NBR                                    04700000
047100            , :WST00008-INTGRTN-TYP-CDE                           04710000
047200        FROM                                                      04720000
047300             WST_INTGRTN_TYP  A                                   04730000
047400           , WST_ATTR_DEFN    B                                   04740000
047500           , WST_ATTR_ELEM    C      -- VENDOR NUMBER             04750000
047600           , WST_ATTR_ELEM    D      -- DEPARTMENT NUMBER         04760000
047700           , WST_ATTR_ELEM    E      -- WST DC CONVERT PARM NAME  04770000
047800           , WST_ATTR_ELEM    F      -- PO INSTRUCTION TYPE CODE  04780000
047900           , WST_ATTR_ELEM    G      -- PO INSTRUCTION START POSIT04790000
048000           , WST_ATTR_ELEM    H      -- PO INSTRUCTION TEXT LENGTH04800000
048100           , WST_ATTR_ELEM    I      -- PO INSTRUCTION TEXT VALUE 04810000
048200           , WST_ATTR_ELEM    J      -- BEGIN TIMESTAMP           04820000
048300           , WST_ATTR_ELEM    K      -- END TIMESTAMP             04830000
048400           , WST_ATTR_ELEM    L      -- AC/IN CODE                04840000
048500           , TPURCHS          M                                   04850000
048600         WHERE                                                    04860000
048700               A.INTGRTN_TYP_CDE   = 'SEPH3PTVDP'                 04870000
048800           AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE            04880000
048900           AND B.ATTR_DEFN_SEQ_NBR = 1                            04890000
049000           AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE            04900000
049100           AND C.ATTR_DEFN_SEQ_NBR = 1                            04910000
049200           AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE            04920000
049300           AND D.ATTR_DEFN_SEQ_NBR = 2                            04930000
049400           AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE            04940000
049500           AND E.ATTR_DEFN_SEQ_NBR = 3                            04950000
049600           AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE            04960000
049700           AND F.ATTR_DEFN_SEQ_NBR = 4                            04970000
049800           AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE            04980000
049900           AND G.ATTR_DEFN_SEQ_NBR = 5                            04990000
050000           AND B.INTGRTN_TYP_CDE   = H.INTGRTN_TYP_CDE            05000000
050100           AND H.ATTR_DEFN_SEQ_NBR = 6                            05010000
050200           AND B.INTGRTN_TYP_CDE   = I.INTGRTN_TYP_CDE            05020000
050300           AND I.ATTR_DEFN_SEQ_NBR = 7                            05030000
050400           AND B.INTGRTN_TYP_CDE   = J.INTGRTN_TYP_CDE            05040000
050500           AND J.ATTR_DEFN_SEQ_NBR = 8                            05050000
050600           AND B.INTGRTN_TYP_CDE   = K.INTGRTN_TYP_CDE            05060000
050700           AND K.ATTR_DEFN_SEQ_NBR = 9                            05070000
050800           AND B.INTGRTN_TYP_CDE   = L.INTGRTN_TYP_CDE            05080000
050900           AND L.ATTR_DEFN_SEQ_NBR = 10                           05090000
051000           AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR          05100000
051100           AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR          05110000
051200           AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR          05120000
051300           AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR          05130000
051400           AND C.ATTR_ELEM_SEQ_NBR = H.ATTR_ELEM_SEQ_NBR          05140000
051500           AND C.ATTR_ELEM_SEQ_NBR = I.ATTR_ELEM_SEQ_NBR          05150000
051600           AND C.ATTR_ELEM_SEQ_NBR = J.ATTR_ELEM_SEQ_NBR          05160000
051700           AND C.ATTR_ELEM_SEQ_NBR = K.ATTR_ELEM_SEQ_NBR          05170000
051800           AND C.ATTR_ELEM_SEQ_NBR = L.ATTR_ELEM_SEQ_NBR          05180000
051900           AND J.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP            05190000
052000           AND K.ATTR_ELEM_TMST   >= CURRENT TIMESTAMP            05200000
052100           AND L.ATTR_ELEM_TXT     = 'AC'                         05210000
052200           AND M.PO_NBR            = :DK-PO-NBR                   05220000
052300           AND M.VER_STATUS_CDE    = 'A'                          05230000
052400           AND M.ENT_ID            = C.ATTR_ELEM_NBR              05240000
052500           AND M.DEPT_NBR          = D.ATTR_ELEM_TXT              05250000
052600        ORDER BY 1                                                05260000
052700        WITH UR                                                   05270000
052800     END-EXEC.                                                    05280000
052900                                                                  05290000
053000     EVALUATE TRUE                                                05300000
053100         WHEN SQLCODE = ZERO                                      05310000
053200             SET PS-PO-PROCESS-YES TO TRUE                        05320000
053300         WHEN SQLCODE = +100                                      05330000
053400             SET PS-PO-PROCESS-NO  TO TRUE                        05340000
053500         WHEN SQLWARN0 NOT = SPACES                               05350000
053600         WHEN SQLCODE < ZERO                                      05360000
053700         WHEN SQLCODE > ZERO                                      05370000
053800             MOVE '4200-SEL-3RD-PARTY-VND-DPT '                   05380000
053900                                          TO PV-PARAGRAPH-NAME    05390000
054000             MOVE 'PARM SEPH3PTVDP' TO PV-DB2-OPERATION-ATTEMPTED 05400000
054100             DISPLAY 'PO NBR  = ' DK-PO-NBR                       05410000
054200             PERFORM 9100-SQL-ABEND                               05420000
054300     END-EVALUATE.                                                05430000
054400                                                                  05440000
054500                                                                  05450000
054600******************************************************************05460000
054700* DEFINE THE VALID KOHL-S DC NUMBERS TO BE CONVERTED/ROLLED UP TO 05470000
054800* THE KOHLS DC NUMBER ASSIGNED TO THE THIRD PARTY LOCATION        05480000
054900******************************************************************05490000
055000 4400-SEL-DC-3RD-PARTY-LOC.                                       05500000
055100                                                                  05510000
055200     SET PS-DC-LOCATION-NOT-FND TO TRUE                           05520000
055300                                                                  05530000
055400     EXEC SQL                                                     05540000
055500        SELECT                                                    05550000
055600             D.ATTR_ELEM_NBR                                      05560000
055700        INTO :WST00010-ATTR-ELEM-NBR                              05570000
055800        FROM                                                      05580000
055900             WST_INTGRTN_TYP  A                                   05590000
056000           , WST_ATTR_DEFN    B                                   05600000
056100           , WST_ATTR_ELEM    C      -- KOHL-S DC NUMBER          05610000
056200           , WST_ATTR_ELEM    D      -- KOHL-S DC NUMBER A        05620000
056300           , WST_ATTR_ELEM    E      -- EFFECTIVE BEGIN DA        05630000
056400           , WST_ATTR_ELEM    F      -- EFFECTING END DATE        05640000
056500           , WST_ATTR_ELEM    G      -- PARM STATUS CODE (        05650000
056600        WHERE                                                     05660000
056700          A.INTGRTN_TYP_CDE   = :WST00008-INTGRTN-TYP-CDE         05670000
056800          AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE             05680000
056900          AND B.ATTR_DEFN_SEQ_NBR = 1                             05690000
057000          AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE             05700000
057100          AND C.ATTR_DEFN_SEQ_NBR = 1                             05710000
057200          AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE             05720000
057300          AND D.ATTR_DEFN_SEQ_NBR = 2                             05730000
057400          AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE             05740000
057500          AND E.ATTR_DEFN_SEQ_NBR = 3                             05750000
057600          AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE             05760000
057700          AND F.ATTR_DEFN_SEQ_NBR = 4                             05770000
057800          AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE             05780000
057900          AND G.ATTR_DEFN_SEQ_NBR = 5                             05790000
058000          AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR           05800000
058100          AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR           05810000
058200          AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR           05820000
058300          AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR           05830000
058400          AND E.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP             05840000
058500          AND F.ATTR_ELEM_TMST   >= CURRENT TIMESTAMP             05850000
058600          AND G.ATTR_ELEM_TXT     = 'AC'                          05860000
058700          AND C.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID               05870000
058800        WITH UR                                                   05880000
058900     END-EXEC.                                                    05890000
059000                                                                  05900000
059100     EVALUATE TRUE                                                05910000
059200         WHEN SQLCODE = ZERO                                      05920000
059300             MOVE WST00010-ATTR-ELEM-NBR TO PV-SAVE-DC-NBR        05930055
059500             SET PS-DC-LOCATION-FOUND TO TRUE                     05950000
059600         WHEN SQLCODE = +100                                      05960000
059700             SET PS-DC-LOCATION-NOT-FND TO TRUE                   05970000
059800         WHEN SQLWARN0 NOT = SPACES                               05980000
059900         WHEN SQLCODE < ZERO                                      05990000
060000         WHEN SQLCODE > ZERO                                      06000000
060100             MOVE '4400-SEL-DC-3RD-PARTY-LOC'                     06010000
060200                                          TO PV-PARAGRAPH-NAME    06020000
060300             MOVE 'SELECT DC LOC  ' TO PV-DB2-OPERATION-ATTEMPTED 06030000
060400             DISPLAY 'SEL PARM= ' WST00010-ATTR-ELEM-TXT-TEXT     06040000
060500             DISPLAY 'DC LOC  = ' DK-OPER-UNT-ID                  06050000
060600             PERFORM 9100-SQL-ABEND                               06060000
060700     END-EVALUATE.                                                06070000
060800                                                                  06080000
060900                                                                  06090000
060910******************************************************************06091009
060920* CHECK PO SPLIT HISTORY TABLE FOR PREVIOUS SPLIT ITEM QUANTITY   06092049
060940******************************************************************06094009
060950 5000-SEL-PREV-SPLIT-HIST.                                        06095021
060960                                                                  06096009
060980     MOVE TR302-PO-NBR        TO  TRT00001-PO-NBR                 06098011
060981     MOVE TR302-DC-NBR        TO  TRT00001-DC-NBR                 06098111
060982     MOVE TR302-ORIGIN-ENT-ID TO  TRT00001-ENT-ID                 06098211
060983                                                                  06098309
060990     EXEC SQL                                                     06099009
060991        SELECT                                                    06099120
060992             DC_ALLOC_QTY                                         06099209
060993           , DC_DROP_IND                                          06099352
060994        INTO :TRT00001-DC-ALLOC-QTY                               06099452
060995           , :TRT00001-DC-DROP-IND                                06099552
061002        FROM   TRT_MANU_PO_HIST                                   06100209
061003        WHERE  PO_NBR     = :TRT00001-PO-NBR                      06100311
061004        AND    DC_NBR     = :TRT00001-DC-NBR                      06100411
061005        AND    ENT_ID     = :TRT00001-ENT-ID                      06100511
061006        AND    MANU_DAT_LOD_TMST =                                06100609
061007                           (SELECT MAX(MANU_DAT_LOD_TMST)         06100709
061008                             FROM  TRT_MANU_PO_HIST               06100809
061009                             WHERE PO_NBR = :TRT00001-PO-NBR      06100911
061010                             AND   DC_NBR = :TRT00001-DC-NBR      06101011
061011                             AND   ENT_ID = :TRT00001-ENT-ID )    06101111
061012        ORDER BY CRE_TMST DESC                                    06101279
061013        FETCH FIRST 1 ROW ONLY                                    06101379
061024        WITH UR                                                   06102409
061025     END-EXEC.                                                    06102509
061026                                                                  06102609
061027     EVALUATE TRUE                                                06102709
061028         WHEN SQLCODE = ZERO                                      06102809
061029         WHEN SQLCODE = 811                                       06102979
061030             IF TRT00001-DC-DROP-IND = 'Y'                        06103079
061031                MOVE ZEROES TO TR302-PREV-ITEM-QTY-N              06103179
061032             ELSE                                                 06103279
061033                MOVE TRT00001-DC-ALLOC-QTY                        06103379
061034                            TO TR302-PREV-ITEM-QTY-N              06103479
061035             END-IF                                               06103579
061039             SET PS-HIST-QTY-FOUND-YES TO TRUE                    06103952
061040         WHEN SQLCODE = +100                                      06104052
061041             PERFORM 5100-SEL-PREV-SPLIT-ENT                      06104152
061042             SET PS-HIST-QTY-FOUND-NO  TO TRUE                    06104252
061043         WHEN SQLWARN0 NOT = SPACES                               06104352
061044         WHEN SQLCODE < ZERO                                      06104452
061045         WHEN SQLCODE > ZERO                                      06104552
061046             MOVE '5000-SEL-PREV-SPLIT-HIST'                      06104652
061047                                          TO PV-PARAGRAPH-NAME    06104752
061048             MOVE 'SELECT SPLIT QTY' TO PV-DB2-OPERATION-ATTEMPTED06104852
061049             DISPLAY 'SEL DC-ALLOC-QTY ' TRT00001-PO-NBR          06104952
061050             DISPLAY 'DC LOC  = ' TRT00001-DC-NBR                 06105052
061051             PERFORM 9100-SQL-ABEND                               06105152
061052     END-EVALUATE.                                                06105252
061053                                                                  06105352
061054******************************************************************06105452
061055* IF THERE IS NO HISTORY ROW, THEN SELECT THE PREVIOUS SPLIT      06105552
061056* QUANTITY FROM THE TRT_MANU_PO_EXTR TABLE                        06105652
061057******************************************************************06105752
061058 5100-SEL-PREV-SPLIT-ENT.                                         06105852
061059                                                                  06105952
061060                                                                  06106052
061061     EXEC SQL                                                     06106152
061062        SELECT                                                    06106252
061063             DC_ALLOC_QTY                                         06106352
061064        INTO :TRT00001-DC-ALLOC-QTY                               06106452
061065        FROM   TRT_MANU_PO_EXTR                                   06106552
061066        WHERE  PO_NBR     = :TRT00001-PO-NBR                      06106652
061067        AND    DC_NBR     = :TRT00001-DC-NBR                      06106752
061068        AND    ENT_ID     = :TRT00001-ENT-ID                      06106852
061069        WITH UR                                                   06106952
061070     END-EXEC.                                                    06107052
061071                                                                  06107152
061072     EVALUATE TRUE                                                06107252
061073         WHEN SQLCODE = ZERO                                      06107352
061074             MOVE TRT00001-DC-ALLOC-QTY  TO TR302-PREV-ITEM-QTY-N 06107452
061075         WHEN SQLCODE = +100                                      06107552
061076             MOVE SPACE TO  TR302-PREV-ITEM-QTY                   06107652
061077         WHEN SQLWARN0 NOT = SPACES                               06107752
061078         WHEN SQLCODE < ZERO                                      06107852
061079         WHEN SQLCODE > ZERO                                      06107952
061080             MOVE '5100-SEL-PREV-SPLIT-ENT'                       06108052
061081                                          TO PV-PARAGRAPH-NAME    06108152
061082             MOVE 'SELECT SPLIT QTY' TO PV-DB2-OPERATION-ATTEMPTED06108252
061083             DISPLAY 'SEL DC-ALLOC-QTY ' TRT00001-PO-NBR          06108352
061084             DISPLAY 'DC LOC  = ' TRT00001-DC-NBR                 06108452
061085             PERFORM 9100-SQL-ABEND                               06108552
061086     END-EVALUATE.                                                06108652
061087                                                                  06108752
061088******************************************************************06108852
061089* PROCESS CURSOR FROM TRT_MANU_PO_EXTR                            06108952
061090* WHERE THE DC_QTY_CHGD_CDE = 'N'                                 06109052
061091* WILL RETURN THE DC ALLOCATIONS THAT WERE NOT CHANGED            06109152
061092******************************************************************06109252
061093 6000-PRCS-NO-DC-QTY-CHG.                                         06109352
061094      SET PS-END-NO-DCQTY-CHG-NO TO TRUE                          06109452
061095      MOVE TR302-LOAD-TIMESTAMP TO TRT00000-MANU-DAT-LOD-TMST     06109576
061096      PERFORM 6100-OPEN-NODCQTY-CHG-CSR                           06109652
061097      PERFORM 6200-PROCESS-DCQTY-CHG                              06109752
061098          UNTIL PS-END-NO-DCQTY-CHG-YES                           06109852
061099      PERFORM 6500-CLOSE-NODCQTY-CHG-CSR.                         06109952
061100                                                                  06110052
061101 6100-OPEN-NODCQTY-CHG-CSR.                                       06110152
061102                                                                  06110252
061103     EXEC SQL                                                     06110352
061104         OPEN NO_DCQTY_CHG_CSR                                    06110452
061105     END-EXEC.                                                    06110552
061106                                                                  06110652
061107     EVALUATE TRUE                                                06110752
061108         WHEN SQLCODE = ZERO                                      06110852
061109             CONTINUE                                             06110952
061110         WHEN SQLWARN0 NOT = SPACES                               06111052
061111         WHEN SQLCODE < ZERO                                      06111152
061112         WHEN SQLCODE > ZERO                                      06111252
061113             MOVE '6100-OPEN-NODCQTY-CHG-CSR '                    06111352
061114                                     TO PV-PARAGRAPH-NAME         06111452
061115             MOVE 'ATTEMPTING TO OPEN THE NO_DCQTY_CHG_CSR'       06111552
061116                                     TO PV-DB2-OPERATION-ATTEMPTED06111652
061117             PERFORM 9100-SQL-ABEND                               06111752
061118     END-EVALUATE.                                                06111852
061119                                                                  06111952
061120******************************************************************06112052
061121* FOR EACH ROW RETURNED FROM THE CURSOR, CHECK IF THE DC IS ON THE06112152
061122* DC LOCATION CONVERSION PARM.  IF THE PARM IS FOUND, WRITE THE   06112252
061123* NEW RECORD FOR THE 3RD PARTY LOCATION                           06112352
061124******************************************************************06112452
061125 6200-PROCESS-DCQTY-CHG.                                          06112552
061126      PERFORM 6300-FETCH-DCQTY-CHG-CSR                            06112652
061127                                                                  06112752
061128      IF PS-END-NO-DCQTY-CHG-YES                                  06112852
061129           CONTINUE                                               06112952
061130      ELSE                                                        06113052
061131         MOVE TRT00000-DC-NBR TO DK-OPER-UNT-ID                   06113152
061132         PERFORM 4400-SEL-DC-3RD-PARTY-LOC                        06113252
061133         IF PS-DC-LOCATION-FOUND                                  06113352
061134            PERFORM 6400-POPULATE-FIELDS                          06113452
061135            PERFORM 8000-WRITE-PO-DTL-REC-OUT                     06113552
061136                                                                  06113678
061138            MOVE TR302-TMS-PO-HDR-DTL-RECORD                      06113878
061139                                    TO PV-SAVE-RECORD             06113978
061140            MOVE TRT00000-DC-NBR    TO  PV-DC-NBR                 06114078
061141                                        PV-DEST-NAME              06114178
061142            MOVE 'Y' TO PV-CHANGES-IND                            06114278
061143            MOVE 'D' TO PV-DC-QTY-CHG-IND                         06114378
061144            MOVE +0 TO PV-REQ-ITEM-QTY                            06114478
061145            SET TR302-THRD-PRTY-PO-PRCS-NO TO TRUE                06114578
061146            PERFORM 8100-WRITE-PO-DTL-CANCEL-REC                  06114678
061150        END-IF                                                    06115052
061151      END-IF.                                                     06115152
061152                                                                  06115252
061153 6300-FETCH-DCQTY-CHG-CSR.                                        06115352
061154                                                                  06115452
061155     EXEC SQL                                                     06115552
061156        FETCH NO_DCQTY_CHG_CSR                                    06115652
061157          INTO :TRT00000-PO-NBR                                   06115752
061158              ,:TRT00000-DC-NBR                                   06115852
061159              ,:TRT00000-ENT-ID                                   06115952
061160              ,:TRT00000-STRT-SHIP-DTE                            06116052
061161              ,:TRT00000-CNCL-DTE                                 06116152
061162              ,:TRT00000-NW-STR-PO-IND                            06116252
061163              ,:TRT00000-DC-ALLOC-QTY                             06116352
061164              ,:TRT00000-STR-ALLOC-PO-IND                         06116452
061165              ,:TRT00000-PO-STAT-CDE                              06116552
061166              ,:TRT00000-DC-QTY-CHGD-CDE                          06116652
061167              ,:TRT00000-PO-STAT-CHGD-IND                         06116752
061168              ,:TRT00000-DC-DROP-IND                              06116852
061169              ,:TRT00000-MANU-DAT-LOD-TMST                        06116952
061170              ,:TRT00000-LAST-UPD-TMST                            06117052
061171              ,:TRT00000-ENT-NM                                   06117152
061172              ,:TRT00000-SEASET-SHRT-NM                           06117252
061173              ,:TRT00000-DTE-CHGD-IND                             06117352
061174              ,:TRT00000-NW-STR-PO-CHGD-IND                       06117452
061175              ,:TRT00000-SEASET-CHGD-IND                          06117552
061176              ,:TRT00000-STR-ALLOC-CHGD-IND                       06117652
061177              ,:TRT00000-INIT-PO-LOD-IND                          06117752
061178              ,:PV-REQ-LATE-DELY-DTE                              06117852
061179              ,:TRT00000-DEPT-NBR                                 06117952
061180              ,:TRT00000-DEPT-NBR-CHGD-IND                        06118052
061181              ,:TRT00000-MIN-CL-NBR                               06118152
061182              ,:TRT00000-MIN-CL-NBR-CHGD-IND                      06118252
061183     END-EXEC.                                                    06118352
061184                                                                  06118452
061185     EVALUATE TRUE                                                06118552
061186         WHEN SQLCODE = ZERO                                      06118652
061187             CONTINUE                                             06118752
061188         WHEN SQLCODE = +100                                      06118852
061189             SET PS-END-NO-DCQTY-CHG-YES  TO TRUE                 06118952
061190         WHEN SQLWARN0 NOT = SPACES                               06119052
061191         WHEN SQLCODE < ZERO                                      06119152
061192         WHEN SQLCODE > ZERO                                      06119252
061193             MOVE '6300-FETCH-DCQTY-CHG-CSR'                      06119352
061194                                     TO PV-PARAGRAPH-NAME         06119452
061195             MOVE 'ATTEMPTING TO FETCH THE DCQTY_CHG_CSR'         06119552
061196                                     TO PV-DB2-OPERATION-ATTEMPTED06119652
061197             PERFORM 9100-SQL-ABEND                               06119752
061198     END-EVALUATE.                                                06119852
061199                                                                  06119952
061200 6400-POPULATE-FIELDS.                                            06120052
061201                                                                  06120152
061202     MOVE SPACES TO TR302-TMS-PO-HDR-DTL-RECORD.                  06120252
061203                                                                  06120352
061204     MOVE TRT00000-ENT-NM            TO TR302-ENT-NAME.           06120452
061205     MOVE PV-SAVE-DC-NBR             TO TR302-DC-NBR              06120555
061206                                        TR302-DEST-NAME-NBR.      06120652
061207     SET  TR302-OPERATION-TYPE-MOD   TO TRUE.                     06120752
061208     MOVE PC-DC                      TO TR302-DC-PREFIX           06120852
061209                                       TR302-DEST-NAME-PREFIX.    06120952
061210     MOVE TRT00000-ENT-ID            TO TR302-ORIGIN-ENT-ID       06121052
061211                                        TR302-SUPPLIER-ENT-ID.    06121152
061212     MOVE TRT00000-PO-NBR            TO TR302-LINE-NBR            06121252
061213                                        TR302-PO-NBR              06121352
061214                                        TR302-PRODUCT-NAME.       06121452
061215     MOVE TRT00000-DEPT-NBR          TO TR302-DEPT-NBR.           06121552
061216     MOVE TRT00000-DEPT-NBR-CHGD-IND TO TR302-DEPT-NBR-CHGD-IND.  06121652
061217     MOVE TRT00000-MIN-CL-NBR        TO TR302-MIN-CL-NBR.         06121752
061218     MOVE TRT00000-MIN-CL-NBR-CHGD-IND                            06121852
061219                                     TO TR302-MIN-CL-NBR-CHGD-IND.06121952
061220     MOVE TRT00000-DC-ALLOC-QTY      TO TR302-REQ-ITEM-QTY        06122052
061221                                        TR302-PREV-ITEM-QTY-N.    06122152
061222     MOVE PV-REQ-LATE-DELY-DTE(1:4)  TO PV-REFORMAT-YEAR.         06122252
061223     MOVE PV-REQ-LATE-DELY-DTE(6:2)  TO PV-REFORMAT-MONTH.        06122352
061224     MOVE PV-REQ-LATE-DELY-DTE(9:2)  TO PV-REFORMAT-DAY.          06122452
061225     MOVE PV-REFORMATED-DATE         TO TR302-REQ-LATE-DELY-DTE.  06122552
061226                                                                  06122652
061227     MOVE TRT00000-PO-STAT-CDE       TO TR302-PO-STATUS-CDE.      06122752
061228     MOVE TRT00000-NW-STR-PO-IND     TO TR302-NEW-STORE-PO-IND.   06122852
061229     MOVE TRT00000-STR-ALLOC-PO-IND  TO                           06122952
061230                                     TR302-STORE-PO-ALLOCATED-IND.06123052
061231     MOVE TRT00000-SEASET-SHRT-NM    TO TR302-SEASET-SHRT-NM.     06123152
061232     MOVE TRT00000-MANU-DAT-LOD-TMST TO TR302-LOAD-TIMESTAMP.     06123252
061233                                                                  06123352
061234* CHANGE INDICATORS                                               06123452
061235     MOVE TRT00000-DC-QTY-CHGD-CDE    TO TR302-DC-QTY-CHG-IND.    06123552
061236     MOVE TRT00000-PO-STAT-CHGD-IND   TO TR302-PO-STATUS-CHG-IND. 06123652
061237     MOVE TRT00000-DC-DROP-IND        TO TR302-DC-DROP-IND.       06123752
061238     MOVE TRT00000-DTE-CHGD-IND       TO TR302-DATE-CHGD-IND.     06123852
061239     MOVE TRT00000-NW-STR-PO-CHGD-IND TO TR302-NW-STR-CHGD-IND.   06123952
061240     MOVE TRT00000-SEASET-CHGD-IND    TO TR302-SEASET-CHGD-IND.   06124052
061241     MOVE TRT00000-STR-ALLOC-CHGD-IND TO TR302-STR-ALLOC-CHGD-IND.06124152
061242     MOVE TRT00000-INIT-PO-LOD-IND    TO TR302-INIT-PO-LOD-IND.   06124252
061243                                                                  06124352
061244* SET SWITCH IF ANY CHANGE INDICATORS HAVE BEEN SET TO TRUE       06124452
061245     IF TR302-DC-QTY-CHG-INCREASE                                 06124552
061246     OR TR302-DC-QTY-CHG-DECREASE                                 06124652
061247     OR TR302-PO-STATUS-CHG-YES                                   06124752
061248     OR TR302-DC-DROP-IND-YES                                     06124852
061249     OR TR302-INIT-PO-LOD-YES                                     06124952
061250     OR TR302-DATE-CHGD-YES                                       06125052
061251     OR TR302-STR-ALLOC-CHGD-YES                                  06125152
061252          SET TR302-CHANGES-YES TO TRUE                           06125252
061253     ELSE                                                         06125352
061254          SET TR302-CHANGES-NO  TO TRUE                           06125452
061255     END-IF.                                                      06125552
061256                                                                  06125652
061257* IF DATE CHANGE, SET PO-LOD SWITCH TO TRUE SO PLANNING ITEM IS   06125752
061258* CREATED.  THIS IS A CHANGE FOR THE ARCHIVE PROCESS.             06125852
061259     IF TR302-DATE-CHGD-YES                                       06125952
061260          SET TR302-INIT-PO-LOD-YES TO TRUE                       06126052
061261     END-IF.                                                      06126152
061262                                                                  06126252
061263* REFORMAT DATES TO MM/DD/CCYY                                    06126352
061264     MOVE TRT00000-STRT-SHIP-DTE(1:4) TO PV-REFORMAT-YEAR.        06126452
061265     MOVE TRT00000-STRT-SHIP-DTE(6:2) TO PV-REFORMAT-MONTH.       06126552
061266     MOVE TRT00000-STRT-SHIP-DTE(9:2) TO PV-REFORMAT-DAY.         06126652
061267     MOVE PV-REFORMATED-DATE   TO TR302-REQ-EARLY-AVAIL-DTE.      06126752
061268                                                                  06126852
061269     PERFORM 6700-ADD-7DAYS-EARLY-DEL-DTE.                        06126952
061270     MOVE PLNSHP-DONT-SHIP-BEF-DTE(1:4)                           06127052
061271                                      TO PV-REFORMAT-YEAR.        06127152
061272     MOVE PLNSHP-DONT-SHIP-BEF-DTE(6:2)                           06127252
061273                                      TO PV-REFORMAT-MONTH.       06127352
061274     MOVE PLNSHP-DONT-SHIP-BEF-DTE(9:2)                           06127452
061275                                      TO PV-REFORMAT-DAY.         06127552
061276     MOVE PV-REFORMATED-DATE   TO TR302-REQ-EARLY-DELY-DTE.       06127652
061277                                                                  06127752
061278     MOVE TRT00000-CNCL-DTE(1:4)      TO PV-REFORMAT-YEAR.        06127852
061279     MOVE TRT00000-CNCL-DTE(6:2)      TO PV-REFORMAT-MONTH.       06127952
061280     MOVE TRT00000-CNCL-DTE(9:2)      TO PV-REFORMAT-DAY.         06128052
061281     MOVE PV-REFORMATED-DATE          TO TR302-REQ-LATE-AVAIL-DTE.06128152
061282                                                                  06128252
061283* SET CORRECT E-MAIL ADDRESS                                      06128352
061284     IF TR302-DC-NBR = '0085'                                     06128452
061285         MOVE '085COC@KOHLS.COM'      TO TR302-E-MAIL-ADDRESS     06128552
061286     ELSE                                                         06128652
061287         MOVE 'COC@KOHLS.COM'         TO TR302-E-MAIL-ADDRESS     06128752
061288     END-IF.                                                      06128852
061289                                                                  06128952
061290     SET TR302-THRD-PRTY-PO-PRCS-YES  TO TRUE.                    06129052
061291                                                                  06129152
061292 6500-CLOSE-NODCQTY-CHG-CSR.                                      06129252
061293     EXEC SQL                                                     06129352
061294          CLOSE NO_DCQTY_CHG_CSR                                  06129452
061295     END-EXEC.                                                    06129552
061296                                                                  06129652
061297     EVALUATE TRUE                                                06129752
061298         WHEN SQLCODE = ZERO                                      06129852
061299             CONTINUE                                             06129952
061300         WHEN SQLWARN0 NOT = SPACES                               06130052
061301         WHEN SQLCODE < ZERO                                      06130152
061302         WHEN SQLCODE > ZERO                                      06130252
061303             MOVE '6300-CLOSE-NODCQTY-CHG-CSR'                    06130352
061304                                     TO PV-PARAGRAPH-NAME         06130452
061305             MOVE 'ATTEMPTING TO CLOSE THE DCQTY_CHG_CSR'         06130552
061306                           TO PV-DB2-OPERATION-ATTEMPTED          06130652
061307             PERFORM 9100-SQL-ABEND                               06130752
061308     END-EVALUATE.                                                06130852
061309                                                                  06130952
061310*----------------------------------------------------------------*06131052
061311* GET EARLY DELIVERY DATE, WHICH CAN'T OVERLAP WITH SHIP DATE     06131152
061312*----------------------------------------------------------------*06131252
061313 6700-ADD-7DAYS-EARLY-DEL-DTE.                                    06131352
061314                                                                  06131452
061315         EXEC SQL                                                 06131552
061316           SELECT B.DONT_SHIP_BEF_DTE + 7 DAYS                    06131652
061317             INTO :PLNSHP-DONT-SHIP-BEF-DTE                       06131752
061318             FROM TPURCHS A,                                      06131852
061319                  TPLNSHP B                                       06131952
061320            WHERE A.PO_NBR         = :TRT00000-PO-NBR             06132052
061321              AND A.PO_NBR         = B.PO_NBR                     06132152
061322              AND A.VER_STATUS_CDE = 'A'                          06132252
061323              AND B.VER_STATUS_CDE = 'A'                          06132352
061324              AND A.PO_TYP_CDE      IN ('IN','SM','SP','ST',      06132452
061325                           'VN','EC','FB','CD','RE','VE')         06132552
061326              AND A.STATUS_CDE      IN ('AC','AP','CA','CM')      06132652
061327             WITH UR                                              06132752
061328         END-EXEC                                                 06132852
061329                                                                  06132952
061330         EVALUATE TRUE                                            06133052
061331             WHEN SQLCODE = ZERO                                  06133152
061332                 CONTINUE                                         06133252
061333             WHEN SQLCODE = +100                                  06133342
061334                 CONTINUE                                         06133443
061335             WHEN SQLWARN0 NOT = SPACES                           06133542
061336             WHEN SQLCODE < ZERO                                  06133642
061337             WHEN SQLCODE > ZERO                                  06133742
061338                 MOVE '6700-ADD-7DAYS-EARLY-DEL-DTE'              06133842
061339                                      TO  PV-PARAGRAPH-NAME       06133942
061340                 MOVE 'EARLY DELIVERY DATE '                      06134043
061341                                TO  PV-DB2-OPERATION-ATTEMPTED    06134143
061342                 MOVE TRT00000-PO-NBR  TO PURCHS-PO-NBR           06134242
061343                 MOVE TRT00000-ENT-ID  TO PURCHS-ENT-ID           06134342
061344                 PERFORM 9100-SQL-ABEND                           06134443
061345         END-EVALUATE.                                            06134542
061346                                                                  06134642
061347                                                                  06134724
061348******************************************************************06134824
061349* READ INPUT FILE.                                                06134924
061350******************************************************************06135000
061360 7000-READ-PO-HDR-DTL-FILE-IN.                                    06136000
061400                                                                  06140000
061500      INITIALIZE TR302-TMS-PO-HDR-DTL-RECORD.                     06150000
061600                                                                  06160000
061700      READ TMS-PO-HDR-DTL-FILE-IN INTO                            06170000
061800           TR302-TMS-PO-HDR-DTL-RECORD                            06180000
061900            AT END SET PS-END-OF-FILE TO TRUE.                    06190000
062000                                                                  06200000
062100      IF PS-END-OF-FILE                                           06210000
062200         CONTINUE                                                 06220000
062300      ELSE                                                        06230000
062400         ADD +1 TO PV-READ-COUNTER                                06240000
062500      END-IF.                                                     06250000
062600                                                                  06260000
062700******************************************************************06270000
062800* WRITE PO HEADER DETAIL FILE - COPYBOOK TRRD302.                 06280000
062900******************************************************************06290000
063000 8000-WRITE-PO-DTL-REC-OUT.                                       06300000
063100                                                                  06310000
063200                                                                  06320000
063300     WRITE  TMS-PO-HDR-DTL-RECORD-OUT                             06330000
063400      FROM  TR302-TMS-PO-HDR-DTL-RECORD                           06340000
063500     ADD    +1   TO PV-PO-RECORD-WRITE-COUNT.                     06350000
063600     MOVE   +0   TO PV-DCSPLIT-WORK-QTY.                          06360000
063700     SET   TR302-THRD-PRTY-PO-PRCS-NO TO TRUE.                    06370017
063800                                                                  06380000
063810******************************************************************06381055
063820* WRITE PO HEADER DETAIL FILE - COPYBOOK TRRD302.                 06382055
063830******************************************************************06383055
063840 8100-WRITE-PO-DTL-CANCEL-REC.                                    06384055
063860                                                                  06386055
063870     WRITE  TMS-PO-HDR-DTL-RECORD-OUT                             06387055
063880      FROM  PV-SAVE-RECORD.                                       06388058
063893                                                                  06389355
063894     ADD    +1   TO PV-PO-RECORD-WRITE-COUNT.                     06389478
063900******************************************************************06390000
065000******************************************************************06500000
065100* CLOSE FILES.   DISPLAY COUNTERS.                                06510000
065200******************************************************************06520000
065300 9000-EOJ-ROUTINE.                                                06530000
065400     CLOSE TMS-PO-HDR-DTL-FILE-IN                                 06540000
065500           TMS-PO-HDR-DTL-FILE-OUT.                               06550071
065600                                                                  06560000
065700     MOVE PV-READ-COUNTER          TO PV-DISPLAY-COUNT.           06570000
065800     DISPLAY 'TOTAL RECORDS READ.: '  PV-DISPLAY-COUNT.           06580000
065900     MOVE PV-PO-RECORD-WRITE-COUNT TO PV-DISPLAY-COUNT.           06590000
066000     DISPLAY 'PO RECORDS OUT.....: '  PV-DISPLAY-COUNT.           06600000
066100                                                                  06610000
066200     DISPLAY '*****  TRKUT304 ENDED  *****'.                      06620002
066300                                                                  06630000
066400******************************************************************06640000
066500* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL     06650000
066600* ERROR OR WARNING CODE OCCURS.                                   06660000
066700******************************************************************06670000
066800 9100-SQL-ABEND.                                                  06680000
066900     DISPLAY '9100-SQL-ABEND'.                                    06690000
067000     DISPLAY '** ABEND     **'.                                   06700000
067100     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        06710000
067200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              06720000
067300     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     06730000
067400     DISPLAY '** PO NUMBER ** = ' TR302-PO-NBR.                   06740000
067500                                                                  06750000
067600******************************************************************06760000
067700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    06770000
067800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         06780000
067900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     06790000
068000* FORMAT.                                                         06800000
068100******************************************************************06810000
068200     COPY DPPD004.                                                06820000
068300                                                                  06830000
068400     MOVE +4013                  TO ABEND-CODE.                   06840000
068500     CALL 'ILBOABN0' USING ABEND-CODE.                            06850000
068600                                                                  06860000
