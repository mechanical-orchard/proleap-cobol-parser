000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    POKCS106.                                         00020000
000300 AUTHOR.        TOM RUSKA. G&R.                                   00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  09-03-93.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*    W106 - PURCHASE ITEM SUMMARY LIST                          * 00090000
001000*                                                               * 00100000
001100*    THIS PROGRAM GENERATES A LIST OF PO LINE ITEMS ASSOCIATED  * 00110000
001200*    WITH A PURCHASE ORDER. IF THE LINE WAS RENUMBERED          * 00120000
      *    "*SKU RENUMBERED"  WILL SHOW UP IN READ ON THAT LINE       * 00130000
      *    THE USER CAN SELECT A SPECIFIC LINE TO INQUIRE ON IT OR    * 00140000
      *    PASS THAT LINE ITEM TO THE STORE ALLOCATION SCREEN.        * 00150000
001300*    TO INQUIRE ON IT OR PASS THAT LINE ITEM TO THE STORE       * 00160000
001400*    ALLOCATION SCREEN.                                         * 00170000
001500*                                                               * 00180000
001600*---------------------------------------------------------------* 00190000
001700*   05/25/99  TKMA318   CHRIS KUNSTAMNN  WR 4560                  00200000
001800*                                                                 00210000
001900*  CHANGED 'PERFORM 6100-UPDATE-TSQ UNTIL ' STMT TO USE           00220000
002000* PV-HOLD-SELECTED-ITEMS INSTEAD OF ASC-NUMBER-OF-SELECTED-ITEMS  00230000
002100* ASC-NUMBER-OF-SELECTED-ITEMS IS DECREMENTED IN THE 6110- PP.    00240000
002200*                                                                 00250000
002300*---------------------------------------------------------------* 00260000
W24803* 05/12/03 - S PRABHAKAR RAO, IGSI - WR NO. 24803               * 00270000
W24803*    - IN MAP POKM106 REPLACED DEPARTMENT, CLASS AND            * 00280000
W24803*      SEQUENCE NUMBER BY DEPARTMENT, MAJOR CLASS, SUB CLASS    * 00290000
W24803*      AND SKU NUMBER AND ADJUSTED THE POSITIONS OF OTHER FIELDS* 00300000
W24803*    - COPY BOOK POWS017 IS CHANGED.                            * 00310000
W24803*    - REPLACED TSK TABLE WITH XLT_SKU AND XLT_VND_STYL TABLES. * 00320000
W24803*    - REPLACED DEPARTMENT, CLASS AND 3 DIGIT SEQUENCE NUMBER   * 00330000
W24803*      WITH DEPARTMENT, SUB CLASS, MAJOR CLASS AND SKU NUMBER   * 00340000
W24803*      RESPECTIVELY FOR NI SKU CONVERSION.                      * 00350000
W24803*---------------------------------------------------------------* 00360000
C98147* 11/10/14 - LINDA FRIESS          - CHG0098147                   00370099
C98147*    - EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND COMMAREA.        00380099
C98147*---------------------------------------------------------------* 00390099
076319* DATE  10/27/2021                                                00391099
076320*            - CHANGE CALL OF 'DPKUT100' TO                     * 00392099
076321*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00393099
076322*              MAKING THE CALL DYNAMIC VS STATIC                * 00394099
076323*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126        00395099
076312*                                                               * 00396099
076318*---------------------------------------------------------------* 00396199
CICS  *  CHANGED 11/16/2022    BY BARB SCHULTZ    WR: CHG0278485      * 00396299
CICS  *                                                               * 00396399
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00396499
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00396599
CICS  *---------------------------------------------------------------* 00397099
003100                                                                  00400000
003200/                                                                 00410000
003300 ENVIRONMENT DIVISION.                                            00420000
003400                                                                  00430000
003500 DATA DIVISION.                                                   00440000
003600                                                                  00450000
003700 WORKING-STORAGE SECTION.                                         00460000
003800                                                                  00470000
003900 01  DK-DB2-KEYS.                                                 00480000
004000     05  DK-PO-NBR                 PIC S9(9) COMP VALUE +0.       00490000
004100     05  DK-PO-LNE-NBR             PIC S9(9) COMP VALUE +0.       00500000
004200     05  DK-ENT-ID                 PIC S9(9) COMP VALUE +0.       00510000
004400                                                                  00520000
004500 01  PC-PROGRAM-CONSTANTS.                                        00530000
004600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00540000
004700                                                    'PO106A  '.   00550000
004800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00560000
004900                                                    'POKM106 '.   00570000
005000     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00580000
005100                                                    'POKCS106'.   00590000
005200     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00600000
005300                                                    COMP.         00610000
005400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00620000
005500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00630000
005600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00640000
005700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +5      00650000
005800                                                    COMP SYNC.    00660000
005900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00670000
006000                                                    COMP SYNC.    00680000
006100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00690000
006200                                                    +1000000      00700000
006300                                                    COMP-3.       00710000
006400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00720000
006500                                                    COMP SYNC.    00730000
006600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00740000
006700                                                    COMP-3.       00750000
006800     05  PC-MAX-RETRIES-2               PIC S9(03)  VALUE +2      00760000
006900                                                    COMP-3.       00770000
007000     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00780000
008100     05  PC-TSYMSG-NUMBERS.                                       00790000
008200         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00800000
008300         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00810000
008400         10  PC-TSYMSG-00017            PIC  9(05)  VALUE 00017.  00820000
008500         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00830000
008600         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00840000
008700         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00850000
008800         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00860000
008900         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00870000
009000         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00880000
009100         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00890000
009200         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00900000
009300         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00910000
009400         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00920000
009500         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00930000
009600         10  PC-TSYMSG-00168            PIC  9(05)  VALUE 00168.  00940000
009700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00950000
009800         10  PC-TSYMSG-00310            PIC  9(05)  VALUE 00310.  00960000
009900         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  00970000
010000         10  PC-TSYMSG-00461            PIC  9(05)  VALUE 00461.  00980000
010100         10  PC-TSYMSG-00486            PIC  9(05)  VALUE 00486.  00990000
010200         10  PC-TSYMSG-00587            PIC  9(05)  VALUE 00587.  01000000
010300         10  PC-TSYMSG-00588            PIC  9(05)  VALUE 00588.  01010000
010400         10  PC-TSYMSG-01773            PIC  9(05)  VALUE 01773.  01020000
010500                                                                  01030000
010600 01  PS-PROGRAM-SWITCHES.                                         01040000
010700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01050000
010800         88  PS-NO-ERROR                            VALUE 'Y'.    01060000
010900         88  PS-ERROR                               VALUE 'N'.    01070000
011000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01080000
011100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01090000
011200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01100000
011300     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01110000
011400         88  PS-DONE                                VALUE 'Y'.    01120000
011500         88  PS-NOT-DONE                            VALUE 'N'.    01130000
011600     05  PS-SKIP-SW                     PIC  X(01)  VALUE 'N'.    01140000
011700         88  PS-DONT-SKIP                           VALUE 'N'.    01150000
011800         88  PS-SKIP                                VALUE 'Y'.    01160000
011900                                                                  01170000
012000 01  PV-PROGRAM-VARIABLES.                                        01180000
012100     05  PV-SUB                         PIC S9(04)  VALUE +0      01190000
012200                                                    COMP SYNC.    01200000
012300     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01210000
012400                                                    COMP SYNC.    01220000
012500     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01230000
012600                                                    COMP-3.       01240000
012700     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01250000
012800                                                    COMP-3.       01260000
012900     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01270000
013000                                                    COMP-3.       01280000
013100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01290000
013200                                                    COMP-3.       01300000
013300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01310000
013400                                                    COMP-3.       01320000
013500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01330000
013600                                                    COMP-3.       01340000
013700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01350000
013800                                                    COMP-3.       01360000
013900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01370000
014000                                                    COMP SYNC.    01380000
014100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01390000
014200                                                    COMP SYNC.    01400000
014300     05  PV-ITEM                        PIC S9(04)  VALUE +0      01410000
014400                                                    COMP SYNC.    01420000
014500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01430000
014600                                                    COMP SYNC.    01440000
014700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01450000
014800                                                    COMP SYNC.    01460000
014900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01470000
015000                                                    COMP SYNC.    01480000
015100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01490000
015200                                                    COMP SYNC.    01500000
015300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01510000
015400                                                    COMP SYNC.    01520000
015500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01530000
015600                                                    COMP SYNC.    01540000
015700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01550000
015800                                                    COMP SYNC.    01560000
015900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01570000
016000                                                    COMP SYNC.    01580000
016100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01590000
016200                                                    COMP SYNC.    01600000
016300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01610000
016400                                                    COMP SYNC.    01620000
016500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01630000
016600                                                    COMP SYNC.    01640000
016700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01650000
016800                                                    COMP SYNC.    01660000
016900     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      01670000
017000                                                    COMP-3.       01680000
017100     05  PV-VER-QTY-NULL                PIC S9(04)  VALUE +0      01690000
017200                                                    COMP SYNC.    01700000
017300     05  PV-ASN-QTY-NULL                PIC S9(04)  VALUE +0      01710000
017400                                                    COMP SYNC.    01720000
017500     05  PV-ALLOC-NULL                  PIC S9(04)  VALUE +0      01730000
017600                                                    COMP SYNC.    01740000
017700     05  PV-ALLOC-ALLPLN-NULL           PIC S9(04)  VALUE +0      01750000
017800                                                    COMP SYNC.    01760000
017900     05  PV-PO-LNE-NBR                  PIC S9(09)  VALUE +0      01770000
018000                                                    COMP.         01780000
018100     05  PV-ASN-PO-LN-NBR               PIC S9(03)V VALUE +0      01790000
018200                                                    COMP-3.       01800000
018300     05  PV-ASN-PO-NBR                  PIC X(22)   VALUE SPACES. 01810000
018400     05  PV-ASN-PO-NBR-6                PIC X(22)   VALUE SPACES. 01820000
018500     05  PV-PO-NBR9                     PIC 9(10)   VALUE ZEROES. 01830000
019800     05  PV-SLASH-DATE.                                           01840000
019900         10  PV-SL-DATE.                                          01850000
020000             15  PV-SL-DATE-MM     PIC X(02).                     01860000
020100             15  FILLER            PIC X(01)    VALUE '/'.        01870000
020200             15  PV-SL-DATE-DD     PIC X(02).                     01880000
020300             15  FILLER            PIC X(01)    VALUE '/'.        01890000
020400             15  PV-SL-DATE-YY     PIC X(02).                     01900000
020500         10  PV-SL-DATE-CC         PIC X(02).                     01910000
W24803     05  PV-DEPT                        PIC 9(04)   VALUE 0.      01920000
W24803     05  PV-MAJ-CL.                                               01930000
W24803         10 FILLER                      PIC 9(02)   VALUE 0.      01940000
W24803         10 PV-MAJ-CL-3                 PIC 9(01)   VALUE 0.      01950000
W24803         10 FILLER                      PIC 9(01)   VALUE 0.      01960000
W24803     05  PV-MAJ-CLASS REDEFINES PV-MAJ-CL                         01970000
W24803                                        PIC 9(04).                01980000
W24803     05  PV-MAJ-CL-NBR-BEG              PIC S9(04)V COMP-3.       01990000
W24803     05  PV-MAJ-CL-NBR-END              PIC S9(04)V COMP-3.       02000000
W24803     05  PV-SUB-CL-NBR-BEG              PIC S9(04)V COMP-3.       02010000
W24803     05  PV-SUB-CL-NBR-END              PIC S9(04)V COMP-3.       02020000
W24803     05  PV-SUB-CL.                                               02030000
W24803         10 FILLER                      PIC 9(02)   VALUE ZERO.   02040000
W24803         10 PV-SUB-CL-3-4               PIC 9(02)   VALUE ZERO.   02050000
W24803     05  PV-SUB-CLASS REDEFINES PV-SUB-CL                         02060000
W24803                                        PIC 9(04).                02070000
020600                                                                  02080000
020700*---------------------------------------------------------------* 02090000
020800*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 02100000
020900*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 02110000
021000*   APPLICATION-SPECIFIC COMMAREA.                              * 02120000
021100*---------------------------------------------------------------* 02130000
021200 01  LQW-LIST-QUEUE-WORK-AREA.                                    02140000
021300     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  02150000
021400     05  LQW-ITEM-ENTRIES               OCCURS 5 TIMES            02160000
021500                                        INDEXED BY LQW-IDX.       02170000
021600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02180000
021700         10  LQW-TEMP-SELECTED-SW       PIC X(01).                02190000
021800         10  LQW-SELECTED-SW            PIC X(01).                02200000
021900             88  LQW-SELECT                         VALUE 'S'.    02210000
022000             88  LQW-DESELECT                       VALUE ' '.    02220000
022100         10  LQW-PO-LNE-NBR             PIC 9(03).                02230000
022200         10  LQW-APP-PO-LNE-NBR         PIC 9(03).                02240000
022300         10  LQW-PO-LNE-VAR-NBR         PIC 9(03).                02250000
022400         10  LQW-DEPT-NBR               PIC 9(03).                02260000
W24803         10  LQW-MAJ-CL-NBR             PIC X(02).                02270000
W24803         10  LQW-SUB-CL-NBR             PIC X(02).                02280000
W24803         10  LQW-SKU-NBR                PIC X(08).                02290000
022700         10  LQW-VEND-DESC              PIC X(20).                02300000
               10  LQW-SIZE-DESC              PIC X(20).                02310000
022900         10  LQW-UNT-QTY                PIC 9(06).                02320000
023500         10  LQW-COLOR-DESC             PIC X(25).                02330000
023700                                                                  02340000
023800/                                                                 02350000
023900*---------------------------------------------------------------* 02360000
024000*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02370000
024100*---------------------------------------------------------------* 02380000
024200                                                                  02390000
024300     COPY POWS012.                                                02400000
024400                                                                  02410000
024500/                                                                 02420000
024600*---------------------------------------------------------------* 02430000
024700*    MAP LAYOUT                                                 * 02440000
024800*---------------------------------------------------------------* 02450000
024900                                                                  02460000
025000     COPY POKM106.                                                02470000
025100                                                                  02480000
025200 01  MR-OCCURS-LAYOUT                   REDEFINES  PO106AO.       02490000
025300     05  FILLER                         PIC X(48).                02500000
025400                                                                  02510000
025500     05  FILLER                         PIC X(05).                02520000
025600     05  MR-PO-NBR-X.                                             02530000
C98147         10  MR-PO-NBR                  PIC Z(8).                 02540099
025800                                                                  02550000
025900     05  FILLER                         PIC X(05).                02560000
026000     05  MR-DEPT-NBR                    PIC X(3).                 02570000
026100                                                                  02580000
026200     05  FILLER                         PIC X(05).                02590000
026300     05  MR-ENT-NAME-DESC               PIC X(30).                02600000
027200                                                                  02610000
027300     05  MR-SCROLL-AREA                 OCCURS 5 TIMES.           02620000
027400         10  MR-SELECTL                 PIC S9(04) COMP.          02630000
027500         10  MR-SELECTA                 PIC X(01).                02640000
027600         10  MR-SELECTC                 PIC X(01).                02650000
027700         10  MR-SELECTH                 PIC X(01).                02660000
027800         10  MR-SELECT                  PIC X(01).                02670000
027900                                                                  02680000
028000         10  FILLER                     PIC X(05).                02690000
028100         10  MR-PO-LNE-NBR-X.                                     02700000
028200             15  MR-PO-LNE-NBR          PIC ZZZ.                  02710000
028300                                                                  02720000
028400         10  FILLER                     PIC X(05).                02730000
028500         10  MR-DEPT                    PIC X(03).                02740000
028600                                                                  02750000
W24803         10  FILLER                     PIC X(05).                02760000
W24803         10  MR-MAJ-CL-NBR-X.                                     02770000
W24803             15  MR-MAJ-CL-NBR          PIC X(02).                02780000
028700         10  FILLER                     PIC X(05).                02790000
W24803         10  MR-SUB-CL-NBR-X.                                     02800000
W24803             15  MR-SUB-CL-NBR          PIC X(02).                02810000
029000                                                                  02820000
029100         10  FILLER                     PIC X(05).                02830000
W24803         10  MR-SKU-NBR-X.                                        02840000
W24803             15  MR-SKU-NBR             PIC X(08).                02850000
029400                                                                  02860000
029500         10  FILLER                     PIC X(05).                02870000
029600         10  MR-VEND-DESC               PIC X(20).                02880000
029700                                                                  02890000
029500         10  FILLER                     PIC X(05).                02900000
029600         10  MR-SIZE-DESC               PIC X(20).                02910000
                                                                        02920000
030100         10  FILLER                     PIC X(05).                02930000
030200         10  MR-UNT-QTY-X.                                        02940000
030300             15  MR-UNT-QTY             PIC Z(6).                 02950000
030400                                                                  02960000
032200         10  FILLER                     PIC X(05).                02970000
032300         10  MR-COLOR-DESC              PIC X(25).                02980000
 32700                                                                  02990000
032800/                                                                 03000000
032900*---------------------------------------------------------------* 03010000
033000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03020000
033100*---------------------------------------------------------------* 03030000
033200                                                                  03040000
033300     COPY DPWS015.                                                03050000
033400                                                                  03060000
033500*---------------------------------------------------------------* 03070000
033600*    FUNCTION KEYS COPYBOOK.                                    * 03080000
033700*---------------------------------------------------------------* 03090000
033800                                                                  03100000
033900     COPY DPWS016.                                                03110000
034000                                                                  03120000
034100*---------------------------------------------------------------* 03130000
034200*    NUMERIC EDIT LAYOUT.                                       * 03140000
034300*---------------------------------------------------------------* 03150000
034400                                                                  03160000
034500     COPY DPWS010I.                                               03170000
034600                                                                  03180000
034700/                                                                 03190000
034800*---------------------------------------------------------------* 03200000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03210099
035000*---------------------------------------------------------------* 03220000
035100                                                                  03230000
035200     COPY DPWS030.                                                03240000
CICS       COPY DPWS930.                                                03241099
035300                                                                  03250000
035400/                                                                 03260000
035500*---------------------------------------------------------------* 03270000
035600*    STANDARD COMMAREA.                                         * 03280000
035700*---------------------------------------------------------------* 03290000
035800                                                                  03300000
035900     COPY DPWS020.                                                03310000
036000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03320000
036100                                                                  03330000
036200*---------------------------------------------------------------* 03340000
036300* INTER-APPLICATION COMMAREA.                                   * 03350000
036400*---------------------------------------------------------------* 03360000
036500                                                                  03370000
036600         10  INTER-APPL-COMM-AREA       PIC X(200).               03380000
036700     COPY POWS013.                                                03390000
036800     COPY POWS017.                                                03400000
036900*---------------------------------------------------------------* 03410000
037000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03420000
037100*---------------------------------------------------------------* 03430000
037200         10  ASC-SPECIFIC-COMMAREA.                               03440000
037300             15  ASC-LIST-KEYS.                                   03450000
037400                 20  ASC-KEY-PO-NBR        PIC S9(9) COMP.        03460000
037500                 20  ASC-KEY-ENT-ID        PIC S9(9) COMP.        03470000
037600                 20  ASC-KEY-DEPT-NBR      PIC X(3).              03480000
037700                 20  ASC-KEY-ENT-NAME-DESC PIC X(30).             03490000
037800             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           03500000
037900                 20  ASC-BLOCK-MODIFIED-SW                        03510000
038000                                        PIC X(01).                03520000
038100                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     03530000
038200                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     03540000
038300                                                                  03550000
038400                 20  ASC-ITEM-ARRAY.                              03560000
038500                     25  ASC-ITEM-ENTRIES OCCURS 5 TIMES.         03570000
038600                         30  ASC-LIST-ITEM-NUMBER                 03580000
038700                                        PIC S9(09) COMP-3.        03590000
038800                         30  ASC-TEMP-SELECTED-SW                 03600000
038900                                        PIC X(01).                03610000
039000                             88  ASC-VALID-SELECT  VALUE ' '      03620000
039100                                                         'S'      03630000
039200                                                         'B'      03640000
039300                                                         'E'.     03650000
039400                             88  ASC-TEMP-NO-SELECT               03660000
039500                                                   VALUE ' '.     03670000
039600                             88  ASC-TEMP-SELECT   VALUE 'S'.     03680000
039700                             88  ASC-TEMP-BEGIN    VALUE 'B'.     03690000
039800                             88  ASC-TEMP-END      VALUE 'E'.     03700000
039900                         30  ASC-SELECTED-SW                      03710000
040000                                        PIC X(01).                03720000
040100                             88  ASC-NO-SELECT     VALUE ' '.     03730000
040200                             88  ASC-SELECT        VALUE 'S'.     03740000
040300                             88  ASC-BEGIN         VALUE 'B'.     03750000
040400                             88  ASC-END           VALUE 'E'.     03760000
040500                         30  ASC-PO-LNE-NBR     PIC 9(03).        03770000
040600                         30  ASC-APP-PO-LNE-NBR PIC 9(03).        03780000
040700                         30  ASC-PO-LNE-VAR-NBR PIC 9(03).        03790000
040800                         30  ASC-DEPT-NBR       PIC 9(03).        03800000
W24803                         30  ASC-MAJ-CL-NBR     PIC 9(02).        03810000
W24803                         30  ASC-SUB-CL-NBR     PIC 9(02).        03820000
W24803                         30  ASC-SKU-NBR        PIC 9(08).        03830000
041100                         30  ASC-VEND-DESC      PIC X(20).        03840000
041200                         30  ASC-SIZE-DESC      PIC X(20).        03850000
041300                         30  ASC-UNT-QTY        PIC 9(06).        03860000
042100                         30  ASC-COLOR-DESC     PIC X(25).        03870000
042300                                                                  03880000
042400             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     03890000
042500             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     03900000
042600             15  ASC-NUMBER-OF-ITEMS-READ                         03910000
042700                                        PIC S9(09) COMP-3.        03920000
042800             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03930000
042900                                        PIC S9(09) COMP-3.        03940000
043000             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        03950000
043100             15  ASC-ITEM-AT-TOP-OF-PANEL                         03960000
043200                                        PIC S9(09) COMP-3.        03970000
043300             15  ASC-ITEM-AT-BOT-OF-PANEL                         03980000
043400                                        PIC S9(09) COMP-3.        03990000
043500             15  ASC-HIGHEST-BLOCK-WRITTEN                        04000000
043600                                        PIC S9(04) COMP SYNC.     04010000
043700             15  ASC-START-OF-SELECTED-RANGE                      04020000
043800                                        PIC S9(09) COMP-3.        04030000
043900             15  ASC-END-OF-SELECTED-RANGE                        04040000
044000                                        PIC S9(09) COMP-3.        04050000
044100             15  ASC-ITEMS-LEFT-INDICATOR                         04060000
044200                                        PIC X(01).                04070000
044300                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     04080000
044400                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     04090000
044500             15  ASC-TEMP-QUEUE-UPDATE-SW                         04100000
044600                                        PIC X(01).                04110000
044700                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     04120000
044800                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04130000
044900             15  ASC-LIST-QUEUE-NAME.                             04140000
045000                 20  ASC-LIST-TERM-ID   PIC X(04).                04150000
045100                 20  ASC-LIST-TASK-NUMBER                         04160000
045200                                        PIC S9(05) COMP-3.        04170000
045300                 20  ASC-LIST-SEQ       PIC 9(01).                04180000
045400             15  ASC-SEL-QUEUE-NAME.                              04190000
045500                 20  ASC-SEL-TERM-ID    PIC X(04).                04200000
045600                 20  ASC-SEL-TASK-NUMBER                          04210000
045700                                        PIC S9(05) COMP-3.        04220000
045800                 20  ASC-SEL-SEQ        PIC 9(01).                04230000
045900                                                                  04240000
046000             15  ASC-CURSOR-SW          PIC X(01).                04250000
046100                 88  ASC-NO-CURSOR                 VALUE 'N'.     04260000
046200                 88  ASC-ITEM-CURSOR               VALUE 'I'.     04270000
046300                 88  ASC-APP-ITEM-CURSOR           VALUE 'A'.     04280000
046400             15  ASC-START-ITEM-REQUEST.                          04290000
046500                 20  ASC-START-ITEM-REQUEST-N                     04300000
046600                                        PIC 9(07).                04310000
046700             15  ASC-TOT-UNT-QTY        PIC 9(07).                04320000
046800             15  ASC-TOT-SKUS-QTY       PIC 9(03).                04330000
046900             15  ASC-PO-TYP-CDE         PIC X(02).                04340000
W24803         10  FILLER                     PIC X(1726).              04350000
047200/                                                                 04360000
047300*---------------------------------------------------------------* 04370000
047400*    ABEND PROCESSING COPYBOOK.                                 * 04380000
047500*---------------------------------------------------------------* 04390000
047600                                                                  04400000
047700     COPY DPWS013.                                                04410000
047800                                                                  04420000
047900/                                                                 04430000
048000*---------------------------------------------------------------* 04440000
048100*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 04450000
048200*---------------------------------------------------------------* 04460000
048300     EXEC SQL                                                     04470000
048400          INCLUDE TPURCHS                                         04480000
048500     END-EXEC.                                                    04490000
048600                                                                  04500000
048700/                                                                 04510000
048800*---------------------------------------------------------------* 04520000
048900*    DB2 AREA FOR THE PURCHASE ORDER LINE ITEM TABLE            * 04530000
049000*---------------------------------------------------------------* 04540000
049100     EXEC SQL                                                     04550000
049200          INCLUDE TPURITM                                         04560000
049300     END-EXEC.                                                    04570000
049400                                                                  04580000
049500/                                                                 04590000
049600*---------------------------------------------------------------* 04600000
049700*    DB2 AREA FOR THE ENTERPRISE NAME TABLE                     * 04610000
049800*---------------------------------------------------------------* 04620000
049900     EXEC SQL                                                     04630000
050000          INCLUDE TENTNME                                         04640000
050100     END-EXEC.                                                    04650000
050200                                                                  04660000
050300/                                                                 04670000
W24803*---------------------------------------------------------------* 04680000
W24803*    DB2 AREA FOR THE XLT_SKU TABLE                             * 04690000
W24803*---------------------------------------------------------------* 04700000
W24803     EXEC SQL                                                     04710000
W24803          INCLUDE XLT00003                                        04720000
W24803     END-EXEC.                                                    04730000
W24803                                                                  04740000
W24803/                                                                 04750000
W24803*---------------------------------------------------------------* 04760000
W24803*    DB2 AREA FOR THE XLT_VND_STYL TABLE                        * 04770000
W24803*---------------------------------------------------------------* 04780000
W24803     EXEC SQL                                                     04790000
W24803          INCLUDE XLT00004                                        04800000
W24803     END-EXEC.                                                    04810000
W24803                                                                  04820000
W24803/                                                                 04830000
056000*---------------------------------------------------------------* 04840000
056100*    DB2 AREA FOR COMMUNICATIONS                                * 04850000
056200*---------------------------------------------------------------* 04860000
056300     EXEC SQL                                                     04870000
056400          INCLUDE SQLCA                                           04880000
056500     END-EXEC.                                                    04890000
056600                                                                  04900000
056700/                                                                 04910000
056800*---------------------------------------------------------------* 04920000
056900*  CURSOR TO SELECT LINE ITEMS WHEN PO IS NOT APPROVED          * 04930000
057000*---------------------------------------------------------------* 04940000
057100                                                                  04950000
057200     EXEC SQL                                                     04960000
057300          DECLARE ITEM-CSR CURSOR FOR                             04970000
057400          SELECT A.PO_LNE_NBR                                     04980000
W24803                ,V.MAJ_CL_NBR                                     04990000
W24803                ,V.SUB_CL_NBR                                     05000000
W24803                ,S.SKU_NBR                                        05010000
W24803                ,S.CSTM_CLOR_DESC                                 05020000
W24803                ,S.SIZE_DESC                                      05030000
W24803                ,S.SKU_DESC                                       05040000
058000                ,A.UNT_QTY                                        05050000
058200                ,A.APP_PO_LNE_NBR                                 05060000
058300            FROM TPURITM A                                        05070000
W24803                ,XLT_SKU S                                        05080000
W24803                ,XLT_VND_STYL V                                   05090000
W24803          WHERE A.PO_NBR         = :PURITM-PO-NBR                 05100000
                  AND A.STATUS_CDE    ^= 'CA'                           05110000
058500            AND A.VER_STATUS_CDE = 'A'                            05120000
W24803            AND A.ITM_NBR        = S.ITM_NBR                      05130000
W24803            AND V.DEPT_NBR       = :XLT00004-DEPT-NBR             05140000
W24803            AND V.MAJ_CL_NBR    BETWEEN :PV-MAJ-CL-NBR-BEG        05150000
W24803                                    AND :PV-MAJ-CL-NBR-END        05160000
W24803            AND V.SUB_CL_NBR    BETWEEN :PV-SUB-CL-NBR-BEG        05170000
W24803                                    AND :PV-SUB-CL-NBR-END        05180000
W24803            AND V.STYL_ID        = S.STYL_ID                      05190000
W24803            AND S.GP_CDE         = :XLT00003-GP-CDE               05200000
058600          ORDER BY                                                05210000
058700                A.PO_LNE_NBR                                      05220000
058800     END-EXEC.                                                    05230000
058900                                                                  05240000
059000/                                                                 05250000
059100*---------------------------------------------------------------* 05260000
059200*  CURSOR TO SELECT LINE ITEMS WHEN PO IS APPROVED              * 05270000
059300*---------------------------------------------------------------* 05280000
059400                                                                  05290000
059500     EXEC SQL                                                     05300000
059600          DECLARE APP-ITEM-CSR CURSOR FOR                         05310000
059700          SELECT A.PO_LNE_NBR                                     05320000
059800                ,A.APP_PO_LNE_NBR                                 05330000
W24803                ,V.MAJ_CL_NBR                                     05340000
W24803                ,V.SUB_CL_NBR                                     05350000
W24803                ,S.SKU_NBR                                        05360000
W24803                ,S.CSTM_CLOR_DESC                                 05370000
W24803                ,S.SIZE_DESC                                      05380000
W24803                ,S.SKU_DESC                                       05390000
060400                ,A.UNT_QTY                                        05400000
060600            FROM TPURITM A                                        05410000
W24803                ,XLT_SKU S                                        05420000
W24803                ,XLT_VND_STYL V                                   05430000
W24803          WHERE A.PO_NBR         = :PURITM-PO-NBR                 05440000
                  AND A.STATUS_CDE    ^= 'CA'                           05450000
060800            AND A.VER_STATUS_CDE = 'A'                            05460000
W24803            AND A.ITM_NBR        = S.ITM_NBR                      05470000
W24803            AND V.DEPT_NBR       = :XLT00004-DEPT-NBR             05480000
W24803            AND V.MAJ_CL_NBR     BETWEEN :PV-MAJ-CL-NBR-BEG       05490000
W24803                                     AND :PV-MAJ-CL-NBR-END       05500000
W24803            AND V.SUB_CL_NBR     BETWEEN :PV-SUB-CL-NBR-BEG       05510000
W24803                                     AND :PV-SUB-CL-NBR-END       05520000
W24803            AND V.STYL_ID        = S.STYL_ID                      05530000
W24803            AND S.GP_CDE         = :XLT00003-GP-CDE               05540000
060900          ORDER BY                                                05550000
061000                A.APP_PO_LNE_NBR                                  05560000
061100     END-EXEC.                                                    05570000
061200                                                                  05580000
061300/                                                                 05590000
061400 LINKAGE SECTION.                                                 05600000
061500                                                                  05610000
061600 01  DFHCOMMAREA.                                                 05620000
061700     05  FILLER                         OCCURS  1 TO 4072 TIMES   05630000
061800                                        DEPENDING ON EIBCALEN.    05640000
061900         10  FILLER                     PIC X.                    05650000
062000                                                                  05660000
062100/                                                                 05670000
062200 PROCEDURE DIVISION.                                              05680000
062300*---------------------------------------------------------------* 05690000
062400*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 05700000
062500*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 05710000
062600*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 05720000
062700*---------------------------------------------------------------* 05730000
062800 0000-MAIN-MODULE.                                                05740000
062900                                                                  05750000
063000     INITIALIZE DP030-CICS-API-FIELDS.                            05760000
063100                                                                  05770000
063200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05780000
063300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05790000
063400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05800000
063500                                                                  05810000
063600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05820000
063700                                                                  05830000
063800     MOVE LENGTH OF PO106AI        TO DP030-MAP-LENGTH (1).       05840000
063900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05850000
064000                                                                  05860000
064100     PERFORM 0001-CALL-CICS-ARCH-API.                             05870000
064200     PERFORM 1000-CONTROL-PROCESSING                              05880000
064300                                                                  05890000
064400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05900000
064500     PERFORM 0001-CALL-CICS-ARCH-API.                             05910000
064600                                                                  05920000
064700*---------------------------------------------------------------* 05930000
064800*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 05940000
064900*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 05950000
065000*---------------------------------------------------------------* 05960000
065100 0001-CALL-CICS-ARCH-API.                                         05970000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05980099
065300                                    DFHCOMMAREA                   05990099
065400                                    DP030-CICS-API-FIELDS         06000099
065500                                    DP020-STANDARD-COMMAREA       06010099
065600                                    PO106AI.                      06020099
065700                                                                  06030000
065800     IF  DP030-RC-CALL-SUCCESSFUL                                 06040000
065900         CONTINUE                                                 06050000
066000     ELSE                                                         06060000
066100         SET DP013-NO-ROLLBACK                                    06070000
066200             DP013-XCTL-DISPLAY-RESTART                           06080000
066300             DP013-CICS-ABEND      TO TRUE                        06090000
066400         MOVE '0001-CALL-CICS-ARCH-API'                           06100000
066500                                   TO DP013-PARAGRAPH             06110000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06120099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06130099
066800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06140000
066900         PERFORM DP013-0000-PROCESS-ABEND                         06150000
067000     END-IF.                                                      06160000
067100                                                                  06170000
067200*----------------------------------------------------------------*06180000
067300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06190000
067400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06200000
067500*                                                                *06210000
067600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06220000
067700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06230000
067800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06240000
067900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06250000
068000*----------------------------------------------------------------*06260000
068100                                                                  06270000
068200 1000-CONTROL-PROCESSING.                                         06280000
068300                                                                  06290000
068400     EVALUATE TRUE                                                06300000
068500         WHEN DP020-NEXT-ACT-INITIAL                              06310000
068600             INITIALIZE ASC-SPECIFIC-COMMAREA                     06320000
068700             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06330000
068800                                      ASC-SEL-TERM-ID             06340000
068900             MOVE DP020-SRC-TASK-NUMBER                           06350000
069000                                   TO ASC-LIST-TASK-NUMBER        06360000
069100                                      ASC-SEL-TASK-NUMBER         06370000
069200             MOVE PC-LIST-QUEUE-SEQ                               06380000
069300                                   TO ASC-LIST-SEQ                06390000
069400             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06400000
069500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06410000
069600             IF  PS-COMMAREA-NOT-VALID                            06420000
069700                 SET DP020-NEXT-ACT-APPL-ERROR                    06430000
069800                                   TO TRUE                        06440000
069900             ELSE                                                 06450000
070000                 PERFORM 4000-BUILD-INITIAL-PANEL                 06460000
070100             END-IF                                               06470000
070200                                                                  06480000
070300         WHEN DP020-NEXT-ACT-READ-MAP                             06490000
070400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06500000
070500                                   TO PV-TOP-ITEM                 06510000
070600             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   06520000
070700             PERFORM 2000-PROCESS-PANEL                           06530000
070800                                                                  06540000
070900         WHEN DP020-NEXT-ACT-RETURN                               06550000
071000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06560000
071100                                   TO PV-TOP-ITEM                 06570000
071200             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   06580000
071300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06590000
071400             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06600000
071500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06610000
071600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06620000
071700                                                                  06630000
071800         WHEN OTHER                                               06640000
071900             SET DP013-LOGIC-ABEND TO TRUE                        06650000
072000             SET DP013-NO-ROLLBACK TO TRUE                        06660000
072100             MOVE '1000-CONTROL-PROCESSING'                       06670000
072200                                   TO DP013-PARAGRAPH             06680000
072300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06690000
072400                                   TO DP013-MESSAGE-TEXT(1)       06700000
072500             PERFORM DP013-0000-PROCESS-ABEND                     06710000
072600     END-EVALUATE.                                                06720000
072700                                                                  06730000
072800/                                                                 06740000
072900*----------------------------------------------------------------*06750000
073000* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *06760000
073100*----------------------------------------------------------------*06770000
073200                                                                  06780000
073300 1100-PROCESS-INTER-APPL-COMM.                                    06790000
073400                                                                  06800000
073500     SET PS-COMMAREA-VALID         TO TRUE.                       06810000
 73600     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06820000
 73700                                                                  06830000
073800     IF  PO017-PO-NBR = ZEROES                                    06840000
073900         MOVE PC-TSYMSG-00461    TO DP020-MSG-NUMBER              06850000
074000         SET PS-ERROR                                             06860000
074100             PS-COMMAREA-NOT-VALID                                06870000
074200             DP020-NEXT-ACT-APPL-ERROR                            06880000
074300             DP020-MSG-FATAL     TO TRUE                          06890000
074400     ELSE                                                         06900000
074500         MOVE PO017-PO-NBR       TO ASC-KEY-PO-NBR                06910000
074600                                    DK-PO-NBR                     06920000
074700         PERFORM 1110-GET-PO-INFO                                 06930000
074800         IF  PURCHS-STATUS-CDE = 'WK' OR 'PA' OR 'RJ' OR 'RS'     06940000
074900                                      OR 'FE'                     06950000
075000             SET ASC-ITEM-CURSOR TO TRUE                          06960000
075100         ELSE                                                     06970000
075200             SET ASC-APP-ITEM-CURSOR                              06980000
075300                                 TO TRUE                          06990000
075400         END-IF                                                   07000000
075500         PERFORM 1120-GET-PRIMARY-ENT-NAME-DESC                   07010000
075600     END-IF.                                                      07020000
075700                                                                  07030000
075800/                                                                 07040000
075900*----------------------------------------------------------------*07050000
076000*    READ PURCHASE ORDER HEADER                                  *07060000
076100*----------------------------------------------------------------*07070000
076200 1110-GET-PO-INFO.                                                07080000
076300                                                                  07090000
076400     PERFORM                                                      07100000
076500         WITH TEST AFTER                                          07110000
076600         VARYING PV-RETRY-COUNTER                                 07120000
076700         FROM 1 BY 1                                              07130000
076800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07140000
076900             OR (SQLCODE = +0))                                   07150000
077000                                                                  07160000
077100         EXEC SQL                                                 07170000
077200              SELECT PO_TYP_CDE                                   07180000
077300                    ,DEPT_NBR                                     07190000
077400                    ,ENT_ID                                       07200000
077500                    ,TOT_UNT_QTY                                  07210000
077600                    ,TOT_SKUS_QTY                                 07220000
077700                    ,STATUS_CDE                                   07230000
077800                    ,PKGNG_CDE                                    07240000
077900                INTO :PURCHS-PO-TYP-CDE                           07250000
078000                    ,:PURCHS-DEPT-NBR                             07260000
078100                    ,:PURCHS-ENT-ID                               07270000
078200                    ,:PURCHS-TOT-UNT-QTY                          07280000
078300                    ,:PURCHS-TOT-SKUS-QTY                         07290000
078400                    ,:PURCHS-STATUS-CDE                           07300000
078500                    ,:PURCHS-PKGNG-CDE                            07310000
078600                FROM TPURCHS                                      07320000
078700               WHERE PO_NBR         = :DK-PO-NBR                  07330000
078800                 AND VER_STATUS_CDE = 'A'                         07340000
078900         END-EXEC                                                 07350000
079000                                                                  07360000
079100         EVALUATE TRUE                                            07370000
079200             WHEN SQLCODE = +0                                    07380000
079300                  MOVE PURCHS-PO-TYP-CDE                          07390000
079400                                 TO ASC-PO-TYP-CDE                07400000
079500                  MOVE PURCHS-DEPT-NBR                            07410000
079600                                 TO ASC-KEY-DEPT-NBR              07420000
079800                  MOVE PURCHS-ENT-ID                              07430000
079900                                 TO ASC-KEY-ENT-ID                07440000
080000                                    DK-ENT-ID                     07450000
080100                  MOVE PURCHS-TOT-UNT-QTY                         07460000
080200                                 TO ASC-TOT-UNT-QTY               07470000
080300                  MOVE PURCHS-TOT-SKUS-QTY                        07480000
080400                                 TO ASC-TOT-SKUS-QTY              07490000
080800                                                                  07500000
080900             WHEN SQLCODE = -904                                  07510000
081000             WHEN SQLCODE = -913                                  07520000
081100                  CONTINUE                                        07530000
081200                                                                  07540000
081300             WHEN SQLWARN0 NOT = SPACES                           07550000
081400             WHEN SQLCODE < +0                                    07560000
081500             WHEN SQLCODE > +0                                    07570000
081600                  MOVE '1110-GET-PO-INFO'                         07580000
081700                                  TO DP013-PARAGRAPH              07590000
081800                  MOVE 'UNSUCCESSFUL SELECT ON PO HEADER'         07600000
081900                                  TO DP013-MESSAGE-TEXT (1)       07610000
082000                  MOVE SQLCA      TO DP013-SQLCA                  07620000
082100                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     07630000
082200                  SET DP013-DB2-ABEND                             07640000
082300                      DP013-XCTL-DISPLAY-RESTART                  07650000
082400                                  TO TRUE                         07660000
082500                  PERFORM DP013-0000-PROCESS-ABEND                07670000
082600         END-EVALUATE                                             07680000
082700     END-PERFORM.                                                 07690000
082800                                                                  07700000
082900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07710000
083000         MOVE '1110-GET-PO-INFO'  TO DP013-PARAGRAPH              07720000
083100         MOVE 'MAX RETRIES EXCEEDED ON SELECT FOR PO NBR'         07730000
083200                                  TO DP013-MESSAGE-TEXT (1)       07740000
083300         MOVE SQLCA               TO DP013-SQLCA                  07750000
083400         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     07760000
083500         SET DP013-DB2-ABEND                                      07770000
083600             DP013-XCTL-DISPLAY-RESTART                           07780000
083700                                  TO TRUE                         07790000
083800         PERFORM DP013-0000-PROCESS-ABEND                         07800000
083900     END-IF.                                                      07810000
084000                                                                  07820000
084100/                                                                 07830000
084200*----------------------------------------------------------------*07840000
084300*  RETRIEVE THE PRIMARY VENDOR NAME                               07850000
084400*----------------------------------------------------------------*07860000
084500                                                                  07870000
084600 1120-GET-PRIMARY-ENT-NAME-DESC.                                  07880000
084700                                                                  07890000
084800     PERFORM                                                      07900000
084900         WITH TEST AFTER                                          07910000
085000         VARYING PV-RETRY-COUNTER                                 07920000
085100         FROM 1 BY 1                                              07930000
085200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07940000
085300             OR (SQLCODE = +0))                                   07950000
085400                                                                  07960000
085500         EXEC SQL                                                 07970000
085600              SELECT ENT_NAME_DESC                                07980000
085700                INTO :ENTNME-ENT-NAME-DESC                        07990000
085800                FROM TENTNME                                      08000000
085900               WHERE ENT_ID   = :DK-ENT-ID                        08010000
086000                 AND TYPE_CDE = '01'                              08020000
086100         END-EXEC                                                 08030000
086200                                                                  08040000
086300         EVALUATE TRUE                                            08050000
086400             WHEN SQLCODE = +0                                    08060000
086500                  MOVE ENTNME-ENT-NAME-DESC                       08070000
086600                                  TO ASC-KEY-ENT-NAME-DESC        08080000
086700             WHEN SQLCODE = -904                                  08090000
086800             WHEN SQLCODE = -913                                  08100000
086900                  CONTINUE                                        08110000
087000                                                                  08120000
087100             WHEN SQLWARN0 NOT = SPACES                           08130000
087200             WHEN SQLCODE < +0                                    08140000
087300             WHEN SQLCODE > +0                                    08150000
087400                  MOVE '1120-GET-PRIMARY-ENT-NAME-DESC'           08160000
087500                                  TO DP013-PARAGRAPH              08170000
087600                  MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'      08180000
087700                                  TO DP013-MESSAGE-TEXT (1)       08190000
087800                  MOVE SQLCA      TO DP013-SQLCA                  08200000
087900                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     08210000
088000                  SET DP013-DB2-ABEND                             08220000
088100                      DP013-XCTL-DISPLAY-RESTART                  08230000
088200                                  TO TRUE                         08240000
088300                  PERFORM DP013-0000-PROCESS-ABEND                08250000
088400         END-EVALUATE                                             08260000
088500     END-PERFORM.                                                 08270000
088600                                                                  08280000
088700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08290000
088800         MOVE '1120-GET-PRIMARY-NAME'                             08300000
088900                                  TO DP013-PARAGRAPH              08310000
089000         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE NAME'    08320000
089100                                  TO DP013-MESSAGE-TEXT (1)       08330000
089200         MOVE SQLCA               TO DP013-SQLCA                  08340000
089300         MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (1)     08350000
089400         SET DP013-DB2-ABEND                                      08360000
089500             DP013-XCTL-DISPLAY-RESTART                           08370000
089600                                  TO TRUE                         08380000
089700         PERFORM DP013-0000-PROCESS-ABEND                         08390000
089800     END-IF.                                                      08400000
089900                                                                  08410000
090000/                                                                 08420000
090100*----------------------------------------------------------------*08430000
090200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08440000
090300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08450000
090400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08460000
090500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08470000
090600* FUNCTION KEYS CAN GET THIS FAR.                                *08480000
090700*----------------------------------------------------------------*08490000
090800                                                                  08500000
090900 2000-PROCESS-PANEL.                                              08510000
091000     EVALUATE TRUE                                                08520000
091100         WHEN DP020-SRC-AID = DP016-CLEAR                         08530000
091200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08540000
091300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08550000
091400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08560000
091500                                                                  08570000
091600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08580000
091700             PERFORM 2050-DELETE-LIST-QUEUE                       08590000
091800             PERFORM 4000-BUILD-INITIAL-PANEL                     08600000
091900                                                                  08610000
092000         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   08620000
092100             PERFORM 2140-DESELECT-ALL-ITEMS                      08630000
092200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08640000
092300                                                                  08650000
092400         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 08660000
092500              PERFORM 2150-SELECT-ALL-ITEMS                       08670000
092600              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                08680000
092700                                                                  08690000
092800         WHEN OTHER                                               08700000
092900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08710000
093000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08720000
093100             IF  PS-NO-ERROR                                      08730000
093200                 SET DP030-CONTINUE-GO TO TRUE                    08740000
093300                 PERFORM 2100-CHECK-FUNCTION-KEY                  08750000
093400             ELSE                                                 08760000
093500                 SET DP030-OVERRIDE-GO TO TRUE                    08770000
093600             END-IF                                               08780000
093700     END-EVALUATE.                                                08790000
093800                                                                  08800000
093900/                                                                 08810000
094000*----------------------------------------------------------------*08820000
094100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08830000
094200*----------------------------------------------------------------*08840000
094300 2050-DELETE-LIST-QUEUE.                                          08850000
094400                                                                  08860000
094500     EXEC CICS                                                    08870000
094600         DELETEQ TS                                               08880000
094700           QUEUE (ASC-LIST-QUEUE-NAME)                            08890000
094800            RESP (PV-CICS-RESP)                                   08900000
094900     END-EXEC.                                                    08910000
095000                                                                  08920000
095100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08930000
095200        (PV-CICS-RESP = DFHRESP(QIDERR))                          08940000
095300         CONTINUE                                                 08950000
095400     ELSE                                                         08960000
095500         SET DP013-CICS-ABEND      TO TRUE                        08970000
095600         SET DP013-NO-ROLLBACK     TO TRUE                        08980000
095700                                                                  08990000
095800         MOVE '2050-DELETE-LIST-QUEUE'                            09000000
095900                                   TO DP013-PARAGRAPH             09010000
096000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09020000
096100                                   TO DP013-MESSAGE-TEXT (1)      09030000
096200         PERFORM DP013-0000-PROCESS-ABEND                         09040000
096300     END-IF.                                                      09050000
096400                                                                  09060000
096500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09070000
096600                                                                  09080000
096700/                                                                 09090000
096800*----------------------------------------------------------------*09100000
096900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09110000
097000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09120000
097100* CICS ARCHITECTURE API.                                         *09130000
097200*----------------------------------------------------------------*09140000
097300 2100-CHECK-FUNCTION-KEY.                                         09150000
097400                                                                  09160000
097500     EVALUATE TRUE                                                09170000
097600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09180000
097700              IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO             09190000
097800                  INITIALIZE PO013-INTER-APPL-COMMAREA            09200000
097900                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS               09210000
098000                                TO PO013-NUMBER-OF-SELECTED-ITEMS 09220000
098100                  MOVE ASC-KEY-PO-NBR TO PO013-PO-NBR             09230000
098200                  MOVE ASC-KEY-DEPT-NBR TO PO013-DEPT-NBR         09240000
098300                  MOVE ASC-KEY-ENT-ID TO PO013-ENT-ID             09250000
098400                  PERFORM 5000-PREPARE-SEL-QUEUE                  09260000
098500              ELSE                                                09270000
098600                  SET DP030-OVERRIDE-GO                           09280000
098700                      DP020-MSG-WARNING                           09290000
098800                                TO TRUE                           09300000
098900                  MOVE PC-TSYMSG-00057                            09310000
099000                                TO DP020-MSG-NUMBER               09320000
099100              END-IF                                              09330000
105300                                                                  09340000
105400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  09350000
105500             MOVE +1               TO PV-TOP-ITEM                 09360000
105600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09370000
105700             PERFORM 3200-RESET-ATTRIBUTES                        09380000
105800                                                                  09390000
105900         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   09400000
106000             PERFORM 2110-BROWSE-BACKWARD                         09410000
106100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09420000
106200             PERFORM 3200-RESET-ATTRIBUTES                        09430000
106300                                                                  09440000
106400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09450000
106500             PERFORM 2120-BROWSE-FORWARD                          09460000
106600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09470000
106700             PERFORM 3200-RESET-ATTRIBUTES                        09480000
106800                                                                  09490000
106900         WHEN DP020-SRC-AID = DP016-ENTER                         09500000
107000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   09510000
107100             IF  PS-ERROR                                         09520000
107200                 CONTINUE                                         09530000
107300             ELSE                                                 09540000
107400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09550000
107500             END-IF                                               09560000
107600                                                                  09570000
107700         WHEN OTHER                                               09580000
107800             SET DP013-NO-ROLLBACK                                09590000
107900                 DP013-XCTL-DISPLAY-RESTART                       09600000
108000                 DP013-CICS-ABEND  TO TRUE                        09610000
108100             MOVE '2100-CHECK-FUNCTION-KEY'                       09620000
108200                                   TO DP013-PARAGRAPH             09630000
108300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09640000
108400                                   TO DP013-MESSAGE-TEXT (1)      09650000
108500             PERFORM DP013-0000-PROCESS-ABEND                     09660000
108600     END-EVALUATE.                                                09670000
108700                                                                  09680000
108800/                                                                 09690000
108900*----------------------------------------------------------------*09700000
109000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09710000
109100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09720000
109200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09730000
109300*    MESSAGE.                                                    *09740000
109400*----------------------------------------------------------------*09750000
109500                                                                  09760000
109600 2110-BROWSE-BACKWARD.                                            09770000
109700                                                                  09780000
109800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09790000
109900         GIVING PV-TOP-ITEM.                                      09800000
110000                                                                  09810000
110100     IF  ((PV-TOP-ITEM < +1)                                      09820000
110200       OR (PV-TOP-ITEM = +1))                                     09830000
110300         MOVE +1                   TO PV-TOP-ITEM                 09840000
110400*        -- TOP OF LIST --                                        09850000
110500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09860000
110600         SET DP020-MSG-INFORMATIONAL                              09870000
110700                                   TO TRUE                        09880000
110800     END-IF.                                                      09890000
110900                                                                  09900000
111000/                                                                 09910000
111100*----------------------------------------------------------------*09920000
111200*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09930000
111300*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09940000
111400*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09950000
111500*----------------------------------------------------------------*09960000
111600                                                                  09970000
111700 2120-BROWSE-FORWARD.                                             09980000
111800                                                                  09990000
111900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              10000000
112000         GIVING PV-TOP-ITEM.                                      10010000
112100                                                                  10020000
112200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   10030000
112300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10040000
112400                                   TO PV-TOP-ITEM                 10050000
112500*        -- BOTTOM OF LIST --                                     10060000
112600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            10070000
112700         SET DP020-MSG-INFORMATIONAL                              10080000
112800                                   TO TRUE                        10090000
112900     ELSE                                                         10100000
113000         COMPUTE PV-BOTTOM-ITEM =                                 10110000
113100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 10120000
113200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            10130000
113300*            -- BOTTOM OF LIST --                                 10140000
113400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            10150000
113500             SET DP020-MSG-INFORMATIONAL                          10160000
113600                                   TO TRUE                        10170000
113700         END-IF                                                   10180000
113800     END-IF.                                                      10190000
113900                                                                  10200000
114000/                                                                 10210000
114100*----------------------------------------------------------------*10220000
114200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *10230000
114300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *10240000
114400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *10250000
114500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *10260000
114600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *10270000
114700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *10280000
114800*----------------------------------------------------------------*10290000
114900                                                                  10300000
115000 2130-CHECK-FOR-JUMP-BROWSE.                                      10310000
115100                                                                  10320000
115200     SET PS-NO-ERROR               TO TRUE.                       10330000
115300     IF (ASC-START-ITEM-REQUEST = SPACE)                          10340000
115400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10350000
115500                                   TO PV-TOP-ITEM                 10360000
115600     ELSE                                                         10370000
115700         MOVE ASC-START-ITEM-REQUEST                              10380000
115800                                   TO DP010I-UNEDITED-FIELD       10390000
115900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       10400000
116000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     10410000
116100         SET DP010I-NEGATIVE-NOT-ALLOWED                          10420000
116200                                   TO TRUE                        10430000
264220         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10441099
264230                         USING DP010I-NUMERIC-EDIT-AREA           10442099
116400                                                                  10450000
116500         IF  NOT DP010I-ERROR-DETECTED                            10460000
116600             MOVE DP010I-NUMERIC-FIELD                            10470000
116700                                   TO ASC-START-ITEM-REQUEST-N    10480000
116800             IF  ASC-START-ITEM-REQUEST-N > ZERO                  10490000
116900                 IF  ASC-START-ITEM-REQUEST-N >                   10500000
117000                                          ASC-NUMBER-OF-ITEMS-READ10510000
117100                     MOVE SPACE TO ASC-START-ITEM-REQUEST         10520000
117200                     COMPUTE PV-TOP-ITEM =                        10530000
117300                             ASC-NUMBER-OF-ITEMS-READ             10540000
117400                             - PC-ITEMS-PER-PANEL + 1             10550000
117500                     IF  PV-TOP-ITEM < +1                         10560000
117600                         MOVE +1   TO PV-TOP-ITEM                 10570000
117700                         MOVE PC-TSYMSG-00070                     10580000
117800                                   TO DP020-MSG-NUMBER            10590000
117900                         SET DP020-MSG-INFORMATIONAL              10600000
118000                                   TO TRUE                        10610000
118100                     END-IF                                       10620000
118200                 ELSE                                             10630000
118300                     MOVE ASC-START-ITEM-REQUEST-N                10640000
118400                                   TO PV-TOP-ITEM                 10650000
118500                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10660000
118600                     COMPUTE PV-BOTTOM-ITEM =                     10670000
118700                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10680000
118800                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10690000
118900*                        -- BOTTOM OF LIST --                     10700000
119000                         MOVE PC-TSYMSG-00070                     10710000
119100                                   TO DP020-MSG-NUMBER            10720000
119200                         SET DP020-MSG-INFORMATIONAL              10730000
119300                                   TO TRUE                        10740000
119400                     END-IF                                       10750000
119500                 END-IF                                           10760000
119600             ELSE                                                 10770000
119700*                --- VALUE OUT OF RANGE ----                      10780000
119800                 MOVE PC-TSYMSG-00101                             10790000
119900                                   TO DP020-MSG-NUMBER            10800000
120000                 MOVE -1           TO ASTRTITL                    10810000
120100                 SET DP030-SET-CURSOR-APPL-1                      10820000
120200                                   TO TRUE                        10830000
120300                 MOVE DP015-REVERSE                               10840000
120400                                   TO ASTRTITH                    10850000
120500                 MOVE DP015-RED    TO ASTRTITC                    10860000
120600                 MOVE DP015-UNP-NUM-BRT-MDT                       10870000
120700                                   TO ASTRTITA                    10880000
120800                 SET DP020-MSG-FATAL                              10890000
120900                                   TO TRUE                        10900000
121000                 SET PS-ERROR      TO TRUE                        10910000
121100             END-IF                                               10920000
121200                                                                  10930000
121300         ELSE                                                     10940000
121400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10950000
121500             MOVE -1               TO ASTRTITL                    10960000
121600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10970000
121700             MOVE DP015-REVERSE    TO ASTRTITH                    10980000
121800             MOVE DP015-RED        TO ASTRTITC                    10990000
121900             MOVE DP015-UNP-NUM-BRT-MDT                           11000000
122000                                   TO ASTRTITA                    11010000
122100             SET DP020-MSG-FATAL   TO TRUE                        11020000
122200             SET PS-ERROR          TO TRUE                        11030000
122300         END-IF                                                   11040000
122400     END-IF.                                                      11050000
122500                                                                  11060000
122600/                                                                 11070000
122700*----------------------------------------------------------------*11080000
122800*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *11090000
122900*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *11100000
123000*----------------------------------------------------------------*11110000
123100 2140-DESELECT-ALL-ITEMS.                                         11120000
123200                                                                  11130000
123300     MOVE +1                       TO ASC-BLK-SUB.                11140000
123400                                                                  11150000
123500     PERFORM 2141-CLEAR-SELECTED-INDS                             11160000
123600         VARYING ASC-ITEM-SUB                                     11170000
123700         FROM 1 BY 1                                              11180000
123800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11190000
123900                                                                  11200000
124000     ADD +1                        TO ASC-BLK-SUB.                11210000
124100                                                                  11220000
124200     PERFORM 2141-CLEAR-SELECTED-INDS                             11230000
124300         VARYING ASC-ITEM-SUB                                     11240000
124400         FROM 1 BY 1                                              11250000
124500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11260000
124600                                                                  11270000
124700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11280000
124800                                   TO PV-LIST-ITEM-NUMBER.        11290000
124900                                                                  11300000
125000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11310000
125100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11320000
125200                                                                  11330000
125300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11340000
125400        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      11350000
125500         MOVE +1                   TO ASC-BLK-SUB                 11360000
125600                                                                  11370000
125700         PERFORM 5100-WRITE-TEMP-STORAGE                          11380000
125800                                                                  11390000
125900         MOVE +1                   TO PV-BLOCK-NUMBER             11400000
126000                                                                  11410000
126100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11420000
126200             PV-FIRST-BLOCK-IN-ARRAY - 1                          11430000
126300                                                                  11440000
126400         PERFORM                                                  11450000
126500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11460000
126600                                                                  11470000
126700             PERFORM 4410-READ-TEMP-STORAGE                       11480000
126800                                                                  11490000
126900             PERFORM 2141-CLEAR-SELECTED-INDS                     11500000
127000                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 11510000
127100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11520000
127200                                                                  11530000
127300             PERFORM 5100-WRITE-TEMP-STORAGE                      11540000
127400                                                                  11550000
127500             ADD +1                TO PV-BLOCK-NUMBER             11560000
127600                                                                  11570000
127700         END-PERFORM                                              11580000
127800                                                                  11590000
127900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11600000
128000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11610000
128100                                                                  11620000
128200         PERFORM                                                  11630000
128300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11640000
128400                   ASC-HIGHEST-BLOCK-WRITTEN                      11650000
128500                                                                  11660000
128600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11670000
128700                                   TO PV-BLOCK-NUMBER             11680000
128800                                                                  11690000
128900             PERFORM 4410-READ-TEMP-STORAGE                       11700000
129000                                                                  11710000
129100             PERFORM 2141-CLEAR-SELECTED-INDS                     11720000
129200                 VARYING ASC-ITEM-SUB                             11730000
129300                 FROM 1 BY 1                                      11740000
129400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11750000
129500                                                                  11760000
129600             PERFORM 5100-WRITE-TEMP-STORAGE                      11770000
129700                                                                  11780000
129800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11790000
129900                                                                  11800000
130000         END-PERFORM                                              11810000
130100                                                                  11820000
130200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11830000
130300                                   TO PV-BLOCK-NUMBER             11840000
130400                                                                  11850000
130500         PERFORM 4410-READ-TEMP-STORAGE                           11860000
130600     END-IF.                                                      11870000
130700                                                                  11880000
130800                                                                  11890000
130900     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS11900000
131000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.11910000
131100     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  11920000
131200                                                                  11930000
131300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11940000
131400                                                                  11950000
131500/                                                                 11960000
131600*----------------------------------------------------------------*11970000
131700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11980000
131800*----------------------------------------------------------------*11990000
131900                                                                  12000000
132000 2141-CLEAR-SELECTED-INDS.                                        12010000
132100                                                                  12020000
132200     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          12030000
132300             NOT EQUAL ZERO                                       12040000
132400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12050000
132500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12060000
132600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    12070000
132700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12080000
132800                                   TO TRUE                        12090000
132900         END-IF                                                   12100000
133000     END-IF.                                                      12110000
133100                                                                  12120000
133200/                                                                 12130000
133300*----------------------------------------------------------------*12140000
133400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *12150000
133500*  FOR ALL ITEMS.                                                *12160000
133600*----------------------------------------------------------------*12170000
133700                                                                  12180000
133800 2150-SELECT-ALL-ITEMS.                                           12190000
133900                                                                  12200000
134000     MOVE +1                       TO ASC-BLK-SUB.                12210000
134100                                                                  12220000
134200     PERFORM 2151-SET-SELECTED-INDS                               12230000
134300         VARYING ASC-ITEM-SUB                                     12240000
134400         FROM 1 BY 1                                              12250000
134500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12260000
134600                                                                  12270000
134700     ADD +1                        TO ASC-BLK-SUB.                12280000
134800                                                                  12290000
134900     PERFORM 2151-SET-SELECTED-INDS                               12300000
135000         VARYING ASC-ITEM-SUB                                     12310000
135100         FROM 1 BY 1                                              12320000
135200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12330000
135300                                                                  12340000
135400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12350000
135500                                   TO PV-LIST-ITEM-NUMBER.        12360000
135600                                                                  12370000
135700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12380000
135800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12390000
135900                                                                  12400000
136000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12410000
136100        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    12420000
136200         MOVE +1                   TO ASC-BLK-SUB                 12430000
136300                                                                  12440000
136400         PERFORM 5100-WRITE-TEMP-STORAGE                          12450000
136500                                                                  12460000
136600         MOVE +1                   TO PV-BLOCK-NUMBER             12470000
136700                                                                  12480000
136800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12490000
136900             PV-FIRST-BLOCK-IN-ARRAY - 1                          12500000
137000                                                                  12510000
137100         PERFORM                                                  12520000
137200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12530000
137300                                                                  12540000
137400             PERFORM 4410-READ-TEMP-STORAGE                       12550000
137500                                                                  12560000
137600             PERFORM 2151-SET-SELECTED-INDS                       12570000
137700                 VARYING ASC-ITEM-SUB                             12580000
137800                 FROM 1 BY 1                                      12590000
137900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12600000
138000                                                                  12610000
138100             PERFORM 5100-WRITE-TEMP-STORAGE                      12620000
138200                                                                  12630000
138300             ADD +1                TO PV-BLOCK-NUMBER             12640000
138400         END-PERFORM                                              12650000
138500                                                                  12660000
138600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12670000
138700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12680000
138800                                                                  12690000
138900         PERFORM                                                  12700000
139000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12710000
139100                   ASC-HIGHEST-BLOCK-WRITTEN                      12720000
139200                                                                  12730000
139300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12740000
139400                                   TO PV-BLOCK-NUMBER             12750000
139500                                                                  12760000
139600             PERFORM 4410-READ-TEMP-STORAGE                       12770000
139700                                                                  12780000
139800             PERFORM 2151-SET-SELECTED-INDS                       12790000
139900                 VARYING ASC-ITEM-SUB                             12800000
140000                 FROM 1 BY 1                                      12810000
140100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12820000
140200                                                                  12830000
140300             PERFORM 5100-WRITE-TEMP-STORAGE                      12840000
140400                                                                  12850000
140500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12860000
140600         END-PERFORM                                              12870000
140700                                                                  12880000
140800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12890000
140900                                   TO PV-BLOCK-NUMBER             12900000
141000                                                                  12910000
141100         PERFORM 4410-READ-TEMP-STORAGE                           12920000
141200     END-IF.                                                      12930000
141300                                                                  12940000
141400     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12950000
141500          ASC-NUMBER-OF-SELECTED-ITEMS.                           12960000
141600                                                                  12970000
141700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12980000
141800                                                                  12990000
141900/                                                                 13000000
142000*----------------------------------------------------------------*13010000
142100*    MARK EACH ITEM AS BEING SELECTED.                           *13020000
142200*----------------------------------------------------------------*13030000
142300                                                                  13040000
142400 2151-SET-SELECTED-INDS.                                          13050000
142500                                                                  13060000
142600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           13070000
142700             NOT EQUAL ZERO                                       13080000
142800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13090000
142900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13100000
143000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        13110000
143100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  13120000
143200                                   TO TRUE                        13130000
143300         END-IF                                                   13140000
143400     END-IF.                                                      13150000
143500                                                                  13160000
143600/                                                                 13170000
143700*----------------------------------------------------------------*13180000
143800*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *13190000
143900*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *13200000
144000*----------------------------------------------------------------*13210000
144100 2200-MOVE-SCREEN-TO-COMMAREA.                                    13220000
144200                                                                  13230000
144300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13240000
144400     MOVE +1                       TO PV-SUB.                     13250000
144500                                                                  13260000
144600     PERFORM 3100-SET-SUBSCRIPTS.                                 13270000
144700                                                                  13280000
144800     IF  ASTRTITL > ZERO                                          13290000
144900         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      13300000
145000     ELSE                                                         13310000
145100         IF  ASTRTITF = DP015-ERASE-EOF                           13320000
145200             INITIALIZE ASC-START-ITEM-REQUEST                    13330000
145300         END-IF                                                   13340000
145400     END-IF.                                                      13350000
145500                                                                  13360000
145600     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          13370000
145700         VARYING PV-SUB                                           13380000
145800         FROM 1 BY 1                                              13390000
145900         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      13400000
146000                                                                  13410000
146100/                                                                 13420000
146200*----------------------------------------------------------------*13430000
146300*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *13440000
146400*----------------------------------------------------------------*13450000
146500 2210-MOVE-LINES-TO-COMMAREA.                                     13460000
146600                                                                  13470000
146700     IF  MR-SELECTL (PV-SUB) > ZERO                               13480000
146800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     13490000
146900                                   TO TRUE                        13500000
147000         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        13510000
147100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13520000
147200     ELSE                                                         13530000
147300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                13540000
147400             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         13550000
147500             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        13560000
147600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13570000
147700         END-IF                                                   13580000
147800     END-IF.                                                      13590000
147900                                                                  13600000
148000     ADD +1                        TO ASC-ITEM-SUB.               13610000
148100                                                                  13620000
148200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13630000
148300         ADD +1                    TO ASC-BLK-SUB                 13640000
148400         MOVE +1                   TO ASC-ITEM-SUB                13650000
148500     END-IF.                                                      13660000
148600                                                                  13670000
148700/                                                                 13680000
148800*----------------------------------------------------------------*13690000
148900*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *13700000
149000*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *13710000
149100*----------------------------------------------------------------*13720000
149200 3000-EDIT-DATA-IN-COMMAREA.                                      13730000
149300                                                                  13740000
149400     SET PS-NO-ERROR               TO TRUE.                       13750000
149500                                                                  13760000
149600     PERFORM 3200-RESET-ATTRIBUTES.                               13770000
149700                                                                  13780000
149800     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13790000
149900**                                                                13800000
150000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13810000
150100* EDITTING IS DONE FROM THE BOTTOM UP.                            13820000
150200**                                                                13830000
150300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13840000
150400         ASC-ITEMS-DISPLAYED - 1.                                 13850000
150500                                                                  13860000
150600     PERFORM 3100-SET-SUBSCRIPTS.                                 13870000
150700     PERFORM 3300-EDIT-SELECTIONS                                 13880000
150800         VARYING PV-SUB                                           13890000
150900         FROM PV-SUB BY -1                                        13900000
151000         UNTIL PV-SUB < +1                                        13910000
151100                                                                  13920000
151200     IF  PS-NO-ERROR                                              13930000
151300         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13940000
151400     END-IF.                                                      13950000
151500                                                                  13960000
151600     IF  ((PS-NO-ERROR)                                           13970000
151700       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13980000
151800       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13990000
151900             PERFORM 3500-MARK-RANGE-AS-SELECTED                  14000000
152000     END-IF.                                                      14010000
152100                                                                  14020000
152200/                                                                 14030000
152300*----------------------------------------------------------------*14040000
152400*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *14050000
152500*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*14060000
152600*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *14070000
152700*                                                                *14080000
152800*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *14090000
152900*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *14100000
153000*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *14110000
153100*    US IN THE 2ND BLOCK OF THE ARRAY.                           *14120000
153200*----------------------------------------------------------------*14130000
153300                                                                  14140000
153400 3100-SET-SUBSCRIPTS.                                             14150000
153500                                                                  14160000
153600     COMPUTE ASC-ITEM-SUB =                                       14170000
153700         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14180000
153800                                                                  14190000
153900     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14200000
154000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14210000
154100                                                                  14220000
154200         MOVE PC-MAX-BLOCKS-IN-ARRAY                              14230000
154300                                   TO ASC-BLK-SUB                 14240000
154400     ELSE                                                         14250000
154500         MOVE +1                   TO ASC-BLK-SUB                 14260000
154600     END-IF.                                                      14270000
154700                                                                  14280000
154800*----------------------------------------------------------------*14290000
154900*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *14300000
155000*----------------------------------------------------------------*14310000
155100                                                                  14320000
155200 3200-RESET-ATTRIBUTES.                                           14330000
155300                                                                  14340000
155400     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   14350000
155500     MOVE DP015-GREEN              TO ASTRTITC.                   14360000
155600     MOVE DP015-UNDERLINE          TO ASTRTITH.                   14370000
155700                                                                  14380000
155800     IF DP020-NEXT-ACT-RETURN                                     14390000
155900     OR DP020-NEXT-ACT-READ-MAP                                   14400000
156000        PERFORM                                                   14410000
156100            VARYING PV-SUB                                        14420000
156200            FROM 1 BY 1                                           14430000
156300            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    14440000
156400            MOVE DP015-UNP-ALP-NOR-OFF                            14450000
156500                                      TO MR-SELECTA (PV-SUB)      14460000
156600            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      14470000
156700            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      14480000
156800        END-PERFORM                                               14490000
156900     ELSE                                                         14500000
157000        PERFORM                                                   14510000
157100            VARYING PV-SUB                                        14520000
157200            FROM 1 BY 1                                           14530000
157300            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     14540000
157400            MOVE DP015-UNP-ALP-NOR-OFF                            14550000
157500                                      TO MR-SELECTA (PV-SUB)      14560000
157600            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      14570000
157700            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      14580000
157800        END-PERFORM                                               14590000
157900     END-IF.                                                      14600000
158000                                                                  14610000
158100/                                                                 14620000
158200*----------------------------------------------------------------*14630000
158300*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *14640000
158400*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *14650000
158500*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *14660000
158600*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *14670000
158700*----------------------------------------------------------------*14680000
158800 3300-EDIT-SELECTIONS.                                            14690000
158900                                                                  14700000
159000     EVALUATE TRUE                                                14710000
159100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14720000
159200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14730000
159300                 CONTINUE                                         14740000
159400                                                                  14750000
159500         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14760000
159600             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        14770000
159700                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS14780000
159800                 MOVE ASC-TEMP-SELECTED-SW                        14790000
159900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14800000
160000                                   TO ASC-SELECTED-SW             14810000
160100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14820000
160200             END-IF                                               14830000
160300                                                                  14840000
160400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14850000
160500                 = SPACE                                          14860000
160600             EVALUATE TRUE                                        14870000
160700                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14880000
160800                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14890000
160900                     MOVE SPACE    TO ASC-SELECTED-SW             14900000
161000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14910000
161100                                                                  14920000
161200                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14930000
161300                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 14940000
161400                     MOVE SPACE    TO ASC-SELECTED-SW             14950000
161500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14960000
161600                                                                  14970000
161700                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14980000
161800                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   14990000
161900                     MOVE SPACE    TO ASC-SELECTED-SW             15000000
162000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15010000
162100             END-EVALUATE                                         15020000
162200                                                                  15030000
162300         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           15040000
162400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15050000
162500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15060000
162600             END-IF                                               15070000
162700             PERFORM 3310-EDIT-RANGE                              15080000
162800                                                                  15090000
162900         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             15100000
163000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15110000
163100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15120000
163200             END-IF                                               15130000
163300             PERFORM 3310-EDIT-RANGE                              15140000
163400                                                                  15150000
163500         WHEN OTHER                                               15160000
163600             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            15170000
163700             SET DP020-MSG-FATAL   TO TRUE                        15180000
163800             MOVE -1               TO MR-SELECTL (PV-SUB)         15190000
163900             SET DP030-SET-CURSOR-APPL-1                          15200000
164000                                   TO TRUE                        15210000
164100             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         15220000
164200             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         15230000
164300             SET PS-ERROR          TO TRUE                        15240000
164400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15250000
164500                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15260000
164600                 MOVE SPACE        TO ASC-SELECTED-SW             15270000
164700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15280000
164800             END-IF                                               15290000
164900     END-EVALUATE.                                                15300000
165000                                                                  15310000
165100     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             15320000
165200     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15330000
165300                                                                  15340000
165400     IF  ASC-ITEM-SUB < 1                                         15350000
165500         SUBTRACT +1 FROM ASC-BLK-SUB                             15360000
165600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15370000
165700     END-IF.                                                      15380000
165800                                                                  15390000
165900*----------------------------------------------------------------*15400000
166000*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *15410000
166100*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *15420000
166200*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *15430000
166300*  THE ENDING.                                                   *15440000
166400*----------------------------------------------------------------*15450000
166500 3310-EDIT-RANGE.                                                 15460000
166600                                                                  15470000
166700     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                15480000
166800         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   15490000
166900             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)15500000
167000                                   TO ASC-SELECTED-SW             15510000
167100                                        (ASC-BLK-SUB ASC-ITEM-SUB)15520000
167200             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 15530000
167300         ELSE                                                     15540000
167400             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     15550000
167500                 CONTINUE                                         15560000
167600             ELSE                                                 15570000
167700*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        15580000
167800                 MOVE PC-TSYMSG-00054                             15590000
167900                                   TO DP020-MSG-NUMBER            15600000
168000                 SET DP020-MSG-FATAL                              15610000
168100                                   TO TRUE                        15620000
168200                 MOVE -1           TO MR-SELECTL (PV-SUB)         15630000
168300                 SET DP030-SET-CURSOR-APPL-1                      15640000
168400                                   TO TRUE                        15650000
168500                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         15660000
168600                 MOVE DP015-UNDERLINE                             15670000
168700                                   TO MR-SELECTH (PV-SUB)         15680000
168800                 SET PS-ERROR      TO TRUE                        15690000
168900             END-IF                                               15700000
169000         END-IF                                                   15710000
169100     ELSE                                                         15720000
169200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15730000
169300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15740000
169400                                   TO ASC-SELECTED-SW             15750000
169500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15760000
169600             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15770000
169700         ELSE                                                     15780000
169800             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15790000
169900                 CONTINUE                                         15800000
170000             ELSE                                                 15810000
170100*                -- ONLY ONE END-OF-RANGE ALLOWED --              15820000
170200                 MOVE PC-TSYMSG-00055                             15830000
170300                                   TO DP020-MSG-NUMBER            15840000
170400                 SET DP020-MSG-FATAL                              15850000
170500                                   TO TRUE                        15860000
170600                 MOVE -1           TO MR-SELECTL (PV-SUB)         15870000
170700                 SET DP030-SET-CURSOR-APPL-1                      15880000
170800                                   TO TRUE                        15890000
170900                 SET PS-ERROR      TO TRUE                        15900000
171000             END-IF                                               15910000
171100         END-IF                                                   15920000
171200     END-IF.                                                      15930000
171300                                                                  15940000
171400*----------------------------------------------------------------*15950000
171500*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *15960000
171600*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *15970000
171700*----------------------------------------------------------------*15980000
171800 3400-CHECK-RANGE-SEQUENCE.                                       15990000
171900                                                                  16000000
172000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16010000
172100       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      16020000
172200       AND  ASC-START-OF-SELECTED-RANGE >                         16030000
172300                                         ASC-END-OF-SELECTED-RANGE16040000
172400*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                16050000
172500         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            16060000
172600         SET DP020-MSG-FATAL       TO TRUE                        16070000
172700         SET PS-ERROR              TO TRUE                        16080000
172800         PERFORM 3410-POSITION-AT-ERROR                           16090000
172900     END-IF.                                                      16100000
173000                                                                  16110000
173100*----------------------------------------------------------------*16120000
173200*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *16130000
173300*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *16140000
173400*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *16150000
173500*----------------------------------------------------------------*16160000
173600 3410-POSITION-AT-ERROR.                                          16170000
173700                                                                  16180000
173800     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       16190000
173900                                                                  16200000
174000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16210000
174100                    - PV-TOP-ITEM + 1.                            16220000
174200                                                                  16230000
174300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16240000
174400         CONTINUE                                                 16250000
174500     ELSE                                                         16260000
174600         MOVE -1                   TO MR-SELECTL (PV-SUB)         16270000
174700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16280000
174800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16290000
174900     END-IF.                                                      16300000
175000                                                                  16310000
175100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16320000
175200                    - PV-TOP-ITEM + 1.                            16330000
175300                                                                  16340000
175400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16350000
175500         CONTINUE                                                 16360000
175600     ELSE                                                         16370000
175700         MOVE -1                   TO MR-SELECTL (PV-SUB)         16380000
175800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16390000
175900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16400000
176000     END-IF.                                                      16410000
176100                                                                  16420000
176200/                                                                 16430000
176300*----------------------------------------------------------------*16440000
176400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *16450000
176500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *16460000
176600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *16470000
176700*----------------------------------------------------------------*16480000
176800                                                                  16490000
176900 3500-MARK-RANGE-AS-SELECTED.                                     16500000
177000                                                                  16510000
177100     MOVE +1                       TO ASC-BLK-SUB.                16520000
177200                                                                  16530000
177300     PERFORM 3510-MARK-SELECTED-INDS                              16540000
177400         VARYING ASC-ITEM-SUB                                     16550000
177500         FROM 1 BY 1                                              16560000
177600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16570000
177700                                                                  16580000
177800     ADD +1                        TO ASC-BLK-SUB.                16590000
177900                                                                  16600000
178000     PERFORM 3510-MARK-SELECTED-INDS                              16610000
178100         VARYING ASC-ITEM-SUB                                     16620000
178200         FROM 1 BY 1                                              16630000
178300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16640000
178400                                                                  16650000
178500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16660000
178600                                   TO PV-LIST-ITEM-NUMBER.        16670000
178700                                                                  16680000
178800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16690000
178900         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         16700000
179000               PC-ITEMS-PER-PANEL).                               16710000
179100                                                                  16720000
179200     MOVE ASC-START-OF-SELECTED-RANGE                             16730000
179300                                   TO PV-START-OF-SELECTED-RANGE. 16740000
179400                                                                  16750000
179500     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16760000
179600         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  16770000
179700               PC-ITEMS-PER-PANEL).                               16780000
179800                                                                  16790000
179900     MOVE ASC-END-OF-SELECTED-RANGE                               16800000
180000                                   TO PV-END-OF-SELECTED-RANGE.   16810000
180100                                                                  16820000
180200     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             16830000
180300         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    16840000
180400               PC-ITEMS-PER-PANEL).                               16850000
180500                                                                  16860000
180600     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             16870000
180700         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16880000
180800                                                                  16890000
180900     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16900000
181000        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16910000
181100         MOVE +1                   TO ASC-BLK-SUB                 16920000
181200         PERFORM 5100-WRITE-TEMP-STORAGE                          16930000
181300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16940000
181400             PV-FIRST-BLOCK-IN-ARRAY - 1                          16950000
181500                                                                  16960000
181600         PERFORM                                                  16970000
181700             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      16980000
181800                   PV-PREV-BLOCK-IN-ARRAY                         16990000
181900             MOVE PV-FIRST-BLOCK-IN-RANGE                         17000000
182000                                   TO PV-BLOCK-NUMBER             17010000
182100             PERFORM 4410-READ-TEMP-STORAGE                       17020000
182200             PERFORM 3510-MARK-SELECTED-INDS                      17030000
182300                 VARYING ASC-ITEM-SUB                             17040000
182400                 FROM 1 BY 1                                      17050000
182500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17060000
182600             PERFORM 5100-WRITE-TEMP-STORAGE                      17070000
182700             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     17080000
182800         END-PERFORM                                              17090000
182900                                                                  17100000
183000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17110000
183100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17120000
183200         PERFORM                                                  17130000
183300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17140000
183400                   PV-LAST-BLOCK-IN-RANGE                         17150000
183500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17160000
183600                                   TO PV-BLOCK-NUMBER             17170000
183700             PERFORM 4410-READ-TEMP-STORAGE                       17180000
183800             PERFORM 3510-MARK-SELECTED-INDS                      17190000
183900                 VARYING ASC-ITEM-SUB                             17200000
184000                 FROM 1 BY 1                                      17210000
184100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17220000
184200             PERFORM 5100-WRITE-TEMP-STORAGE                      17230000
184300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17240000
184400         END-PERFORM                                              17250000
184500                                                                  17260000
184600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17270000
184700                                   TO PV-BLOCK-NUMBER             17280000
184800         PERFORM 4410-READ-TEMP-STORAGE                           17290000
184900     END-IF.                                                      17300000
185000                                                                  17310000
185100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17320000
185200                                      ASC-END-OF-SELECTED-RANGE.  17330000
185300                                                                  17340000
185400/                                                                 17350000
185500*----------------------------------------------------------------*17360000
185600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17370000
185700*----------------------------------------------------------------*17380000
185800                                                                  17390000
185900 3510-MARK-SELECTED-INDS.                                         17400000
186000                                                                  17410000
186100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         17420000
186200         ASC-START-OF-SELECTED-RANGE)                             17430000
186300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         17440000
186400         ASC-START-OF-SELECTED-RANGE)                             17450000
186500                                                                  17460000
186600         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     17470000
186700             ASC-END-OF-SELECTED-RANGE)                           17480000
186800         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     17490000
186900             ASC-END-OF-SELECTED-RANGE)                           17500000
187000                                                                  17510000
187100             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17520000
187200                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   17530000
187300                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   17540000
187400                                   TO TRUE                        17550000
187500                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17560000
187600                                   TO TRUE                        17570000
187700                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS17580000
187800             END-IF                                               17590000
187900         END-IF                                                   17600000
188000     END-IF.                                                      17610000
188100                                                                  17620000
188200/                                                                 17630000
188300*----------------------------------------------------------------*17640000
188400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *17650000
188500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *17660000
188600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *17670000
188700*    DISPLAY THE PANEL TO USER.                                  *17680000
188800*----------------------------------------------------------------*17690000
188900                                                                  17700000
189000 4000-BUILD-INITIAL-PANEL.                                        17710000
189100                                                                  17720000
189200     INITIALIZE ASC-BLOCK-ENTRIES (1)                             17730000
189300                ASC-BLOCK-ENTRIES (2).                            17740000
189400                                                                  17750000
189500     MOVE +1                       TO ASC-BLK-SUB.                17760000
189600                                                                  17770000
189700     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       17780000
189800                                                                  17790000
189900     MOVE +0                       TO ASC-ITEM-SUB                17800000
190000                                      ASC-NUMBER-OF-ITEMS-READ    17810000
190100                                      ASC-NUMBER-OF-SELECTED-ITEMS17820000
190200                                      ASC-HIGHEST-BLOCK-WRITTEN   17830000
190300                                      ASC-START-OF-SELECTED-RANGE 17840000
190400                                      ASC-END-OF-SELECTED-RANGE   17850000
190500                                      ASC-ITEM-AT-TOP-OF-PANEL.   17860000
190600                                                                  17870000
190700     PERFORM 4100-PREPARE-CURSOR.                                 17880000
190800                                                                  17890000
190900     MOVE ZEROES                   TO PV-PO-LNE-NBR.              17900000
191000                                                                  17910000
191100     PERFORM 4010-OPEN-CURSOR.                                    17920000
191200                                                                  17930000
191300     PERFORM 4300-READ-ITEMS-FROM-DB.                             17940000
191400                                                                  17950000
191500     PERFORM 4020-CLOSE-CURSOR.                                   17960000
191600                                                                  17970000
191700     MOVE +1                       TO PV-TOP-ITEM.                17980000
191800                                                                  17990000
191900     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          18000000
192000         SET DP020-NEXT-ACT-APPL-ERROR                            18010000
192100                                   TO TRUE                        18020000
192200         SET DP020-MSG-FATAL       TO TRUE                        18030000
192300         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            18040000
192400     ELSE                                                         18050000
192500         MOVE -1                   TO MR-SELECTL (1)              18060000
192600         SET DP030-SET-CURSOR-APPL-1                              18070000
192700                                   TO TRUE                        18080000
192800         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     18090000
192900     END-IF.                                                      18100000
193000                                                                  18110000
193100/                                                                 18120000
193200*----------------------------------------------------------------*18130000
193300* OPEN THE PO LINE ITEM CURSOR                                   *18140000
193400*----------------------------------------------------------------*18150000
193500                                                                  18160000
193600 4010-OPEN-CURSOR.                                                18170000
193700                                                                  18180000
193800     PERFORM                                                      18190000
193900         WITH TEST AFTER                                          18200000
194000         VARYING PV-RETRY-COUNTER                                 18210000
194100         FROM 1 BY 1                                              18220000
194200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18230000
194300            OR (SQLCODE = +0))                                    18240000
194400                                                                  18250000
194500         EVALUATE TRUE                                            18260000
194600                                                                  18270000
194700             WHEN ASC-ITEM-CURSOR                                 18280000
194800                  EXEC SQL                                        18290000
194900                      OPEN ITEM-CSR                               18300000
195000                  END-EXEC                                        18310000
195100                                                                  18320000
195200             WHEN ASC-APP-ITEM-CURSOR                             18330000
195300                  EXEC SQL                                        18340000
195400                      OPEN APP-ITEM-CSR                           18350000
195500                  END-EXEC                                        18360000
195600                                                                  18370000
195700         END-EVALUATE                                             18380000
195800                                                                  18390000
195900         EVALUATE TRUE                                            18400000
196000             WHEN SQLCODE = +0                                    18410000
196100                  CONTINUE                                        18420000
196200             WHEN SQLCODE = -904                                  18430000
196300             WHEN SQLCODE = -913                                  18440000
196400                  CONTINUE                                        18450000
196500             WHEN SQLWARN0 NOT = SPACE                            18460000
196600             WHEN SQLCODE  NOT = +0                               18470000
196700                  MOVE '4010-OPEN-CURSOR'                         18480000
196800                                   TO DP013-PARAGRAPH             18490000
196900                  MOVE 'OPEN APP/ITEM-CSR CURSOR'                 18500000
197000                                   TO DP013-MESSAGE-TEXT (1)      18510000
197100                  MOVE SQLCA       TO DP013-SQLCA                 18520000
197200                  MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (1)    18530000
197300                  SET DP013-DB2-ABEND                             18540000
197400                                   TO TRUE                        18550000
197500                  PERFORM DP013-0000-PROCESS-ABEND                18560000
197600         END-EVALUATE                                             18570000
197700     END-PERFORM.                                                 18580000
197800                                                                  18590000
197900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18600000
198000         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             18610000
198100         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              18620000
198200                                   TO DP013-MESSAGE-TEXT (1)      18630000
198300         MOVE SQLCA                TO DP013-SQLCA                 18640000
198400         SET DP013-DB2-ABEND       TO TRUE                        18650000
198500         PERFORM DP013-0000-PROCESS-ABEND                         18660000
198600     END-IF.                                                      18670000
198700                                                                  18680000
198800/                                                                 18690000
198900*----------------------------------------------------------------*18700000
199000* CLOSE THE PO LINE ITEM CURSOR                                  *18710000
199100*----------------------------------------------------------------*18720000
199200                                                                  18730000
199300 4020-CLOSE-CURSOR.                                               18740000
199400                                                                  18750000
199500     EVALUATE TRUE                                                18760000
199600                                                                  18770000
199700         WHEN ASC-ITEM-CURSOR                                     18780000
199800              EXEC SQL                                            18790000
199900                  CLOSE ITEM-CSR                                  18800000
200000              END-EXEC                                            18810000
200100                                                                  18820000
200200         WHEN ASC-APP-ITEM-CURSOR                                 18830000
200300              EXEC SQL                                            18840000
200400                  CLOSE APP-ITEM-CSR                              18850000
200500              END-EXEC                                            18860000
200600                                                                  18870000
200700     END-EVALUATE.                                                18880000
200800                                                                  18890000
200900     EVALUATE TRUE                                                18900000
201000         WHEN SQLCODE = +0                                        18910000
201100              CONTINUE                                            18920000
201200                                                                  18930000
201300         WHEN SQLWARN0 NOT = SPACE                                18940000
201400         WHEN SQLCODE  NOT = +0                                   18950000
201500              MOVE '4020-CLOSE-CURSOR'                            18960000
201600                                   TO DP013-PARAGRAPH             18970000
201700              MOVE 'CLOSE APP/ITEM-CSR CURSOR'                    18980000
201800                                   TO DP013-MESSAGE-TEXT (1)      18990000
201900              MOVE SQLCA           TO DP013-SQLCA                 19000000
202000              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    19010000
202100              SET DP013-DB2-ABEND  TO TRUE                        19020000
202200              PERFORM DP013-0000-PROCESS-ABEND                    19030000
202300     END-EVALUATE.                                                19040000
202400                                                                  19050000
202500/                                                                 19060000
202600*----------------------------------------------------------------*19070000
202700*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *19080000
202800*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *19090000
202900*----------------------------------------------------------------*19100000
203000                                                                  19110000
203100 4100-PREPARE-CURSOR.                                             19120000
203200                                                                  19130000
W24803     INITIALIZE DCLTPURITM                                        19140000
W24803                DCLXLT00003                                       19150000
W24803                DCLXLT00004.                                      19160000
W24803     MOVE ASC-KEY-PO-NBR         TO PURITM-PO-NBR.                19170000
W24803     MOVE ASC-KEY-DEPT-NBR       TO PV-DEPT.                      19180000
W24803     MOVE PV-DEPT                TO XLT00004-DEPT-NBR.            19190000
W24803     IF PO017-MAJ-CL-NBR > '0000'                                 19200000
W24803       IF PO017-MAJ-CL-NBR (3:1) > 0                              19210000
W24803         MOVE PO017-MAJ-CL-NBR(3:1) TO PV-MAJ-CL-3                19220000
W24803       ELSE                                                       19230000
W24803         IF PO017-MAJ-CL-NBR (4:1) > 0                            19240000
W24803           MOVE PO017-MAJ-CL-NBR(4:1) TO PV-MAJ-CL-3              19250000
W24803         END-IF                                                   19260000
W24803       END-IF                                                     19270000
W24803       MOVE PV-MAJ-CLASS         TO PV-MAJ-CL-NBR-BEG             19280000
W24803                                    PV-MAJ-CL-NBR-END             19290000
W24803     ELSE                                                         19300000
W24803       MOVE +0                   TO PV-MAJ-CL-NBR-BEG             19310000
W24803       MOVE +9999                TO PV-MAJ-CL-NBR-END             19320000
W24803     END-IF.                                                      19330000
W24803     IF PO017-CL-NBR-BEG > SPACES                                 19340000
W24803       MOVE PO017-CL-NBR-BEG     TO PV-SUB-CL-3-4                 19350000
W24803       MOVE PV-SUB-CLASS         TO PV-SUB-CL-NBR-BEG             19360000
W24803                                    PV-SUB-CL-NBR-END             19370000
W24803     ELSE                                                         19380000
W24803       MOVE +0                   TO PV-SUB-CL-NBR-BEG             19390000
W24803       MOVE +9999                TO PV-SUB-CL-NBR-END             19400000
W24803     END-IF.                                                      19410000
W24803     MOVE PO017-GROUP-CODE       TO XLT00003-GP-CDE.              19420000
203500                                                                  19430000
203600/                                                                 19440000
203700*----------------------------------------------------------------*19450000
203800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *19460000
203900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *19470000
204000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *19480000
204100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *19490000
204200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *19500000
204300*                                                                *19510000
204400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *19520000
204500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *19530000
204600*    UPON INITIALIZATION.                                        *19540000
204700*----------------------------------------------------------------*19550000
204800                                                                  19560000
204900 4300-READ-ITEMS-FROM-DB.                                         19570000
205000                                                                  19580000
205100     PERFORM                                                      19590000
205200         VARYING PV-READ-COUNT                                    19600000
205300         FROM 1 BY 1                                              19610000
205400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19620000
205500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19630000
205600                                                                  19640000
205700         PERFORM 4310-FETCH                                       19650000
205800                                                                  19660000
205900         IF  ASC-ITEMS-LEFT-ON-DB                                 19670000
206000             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19680000
206100                 ADD +1            TO ASC-ITEM-SUB                19690000
206200             ELSE                                                 19700000
206300                 ADD +1            TO ASC-BLK-SUB                 19710000
206400                 MOVE +1           TO ASC-ITEM-SUB                19720000
206500                                                                  19730000
206600                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         19740000
206700                     MOVE +1       TO ASC-BLK-SUB                 19750000
206800                     SET ASC-BLOCK-MODIFIED (1)                   19760000
206900                                   TO TRUE                        19770000
207000                     PERFORM 5100-WRITE-TEMP-STORAGE              19780000
207100                     MOVE ASC-BLOCK-ENTRIES                       19790000
207200                               (PC-MAX-BLOCKS-IN-ARRAY)           19800000
207300                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 19810000
207400                     ADD +1        TO ASC-BLK-SUB                 19820000
207500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   19830000
207600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      19840000
207700                                   TO TRUE                        19850000
207800                 END-IF                                           19860000
207900             END-IF                                               19870000
208000             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    19880000
208100             MOVE ASC-NUMBER-OF-ITEMS-READ                        19890000
208200                                   TO ASC-LIST-ITEM-NUMBER        19900000
208300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19910000
208400             IF  ASC-ITEM-CURSOR                                  19920000
208500                 ADD +1            TO PV-PO-LNE-NBR               19930000
208600                 MOVE PV-PO-LNE-NBR                               19940000
208700                                   TO ASC-PO-LNE-VAR-NBR          19950000
208800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19960000
208900                 MOVE ZEROES       TO ASC-APP-PO-LNE-NBR          19970000
209000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19980000
209100             ELSE                                                 19990000
209200                 MOVE ZEROES       TO ASC-PO-LNE-VAR-NBR          20000000
209300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20010000
209400                 MOVE PURITM-APP-PO-LNE-NBR                       20020000
209500                                   TO ASC-APP-PO-LNE-NBR          20030000
209600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20040000
209700             END-IF                                               20050000
209800             MOVE PURITM-PO-LNE-NBR                               20060000
209900                                   TO ASC-PO-LNE-NBR              20070000
210000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20080000
210100             MOVE ASC-KEY-DEPT-NBR TO ASC-DEPT-NBR                20090000
210200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20100000
W24803             MOVE XLT00004-MAJ-CL-NBR TO ASC-MAJ-CL-NBR           20110000
W24803                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20120000
W24803             MOVE XLT00004-SUB-CL-NBR TO ASC-SUB-CL-NBR           20130000
W24803                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20140000
W24803             MOVE XLT00003-SKU-NBR    TO ASC-SKU-NBR              20150000
W24803                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20160000
W24803             MOVE XLT00003-SIZE-DESC  TO ASC-SIZE-DESC            20170000
W24803                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20180000
W24803             MOVE XLT00003-CSTM-CLOR-DESC                         20190000
W24803                                      TO ASC-COLOR-DESC           20200000
W24803                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20210000
W24803             MOVE XLT00003-SKU-DESC   TO ASC-VEND-DESC            20220000
W24803                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20230000
211600             MOVE PURITM-UNT-QTY   TO ASC-UNT-QTY                 20240000
211700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20250000
218100         END-IF                                                   20260000
218200     END-PERFORM.                                                 20270000
218300                                                                  20280000
218400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          20290000
218500         MOVE +1                   TO ASC-BLK-SUB                 20300000
218600         PERFORM 5100-WRITE-TEMP-STORAGE                          20310000
218700         ADD +1                    TO ASC-BLK-SUB                 20320000
218800         PERFORM 5100-WRITE-TEMP-STORAGE                          20330000
218900                                                                  20340000
219000         MOVE 1                    TO ASC-BLK-SUB                 20350000
219100                                      PV-BLOCK-NUMBER             20360000
219200         PERFORM 4410-READ-TEMP-STORAGE                           20370000
219300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             20380000
219400             MOVE 2                TO ASC-BLK-SUB                 20390000
219500                                      PV-BLOCK-NUMBER             20400000
219600             PERFORM 4410-READ-TEMP-STORAGE                       20410000
219700         END-IF                                                   20420000
219800     END-IF.                                                      20430000
219900                                                                  20440000
220000/                                                                 20450000
220100*----------------------------------------------------------------*20460000
220200*    FETCH A VENDOR ROW                                          *20470000
220300*----------------------------------------------------------------*20480000
220400                                                                  20490000
220500 4310-FETCH.                                                      20500000
220600                                                                  20510000
220700     EVALUATE TRUE                                                20520000
220800                                                                  20530000
220900         WHEN ASC-ITEM-CURSOR                                     20540000
221000              EXEC SQL                                            20550000
221100                  FETCH ITEM-CSR                                  20560000
221200                  INTO :PURITM-PO-LNE-NBR                         20570000
W24803                      ,:XLT00004-MAJ-CL-NBR                       20580000
W24803                      ,:XLT00004-SUB-CL-NBR                       20590000
W24803                      ,:XLT00003-SKU-NBR                          20600000
W24803                      ,:XLT00003-CSTM-CLOR-DESC                   20610000
W24803                      ,:XLT00003-SIZE-DESC                        20620000
W24803                      ,:XLT00003-SKU-DESC                         20630000
221800                      ,:PURITM-UNT-QTY                            20640000
221800                      ,:PURITM-APP-PO-LNE-NBR                     20650000
222000               END-EXEC                                           20660000
222100                                                                  20670000
222200         WHEN ASC-APP-ITEM-CURSOR                                 20680000
222300              EXEC SQL                                            20690000
222400                  FETCH APP-ITEM-CSR                              20700000
222500                  INTO :PURITM-PO-LNE-NBR                         20710000
222600                      ,:PURITM-APP-PO-LNE-NBR                     20720000
W24803                      ,:XLT00004-MAJ-CL-NBR                       20730000
W24803                      ,:XLT00004-SUB-CL-NBR                       20740000
W24803                      ,:XLT00003-SKU-NBR                          20750000
W24803                      ,:XLT00003-CSTM-CLOR-DESC                   20760000
W24803                      ,:XLT00003-SIZE-DESC                        20770000
W24803                      ,:XLT00003-SKU-DESC                         20780000
223200                      ,:PURITM-UNT-QTY                            20790000
223400               END-EXEC                                           20800000
223500                                                                  20810000
223600     END-EVALUATE                                                 20820000
223700                                                                  20830000
223800     EVALUATE TRUE                                                20840000
223900         WHEN SQLCODE = +0                                        20850000
224000              CONTINUE                                            20860000
224100         WHEN SQLCODE = +100                                      20870000
224200              SET ASC-NO-ITEMS-LEFT-ON-DB                         20880000
224300                                   TO TRUE                        20890000
224400         WHEN SQLWARN0 NOT = SPACE                                20900000
224500         WHEN SQLCODE < +0                                        20910000
224600         WHEN SQLCODE > +0                                        20920000
224700              MOVE '4310-FETCH-CURSOR'                            20930000
224800                                   TO DP013-PARAGRAPH             20940000
224900              MOVE 'FETCH APP/ITEM CURSOR'                        20950000
225000                                   TO DP013-MESSAGE-TEXT (1)      20960000
225100              MOVE SQLCA           TO DP013-SQLCA                 20970000
225200              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    20980000
W24803              MOVE 'XLT_SKU'       TO DP013-DB2-TABLE-NAME (2)    20990000
W24803              MOVE 'XLT_VND_STYL'  TO DP013-DB2-TABLE-NAME (3)    21000000
225300              SET DP013-DB2-ABEND  TO TRUE                        21010000
225400              PERFORM DP013-0000-PROCESS-ABEND                    21020000
225500     END-EVALUATE.                                                21030000
225600                                                                  21040000
225700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21050000
225800         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             21060000
225900         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             21070000
226000                                   TO DP013-MESSAGE-TEXT (1)      21080000
226100         MOVE SQLCA                TO DP013-SQLCA                 21090000
226200         SET DP013-DB2-ABEND                                      21100000
226300             DP013-XCTL-DISPLAY-RESTART                           21110000
226400                                   TO TRUE                        21120000
226500         PERFORM DP013-0000-PROCESS-ABEND                         21130000
226600     END-IF.                                                      21140000
226700                                                                  21150000
226800/                                                                 21160000
250600*----------------------------------------------------------------*21170000
250700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *21180000
250800*----------------------------------------------------------------*21190000
250900                                                                  21200000
251000 4400-MOVE-COMMAREA-TO-SCREEN.                                    21210000
251100                                                                  21220000
251200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             21230000
251300         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          21240000
251400         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          21250000
251500             MOVE +1               TO ASC-BLK-SUB                 21260000
251600             PERFORM 5100-WRITE-TEMP-STORAGE                      21270000
251700             ADD +1                TO ASC-BLK-SUB                 21280000
251800             PERFORM 5100-WRITE-TEMP-STORAGE                      21290000
251900             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             21300000
252000                 GIVING PV-BLOCK-NUMBER                           21310000
252100                 REMAINDER PV-REMAINDER                           21320000
252200             IF  PV-REMAINDER > ZERO                              21330000
252300                 ADD +1            TO PV-BLOCK-NUMBER             21340000
252400             END-IF                                               21350000
252500             MOVE +1               TO ASC-BLK-SUB                 21360000
252600             PERFORM 4410-READ-TEMP-STORAGE                       21370000
252700             ADD +1                TO ASC-BLK-SUB                 21380000
252800                                      PV-BLOCK-NUMBER             21390000
252900             PERFORM 4410-READ-TEMP-STORAGE                       21400000
253000     END-IF.                                                      21410000
253100                                                                  21420000
253200     MOVE +1                       TO ASC-BLK-SUB.                21430000
253300                                                                  21440000
253400     COMPUTE ASC-ITEM-SUB =                                       21450000
253500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              21460000
253600         + PC-ITEMS-PER-PANEL).                                   21470000
253700                                                                  21480000
253800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21490000
253900         ADD +1                    TO ASC-BLK-SUB                 21500000
254000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            21510000
254100     END-IF.                                                      21520000
254200                                                                  21530000
254300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           21540000
254400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                21550000
254500                                                                  21560000
254600     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        21570000
254700     PERFORM 4420-FORMAT-LIST-LINES                               21580000
254800         VARYING PV-SUB                                           21590000
254900         FROM PC-ITEMS-PER-PANEL BY -1                            21600000
255000         UNTIL PV-SUB < +1.                                       21610000
255100                                                                  21620000
255200     COMPUTE ASC-ITEMS-DISPLAYED =                                21630000
255300         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          21640000
255400                                                                  21650000
255500     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    21660000
255600                                      ASTRTITO.                   21670000
255700                                                                  21680000
255800     MOVE ASC-KEY-PO-NBR           TO MR-PO-NBR.                  21690000
255900     MOVE ASC-KEY-DEPT-NBR         TO MR-DEPT-NBR.                21700000
256000     MOVE ASC-KEY-ENT-NAME-DESC    TO MR-ENT-NAME-DESC.           21710000
256300                                                                  21720000
256400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    21730000
256500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    21740000
256600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21750000
256700                                   TO ASELITO.                    21760000
256800                                                                  21770000
256900     IF  DP020-MSG-NUMBER-X = SPACE                               21780000
257000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  21790000
257100*            --- MORE ITEMS TO DISPLAY ----                       21800000
257200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            21810000
257300             SET DP020-MSG-INFORMATIONAL                          21820000
257400                                   TO TRUE                        21830000
257500         END-IF                                                   21840000
257600     END-IF.                                                      21850000
257700                                                                  21860000
257800*----------------------------------------------------------------*21870000
257900*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *21880000
258000*----------------------------------------------------------------*21890000
258100                                                                  21900000
258200 4410-READ-TEMP-STORAGE.                                          21910000
258300                                                                  21920000
258400     EXEC CICS                                                    21930000
258500         READQ TS                                                 21940000
258600             QUEUE (ASC-LIST-QUEUE-NAME)                          21950000
258700             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21960000
258800             ITEM  (PV-BLOCK-NUMBER)                              21970000
258900             RESP  (PV-CICS-RESP)                                 21980000
259000     END-EXEC.                                                    21990000
259100                                                                  22000000
259200     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       22010000
259300       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     22020000
259400         CONTINUE                                                 22030000
259500     ELSE                                                         22040000
259600         SET DP013-CICS-ABEND      TO TRUE                        22050000
259700         SET DP013-NO-ROLLBACK     TO TRUE                        22060000
259800         MOVE '4410-READ-TEMP-STORAGE'                            22070000
259900                                   TO DP013-PARAGRAPH             22080000
260000         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      22090000
260100                                   TO DP013-MESSAGE-TEXT(1)       22100000
260200         PERFORM DP013-0000-PROCESS-ABEND                         22110000
260300     END-IF.                                                      22120000
260400                                                                  22130000
260500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      22140000
260600                                   TO TRUE.                       22150000
260700                                                                  22160000
260800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         22170000
260900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               22180000
261000     END-IF.                                                      22190000
261100                                                                  22200000
261200/                                                                 22210000
261300*----------------------------------------------------------------*22220000
261400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *22230000
261500*----------------------------------------------------------------*22240000
261600                                                                  22250000
261700 4420-FORMAT-LIST-LINES.                                          22260000
261800                                                                  22270000
261900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      22280000
262000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                22290000
262100         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         22300000
262200         MOVE SPACES               TO MR-PO-NBR-X                 22310000
262300                                      MR-DEPT-NBR                 22320000
262400                                      MR-ENT-NAME-DESC            22330000
262700                                      MR-SELECT  (PV-SUB)         22340000
262800                                      MR-PO-LNE-NBR-X (PV-SUB)    22350000
262900                                      MR-DEPT (PV-SUB)            22360000
W24803                                      MR-MAJ-CL-NBR-X (PV-SUB)    22370000
W24803                                      MR-SUB-CL-NBR-X (PV-SUB)    22380000
W24803                                      MR-SKU-NBR-X (PV-SUB)       22390000
263200                                      MR-VEND-DESC (PV-SUB)       22400000
263300                                      MR-SIZE-DESC (PV-SUB)       22410000
263400                                      MR-UNT-QTY-X (PV-SUB)       22420000
264000                                      MR-COLOR-DESC (PV-SUB)      22430000
264200     ELSE                                                         22440000
264300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22450000
264400                                                   > SPACE        22460000
264500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 22470000
264600                                   TO MR-SELECT (PV-SUB)          22480000
264700         ELSE                                                     22490000
264800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22500000
264900                                   TO MR-SELECT (PV-SUB)          22510000
265000         END-IF                                                   22520000
265100                                                                  22530000
265200         IF  DP030-SET-CURSOR-TRAILER                             22540000
265300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)22550000
265400                 > SPACE)                                         22560000
265500               OR (PV-SUB = 1))                                   22570000
265600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               22580000
265700                MOVE -1            TO MR-SELECTL (PV-SUB)         22590000
265800             END-IF                                               22600000
265900         END-IF                                                   22610000
266000                                                                  22620000
266100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           22630000
266200             IF  ASC-ITEM-CURSOR                                  22640000
266300                 MOVE ASC-PO-LNE-VAR-NBR                          22650000
266400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22660000
266500                                   TO MR-PO-LNE-NBR (PV-SUB)      22670000
266600             ELSE                                                 22680000
266700                 MOVE ASC-APP-PO-LNE-NBR                          22690000
266800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22700000
266900                                   TO MR-PO-LNE-NBR (PV-SUB)      22710000
267000             END-IF                                               22720000
267100             MOVE ASC-DEPT-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         22730000
267200                                   TO MR-DEPT (PV-SUB)            22740000
W24803             MOVE ASC-MAJ-CL-NBR (ASC-BLK-SUB ASC-ITEM-SUB)       22750000
W24803                                   TO MR-MAJ-CL-NBR (PV-SUB)      22760000
W24803             MOVE ASC-SUB-CL-NBR (ASC-BLK-SUB ASC-ITEM-SUB)       22770000
W24803                                   TO MR-SUB-CL-NBR (PV-SUB)      22780000
W24803             MOVE ASC-SKU-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          22790000
W24803                                   TO MR-SKU-NBR (PV-SUB)         22800000
267700             MOVE ASC-VEND-DESC (ASC-BLK-SUB ASC-ITEM-SUB)        22810000
267800                                   TO MR-VEND-DESC (PV-SUB)       22820000
267700             MOVE ASC-SIZE-DESC (ASC-BLK-SUB ASC-ITEM-SUB)        22830000
267800                                   TO MR-SIZE-DESC (PV-SUB)       22840000
268100             MOVE ASC-UNT-QTY (ASC-BLK-SUB ASC-ITEM-SUB)          22850000
268200                                   TO MR-UNT-QTY (PV-SUB)         22860000
270700             MOVE ASC-COLOR-DESC (ASC-BLK-SUB ASC-ITEM-SUB)       22870000
270800                                   TO MR-COLOR-DESC (PV-SUB)      22880000
271100         END-IF                                                   22890000
271200     END-IF.                                                      22900000
271300                                                                  22910000
271400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               22920000
271500                                                                  22930000
271600     IF  ASC-ITEM-SUB < + 1                                       22940000
271700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                22950000
271800         MOVE +1                   TO ASC-BLK-SUB                 22960000
271900     END-IF.                                                      22970000
272000                                                                  22980000
278200*----------------------------------------------------------------*22990000
278300*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *23000000
278400*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *23010000
278500*  ISSUE A WARNING.                                              *23020000
278600*----------------------------------------------------------------*23030000
278700 4430-CHECK-FOR-BEGIN-AND-END.                                    23040000
278800                                                                  23050000
278900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       23060000
279000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     23070000
279100*            -- NO END-OF-RANGE SPECFIED ---                      23080000
279200             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            23090000
279300             SET DP020-MSG-WARNING TO TRUE                        23100000
279400             PERFORM 4431-POSITION-AT-WARNING                     23110000
279500         END-IF                                                   23120000
279600     ELSE                                                         23130000
279700         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     23140000
279800*            -- NO BEGINNING-OF-RANGE SPECFIED ---                23150000
279900             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            23160000
280000             SET DP020-MSG-WARNING TO TRUE                        23170000
280100             PERFORM 4431-POSITION-AT-WARNING                     23180000
280200         END-IF                                                   23190000
280300     END-IF.                                                      23200000
280400                                                                  23210000
280500*----------------------------------------------------------------*23220000
280600*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *23230000
280700*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *23240000
280800*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *23250000
280900*  POSITION THE CURSOR THERE.                                    *23260000
281000*----------------------------------------------------------------*23270000
281100 4431-POSITION-AT-WARNING.                                        23280000
281200                                                                  23290000
281300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 23300000
281400                    - PV-TOP-ITEM + 1.                            23310000
281500                                                                  23320000
281600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23330000
281700         CONTINUE                                                 23340000
281800     ELSE                                                         23350000
281900         SET DP030-SET-CURSOR-APPL-1                              23360000
282000                                   TO TRUE                        23370000
282100         MOVE -1                   TO MR-SELECTL (PV-SUB)         23380000
282200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23390000
282300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23400000
282400     END-IF.                                                      23410000
282500                                                                  23420000
282600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   23430000
282700                    - PV-TOP-ITEM + 1.                            23440000
282800                                                                  23450000
282900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23460000
283000         CONTINUE                                                 23470000
283100     ELSE                                                         23480000
283200         SET DP030-SET-CURSOR-APPL-1                              23490000
283300                                   TO TRUE                        23500000
283400         MOVE -1                   TO MR-SELECTL (PV-SUB)         23510000
283500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23520000
283600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23530000
283700     END-IF.                                                      23540000
283800                                                                  23550000
283900/                                                                 23560000
284000*----------------------------------------------------------------*23570000
284100* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *23580000
284200* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *23590000
284300* FOR THE SELECTED ITEMS QUEUE.                                  *23600000
284400*                                                                *23610000
284500* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *23620000
284600* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *23630000
284700* THE ARRAY IS FULL.                                             *23640000
284800*----------------------------------------------------------------*23650000
284900                                                                  23660000
285000 5000-PREPARE-SEL-QUEUE.                                          23670000
285100                                                                  23680000
285200     MOVE +1                       TO ASC-BLK-SUB.                23690000
285300     PERFORM 5100-WRITE-TEMP-STORAGE.                             23700000
285400     ADD +1                        TO ASC-BLK-SUB.                23710000
285500     PERFORM 5100-WRITE-TEMP-STORAGE.                             23720000
285600                                                                  23730000
285700     MOVE ASC-SEL-QUEUE-NAME       TO PO013-SEL-QUEUE-NAME.       23740000
285800     PERFORM 6010-DELETE-SEL-QUEUE.                               23750000
285900                                                                  23760000
286000     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      23770000
286100         SET ASC-UPDATE-TSQ        TO TRUE                        23780000
286200     END-IF.                                                      23790000
286300                                                                  23800000
286400     SET PO012-IDX                 TO 1.                          23810000
286500     MOVE ZERO                     TO PO013-NUMBER-OF-TS-ITEMS.   23820000
286600     INITIALIZE PO012-SELECTED-ITEM-ARRAY.                        23830000
286700                                                                  23840000
286800     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           23850000
286900             VARYING PV-ITEM                                      23860000
287000             FROM 1 BY 1                                          23870000
287100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     23880000
287200                                                                  23890000
287300     IF  PO012-IDX > 1                                            23900000
287400         PERFORM 5205-WRITE-SEL-QUEUE                             23910000
287500         ADD +1                    TO PO013-NUMBER-OF-TS-ITEMS    23920000
287600     END-IF.                                                      23930000
287700                                                                  23940000
287800/                                                                 23950000
287900*----------------------------------------------------------------*23960000
288000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *23970000
288100*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *23980000
288200*----------------------------------------------------------------*23990000
288300                                                                  24000000
288400 5100-WRITE-TEMP-STORAGE.                                         24010000
288500                                                                  24020000
288600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     24030000
288700                                   TO PV-LIST-ITEM-NUMBER.        24040000
288800     COMPUTE PV-BLOCK-NUMBER =                                    24050000
288900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    24060000
289000                                                                  24070000
289100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             24080000
289200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             24090000
289300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      24100000
289400             PERFORM 5105-REWRITE-ASC-LISTQ                       24110000
289500         END-IF                                                   24120000
289600     ELSE                                                         24130000
289700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       24140000
289800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            24150000
289900         PERFORM 5110-WRITE-ASC-LISTQ                             24160000
290000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   24170000
290100     END-IF.                                                      24180000
290200                                                                  24190000
290300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      24200000
290400                                   TO TRUE.                       24210000
290500                                                                  24220000
290600/                                                                 24230000
290700*----------------------------------------------------------------*24240000
290800*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *24250000
290900*  SPECIFIC COMMAREA.                                            *24260000
291000*----------------------------------------------------------------*24270000
291100 5105-REWRITE-ASC-LISTQ.                                          24280000
291200                                                                  24290000
291300     EXEC CICS                                                    24300000
291400         WRITEQ TS                                                24310000
291500             QUEUE (ASC-LIST-QUEUE-NAME)                          24320000
291600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24330000
291700             ITEM  (PV-BLOCK-NUMBER)                              24340000
291800             REWRITE                                              24350000
291900             RESP  (PV-CICS-RESP)                                 24360000
292000     END-EXEC.                                                    24370000
292100                                                                  24380000
292200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           24390000
292300         CONTINUE                                                 24400000
292400     ELSE                                                         24410000
292500         SET DP013-CICS-ABEND      TO TRUE                        24420000
292600         SET DP013-NO-ROLLBACK     TO TRUE                        24430000
292700         MOVE '5105-REWRITE-ASC-LISTQ'                            24440000
292800                                   TO DP013-PARAGRAPH             24450000
292900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     24460000
293000                                   TO DP013-MESSAGE-TEXT(1)       24470000
293100         PERFORM DP013-0000-PROCESS-ABEND                         24480000
293200     END-IF.                                                      24490000
293300                                                                  24500000
293400/                                                                 24510000
293500*----------------------------------------------------------------*24520000
293600*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *24530000
293700*  SPECIFIC COMMAREA.                                            *24540000
293800*----------------------------------------------------------------*24550000
293900 5110-WRITE-ASC-LISTQ.                                            24560000
294000                                                                  24570000
294100     EXEC CICS                                                    24580000
294200         WRITEQ TS                                                24590000
294300             QUEUE (ASC-LIST-QUEUE-NAME)                          24600000
294400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24610000
294500             ITEM  (PV-BLOCK-NUMBER)                              24620000
294600             RESP  (PV-CICS-RESP)                                 24630000
294700     END-EXEC.                                                    24640000
294800                                                                  24650000
294900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      24660000
295000         SET DP013-CICS-ABEND      TO TRUE                        24670000
295100         SET DP013-NO-ROLLBACK     TO TRUE                        24680000
295200         MOVE '5110-WRITE-ASC-LISTQ'                              24690000
295300                                   TO DP013-PARAGRAPH             24700000
295400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           24710000
295500                                   TO DP013-MESSAGE-TEXT(1)       24720000
295600         PERFORM DP013-0000-PROCESS-ABEND                         24730000
295700     END-IF.                                                      24740000
295800                                                                  24750000
295900/                                                                 24760000
296000*----------------------------------------------------------------*24770000
296100* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *24780000
296200* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *24790000
296300*----------------------------------------------------------------*24800000
296400                                                                  24810000
296500 5200-FILL-SEL-QUEUE-RECORD.                                      24820000
296600                                                                  24830000
296700     PERFORM 6112-READ-LIST-QUEUE.                                24840000
296800                                                                  24850000
296900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       24860000
297000         PERFORM                                                  24870000
297100         VARYING LQW-IDX                                          24880000
297200         FROM 1 BY 1                                              24890000
297300         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            24900000
297400           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          24910000
297500                                                                  24920000
297600             IF  LQW-SELECT (LQW-IDX)                             24930000
297700                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              24940000
297800                                   TO PO012-ITEM (PO012-IDX)      24950000
297900                 MOVE LQW-PO-LNE-NBR (LQW-IDX)                    24960000
298000                           TO PO012-PO-LNE-NBR (PO012-IDX)        24970000
298100                              PO013-PO-LNE-NBR                    24980000
298200                 MOVE LQW-APP-PO-LNE-NBR (LQW-IDX)                24990000
298300                           TO PO012-APP-PO-LNE-NBR (PO012-IDX)    25000000
298400                 MOVE LQW-PO-LNE-VAR-NBR (LQW-IDX)                25010000
298500                           TO PO012-PO-LNE-VAR-NBR (PO012-IDX)    25020000
298600                 MOVE 'I'          TO PO012-ACTION-SW (PO012-IDX) 25030000
298700                 SET PO012-IDX UP BY 1                            25040000
298800                 IF  PO012-IDX > PO012-MAX-ITEMS                  25050000
298900                     PERFORM 5205-WRITE-SEL-QUEUE                 25060000
299000                     ADD +1        TO PO013-NUMBER-OF-TS-ITEMS    25070000
299100                     INITIALIZE PO012-SELECTED-ITEM-ARRAY         25080000
299200                     SET PO012-IDX TO 1                           25090000
299300                 END-IF                                           25100000
299400             END-IF                                               25110000
299500         END-PERFORM                                              25120000
299600     END-IF.                                                      25130000
299700                                                                  25140000
299800/                                                                 25150000
299900*----------------------------------------------------------------*25160000
300000*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *25170000
300100*----------------------------------------------------------------*25180000
300200                                                                  25190000
300300 5205-WRITE-SEL-QUEUE.                                            25200000
300400                                                                  25210000
300500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            25220000
300600                                   TO PO012-SELECTED-ITEMS.       25230000
300700                                                                  25240000
300800     EXEC CICS                                                    25250000
300900          WRITEQ TS                                               25260000
301000              QUEUE (ASC-SEL-QUEUE-NAME)                          25270000
301100              FROM  (PO012-PO-SELECT-RECORD)                      25280000
301200              ITEM  (PV-SEL-QUEUE-ITEM)                           25290000
301300              RESP  (PV-CICS-RESP)                                25300000
301400     END-EXEC.                                                    25310000
301500                                                                  25320000
301600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25330000
301700         CONTINUE                                                 25340000
301800     ELSE                                                         25350000
301900         SET DP013-CICS-ABEND      TO TRUE                        25360000
302000         SET DP013-NO-ROLLBACK     TO TRUE                        25370000
302100         MOVE '5205-WRITE-SEL-QUEUE'                              25380000
302200                                   TO DP013-PARAGRAPH             25390000
302300         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          25400000
302400                                   TO DP013-MESSAGE-TEXT(1)       25410000
302500         PERFORM DP013-0000-PROCESS-ABEND                         25420000
302600     END-IF.                                                      25430000
302700                                                                  25440000
302800/                                                                 25450000
302900*----------------------------------------------------------------*25460000
303000*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *25470000
303100*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *25480000
303200*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *25490000
303300*  THE USER.                                                     *25500000
303400*----------------------------------------------------------------*25510000
303500 6000-REFRESH-PANEL-FROM-TEMP.                                    25520000
303600                                                                  25530000
303700     IF  ASC-UPDATE-TSQ                                           25540000
303800         SET ASC-NO-TSQ-UPDATE     TO TRUE                        25550000
303900         MOVE ZERO                 TO PV-SAVE-ITEM                25560000
304000                                      PV-SEL-QUEUE-ITEM           25570000
304100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        25580000
304200                                   TO PV-HOLD-SELECTED-ITEMS      25590000
304300            PERFORM 6100-UPDATE-TSQ                               25600000
304400                UNTIL PV-ITEMS-PROCESSED >                        25610000
304500                                    PV-HOLD-SELECTED-ITEMS        25620000
304600         PERFORM 6010-DELETE-SEL-QUEUE                            25630000
304700         INITIALIZE ASC-BLOCK-ENTRIES (1)                         25640000
304800                    ASC-BLOCK-ENTRIES (2)                         25650000
304900     END-IF.                                                      25660000
305000                                                                  25670000
305100/                                                                 25680000
305200*----------------------------------------------------------------*25690000
305300*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *25700000
305400*----------------------------------------------------------------*25710000
305500 6010-DELETE-SEL-QUEUE.                                           25720000
305600                                                                  25730000
305700     EXEC CICS                                                    25740000
305800         DELETEQ TS                                               25750000
305900             QUEUE (ASC-SEL-QUEUE-NAME)                           25760000
306000             RESP  (PV-CICS-RESP)                                 25770000
306100     END-EXEC.                                                    25780000
306200                                                                  25790000
306300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      25800000
306400         (PV-CICS-RESP = DFHRESP(QIDERR)))                        25810000
306500         CONTINUE                                                 25820000
306600     ELSE                                                         25830000
306700         SET DP013-CICS-ABEND      TO TRUE                        25840000
306800         SET DP013-NO-ROLLBACK     TO TRUE                        25850000
306900         MOVE '6010-DELETE-SEL-QUEUE'                             25860000
307000                                   TO DP013-PARAGRAPH             25870000
307100         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         25880000
307200                                   TO DP013-MESSAGE-TEXT (1)      25890000
307300         PERFORM DP013-0000-PROCESS-ABEND                         25900000
307400     END-IF.                                                      25910000
307500                                                                  25920000
307600/                                                                 25930000
307700*----------------------------------------------------------------*25940000
307800*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *25950000
307900*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *25960000
308000*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *25970000
308100*    THE TEMP QUEUE.                                             *25980000
308200*----------------------------------------------------------------*25990000
308300                                                                  26000000
308400 6100-UPDATE-TSQ.                                                 26010000
308500                                                                  26020000
308600     ADD 1                         TO PV-SEL-QUEUE-ITEM.          26030000
308700     PERFORM 6105-READ-SEL-QUEUE.                                 26040000
308800                                                                  26050000
308900     PERFORM                                                      26060000
309000         VARYING PO012-IDX                                        26070000
309100         FROM 1 BY 1                                              26080000
309200         UNTIL ((PV-ITEMS-PROCESSED >                             26090000
309300                              PV-HOLD-SELECTED-ITEMS)             26100000
309400         OR (PO012-IDX GREATER THAN PO012-MAX-ITEMS))             26110000
309500         IF  PO012-ACTION-SW (PO012-IDX) > SPACE                  26120000
309600             PERFORM 6110-PROCESS-ITEMS                           26130000
309700         END-IF                                                   26140000
309800         ADD +1                    TO PV-ITEMS-PROCESSED          26150000
309900     END-PERFORM.                                                 26160000
310000                                                                  26170000
310100     PERFORM 6111-WRITE-LIST-QUEUE.                               26180000
310200/                                                                 26190000
310300*----------------------------------------------------------------*26200000
310400*    READ THE LIST QUEUE RECORD.                                 *26210000
310500*----------------------------------------------------------------*26220000
310600                                                                  26230000
310700 6105-READ-SEL-QUEUE.                                             26240000
310800                                                                  26250000
310900     EXEC CICS                                                    26260000
311000          READQ TS                                                26270000
311100              QUEUE (ASC-SEL-QUEUE-NAME)                          26280000
311200              INTO  (PO012-PO-SELECT-RECORD)                      26290000
311300              ITEM  (PV-SEL-QUEUE-ITEM)                           26300000
311400              RESP  (PV-CICS-RESP)                                26310000
311500     END-EXEC.                                                    26320000
311600                                                                  26330000
311700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26340000
311800         CONTINUE                                                 26350000
311900     ELSE                                                         26360000
312000         SET DP013-CICS-ABEND      TO TRUE                        26370000
312100         SET DP013-NO-ROLLBACK     TO TRUE                        26380000
312200         MOVE '6105-READ-SEL-QUEUE'                               26390000
312300                                   TO DP013-PARAGRAPH             26400000
312400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           26410000
312500                                   TO DP013-MESSAGE-TEXT(1)       26420000
312600         PERFORM DP013-0000-PROCESS-ABEND                         26430000
312700     END-IF.                                                      26440000
312800                                                                  26450000
312900/                                                                 26460000
313000*----------------------------------------------------------------*26470000
313100*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*26480000
313200*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*26490000
313300*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *26500000
313400*----------------------------------------------------------------*26510000
313500                                                                  26520000
313600 6110-PROCESS-ITEMS.                                              26530000
313700                                                                  26540000
313800     COMPUTE PV-ITEM = 1 + ((PO012-ITEM (PO012-IDX) - 1)          26550000
313900                     / PC-ITEMS-PER-PANEL).                       26560000
314000                                                                  26570000
314100     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           26580000
314200         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          26590000
314300             PERFORM 6111-WRITE-LIST-QUEUE                        26600000
314400         END-IF                                                   26610000
314500         MOVE PV-ITEM              TO PV-SAVE-ITEM                26620000
314600                                                                  26630000
314700         PERFORM 6112-READ-LIST-QUEUE                             26640000
314800         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               26650000
314900             CONTINUE                                             26660000
315000         END-IF                                                   26670000
315100     END-IF.                                                      26680000
315200                                                                  26690000
315300     COMPUTE PV-SUB = (PO012-ITEM (PO012-IDX)                     26700000
315400                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              26710000
315500                                                                  26720000
315600     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       26730000
315700     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        26740000
315800                                     (PV-SUB).                    26750000
315900     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                26760000
316000                                                                  26770000
316100/                                                                 26780000
316200*----------------------------------------------------------------*26790000
316300*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *26800000
316400*----------------------------------------------------------------*26810000
316500                                                                  26820000
316600 6111-WRITE-LIST-QUEUE.                                           26830000
316700                                                                  26840000
316800     EXEC CICS                                                    26850000
316900         WRITEQ TS                                                26860000
317000             QUEUE (ASC-LIST-QUEUE-NAME)                          26870000
317100             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     26880000
317200             ITEM  (PV-SAVE-ITEM)                                 26890000
317300             REWRITE                                              26900000
317400             RESP  (PV-CICS-RESP)                                 26910000
317500     END-EXEC.                                                    26920000
317600                                                                  26930000
317700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26940000
317800         CONTINUE                                                 26950000
317900     ELSE                                                         26960000
318000         SET DP013-CICS-ABEND      TO TRUE                        26970000
318100         SET DP013-NO-ROLLBACK     TO TRUE                        26980000
318200         MOVE '6111-WRITE-LIST-QUEUE'                             26990000
318300                                   TO DP013-PARAGRAPH             27000000
318400         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  27010000
318500                                   TO DP013-MESSAGE-TEXT(1)       27020000
318600         PERFORM DP013-0000-PROCESS-ABEND                         27030000
318700     END-IF.                                                      27040000
318800                                                                  27050000
318900/                                                                 27060000
319000*----------------------------------------------------------------*27070000
319100*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*27080000
319200*----------------------------------------------------------------*27090000
319300                                                                  27100000
319400 6112-READ-LIST-QUEUE.                                            27110000
319500                                                                  27120000
319600     EXEC CICS                                                    27130000
319700         READQ TS                                                 27140000
319800             QUEUE (ASC-LIST-QUEUE-NAME)                          27150000
319900             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     27160000
320000             ITEM  (PV-ITEM)                                      27170000
320100             RESP  (PV-CICS-RESP)                                 27180000
320200     END-EXEC.                                                    27190000
320300                                                                  27200000
320400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27210000
320500         CONTINUE                                                 27220000
320600     ELSE                                                         27230000
320700         SET DP013-CICS-ABEND      TO TRUE                        27240000
320800         SET DP013-NO-ROLLBACK     TO TRUE                        27250000
320900         MOVE '6112-READ-LIST-QUEUE'                              27260000
321000                                   TO DP013-PARAGRAPH             27270000
321100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    27280000
321200                                   TO DP013-MESSAGE-TEXT(1)       27290000
321300         PERFORM DP013-0000-PROCESS-ABEND                         27300000
321400     END-IF.                                                      27310000
321500                                                                  27320000
321600/                                                                 27330000
321700*----------------------------------------------------------------*27340000
321800*    ABEND PROCESSOR MODULE                                      *27350000
321900*----------------------------------------------------------------*27360000
322000                                                                  27370000
322100     COPY DPPD013.                                                27380000
