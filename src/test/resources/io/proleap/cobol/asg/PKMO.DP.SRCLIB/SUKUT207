000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    SUKUT207.                                         00050000
000600 AUTHOR.        GERMAN BANDA.                                     00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   MAY 2022.                                         00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM WILL BE USED TO CREATE A COMMA DELIMITED FILE     00120000
001300*  THAT WILL CONTAIN CARTON INFORMATION FOR P2L CARTONS           00130000
001500*                                                                 00150000
001600*  THE FILE WILL TAKE EACH CARTON AND THEN GENERATE RECORDS       00160000
001700*  FOR ANY ACTIVITY FOUND AGAINST THE CARTON THROUGH OUR          00170000
001800*  SYSTEM.  EACH RECORD WILL BE AN ACTIVITY AGAINST THE CARTON    00180000
001900*  AND WILL CONTAIN A DESCRIPTION OF THE ACTIVITY, THE DATE/TIME  00190000
002000*  THE ACTIVITY TOOK PLACE AND BY WHAT DC.                        00200000
002100*  SOME EXAMPLES OF THE DIFFERENT TYPES OF ACTIVITY ARE:          00210000
002200*    RF CHECKIN                                                   00220000
002300*    PNA CHECKIN                                                  00230000
002400*    CARTON AUDIT START                                           00240000
002500*    CARTON AUDIT STOP                                            00250000
002600*    PACK-TO-LIGHT LAUNCH                                         00260000
002700*  THE COPYBOOK FOR THE OUTPUT FILE WILL BE SURD173.              00270000
002800*                                                                 00280000
002900*  THE PROGRAM WILL START WITH THE PACK TO LIGHT LAUNCH           00290000
003000*  WHERE THE P2L CARTON ENDS.  FROM THE LAUNCH EVENT, THE PROGRAM 00300000
003100*  WILL DETERMINE THE VENDOR CARTON INFORMATION AND RECORD THE    00310000
003200*  EVENTS FOWARD.                                                 00320000
003210*                                                                 00321000
003300*  THE FILE WILL BE SENT TO A THIRD PARTY CONSULTING FIRM         00330000
003400*  WORKING WITH THE LOGISTICS BUSINESS TEAM FOR DOING LABOR       00340000
003500*  STUDIES.                                                       00350000
003600******************************************************************00360000
003700                                                                  00370000
003800******************************************************************00380000
003900 ENVIRONMENT DIVISION.                                            00390000
004000******************************************************************00400000
004100                                                                  00410000
004200 CONFIGURATION SECTION.                                           00420000
004300                                                                  00430000
004400 SOURCE-COMPUTER.        IBM-3090.                                00440000
004500 OBJECT-COMPUTER.        IBM-3090.                                00450000
004600                                                                  00460000
004700 INPUT-OUTPUT SECTION.                                            00470000
004800                                                                  00480000
004900 FILE-CONTROL.                                                    00490000
005000                                                                  00500000
005400     SELECT SU-P2L-ACTIVITY-FILE                                  00540008
005500         ASSIGN TO OUT01.                                         00550000
005600                                                                  00560000
005700******************************************************************00570000
005800 DATA DIVISION.                                                   00580000
005900******************************************************************00590000
006000                                                                  00600000
006100 FILE SECTION.                                                    00610000
007000 FD  SU-P2L-ACTIVITY-FILE                                         00700008
007100     RECORDING MODE IS F                                          00710000
007200     BLOCK CONTAINS 0 RECORDS                                     00720000
007300     LABEL RECORDS ARE STANDARD.                                  00730000
007400                                                                  00740000
007500 01  SU-P2L-ACTIVITY-FILE-RECORD      PIC  X(100).                00750008
007600                                                                  00760000
007700                                                                  00770000
007800******************************************************************00780000
007900 WORKING-STORAGE SECTION.                                         00790000
008000******************************************************************00800000
008100                                                                  00810000
008200                                                                  00820000
008300 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00830000
008400                                                   COMP SYNC.     00840000
008500                                                                  00850000
008600                                                                  00860000
008700 01  DK-DB2-KEYS.                                                 00870000
008903                                                                  00890302
009000     05  DK-LOC-ID                   PIC S9(04)    VALUE +0.      00900023
009400                                                                  00940000
009500 01  PC-PROGRAM-CONSTANTS.                                        00950000
009600     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00960000
009700         'SUKUT207'.                                              00970000
009800     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       00980000
009900                                                   COMP SYNC.     00990000
009910     05  PC-COMMA                    PIC  X(01)    VALUE ','.     00991094
009920                                                                  00992094
010000 01  PS-PROGRAM-SWITCHES.                                         01000000
010100     05  PS-EOF-INPUT-FILE-SW        PIC  X(01)    VALUE 'N'.     01010000
010200         88  PS-EOF-INPUT-FILE                     VALUE 'Y'.     01020000
010300         88  PS-NOT-EOF-INPUT-FILE                 VALUE 'N'.     01030000
010400     05  PS-END-OF-CURSOR-SW         PIC  X(01)    VALUE 'N'.     01040000
010500         88  PS-END-OF-CURSOR                      VALUE 'Y'.     01050000
010600         88  PS-NOT-END-OF-CURSOR                  VALUE 'N'.     01060000
010601     05  PS-END-OF-LBL-CURSOR-SW     PIC  X(01)    VALUE 'N'.     01060119
010602         88  PS-END-OF-LBL-CSR                     VALUE 'Y'.     01060219
010603         88  PS-NOT-END-OF-LBL-CSR                 VALUE 'N'.     01060319
010607     05  PS-END-OF-DVRT-CURSOR-SW    PIC  X(01)    VALUE 'N'.     01060734
010608         88  PS-END-OF-DVRT-CSR                    VALUE 'Y'.     01060834
010609         88  PS-NOT-END-OF-DVRT-CSR                VALUE 'N'.     01060934
010610     05  PS-END-OF-AUD-CURSOR-SW     PIC  X(01)    VALUE 'N'.     01061034
010611         88  PS-END-OF-AUD-CSR                     VALUE 'Y'.     01061134
010612         88  PS-NOT-END-OF-AUD-CSR                 VALUE 'N'.     01061234
010613     05  PS-END-OF-TAG-CURSOR-SW     PIC  X(01)    VALUE 'N'.     01061381
010614         88  PS-END-OF-TAG-CURSOR                  VALUE 'Y'.     01061481
010615         88  PS-NOT-END-OF-TAG-CSR                 VALUE 'N'.     01061581
010616     05  PS-P2L-BRCDE-FOUND-SW       PIC  X(01)    VALUE 'N'.     01061681
010620         88  PS-P2L-BRCDE-FOUND-YES                VALUE 'Y'.     01062010
010630         88  PS-P2L-BRCDE-FOUND-NO                 VALUE 'N'.     01063010
010640     05  PS-CHECK-IN-RECORD-FOUND-SW PIC  X(01)    VALUE 'N'.     01064023
010650         88  PS-PNA-CHKIN-RECORD-FOUND             VALUE 'P'.     01065042
010651         88  PS-RF-CHKIN-RECORD-FOUND              VALUE 'R'.     01065142
010660         88  PS-CHECK-IN-RECORD-FOUND-NO           VALUE 'N'.     01066017
010680     05  PS-AUTOCY-DIRECTIVE-MODE      PIC X(01)     VALUE SPACES.01068079
010690         88  ALL-CARTONS-DIRECTIVES-MODE             VALUE 'A'.   01069079
010691         88  EXCEPTION-DIRECTIVES-MODE               VALUE 'E'.   01069179
010692         88  NO-DIRECTIVES-MODE                      VALUE 'N'.   01069279
010700                                                                  01070000
010800 01  PV-PROGRAM-VARIABLES.                                        01080000
010810     05  PV-DISP-NBR                 PIC ZZZ,ZZZ,ZZ9.             01081098
010910     05  PV-P2L-CRTN-FETCH-COUNT     PIC S9(09) COMP.             01091098
011000     05  PV-OUTPUT-WRITE-COUNT       PIC S9(09) COMP.             01100000
011010     05  PV-BRCDE-MISSING-COUNT      PIC S9(09) COMP.             01101011
011020     05  PV-PREV-P2L-BARCODE         PIC X(22)  VALUE SPACES.     01102074
011100                                                                  01110000
011110     05  PV-ACTIVITY-RECORD-TYPE     PIC  X(01)    VALUE SPACE.   01111042
011120         88  PV-INBOUND-LAUNCH                     VALUE 'A'.     01112042
011130         88  PV-CHECK-IN                           VALUE 'B'.     01113042
011141         88  PV-PNA-AUDIT-LABEL-PRINT              VALUE 'D'.     01114142
011150         88  PV-CARTON-AUDIT-START                 VALUE 'E'.     01115047
011160         88  PV-CARTON-AUDIT-STOP                  VALUE 'F'.     01116047
011170         88  PV-CARTON-DIRECTIVE                   VALUE 'G'.     01117047
011180         88  PV-LABEL-PRINT                        VALUE 'H'.     01118047
011190         88  PV-PNA-LABEL-PRINT                    VALUE 'I'.     01119056
011191         88  PV-EAS-TAG-PROCESS                    VALUE 'J'.     01119180
011192                                                                  01119299
011193     05  PV-HOLD-TMST.                                            01119399
011194         10  PV-HOLD-TMST-YYYY       PIC 9(04).                   01119499
011195         10  PV-HOLD-TMST-DASH1      PIC X(01).                   01119599
011196         10  PV-HOLD-TMST-MM         PIC 9(02).                   01119699
011197         10  PV-HOLD-TMST-DASH2      PIC X(01).                   01119799
011198         10  PV-HOLD-TMST-DD         PIC 9(02).                   01119899
011199         10  PV-HOLD-TMST-DASH3      PIC X(01).                   01119999
011200         10  PV-HOLD-TMST-HH         PIC 9(02).                   01120099
011201         10  PV-HOLD-TMST-PERIOD1    PIC X(01).                   01120199
011202         10  PV-HOLD-TMST-MI         PIC 9(02).                   01120299
011203         10  PV-HOLD-TMST-PERIOD2    PIC X(01).                   01120399
011204         10  PV-HOLD-TMST-SS         PIC 9(02).                   01120499
011205         10  PV-HOLD-TMST-PERIOD3    PIC X(01).                   01120599
011206         10  PV-HOLD-TMST-NNNNNN     PIC 9(06).                   01120699
011207                                                                  01120799
011208     05  PV-MAX-ERROR-COUNT          PIC S9(09) COMP.             01120800
011209     05  PV-PO-NBR                   PIC  S9(9) COMP.             01120918
011210     05  PV-RCVR-SEQ-NBR             PIC  S9(9) COMP.             01121018
011211     05  PV-PO-LNE-NBR               PIC  S9(9) COMP.             01121118
011212     05  PV-LBL-ASG-SEQ-NBR          PIC  S9(9) COMP.             01121218
011213     05  PV-P2L-BARCODE              PIC  X(22).                  01121319
011214     05  PV-ACTIVITY-TIMESTAMP       PIC  X(26).                  01121429
011215     05  PV-CARTON-ACTIVITY          PIC  X(30).                  01121556
011216                                                                  01121656
011217     05  PV-CSR-AUDIT-PROMPT-CDE     PIC  X(1).                   01121787
011218     05  PV-OPER-UNT-ID              PIC S9(04)    VALUE +0       01121856
011219                                                   COMP SYNC.     01121956
011220     05  DK-LOC-ID                   PIC S9(04)    VALUE +0       01122056
011221                                                   COMP SYNC.     01122156
011222     05  PV-SHIPT-UNT-ID             PIC S9(18)    VALUE +0       01122256
011223                                                   COMP-3.        01122356
011224                                                                  01122456
011225     05  PV-BAR-CODE                     PIC  X(40) VALUE ZEROES. 01122556
011226     05  PV-BAR-CODE-N  REDEFINES  PV-BAR-CODE.                   01122602
011230         10 FILLER                       PIC  9(13).              01123002
011240         10 PV-BRCDE-LBL-SEQ             PIC  9(04).              01124002
011250         10 FILLER                       PIC  9(23).              01125002
013500                                                                  01350000
013510     05  PV-BAR-CODE-MSG-LBL.                                     01351058
013521         10 PV-BRCDE-PRINT-TXT           PIC  X(11).              01352156
013522         10 FILLER                       PIC  X(01).              01352256
013530         10 PV-BAR-CODE-TXT              PIC  X(10).              01353056
013560                                                                  01356056
013570     05  PV-CARTON-AUDIT-ACTIVITY.                                01357087
013580         10 PV-CRTN-AUD-STRT-STOP        PIC  X(18).              01358087
013590         10 FILLER                       PIC  X(01).              01359087
013591         10 PV-CRTN-AUD-TYPE             PIC  X(04).              01359187
013592         10 FILLER                       PIC  X(01).              01359287
013593         10 PV-CRTN-AUD-PRMPT            PIC  X(06).              01359387
013594                                                                  01359487
013595                                                                  01359562
013600     05  PV-TOTAL-WRITE-CNT          PIC  9(09)    VALUE ZERO.    01360008
013800     05  PV-BYPASS-COUNT             PIC  9(09)    VALUE ZERO.    01380000
013900     05  PV-COUNTER                  PIC S9(04)    VALUE ZERO.    01390000
014000                                                                  01400000
014100     05  PV-OPER-UNT-ID-DISP.                                     01410000
014200         10  PV-OPER-UNT-ID-N        PIC 9(04)     VALUE ZERO.    01420000
014210         10  PV-SHIPT-UNT-ID-N       PIC 9(18)     VALUE ZERO.    01421019
014300                                                                  01430000
014400     05  PV-STR-CSR-OPER-UNT-ID      PIC S9(4) COMP VALUE ZEROES. 01440000
014500     05  PV-CSR-DIVERT-NBR           PIC S9(9) COMP VALUE ZEROES. 01450000
014600     05  PV-CSR-DIVERT-LOC-ID        PIC  X(4)      VALUE SPACES. 01460000
014700     05  PV-CSR-ASGMT-DATE           PIC  X(10)     VALUE SPACES. 01470000
014800     05  PV-CSR-ASGMT-TIME           PIC  X(08)     VALUE SPACES. 01480000
014900                                                                  01490000
015000     05  PV-NULL-IND-1                  PIC S9(04)  VALUE ZEROS   01500000
015100                                                    COMP SYNC.    01510000
015200     05  PV-NULL-IND-2                  PIC S9(04)  VALUE ZEROS   01520000
015300                                                    COMP SYNC.    01530000
015400     05  PV-NULL-IND-3                  PIC S9(04)  VALUE ZEROS   01540000
015500                                                    COMP SYNC.    01550000
015600                                                                  01560000
015700 01  PV-ABEND-VARIABLES.                                          01570000
015800     05  PV-SQLCODE                  PIC S9(9).                   01580000
015900     05  PV-DISPLAY-SQLCODE          PIC -999.                    01590000
016000     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'SUKUT207'.  01600000
016100     05  PV-ABEND-PARAGRAPH          PIC X(30) VALUE SPACES.      01610000
016200     05  PV-ABEND-OPER-MESSAGE-1     PIC X(79) VALUE SPACES.      01620000
016300     05  PV-ABEND-OPER-MESSAGE-2     PIC X(79) VALUE SPACES.      01630000
016400     05  PV-ABEND-OPER-MESSAGE-3     PIC X(79) VALUE SPACES.      01640000
016500     05  PV-ABEND-OPER-MESSAGE-4     PIC X(79) VALUE SPACES.      01650000
016600     05  PV-ABEND-TABLE-1            PIC X(19) VALUE SPACES.      01660000
016700     05  PV-ABEND-TABLE-2            PIC X(19) VALUE SPACES.      01670000
016800     05  PV-ABEND-TABLE-3            PIC X(19) VALUE SPACES.      01680000
016900     05  PV-ABEND-TABLE-4            PIC X(19) VALUE SPACES.      01690000
017000                                                                  01700000
017600******************************************************************01760000
017700** OUTPUT FILE LAYOUT                                           **01770000
017800******************************************************************01780000
017900     COPY SURD173.                                                01790008
018000                                                                  01800000
018100******************************************************************01810000
018200** DB2 FORMATTED MESSAGE AREA                                   **01820000
018300******************************************************************01830000
018400     COPY DPWS004.                                                01840000
018500                                                                  01850000
018600******************************************************************01860000
018700** COMMUNICATIONS AREA FOR DB2                                  **01870000
018800******************************************************************01880000
018900     EXEC SQL                                                     01890000
019000          INCLUDE SQLCA                                           01900000
019100     END-EXEC.                                                    01910000
019200                                                                  01920000
019300******************************************************************01930000
019400** PCT BUSINESS EVENT EXPORT TABLE  (PCT_BUS_EVNT_EXPRT)        **01940009
019500******************************************************************01950000
019600     EXEC SQL                                                     01960000
019710          INCLUDE PCT00011                                        01971009
019800     END-EXEC.                                                    01980000
019900                                                                  01990000
020000******************************************************************02000000
020100** TKRPRPM                                                      **02010000
020200******************************************************************02020000
020300     EXEC SQL                                                     02030000
020400          INCLUDE TKRPRPM                                         02040000
020500     END-EXEC.                                                    02050000
020600                                                                  02060000
020700******************************************************************02070000
020800*  TLBVRDA  - VIRTUAL LABEL TABLE                                 02080001
020900******************************************************************02090000
021000     EXEC SQL                                                     02100000
021100         INCLUDE TLBVRDA                                          02110001
021200     END-EXEC.                                                    02120000
021300                                                                  02130000
021500******************************************************************02150022
021600*  TLBPTDA  - LABEL PRINT DATA TABLE                              02160022
021700******************************************************************02170022
021800     EXEC SQL                                                     02180022
021900         INCLUDE TLBPTDA                                          02190022
022000     END-EXEC.                                                    02200022
022100                                                                  02210022
022110******************************************************************02211022
022120*  TSHUNLO  - SHIP UNIT LOCATION TABLE                            02212022
022130******************************************************************02213022
022140     EXEC SQL                                                     02214022
022150         INCLUDE TSHUNLO                                          02215022
022160     END-EXEC.                                                    02216022
022170                                                                  02217022
022171******************************************************************02217124
022172*  TSULBXF  - SHIP UNIT CROSS REFERENCE TABLE                     02217224
022173******************************************************************02217324
022174     EXEC SQL                                                     02217424
022175         INCLUDE TSULBXF                                          02217524
022176     END-EXEC.                                                    02217624
022177                                                                  02217724
022178******************************************************************02217825
022179*  TSUATRN  - CARTON AUDIT TABLE                                  02217925
022180******************************************************************02218025
022181     EXEC SQL                                                     02218125
022182         INCLUDE TSUATRN                                          02218225
022183     END-EXEC.                                                    02218325
022184                                                                  02218425
022185******************************************************************02218588
022186*  TSUNAUD  - CARTON AUDIT HEADER TABLE                           02218688
022187******************************************************************02218788
022188     EXEC SQL                                                     02218888
022189         INCLUDE TSUNAUD                                          02218988
022190     END-EXEC.                                                    02219088
022191                                                                  02219188
022192******************************************************************02219288
022193*  SUT_CART_DIRV_TRKG - CARTON DIVERT TRACKING TABLE              02219388
022194******************************************************************02219488
022195     EXEC SQL                                                     02219588
022196         INCLUDE SUT00102                                         02219688
022197     END-EXEC.                                                    02219788
022198                                                                  02219888
022199******************************************************************02219999
022200*  SUT_PO_AUD_REQ     - PO AUDIT REQUEST TABLE FOR PROMPTED AUDITS02220099
022201******************************************************************02220199
022202     EXEC SQL                                                     02220299
022203         INCLUDE SUT00015                                         02220399
022204     END-EXEC.                                                    02220499
022205                                                                  02220599
022206******************************************************************02220699
022207*  TCOCNTL- COMPANY CONTROL TABLE                                 02220799
022210******************************************************************02221093
022220     EXEC SQL                                                     02222093
022230         INCLUDE TCOCNTL                                          02223093
022240     END-EXEC.                                                    02224093
022250                                                                  02225093
022300******************************************************************02230093
024900******************************************************************02490000
025000*  P2L INBOUND LAUNCH CARTON CURSOR                               02500001
025010* A.EVNT_KY_1_NBR - DC NUMBER                                     02501002
025020* A.EVNT_KY_2_NBR - PO NUMBER                                     02502002
025030* A.EVNT_KY_3_NBR - RECEIVER SEQ NUMBER                           02503002
025040* A.EVNT_KY_4_NBR - LINE NUMBER                                   02504002
025050* A.EVNT_KY_2_TXT - LAST 17 OF P2L BARCODE                        02505002
025060*                                                                 02506002
025100******************************************************************02510000
025200     EXEC SQL                                                     02520000
025300          DECLARE P2L-LAUNCH-CSR CURSOR  FOR                      02530001
025400           SELECT                                                 02540001
025500                A.EVNT_KY_1_NBR                                   02550001
025600             ,  A.EVNT_KY_2_NBR                                   02560012
025610             ,  A.EVNT_KY_3_NBR                                   02561012
025620             ,  A.EVNT_KY_4_NBR                                   02562012
025640             ,  A.EVNT_KY_1_TMST  + C.FUNC_QTY HOURS              02564012
025650             ,  A.EVNT_KY_2_TXT                                   02565018
028500           FROM  PCT_BUS_EVNT_EXPRT A                             02850001
028510               , TKRPRPM   B                                      02851001
028520               , TKRPRPM   C                                      02852001
028521               , TCOCNTL   D                                      02852192
028530           WHERE A.EVNT_OBJ_ACTN_TXT  = 'INBOUND LAUNCH'          02853001
028550             AND B.SYS_PRC_FUNC_CDE   = 'DLCDPL'                  02855001
028560             AND B.LOC_ID             = A.EVNT_KY_1_NBR           02856092
028570             AND B.FUNC_PRC_STAT_CDE  = 'AC'                      02857092
028580             AND B.FUNC_TXT           = 'Y'                       02858092
028590             AND C.INTFC_SYS_CDE      = 'KHL'                     02859001
028600             AND C.SYS_PRC_FUNC_CDE   = 'TIMEZN'                  02860001
028700             AND C.LOC_ID             =  A.EVNT_KY_1_NBR          02870092
028710             AND D.OPER_UNT_ID        = 090                       02871092
028730             AND DATE(A.CRE_TMST)     = D.BTCH_PRC_DTE            02873099
028900           ORDER BY 1,6,5                                         02890053
029900         WITH UR                                                  02990028
030000     END-EXEC.                                                    03000000
030100                                                                  03010000
030110******************************************************************03011018
030111* LABEL PRINT DATA CURSOR                                         03011118
030120******************************************************************03012018
030200     EXEC SQL                                                     03020018
030300          DECLARE LBL-PRINT-CSR CURSOR  FOR                       03030018
030400           SELECT                                                 03040018
030600                 A.CRE_TMST                                       03060024
030700               , A.LBL_PRT_BTCH_ID                                03070070
030800               , A.CART_ACTN_CDE                                  03080055
030900               , A.CART_LBL_TYP_CDE                               03090056
031000               , A.BRCDE_NBR                                      03100056
031100               , A.OPER_UNT_ID                                    03110099
031110               , A.MISDIR_OPER_UNT_ID                             03111099
031200           FROM  TLBPTDA   A                                      03120018
031500           WHERE  A.SHIPT_UNT_ID       = :PV-SHIPT-UNT-ID         03150019
031600             AND  A.PO_NBR             = :PV-PO-NBR               03160019
031700             AND  A.OPER_UNT_ID        = :PV-OPER-UNT-ID          03170028
031800           ORDER BY A.CRE_TMST ASC                                03180028
032500           WITH UR                                                03250018
032600     END-EXEC.                                                    03260018
032700                                                                  03270018
032800******************************************************************03280020
032900* DIRECTIVE TRACKING CURSOR                                       03290020
033000******************************************************************03300020
033100     EXEC SQL                                                     03310020
033200          DECLARE CART-DVRT-TRKNG-CSR CURSOR  FOR                 03320020
033300           SELECT                                                 03330020
033400                 A.CRE_TMST                                       03340024
033410               , A.DIRV_RSN_CDE                                   03341062
033420               , A.CNVYR_PRC_ACTN_NM                              03342090
033430               , A.OPER_UNT_ID                                    03343090
033500           FROM  SUT_CART_DIRV_TRKG A                             03350020
033600           WHERE  A.BRCDE_NBR          = :PV-P2L-BARCODE          03360020
033700           ORDER BY A.CRE_TMST ASC                                03370028
034000           WITH UR                                                03400020
034100     END-EXEC.                                                    03410020
034200                                                                  03420020
034300******************************************************************03430035
034400* CARTON AUDIT CURSOR                                             03440035
034500******************************************************************03450035
034600     EXEC SQL                                                     03460035
034790          DECLARE CARTON-AUDIT-CSR CURSOR FOR                     03479087
034800           SELECT T1.AUD_CNTL_NBR, T1.UNT_AUD_STRT_TMST           03480087
034900                , T1.UNT_AUD_STP_TMST, T1.OPER_UNT_ID             03490087
035000                , T1.AUD_TYP_CDE                                  03500087
035100                , IFNULL(T2.PROMPTED_AUDIT,'N') AS PROMPT_CDE     03510087
035200           FROM                                                   03520087
035300           (SELECT A.UNT_AUD_STRT_TMST                            03530087
035310                 , A.UNT_AUD_STP_TMST                             03531087
035320                 , B.OPER_UNT_ID                                  03532087
035330                 , A.AUD_CNTL_NBR                                 03533087
035340                 , B.AUD_TYP_CDE                                  03534087
035350              FROM TSUATRN  A                                     03535087
035360                 , TSUNAUD  B                                     03536087
035370             WHERE A.SHIPT_UNT_ID   = :PV-SHIPT-UNT-ID            03537087
035380               AND B.AUD_CNTL_NBR   = A.AUD_CNTL_NBR              03538087
035390           ) AS T1                                                03539087
035391           LEFT OUTER JOIN                                        03539187
035392           (SELECT A.AUD_CNTL_NBR                                 03539287
035393                 , 'Y' AS PROMPTED_AUDIT                          03539387
035394              FROM TSUATRN  A                                     03539487
035395                 , TSUNAUD  B                                     03539587
035396                 , SUT_PO_AUD_REQ C                               03539687
035397             WHERE A.SHIPT_UNT_ID   = :PV-SHIPT-UNT-ID            03539787
035398               AND B.AUD_CNTL_NBR   = A.AUD_CNTL_NBR              03539887
035399               AND C.AUD_CNTL_NBR   = A.AUD_CNTL_NBR              03539987
035400           ) AS T2                                                03540087
035401                ON T2.AUD_CNTL_NBR  = T1.AUD_CNTL_NBR             03540187
035402            WITH UR                                               03540287
035410     END-EXEC.                                                    03541035
035500                                                                  03550035
035600******************************************************************03560080
035700* EAS TAG CURSOR                                                  03570080
035800******************************************************************03580080
035900     EXEC SQL                                                     03590080
036000         DECLARE EAS-TAG-CSR CURSOR  FOR                          03600080
036200          SELECT CRE_TMST                                         03620080
036310                ,SCN_LOC_ID                                       03631080
036320                ,OPER_UNT_ID                                      03632099
036420          FROM  TSHUNLO                                           03642080
036500            WHERE SHIPT_UNT_ID  = :PV-SHIPT-UNT-ID                03650082
036510              AND ACTV_CDE        = 'I'                           03651080
036520              AND SCN_LOC_ID LIKE 'RFD%'                          03652080
036600          WITH UR                                                 03660080
036700     END-EXEC.                                                    03670080
036800                                                                  03680080
037900******************************************************************03790000
038000 PROCEDURE DIVISION.                                              03800000
038100******************************************************************03810000
038200                                                                  03820000
038300******************************************************************03830000
038400* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     03840000
038500*      PROGRAM.                                                   03850000
038600******************************************************************03860000
038700 0000-PROGRAM-MAINLINE.                                           03870000
038800                                                                  03880000
038900     PERFORM 1000-INITIALIZE.                                     03890000
039000                                                                  03900000
039200     SET  PS-NOT-END-OF-CURSOR  TO  TRUE.                         03920001
039300                                                                  03930000
039400     PERFORM 2000-OPEN-P2L-LAUNCH-CSR.                            03940018
039500                                                                  03950000
039600     PERFORM 2050-FETCH-P2L-LAUNCH-CSR.                           03960018
039700                                                                  03970000
039800     PERFORM 2100-PROCESS-P2L-CSR                                 03980018
039900       UNTIL PS-END-OF-CURSOR.                                    03990000
040000                                                                  04000000
040100     PERFORM 3000-CLOSE-P2L-LAUNCH-CSR.                           04010018
040110                                                                  04011098
040120                                                                  04012098
040200     MOVE PV-P2L-CRTN-FETCH-COUNT TO  PV-DISP-NBR.                04020098
040300     DISPLAY ' '.                                                 04030098
040400     DISPLAY 'P2L LAUNCH CARTONS COUNT..: '                       04040098
040500             PV-DISP-NBR.                                         04050098
040600     MOVE PV-BRCDE-MISSING-COUNT TO PV-DISP-NBR.                  04060098
040700     DISPLAY ' '.                                                 04070098
040800     DISPLAY 'P2L CARTONS NOT ON TLBVRDA: '                       04080098
040900             PV-DISP-NBR.                                         04090098
041000     MOVE PV-TOTAL-WRITE-CNT    TO PV-DISP-NBR.                   04100098
041100     DISPLAY ' '.                                                 04110098
041200     DISPLAY 'CARTON RECS WRITTEN COUNT.: '                       04120098
041300             PV-DISP-NBR.                                         04130098
044600                                                                  04460000
044700     CLOSE SU-P2L-ACTIVITY-FILE.                                  04470008
045000                                                                  04500000
045500     STOP RUN.                                                    04550000
045600                                                                  04560000
045700                                                                  04570000
045800***************************************************************** 04580000
045900*  INITIALIZATION PARAGRAPH                                       04590000
046000***************************************************************** 04600000
046100 1000-INITIALIZE.                                                 04610000
046200                                                                  04620000
046400     OPEN OUTPUT SU-P2L-ACTIVITY-FILE.                            04640008
046600                                                                  04660000
046900     DISPLAY '*************************************'.             04690000
047000     DISPLAY '**                                  *'.             04700000
047100     DISPLAY '**           SUKUT207               *'.             04710000
047200     DISPLAY '**                                  *'.             04720000
047300     DISPLAY '*************************************'.             04730000
047400     DISPLAY '**                                  *'.             04740000
052900                                                                  05290000
057500******************************************************************05750000
057600* OPEN THE P2L LAUNCH CURSOR                                      05760001
057700******************************************************************05770000
057800 2000-OPEN-P2L-LAUNCH-CSR.                                        05780018
057900                                                                  05790000
058000     PERFORM WITH TEST AFTER                                      05800000
058100       VARYING PV-COUNTER FROM 1 BY 1                             05810000
058200         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    05820000
058300                SQLCODE = ZERO)                                   05830000
058400                                                                  05840000
058500         EXEC SQL                                                 05850000
058600              OPEN P2L-LAUNCH-CSR                                 05860001
058700         END-EXEC                                                 05870000
058800                                                                  05880000
058900         EVALUATE TRUE                                            05890000
059000             WHEN SQLCODE = +0                                    05900000
059100             WHEN SQLCODE = -904                                  05910000
059200             WHEN SQLCODE = -911                                  05920000
059300             WHEN SQLCODE = -913                                  05930000
059400                 CONTINUE                                         05940000
059500             WHEN SQLWARN0 NOT EQUAL SPACE                        05950000
059600             WHEN SQLCODE NOT EQUAL ZERO                          05960000
059700                 MOVE '2000-OPEN-P2L-LAUNCH-CSR'                  05970018
059800                                      TO PV-ABEND-PARAGRAPH       05980000
059900                 MOVE 'ERROR OPENING ASSIGNMENT CURSOR'           05990000
060000                                      TO PV-ABEND-OPER-MESSAGE-1  06000000
060100                 MOVE PV-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         06010018
060200                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        06020000
060300                         PV-OPER-UNT-ID-DISP                      06030000
060400                                         DELIMITED BY SIZE        06040000
060500                                   INTO PV-ABEND-OPER-MESSAGE-2   06050000
060600                 MOVE 'DLT_ASGMT'     TO PV-ABEND-TABLE-1         06060000
060700                 PERFORM 9100-SQL-ABEND                           06070000
060800         END-EVALUATE                                             06080000
060900     END-PERFORM.                                                 06090000
061000                                                                  06100000
061100     IF  PV-COUNTER > PC-MAX-RETRIES                              06110000
061200         MOVE '2000-OPEN-ASGMT-CSR'                               06120018
061300                                      TO PV-ABEND-PARAGRAPH       06130000
061400         MOVE 'MAX RETRIES ERROR OPENING ASSIGNMENT CURSOR'       06140000
061500                                      TO PV-ABEND-OPER-MESSAGE-1  06150000
061600         MOVE PV-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         06160018
061700         STRING 'OPER UNT ID: '  DELIMITED BY SIZE                06170000
061800                 PV-OPER-UNT-ID-DISP                              06180000
061900                                 DELIMITED BY SIZE                06190000
062000                                    INTO PV-ABEND-OPER-MESSAGE-2  06200000
062100         MOVE 'PCT_BUS_EVNT_EXPRT'    TO PV-ABEND-TABLE-1         06210001
062200         PERFORM 9100-SQL-ABEND                                   06220000
062300     END-IF.                                                      06230000
062400                                                                  06240000
062500                                                                  06250000
062600******************************************************************06260000
062700* FETCH P2L LAUNCH CURSOR                                        *06270001
062800******************************************************************06280000
062900 2050-FETCH-P2L-LAUNCH-CSR.                                       06290018
063000                                                                  06300000
063100     EXEC SQL                                                     06310000
063200          FETCH P2L-LAUNCH-CSR                                    06320001
063300           INTO :PCT00011-EVNT-KY-1-NBR                           06330001
063310              , :PCT00011-EVNT-KY-2-NBR                           06331002
063320              , :PCT00011-EVNT-KY-3-NBR                           06332002
063321              , :PCT00011-EVNT-KY-4-NBR                           06332102
063500              , :PCT00011-EVNT-KY-1-TMST                          06350001
063600              , :PCT00011-EVNT-KY-2-TXT                           06360018
064600     END-EXEC.                                                    06460000
064700                                                                  06470000
064800     EVALUATE TRUE                                                06480000
064900       WHEN SQLCODE = ZERO                                        06490000
065000            ADD +1  TO PV-P2L-CRTN-FETCH-COUNT                    06500098
065200       WHEN SQLCODE = +100                                        06520000
065300           SET PS-END-OF-CURSOR      TO TRUE                      06530000
065400       WHEN SQLWARN0 NOT EQUAL SPACE                              06540000
065500       WHEN SQLCODE NOT EQUAL ZERO                                06550000
065600           MOVE '2050-FETCH-P2L-LAUNCH-CSR'                       06560018
065700                                     TO PV-ABEND-PARAGRAPH        06570000
065800           MOVE 'FETCH P2L UPLD CURSOR '                          06580018
065900                                     TO PV-ABEND-OPER-MESSAGE-1   06590000
066000           MOVE PV-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          06600018
066100           STRING 'OPER UNT ID: '  DELIMITED BY SIZE              06610000
066200                   PV-OPER-UNT-ID-DISP                            06620000
066300                                   DELIMITED BY SIZE              06630000
066400                                   INTO PV-ABEND-OPER-MESSAGE-2   06640000
066500           MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-TABLE-1          06650001
066600           PERFORM 9100-SQL-ABEND                                 06660000
066700     END-EVALUATE.                                                06670000
066800                                                                  06680000
066900                                                                  06690000
067000******************************************************************06700000
067100*                                                                *06710000
067200******************************************************************06720000
067300 2100-PROCESS-P2L-CSR.                                            06730018
067301                                                                  06730198
067310     IF  PCT00011-EVNT-KY-2-TXT = PV-PREV-P2L-BARCODE             06731048
067320         SET PV-INBOUND-LAUNCH   TO TRUE                          06732054
067322         MOVE PCT00011-EVNT-KY-1-TMST TO PV-ACTIVITY-TIMESTAMP    06732251
067323         PERFORM 6000-WRITE-ACTIVITY-RECORD                       06732351
067330     ELSE                                                         06733048
067420       MOVE PCT00011-EVNT-KY-1-NBR  TO PV-OPER-UNT-ID             06742048
067430       MOVE PCT00011-EVNT-KY-2-NBR  TO PV-PO-NBR                  06743048
067440       MOVE PCT00011-EVNT-KY-3-NBR  TO PV-RCVR-SEQ-NBR            06744048
067450       MOVE PCT00011-EVNT-KY-4-NBR  TO PV-PO-LNE-NBR              06745048
067460       MOVE PCT00011-EVNT-KY-2-TXT  TO PV-BAR-CODE                06746048
067461                                       PV-PREV-P2L-BARCODE        06746148
067462                                                                  06746248
067463       MOVE PCT00011-EVNT-KY-1-TMST TO PV-ACTIVITY-TIMESTAMP      06746348
067470       MOVE PV-BRCDE-LBL-SEQ        TO PV-LBL-ASG-SEQ-NBR         06747048
068800                                                                  06880048
068900       PERFORM 2150-SELECT-VRDA-BRCDE                             06890080
069500                                                                  06950048
070210       IF PS-P2L-BRCDE-FOUND-YES                                  07021048
070220          MOVE LBVRDA-BRCDE-NBR TO   PV-P2L-BARCODE               07022078
070230          SET PV-INBOUND-LAUNCH  TO TRUE                          07023048
070300          PERFORM 6000-WRITE-ACTIVITY-RECORD                      07030048
070400          PERFORM 2300-SELECT-TSULBXF-BRCDE                       07040048
070410          IF PS-PNA-CHKIN-RECORD-FOUND OR PS-RF-CHKIN-RECORD-FOUND07041048
070411             PERFORM 6000-WRITE-ACTIVITY-RECORD                   07041148
070412             PERFORM 3100-PROCESS-CART-AUD                        07041280
070413             PERFORM 4000-PROCESS-PRINT-DATA                      07041380
070430          END-IF                                                  07043048
070460          PERFORM 3550-SELECT-DIRECTIVES-PARM                     07046079
070461          IF ALL-CARTONS-DIRECTIVES-MODE OR                       07046179
070462                                EXCEPTION-DIRECTIVES-MODE         07046279
070463             PERFORM 5000-PROCESS-CART-DVRT                       07046380
070464          ELSE                                                    07046485
070465             PERFORM 5400-PROCESS-EAS-TAGGING                     07046585
070466          END-IF                                                  07046679
070470       ELSE                                                       07047077
070480          MOVE SPACES TO PV-PREV-P2L-BARCODE                      07048077
070500       END-IF                                                     07050048
070501                                                                  07050148
070520                                                                  07052048
070700     END-IF.                                                      07070048
070710                                                                  07071049
070800     PERFORM 2050-FETCH-P2L-LAUNCH-CSR.                           07080050
076100******************************************************************07610000
076200*  SELECT INBOUND P2L BARCODE                                     07620016
124500******************************************************************12450000
124600 2150-SELECT-VRDA-BRCDE.                                          12460080
125600                                                                  12560010
125700      EXEC SQL                                                    12570010
125800          SELECT BRCDE_NBR                                        12580010
125900            INTO :LBVRDA-BRCDE-NBR                                12590010
126000            FROM                                                  12600010
126100                  TLBVRDA  A                                      12610010
127000            WHERE                                                 12700010
127100                  A.PO_NBR             = :PV-PO-NBR               12710018
127200              AND A.RCVR_SEQ_NBR       = :PV-RCVR-SEQ-NBR         12720018
127300              AND A.PO_LNE_NBR         = :PV-PO-LNE-NBR           12730018
127400              AND A.LBL_TYP_LBL_SEQ_ID = :PV-LBL-ASG-SEQ-NBR      12740018
127500              AND A.CART_LBL_TYP_CDE   = 'P'                      12750016
127806            WITH UR                                               12780610
127807      END-EXEC                                                    12780710
127808                                                                  12780810
127809      EVALUATE TRUE                                               12780910
127810          WHEN SQLCODE = ZERO                                     12781010
127812               SET PS-P2L-BRCDE-FOUND-YES TO TRUE                 12781210
127817          WHEN SQLCODE = +100                                     12781710
127819               SET PS-P2L-BRCDE-FOUND-NO  TO TRUE                 12781910
127820               ADD  1  TO  PV-BRCDE-MISSING-COUNT                 12782011
127821          WHEN SQLCODE = -904                                     12782110
127822          WHEN SQLCODE = -911                                     12782210
127823              CONTINUE                                            12782310
127824                                                                  12782410
127825          WHEN SQLWARN0 NOT = SPACES                              12782510
127826          WHEN SQLCODE < ZERO                                     12782610
127827          WHEN SQLCODE > ZERO                                     12782710
127828              MOVE '2150-SELECT-VRDA-BRCDE         '              12782880
127829                              TO PV-ABEND-PARAGRAPH               12782910
127830              MOVE 'CHECK P2L BARCODE    '                        12783010
127831                              TO PV-ABEND-OPER-MESSAGE-1          12783110
127832              MOVE 'TLBVRDA ' TO PV-ABEND-TABLE-1                 12783210
127835              PERFORM 9100-SQL-ABEND                              12783510
127836                                                                  12783610
127837      END-EVALUATE.                                               12783710
127850                                                                  12785010
127851******************************************************************12785116
127852*  SELECT INBOUND P2L BARCODE                                     12785216
127853******************************************************************12785316
127854 2300-SELECT-TSULBXF-BRCDE.                                       12785418
127857                                                                  12785729
127858      EXEC SQL                                                    12785829
127859          SELECT A.SHIPT_UNT_ID                                   12785929
127861                ,A.CRE_TMST                                       12786129
127862                ,B.LBL_PRT_BTCH_ID                                12786242
127863                ,B.OPER_UNT_ID                                    12786399
127864            INTO :SULBXF-SHIPT-UNT-ID                             12786499
127865               , :SULBXF-CRE-TMST                                 12786599
127866               , :SHUNLO-LBL-PRT-BTCH-ID                          12786699
127867               , :SHUNLO-OPER-UNT-ID                              12786799
127868            FROM                                                  12786899
127869                  TSULBXF  A                                      12786999
127870                , TSHUNLO  B                                      12787099
127871            WHERE A.BRCDE_NBR          = :LBVRDA-BRCDE-NBR        12787199
127872             AND  A.CART_LBL_TYP_CDE   = 'P'                      12787299
127873             AND  A.SHIPT_UNT_ID       = B.SHIPT_UNT_ID           12787399
127874             AND  B.SCN_LOC_ID         = 'RECV'                   12787499
127875            WITH UR                                               12787599
127876      END-EXEC                                                    12787699
127877                                                                  12787799
127878      EVALUATE TRUE                                               12787899
127879          WHEN SQLCODE = ZERO                                     12787999
127880               MOVE SULBXF-SHIPT-UNT-ID TO PV-SHIPT-UNT-ID        12788099
127881               MOVE SULBXF-CRE-TMST     TO PV-ACTIVITY-TIMESTAMP  12788199
127882               MOVE SHUNLO-OPER-UNT-ID  TO PV-OPER-UNT-ID         12788299
127883               SET PV-CHECK-IN  TO TRUE                           12788399
127884                                                                  12788499
127885               IF SHUNLO-LBL-PRT-BTCH-ID > 0                      12788599
127886                  SET PS-RF-CHKIN-RECORD-FOUND TO TRUE            12788699
127887               ELSE                                               12788799
127888                  SET PS-PNA-CHKIN-RECORD-FOUND TO TRUE           12788899
127889               END-IF                                             12788999
127890          WHEN SQLCODE = +100                                     12789099
127891               SET PS-CHECK-IN-RECORD-FOUND-NO  TO TRUE           12789199
127892          WHEN SQLCODE = -904                                     12789299
127893          WHEN SQLCODE = -911                                     12789399
127894              CONTINUE                                            12789499
127895                                                                  12789599
127896          WHEN SQLWARN0 NOT = SPACES                              12789699
127897          WHEN SQLCODE < ZERO                                     12789799
127898          WHEN SQLCODE > ZERO                                     12789899
127899              MOVE '2300-SELECT-TSULBXF-BRCDE      '              12789999
127900                              TO PV-ABEND-PARAGRAPH               12790099
127901              MOVE 'CHECK P2L BARCODE TSULBXF '                   12790199
127902                              TO PV-ABEND-OPER-MESSAGE-1          12790299
127903              MOVE 'TSULBXF ' TO PV-ABEND-TABLE-1                 12790399
127904              PERFORM 9100-SQL-ABEND                              12790499
127905                                                                  12790599
127906      END-EVALUATE.                                               12790699
127907                                                                  12790799
127908******************************************************************12790842
127909*  PROCESS CARTON AUDITS                                         *12790942
127910******************************************************************12791042
127911 3100-PROCESS-CART-AUD.                                           12791180
127912                                                                  12791235
127920     SET  PS-NOT-END-OF-AUD-CSR TO  TRUE.                         12792035
127930                                                                  12793035
127931     PERFORM 3200-OPEN-CART-AUD-CSR.                              12793180
127932                                                                  12793235
127933     PERFORM 3300-FETCH-CART-AUD-CSR.                             12793380
127934                                                                  12793435
127935     PERFORM 3400-PROCESS-CART-AUD-CSR                            12793580
127936       UNTIL PS-END-OF-AUD-CSR.                                   12793636
127937                                                                  12793735
127938     PERFORM 3500-CLOSE-CART-AUD-CSR.                             12793880
127939                                                                  12793935
127940******************************************************************12794035
127941*                                                                *12794135
127942******************************************************************12794235
127943 3200-OPEN-CART-AUD-CSR.                                          12794380
127944******************************************************************12794435
127945                                                                  12794535
127946     EXEC SQL                                                     12794635
127947          OPEN CARTON-AUDIT-CSR                                   12794735
127948     END-EXEC                                                     12794835
127949                                                                  12794935
127950     EVALUATE TRUE                                                12795035
127951         WHEN SQLCODE = +0                                        12795135
127952             CONTINUE                                             12795235
127953         WHEN SQLWARN0 NOT EQUAL SPACE                            12795335
127954         WHEN SQLCODE NOT EQUAL ZERO                              12795435
127955             MOVE '3200-OPEN-CART-AUD-CSR'                        12795580
127956                                  TO PV-ABEND-PARAGRAPH           12795635
127957             MOVE 'ERROR OPENING DIVERT DATA CURSOR'              12795735
127958                                  TO PV-ABEND-OPER-MESSAGE-1      12795835
127959             STRING 'P2L BARCODE :'  DELIMITED BY SIZE            12795935
127960                     PV-P2L-BARCODE                               12796035
127961                                     DELIMITED BY SIZE            12796135
127962                               INTO PV-ABEND-OPER-MESSAGE-2       12796235
127963             MOVE 'SUT_CART_DI'   TO PV-ABEND-TABLE-1             12796335
127964             PERFORM 9100-SQL-ABEND                               12796435
127965     END-EVALUATE.                                                12796535
127966                                                                  12796635
127967******************************************************************12796735
127968*                                                                *12796835
127969******************************************************************12796935
127970 3300-FETCH-CART-AUD-CSR.                                         12797080
127971******************************************************************12797135
127972                                                                  12797296
127973     EXEC SQL                                                     12797335
127974          FETCH CARTON-AUDIT-CSR                                  12797435
127977           INTO :SUATRN-AUD-CNTL-NBR                              12797787
127978              , :SUATRN-UNT-AUD-STRT-TMST                         12797887
127979              , :SUATRN-UNT-AUD-STP-TMST                          12797987
127980              , :SUNAUD-OPER-UNT-ID                               12798087
127981              , :SUNAUD-AUD-TYP-CDE                               12798187
127982              , :PV-CSR-AUDIT-PROMPT-CDE                          12798287
127983     END-EXEC.                                                    12798335
127984                                                                  12798435
127985     EVALUATE TRUE                                                12798535
127986         WHEN SQLCODE = +0                                        12798635
127987             CONTINUE                                             12798735
127988         WHEN SQLCODE = +100                                      12798835
127989             SET PS-END-OF-AUD-CSR TO TRUE                        12798937
127990         WHEN SQLWARN0 NOT EQUAL SPACE                            12799035
127991         WHEN SQLCODE NOT EQUAL ZERO                              12799135
127992             MOVE '3200-OPEN-CART-AUD-CSR'                        12799280
127993                                  TO PV-ABEND-PARAGRAPH           12799335
127994             MOVE 'ERROR OPENING PRINT DATA CURSOR'               12799435
127995                                  TO PV-ABEND-OPER-MESSAGE-1      12799535
127996             MOVE PV-SHIPT-UNT-ID TO PV-SHIPT-UNT-ID-N            12799635
127997             STRING 'P2L BARCODE :'  DELIMITED BY SIZE            12799735
127998                     PV-P2L-BARCODE                               12799835
127999                                     DELIMITED BY SIZE            12799935
128000                               INTO PV-ABEND-OPER-MESSAGE-2       12800035
128001             MOVE 'SUT_CART_D'    TO PV-ABEND-TABLE-1             12800135
128002             PERFORM 9100-SQL-ABEND                               12800235
128003     END-EVALUATE.                                                12800335
128004                                                                  12800435
128005******************************************************************12800535
128006*                                                                *12800635
128007******************************************************************12800735
128008 3400-PROCESS-CART-AUD-CSR.                                       12800880
128009******************************************************************12800935
128010*                                                                *12801035
128020     MOVE SPACES          TO PV-CARTON-AUDIT-ACTIVITY.            12802095
128021                                                                  12802187
128022     IF PV-CSR-AUDIT-PROMPT-CDE  =  'Y'                           12802287
128023        MOVE 'SYSTM'                  TO PV-CRTN-AUD-PRMPT        12802387
128024     ELSE                                                         12802487
128025        MOVE 'MANUAL'                 TO PV-CRTN-AUD-PRMPT        12802587
128026     END-IF                                                       12802687
128028                                                                  12802887
128029     EVALUATE TRUE                                                12802987
128030       WHEN SUNAUD-AUD-TYP-CDE  = '01'                            12803087
128031            MOVE   '100%'            TO PV-CRTN-AUD-TYPE          12803187
128032       WHEN SUNAUD-AUD-TYP-CDE  = '02'                            12803287
128033            MOVE   'SPOT'            TO PV-CRTN-AUD-TYPE          12803387
128034       WHEN SUNAUD-AUD-TYP-CDE  = '03'                            12803487
128035            MOVE   'RWRK'            TO PV-CRTN-AUD-TYPE          12803587
128036     END-EVALUATE                                                 12803687
128037                                                                  12803795
128038****PROCESS CARTON AUDIT START                                    12803887
128039*                                                                *12803987
128040     SET  PV-CARTON-AUDIT-START TO TRUE                           12804087
128041     MOVE 'CARTON AUDIT START '    TO PV-CRTN-AUD-STRT-STOP       12804187
128042                                                                  12804287
128044     MOVE SUNAUD-OPER-UNT-ID        TO PV-OPER-UNT-ID.            12804499
128046                                                                  12804687
128047     MOVE SUATRN-UNT-AUD-STRT-TMST TO PV-ACTIVITY-TIMESTAMP.      12804787
128048     PERFORM 6000-WRITE-ACTIVITY-RECORD.                          12804887
128049                                                                  12804987
128050****PROCESS CARTON AUDIT STOP                                     12805087
128051                                                                  12805187
128052     SET  PV-CARTON-AUDIT-STOP  TO TRUE                           12805287
128053     MOVE 'CARTON AUDIT STOP  '    TO PV-CRTN-AUD-STRT-STOP       12805387
128056     MOVE SUNAUD-OPER-UNT-ID       TO PV-OPER-UNT-ID.             12805699
128057     MOVE SUATRN-UNT-AUD-STP-TMST TO PV-ACTIVITY-TIMESTAMP        12805787
128058                                                                  12805887
128059     PERFORM 6000-WRITE-ACTIVITY-RECORD.                          12805987
128060                                                                  12806087
128061     PERFORM 3300-FETCH-CART-AUD-CSR.                             12806180
128062******************************************************************12806245
128063 3500-CLOSE-CART-AUD-CSR.                                         12806380
128064******************************************************************12806445
128065*                                                                *12806545
128066                                                                  12806645
128067     EXEC SQL                                                     12806745
128068          CLOSE CARTON-AUDIT-CSR                                  12806845
128069     END-EXEC                                                     12806945
128070                                                                  12807045
128071     EVALUATE TRUE                                                12807145
128072         WHEN SQLCODE = +0                                        12807245
128073             CONTINUE                                             12807345
128074         WHEN SQLWARN0 NOT EQUAL SPACE                            12807445
128075         WHEN SQLCODE NOT EQUAL ZERO                              12807545
128076             MOVE '3200-OPEN-CART-AUD-CSR'                        12807680
128077                                  TO PV-ABEND-PARAGRAPH           12807745
128078             MOVE 'ERROR CLOSING CART-AUD  CURSOR'                12807845
128079                                  TO PV-ABEND-OPER-MESSAGE-1      12807945
128080             STRING 'P2L BARCODE :'  DELIMITED BY SIZE            12808045
128081                     PV-P2L-BARCODE                               12808145
128082                                     DELIMITED BY SIZE            12808245
128083                               INTO PV-ABEND-OPER-MESSAGE-2       12808345
128084             MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1        12808445
128085             PERFORM 9100-SQL-ABEND                               12808545
128086     END-EVALUATE.                                                12808645
128087                                                                  12808745
128088******************************************************************12808845
128089* CLOSE P2L LAUNCH CSR                                            12808945
128090******************************************************************12809045
128091 3000-CLOSE-P2L-LAUNCH-CSR.                                       12809145
128092                                                                  12809245
128093     PERFORM                                                      12809345
128094         WITH TEST AFTER                                          12809445
128095         VARYING PV-COUNTER                                       12809545
128096         FROM 1 BY 1                                              12809645
128097         UNTIL ((PV-COUNTER > PC-MAX-RETRIES) OR                  12809745
128098                (SQLCODE = ZERO))                                 12809845
128099         EXEC SQL                                                 12809945
128100             CLOSE P2L-LAUNCH-CSR                                 12810045
128101         END-EXEC                                                 12810145
128102                                                                  12810245
128103         EVALUATE TRUE                                            12810345
128104             WHEN SQLCODE = +0                                    12810445
128105             WHEN SQLCODE = -904                                  12810545
128106             WHEN SQLCODE = -911                                  12810645
128107             WHEN SQLCODE = -913                                  12810745
128108                 CONTINUE                                         12810845
128109             WHEN SQLWARN0 NOT EQUAL SPACE                        12810945
128110             WHEN SQLCODE NOT EQUAL ZERO                          12811045
128111                 MOVE '3000-CLOSE-P2L-LAUNCH-CSR'                 12811145
128112                                      TO PV-ABEND-PARAGRAPH       12811245
128113                 MOVE 'ERROR CLOSING PCT_BUS_EVNT_EXPRT '         12811345
128114                                      TO PV-ABEND-OPER-MESSAGE-1  12811445
128115                 MOVE PV-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         12811545
128116                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        12811645
128117                         PV-OPER-UNT-ID-DISP                      12811745
128118                                         DELIMITED BY SIZE        12811845
128119                                    INTO PV-ABEND-OPER-MESSAGE-2  12811945
128120                 MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-TABLE-1    12812045
128121                 PERFORM 9100-SQL-ABEND                           12812145
128122         END-EVALUATE                                             12812245
128123     END-PERFORM.                                                 12812345
128124                                                                  12812445
128125     IF  PV-COUNTER > PC-MAX-RETRIES                              12812545
128126         MOVE '3000-CLOSE-P2L-LAUNCH-CSR'                         12812645
128127                                      TO PV-ABEND-PARAGRAPH       12812745
128128         MOVE 'MAX RETRIES ERROR CLOSING PCT_BUS_EVNT_EXPRT'      12812845
128129                                      TO PV-ABEND-OPER-MESSAGE-1  12812945
128130         MOVE PV-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         12813045
128131         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        12813145
128132                 PV-OPER-UNT-ID-DISP  '-'                         12813245
128133                                         DELIMITED BY SIZE        12813345
128134                                    INTO PV-ABEND-OPER-MESSAGE-2  12813445
128135         MOVE 'PCT_BUS_EVNT_EXPRT'    TO PV-ABEND-TABLE-1         12813545
128136         PERFORM 9100-SQL-ABEND                                   12813645
128137     END-IF.                                                      12813745
128138                                                                  12813845
128139******************************************************************12813945
128140*  PROCESS LABEL PRINTS                                          *12814045
128141******************************************************************12814145
128142 4000-PROCESS-PRINT-DATA.                                         12814280
128143                                                                  12814396
128144     SET  PS-NOT-END-OF-LBL-CSR TO  TRUE.                         12814445
128145                                                                  12814545
128146     PERFORM 4100-OPEN-PRINT-DATA-CSR.                            12814680
128147                                                                  12814745
128148     PERFORM 4200-FETCH-PRINT-DATA-CSR.                           12814880
128149                                                                  12814945
128150     PERFORM 4300-PROCESS-LBPTDA-CSR                              12815080
128151       UNTIL PS-END-OF-LBL-CSR.                                   12815145
128152                                                                  12815245
128153     PERFORM 4400-CLOSE-PRINT-DATA-CSR.                           12815380
128154                                                                  12815445
128155******************************************************************12815545
128156*                                                                *12815645
128157******************************************************************12815745
128158 4100-OPEN-PRINT-DATA-CSR.                                        12815880
128159******************************************************************12815945
128160                                                                  12816045
128161     EXEC SQL                                                     12816145
128162          OPEN LBL-PRINT-CSR                                      12816245
128163     END-EXEC                                                     12816345
128164                                                                  12816445
128165     EVALUATE TRUE                                                12816545
128166         WHEN SQLCODE = +0                                        12816645
128167             CONTINUE                                             12816745
128168         WHEN SQLWARN0 NOT EQUAL SPACE                            12816845
128169         WHEN SQLCODE NOT EQUAL ZERO                              12816945
128170             MOVE '4100-OPEN-PRINT-DATA-CSR'                      12817080
128171                                  TO PV-ABEND-PARAGRAPH           12817145
128172             MOVE 'ERROR OPENING PRINT DATA CURSOR'               12817245
128173                                  TO PV-ABEND-OPER-MESSAGE-1      12817345
128174             MOVE PV-SHIPT-UNT-ID TO PV-SHIPT-UNT-ID-N            12817445
128175             STRING 'SHIPT UNT ID:'  DELIMITED BY SIZE            12817545
128176                     PV-SHIPT-UNT-ID-N                            12817645
128177                                     DELIMITED BY SIZE            12817745
128178                               INTO PV-ABEND-OPER-MESSAGE-2       12817845
128179             MOVE 'TLBPTDA  '     TO PV-ABEND-TABLE-1             12817945
128180             PERFORM 9100-SQL-ABEND                               12818045
128181     END-EVALUATE.                                                12818145
128182                                                                  12818245
128183******************************************************************12818345
128184*                                                                *12818445
128185******************************************************************12818545
128186 4200-FETCH-PRINT-DATA-CSR.                                       12818680
128187******************************************************************12818745
128189                                                                  12818945
128190     EXEC SQL                                                     12819045
128191          FETCH LBL-PRINT-CSR                                     12819145
128192           INTO :LBPTDA-CRE-TMST                                  12819245
128193              , :LBPTDA-LBL-PRT-BTCH-ID                           12819370
128194              , :LBPTDA-CART-ACTN-CDE                             12819456
128195              , :LBPTDA-CART-LBL-TYP-CDE                          12819556
128196              , :LBPTDA-BRCDE-NBR                                 12819656
128197              , :LBPTDA-OPER-UNT-ID                               12819799
128198              , :LBPTDA-MISDIR-OPER-UNT-ID                        12819899
128199     END-EXEC.                                                    12819999
128200                                                                  12820099
128201     EVALUATE TRUE                                                12820199
128202         WHEN SQLCODE = +0                                        12820299
128203             CONTINUE                                             12820399
128204         WHEN SQLCODE = +100                                      12820499
128205             SET PS-END-OF-LBL-CSR TO TRUE                        12820599
128206         WHEN SQLWARN0 NOT EQUAL SPACE                            12820699
128207         WHEN SQLCODE NOT EQUAL ZERO                              12820799
128208             MOVE '4100-OPEN-PRINT-DATA-CSR'                      12820899
128209                                  TO PV-ABEND-PARAGRAPH           12820999
128210             MOVE 'ERROR OPENING PRINT DATA CURSOR'               12821099
128211                                  TO PV-ABEND-OPER-MESSAGE-1      12821199
128212             MOVE PV-SHIPT-UNT-ID TO PV-SHIPT-UNT-ID-N            12821299
128213             STRING 'SHIPT UNT ID:'  DELIMITED BY SIZE            12821399
128214                     PV-SHIPT-UNT-ID-N                            12821499
128215                                     DELIMITED BY SIZE            12821599
128216                               INTO PV-ABEND-OPER-MESSAGE-2       12821699
128217             MOVE 'TLBPTDA  '     TO PV-ABEND-TABLE-1             12821799
128218             PERFORM 9100-SQL-ABEND                               12821899
128219     END-EVALUATE.                                                12821999
128220                                                                  12822099
128221******************************************************************12822199
128222*                                                                *12822299
128223******************************************************************12822399
128224 4300-PROCESS-LBPTDA-CSR.                                         12822499
128225******************************************************************12822599
128226*                                                                *12822699
128227                                                                  12822799
128228     SET  PV-LABEL-PRINT        TO TRUE                           12822899
128229     IF LBPTDA-LBL-PRT-BTCH-ID  > 0                               12822999
128230        IF LBPTDA-CART-ACTN-CDE = 'Q'                             12823099
128231           MOVE 'RF AUDIT LABEL PRINT ' TO PV-CARTON-ACTIVITY     12823199
128232        ELSE                                                      12823299
128233           IF LBPTDA-CART-LBL-TYP-CDE = 'P'                       12823399
128234              MOVE 'RF LABEL PRINT' TO PV-CARTON-ACTIVITY         12823499
128235           ELSE                                                   12823599
128236              MOVE SPACES           TO   PV-BAR-CODE-MSG-LBL      12823699
128237              MOVE LBPTDA-BRCDE-NBR TO   PV-BAR-CODE-TXT          12823799
128238              MOVE 'RF PRINT '     TO   PV-BRCDE-PRINT-TXT        12823899
128239              MOVE PV-BAR-CODE-MSG-LBL  TO PV-CARTON-ACTIVITY     12823999
128240           END-IF                                                 12824099
128241        END-IF                                                    12824199
128242     ELSE                                                         12824299
128243        IF LBPTDA-CART-ACTN-CDE = 'Q'                             12824399
128244           MOVE 'PNA AUDIT LABEL PRINT ' TO PV-CARTON-ACTIVITY    12824499
128245        ELSE                                                      12824599
128246           IF LBPTDA-CART-LBL-TYP-CDE = 'P'                       12824699
128247              MOVE 'PNA LABEL PRINT' TO PV-CARTON-ACTIVITY        12824799
128248           ELSE                                                   12824899
128249              MOVE SPACES           TO   PV-BAR-CODE-MSG-LBL      12824999
128250              MOVE LBPTDA-BRCDE-NBR TO   PV-BAR-CODE-TXT          12825099
128251              MOVE 'PNA PRINT '     TO   PV-BRCDE-PRINT-TXT       12825199
128252              MOVE PV-BAR-CODE-MSG-LBL  TO PV-CARTON-ACTIVITY     12825299
128253           END-IF                                                 12825399
128254        END-IF                                                    12825499
128255     END-IF.                                                      12825599
128256                                                                  12825699
128257     MOVE LBPTDA-CRE-TMST       TO PV-ACTIVITY-TIMESTAMP.         12825799
128258                                                                  12825899
128259     IF LBPTDA-OPER-UNT-ID  > 0                                   12825999
128260        MOVE LBPTDA-OPER-UNT-ID TO PV-OPER-UNT-ID                 12826099
128261     ELSE                                                         12826199
128262        MOVE LBPTDA-MISDIR-OPER-UNT-ID TO PV-OPER-UNT-ID          12826299
128263     END-IF.                                                      12826399
128264                                                                  12826499
128265     PERFORM 6000-WRITE-ACTIVITY-RECORD.                          12826599
128266*                                                                *12826699
128267     PERFORM 4200-FETCH-PRINT-DATA-CSR.                           12826799
128268******************************************************************12826899
128269 4400-CLOSE-PRINT-DATA-CSR.                                       12826999
128270******************************************************************12827099
128271*                                                                *12827199
128272                                                                  12827299
128273     EXEC SQL                                                     12827399
128274          CLOSE LBL-PRINT-CSR                                     12827499
128275     END-EXEC                                                     12827599
128276                                                                  12827699
128277     EVALUATE TRUE                                                12827799
128278         WHEN SQLCODE = +0                                        12827899
128279             CONTINUE                                             12827999
128280         WHEN SQLWARN0 NOT EQUAL SPACE                            12828099
128281         WHEN SQLCODE NOT EQUAL ZERO                              12828199
128282             MOVE '4100-OPEN-PRINT-DATA-CSR'                      12828299
128283                                  TO PV-ABEND-PARAGRAPH           12828399
128284             MOVE 'ERROR CLOSING PRINT DATA CURSOR'               12828499
128285                                  TO PV-ABEND-OPER-MESSAGE-1      12828599
128286             MOVE PV-SHIPT-UNT-ID TO PV-SHIPT-UNT-ID-N            12828699
128287             STRING 'SHIPT UNT ID:'  DELIMITED BY SIZE            12828799
128288                     PV-SHIPT-UNT-ID-N                            12828899
128289                                     DELIMITED BY SIZE            12828999
128290                               INTO PV-ABEND-OPER-MESSAGE-2       12829099
128291             MOVE 'TLBPTDA  '     TO PV-ABEND-TABLE-1             12829199
128292             PERFORM 9100-SQL-ABEND                               12829299
128293     END-EVALUATE.                                                12829399
128294                                                                  12829499
128295******************************************************************12829599
128296*  SELECT-DIRECTIVES-PARM                                         12829699
128297******************************************************************12829799
128298 3550-SELECT-DIRECTIVES-PARM.                                     12829899
128299                                                                  12829999
128300      EXEC SQL                                                    12830099
128301          SELECT FUNC_TXT                                         12830199
128302            INTO :PS-AUTOCY-DIRECTIVE-MODE                        12830299
128303            FROM TKRPRPM                                          12830399
128304           WHERE INTFC_SYS_CDE        = 'KHL'                     12830499
128305             AND SYS_PRC_FUNC_CDE     = 'ACAUDT'                  12830599
128306             AND FUNC_PRC_STAT_CDE    = 'AC'                      12830699
128307             AND FUNC_BEG_TMST       <=  CURRENT TIMESTAMP        12830799
128308             AND FUNC_END_TMST       >=  CURRENT TIMESTAMP        12830899
128309             AND LOC_ID               =  :PV-OPER-UNT-ID          12830999
128310      END-EXEC                                                    12831099
128311                                                                  12831199
128312      EVALUATE TRUE                                               12831299
128313          WHEN SQLCODE = ZERO                                     12831399
128314               CONTINUE                                           12831499
128315          WHEN SQLCODE = +100                                     12831599
128316               MOVE 'N'   TO PS-AUTOCY-DIRECTIVE-MODE             12831699
128317          WHEN SQLCODE = -904                                     12831799
128318          WHEN SQLCODE = -911                                     12831899
128319              CONTINUE                                            12831999
128320                                                                  12832099
128321          WHEN SQLWARN0 NOT = SPACES                              12832199
128322          WHEN SQLCODE < ZERO                                     12832299
128323          WHEN SQLCODE > ZERO                                     12832399
128324              MOVE '3550-SELECT-DIRECTIVES-PARM    '              12832499
128325                              TO PV-ABEND-PARAGRAPH               12832599
128326              MOVE 'CHECK DIRECTIVES PARAMETER'                   12832699
128327                              TO PV-ABEND-OPER-MESSAGE-1          12832799
128328              MOVE 'TKRPRPM ' TO PV-ABEND-TABLE-1                 12832899
128329              PERFORM 9100-SQL-ABEND                              12832999
128330                                                                  12833099
128331      END-EVALUATE.                                               12833199
128332                                                                  12833299
128333******************************************************************12833399
128334*  PROCESS CARTON DIVERT TRACKING                                *12833499
128335******************************************************************12833599
128336 5000-PROCESS-CART-DVRT.                                          12833699
128337                                                                  12833799
128338     SET  PS-NOT-END-OF-DVRT-CSR TO TRUE.                         12833899
128339                                                                  12833999
128340     PERFORM 5100-OPEN-CART-DVRT-CSR.                             12834099
128341                                                                  12834199
128342     PERFORM 5150-FETCH-CART-DVRT-CSR.                            12834299
128343                                                                  12834399
128344     PERFORM 5200-PROCESS-CART-DVRT-CSR                           12834499
128345       UNTIL PS-END-OF-DVRT-CSR.                                  12834599
128346                                                                  12834699
128347     PERFORM 5300-CLOSE-CART-DVRT-CSR.                            12834799
128348                                                                  12834899
128349******************************************************************12834999
128350*                                                                *12835099
128351******************************************************************12835199
128352 5100-OPEN-CART-DVRT-CSR.                                         12835299
128353******************************************************************12835399
128354                                                                  12835499
128355     EXEC SQL                                                     12835599
128356          OPEN CART-DVRT-TRKNG-CSR                                12835699
128357     END-EXEC                                                     12835799
128358                                                                  12835899
128359     EVALUATE TRUE                                                12835999
128360         WHEN SQLCODE = +0                                        12836099
128361             CONTINUE                                             12836199
128362         WHEN SQLWARN0 NOT EQUAL SPACE                            12836299
128363         WHEN SQLCODE NOT EQUAL ZERO                              12836399
128364             MOVE '5100-OPEN-CART-DVRT-CSR'                       12836499
128365                                  TO PV-ABEND-PARAGRAPH           12836599
128366             MOVE 'ERROR OPENING DIVERT DATA CURSOR'              12836699
128367                                  TO PV-ABEND-OPER-MESSAGE-1      12836799
128368             STRING 'P2L BARCODE :'  DELIMITED BY SIZE            12836899
128369                     PV-P2L-BARCODE                               12836999
128370                                     DELIMITED BY SIZE            12837099
128371                               INTO PV-ABEND-OPER-MESSAGE-2       12837199
128372             MOVE 'SUT_CART_DI'   TO PV-ABEND-TABLE-1             12837299
128373             PERFORM 9100-SQL-ABEND                               12837399
128374     END-EVALUATE.                                                12837499
128375                                                                  12837599
128376******************************************************************12837699
128377*                                                                *12837799
128378******************************************************************12837899
128379 5150-FETCH-CART-DVRT-CSR.                                        12837999
128380******************************************************************12838099
128381     EXEC SQL                                                     12838199
128382          FETCH CART-DVRT-TRKNG-CSR                               12838299
128383           INTO :SUT00102-CRE-TMST                                12838399
128384              , :SUT00102-DIRV-RSN-CDE                            12838499
128385              , :SUT00102-CNVYR-PRC-ACTN-NM                       12838599
128386              , :SUT00102-OPER-UNT-ID                             12838699
128387     END-EXEC.                                                    12838799
128388                                                                  12838899
128389     EVALUATE TRUE                                                12838999
128390         WHEN SQLCODE = +0                                        12839099
128391             CONTINUE                                             12839199
128392         WHEN SQLCODE = +100                                      12839299
128393             SET PS-END-OF-DVRT-CSR TO TRUE                       12839399
128394         WHEN SQLWARN0 NOT EQUAL SPACE                            12839499
128395         WHEN SQLCODE NOT EQUAL ZERO                              12839599
128396             MOVE '5150-FETCH-CART-DVRT-CSR'                      12839699
128397                                  TO PV-ABEND-PARAGRAPH           12839799
128398             MOVE 'ERROR FETCH OF CARTON DVRT CSR '               12839899
128399                                  TO PV-ABEND-OPER-MESSAGE-1      12839999
128400             MOVE PV-SHIPT-UNT-ID TO PV-SHIPT-UNT-ID-N            12840099
128401             STRING 'P2L BARCODE :'  DELIMITED BY SIZE            12840199
128402                     PV-P2L-BARCODE                               12840299
128403                                     DELIMITED BY SIZE            12840399
128404                               INTO PV-ABEND-OPER-MESSAGE-2       12840499
128405             MOVE 'SUT_CART_D'    TO PV-ABEND-TABLE-1             12840599
128406             PERFORM 9100-SQL-ABEND                               12840699
128407     END-EVALUATE.                                                12840799
128408                                                                  12840899
128409******************************************************************12840999
128410*                                                                *12841099
128411******************************************************************12841199
128412 5200-PROCESS-CART-DVRT-CSR.                                      12841299
128413******************************************************************12841399
128414*                                                                *12841499
128415     SET PV-CARTON-DIRECTIVE  TO TRUE                             12841599
128416     MOVE SUT00102-OPER-UNT-ID TO PV-OPER-UNT-ID.                 12841690
128420     MOVE SUT00102-CRE-TMST TO PV-ACTIVITY-TIMESTAMP.             12842090
128430                                                                  12843090
128431     IF  SUT00102-DIRV-RSN-CDE = 'AU%'                            12843190
128432     AND SUT00102-CNVYR-PRC-ACTN-NM = 'ADD'                       12843290
128433         MOVE '100% AUDIT NEEDED DIRECTIVE   '                    12843390
128434              TO PV-CARTON-ACTIVITY                               12843490
128435     END-IF.                                                      12843590
128436                                                                  12843690
128437     IF  SUT00102-DIRV-RSN-CDE = 'AUN'                            12843790
128438         MOVE 'AUDIT NO LONGER NEED DIRECTIVE'                    12843890
128439              TO PV-CARTON-ACTIVITY                               12843990
128440     END-IF.                                                      12844090
128441                                                                  12844190
128442     IF  SUT00102-DIRV-RSN-CDE = 'AUP'                            12844290
128443         MOVE 'AUDIT PASS RELEASE DIRECTIVE  '                    12844390
128444              TO PV-CARTON-ACTIVITY                               12844490
128445     END-IF.                                                      12844590
128446                                                                  12844690
128447     IF  SUT00102-DIRV-RSN-CDE = 'AUQ'                            12844790
128448         MOVE 'QA AUDIT NEEDED DIRECTIVE     '                    12844890
128449              TO PV-CARTON-ACTIVITY                               12844990
128450     END-IF.                                                      12845090
128451                                                                  12845190
128452     IF  SUT00102-DIRV-RSN-CDE = 'AUR'                            12845290
128453     AND SUT00102-CNVYR-PRC-ACTN-NM = 'ADD'                       12845390
128454         MOVE 'REWORK AUDIT NEEDED DIRECTIVE '                    12845490
128455              TO PV-CARTON-ACTIVITY                               12845590
128456     END-IF.                                                      12845690
128457                                                                  12845790
128458     IF  SUT00102-DIRV-RSN-CDE = 'AUU'                            12845890
128459     AND SUT00102-CNVYR-PRC-ACTN-NM = 'ADD'                       12845990
128460         MOVE 'WAIT ON AUDIT RESULT DIRECTIVE'                    12846090
128461              TO PV-CARTON-ACTIVITY                               12846190
128462     END-IF.                                                      12846290
128463                                                                  12846390
128464     IF  SUT00102-DIRV-RSN-CDE = 'BRC'                            12846490
128465         MOVE 'ROUTE VIA BARCORD DIRECTIVE   '                    12846590
128466              TO PV-CARTON-ACTIVITY                               12846690
128467     END-IF.                                                      12846790
128468                                                                  12846890
128469     IF  SUT00102-DIRV-RSN-CDE = 'RCL'                            12846990
128470     AND SUT00102-CNVYR-PRC-ACTN-NM = 'ADD'                       12847090
128471         MOVE 'CARTON RECLAIMED DIRECTIVE    '                    12847190
128472              TO PV-CARTON-ACTIVITY                               12847290
128473     END-IF.                                                      12847390
128474                                                                  12847490
128475     IF  SUT00102-DIRV-RSN-CDE = 'RFD'                            12847590
128476         MOVE 'CARTON TO BE TAGGED DIRECTIVE '                    12847690
128477              TO PV-CARTON-ACTIVITY                               12847790
128478     END-IF.                                                      12847890
128479                                                                  12847990
128480     IF  SUT00102-DIRV-RSN-CDE = 'RLC'                            12848090
128481         MOVE 'CARTON RELEASE AUDIT DIRECTIVE'                    12848190
128482              TO PV-CARTON-ACTIVITY                               12848290
128483     END-IF.                                                      12848390
128484                                                                  12848490
128485     IF  SUT00102-DIRV-RSN-CDE = 'RLF'                            12848590
128486         MOVE 'CARTON MANUAL RELEASE DIRECTVE'                    12848690
128487              TO PV-CARTON-ACTIVITY                               12848790
128488     END-IF.                                                      12848890
128489                                                                  12848990
128490     IF  SUT00102-DIRV-RSN-CDE = 'RLO'                            12849090
128491     AND SUT00102-CNVYR-PRC-ACTN-NM = 'ADD'                       12849190
128492         MOVE 'CARTON ONLINE RELEASE DIRECTVE'                    12849290
128493              TO PV-CARTON-ACTIVITY                               12849390
128494     END-IF.                                                      12849490
128495                                                                  12849590
128496     IF  PV-CARTON-ACTIVITY = ' '                                 12849690
128497         IF  SUT00102-CNVYR-PRC-ACTN-NM = 'DELETE'                12849790
128498             IF  SUT00102-DIRV-RSN-CDE = 'RLO'                    12849890
128499             OR  SUT00102-DIRV-RSN-CDE = 'AUR'                    12849990
128500             OR  SUT00102-DIRV-RSN-CDE = 'RCL'                    12850090
128501             OR  SUT00102-DIRV-RSN-CDE = 'AU%'                    12850190
128502             OR  SUT00102-DIRV-RSN-CDE = 'AUU'                    12850290
128503                 NEXT SENTENCE                                    12850390
128504             ELSE                                                 12850490
128505                 DISPLAY 'NO HANDLING FOR CARTON '                12850590
128506                         'RELEASE DIRECTIVE: '                    12850690
128507                         SUT00102-DIRV-RSN-CDE                    12850790
128508                 DISPLAY 'SML NUMBER: ' PV-P2L-BARCODE            12850891
128509             END-IF                                               12850990
128510         ELSE                                                     12851090
128511             DISPLAY 'NO HANDLING FOR CARTON '                    12851190
128512                     'RELEASE DIRECTIVE: '                        12851290
128513                     SUT00102-DIRV-RSN-CDE                        12851390
128514             DISPLAY 'SML NUMBER: ' PV-P2L-BARCODE                12851491
128515         END-IF                                                   12851590
128516     ELSE                                                         12851690
128518         PERFORM 6000-WRITE-ACTIVITY-RECORD                       12851891
128519     END-IF.                                                      12851990
128521*                                                                *12852190
128522     PERFORM 5150-FETCH-CART-DVRT-CSR.                            12852290
128523******************************************************************12852390
128524 5300-CLOSE-CART-DVRT-CSR.                                        12852490
128525******************************************************************12852590
128526*                                                                *12852690
128527                                                                  12852790
128528     EXEC SQL                                                     12852890
128529          CLOSE CART-DVRT-TRKNG-CSR                               12852990
128530     END-EXEC                                                     12853090
128531                                                                  12853190
128532     EVALUATE TRUE                                                12853290
128533         WHEN SQLCODE = +0                                        12853390
128534             CONTINUE                                             12853490
128535         WHEN SQLWARN0 NOT EQUAL SPACE                            12853590
128536         WHEN SQLCODE NOT EQUAL ZERO                              12853690
128537             MOVE '5100-OPEN-CART-DVRT-CSR'                       12853790
128538                                  TO PV-ABEND-PARAGRAPH           12853890
128539             MOVE 'ERROR CLOSING CART-DVRT  CURSOR'               12853990
128540                                  TO PV-ABEND-OPER-MESSAGE-1      12854090
128541             STRING 'P2L BARCODE :'  DELIMITED BY SIZE            12854190
128542                     PV-P2L-BARCODE                               12854290
128543                                     DELIMITED BY SIZE            12854390
128544                               INTO PV-ABEND-OPER-MESSAGE-2       12854490
128545             MOVE 'SUT_CART_DIRV_TRKG' TO PV-ABEND-TABLE-1        12854590
128546             PERFORM 9100-SQL-ABEND                               12854690
128547     END-EVALUATE.                                                12854790
128548                                                                  12854890
128549******************************************************************12854990
128550*  PROCESS EAS TAG RECORDS                                       *12855090
128551******************************************************************12855190
128552 5400-PROCESS-EAS-TAGGING.                                        12855290
128553                                                                  12855390
128554     SET  PS-NOT-END-OF-TAG-CSR TO  TRUE.                         12855490
128555                                                                  12855590
128556     PERFORM 5500-OPEN-EAS-TAG-CSR.                               12855690
128557                                                                  12855790
128558     PERFORM 5550-FETCH-EAS-TAG-CSR.                              12855890
128559                                                                  12855990
128560     PERFORM 5600-PROCESS-EAS-TAGGING-CSR                         12856090
128561       UNTIL PS-END-OF-TAG-CURSOR.                                12856190
128562                                                                  12856290
128563     PERFORM 5700-CLOSE-EAS-TAG-CSR.                              12856390
128564                                                                  12856490
128565******************************************************************12856590
128566*                                                                *12856690
128567******************************************************************12856790
128568 5500-OPEN-EAS-TAG-CSR.                                           12856890
128569******************************************************************12856990
128570                                                                  12857090
128571     EXEC SQL                                                     12857190
128572          OPEN EAS-TAG-CSR                                        12857290
128573     END-EXEC                                                     12857390
128574                                                                  12857490
128575     EVALUATE TRUE                                                12857590
128576         WHEN SQLCODE = +0                                        12857690
128577             CONTINUE                                             12857790
128578         WHEN SQLWARN0 NOT EQUAL SPACE                            12857890
128579         WHEN SQLCODE NOT EQUAL ZERO                              12857990
128580             MOVE '5500-OPEN-EAS-TAG-CSR'                         12858090
128581                                  TO PV-ABEND-PARAGRAPH           12858190
128582             MOVE 'ERROR OPENING DIVERT DATA CURSOR'              12858290
128583                                  TO PV-ABEND-OPER-MESSAGE-1      12858390
128584             STRING 'P2L BARCODE :'  DELIMITED BY SIZE            12858490
128585                     PV-P2L-BARCODE                               12858590
128586                                     DELIMITED BY SIZE            12858690
128587                               INTO PV-ABEND-OPER-MESSAGE-2       12858790
128588             MOVE 'SUT_CART_DI'   TO PV-ABEND-TABLE-1             12858890
128589             PERFORM 9100-SQL-ABEND                               12858990
128590     END-EVALUATE.                                                12859090
128591                                                                  12859190
128592******************************************************************12859290
128593*                                                                *12859390
128594******************************************************************12859490
128595 5550-FETCH-EAS-TAG-CSR.                                          12859590
128596******************************************************************12859690
128597     EXEC SQL                                                     12859790
128598          FETCH EAS-TAG-CSR                                       12859890
128599           INTO :SHUNLO-CRE-TMST                                  12859990
128600              , :SHUNLO-SCN-LOC-ID                                12860090
128601              , :SHUNLO-OPER-UNT-ID                               12860199
128602     END-EXEC.                                                    12860299
128603                                                                  12860399
128604     EVALUATE TRUE                                                12860499
128605         WHEN SQLCODE = +0                                        12860599
128606             CONTINUE                                             12860699
128607         WHEN SQLCODE = +100                                      12860799
128608             SET PS-END-OF-TAG-CURSOR TO TRUE                     12860899
128609         WHEN SQLWARN0 NOT EQUAL SPACE                            12860999
128610         WHEN SQLCODE NOT EQUAL ZERO                              12861099
128611             MOVE '5500-OPEN-EAS-TAG-CSR'                         12861199
128612                                  TO PV-ABEND-PARAGRAPH           12861299
128613             MOVE 'ERROR OPENING PRINT DATA CURSOR'               12861399
128614                                  TO PV-ABEND-OPER-MESSAGE-1      12861499
128615             MOVE PV-SHIPT-UNT-ID TO PV-SHIPT-UNT-ID-N            12861599
128616             STRING 'P2L BARCODE :'  DELIMITED BY SIZE            12861699
128617                     PV-P2L-BARCODE                               12861799
128618                                     DELIMITED BY SIZE            12861899
128619                               INTO PV-ABEND-OPER-MESSAGE-2       12861999
128620             MOVE 'SUT_CART_D'    TO PV-ABEND-TABLE-1             12862099
128621             PERFORM 9100-SQL-ABEND                               12862199
128622     END-EVALUATE.                                                12862299
128623                                                                  12862399
128624******************************************************************12862499
128625*                                                                *12862599
128626******************************************************************12862699
128627 5600-PROCESS-EAS-TAGGING-CSR.                                    12862799
128628******************************************************************12862899
128629*                                                                *12862999
128630      MOVE PV-P2L-BARCODE        TO SU173-CARTON-ID.              12863099
128631      SET  PV-EAS-TAG-PROCESS    TO TRUE.                         12863199
128632      IF  SHUNLO-SCN-LOC-ID  = 'RFDC'                             12863299
128633          MOVE 'RFID/EAS TAG LBL '    TO PV-CARTON-ACTIVITY       12863399
128634      ELSE                                                        12863499
128635          MOVE 'RFID/EAS TAG COMPLT'  TO PV-CARTON-ACTIVITY       12863599
128636      END-IF.                                                     12863699
128637                                                                  12863799
128638      MOVE SHUNLO-CRE-TMST       TO PV-ACTIVITY-TIMESTAMP.        12863899
128639      MOVE SHUNLO-OPER-UNT-ID    TO PV-OPER-UNT-ID.               12863999
128640      PERFORM 6000-WRITE-ACTIVITY-RECORD.                         12864099
128641*                                                                 12864199
128642      PERFORM 5550-FETCH-EAS-TAG-CSR.                             12864299
128643******************************************************************12864399
128644 5700-CLOSE-EAS-TAG-CSR.                                          12864499
128645******************************************************************12864599
128646*                                                                *12864699
128647                                                                  12864799
128648     EXEC SQL                                                     12864899
128649          CLOSE EAS-TAG-CSR                                       12864999
128650     END-EXEC                                                     12865099
128651                                                                  12865199
128652     EVALUATE TRUE                                                12865299
128653         WHEN SQLCODE = +0                                        12865399
128654             CONTINUE                                             12865499
128655         WHEN SQLWARN0 NOT EQUAL SPACE                            12865599
128656         WHEN SQLCODE NOT EQUAL ZERO                              12865699
128657             MOVE '5700-CLOSE-EAS-TAG-CSR'                        12865799
128658                                  TO PV-ABEND-PARAGRAPH           12865899
128659             MOVE 'ERROR CLOSING EAS TAG  CURSOR'                 12865999
128660                                  TO PV-ABEND-OPER-MESSAGE-1      12866099
128661             STRING 'P2L BARCODE :'  DELIMITED BY SIZE            12866199
128662                     PV-P2L-BARCODE                               12866299
128663                                     DELIMITED BY SIZE            12866399
128664                               INTO PV-ABEND-OPER-MESSAGE-2       12866499
128665             MOVE 'TSHUNLO ' TO PV-ABEND-TABLE-1                  12866599
128666             PERFORM 9100-SQL-ABEND                               12866699
128667     END-EVALUATE.                                                12866799
128668                                                                  12866899
128669******************************************************************12866999
128670 6000-WRITE-ACTIVITY-RECORD.                                      12867099
128671                                                                  12867199
128672     MOVE  SPACES                  TO SU173-EXTRACT-RECORD.       12867299
128673     MOVE  PV-P2L-BARCODE          TO SU173-CARTON-ID.            12867399
128674                                                                  12867499
128675     EVALUATE TRUE                                                12867599
128676        WHEN PV-INBOUND-LAUNCH                                    12867699
128677           MOVE  'INBOUND LAUNCH'   TO SU173-CARTON-ACTIVITY      12867799
128678        WHEN PV-CHECK-IN                                          12867899
128679           IF PS-PNA-CHKIN-RECORD-FOUND                           12867999
128680              MOVE  'PNA CHECKIN '     TO SU173-CARTON-ACTIVITY   12868099
128681           ELSE                                                   12868199
128682             IF PS-RF-CHKIN-RECORD-FOUND                          12868299
128683                MOVE  'RF CHECKIN  '     TO SU173-CARTON-ACTIVITY 12868399
128684             ELSE                                                 12868499
128685                MOVE  'MANUAL CHECKIN'   TO SU173-CARTON-ACTIVITY 12868599
128686             END-IF                                               12868699
128687           END-IF                                                 12868799
128688        WHEN PV-CARTON-AUDIT-START                                12868899
128689        WHEN PV-CARTON-AUDIT-STOP                                 12868999
128690             MOVE PV-CARTON-AUDIT-ACTIVITY                        12869099
128691                                        TO SU173-CARTON-ACTIVITY  12869199
128692        WHEN PV-LABEL-PRINT                                       12869299
128693             MOVE PV-CARTON-ACTIVITY    TO SU173-CARTON-ACTIVITY  12869399
128694        WHEN PV-CARTON-DIRECTIVE                                  12869499
128695             MOVE PV-CARTON-ACTIVITY    TO SU173-CARTON-ACTIVITY  12869599
128696        WHEN PV-EAS-TAG-PROCESS                                   12869699
128697             MOVE PV-CARTON-ACTIVITY    TO SU173-CARTON-ACTIVITY  12869799
128698     END-EVALUATE                                                 12869899
128699                                                                  12869999
128700     MOVE  PV-ACTIVITY-TIMESTAMP   TO PV-HOLD-TMST.               12870099
128701     PERFORM 6100-FORMAT-OUTPUT-DATE-TIME.                        12870199
128702                                                                  12870299
128710     MOVE  PV-OPER-UNT-ID          TO SU173-ACTIVITY-AT-DC-NBR.   12871099
129730                                                                  12973094
129800     WRITE SU-P2L-ACTIVITY-FILE-RECORD FROM                       12980008
129900                                SU173-EXTRACT-RECORD.             12990008
129910                                                                  12991008
130000     ADD  1  TO  PV-TOTAL-WRITE-CNT.                              13000008
130100                                                                  13010000
130200                                                                  13020000
130210 6100-FORMAT-OUTPUT-DATE-TIME.                                    13021099
130220                                                                  13022099
130230     MOVE '-'          TO SU173-DASH-01                           13023099
130240                          SU173-DASH-02.                          13024099
130250     MOVE ':'          TO SU173-COLON-01                          13025099
130260                          SU173-COLON-02.                         13026099
130270     MOVE SPACE        TO SU173-SPACE-01.                         13027099
130280                                                                  13028099
130290     MOVE PV-HOLD-TMST-YYYY   TO SU173-ACTIVITY-YYYY.             13029099
130291     MOVE PV-HOLD-TMST-MM     TO SU173-ACTIVITY-MM.               13029199
130292     MOVE PV-HOLD-TMST-DD     TO SU173-ACTIVITY-DD.               13029299
130293     MOVE PV-HOLD-TMST-HH     TO SU173-ACTIVITY-HH.               13029399
130294     MOVE PV-HOLD-TMST-MI     TO SU173-ACTIVITY-MI.               13029499
130295     MOVE PV-HOLD-TMST-SS     TO SU173-ACTIVITY-SS.               13029599
130296                                                                  13029699
130297     MOVE  PC-COMMA           TO SU173-COMMA-01                   13029799
130298                                 SU173-COMMA-02                   13029899
130299                                 SU173-COMMA-03                   13029999
130300                                 SU173-COMMA-04.                  13030099
130310******************************************************************13031000
130400*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    13040000
130500*  ERROR OR WARNING CODE OCCURS.                                  13050000
130600******************************************************************13060000
130700 9100-SQL-ABEND.                                                  13070000
130800     MOVE SQLCODE    TO PV-SQLCODE.                               13080000
130900     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       13090000
131000                                                                  13100000
131100     DISPLAY '9100-SQL-ABEND'.                                    13110000
131200     DISPLAY '** ABEND              **'.                          13120000
131300     DISPLAY '** SQLCODE            ** = ' PV-DISPLAY-SQLCODE.    13130000
131400     DISPLAY '** PROGRAM            ** = ' PC-CURRENT-PROGRAM-NAME13140000
131500     DISPLAY '** PARAGRAPH          ** = ' PV-ABEND-PARAGRAPH.    13150000
131600     DISPLAY '** TABLE(S) AFFECTED  ** = ' PV-ABEND-TABLE-1.      13160000
131700     DISPLAY '**                    ** = ' PV-ABEND-TABLE-2.      13170000
131800     DISPLAY '**                    ** = ' PV-ABEND-TABLE-3.      13180000
131900     DISPLAY '**                    ** = ' PV-ABEND-TABLE-4.      13190000
132000     DISPLAY '** OPERATION          ** = ' PV-ABEND-OPER-MESSAGE-113200000
132100     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-213210000
132200     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-313220000
132300     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-413230000
132400     DISPLAY '**                    ** = '                        13240000
132500                                                                  13250000
132600******************************************************************13260000
132700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    13270000
132800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         13280000
132900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     13290000
133000* FORMAT.                                                         13300000
133100******************************************************************13310000
133200     COPY DPPD004.                                                13320000
133300                                                                  13330000
133400     MOVE +4013                  TO ABEND-CODE.                   13340000
133500     CALL 'ILBOABN0' USING ABEND-CODE.                            13350000
