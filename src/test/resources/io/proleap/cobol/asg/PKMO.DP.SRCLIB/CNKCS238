000100*-----------------------*                                         00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300*-----------------------*                                         00030002
000600 PROGRAM-ID.    CNKCS238.                                         00060002
000700 AUTHOR.        DENISE HAHN                                       00070002
000800 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00080002
000900 DATE-WRITTEN.  JUNE, 2012.                                       00090002
001000 DATE-COMPILED.                                                   00100002
001100*----------------------------------------------------------------*00110002
001200*    Y238 - DC-SEASONAL SET DIVERT CRIT SPEC                     *00120002
001300*                                                                *00130002
001400*    THIS PROGRAM ALLOWS THE USER TO ENTER DATA TO BE USED BY    *00140002
001500*    SUBSEQUENT PROGRAMS.  FROM THIS SCREEN THE USER CAN PRESS:  *00150002
001700*    F15 TO SEASONAL SET DIVERT NUMBER                           *00170002
001900*    F23 TO DISPLAY A LIST OF SEASONAL SETS                      *00190002
002100*----------------------------------------------------------------*00210002
263455* CHANGED 11/03/2021    BY JIM HUNTER      WR: CHG0263455         00211042
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00212042
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00213042
263455*----------------------------------------------------------------*00214042
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00215043
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00216043
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00217043
CICS  *-----------------------------------------------------------------00218043
002200 ENVIRONMENT DIVISION.                                            00220002
002300 DATA DIVISION.                                                   00230002
002400                                                                  00240002
002500 WORKING-STORAGE SECTION.                                         00250028
004000                                                                  00400008
004100 01  PC-PROGRAM-CONSTANTS.                                        00410008
004200     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'CNK238'.   00420008
004210     05  PC-UPDATE                 PIC  X(01)  VALUE  'U'.        00421018
004300     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'CNKM238'.  00430008
004400     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'CNKCS238'. 00440008
005600                                                                  00560013
005700 01  PS-PROGRAM-SWITCHES.                                         00570013
005800     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00580013
005900         88  PS-ERROR                          VALUE  'Y'.        00590013
006000         88  PS-NO-ERROR                       VALUE  'N'.        00600013
006700                                                                  00670021
006800*----------------------------------------------------------------*00680002
006900*  SYSTEM MESSAGES                                               *00690002
007000*----------------------------------------------------------------*00700002
007100*   00005 - INVALID VALUE                                         00710017
007200*   00007 - REQUIRED ENTRY                                        00720017
007300*   00008 - MUST BE NUMERIC                                       00730017
007900*----------------------------------------------------------------*00790002
008000 01  PC-TSYMSG-NUMBERS.                                           00800016
008100     05  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.          00810016
008200     05  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.          00820016
008300     05  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.          00830016
008900                                                                  00890021
010300                                                                  01030002
010400*----------------------------------------------------------------*01040002
010500*    MAP LAYOUT                                                  *01050002
010600*----------------------------------------------------------------*01060002
010700     COPY CNKM238.                                                01070002
010800                                                                  01080002
010900*----------------------------------------------------------------*01090002
011000*    ATTRIBUTE SETTINGS COPYBOOK.                                *01100002
011100*----------------------------------------------------------------*01110002
011200     COPY DPWS015.                                                01120002
011300                                                                  01130002
011400*----------------------------------------------------------------*01140002
011500*    FUNCTION KEYS COPYBOOK                                      *01150002
011600*----------------------------------------------------------------*01160002
011700     COPY DPWS016.                                                01170002
011800                                                                  01180002
011900******************************************************************01190002
012000** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01200002
012100** SUB-ROUTINE (DPKUT100).                                      **01210002
012200******************************************************************01220002
012300     COPY DPWS010I.                                               01230002
012400                                                                  01240002
012500******************************************************************01250002
012600** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **01260002
012700** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01270002
012800******************************************************************01280002
012900     COPY DPWS030.                                                01290002
CICS       COPY DPWS930.                                                01291043
013000                                                                  01300002
013100***************************************************************** 01310002
013200*    STANDARD COMMAREA.                                           01320002
013300***************************************************************** 01330002
013400     COPY DPWS020.                                                01340002
013500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01350002
013600                                                                  01360002
013700***************************************************************** 01370002
013800*    INTER-APPLICATION COMMAREA.                                  01380002
013900***************************************************************** 01390002
014000         10  INTER-APPL-COMM-AREA PIC X(200).                     01400002
014100     COPY CNWS015.                                                01410003
014200                                                                  01420002
014300***************************************************************** 01430002
014400*    SPECIFIC COMMAREA FOR CNKCS238.                              01440002
014500***************************************************************** 01450002
014510*                                                                 01451003
014600         10  ASC-SPECIFIC-COMMAREA.                               01460004
015000             15  ASC-FUNCTION                PIC  X(01).          01500018
015001             15  ASC-CURRENT-TIMESTAMP       PIC  X(26).          01500118
015002             15  ASC-CURRENT-TIMESTAMP-R                          01500218
015003                 REDEFINES ASC-CURRENT-TIMESTAMP.                 01500318
015004                 20  ASC-CURRENT-YEAR        PIC  X(04).          01500418
015005                 20  FILLER                  PIC  X(22).          01500518
015010             15  ASC-DVRT-PREFIX             PIC  X(04).          01501039
015100             15  ASC-DVRT-PREFIX-N REDEFINES ASC-DVRT-PREFIX      01510004
015201                                             PIC  9(04).          01520139
015202             15  ASC-DVRT-PREFIX-R REDEFINES ASC-DVRT-PREFIX.     01520238
015203                 20  FILLER                  PIC  X(02).          01520339
015204                 20  ASC-DIVERT-2DIGIT       PIC  9(02).          01520436
015300             15  ASC-FROM-YEAR               PIC  X(04).          01530004
015400             15  ASC-FROM-YEAR-N REDEFINES ASC-FROM-YEAR          01540007
015500                                             PIC  Z(04).          01550004
015510             15  ASC-TO-YEAR                 PIC  X(04).          01551004
015520             15  ASC-TO-YEAR-N REDEFINES ASC-TO-YEAR              01552007
015530                                             PIC  Z(04).          01553004
015600             15  ASC-SHORT-NAME              PIC  X(05).          01560004
015700             15  ASC-SEASET-NAME             PIC  X(25).          01570004
016000             15  ASC-STR-RLSE-END-DTE        PIC  X(10).          01600022
016040             15  ASC-SEASET-STAT-CDE         PIC  X(01).          01604022
016050             15  ASC-SEASET-TYPE             PIC  X(03).          01605031
017000             15  FILLER                      PIC  X(97).          01700031
017100                                                                  01710002
017200*----------------------------------------------------------------*01720002
017300*    ABEND PROCESSING COPYBOOK.                                  *01730002
017400*----------------------------------------------------------------*01740002
017500     COPY DPWS013.                                                01750002
017600                                                                  01760002
017700*----------------------------------------------------------------*01770002
017800*    SEASONAL SET TABLE                                           01780003
017900*----------------------------------------------------------------*01790002
018000     EXEC SQL                                                     01800002
018100          INCLUDE TSEASET                                         01810003
018200     END-EXEC.                                                    01820002
018300                                                                  01830002
019100*----------------------------------------------------------------*01910002
019200*    COMMAREA USED TO CALL XLKUT071                               01920002
019300*----------------------------------------------------------------*01930002
019400*    COPY XLWS071.                                                01940003
019500                                                                  01950002
019600*----------------------------------------------------------------*01960002
019700*  COMMUNICATION AREAS FOR DB2                                    01970002
019800*----------------------------------------------------------------*01980002
019900     EXEC SQL                                                     01990002
020000         INCLUDE SQLCA                                            02000002
020100     END-EXEC.                                                    02010002
020200                                                                  02020002
020300*----------------------------------------------------------------*02030002
020400 LINKAGE SECTION.                                                 02040002
020500                                                                  02050002
020600 01  DFHCOMMAREA.                                                 02060002
020700     05  FILLER                         OCCURS  1 TO 4072 TIMES   02070002
020800                                        DEPENDING ON EIBCALEN.    02080002
020900         10  FILLER                     PIC X.                    02090002
021000                                                                  02100002
021100                                                                  02110002
021200 PROCEDURE DIVISION.                                              02120002
021300***************************************************************** 02130002
021400** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02140002
021500** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02150002
021600** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02160002
021700**                                                             ** 02170002
021800** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02180002
021900** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02190002
022000***************************************************************** 02200002
022100 0000-MAIN-MODULE.                                                02210002
022200     INITIALIZE DP030-CICS-API-FIELDS.                            02220002
022300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02230002
022400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02240002
022500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02250002
022600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02260002
022700     MOVE LENGTH OF CNK238I        TO DP030-MAP-LENGTH (1).       02270004
022800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02280002
022900     PERFORM 0001-CALL-CICS-ARCH-API.                             02290002
023000*                                                                 02300002
023100     PERFORM 1000-CONTROL-PROCESSING                              02310002
023200*                                                                 02320002
023300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02330002
023400     PERFORM 0001-CALL-CICS-ARCH-API.                             02340002
023500                                                                  02350002
023600*---------------------------------------------------------------- 02360002
023700 0001-CALL-CICS-ARCH-API.                                         02370002
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02380043
023900                                    DFHCOMMAREA                   02390043
024000                                    DP030-CICS-API-FIELDS         02400043
024100                                    DP020-STANDARD-COMMAREA       02410043
024200                                    CNK238I.                      02420043
024300*                                                                 02430002
024400     IF  DP030-RC-CALL-SUCCESSFUL                                 02440002
024500         CONTINUE                                                 02450002
024600     ELSE                                                         02460002
024700         SET DP013-NO-ROLLBACK                                    02470002
024800             DP013-XCTL-DISPLAY-RESTART                           02480002
024900             DP013-CICS-ABEND      TO TRUE                        02490002
025000         MOVE 'BEFORE 0000-MAIN-MODULE'                           02500002
025100                                   TO DP013-PARAGRAPH             02510002
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02511043
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02512043
025400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02540002
025500         PERFORM DP013-0000-PROCESS-ABEND                         02550002
025600     END-IF.                                                      02560002
025700                                                                  02570002
025800*----------------------------------------------------------------*02580002
025900*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02590002
026000*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02600002
026100*----------------------------------------------------------------*02610002
026200 1000-CONTROL-PROCESSING.                                         02620002
026300                                                                  02630002
026400     EVALUATE TRUE                                                02640002
026500         WHEN DP020-NEXT-ACT-INITIAL                              02650002
026600              INITIALIZE ASC-SPECIFIC-COMMAREA                    02660004
026900              PERFORM 4000-BUILD-INITIAL-PANEL                    02690004
027000              PERFORM 3200-RESET-ATTRIBUTES                       02700004
027100                                                                  02710002
027200         WHEN DP020-NEXT-ACT-RETURN                               02720002
027300              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                02730004
027400              PERFORM 3200-RESET-ATTRIBUTES                       02740004
027500                                                                  02750002
027600         WHEN DP020-NEXT-ACT-READ-MAP                             02760002
027700              PERFORM 2000-FKEY-PROCESSING                        02770004
027800                                                                  02780002
027900         WHEN OTHER                                               02790002
028000              SET DP013-LOGIC-ABEND                               02800004
028100                  DP013-NO-ROLLBACK TO TRUE                       02810004
028200              MOVE 'CNKCS238 - 1000-CONTROL-PROCESSING'           02820004
028300                                    TO  DP013-PARAGRAPH           02830004
028400              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  02840004
028500                                    TO  DP013-MESSAGE-TEXT(1)     02850004
028600              MOVE DP020-NEXT-APPL-ACTIVITY                       02860004
028700                                    TO DP013-MESSAGE-TEXT(2)      02870004
028800              PERFORM DP013-0000-PROCESS-ABEND                    02880004
028900     END-EVALUATE.                                                02890002
029000                                                                  02900002
029100*----------------------------------------------------------------*02910002
029200* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02920002
029300* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02930002
029400* EDITS.                                                         *02940002
029500*----------------------------------------------------------------*02950002
029600 2000-FKEY-PROCESSING.                                            02960002
029700                                                                  02970002
029800     EVALUATE TRUE                                                02980002
029900                                                                  02990002
030000         WHEN DP020-SRC-AID = DP016-CLEAR                         03000002
030100              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  03010004
030200              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                03020004
030300                                                                  03030002
030400*F5-REFRESH                                                       03040002
030500         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03050002
030600              INITIALIZE ASC-SPECIFIC-COMMAREA                    03060003
030800              MOVE SPACES      TO                                 03080023
030900                                  AFRYEARO                        03090003
031100                                  ASHRTNMO                        03110003
031300                                  ASETNAMO                        03130003
031400                                  ARLSEYRO                        03140003
031800                                                                  03180011
032100             PERFORM 4000-BUILD-INITIAL-PANEL                     03210002
032200             PERFORM 3200-RESET-ATTRIBUTES                        03220002
032300                                                                  03230002
032400         WHEN OTHER                                               03240002
032500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 03250002
032600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03260002
032700             IF  PS-NO-ERROR                                      03270002
032800                 SET DP030-CONTINUE-GO TO TRUE                    03280002
032900                 PERFORM 2100-CHECK-FUNCTION-KEY                  03290002
033000                 IF  PS-ERROR                                     03300002
033100                     SET DP030-OVERRIDE-GO TO TRUE                03310002
033200                 END-IF                                           03320002
033300             ELSE                                                 03330002
033400                 SET DP030-OVERRIDE-GO TO TRUE                    03340002
033500             END-IF                                               03350002
033600     END-EVALUATE.                                                03360002
033700                                                                  03370002
033800******************************************************************03380002
033900** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **03390002
034000** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **03400002
034100** FROM THE CICS ARCHITECTURE API.                              **03410002
034200******************************************************************03420002
034300 2100-CHECK-FUNCTION-KEY.                                         03430002
034400     EVALUATE TRUE                                                03440002
034500                                                                  03450002
034600         WHEN DP020-SRC-AID = DP016-ENTER                         03460002
035200              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                03520003
035300                                                                  03530002
037200                                                                  03720002
037300*F15 UPD SET  ----> GOES TO CNKCS240 TO PROCESS A TSEASET UPDATE  03730003
037400         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              03740002
037500              IF  ASC-FROM-YEAR   = SPACES  OR                    03750015
037510                  ASC-SHORT-NAME  = SPACES                        03751015
037600                  SET PS-ERROR                                    03760003
037700                      DP020-MSG-FATAL         TO TRUE             03770003
037800                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 03780003
037900                  MOVE DP015-UNP-ALP-BRT-OFF  TO AFRYEARA         03790015
037910                                                 ASHRTNMA         03791015
038000                  MOVE DP015-RED              TO AFRYEARC         03800015
038010                                                 ASHRTNMC         03801015
038100                  MOVE DP015-REVERSE          TO AFRYEARH         03810015
038110                                                 ASHRTNMH         03811015
038200                  MOVE -1                     TO AFRYEARL         03820015
038210                                                 ASHRTNML         03821015
038300                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             03830003
038400                  MOVE SPACES                 TO AFRYEARO         03840015
038410                                                 ASHRTNMO         03841015
038420              ELSE                                                03842030
038430                  MOVE PC-UPDATE              TO ASC-FUNCTION     03843041
039900                  PERFORM 2110-PREPARE-INTER-APPL-COMM            03990003
040100              END-IF                                              04010003
040200           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   04020002
040300                                                                  04030002
041400*F23 SET LIST ----> GOES TO CNKCS239 TO LIST SEASONAL SETS        04140003
041500         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04150003
041600              MOVE  SPACES                TO ASC-FUNCTION         04160041
042700              PERFORM 2110-PREPARE-INTER-APPL-COMM                04270015
042900              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                04290003
043000                                                                  04300002
046800     END-EVALUATE.                                                04680002
046900*                                                                 04690003
047000******************************************************************04700002
047100** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **04710002
047200** INTER-APPLICATION COMMAREA.                                  **04720002
047300******************************************************************04730002
047400 2110-PREPARE-INTER-APPL-COMM.                                    04740004
047500                                                                  04750004
047600     INITIALIZE CN015-INTER-APPL-COMMAREA.                        04760035
047700                                                                  04770004
047800     MOVE ASC-FUNCTION             TO CN015-FUNCTION.             04780004
047900     MOVE ASC-DIVERT-2DIGIT        TO CN015-DIVERT-PREFIX-NBR.    04790036
048000     MOVE ASC-FROM-YEAR            TO CN015-SET-YEAR.             04800027
048200     MOVE ASC-SHORT-NAME           TO CN015-SHORT-NAME.           04820004
048300     MOVE ASC-SEASET-NAME          TO CN015-SEASET-NAME.          04830004
048310     MOVE ASC-SEASET-STAT-CDE      TO CN015-STATUS.               04831027
048400     MOVE ASC-STR-RLSE-END-DTE     TO CN015-RLSE-DATE.            04840025
048500     MOVE ASC-SEASET-TYPE          TO CN015-SEASET-TYPE.          04850031
049200                                                                  04920004
049300*----------------------------------------------------------------*04930002
049400* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*04940002
049500* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *04950002
049600* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *04960002
049700*----------------------------------------------------------------*04970002
049800 2200-MOVE-SCREEN-TO-COMMAREA.                                    04980012
050800*FROM YEAR                                                        05080004
050900     IF  AFRYEARL > ZERO                                          05090004
051000         MOVE AFRYEARI        TO ASC-FROM-YEAR                    05100004
051100     ELSE                                                         05110004
051200         IF  AFRYEARF = DP015-ERASE-EOF                           05120004
051300             MOVE SPACES      TO ASC-FROM-YEAR                    05130004
051400         END-IF                                                   05140004
051500     END-IF.                                                      05150004
051600                                                                  05160004
051700*SEASONAL SET SHORT NAME                                          05170004
051800     IF  ASHRTNML > ZERO                                          05180004
051900         MOVE ASHRTNMI        TO ASC-SHORT-NAME                   05190004
052000     ELSE                                                         05200004
052100         IF  ASHRTNMF = DP015-ERASE-EOF                           05210004
052200             MOVE SPACES      TO ASC-SHORT-NAME                   05220004
052300         END-IF                                                   05230004
052400     END-IF.                                                      05240004
052500                                                                  05250004
052510*SEASONAL SET LONG NAME                                           05251004
052520     IF  ASETNAML > ZERO                                          05252004
052530         MOVE ASETNAMI        TO ASC-SEASET-NAME                  05253004
052540     ELSE                                                         05254004
052550         IF  ASETNAMF = DP015-ERASE-EOF                           05255004
052560             MOVE SPACES      TO ASC-SEASET-NAME                  05256004
052570         END-IF                                                   05257004
052580     END-IF.                                                      05258004
052590                                                                  05259004
052626                                                                  05262604
052630******************************************************************05263002
052700* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *05270002
052800* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *05280002
052900* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE     *05290002
053000* DONE IN THE DESTINATION PROGRAM, NOT HERE.                     *05300002
053100******************************************************************05310002
053200 3000-EDIT-DATA-IN-COMMAREA.                                      05320004
053300     PERFORM 3200-RESET-ATTRIBUTES.                               05330004
053400                                                                  05340004
053500*EDIT "DIVERT PREFIX" TO MAKE SURE NUMERIC                        05350004
053510                                                                  05351004
055410                                                                  05541004
055420*EDIT "FROM YEAR" TO MAKE SURE NUMERIC                            05542004
055430                                                                  05543004
055440     IF  ASC-FROM-YEAR   NOT = SPACES                             05544004
055450         MOVE ASC-FROM-YEAR      TO DP010I-UNEDITED-FIELD         05545004
055460         MOVE LENGTH OF ASC-FROM-YEAR   TO DP010I-MAXIMUM-DIGITS  05546004
055470         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       05547004
055480         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  05548004
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         05549142
263455              USING DP010I-NUMERIC-EDIT-AREA                      05549242
055491         IF  DP010I-ERROR-DETECTED                                05549304
055492             SET PS-ERROR                                         05549404
055493                 DP020-MSG-FATAL         TO TRUE                  05549504
055494             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      05549604
055495             MOVE DP015-UNP-ALP-BRT-OFF  TO AFRYEARA              05549704
055496             MOVE DP015-RED              TO AFRYEARC              05549804
055497             MOVE DP015-REVERSE          TO AFRYEARH              05549904
055498             MOVE -1                     TO AFRYEARL              05550004
055499             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  05550104
055500             MOVE SPACES                 TO AFRYEARO              05550204
055501         ELSE                                                     05550304
055502             MOVE DP010I-NUMERIC-FIELD  TO ASC-FROM-YEAR-N        05550404
055503             MOVE ASC-FROM-YEAR         TO AFRYEARO               05550504
055504     END-IF.                                                      05550604
055505                                                                  05550704
055598*VALIDATE SEASONAL SET                                            05559804
055599     IF  ASC-FROM-YEAR   >  SPACES  AND                           05559904
055600         ASC-SHORT-NAME  >  SPACES                                05560004
055610             PERFORM 3010-VALIDATE-SEASONAL-SET                   05561004
055700             IF  PS-ERROR                                         05570004
055800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05580004
055900             END-IF                                               05590004
056100     END-IF.                                                      05610004
056200                                                                  05620004
056700                                                                  05670004
056800                                                                  05680004
056900****************************************************************  05690002
057000*    VALIDATE SEASONAL SET                                     *  05700004
057200****************************************************************  05720002
057300                                                                  05730004
057400 3010-VALIDATE-SEASONAL-SET.                                      05740004
064300      MOVE ASC-FROM-YEAR     TO  SEASET-SEASET-YR.                06430004
064310      MOVE ASC-SHORT-NAME    TO  SEASET-SEASET-SHRT-NM.           06431004
064400                                                                  06440004
064500        EXEC SQL                                                  06450004
064600          SELECT  SEASET_NM                                       06460004
064610                , SEASET_STAT_CDE                                 06461022
064620                , STR_RLSE_END_DTE                                06462022
064630                , SEASET_TYP_CDE                                  06463031
064640                , DIVERT_PFX_NBR                                  06464032
064700            INTO :SEASET-SEASET-NM                                06470004
064710                ,:SEASET-SEASET-STAT-CDE                          06471022
064720                ,:SEASET-STR-RLSE-END-DTE                         06472022
064730                ,:SEASET-SEASET-TYP-CDE                           06473031
064740                ,:SEASET-DIVERT-PFX-NBR                           06474032
064800            FROM  TSEASET                                         06480004
064900           WHERE  SEASET_YR      = :SEASET-SEASET-YR              06490004
065000             AND  SEASET_SHRT_NM = :SEASET-SEASET-SHRT-NM         06500004
065100        END-EXEC.                                                 06510004
065200                                                                  06520004
065300        EVALUATE TRUE                                             06530004
065400            WHEN SQLCODE = +0                                     06540004
065500                 MOVE  SEASET-SEASET-NM  TO ASC-SEASET-NAME       06550022
065501                 MOVE  SEASET-SEASET-STAT-CDE                     06550122
065502                                         TO ASC-SEASET-STAT-CDE   06550222
065503                 MOVE  SEASET-STR-RLSE-END-DTE                    06550322
065504                                         TO ASC-STR-RLSE-END-DTE  06550422
065505                 MOVE  SEASET-SEASET-TYP-CDE                      06550531
065506                                         TO ASC-SEASET-TYPE       06550631
065507                 MOVE  SEASET-DIVERT-PFX-NBR                      06550734
065508                                         TO ASC-DVRT-PREFIX       06550832
065510                                                                  06551004
065600            WHEN SQLCODE = +100                                   06560004
065700                SET PS-ERROR                                      06570004
065800                    DP020-MSG-FATAL         TO TRUE               06580004
065900                MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER   06590004
066000                MOVE DP015-UNP-ALP-BRT-OFF  TO AFRYEARA           06600004
066010                                               ASHRTNMA           06601004
066100                MOVE DP015-RED              TO AFRYEARC           06610004
066110                                               ASHRTNMC           06611004
066200                MOVE DP015-REVERSE          TO AFRYEARH           06620004
066210                                               ASHRTNMH           06621004
066300                MOVE -1                     TO AFRYEARL           06630004
066400                SET DP030-SET-CURSOR-APPL-1 TO TRUE               06640004
066500                MOVE SPACES                 TO AFRYEARO           06650004
066501                                               ASHRTNMO           06650104
066510                                                                  06651004
066600            WHEN SQLWARN0 NOT = SPACES                            06660004
066700            WHEN SQLCODE < +0                                     06670004
066800            WHEN SQLCODE > +0                                     06680004
066900                MOVE '3010-VALIDATE-SEASONAL-SET  '               06690004
067000                                          TO DP013-PARAGRAPH      06700004
067100                MOVE 'INVALID SEASONAL SET'                       06710004
067200                                    TO DP013-MESSAGE-TEXT (1)     06720004
067210                STRING 'SET:' ASC-FROM-YEAR '-'                   06721005
067220                              ASC-SHORT-NAME                      06722005
067230                                       DELIMITED BY SIZE          06723004
067240                                  INTO DP013-MESSAGE-TEXT (1)     06724004
067300                MOVE SQLCA      TO DP013-SQLCA                    06730004
067400                MOVE 'TSEASET'  TO DP013-DB2-TABLE-NAME (1)       06740004
067500                SET DP013-DB2-ABEND                               06750004
067600                    DP013-XCTL-DISPLAY-RESTART TO TRUE            06760004
067700                PERFORM DP013-0000-PROCESS-ABEND                  06770004
067800        END-EVALUATE.                                             06780004
067900                                                                  06790004
068000                                                                  06800004
092200******************************************************************09220002
092300** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **09230002
092400** MAP.                                                         **09240002
092500******************************************************************09250002
092600 3200-RESET-ATTRIBUTES.                                           09260004
092700     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       09270004
092800                                                                  09280004
094100     MOVE DP015-UNP-ALP-NOR-OFF TO                                09410024
094200                                   AFRYEARA                       09420004
094310                                   ASHRTNMA.                      09431024
094360                                                                  09436004
094400     MOVE DP015-GREEN           TO                                09440024
094500                                   AFRYEARC                       09450004
094610                                   ASHRTNMC.                      09461024
094660                                                                  09466004
094700     MOVE DP015-UNDERLINE       TO                                09470024
094800                                   AFRYEARH                       09480004
094910                                   ASHRTNMH.                      09491024
094920                                                                  09492024
095000     MOVE -1                    TO AFRYEARL.                      09500024
095200                                                                  09520004
095300     SET DP030-SET-CURSOR-APPL-1    TO TRUE.                      09530004
095310                                                                  09531004
095320                                                                  09532004
095400*----------------------------------------------------------------*09540002
095500*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *09550002
095600*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *09560002
095700*  IT HERE.                                                      *09570002
095800*----------------------------------------------------------------*09580002
095900 4000-BUILD-INITIAL-PANEL.                                        09590004
096300                                                                  09630004
096310     PERFORM 4100-GET-CURRENT-YEAR.                               09631004
096320                                                                  09632004
096400     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        09640004
096500*                                                                 09650003
096600     MOVE  ASC-CURRENT-YEAR        TO ASC-FROM-YEAR               09660004
096700                                      ASC-TO-YEAR.                09670004
097100*                                                                 09710003
097200     MOVE ASC-FROM-YEAR            TO AFRYEARO.                   09720004
097400                                                                  09740004
097410                                                                  09741004
097500****************************************************************  09750002
097600*    GET CURRENT YEAR.                                         *  09760004
097700*                                                              *  09770002
097800****************************************************************  09780002
097900                                                                  09790004
098000 4100-GET-CURRENT-YEAR.                                           09800004
098010                                                                  09801004
098020         EXEC SQL                                                 09802004
098030             SET :ASC-CURRENT-TIMESTAMP = CURRENT TIMESTAMP       09803004
098040         END-EXEC.                                                09804004
102100                                                                  10210004
102110                                                                  10211004
102200*----------------------------------------------------------------*10220002
102300*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *10230002
102400*----------------------------------------------------------------*10240002
102500 4400-MOVE-COMMAREA-TO-SCREEN.                                    10250004
102510                                                                  10251004
102700     MOVE ASC-FROM-YEAR            TO AFRYEARO.                   10270004
102900     MOVE ASC-SHORT-NAME           TO ASHRTNMO.                   10290004
103000     MOVE ASC-SEASET-NAME          TO ASETNAMO.                   10300004
103100     MOVE ASC-STR-RLSE-END-DTE     TO ARLSEYRO.                   10310025
103300                                                                  10330004
103310                                                                  10331004
103400*----------------------------------------------------------------*10340002
103500*    ABEND PROCESSOR MODULE                                      *10350002
103600*----------------------------------------------------------------*10360002
103700                                                                  10370002
103800     COPY DPPD013.                                                10380002
