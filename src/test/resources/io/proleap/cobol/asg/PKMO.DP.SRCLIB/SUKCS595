000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    SUKCS595.                                         00040000
000500 AUTHOR.        DEANNA BRANTNER                                   00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  JUNE, 2002.                                       00070000
000800 DATE-COMPILED.                                                   00080000
000900*----------------------------------------------------------------*00090000
001000*    S595 - OUTBOUND MANIFESTED CARTON - CRITERIA SPECIFICATION   00100000
001100*----------------------------------------------------------------*00110000
001110* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00111022
001120* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00112023
001130* MAKING THE CALL DYNAMIC VS STATIC.                              00113023
001130*                                                                 00113125
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00113225
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00113325
001140*---------------------------------------------------------------* 00114023
001200 ENVIRONMENT DIVISION.                                            00120000
001300 DATA DIVISION.                                                   00130000
001400                                                                  00140000
001500 WORKING-STORAGE SECTION.                                         00150000
001600*----------------------------------------------------------------*00160000
001700*   PROGRAM CONSTANTS                                            *00170000
001800*----------------------------------------------------------------*00180000
001900 01  PC-PROGRAM-CONSTANTS.                                        00190000
002000     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'SU595A  '.  00200000
002100     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'SUKM595 '.  00210000
002200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'SUKCS595'.  00220000
002300     05  PC-REPORT-PGM-1           PIC  X(08)  VALUE 'PCKCS126'.  00230000
002400     05  PC-OP-CO-NBR              PIC  X(02)  VALUE '03'.        00240000
002500     05  PC-FCLTY-ID-0001          PIC  9(04)  VALUE  0001.       00250000
002600     05  PC-01                     PIC  X(02)  VALUE '01'.        00260000
002700     05  PC-PRTR-VALIDATION-PGM    PIC  X(08)  VALUE 'DPKCS060'.  00270000
002800     05  PC-LOCATION-MODULE        PIC  X(08)  VALUE 'XLKUT071'.  00280000
002900     05  PC-A                      PIC  X(01)  VALUE 'A'.         00290000
003000     05  PC-C                      PIC  X(01)  VALUE 'C'.         00300000
003100     05  PC-DPT                    PIC  X(03)  VALUE 'DPT'.       00310000
003200     05  PC-MGMX                   PIC  X(04)  VALUE 'MGMX'.      00320000
003300     05  PC-LEAVE-SYSTEM-LENGTH    PIC S9(04)  VALUE +160.        00330011
003400     05  PC-Y                      PIC  X(01)  VALUE 'Y'.         00340003
003500     05  PC-TEST                   PIC  X(01)  VALUE 'T'.         00350003
003600     05  PC-QA                     PIC  X(01)  VALUE 'Q'.         00360003
003700     05  PC-LEARN                  PIC  X(01)  VALUE 'L'.         00370003
003800                                                                  00380000
003900*-----------------------------------------------------------------00390000
004000*  DB2 KEYS                                                       00400000
004100*-----------------------------------------------------------------00410000
004200 01  DK-DB2-KEYS.                                                 00420000
004300     05  DK-PURGE-WEEKS                 PIC S9(04)  COMP VALUE +0.00430000
004400     05  DK-CURR-OPER-UNT-ID            PIC S9(04)  COMP VALUE +0.00440000
004500     05  DK-CURR-FCLTY-ID               PIC S9(04)  COMP VALUE +0.00450000
004600     05  DK-PO-NUMBER                   PIC S9(09)  COMP VALUE +0.00460000
004700     05  DK-RCVR-NUMBER                 PIC S9(09)  COMP VALUE +0.00470000
004800     05  DK-LINE-NUMBER                 PIC S9(09)  COMP VALUE +0.00480000
004900     05  DK-SML-NUMBER-NUM              PIC S9(18)  COMP-3.       00490000
005000     05  DK-STORE-NUMBER                PIC S9(04)  COMP VALUE +0.00500000
005100     05  DK-SML-NUMBER-X                PIC  X(22)  VALUE SPACES. 00510000
005200     05  DK-SML-NUMBER-R REDEFINES DK-SML-NUMBER-X.               00520000
005300         10  DK-SML-ZEROES              PIC  X(02).               00530000
005400         10  DK-SML-NUMBER              PIC  9(18).               00540000
005500         10  DK-SML-SPACES              PIC  X(02).               00550000
005600                                                                  00560000
005700*----------------------------------------------------------------*00570000
005800*  SYSTEM MESSAGES                                               *00580000
005900*----------------------------------------------------------------*00590000
006000*   00005 = INVALID VALUE                                         00600000
006100*   00007 = REQUIRED ENTRY                                        00610000
006200*   00008 = MUST BE NUMERIC                                       00620000
006300*   00045 = INVALID FUNCTION KEY                                  00630000
006400*   00954 = PO/RECEIVER SEQUENCE NOT FOUND                        00640000
006500*   01247 = LINE DOES NOT EXIST ON THE SPECIFIED PO               00650000
006600*   01623 = INVALID STORE NUMBER FOR THIS FUNCTION                00660000
006700*   02227 = APPLICATION UNAVAILABLE AT THIS TIME                  00670000
006800*   02546 = PURCHASE ORDER NUMBER NOT FOUND                       00680000
006900*   03101 =RCVR NOT AVALIABLE-STORE CARTONS PURGED X WEEKS VRFY   00690000
007000*   03396 = MASTER CONTAINER - SCANNED ONTO TRIP &VAR             00700000
007100*   03397 = MASTER CONTAINER - DIVERTED TO DOOR                   00710000
007200*   03704 = PO-FX-STORE REQUIRED FOR FAST TRANSFER LOOKUP         00720004
007300*                                                                 00730000
007400*----------------------------------------------------------------*00740000
007500 01  PC-TSYMSG-NUMBERS.                                           00750000
007600     05  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.          00760000
007700     05  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.          00770000
007800     05  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.          00780000
007900     05  PC-TSYMSG-00045       PIC  9(05)  VALUE  00045.          00790000
008000     05  PC-TSYMSG-00954       PIC  9(05)  VALUE  00954.          00800000
008100     05  PC-TSYMSG-01247       PIC  9(05)  VALUE  01247.          00810000
008200     05  PC-TSYMSG-01623       PIC  9(05)  VALUE  01623.          00820000
008300     05  PC-TSYMSG-02227       PIC  9(05)  VALUE  02227.          00830000
008400     05  PC-TSYMSG-02546       PIC  9(05)  VALUE  02546.          00840000
008500     05  PC-TSYMSG-02861       PIC  9(05)  VALUE  02861.          00850000
008600     05  PC-TSYMSG-03101       PIC  9(05)  VALUE  03101.          00860000
008700     05  PC-TSYMSG-03386       PIC  9(05)  VALUE  03386.          00870000
008800     05  PC-TSYMSG-03387       PIC  9(05)  VALUE  03387.          00880000
008900     05  PC-TSYMSG-03396       PIC  9(05)  VALUE  03396.          00890000
009000     05  PC-TSYMSG-03397       PIC  9(05)  VALUE  03397.          00900000
009100     05  PC-TSYMSG-03700       PIC  9(05)  VALUE  03700.          00910003
009200     05  PC-TSYMSG-03704       PIC  9(05)  VALUE  03704.          00920004
009300                                                                  00930000
009400*----------------------------------------------------------------*00940000
009500*   PROGRAM MESSAGES                                             *00950000
009600*----------------------------------------------------------------*00960000
009700 01  PM-PROGRAM-MESSAGES.                                         00970000
009800     05  PM-ABEND-INFO-A.                                         00980000
009900         10  FILLER                PIC X(15)   VALUE              00990000
010000                                   'DP020-SRC-AID: '.             01000000
010100         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      01010000
010200         10  FILLER                PIC X(19)   VALUE              01020000
010300                                   '. DP020-FK-ACTION: '.         01030000
010400         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      01040000
010500         10  FILLER                PIC X(22)   VALUE              01050000
010600                                   '. DP020-FK-DISPN-IND: '.      01060000
010700         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      01070000
010800         10  FILLER                PIC X(01)   VALUE '.'.         01080000
010900         10  FILLER                PIC X(19)   VALUE SPACE.       01090000
011000                                                                  01100000
011100*----------------------------------------------------------------*01110000
011200*   SWITCHES                                                     *01120000
011300*----------------------------------------------------------------*01130000
011400 01  PS-PROGRAM-SWITCHES.                                         01140000
011500     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        01150000
011600         88  PS-ERROR                          VALUE  'Y'.        01160000
011700         88  PS-NO-ERROR                       VALUE  'N'.        01170000
011900     05  PS-CS-PULL-SW             PIC  X(01)  VALUE  'N'.        01190000
012000         88  PS-CS-PULL-TRAN                   VALUE  'Y'.        01200000
012100         88  PS-NOT-CS-PULL-TRAN               VALUE  'N'.        01210000
012300                                                                  01230004
012600     05  PS-FAST-TRANSFER-SW       PIC  X(01)  VALUE  'N'.        01260004
012700         88  PS-FX-FAST-TRANSFER               VALUE  'Y'.        01270004
012800         88  PS-NOT-FX-FAST-TRANSFER           VALUE  'N'.        01280004
013000                                                                  01300000
013100     05  PS-ABEND-IND                    PIC  X(01)  VALUE 'N'.   01310003
013200         88  PS-NO-ABEND-IN-PROGRESS                 VALUE 'N'.   01320003
013300         88  PS-ABEND-IN-PROGRESS                    VALUE 'Y'.   01330003
013400     05  PS-INTERNAL-READER-ENQ-DEQ-IND  PIC  X(01)  VALUE 'D'.   01340003
013500         88  PS-INTERNAL-READER-ENQUEUED             VALUE 'E'.   01350003
013600         88  PS-INTERNAL-READER-DEQUEUED             VALUE 'D'.   01360003
013700*----------------------------------------------------------------*01370000
013800*   PROGRAM VARIABLES                                            *01380000
013900*----------------------------------------------------------------*01390000
014000 01  PV-PROGRAM-VARIABLES.                                        01400000
014100     05  PV-CHILDREN-COUNT         PIC S9(04)  COMP SYNC          01410000
014200                                               VALUE ZEROES.      01420000
014300     05  PV-SCAN-ON-TRIP-ID        PIC  9(09)  VALUE ZEROES.      01430000
014400     05  PV-DIVERT-DOOR            PIC  X(04)  VALUE SPACES.      01440000
014500     05  PV-PURGE-WEEKS            PIC  Z(09)  VALUE ZEROES.      01450000
014600     05  PV-DISPLAY-SQLCODE        PIC -9(09)  VALUE ZEROES.      01460000
014700     05  PV-PURGE-DATE             PIC  X(10).                    01470000
014800     05  PV-VERIFY-DATE            PIC  X(10).                    01480000
014900     05  PV-4-DIGIT-STORE          PIC  Z(04)  VALUE  ZEROES.     01490000
015000     05  PV-USER-LOCATION          PIC  9(04)  VALUE  ZEROES.     01500000
015100     05  PV-USER-LOCATION-R REDEFINES PV-USER-LOCATION.           01510000
015200         10  FILLER                PIC  X(01).                    01520000
015300         10  PV-DP020-LOCATION     PIC  9(03).                    01530000
015400     05  PV-COMMAREA-LENGTH        PIC S9(04)  VALUE +0.          01540000
015500     05  PV-CICS-RESPONSE          PIC S9(08)  VALUE ZEROES       01550000
015600                                   COMP SYNC.                     01560000
015700     05  PV-CURRENT-DATE           PIC  X(10)  VALUE SPACES.      01570000
015800     05  PV-CURRENT-DATE-R REDEFINES PV-CURRENT-DATE.             01580000
015900         10  PV-CURR-YY            PIC  9(04).                    01590000
016000         10  FILLER                PIC  X(01).                    01600000
016100         10  PV-CURR-MM            PIC  9(02).                    01610000
016200         10  FILLER                PIC  X(01).                    01620000
016300         10  PV-CURR-DD            PIC  9(02).                    01630000
016400     05  PV-SEL-QUEUE-ITEM            PIC S9(04) COMP VALUE ZERO. 01640000
016500     05  PV-CICS-RESP                 PIC S9(04) COMP VALUE ZERO. 01650000
016600     05  PV-SYSTEM-ID.                                            01660003
016700         10  FILLER                PIC  X(04)   VALUE SPACE.      01670003
016800         10  PV-REGION-IND         PIC  X(01).                    01680003
016900             88  PV-TEST-CICS                   VALUE 'T'.        01690003
017000             88  PV-QA-CICS                     VALUE 'Q'.        01700003
017100             88  PV-PROD-CICS                   VALUE 'P'.        01710003
017200             88  PV-LEARN-CICS                  VALUE 'L'.        01720003
017300         10  FILLER                      PIC  X(03)  VALUE SPACES.01730003
017400     05  PV-LEAVE-SYSTEM-MESSAGE         PIC X(160)  VALUE SPACES.01740003
017500     05  PV-JOB-PROC                     PIC  X(07)  VALUE        01750003
017600         'SUK9011'.                                               01760003
017700 01  SE-SYSTEM-ERROR-MESSAGE.                                     01770003
017800     05  FILLER                  PIC X(43)    VALUE               01780003
017900         'A SYSTEM ERROR HAS OCCURRED - CONTACT DP - '.           01790003
018000     05  FILLER                  PIC X(33)    VALUE               01800003
018100         'PROGRAM SUKCS595       EIBRESP = '.                     01810003
018200     05  SE-CICS-RESPONSE        PIC 9(4)     VALUE ZERO.         01820003
018300     05  FILLER                  PIC X(5)     VALUE SPACES.       01830003
018400     05  FILLER                  PIC X(14)    VALUE               01840003
018500         'ATTEMPTING TO '.                                        01850003
018600     05  SE-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.       01860003
018700 01  TD-TRANSIENT-DATA-AREA.                                      01870003
018800     05  TD-QUEUE-NAME           PIC X(4)     VALUE 'IRTD'.       01880003
018900     05  TD-QUEUE-NAME-LENGTH    PIC S9(4)    VALUE +4            01890003
019000                                 COMP SYNC.                       01900003
019100     05  TD-JCL-LINE             PIC X(80)    VALUE SPACES.       01910003
019200     05  TD-JCL-LINE-LENGTH      PIC S9(4)    VALUE +80           01920003
019300                                 COMP SYNC.                       01930003
019400                                                                  01940000
019500 01  JL-JCL-LINE-AREA.                                            01950000
019600     05  JL-JCL-LINE-1           PIC X(80).                       01960000
019700     05  JL-JOB-LINE-PROD.                                        01970000
019800         10  FILLER              PIC X(21)    VALUE               01980000
019900             '//SUK901   JOB KOHLS,'.                             01990000
020000         10  FILLER              PIC X(1)     VALUE QUOTE.        02000000
020100         10  FILLER              PIC X(16)    VALUE               02010000
020200             'CARTON PKD QUERY'.                                  02020000
020300         10  FILLER              PIC X(1)     VALUE QUOTE.        02030000
020400         10  FILLER              PIC X(19)    VALUE               02040000
020500             ',MSGCLASS=P,CLASS=Q'.                               02050000
020600         10  FILLER              PIC X(22)    VALUE SPACES.       02060000
020700     05  JL-JOB-LINE-TEST.                                        02070000
020800         10  FILLER              PIC X(02)    VALUE               02080000
020900             '//'.                                                02090000
021000         10  JL-TEST-JOB-NAME    PIC X(07)    VALUE SPACES.       02100000
021100         10  FILLER              PIC X(01)    VALUE               02110000
021200             'Q'.                                                 02120000
021300         10  FILLER              PIC X(11)    VALUE               02130000
021400             ' JOB KOHLS,'.                                       02140000
021500         10  FILLER              PIC X(1)     VALUE QUOTE.        02150000
021600         10  FILLER              PIC X(16)    VALUE               02160000
021700             'CARTON PKD QUERY'.                                  02170000
021800         10  FILLER              PIC X(1)     VALUE QUOTE.        02180000
021900         10  FILLER              PIC X(19)    VALUE               02190000
022000             ',MSGCLASS=X,CLASS=E'.                               02200000
022100         10  FILLER              PIC X(08)    VALUE               02210000
022200             ',NOTIFY='.                                          02220000
022300         10  JL-TEST-NOTIFY      PIC X(07)    VALUE SPACES.       02230000
022400         10  FILLER              PIC X(07)    VALUE SPACES.       02240000
022500     05  JL-JCL-LINE-3.                                           02250000
022600         10  FILLER              PIC X(13)    VALUE               02260000
022700             '/*JOBPARM K=0'.                                     02270000
022800         10  FILLER              PIC X(67)    VALUE SPACES.       02280000
022900     05  JL-JCL-LINE-4-PROD.                                      02290000
023000         10  FILLER              PIC X(39)    VALUE               02300000
023100             '//JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR'.           02310000
023200         10  FILLER              PIC X(41)    VALUE SPACES.       02320000
023300     05  JL-JCL-LINE-4-TEST.                                      02330000
023400         10  FILLER              PIC X(39)    VALUE               02340000
023500             '//JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR'.           02350000
023600         10  FILLER              PIC X(41)    VALUE SPACES.       02360000
023700     05  JL-JCL-LINE-4-QA.                                        02370000
023800         10  FILLER              PIC X(39)    VALUE               02380000
023900             '//JOBLIB   DD DSN=QKMO.LOADLIB,DISP=SHR'.           02390000
024000         10  FILLER              PIC X(41)    VALUE SPACES.       02400000
024100     05  JL-JCL-LINE-4-LEARN.                                     02410000
024200         10  FILLER              PIC X(39)    VALUE               02420000
024300             '//JOBLIB   DD DSN=LKMO.LOADLIB,DISP=SHR'.           02430000
024400         10  FILLER              PIC X(41)    VALUE SPACES.       02440000
024500     05  JL-JCL-LINE-12.                                          02450000
024600         10  FILLER              PIC X(16)    VALUE               02460000
024700             '//PS020    EXEC '.                                  02470000
024800         10  JL-LINE-12-PROC     PIC X(07)    VALUE SPACES.       02480000
024900         10  JL-LINE-12-PROC-T   PIC X(01)    VALUE SPACES.       02490000
025000         10  FILLER              PIC X(55)    VALUE SPACES.       02500000
025100     05  JL-JCL-LINE-14.                                          02510000
025200         10  FILLER              PIC X(18)    VALUE               02520000
025300             '//S010.SYSUT1 DD *'.                                02530000
025400         10  FILLER              PIC X(62)    VALUE SPACES.       02540000
025500     05  JL-JCL-LINE-15.                                          02550000
025600         10  JL-LINE-15-PO-NBR   PIC X(09).                       02560000
025700         10  FILLER              PIC X(71)    VALUE SPACES.       02570000
025800     05  JL-JCL-LINE-EOF.                                         02580000
025900         10  FILLER              PIC X(5)     VALUE '/*EOF'.      02590000
026000         10  FILLER              PIC X(75)    VALUE SPACES.       02600000
026100*----------------------------------------------------------------*02610000
026200*    MAP LAYOUT                                                  *02620000
026300*----------------------------------------------------------------*02630000
026400     COPY SUKM595.                                                02640000
026500                                                                  02650000
026600*----------------------------------------------------------------*02660000
026700*    LOCATION MODULE COPYBOOK.                                    02670000
026800*----------------------------------------------------------------*02680000
026900     COPY XLWS071.                                                02690000
027000                                                                  02700000
027100*----------------------------------------------------------------*02710000
027200*    ATTRIBUTE SETTINGS COPYBOOK.                                *02720000
027300*----------------------------------------------------------------*02730000
027400     COPY DPWS015.                                                02740000
027500                                                                  02750000
027600*----------------------------------------------------------------*02760000
027700*    FUNCTION KEYS COPYBOOK                                      *02770000
027800*----------------------------------------------------------------*02780000
027900     COPY DPWS016.                                                02790000
028000                                                                  02800000
028100*----------------------------------------------------------------*02810000
028200*    ABEND PROCESSING COPYBOOK.                                  *02820000
028300*----------------------------------------------------------------*02830000
028400     COPY DPWS013.                                                02840000
028500                                                                  02850000
028600*----------------------------------------------------------------*02860000
028700*  THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT     *02870000
028800*  SUB-ROUTINE (DPKUT100).                                       *02880000
028900*----------------------------------------------------------------*02890000
029000     COPY DPWS010I.                                               02900000
029100                                                                  02910000
029200*----------------------------------------------------------------*02920000
029400*  PARAMETERS FOR CALLING CICS ARCHITECTURE API                  *02940025
029500*----------------------------------------------------------------*02950000
029600     COPY DPWS030.                                                02960000
029600     COPY DPWS930.                                                02961025
029700                                                                  02970000
029800*----------------------------------------------------------------*02980000
029900*    STANDARD COMMAREA.                                          *02990000
030000*----------------------------------------------------------------*03000000
030100     COPY DPWS020.                                                03010000
030200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03020000
030300                                                                  03030000
030400*----------------------------------------------------------------*03040000
030500*    INTER-APPLICATION COMMAREA.                                 *03050000
030600*----------------------------------------------------------------*03060000
030700         10  INTER-APPL-COMM-AREA PIC X(200).                     03070000
030800     COPY SUWS008.                                                03080000
031000                                                                  03100000
031100*----------------------------------------------------------------*03110000
031200*    SPECIFIC COMMMAREA FOR SUKCS595.                            *03120000
031300*----------------------------------------------------------------*03130000
031400         10  ASC-SPECIFIC-COMMAREA.                               03140000
031500             15  ASC-CURR-OPER-UNT-ID        PIC  X(04).          03150000
031600             15  ASC-CURR-OPER-UNT-ID-N REDEFINES                 03160000
031700                     ASC-CURR-OPER-UNT-ID    PIC  9(04).          03170000
031800             15  ASC-CURR-FCLTY-ID           PIC  X(04).          03180000
031900             15  ASC-CURR-FCLTY-ID-N REDEFINES                    03190000
032000                     ASC-CURR-FCLTY-ID       PIC  9(04).          03200000
032100             15  ASC-OPER-UNIT-NAME          PIC  X(25).          03210000
032200             15  ASC-PO-NBR                  PIC  X(09).          03220000
032300             15  ASC-PO-NBR-R REDEFINES ASC-PO-NBR.               03230000
032400                 20  ASC-PO-NBR-N            PIC  9(09).          03240000
032500             15  ASC-RCVR-NBR                PIC  X(04).          03250000
032600             15  ASC-RCVR-NBR-R REDEFINES ASC-RCVR-NBR.           03260000
032700                 20  ASC-RCVR-NBR-N          PIC  9(04).          03270000
032800             15  ASC-LINE-NBR                PIC  X(04).          03280000
032900             15  ASC-LINE-NBR-R REDEFINES ASC-LINE-NBR.           03290000
033000                 20  ASC-LINE-NBR-N          PIC  9(04).          03300000
033100             15  ASC-STR-NBR                 PIC  X(04).          03310000
033200             15  ASC-STR-NBR-R REDEFINES ASC-STR-NBR.             03320000
033300                 20  ASC-STR-NBR-N           PIC  9(04).          03330000
033400             15  ASC-STORE-NAME              PIC  X(25).          03340000
033500             15  ASC-SML-NBR-X               PIC  X(20).          03350000
033600             15  ASC-SML-NBR-Y REDEFINES ASC-SML-NBR-X.           03360000
033700                 20  ASC-ZEROES              PIC  9(02).          03370000
033800                 20  ASC-SML-NBR             PIC  9(18).          03380000
033900             15  ASC-SML-NBR-Z REDEFINES ASC-SML-NBR-X.           03390000
034000                 20  ASC-SML-NBR-A           PIC  9(18).          03400000
034100                 20  FILLER                  PIC  X(02).          03410000
034200             15  ASC-CART-SRC                PIC  X(03).          03420000
034300             15  ASC-CART-SRC-CDE            PIC  X(20).          03430000
034400             15  ASC-SEL-QUEUE-NAME.                              03440000
034500                 20  ASC-SEL-TERM-ID          PIC  X(04).         03450000
034600                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  03460000
034700                 20  ASC-SEL-SEQ              PIC  9(01).         03470000
034800             15  ASC-REQUEST-TYPE             PIC  X(02).         03480008
034900                 88  ASC-PO-RCVR-REQ               VALUE 'PO'.    03490007
035000                 88  ASC-CS-PULL-REQ               VALUE 'CS'.    03500007
035100                 88  ASC-FX-FAST-REQ               VALUE 'FX'.    03510007
035110             15  ASC-STORE-SCAN              PIC  X(20).          03511016
035120             15  ASC-STORE-SCAN-DATE         PIC  X(10).          03512016
035130             15  ASC-STORE-SCAN-TIME         PIC  X(05).          03513016
035140             15  ASC-STORE-SCAN-COUNT        PIC S9(09)  COMP.    03514016
035150             15  ASC-STORE-SCAN-MULT         PIC  X.              03515016
035200                                                                  03520000
035300*-----------------------------------------------------------------03530000
035400*  TKRPRPM TABLE                                                  03540000
035500*-----------------------------------------------------------------03550000
035600     EXEC SQL                                                     03560000
035700          INCLUDE TKRPRPM                                         03570000
035800     END-EXEC.                                                    03580000
035900                                                                  03590000
036000*-----------------------------------------------------------------03600000
036100*  TRECITM TABLE                                                  03610000
036200*-----------------------------------------------------------------03620000
036300     EXEC SQL                                                     03630000
036400          INCLUDE TRECITM                                         03640000
036500     END-EXEC.                                                    03650000
036600                                                                  03660000
036700*-----------------------------------------------------------------03670000
036800*  TRECDIS TABLE                                                  03680000
036900*-----------------------------------------------------------------03690000
037000     EXEC SQL                                                     03700000
037100          INCLUDE TRECDIS                                         03710000
037200     END-EXEC.                                                    03720000
037300                                                                  03730000
037400*-----------------------------------------------------------------03740000
037500*  TRECEIV TABLE                                                  03750000
037600*-----------------------------------------------------------------03760000
037700     EXEC SQL                                                     03770000
037800          INCLUDE TRECEIV                                         03780000
037900     END-EXEC.                                                    03790000
038000                                                                  03800000
038100*-----------------------------------------------------------------03810000
038200*  SUT_OTBND_CART TABLE                                           03820000
038300*-----------------------------------------------------------------03830000
038400     EXEC SQL                                                     03840000
038500          INCLUDE SUT00024                                        03850000
038600     END-EXEC.                                                    03860000
038700                                                                  03870000
038800*-----------------------------------------------------------------03880000
038900*  SUT_OTBND_LOC  TABLE                                           03890000
039000*-----------------------------------------------------------------03900000
039100     EXEC SQL                                                     03910000
039200          INCLUDE SUT00027                                        03920000
039300     END-EXEC.                                                    03930000
039400                                                                  03940000
039500*-----------------------------------------------------------------03950000
039600*  TSUCRDV TABLE - CARTON DIVERTS                                 03960000
039700*-----------------------------------------------------------------03970000
039800     EXEC SQL                                                     03980000
039900          INCLUDE TSUCRDV                                         03990000
040000     END-EXEC.                                                    04000000
040100                                                                  04010000
040110*-----------------------------------------------------------------04011016
040120*  SUT_OTBND_STR_SCN - STORE SCAN                                 04012016
040130*-----------------------------------------------------------------04013016
040140     EXEC SQL                                                     04014016
040150          INCLUDE SUT00121                                        04015016
040160     END-EXEC.                                                    04016016
040170                                                                  04017016
040180*-----------------------------------------------------------------04018016
040190*  SUT_OTBND_SCN_TYP - STORE SCAN CODE DESCRIPTIONS               04019016
040191*-----------------------------------------------------------------04019116
040192     EXEC SQL                                                     04019216
040193          INCLUDE SUT00120                                        04019316
040194     END-EXEC.                                                    04019416
040195                                                                  04019516
040200*-----------------------------------------------------------------04020000
040300*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                04030000
040400*-----------------------------------------------------------------04040000
040500     EXEC SQL                                                     04050000
040600          INCLUDE SQLCA                                           04060000
040700     END-EXEC.                                                    04070000
040800                                                                  04080000
040900*-----------------------------------------------------------------04090000
041000 LINKAGE SECTION.                                                 04100000
041100*-----------------------------------------------------------------04110000
041200 01  DFHCOMMAREA.                                                 04120000
041300     05  FILLER                         OCCURS  1 TO 4072 TIMES   04130000
041400                                        DEPENDING ON EIBCALEN.    04140000
041500         10  FILLER                     PIC X.                    04150000
041600                                                                  04160000
041700*----------------------------------------------------------------*04170000
041800 PROCEDURE DIVISION.                                              04180000
041900*----------------------------------------------------------------*04190000
042000*  THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM.   *04200000
042100*  THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API    *04210000
042200*  MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.              *04220000
042300*                                                                *04230000
042400*  THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE    *04240000
042500*  LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.         *04250000
042600*----------------------------------------------------------------*04260000
042700 0000-MAIN-MODULE.                                                04270000
042800     INITIALIZE DP030-CICS-API-FIELDS.                            04280000
042900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04290000
043000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04300000
043100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04310000
043200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04320000
043300     MOVE LENGTH OF SU595AI        TO DP030-MAP-LENGTH (1).       04330000
043400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04340000
043500     PERFORM 0001-CALL-CICS-ARCH-API.                             04350000
043600                                                                  04360000
043700     PERFORM 1000-CONTROL-PROCESSING                              04370000
043800                                                                  04380000
043900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04390000
044000     PERFORM 0001-CALL-CICS-ARCH-API.                             04400000
044100                                                                  04410000
044200*----------------------------------------------------------------*04420000
044300 0001-CALL-CICS-ARCH-API.                                         04430000
044400*    CALL 'DPKCS030' USING DFHEIBLK                               04440025
044400     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04441025
044500                           DFHCOMMAREA                            04450000
044600                           DP030-CICS-API-FIELDS                  04460000
044700                           DP020-STANDARD-COMMAREA                04470000
044800                           SU595AI.                               04480000
044900                                                                  04490000
045000     IF  DP030-RC-CALL-SUCCESSFUL                                 04500000
045100         CONTINUE                                                 04510000
045200     ELSE                                                         04520000
045300         SET DP013-NO-ROLLBACK                                    04530000
045400             DP013-XCTL-DISPLAY-RESTART                           04540000
045500             DP013-CICS-ABEND      TO TRUE                        04550000
045600         MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH        04560000
045700*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL'                   04570025
045800*                                  TO DP013-MESSAGE-TEXT (2)      04580025
045700         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04581025
045800-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04582025
045900         MOVE  SPACES              TO DP013-MESSAGE-TEXT (3)      04590000
046000         STRING  'RETURN CODE - '     DELIMITED BY SIZE           04600000
046100                  DP030-RETURN-CODE   DELIMITED BY SIZE           04610000
046200                                 INTO DP013-MESSAGE-TEXT (3)      04620000
046300         PERFORM DP013-0000-PROCESS-ABEND                         04630000
046400     END-IF.                                                      04640000
046500                                                                  04650000
046600*----------------------------------------------------------------*04660000
046700*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *04670000
046800*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *04680000
046900*----------------------------------------------------------------*04690000
047000 1000-CONTROL-PROCESSING.                                         04700000
047100                                                                  04710000
047200     EVALUATE TRUE                                                04720000
047300         WHEN DP020-NEXT-ACT-INITIAL                              04730000
047400             INITIALIZE ASC-SPECIFIC-COMMAREA                     04740000
047500             MOVE EIBTRMID         TO ASC-SEL-TERM-ID             04750000
047600             MOVE DP020-SRC-TASK-NUMBER                           04760000
047700                                   TO ASC-SEL-TASK-NUMBER         04770000
047800             MOVE 2                TO ASC-SEL-SEQ                 04780000
047900             PERFORM 4000-BUILD-INITIAL-PANEL                     04790000
048000             PERFORM 3200-RESET-ATTRIBUTES                        04800000
048100                                                                  04810000
048200         WHEN DP020-NEXT-ACT-READ-MAP                             04820000
048400             PERFORM 2000-FKEY-PROCESSING                         04840000
048500                                                                  04850000
048600         WHEN DP020-NEXT-ACT-RETURN                               04860000
048700             INITIALIZE PV-USER-LOCATION                          04870000
048800             MOVE DP020-LOCATION-NBR      TO ASC-CURR-OPER-UNT-ID 04880000
048900                                             DK-CURR-OPER-UNT-ID  04890000
049000                                             AOPERO               04900000
049100             MOVE PC-FCLTY-ID-0001        TO ASC-CURR-FCLTY-ID    04910000
049200                                             DK-CURR-FCLTY-ID     04920000
049300                                             AFCLTYO              04930000
049400             PERFORM 7000-GET-STORE-NAME                          04940000
049500             MOVE ASC-OPER-UNIT-NAME      TO ANAMEO               04950000
049600                                                                  04960000
049700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04970000
049800             PERFORM 3200-RESET-ATTRIBUTES                        04980000
049900             SET DP030-SET-CURSOR-APPL-1   TO TRUE                04990000
050000             MOVE -1                       TO APOL                05000000
050100                                                                  05010000
050200         WHEN OTHER                                               05020000
050300             SET DP013-LOGIC-ABEND                                05030000
050400                 DP013-NO-ROLLBACK TO TRUE                        05040000
050500             MOVE 'SUKCS595 - 1000-CONTROL-PROCESSING'            05050000
050600                                   TO  DP013-PARAGRAPH            05060000
050700             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   05070000
050800                                   TO  DP013-MESSAGE-TEXT(1)      05080000
050900             MOVE DP020-NEXT-APPL-ACTIVITY                        05090000
051000                                   TO DP013-MESSAGE-TEXT(2)       05100000
051100             PERFORM DP013-0000-PROCESS-ABEND                     05110000
051200     END-EVALUATE.                                                05120000
051300                                                                  05130000
051400*----------------------------------------------------------------*05140000
051500* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*05150000
051600* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*05160000
051700* EDITS.                                                         *05170000
051800*----------------------------------------------------------------*05180000
051900 2000-FKEY-PROCESSING.                                            05190000
052000                                                                  05200000
052100     EVALUATE TRUE                                                05210000
052200                                                                  05220000
052300         WHEN DP020-SRC-AID = DP016-CLEAR                         05230000
052400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05240000
052500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05250000
052600                                                                  05260000
052700         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     05270000
052800             INITIALIZE ASC-SPECIFIC-COMMAREA                     05280000
052900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05290000
053000             PERFORM 4000-BUILD-INITIAL-PANEL                     05300000
053100             PERFORM 3200-RESET-ATTRIBUTES                        05310000
053200             MOVE -1  TO APOL                                     05320000
053300                                                                  05330000
053400         WHEN OTHER                                               05340000
053500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05350000
053600             PERFORM 2100-CHECK-FUNCTION-KEY                      05360000
053700                                                                  05370000
053800             IF  PS-NO-ERROR                                      05380000
053900                 SET DP030-CONTINUE-GO TO TRUE                    05390000
054000             ELSE                                                 05400000
054100                 SET DP030-OVERRIDE-GO TO TRUE                    05410000
054200             END-IF                                               05420000
054300     END-EVALUATE.                                                05430000
054400                                                                  05440000
054500*----------------------------------------------------------------*05450000
054600*  ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED      *05460000
054700*  FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED  *05470000
054800*  FROM THE CICS ARCHITECTURE API.                               *05480000
054900*----------------------------------------------------------------*05490000
055000 2100-CHECK-FUNCTION-KEY.                                         05500000
055100     EVALUATE TRUE                                                05510000
055200                                                                  05520000
055300* ENTER                                                           05530000
055400         WHEN DP020-SRC-AID = DP016-ENTER                         05540000
055500              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  05550000
055600              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05560000
055700              IF PS-NO-ERROR                                      05570000
055800                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             05580000
055900                  MOVE -1                     TO APOL             05590000
056000              END-IF                                              05600000
056100                                                                  05610000
056200* F16 - CHILD LIST   - LOCAL-FUNC-06                              05620000
056300         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              05630000
056400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05640000
056500             IF ASC-SML-NBR-X > ZERO                              05650000
056600                 IF ASC-CART-SRC-CDE  = 'MASTER CONTAINER'        05660000
056700/                  IF PV-SCAN-ON-TRIP-ID > 0                      05670000
056800/                      SET PS-ERROR                               05680000
056900/                          DP020-MSG-FATAL         TO TRUE        05690000
057000/                      MOVE PC-TSYMSG-03396    TO DP020-MSG-NUMBER05700000
057100/                      MOVE PV-SCAN-ON-TRIP-ID   TO DP020-MSG-TEXT05710000
057200/                      MOVE DP015-UNP-ALP-BRT-OFF  TO ASMLA       05720000
057300/                      MOVE DP015-RED              TO ASMLC       05730000
057400/                      MOVE DP015-REVERSE          TO ASMLH       05740000
057500/                      SET DP030-SET-CURSOR-APPL-1 TO TRUE        05750000
057600/                      MOVE -1                     TO ASMLL       05760000
057700/                  ELSE                                           05770000
057800* CHECKING IF IT IS DIVERTED AND IT IS NOT A SHUTTLE DOOR         05780000
057900/                  IF PV-DIVERT-DOOR > SPACE                      05790000
058000/                  AND PV-CHILDREN-COUNT = 0                      05800000
058100/                      SET PS-ERROR                               05810000
058200/                          DP020-MSG-FATAL         TO TRUE        05820000
058300/                      MOVE PC-TSYMSG-03397    TO DP020-MSG-NUMBER05830000
058400/                      MOVE PV-DIVERT-DOOR     TO DP020-MSG-TEXT  05840000
058500/                      MOVE DP015-UNP-ALP-BRT-OFF  TO ASMLA       05850000
058600/                      MOVE DP015-RED              TO ASMLC       05860000
058700/                      MOVE DP015-REVERSE          TO ASMLH       05870000
058800/                      SET DP030-SET-CURSOR-APPL-1 TO TRUE        05880000
058900/                      MOVE -1                     TO ASMLL       05890000
059000/                  ELSE                                           05900000
059100/                  IF PV-CHILDREN-COUNT = 0                       05910000
059200/                      SET PS-ERROR                               05920000
059300/                          DP020-MSG-FATAL         TO TRUE        05930000
059400/                      MOVE PC-TSYMSG-03386    TO DP020-MSG-NUMBER05940000
059500/                      MOVE DP015-UNP-ALP-BRT-OFF  TO ASMLA       05950000
059600/                      MOVE DP015-RED              TO ASMLC       05960000
059700/                      MOVE DP015-REVERSE          TO ASMLH       05970000
059800/                      SET DP030-SET-CURSOR-APPL-1 TO TRUE        05980000
059900/                      MOVE -1                     TO ASMLL       05990000
060000/                  ELSE                                           06000000
060100                       PERFORM 2110-PREPARE-INTER-APPL-COMM       06010000
060200/                  END-IF                                         06020000
060300/                  END-IF                                         06030000
060400/                  END-IF                                         06040000
060500                 ELSE                                             06050000
060600                   SET PS-ERROR                                   06060000
060700                       DP020-MSG-FATAL         TO TRUE            06070000
060800                   MOVE PC-TSYMSG-03387        TO DP020-MSG-NUMBER06080000
060900                   MOVE DP015-UNP-ALP-BRT-OFF  TO ASMLA           06090000
061000                   MOVE DP015-RED              TO ASMLC           06100000
061100                   MOVE DP015-REVERSE          TO ASMLH           06110000
061200                   SET DP030-SET-CURSOR-APPL-1 TO TRUE            06120000
061300                   MOVE -1                     TO ASMLL           06130000
061400                 END-IF                                           06140000
061500             ELSE                                                 06150000
061600                 SET PS-ERROR                                     06160000
061700                     DP020-MSG-FATAL         TO TRUE              06170000
061800                 MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER  06180000
061900                 MOVE DP015-UNP-ALP-BRT-OFF  TO ASMLA             06190000
062000                 MOVE DP015-RED              TO ASMLC             06200000
062100                 MOVE DP015-REVERSE          TO ASMLH             06210000
062200                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              06220000
062300                 MOVE -1                     TO ASMLL             06230000
062400             END-IF                                               06240000
062500                                                                  06250000
062600* F17 - PO LINE LIST - LOCAL-FUNC-01                              06260000
062700         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06270000
062800             IF ((ASC-PO-NBR   = SPACES OR ZEROS) AND             06280000
062900                 (ASC-RCVR-NBR = SPACES OR ZEROS))                06290000
063000                 SET PS-ERROR                                     06300000
063100                     DP020-MSG-FATAL         TO TRUE              06310000
063200                 MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER  06320000
063300                 MOVE DP015-UNP-ALP-BRT-OFF  TO APOA              06330000
063400                                                ARCVRA            06340000
063500                 MOVE DP015-RED              TO APOC              06350000
063600                                                ARCVRC            06360000
063700                 MOVE DP015-REVERSE          TO APOH              06370000
063800                                                ARCVRH            06380000
063900                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              06390000
064000                 MOVE -1                     TO APOL              06400000
064100             ELSE                                                 06410000
064200                 IF ASC-PO-NBR = SPACES OR ZEROS                  06420000
064300                     SET PS-ERROR                                 06430000
064400                         DP020-MSG-FATAL         TO TRUE          06440000
064500                     MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER   06450000
064600                     MOVE DP015-UNP-ALP-BRT-OFF  TO APOA          06460000
064700                     MOVE DP015-RED              TO APOC          06470000
064800                     MOVE DP015-REVERSE          TO APOH          06480000
064900                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          06490000
065000                     MOVE -1                     TO APOL          06500000
065100                 ELSE                                             06510000
065200                     IF ASC-RCVR-NBR = SPACES OR ZEROS            06520000
065300                         SET PS-ERROR                             06530000
065400                             DP020-MSG-FATAL         TO TRUE      06540000
065500                         MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER 06550000
065600                         MOVE DP015-UNP-ALP-BRT-OFF  TO ARCVRA    06560000
065700                         MOVE DP015-RED              TO ARCVRC    06570000
065800                         MOVE DP015-REVERSE          TO ARCVRH    06580000
065900                         SET DP030-SET-CURSOR-APPL-1 TO TRUE      06590000
066000                         MOVE -1                     TO ARCVRL    06600000
066100                     END-IF                                       06610000
066200                 END-IF                                           06620000
066300             END-IF                                               06630000
066400             IF PS-NO-ERROR                                       06640000
066500                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               06650000
066600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06660000
066700                 PERFORM 2110-PREPARE-INTER-APPL-COMM             06670000
066800             END-IF                                               06680000
066900                                                                  06690000
067000* F22 - CARTON DETAIL LIST - LOCAL-FUNC-02                        06700000
067100         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              06710000
067200* F24 - CARTON MANIFEST RPT - LOCAL-FUNC-05                       06720000
067300         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              06730000
067400* F18 - SM CRTN PACKED DETAIL                                     06740000
067500         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              06750000
067600* F14 - SML CARTON FLOW LIST                                      06760011
067700         WHEN DP020-FK-LOCAL-FUNC-08 (DP020-SRC-AID)              06770011
067800             IF ASC-SML-NBR = SPACES OR ZEROS                     06780000
067900                 SET PS-ERROR                                     06790000
068000                     DP020-MSG-FATAL         TO TRUE              06800000
068100                 MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER  06810000
068200                 MOVE DP015-UNP-ALP-BRT-OFF  TO ASMLA             06820000
068300                 MOVE DP015-RED              TO ASMLC             06830000
068400                 MOVE DP015-REVERSE          TO ASMLH             06840000
068500                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              06850000
068600                 MOVE -1                     TO ASMLL             06860000
068700             END-IF                                               06870000
068800             IF PS-NO-ERROR                                       06880000
068900                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               06890000
069000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06900000
069100                 PERFORM 2110-PREPARE-INTER-APPL-COMM             06910000
069200             END-IF                                               06920000
069300                                                                  06930000
069400* F23 - PO CARTON LIST - LOCAL-FUNC-03                            06940000
069500         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              06950000
069600             IF ((ASC-PO-NBR   = SPACES OR ZEROS) AND             06960000
069700                 (ASC-RCVR-NBR = SPACES OR ZEROS))                06970000
070000                 SET PS-ERROR                                     07000000
070100                     DP020-MSG-FATAL         TO TRUE              07010000
070200                 MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER  07020000
070300                 MOVE DP015-UNP-ALP-BRT-OFF  TO APOA              07030000
070400                                                ARCVRA            07040000
070500                                                ALINEA            07050000
070600                 MOVE DP015-RED              TO APOC              07060000
070700                                                ARCVRC            07070000
070800                                                ALINEC            07080000
070900                 MOVE DP015-REVERSE          TO APOH              07090000
071000                                                ARCVRH            07100000
071100                                                ALINEH            07110000
071200                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07120000
071300                 MOVE -1                     TO APOL              07130000
071400             ELSE                                                 07140000
071500                 IF ASC-PO-NBR = SPACES OR ZEROS                  07150000
071600                     SET PS-ERROR                                 07160000
071700                         DP020-MSG-FATAL     TO TRUE              07170000
071800                     MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER  07180000
071900                     MOVE DP015-UNP-ALP-BRT-OFF  TO APOA          07190000
072000                     MOVE DP015-RED          TO APOC              07200000
072100                     MOVE DP015-REVERSE      TO APOH              07210000
072200                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          07220000
072300                     MOVE -1                 TO APOL              07230000
072400                 ELSE                                             07240000
072500                     IF ASC-RCVR-NBR = SPACES OR ZEROS            07250000
072600                         SET PS-ERROR                             07260000
072700                             DP020-MSG-FATAL         TO TRUE      07270000
072800                         MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER 07280000
072900                         MOVE DP015-UNP-ALP-BRT-OFF  TO ARCVRA    07290000
073000                         MOVE DP015-RED              TO ARCVRC    07300000
073100                         MOVE DP015-REVERSE          TO ARCVRH    07310000
073200                         SET DP030-SET-CURSOR-APPL-1 TO TRUE      07320000
073300                         MOVE -1                     TO ARCVRL    07330000
074600                     END-IF                                       07460000
074700                 END-IF                                           07470000
074800             END-IF                                               07480000
074900             IF PS-NO-ERROR                                       07490000
075000                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               07500000
075100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07510000
075200                 PERFORM 2110-PREPARE-INTER-APPL-COMM             07520000
075300             END-IF                                               07530000
075400                                                                  07540000
075500* F21 - CARTON PKD QUERY - LOCAL-FUNC-07                          07550000
075600         WHEN DP020-FK-LOCAL-FUNC-07 (DP020-SRC-AID)              07560000
075700             IF (ASC-PO-NBR   = SPACES OR ZEROS)                  07570000
075800                 SET PS-ERROR                                     07580000
075900                     DP020-MSG-FATAL         TO TRUE              07590000
076000                 MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER  07600000
076100                 MOVE DP015-UNP-ALP-BRT-OFF  TO APOA              07610000
076200                 MOVE DP015-RED              TO APOC              07620000
076300                 MOVE DP015-REVERSE          TO APOH              07630000
076400                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07640000
076500                 MOVE -1                     TO APOL              07650000
076600             END-IF                                               07660000
076700             IF PS-NO-ERROR                                       07670000
076800                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               07680000
076900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07690000
077000                 PERFORM 9000-SUBMIT-REQUEST                      07700000
077100                 MOVE PC-TSYMSG-03700        TO DP020-MSG-NUMBER  07710000
077200             END-IF                                               07720000
077300* OTHER                                                           07730000
077400         WHEN OTHER                                               07740000
077500              SET DP013-NO-ROLLBACK                               07750000
077600                  DP013-XCTL-DISPLAY-RESTART                      07760000
077700                  DP013-CICS-ABEND  TO TRUE                       07770000
077800              MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH   07780000
077900              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'     07790000
078000                                   TO DP013-MESSAGE-TEXT (1)      07800000
078100              MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:'07810000
078200                                   TO DP013-MESSAGE-TEXT (2)      07820000
078300              MOVE DP020-SRC-AID    TO PM-A-SRC-AID               07830000
078400              MOVE DP020-FK-ACTION (DP020-SRC-AID)                07840000
078500                                    TO PM-A-FK-ACTION             07850000
078600              MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)             07860000
078700                                    TO PM-A-FK-DISPN              07870000
078800              MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)     07880000
078900              MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'       07890000
079000                                    TO DP013-MESSAGE-TEXT (4)     07900000
079100              PERFORM DP013-0000-PROCESS-ABEND                    07910000
079200     END-EVALUATE.                                                07920000
079300                                                                  07930000
079400*----------------------------------------------------------------*07940000
079500*  MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE    *07950000
079600*  INTER-APPLICATION COMMAREA.                                   *07960000
079700*----------------------------------------------------------------*07970000
079800 2110-PREPARE-INTER-APPL-COMM.                                    07980000
079900                                                                  07990000
080000     INITIALIZE SU008-INTER-APPL-COMMAREA                         08000000
080100     MOVE ASC-CURR-OPER-UNT-ID-N      TO SU008-OPER-UNT-ID        08010000
080200     MOVE ASC-PO-NBR                  TO SU008-PO-NBR             08020000
080300     MOVE ASC-RCVR-NBR                TO SU008-RCVR-NBR           08030000
080400                                                                  08040006
080500     MOVE SPACES                      TO SU008-REQUEST-TYPE.      08050006
080700     IF ASC-RCVR-NBR = 'CS'                                       08070006
080800         MOVE 0                       TO SU008-RCVR-NBR           08080006
080900         SET  SU008-CS-PULL-TRAN      TO TRUE                     08090006
081000     END-IF.                                                      08100006
081200                                                                  08120004
081400     IF ASC-RCVR-NBR = 'FX'                                       08140004
081500         MOVE 0                       TO SU008-RCVR-NBR           08150004
081600         SET  SU008-FX-FAST-TRANSFER  TO TRUE                     08160006
081700     END-IF.                                                      08170004
081900                                                                  08190004
082000     MOVE ASC-LINE-NBR                TO SU008-LINE-NBR           08200000
082100     MOVE ASC-STR-NBR                 TO SU008-DEST-STR-NBR       08210000
082200     MOVE ASC-CART-SRC                TO SU008-CREATE-ID          08220000
082300     IF ASC-ZEROES = ZEROES                                       08230000
082400         MOVE ASC-SML-NBR             TO SU008-SML-NBR            08240000
082500     ELSE                                                         08250000
082600         MOVE ASC-SML-NBR-A           TO SU008-SML-NBR            08260000
082700     END-IF.                                                      08270000
082800                                                                  08280023
082900*----------------------------------------------------------------*08290000
083000* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*08300000
083100* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *08310000
083200* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *08320000
083300*----------------------------------------------------------------*08330000
083400 2200-MOVE-SCREEN-TO-COMMAREA.                                    08340000
083500                                                                  08350000
083600* OPER/FACILITY ID                                                08360000
083700     IF  AOPERL  > ZERO                                           08370000
083800         MOVE AOPERI               TO ASC-CURR-OPER-UNT-ID        08380000
083900                                      DK-CURR-OPER-UNT-ID         08390000
084000         MOVE PC-FCLTY-ID-0001     TO ASC-CURR-FCLTY-ID           08400000
084100                                      DK-CURR-FCLTY-ID            08410000
084200     ELSE                                                         08420000
084300         IF  ASC-CURR-OPER-UNT-ID-N < ZERO                        08430000
084400             MOVE SPACES           TO ASC-CURR-OPER-UNT-ID        08440000
084500             MOVE SPACES           TO ASC-CURR-FCLTY-ID           08450000
084600         END-IF                                                   08460000
084700     END-IF.                                                      08470000
084800                                                                  08480000
084900* PURCHASE ORDER NUMBER                                           08490000
085000     IF  APOL  > ZERO                                             08500000
085100         MOVE APOI                 TO ASC-PO-NBR                  08510000
085200     ELSE                                                         08520000
085300         IF  APOF  = DP015-ERASE-EOF                              08530000
085400             MOVE SPACES           TO ASC-PO-NBR                  08540000
085500         END-IF                                                   08550000
085600     END-IF.                                                      08560000
085700                                                                  08570000
085800* RECEIVER NUMBER                                                 08580000
085900     IF  ARCVRL > ZERO                                            08590000
086000         MOVE ARCVRI           TO ASC-RCVR-NBR                    08600000
086100     ELSE                                                         08610000
086200         IF  ARCVRF = DP015-ERASE-EOF                             08620000
086300             MOVE SPACES       TO ASC-RCVR-NBR                    08630000
086400         END-IF                                                   08640000
086500     END-IF.                                                      08650000
086600                                                                  08660000
086700* LINE NUMBER                                                     08670000
086800     IF  ALINEL > ZERO                                            08680000
086900         MOVE ALINEI           TO ASC-LINE-NBR                    08690000
087000     ELSE                                                         08700000
087100         IF  ALINEF =  DP015-ERASE-EOF                            08710000
087200             MOVE SPACES       TO ASC-LINE-NBR                    08720000
087300         END-IF                                                   08730000
087400     END-IF.                                                      08740000
087500                                                                  08750000
087600* STORE NUMBER                                                    08760000
087700     IF  ASTOREL > ZERO                                           08770000
087800         MOVE ASTOREI           TO ASC-STR-NBR                    08780000
087900     ELSE                                                         08790000
088000         IF  ASTOREF = DP015-ERASE-EOF                            08800000
088100             MOVE SPACES        TO ASC-STR-NBR                    08810000
088200         END-IF                                                   08820000
088300     END-IF.                                                      08830000
088400                                                                  08840000
088500* SML NUMBER                                                      08850000
088600     IF  ASMLL > ZERO                                             08860000
088700         MOVE ASMLI            TO ASC-SML-NBR-X                   08870000
088800     ELSE                                                         08880000
088900         IF  ASMLF = DP015-ERASE-EOF                              08890000
089000             MOVE SPACES       TO ASC-SML-NBR-X                   08900000
089100         END-IF                                                   08910000
089200     END-IF.                                                      08920000
089300                                                                  08930000
089400*----------------------------------------------------------------*08940000
089500* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *08950000
089600* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *08960000
089700* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*08970000
089800* IN THE DESTINATION PROGRAM, NOT HERE.                          *08980000
089900*----------------------------------------------------------------*08990000
090000 3000-EDIT-DATA-IN-COMMAREA.                                      09000000
090100                                                                  09010000
090200*-----------------------------------------------------------------09020000
090300* VERIFY THAT PO NUMBER IS NUMERIC                                09030000
090400*-----------------------------------------------------------------09040000
090500     IF  ASC-PO-NBR >  SPACES                                     09050000
090600         MOVE ASC-PO-NBR             TO DP010I-UNEDITED-FIELD     09060000
090700         MOVE LENGTH OF ASC-PO-NBR   TO DP010I-MAXIMUM-DIGITS     09070000
090800         MOVE ZERO                   TO DP010I-MAXIMUM-DECIMALS   09080000
090900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  09090000
091000         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09100023
091010              USING DP010I-NUMERIC-EDIT-AREA                      09101023
091100         IF  DP010I-ERROR-DETECTED                                09110000
091200             SET PS-ERROR                                         09120000
091300                 DP020-MSG-FATAL         TO TRUE                  09130000
091400             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      09140000
091500             MOVE DP015-UNP-ALP-BRT-OFF  TO APOA                  09150000
091600             MOVE DP015-RED              TO APOC                  09160000
091700             MOVE DP015-REVERSE          TO APOH                  09170000
091800             MOVE -1                     TO APOL                  09180000
091900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09190000
092000         ELSE                                                     09200000
092100             MOVE DP010I-NUMERIC-FIELD TO ASC-PO-NBR-N            09210000
092200         END-IF                                                   09220000
092300     ELSE                                                         09230000
092400         MOVE SPACES TO ASC-PO-NBR                                09240000
092500     END-IF.                                                      09250000
092600                                                                  09260000
092700     SET  ASC-PO-RCVR-REQ  TO  TRUE.                              09270007
092900*-----------------------------------------------------------------09290000
093000* VERIFY THAT RCVR NUMBER IS NUMERIC                              09300000
093100*        OR THAT IT CONTAINS THE VALUE 'CS'                       09310000
093200*        OR THAT IT CONTAINS THE VALUE 'FX'                       09320004
093300*-----------------------------------------------------------------09330000
093400* CENTRAL STOCK PULL TRANS DO NOT HAVE A RECEIVER NUMBER          09340000
093500     IF  ASC-RCVR-NBR = 'CS  '                                    09350000
093600     OR  ASC-RCVR-NBR = ' CS '                                    09360000
093700     OR  ASC-RCVR-NBR = '  CS'                                    09370000
093800         SET PS-CS-PULL-TRAN           TO TRUE                    09380000
093900         INITIALIZE                    DCLTRECEIV                 09390000
094000         MOVE SPACES                   TO PV-VERIFY-DATE          09400000
094100         MOVE SPACES                   TO PV-PURGE-DATE           09410000
094200         MOVE 'CS  '                   TO ASC-RCVR-NBR            09420000
094300         SET  ASC-CS-PULL-REQ          TO TRUE                    09430007
094400     END-IF.                                                      09440000
094600                                                                  09460004
094700* FAST TRANSFER DO NOT HAVE A RECEIVER NUMBER                     09470004
094900     IF  ASC-RCVR-NBR = 'FX  '                                    09490004
095000     OR  ASC-RCVR-NBR = ' FX '                                    09500004
095100     OR  ASC-RCVR-NBR = '  FX'                                    09510004
095200         SET PS-FX-FAST-TRANSFER       TO TRUE                    09520004
095300         INITIALIZE                    DCLTRECEIV                 09530004
095400         MOVE SPACES                   TO PV-VERIFY-DATE          09540004
095500         MOVE SPACES                   TO PV-PURGE-DATE           09550004
095600         MOVE 'FX  '                   TO ASC-RCVR-NBR            09560004
095700         SET  ASC-FX-FAST-REQ          TO  TRUE                   09570007
095800     END-IF.                                                      09580004
096000                                                                  09600000
096100     IF  ASC-RCVR-NBR >  SPACES                                   09610000
096300     AND PS-NOT-CS-PULL-TRAN                                      09630000
096400     AND PS-NOT-FX-FAST-TRANSFER                                  09640004
096500         MOVE ASC-RCVR-NBR             TO DP010I-UNEDITED-FIELD   09650000
096600         MOVE LENGTH OF ASC-RCVR-NBR   TO DP010I-MAXIMUM-DIGITS   09660000
096700         MOVE ZERO                     TO DP010I-MAXIMUM-DECIMALS 09670000
096800         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  09680000
096900         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09690023
096910              USING DP010I-NUMERIC-EDIT-AREA                      09691023
097000         IF  DP010I-ERROR-DETECTED                                09700000
097100             SET PS-ERROR                                         09710000
097200                 DP020-MSG-FATAL         TO TRUE                  09720000
097300             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      09730000
097400             MOVE DP015-UNP-ALP-BRT-OFF  TO ARCVRA                09740000
097500             MOVE DP015-RED              TO ARCVRC                09750000
097600             MOVE DP015-REVERSE          TO ARCVRH                09760000
097700             MOVE -1                     TO ARCVRL                09770000
097800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09780000
097900         ELSE                                                     09790000
098000             MOVE DP010I-NUMERIC-FIELD TO ASC-RCVR-NBR-N          09800000
098100         END-IF                                                   09810000
098600     END-IF.                                                      09860000
098700                                                                  09870000
098800*-----------------------------------------------------------------09880000
098900* VERIFY THAT LINE NUMBER IS NUMERIC                              09890000
099000*-----------------------------------------------------------------09900000
099100     IF  ASC-LINE-NBR >  SPACES                                   09910000
099200         MOVE ASC-LINE-NBR             TO DP010I-UNEDITED-FIELD   09920000
099300         MOVE LENGTH OF ASC-LINE-NBR   TO DP010I-MAXIMUM-DIGITS   09930000
099400         MOVE ZERO                     TO DP010I-MAXIMUM-DECIMALS 09940000
099500         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  09950000
099600         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09960023
099610              USING DP010I-NUMERIC-EDIT-AREA                      09961023
099700         IF  DP010I-ERROR-DETECTED                                09970000
099800             SET PS-ERROR                                         09980000
099900                 DP020-MSG-FATAL         TO TRUE                  09990000
100000             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      10000000
100100             MOVE DP015-UNP-ALP-BRT-OFF  TO ALINEA                10010000
100200             MOVE DP015-RED              TO ALINEC                10020000
100300             MOVE DP015-REVERSE          TO ALINEH                10030000
100400             MOVE -1                     TO ALINEL                10040000
100500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10050000
100600         ELSE                                                     10060000
100700             MOVE DP010I-NUMERIC-FIELD TO ASC-LINE-NBR-N          10070000
100800         END-IF                                                   10080000
100900     ELSE                                                         10090000
101000         MOVE SPACES TO ASC-LINE-NBR                              10100000
101100     END-IF.                                                      10110000
101200                                                                  10120000
101300*-----------------------------------------------------------------10130000
101400* VERIFY THAT STORE NUMBER IS NUMERIC                             10140000
101500*-----------------------------------------------------------------10150000
101600     IF  ASC-STR-NBR > SPACES                                     10160000
101700         MOVE ASC-STR-NBR            TO DP010I-UNEDITED-FIELD     10170000
101800         MOVE LENGTH OF ASC-STR-NBR  TO DP010I-MAXIMUM-DIGITS     10180000
101900         MOVE ZERO                     TO DP010I-MAXIMUM-DECIMALS 10190000
102000         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  10200000
102100         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10210023
102110              USING DP010I-NUMERIC-EDIT-AREA                      10211023
102200         IF  DP010I-ERROR-DETECTED                                10220000
102300             SET PS-ERROR                                         10230000
102400                 DP020-MSG-FATAL         TO TRUE                  10240000
102500             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      10250000
102600             MOVE DP015-UNP-ALP-BRT-OFF  TO ASTOREA               10260000
102700             MOVE DP015-RED              TO ASTOREC               10270000
102800             MOVE DP015-REVERSE          TO ASTOREH               10280000
102900             MOVE -1                     TO ASTOREL               10290000
103000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10300000
103100         ELSE                                                     10310000
103200             MOVE DP010I-NUMERIC-FIELD TO ASC-STR-NBR-N           10320000
103300         END-IF                                                   10330000
103400     ELSE                                                         10340000
103500         MOVE SPACES TO ASC-STR-NBR                               10350000
103600     END-IF.                                                      10360000
103700                                                                  10370000
103800*-----------------------------------------------------------------10380000
103900* GET NUMBER OF WEEKS OUTBOUND CARTONS HAVE BEEN PURGED           10390000
104000* BYPASS THESE EDITS FOR CS PULL TRANSACTIONS                     10400000
104200*-----------------------------------------------------------------10420000
104300     IF  PS-NO-ERROR                                              10430000
104500     AND PS-NOT-CS-PULL-TRAN                                      10450000
104600     AND PS-NOT-FX-FAST-TRANSFER                                  10460004
104700         PERFORM 3160-GET-PURGE-WKS                               10470000
104800     END-IF.                                                      10480000
104900                                                                  10490000
105000*-----------------------------------------------------------------10500000
105100* VERIFY THAT THE PURCHASE ORDER AND RCVR NUMBER EXIST            10510000
105200*-----------------------------------------------------------------10520000
105300     IF  PS-NO-ERROR                                              10530000
105500     AND PS-NOT-CS-PULL-TRAN                                      10550000
105600     AND PS-NOT-FX-FAST-TRANSFER                                  10560004
105700         IF ASC-PO-NBR-N > ZERO AND ASC-RCVR-NBR-N > ZERO         10570000
105800             PERFORM 3110-VALIDATE-PO-RCVR-NBR                    10580000
105900         END-IF                                                   10590000
106000     END-IF.                                                      10600000
106100                                                                  10610000
106200*-----------------------------------------------------------------10620000
106300* CHECK IF PO-RECEIVER IS VERIFIED PRIOR TO OUTBOUND PURGE DATE   10630000
106500*-----------------------------------------------------------------10650000
106600     IF  PS-NO-ERROR                                              10660000
106800     AND PS-NOT-CS-PULL-TRAN                                      10680000
106900     AND PS-NOT-FX-FAST-TRANSFER                                  10690004
107000         IF  RECEIV-STATUS-CDE  = 'VE'  AND                       10700000
107100             PV-VERIFY-DATE < PV-PURGE-DATE                       10710000
107200             SET PS-ERROR                                         10720000
107300                 DP020-MSG-FATAL         TO TRUE                  10730000
107400             MOVE DK-PURGE-WEEKS         TO PV-PURGE-WEEKS        10740000
107500             MOVE PV-PURGE-WEEKS         TO DP020-MSG-TEXT        10750000
107600             MOVE PC-TSYMSG-03101        TO DP020-MSG-NUMBER      10760000
107700             MOVE DP015-UNP-ALP-BRT-OFF  TO APOA                  10770000
107800                                            ARCVRA                10780000
107900             MOVE DP015-RED              TO APOC                  10790000
108000                                            ARCVRC                10800000
108100             MOVE DP015-REVERSE          TO APOH                  10810000
108200                                            ARCVRH                10820000
108300             MOVE -1                     TO APOL                  10830000
108400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10840000
108500     END-IF.                                                      10850000
108600                                                                  10860000
108700*-----------------------------------------------------------------10870000
108800* VERIFY THAT THE PURCHASE ORDER, RCVR AND LINE NUMBER EXIST      10880000
108900*-----------------------------------------------------------------10890000
109000     IF  PS-NO-ERROR                                              10900000
109200     AND PS-NOT-CS-PULL-TRAN                                      10920000
109300     AND PS-NOT-FX-FAST-TRANSFER                                  10930004
109400         IF ASC-PO-NBR-N > ZERO AND ASC-RCVR-NBR-N > ZERO         10940000
109500            AND ASC-LINE-NBR-N > ZERO                             10950000
109600             PERFORM 3120-VALIDATE-PO-RCVR-LINE-NBR               10960000
109700         END-IF                                                   10970000
109800     END-IF.                                                      10980000
109900                                                                  10990000
110000*-----------------------------------------------------------------11000000
110100* VERIFY THAT THE PURCHASE ORDER, RCVR, LINE AND STORE NBR EXIST  11010000
110200*-----------------------------------------------------------------11020000
110300     IF  PS-NO-ERROR                                              11030000
110500     AND PS-NOT-CS-PULL-TRAN                                      11050000
110600     AND PS-NOT-FX-FAST-TRANSFER                                  11060004
110700         IF ASC-PO-NBR-N > ZERO AND ASC-RCVR-NBR-N > ZERO         11070000
110800            AND ASC-LINE-NBR-N > ZERO AND ASC-STR-NBR-N > ZERO    11080000
110900             PERFORM 3130-VALIDATE-PORCVR-LINESTR                 11090000
111000         END-IF                                                   11100000
111100     END-IF.                                                      11110000
111200                                                                  11120000
111300*-----------------------------------------------------------------11130000
111400* VERIFY THAT THE PURCHASE ORDER, RCVR, AND STORE NUMBER EXIST    11140000
111500*-----------------------------------------------------------------11150000
111600     IF  PS-NO-ERROR                                              11160000
111800     AND PS-NOT-CS-PULL-TRAN                                      11180000
111900     AND PS-NOT-FX-FAST-TRANSFER                                  11190004
112000         IF ASC-PO-NBR-N > ZERO AND ASC-RCVR-NBR-N > ZERO         11200000
112100            AND ASC-STR-NBR-N > ZERO                              11210000
112200             PERFORM 3140-VALIDATE-PORCVR-STORE                   11220000
112300         END-IF                                                   11230000
112400     END-IF.                                                      11240000
112500                                                                  11250000
112600*-----------------------------------------------------------------11260000
112700* VALIDATE SML NUMBER                                             11270000
112800*-----------------------------------------------------------------11280000
112900     MOVE SPACES      TO ASC-CART-SRC-CDE.                        11290000
113000     IF  PS-NO-ERROR                                              11300000
113100         IF ASC-SML-NBR-X > ZERO                                  11310000
113200             PERFORM 3150-VALIDATE-SML-NBR                        11320000
113300             MOVE  SUT00024-CART-SRC-CDE   TO ASC-CART-SRC        11330000
113400             EVALUATE SUT00024-CART-SRC-CDE                       11340000
113500                 WHEN 'ASN'                                       11350000
113600                   MOVE 'CHECK-IN'         TO ASC-CART-SRC-CDE    11360000
113700                 WHEN 'CPS'                                       11370000
113800                   MOVE 'CASEPACK SPLIT'   TO ASC-CART-SRC-CDE    11380000
113900                 WHEN 'DMG'                                       11390000
114000                   MOVE 'DAMAGED CARTON'   TO ASC-CART-SRC-CDE    11400000
114100                 WHEN 'FXR'                                       11410000
114200                   MOVE 'FAST-TRANSFER'    TO ASC-CART-SRC-CDE    11420000
114300                 WHEN 'JWL'                                       11430000
114400                   MOVE 'JEWELRY'          TO ASC-CART-SRC-CDE    11440000
114500                 WHEN 'MSC'                                       11450000
114600                   MOVE 'MISCELLANEOUS'    TO ASC-CART-SRC-CDE    11460000
114700                 WHEN 'MST'                                       11470000
114800                   MOVE 'MASTER CONTAINER' TO ASC-CART-SRC-CDE    11480000
114900                 WHEN 'P2L'                                       11490000
115000                   MOVE 'PACK-TO-LIGHT'    TO ASC-CART-SRC-CDE    11500000
115100                 WHEN 'RCV'                                       11510000
115200                   MOVE 'RECEIVING'        TO ASC-CART-SRC-CDE    11520000
115300                 WHEN 'RDM'                                       11530000
115400                   MOVE 'RDM'              TO ASC-CART-SRC-CDE    11540000
115500                 WHEN 'SMO'                                       11550000
115600                   MOVE 'SMOOTHING'        TO ASC-CART-SRC-CDE    11560000
115601                 WHEN '3WD'                                       11560123
115602                   MOVE '3RD PRTY WHSE DISTRO'                    11560224
115603                                           TO ASC-CART-SRC-CDE    11560324
115610                 WHEN OTHER                                       11561014
115620                   MOVE 'UNKNOWN'          TO ASC-CART-SRC-CDE    11562014
115700             END-EVALUATE                                         11570000
115800             IF SUT00024-CART-SRC-CDE = 'MST'                     11580000
115900                 PERFORM 3155-COUNT-FOR-CHILDREN                  11590000
116000             END-IF                                               11600000
116100         END-IF                                                   11610000
116200     END-IF.                                                      11620000
116300                                                                  11630000
116400                                                                  11640004
116500*-----------------------------------------------------------------11650004
116600* FOR FAST TRANSFER THE FOLLOWING ARE REQUIRED                    11660004
116700*    - PO NUMBER CONTAINS THE 6 DIGIT TRANSFER NUMBER             11670004
116800*    - RECEIVER  CONTAINS FX INDICATING FAST TRANSFER             11680004
116900*    - STORE NUMBER  CONTAINS THE STORE THE TRANSFER IS TO        11690004
117000*-----------------------------------------------------------------11700004
117100     IF  PS-NO-ERROR  AND                                         11710005
117200         ASC-FX-FAST-REQ                                          11720007
117300         IF  ASC-PO-NBR-N > ZERO AND                              11730004
117400             ASC-STR-NBR-N > ZERO                                 11740004
117500             CONTINUE                                             11750004
117600         ELSE                                                     11760004
117700             SET PS-ERROR                                         11770004
117800                 DP020-MSG-FATAL         TO TRUE                  11780004
117900             MOVE PC-TSYMSG-03704        TO DP020-MSG-NUMBER      11790004
118000             MOVE DP015-UNP-ALP-BRT-OFF  TO APOA                  11800004
118100             MOVE DP015-RED              TO APOC                  11810004
118200             MOVE DP015-REVERSE          TO APOH                  11820004
118300             MOVE -1                     TO APOL                  11830004
118400             MOVE DP015-UNP-ALP-BRT-OFF  TO ARCVRA                11840004
118500             MOVE DP015-RED              TO ARCVRC                11850004
118600             MOVE DP015-REVERSE          TO ARCVRH                11860004
118700             MOVE DP015-UNP-ALP-BRT-OFF  TO ASTOREA               11870004
118800             MOVE DP015-RED              TO ASTOREC               11880004
118900             MOVE DP015-REVERSE          TO ASTOREH               11890004
119000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11900004
119100         END-IF                                                   11910004
119200     END-IF.                                                      11920004
119300                                                                  11930004
119310*-----------------------------------------------------------------11931016
119320* GET STORE SCAN INFORMATION IF THE SML HAS BEEN ENTERED.         11932016
119330*-----------------------------------------------------------------11933016
119340     MOVE SPACES      TO  ASC-STORE-SCAN                          11934016
119341                          ASC-STORE-SCAN-DATE                     11934116
119342                          ASC-STORE-SCAN-TIME                     11934216
119343                          ASC-STORE-SCAN-MULT.                    11934316
119344     MOVE ZEROES      TO  ASC-STORE-SCAN-COUNT                    11934416
119346                                                                  11934616
119350     IF  PS-NO-ERROR                                              11935016
119360         IF ASC-SML-NBR-X > ZERO                                  11936016
119370             PERFORM 3170-CHECK-STORE-SCAN                        11937016
119371         END-IF                                                   11937116
119372     END-IF.                                                      11937216
119373                                                                  11937316
119430                                                                  11943004
119500*---------------------------------------------------------------* 11950000
119600*  VALIDATE PURCHASE ORDER AND RCVR NUMBER                        11960000
119700*---------------------------------------------------------------* 11970000
119800 3110-VALIDATE-PO-RCVR-NBR.                                       11980000
119900     MOVE ASC-PO-NBR-N    TO DK-PO-NUMBER.                        11990000
120000     MOVE ASC-RCVR-NBR-N  TO DK-RCVR-NUMBER.                      12000000
120100     EXEC SQL                                                     12010000
120200              SELECT  ORD_NBR                                     12020000
120300                     ,REC_SEQ_NBR                                 12030000
120400                     ,STATUS_CDE                                  12040000
120500                     ,DATE(VERFYD_TMST)                           12050000
120600                INTO :RECEIV-ORD-NBR                              12060000
120700                    ,:RECEIV-REC-SEQ-NBR                          12070000
120800                    ,:RECEIV-STATUS-CDE                           12080000
120900                    ,:PV-VERIFY-DATE                              12090000
121000                FROM  TRECEIV                                     12100000
121100               WHERE  ORD_NBR        = :DK-PO-NUMBER              12110000
121200                 AND  REC_SEQ_NBR    = :DK-RCVR-NUMBER            12120000
121300                 AND  VER_STATUS_CDE = :PC-A                      12130000
121400     END-EXEC.                                                    12140000
121500                                                                  12150000
121600      EVALUATE TRUE                                               12160000
121700          WHEN SQLCODE = +0                                       12170000
121800          WHEN SQLCODE = -811                                     12180000
121900               CONTINUE                                           12190000
122000          WHEN SQLCODE = +100                                     12200000
122100               SET PS-ERROR                                       12210000
122200                   DP020-MSG-FATAL       TO TRUE                  12220000
122300               MOVE PC-TSYMSG-00954      TO DP020-MSG-NUMBER      12230000
122400               MOVE DP015-UNP-ALP-BRT-OFF TO APOA                 12240000
122500                                            ARCVRA                12250000
122600               MOVE DP015-RED            TO APOC                  12260000
122700                                            ARCVRC                12270000
122800               MOVE DP015-REVERSE        TO APOH                  12280000
122900                                            ARCVRH                12290000
123000               MOVE -1                   TO APOL                  12300000
123100               SET DP030-SET-CURSOR-APPL-1 TO TRUE                12310000
123200          WHEN OTHER                                              12320000
123300              MOVE '3110-VALIDATE-PO-RCVR-NBR' TO DP013-PARAGRAPH 12330000
123400               MOVE 'VERIFY PURCHASE ORDER NUMBER'                12340000
123500                                   TO DP013-MESSAGE-TEXT (1)      12350000
123600               STRING 'PO NUMBER-'      DELIMITED BY SIZE         12360000
123700                      ASC-PO-NBR        DELIMITED BY SIZE         12370000
123800                      'RCVR NUMBER-'    DELIMITED BY SIZE         12380000
123900                      ASC-RCVR-NBR      DELIMITED BY SIZE         12390000
124000                                 INTO DP013-MESSAGE-TEXT (2)      12400000
124100                  MOVE SQLCA   TO DP013-SQLCA                     12410000
124200                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     12420000
124300                  SET DP013-DB2-ABEND                             12430000
124400                      DP013-XCTL-DISPLAY-RESTART TO TRUE          12440000
124500                  PERFORM DP013-0000-PROCESS-ABEND                12450000
124600     END-EVALUATE.                                                12460000
124700                                                                  12470000
124800*---------------------------------------------------------------* 12480000
124900*  VALIDATE PO, RCVR, AND LINE NUMBER                             12490000
125000*---------------------------------------------------------------* 12500000
125100 3120-VALIDATE-PO-RCVR-LINE-NBR.                                  12510000
125200     MOVE ASC-PO-NBR-N    TO DK-PO-NUMBER.                        12520000
125300     MOVE ASC-RCVR-NBR-N  TO DK-RCVR-NUMBER.                      12530000
125400     MOVE ASC-LINE-NBR-N  TO DK-LINE-NUMBER.                      12540000
125500     EXEC SQL                                                     12550000
125600              SELECT  ORD_NBR                                     12560000
125700                     ,ORD_LNE_NBR                                 12570000
125800                     ,REC_SEQ_NBR                                 12580000
125900                INTO  :RECITM-ORD-NBR                             12590000
126000                     ,:RECITM-ORD-LNE-NBR                         12600000
126100                     ,:RECITM-REC-SEQ-NBR                         12610000
126200                FROM  TRECITM                                     12620000
126300               WHERE  ORD_NBR        = :DK-PO-NUMBER              12630000
126400                 AND  ORD_LNE_NBR    = :DK-LINE-NUMBER            12640000
126500                 AND  REC_SEQ_NBR    = :DK-RCVR-NUMBER            12650000
126600                 AND  STATUS_CDE NOT LIKE 'DE'                    12660000
126700     END-EXEC.                                                    12670000
126800                                                                  12680000
126900      EVALUATE TRUE                                               12690000
127000          WHEN SQLCODE = +0                                       12700000
127100          WHEN SQLCODE = -811                                     12710000
127200               CONTINUE                                           12720000
127300          WHEN SQLCODE = +100                                     12730000
127400               SET PS-ERROR                                       12740000
127500                   DP020-MSG-FATAL         TO TRUE                12750000
127600               MOVE PC-TSYMSG-01247        TO DP020-MSG-NUMBER    12760000
127700               MOVE DP015-UNP-ALP-BRT-OFF  TO ALINEA              12770000
127800               MOVE DP015-RED              TO ALINEC              12780000
127900               MOVE DP015-REVERSE          TO ALINEH              12790000
128000               MOVE -1                     TO ALINEL              12800000
128100               SET DP030-SET-CURSOR-APPL-1 TO TRUE                12810000
128200          WHEN OTHER                                              12820000
128300               MOVE '3120-VALIDATE-PO-RCVR-LI' TO DP013-PARAGRAPH 12830000
128400               MOVE 'VERIFY PO-RCVR-LINE NUMBER'                  12840000
128500                                   TO DP013-MESSAGE-TEXT (1)      12850000
128600               STRING 'PO NBR-'         DELIMITED BY SIZE         12860000
128700                      ASC-PO-NBR        DELIMITED BY SIZE         12870000
128800                      'RECEIVER NBR-'   DELIMITED BY SIZE         12880000
128900                      ASC-RCVR-NBR      DELIMITED BY SIZE         12890000
129000                      'LINE NBR-'       DELIMITED BY SIZE         12900000
129100                      ASC-LINE-NBR      DELIMITED BY SIZE         12910000
129200                                 INTO DP013-MESSAGE-TEXT (2)      12920000
129300               MOVE SQLCA   TO DP013-SQLCA                        12930000
129400               MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)        12940000
129500               SET DP013-DB2-ABEND                                12950000
129600                   DP013-XCTL-DISPLAY-RESTART TO TRUE             12960000
129700               PERFORM DP013-0000-PROCESS-ABEND                   12970000
129800     END-EVALUATE.                                                12980000
129900                                                                  12990000
130000*---------------------------------------------------------------* 13000000
130100*  VALIDATE PO, RCVR, LINE, AND STORE NUMBER                      13010000
130200*---------------------------------------------------------------* 13020000
130300 3130-VALIDATE-PORCVR-LINESTR.                                    13030000
130400     MOVE ASC-PO-NBR-N    TO DK-PO-NUMBER.                        13040000
130500     MOVE ASC-RCVR-NBR-N  TO DK-RCVR-NUMBER.                      13050000
130600     MOVE ASC-LINE-NBR-N  TO DK-LINE-NUMBER.                      13060000
130700     MOVE ASC-STR-NBR-N   TO DK-STORE-NUMBER.                     13070000
130800     EXEC SQL                                                     13080000
130900              SELECT  ORD_NBR                                     13090000
131000                     ,ORD_LNE_NBR                                 13100000
131100                     ,REC_SEQ_NBR                                 13110000
131200                     ,STR_NBR                                     13120000
131300                INTO  :RECDIS-ORD-NBR                             13130000
131400                     ,:RECDIS-ORD-LNE-NBR                         13140000
131500                     ,:RECDIS-REC-SEQ-NBR                         13150000
131600                     ,:RECDIS-STR-NBR                             13160000
131700                FROM  TRECDIS                                     13170000
131800               WHERE  ORD_NBR     = :DK-PO-NUMBER                 13180000
131900                 AND  ORD_LNE_NBR = :DK-LINE-NUMBER               13190000
132000                 AND  REC_SEQ_NBR = :DK-RCVR-NUMBER               13200000
132100                 AND  STR_NBR     = :DK-STORE-NUMBER              13210000
132200     END-EXEC.                                                    13220000
132300                                                                  13230000
132400      EVALUATE TRUE                                               13240000
132500          WHEN SQLCODE = +0                                       13250000
132600          WHEN SQLCODE = -811                                     13260000
132700               CONTINUE                                           13270000
132800          WHEN SQLCODE = +100                                     13280000
132900               SET PS-ERROR                                       13290000
133000                   DP020-MSG-FATAL         TO TRUE                13300000
133100               MOVE PC-TSYMSG-01623        TO DP020-MSG-NUMBER    13310000
133200               MOVE DP015-UNP-ALP-BRT-OFF  TO ASTOREA             13320000
133300               MOVE DP015-RED              TO ASTOREC             13330000
133400               MOVE DP015-REVERSE          TO ASTOREH             13340000
133500               MOVE -1                     TO ASTOREL             13350000
133600               SET DP030-SET-CURSOR-APPL-1 TO TRUE                13360000
133700          WHEN OTHER                                              13370000
133800               MOVE '3130-VLDT-PORCVR-LINESTR' TO DP013-PARAGRAPH 13380000
133900               MOVE 'VERIFY PO-RCVR-LINE-STR NBR'                 13390000
134000                                   TO DP013-MESSAGE-TEXT (1)      13400000
134100               STRING 'PO NBR-'         DELIMITED BY SIZE         13410000
134200                      ASC-PO-NBR        DELIMITED BY SIZE         13420000
134300                      'RECEIVER NBR-'   DELIMITED BY SIZE         13430000
134400                      ASC-RCVR-NBR      DELIMITED BY SIZE         13440000
134500                      'LINE NBR-'       DELIMITED BY SIZE         13450000
134600                      ASC-LINE-NBR      DELIMITED BY SIZE         13460000
134700                      'STORE NBR-'      DELIMITED BY SIZE         13470000
134800                      ASC-STR-NBR       DELIMITED BY SIZE         13480000
134900                                 INTO DP013-MESSAGE-TEXT (2)      13490000
135000               MOVE SQLCA   TO DP013-SQLCA                        13500000
135100               MOVE 'TRECDIS ' TO DP013-DB2-TABLE-NAME (1)        13510000
135200               SET DP013-DB2-ABEND                                13520000
135300                   DP013-XCTL-DISPLAY-RESTART TO TRUE             13530000
135400               PERFORM DP013-0000-PROCESS-ABEND                   13540000
135500     END-EVALUATE.                                                13550000
135600                                                                  13560000
135700*---------------------------------------------------------------* 13570000
135800*  VALIDATE PO, RCVR, AND STORE NUMBER                            13580000
135900*---------------------------------------------------------------* 13590000
136000 3140-VALIDATE-PORCVR-STORE.                                      13600000
136100     MOVE ASC-PO-NBR-N    TO DK-PO-NUMBER.                        13610000
136200     MOVE ASC-RCVR-NBR-N  TO DK-RCVR-NUMBER.                      13620000
136300     MOVE ASC-STR-NBR-N   TO DK-STORE-NUMBER.                     13630000
136400     EXEC SQL                                                     13640000
136500              SELECT  ORD_NBR                                     13650000
136600                     ,REC_SEQ_NBR                                 13660000
136700                     ,STR_NBR                                     13670000
136800                INTO  :RECDIS-ORD-NBR                             13680000
136900                     ,:RECDIS-REC-SEQ-NBR                         13690000
137000                     ,:RECDIS-STR-NBR                             13700000
137100                FROM  TRECDIS                                     13710000
137200               WHERE  ORD_NBR     = :DK-PO-NUMBER                 13720000
137300                 AND  REC_SEQ_NBR = :DK-RCVR-NUMBER               13730000
137400                 AND  STR_NBR     = :DK-STORE-NUMBER              13740000
137500     END-EXEC.                                                    13750000
137600                                                                  13760000
137700      EVALUATE TRUE                                               13770000
137800          WHEN SQLCODE = +0                                       13780000
137900          WHEN SQLCODE = -811                                     13790000
138000               CONTINUE                                           13800000
138100          WHEN SQLCODE = +100                                     13810000
138200               SET PS-ERROR                                       13820000
138300                   DP020-MSG-FATAL         TO TRUE                13830000
138400               MOVE PC-TSYMSG-01623        TO DP020-MSG-NUMBER    13840000
138500               MOVE DP015-UNP-ALP-BRT-OFF  TO ASTOREA             13850000
138600               MOVE DP015-RED              TO ASTOREC             13860000
138700               MOVE DP015-REVERSE          TO ASTOREH             13870000
138800               MOVE -1                     TO ASTOREL             13880000
138900               SET DP030-SET-CURSOR-APPL-1 TO TRUE                13890000
139000          WHEN OTHER                                              13900000
139100               MOVE '3140-VALIDATE-PORCVR-STR ' TO DP013-PARAGRAPH13910000
139200               MOVE 'VERIFY PO-RCVR-STORE NUMBER'                 13920000
139300                                   TO DP013-MESSAGE-TEXT (1)      13930000
139400               STRING 'PO NBR-'         DELIMITED BY SIZE         13940000
139500                      ASC-PO-NBR        DELIMITED BY SIZE         13950000
139600                      'RECEIVER NBR-'   DELIMITED BY SIZE         13960000
139700                      ASC-RCVR-NBR      DELIMITED BY SIZE         13970000
139800                      'STORE NBR-'      DELIMITED BY SIZE         13980000
139900                      ASC-STR-NBR       DELIMITED BY SIZE         13990000
140000                                 INTO DP013-MESSAGE-TEXT (2)      14000000
140100               MOVE SQLCA   TO DP013-SQLCA                        14010000
140200               MOVE 'TRECDIS ' TO DP013-DB2-TABLE-NAME (1)        14020000
140300               SET DP013-DB2-ABEND                                14030000
140400                   DP013-XCTL-DISPLAY-RESTART TO TRUE             14040000
140500               PERFORM DP013-0000-PROCESS-ABEND                   14050000
140600     END-EVALUATE.                                                14060000
140700                                                                  14070000
140800*---------------------------------------------------------------* 14080000
140900*  VALIDATE SML NUMBER                                            14090000
141000*---------------------------------------------------------------* 14100000
141100 3150-VALIDATE-SML-NBR.                                           14110000
141200     IF ASC-ZEROES = ZERO                                         14120000
141300         MOVE ASC-SML-NBR     TO DK-SML-NUMBER                    14130000
141400     ELSE                                                         14140000
141500         MOVE ASC-SML-NBR-A   TO DK-SML-NUMBER                    14150000
141600     END-IF.                                                      14160000
141700     MOVE DK-SML-NUMBER   TO DK-SML-NUMBER-NUM.                   14170000
141800     MOVE ZEROES          TO DK-SML-ZEROES.                       14180000
141900     MOVE SPACES          TO DK-SML-SPACES.                       14190000
142000                                                                  14200000
142100     EXEC SQL                                                     14210000
142200              SELECT  SHIPT_UNT_ID                                14220000
142300                   ,  CART_SRC_CDE                                14230000
142400                INTO  :SUT00024-SHIPT-UNT-ID                      14240000
142500                   ,  :SUT00024-CART-SRC-CDE                      14250000
142600                FROM  SUT_OTBND_CART                              14260000
142700               WHERE  SHIPT_UNT_ID = :DK-SML-NUMBER-NUM           14270000
142800     END-EXEC.                                                    14280000
142900                                                                  14290000
143000      EVALUATE TRUE                                               14300000
143100          WHEN SQLCODE = +0                                       14310000
143200          WHEN SQLCODE = -811                                     14320000
143300               CONTINUE                                           14330000
143400          WHEN SQLCODE = +100                                     14340013
143401               EVALUATE TRUE                                      14340113
143403                   WHEN DP020-FK-LOCAL-FUNC-08 (DP020-SRC-AID)    14340313
143410                        MOVE 'UNKNOWN'  TO ACTSRCO                14341013
143420                   WHEN OTHER                                     14342013
143500                        SET PS-ERROR                              14350013
143600                            DP020-MSG-FATAL  TO TRUE              14360013
143700                        MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER  14370013
143800                        MOVE DP015-UNP-ALP-BRT-OFF  TO ASMLA      14380013
143900                        MOVE DP015-RED      TO ASMLC              14390013
144000                        MOVE DP015-REVERSE  TO ASMLH              14400013
144100                        MOVE -1             TO ASMLL              14410013
144200                        SET DP030-SET-CURSOR-APPL-1 TO TRUE       14420013
144201                        MOVE 'UNKNOWN'      TO ACTSRCO            14420113
144210               END-EVALUATE                                       14421013
144300          WHEN OTHER                                              14430000
144400               MOVE '3150-VALIDATE-SML-NBR' TO DP013-PARAGRAPH    14440000
144500               MOVE 'VERIFY SML NUMBER'                           14450000
144600                                   TO DP013-MESSAGE-TEXT (1)      14460000
144700               STRING 'SML NBR-'        DELIMITED BY SIZE         14470000
144800                      ASC-SML-NBR-X     DELIMITED BY SIZE         14480000
144900                                 INTO DP013-MESSAGE-TEXT (2)      14490000
145000               MOVE SQLCA   TO DP013-SQLCA                        14500000
145100               MOVE 'TSULBXF ' TO DP013-DB2-TABLE-NAME (1)        14510000
145200               SET DP013-DB2-ABEND                                14520000
145300                   DP013-XCTL-DISPLAY-RESTART TO TRUE             14530000
145400               PERFORM DP013-0000-PROCESS-ABEND                   14540000
145500     END-EVALUATE.                                                14550000
145600                                                                  14560000
145700*---------------------------------------------------------------* 14570000
145800 3155-COUNT-FOR-CHILDREN.                                         14580000
145900     MOVE ZEROES          TO PV-CHILDREN-COUNT.                   14590000
146000                                                                  14600000
146100     EXEC SQL                                                     14610000
146200              SELECT  COUNT(*)                                    14620000
146300                INTO  :PV-CHILDREN-COUNT                          14630000
146400                FROM  SUT_OTBND_CART                              14640000
146500               WHERE  PRNT_CART_ID = :DK-SML-NUMBER-NUM           14650000
146600                 AND  SHIPT_UNT_ID <> PRNT_CART_ID                14660000
146700     END-EXEC.                                                    14670000
146800                                                                  14680000
146900      EVALUATE TRUE                                               14690000
147000          WHEN SQLCODE = +0                                       14700000
147100               PERFORM 3157-CHECK-IF-SCANNED-ON                   14710000
147200          WHEN SQLCODE = -305                                     14720000
147300          WHEN SQLCODE = +100                                     14730000
147400               MOVE ZEROES          TO PV-CHILDREN-COUNT          14740000
147500          WHEN OTHER                                              14750000
147600               MOVE '3155-COUNT-FOR-CHILDREN'                     14760000
147700                                            TO DP013-PARAGRAPH    14770000
147800               MOVE 'COUNT CHILDREN'                              14780000
147900                                   TO DP013-MESSAGE-TEXT (1)      14790000
148000               MOVE SQLCODE        TO PV-DISPLAY-SQLCODE          14800000
148100               STRING 'SML NBR-'         DELIMITED BY SIZE        14810000
148200                      ASC-SML-NBR-X      DELIMITED BY SIZE        14820000
148300                      'SQLCODE = '       DELIMITED BY SIZE        14830000
148400                      PV-DISPLAY-SQLCODE DELIMITED BY SIZE        14840000
148500                                 INTO DP013-MESSAGE-TEXT (2)      14850000
148600               MOVE SQLCA   TO DP013-SQLCA                        14860000
148700               MOVE 'SUT00024' TO DP013-DB2-TABLE-NAME (1)        14870000
148800               SET DP013-DB2-ABEND                                14880000
148900                   DP013-XCTL-DISPLAY-RESTART TO TRUE             14890000
149000               PERFORM DP013-0000-PROCESS-ABEND                   14900000
149100     END-EVALUATE.                                                14910000
149200                                                                  14920000
149300*----------------------------------------------------------------*14930000
149400 3157-CHECK-IF-SCANNED-ON.                                        14940000
149500                                                                  14950000
149600     EXEC SQL                                                     14960000
149700              SELECT  OTBND_TRIP_ID                               14970000
149800                INTO  :SUT00027-OTBND-TRIP-ID                     14980000
149900                FROM  SUT_OTBND_LOC                               14990000
150000               WHERE  SHIPT_UNT_ID = :DK-SML-NUMBER-NUM           15000000
150100                 AND  SCN_CDE      = 'SHON'                       15010000
150200                 AND  ACTV_CDE     = 'I'                          15020000
150300     END-EXEC.                                                    15030000
150400                                                                  15040000
150500      EVALUATE TRUE                                               15050000
150600          WHEN SQLCODE = +0                                       15060000
150700          WHEN SQLCODE = -811                                     15070000
150800               MOVE SUT00027-OTBND-TRIP-ID                        15080000
150900                 TO PV-SCAN-ON-TRIP-ID                            15090000
151000          WHEN SQLCODE = -305                                     15100000
151100          WHEN SQLCODE = +100                                     15110000
151200               MOVE ZEROES          TO PV-SCAN-ON-TRIP-ID         15120000
151300               PERFORM 3158-CHECK-IF-DIVERT                       15130000
151400          WHEN OTHER                                              15140000
151500               MOVE '3157-CHECK-IF-SCANNED-ON'                    15150000
151600                                            TO DP013-PARAGRAPH    15160000
151700               MOVE 'CHECK IF MASTER SCANNED ON OTBND TRIP'       15170000
151800                                   TO DP013-MESSAGE-TEXT (1)      15180000
151900               MOVE SQLCODE        TO PV-DISPLAY-SQLCODE          15190000
152000               STRING 'SML NBR-'         DELIMITED BY SIZE        15200000
152100                      ASC-SML-NBR-X      DELIMITED BY SIZE        15210000
152200                      'SQLCODE = '       DELIMITED BY SIZE        15220000
152300                      PV-DISPLAY-SQLCODE DELIMITED BY SIZE        15230000
152400                                 INTO DP013-MESSAGE-TEXT (2)      15240000
152500               MOVE SQLCA   TO DP013-SQLCA                        15250000
152600               MOVE 'SUT00027' TO DP013-DB2-TABLE-NAME (1)        15260000
152700               SET DP013-DB2-ABEND                                15270000
152800                   DP013-XCTL-DISPLAY-RESTART TO TRUE             15280000
152900               PERFORM DP013-0000-PROCESS-ABEND                   15290000
153000     END-EVALUATE.                                                15300000
153100                                                                  15310000
153200*----------------------------------------------------------------*15320000
153300 3158-CHECK-IF-DIVERT.                                            15330000
153400                                                                  15340000
153500     EXEC SQL                                                     15350000
153600              SELECT  A.DOOR_ID                                   15360000
153700                INTO  :SUCRDV-DOOR-ID                             15370000
153800                FROM  TSUCRDV A                                   15380000
153900               WHERE  A.SHIPT_UNT_ID = :DK-SML-NUMBER-NUM         15390000
154000                 AND  A.DIVERT_TMST  IN                           15400000
154100                      (SELECT MAX(B.DIVERT_TMST)                  15410000
154200                         FROM TSUCRDV B                           15420000
154300                        WHERE A.SHIPT_UNT_ID  = B.SHIPT_UNT_ID)   15430000
154400     END-EXEC.                                                    15440000
154500                                                                  15450000
154600      EVALUATE TRUE                                               15460000
154700          WHEN SQLCODE = +0                                       15470000
154800          WHEN SQLCODE = -811                                     15480000
154900               MOVE SUCRDV-DOOR-ID                                15490000
155000                 TO PV-DIVERT-DOOR                                15500000
155100          WHEN SQLCODE = -305                                     15510000
155200          WHEN SQLCODE = +100                                     15520000
155300               MOVE SPACES          TO PV-DIVERT-DOOR             15530000
155400          WHEN OTHER                                              15540000
155500               MOVE '3158-CHECK-IF-DIVERT'                        15550000
155600                                            TO DP013-PARAGRAPH    15560000
155700               MOVE 'CHECK IF MASTER SCANNED ON OTBND TRIP'       15570000
155800                                   TO DP013-MESSAGE-TEXT (1)      15580000
155900               MOVE SQLCODE        TO PV-DISPLAY-SQLCODE          15590000
156000               STRING 'SML NBR-'         DELIMITED BY SIZE        15600000
156100                      ASC-SML-NBR-X      DELIMITED BY SIZE        15610000
156200                      'SQLCODE = '       DELIMITED BY SIZE        15620000
156300                      PV-DISPLAY-SQLCODE DELIMITED BY SIZE        15630000
156400                                 INTO DP013-MESSAGE-TEXT (2)      15640000
156500               MOVE SQLCA   TO DP013-SQLCA                        15650000
156600               MOVE 'TSUCRDV ' TO DP013-DB2-TABLE-NAME (1)        15660000
156700               SET DP013-DB2-ABEND                                15670000
156800                   DP013-XCTL-DISPLAY-RESTART TO TRUE             15680000
156900               PERFORM DP013-0000-PROCESS-ABEND                   15690000
157000     END-EVALUATE.                                                15700000
157100                                                                  15710000
157200*----------------------------------------------------------------*15720000
157300*  GET THE NUMBER OF WEEKS THAT THE OUTBOUND DATABASES HAVE BEEN *15730000
157400*  PURGED.                                                       *15740000
157600*----------------------------------------------------------------*15760000
157700 3160-GET-PURGE-WKS.                                              15770000
157800     EXEC SQL                                                     15780000
157900         SELECT  FUNC_QTY                                         15790000
158000           INTO :DK-PURGE-WEEKS                                   15800000
158100           FROM TKRPRPM                                           15810000
158200          WHERE LOC_ID            =  90                           15820000
158300            AND INTFC_SYS_CDE     = 'KHL'                         15830000
158400            AND SYS_PRC_FUNC_CDE  = 'OTPURG'                      15840000
158500            AND FUNC_PRC_STAT_CDE = 'AC'                          15850000
158600     END-EXEC.                                                    15860000
158700                                                                  15870000
158800     EVALUATE TRUE                                                15880000
158900         WHEN SQLCODE = +0                                        15890000
159000              PERFORM 3165-GET-PURGE-DATE                         15900000
159100         WHEN OTHER                                               15910000
159200              MOVE '3160-GET-PURGE-WKS       ' TO DP013-PARAGRAPH 15920000
159300              MOVE 'GET NUMBER OF WEEKS PURGED '                  15930000
159400                                   TO DP013-MESSAGE-TEXT (1)      15940000
159500              STRING 'PO NBR-'        DELIMITED BY SIZE           15950000
159600                      ASC-PO-NBR      DELIMITED BY SIZE           15960000
159700                     'RECEIVER NBR-'  DELIMITED BY SIZE           15970000
159800                      ASC-RCVR-NBR    DELIMITED BY SIZE           15980000
159900                     'STORE NBR-'     DELIMITED BY SIZE           15990000
160000                      ASC-STR-NBR     DELIMITED BY SIZE           16000000
160100                                 INTO DP013-MESSAGE-TEXT (2)      16010000
160200              MOVE SQLCA   TO DP013-SQLCA                         16020000
160300              MOVE 'TKRPRPM ' TO DP013-DB2-TABLE-NAME (1)         16030000
160400              SET DP013-DB2-ABEND                                 16040000
160500                  DP013-XCTL-DISPLAY-RESTART TO TRUE              16050000
160600              PERFORM DP013-0000-PROCESS-ABEND                    16060000
160700     END-EVALUATE.                                                16070000
160800                                                                  16080000
160900                                                                  16090000
161000 3165-GET-PURGE-DATE.                                             16100000
161100                                                                  16110000
161200     EXEC SQL                                                     16120000
161300         SELECT  (CURRENT_DATE -                                  16130000
161400                  (:DK-PURGE-WEEKS * 7) DAYS)                     16140000
161500           INTO :PV-PURGE-DATE                                    16150000
161600           FROM TKRPRPM                                           16160000
161700          WHERE LOC_ID            =  90                           16170000
161800            AND INTFC_SYS_CDE     = 'KHL'                         16180000
161900            AND SYS_PRC_FUNC_CDE  = 'OTPURG'                      16190000
162000            AND FUNC_PRC_STAT_CDE = 'AC'                          16200000
162100     END-EXEC.                                                    16210000
162200                                                                  16220000
162300     EVALUATE TRUE                                                16230000
162400         WHEN SQLCODE = +0                                        16240000
162500              CONTINUE                                            16250000
162600         WHEN OTHER                                               16260000
162700              MOVE '3165-GET-PURGE-DATE      ' TO DP013-PARAGRAPH 16270000
162800              MOVE 'CALCULATE DATE PURGE THRU  '                  16280000
162900                                   TO DP013-MESSAGE-TEXT (1)      16290000
163000              STRING 'PO NBR-'        DELIMITED BY SIZE           16300000
163100                      ASC-PO-NBR      DELIMITED BY SIZE           16310000
163200                     'RECEIVER NBR-'  DELIMITED BY SIZE           16320000
163300                      ASC-RCVR-NBR    DELIMITED BY SIZE           16330000
163400                     'STORE NBR-'     DELIMITED BY SIZE           16340000
163500                      ASC-STR-NBR     DELIMITED BY SIZE           16350000
163600                                 INTO DP013-MESSAGE-TEXT (2)      16360000
163700              MOVE SQLCA   TO DP013-SQLCA                         16370000
163800              MOVE 'TKRPRPM ' TO DP013-DB2-TABLE-NAME (1)         16380000
163900              SET DP013-DB2-ABEND                                 16390000
164000                  DP013-XCTL-DISPLAY-RESTART TO TRUE              16400000
164100              PERFORM DP013-0000-PROCESS-ABEND                    16410000
164200     END-EVALUATE.                                                16420000
164300                                                                  16430000
164400                                                                  16440000
164421*---------------------------------------------------------------* 16442116
164422*  CHECK IF CARTON HAS BEEN SCANNED AT THE STORE                  16442216
164424*---------------------------------------------------------------* 16442416
164430 3170-CHECK-STORE-SCAN.                                           16443016
164443                                                                  16444316
164444     EXEC SQL                                                     16444416
164445              SELECT  B.SCN_TYP_SHRT_DES                          16444516
164446                   ,  DATE(A.CRE_TMST)                            16444616
164447                   ,  TIME(A.CRE_TMST)                            16444716
164448                INTO :ASC-STORE-SCAN                              16444816
164449                   , :ASC-STORE-SCAN-DATE                         16444916
164450                   , :ASC-STORE-SCAN-TIME                         16445016
164451                FROM  SUT_OTBND_STR_SCN A                         16445116
164452                   ,  SUT_OTBND_SCN_TYP B                         16445216
164454               WHERE A.SHIPT_UNT_ID = :DK-SML-NUMBER-NUM          16445416
164455                 AND A.SCN_TYP_CDE  =  B.SCN_TYP_CDE              16445521
164456                 AND A.CRE_TMST IN                                16445616
164457                     (SELECT MAX(C.CRE_TMST)                      16445716
164458                        FROM SUT_OTBND_STR_SCN C                  16445816
164459                       WHERE A.SHIPT_UNT_ID  =  C.SHIPT_UNT_ID    16445916
164460                         AND NOT C.SCN_TYP_CDE  =  'SSMS')        16446016
164461     END-EXEC.                                                    16446116
164462                                                                  16446216
164463      EVALUATE TRUE                                               16446316
164464          WHEN SQLCODE = +0                                       16446416
164465               PERFORM 3175-CHECK-MULT-STR-SCN                    16446516
164466          WHEN SQLCODE = +100                                     16446616
164467               MOVE SPACES  TO  ASC-STORE-SCAN                    16446716
164468                                ASC-STORE-SCAN-DATE               16446816
164469                                ASC-STORE-SCAN-TIME               16446916
164470                                ASC-STORE-SCAN-MULT               16447016
164480               MOVE ZEROES  TO  ASC-STORE-SCAN-COUNT              16448016
164484          WHEN OTHER                                              16448416
164485               MOVE '3170-CHECK-STORE-SCAN' TO DP013-PARAGRAPH    16448516
164486               MOVE 'CHECK IF STORE HAS SCANNED CARTON'           16448616
164487                                   TO DP013-MESSAGE-TEXT (1)      16448716
164488               STRING 'SML NBR-'        DELIMITED BY SIZE         16448816
164489                      ASC-SML-NBR-X     DELIMITED BY SIZE         16448916
164490                                 INTO DP013-MESSAGE-TEXT (2)      16449016
164491               MOVE SQLCA   TO DP013-SQLCA                        16449116
164492               MOVE 'SUT00120' TO DP013-DB2-TABLE-NAME (1)        16449216
164493               MOVE 'SUT00121' TO DP013-DB2-TABLE-NAME (2)        16449316
164494               SET DP013-DB2-ABEND                                16449416
164495                   DP013-XCTL-DISPLAY-RESTART TO TRUE             16449516
164496               PERFORM DP013-0000-PROCESS-ABEND                   16449616
164497     END-EVALUATE.                                                16449716
164498                                                                  16449816
164499                                                                  16449916
164500*----------------------------------------------------------------*16450016
164501*  IF THE CARTON HAS BEEN SCANNED AT THE STORE, CHECK TO SEE IF  *16450116
164502*  THERE ARE MULTIPLE SCANS FOR THE CARTON                       *16450216
164504*----------------------------------------------------------------*16450416
164505 3175-CHECK-MULT-STR-SCN.                                         16450516
164506                                                                  16450616
164507     EXEC SQL                                                     16450716
164508              SELECT  COUNT(*)                                    16450816
164511                INTO :ASC-STORE-SCAN-COUNT                        16451116
164514                FROM  SUT_OTBND_STR_SCN                           16451416
164516               WHERE  SHIPT_UNT_ID = :DK-SML-NUMBER-NUM           16451618
164522     END-EXEC.                                                    16452216
164523                                                                  16452316
164524      EVALUATE TRUE                                               16452416
164525          WHEN SQLCODE = +0                                       16452516
164526               IF  ASC-STORE-SCAN-COUNT  > 1                      16452616
164527                   MOVE  '*'  TO  ASC-STORE-SCAN-MULT             16452716
164528               ELSE                                               16452816
164529                   MOVE  ' '  TO  ASC-STORE-SCAN-MULT             16452916
164530               END-IF                                             16453016
164537          WHEN OTHER                                              16453716
164538               MOVE '3175-CHECK-MULT-STR-SCN' TO DP013-PARAGRAPH  16453817
164539               MOVE 'CHECK IF STORE SCANNED CRTN MULT TIMES'      16453916
164540                                   TO DP013-MESSAGE-TEXT (1)      16454016
164541               STRING 'SML NBR-'        DELIMITED BY SIZE         16454116
164542                      ASC-SML-NBR-X     DELIMITED BY SIZE         16454216
164543                                 INTO DP013-MESSAGE-TEXT (2)      16454316
164544               MOVE SQLCA   TO DP013-SQLCA                        16454416
164546               MOVE 'SUT00121' TO DP013-DB2-TABLE-NAME (1)        16454616
164547               SET DP013-DB2-ABEND                                16454716
164548                   DP013-XCTL-DISPLAY-RESTART TO TRUE             16454816
164549               PERFORM DP013-0000-PROCESS-ABEND                   16454916
164550     END-EVALUATE.                                                16455016
164552                                                                  16455216
164553                                                                  16455316
164560*----------------------------------------------------------------*16456015
164600*  MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE  *16460000
164700*  MAP.                                                          *16470000
164800*----------------------------------------------------------------*16480000
164900 3200-RESET-ATTRIBUTES.                                           16490000
165000                                                                  16500000
165100     MOVE DP015-ASK-NOR-OFF        TO AOPERA                      16510000
165200                                      ANAMEA                      16520000
165300                                      AFCLTYA.                    16530009
165400                                                                  16540000
165500     MOVE DP015-UNP-NUM-NOR-OFF    TO APOA                        16550000
165800                                      ALINEA                      16580000
165900                                      ASTOREA                     16590000
166000                                      ASMLA.                      16600000
166100                                                                  16610000
166300     MOVE DP015-UNP-ALP-NOR-OFF    TO ARCVRA.                     16630000
166400                                                                  16640000
166500     MOVE DP015-BLUE               TO AOPERC                      16650000
166600                                      ANAMEC.                     16660000
166700                                                                  16670000
166800     MOVE DP015-GREEN              TO APOC                        16680000
166900                                      ARCVRC                      16690000
167000                                      ALINEC                      16700000
167100                                      ASTOREC                     16710000
167200                                      ASMLC.                      16720000
167300                                                                  16730000
167400     MOVE DP015-UNDERLINE          TO APOH                        16740000
167500                                      ARCVRH                      16750000
167600                                      ALINEH                      16760000
167700                                      ASTOREH                     16770000
167800                                      ASMLH.                      16780000
167900                                                                  16790000
168000*----------------------------------------------------------------*16800000
168100*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *16810000
168200*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *16820000
168300*  IT HERE.                                                      *16830000
168400*----------------------------------------------------------------*16840000
168500 4000-BUILD-INITIAL-PANEL.                                        16850000
168600     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        16860000
168700     MOVE -1                       TO APOL.                       16870000
168800                                                                  16880000
168900     INITIALIZE PV-USER-LOCATION.                                 16890000
169000     MOVE DP020-LOCATION-NBR       TO ASC-CURR-OPER-UNT-ID        16900000
169100                                      DK-CURR-OPER-UNT-ID         16910000
169200                                      AOPERO.                     16920000
169300                                                                  16930000
169400     MOVE PC-FCLTY-ID-0001         TO ASC-CURR-FCLTY-ID           16940000
169500                                      DK-CURR-FCLTY-ID            16950000
169600                                      AFCLTYO.                    16960000
169700     PERFORM 7000-GET-STORE-NAME.                                 16970000
169800     MOVE ASC-OPER-UNIT-NAME       TO ANAMEO.                     16980000
169900                                                                  16990000
170000*----------------------------------------------------------------*17000000
170100*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *17010000
170200*----------------------------------------------------------------*17020000
170300 4400-MOVE-COMMAREA-TO-SCREEN.                                    17030000
170400                                                                  17040000
170500     MOVE ASC-CURR-OPER-UNT-ID     TO AOPERO.                     17050000
170600     MOVE ASC-CURR-FCLTY-ID        TO AFCLTYO.                    17060000
170700     MOVE ASC-OPER-UNIT-NAME       TO ANAMEO.                     17070000
170800     MOVE ASC-PO-NBR-N             TO APOO                        17080000
170900                                      JL-LINE-15-PO-NBR.          17090000
171000     MOVE ASC-RCVR-NBR             TO ARCVRO.                     17100000
171100     MOVE ASC-LINE-NBR             TO ALINEO.                     17110000
171200     MOVE ASC-STR-NBR              TO ASTOREO.                    17120000
171300     MOVE ASC-STORE-NAME           TO ASTNAMEO.                   17130000
171400     MOVE ASC-SML-NBR-X            TO ASMLO.                      17140000
171500     MOVE ASC-CART-SRC-CDE         TO ACTSRCO.                    17150000
171510     MOVE ASC-STORE-SCAN           TO ASTSCNO.                    17151016
171511     MOVE ASC-STORE-SCAN-MULT      TO ASTMLTO.                    17151116
171520     MOVE ASC-STORE-SCAN-DATE      TO ASCNDTO.                    17152016
171530     MOVE ASC-STORE-SCAN-TIME      TO ASCNTMO.                    17153016
171600                                                                  17160000
171610                                                                  17161016
171700*----------------------------------------------------------------*17170000
171800*       GET STORE NAME                                            17180000
171900*----------------------------------------------------------------*17190000
172000 7000-GET-STORE-NAME.                                             17200000
172100                                                                  17210000
172200     INITIALIZE XL071-COMMAREA-REC.                               17220000
172300     MOVE ASC-CURR-OPER-UNT-ID-N   TO XL071-LOCATION-NUMBER.      17230000
172400                                                                  17240000
172500     CALL PC-LOCATION-MODULE  USING DFHEIBLK                      17250000
172600                                    XL071-COMMAREA                17260000
172700                                    XL071-COMMAREA-REC.           17270000
172800                                                                  17280000
172900     IF XL071-NO-ERRORS                                           17290000
173000         MOVE XL071-LOC-NM        TO ASC-OPER-UNIT-NAME           17300000
173100     ELSE                                                         17310000
173200         IF XL071-LOC-NOT-FOUND                                   17320000
173300             MOVE 'STORE NAME NOT FOUND' TO ASC-OPER-UNIT-NAME    17330000
173400         ELSE                                                     17340000
173500             IF XL071-BAD-DB2-RETURN                              17350000
173600                 SET PS-ERROR    TO TRUE                          17360000
173700                 MOVE '7000-GET-STORE-NAME' TO DP013-PARAGRAPH    17370000
173800                 MOVE 'UNSUCCESSFUL SELECT ON LCATN TABLE'        17380000
173900                                        TO DP013-MESSAGE-TEXT (1) 17390000
174000                 MOVE SQLCA      TO DP013-SQLCA                   17400000
174100                 MOVE 'XLT_LOC ' TO DP013-DB2-TABLE-NAME (1)      17410000
174200                 SET DP013-DB2-ABEND                              17420000
174300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17430000
174400                 PERFORM DP013-0000-PROCESS-ABEND                 17440000
174500             END-IF                                               17450000
174600         END-IF                                                   17460000
174700     END-IF.                                                      17470000
174800                                                                  17480000
174900*----------------------------------------------------------------*17490000
175000*    ABEND PROCESSOR MODULE                                      *17500000
175100*----------------------------------------------------------------*17510000
175200     COPY DPPD013.                                                17520000
175300*----------------------------------------------------------------*17530000
175400*                                                                *17540000
175500*----------------------------------------------------------------*17550000
175600 9000-SUBMIT-REQUEST.                                             17560000
175700                                                                  17570000
175800     EXEC CICS ASSIGN                                             17580000
175900               APPLID(PV-SYSTEM-ID)                               17590000
176000               USERID(DP020-USERID)                               17600000
176100     END-EXEC.                                                    17610000
176200                                                                  17620000
176300     PERFORM 9500-ENQUEUE-INTERNAL-READER.                        17630000
176400                                                                  17640000
176500*-----------------------------------------------------------------17650000
176600* PROD/LEARN JCL SETUP                                            17660000
176700*     //SUK901   JOB KOHLS,'CRTN PKD QURY',MSGCLASS=P,CLASS=Q     17670001
176800*     /*JOBPARM K=O                                               17680000
176900*     //JOBOUT01 OUTPUT FORMS=STD,FCB=8S                          17690000
177000*     //JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR                     17700000
177100*     //PS020    EXEC SUK9011                                     17710001
177200*     //S010.SYSUT1 DD *                                          17720000
177300*     XXXXXXXXX                                                   17730000
177400*     //S035.SYSUT1 DD *                                          17740000
177500*     PPPPPPPPI0 C                                                17750000
177600*     //$AUTO    EXEC PGM=$A,COND=(0,LE),PARM='>'                 17760000
177700*     /*EOF                                                       17770000
177800*-----------------------------------------------------------------17780000
177900* TEST JCL SETUP                                                  17790000
178000*     //XXXXXXXQ JOB KOHLS,'CRTN PKD QURY',MSGCLASS=X,CLASS=E     17800001
178100*     //JOBOUT01 OUTPUT FORMS=STD,FCB=8S                          17810000
178200*     //JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR                     17820000
178300*     //PS020    EXEC SUK9011T                                    17830001
178400*     //S010.SYSUT1 DD *                                          17840000
178500*     XXXXXXXXX                                                   17850000
178600*     //S035.SYSUT1 DD *                                          17860000
178700*     PPPPPPPPI0 C                                                17870000
178800*     //$AUTO    EXEC PGM=$A,COND=(0,LE),PARM='>'                 17880000
178900*     /*EOF                                                       17890000
179000*-----------------------------------------------------------------17900000
179100                                                                  17910000
179200     IF PV-PROD-CICS                                              17920000
179300          MOVE JL-JOB-LINE-PROD       TO  JL-JCL-LINE-1           17930000
179400          MOVE JL-JCL-LINE-1          TO  TD-JCL-LINE             17940000
179500          PERFORM 9100-WRITE-TD-LINE                              17950000
179600          MOVE JL-JCL-LINE-3          TO  TD-JCL-LINE             17960000
179700          PERFORM 9100-WRITE-TD-LINE                              17970000
179800          MOVE JL-JCL-LINE-4-PROD     TO  TD-JCL-LINE             17980000
179900          PERFORM 9100-WRITE-TD-LINE                              17990000
180000          MOVE PV-JOB-PROC            TO  JL-LINE-12-PROC         18000000
180100          MOVE ' '                    TO  JL-LINE-12-PROC-T       18010000
180200          MOVE JL-JCL-LINE-12         TO  TD-JCL-LINE             18020000
180300          PERFORM 9100-WRITE-TD-LINE                              18030000
180400     ELSE                                                         18040000
180500        IF PV-TEST-CICS                                           18050000
180600           MOVE DP020-USERID           TO  JL-TEST-JOB-NAME       18060000
180700           MOVE JL-JOB-LINE-TEST       TO  JL-JCL-LINE-1          18070000
180800           MOVE JL-JCL-LINE-1          TO  TD-JCL-LINE            18080000
180900           PERFORM 9100-WRITE-TD-LINE                             18090000
181000                                                                  18100000
181100           MOVE JL-JCL-LINE-4-TEST     TO  TD-JCL-LINE            18110000
181200           PERFORM 9100-WRITE-TD-LINE                             18120000
181300           MOVE PV-JOB-PROC            TO  JL-LINE-12-PROC        18130000
181400           MOVE PC-TEST                TO  JL-LINE-12-PROC-T      18140000
181500           MOVE JL-JCL-LINE-12         TO  TD-JCL-LINE            18150000
181600           PERFORM 9100-WRITE-TD-LINE                             18160000
181700        ELSE                                                      18170000
181800           IF PV-QA-CICS                                          18180000
181900              MOVE DP020-USERID           TO  JL-TEST-JOB-NAME    18190000
182000              MOVE JL-JOB-LINE-TEST       TO  JL-JCL-LINE-1       18200000
182100              MOVE JL-JCL-LINE-1          TO  TD-JCL-LINE         18210000
182200              PERFORM 9100-WRITE-TD-LINE                          18220000
182300              MOVE JL-JCL-LINE-4-QA       TO  TD-JCL-LINE         18230000
182400              PERFORM 9100-WRITE-TD-LINE                          18240000
182500                                                                  18250000
182600              MOVE PV-JOB-PROC            TO  JL-LINE-12-PROC     18260000
182700              MOVE PC-QA                  TO  JL-LINE-12-PROC-T   18270000
182800              MOVE JL-JCL-LINE-12         TO  TD-JCL-LINE         18280000
182900              PERFORM 9100-WRITE-TD-LINE                          18290000
183000           ELSE                                                   18300000
183100              IF PV-LEARN-CICS                                    18310000
183200                 MOVE DP020-USERID           TO  JL-TEST-JOB-NAME 18320000
183300                 MOVE JL-JOB-LINE-TEST       TO  JL-JCL-LINE-1    18330000
183400                 MOVE JL-JCL-LINE-1          TO  TD-JCL-LINE      18340000
183500                 PERFORM 9100-WRITE-TD-LINE                       18350000
183600                                                                  18360000
183700                 MOVE JL-JCL-LINE-4-LEARN    TO  TD-JCL-LINE      18370000
183800                 PERFORM 9100-WRITE-TD-LINE                       18380000
183900                 MOVE PV-JOB-PROC            TO  JL-LINE-12-PROC  18390000
184000                 MOVE PC-LEARN               TO  JL-LINE-12-PROC-T18400000
184100                 MOVE JL-JCL-LINE-12         TO  TD-JCL-LINE      18410000
184200                 PERFORM 9100-WRITE-TD-LINE                       18420000
184300              END-IF                                              18430000
184400           END-IF                                                 18440000
184500        END-IF                                                    18450000
184600     END-IF.                                                      18460000
184700                                                                  18470000
184800     MOVE JL-JCL-LINE-14              TO  TD-JCL-LINE.            18480000
184900     PERFORM 9100-WRITE-TD-LINE.                                  18490000
185000                                                                  18500000
185100     MOVE JL-LINE-15-PO-NBR           TO  JL-LINE-15-PO-NBR.      18510000
185200     MOVE JL-JCL-LINE-15              TO  TD-JCL-LINE.            18520000
185300     PERFORM 9100-WRITE-TD-LINE.                                  18530000
185400                                                                  18540000
185500     MOVE JL-JCL-LINE-EOF             TO  TD-JCL-LINE.            18550000
185600     PERFORM 9100-WRITE-TD-LINE.                                  18560000
185700                                                                  18570000
185800     PERFORM 9600-DEQUEUE-INTERNAL-READER.                        18580000
185900                                                                  18590000
186000*----------------------------------------------------------------*18600000
186100*  WRITE A JCL LINE TO THE TRANSIENT DATA QUEUE FOR THE INTERNAL *18610000
186200*  READER.  ON ANY ERROR, DEQUEUE THE INTERNAL READER, DELETE    *18620000
186300*  THE TEMPORARY STORAGE QUEUE (TO PREVENT OLD REQUEST           *18630000
186400*  INFORMATION FROM ACCIDENTALLY APPEARING ON A FUTURE REQUEST), *18640000
186500*  FORMAT AND DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE     *18650000
186600*  CICS.                                                         *18660000
186700*----------------------------------------------------------------*18670000
186800 9100-WRITE-TD-LINE.                                              18680000
186900     EXEC CICS                                                    18690000
187000         WRITEQ TD                                                18700000
187100             QUEUE(TD-QUEUE-NAME)                                 18710000
187200             FROM(TD-JCL-LINE)                                    18720000
187300             LENGTH(TD-JCL-LINE-LENGTH)                           18730000
187400             RESP(PV-CICS-RESPONSE)                               18740000
187500     END-EXEC.                                                    18750000
187600                                                                  18760000
187700     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    18770000
187800         SET PS-ABEND-IN-PROGRESS TO TRUE                         18780000
187900         STRING 'WRITE TO TRANSIENT DATA QUEUE '                  18790000
188000                                                DELIMITED BY SIZE 18800000
188100                TD-QUEUE-NAME                   DELIMITED BY SIZE 18810000
188200                ' (INTERNAL READER)'            DELIMITED BY SIZE 18820000
188300             INTO SE-ATTEMPTED-ACTION                             18830000
188400         MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE                18840000
188500         MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE  18850000
188600         PERFORM 9600-DEQUEUE-INTERNAL-READER                     18860000
188700         PERFORM 9900-LEAVE-SYSTEM                                18870000
188800     END-IF.                                                      18880000
188900                                                                  18890000
189000                                                                  18900000
189100*----------------------------------------------------------------*18910000
189200*  ENQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *18920000
189300*  THIS WILL PREVENT INTERLEAVING OF JCL SUBMITTED CONCURRENTLY  *18930000
189400*  BY MULTIPLE USERS.  IF THE QUEUE IS BUSY, THIS PROGRAM WILL   *18940000
189500*  WAIT TO ENQUEUE IT, BY NOT SPECIFICALLY HANDLING THE QBUSY    *18950000
189600*  CONDITION.  IF ANY OTHER ERRORS OCCUR, DELETE THE TEMPORARY   *18960000
189700*  STORAGE QUEUE (TO PREVENT OLD REQUEST INFORMATION FROM        *18970000
189800*  ACCIDENTALLY APPEARING ON A FUTURE REQUEST), FORMAT AND       *18980000
189900*  DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE CICS.          *18990000
190000*----------------------------------------------------------------*19000000
190100 9500-ENQUEUE-INTERNAL-READER.                                    19010000
190200     EXEC CICS                                                    19020000
190300         ENQ                                                      19030000
190400             RESOURCE(TD-QUEUE-NAME)                              19040000
190500             LENGTH(TD-QUEUE-NAME-LENGTH)                         19050000
190600             RESP(PV-CICS-RESPONSE)                               19060000
190700     END-EXEC.                                                    19070000
190800                                                                  19080000
190900     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    19090000
191000         SET PS-ABEND-IN-PROGRESS TO TRUE                         19100000
191100         STRING 'ENQUEUE '            DELIMITED BY SIZE           19110000
191200                TD-QUEUE-NAME         DELIMITED BY SIZE           19120000
191300                ' (INTERNAL READER)'  DELIMITED BY SIZE           19130000
191400             INTO SE-ATTEMPTED-ACTION                             19140000
191500         MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE                19150000
191600         MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE  19160000
191700         PERFORM 9900-LEAVE-SYSTEM                                19170000
191800     END-IF.                                                      19180000
191900                                                                  19190000
192000     SET PS-INTERNAL-READER-ENQUEUED TO TRUE.                     19200000
192100                                                                  19210000
192200                                                                  19220000
192300*----------------------------------------------------------------*19230000
192400*  DEQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *19240000
192500*  THIS SHOULD BE DONE FOLLOWING A SUCCESSFUL REPORT REQUEST     *19250000
192600*  SUBMISSION, A CANCELLATION OF THE CURRENT REPORT REQUEST, OR  *19260000
192700*  ANY DETECTED ABENDS.  THIS WILL FREE UP THE INTERNAL READER   *19270000
192800*  FOR THE NEXT USER.  IF ANY ERRORS OCCUR, CHECK TO SEE IF      *19280000
192900*  ANY OTHER ABEND SITUATIONS HAVE ALREADY OCCURRED.  IF SO, DO  *19290000
193000*  NOT FORCE THE ABEND FOR THIS ERROR, AND ALLOW PROGRAM CONTROL *19300000
193100*  TO RETURN TO THE POINT WHERE THE FIRST ABEND OCCURRED, AND    *19310000
193200*  DISPLAY THE MESSAGE RELATING TO THAT ABEND.  IF NOT, DELETE   *19320000
193300*  THE TEMPORARY STORAGE QUEUE (TO PREVENT OLD REQUEST           *19330000
193400*  INFORMATION FROM ACCIDENTALLY APPEARING ON A FUTURE REQUEST), *19340000
193500*  FORMAT AND DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE     *19350000
193600*  CICS.                                                         *19360000
193700*----------------------------------------------------------------*19370000
193800 9600-DEQUEUE-INTERNAL-READER.                                    19380000
193900     SET PS-INTERNAL-READER-DEQUEUED TO TRUE.                     19390000
194000                                                                  19400000
194100     EXEC CICS                                                    19410000
194200         DEQ                                                      19420000
194300             RESOURCE(TD-QUEUE-NAME)                              19430000
194400             LENGTH(TD-QUEUE-NAME-LENGTH)                         19440000
194500             RESP(PV-CICS-RESPONSE)                               19450000
194600     END-EXEC.                                                    19460000
194700                                                                  19470000
194800     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    19480000
194900         IF PS-NO-ABEND-IN-PROGRESS                               19490000
195000             SET PS-ABEND-IN-PROGRESS TO TRUE                     19500000
195100             STRING 'DEQUEUE '            DELIMITED BY SIZE       19510000
195200                    TD-QUEUE-NAME         DELIMITED BY SIZE       19520000
195300                    ' (INTERNAL READER)'  DELIMITED BY SIZE       19530000
195400                 INTO SE-ATTEMPTED-ACTION                         19540000
195500             MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE            19550000
195600             MOVE SE-SYSTEM-ERROR-MESSAGE TO                      19560000
195700                       PV-LEAVE-SYSTEM-MESSAGE                    19570000
195800             PERFORM 9900-LEAVE-SYSTEM                            19580000
195900         END-IF                                                   19590000
196000     END-IF.                                                      19600000
196100                                                                  19610000
196200                                                                  19620000
196300*----------------------------------------------------------------*19630000
196400*  EXIT THE SHIPT UNIT REPORT REQUEST SYSTEM, DISPLAYING A       *19640000
196500*  REASON FOR THE PROGRAM ABEND.                                 *19650000
196600*----------------------------------------------------------------*19660000
196700 9900-LEAVE-SYSTEM.                                               19670000
196800     EXEC CICS                                                    19680000
196900         SEND                                                     19690000
197000             FROM(PV-LEAVE-SYSTEM-MESSAGE)                        19700000
197100             LENGTH(PC-LEAVE-SYSTEM-LENGTH)                       19710000
197200             ERASE                                                19720000
197300     END-EXEC.                                                    19730000
197400                                                                  19740000
197500     EXEC CICS                                                    19750000
197600         RETURN                                                   19760000
197700     END-EXEC.                                                    19770000
197800                                                                  19780000
197900                                                                  19790000
198000                                                                  19800000
