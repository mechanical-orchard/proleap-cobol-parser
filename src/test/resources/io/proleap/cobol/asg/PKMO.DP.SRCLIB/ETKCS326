000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    ETKCS326.                                         00040000
000500 AUTHOR.        TROY BIRK.                                        00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  JULY 1994.                                        00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000******************************************************************00100000
001100* PROGRAM NUMBER: ETKCS326       SYSTEM: ET     LANGUAGE: COBOL II00110000
001200*                                                                 00120000
001300* TRANID:  E326   MNEMONIC:  ETLINTER           MAP: ETKM326      00130000
001400*                                                                 00140000
001500* PROGRAM NAME : EDI TRANSMISSION ERROR LIST                      00150000
001600*                                                                 00160000
001700* ORIGINAL WORK REQUEST #: 2026                                   00170000
001800*                                                                 00180000
001900* PROGRAM OBJECTIVE:                                              00190000
002000*                                                                 00200000
002100*   TO LIST ALL ERRORS FOR AN INTERCHANGE TRANMISSION.            00210000
002200*                                                                 00220000
002300* DATASETS USED:                                                  00230000
002400*  DSN                                 COPY USED  I/O  VSAM?  DB? 00240000
002500* --------------------------------    ----------- ---- -----  --- 00250000
002600*  TINTERR                             TINTERR     I     N    DB2 00260000
002700*                                                                 00270000
002800* PROGRAM NARRATIVE:                                              00280000
002900*                                                                 00290000
003000*   THIS SCREEN IS ACCESSED FROM THE TRANSMISSION LIST (ETLINTXM).00300000
003100*   A SELECTION QUEUE IS PASSED TO THIS PROGRAM CONTAINING        00310000
003200*   THE DATALESS KEY OF THE ITEM SELECTED FROM THE PREVIOUS LIST. 00320000
003300*   A CURSOR IS OPENED RETRIEVING ALL ROWS FROM THE TINTERR TABLE 00330000
003400*   FOR THE GIVEN DATALESS KEY. IF F19/F20 (PREV/NEXT SELECTION)  00340000
003500*   IS HIT, A NEW ITEM IS PULLED FROM THE SELECTION QUEUE AND     00350000
003600*   A NEW LIST IS BUILT.                                          00360000
003700*                                                                 00370000
003800*   FROM THIS LIST, THE USER IS NOT ABLE TO SELECT INDIVIDUAL     00380000
003900*   ITEMS. HOWEVER, THE USER IS ABLE TO VIEW OR UPDATE NOTES      00390000
004000*   ABOUT THE TRANMISSION ERROR BY HITTING F14 (VIEW) OR F15      00400000
004100*   (UPDATE).                                                     00410000
004200*                                                                 00420000
004300* CONTROL CARD REQUIREMENTS: N/A                                  00430000
004400* JOBS PROGRAM IS FOUND IN:  N/A                                  00440000
004500* REPORTS PRODUCED:          N/A                                  00450000
004600*                                                                 00460000
004700***************************************************************** 00470000
004800* CHANGES:                                                        00480000
004900*   DATE 12/05/94                                                 00490000
005000*   CHANGED ORDER OF LIST FROM SEG_SEQ_NBR TO REJ_SEQ_NBR BUT___  00500000
005100*   KEPT DISPLAYING SEG_SEQ_NBR ON THE SCREEN.__________________  00510000
005200*   MADE BY: STEVE FLUNKER________   WR/IR #: 3138______________  00520000
005300***************************************************************** 00530000
005310* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00531002
005320*            - CHANGE CALL OF DPKUT100 TO                       * 00532002
005330*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00533002
005340*              MAKING THE CALL DYNAMIC VS STATIC                * 00534002
005350*                                                               * 00535002
005360*---------------------------------------------------------------* 00536002
CICS  *  CHANGED 10/26/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00537003
CICS  *                                                               * 00538003
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00539003
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00539103
005350*                                                               * 00539203
005360*---------------------------------------------------------------* 00539303
005400 EJECT                                                            00540000
005500 ENVIRONMENT DIVISION.                                            00550000
005600                                                                  00560000
005700 DATA DIVISION.                                                   00570000
005800                                                                  00580000
005900 WORKING-STORAGE SECTION.                                         00590000
006000                                                                  00600000
006100 01  PC-PROGRAM-CONSTANTS.                                        00610000
006200     05  PC-ITEM-NUMBER-LENGTH          PIC S9(04)  VALUE +5      00620000
006300                                                    COMP SYNC.    00630000
006400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00640000
006500                                                    'ET326A  '.   00650000
006600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00660000
006700                                                    'ETKM326 '.   00670000
006800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00680000
006900                                                    'ETKCS326'.   00690000
007000     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00700000
007100     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00710000
007200     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     00720000
007300                                                    COMP SYNC.    00730000
007400     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00740000
007500                                                    COMP SYNC.    00750000
007600     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00760000
007700                                                    +1000000      00770000
007800                                                    COMP-3.       00780000
007900*                                                                 00790000
008000     05  PC-TSYMSG-NUMBERS.                                       00800000
008100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00810000
008200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00820000
008300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00830000
008400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00840000
008500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00850000
008600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00860000
008700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00870000
008800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00880000
008900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00890000
009000         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00900000
009100         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00910000
009200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00920000
009300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00930000
009400         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  00940000
009500         10  PC-TSYMSG-00831            PIC  9(05)  VALUE 00831.  00950000
009600*                                                                 00960000
009700 01  PS-PROGRAM-SWITCHES.                                         00970000
009800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00980000
009900         88  PS-NO-ERROR                            VALUE 'Y'.    00990000
010000         88  PS-ERROR                               VALUE 'N'.    01000000
010100     05  PS-LIST-END-SW            PIC X       VALUE 'N'.         01010000
010200         88  PS-LIST-END                       VALUE 'Y'.         01020000
010300         88  PS-NO-LIST-END                    VALUE 'N'.         01030000
010400     05  PS-START-ITEM-ERROR-SW         PIC  X(01)  VALUE 'Y'.    01040000
010500         88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.    01050000
010600         88  PS-START-ITEM-ERROR                    VALUE 'N'.    01060000
010700*                                                                 01070000
010800 01  PV-PROGRAM-VARIABLES.                                        01080000
010900     05  PV-SUB                         PIC S9(04)  VALUE +0      01090000
011000                                                    COMP SYNC.    01100000
011100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01110000
011200                                                    COMP SYNC.    01120000
011300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01130000
011400                                                    COMP-3.       01140000
011500     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01150000
011600                                                    COMP-3.       01160000
011700     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01170000
011800                                                    COMP-3.       01180000
011900     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01190000
012000                                                    COMP-3.       01200000
012100     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01210000
012200                                                    COMP-3.       01220000
012300     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01230000
012400                                                    COMP-3.       01240000
012500     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01250000
012600                                                    COMP-3.       01260000
012700     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01270000
012800                                                    COMP SYNC.    01280000
012900     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01290000
013000                                                    COMP SYNC.    01300000
013100     05  PV-ITEM                        PIC S9(04)  VALUE +0      01310000
013200                                                    COMP SYNC.    01320000
013300     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01330000
013400                                                    COMP SYNC.    01340000
013500     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01350000
013600                                                    COMP SYNC.    01360000
013700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01370000
013800                                                    COMP SYNC.    01380000
013900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01390000
014000                                                    COMP SYNC.    01400000
014100     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01410000
014200                                                    COMP SYNC.    01420000
014300     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01430000
014400                                                    COMP SYNC.    01440000
014500     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01450000
014600                                                    COMP SYNC.    01460000
014700     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01470000
014800                                                    COMP SYNC.    01480000
014900     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01490000
015000                                                    COMP SYNC.    01500000
015100     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01510000
015200                                                    COMP SYNC.    01520000
015300     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01530000
015400                                                    COMP SYNC.    01540000
015500     05  PV-SUM-ITM-EXTD-AMT            PIC S9(7)V99              01550000
015600                                                    COMP-3.       01560000
015700     05  PV-BEGIN-DT.                                             01570000
015800         10  PV-BEGIN-YYYY              PIC X(04)  VALUE SPACES.  01580000
015900         10  FILLER                     PIC X(01)  VALUE '-'.     01590000
016000         10  PV-BEGIN-MM                PIC X(02)  VALUE SPACES.  01600000
016100         10  FILLER                     PIC X(01)  VALUE '-'.     01610000
016200         10  PV-BEGIN-DD                PIC X(02)  VALUE SPACES.  01620000
016300     05  PV-BEGIN-DATE REDEFINES PV-BEGIN-DT PIC X(10).           01630000
016400     05  PV-END-DT.                                               01640000
016500         10  PV-END-YYYY                PIC X(04)  VALUE SPACES.  01650000
016600         10  FILLER                     PIC X(01)  VALUE '-'.     01660000
016700         10  PV-END-MM                  PIC X(02)  VALUE SPACES.  01670000
016800         10  FILLER                     PIC X(01)  VALUE '-'.     01680000
016900         10  PV-END-DD                  PIC X(02)  VALUE SPACES.  01690000
017000     05  PV-END-DATE REDEFINES PV-END-DT PIC X(10).               01700000
017100     05  PV-CONVERT-DATE.                                         01710000
017200         10  PV-CONVERT-MM              PIC X(02)  VALUE SPACES.  01720000
017300         10  PV-DASH1                   PIC X(01)  VALUE '-'.     01730000
017400         10  PV-CONVERT-DD              PIC X(02)  VALUE SPACES.  01740000
017500         10  PV-DASH2                   PIC X(01)  VALUE '-'.     01750000
017600         10  PV-CONVERT-YY              PIC X(02)  VALUE SPACES.  01760000
017700*                                                                 01770000
017800******************************************************************01780000
017900**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01790000
018000**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01800000
018100**  APPLICATION-SPECIFIC COMMAREA.                              **01810000
018200******************************************************************01820000
018300 01  LQW-LIST-QUEUE-WORK-AREA.                                    01830000
018400     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01840000
018500     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           01850000
018600                                        INDEXED BY LQW-IDX.       01860000
018700         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01870000
018800         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01880000
018900         10  LQW-SELECTED-SW            PIC  X(01).               01890000
019000             88  LQW-SELECT                         VALUE 'S'.    01900000
019100             88  LQW-DESELECT                       VALUE ' '.    01910000
019200         10  LQW-ACTION                 PIC  X(01).               01920000
019300         10  LQW-ENT-ID             PIC  S9(9) COMP.              01930000
019400         10  LQW-VENDOR-NAME        PIC  X(30).                   01940000
019500         10  LQW-TP-DKEY            PIC  S9(9) COMP.              01950000
019600         10  LQW-TP-DKEY-TMST       PIC  X(26).                   01960000
019700                                                                  01970000
019800     EJECT                                                        01980000
019900*---------------------------------------------------------------* 01990000
020000*  RECORD LAYOUT FOR THE SELECTION                                02000000
020100*  TEMP STORAGE QUEUE.                                          * 02010000
020200*---------------------------------------------------------------* 02020000
020300     COPY ETWS308.                                                02030000
020400                                                                  02040000
020500     EJECT                                                        02050000
020600*---------------------------------------------------------------* 02060000
020700*    MAP LAYOUT                                                 * 02070000
020800*---------------------------------------------------------------* 02080000
020900                                                                  02090000
021000     COPY ETKM326.                                                02100000
021100*                                                                 02110000
021200 01  MR-OCCURS-LAYOUT                   REDEFINES  ET326AO.       02120000
021300     05  FILLER                         PIC X(42).                02130000
021400                                                                  02140000
021500     05  MR-VENDOR-NAMEL                PIC S9(04) COMP.          02150000
021600     05  MR-VENDOR-NAMEA                PIC  X(01).               02160000
021700     05  MR-VENDOR-NAMEC                PIC  X(01).               02170000
021800     05  MR-VENDOR-NAMEH                PIC  X(01).               02180000
021900     05  MR-VENDOR-NAME                 PIC  X(30).               02190000
022000                                                                  02200000
022100     05  MR-INT-CONTROL-NUML            PIC S9(04) COMP.          02210000
022200     05  MR-INT-CONTROL-NUMA            PIC  X(01).               02220000
022300     05  MR-INT-CONTROL-NUMC            PIC  X(01).               02230000
022400     05  MR-INT-CONTROL-NUMH            PIC  X(01).               02240000
022500     05  MR-INT-CONTROL-NUM             PIC  X(09).               02250000
022600                                                                  02260000
022700     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          02270000
022800                                                                  02280000
022900         10  MR-ERROR-TEXTL             PIC S9(04) COMP.          02290000
023000         10  MR-ERROR-TEXTA             PIC  X(01).               02300000
023100         10  MR-ERROR-TEXTC             PIC  X(01).               02310000
023200         10  MR-ERROR-TEXTH             PIC  X(01).               02320000
023300         10  MR-ERROR-TEXT              PIC  X(54).               02330000
023400                                                                  02340000
023500         10  MR-SEGMENT-IDL            PIC S9(04) COMP.           02350000
023600         10  MR-SEGMENT-IDA            PIC  X(01).                02360000
023700         10  MR-SEGMENT-IDC            PIC  X(01).                02370000
023800         10  MR-SEGMENT-IDH            PIC  X(01).                02380000
023900         10  MR-SEGMENT-ID             PIC  X(03).                02390000
024000                                                                  02400000
024100         10  MR-SEQUENCE-NUML          PIC S9(04) COMP.           02410000
024200         10  MR-SEQUENCE-NUMA          PIC  X(01).                02420000
024300         10  MR-SEQUENCE-NUMC          PIC  X(01).                02430000
024400         10  MR-SEQUENCE-NUMH          PIC  X(01).                02440000
024500         10  MR-SEQUENCE-NUM           PIC  X(05).                02450000
024600                                                                  02460000
024700                                                                  02470000
024800     EJECT                                                        02480000
024900*---------------------------------------------------------------* 02490000
025000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02500000
025100*---------------------------------------------------------------* 02510000
025200                                                                  02520000
025300     COPY DPWS015.                                                02530000
025400                                                                  02540000
025500*---------------------------------------------------------------* 02550000
025600*    FUNCTION KEYS COPYBOOK.                                    * 02560000
025700*---------------------------------------------------------------* 02570000
025800                                                                  02580000
025900     COPY DPWS016.                                                02590000
026000                                                                  02600000
026100*---------------------------------------------------------------* 02610000
026200*    NUMERIC EDIT LAYOUT.                                       * 02620000
026300*---------------------------------------------------------------* 02630000
026400                                                                  02640000
026500     COPY DPWS010I.                                               02650000
026600 EJECT                                                            02660000
026700*---------------------------------------------------------------* 02670000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02680003
026900*---------------------------------------------------------------* 02690000
027000                                                                  02700000
027100     COPY DPWS030.                                                02710000
CICS       COPY DPWS930.                                                02711003
027200 EJECT                                                            02720000
027300*---------------------------------------------------------------* 02730000
027400*    STANDARD COMMAREA.                                         * 02740000
027500*---------------------------------------------------------------* 02750000
027600                                                                  02760000
027700     COPY DPWS020.                                                02770000
027800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02780000
027900                                                                  02790000
028000*---------------------------------------------------------------* 02800000
028100*  INTER-APPLICATION COMMAREA                                     02810000
028200*---------------------------------------------------------------* 02820000
028300                                                                  02830000
028400         10  INTER-APPL-COMM-AREA       PIC X(200).               02840000
028500     COPY ETWS307.                                                02850000
028600*---------------------------------------------------------------* 02860000
028700*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02870000
028800*---------------------------------------------------------------* 02880000
028900         10  ASC-SPECIFIC-COMMAREA.                               02890000
029000             15  ASC-INT-CONTROL-NUMBER PIC  S9(9) COMP.          02900000
029100             15  ASC-VENDOR-NAME        PIC  X(30).               02910000
029200             15  ASC-TP-DKEY            PIC  S9(9) COMP.          02920000
029300             15  ASC-TP-DKEY-TMST       PIC  X(26).               02930000
029400             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02940000
029500                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02950000
029600                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02960000
029700                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02970000
029800                                                                  02980000
029900                 20  ASC-ITEM-ARRAY.                              02990000
030000                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        03000000
030100                         30  ASC-LIST-ITEM-NUMBER                 03010000
030200                                                     PIC S9(09)   03020000
030300                                                     COMP-3.      03030000
030400                         30  ASC-ERROR-TEXT          PIC X(54).   03040000
030500                         30  ASC-SEGMENT-ID          PIC X(03).   03050000
030600                         30  ASC-SEQUENCE-NUM        PIC 9(05).   03060000
030700                                                                  03070000
030800             15  ASC-BLK-SUB                         PIC S9(04)   03080000
030900                                                          COMP    03090000
031000                                                          SYNC.   03100000
031100             15  ASC-NUMBER-OF-TS-ITEMS      PIC S9(05) COMP-3.   03110000
031200             15  ASC-SEL-SUB                 PIC S9(04) COMP.     03120000
031300             15  ASC-SEL-ITEM                PIC S9(04) COMP.     03130000
031400             15  ASC-ITEM-SUB                        PIC S9(04)   03140000
031500                                                          COMP    03150000
031600                                                          SYNC.   03160000
031700             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03170000
031800                                                          COMP-3. 03180000
031900             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03190000
032000                                                          COMP-3. 03200000
032100             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03210000
032200                                                          COMP-3. 03220000
032300             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03230000
032400                                                          COMP-3. 03240000
032500             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03250000
032600                                                          COMP-3. 03260000
032700             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03270000
032800                                                          COMP    03280000
032900                                                          SYNC.   03290000
033000             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03300000
033100                                                          COMP-3. 03310000
033200             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03320000
033300                                                          COMP-3. 03330000
033400             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03340000
033500                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03350000
033600                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03360000
033700             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03370000
033800                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03380000
033900                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03390000
034000             15  ASC-LIST-QUEUE-NAME.                             03400000
034100                 20  ASC-LIST-TERM-ID                PIC  X(04).  03410000
034200                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03420000
034300                                                          COMP-3. 03430000
034400                 20  ASC-LIST-SEQ                    PIC  9(01).  03440000
034500             15  ASC-SEL-QUEUE-NAME.                              03450000
034600                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03460000
034700                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03470000
034800                                                          COMP-3. 03480000
034900                 20  ASC-SEL-SEQ                     PIC  9(01).  03490000
035000                                                                  03500000
035100             15  ASC-START-ITEM-REQUEST.                          03510000
035200                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03520000
035300             15  FILLER                              PIC X(1255). 03530000
035400     EJECT                                                        03540000
035500*---------------------------------------------------------------* 03550000
035600*    ABEND PROCESSING COPYBOOK.                                 * 03560000
035700*---------------------------------------------------------------* 03570000
035800                                                                  03580000
035900     COPY DPWS013.                                                03590000
036000                                                                  03600000
036100 EJECT                                                            03610000
036200*                                                                 03620000
036300*---------------------------------------------------------------* 03630000
036400*    DCLGEN FOR EDI FUNCTIONAL GROUP DB                           03640000
036500*---------------------------------------------------------------* 03650000
036600     EXEC SQL                                                     03660000
036700          INCLUDE TINTERR                                         03670000
036800     END-EXEC.                                                    03680000
036900*                                                                 03690000
037000*---------------------------------------------------------------* 03700000
037100*    DB2 AREA FOR COMMUNICATIONS                                * 03710000
037200*---------------------------------------------------------------* 03720000
037300     EXEC SQL                                                     03730000
037400          INCLUDE SQLCA                                           03740000
037500     END-EXEC.                                                    03750000
037600                                                                  03760000
037700*---------------------------------------------------------------* 03770000
037800*                                                                 03780000
037900*---------------------------------------------------------------* 03790000
038000     EXEC SQL                                                     03800000
038100         DECLARE  CURSOR_ONE   CURSOR FOR                         03810000
038200         SELECT   ERR_MSG_DESC,                                   03820000
038300                  SEG_ID,                                         03830000
038400                  SEQ_SEQ_NBR,                                    03840000
038500                  REJ_SEQ_NBR                                     03850000
038600         FROM     TINTERR                                         03860000
038700         WHERE  (TP_DKEY   = :ASC-TP-DKEY)              AND       03870000
038800                (TP_DKEY_TMST = :ASC-TP-DKEY-TMST)                03880000
038900         ORDER BY REJ_SEQ_NBR                                     03890000
039000     END-EXEC.                                                    03900000
039100                                                                  03910000
039200                                                                  03920000
039300 EJECT                                                            03930000
039400 LINKAGE SECTION.                                                 03940000
039500                                                                  03950000
039600 01  DFHCOMMAREA.                                                 03960000
039700     05  FILLER                         OCCURS  1 TO 4072 TIMES   03970000
039800                                        DEPENDING ON EIBCALEN.    03980000
039900         10  FILLER                     PIC X.                    03990000
040000                                                                  04000000
040100 EJECT                                                            04010000
040200 PROCEDURE DIVISION.                                              04020000
040300******************************************************************04030000
040400**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04040000
040500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04050000
040600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04060000
040700******************************************************************04070000
040800 0000-MAIN-MODULE.                                                04080000
040900     INITIALIZE DP030-CICS-API-FIELDS.                            04090000
041000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04100000
041100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04110000
041200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04120000
041300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04130000
041400     MOVE LENGTH OF ET326AI        TO DP030-MAP-LENGTH (1).       04140000
041500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04150000
041600     PERFORM 0001-CALL-CICS-ARCH-API.                             04160000
041700*                                                                 04170000
041800     PERFORM 1000-CONTROL-PROCESSING                              04180000
041900*                                                                 04190000
042000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04200000
042100     PERFORM 0001-CALL-CICS-ARCH-API.                             04210000
042200                                                                  04220000
042300******************************************************************04230000
042400**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04240000
042500**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04250000
042600******************************************************************04260000
042700 0001-CALL-CICS-ARCH-API.                                         04270000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04280003
042900                                    DFHCOMMAREA                   04290003
043000                                    DP030-CICS-API-FIELDS         04300003
043100                                    DP020-STANDARD-COMMAREA       04310003
043200                                    ET326AI.                      04320003
043300*                                                                 04330000
043400     IF  DP030-RC-CALL-SUCCESSFUL                                 04340000
043500         CONTINUE                                                 04350000
043600     ELSE                                                         04360000
043700         SET DP013-NO-ROLLBACK                                    04370000
043800             DP013-XCTL-DISPLAY-RESTART                           04380000
043900             DP013-CICS-ABEND      TO TRUE                        04390000
044000         MOVE '0001-CALL-CICS-ARCH-API'                           04400000
044100                                   TO DP013-PARAGRAPH             04410000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04420003
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04430003
044400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04440000
044500         PERFORM DP013-0000-PROCESS-ABEND                         04450000
044600     END-IF.                                                      04460000
044700*----------------------------------------------------------------*04470000
044800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04480000
044900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04490000
045000*                                                                 04500000
045100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04510000
045200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04520000
045300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04530000
045400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04540000
045500*----------------------------------------------------------------*04550000
045600                                                                  04560000
045700 1000-CONTROL-PROCESSING.                                         04570000
045800                                                                  04580000
045900     EVALUATE TRUE                                                04590000
046000         WHEN DP020-NEXT-ACT-INITIAL                              04600000
046100             INITIALIZE ASC-SPECIFIC-COMMAREA                     04610000
046200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04620000
046300                                      ASC-SEL-TERM-ID             04630000
046400             MOVE DP020-SRC-TASK-NUMBER                           04640000
046500                                   TO ASC-LIST-TASK-NUMBER        04650000
046600                                      ASC-SEL-TASK-NUMBER         04660000
046700             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               04670000
046800             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                04680000
046900             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04690000
047000             IF PS-NO-ERROR                                       04700000
047100                 PERFORM 4000-BUILD-INITIAL-PANEL                 04710000
047200             END-IF                                               04720000
047300                                                                  04730000
047400         WHEN DP020-NEXT-ACT-READ-MAP                             04740000
047500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04750000
047600                                   TO PV-TOP-ITEM                 04760000
047700             PERFORM 2000-PROCESS-PANEL                           04770000
047800                                                                  04780000
047900         WHEN DP020-NEXT-ACT-RETURN                               04790000
048000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04800000
048100                                   TO PV-TOP-ITEM                 04810000
048200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04820000
048300*            PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 04830000
048400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04840000
048500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04850000
048600                                                                  04860000
048700         WHEN OTHER                                               04870000
048800             SET DP013-LOGIC-ABEND TO TRUE                        04880000
048900             SET DP013-NO-ROLLBACK TO TRUE                        04890000
049000             MOVE '1000-CONTROL-PROCESSING'                       04900000
049100                                   TO DP013-PARAGRAPH             04910000
049200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04920000
049300                                   TO DP013-MESSAGE-TEXT(1)       04930000
049400             PERFORM DP013-0000-PROCESS-ABEND                     04940000
049500     END-EVALUATE.                                                04950000
049600                                                                  04960000
049700 EJECT                                                            04970000
049800*----------------------------------------------------------------*04980000
049900* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *04990000
050000* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05000000
050100*----------------------------------------------------------------*05010000
050200                                                                  05020000
050300 1100-PROCESS-INTER-APPL-COMM.                                    05030000
050400                                                                  05040000
050500     MOVE ET307-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS      05050000
050600     MOVE ET307-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME          05060000
050700     MOVE ET308-MAX-ITEMS TO ASC-SEL-SUB                          05070000
050800     MOVE ZERO TO ASC-SEL-ITEM.                                   05080000
050900     PERFORM 2140-GET-NEXT-ITEM.                                  05090000
051000                                                                  05100000
051100 EJECT                                                            05110000
051200*----------------------------------------------------------------*05120000
051300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05130000
051400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05140000
051500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05150000
051600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05160000
051700* FUNCTION KEYS CAN GET THIS FAR.                                *05170000
051800*----------------------------------------------------------------*05180000
051900                                                                  05190000
052000 2000-PROCESS-PANEL.                                              05200000
052100     EVALUATE TRUE                                                05210000
052200         WHEN DP020-SRC-AID = DP016-CLEAR                         05220000
052300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05230000
052400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05240000
052500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05250000
052600                                                                  05260000
052700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05270000
052800             PERFORM 2050-DELETE-LIST-QUEUE                       05280000
052900             PERFORM 4000-BUILD-INITIAL-PANEL                     05290000
053000                                                                  05300000
053100*        WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    05310000
053200*            PERFORM 2140-DESELECT-ALL-ITEMS                      05320000
053300*            PERFORM 3200-RESET-ATTRIBUTES                        05330000
053400*            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05340000
053500*                                                                 05350000
053600*        WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  05360000
053700*            PERFORM 2150-SELECT-ALL-ITEMS                        05370000
053800*            PERFORM 3200-RESET-ATTRIBUTES                        05380000
053900*            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05390000
054000*                                                                 05400000
054100         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             05410000
054200                 PERFORM 2050-DELETE-LIST-QUEUE                   05420000
054300                 PERFORM 2140-GET-NEXT-ITEM                       05430000
054400                 IF PS-LIST-END                                   05440000
054500                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         05450000
054600                     SET PS-NO-LIST-END TO TRUE                   05460000
054700                 ELSE                                             05470000
054800                     PERFORM 4000-BUILD-INITIAL-PANEL             05480000
054900                 END-IF                                           05490000
055000                                                                  05500000
055100         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             05510000
055200                 PERFORM 2050-DELETE-LIST-QUEUE                   05520000
055300                 PERFORM 2150-GET-PREV-ITEM                       05530000
055400                 IF PS-LIST-END                                   05540000
055500                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         05550000
055600                     SET PS-NO-LIST-END TO TRUE                   05560000
055700                 ELSE                                             05570000
055800                     PERFORM 4000-BUILD-INITIAL-PANEL             05580000
055900                 END-IF                                           05590000
056000                                                                  05600000
056100         WHEN OTHER                                               05610000
056200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05620000
056300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05630000
056400             IF  PS-NO-ERROR                                      05640000
056500                 SET DP030-CONTINUE-GO TO TRUE                    05650000
056600                 PERFORM 2100-CHECK-FUNCTION-KEY                  05660000
056700             ELSE                                                 05670000
056800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05680000
056900                 SET DP030-OVERRIDE-GO TO TRUE                    05690000
057000             END-IF                                               05700000
057100     END-EVALUATE.                                                05710000
057200 EJECT                                                            05720000
057300*----------------------------------------------------------------*05730000
057400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05740000
057500*----------------------------------------------------------------*05750000
057600 2050-DELETE-LIST-QUEUE.                                          05760000
057700                                                                  05770000
057800     EXEC CICS                                                    05780000
057900         DELETEQ TS                                               05790000
058000             QUEUE (ASC-LIST-QUEUE-NAME)                          05800000
058100             RESP  (PV-CICS-RESP)                                 05810000
058200     END-EXEC.                                                    05820000
058300                                                                  05830000
058400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05840000
058500        (PV-CICS-RESP = DFHRESP(QIDERR))                          05850000
058600         CONTINUE                                                 05860000
058700     ELSE                                                         05870000
058800         SET DP013-CICS-ABEND      TO TRUE                        05880000
058900         SET DP013-NO-ROLLBACK     TO TRUE                        05890000
059000                                                                  05900000
059100         MOVE '2050-DELETE-LIST-QUEUE'                            05910000
059200                                   TO DP013-PARAGRAPH             05920000
059300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05930000
059400                                   TO DP013-MESSAGE-TEXT (1)      05940000
059500         PERFORM DP013-0000-PROCESS-ABEND                         05950000
059600     END-IF.                                                      05960000
059700                                                                  05970000
059800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05980000
059900 EJECT                                                            05990000
060000*----------------------------------------------------------------*06000000
060100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06010000
060200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06020000
060300* CICS ARCHITECTURE API.                                         *06030000
060400*----------------------------------------------------------------*06040000
060500 2100-CHECK-FUNCTION-KEY.                                         06050000
060600     EVALUATE TRUE                                                06060000
060700         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  06070000
060800                                                                  06080000
060900             MOVE ASC-VENDOR-NAME  TO ET307-VENDOR-NAME           06090000
061000             MOVE ASC-TP-DKEY      TO ET307-TP-DKEY               06100000
061100             MOVE ASC-TP-DKEY-TMST TO ET307-TP-DKEY-TMST          06110000
061200                                                                  06120000
061300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06130000
061400             MOVE +1               TO PV-TOP-ITEM                 06140000
061500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06150000
061600                                                                  06160000
061700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06170000
061800             PERFORM 2110-BROWSE-BACKWARD                         06180000
061900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06190000
062000                                                                  06200000
062100         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06210000
062200             PERFORM 2120-BROWSE-FORWARD                          06220000
062300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06230000
062400                                                                  06240000
062500         WHEN DP020-SRC-AID = DP016-ENTER                         06250000
062600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06260000
062700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06270000
062800                                                                  06280000
062900         WHEN OTHER                                               06290000
063000             SET DP013-NO-ROLLBACK                                06300000
063100                 DP013-XCTL-DISPLAY-RESTART                       06310000
063200                 DP013-CICS-ABEND  TO TRUE                        06320000
063300             MOVE '2100-CHECK-FUNCTION-KEY'                       06330000
063400                                   TO DP013-PARAGRAPH             06340000
063500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06350000
063600                                   TO DP013-MESSAGE-TEXT (1)      06360000
063700             PERFORM DP013-0000-PROCESS-ABEND                     06370000
063800     END-EVALUATE.                                                06380000
063900                                                                  06390000
064000*----------------------------------------------------------------*06400000
064100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06410000
064200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06420000
064300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06430000
064400*    MESSAGE.                                                    *06440000
064500*----------------------------------------------------------------*06450000
064600                                                                  06460000
064700 2110-BROWSE-BACKWARD.                                            06470000
064800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06480000
064900         GIVING PV-TOP-ITEM.                                      06490000
065000*                                                                 06500000
065100     IF  ((PV-TOP-ITEM < +1)                                      06510000
065200       OR (PV-TOP-ITEM = +1))                                     06520000
065300         MOVE +1                   TO PV-TOP-ITEM                 06530000
065400*        -- TOP OF LIST --                                        06540000
065500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06550000
065600         SET DP020-MSG-INFORMATIONAL TO TRUE                      06560000
065700     END-IF.                                                      06570000
065800                                                                  06580000
065900 EJECT                                                            06590000
066000*----------------------------------------------------------------*06600000
066100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06610000
066200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06620000
066300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06630000
066400*----------------------------------------------------------------*06640000
066500                                                                  06650000
066600 2120-BROWSE-FORWARD.                                             06660000
066700                                                                  06670000
066800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06680000
066900         GIVING PV-TOP-ITEM.                                      06690000
067000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06700000
067100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06710000
067200                                   TO PV-TOP-ITEM                 06720000
067300*        -- BOTTOM OF LIST --                                     06730000
067400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06740000
067500         SET DP020-MSG-INFORMATIONAL                              06750000
067600                                   TO TRUE                        06760000
067700     ELSE                                                         06770000
067800         COMPUTE PV-BOTTOM-ITEM =                                 06780000
067900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06790000
068000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06800000
068100*            -- BOTTOM OF LIST --                                 06810000
068200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06820000
068300             SET DP020-MSG-INFORMATIONAL                          06830000
068400                                   TO TRUE                        06840000
068500         END-IF                                                   06850000
068600     END-IF.                                                      06860000
068700 EJECT                                                            06870000
068800*----------------------------------------------------------------*06880000
068900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *06890000
069000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *06900000
069100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *06910000
069200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *06920000
069300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *06930000
069400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *06940000
069500*----------------------------------------------------------------*06950000
069600                                                                  06960000
069700 2130-CHECK-FOR-JUMP-BROWSE.                                      06970000
069800     IF (ASC-START-ITEM-REQUEST = SPACE)                          06980000
069900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06990000
070000                                   TO PV-TOP-ITEM                 07000000
070100     ELSE                                                         07010000
070200         MOVE ASC-START-ITEM-REQUEST  TO DP010I-UNEDITED-FIELD    07020000
070300         MOVE PC-ITEM-NUMBER-LENGTH   TO DP010I-MAXIMUM-DIGITS    07030000
070400         MOVE +0                      TO DP010I-MAXIMUM-DECIMALS  07040000
070500         SET DP010I-NEGATIVE-NOT-ALLOWED                          07050000
070600                                   TO TRUE                        07060000
070710         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07071001
070720                         USING DP010I-NUMERIC-EDIT-AREA           07072001
070800                                                                  07080000
070900         IF  NOT DP010I-ERROR-DETECTED                            07090000
071000             MOVE DP010I-NUMERIC-FIELD                            07100000
071100                                   TO  ASC-START-ITEM-REQUEST-N   07110000
071200             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07120000
071300                 IF  ASC-START-ITEM-REQUEST-N >                   07130000
071400                                          ASC-NUMBER-OF-ITEMS-READ07140000
071500                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07150000
071600                     COMPUTE PV-TOP-ITEM =                        07160000
071700                             ASC-NUMBER-OF-ITEMS-READ             07170000
071800                             - PC-ITEMS-PER-PANEL + 1             07180000
071900                     IF  PV-TOP-ITEM < +1                         07190000
072000                         MOVE +1   TO PV-TOP-ITEM                 07200000
072100*                        ---- BOTTOM OF LIST ----                 07210000
072200                         MOVE PC-TSYMSG-00070                     07220000
072300                                   TO DP020-MSG-NUMBER            07230000
072400                         SET DP020-MSG-INFORMATIONAL              07240000
072500                                   TO TRUE                        07250000
072600                     END-IF                                       07260000
072700                 ELSE                                             07270000
072800                     MOVE ASC-START-ITEM-REQUEST-N                07280000
072900                                   TO PV-TOP-ITEM                 07290000
073000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07300000
073100                     COMPUTE PV-BOTTOM-ITEM =                     07310000
073200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07320000
073300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07330000
073400*                        -- BOTTOM OF LIST --                     07340000
073500                         MOVE PC-TSYMSG-00070                     07350000
073600                                   TO DP020-MSG-NUMBER            07360000
073700                         SET DP020-MSG-INFORMATIONAL              07370000
073800                                   TO TRUE                        07380000
073900                     END-IF                                       07390000
074000                 END-IF                                           07400000
074100             ELSE                                                 07410000
074200*                --- VALUE OUT OF RANGE ----                      07420000
074300                 MOVE PC-TSYMSG-00101     TO DP020-MSG-NUMBER     07430000
074400                 MOVE -1                  TO ASTRTITL             07440000
074500                 SET DP030-SET-CURSOR-APPL-1                      07450000
074600                                          TO TRUE                 07460000
074700                 MOVE DP015-REVERSE       TO ASTRTITH             07470000
074800                 MOVE DP015-RED           TO ASTRTITC             07480000
074900                 MOVE DP015-UNP-NUM-BRT-OFF                       07490000
075000                                          TO ASTRTITA             07500000
075100                 SET DP020-MSG-FATAL      TO TRUE                 07510000
075200                 SET PS-START-ITEM-ERROR TO TRUE                  07520000
075300             END-IF                                               07530000
075400                                                                  07540000
075500         ELSE                                                     07550000
075600*            ---- MUST BE NUMERIC ----                            07560000
075700             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      07570000
075800             MOVE -1                     TO ASTRTITL              07580000
075900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07590000
076000             MOVE DP015-REVERSE          TO ASTRTITH              07600000
076100             MOVE DP015-RED              TO ASTRTITC              07610000
076200             MOVE DP015-UNP-NUM-BRT-OFF  TO ASTRTITA              07620000
076300             SET DP020-MSG-FATAL         TO TRUE                  07630000
076400             SET PS-START-ITEM-ERROR     TO TRUE                  07640000
076500         END-IF                                                   07650000
076600     END-IF.                                                      07660000
076700 EJECT                                                            07670000
076800*----------------------------------------------------------------*07680000
076900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *07690000
077000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *07700000
077100*----------------------------------------------------------------*07710000
077200*2140-DESELECT-ALL-ITEMS.                                         07720000
077300*    MOVE +1                       TO ASC-BLK-SUB.                07730000
077400*                                                                 07740000
077500*    PERFORM 2141-CLEAR-SELECTED-INDS                             07750000
077600*        VARYING ASC-ITEM-SUB                                     07760000
077700*        FROM 1 BY 1                                              07770000
077800*        UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07780000
077900*                                                                 07790000
078000*    ADD +1                        TO ASC-BLK-SUB.                07800000
078100*                                                                 07810000
078200*    PERFORM 2141-CLEAR-SELECTED-INDS                             07820000
078300*        VARYING ASC-ITEM-SUB                                     07830000
078400*        FROM 1 BY 1                                              07840000
078500*        UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07850000
078600*                                                                 07860000
078700*    MOVE ASC-LIST-ITEM-NUMBER(1 1)                               07870000
078800*                                  TO PV-LIST-ITEM-NUMBER.        07880000
078900*                                                                 07890000
079000*    COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            07900000
079100*        1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    07910000
079200*                                                                 07920000
079300*    IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     07930000
079400*       (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      07940000
079500*        MOVE +1                   TO ASC-BLK-SUB                 07950000
079600*                                                                 07960000
079700*        PERFORM 5100-WRITE-TEMP-STORAGE                          07970000
079800*                                                                 07980000
079900*        MOVE +1                   TO PV-BLOCK-NUMBER             07990000
080000*                                                                 08000000
080100*        COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08010000
080200*            PV-FIRST-BLOCK-IN-ARRAY - 1                          08020000
080300*                                                                 08030000
080400*        PERFORM                                                  08040000
080500*            UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08050000
080600*                                                                 08060000
080700*            PERFORM 4410-READ-TEMP-STORAGE                       08070000
080800*                                                                 08080000
080900*            PERFORM 2141-CLEAR-SELECTED-INDS                     08090000
081000*                VARYING ASC-ITEM-SUB FROM 1 BY 1                 08100000
081100*                UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08110000
081200*                                                                 08120000
081300*            PERFORM 5100-WRITE-TEMP-STORAGE                      08130000
081400*                                                                 08140000
081500*            ADD +1                TO PV-BLOCK-NUMBER             08150000
081600*                                                                 08160000
081700*        END-PERFORM                                              08170000
081800*                                                                 08180000
081900*        COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08190000
082000*            PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08200000
082100*                                                                 08210000
082200*        PERFORM                                                  08220000
082300*            UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08230000
082400*                  ASC-HIGHEST-BLOCK-WRITTEN                      08240000
082500*                                                                 08250000
082600*            MOVE PV-NEXT-BLOCK-IN-ARRAY                          08260000
082700*                                  TO PV-BLOCK-NUMBER             08270000
082800*                                                                 08280000
082900*            PERFORM 4410-READ-TEMP-STORAGE                       08290000
083000*                                                                 08300000
083100*            PERFORM 2141-CLEAR-SELECTED-INDS                     08310000
083200*                VARYING ASC-ITEM-SUB                             08320000
083300*                FROM 1 BY 1                                      08330000
083400*                UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08340000
083500*                                                                 08350000
083600*            PERFORM 5100-WRITE-TEMP-STORAGE                      08360000
083700*                                                                 08370000
083800*            ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08380000
083900*                                                                 08390000
084000*        END-PERFORM                                              08400000
084100*                                                                 08410000
084200*        MOVE PV-FIRST-BLOCK-IN-ARRAY                             08420000
084300*                                  TO PV-BLOCK-NUMBER             08430000
084400*                                                                 08440000
084500*        PERFORM 4410-READ-TEMP-STORAGE                           08450000
084600*    END-IF.                                                      08460000
084700*                                                                 08470000
084800*                                                                 08480000
084900*    MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 08490000
085000*    MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.08500000
085100*    MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  08510000
085200*                                                                 08520000
085300*    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08530000
085400*                                                                 08540000
085500*EJECT                                                            08550000
085600*----------------------------------------------------------------*08560000
085700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *08570000
085800*----------------------------------------------------------------*08580000
085900*                                                                 08590000
086000*2141-CLEAR-SELECTED-INDS.                                        08600000
086100*                                                                 08610000
086200*    IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           08620000
086300*            NOT EQUAL ZERO                                       08630000
086400*        IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08640000
086500*            SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08650000
086600*                ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    08660000
086700*                ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  08670000
086800*                                  TO TRUE                        08680000
086900*        END-IF                                                   08690000
087000*    END-IF.                                                      08700000
087100*                                                                 08710000
087200*EJECT                                                            08720000
087300*----------------------------------------------------------------*08730000
087400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *08740000
087500*  FOR ALL ITEMS.                                                *08750000
087600*----------------------------------------------------------------*08760000
087700*                                                                 08770000
087800*2150-SELECT-ALL-ITEMS.                                           08780000
087900*                                                                 08790000
088000*    MOVE +1                       TO ASC-BLK-SUB.                08800000
088100*                                                                 08810000
088200*    PERFORM 2151-SET-SELECTED-INDS                               08820000
088300*        VARYING ASC-ITEM-SUB                                     08830000
088400*        FROM 1 BY 1                                              08840000
088500*        UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08850000
088600*                                                                 08860000
088700*    ADD +1                        TO ASC-BLK-SUB.                08870000
088800*                                                                 08880000
088900*    PERFORM 2151-SET-SELECTED-INDS                               08890000
089000*        VARYING ASC-ITEM-SUB                                     08900000
089100*        FROM 1 BY 1                                              08910000
089200*        UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08920000
089300*                                                                 08930000
089400*    MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08940000
089500*                                  TO PV-LIST-ITEM-NUMBER.        08950000
089600*                                                                 08960000
089700*    COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08970000
089800*        1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08980000
089900*                                                                 08990000
090000*    IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09000000
090100*       (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09010000
090200*        MOVE +1                   TO ASC-BLK-SUB                 09020000
090300*                                                                 09030000
090400*        PERFORM 5100-WRITE-TEMP-STORAGE                          09040000
090500*                                                                 09050000
090600*        MOVE +1                   TO PV-BLOCK-NUMBER             09060000
090700*                                                                 09070000
090800*        COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09080000
090900*            PV-FIRST-BLOCK-IN-ARRAY - 1                          09090000
091000*                                                                 09100000
091100*        PERFORM                                                  09110000
091200*            UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09120000
091300*                                                                 09130000
091400*            PERFORM 4410-READ-TEMP-STORAGE                       09140000
091500*                                                                 09150000
091600*            PERFORM 2151-SET-SELECTED-INDS                       09160000
091700*                VARYING ASC-ITEM-SUB                             09170000
091800*                FROM 1 BY 1                                      09180000
091900*                UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09190000
092000*                                                                 09200000
092100*            PERFORM 5100-WRITE-TEMP-STORAGE                      09210000
092200*                                                                 09220000
092300*            ADD +1                TO PV-BLOCK-NUMBER             09230000
092400*                                                                 09240000
092500*        END-PERFORM                                              09250000
092600*                                                                 09260000
092700*        COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09270000
092800*            PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09280000
092900*                                                                 09290000
093000*        PERFORM                                                  09300000
093100*            UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09310000
093200*                  ASC-HIGHEST-BLOCK-WRITTEN                      09320000
093300*                                                                 09330000
093400*            MOVE PV-NEXT-BLOCK-IN-ARRAY                          09340000
093500*                                  TO PV-BLOCK-NUMBER             09350000
093600*                                                                 09360000
093700*            PERFORM 4410-READ-TEMP-STORAGE                       09370000
093800*                                                                 09380000
093900*            PERFORM 2151-SET-SELECTED-INDS                       09390000
094000*                VARYING ASC-ITEM-SUB                             09400000
094100*                FROM 1 BY 1                                      09410000
094200*                UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09420000
094300*                                                                 09430000
094400*            PERFORM 5100-WRITE-TEMP-STORAGE                      09440000
094500*                                                                 09450000
094600*            ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09460000
094700*                                                                 09470000
094800*        END-PERFORM                                              09480000
094900*                                                                 09490000
095000*        MOVE PV-FIRST-BLOCK-IN-ARRAY                             09500000
095100*                                  TO PV-BLOCK-NUMBER             09510000
095200*                                                                 09520000
095300*        PERFORM 4410-READ-TEMP-STORAGE                           09530000
095400*    END-IF.                                                      09540000
095500*                                                                 09550000
095600*                                                                 09560000
095700*    MOVE ASC-NUMBER-OF-ITEMS-READ TO                             09570000
095800*                      ASC-NUMBER-OF-SELECTED-ITEMS.              09580000
095900*                                                                 09590000
096000*    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09600000
096100*                                                                 09610000
096200*EJECT                                                            09620000
096300*----------------------------------------------------------------*09630000
096400*    MARK EACH ITEM AS BEING SELECTED.                           *09640000
096500*----------------------------------------------------------------*09650000
096600*                                                                 09660000
096700*2151-SET-SELECTED-INDS.                                          09670000
096800*                                                                 09680000
096900*    IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09690000
097000*            NOT EQUAL ZERO                                       09700000
097100*        IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09710000
097200*            SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09720000
097300*                ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        09730000
097400*                ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09740000
097500*                              TO  TRUE                           09750000
097600*        END-IF                                                   09760000
097700*    END-IF.                                                      09770000
097800*                                                                 09780000
097900*                                                                 09790000
098000******************************************************************09800000
098100** GET THE NEXT VENDOR FROM THE LIST QUEUE.                       09810000
098200******************************************************************09820000
098300 2140-GET-NEXT-ITEM.                                              09830000
098400     ADD +1                       TO ASC-SEL-SUB.                 09840000
098500     IF  ASC-SEL-SUB > ET308-MAX-ITEMS                            09850000
098600         ADD +1                   TO ASC-SEL-ITEM                 09860000
098700         MOVE +1                  TO ASC-SEL-SUB                  09870000
098800     END-IF.                                                      09880000
098900     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 09890000
099000         PERFORM 9100-READ-SEL-QUEUE                              09900000
099100         IF  ET308-ITEM (ASC-SEL-SUB) > ZERO                      09910000
099200             MOVE ET308-INT-CONTROL-NUMBER (ASC-SEL-SUB)          09920000
099300                                   TO ASC-INT-CONTROL-NUMBER      09930000
099400             MOVE ET308-VENDOR-NAME (ASC-SEL-SUB)                 09940000
099500                                   TO ASC-VENDOR-NAME             09950000
099600             MOVE ET308-TP-DKEY     (ASC-SEL-SUB)                 09960000
099700                                   TO ASC-TP-DKEY                 09970000
099800             MOVE ET308-TP-DKEY-TMST (ASC-SEL-SUB)                09980000
099900                                   TO ASC-TP-DKEY-TMST            09990000
100000             SET ET308-INQ (ASC-SEL-SUB) TO TRUE                  10000000
100100             PERFORM 9200-REWRITE-SEL-QUEUE                       10010000
100200         ELSE                                                     10020000
100300             SUBTRACT +1 FROM ASC-SEL-SUB                         10030000
100400*            ---- BOTTOM OF LIST ----                             10040000
100500             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             10050000
100600             SET DP020-MSG-INFORMATIONAL TO TRUE                  10060000
100700             SET PS-LIST-END             TO TRUE                  10070000
100800         END-IF                                                   10080000
100900     ELSE                                                         10090000
101000         SUBTRACT +1 FROM ASC-SEL-ITEM                            10100000
101100         MOVE ET308-MAX-ITEMS     TO ASC-SEL-SUB                  10110000
101200*        ---- BOTTOM OF LIST ----                                 10120000
101300         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             10130000
101400         SET DP020-MSG-INFORMATIONAL TO TRUE                      10140000
101500         SET PS-LIST-END             TO TRUE                      10150000
101600     END-IF.                                                      10160000
101700                                                                  10170000
101800******************************************************************10180000
101900** GET THE PREVIOUS VENDOR FROM THE LIST QUEUE.                   10190000
102000******************************************************************10200000
102100 2150-GET-PREV-ITEM.                                              10210000
102200                                                                  10220000
102300     SUBTRACT +1 FROM ASC-SEL-SUB.                                10230000
102400     IF  ASC-SEL-SUB < +1                                         10240000
102500         SUBTRACT +1 FROM ASC-SEL-ITEM                            10250000
102600         MOVE ET308-MAX-ITEMS     TO ASC-SEL-SUB                  10260000
102700     END-IF.                                                      10270000
102800                                                                  10280000
102900     IF  ASC-SEL-ITEM > ZERO                                      10290000
103000         PERFORM 9100-READ-SEL-QUEUE                              10300000
103100             MOVE ET308-INT-CONTROL-NUMBER (ASC-SEL-SUB)          10310000
103200                                   TO ASC-INT-CONTROL-NUMBER      10320000
103300             MOVE ET308-VENDOR-NAME (ASC-SEL-SUB)                 10330000
103400                                   TO ASC-VENDOR-NAME             10340000
103500             MOVE ET308-TP-DKEY     (ASC-SEL-SUB)                 10350000
103600                                   TO ASC-TP-DKEY                 10360000
103700             MOVE ET308-TP-DKEY-TMST (ASC-SEL-SUB)                10370000
103800                                   TO ASC-TP-DKEY-TMST            10380000
103900                                                                  10390000
104000     ELSE                                                         10400000
104100         MOVE +1                  TO ASC-SEL-ITEM                 10410000
104200                                     ASC-SEL-SUB                  10420000
104300*        ---- TOP OF LIST ----                                    10430000
104400         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             10440000
104500         SET DP020-MSG-INFORMATIONAL TO TRUE                      10450000
104600         SET PS-LIST-END             TO TRUE                      10460000
104700     END-IF.                                                      10470000
104800                                                                  10480000
104900******************************************************************10490000
105000** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10500000
105100** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10510000
105200******************************************************************10520000
105300 2200-MOVE-SCREEN-TO-COMMAREA.                                    10530000
105400                                                                  10540000
105500     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10550000
105600     MOVE +1                       TO PV-SUB.                     10560000
105700*                                                                 10570000
105800     PERFORM 3100-SET-SUBSCRIPTS.                                 10580000
105900     IF  ASTRTITL > ZERO                                          10590000
106000         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10600000
106100     ELSE                                                         10610000
106200         IF ASTRTITF = DP015-ERASE-EOF                            10620000
106300             MOVE SPACE TO ASC-START-ITEM-REQUEST                 10630000
106400         END-IF.                                                  10640000
106500                                                                  10650000
106600*    PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10660000
106700*        VARYING PV-SUB                                           10670000
106800*        FROM 1 BY 1                                              10680000
106900*        UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10690000
107000******************************************************************10700000
107100** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**10710000
107200******************************************************************10720000
107300*2210-MOVE-LINES-TO-COMMAREA.                                     10730000
107400*    IF  MR-SELECTL (PV-SUB) > ZERO                               10740000
107500*        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10750000
107600*        MOVE MR-SELECTI (PV-SUB)                                 10760000
107700*                                  TO ASC-TEMP-SELECTED-SW        10770000
107800*                                (ASC-BLK-SUB, ASC-ITEM-SUB)      10780000
107900*    ELSE                                                         10790000
108000*        IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10800000
108100*                SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10810000
108200*                MOVE SPACE        TO ASC-TEMP-SELECTED-SW        10820000
108300*                                (ASC-BLK-SUB, ASC-ITEM-SUB)      10830000
108400*        END-IF                                                   10840000
108500*    END-IF.                                                      10850000
108600*    ADD +1                        TO ASC-ITEM-SUB.               10860000
108700*    IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10870000
108800*        ADD +1                    TO ASC-BLK-SUB                 10880000
108900*        MOVE +1                   TO ASC-ITEM-SUB                10890000
109000*    END-IF.                                                      10900000
109100******************************************************************10910000
109200** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **10920000
109300** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **10930000
109400******************************************************************10940000
109500 3000-EDIT-DATA-IN-COMMAREA.                                      10950000
109600     SET PS-NO-ERROR               TO TRUE.                       10960000
109700     PERFORM 3200-RESET-ATTRIBUTES.                               10970000
109800     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10980000
109900**                                                                10990000
110000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              11000000
110100* EDITTING IS DONE FROM THE BOTTOM UP.                            11010000
110200**                                                                11020000
110300*    COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11030000
110400*        ASC-ITEMS-DISPLAYED - 1.                                 11040000
110500*    PERFORM 3100-SET-SUBSCRIPTS.                                 11050000
110600*    PERFORM 3300-EDIT-SELECTIONS                                 11060000
110700*        VARYING PV-SUB                                           11070000
110800*        FROM PV-SUB BY -1                                        11080000
110900*        UNTIL PV-SUB < +1                                        11090000
111000*                                                                 11100000
111100*    IF  PS-NO-ERROR                                              11110000
111200*        PERFORM 3400-CHECK-RANGE-SEQUENCE                        11120000
111300*    END-IF.                                                      11130000
111400*                                                                 11140000
111500*    IF  ((PS-NO-ERROR)                                           11150000
111600*      AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11160000
111700*      AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11170000
111800*            PERFORM 3500-MARK-RANGE-AS-SELECTED                  11180000
111900*    END-IF.                                                      11190000
112000*                                                                 11200000
112100*----------------------------------------------------------------*11210000
112200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *11220000
112300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*11230000
112400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *11240000
112500*                                                                *11250000
112600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11260000
112700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11270000
112800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11280000
112900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *11290000
113000*----------------------------------------------------------------*11300000
113100                                                                  11310000
113200 3100-SET-SUBSCRIPTS.                                             11320000
113300                                                                  11330000
113400     COMPUTE ASC-ITEM-SUB =                                       11340000
113500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11350000
113600                                                                  11360000
113700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11370000
113800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11380000
113900                                                                  11390000
114000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               11400000
114100     ELSE                                                         11410000
114200         MOVE +1                     TO ASC-BLK-SUB               11420000
114300     END-IF.                                                      11430000
114400******************************************************************11440000
114500** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **11450000
114600******************************************************************11460000
114700                                                                  11470000
114800 3200-RESET-ATTRIBUTES.                                           11480000
114900     MOVE DP015-UNP-NUM-NOR-OFF    TO ASTRTITA.                   11490000
115000     MOVE DP015-GREEN              TO ASTRTITC.                   11500000
115100     MOVE DP015-UNDERLINE          TO ASTRTITH.                   11510000
115200                                                                  11520000
115300     MOVE DP015-BLUE    TO   MR-VENDOR-NAMEC                      11530000
115400                             MR-INT-CONTROL-NUMC                  11540000
115500                                                                  11550000
115600     PERFORM                                                      11560000
115700         VARYING PV-SUB                                           11570000
115800         FROM 1 BY 1                                              11580000
115900         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        11590000
116000         MOVE DP015-BLUE    TO   MR-ERROR-TEXTC      (PV-SUB)     11600000
116100                                 MR-SEGMENT-IDC      (PV-SUB)     11610000
116200                                 MR-SEQUENCE-NUMC    (PV-SUB)     11620000
116300     END-PERFORM.                                                 11630000
116400******************************************************************11640000
116500** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **11650000
116600** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **11660000
116700** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **11670000
116800** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **11680000
116900******************************************************************11690000
117000*3300-EDIT-SELECTIONS.                                            11700000
117100*    EVALUATE TRUE                                                11710000
117200*        WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11720000
117300*            = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11730000
117400*                CONTINUE                                         11740000
117500*        WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         11750000
117600*            IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11760000
117700*                ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   11770000
117800*                MOVE ASC-TEMP-SELECTED-SW                        11780000
117900*                                     (ASC-BLK-SUB ASC-ITEM-SUB)  11790000
118000*                               TO ASC-SELECTED-SW                11800000
118100*                                     (ASC-BLK-SUB ASC-ITEM-SUB)  11810000
118200*            END-IF                                               11820000
118300*        WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11830000
118400*                = SPACE                                          11840000
118500*            EVALUATE TRUE                                        11850000
118600*                WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       11860000
118700*                    SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS11870000
118800*                    MOVE SPACE TO ASC-SELECTED-SW                11880000
118900*                                     (ASC-BLK-SUB ASC-ITEM-SUB)  11890000
119000*                WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        11900000
119100*                    MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    11910000
119200*                    MOVE SPACE TO ASC-SELECTED-SW                11920000
119300*                                     (ASC-BLK-SUB ASC-ITEM-SUB)  11930000
119400*                WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          11940000
119500*                    MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      11950000
119600*                    MOVE SPACE TO ASC-SELECTED-SW                11960000
119700*                                     (ASC-BLK-SUB ASC-ITEM-SUB)  11970000
119800*            END-EVALUATE                                         11980000
119900*        WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           11990000
120000*            IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12000000
120100*                SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12010000
120200*            END-IF                                               12020000
120300*            PERFORM 3310-EDIT-RANGE                              12030000
120400*        WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12040000
120500*            IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12050000
120600*                SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12060000
120700*            END-IF                                               12070000
120800*            PERFORM 3310-EDIT-RANGE                              12080000
120900*        WHEN OTHER                                               12090000
121000*            ---- INVALID VALUE ----                              12100000
121100*            MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           12110000
121200*            SET DP020-MSG-FATAL    TO TRUE                       12120000
121300*            MOVE -1                TO MR-SELECTL (PV-SUB)        12130000
121400*            SET DP030-SET-CURSOR-APPL-1                          12140000
121500*                                   TO TRUE                       12150000
121600*            MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        12160000
121700*            MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        12170000
121800*            SET PS-ERROR TO TRUE                                 12180000
121900*            IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12190000
122000*                SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     12200000
122100*                MOVE SPACE         TO ASC-SELECTED-SW            12210000
122200*                                       (ASC-BLK-SUB ASC-ITEM-SUB)12220000
122300*            END-IF                                               12230000
122400*    END-EVALUATE.                                                12240000
122500*                                                                 12250000
122600*    SUBTRACT +1             FROM PV-ITEM-IN-USE.                 12260000
122700*    SUBTRACT +1 FROM ASC-ITEM-SUB.                               12270000
122800*    IF  ASC-ITEM-SUB < 1                                         12280000
122900*        SUBTRACT +1 FROM ASC-BLK-SUB                             12290000
123000*        MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12300000
123100*    END-IF.                                                      12310000
123200******************************************************************12320000
123300** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **12330000
123400** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **12340000
123500** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**12350000
123600** THE ENDING.                                                  **12360000
123700******************************************************************12370000
123800*3310-EDIT-RANGE.                                                 12380000
123900*    IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                12390000
124000*        IF  ASC-START-OF-SELECTED-RANGE = ZERO                   12400000
124100*            MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)12410000
124200*                                  TO ASC-SELECTED-SW             12420000
124300*                                       (ASC-BLK-SUB ASC-ITEM-SUB)12430000
124400*            MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 12440000
124500*        ELSE                                                     12450000
124600*            IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     12460000
124700*                CONTINUE                                         12470000
124800*            ELSE                                                 12480000
124900*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        12490000
125000*                MOVE PC-TSYMSG-00054                             12500000
125100*                                  TO DP020-MSG-NUMBER            12510000
125200*                SET DP020-MSG-FATAL                              12520000
125300*                                  TO TRUE                        12530000
125400*                MOVE -1           TO MR-SELECTL (PV-SUB)         12540000
125500*                SET DP030-SET-CURSOR-APPL-1                      12550000
125600*                                  TO TRUE                        12560000
125700*                MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         12570000
125800*                MOVE DP015-UNDERLINE                             12580000
125900*                                  TO MR-SELECTH (PV-SUB)         12590000
126000*                SET PS-ERROR      TO TRUE                        12600000
126100*            END-IF                                               12610000
126200*        END-IF                                                   12620000
126300*    ELSE                                                         12630000
126400*        IF  ASC-END-OF-SELECTED-RANGE = ZERO                     12640000
126500*            MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 12650000
126600*                                  TO ASC-SELECTED-SW             12660000
126700*                                    (ASC-BLK-SUB ASC-ITEM-SUB)   12670000
126800*            MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   12680000
126900*        ELSE                                                     12690000
127000*            IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       12700000
127100*                CONTINUE                                         12710000
127200*            ELSE                                                 12720000
127300*                -- ONLY ONE END-OF-RANGE ALLOWED --              12730000
127400*                MOVE PC-TSYMSG-00055                             12740000
127500*                                  TO DP020-MSG-NUMBER            12750000
127600*                SET DP020-MSG-FATAL                              12760000
127700*                                  TO TRUE                        12770000
127800*                MOVE -1           TO MR-SELECTL (PV-SUB)         12780000
127900*                SET DP030-SET-CURSOR-APPL-1                      12790000
128000*                                  TO TRUE                        12800000
128100*                SET PS-ERROR      TO TRUE                        12810000
128200*            END-IF                                               12820000
128300*        END-IF                                                   12830000
128400*    END-IF.                                                      12840000
128500*                                                                 12850000
128600******************************************************************12860000
128700** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **12870000
128800** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **12880000
128900******************************************************************12890000
129000*3400-CHECK-RANGE-SEQUENCE.                                       12900000
129100*    IF  ASC-START-OF-SELECTED-RANGE > ZERO                       12910000
129200*      AND  ASC-END-OF-SELECTED-RANGE > ZERO                      12920000
129300*      AND  ASC-START-OF-SELECTED-RANGE >                         12930000
129400*                                        ASC-END-OF-SELECTED-RANGE12940000
129500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                12950000
129600*        MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 12960000
129700*        SET DP020-MSG-FATAL TO TRUE                              12970000
129800*        SET PS-ERROR TO TRUE                                     12980000
129900*        PERFORM 3410-POSITION-AT-ERROR                           12990000
130000*    ELSE                                                         13000000
130100*        MOVE -1 TO MR-SELECTL (1)                                13010000
130200*    END-IF.                                                      13020000
130300*    SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       13030000
130400*                                                                 13040000
130500*                                                                 13050000
130600******************************************************************13060000
130700** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **13070000
130800** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **13080000
130900** SHOULD BE POSITIONED ON A RANGE ERROR.                       **13090000
131000******************************************************************13100000
131100*3410-POSITION-AT-ERROR.                                          13110000
131200*    COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 13120000
131300*                   - PV-TOP-ITEM + 1.                            13130000
131400*    IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13140000
131500*        CONTINUE                                                 13150000
131600*    ELSE                                                         13160000
131700*        MOVE -1                   TO MR-SELECTL (PV-SUB)         13170000
131800*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13180000
131900*        MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13190000
132000*    END-IF.                                                      13200000
132100*                                                                 13210000
132200*    COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   13220000
132300*                   - PV-TOP-ITEM + 1.                            13230000
132400*    IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13240000
132500*        CONTINUE                                                 13250000
132600*    ELSE                                                         13260000
132700*        MOVE -1                   TO MR-SELECTL (PV-SUB)         13270000
132800*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13280000
132900*        MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13290000
133000*    END-IF.                                                      13300000
133100*EJECT                                                            13310000
133200*----------------------------------------------------------------*13320000
133300*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *13330000
133400*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *13340000
133500*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *13350000
133600*----------------------------------------------------------------*13360000
133700*                                                                 13370000
133800*3500-MARK-RANGE-AS-SELECTED.                                     13380000
133900*    MOVE +1                       TO  ASC-BLK-SUB.               13390000
134000*    PERFORM 3510-MARK-SELECTED-INDS                              13400000
134100*        VARYING ASC-ITEM-SUB                                     13410000
134200*        FROM 1 BY 1                                              13420000
134300*        UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13430000
134400*                                                                 13440000
134500*    ADD +1                        TO ASC-BLK-SUB.                13450000
134600*    PERFORM 3510-MARK-SELECTED-INDS                              13460000
134700*        VARYING ASC-ITEM-SUB                                     13470000
134800*        FROM 1 BY 1                                              13480000
134900*        UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13490000
135000*                                                                 13500000
135100*    MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13510000
135200*                                  TO  PV-LIST-ITEM-NUMBER.       13520000
135300*    COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13530000
135400*        1 + ((PV-LIST-ITEM-NUMBER - 1) /                         13540000
135500*              PC-ITEMS-PER-PANEL).                               13550000
135600*                                                                 13560000
135700*    MOVE ASC-START-OF-SELECTED-RANGE                             13570000
135800*                                  TO PV-START-OF-SELECTED-RANGE. 13580000
135900*    COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            13590000
136000*        1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  13600000
136100*              PC-ITEMS-PER-PANEL).                               13610000
136200*                                                                 13620000
136300*    MOVE ASC-END-OF-SELECTED-RANGE                               13630000
136400*                                  TO  PV-END-OF-SELECTED-RANGE.  13640000
136500*    COMPUTE PV-LAST-BLOCK-IN-RANGE =                             13650000
136600*        1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    13660000
136700*              PC-ITEMS-PER-PANEL).                               13670000
136800*    COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             13680000
136900*        PV-FIRST-BLOCK-IN-ARRAY + 1.                             13690000
137000*                                                                 13700000
137100*    IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    13710000
137200*       (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        13720000
137300*        MOVE +1                   TO ASC-BLK-SUB                 13730000
137400*        PERFORM 5100-WRITE-TEMP-STORAGE                          13740000
137500*        COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13750000
137600*            PV-FIRST-BLOCK-IN-ARRAY - 1                          13760000
137700*                                                                 13770000
137800*        PERFORM                                                  13780000
137900*            UNTIL PV-FIRST-BLOCK-IN-RANGE >                      13790000
138000*                  PV-PREV-BLOCK-IN-ARRAY                         13800000
138100*            MOVE PV-FIRST-BLOCK-IN-RANGE                         13810000
138200*                                  TO PV-BLOCK-NUMBER             13820000
138300*            PERFORM 4410-READ-TEMP-STORAGE                       13830000
138400*            PERFORM 3510-MARK-SELECTED-INDS                      13840000
138500*                VARYING ASC-ITEM-SUB                             13850000
138600*                FROM 1 BY 1                                      13860000
138700*                UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13870000
138800*            PERFORM 5100-WRITE-TEMP-STORAGE                      13880000
138900*            ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     13890000
139000*        END-PERFORM                                              13900000
139100*                                                                 13910000
139200*        COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13920000
139300*            PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13930000
139400*        PERFORM                                                  13940000
139500*            UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13950000
139600*                  PV-LAST-BLOCK-IN-RANGE                         13960000
139700*            MOVE PV-NEXT-BLOCK-IN-ARRAY                          13970000
139800*                                  TO PV-BLOCK-NUMBER             13980000
139900*            PERFORM 4410-READ-TEMP-STORAGE                       13990000
140000*            PERFORM 3510-MARK-SELECTED-INDS                      14000000
140100*                VARYING ASC-ITEM-SUB                             14010000
140200*                FROM 1 BY 1                                      14020000
140300*                UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14030000
140400*            PERFORM 5100-WRITE-TEMP-STORAGE                      14040000
140500*            ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14050000
140600*        END-PERFORM                                              14060000
140700*                                                                 14070000
140800*        MOVE PV-FIRST-BLOCK-IN-ARRAY                             14080000
140900*                                  TO PV-BLOCK-NUMBER             14090000
141000*        PERFORM 4410-READ-TEMP-STORAGE                           14100000
141100*    END-IF.                                                      14110000
141200*                                                                 14120000
141300*    MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 14130000
141400*                                     ASC-END-OF-SELECTED-RANGE.  14140000
141500*                                                                 14150000
141600*EJECT                                                            14160000
141700*----------------------------------------------------------------*14170000
141800* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *14180000
141900*----------------------------------------------------------------*14190000
142000*                                                                 14200000
142100*3510-MARK-SELECTED-INDS.                                         14210000
142200*                                                                 14220000
142300*    IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14230000
142400*                               ASC-ITEM-SUB) >                   14240000
142500*        ASC-START-OF-SELECTED-RANGE)                             14250000
142600*    OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14260000
142700*                               ASC-ITEM-SUB) =                   14270000
142800*        ASC-START-OF-SELECTED-RANGE)                             14280000
142900*                                                                 14290000
143000*        IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14300000
143100*                                   ASC-ITEM-SUB) <               14310000
143200*            ASC-END-OF-SELECTED-RANGE)                           14320000
143300*        OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14330000
143400*                                   ASC-ITEM-SUB) =               14340000
143500*            ASC-END-OF-SELECTED-RANGE)                           14350000
143600*                                                                 14360000
143700*            IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14370000
143800*                SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   14380000
143900*                    ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   14390000
144000*                              TO TRUE                            14400000
144100*                SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              14410000
144200*                              TO TRUE                            14420000
144300*                ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    14430000
144400*            END-IF                                               14440000
144500*        END-IF                                                   14450000
144600*    END-IF.                                                      14460000
144700*                                                                 14470000
144800*EJECT                                                            14480000
144900*----------------------------------------------------------------*14490000
145000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14500000
145100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14510000
145200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14520000
145300*    DISPLAY THE PANEL TO USER.                                  *14530000
145400*----------------------------------------------------------------*14540000
145500                                                                  14550000
145600 4000-BUILD-INITIAL-PANEL.                                        14560000
145700                                                                  14570000
145800     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            14580000
145900                                 ASC-BLOCK-ENTRIES (2).           14590000
146000     MOVE +1                 TO ASC-BLK-SUB.                      14600000
146100     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            14610000
146200                                                                  14620000
146300     MOVE +0                 TO ASC-ITEM-SUB                      14630000
146400                                ASC-NUMBER-OF-ITEMS-READ          14640000
146500                                ASC-NUMBER-OF-SELECTED-ITEMS      14650000
146600                                ASC-HIGHEST-BLOCK-WRITTEN         14660000
146700                                ASC-START-OF-SELECTED-RANGE       14670000
146800                                ASC-END-OF-SELECTED-RANGE         14680000
146900                                ASC-ITEM-AT-TOP-OF-PANEL.         14690000
147000                                                                  14700000
147100     PERFORM 4010-OPEN-CURSOR.                                    14710000
147200                                                                  14720000
147300     IF SQLCODE = ZERO                                            14730000
147400         PERFORM 4300-READ-ITEMS-FROM-DB                          14740000
147500                                                                  14750000
147600         PERFORM 4020-CLOSE-CURSOR                                14760000
147700                                                                  14770000
147800         MOVE +1                   TO  PV-TOP-ITEM                14780000
147900         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      14790000
148000*            ---- NO LIST ITEMS FOUND FOR CRITERIA ----           14800000
148100             SET DP020-MSG-INFORMATIONAL TO  TRUE                 14810000
148200             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER           14820000
148300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14830000
148400         ELSE                                                     14840000
148500             MOVE -1               TO ASTRTITL                    14850000
148600             SET DP030-SET-CURSOR-APPL-1                          14860000
148700                                   TO TRUE                        14870000
148800             MOVE DP015-BLUE    TO   MR-VENDOR-NAMEC              14880000
148900                                     MR-INT-CONTROL-NUMC          14890000
149000                                                                  14900000
149100             PERFORM                                              14910000
149200                 VARYING PV-SUB                                   14920000
149300                 FROM 1 BY 1                                      14930000
149400                 UNTIL PV-SUB > PC-ITEMS-PER-PANEL                14940000
149500                 MOVE DP015-BLUE TO MR-ERROR-TEXTC   (PV-SUB)     14950000
149600                                    MR-SEGMENT-IDC   (PV-SUB)     14960000
149700                                    MR-SEQUENCE-NUMC (PV-SUB)     14970000
149800             END-PERFORM                                          14980000
149900                                                                  14990000
150000                                                                  15000000
150100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15010000
150200         END-IF                                                   15020000
150300     ELSE                                                         15030000
150400         SET  DP020-NEXT-ACT-APPL-ERROR                           15040000
150500              DP020-MSG-WARNING         TO TRUE                   15050000
150600*        ---- WAIT 15 SECONDS, THEN RETRY ----                    15060000
150700         MOVE PC-TSYMSG-00551  TO  DP020-MSG-NUMBER               15070000
150800     END-IF.                                                      15080000
150900 EJECT                                                            15090000
151000*----------------------------------------------------------------*15100000
151100*   OPEN THE CURSOR.                                              15110000
151200*   IN THIS PARTICULAR APPLICATION ONE OF 5 DIFFERENT CURSORS    *15120000
151300*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *15130000
151400*   USER.                                                        *15140000
151500*----------------------------------------------------------------*15150000
151600                                                                  15160000
151700 4010-OPEN-CURSOR.                                                15170000
151800                                                                  15180000
151900     MOVE 'CURSOR 1'                                              15190000
152000                  TO DP013-MESSAGE-TEXT (2)                       15200000
152100     EXEC SQL                                                     15210000
152200           OPEN CURSOR_ONE                                        15220000
152300     END-EXEC                                                     15230000
152400                                                                  15240000
152500     EVALUATE TRUE                                                15250000
152600         WHEN SQLCODE = ZERO                                      15260000
152700             CONTINUE                                             15270000
152800         WHEN SQLWARN0 NOT = SPACES                               15280000
152900         WHEN SQLCODE  NOT = ZERO                                 15290000
153000             MOVE '4010-OPEN-CURSOR'                              15300000
153100                               TO DP013-PARAGRAPH                 15310000
153200             MOVE 'OPEN CURSOR'                                   15320000
153300                               TO DP013-MESSAGE-TEXT (1)          15330000
153400             MOVE SQLCA        TO DP013-SQLCA                     15340000
153500             SET DP013-DB2-ABEND                                  15350000
153600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15360000
153700             PERFORM DP013-0000-PROCESS-ABEND                     15370000
153800     END-EVALUATE.                                                15380000
153900 EJECT                                                            15390000
154000*----------------------------------------------------------------*15400000
154100* CLOSE THE CURSOR.                                               15410000
154200*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *15420000
154300*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *15430000
154400*   USER.                                                        *15440000
154500*----------------------------------------------------------------*15450000
154600                                                                  15460000
154700 4020-CLOSE-CURSOR.                                               15470000
154800*                                                                 15480000
154900     MOVE 'CURSOR 1'     TO DP013-MESSAGE-TEXT (2).               15490000
155000                                                                  15500000
155100     EXEC SQL                                                     15510000
155200          CLOSE CURSOR_ONE                                        15520000
155300     END-EXEC.                                                    15530000
155400                                                                  15540000
155500     EVALUATE TRUE                                                15550000
155600         WHEN SQLCODE = ZERO                                      15560000
155700             CONTINUE                                             15570000
155800         WHEN SQLWARN0 NOT = SPACES                               15580000
155900         WHEN SQLCODE  NOT = ZERO                                 15590000
156000             MOVE '4020-CLOSE-CURSOR'                             15600000
156100                               TO DP013-PARAGRAPH                 15610000
156200             MOVE 'CLOSE CURSOR'                                  15620000
156300                               TO DP013-MESSAGE-TEXT (1)          15630000
156400             MOVE SQLCA        TO DP013-SQLCA                     15640000
156500             MOVE 'TINVPAR '   TO DP013-DB2-TABLE-NAME (1)        15650000
156600             SET DP013-DB2-ABEND                                  15660000
156700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15670000
156800             PERFORM DP013-0000-PROCESS-ABEND                     15680000
156900     END-EVALUATE.                                                15690000
157000 EJECT                                                            15700000
157100*----------------------------------------------------------------*15710000
157200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *15720000
157300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *15730000
157400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *15740000
157500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *15750000
157600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *15760000
157700*                                                                *15770000
157800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *15780000
157900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *15790000
158000*    UPON INITIALIZATION.                                        *15800000
158100*----------------------------------------------------------------*15810000
158200                                                                  15820000
158300 4300-READ-ITEMS-FROM-DB.                                         15830000
158400                                                                  15840000
158500     PERFORM                                                      15850000
158600         VARYING PV-READ-COUNT                                    15860000
158700         FROM 1 BY 1                                              15870000
158800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    15880000
158900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         15890000
159000                                                                  15900000
159100         PERFORM 4310-FETCH                                       15910000
159200                                                                  15920000
159300         IF  ASC-ITEMS-LEFT-ON-DB                                 15930000
159400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                15940000
159500                 ADD +1            TO ASC-ITEM-SUB                15950000
159600             ELSE                                                 15960000
159700                 ADD +1            TO ASC-BLK-SUB                 15970000
159800                 MOVE +1           TO ASC-ITEM-SUB                15980000
159900                                                                  15990000
160000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16000000
160100                     MOVE +1       TO ASC-BLK-SUB                 16010000
160200                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           16020000
160300                     PERFORM 5100-WRITE-TEMP-STORAGE              16030000
160400                     MOVE ASC-BLOCK-ENTRIES                       16040000
160500                                          (PC-MAX-BLOCKS-IN-ARRAY)16050000
160600                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)16060000
160700                     ADD +1        TO ASC-BLK-SUB                 16070000
160800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   16080000
160900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16090000
161000                                                           TO TRUE16100000
161100                 END-IF                                           16110000
161200             END-IF                                               16120000
161300             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    16130000
161400             MOVE ASC-NUMBER-OF-ITEMS-READ                        16140000
161500                TO ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)16150000
161600*   -----------MOVE ITEMS FROM DB TO ASC COMMAREA ---------       16160000
161700             MOVE INTERR-ERR-MSG-DESC       TO                    16170000
161800               ASC-ERROR-TEXT    (ASC-BLK-SUB ASC-ITEM-SUB)       16180000
161900             MOVE INTERR-SEG-ID             TO                    16190000
162000               ASC-SEGMENT-ID    (ASC-BLK-SUB ASC-ITEM-SUB)       16200000
162100             MOVE INTERR-SEQ-SEQ-NBR        TO                    16210000
162200               ASC-SEQUENCE-NUM  (ASC-BLK-SUB ASC-ITEM-SUB)       16220000
162300*   -----------MOVE ITEMS FROM DB TO ASC COMMAREA ---------       16230000
162400         END-IF                                                   16240000
162500     END-PERFORM.                                                 16250000
162600                                                                  16260000
162700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          16270000
162800         MOVE +1               TO ASC-BLK-SUB                     16280000
162900         PERFORM 5100-WRITE-TEMP-STORAGE                          16290000
163000         ADD +1                TO ASC-BLK-SUB                     16300000
163100         PERFORM 5100-WRITE-TEMP-STORAGE                          16310000
163200                                                                  16320000
163300         MOVE 1                TO ASC-BLK-SUB                     16330000
163400                                  PV-BLOCK-NUMBER                 16340000
163500         PERFORM 4410-READ-TEMP-STORAGE                           16350000
163600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             16360000
163700             MOVE 2            TO ASC-BLK-SUB                     16370000
163800                                  PV-BLOCK-NUMBER                 16380000
163900             PERFORM 4410-READ-TEMP-STORAGE                       16390000
164000         END-IF                                                   16400000
164100     END-IF.                                                      16410000
164200 EJECT                                                            16420000
164300*----------------------------------------------------------------*16430000
164400*    FETCH THE CURSOR.                                            16440000
164500*----------------------------------------------------------------*16450000
164600                                                                  16460000
164700 4310-FETCH.                                                      16470000
164800                                                                  16480000
164900     MOVE 'CURSOR 1'                                              16490000
165000                  TO DP013-MESSAGE-TEXT (2).                      16500000
165100     EXEC SQL                                                     16510000
165200          FETCH CURSOR_ONE                                        16520000
165300          INTO  :INTERR-ERR-MSG-DESC                              16530000
165400              , :INTERR-SEG-ID                                    16540000
165500              , :INTERR-SEQ-SEQ-NBR                               16550000
165600              , :INTERR-REJ-SEQ-NBR                               16560000
165700     END-EXEC.                                                    16570000
165800                                                                  16580000
165900                                                                  16590000
166000     EVALUATE TRUE                                                16600000
166100         WHEN SQLCODE = ZERO                                      16610000
166200         WHEN SQLCODE = +100                                      16620000
166300             IF  SQLCODE EQUAL +100                               16630000
166400                 SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE              16640000
166500             END-IF                                               16650000
166600         WHEN SQLWARN0 NOT = SPACE                                16660000
166700         WHEN SQLCODE  NOT = ZERO                                 16670000
166800              MOVE '4310-FETCH-CURSOR'                            16680000
166900                               TO DP013-PARAGRAPH                 16690000
167000              MOVE 'FETCH CURSOR'                                 16700000
167100                               TO DP013-MESSAGE-TEXT (1)          16710000
167200              MOVE SQLCA       TO DP013-SQLCA                     16720000
167300              SET DP013-DB2-ABEND                                 16730000
167400                               TO TRUE                            16740000
167500              PERFORM DP013-0000-PROCESS-ABEND                    16750000
167600     END-EVALUATE.                                                16760000
167700                                                                  16770000
167800                                                                  16780000
167900                                                                  16790000
168000*----------------------------------------------------------------*16800000
168100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *16810000
168200*----------------------------------------------------------------*16820000
168300                                                                  16830000
168400 4400-MOVE-COMMAREA-TO-SCREEN.                                    16840000
168500     MOVE ASC-INT-CONTROL-NUMBER TO MR-INT-CONTROL-NUM.           16850000
168600     MOVE ASC-VENDOR-NAME     TO MR-VENDOR-NAME.                  16860000
168700                                                                  16870000
168800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             16880000
168900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          16890000
169000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          16900000
169100             MOVE +1    TO ASC-BLK-SUB                            16910000
169200             PERFORM 5100-WRITE-TEMP-STORAGE                      16920000
169300             ADD +1     TO ASC-BLK-SUB                            16930000
169400             PERFORM 5100-WRITE-TEMP-STORAGE                      16940000
169500             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             16950000
169600                 GIVING PV-BLOCK-NUMBER                           16960000
169700                 REMAINDER PV-REMAINDER                           16970000
169800             IF  PV-REMAINDER > ZERO                              16980000
169900                 ADD +1 TO PV-BLOCK-NUMBER                        16990000
170000             END-IF                                               17000000
170100             MOVE +1    TO ASC-BLK-SUB                            17010000
170200             PERFORM 4410-READ-TEMP-STORAGE                       17020000
170300             ADD +1     TO ASC-BLK-SUB                            17030000
170400                           PV-BLOCK-NUMBER                        17040000
170500             PERFORM 4410-READ-TEMP-STORAGE                       17050000
170600     END-IF.                                                      17060000
170700     MOVE +1            TO ASC-BLK-SUB.                           17070000
170800     COMPUTE ASC-ITEM-SUB =                                       17080000
170900         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              17090000
171000         + PC-ITEMS-PER-PANEL).                                   17100000
171100*                                                                 17110000
171200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17120000
171300         ADD +1         TO ASC-BLK-SUB                            17130000
171400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17140000
171500     END-IF.                                                      17150000
171600*                                                                 17160000
171700     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           17170000
171800         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                17180000
171900*    PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        17190000
172000     PERFORM 4420-FORMAT-LIST-LINES                               17200000
172100         VARYING PV-SUB                                           17210000
172200         FROM PC-ITEMS-PER-PANEL BY -1                            17220000
172300         UNTIL PV-SUB < +1.                                       17230000
172400*                                                                 17240000
172500     COMPUTE ASC-ITEMS-DISPLAYED =                                17250000
172600         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          17260000
172700     IF PS-NO-START-ITEM-ERROR                                    17270000
172800         MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL17280000
172900                                          ASTRTITO                17290000
173000         MOVE SPACE                    TO ASC-START-ITEM-REQUEST  17300000
173100     ELSE                                                         17310000
173200         MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                17320000
173300     END-IF.                                                      17330000
173400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    17340000
173500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    17350000
173600*    MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            17360000
173700*                                  TO ASELITO.                    17370000
173800*                                                                 17380000
173900     IF  DP020-MSG-NUMBER-X = SPACE                               17390000
174000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  17400000
174100*            --- MORE ITEMS TO DISPLAY ----                       17410000
174200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            17420000
174300             SET DP020-MSG-INFORMATIONAL TO TRUE                  17430000
174400         END-IF                                                   17440000
174500     END-IF.                                                      17450000
174600*----------------------------------------------------------------*17460000
174700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17470000
174800*----------------------------------------------------------------*17480000
174900                                                                  17490000
175000 4410-READ-TEMP-STORAGE.                                          17500000
175100                                                                  17510000
175200     EXEC CICS                                                    17520000
175300         READQ TS                                                 17530000
175400             QUEUE (ASC-LIST-QUEUE-NAME)                          17540000
175500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17550000
175600             ITEM  (PV-BLOCK-NUMBER)                              17560000
175700             RESP  (PV-CICS-RESP)                                 17570000
175800     END-EXEC.                                                    17580000
175900                                                                  17590000
176000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17600000
176100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17610000
176200         CONTINUE                                                 17620000
176300     ELSE                                                         17630000
176400         SET DP013-CICS-ABEND     TO TRUE                         17640000
176500         SET DP013-NO-ROLLBACK    TO TRUE                         17650000
176600         MOVE '4410-READ-TEMP-STORAGE'                            17660000
176700                                  TO DP013-PARAGRAPH              17670000
176800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17680000
176900                                  TO DP013-MESSAGE-TEXT(1)        17690000
177000         PERFORM DP013-0000-PROCESS-ABEND                         17700000
177100     END-IF.                                                      17710000
177200                                                                  17720000
177300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17730000
177400*                                                                 17740000
177500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         17750000
177600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               17760000
177700     END-IF.                                                      17770000
177800 EJECT                                                            17780000
177900*----------------------------------------------------------------*17790000
178000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *17800000
178100*----------------------------------------------------------------*17810000
178200                                                                  17820000
178300 4420-FORMAT-LIST-LINES.                                          17830000
178400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      17840000
178500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                17850000
178600         MOVE SPACE             TO  MR-ERROR-TEXT     (PV-SUB)    17860000
178700                                    MR-SEQUENCE-NUM   (PV-SUB)    17870000
178800                                    MR-SEGMENT-ID     (PV-SUB)    17880000
178900*----------------------END INITIALIZE                             17890000
179000     ELSE                                                         17900000
179100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           17910000
179200*---------------MOVE COMMAREA TO THE SCEEN----------------------- 17920000
179300*            MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           17930000
179400*                                TO MR-ACTION (PV-SUB)            17940000
179500             MOVE ASC-ERROR-TEXT      (ASC-BLK-SUB ASC-ITEM-SUB)  17950000
179600                                 TO MR-ERROR-TEXT     (PV-SUB)    17960000
179700             MOVE  ASC-SEGMENT-ID    (ASC-BLK-SUB ASC-ITEM-SUB)   17970000
179800                                 TO MR-SEGMENT-ID     (PV-SUB)    17980000
179900             MOVE  ASC-SEQUENCE-NUM  (ASC-BLK-SUB ASC-ITEM-SUB)   17990000
180000                                 TO MR-SEQUENCE-NUM   (PV-SUB)    18000000
180100*---------------MOVE COMMAREA TO THE SCEEN----------------------- 18010000
180200         END-IF                                                   18020000
180300     END-IF.                                                      18030000
180400     SUBTRACT +1 FROM ASC-ITEM-SUB                                18040000
180500     IF  ASC-ITEM-SUB < + 1                                       18050000
180600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  18060000
180700         MOVE +1                 TO ASC-BLK-SUB                   18070000
180800     END-IF.                                                      18080000
180900******************************************************************18090000
181000** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **18100000
181100** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **18110000
181200** ISSUE A WARNING.                                             **18120000
181300******************************************************************18130000
181400*4430-CHECK-FOR-BEGIN-AND-END.                                    18140000
181500*    IF  ASC-START-OF-SELECTED-RANGE > ZERO                       18150000
181600*        IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18160000
181700*            -- NO END-OF-RANGE SPECFIED ---                      18170000
181800*            MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            18180000
181900*            SET DP020-MSG-WARNING TO TRUE                        18190000
182000*            PERFORM 4431-POSITION-AT-WARNING                     18200000
182100*        END-IF                                                   18210000
182200*    ELSE                                                         18220000
182300*        IF  ASC-END-OF-SELECTED-RANGE > ZERO                     18230000
182400*            -- NO BEGINNING-OF-RANGE SPECFIED ---                18240000
182500*            MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            18250000
182600*            SET DP020-MSG-WARNING TO TRUE                        18260000
182700*            PERFORM 4431-POSITION-AT-WARNING                     18270000
182800*        END-IF                                                   18280000
182900*    END-IF.                                                      18290000
183000******************************************************************18300000
183100** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **18310000
183200** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **18320000
183300** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **18330000
183400** POSITION THE CURSOR THERE.                                   **18340000
183500******************************************************************18350000
183600*4431-POSITION-AT-WARNING.                                        18360000
183700*    COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18370000
183800*                   - PV-TOP-ITEM + 1.                            18380000
183900*    IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18390000
184000*        CONTINUE                                                 18400000
184100*    ELSE                                                         18410000
184200*        SET DP030-SET-CURSOR-APPL-1                              18420000
184300*                                  TO TRUE                        18430000
184400*        MOVE -1                   TO MR-SELECTL (PV-SUB)         18440000
184500*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18450000
184600*        MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         18460000
184700*    END-IF.                                                      18470000
184800*                                                                 18480000
184900*    COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18490000
185000*                   - PV-TOP-ITEM + 1.                            18500000
185100*    IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18510000
185200*        CONTINUE                                                 18520000
185300*    ELSE                                                         18530000
185400*        SET DP030-SET-CURSOR-APPL-1                              18540000
185500*                                  TO TRUE                        18550000
185600*        MOVE -1                   TO MR-SELECTL (PV-SUB)         18560000
185700*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18570000
185800*        MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         18580000
185900*    END-IF.                                                      18590000
186000*EJECT                                                            18600000
186100*----------------------------------------------------------------*18610000
186200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *18620000
186300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *18630000
186400* FOR THE SELECTED ITEMS QUEUE.                                  *18640000
186500*                                                                *18650000
186600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *18660000
186700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *18670000
186800* THE ARRAY IS FULL.                                             *18680000
186900*----------------------------------------------------------------*18690000
187000*                                                                 18700000
187100*5000-PREPARE-SEL-QUEUE.                                          18710000
187200*                                                                 18720000
187300*    MOVE +1                   TO  ASC-BLK-SUB.                   18730000
187400*    PERFORM 5100-WRITE-TEMP-STORAGE.                             18740000
187500*    ADD +1                    TO  ASC-BLK-SUB.                   18750000
187600*    PERFORM 5100-WRITE-TEMP-STORAGE.                             18760000
187700*                                                                 18770000
187800*    MOVE ASC-SEL-QUEUE-NAME   TO  ET307-SEL-QUEUE-NAME.          18780000
187900*    PERFORM 6010-DELETE-SEL-QUEUE.                               18790000
188000*                                                                 18800000
188100*    SET ASC-UPDATE-TSQ        TO  TRUE.                          18810000
188200*                                                                 18820000
188300*    SET ET308-IDX             TO  1.                             18830000
188400*    MOVE ZERO                 TO ET307-NUMBER-OF-TS-ITEMS.       18840000
188500*    INITIALIZE ET308-SELECTED-ITEM-ARRAY.                        18850000
188600*                                                                 18860000
188700*    PERFORM 5200-FILL-SEL-QUEUE-RECORD                           18870000
188800*            VARYING PV-ITEM                                      18880000
188900*            FROM 1 BY 1                                          18890000
189000*            UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN.           18900000
189100*                                                                 18910000
189200*    IF  ET308-IDX > 1                                            18920000
189300*        PERFORM 5205-WRITE-SEL-QUEUE                             18930000
189400*        ADD +1                TO ET307-NUMBER-OF-TS-ITEMS        18940000
189500*    END-IF.                                                      18950000
189600*EJECT                                                            18960000
189700*----------------------------------------------------------------*18970000
189800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *18980000
189900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *18990000
190000*----------------------------------------------------------------*19000000
190100*                                                                 19010000
190200 5100-WRITE-TEMP-STORAGE.                                         19020000
190300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     19030000
190400                                   TO PV-LIST-ITEM-NUMBER.        19040000
190500     COMPUTE PV-BLOCK-NUMBER =                                    19050000
190600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19060000
190700                                                                  19070000
190800     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             19080000
190900     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             19090000
191000         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      19100000
191100             PERFORM 5105-REWRITE-ASC-LISTQ                       19110000
191200         END-IF                                                   19120000
191300     ELSE                                                         19130000
191400         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       19140000
191500         ASC-HIGHEST-BLOCK-WRITTEN + 1                            19150000
191600         PERFORM 5110-WRITE-ASC-LISTQ                             19160000
191700         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   19170000
191800     END-IF.                                                      19180000
191900                                                                  19190000
192000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19200000
192100******************************************************************19210000
192200** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **19220000
192300** SPECIFIC COMMAREA.                                           **19230000
192400******************************************************************19240000
192500 5105-REWRITE-ASC-LISTQ.                                          19250000
192600     EXEC CICS                                                    19260000
192700         WRITEQ TS                                                19270000
192800             QUEUE (ASC-LIST-QUEUE-NAME)                          19280000
192900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19290000
193000             ITEM  (PV-BLOCK-NUMBER)                              19300000
193100             REWRITE                                              19310000
193200             RESP  (PV-CICS-RESP)                                 19320000
193300     END-EXEC.                                                    19330000
193400                                                                  19340000
193500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           19350000
193600         CONTINUE                                                 19360000
193700     ELSE                                                         19370000
193800         SET DP013-CICS-ABEND            TO TRUE                  19380000
193900         SET DP013-NO-ROLLBACK           TO TRUE                  19390000
194000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       19400000
194100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     19410000
194200                                         TO DP013-MESSAGE-TEXT(1) 19420000
194300         PERFORM DP013-0000-PROCESS-ABEND                         19430000
194400     END-IF.                                                      19440000
194500                                                                  19450000
194600******************************************************************19460000
194700** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **19470000
194800** SPECIFIC COMMAREA.                                           **19480000
194900******************************************************************19490000
195000 5110-WRITE-ASC-LISTQ.                                            19500000
195100     EXEC CICS                                                    19510000
195200         WRITEQ TS                                                19520000
195300             QUEUE (ASC-LIST-QUEUE-NAME)                          19530000
195400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19540000
195500             ITEM  (PV-BLOCK-NUMBER)                              19550000
195600             RESP  (PV-CICS-RESP)                                 19560000
195700     END-EXEC.                                                    19570000
195800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      19580000
195900         SET DP013-CICS-ABEND      TO TRUE                        19590000
196000         SET DP013-NO-ROLLBACK     TO TRUE                        19600000
196100         MOVE '5110-WRITE-ASC-LISTQ'                              19610000
196200                                   TO DP013-PARAGRAPH             19620000
196300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           19630000
196400                                   TO DP013-MESSAGE-TEXT(1)       19640000
196500         PERFORM DP013-0000-PROCESS-ABEND                         19650000
196600     END-IF.                                                      19660000
196700 EJECT                                                            19670000
196800*----------------------------------------------------------------*19680000
196900* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *19690000
197000* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *19700000
197100*----------------------------------------------------------------*19710000
197200*                                                                 19720000
197300*5200-FILL-SEL-QUEUE-RECORD.                                      19730000
197400*                                                                 19740000
197500*    PERFORM 6112-READ-LIST-QUEUE.                                19750000
197600*                                                                 19760000
197700*    IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       19770000
197800*        PERFORM                                                  19780000
197900*        VARYING LQW-IDX                                          19790000
198000*        FROM 1 BY 1                                              19800000
198100*        UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            19810000
198200*          OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          19820000
198300*                                                                 19830000
198400*            IF  LQW-SELECT (LQW-IDX)                             19840000
198500*                MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              19850000
198600*                                  TO ET308-ITEM (ET308-IDX)      19860000
198700*                                                                 19870000
198800*                MOVE LQW-ENT-ID        (LQW-IDX)                 19880000
198900*                      TO ET308-ENT-ID    (ET308-IDX)             19890000
199000*                MOVE LQW-VENDOR-NAME   (LQW-IDX)                 19900000
199100*                      TO ET308-VENDOR-NAME (ET308-IDX)           19910000
199200*                MOVE LQW-TP-DKEY       (LQW-IDX)                 19920000
199300*                      TO ET308-TP-DKEY     (ET308-IDX)           19930000
199400*                MOVE LQW-TP-DKEY-TMST  (LQW-IDX)                 19940000
199500*                      TO ET308-TP-DKEY-TMST (ET308-IDX)          19950000
199600*                MOVE SPACE        TO ET308-ACTION-SW (ET308-IDX) 19960000
199700*                SET ET308-IDX UP BY 1                            19970000
199800*                IF  ET308-IDX > ET308-MAX-ITEMS                  19980000
199900*                    PERFORM 5205-WRITE-SEL-QUEUE                 19990000
200000*                    ADD +1        TO ET307-NUMBER-OF-TS-ITEMS    20000000
200100*                    INITIALIZE ET308-SELECTED-ITEM-ARRAY         20010000
200200*                    SET ET308-IDX TO  1                          20020000
200300*                END-IF                                           20030000
200400*            END-IF                                               20040000
200500*        END-PERFORM                                              20050000
200600*    END-IF.                                                      20060000
200700*                                                                 20070000
200800*----------------------------------------------------------------*20080000
200900*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *20090000
201000*----------------------------------------------------------------*20100000
201100*                                                                 20110000
201200*5205-WRITE-SEL-QUEUE.                                            20120000
201300*                                                                 20130000
201400*    MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20140000
201500*                                  TO ET308-SELECTED-ITEMS.       20150000
201600*                                                                 20160000
201700*    EXEC CICS                                                    20170000
201800*         WRITEQ TS                                               20180000
201900*             QUEUE (ASC-SEL-QUEUE-NAME)                          20190000
202000*             FROM  (ET308-SELECTED-VNDRS)                        20200000
202100*             ITEM  (PV-SEL-QUEUE-ITEM)                           20210000
202200*             RESP  (PV-CICS-RESP)                                20220000
202300*    END-EXEC.                                                    20230000
202400*                                                                 20240000
202500*    IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20250000
202600*        CONTINUE                                                 20260000
202700*    ELSE                                                         20270000
202800*        SET DP013-CICS-ABEND      TO TRUE                        20280000
202900*        SET DP013-NO-ROLLBACK     TO TRUE                        20290000
203000*        MOVE '5205-WRITE-SEL-QUEUE'                              20300000
203100*                                  TO DP013-PARAGRAPH             20310000
203200*        MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          20320000
203300*                                  TO DP013-MESSAGE-TEXT(1)       20330000
203400*        PERFORM DP013-0000-PROCESS-ABEND                         20340000
203500*    END-IF.                                                      20350000
203600*EJECT                                                            20360000
203700******************************************************************20370000
203800** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **20380000
203900** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **20390000
204000** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **20400000
204100** THE USER.                                                    **20410000
204200******************************************************************20420000
204300*6000-REFRESH-PANEL-FROM-TEMP.                                    20430000
204400*    IF  ASC-UPDATE-TSQ                                           20440000
204500*        SET ASC-NO-TSQ-UPDATE TO TRUE                            20450000
204600*        MOVE ZERO                 TO PV-SAVE-ITEM                20460000
204700*                                     PV-SEL-QUEUE-ITEM           20470000
204800*        MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        20480000
204900*                                  TO PV-HOLD-SELECTED-ITEMS      20490000
205000*        PERFORM 6100-UPDATE-TSQ                                  20500000
205100*            UNTIL PV-ITEMS-PROCESSED >                           20510000
205200*                                    PV-HOLD-SELECTED-ITEMS       20520000
205300*        PERFORM 6010-DELETE-SEL-QUEUE                            20530000
205400*        INITIALIZE ASC-BLOCK-ENTRIES (1)                         20540000
205500*                   ASC-BLOCK-ENTRIES (2)                         20550000
205600*                                                                 20560000
205700*        DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 20570000
205800*               GIVING PV-BLOCK-NUMBER                            20580000
205900*               REMAINDER PV-REMAINDER                            20590000
206000*        IF  PV-REMAINDER > ZERO                                  20600000
206100*            ADD +1     TO PV-BLOCK-NUMBER                        20610000
206200*        END-IF                                                   20620000
206300*        MOVE +1        TO ASC-BLK-SUB                            20630000
206400*        PERFORM 4410-READ-TEMP-STORAGE                           20640000
206500*        ADD +1         TO ASC-BLK-SUB                            20650000
206600*                          PV-BLOCK-NUMBER                        20660000
206700*        PERFORM 4410-READ-TEMP-STORAGE                           20670000
206800*                                                                 20680000
206900*    END-IF.                                                      20690000
207000*                                                                 20700000
207100*----------------------------------------------------------------*20710000
207200*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *20720000
207300*----------------------------------------------------------------*20730000
207400*6010-DELETE-SEL-QUEUE.                                           20740000
207500*                                                                 20750000
207600*    EXEC CICS                                                    20760000
207700*        DELETEQ TS                                               20770000
207800*            QUEUE (ASC-SEL-QUEUE-NAME)                           20780000
207900*            RESP  (PV-CICS-RESP)                                 20790000
208000*    END-EXEC.                                                    20800000
208100*                                                                 20810000
208200*    IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      20820000
208300*       (PV-CICS-RESP = DFHRESP(QIDERR)))                         20830000
208400*        CONTINUE                                                 20840000
208500*    ELSE                                                         20850000
208600*        SET DP013-CICS-ABEND TO TRUE                             20860000
208700*        SET DP013-NO-ROLLBACK TO TRUE                            20870000
208800*        MOVE '6010-DELETE-SEL-QUEUE'                             20880000
208900*                       TO DP013-PARAGRAPH                        20890000
209000*        MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         20900000
209100*                       TO DP013-MESSAGE-TEXT (1)                 20910000
209200*        PERFORM DP013-0000-PROCESS-ABEND                         20920000
209300*    END-IF.                                                      20930000
209400*                                                                 20940000
209500*----------------------------------------------------------------*20950000
209600*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *20960000
209700*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *20970000
209800*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *20980000
209900*    THE TEMP QUEUE.                                             *20990000
210000*----------------------------------------------------------------*21000000
210100*                                                                 21010000
210200*6100-UPDATE-TSQ.                                                 21020000
210300*                                                                 21030000
210400*    ADD 1                     TO  PV-SEL-QUEUE-ITEM.             21040000
210500*    PERFORM 6105-READ-SEL-QUEUE.                                 21050000
210600*    PERFORM                                                      21060000
210700*        VARYING ET308-IDX                                        21070000
210800*        FROM 1 BY 1                                              21080000
210900*        UNTIL ((PV-ITEMS-PROCESSED >                             21090000
211000*                             PV-HOLD-SELECTED-ITEMS)             21100000
211100*        OR (ET308-IDX GREATER THAN ET308-MAX-ITEMS))             21110000
211200*        IF  ET308-ACTION-SW (ET308-IDX) > SPACE                  21120000
211300*            PERFORM 6110-PROCESS-ITEMS                           21130000
211400*        END-IF                                                   21140000
211500*        ADD +1                TO PV-ITEMS-PROCESSED              21150000
211600*    END-PERFORM.                                                 21160000
211700*    PERFORM 6111-WRITE-LIST-QUEUE.                               21170000
211800*----------------------------------------------------------------*21180000
211900*    READ THE LIST QUEUE RECORD.                                 *21190000
212000*----------------------------------------------------------------*21200000
212100*                                                                 21210000
212200*6105-READ-SEL-QUEUE.                                             21220000
212300*                                                                 21230000
212400*    EXEC CICS                                                    21240000
212500*         READQ TS                                                21250000
212600*             QUEUE (ASC-SEL-QUEUE-NAME)                          21260000
212700*             INTO  (ET308-SELECTED-VNDRS)                        21270000
212800*             ITEM  (PV-SEL-QUEUE-ITEM)                           21280000
212900*             RESP  (PV-CICS-RESP)                                21290000
213000*    END-EXEC.                                                    21300000
213100*                                                                 21310000
213200*    IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21320000
213300*        CONTINUE                                                 21330000
213400*    ELSE                                                         21340000
213500*        SET DP013-CICS-ABEND      TO  TRUE                       21350000
213600*        SET DP013-NO-ROLLBACK     TO  TRUE                       21360000
213700*        MOVE '6105-READ-SEL-QUEUE'                               21370000
213800*                                  TO  DP013-PARAGRAPH            21380000
213900*        MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           21390000
214000*                                  TO  DP013-MESSAGE-TEXT(1)      21400000
214100*        PERFORM DP013-0000-PROCESS-ABEND                         21410000
214200*    END-IF.                                                      21420000
214300*EJECT                                                            21430000
214400*----------------------------------------------------------------*21440000
214500*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*21450000
214600*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*21460000
214700*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *21470000
214800*----------------------------------------------------------------*21480000
214900                                                                  21490000
215000 6110-PROCESS-ITEMS.                                              21500000
215100                                                                  21510000
215200     COMPUTE PV-ITEM = 1 + ((ET308-ITEM (ET308-IDX) - 1)          21520000
215300                     / PC-ITEMS-PER-PANEL).                       21530000
215400                                                                  21540000
215500     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           21550000
215600         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          21560000
215700             PERFORM 6111-WRITE-LIST-QUEUE                        21570000
215800         END-IF                                                   21580000
215900         MOVE PV-ITEM          TO PV-SAVE-ITEM                    21590000
216000                                                                  21600000
216100         PERFORM 6112-READ-LIST-QUEUE                             21610000
216200         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               21620000
216300             CONTINUE                                             21630000
216400         END-IF                                                   21640000
216500     END-IF.                                                      21650000
216600                                                                  21660000
216700     COMPUTE PV-SUB = (ET308-ITEM (ET308-IDX)                     21670000
216800                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              21680000
216900     SET LQW-DESELECT (PV-SUB) TO    TRUE                         21690000
217000     MOVE LQW-SELECTED-SW (PV-SUB)                                21700000
217100                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  21710000
217200                                                                  21720000
217300     MOVE ET308-ACTION-SW (ET308-IDX)   TO LQW-ACTION (PV-SUB).   21730000
217400     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                21740000
217500                                                                  21750000
217600*----------------------------------------------------------------*21760000
217700*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *21770000
217800*----------------------------------------------------------------*21780000
217900                                                                  21790000
218000 6111-WRITE-LIST-QUEUE.                                           21800000
218100                                                                  21810000
218200     EXEC CICS                                                    21820000
218300         WRITEQ TS                                                21830000
218400             QUEUE (ASC-LIST-QUEUE-NAME)                          21840000
218500             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     21850000
218600             ITEM  (PV-SAVE-ITEM)                                 21860000
218700             REWRITE                                              21870000
218800             RESP  (PV-CICS-RESP)                                 21880000
218900     END-EXEC.                                                    21890000
219000*                                                                 21900000
219100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21910000
219200         CONTINUE                                                 21920000
219300     ELSE                                                         21930000
219400         SET DP013-CICS-ABEND  TO  TRUE                           21940000
219500         SET DP013-NO-ROLLBACK TO  TRUE                           21950000
219600         MOVE '6111-WRITE-LIST-QUEUE'                             21960000
219700                               TO  DP013-PARAGRAPH                21970000
219800         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  21980000
219900                               TO  DP013-MESSAGE-TEXT(1)          21990000
220000         PERFORM DP013-0000-PROCESS-ABEND                         22000000
220100     END-IF.                                                      22010000
220200                                                                  22020000
220300 EJECT                                                            22030000
220400*----------------------------------------------------------------*22040000
220500*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*22050000
220600*----------------------------------------------------------------*22060000
220700                                                                  22070000
220800 6112-READ-LIST-QUEUE.                                            22080000
220900                                                                  22090000
221000     EXEC CICS                                                    22100000
221100         READQ TS                                                 22110000
221200             QUEUE (ASC-LIST-QUEUE-NAME)                          22120000
221300             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     22130000
221400             ITEM  (PV-ITEM)                                      22140000
221500             RESP  (PV-CICS-RESP)                                 22150000
221600     END-EXEC.                                                    22160000
221700*                                                                 22170000
221800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22180000
221900         CONTINUE                                                 22190000
222000     ELSE                                                         22200000
222100         SET DP013-CICS-ABEND        TO TRUE                      22210000
222200         SET DP013-NO-ROLLBACK       TO TRUE                      22220000
222300         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           22230000
222400         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    22240000
222500                                     TO DP013-MESSAGE-TEXT(1)     22250000
222600         PERFORM DP013-0000-PROCESS-ABEND                         22260000
222700     END-IF.                                                      22270000
222800                                                                  22280000
222900******************************************************************22290000
223000* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *22300000
223100******************************************************************22310000
223200                                                                  22320000
223300 9100-READ-SEL-QUEUE.                                             22330000
223400     EXEC CICS                                                    22340000
223500         READQ TS                                                 22350000
223600             QUEUE (ASC-SEL-QUEUE-NAME)                           22360000
223700             INTO  (ET308-SELECTED-VNDRS)                         22370000
223800             ITEM  (ASC-SEL-ITEM)                                 22380000
223900             RESP  (PV-CICS-RESP)                                 22390000
224000     END-EXEC.                                                    22400000
224100                                                                  22410000
224200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       22420000
224300         CONTINUE                                                 22430000
224400     ELSE                                                         22440000
224500         SET DP013-LOGIC-ABEND                                    22450000
224600             DP013-NO-ROLLBACK     TO TRUE                        22460000
224700         MOVE '9100-READ-SEL-QUEUE'                               22470000
224800                                   TO DP013-PARAGRAPH             22480000
224900         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   22490000
225000                                   TO DP013-MESSAGE-TEXT (1)      22500000
225100         PERFORM DP013-0000-PROCESS-ABEND                         22510000
225200     END-IF.                                                      22520000
225300*                                                                 22530000
225400******************************************************************22540000
225500* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *22550000
225600******************************************************************22560000
225700 9200-REWRITE-SEL-QUEUE.                                          22570000
225800     EXEC CICS                                                    22580000
225900          WRITEQ TS                                               22590000
226000              QUEUE  (ASC-SEL-QUEUE-NAME)                         22600000
226100              FROM   (ET308-SELECTED-VNDRS)                       22610000
226200              ITEM   (ASC-SEL-ITEM)                               22620000
226300              RESP   (PV-CICS-RESP)                               22630000
226400              REWRITE                                             22640000
226500     END-EXEC.                                                    22650000
226600                                                                  22660000
226700     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   22670000
226800         SET DP013-CICS-ABEND                                     22680000
226900             DP013-NO-ROLLBACK     TO TRUE                        22690000
227000         MOVE '9200-REWRITE-SEL-QUEUE'                            22700000
227100                                   TO DP013-PARAGRAPH             22710000
227200         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   22720000
227300                                   TO DP013-MESSAGE-TEXT (1)      22730000
227400         PERFORM DP013-0000-PROCESS-ABEND                         22740000
227500     END-IF.                                                      22750000
227600                                                                  22760000
227700 EJECT                                                            22770000
227800*----------------------------------------------------------------*22780000
227900*    ABEND PROCESSOR MODULE                                      *22790000
228000*----------------------------------------------------------------*22800000
228100                                                                  22810000
228200     COPY DPPD013.                                                22820000
