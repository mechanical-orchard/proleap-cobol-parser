000100 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.     APKUT324.                                        00020030
000300 AUTHOR.         SCOTT KRUSCHKA.                                  00030030
000400 DATE-WRITTEN.   10/23/2007.                                      00040030
000500 DATE-COMPILED.                                                   00050002
000600***************************************************************** 00060002
000700*  COBOL 2 WITH SQL                                             * 00070002
000800*                                                               * 00080002
000900*  WEEKLY LI & FUNG RECEIPTS EXTRACT.                           * 00090046
001000*                                                               * 00100002
001100*  CREATE FILE OF ALL LI & FUNG RECEIPTS ENTERED DURING THE PAST* 00110030
001200*  WEEK AND FORMAT THEM INTO AN OUTPUT FILE THAT CAN BE FTP'D   * 00120039
001300*  TO THE SERVER.                                               * 00130039
001400*                                                               * 00140002
001500***************************************************************** 00150002
001600*---------------------------------------------------------------* 00160002
001700* CHANGE LOG:                                                   * 00170002
001800*                                                               * 00180002
001900*                                                               * 00190025
002000*---------------------------------------------------------------* 00200002
002100                                                                  00210002
002200 ENVIRONMENT DIVISION.                                            00220002
002300 CONFIGURATION SECTION.                                           00230002
002400 SOURCE-COMPUTER.    IBM-3090.                                    00240002
002500 OBJECT-COMPUTER.    IBM-3090.                                    00250002
002600                                                                  00260002
002700 INPUT-OUTPUT SECTION.                                            00270002
002800 FILE-CONTROL.                                                    00280002
002900     SELECT LIFUNG-RCPT-FILE     ASSIGN TO UT-S-OUT01.            00290033
003000                                                                  00300002
003100 DATA DIVISION.                                                   00310002
003200 FILE SECTION.                                                    00320002
003300                                                                  00330002
003400 FD  LIFUNG-RCPT-FILE                                             00340030
003500     RECORDING MODE IS F                                          00350002
003600     LABEL RECORDS ARE STANDARD                                   00360002
003700     DATA RECORD IS RECYC-VCHR-REC.                               00370002
003800                                                                  00380043
003900 01  LIFUNG-RCPT-REC             PIC X(35).                       00390045
004000                                                                  00400043
004100 WORKING-STORAGE SECTION.                                         00410002
004200                                                                  00420002
004300 01  LIFUNG-HEADER-RCPT-REC.                                      00430043
004400     05  LF-HDR-DEPT             PIC X(04) VALUE "DEPT".          00440043
004500     05  LF-HDR-DELIMT-01        PIC X(01) VALUE ",".             00450043
004600     05  LF-HDR-CLASS            PIC X(05) VALUE "CLASS".         00460043
004700     05  LF-HDR-DELIMT-02        PIC X(01) VALUE ",".             00470043
004800     05  LF-HDR-UNIT-COST        PIC X(08) VALUE "ELC COST".      00480043
004900     05  LF-HDR-DELIMT-03        PIC X(01) VALUE ",".             00490043
005000     05  LF-HDR-1ST-COST         PIC X(08) VALUE "1ST COST".      00500043
005100     05  LF-HDR-DELIMT-04        PIC X(01) VALUE ",".             00510043
005200     05  FILLER                  PIC X(06) VALUE SPACES.          00520045
005300                                                                  00530043
005400 01  LIFUNG-DETAIL-RCPT-REC.                                      00540043
005500     05  LF-DTL-DEPT-NBR         PIC X(03).                       00550043
005600     05  LF-DTL-DELIMIT-01       PIC X(01) VALUE ",".             00560044
005700     05  LF-DTL-CL-NBR           PIC X(02).                       00570043
005800     05  LF-DTL-DELIMIT-02       PIC X(01) VALUE ",".             00580044
005900     05  LF-DTL-UNIT-COST-AMT    PIC ---------9.99.               00590043
006000     05  LF-DTL-DELIMIT-03       PIC X(01) VALUE ",".             00600044
006100     05  LF-DTL-1ST-COST-AMT     PIC ---------9.99.               00610043
006200     05  LF-DTL-DELIMIT-04       PIC X(01) VALUE ",".             00620044
006300                                                                  00630043
006400 01  PV-PROGRAM-VARIABLES.                                        00640002
006500     05  FILLER                  PIC  X(31)  VALUE                00650033
006600         '** BEGINNING OF APKUT324 W/S **'.                       00660030
006700     05  PV-PROGRAM-NAME         PIC  X(08)  VALUE 'APKUT324'.    00670033
006800     05  PV-CURRENT-DATE.                                         00680002
006900         10  PV-CURRENT-YEAR     PIC  9(02)  VALUE ZEROS.         00690002
007000         10  PV-CURRENT-MONTH    PIC  9(02)  VALUE ZEROS.         00700002
007100         10  PV-CURRENT-DAY      PIC  9(02)  VALUE ZEROS.         00710002
007200     05  PV-CURRENT-TIME.                                         00720002
007300         10  PV-CURRENT-HOUR     PIC  9(02)  VALUE ZEROS.         00730002
007400         10  PV-CURRENT-MINUTE   PIC  9(02)  VALUE ZEROS.         00740002
007500         10  FILLER              PIC  9(02)  VALUE ZEROS.         00750002
007600     05  PV-START-TMST           PIC  X(26)  VALUE SPACES.        00760033
007700     05  PV-START-TMST-R1 REDEFINES PV-START-TMST.                00770033
007800         10  PV-START-DATE       PIC  X(10).                      00780033
007900         10  PV-START-HHMMSS     PIC  X(16).                      00790033
008000     05  PV-END-TMST             PIC  X(26)  VALUE SPACES.        00800033
008100     05  PV-END-TMST-R1 REDEFINES PV-END-TMST.                    00810033
008200         10  PV-END-DATE         PIC  X(10).                      00820033
008300         10  PV-END-HHMMSS       PIC  X(16).                      00830033
008400     05  PV-UNIT-COST-AMT        PIC  S9(9)V999 COMP-3 VALUE 0.   00840035
008500     05  PV-1ST-COST-AMT         PIC  S9(9)V999 COMP-3 VALUE 0.   00850035
008600                                                                  00860022
008700 01  PC-COUNTERS.                                                 00870033
008800     05  PC-COUNT-LIFUNG-RCPT-READ PIC  9(07)  VALUE ZEROS.       00880033
008900     05  PC-COUNT-RCPT-WRITTEN     PIC  9(07)  VALUE ZEROS.       00890033
009000                                                                  00900022
009100 01  PS-PROGRAM-SWITCHES.                                         00910022
009200     05  PS-END-OF-LIFUNG-SW     PIC X(01)        VALUE 'N'.      00920026
009300         88  MORE-LIFUNG-CSR                      VALUE 'N'.      00930026
009400         88  END-OF-LIFUNG-CSR                    VALUE 'Y'.      00940026
009500                                                                  00950022
009600*----------------------------------------------------------------*00960022
009700*  COMMUNICATIONS AREA2 FOR DB2                                  *00970022
009800*----------------------------------------------------------------*00980022
009900     COPY SQLCA2.                                                 00990022
010000                                                                  01000022
010100     EXEC SQL                                                     01010022
010200          INCLUDE SQLCA                                           01020022
010300     END-EXEC.                                                    01030022
010400                                                                  01040022
010500*----------------------------------------------------------------*01050022
010600*  AP CONTROL TABLE                                              *01060022
010700*----------------------------------------------------------------*01070022
010800     EXEC SQL                                                     01080022
010900          INCLUDE TAPCNTL                                         01090022
011000     END-EXEC.                                                    01100022
011100                                                                  01110022
011200*----------------------------------------------------------------*01120022
011300*  RECEIVERS TABLE                                               *01130030
011400*----------------------------------------------------------------*01140022
011500     EXEC SQL                                                     01150022
011600          INCLUDE TRECEIV                                         01160030
011700     END-EXEC.                                                    01170022
011800                                                                  01180022
011900*----------------------------------------------------------------*01190030
012000*  PURCHASE ORDER HEADER TABLE                                   *01200030
012100*----------------------------------------------------------------*01210030
012200     EXEC SQL                                                     01220030
012300          INCLUDE TPURCHS                                         01230030
012400     END-EXEC.                                                    01240030
012500                                                                  01250030
012600*----------------------------------------------------------------*01260030
012700*  PURCHASE ORDER ITEMS TABLE                                    *01270030
012800*----------------------------------------------------------------*01280030
012900     EXEC SQL                                                     01290030
013000          INCLUDE TPURITM                                         01300030
013100     END-EXEC.                                                    01310030
013200                                                                  01320030
013300*----------------------------------------------------------------*01330030
013400*  RECEIVING DISTRIBUTION TABLE                                  *01340030
013500*----------------------------------------------------------------*01350030
013600     EXEC SQL                                                     01360030
013700          INCLUDE TRECDIS                                         01370030
013800     END-EXEC.                                                    01380030
013900                                                                  01390030
014000*----------------------------------------------------------------*01400022
014100*   LIFUNG_CSR SELECTS ALL RECEIPTS THROUGHOUT THE PAST WEEK     *01410030
014200*   BASED UPON THE START AND END DATES.                          *01420030
014300*----------------------------------------------------------------*01430022
014400     EXEC SQL                                                     01440042
014500       DECLARE LIFUNG_CSR CURSOR FOR                              01450042
014600         SELECT PS.DEPT_NBR                                       01460042
014700              , PI.CL_NBR                                         01470042
014800              , SUM(AP_VERIFY_ITM_QTY * UNT_COST_AMT)             01480042
014900              , SUM(AP_VERIFY_ITM_QTY * PRD_1ST_COST_AMT)         01490042
015000           FROM TRECEIV RV                                        01500042
015100              , TPURCHS PS                                        01510042
015200              , TPURITM PI                                        01520042
015300              , TRECDIS RD                                        01530042
015400         WHERE PS.ENT_ID = 10593                                  01540042
015500           AND RV.ORD_NBR   = PS.PO_NBR                           01550042
015600           AND PI.PO_NBR    = PS.PO_NBR                           01560042
015700           AND RV.ORD_NBR   = RD.ORD_NBR                          01570042
015800           AND RV.REC_SEQ_NBR = RD.REC_SEQ_NBR                    01580042
015900           AND PI.PO_LNE_NBR = RD.ORD_LNE_NBR                     01590042
016000           AND RV.STATUS_CDE  = 'VE'                              01600042
016100           AND PS.VER_STATUS_CDE = 'A'                            01610042
016200           AND PI.VER_STATUS_CDE = 'A'                            01620042
016300           AND VERFYD_TMST BETWEEN :PV-START-TMST                 01630042
016400                               AND :PV-END-TMST                   01640042
016500         GROUP BY                                                 01650042
016600               PS.DEPT_NBR                                        01660042
016700             , PI.CL_NBR                                          01670042
016800     END-EXEC.                                                    01680042
016900                                                                  01690042
017000*----------------------------------------------------------------*01700022
017100*  ABEND DATA AREAS                                              *01710022
017200*----------------------------------------------------------------*01720022
017300 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01730022
017400                                             COMP SYNC.           01740022
017500     88  AC-BAD-DATA                         VALUE +4003.         01750022
017600     88  AC-DB2-ERROR                        VALUE +4013.         01760022
017700                                                                  01770022
017800 01  ABEND-AREAS.                                                 01780022
017900     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01790022
018000             '*****       ABEND'.                                 01800022
018100     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01810022
018200             '*****   PROGRAM: APKUT324'.                         01820031
018300     05  AA-PARAGRAPH-LIT.                                        01830022
018400         10  FILLER              PIC  X(17)  VALUE                01840022
018500             '***** PARAGRAPH: '.                                 01850022
018600         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01860022
018700     05  AA-MESSAGE-LINE.                                         01870022
018800         10  FILLER              PIC  X(06)  VALUE '*****'.       01880022
018900         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        01890022
019000     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01900022
019100             '*****    DB2 ERROR'.                                01910022
019200     05  AA-DB2-OPERATION-LIT.                                    01920022
019300         10  FILLER              PIC  X(17)  VALUE                01930022
019400             '***** OPERATION: '.                                 01940022
019500         10  AA-DB2-OPERATION.                                    01950022
019600             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        01960022
019700             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        01970022
019800     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        01980022
019900     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        01990022
020000     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        02000022
020100     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        02010032
020200                                                                  02020022
020300     COPY DPWS004.                                                02030022
020400 01  FILLER                      PIC  X(25)  VALUE                02040022
020500     '** END OF APKUT324 W/S **'.                                 02050031
020600                                                                  02060022
020700 PROCEDURE DIVISION.                                              02070022
020800                                                                  02080042
020900 A100-MAIN.                                                       02090022
021000     PERFORM B100-INITIALIZATION.                                 02100022
021100                                                                  02110022
021200     PERFORM B200-PROCESS-LIFUNG-RCPT                             02120031
021300       UNTIL END-OF-LIFUNG-CSR.                                   02130026
021400                                                                  02140022
021500     PERFORM B300-END-PROGRAM.                                    02150022
021600                                                                  02160022
021700     GOBACK.                                                      02170022
021800                                                                  02180022
021900 B100-INITIALIZATION.                                             02190022
022000*----------------------------------------------------------------*02200022
022100*    OPEN OUTPUT FILE AND PERFORM INITIALIZATION.                *02210022
022200*----------------------------------------------------------------*02220022
022300     OPEN OUTPUT LIFUNG-RCPT-FILE.                                02230031
022400                                                                  02240022
022500     INITIALIZE DCLTRECEIV                                        02250031
022600                DCLTPURCHS                                        02260031
022700                DCLTPURITM                                        02270031
022800                DCLTRECDIS                                        02280031
022900                LIFUNG-RCPT-REC.                                  02290045
023000                                                                  02300022
023100     PERFORM S100-GET-DATES.                                      02310022
023200     MOVE '-00.00.00.000001' TO PV-START-HHMMSS.                  02320037
023300     MOVE '-23.59.59.999999' TO PV-END-HHMMSS.                    02330037
023400                                                                  02340022
023500** THIS INITIAL WRITE PUTS A RECORD OF HEADINGS AS THE FIRST      02350043
023600** RECORD ON THE FILE.                                            02360043
023700                                                                  02370043
023800     MOVE LIFUNG-HEADER-RCPT-REC TO LIFUNG-RCPT-REC.              02380043
023900     PERFORM W100-WRITE-LIFUNG-RCPT-REC.                          02390043
024000                                                                  02400023
024100     PERFORM Y100-OPEN-LIFUNG-CSR.                                02410026
024200                                                                  02420022
024300     PERFORM R100-FETCH-LIFUNG-RCPT.                              02430031
024400     IF END-OF-LIFUNG-CSR                                         02440026
024500         DISPLAY '***  APKUT324  ***'                             02450031
024600         DISPLAY 'FIRST FETCH OF LI & FUNG CURSOR   '             02460026
024700         DISPLAY 'NO LI & FUNG RECEIPTS FOUND       '             02470033
024800         DISPLAY ' '                                              02480022
024900     END-IF.                                                      02490022
025000                                                                  02500022
025100 B200-PROCESS-LIFUNG-RCPT.                                        02510031
025200*----------------------------------------------------------------*02520022
025300*    CREATING OUTPUT FILE BY MOVING FIELDS FETCHED INTO THEIR    *02530022
025400*    CORRESPONDING COPYBOOK FIELDS.                              *02540022
025500*----------------------------------------------------------------*02550022
025600     INITIALIZE LIFUNG-RCPT-REC.                                  02560045
025700                                                                  02570022
025800     MOVE PURCHS-DEPT-NBR          TO LF-DTL-DEPT-NBR.            02580043
025900**   MOVE ','                      TO LF-DTL-DELIMIT-01.          02590044
026000     MOVE PURITM-CL-NBR            TO LF-DTL-CL-NBR.              02600043
026100**   MOVE ','                      TO LF-DTL-DELIMIT-02.          02610044
026200     MOVE PV-UNIT-COST-AMT         TO LF-DTL-UNIT-COST-AMT.       02620043
026300**   MOVE ','                      TO LF-DTL-DELIMIT-03.          02630044
026400     MOVE PV-1ST-COST-AMT          TO LF-DTL-1ST-COST-AMT.        02640043
026500**   MOVE ','                      TO LF-DTL-DELIMIT-04.          02650044
026600     MOVE LIFUNG-DETAIL-RCPT-REC   TO LIFUNG-RCPT-REC.            02660043
026700                                                                  02670022
026800     PERFORM W100-WRITE-LIFUNG-RCPT-REC.                          02680031
026900                                                                  02690022
027000     PERFORM R100-FETCH-LIFUNG-RCPT.                              02700031
027100                                                                  02710022
027200 B300-END-PROGRAM.                                                02720022
027300*----------------------------------------------------------------*02730022
027400*    ENDING PROCESSING: DISPLAYS COUNTS, AND CLOSES FILES.       *02740022
027500*----------------------------------------------------------------*02750022
027600     CLOSE LIFUNG-RCPT-FILE.                                      02760031
027700                                                                  02770022
027800     DISPLAY '       '                                            02780022
027900     DISPLAY '**********************************'                 02790022
028000     DISPLAY '******** APKUT324 SUMMARY ********'.                02800031
028100     DISPLAY 'START DATE = ' PV-START-DATE                        02810022
028200     DISPLAY 'END DATE   = ' PV-END-DATE                          02820022
028300     DISPLAY 'LI & FUNG RCPT FETCHED = '                          02830031
028400                                       PC-COUNT-LIFUNG-RCPT-READ. 02840031
028500     DISPLAY 'TOTAL RECORDS WRITTEN  = '                          02850026
028600                                       PC-COUNT-RCPT-WRITTEN.     02860031
028700     DISPLAY '**********************************'                 02870026
028800     DISPLAY '       '                                            02880026
028900                                                                  02890026
029000     PERFORM Y200-CLOSE-LIFUNG-CSR.                               02900026
029100                                                                  02910026
029200 R100-FETCH-LIFUNG-RCPT.                                          02920031
029300*----------------------------------------------------------------*02930026
029400*  RETRIEVES THE LIFUNG_CSR DATA                                 *02940026
029500*----------------------------------------------------------------*02950026
029600     EXEC SQL                                                     02960042
029700         FETCH   LIFUNG_CSR                                       02970042
029800          INTO  :PURCHS-DEPT-NBR                                  02980042
029900               ,:PURITM-CL-NBR                                    02990042
030000               ,:PV-UNIT-COST-AMT                                 03000042
030100               ,:PV-1ST-COST-AMT                                  03010042
030200     END-EXEC.                                                    03020042
030300                                                                  03030041
030400     EVALUATE TRUE                                                03040026
030500         WHEN SQLCODE = ZERO                                      03050026
030600             ADD 1 TO PC-COUNT-LIFUNG-RCPT-READ                   03060032
030700         WHEN SQLCODE = +100                                      03070026
030800             SET END-OF-LIFUNG-CSR TO TRUE                        03080026
030900                                                                  03090026
031000         WHEN SQLWARN0 NOT = SPACES                               03100026
031100         WHEN SQLCODE  NOT = ZERO                                 03110026
031200             MOVE 'R100-FETCH-LIFUNG-RCPT'                        03120032
031300                                        TO AA-PARAGRAPH-NAME      03130026
031400             MOVE 'UNSUCCESSFUL FETCH WITH LIFUNG_CSR'            03140026
031500                                        TO AA-DB2-OPERATION       03150026
031600             MOVE 'TRECEIV'             TO AA-DB2-TABLE-1         03160032
031700             MOVE 'TPURCHS'             TO AA-DB2-TABLE-2         03170032
031800             MOVE 'TPURITM'             TO AA-DB2-TABLE-3         03180032
031900             MOVE 'TRECDIS'             TO AA-DB2-TABLE-4         03190032
032000             PERFORM Z998-DB2-ABEND                               03200026
032100     END-EVALUATE.                                                03210026
032200                                                                  03220026
032300 S100-GET-DATES.                                                  03230026
032400*----------------------------------------------------------------*03240026
032500*    SELECT THE BEGINNING AND ENDING DATES BY USING              *03250036
032600*    PREV_WK_END_DTE.  THIS PROGRAM RUNS BEFORE IT'S UPDATED     *03260038
032700*    BY APKUP076 IN JOB APK200.                                  *03270036
032800*    THE EXTRACT DATES SHOULD BE FOR SUNDAY THRU SATURDAY.       *03280032
032900*    THIS IS SETUP ASSUMING TO BE RUN ON SATURDAY.               *03290032
033000*----------------------------------------------------------------*03300026
033100                                                                  03310026
033200         EXEC SQL                                                 03320026
033300             SELECT  (PREV_WK_END_DTE - 6 DAYS)                   03330038
033400                    ,PREV_WK_END_DTE                              03340038
033500               INTO  :PV-START-DATE                               03350026
033600                    ,:PV-END-DATE                                 03360026
033700               FROM  TAPCNTL                                      03370026
033800         END-EXEC.                                                03380026
033900                                                                  03390026
034000         EVALUATE TRUE                                            03400026
034100           WHEN SQLCODE = ZERO                                    03410026
034200             CONTINUE                                             03420026
034300           WHEN SQLWARN0 NOT = SPACES                             03430026
034400           WHEN SQLCODE NOT  = ZERO                               03440026
034500             MOVE 'S100-GET-DATES'                                03450026
034600                                 TO AA-PARAGRAPH-NAME             03460026
034700             MOVE 'UNSUCCESSFUL SELECT'                           03470026
034800                                 TO AA-DB2-OPERATION              03480026
034900             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                03490026
035000             MOVE SPACES         TO AA-DB2-TABLE-2                03500026
035100                                    AA-DB2-TABLE-3                03510026
035200                                    AA-DB2-TABLE-4                03520032
035300             PERFORM Z998-DB2-ABEND                               03530026
035400         END-EVALUATE.                                            03540026
035500                                                                  03550026
035600 W100-WRITE-LIFUNG-RCPT-REC.                                      03560032
035700*----------------------------------------------------------------*03570026
035800*    WRITE THE RECEIPT RECORDS TO THE FILE                       *03580032
035900*----------------------------------------------------------------*03590026
036000                                                                  03600026
036100**   WRITE LIFUNG-RCPT-REC FROM LIFUNG-RECEIPT-RECORD.            03610043
036200     WRITE LIFUNG-RCPT-REC.                                       03620045
036300                                                                  03630026
036400     ADD 1 TO PC-COUNT-RCPT-WRITTEN.                              03640032
036500                                                                  03650026
036600**   INITIALIZE LIFUNG-RCPT-REC.                                  03660045
036700                                                                  03670026
036800 Y100-OPEN-LIFUNG-CSR.                                            03680026
036900*---------------------------------------------------------------- 03690026
037000*    OPEN LIFUNG_CSR CURSOR.                                      03700033
037100*---------------------------------------------------------------- 03710026
037200                                                                  03720026
037300     EXEC SQL                                                     03730026
037400         OPEN LIFUNG_CSR                                          03740026
037500     END-EXEC.                                                    03750026
037600                                                                  03760026
037700     EVALUATE TRUE                                                03770026
037800         WHEN SQLCODE = ZERO                                      03780026
037900             CONTINUE                                             03790026
038000         WHEN SQLWARN0 NOT = SPACES                               03800026
038100         WHEN SQLCODE  NOT = ZERO                                 03810026
038200             MOVE 'Y100-OPEN-LIFUNG-CSR'                          03820026
038300                                 TO AA-PARAGRAPH-NAME             03830026
038400             MOVE 'UNSUCCESSFUL OPEN ON LIFUNG_CSR'               03840026
038500                                 TO AA-DB2-OPERATION              03850026
038600             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                03860032
038700             MOVE 'TPURCHS'      TO AA-DB2-TABLE-2                03870032
038800             MOVE 'TPURITM'      TO AA-DB2-TABLE-3                03880032
038900             MOVE 'TRECDIS'      TO AA-DB2-TABLE-4                03890032
039000             MOVE SPACES         TO AA-MESSAGE                    03900026
039100             PERFORM Z998-DB2-ABEND                               03910026
039200     END-EVALUATE.                                                03920026
039300                                                                  03930026
039400 Y200-CLOSE-LIFUNG-CSR.                                           03940026
039500*---------------------------------------------------------------- 03950026
039600*    CLOSE THE LIFUNG_CSR CURSOR.                               * 03960026
039700*---------------------------------------------------------------- 03970026
039800                                                                  03980026
039900     EXEC SQL                                                     03990026
040000         CLOSE LIFUNG_CSR                                         04000026
040100     END-EXEC.                                                    04010026
040200                                                                  04020026
040300     EVALUATE TRUE                                                04030026
040400         WHEN SQLCODE = ZERO                                      04040026
040500              CONTINUE                                            04050026
040600                                                                  04060026
040700         WHEN SQLWARN0 NOT = SPACES                               04070026
040800         WHEN SQLCODE  NOT = ZERO                                 04080026
040900             MOVE 'Y200-CLOSE-LIFUNG-CSR'                         04090026
041000                                 TO AA-PARAGRAPH-NAME             04100026
041100             MOVE 'UNSUCCESSFUL CLOSE ON LIFUNG_CSR'              04110026
041200                                 TO AA-DB2-OPERATION              04120026
041300             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                04130032
041400             MOVE 'TPURCHS'      TO AA-DB2-TABLE-2                04140032
041500             MOVE 'TPURITM'      TO AA-DB2-TABLE-3                04150032
041600             MOVE 'TRECDIS'      TO AA-DB2-TABLE-4                04160032
041700             MOVE SPACES         TO AA-MESSAGE                    04170026
041800             PERFORM Z998-DB2-ABEND                               04180026
041900     END-EVALUATE.                                                04190026
042000                                                                  04200026
042100 Z998-DB2-ABEND.                                                  04210026
042200*----------------------------------------------------------------*04220026
042300*    ABEND ROUTINE FOR DB2 ERRORS                                *04230026
042400*----------------------------------------------------------------*04240026
042500     CLOSE LIFUNG-RCPT-FILE.                                      04250032
042600                                                                  04260026
042700     DISPLAY AA-ABEND-LIT.                                        04270026
042800     DISPLAY AA-DB2-ERROR-LIT.                                    04280026
042900     DISPLAY AA-PROGRAM-LIT.                                      04290026
043000     DISPLAY AA-PARAGRAPH-LIT.                                    04300026
043100     DISPLAY AA-DB2-OPERATION-LIT.                                04310026
043200     DISPLAY AA-DB2-TABLE-1.                                      04320026
043300     DISPLAY AA-DB2-TABLE-2.                                      04330026
043400     DISPLAY AA-DB2-TABLE-3.                                      04340026
043500     DISPLAY AA-DB2-TABLE-4.                                      04350032
043600     SET AC-DB2-ERROR TO TRUE.                                    04360026
043700                                                                  04370026
043800     COPY DPPD004.                                                04380026
043900                                                                  04390026
044000     CALL 'ILBOABN0' USING ABEND-CODE.                            04400026
044100                                                                  04410026
