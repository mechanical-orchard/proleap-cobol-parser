000100 IDENTIFICATION DIVISION.                                         00010007
000200 PROGRAM-ID.      APKUT279.                                       00020007
000300 AUTHOR.          MICHELE RINDFLEISCH.                            00030007
000400 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040007
000500 DATE-WRITTEN.    12/01/05.                                       00050007
000600 DATE-COMPILED.                                                   00060007
000700*----------------------------------------------------------------*00070007
000800*    COBOL II WITH SQL                                           *00080007
000900*                                                                *00090007
001000*    REVISE AUTOMATED NSD LOAD FILE TO ELIMINATE LOAD RECORDS    *00100007
001010*    FOR PO'S THAT HAVE ALREADY BEEN LOADED ON THE NSD TABLE.    *00101007
001011*                                                                *00101107
001012*  PROGRAM OVERVIEW:                                             *00101207
001013*                                                                *00101307
001014*  THIS PROGRAM USES THE PO AND LOC_NBR ON THE INPUT NSD PO      *00101407
001015*  EXTRACT FILE TO SEARCH FOR THE SAME RECORD ON THE AP NEW      *00101507
001016*  STORE DISCOUNT TABLE.  ONLY IF A RECORD *** IS NOT *** FOUND  *00101607
001017*  ON THE TABLE WILL THE RECORD BE WRITTEN TO THE NSD EXTRACT    *00101707
001018*  OUTPUT FILE.                                                  *00101807
001019*                                                                *00101907
001020* DB2 TABLES:                                                    *00102007
001030*  1. APTW NEW STORE DISC              (APT00000)                *00103007
001040*                                                                *00104007
001050* INPUT:                                                         *00105007
001060*  1. NEW STORE PO FILE                (APRD088)                 *00106007
001070*                                                                *00107007
001080* OUTPUT:                                                        *00108007
001090*  1. NEW STORE PO EXTRACT FILE        (APRD088)                 *00109007
001100*----------------------------------------------------------------*00110007
001200* CHANGE LOG:                                                    *00120007
001300* DATE  12/01/2005                                               *00130007
001400*     CHANGE MADE: INITIAL VERSION.                              *00140007
001410*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR29790          *00141007
001420*----------------------------------------------------------------*00142007
001421 ENVIRONMENT DIVISION.                                            00142107
001422 CONFIGURATION SECTION.                                           00142207
001423 SOURCE-COMPUTER. IBM-3090.                                       00142307
001424 OBJECT-COMPUTER. IBM-3090.                                       00142407
001425                                                                  00142507
001426 INPUT-OUTPUT SECTION.                                            00142607
001427 FILE-CONTROL.                                                    00142707
001428                                                                  00142807
001429     SELECT NWSTR-PO-FILE      ASSIGN TO INP01.                   00142907
001430     SELECT NWSTR-PO-EXTR-FILE ASSIGN TO OUT01.                   00143007
001440                                                                  00144007
001450 DATA DIVISION.                                                   00145007
001460 FILE SECTION.                                                    00146007
001470                                                                  00147007
001480 FD  NWSTR-PO-FILE                                                00148007
001490     RECORDING MODE F                                             00149007
001500     LABEL RECORDS ARE STANDARD                                   00150007
001600     DATA RECORD IS NWSTR-PO-REC.                                 00160007
001700 01  NWSTR-PO-REC                     PIC X(32).                  00170007
001800                                                                  00180007
001900 FD  NWSTR-PO-EXTR-FILE                                           00190007
002000     RECORDING MODE F                                             00200007
002100     LABEL RECORDS ARE STANDARD                                   00210007
002200     DATA RECORD IS NWSTR-PO-EXTR-REC.                            00220007
002300 01  NWSTR-PO-EXTR-REC                PIC X(32).                  00230007
002400                                                                  00240007
002500 WORKING-STORAGE SECTION.                                         00250007
002600                                                                  00260007
002700 01  PC-PROGRAM-CONSTANTS.                                        00270007
002800     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00280007
002810                                                    +1000000      00281007
002820                                                    COMP-3.       00282007
002830 01  PV-PROGRAM-VARIABLES.                                        00283007
002840     05  DISPLAY-PO-NBR               PIC ZZZZZZZZ9.              00284007
002850     05  DISPLAY-LOC-NBR              PIC ZZZZ9.                  00285007
002860     05  PV-RECORDS-READ              PIC 9(09) VALUE ZERO.       00286007
002870     05  PV-RECORDS-WRITTEN           PIC 9(09) VALUE ZERO.       00287007
002880     05  PV-ONE                         PIC X(01).                00288007
002890     05  PV-BYPASS-COUNT              PIC 9(11)  VALUE ZERO.      00289007
002900     05  PV-READ-COUNT                PIC S9(09)  VALUE +0        00290007
003000                                                    COMP-3.       00300007
003100                                                                  00310007
003200 01  ABEND-CODE                       PIC S9(4) VALUE 0 COMP SYNC.00320007
003300     88  AC-DB2-ERROR                           VALUE +4013.      00330007
003400                                                                  00340007
003500 01  PS-PROGRAM-SWITCHES.                                         00350007
003600     05  PS-END-OF-NWSTR-PO-REC-SW    PIC X(01)      VALUE 'N'.   00360007
003700         88  END-OF-NWSTR-PO-REC                     VALUE 'Y'.   00370007
003800     05  NWSTR-PO-FOUND-SW           PIC X(01).                   00380007
003900         88  YES-NWSTR-PO-FOUND                      VALUE 'Y'.   00390007
004000                                                                  00400007
004100 01  ABEND-AREAS.                                                 00410007
004200     05  AA-ABEND-LIT            PIC  X(40)  VALUE                00420007
004300             '*****       ABEND'.                                 00430007
004400     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                00440007
004500             '*****   PROGRAM: APKUT279'.                         00450007
004600     05  AA-PARAGRAPH-LIT.                                        00460007
004700         10  FILLER              PIC  X(17)  VALUE                00470007
004800             '***** PARAGRAPH: '.                                 00480007
004900         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        00490007
005000     05  AA-MESSAGE-LINE.                                         00500007
005100         10  FILLER              PIC  X(06)  VALUE '*****'.       00510007
005200         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        00520007
005300     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                00530007
005400             '*****    DB2 ERROR'.                                00540007
005500     05  AA-DB2-OPERATION-LIT.                                    00550007
005600         10  FILLER              PIC  X(17)  VALUE                00560007
005700             '***** OPERATION: '.                                 00570007
005800         10  AA-DB2-OPERATION.                                    00580007
005900             15  AA-DB2-OP-1     PIC  X(50)  VALUE SPACES.        00590007
006000             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        00600007
006100     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        00610007
006200                                                                  00620007
006300     COPY DPWS004.                                                00630007
006400                                                                  00640007
006500*----------------------------------------------------------------*00650007
006600*    LAYOUT OF THE INPUT NWSTR-PO-FILE                            00660007
006700*----------------------------------------------------------------*00670007
006800     COPY APRD088.                                                00680007
006900     EJECT                                                        00690007
007000*----------------------------------------------------------------*00700007
007100*    LAYOUT OF THE OUTPUT NEW STORE PO EXTRACT FILE               00710007
007200*----------------------------------------------------------------*00720007
007300                                                                  00730007
007400     COPY APRD088 REPLACING 'AP088-' BY 'OUT088-'.                00740007
007500                                                                  00750007
007600*----------------------------------------------------------------*00760007
007700*    APTW_NW_STR_DISC TABLE                                       00770007
007800*----------------------------------------------------------------*00780007
007900     EXEC SQL                                                     00790007
008000        INCLUDE APT00000                                          00800007
008100     END-EXEC.                                                    00810007
008200                                                                  00820007
008300 EJECT                                                            00830007
008400*---------------------------------------------------------------* 00840007
008500*    DB2 AREA FOR SYSDUMMY1                                     * 00850007
008600*---------------------------------------------------------------* 00860007
008700     EXEC SQL                                                     00870007
008800          INCLUDE SYSDUMMY                                        00880007
008900     END-EXEC.                                                    00890007
009000 EJECT                                                            00900007
009100*----------------------------------------------------------------*00910007
009200* DB2 COMMUNICATION AREA                                          00920007
009210*----------------------------------------------------------------*00921007
009220     EXEC SQL                                                     00922007
009230         INCLUDE SQLCA                                            00923007
009240     END-EXEC.                                                    00924007
009250 EJECT                                                            00925007
009260*----------------------------------------------------------------*00926007
009270* DB2 COMMUNICATION AREA2                                         00927007
009280*----------------------------------------------------------------*00928007
009290     COPY SQLCA2.                                                 00929007
009300 EJECT                                                            00930007
009400 PROCEDURE DIVISION.                                              00940007
009500                                                                  00950007
009600 A100-MAINLINE.                                                   00960007
009700                                                                  00970007
009800     PERFORM B100-INITIALIZE.                                     00980007
009900                                                                  00990007
010000     PERFORM B200-PROCESS-INPUT                                   01000007
010100       UNTIL END-OF-NWSTR-PO-REC.                                 01010007
010200                                                                  01020007
010300     PERFORM B300-END-ROUTINE.                                    01030007
010400                                                                  01040007
010500     GOBACK.                                                      01050007
010600                                                                  01060007
010700 EJECT                                                            01070007
010800*----------------------------------------------------------------*01080007
010900* B100-INITIALIZE OPENS ALL FILES AND PERFORMS INITIAL READ.     *01090007
011000*----------------------------------------------------------------*01100007
011100 B100-INITIALIZE.                                                 01110007
011200                                                                  01120007
011300     MOVE 'B100-INITIALIZE' TO AA-PARAGRAPH-NAME.                 01130007
011400                                                                  01140007
011500     OPEN INPUT  NWSTR-PO-FILE                                    01150007
011600          OUTPUT NWSTR-PO-EXTR-FILE.                              01160007
011700                                                                  01170007
011800     MOVE 'N'               TO  PS-END-OF-NWSTR-PO-REC-SW         01180007
011900                                NWSTR-PO-FOUND-SW.                01190007
012000                                                                  01200007
012100     PERFORM R100-READ-NWSTR-PO-FILE.                             01210007
012200                                                                  01220007
012300     IF  END-OF-NWSTR-PO-REC                                      01230007
012400         DISPLAY 'NO RECORDS IN NEW STORE PO INPUT FILE'          01240007
012500     END-IF.                                                      01250007
012600                                                                  01260007
012700*----------------------------------------------------------------*01270007
012800* MAIN PROGRAM LOOP                                               01280007
012900*----------------------------------------------------------------*01290007
013000 B200-PROCESS-INPUT.                                              01300007
013100                                                                  01310007
013200     MOVE 'B200-PROCESS-INPUT' TO AA-PARAGRAPH-NAME.              01320007
013300                                                                  01330007
013400     PERFORM S100-SELECT-NSD-TBL-PO.                              01340007
013500                                                                  01350007
013600     IF  YES-NWSTR-PO-FOUND                                       01360007
013700         NEXT SENTENCE                                            01370007
013800     ELSE                                                         01380007
013900         PERFORM W100-WRITE-NWSTR-PO-EXTR-REC                     01390007
014000     END-IF.                                                      01400007
014100                                                                  01410007
014200     PERFORM R100-READ-NWSTR-PO-FILE.                             01420007
014300                                                                  01430007
014400*----------------------------------------------------------------*01440007
014500* END OF PROGRAM - CLOSE FILES AND DISPLAY COUNTS.               *01450007
014600*----------------------------------------------------------------*01460007
014700 B300-END-ROUTINE.                                                01470007
014800                                                                  01480007
014900     CLOSE NWSTR-PO-FILE                                          01490007
015000           NWSTR-PO-EXTR-FILE.                                    01500007
015100                                                                  01510007
015200     DISPLAY '*--------- PROGRAM APKUT279 COMPLETE --------*'.    01520007
015300     DISPLAY '*  NWSTR PO RECORDS READ = ' PV-RECORDS-READ.       01530007
015500     DISPLAY '*  NSD TABLE RECORDS BYPASSED = ' PV-BYPASS-COUNT.  01550007
015600     DISPLAY '*  RECORDS WRITTEN = ' PV-RECORDS-WRITTEN.          01560007
015700     DISPLAY '*--------------------------------------------*'.    01570007
015800 EJECT                                                            01580007
015900*----------------------------------------------------------------*01590007
016000* SELECT THE PO_NBR AND LOCATION NUMBER FROM THE AP NEW STORE     01600007
016100* DISCOUNT TABLE.                                                 01610007
016200*----------------------------------------------------------------*01620007
016300 S100-SELECT-NSD-TBL-PO.                                          01630007
016400                                                                  01640007
016500     MOVE 'S100-SELECT-NSD-TBL-PO' TO AA-PARAGRAPH-NAME.          01650007
016600                                                                  01660007
016700     MOVE 'N'               TO  NWSTR-PO-FOUND-SW.                01670007
016800                                                                  01680007
016900     PERFORM                                                      01690007
017000         WITH TEST AFTER                                          01700007
017100         VARYING PV-READ-COUNT                                    01710007
017200         FROM 1 BY 1                                              01720007
017300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    01730007
017400                   OR (SQLCODE = ZERO)                            01740007
017500                   OR (SQLCODE = +100))                           01750007
017600                                                                  01760007
017700         EXEC SQL                                                 01770007
017800           SELECT '1'                                             01780007
017900            INTO  :PV-ONE                                         01790007
018000             FROM SYSIBM.SYSDUMMY1 X                              01800007
018100            WHERE EXISTS                                          01810007
018200                 (SELECT 1                                        01820007
018300                    FROM  APTW_NW_STR_DISC                        01830007
018400                   WHERE PO_NBR = :AP088-PO-NBR                   01840007
018500                     AND LOC_NBR = :AP088-LOC-NBR)                01850007
018600          WITH UR                                                 01860007
018700         END-EXEC                                                 01870007
018800     END-PERFORM.                                                 01880007
018900                                                                  01890007
019000     EVALUATE TRUE                                                01900007
019100         WHEN SQLCODE = ZEROS                                     01910007
019200             SET YES-NWSTR-PO-FOUND TO TRUE                       01920007
019300             ADD +1 TO PV-BYPASS-COUNT                            01930007
019400         WHEN SQLCODE = +100                                      01940007
019500             CONTINUE                                             01950007
019600         WHEN OTHER                                               01960007
019700             MOVE 'UNSUCCESSFUL SELECT ' TO AA-DB2-OP-1           01970007
019800             MOVE 'APT00000'             TO AA-DB2-TABLE-1        01980007
019900             PERFORM Z999-DB2-ABEND                               01990007
020000     END-EVALUATE.                                                02000007
020100 EJECT                                                            02010007
020200****************************************************************  02020007
020300* R100-READ-NWSTR-PO-FILE                                         02030007
020400****************************************************************  02040007
020500 R100-READ-NWSTR-PO-FILE.                                         02050007
020600                                                                  02060007
020700     MOVE 'R100-READ-NWSTR-PO-FILE'                               02070007
020800                                 TO   AA-PARAGRAPH-NAME.          02080007
020900                                                                  02090007
021000     READ NWSTR-PO-FILE INTO AP088-NW-STR-EXTRACT                 02100007
021100       AT END                                                     02110007
021200           SET END-OF-NWSTR-PO-REC TO TRUE.                       02120007
021300                                                                  02130007
021400     IF  END-OF-NWSTR-PO-REC                                      02140007
021500         CONTINUE                                                 02150007
021600     ELSE                                                         02160007
021700         MOVE AP088-NW-STR-EXTRACT TO OUT088-NW-STR-EXTRACT       02170007
021800         ADD +1 TO PV-RECORDS-READ                                02180007
021900     END-IF.                                                      02190007
022000                                                                  02200007
022100*----------------------------------------------------------------*02210007
022200* WRITE OUTPUT RECORD                                             02220007
022300*----------------------------------------------------------------*02230007
022400 W100-WRITE-NWSTR-PO-EXTR-REC.                                    02240007
022500                                                                  02250007
022600     MOVE 'W100-WRITE-NWSTR-PO-EXTR-REC'                          02260007
022700                                 TO   AA-PARAGRAPH-NAME.          02270007
022800                                                                  02280007
022900     WRITE NWSTR-PO-EXTR-REC FROM OUT088-NW-STR-EXTRACT.          02290007
023000     ADD +1 TO PV-RECORDS-WRITTEN.                                02300007
023100                                                                  02310007
023200******************************************************************02320007
023300*     SQL WARNING OR ERROR PROCESSING                            *02330007
023400*                                                                *02340007
023500******************************************************************02350007
023600                                                                  02360007
023700 Z999-DB2-ABEND.                                                  02370007
023800                                                                  02380007
023900     MOVE AP088-PO-NBR       TO DISPLAY-PO-NBR.                   02390007
024000     MOVE AP088-LOC-NBR      TO DISPLAY-LOC-NBR.                  02400007
024100                                                                  02410007
024200     DISPLAY 'PO BEING PROCESSED = '    DISPLAY-PO-NBR.           02420007
024300     DISPLAY 'LOCATION BEING PROCESSED = ' DISPLAY-LOC-NBR.       02430007
024400     DISPLAY AA-ABEND-LIT.                                        02440007
024500     DISPLAY AA-DB2-ERROR-LIT.                                    02450007
024600     DISPLAY AA-PROGRAM-LIT.                                      02460007
024700     DISPLAY AA-PARAGRAPH-LIT.                                    02470007
024800     DISPLAY AA-DB2-OPERATION-LIT.                                02480007
024900     DISPLAY AA-DB2-TABLE-1.                                      02490007
025000     SET AC-DB2-ERROR TO TRUE.                                    02500007
025100                                                                  02510007
025200     COPY DPPD004.                                                02520007
025300                                                                  02530007
025400     CALL 'ILBOABN0' USING ABEND-CODE.                            02540007
