       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.             IMKUP067.                                        
       AUTHOR.                 PAUL KEBER.                                      
       INSTALLATION.           KOHLS DEPARTMENT STORES.                         
       DATE-WRITTEN.           03/20/2007.                                      
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      *  IMKUP067 - CUSTOMER INTERFACE DESCRIPTION BUSINESS GROUP CHANGE        
      ******************************************************************        
      *  THIS PROGRAM READS IN A FILE CONTAINING TMDSEBG SHORT                  
      *  DESCRIPTION CHANGES AND DEPARTMENTS WHOSE BUSINESS GROUP IS            
      *  BEING CHANGED.  FOR A TMDSEBG SHORT DESCRIPTION CHANGE, ALL            
      *  DEPARTMENTS USING THAT BUSINESS GROUP ARE PROCESSED.  FOR EACH         
      *  DEPARTMENT, MAJOR CLASS OR SUBCLASS RULE ON TABLE                      
      *  IMT_CHARTC_RULDESC FOR EACH DEPARTMENT BEING PROCESSED, THE            
      *  CUSTOMER INTERFACE DESCRIPTION IS REBUILT FOR ALL STYLES OF            
      *  THAT DEPARTMENT.  IF THE CUSTOMER INTERFACE DESCRIPTION FOR A          
      *  STYLE CONTAINS THE BUSINESS GROUP SHORT DESCRIPTION OR IF THE          
      *  DESCRIPTION IS THE DEFAULT BUSINESS GROUP DESCRIPTION, THE             
      *  TMDARVS ROW CUSTOMER INTERFACE DESCRIPTION IS UPDATED FOR THAT         
      *  STYLE.  TMDARVS ROWS THAT USE THE DEFAULT BRAND/HIERARCHY              
      *  DESCRIPTION FOR CUSTOMER INTERFACE DESCRIPTION WILL NOT BE             
      *  UPDATED.  IF NO BUSINESS RULE IS FOUND ON IMT_CHARTC_RULDESC           
      *  FOR THE DEPARTMENT BEING PROCESSED, ALL STYLES OF THAT                 
      *  DEPARTMENT WHOSE CUSTOMER INTERFACE DESCRIPTION IS EQUAL TO THE        
      *  OLD BUSINESS GROUP SHORT DESCRIPTION (MEANING THAT THE DEFAULT         
      *  BUSINESS GROUP DESCRIPTION IS BEING USED) WILL BE UPDATED WITH         
      *  THE NEW BUSINESS GROUP SHORT DESCRIPTION.  THIS PROGRAM WILL           
      *  UTILIZE CHECKPOINT RESTART LOGIC.                                      
      ******************************************************************        
      *  CHANGE LOG:                                                            
      *                                                                         
      *  03/20/07 - PAUL KEBER.  WR #31557                                      
      *             NEW PROGRAM FOR THE CUSTOMER INTERFACE DESCRIPTION          
      *             PROJECT.                                                    
W35681******************************************************************        
W35681*  09/28/10 - BRUCE GRAHAM - KFORCE                                       
W35681*             WR35681, WR37044, WR37184, WR38861 ETL                      
W35681*             CUSTOMER DESCRIPTION CHANGE NEW TMDARVS ATTRIBUTES          
      ******************************************************************        
                                                                                
      ******************************************************************        
       ENVIRONMENT DIVISION.                                                    
      ******************************************************************        
                                                                                
       CONFIGURATION SECTION.                                                   
                                                                                
       SOURCE-COMPUTER.                        IBM-3090.                        
       OBJECT-COMPUTER.                        IBM-3090.                        
                                                                                
       INPUT-OUTPUT SECTION.                                                    
                                                                                
       FILE-CONTROL.                                                            
                                                                                
           SELECT BUSGP-UPDTS-FILE                                              
               ASSIGN TO INP01.                                                 
                                                                                
      ******************************************************************        
       DATA DIVISION.                                                           
      ******************************************************************        
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD  BUSGP-UPDTS-FILE                                                     
           RECORDING MODE F                                                     
           LABEL RECORDS OMITTED                                                
           BLOCK CONTAINS  0 RECORDS.                                           
       01  BUSGP-UPDTS-RECORD            PIC X(32).                             
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
      ******************************************************************        
      * PROGRAM ACCUMULATORS                                           *        
      ******************************************************************        
                                                                                
       01  PA-PROGRAM-ACCUMULATORS.                                             
           05  PA-NBR-INPUT-RECORDS-READ     PIC S9(09)   VALUE +0 COMP.        
           05  PA-NBR-BG-DEPTS-PROCESSED     PIC S9(09)   VALUE +0 COMP.        
           05  PA-NBR-BUS-RULES-PROCESSED    PIC S9(09)   VALUE +0 COMP.        
           05  PA-NBR-STYLES-PROCESSED       PIC S9(09)   VALUE +0 COMP.        
           05  PA-NBR-TMDARVS-UPDATES        PIC S9(09)   VALUE +0 COMP.        
           05  PA-NBR-COMMITS-TAKEN          PIC S9(09)   VALUE +0 COMP.        
                                                                                
      ******************************************************************        
      * PROGRAM CONSTANTS                                              *        
      ******************************************************************        
                                                                                
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-PROGRAM-NAME               PIC  X(08)    VALUE                
                                                           'IMKUP067'.          
           05  PC-JOB-NAME                   PIC  X(06)    VALUE                
                                                           'IMK018'.            
           05  PC-BUSINESS-GROUP-DESC        PIC  9(02)    VALUE 5.             
           05  PC-BUS-GRP-CHARTC-CDE         PIC S9(04)    VALUE +5             
                                                           COMP.                
           05  PC-MAXIMUM-RETRY-COUNT        PIC S9(04)    VALUE +3             
                                                           COMP SYNC.           
           05  PC-ATTR-BRAND                 PIC S9(04)    VALUE +3             
                                                           COMP.                
           05  PC-ATTR-HIER                  PIC S9(04)    VALUE +21            
                                                           COMP.                
           05  PC-ATTR-CTG                   PIC S9(04)    VALUE +36            
                                                           COMP.                
                                                                                
      ******************************************************************        
      * PROGRAM VARIABLES                                              *        
      ******************************************************************        
                                                                                
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-RETRY-COUNT                PIC S9(04)   VALUE +0 COMP.        
           05  PV-END-SPACE-CNT              PIC S9(04)   VALUE +0 COMP.        
           05  PV-END-SPACE-CNT-1            PIC S9(04)   VALUE +0 COMP.        
           05  PV-END-SPACE-CNT-2            PIC S9(04)   VALUE +0 COMP.        
           05  PV-END-SPACE-CNT-3            PIC S9(04)   VALUE +0 COMP.        
           05  PV-PREV-LBL-SEQ-NBR           PIC S9(04)   VALUE +0 COMP.        
           05  PV-PREV-RPT-HIER-SEQ-NBR      PIC S9(04)   VALUE +0 COMP.        
           05  PV-PREV-BDY-STYL-SEQ-NBR      PIC S9(04)   VALUE +0 COMP.        
           05  PV-PREV-SLHTT-SEQ-NBR         PIC S9(04)   VALUE +0 COMP.        
           05  PV-PREV-FUNC-SEQ-NBR          PIC S9(04)   VALUE +0 COMP.        
           05  PV-PREV-GNDR-SEQ-NBR          PIC S9(04)   VALUE +0 COMP.        
           05  PV-PREV-FBRCN-SEQ-NBR         PIC S9(04)   VALUE +0 COMP.        
           05  PV-PREV-PATRN-SEQ-NBR         PIC S9(04)   VALUE +0 COMP.        
W35681     05  PV-PREV-CTG-SEQ-NBR           PIC S9(04)   VALUE +0 COMP.        
W35681     05  PV-PREV-MAJ-CTG-SEQ-NBR       PIC S9(04)   VALUE +0 COMP.        
W35681     05  PV-PREV-MTRL-SEQ-NBR          PIC S9(04)   VALUE +0 COMP.        
W35681     05  PV-PREV-ATTR-1-SEQ-NBR        PIC S9(04)   VALUE +0 COMP.        
W35681     05  PV-PREV-ATTR-2-SEQ-NBR        PIC S9(04)   VALUE +0 COMP.        
W35681     05  PV-PREV-NW-SLHTT-SEQ-NBR      PIC S9(04)   VALUE +0 COMP.        
           05  PV-CHARTC-CDE                 PIC S9(4)    COMP.                 
               88  IM-CHARTC-CDE                          VALUES                
                                                           +1, +3,              
                                                           +7, +21,             
                                                          +22, +23,             
                                                          +24, +26,             
W35681                                                    +36, +37,             
W35681                                                    +38, +39,             
W35681                                                    +42, +43.             
               88  BG-CHARTC-CDE                          VALUE +5.             
           05  PV-CHARTC-CDE-TYPE            PIC S9(4)    COMP.                 
               88  PV-ATTR-FABRICATION                    VALUE +1.             
               88  PV-ATTR-BRAND                          VALUE +3.             
               88  PV-ATTR-PATTERN                        VALUE +7.             
               88  PV-ATTR-HIER                           VALUE +21.            
               88  PV-ATTR-FUNC                           VALUE +22.            
               88  PV-ATTR-SILH                           VALUE +23.            
               88  PV-ATTR-BDYSTL                         VALUE +24.            
               88  PV-ATTR-GNDR                           VALUE +26.            
               88  PV-ATTR-BUSGRP                         VALUE +5.             
W35681         88  PV-ATTR-CTG                            VALUE +36.            
W35681         88  PV-ATTR-MAJ-CTG                        VALUE +37.            
W35681         88  PV-ATTR-NW-SILH                        VALUE +38.            
W35681         88  PV-ATTR-MTRL                           VALUE +39.            
W35681         88  PV-ATTR-ATTR-1                         VALUE +42.            
W35681         88  PV-ATTR-ATTR-2                         VALUE +43.            
                                                                                
           05  PV-CURR-DEPT                  PIC  X(03)   VALUE SPACES.         
           05  PV-CURR-DEPT-9    REDEFINES PV-CURR-DEPT                         
                                             PIC  9(03).                        
           05  PV-CURR-MCL                   PIC  X(02)   VALUE SPACES.         
           05  PV-CURR-MCL-9     REDEFINES PV-CURR-MCL                          
                                             PIC  9(02).                        
           05  PV-CURR-SCL                   PIC  X(03)   VALUE SPACES.         
           05  PV-CURR-SCL-9     REDEFINES PV-CURR-SCL                          
                                             PIC  9(03).                        
                                                                                
           05  PV-PREV-MDSELV-CDE            PIC X(3)     VALUE SPACES.         
           05  PV-CUST-DESC                  PIC X(26)    VALUE SPACES.         
           05  PV-CUST-DESC-PART-1           PIC X(8)     VALUE SPACES.         
           05  PV-CUST-DESC-PART-2           PIC X(8)     VALUE SPACES.         
           05  PV-CUST-DESC-PART-3           PIC X(8)     VALUE SPACES.         
           05  PV-CUST-DESC-DFLT-BRND        PIC X(8)     VALUE SPACES.         
           05  PV-CUST-DESC-DFLT-HIER        PIC X(8)     VALUE SPACES.         
W35618     05  PV-CUST-DESC-DFLT-CTG         PIC X(8)     VALUE SPACES.         
           05  PV-CUST-DESC-EDITED           PIC X(26)    VALUE SPACES.         
           05  PV-SHORT-DESC                 PIC X(8)     VALUE SPACES.         
           05  PV-NBR-BLANK-ATTRS            PIC S9(1)    VALUE ZEROES.         
           05  PV-CNT-TRAILING-SPACES        PIC X(8)     VALUE SPACES.         
           05  PV-7-TRAILING-SPCS  REDEFINES                                    
               PV-CNT-TRAILING-SPACES.                                          
               10  FILLER                    PIC  X(1).                         
               10  PV-7-TRLNG-SPCS           PIC  X(7).                         
           05  PV-6-TRAILING-SPCS  REDEFINES                                    
               PV-CNT-TRAILING-SPACES.                                          
               10  FILLER                    PIC  X(2).                         
               10  PV-6-TRLNG-SPCS           PIC  X(6).                         
           05  PV-5-TRAILING-SPCS  REDEFINES                                    
               PV-CNT-TRAILING-SPACES.                                          
               10  FILLER                    PIC  X(3).                         
               10  PV-5-TRLNG-SPCS           PIC  X(5).                         
           05  PV-4-TRAILING-SPCS  REDEFINES                                    
               PV-CNT-TRAILING-SPACES.                                          
               10  FILLER                    PIC  X(4).                         
               10  PV-4-TRLNG-SPCS           PIC  X(4).                         
           05  PV-3-TRAILING-SPCS  REDEFINES                                    
               PV-CNT-TRAILING-SPACES.                                          
               10  FILLER                    PIC  X(5).                         
               10  PV-3-TRLNG-SPCS           PIC  X(3).                         
           05  PV-2-TRAILING-SPCS  REDEFINES                                    
               PV-CNT-TRAILING-SPACES.                                          
               10  FILLER                    PIC  X(6).                         
               10  PV-2-TRLNG-SPCS           PIC  X(2).                         
           05  PV-1-TRAILING-SPCS  REDEFINES                                    
               PV-CNT-TRAILING-SPACES.                                          
               10  FILLER                    PIC  X(7).                         
               10  PV-1-TRLNG-SPCS           PIC  X(1).                         
                                                                                
           05  PV-NBR-BUS-GRP-SELECTS        PIC S9(9)    VALUE ZEROES          
                                                          COMP-3.               
           05  PV-DB2-OPERATION-ATTEMPTED    PIC X(30)    VALUE SPACE.          
           05  PV-PARAGRAPH-NAME             PIC X(30)    VALUE SPACE.          
           05  PV-CURRENT-TIMESTAMP          PIC X(26)    VALUE SPACES.         
           05  PV-COMMIT-TIMESTAMP           PIC X(26)    VALUE SPACES.         
           05  PV-DISPLAY-COUNT              PIC ZZZ,ZZZ,ZZ9                    
                                                          VALUE ZEROES.         
           05  PV-DISPLAY-SQLCODE            PIC ZZ999-   VALUE ZEROES.         
                                                                                
      ******************************************************************        
      * PROGRAM SWITCHES                                               *        
      ******************************************************************        
                                                                                
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-END-OF-BUS-RULE-CSR-SW     PIC X(1)     VALUE 'N'.            
               88  PS-END-OF-BUS-RULE-CSR                 VALUE 'Y'.            
               88  PS-NOT-END-OF-BUS-RULE-CSR             VALUE 'N'.            
           05  PS-END-OF-BG-DEPTS-CSR-SW     PIC X(1)     VALUE 'N'.            
               88  PS-END-OF-BG-DEPTS-CSR                 VALUE 'Y'.            
           05  PS-END-OF-BG-UPDATES-RECS-SW  PIC X(1)     VALUE 'N'.            
               88  PS-END-OF-BG-UPDATES-RECS              VALUE 'Y'.            
           05  PS-NEXT-DEPT-SW               PIC X(1)     VALUE 'N'.            
               88  PS-NEXT-DEPT                           VALUE 'Y'.            
           05  PS-DEPT-LVL-RULE-SW           PIC X(1)     VALUE 'N'.            
               88  PS-DEPT-LVL-RULE                       VALUE 'Y'.            
           05  PS-MCL-LVL-RULE-SW            PIC X(1)     VALUE 'N'.            
               88  PS-MCL-LVL-RULE                        VALUE 'Y'.            
           05  PS-SCL-LVL-RULE-SW            PIC X(1)     VALUE 'N'.            
               88  PS-SCL-LVL-RULE                        VALUE 'Y'.            
           05  PS-END-OF-STYLE-CSR-SW        PIC X(1)     VALUE 'N'.            
               88  PS-END-OF-STYLE-CSR                    VALUE 'Y'.            
           05  PS-DFLT-BRND-IS-BLANK-SW      PIC X(1)     VALUE 'N'.            
               88  PS-DFLT-BRND-IS-BLANK                  VALUE 'Y'.            
           05  PS-DFLT-HIER-IS-BLANK-SW      PIC X(1)     VALUE 'N'.            
               88  PS-DFLT-HIER-IS-BLANK                  VALUE 'Y'.            
W35618     05  PS-DFLT-CTG-IS-BLANK-SW       PIC X(1)     VALUE 'N'.            
W35618         88  PS-DFLT-CTG-IS-BLANK                   VALUE 'Y'.            
           05  PS-BUSINESS-GROUP-USED-SW     PIC X(1)     VALUE 'N'.            
               88  PS-BUSINESS-GROUP-USED                 VALUE 'Y'.            
               88  PS-BUSINESS-GROUP-NOT-USED             VALUE 'N'.            
           05  PS-DFLT-BUS-GRP-USED-SW       PIC X(1)     VALUE 'N'.            
               88  PS-DFLT-BUS-GRP-USED                   VALUE 'Y'.            
               88  PS-DFLT-BUS-GRP-NOT-USED               VALUE 'N'.            
           05  PS-ERROR-SW                   PIC X(01)    VALUE 'N'.            
               88  PS-NO-ERROR                            VALUE 'N'.            
               88  PS-ERROR                               VALUE 'Y'.            
           05  PS-FIRST-COMMIT-SW            PIC X        VALUE 'N'.            
               88  PS-FIRST-COMMIT                        VALUE 'Y'.            
                                                                                
       01  ABEND-CODE                        PIC S9(04)    VALUE +0             
                                                           COMP SYNC.           
                                                                                
      *****************************************************************         
      *  BUSINESS GROUP SHORT DESCRIPTION UPDATES COPYBOOK                      
      *****************************************************************         
           COPY HMRD017.                                                        
                                                                                
      ******************************************************************        
      * CHECKPOINT RESTART VARIABLES AND PREV COMMIT VARIABLES.        *        
      ******************************************************************        
       01  CR-CHECKPOINT-RESTART-AREA.                                          
           05  CR-AREA-LEN                  PIC S9(04) VALUE +72  COMP.         
           05  CR-CHECKPOINT-RESTART-VAR.                                       
               10  CR-PREV-DTL-KEY          PIC  X(15) VALUE SPACES.            
               10  FILLER REDEFINES CR-PREV-DTL-KEY.                            
                   15  CR-BUS-GP-NBR        PIC  9(03).                         
                   15  CR-BUS-GP-SHRT-DESC  PIC  X(08).                         
                   15  CR-DEPT-NBR          PIC  9(04).                         
               10  FILLER                   PIC  X(01) VALUE SPACES.            
               10  CR-INPUT-READ-COUNT      PIC  9(09) VALUE ZEROES.            
               10  CR-BG-DEPTS-PROCESSED    PIC  9(09) VALUE ZEROES.            
               10  CR-BUS-RULES-PROCESSED   PIC  9(09) VALUE ZEROES.            
               10  CR-STYLES-PROCESSED      PIC  9(09) VALUE ZEROES.            
               10  CR-TMDARVS-UPDATES       PIC  9(09) VALUE ZEROES.            
               10  CR-COMMITS-TAKEN         PIC  9(09) VALUE ZEROES.            
      *                                                                         
       01  CK-CHECKPOINT-SAVE-AREA.                                             
           05  CK-SAVE-PREV-KEY         PIC  X(15) VALUE SPACES.                
           05  FILLER REDEFINES CK-SAVE-PREV-KEY.                               
               10  CK-BUS-GP-NBR        PIC  9(03).                             
               10  CK-BUS-GP-SHRT-DESC  PIC  X(08).                             
               10  CK-DEPT-NBR          PIC  9(04).                             
                                                                                
      * VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004                 
           COPY DPWS004.                                                        
                                                                                
      *****************************************************************         
      *  TABLE DCLGEN - IMT_CHARTC_RULDESC                                      
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE IMT00022                                                 
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  TABLE DCLGEN - TMDSEAR                                                 
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TMDSEAR                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  TABLE DCLGEN - TMDARVS                                                 
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TMDARVS                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  TABLE DCLGEN - TVSCHVL                                                 
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TVSCHVL                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  TABLE DCLGEN - TMDSEDP                                                 
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TMDSEDP                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DB2 CHECKPOINT RESTART CONTROL TABLE AND RESTART INFO TABLE             
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TCKRSTCN                                                 
           END-EXEC.                                                            
                                                                                
           EXEC SQL                                                             
               INCLUDE TCKRSTIN                                                 
           END-EXEC.                                                            
                                                                                
      *  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                        
                                                                                
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
           COPY SQLCA2.                                                         
                                                                                
      ******************************************************************        
      *  CURSOR TO RETRIEVE ALL DEPARTMENTS ASSIGNED TO A BUSINESS GROUP        
      ******************************************************************        
           EXEC SQL                                                             
             DECLARE BG_DEPTS_CSR CURSOR WITH HOLD FOR                          
               SELECT B.DEPT_NBR                                                
                 FROM TMDSEDP A                                                 
                     ,TMDSEAR B                                                 
                WHERE A.MDSEBG_NBR  = :MDSEDP-MDSEBG-NBR                        
                  AND B.MDSEAR_DKEY = A.MDSEAR_DKEY                             
                  AND B.MDSELV_CDE  = 'DPT'                                     
                  AND CURRENT DATE BETWEEN B.STRT_DTE AND B.END_DTE             
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  CURSOR TO RETRIEVE CUSTOMER INTERFACE DESCRIPTION BUSINESS             
      *  RULES FOR A SPECIFIC DEPARTMENT.  MAJOR CLASSES AND SUBCLASSES         
      *  WITHIN THE DEPARTMENT ARE ALSO SELECTED.                               
      ******************************************************************        
           EXEC SQL                                                             
             DECLARE BUS_RULE_CSR CURSOR WITH HOLD FOR                          
               SELECT B.MDSELV_CDE                                              
                    , B.MAJ_CL_NBR                                              
                    , B.SUB_CL_NBR                                              
                    , A.POS1_VS_CHARTC_CDE                                      
                    , A.POS2_VS_CHARTC_CDE                                      
                    , A.POS3_VS_CHARTC_CDE                                      
                 FROM IMT_CHARTC_RULDESC A                                      
                    , TMDSEAR B                                                 
                WHERE B.DEPT_NBR = :MDSEAR-DEPT-NBR                             
                  AND A.MDSEAR_ID = B.MDSEAR_DKEY                               
                  AND (B.MDSELV_CDE = 'DPT'                                     
                       OR B.MDSELV_CDE = 'MCL'                                  
                       OR B.MDSELV_CDE = 'SCL')                                 
                  AND CURRENT DATE BETWEEN B.STRT_DTE AND B.END_DTE             
             ORDER BY B.MDSELV_CDE DESC                                         
                    , B.MAJ_CL_NBR ASC                                          
                    , B.SUB_CL_NBR ASC                                          
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  CURSOR TO RETRIEVE ALL STYLES FOR A DEPARTMENT BUSINESS RULE           
      *  BUT EXCLUDING THOSE STYLES THAT ARE IN MAJOR CLASS OR SUBCLASS         
      *  RULES FOR THAT DEPARTMENT.                                             
      ******************************************************************        
           EXEC SQL                                                             
             DECLARE STYLES_BY_DEPT_CSR CURSOR WITH HOLD FOR                    
                SELECT A.SUB_CL_MDSEAR_ID                                       
                     , A.VS_ID                                                  
                     , A.LBL_SEQ_NBR                                            
                     , A.RPT_HIER_SEQ_NBR                                       
                     , A.BDY_STYL_SEQ_NBR                                       
                     , A.SLHTT_SEQ_NBR                                          
                     , A.FUNC_SEQ_NBR                                           
                     , A.GNDR_SEQ_NBR                                           
                     , A.FBRCN_SEQ_NBR                                          
                     , A.PATRN_SEQ_NBR                                          
                     , A.CUST_INTFC_DESC                                        
W35681               , A.CTG_SEQ_NBR                                            
W35681               , A.MAJ_CTG_SEQ_NBR                                        
W35681               , A.MTRL_SEQ_NBR                                           
W35681               , A.ATTR_1_SEQ_NBR                                         
W35681               , A.ATTR_2_SEQ_NBR                                         
W35681               , A.NW_SLHTT_SEQ_NBR                                       
                  FROM TMDARVS A                                                
                 WHERE A.DEPT_NBR     =  :MDARVS-DEPT-NBR                       
                   AND A.ACTV_IND     =  'Y'                                    
                   AND NOT EXISTS                                               
         (SELECT 1                                                              
            FROM IMT_CHARTC_RULDESC C                                           
               , TMDSEAR D                                                      
           WHERE D.OPERCO_NBR = '03'                                            
             AND C.MDSEAR_ID  = D.MDSEAR_DKEY                                   
             AND ((D.MDSELV_CDE = 'MCL'                                         
                   AND D.DEPT_NBR   = SUBSTR(DIGITS(A.DEPT_NBR),2,3)            
                   AND D.MAJ_CL_NBR = SUBSTR(DIGITS(A.MAJ_CL_NBR),3,2))         
              OR (D.MDSELV_CDE = 'SCL'                                          
                  AND D.DEPT_NBR   = SUBSTR(DIGITS(A.DEPT_NBR),2,3)             
                  AND D.MAJ_CL_NBR = SUBSTR(DIGITS(A.MAJ_CL_NBR),3,2)           
                  AND D.SUB_CL_NBR = SUBSTR(DIGITS(A.SUB_CL_NBR),2,3))))        
              ORDER BY A.LBL_SEQ_NBR                                            
                     , A.RPT_HIER_SEQ_NBR                                       
                     , A.BDY_STYL_SEQ_NBR                                       
                     , A.SLHTT_SEQ_NBR                                          
                     , A.FUNC_SEQ_NBR                                           
                     , A.GNDR_SEQ_NBR                                           
                     , A.FBRCN_SEQ_NBR                                          
                     , A.PATRN_SEQ_NBR                                          
W35681               , A.CTG_SEQ_NBR                                            
W35681               , A.MAJ_CTG_SEQ_NBR                                        
W35681               , A.MTRL_SEQ_NBR                                           
W35681               , A.ATTR_1_SEQ_NBR                                         
W35681               , A.ATTR_2_SEQ_NBR                                         
W35681               , A.NW_SLHTT_SEQ_NBR                                       
           END-EXEC.                                                            
                                                                                
                                                                                
      ******************************************************************        
      *  CURSOR TO RETRIEVE ALL STYLES FOR A MAJOR CLASS BUSINESS RULE          
      *  BUT EXCLUDING THOSE STYLES THAT ARE IN SUBCLASS RULES FOR THAT         
      *  DEPARTMENT.                                                            
      ******************************************************************        
           EXEC SQL                                                             
             DECLARE STYLES_BY_MCL_CSR CURSOR WITH HOLD FOR                     
                SELECT A.SUB_CL_MDSEAR_ID                                       
                     , A.VS_ID                                                  
                     , A.LBL_SEQ_NBR                                            
                     , A.RPT_HIER_SEQ_NBR                                       
                     , A.BDY_STYL_SEQ_NBR                                       
                     , A.SLHTT_SEQ_NBR                                          
                     , A.FUNC_SEQ_NBR                                           
                     , A.GNDR_SEQ_NBR                                           
                     , A.FBRCN_SEQ_NBR                                          
                     , A.PATRN_SEQ_NBR                                          
                     , A.CUST_INTFC_DESC                                        
W35681               , A.CTG_SEQ_NBR                                            
W35681               , A.MAJ_CTG_SEQ_NBR                                        
W35681               , A.MTRL_SEQ_NBR                                           
W35681               , A.ATTR_1_SEQ_NBR                                         
W35681               , A.ATTR_2_SEQ_NBR                                         
W35681               , A.NW_SLHTT_SEQ_NBR                                       
                  FROM TMDARVS A                                                
                 WHERE A.DEPT_NBR     =  :MDARVS-DEPT-NBR                       
                   AND A.MAJ_CL_NBR   =  :MDARVS-MAJ-CL-NBR                     
                   AND A.ACTV_IND     =  'Y'                                    
                   AND NOT EXISTS                                               
                       (SELECT 1                                                
                         FROM IMT_CHARTC_RULDESC C                              
                        WHERE C.MDSEAR_ID = A.SUB_CL_MDSEAR_ID)                 
              ORDER BY A.LBL_SEQ_NBR                                            
                     , A.RPT_HIER_SEQ_NBR                                       
                     , A.BDY_STYL_SEQ_NBR                                       
                     , A.SLHTT_SEQ_NBR                                          
                     , A.FUNC_SEQ_NBR                                           
                     , A.GNDR_SEQ_NBR                                           
                     , A.FBRCN_SEQ_NBR                                          
                     , A.PATRN_SEQ_NBR                                          
W35681               , A.CTG_SEQ_NBR                                            
W35681               , A.MAJ_CTG_SEQ_NBR                                        
W35681               , A.MTRL_SEQ_NBR                                           
W35681               , A.ATTR_1_SEQ_NBR                                         
W35681               , A.ATTR_2_SEQ_NBR                                         
W35681               , A.NW_SLHTT_SEQ_NBR                                       
           END-EXEC.                                                            
                                                                                
                                                                                
      ******************************************************************        
      *  CURSOR TO RETRIEVE ALL STYLES FOR A SUBCLASS BUSINESS RULE             
      *  FOR THAT DEPARTMENT.                                                   
      ******************************************************************        
           EXEC SQL                                                             
             DECLARE STYLES_BY_SCL_CSR CURSOR WITH HOLD FOR                     
                SELECT A.SUB_CL_MDSEAR_ID                                       
                     , A.VS_ID                                                  
                     , A.LBL_SEQ_NBR                                            
                     , A.RPT_HIER_SEQ_NBR                                       
                     , A.BDY_STYL_SEQ_NBR                                       
                     , A.SLHTT_SEQ_NBR                                          
                     , A.FUNC_SEQ_NBR                                           
                     , A.GNDR_SEQ_NBR                                           
                     , A.FBRCN_SEQ_NBR                                          
                     , A.PATRN_SEQ_NBR                                          
                     , A.CUST_INTFC_DESC                                        
W35681               , A.CTG_SEQ_NBR                                            
W35681               , A.MAJ_CTG_SEQ_NBR                                        
W35681               , A.MTRL_SEQ_NBR                                           
W35681               , A.ATTR_1_SEQ_NBR                                         
W35681               , A.ATTR_2_SEQ_NBR                                         
W35681               , A.NW_SLHTT_SEQ_NBR                                       
                  FROM TMDARVS A                                                
                 WHERE A.DEPT_NBR     =  :MDARVS-DEPT-NBR                       
                   AND A.MAJ_CL_NBR   =  :MDARVS-MAJ-CL-NBR                     
                   AND A.SUB_CL_NBR   =  :MDARVS-SUB-CL-NBR                     
                   AND A.ACTV_IND     =  'Y'                                    
              ORDER BY A.LBL_SEQ_NBR                                            
                     , A.RPT_HIER_SEQ_NBR                                       
                     , A.BDY_STYL_SEQ_NBR                                       
                     , A.SLHTT_SEQ_NBR                                          
                     , A.FUNC_SEQ_NBR                                           
                     , A.GNDR_SEQ_NBR                                           
                     , A.FBRCN_SEQ_NBR                                          
                     , A.PATRN_SEQ_NBR                                          
W35681               , A.CTG_SEQ_NBR                                            
W35681               , A.MAJ_CTG_SEQ_NBR                                        
W35681               , A.MTRL_SEQ_NBR                                           
W35681               , A.ATTR_1_SEQ_NBR                                         
W35681               , A.ATTR_2_SEQ_NBR                                         
W35681               , A.NW_SLHTT_SEQ_NBR                                       
           END-EXEC.                                                            
                                                                                
                                                                                
      ******************************************************************        
      *  CURSOR TO RETRIEVE ALL STYLES FOR A DEPARTMENT THAT HAVE NO            
      *  BUSINESS RULES AND WHOSE CUSTOMER INTERFACE DESCRIPTION IS             
      *  EQUAL TO THE OLD BUSINESS GROUP SHORT DESCRIPTION.                     
      ******************************************************************        
           EXEC SQL                                                             
             DECLARE NO_BUS_RULES_CSR CURSOR WITH HOLD FOR                      
                SELECT SUB_CL_MDSEAR_ID                                         
                     , VS_ID                                                    
                  FROM TMDARVS A                                                
                 WHERE DEPT_NBR        = :MDARVS-DEPT-NBR                       
                   AND ACTV_IND        = 'Y'                                    
                   AND CUST_INTFC_DESC = :MDARVS-CUST-INTFC-DESC                
           END-EXEC.                                                            
                                                                                
                                                                                
       LINKAGE SECTION.                                                         
                                                                                
       PROCEDURE DIVISION.                                                      
                                                                                
                                                                                
      ******************************************************************        
      * MAINLINE.                                                               
      ******************************************************************        
       0000-MAINLINE.                                                           
                                                                                
           PERFORM 1000-INITIALIZATION.                                         
                                                                                
           PERFORM 2000-PROCESS-BUS-GROUP-UPDATES                               
               UNTIL PS-END-OF-BG-UPDATES-RECS.                                 
                                                                                
           PERFORM 9000-EOJ-ROUTINE.                                            
                                                                                
           GOBACK.                                                              
                                                                                
      ******************************************************************        
      * INITIALIZATION                                                          
      ******************************************************************        
                                                                                
       1000-INITIALIZATION.                                                     
                                                                                
           OPEN INPUT BUSGP-UPDTS-FILE.                                         
                                                                                
           PERFORM 7400-INIT-CHECKPOINT-SELECT.                                 
                                                                                
      * CKPT-STAT-CODE = '9' INDICATES A RESTART CONDITION                      
           IF TCKRSTCNTL-CKPT-STAT-CODE = '9'                                   
               PERFORM 7500-SELECT-RESTART-INFO                                 
               MOVE TCKRSTINF-WORK-STRG-DESC-TEXT                               
                                           TO CR-CHECKPOINT-RESTART-VAR         
               MOVE CR-PREV-DTL-KEY        TO CK-SAVE-PREV-KEY                  
               MOVE CR-BG-DEPTS-PROCESSED  TO PA-NBR-BG-DEPTS-PROCESSED         
               MOVE CR-BUS-RULES-PROCESSED TO PA-NBR-BUS-RULES-PROCESSED        
               MOVE CR-STYLES-PROCESSED    TO PA-NBR-STYLES-PROCESSED           
               MOVE CR-TMDARVS-UPDATES     TO PA-NBR-TMDARVS-UPDATES            
               MOVE CR-COMMITS-TAKEN       TO PA-NBR-COMMITS-TAKEN              
               DISPLAY 'CHECKPOINT RESTART INFORMATION:'                        
               DISPLAY 'INPUT RECS READ   ' CR-INPUT-READ-COUNT                 
               DISPLAY 'BUSINESS GROUP    ' CK-BUS-GP-NBR                       
               DISPLAY 'BUS GP SHORT DESC ' CK-BUS-GP-SHRT-DESC                 
               DISPLAY 'DEPARTMENT NBR    ' CK-DEPT-NBR                         
               IF CR-INPUT-READ-COUNT > 0                                       
                   SUBTRACT 1 FROM CR-INPUT-READ-COUNT                          
               END-IF                                                           
           ELSE                                                                 
               SET PS-FIRST-COMMIT TO TRUE                                      
               INITIALIZE CR-CHECKPOINT-RESTART-VAR                             
           END-IF.                                                              
      *                                                                         
           PERFORM 4000-READ-BUSGP-UPDTS-REC                                    
               UNTIL PA-NBR-INPUT-RECORDS-READ > CR-INPUT-READ-COUNT            
                  OR PS-END-OF-BG-UPDATES-RECS.                                 
      *                                                                         
           IF TCKRSTCNTL-CKPT-STAT-CODE = '9'                                   
               DISPLAY 'INPUT FILE RESTARTED ON RECORD '                        
                        PA-NBR-INPUT-RECORDS-READ                               
               DISPLAY 'BUSINESS GROUP    ' HM017-BUS-GRP-BUS-GP-NBR            
               DISPLAY 'BUS GP SHORT DESC '                                     
                     HM017-BUS-GRP-BUS-GP-SHRT-DESC                             
               DISPLAY 'DEPARTMENT NBR    ' HM017-BUS-GRP-DEPT                  
           END-IF.                                                              
                                                                                
           IF PS-END-OF-BG-UPDATES-RECS                                         
               DISPLAY '** NO RECORDS ON INPUT FILE **'                         
           ELSE                                                                 
               PERFORM 7300-GET-COMMIT-TIMESTAMP                                
               DISPLAY 'COMMITS WILL BE TAKEN EVERY ',                          
                    TCKRSTCNTL-CKPT-FRQNCY-QTY, ' SECONDS.'                     
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *  FOR EACH BUSINESS GROUP UPDATES FILE RECORD, FIND ALL OF THE           
      *  IMPACTED STYLES AND UPDATE THE CUSTOMER INTERFACE DESCRIPTION.         
      ******************************************************************        
       2000-PROCESS-BUS-GROUP-UPDATES.                                          
                                                                                
           IF HM017-BUS-GRP-DEPT = ZERO                                         
               MOVE HM017-BUS-GRP-BUS-GP-NBR TO MDSEDP-MDSEBG-NBR               
               MOVE 'N' TO PS-END-OF-BG-DEPTS-CSR-SW                            
               PERFORM 5000-OPEN-BG-DEPTS-CSR                                   
               PERFORM 5010-FETCH-BG-DEPTS-CSR                                  
               PERFORM 2010-PROCESS-BG-DEPT                                     
                   UNTIL PS-END-OF-BG-DEPTS-CSR                                 
               PERFORM 5020-CLOSE-BG-DEPTS-CSR                                  
           ELSE                                                                 
               MOVE HM017-BUS-GRP-DEPT TO PV-CURR-DEPT-9                        
               MOVE PV-CURR-DEPT       TO MDSEAR-DEPT-NBR                       
               PERFORM 2010-PROCESS-BG-DEPT                                     
           END-IF.                                                              
                                                                                
           PERFORM 4000-READ-BUSGP-UPDTS-REC.                                   
                                                                                
      ******************************************************************        
      *  FOR EACH BUSINESS GROUP UPDATES FILE RECORD DEPARTMENT, FIND           
      *  ALL OF THE IMPACTED STYLES AND UPDATE THE CUSTOMER INTERFACE           
      *  DESCRIPTION.                                                           
      ******************************************************************        
       2010-PROCESS-BG-DEPT.                                                    
                                                                                
           SET PS-NOT-END-OF-BUS-RULE-CSR TO TRUE.                              
           PERFORM 5100-OPEN-BUS-RULE-CSR.                                      
                                                                                
           PERFORM 5110-FETCH-BUS-RULE-CSR.                                     
                                                                                
           IF PS-NOT-END-OF-BUS-RULE-CSR                                        
               PERFORM 2050-PROCESS-BUS-RULES                                   
                   UNTIL PS-END-OF-BUS-RULE-CSR                                 
           ELSE                                                                 
               PERFORM 2300-PROCESS-NO-RULES-STYLES                             
           END-IF.                                                              
                                                                                
           PERFORM 5120-CLOSE-BUS-RULE-CSR.                                     
                                                                                
           IF HM017-BUS-GRP-DEPT = ZERO                                         
               PERFORM 5010-FETCH-BG-DEPTS-CSR                                  
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *  FOR EACH NEW OR MODIFIED BUSINESS RULE IN TABLE                        
      *  IMT_CHARTC_RULDESC, FIND ALL OF THE IMPACTED STYLES AND                
      *  UPDATE THE CUSTOMER INTERFACE DESCRIPTION.                             
      ******************************************************************        
       2050-PROCESS-BUS-RULES.                                                  
                                                                                
           INITIALIZE  PV-CURR-MCL                                              
                       PV-CURR-SCL.                                             
                                                                                
           MOVE +0  TO MDARVS-LBL-SEQ-NBR                                       
                       MDARVS-RPT-HIER-SEQ-NBR                                  
                       MDARVS-BDY-STYL-SEQ-NBR                                  
                       MDARVS-SLHTT-SEQ-NBR                                     
                       MDARVS-FUNC-SEQ-NBR                                      
                       MDARVS-GNDR-SEQ-NBR                                      
                       MDARVS-FBRCN-SEQ-NBR                                     
                       MDARVS-PATRN-SEQ-NBR                                     
                       MDARVS-PRFL-GP-NM-TXT                                    
                       MDARVS-CTG-SEQ-NBR                                       
                       MDARVS-MAJ-CTG-SEQ-NBR                                   
                       MDARVS-MTRL-SEQ-NBR                                      
                       MDARVS-ATTR-1-SEQ-NBR                                    
                       MDARVS-ATTR-2-SEQ-NBR                                    
                       MDARVS-NW-SLHTT-SEQ-NBR.                                 
                                                                                
           MOVE 'N' TO PS-DEPT-LVL-RULE-SW                                      
                       PS-MCL-LVL-RULE-SW                                       
                       PS-SCL-LVL-RULE-SW                                       
                       PS-END-OF-STYLE-CSR-SW.                                  
                                                                                
           MOVE MDSEAR-DEPT-NBR             TO PV-CURR-DEPT.                    
           MOVE PV-CURR-DEPT-9              TO MDARVS-DEPT-NBR.                 
                                                                                
           IF MDSEAR-MDSELV-CDE = 'SCL'                                         
               MOVE MDSEAR-SUB-CL-NBR TO PV-CURR-SCL                            
               MOVE PV-CURR-SCL-9  TO MDARVS-SUB-CL-NBR                         
               MOVE MDSEAR-MAJ-CL-NBR TO PV-CURR-MCL                            
               MOVE PV-CURR-MCL-9  TO MDARVS-MAJ-CL-NBR                         
               SET PS-SCL-LVL-RULE TO TRUE                                      
           ELSE                                                                 
               IF MDSEAR-MDSELV-CDE = 'MCL'                                     
                   MOVE MDSEAR-MAJ-CL-NBR TO PV-CURR-MCL                        
                   MOVE PV-CURR-MCL-9  TO MDARVS-MAJ-CL-NBR                     
                   SET PS-MCL-LVL-RULE TO TRUE                                  
               ELSE                                                             
                   IF MDSEAR-MDSELV-CDE = 'DPT'                                 
                       SET PS-DEPT-LVL-RULE TO TRUE                             
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  PS-DEPT-LVL-RULE                                                 
               PERFORM 5200-OPEN-STYLES-BY-DEPT-CSR                             
               PERFORM 5210-FETCH-STYLES-BY-DEPT                                
           ELSE                                                                 
               IF  PS-MCL-LVL-RULE                                              
                   PERFORM 5300-OPEN-STYLES-BY-MCL-CSR                          
                   PERFORM 5310-FETCH-STYLES-BY-MCL                             
               ELSE                                                             
                   IF  PS-SCL-LVL-RULE                                          
                       PERFORM 5400-OPEN-STYLES-BY-SCL-CSR                      
                       PERFORM 5410-FETCH-STYLES-BY-SCL                         
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
           PERFORM 2100-PROCESS-STYLES                                          
               UNTIL PS-END-OF-STYLE-CSR.                                       
                                                                                
           IF  PS-DEPT-LVL-RULE                                                 
               PERFORM 5220-CLOSE-STYLES-BY-DEPT-CSR                            
           ELSE                                                                 
               IF  PS-MCL-LVL-RULE                                              
                   PERFORM 5320-CLOSE-STYLES-BY-MCL-CSR                         
               ELSE                                                             
                   IF  PS-SCL-LVL-RULE                                          
                       PERFORM 5420-CLOSE-STYLES-BY-SCL-CSR                     
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
           PERFORM 5110-FETCH-BUS-RULE-CSR.                                     
                                                                                
      ******************************************************************        
      *  BUILD THE NEW CUSTOMER INTERFACE DESCRIPTION FOR EACH STYLE            
      *  IMPACTED BY THE BUSINESS RULE CHANGE, AND UPDATE THE CUSTOMER          
      *  INTERFACE DESCRIPTION IN TABLE TMDARVS.                                
      ******************************************************************        
       2100-PROCESS-STYLES.                                                     
                                                                                
           IF  MDARVS-LBL-SEQ-NBR      = PV-PREV-LBL-SEQ-NBR                    
           AND MDARVS-RPT-HIER-SEQ-NBR = PV-PREV-RPT-HIER-SEQ-NBR               
           AND MDARVS-BDY-STYL-SEQ-NBR = PV-PREV-BDY-STYL-SEQ-NBR               
           AND MDARVS-SLHTT-SEQ-NBR    = PV-PREV-SLHTT-SEQ-NBR                  
           AND MDARVS-FUNC-SEQ-NBR     = PV-PREV-FUNC-SEQ-NBR                   
           AND MDARVS-GNDR-SEQ-NBR     = PV-PREV-GNDR-SEQ-NBR                   
           AND MDARVS-FBRCN-SEQ-NBR    = PV-PREV-FBRCN-SEQ-NBR                  
           AND MDARVS-PATRN-SEQ-NBR    = PV-PREV-PATRN-SEQ-NBR                  
W35681     AND MDARVS-CTG-SEQ-NBR      = PV-PREV-CTG-SEQ-NBR                    
W35681     AND MDARVS-MAJ-CTG-SEQ-NBR  = PV-PREV-MAJ-CTG-SEQ-NBR                
W35681     AND MDARVS-MTRL-SEQ-NBR     = PV-PREV-MTRL-SEQ-NBR                   
W35681     AND MDARVS-ATTR-1-SEQ-NBR   = PV-PREV-ATTR-1-SEQ-NBR                 
W35681     AND MDARVS-ATTR-2-SEQ-NBR   = PV-PREV-ATTR-2-SEQ-NBR                 
W35681     AND MDARVS-NW-SLHTT-SEQ-NBR = PV-PREV-NW-SLHTT-SEQ-NBR               
      ****     IF ALL OF THE ATTRIBUTES ARE THE SAME, USE THE SAME              
      ****     CUSTOMER INTERFACE DESCRIPTION THAT WAS JUST BUILT               
               CONTINUE                                                         
           ELSE                                                                 
               PERFORM 2140-BUILD-CUST-DESC                                     
           END-IF.                                                              
                                                                                
           IF PV-CUST-DESC-EDITED NOT = MDARVS-CUST-INTFC-DESC                  
             AND (PS-BUSINESS-GROUP-USED                                        
                  OR PS-DFLT-BUS-GRP-USED)                                      
               PERFORM 5700-UPDATE-CUST-DESC                                    
               PERFORM 7700-COMMIT-PROCESSING                                   
           END-IF.                                                              
                                                                                
           IF  PS-DEPT-LVL-RULE                                                 
               PERFORM 5210-FETCH-STYLES-BY-DEPT                                
           ELSE                                                                 
               IF  PS-MCL-LVL-RULE                                              
                   PERFORM 5310-FETCH-STYLES-BY-MCL                             
               ELSE                                                             
                   IF  PS-SCL-LVL-RULE                                          
                       PERFORM 5410-FETCH-STYLES-BY-SCL                         
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  BUILD THE 26-CHARACTER CUSTOMER INTERFACE DESCRIPTION                  
      ******************************************************************        
       2140-BUILD-CUST-DESC.                                                    
                                                                                
           SET PS-BUSINESS-GROUP-NOT-USED TO TRUE.                              
           SET PS-DFLT-BUS-GRP-NOT-USED TO TRUE.                                
           MOVE SPACES TO  PV-CUST-DESC                                         
                           PV-CUST-DESC-PART-1                                  
                           PV-CUST-DESC-PART-2                                  
                           PV-CUST-DESC-PART-3                                  
                           PV-CUST-DESC-DFLT-BRND                               
W35681                     PV-CUST-DESC-DFLT-HIER                               
W35681                     PV-CUST-DESC-DFLT-CTG.                               
           MOVE ZERO   TO  PV-NBR-BLANK-ATTRS.                                  
           MOVE 'N'    TO  PS-DFLT-BRND-IS-BLANK-SW                             
W35681                     PS-DFLT-HIER-IS-BLANK-SW                             
W35681                     PS-DFLT-CTG-IS-BLANK-SW.                             
                                                                                
           PERFORM 2141-GET-CUST-DESC-PART-1.                                   
           PERFORM 2142-GET-CUST-DESC-PART-2.                                   
                                                                                
                                                                                
W35681***  IF TWO OF THREE PARTS OF THE CUST DESC ARE                           
W35681***  BLANK AND ONE OF THEM IS BRAND OR CATAGORY,                          
W35681***  TRY TO USE BRAND + CATAGORY DEFAULT                                  
W35681***  AS THE DEFAULT DESCRIPTION .                                         
W35681***  IF THAT DOESN'T WORK, TRY BRAND + HIERARCHY                          
W35681***  AS THE DEFAULT DESCRIPTION .                                         
W35681***  IF THAT DOESN'T WORK, DEFAULT TO                                     
W35681***  BUSINESS GROUP AS THE DEFAULT DESCRIPTION                            
                                                                                
W35681     IF  PV-NBR-BLANK-ATTRS = 2                                           
W35681         PERFORM 2160-APPLY-DEFAULTS                                      
W35681     ELSE                                                                 
W35681***      IF AT LEAST ONE OF THE FIRST TWO PARTS OF THE CUST DESC          
W35681***      IS NOT BLANK, GO AHEAD AND RETRIEVE THE THIRD PART               
W35681         PERFORM 2143-GET-CUST-DESC-PART-3                                
W35681         IF  PV-NBR-BLANK-ATTRS = 2                                       
W35681             PERFORM 2160-APPLY-DEFAULTS                                  
W35681         END-IF                                                           
W35681     END-IF.                                                              
                                                                                
           PERFORM 2150-EDIT-CUST-DESC.                                         
                                                                                
W35681************************************************************              
W35681*     ALL OF THE COMMENTED OUT CODE BELOW WAS REPLACED     *              
W35681*     BY THE LOGIC ABOVE AND THE PERFORMED ROUTINES        *              
W35681************************************************************              
                                                                                
      ***  IF TWO OF THREE PARTS OF THE CUST DESC ARE                           
      ***  BLANK AND ONE OF THEM IS BRAND OR HIERARCHY,                         
      ***  USE BUSINESS GROUP AS THE DEFAULT DESCRIPTION                        
      ***                                                                       
      ***  IF TWO OF THREE PARTS OF THE CUST DESC ARE BLANK                     
      ***  AND NEITHER OF THEM IS BRAND OR HIERARCHY, USE THE                   
      ***  DEFAULT RULE OF BRAND + HIERARCHY                                    
      ***                                                                       
      ***  IF  PV-NBR-BLANK-ATTRS = 2                                           
      ***      IF  PS-DFLT-BRND-IS-BLANK                                        
      ***      OR  PS-DFLT-HIER-IS-BLANK                                        
      ***          MOVE PV-SAVED-BUS-GRP-DESC TO PV-CUST-DESC-PART-1            
      ***          MOVE SPACES                TO PV-CUST-DESC-PART-2            
      ***                                        PV-CUST-DESC-PART-3            
      ***      ELSE                                                             
      ***          PERFORM 2160-DEFAULT-BRND-HIER                               
      ***      END-IF                                                           
      ***  ELSE                                                                 
      ***      IF AT LEAST ONE OF THE FIRST TWO PARTS OF THE CUST DESC          
      ***      IS NOT BLANK, GO AHEAD AND RETRIEVE THE THIRD PART               
      ***      PERFORM 2143-GET-CUST-DESC-PART-3                                
      ***      IF  PV-NBR-BLANK-ATTRS = 2                                       
      ***          IF  PS-DFLT-BRND-IS-BLANK                                    
      ***          OR  PS-DFLT-HIER-IS-BLANK                                    
      ***              MOVE PV-SAVED-BUS-GRP-DESC                               
      ***                                     TO PV-CUST-DESC-PART-1            
      ***              MOVE SPACES            TO PV-CUST-DESC-PART-2            
      ***                                        PV-CUST-DESC-PART-3            
      ***          ELSE                                                         
      ***              PERFORM 2160-DEFAULT-BRND-HIER                           
      ***          END-IF                                                       
      ***      END-IF                                                           
      ***  END-IF.                                                              
                                                                                
      ******************************************************************        
      *  GET THE FIRST OF THREE 8-CHAR SHORT DESCRIPTIONS THAT WILL             
      *  BE USED TO BUILD THE CUSTOMER INTERFACE DESCRIPTION.                   
      ******************************************************************        
       2141-GET-CUST-DESC-PART-1.                                               
                                                                                
           MOVE IMT00022-POS1-VS-CHARTC-CDE TO PV-CHARTC-CDE                    
                                               PV-CHARTC-CDE-TYPE.              
                                                                                
           PERFORM 2200-GET-SHORT-DESC.                                         
                                                                                
           MOVE PV-SHORT-DESC TO PV-CUST-DESC-PART-1.                           
                                                                                
           IF  PV-CUST-DESC-PART-1 = SPACES                                     
               ADD +1 TO PV-NBR-BLANK-ATTRS                                     
               IF  PV-ATTR-BRAND                                                
                   SET PS-DFLT-BRND-IS-BLANK TO TRUE                            
               ELSE                                                             
W35681             IF  PV-ATTR-CTG                                              
W35681                 SET PS-DFLT-CTG-IS-BLANK TO TRUE                         
W35681             ELSE                                                         
W35681                 IF  PV-ATTR-HIER                                         
W35681                     SET PS-DFLT-HIER-IS-BLANK TO TRUE                    
W35681                 END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           ELSE                                                                 
               IF  PV-ATTR-BRAND                                                
                   MOVE PV-CUST-DESC-PART-1 TO PV-CUST-DESC-DFLT-BRND           
               ELSE                                                             
W35681             IF  PV-ATTR-CTG                                              
W35681                 MOVE PV-CUST-DESC-PART-1                                 
W35681                                      TO PV-CUST-DESC-DFLT-CTG            
W35681             ELSE                                                         
W35681                 IF  PV-ATTR-HIER                                         
W35681                     MOVE PV-CUST-DESC-PART-1                             
W35681                                      TO PV-CUST-DESC-DFLT-HIER           
W35681                 ELSE                                                     
W35681                     IF  PV-ATTR-BUSGRP                                   
W35681                         SET PS-BUSINESS-GROUP-USED TO TRUE               
W35681                     END-IF                                               
W35681                 END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  GET THE SECOND OF THREE 8-CHAR SHORT DESCRIPTIONS THAT WILL            
      *  BE USED TO BUILD THE CUSTOMER INTERFACE DESCRIPTION.                   
      ******************************************************************        
       2142-GET-CUST-DESC-PART-2.                                               
                                                                                
           MOVE IMT00022-POS2-VS-CHARTC-CDE TO PV-CHARTC-CDE                    
                                               PV-CHARTC-CDE-TYPE.              
                                                                                
           PERFORM 2200-GET-SHORT-DESC.                                         
                                                                                
           MOVE PV-SHORT-DESC TO PV-CUST-DESC-PART-2.                           
                                                                                
           IF  PV-CUST-DESC-PART-2 = SPACES                                     
               ADD +1 TO PV-NBR-BLANK-ATTRS                                     
               IF  PV-ATTR-BRAND                                                
                   SET PS-DFLT-BRND-IS-BLANK TO TRUE                            
               ELSE                                                             
W35681             IF  PV-ATTR-CTG                                              
W35681                 SET PS-DFLT-CTG-IS-BLANK TO TRUE                         
W35681             ELSE                                                         
W35681                 IF  PV-ATTR-HIER                                         
W35681                     SET PS-DFLT-HIER-IS-BLANK TO TRUE                    
W35681                 END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           ELSE                                                                 
               IF  PV-ATTR-BRAND                                                
                   MOVE PV-CUST-DESC-PART-2 TO PV-CUST-DESC-DFLT-BRND           
               ELSE                                                             
W35681             IF  PV-ATTR-CTG                                              
W35681                 MOVE PV-CUST-DESC-PART-2                                 
W35681                                      TO PV-CUST-DESC-DFLT-CTG            
W35681             ELSE                                                         
W35681                 IF  PV-ATTR-HIER                                         
W35681                     MOVE PV-CUST-DESC-PART-2                             
W35681                                      TO PV-CUST-DESC-DFLT-HIER           
W35681                 ELSE                                                     
W35681                     IF  PV-ATTR-BUSGRP                                   
W35681                         SET PS-BUSINESS-GROUP-USED TO TRUE               
W35681                     END-IF                                               
W35681                 END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  GET THE THIRD OF THREE 8-CHAR SHORT DESCRIPTIONS THAT WILL             
      *  BE USED TO BUILD THE CUSTOMER INTERFACE DESCRIPTION.                   
      ******************************************************************        
       2143-GET-CUST-DESC-PART-3.                                               
                                                                                
           MOVE IMT00022-POS3-VS-CHARTC-CDE TO PV-CHARTC-CDE                    
                                               PV-CHARTC-CDE-TYPE.              
                                                                                
           PERFORM 2200-GET-SHORT-DESC.                                         
                                                                                
           MOVE PV-SHORT-DESC TO PV-CUST-DESC-PART-3.                           
                                                                                
           IF  PV-CUST-DESC-PART-3 = SPACES                                     
               ADD +1 TO PV-NBR-BLANK-ATTRS                                     
               IF  PV-ATTR-BRAND                                                
                   SET PS-DFLT-BRND-IS-BLANK TO TRUE                            
               ELSE                                                             
W35681             IF  PV-ATTR-CTG                                              
W35681                 SET PS-DFLT-CTG-IS-BLANK TO TRUE                         
W35681             ELSE                                                         
W35681                 IF  PV-ATTR-HIER                                         
W35681                     SET PS-DFLT-HIER-IS-BLANK TO TRUE                    
W35681                 END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           ELSE                                                                 
               IF  PV-ATTR-BRAND                                                
                   MOVE PV-CUST-DESC-PART-3 TO PV-CUST-DESC-DFLT-BRND           
               ELSE                                                             
W35681             IF  PV-ATTR-CTG                                              
W35681                 MOVE PV-CUST-DESC-PART-3                                 
W35681                                      TO PV-CUST-DESC-DFLT-CTG            
W35681             ELSE                                                         
W35681                 IF  PV-ATTR-HIER                                         
W35681                     MOVE PV-CUST-DESC-PART-3                             
W35681                                      TO PV-CUST-DESC-DFLT-HIER           
W35681                 ELSE                                                     
W35681                     IF  PV-ATTR-BUSGRP                                   
W35681                         SET PS-BUSINESS-GROUP-USED TO TRUE               
W35681                     END-IF                                               
W35681                 END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  EDIT THE CUSTOMER INTERFACE DESC TO REMOVE EXTRA SPACES.               
      ******************************************************************        
       2150-EDIT-CUST-DESC.                                                     
                                                                                
      **** ELIMINATE DUPLICATE SHORT DESCRIPTIONS WITHIN THE 26-CHAR            
      **** CUSTOMER INTERFACE DESCRIPTION.                                      
                                                                                
           IF  PV-CUST-DESC-PART-2 = PV-CUST-DESC-PART-3                        
               MOVE SPACES TO PV-CUST-DESC-PART-3                               
           END-IF.                                                              
                                                                                
           IF  PV-CUST-DESC-PART-1 = PV-CUST-DESC-PART-3                        
               MOVE SPACES TO PV-CUST-DESC-PART-3                               
           END-IF.                                                              
                                                                                
           IF  PV-CUST-DESC-PART-1 = PV-CUST-DESC-PART-2                        
               MOVE SPACES TO PV-CUST-DESC-PART-2                               
           END-IF.                                                              
                                                                                
      **** REFORMAT THE CUSTOMER DESCRIPTION TO ELIMINATE SPACES IN             
      **** PARTS 1 AND 2 OF THE 26-CHAR CUSTOMER INTERFACE DESCRIPTION.         
                                                                                
           IF  PV-CUST-DESC-PART-2 = SPACES                                     
               MOVE PV-CUST-DESC-PART-3 TO PV-CUST-DESC-PART-2                  
               MOVE SPACES              TO PV-CUST-DESC-PART-3                  
           END-IF.                                                              
                                                                                
           IF  PV-CUST-DESC-PART-1 = SPACES                                     
               MOVE PV-CUST-DESC-PART-2 TO PV-CUST-DESC-PART-1                  
               MOVE PV-CUST-DESC-PART-3 TO PV-CUST-DESC-PART-2                  
               MOVE SPACES              TO PV-CUST-DESC-PART-3                  
           END-IF.                                                              
                                                                                
      **** ELIMINATE EXTRA SPACES WITHIN THE 26-CHAR CUSTOMER INTERFACE         
      **** DESCRIPTION.                                                         
                                                                                
           IF PV-CUST-DESC-PART-2 = SPACES                                      
             AND PV-CUST-DESC-PART-3 = SPACES                                   
               PERFORM 2165-DEFAULT-BUS-GRP                                     
               MOVE PV-SHORT-DESC TO PV-CUST-DESC-EDITED                        
           ELSE                                                                 
               PERFORM 2155-ELIM-SPACES                                         
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  DELETE EXTRA SPACES FROM THE 26-CHAR CUSTOMER INTERFACE DESC           
      ******************************************************************        
       2155-ELIM-SPACES.                                                        
                                                                                
           INITIALIZE PV-END-SPACE-CNT                                          
                      PV-END-SPACE-CNT-1                                        
                      PV-END-SPACE-CNT-2                                        
                      PV-END-SPACE-CNT-3                                        
                      PV-CNT-TRAILING-SPACES                                    
                      PV-CUST-DESC-EDITED.                                      
                                                                                
           MOVE PV-CUST-DESC-PART-1 TO PV-CNT-TRAILING-SPACES.                  
           PERFORM 2157-COUNT-SPACES.                                           
           MOVE PV-END-SPACE-CNT    TO PV-END-SPACE-CNT-1.                      
                                                                                
           INITIALIZE PV-END-SPACE-CNT                                          
                      PV-CNT-TRAILING-SPACES.                                   
                                                                                
           MOVE PV-CUST-DESC-PART-2 TO PV-CNT-TRAILING-SPACES.                  
           PERFORM 2157-COUNT-SPACES.                                           
           MOVE PV-END-SPACE-CNT    TO PV-END-SPACE-CNT-2.                      
                                                                                
           INITIALIZE PV-END-SPACE-CNT                                          
                      PV-CNT-TRAILING-SPACES.                                   
                                                                                
           MOVE PV-CUST-DESC-PART-3 TO PV-CNT-TRAILING-SPACES.                  
           PERFORM 2157-COUNT-SPACES.                                           
           MOVE PV-END-SPACE-CNT    TO PV-END-SPACE-CNT-3.                      
                                                                                
           STRING PV-CUST-DESC-PART-1  (1 : 8 - PV-END-SPACE-CNT-1)             
                                       DELIMITED BY SIZE                        
                  SPACE                DELIMITED BY SIZE                        
                  PV-CUST-DESC-PART-2  (1 : 8 - PV-END-SPACE-CNT-2)             
                                       DELIMITED BY SIZE                        
                  SPACE                DELIMITED BY SIZE                        
                  PV-CUST-DESC-PART-3  (1 : 8 - PV-END-SPACE-CNT-3)             
                                       DELIMITED BY SIZE                        
                  INTO PV-CUST-DESC-EDITED                                      
           END-STRING.                                                          
                                                                                
                                                                                
      ******************************************************************        
      *  COUNT THE TRAILING SPACES IN EACH 8-CHAR SHORT DESCRIPTION             
      *  (PARTS 1, 2, AND 3 OF THE CUSTOMER INTERFACE DESCRIPTION).             
      ******************************************************************        
       2157-COUNT-SPACES.                                                       
                                                                                
           IF  PV-CNT-TRAILING-SPACES = SPACES                                  
               MOVE +8 TO PV-END-SPACE-CNT                                      
           ELSE                                                                 
               IF  PV-7-TRLNG-SPCS = SPACES                                     
                   MOVE +7 TO PV-END-SPACE-CNT                                  
               ELSE                                                             
                   IF  PV-6-TRLNG-SPCS = SPACES                                 
                       MOVE +6 TO PV-END-SPACE-CNT                              
                   ELSE                                                         
                       IF  PV-5-TRLNG-SPCS = SPACES                             
                           MOVE +5 TO PV-END-SPACE-CNT                          
                       ELSE                                                     
                           IF  PV-4-TRLNG-SPCS = SPACES                         
                               MOVE +4 TO PV-END-SPACE-CNT                      
                           ELSE                                                 
                               IF  PV-3-TRLNG-SPCS = SPACES                     
                                   MOVE +3 TO PV-END-SPACE-CNT                  
                               ELSE                                             
                                   IF  PV-2-TRLNG-SPCS = SPACES                 
                                       MOVE +2 TO PV-END-SPACE-CNT              
                                   ELSE                                         
                                       IF  PV-1-TRLNG-SPCS = SPACES             
                                           MOVE +1 TO PV-END-SPACE-CNT          
                                       END-IF                                   
                                   END-IF                                       
                               END-IF                                           
                           END-IF                                               
                       END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
                                                                                
W35681******************************************************************        
W35681*  TWO OF THE THREE PARTS THAT MAKE UP THE 26-CHAR CUSTOMER               
W35681*  INTERFACE DESCRIPTION ARE BLANK - USE BRAND/CATAGORY DEFAULT           
W35681*  DESCRIPTION OR BRAND/HIERARCHY DEFAULT OR BUSINESS GROUP               
W35681******************************************************************        
W35681 2160-APPLY-DEFAULTS.                                                     
W35681                                                                          
W35681** BRAND MUST BE PRESENT OR BUS GRP DEFAULT IS USED                       
W35681** IF CATAGORY IS PRESENT IT WILL BE USED WITH BRAND                      
W35681** IF CATAGORY IS NOT PRESENT, HIERARCHY WILL BE USED WITH BRAND          
W35681** IF NEITHER CATAGORY NOR HIERARCHY ARE PRESENT, BUS GRP DEFAULT         
W35681** WILL BE USED.                                                          
W35681                                                                          
W35681                                                                          
W35681     SET PS-BUSINESS-GROUP-NOT-USED TO TRUE.                              
W35681                                                                          
W35681     PERFORM 2161-TRY-BRAND.                                              
W35681                                                                          
W35681     IF  PV-CUST-DESC-PART-1    = SPACES                                  
W35681         PERFORM 2165-DEFAULT-BUS-GRP                                     
W35681     ELSE                                                                 
W35681         PERFORM 2162-TRY-CTG                                             
W35681         IF  PV-CUST-DESC-PART-2    = SPACES                              
W35681             PERFORM 2163-TRY-HIER                                        
W35681             IF  PV-CUST-DESC-PART-2    = SPACES                          
W35681                 PERFORM 2165-DEFAULT-BUS-GRP                             
W35681              END-IF                                                      
W35681         END-IF                                                           
W35681     END-IF.                                                              
W35681                                                                          
W35681                                                                          
W35681                                                                          
W35681 2161-TRY-BRAND.                                                          
W35681                                                                          
W35681     IF PV-CUST-DESC-DFLT-BRND = SPACES                                   
W35681         MOVE PC-ATTR-BRAND TO PV-CHARTC-CDE                              
W35681                               PV-CHARTC-CDE-TYPE                         
W35681         PERFORM 2200-GET-SHORT-DESC                                      
W35681         MOVE PV-SHORT-DESC TO PV-CUST-DESC-PART-1                        
W35681     ELSE                                                                 
W35681         MOVE PV-CUST-DESC-DFLT-BRND TO PV-CUST-DESC-PART-1               
W35681                                                                          
W35681     END-IF.                                                              
W35681                                                                          
W35681                                                                          
W35681 2162-TRY-CTG.                                                            
W35681                                                                          
W35681     IF PV-CUST-DESC-DFLT-CTG  = SPACES                                   
W35681         MOVE PC-ATTR-CTG   TO PV-CHARTC-CDE                              
W35681                               PV-CHARTC-CDE-TYPE                         
W35681         PERFORM 2200-GET-SHORT-DESC                                      
W35681         MOVE PV-SHORT-DESC TO PV-CUST-DESC-PART-2                        
W35861         MOVE SPACES                 TO PV-CUST-DESC-PART-3               
W35681     ELSE                                                                 
W35681         MOVE PV-CUST-DESC-DFLT-CTG  TO PV-CUST-DESC-PART-2               
W35861         MOVE SPACES                 TO PV-CUST-DESC-PART-3               
W35681     END-IF.                                                              
W35681                                                                          
W35681 2163-TRY-HIER.                                                           
W35681                                                                          
W35681     IF PV-CUST-DESC-DFLT-HIER = SPACES                                   
W35681         MOVE PC-ATTR-HIER  TO PV-CHARTC-CDE                              
W35681                               PV-CHARTC-CDE-TYPE                         
W35681         PERFORM 2200-GET-SHORT-DESC                                      
W35681         MOVE PV-SHORT-DESC TO PV-CUST-DESC-PART-2                        
W35861         MOVE SPACES                 TO PV-CUST-DESC-PART-3               
W35681     ELSE                                                                 
W35681         MOVE PV-CUST-DESC-DFLT-HIER TO PV-CUST-DESC-PART-2               
W35861         MOVE SPACES                 TO PV-CUST-DESC-PART-3               
W35681     END-IF.                                                              
W35681                                                                          
W35681                                                                          
                                                                                
   *********************************************************************        
   ****  TWO OF THE THREE PARTS THAT MAKE UP THE 26-CHAR CUSTOMER               
   ****  INTERFACE DESCRIPTION ARE BLANK - USE BRAND/HIERARCHY DEFAULT          
   ****  DESCRIPTION.                                                           
   *********************************************************************        
   ****2160-DEFAULT-BRND-HIER.                                                  
   ****                                                                         
   ****    SET PS-BUSINESS-GROUP-NOT-USED TO TRUE.                              
   ****                                                                         
   ****    IF  PV-CUST-DESC-DFLT-BRND = SPACES                                  
   ****        MOVE PC-ATTR-BRAND TO PV-CHARTC-CDE                              
   ****                              PV-CHARTC-CDE-TYPE                         
   ****        PERFORM 2200-GET-SHORT-DESC                                      
   ****        MOVE PV-SHORT-DESC TO PV-CUST-DESC-PART-1                        
   ****    ELSE                                                                 
   ****        MOVE PV-CUST-DESC-DFLT-BRND TO PV-CUST-DESC-PART-1               
   ****    END-IF.                                                              
   ****                                                                         
   ****    IF  PV-CUST-DESC-PART-1 = SPACES                                     
   ****        PERFORM 2165-DEFAULT-BUS-GRP                                     
   ****    ELSE                                                                 
   ****        IF  PV-CUST-DESC-DFLT-HIER = SPACES                              
   ****            MOVE PC-ATTR-HIER TO PV-CHARTC-CDE                           
   ****                                 PV-CHARTC-CDE-TYPE                      
   ****            PERFORM 2200-GET-SHORT-DESC                                  
   ****            MOVE PV-SHORT-DESC TO PV-CUST-DESC-PART-2                    
   ****            IF  PV-CUST-DESC-PART-2 = SPACES                             
   ****                PERFORM 2165-DEFAULT-BUS-GRP                             
   ****            ELSE                                                         
   ****                MOVE SPACES TO PV-CUST-DESC-PART-3                       
   ****            END-IF                                                       
   ****        ELSE                                                             
   ****            MOVE PV-CUST-DESC-DFLT-HIER TO PV-CUST-DESC-PART-2           
   ****            MOVE SPACES                 TO PV-CUST-DESC-PART-3           
   ****        END-IF                                                           
   ****    END-IF.                                                              
   ****                                                                         
   ****                                                                         
   *********************************************************************        
   ****  BRAND/HIER DEFAULT IS NOT COMPLETE - USE BUSINESS GROUP                
   ****  DEFAULT DESCRIPTION.                                                   
   *********************************************************************        
       2165-DEFAULT-BUS-GRP.                                                    
                                                                                
           SET PS-DFLT-BUS-GRP-USED TO TRUE.                                    
                                                                                
           MOVE HM017-BUS-GRP-BUS-GP-SHRT-DESC                                  
                              TO PV-SHORT-DESC                                  
                                 PV-CUST-DESC-PART-1.                           
           MOVE SPACES        TO PV-CUST-DESC-PART-2                            
                                 PV-CUST-DESC-PART-3.                           
                                                                                
                                                                                
      ******************************************************************        
      *  GET ONE OF THE 8-CHAR SHORT DESCRIPTIONS THAT WILL BE                  
      *  BE CONCATENATED TO BUILD THE 26-CHAR CUSTOMER INTERFACE                
      *  DESCRIPTION.                                                           
      ******************************************************************        
       2200-GET-SHORT-DESC.                                                     
                                                                                
           MOVE SPACES TO PV-SHORT-DESC.                                        
                                                                                
           IF  IM-CHARTC-CDE                                                    
               PERFORM 2210-GET-ITEM-ATTR                                       
           ELSE                                                                 
               IF  BG-CHARTC-CDE                                                
                   MOVE HM017-BUS-GRP-BUS-GP-SHRT-DESC                          
                         TO PV-SHORT-DESC                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  GET THE ITEM ATTRIBUTE DESCRIPTION NEEDED TO BUILD THE                 
      *  26-CHARACTER CUSTOMER INTERFACE DESCRIPTION.                           
      ******************************************************************        
       2210-GET-ITEM-ATTR.                                                      
                                                                                
           MOVE PV-CHARTC-CDE TO VSCHVL-CHARTC-CDE.                             
                                                                                
W35681*   CHANGED IF - ELSE TO AN EVALUATE                                      
W35681                                                                          
W35681     EVALUATE TRUE                                                        
W35681                                                                          
W35681         WHEN PV-ATTR-BRAND                                               
W35681                  MOVE MDARVS-LBL-SEQ-NBR                                 
W35681                             TO VSCHVL-CHARTC-SEQ-NBR                     
W35681         WHEN PV-ATTR-HIER                                                
W35681                  MOVE MDARVS-RPT-HIER-SEQ-NBR                            
W35681                             TO VSCHVL-CHARTC-SEQ-NBR                     
W35681         WHEN PV-ATTR-FUNC                                                
W35681                  MOVE MDARVS-FUNC-SEQ-NBR                                
W35681                             TO VSCHVL-CHARTC-SEQ-NBR                     
W35681         WHEN PV-ATTR-SILH                                                
W35681                  MOVE MDARVS-SLHTT-SEQ-NBR                               
W35681                             TO VSCHVL-CHARTC-SEQ-NBR                     
W35681         WHEN PV-ATTR-BDYSTL                                              
W35681                  MOVE MDARVS-BDY-STYL-SEQ-NBR                            
W35681                             TO VSCHVL-CHARTC-SEQ-NBR                     
W35681         WHEN PV-ATTR-GNDR                                                
W35681                  MOVE MDARVS-GNDR-SEQ-NBR                                
W35681                             TO VSCHVL-CHARTC-SEQ-NBR                     
W35681         WHEN PV-ATTR-FABRICATION                                         
W35681                  MOVE MDARVS-FBRCN-SEQ-NBR                               
W35681                             TO VSCHVL-CHARTC-SEQ-NBR                     
W35681         WHEN PV-ATTR-PATTERN                                             
W35681                  MOVE MDARVS-PATRN-SEQ-NBR                               
W35681                             TO VSCHVL-CHARTC-SEQ-NBR                     
W35681         WHEN PV-ATTR-CTG                                                 
W35681                  MOVE MDARVS-CTG-SEQ-NBR                                 
W35681                             TO VSCHVL-CHARTC-SEQ-NBR                     
W35681         WHEN PV-ATTR-MAJ-CTG                                             
W35681                  MOVE MDARVS-MAJ-CTG-SEQ-NBR                             
W35681                             TO VSCHVL-CHARTC-SEQ-NBR                     
W35681         WHEN PV-ATTR-NW-SILH                                             
W35681                  MOVE MDARVS-NW-SLHTT-SEQ-NBR                            
W35681                             TO VSCHVL-CHARTC-SEQ-NBR                     
W35681         WHEN PV-ATTR-MTRL                                                
W35681                  MOVE MDARVS-MTRL-SEQ-NBR                                
W35681                             TO VSCHVL-CHARTC-SEQ-NBR                     
W35681         WHEN PV-ATTR-ATTR-1                                              
W35681                  MOVE MDARVS-ATTR-1-SEQ-NBR                              
W35681                             TO VSCHVL-CHARTC-SEQ-NBR                     
W35681         WHEN PV-ATTR-ATTR-2                                              
W35681                  MOVE MDARVS-ATTR-2-SEQ-NBR                              
W35681                             TO VSCHVL-CHARTC-SEQ-NBR                     
W35681     END-EVALUATE.                                                        
                                                                                
           PERFORM 5600-GET-ITEM-ATTR-TVSCHVL.                                  
                                                                                
                                                                                
      ******************************************************************        
      *  BUILD THE NEW CUSTOMER INTERFACE DESCRIPTION FOR EACH STYLE            
      *  IMPACTED BY THE BUSINESS RULE CHANGE, AND UPDATE THE CUSTOMER          
      *  INTERFACE DESCRIPTION ON TABLE TMDARVS.                                
      ******************************************************************        
       2300-PROCESS-NO-RULES-STYLES.                                            
                                                                                
           MOVE HM017-BUS-GRP-OLD-SHRT-DESC                                     
                 TO MDARVS-CUST-INTFC-DESC.                                     
           MOVE HM017-BUS-GRP-BUS-GP-SHRT-DESC                                  
                 TO PV-CUST-DESC-EDITED.                                        
           MOVE MDSEAR-DEPT-NBR TO PV-CURR-DEPT.                                
           MOVE PV-CURR-DEPT-9  TO MDARVS-DEPT-NBR.                             
           DISPLAY 'PROCESSING NO RULES STYLES FOR DEPARTMENT: '                
                 MDSEAR-DEPT-NBR.                                               
                                                                                
           MOVE 'N' TO PS-END-OF-STYLE-CSR-SW.                                  
           PERFORM 5500-OPEN-NO-BUS-RULES-CSR.                                  
           PERFORM 5510-FETCH-NO-BUS-RULES-CSR                                  
                 UNTIL PS-END-OF-STYLE-CSR.                                     
                                                                                
           PERFORM 5520-CLOSE-NO-BUS-RULES-CSR.                                 
                                                                                
      ******************************************************************        
      * READ BUSINESS GROUP UPDATES INPUT FILE.                                 
      ******************************************************************        
       4000-READ-BUSGP-UPDTS-REC.                                               
                                                                                
           READ BUSGP-UPDTS-FILE INTO HMRD017-BUS-GRP-DESC-RECORD               
               AT END                                                           
                    SET PS-END-OF-BG-UPDATES-RECS TO TRUE                       
               NOT AT END                                                       
                    ADD +1 TO PA-NBR-INPUT-RECORDS-READ                         
           END-READ.                                                            
                                                                                
                                                                                
      ******************************************************************        
      *  OPEN THE BUSINESS GROUP DEPARTMENTS CURSOR                             
      ******************************************************************        
       5000-OPEN-BG-DEPTS-CSR.                                                  
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   OPEN BG_DEPTS_CSR                                            
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5000-OPEN-BG-DEPTS-CSR'                           
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'OPEN ON BUS GROUP DEPTS CURSOR'                   
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5000-OPEN-BG-DEPTS-CSR' TO PV-PARAGRAPH-NAME               
               MOVE 'OPEN CURSOR RETRIES EXCEEDED'                              
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *  FETCH THE BUSINESS RULES CURSOR                                        
      ******************************************************************        
       5010-FETCH-BG-DEPTS-CSR.                                                 
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR SQLCODE = +100                                             
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   FETCH BG_DEPTS_CSR                                           
                   INTO :MDSEAR-DEPT-NBR                                        
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +0                                            
                        ADD +1 TO PA-NBR-BG-DEPTS-PROCESSED                     
                        DISPLAY 'PROCESSING BUSINESS GROUP: '                   
                              MDSEDP-MDSEBG-NBR                                 
                                ' DEPARTMENT:' MDSEAR-DEPT-NBR                  
                   WHEN SQLCODE = +100                                          
                        SET PS-END-OF-BG-DEPTS-CSR TO TRUE                      
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5010-FETCH-BG-DEPTS-CSR'                          
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'FETCH ON BUS GROUP DEPTS CURSOR'                  
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5010-FETCH-BG-DEPTS-CSR' TO PV-PARAGRAPH-NAME              
               MOVE 'FETCH CURSOR RETRIES EXCEEDED'                             
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  CLOSE THE BUSINESS RULES CURSOR                                        
      ******************************************************************        
       5020-CLOSE-BG-DEPTS-CSR.                                                 
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   CLOSE BG_DEPTS_CSR                                           
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5020-CLOSE-BG-DEPTS-CSR'                          
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'CLOSE ON BUS GROUP DEPTS CURSOR'                  
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5020-CLOSE-BG-DEPTS-CSR' TO PV-PARAGRAPH-NAME              
               MOVE 'CLOSE CURSOR RETRIES EXCEEDED'                             
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  OPEN THE BUSINESS RULES CURSOR                                         
      ******************************************************************        
       5100-OPEN-BUS-RULE-CSR.                                                  
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   OPEN BUS_RULE_CSR                                            
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5100-OPEN-BUS-RULE-CSR'                           
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'OPEN ON BUSINESS RULE CURSOR'                     
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5100-OPEN-BUS-RULE-CSR' TO PV-PARAGRAPH-NAME               
               MOVE 'OPEN CURSOR RETRIES EXCEEDED'                              
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *  FETCH THE BUSINESS RULES CURSOR                                        
      ******************************************************************        
       5110-FETCH-BUS-RULE-CSR.                                                 
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR SQLCODE = +100                                             
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   FETCH BUS_RULE_CSR                                           
                   INTO :MDSEAR-MDSELV-CDE                                      
                      , :MDSEAR-MAJ-CL-NBR                                      
                      , :MDSEAR-SUB-CL-NBR                                      
                      , :IMT00022-POS1-VS-CHARTC-CDE                            
                      , :IMT00022-POS2-VS-CHARTC-CDE                            
                      , :IMT00022-POS3-VS-CHARTC-CDE                            
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +0                                            
                        ADD +1 TO PA-NBR-BUS-RULES-PROCESSED                    
                        DISPLAY 'PROCESSING BUSINESS RULE FOR DEPT: '           
                              MDSEAR-DEPT-NBR                                   
                                ' MAJOR CLASS: ' MDSEAR-MAJ-CL-NBR              
                                ' SUB CLASS: ' MDSEAR-SUB-CL-NBR                
                   WHEN SQLCODE = +100                                          
                        SET PS-END-OF-BUS-RULE-CSR TO TRUE                      
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5110-FETCH-BUS-RULE-CSR'                          
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'FETCH ON BUSINESS RULE CURSOR'                    
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5110-FETCH-BUS-RULE-CSR' TO PV-PARAGRAPH-NAME              
               MOVE 'FETCH CURSOR RETRIES EXCEEDED'                             
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  CLOSE THE BUSINESS RULES CURSOR                                        
      ******************************************************************        
       5120-CLOSE-BUS-RULE-CSR.                                                 
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   CLOSE BUS_RULE_CSR                                           
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5120-CLOSE-BUS-RULE-CSR'                          
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'CLOSE ON BUSINESS RULE CURSOR'                    
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5120-CLOSE-BUS-RULE-CSR' TO PV-PARAGRAPH-NAME              
               MOVE 'CLOSE CURSOR RETRIES EXCEEDED'                             
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  OPEN THE STYLES-BY-DEPT CURSOR                                         
      ******************************************************************        
       5200-OPEN-STYLES-BY-DEPT-CSR.                                            
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   OPEN STYLES_BY_DEPT_CSR                                      
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5200-OPEN-STYLES-BY-DEPT-CSR'                     
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'OPEN ON STYLES-BY-DEPT CURSOR'                    
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5200-OPEN-STYLES-BY-DEPT-CSR' TO PV-PARAGRAPH-NAME         
               MOVE 'OPEN CURSOR RETRIES EXCEEDED'                              
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  FETCH THE STYLES FOR THE DEPT-LEVEL BUSINESS RULE BEING                
      *  PROCESSED                                                              
      ******************************************************************        
       5210-FETCH-STYLES-BY-DEPT.                                               
                                                                                
           MOVE MDARVS-LBL-SEQ-NBR      TO PV-PREV-LBL-SEQ-NBR.                 
           MOVE MDARVS-RPT-HIER-SEQ-NBR TO PV-PREV-RPT-HIER-SEQ-NBR.            
           MOVE MDARVS-BDY-STYL-SEQ-NBR TO PV-PREV-BDY-STYL-SEQ-NBR.            
           MOVE MDARVS-SLHTT-SEQ-NBR    TO PV-PREV-SLHTT-SEQ-NBR.               
           MOVE MDARVS-FUNC-SEQ-NBR     TO PV-PREV-FUNC-SEQ-NBR.                
           MOVE MDARVS-GNDR-SEQ-NBR     TO PV-PREV-GNDR-SEQ-NBR.                
           MOVE MDARVS-FBRCN-SEQ-NBR    TO PV-PREV-FBRCN-SEQ-NBR.               
           MOVE MDARVS-PATRN-SEQ-NBR    TO PV-PREV-PATRN-SEQ-NBR.               
W35681     MOVE MDARVS-CTG-SEQ-NBR      TO PV-PREV-CTG-SEQ-NBR.                 
W35681     MOVE MDARVS-MAJ-CTG-SEQ-NBR  TO PV-PREV-MAJ-CTG-SEQ-NBR.             
W35681     MOVE MDARVS-MTRL-SEQ-NBR     TO PV-PREV-MTRL-SEQ-NBR.                
W35681     MOVE MDARVS-ATTR-1-SEQ-NBR   TO PV-PREV-ATTR-1-SEQ-NBR.              
W35681     MOVE MDARVS-ATTR-2-SEQ-NBR   TO PV-PREV-ATTR-2-SEQ-NBR.              
W35681     MOVE MDARVS-NW-SLHTT-SEQ-NBR TO PV-PREV-NW-SLHTT-SEQ-NBR.            
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR SQLCODE = +100                                             
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   FETCH STYLES_BY_DEPT_CSR                                     
                   INTO :MDARVS-SUB-CL-MDSEAR-ID                                
                      , :MDARVS-VS-ID                                           
                      , :MDARVS-LBL-SEQ-NBR                                     
                      , :MDARVS-RPT-HIER-SEQ-NBR                                
                      , :MDARVS-BDY-STYL-SEQ-NBR                                
                      , :MDARVS-SLHTT-SEQ-NBR                                   
                      , :MDARVS-FUNC-SEQ-NBR                                    
                      , :MDARVS-GNDR-SEQ-NBR                                    
                      , :MDARVS-FBRCN-SEQ-NBR                                   
                      , :MDARVS-PATRN-SEQ-NBR                                   
                      , :MDARVS-CUST-INTFC-DESC                                 
W35681                , :MDARVS-CTG-SEQ-NBR                                     
W35681                , :MDARVS-MAJ-CTG-SEQ-NBR                                 
W35681                , :MDARVS-MTRL-SEQ-NBR                                    
W35681                , :MDARVS-ATTR-1-SEQ-NBR                                  
W35681                , :MDARVS-ATTR-2-SEQ-NBR                                  
W35681                , :MDARVS-NW-SLHTT-SEQ-NBR                                
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +0                                            
                        ADD +1 TO PA-NBR-STYLES-PROCESSED                       
                   WHEN SQLCODE = +100                                          
                        SET PS-END-OF-STYLE-CSR TO TRUE                         
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5210-FETCH-STYLES-BY-DEPT'                        
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'FETCH ON STYLES-BY-DEPT CURSOR'                   
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5210-FETCH-STYLES-BY-DEPT' TO PV-PARAGRAPH-NAME            
               MOVE 'FETCH CURSOR RETRIES EXCEEDED'                             
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  CLOSE THE STYLES-BY-DEPT CURSOR                                        
      ******************************************************************        
       5220-CLOSE-STYLES-BY-DEPT-CSR.                                           
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   CLOSE STYLES_BY_DEPT_CSR                                     
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5220-CLOSE-STYLES-BY-DEPT-CSR'                    
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'CLOSE ON STYLES-BY-DEPT CURSOR'                   
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5220-CLOSE-STYLES-BY-DEPT-CSR' TO PV-PARAGRAPH-NAME        
               MOVE 'CLOSE CURSOR RETRIES EXCEEDED'                             
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  OPEN THE STYLES-BY-MCL CURSOR                                          
      ******************************************************************        
       5300-OPEN-STYLES-BY-MCL-CSR.                                             
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   OPEN STYLES_BY_MCL_CSR                                       
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5300-OPEN-STYLES-BY-MCL-CSR'                      
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'OPEN ON STYLES-BY-MCL CURSOR'                     
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5300-OPEN-STYLES-BY-MCL-CSR' TO PV-PARAGRAPH-NAME          
               MOVE 'OPEN CURSOR RETRIES EXCEEDED'                              
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  FETCH THE STYLES FOR THE MAJOR CLASS LEVEL BUSINESS RULE BEING         
      *  PROCESSED                                                              
      ******************************************************************        
       5310-FETCH-STYLES-BY-MCL.                                                
                                                                                
           MOVE MDARVS-LBL-SEQ-NBR      TO PV-PREV-LBL-SEQ-NBR.                 
           MOVE MDARVS-RPT-HIER-SEQ-NBR TO PV-PREV-RPT-HIER-SEQ-NBR.            
           MOVE MDARVS-BDY-STYL-SEQ-NBR TO PV-PREV-BDY-STYL-SEQ-NBR.            
           MOVE MDARVS-SLHTT-SEQ-NBR    TO PV-PREV-SLHTT-SEQ-NBR.               
           MOVE MDARVS-FUNC-SEQ-NBR     TO PV-PREV-FUNC-SEQ-NBR.                
           MOVE MDARVS-GNDR-SEQ-NBR     TO PV-PREV-GNDR-SEQ-NBR.                
           MOVE MDARVS-FBRCN-SEQ-NBR    TO PV-PREV-FBRCN-SEQ-NBR.               
           MOVE MDARVS-PATRN-SEQ-NBR    TO PV-PREV-PATRN-SEQ-NBR.               
W35681     MOVE MDARVS-CTG-SEQ-NBR      TO PV-PREV-CTG-SEQ-NBR.                 
W35681     MOVE MDARVS-MAJ-CTG-SEQ-NBR  TO PV-PREV-MAJ-CTG-SEQ-NBR.             
W35681     MOVE MDARVS-MTRL-SEQ-NBR     TO PV-PREV-MTRL-SEQ-NBR.                
W35681     MOVE MDARVS-ATTR-1-SEQ-NBR   TO PV-PREV-ATTR-1-SEQ-NBR.              
W35681     MOVE MDARVS-ATTR-2-SEQ-NBR   TO PV-PREV-ATTR-2-SEQ-NBR.              
W35681     MOVE MDARVS-NW-SLHTT-SEQ-NBR TO PV-PREV-NW-SLHTT-SEQ-NBR.            
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR SQLCODE = +100                                             
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   FETCH STYLES_BY_MCL_CSR                                      
                   INTO :MDARVS-SUB-CL-MDSEAR-ID                                
                      , :MDARVS-VS-ID                                           
                      , :MDARVS-LBL-SEQ-NBR                                     
                      , :MDARVS-RPT-HIER-SEQ-NBR                                
                      , :MDARVS-BDY-STYL-SEQ-NBR                                
                      , :MDARVS-SLHTT-SEQ-NBR                                   
                      , :MDARVS-FUNC-SEQ-NBR                                    
                      , :MDARVS-GNDR-SEQ-NBR                                    
                      , :MDARVS-FBRCN-SEQ-NBR                                   
                      , :MDARVS-PATRN-SEQ-NBR                                   
                      , :MDARVS-CUST-INTFC-DESC                                 
W35681                , :MDARVS-CTG-SEQ-NBR                                     
W35681                , :MDARVS-MAJ-CTG-SEQ-NBR                                 
W35681                , :MDARVS-MTRL-SEQ-NBR                                    
W35681                , :MDARVS-ATTR-1-SEQ-NBR                                  
W35681                , :MDARVS-ATTR-2-SEQ-NBR                                  
W35681                , :MDARVS-NW-SLHTT-SEQ-NBR                                
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +0                                            
                        ADD +1 TO PA-NBR-STYLES-PROCESSED                       
                   WHEN SQLCODE = +100                                          
                        SET PS-END-OF-STYLE-CSR TO TRUE                         
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5310-FETCH-STYLES-BY-MCL'                         
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'FETCH ON STYLES-BY-MCL CURSOR'                    
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5310-FETCH-STYLES-BY-MCL' TO PV-PARAGRAPH-NAME             
               MOVE 'FETCH CURSOR RETRIES EXCEEDED'                             
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  CLOSE THE STYLES-BY-MCL CURSOR                                         
      ******************************************************************        
       5320-CLOSE-STYLES-BY-MCL-CSR.                                            
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   CLOSE STYLES_BY_MCL_CSR                                      
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5320-CLOSE-STYLES-BY-MCL-CSR'                     
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'CLOSE ON STYLES-BY-MCL CURSOR'                    
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5320-CLOSE-STYLES-BY-MCL-CSR' TO PV-PARAGRAPH-NAME         
               MOVE 'CLOSE CURSOR RETRIES EXCEEDED'                             
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  OPEN THE STYLES-BY-SCL CURSOR                                          
      ******************************************************************        
       5400-OPEN-STYLES-BY-SCL-CSR.                                             
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   OPEN STYLES_BY_SCL_CSR                                       
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5400-OPEN-STYLES-BY-SCL-CSR'                      
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'OPEN ON STYLES-BY-SCL CURSOR'                     
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5400-OPEN-STYLES-BY-SCL-CSR' TO PV-PARAGRAPH-NAME          
               MOVE 'OPEN CURSOR RETRIES EXCEEDED'                              
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  FETCH THE STYLES FOR THE SUBCLASS LEVEL BUSINESS RULE BEING            
      *  PROCESSED                                                              
      ******************************************************************        
       5410-FETCH-STYLES-BY-SCL.                                                
                                                                                
           MOVE MDARVS-LBL-SEQ-NBR      TO PV-PREV-LBL-SEQ-NBR.                 
           MOVE MDARVS-RPT-HIER-SEQ-NBR TO PV-PREV-RPT-HIER-SEQ-NBR.            
           MOVE MDARVS-BDY-STYL-SEQ-NBR TO PV-PREV-BDY-STYL-SEQ-NBR.            
           MOVE MDARVS-SLHTT-SEQ-NBR    TO PV-PREV-SLHTT-SEQ-NBR.               
           MOVE MDARVS-FUNC-SEQ-NBR     TO PV-PREV-FUNC-SEQ-NBR.                
           MOVE MDARVS-GNDR-SEQ-NBR     TO PV-PREV-GNDR-SEQ-NBR.                
           MOVE MDARVS-FBRCN-SEQ-NBR    TO PV-PREV-FBRCN-SEQ-NBR.               
           MOVE MDARVS-PATRN-SEQ-NBR    TO PV-PREV-PATRN-SEQ-NBR.               
W35681     MOVE MDARVS-CTG-SEQ-NBR      TO PV-PREV-CTG-SEQ-NBR.                 
W35681     MOVE MDARVS-MAJ-CTG-SEQ-NBR  TO PV-PREV-MAJ-CTG-SEQ-NBR.             
W35681     MOVE MDARVS-MTRL-SEQ-NBR     TO PV-PREV-MTRL-SEQ-NBR.                
W35681     MOVE MDARVS-ATTR-1-SEQ-NBR   TO PV-PREV-ATTR-1-SEQ-NBR.              
W35681     MOVE MDARVS-ATTR-2-SEQ-NBR   TO PV-PREV-ATTR-2-SEQ-NBR.              
W35681     MOVE MDARVS-NW-SLHTT-SEQ-NBR TO PV-PREV-NW-SLHTT-SEQ-NBR.            
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR SQLCODE = +100                                             
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   FETCH STYLES_BY_SCL_CSR                                      
                   INTO :MDARVS-SUB-CL-MDSEAR-ID                                
                      , :MDARVS-VS-ID                                           
                      , :MDARVS-LBL-SEQ-NBR                                     
                      , :MDARVS-RPT-HIER-SEQ-NBR                                
                      , :MDARVS-BDY-STYL-SEQ-NBR                                
                      , :MDARVS-SLHTT-SEQ-NBR                                   
                      , :MDARVS-FUNC-SEQ-NBR                                    
                      , :MDARVS-GNDR-SEQ-NBR                                    
                      , :MDARVS-FBRCN-SEQ-NBR                                   
                      , :MDARVS-PATRN-SEQ-NBR                                   
                      , :MDARVS-CUST-INTFC-DESC                                 
W35681                , :MDARVS-CTG-SEQ-NBR                                     
W35681                , :MDARVS-MAJ-CTG-SEQ-NBR                                 
W35681                , :MDARVS-MTRL-SEQ-NBR                                    
W35681                , :MDARVS-ATTR-1-SEQ-NBR                                  
W35681                , :MDARVS-ATTR-2-SEQ-NBR                                  
W35681                , :MDARVS-NW-SLHTT-SEQ-NBR                                
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +0                                            
                        ADD +1 TO PA-NBR-STYLES-PROCESSED                       
                   WHEN SQLCODE = +100                                          
                        SET PS-END-OF-STYLE-CSR TO TRUE                         
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5410-FETCH-STYLES-BY-SCL'                         
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'FETCH ON STYLES-BY-SCL CURSOR'                    
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5410-FETCH-STYLES-BY-SCL' TO PV-PARAGRAPH-NAME             
               MOVE 'FETCH CURSOR RETRIES EXCEEDED'                             
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  CLOSE THE STYLES-BY-SCL CURSOR                                         
      ******************************************************************        
       5420-CLOSE-STYLES-BY-SCL-CSR.                                            
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   CLOSE STYLES_BY_SCL_CSR                                      
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5420-CLOSE-STYLES-BY-SCL-CSR'                     
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'CLOSE ON STYLES-BY-SCL CURSOR'                    
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5420-CLOSE-STYLES-BY-SCL-CSR' TO PV-PARAGRAPH-NAME         
               MOVE 'CLOSE CURSOR RETRIES EXCEEDED'                             
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  OPEN THE NO BUSINESS RULES CURSOR                                      
      ******************************************************************        
       5500-OPEN-NO-BUS-RULES-CSR.                                              
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   OPEN NO_BUS_RULES_CSR                                        
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5500-OPEN-NO-BUS-RULES-CSR'                       
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'OPEN ON STYLES-BY-SCL CURSOR'                     
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5500-OPEN-NO-BUS-RULES-CSR' TO PV-PARAGRAPH-NAME           
               MOVE 'OPEN CURSOR RETRIES EXCEEDED'                              
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  FETCH THE STYLES OF THE NO BUSINESS RULES CURSOR                       
      ******************************************************************        
       5510-FETCH-NO-BUS-RULES-CSR.                                             
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR SQLCODE = +100                                             
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   FETCH NO_BUS_RULES_CSR                                       
                   INTO :MDARVS-SUB-CL-MDSEAR-ID                                
                      , :MDARVS-VS-ID                                           
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +0                                            
                        ADD +1 TO PA-NBR-STYLES-PROCESSED                       
                        PERFORM 5700-UPDATE-CUST-DESC                           
                        PERFORM 7700-COMMIT-PROCESSING                          
                   WHEN SQLCODE = +100                                          
                        SET PS-END-OF-STYLE-CSR TO TRUE                         
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5510-FETCH-NO-BUS-RULES-CSR'                      
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'FETCH ON NO BUSINESS RULES CURSOR'                
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5510-FETCH-NO-BUS-RULES-CSR' TO PV-PARAGRAPH-NAME          
               MOVE 'FETCH CURSOR RETRIES EXCEEDED'                             
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  CLOSE THE NO BUSINESS RULES CURSOR                                     
      ******************************************************************        
       5520-CLOSE-NO-BUS-RULES-CSR.                                             
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                   CLOSE NO_BUS_RULES_CSR                                       
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        CONTINUE                                                
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                        MOVE '5520-CLOSE-NO-BUS-RULES-CSR'                      
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'CLOSE ON NO BUSINESS RULES CURSOR'                
                              TO PV-DB2-OPERATION-ATTEMPTED                     
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5520-CLOSE-NO-BUS-RULES-CSR' TO PV-PARAGRAPH-NAME          
               MOVE 'CLOSE CURSOR RETRIES EXCEEDED'                             
                              TO PV-DB2-OPERATION-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  FINISH GETTING THE ITEM ATTRIBUTE FOR THIS STYLE                       
      ******************************************************************        
       5600-GET-ITEM-ATTR-TVSCHVL.                                              
                                                                                
           MOVE SPACES TO VSCHVL-SHRT-CHARTC-DESC.                              
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR SQLCODE = +100                                             
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                  SELECT SHRT_CHARTC_DESC                                       
                    INTO :VSCHVL-SHRT-CHARTC-DESC                               
                    FROM TVSCHVL                                                
                   WHERE CHARTC_CDE     = :VSCHVL-CHARTC-CDE                    
                     AND CHARTC_SEQ_NBR = :VSCHVL-CHARTC-SEQ-NBR                
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +0                                            
                        CONTINUE                                                
                   WHEN SQLCODE = +100                                          
                        MOVE SPACES TO VSCHVL-SHRT-CHARTC-DESC                  
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        ADD 1        TO PV-RETRY-COUNT                          
                   WHEN OTHER                                                   
                        MOVE '5600-GET-ITEM-ATTR-TVSCHVL'                       
                                     TO PV-PARAGRAPH-NAME                       
                        MOVE 'SELECT ON TVSCHVL'                                
                                     TO PV-DB2-OPERATION-ATTEMPTED              
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5600-GET-ITEM-ATTR-TVSCHVL'                                
                                     TO PV-PARAGRAPH-NAME                       
               MOVE 'SELECT ON TVSCHVL'                                         
                                     TO PV-DB2-OPERATION-ATTEMPTED              
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
           IF  VSCHVL-SHRT-CHARTC-DESC = SPACES                                 
           OR  VSCHVL-SHRT-CHARTC-DESC = 'NONE'                                 
           OR  VSCHVL-SHRT-CHARTC-DESC = 'OTHER'                                
               MOVE SPACES TO PV-SHORT-DESC                                     
           ELSE                                                                 
               MOVE VSCHVL-SHRT-CHARTC-DESC TO PV-SHORT-DESC                    
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  UPDATE THE CUSTOMER INTERFACE DESCRIPTION ON TMDARVS                   
      ******************************************************************        
       5700-UPDATE-CUST-DESC.                                                   
                                                                                
           MOVE PV-CUST-DESC-EDITED TO MDARVS-CUST-INTFC-DESC.                  
                                                                                
           PERFORM  WITH TEST AFTER                                             
                   UNTIL SQLCODE = +0                                           
                      OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                
                                                                                
               EXEC SQL                                                         
                   UPDATE TMDARVS                                               
                      SET CUST_INTFC_DESC  = :MDARVS-CUST-INTFC-DESC            
                    WHERE SUB_CL_MDSEAR_ID = :MDARVS-SUB-CL-MDSEAR-ID           
                      AND VS_ID            = :MDARVS-VS-ID                      
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +0                                            
                        ADD +1 TO PA-NBR-TMDARVS-UPDATES                        
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        ADD 1          TO PV-RETRY-COUNT                        
                   WHEN OTHER                                                   
                        MOVE '5700-UPDATE-CUST-DESC'                            
                                       TO PV-PARAGRAPH-NAME                     
                        MOVE 'UPDATE CUST DESC ON TMDARVS'                      
                                       TO PV-DB2-OPERATION-ATTEMPTED            
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '5700-UPDATE-CUST-DESC'                                     
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'UPDATE CUST DESC ON TMDARVS'                               
                                       TO PV-DB2-OPERATION-ATTEMPTED            
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      * 7300-GET-COMMIT-TIMESTAMP.                                     *        
      * PROCESSES: GET THE COMMIT TIMESTAMP FROM THE CHECKPOINT        *        
      *            CONTROL TABLE                                       *        
      ******************************************************************        
       7300-GET-COMMIT-TIMESTAMP.                                               
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                 SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)           
                   INTO :PV-COMMIT-TIMESTAMP                                    
                   FROM TCKRSTCNTL                                              
                  WHERE JOB_NAME  = :PC-JOB-NAME                                
                    AND PLAN_NAME = :PC-PROGRAM-NAME                            
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +0                                            
                        CONTINUE                                                
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        ADD 1        TO PV-RETRY-COUNT                          
                   WHEN OTHER                                                   
                        MOVE '7300-GET-COMMIT-TIMESTAMP'                        
                                     TO PV-PARAGRAPH-NAME                       
                        MOVE 'SELECT ON TCKRSTCNTL'                             
                                     TO PV-DB2-OPERATION-ATTEMPTED              
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '7300-GET-COMMIT-TIMESTAMP'                                 
                                     TO PV-PARAGRAPH-NAME                       
               MOVE 'SELECT ON TCKRSTCNTL'                                      
                                     TO PV-DB2-OPERATION-ATTEMPTED              
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
      *                                                                         
      ******************************************************************        
      * 7400-INIT-CHECKPOINT-SELECT                                    *        
      * PROCESSES: SELECTS FROM THE CHECKPOINT RESTART CONTROL TABLE   *        
      *            IF WE ARE IN A RESTART CONDITION.                   *        
      ******************************************************************        
       7400-INIT-CHECKPOINT-SELECT.                                             
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                 SELECT  CKPT_STAT_CODE                                         
                        ,CKPT_FRQNCY_QTY                                        
                   INTO  :TCKRSTCNTL-CKPT-STAT-CODE                             
                        ,:TCKRSTCNTL-CKPT-FRQNCY-QTY                            
                   FROM  TCKRSTCNTL                                             
                  WHERE  JOB_NAME  = :PC-JOB-NAME                               
                    AND  PLAN_NAME = :PC-PROGRAM-NAME                           
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +0                                            
                        CONTINUE                                                
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        ADD 1        TO PV-RETRY-COUNT                          
                   WHEN OTHER                                                   
                        MOVE '7400-INIT-CHECKPOINT-SELECT'                      
                                     TO PV-PARAGRAPH-NAME                       
                        MOVE 'SELECT ON TCKRSTCNTL'                             
                                     TO PV-DB2-OPERATION-ATTEMPTED              
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '7400-INIT-CHECKPOINT-SELECT'                               
                                     TO PV-PARAGRAPH-NAME                       
               MOVE 'SELECT ON TCKRSTCNTL'                                      
                                     TO PV-DB2-OPERATION-ATTEMPTED              
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
      *                                                                         
      ******************************************************************        
      * 7500-SELECT-RESTART-INFO                                       *        
      * PROCESSES: SELECTS FROM THE CHECKPOINT RESTART INFORMATION     *        
      *            TABLE TO OBTAIN THE PROGRAMS SAVED VARIABLES.       *        
      ******************************************************************        
       7500-SELECT-RESTART-INFO.                                                
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                 SELECT WORK_STRG_DESC                                          
                   INTO :TCKRSTINF-WORK-STRG-DESC                               
                   FROM TCKRSTINF                                               
                  WHERE JOB_NAME  = :PC-JOB-NAME                                
                    AND PLAN_NAME = :PC-PROGRAM-NAME                            
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +0                                            
                        CONTINUE                                                
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        ADD 1        TO PV-RETRY-COUNT                          
                   WHEN OTHER                                                   
                        MOVE '7500-SELECT-RESTART-INFO'                         
                                     TO PV-PARAGRAPH-NAME                       
                        MOVE 'SELECT ON TCKRSTINF'                              
                                     TO PV-DB2-OPERATION-ATTEMPTED              
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '7500-SELECT-RESTART-INFO'                                  
                                     TO PV-PARAGRAPH-NAME                       
               MOVE 'SELECT ON TCKRSTINF'                                       
                                     TO PV-DB2-OPERATION-ATTEMPTED              
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * 7600-SET-CURRENT-TIMESTAMP.                                    *        
      * PROCESSES: GET THE CURRENT TIMESTAMP FROM DB2.                 *        
      ******************************************************************        
       7600-SET-CURRENT-TIMESTAMP.                                              
                                                                                
           EXEC SQL                                                             
                SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP                   
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = 0                                                       
               CONTINUE                                                         
           ELSE                                                                 
               MOVE '7600-SET-CURRENT-TIMESTAMP' TO PV-PARAGRAPH-NAME           
               MOVE 'SET CURRENT TIMESTAMP'                                     
                     TO PV-DB2-OPERATION-ATTEMPTED                              
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
      *                                                                         
      ******************************************************************        
      * 7700-COMMIT-PROCESSING.                                        *        
      * PROCESSES: CHECK IF WE NEED TO TAKE A COMMIT.                  *        
      *          PREPARE CHECKPOINT RECORD FOR UPDATE OF WORK_STRG_DESC*        
      ******************************************************************        
       7700-COMMIT-PROCESSING.                                                  
           MOVE '7700-COMMIT-PROCESSING'      TO PV-PARAGRAPH-NAME.             
                                                                                
           PERFORM 7600-SET-CURRENT-TIMESTAMP.                                  
                                                                                
      * PREPARE COMMIT RECORD FOR UPDATE                                        
           IF PV-CURRENT-TIMESTAMP > PV-COMMIT-TIMESTAMP                        
               MOVE HM017-BUS-GRP-BUS-GP-NBR  TO CR-BUS-GP-NBR                  
               MOVE HM017-BUS-GRP-BUS-GP-SHRT-DESC                              
                                              TO CR-BUS-GP-SHRT-DESC            
               MOVE HM017-BUS-GRP-DEPT        TO CR-DEPT-NBR                    
               MOVE PA-NBR-INPUT-RECORDS-READ TO CR-INPUT-READ-COUNT            
               MOVE PA-NBR-BG-DEPTS-PROCESSED TO CR-BG-DEPTS-PROCESSED          
               MOVE PA-NBR-BUS-RULES-PROCESSED                                  
                                              TO CR-BUS-RULES-PROCESSED         
               MOVE PA-NBR-STYLES-PROCESSED   TO CR-STYLES-PROCESSED            
               MOVE PA-NBR-TMDARVS-UPDATES    TO CR-TMDARVS-UPDATES             
               MOVE PA-NBR-COMMITS-TAKEN      TO CR-COMMITS-TAKEN               
      *        MOVE COMMIT INFO TO WORKING STORAGE ROW                          
               MOVE CR-CHECKPOINT-RESTART-AREA TO                               
                                             TCKRSTINF-WORK-STRG-DESC           
               IF PS-FIRST-COMMIT                                               
                   MOVE '9' TO TCKRSTCNTL-CKPT-STAT-CODE                        
                   PERFORM 7900-UPDATE-CHECKPOINT-STATUS                        
                   MOVE 'N' TO PS-FIRST-COMMIT-SW                               
               END-IF                                                           
               PERFORM 7800-COMMIT-CHANGES                                      
               PERFORM 7300-GET-COMMIT-TIMESTAMP                                
           END-IF.                                                              
      *                                                                         
      *                                                                         
      ******************************************************************        
      * 7800-COMMIT-CHANGES.                                                    
      * PROCESSES: PERFORM UPDATE OF CHECKPOINT INFORMATION TABLE.              
      *            TAKE A COMMIT.                                               
      *  ==> PERFORMED FROM: 7700-COMMIT-PROCESSING, 9000-EOJ-ROUTINE           
      ******************************************************************        
       7800-COMMIT-CHANGES.                                                     
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                 UPDATE TCKRSTINF                                               
                    SET WORK_STRG_DESC = :TCKRSTINF-WORK-STRG-DESC              
                  WHERE JOB_NAME  = :PC-JOB-NAME                                
                    AND PLAN_NAME = :PC-PROGRAM-NAME                            
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +0                                            
                        CONTINUE                                                
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        ADD 1        TO PV-RETRY-COUNT                          
                   WHEN OTHER                                                   
                        MOVE '7800-COMMIT-CHANGES'                              
                                     TO PV-PARAGRAPH-NAME                       
                        MOVE 'UPDATE TCKRSTINF'                                 
                                     TO PV-DB2-OPERATION-ATTEMPTED              
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '7800-COMMIT-CHANGES'                                       
                                     TO PV-PARAGRAPH-NAME                       
               MOVE 'UPDATE TCKRSTINF'                                          
                                     TO PV-DB2-OPERATION-ATTEMPTED              
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
           EXEC SQL                                                             
               COMMIT                                                           
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = 0                                                       
               ADD +1 TO PA-NBR-COMMITS-TAKEN                                   
           ELSE                                                                 
               MOVE '7800-COMMIT-CHANGES' TO PV-PARAGRAPH-NAME                  
               MOVE 'COMMIT' TO PV-DB2-OPERATION-ATTEMPTED                      
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      * 7900-UPDATE-CHECKPOINT-STATUS                                           
      * PROCESSES: UPDATES THE STATUS ON THE CHECKPOINT CONTROL TABLE           
      ******************************************************************        
       7900-UPDATE-CHECKPOINT-STATUS.                                           
                                                                                
           PERFORM  WITH TEST AFTER                                             
             VARYING PV-RETRY-COUNT FROM 1 BY 1                                 
               UNTIL SQLCODE = +0                                               
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                    
                                                                                
               EXEC SQL                                                         
                 UPDATE TCKRSTCNTL                                              
                    SET CKPT_STAT_CODE = :TCKRSTCNTL-CKPT-STAT-CODE             
                  WHERE JOB_NAME  = :PC-JOB-NAME                                
                    AND PLAN_NAME = :PC-PROGRAM-NAME                            
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +0                                            
                        CONTINUE                                                
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -904                                          
                        ADD 1        TO PV-RETRY-COUNT                          
                   WHEN OTHER                                                   
                        MOVE '7900-UPDATE-CHECKPOINT-STATUS'                    
                                     TO PV-PARAGRAPH-NAME                       
                        MOVE 'UPDATE TCKRSTCNTL'                                
                                     TO PV-DB2-OPERATION-ATTEMPTED              
                        PERFORM 9999-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                          
               MOVE '7900-UPDATE-CHECKPOINT-STATUS'                             
                                     TO PV-PARAGRAPH-NAME                       
               MOVE 'UPDATE TCKRSTCNTL'                                         
                                     TO PV-DB2-OPERATION-ATTEMPTED              
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *  PERFORMS END-OF-JOB PROCESSING                                         
      ******************************************************************        
                                                                                
       9000-EOJ-ROUTINE.                                                        
                                                                                
           MOVE '0' TO TCKRSTCNTL-CKPT-STAT-CODE.                               
           PERFORM 7900-UPDATE-CHECKPOINT-STATUS.                               
                                                                                
           MOVE HM017-BUS-GRP-BUS-GP-NBR   TO CR-BUS-GP-NBR.                    
           MOVE HM017-BUS-GRP-BUS-GP-SHRT-DESC                                  
                                           TO CR-BUS-GP-SHRT-DESC.              
           MOVE HM017-BUS-GRP-DEPT         TO CR-DEPT-NBR.                      
           MOVE PA-NBR-INPUT-RECORDS-READ  TO CR-INPUT-READ-COUNT.              
           MOVE PA-NBR-BG-DEPTS-PROCESSED  TO CR-BG-DEPTS-PROCESSED.            
           MOVE PA-NBR-BUS-RULES-PROCESSED TO CR-BUS-RULES-PROCESSED.           
           MOVE PA-NBR-STYLES-PROCESSED    TO CR-STYLES-PROCESSED.              
           MOVE PA-NBR-TMDARVS-UPDATES     TO CR-TMDARVS-UPDATES.               
           MOVE PA-NBR-COMMITS-TAKEN       TO CR-COMMITS-TAKEN.                 
           ADD 1 TO CR-COMMITS-TAKEN.                                           
      *    MOVE COMMIT INFO TO WORKING STORAGE ROW                              
           MOVE CR-CHECKPOINT-RESTART-AREA TO TCKRSTINF-WORK-STRG-DESC          
           PERFORM 7800-COMMIT-CHANGES.                                         
                                                                                
           CLOSE BUSGP-UPDTS-FILE.                                              
                                                                                
           PERFORM 9300-DISPLAY-TOTALS.                                         
                                                                                
                                                                                
      ******************************************************************        
      *  DISPLAYS PROGRAM TOTALS                                                
      ******************************************************************        
                                                                                
       9300-DISPLAY-TOTALS.                                                     
                                                                                
           DISPLAY SPACES.                                                      
           DISPLAY '*********************************************'.             
           DISPLAY '***** TOTAL COUNTS FOR PROGRAM IMKUP067 *****'.             
           DISPLAY '*********************************************'.             
                                                                                
           MOVE PA-NBR-INPUT-RECORDS-READ    TO PV-DISPLAY-COUNT.               
           DISPLAY 'INPUT RECORDS READ             = '                          
                                                     PV-DISPLAY-COUNT.          
                                                                                
           MOVE PA-NBR-BG-DEPTS-PROCESSED    TO PV-DISPLAY-COUNT.               
           DISPLAY 'BUSINESS GROUP DEPTS PROCESSED = '                          
                                                     PV-DISPLAY-COUNT.          
                                                                                
           MOVE PA-NBR-BUS-RULES-PROCESSED   TO PV-DISPLAY-COUNT.               
           DISPLAY 'TOT NBR OF BUS RULES PROCESSED = '                          
                                                     PV-DISPLAY-COUNT.          
                                                                                
           MOVE PA-NBR-STYLES-PROCESSED      TO PV-DISPLAY-COUNT.               
           DISPLAY 'TOT NBR OF STYLES PROCESSED    = '                          
                                                     PV-DISPLAY-COUNT.          
                                                                                
           MOVE PA-NBR-TMDARVS-UPDATES       TO PV-DISPLAY-COUNT.               
           DISPLAY 'TOT NBR OF UPDATES TO TMDARVS  = '                          
                                                     PV-DISPLAY-COUNT.          
                                                                                
           MOVE PA-NBR-COMMITS-TAKEN         TO PV-DISPLAY-COUNT.               
           DISPLAY 'TOT NBR OF COMMITS             = '                          
                                                     PV-DISPLAY-COUNT.          
           DISPLAY SPACES.                                                      
                                                                                
      ******************************************************************        
      *  PERFORMS ABEND PROCESSING FOR SQL ERRORS.                              
      ******************************************************************        
                                                                                
       9999-SQL-ABEND.                                                          
                                                                                
           PERFORM 9300-DISPLAY-TOTALS.                                         
           DISPLAY ' '.                                                         
           DISPLAY '9999-SQL-ABEND'                                             
           DISPLAY '** ABEND     **'.                                           
           DISPLAY '** PROGRAM   ** = IMKUP067'.                                
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.                      
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.             
           MOVE SQLCODE TO PV-DISPLAY-SQLCODE.                                  
           DISPLAY '** SQLCODE   ** = ' PV-DISPLAY-SQLCODE.                     
                                                                                
      ******************************************************************        
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-            
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE                 
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE             
      * FORMAT.                                                                 
      ******************************************************************        
           COPY DPPD004.                                                        
                                                                                
           MOVE +4013 TO ABEND-CODE.                                            
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
