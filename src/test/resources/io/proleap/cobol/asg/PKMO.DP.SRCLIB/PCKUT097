000100 TITLE 'EXTRACT HANGING PACKSLIP DATA'.                           00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.    PCKUT097.                                         00030000
000400 AUTHOR.        JEAN KURK.                                        00040000
000500 DATE-WRITTEN.  OCTOBER, 2011.                                    00050000
000600                                                                  00060000
000700*THIS PROGRAM WILL EXTRACT DATA FOR HANGING PACKSLIPS.            00070000
000710*THIS RECORDS ARE TRAILER LEVEL RECORDS.                          00071014
000720*THIS DATA WILL BE ADDED TO THE INBOUND CARTON FORECAST REPORTS.  00072015
000730*                                                                 00073015
000740***************************************************************** 00074015
000741*  CHANGE LOG.                                                    00074115
000742*  DATE         CHANGED BY      DESC                              00074215
000743*  -----------  -------------- ---------------------------------- 00074315
000744*  04/03/2012   B. ROCKWELL    ADD DATE PARAMETER LOOKUPS.        00074415
000745*                              CREATE NEW PCRD070 OUTPUT FILE.    00074515
000746*                              PROJ ID:  3347A                    00074615
000747*                              WR/IR#:   WR40796                  00074715
000748***************************************************************** 00074815
000749 ENVIRONMENT DIVISION.                                            00074915
000750 INPUT-OUTPUT SECTION.                                            00075015
000760                                                                  00076015
000770 FILE-CONTROL.                                                    00077015
000780     SELECT PKSL-EXTRACT-FILE       ASSIGN TO OUT01.              00078015
000790                                                                  00079015
000800     SELECT PKSL-REPORT-FILE        ASSIGN TO OUT02.              00080000
000810                                                                  00081000
000820 DATA DIVISION.                                                   00082000
000830 FILE SECTION.                                                    00083000
000840                                                                  00084000
000850 FD  PKSL-EXTRACT-FILE                                            00085000
000860     RECORDING MODE IS F                                          00086000
000870     LABEL RECORDS ARE STANDARD                                   00087000
000880     BLOCK CONTAINS 0 RECORDS.                                    00088000
000890                                                                  00089000
000900 01  PKSL-EXTRACT-RECORD              PIC X(400).                 00090000
001000                                                                  00100000
001100 FD  PKSL-REPORT-FILE                                             00110000
001200     RECORDING MODE IS F                                          00120000
001300     LABEL RECORDS ARE STANDARD                                   00130000
001400     BLOCK CONTAINS 0 RECORDS.                                    00140000
001500                                                                  00150000
001600 01  PKSL-REPORT-RECORD               PIC X(200).                 00160000
001700                                                                  00170000
001800 WORKING-STORAGE SECTION.                                         00180000
001900                                                                  00190000
002000 01  WS-RESND-CODE                    PIC S9(04)   VALUE ZERO.    00200000
002100                                                                  00210000
002200 01  WS-PROGRAM-SWITCHES.                                         00220000
002300     05  WS-END-CSR1-SW               PIC X(1)   VALUE 'N'.       00230000
002400         88  WS-END-CSR1                         VALUE 'Y'.       00240000
002500     05  WS-END-CSR2-SW               PIC X(1)   VALUE 'N'.       00250000
002600         88  WS-END-CSR2                         VALUE 'Y'.       00260000
002700     05  WS-END-PO-CSR-SW             PIC X(1)   VALUE 'N'.       00270000
002800         88  WS-END-PO-CSR                       VALUE 'Y'.       00280000
002900         88  WS-END-PO-CSR-NO                    VALUE 'N'.       00290000
003000                                                                  00300000
003100 01  CC-CONTROL-CARD-PARAMETERS.                                  00310000
003200      05 CC-DC-NBR                      PIC 9(04).                00320000
003300      05 FILLER                         PIC X(76) VALUE SPACE.    00330000
003400                                                                  00340000
003500 01  DK-DATABASE-KEYS.                                            00350000
003600      05 DK-TRIP-ID                     PIC  S9(9) COMP.          00360000
003700      05 DK-PO-NBR                      PIC  S9(9) COMP.          00370000
003800      05 DK-REC-SEQ-NBR                 PIC  S9(9) COMP.          00380000
003900      05 DK-SHIPT-ID                    PIC  S9(9) COMP.          00390000
004000      05 DK-SEQ-NBR                     PIC  S9(4) COMP.          00400000
004100      05 DK-OPER-UNT-ID                 PIC  S9(4) COMP.          00410000
004200      05 DK-CRE-TMST                    PIC  X(26).               00420000
004300                                                                  00430000
004400 01  WS-PROGRAM-VARIABLES.                                        00440000
004500     05  WS-SQLCODE                   PIC 9(9)    VALUE ZERO.     00450000
004600     05  WS-DISPLAY-NUMBER            PIC 9999999999.             00460000
004700     05  WS-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            00470000
004800     05  WS-FETCH-CNT1                PIC S9(9)   COMP-3          00480000
004900                                                  VALUE ZEROS.    00490000
005000     05  WS-FETCH-CNT2                PIC S9(9)   COMP-3          00500000
005100                                                  VALUE ZEROS.    00510000
005200     05  WS-FETCH-PO-CNT              PIC S9(9)   COMP-3          00520000
005300                                                  VALUE ZEROS.    00530000
005400     05  WS-WRITE-COUNT1              PIC S9(9)   COMP-3          00540000
005500                                                  VALUE ZEROS.    00550000
005600     05  WS-SHIPT-UNT-ID-CNT          PIC S9(09) COMP-3.          00560000
005700     05  WS-UNIT-CNT                  PIC S9(9)  COMP-3 VALUE 0.  00570000
005800     05  WS-CTN-CNT                   PIC S9(9)  COMP-3 VALUE 0.  00580000
005900     05  WS-SSCC-CNT                  PIC S9(9)  COMP-3 VALUE 0.  00590000
006000     05  WS-MATCH-CNT                 PIC S9(9)  COMP-3 VALUE 0.  00600000
006100     05  WS-UNMATCH-CNT               PIC S9(9)  COMP-3 VALUE 0.  00610000
006200                                                                  00620000
006300 01  WS-DC-COUNT-TABLE.                                           00630000
006400     05  WS-DC-ENTRY                  OCCURS 20 TIMES             00640000
006500                                      INDEXED BY WS-DC-IDX.       00650000
006600         10  WS-DC-NBR                PIC ZZ99.                   00660000
006700         10  WS-DC-COUNTER            PIC S9(9)   COMP-3          00670000
006800                                                  VALUE ZEROS.    00680000
006900 01  PV-PROGRAM-VARIABLES.                                        00690000
007000     05  PV-VEH-NBR-NULL              PIC S9(04) COMP VALUE 0.    00700000
007100     05  PV-VER-QTY-NULL              PIC S9(04) VALUE +0         00710000
007200                                                 COMP SYNC.       00720000
007300     05  PV-ITEM-QTY                  PIC S9(09) COMP VALUE 0.    00730000
007400     05  PV-CARTON-QTY                PIC S9(09) COMP VALUE 0.    00740000
007500     05  PV-DISPLAY-TRIP              PIC 9(09).                  00750000
007600     05  PV-DISPLAY-PO                PIC 9(09).                  00760000
007700     05  PV-IBFRCS-PARAM              PIC S9(9) COMP.             00770000
007701     05  PV-FILTER-NO-SSCC            PIC S9(9) COMP.             00770100
007702     05  PV-FILTER-SSCC               PIC S9(9) COMP.             00770200
007703     05  PV-MATCHED-ITEMS             PIC S9(9) VALUE ZERO        00770300
007704                                                COMP.             00770400
007705     05  PV-UNMATCHED-ITEMS           PIC S9(9) VALUE ZERO        00770500
007706                                                COMP.             00770600
007707     05  PV-SSCC-CNT                  PIC S9(9) VALUE ZERO        00770700
007708                                                COMP.             00770800
007709     05  PV-UNMATCHED-IND             PIC S9(4) VALUE ZERO        00770900
007710                                                COMP.             00771000
007720     05  PV-MATCHED-IND               PIC S9(4) VALUE ZERO        00772000
007721                                                COMP.             00772100
007722     05  PV-SSCC-IND                  PIC S9(4) VALUE ZERO        00772200
007723                                                COMP.             00772300
007724     05  PV-INTEGER                  PIC  9(08).                  00772400
007725     05  PV-FUTURE-DATE              PIC  9(08).                  00772500
007727     05  PV-CURRENT-DATE-DATA.                                    00772700
007728         10  PV-CURRENT-DATE.                                     00772800
007729             15  PV-CURRENT-DATE-YEAR    PIC  9(04).              00772900
007730             15  PV-CURRENT-DATE-MONTH   PIC  9(02).              00773000
007731             15  PV-CURRENT-DATE-DAY     PIC  9(02).              00773100
007732         10  FILLER                      PIC  X(12).              00773200
007733     05  PV-PKSLP-TMST                   PIC  X(26).              00773300
007734     05  PV-PKSLP-TMST-R REDEFINES PV-PKSLP-TMST.                 00773400
007736         10  PV-PKSLP-YYYY               PIC  X(04).              00773600
007737         10  FILLER                      PIC  X(01).              00773700
007738         10  PV-PKSLP-MM                 PIC  X(02).              00773800
007740         10  FILLER                      PIC  X(01).              00774000
007741         10  PV-PKSLP-DD                 PIC  X(02).              00774100
007742         10  FILLER                      PIC  X(16).              00774200
007743     05  PV-PKSLIP-DATE              PIC  9(08).                  00774300
007744     05  PV-PKSLIP-DATE-R REDEFINES PV-PKSLIP-DATE.               00774400
007745         10  PV-PKSLIP-DATE-YYYY     PIC  9(04).                  00774500
007746         10  PV-PKSLIP-DATE-MM       PIC  9(02).                  00774600
007747         10  PV-PKSLIP-DATE-DD       PIC  9(02).                  00774700
007748                                                                  00774800
007749 01  PC-PROGRAM-CONSTANTS.                                        00774900
007750     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'PCKUT097'.00775000
007751 01  WS-ABEND-FIELDS.                                             00775100
007752     05  WS-ABEND-CODE                PIC S9(04)   VALUE ZERO.    00775200
007753     05  WS-ABEND-PROGRAM             PIC X(8)   VALUE 'PCKUT097'.00775300
007754     05  WS-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00775400
007755     05  WS-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00775500
007756     05  WS-ABEND-STRUCTURE-1         PIC X(15)  VALUE SPACES.    00775600
007757     05  WS-ABEND-STRUCTURE-2         PIC X(15)  VALUE SPACES.    00775700
007758     05  WS-ABEND-STRUCTURE-3         PIC X(15)  VALUE SPACES.    00775800
007759     05  WS-ABEND-STATUS              PIC XX     VALUE SPACES.    00775900
007760     05  WS-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00776000
007770     05  WS-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00777000
007780     05  WS-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00778000
007790     05  WS-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    00779000
007800                                                                  00780000
007900*    EXPORT EXTRACT FILE LAYOUT                                   00790000
008000     COPY PCRD068.                                                00800000
008100                                                                  00810000
008200*    REPORT FILE LAYOUT                                           00820000
008300     COPY PCRD070.                                                00830000
008400                                                                  00840000
008500*    DCLGEN FOR THE PARAMETER TABLE                               00850000
008600     EXEC SQL                                                     00860000
008700         INCLUDE TKRPRPM                                          00870000
008800     END-EXEC.                                                    00880000
008900                                                                  00890000
009000*    DCLGEN FOR SU APPLICATION ID INBOUND VEHICLE TRIP TABLE      00900000
009100     EXEC SQL                                                     00910000
009200         INCLUDE TVHTRIP                                          00920000
009300     END-EXEC.                                                    00930000
009400                                                                  00940000
009500*    DCLGEN FOR TPURCHS                                           00950000
009600     EXEC SQL                                                     00960000
009700         INCLUDE TPURCHS                                          00970000
009800     END-EXEC.                                                    00980000
009900                                                                  00990000
010000*    DCLGEN FOR TINPKSU                                           01000000
010100     EXEC SQL                                                     01010000
010110         INCLUDE TINPKSU                                          01011000
010120     END-EXEC.                                                    01012000
010130                                                                  01013000
010140*    DCLGEN FOR TENTNME                                           01014000
010150     EXEC SQL                                                     01015000
010160         INCLUDE TENTNME                                          01016000
010170     END-EXEC.                                                    01017000
010180                                                                  01018000
010190*    DCLGEN FOR SU APPLICATION ID TRIP STATUS TABLE               01019000
010191     EXEC SQL                                                     01019100
010192         INCLUDE TTRIPST                                          01019200
010193     END-EXEC.                                                    01019300
010194                                                                  01019400
010195*    DCLGEN FOR SU APPLICATION ID TRIP STATUS TYPE TABLE          01019500
010196     EXEC SQL                                                     01019600
010197         INCLUDE TTRSTYP                                          01019700
010198     END-EXEC.                                                    01019800
010199                                                                  01019900
010200*    DCLGEN FOR XL APPLICATION ID XLT_LOC TABLE                   01020000
010300     EXEC SQL                                                     01030000
010400         INCLUDE XLT00010                                         01040000
010500     END-EXEC.                                                    01050000
010600                                                                  01060000
010700*    DCLGEN FOR TPKSLIP TABLE                                     01070000
010800     EXEC SQL                                                     01080000
010900         INCLUDE TPKSLIP                                          01090000
011000     END-EXEC.                                                    01100000
011100                                                                  01110000
011200*    DCLGEN FOR TPKITEM TABLE                                     01120000
011300     EXEC SQL                                                     01130000
011400         INCLUDE TPKITEM                                          01140000
011500     END-EXEC.                                                    01150000
011600                                                                  01160000
011700*    DCLGEN FOR TUNPKSL TABLE                                     01170000
011800     EXEC SQL                                                     01180000
011900         INCLUDE TUNPKSL                                          01190000
012000     END-EXEC.                                                    01200000
012100                                                                  01210000
012110*    DCLGEN FOR TSHIPMT TABLE                                     01211000
012120     EXEC SQL                                                     01212000
012130         INCLUDE TSHIPMT                                          01213000
012140     END-EXEC.                                                    01214000
012150                                                                  01215000
012160*    DCLGEN FOR TSHPTPO TABLE                                     01216000
012170     EXEC SQL                                                     01217000
012180         INCLUDE TSHPTPO                                          01218000
012190     END-EXEC.                                                    01219000
012200                                                                  01220000
012300*    DCLGEN FOR PROCESS FILE TABLE                                01230000
012400     EXEC SQL                                                     01240000
012500         INCLUDE SUT00113                                         01250000
012600     END-EXEC.                                                    01260000
012700                                                                  01270000
012800* CURSOR FOR TYPE 1 HANGING PACKSLIP - MISSING TRAILER            01280000
012900     EXEC SQL                                                     01290000
013000         DECLARE HNG-PKSL-1 CURSOR FOR                            01300000
013100         SELECT DISTINCT A.TRIP_ID                                01310000
013200              , B.OPER_UNT_ID                                     01320000
013300              , A.OWNER_SCAC_ID                                   01330000
013400              , A.VEH_NBR                                         01340000
013500              , B.TRIP_STATUS_CDE                                 01350000
013600              , A.MANIFEST_NBR                                    01360000
013700           FROM TVHTRIP A                                         01370000
013800              , TTRIPST B                                         01380000
013900              , TTRSTYP C                                         01390000
014000              , XLT_LOC G                                         01400000
014100          WHERE A.TRIP_ID         = B.TRIP_ID                     01410000
014200            AND B.TRIP_STATUS_CDE = C.TRIP_STATUS_CDE             01420000
014300            AND C.TRIP_STATUS_CDE = 'EN'                          01430000
014400            AND B.STATUS_DTE >                                    01440000
014500                  (CURRENT DATE - :PV-IBFRCS-PARAM DAYS)          01450000
014600            AND B.OPER_UNT_ID     = :DK-OPER-UNT-ID               01460000
014700            AND G.LOC_NBR         = B.OPER_UNT_ID                 01470000
014800            AND G.LOC_TYP_CDE     = 'DC'                          01480000
014900            AND A.VEH_NBR         IS NULL                         01490000
015000            AND C.PRTY_CDE        =                               01500000
015100            (SELECT MAX(E.PRTY_CDE)                               01510000
015200               FROM TTRIPST D                                     01520000
015300                  , TTRSTYP E                                     01530000
015400              WHERE D.TRIP_ID    = A.TRIP_ID                      01540000
015500                AND D.TRIP_STATUS_CDE = E.TRIP_STATUS_CDE)        01550000
015600              GROUP BY B.OPER_UNT_ID                              01560000
015700                      , A.TRIP_ID                                 01570000
015800                      , A.OWNER_SCAC_ID                           01580000
015900                      , A.VEH_NBR                                 01590000
016000                      , B.TRIP_STATUS_CDE                         01600000
016100                      , C.PRTY_CDE                                01610000
016200                      , B.STATUS_DTE                              01620000
016300                      , B.STATUS_TME                              01630000
016400                      , A.MANIFEST_NBR                            01640000
016500           WITH UR                                                01650000
016600     END-EXEC.                                                    01660000
016700                                                                  01670000
016800* CURSOR FOR TYPE 2 HANGING PACKSLIP - MISSING RECEIVER           01680000
016900     EXEC SQL                                                     01690000
017000         DECLARE HNG-PKSL-2 CURSOR FOR                            01700000
017100         SELECT PO_NBR                                            01710000
017200               ,SEQ_NBR                                           01720000
017300               ,REC_SEQ_NBR                                       01730000
017400               ,OWNER_SCAC_ID                                     01740000
017500               ,OPER_UNT_ID                                       01750000
017600               ,SHIPT_ID                                          01760000
017700               ,CRE_TMST                                          01770000
017800               ,EXPTED_PKG_QTY                                    01780000
017900               ,BOL_NBR                                           01790000
018000           FROM TPKSLIP                                           01800000
018100          WHERE REC_SEQ_NBR = 0                                   01810000
018200            AND VER_STAT_CDE = 'A'                                01820000
018300            AND PO_NBR > 0                                        01830000
018400            AND OPER_UNT_ID = :DK-OPER-UNT-ID                     01840000
018500            AND CRE_TMST > (TIMESTAMP(CURRENT TIMESTAMP) -        01850000
018600                           :PV-IBFRCS-PARAM DAYS)                 01860000
018700           WITH UR                                                01870000
018800     END-EXEC.                                                    01880000
018900                                                                  01890000
019000* CURSOR TO GET PO RECORDS                                        01900000
019100*       NOTE:  WE WANT TO INCLUDE INACTIVE ROWS FROM TPKSLIP      01910000
019200     EXEC SQL                                                     01920000
019300         DECLARE PO-CURSOR CURSOR FOR                             01930000
019400             SELECT DISTINCT                                      01940000
019500                C.PO_NBR                                          01950000
019600              , C.REC_SEQ_NBR                                     01960000
019700              , C.CRE_TMST                                        01970000
019800              , C.SEQ_NBR                                         01980000
019900              , C.EXPTED_PKG_QTY                                  01990000
020000              , C.BOL_NBR                                         02000000
020100              , C.SHIPT_ID                                        02010000
020200             FROM                                                 02020000
020300                   TSHIPMT A                                      02030000
020400              ,    TSHPTPO B                                      02040000
020410              ,    TPKSLIP C                                      02041000
020420             WHERE A.TRIP_ID         = :DK-TRIP-ID                02042000
020430               AND A.SHIPT_ID        = B.SHIPT_ID                 02043000
020440               AND B.SHIPT_ID        = C.SHIPT_ID                 02044000
020450               AND B.PO_NBR          = C.PO_NBR                   02045000
020460               AND B.REC_SEQ_NBR     = C.REC_SEQ_NBR              02046000
020470               AND C.OPER_UNT_ID     = :DK-OPER-UNT-ID            02047000
020480               AND C.CRE_TMST =                                   02048000
020490                    (SELECT MAX(D.CRE_TMST)                       02049000
020500                       FROM TPKSLIP D                             02050000
020510                       WHERE D.PO_NBR      = C.PO_NBR             02051000
020520                         AND D.SEQ_NBR     = C.SEQ_NBR)           02052000
020530           WITH UR                                                02053000
020540     END-EXEC.                                                    02054000
020550                                                                  02055000
020551*  USED FOR DB2 ERROR MESSAGE BUILDING                            02055100
020552     COPY DPWS004.                                                02055200
020553                                                                  02055300
020554*   DB2 SQL COMMUNICATION AREA                                    02055400
020555     EXEC SQL                                                     02055500
020556          INCLUDE SQLCA                                           02055600
020557     END-EXEC.                                                    02055700
020558                                                                  02055800
020559 PROCEDURE DIVISION.                                              02055900
020560                                                                  02056000
020570     PERFORM 1000-INIT.                                           02057000
020580                                                                  02058000
020590* CURSOR 1 - MISSING TRAILER                                      02059000
020600     PERFORM 2000-PROCESS-CSR1 UNTIL WS-END-CSR1.                 02060000
020700                                                                  02070000
020800     PERFORM 2500-SWITCH-CSR.                                     02080000
020900                                                                  02090000
021000* CURSOR 2 - MISSING RECEIVER                                     02100000
021100     PERFORM 3000-PROCESS-CSR2 UNTIL WS-END-CSR2.                 02110000
021200                                                                  02120000
021300     PERFORM 9000-TERMINATE.                                      02130000
021400                                                                  02140000
021500     GOBACK.                                                      02150000
021600                                                                  02160000
021700 1000-INIT.                                                       02170000
021800                                                                  02180000
021810     ACCEPT CC-CONTROL-CARD-PARAMETERS FROM SYSIN.                02181000
021811     DISPLAY 'CONTROL CARD SET-UP FOR THIS RUN IS: '              02181100
021812             CC-CONTROL-CARD-PARAMETERS.                          02181200
021813     MOVE CC-DC-NBR             TO DK-OPER-UNT-ID.                02181300
021815     MOVE FUNCTION CURRENT-DATE TO PV-CURRENT-DATE-DATA.          02181500
021816                                                                  02181600
021817     EXEC SQL                                                     02181700
021818         SELECT FUNC_QTY                                          02181800
021819           INTO :PV-IBFRCS-PARAM                                  02181900
021820           FROM TKRPRPM                                           02182000
021821          WHERE LOC_ID            = :DK-OPER-UNT-ID               02182100
021822            AND FUNC_PRC_STAT_CDE = 'AC'                          02182200
021823            AND SYS_PRC_FUNC_CDE  = 'IBFRCS'                      02182300
021824           WITH UR                                                02182400
021825     END-EXEC.                                                    02182500
021826                                                                  02182600
021827     EVALUATE TRUE                                                02182700
021828         WHEN SQLCODE = ZERO                                      02182800
021829             CONTINUE                                             02182900
021830         WHEN SQLCODE = +100                                      02183000
021831             MOVE +30 TO PV-IBFRCS-PARAM                          02183100
021832         WHEN SQLWARN0 NOT = SPACE                                02183200
021833         WHEN SQLCODE  NOT = ZERO                                 02183300
021834             MOVE '1000-INIT'          TO WS-ABEND-PARAGRAPH      02183400
021835             MOVE 'SELECT FUNC_QTY'    TO WS-ABEND-OPERATION      02183500
021836             MOVE 'TKRPRPM'            TO WS-ABEND-STRUCTURE-1    02183600
021837             PERFORM 9900-DB2-ABEND                               02183700
021838     END-EVALUATE.                                                02183800
021839                                                                  02183900
021840*** RETRIEVE THE PARAMETER NEEDED TO FILTER OUT HANGING PKSLIPS   02184000
021841*** HGPKS1 IS USED FOR THOSE PACKLIPS WITH SSCC COUNT = 0         02184100
021842     EXEC SQL                                                     02184200
021843         SELECT FUNC_QTY                                          02184300
021844           INTO :PV-FILTER-NO-SSCC                                02184400
021845           FROM TKRPRPM                                           02184500
021846          WHERE FUNC_PRC_STAT_CDE = 'AC'                          02184600
021847            AND SYS_PRC_FUNC_CDE  = 'HGPKS1'                      02184700
021848           WITH UR                                                02184800
021849     END-EXEC.                                                    02184900
021850                                                                  02185000
021851     EVALUATE TRUE                                                02185100
021860         WHEN SQLCODE = ZERO                                      02186000
021870             CONTINUE                                             02187000
021880         WHEN SQLCODE = +100                                      02188000
021890             MOVE +5 TO PV-FILTER-NO-SSCC                         02189000
021900         WHEN SQLWARN0 NOT = SPACE                                02190000
022000         WHEN SQLCODE  NOT = ZERO                                 02200000
022100             MOVE '1000-INIT'          TO WS-ABEND-PARAGRAPH      02210000
022200             MOVE 'SELECT FUNC_QTY'    TO WS-ABEND-OPERATION      02220000
022300             MOVE 'TKRPRPM'            TO WS-ABEND-STRUCTURE-1    02230000
022400             PERFORM 9900-DB2-ABEND                               02240000
022500     END-EVALUATE.                                                02250000
022600                                                                  02260000
022700*** RETRIEVE THE PARAMETER NEEDED TO FILTER OUT HANGING PKSLIPS   02270000
022800*** HGPKS2 IS USED FOR THOSE PACKLIPS WITH SSCC COUNT > 0         02280000
022900     EXEC SQL                                                     02290000
023000         SELECT FUNC_QTY                                          02300000
023100           INTO :PV-FILTER-SSCC                                   02310000
023200           FROM TKRPRPM                                           02320000
023210          WHERE FUNC_PRC_STAT_CDE = 'AC'                          02321000
023220            AND SYS_PRC_FUNC_CDE  = 'HGPKS2'                      02322000
023230           WITH UR                                                02323000
023240     END-EXEC.                                                    02324000
023250                                                                  02325000
023260     EVALUATE TRUE                                                02326000
023270         WHEN SQLCODE = ZERO                                      02327000
023280             CONTINUE                                             02328000
023290         WHEN SQLCODE = +100                                      02329000
023291             MOVE +14 TO PV-FILTER-SSCC                           02329100
023292         WHEN SQLWARN0 NOT = SPACE                                02329200
023293         WHEN SQLCODE  NOT = ZERO                                 02329300
023294             MOVE '1000-INIT'          TO WS-ABEND-PARAGRAPH      02329400
023295             MOVE 'SELECT FUNC_QTY'    TO WS-ABEND-OPERATION      02329500
023296             MOVE 'TKRPRPM'            TO WS-ABEND-STRUCTURE-1    02329600
023297             PERFORM 9900-DB2-ABEND                               02329700
023298     END-EVALUATE.                                                02329800
023299                                                                  02329900
023300     OPEN OUTPUT PKSL-EXTRACT-FILE                                02330000
023310                 PKSL-REPORT-FILE.                                02331000
023320                                                                  02332000
023330     SET WS-DC-IDX TO +1.                                         02333000
023340                                                                  02334000
023350     PERFORM 7000-OPEN-PKSL-CSR1.                                 02335000
023360                                                                  02336000
023370     PERFORM 7010-FETCH-PKSL-CSR1.                                02337000
023380                                                                  02338000
023390* CURSOR 1 - MISSING TRAILER                                      02339000
023400 2000-PROCESS-CSR1.                                               02340000
023500                                                                  02350000
023600     INITIALIZE PC068-RECORD-LAYOUT                               02360000
023700                PC070-RECORD-LAYOUT.                              02370000
023800                                                                  02380000
023900     MOVE '01-01-0001'           TO PC068-ARRIVAL-DATE.           02390000
024000     MOVE ' '                    TO PC068-TRLR-LOC.               02400000
024100     MOVE 'X'                    TO PC068-SORT-BY-LOC-IND.        02410000
024200     MOVE '2'                    TO PC068-PROCESS-GROUP.          02420000
024300     MOVE 'TLR'                  TO PC068-RECORD-TYPE.            02430000
024400     MOVE TRIPST-OPER-UNT-ID     TO PC068-OPER-UNT-ID             02440000
024500                                    PC070-OPER-UNT-ID.            02450000
024600     MOVE 'NO TRLR'              TO PC070-HANG-TYPE.              02460000
024700     MOVE VHTRIP-TRIP-ID         TO PC068-TRIP-ID                 02470000
024800                                    PC070-TRIP-ID.                02480000
024900     MOVE VHTRIP-OWNER-SCAC-ID   TO PC068-SCAC                    02490000
025000                                    PC070-SCAC.                   02500000
025100     MOVE ' '                    TO PC068-TRLR-NBR                02510000
025200                                    PC070-TRLR-NBR.               02520000
025300                                                                  02530000
025310     MOVE 0                      TO PC068-HAZ-CTN-CNT             02531015
025320                                    PC068-HAZ-UNT-CNT             02532015
025321                                    PC068-CNTL-FLOW-CTN-CNT       02532115
025322                                    PC068-CNTL-FLOW-UNT-CNT.      02532215
025330                                                                  02533015
025400     MOVE VHTRIP-TRIP-ID         TO DK-TRIP-ID.                   02540000
025500     MOVE 0                      TO WS-UNIT-CNT.                  02550000
025600     MOVE 0                      TO WS-CTN-CNT.                   02560000
025700     MOVE 0                      TO WS-FETCH-PO-CNT.              02570000
025800                                                                  02580000
025900     PERFORM 5010-OPEN-PO-CURSOR.                                 02590000
026000                                                                  02600000
026100     PERFORM 5020-FETCH-PO-CURSOR UNTIL WS-END-PO-CSR.            02610000
026200                                                                  02620000
026300     PERFORM 5030-CLOSE-PO-CURSOR.                                02630000
026310                                                                  02631000
026320     SET WS-END-PO-CSR-NO TO TRUE.                                02632000
026330                                                                  02633000
026340     PERFORM 7010-FETCH-PKSL-CSR1.                                02634000
026350                                                                  02635000
026360 2500-SWITCH-CSR.                                                 02636000
026370                                                                  02637000
026380     PERFORM 7020-CLOSE-PKSL-CSR1.                                02638000
026390                                                                  02639000
026400     PERFORM 7100-OPEN-PKSL-CSR2.                                 02640000
026500                                                                  02650000
026600     PERFORM 7110-FETCH-PKSL-CSR2.                                02660000
026700                                                                  02670000
026800* CURSOR 1 - MISSING RECEIVER                                     02680000
026900 3000-PROCESS-CSR2.                                               02690000
027000                                                                  02700000
027100     INITIALIZE PC068-RECORD-LAYOUT                               02710000
027200                PC070-RECORD-LAYOUT.                              02720000
027300                                                                  02730000
027400     MOVE ' '                    TO PC068-ARRIVAL-DATE.           02740000
027500     MOVE ' '                    TO PC068-TRLR-LOC.               02750000
027600     MOVE 'X'                    TO PC068-SORT-BY-LOC-IND.        02760000
027700     MOVE '2'                    TO PC068-PROCESS-GROUP.          02770000
027800     MOVE 'TLR'                  TO PC068-RECORD-TYPE.            02780000
027900     MOVE 0                      TO PC068-TRIP-ID.                02790000
028000     MOVE ' '                    TO PC068-TRLR-NBR.               02800000
028100     MOVE 0                      TO WS-UNIT-CNT.                  02810000
028200     MOVE 0                      TO WS-CTN-CNT.                   02820000
028300     MOVE 0                      TO WS-SSCC-CNT.                  02830000
028400     MOVE 0                      TO WS-MATCH-CNT.                 02840000
028500     MOVE 0                      TO WS-UNMATCH-CNT.               02850000
028600     MOVE 0                      TO WS-FETCH-PO-CNT.              02860000
028700                                                                  02870000
028800     MOVE PKSLIP-OPER-UNT-ID     TO PC068-OPER-UNT-ID             02880000
028900                                    PC070-OPER-UNT-ID.            02890000
029000     MOVE 'NO RCVR'              TO PC070-HANG-TYPE.              02900000
029100     MOVE PKSLIP-OWNER-SCAC-ID   TO PC068-SCAC                    02910000
029200                                    PC070-SCAC.                   02920000
029300     MOVE PKSLIP-PO-NBR          TO PC068-PO-NBR                  02930000
029400                                    PC070-PO-NBR.                 02940000
029500     MOVE PKSLIP-REC-SEQ-NBR     TO PC068-REC-SEQ-NBR             02950000
029600                                    PC070-REC-SEQ-NBR.            02960000
029700     MOVE PKSLIP-EXPTED-PKG-QTY  TO WS-CTN-CNT.                   02970000
029800     MOVE PKSLIP-SHIPT-ID        TO DK-SHIPT-ID.                  02980000
029900                                                                  02990000
030000     PERFORM 4100-GET-SHIPMT-INFO.                                03000000
030100                                                                  03010000
030200     MOVE PKSLIP-PO-NBR          TO DK-PO-NBR.                    03020000
030300     MOVE PKSLIP-REC-SEQ-NBR     TO DK-REC-SEQ-NBR.               03030000
030400     MOVE PKSLIP-OPER-UNT-ID     TO DK-OPER-UNT-ID.               03040000
030401     MOVE PKSLIP-BOL-NBR         TO PC070-BOL-NBR.                03040100
030402     MOVE PKSLIP-SEQ-NBR         TO DK-SEQ-NBR                    03040200
030403                                    PC070-PKSLP-SEQ-NBR           03040300
030404                                    PC068-PO-LNE-NBR.             03040400
030405     MOVE PKSLIP-CRE-TMST        TO DK-CRE-TMST                   03040500
030406                                    PC070-PKSLP-CRE-TS            03040600
030407                                    PV-PKSLP-TMST.                03040700
030408                                                                  03040800
030409     PERFORM 6300-GET-TRIP.                                       03040900
030410                                                                  03041000
030411     MOVE SPACES                 TO PC068-TRLR-NBR.               03041100
030412     MOVE SHIPMT-TRIP-ID         TO DK-TRIP-ID.                   03041200
030413                                                                  03041300
030414     PERFORM 6310-GET-TRLR.                                       03041400
030415                                                                  03041500
030416     PERFORM 4200-GET-MATCH-CNT.                                  03041600
030417                                                                  03041700
030418     PERFORM 4300-GET-UNMATCH-CNT.                                03041800
030419                                                                  03041900
030420     PERFORM 4400-GET-SSCC-CNT.                                   03042000
030430                                                                  03043000
030440     ADD WS-MATCH-CNT            TO WS-UNIT-CNT.                  03044000
030450                                                                  03045000
030451     ADD WS-UNMATCH-CNT          TO WS-UNIT-CNT.                  03045100
030452     MOVE WS-UNIT-CNT            TO PC068-UNIT-CNT-TRLR           03045200
030453                                    PC070-UNIT-CNT.               03045300
030454     MOVE WS-CTN-CNT             TO PC068-TOT-CTN-CNT             03045400
030455                                    PC070-CARTON-CNT.             03045500
030456     MOVE WS-SSCC-CNT            TO PC070-SSCC-CNT.               03045600
030457     MOVE 1                      TO PC068-PO-CNT-TRLR.            03045700
030458                                                                  03045800
030459     MOVE  PV-PKSLP-YYYY     TO PV-PKSLIP-DATE-YYYY.              03045900
030460     MOVE  PV-PKSLP-MM       TO PV-PKSLIP-DATE-MM.                03046000
030461     MOVE  PV-PKSLP-DD       TO PV-PKSLIP-DATE-DD.                03046100
030462     COMPUTE PV-INTEGER                                           03046200
030463                = FUNCTION INTEGER-OF-DATE (PV-PKSLIP-DATE).      03046300
030464     IF WS-SSCC-CNT > 0                                           03046400
030466         ADD PV-FILTER-SSCC    TO PV-INTEGER                      03046600
030467     ELSE                                                         03046700
030469         ADD PV-FILTER-NO-SSCC TO PV-INTEGER.                     03046900
030470     COMPUTE PV-FUTURE-DATE                                       03047000
030471                = FUNCTION DATE-OF-INTEGER (PV-INTEGER).          03047100
030472     IF PV-FUTURE-DATE < PV-CURRENT-DATE                          03047200
030475       CONTINUE                                                   03047500
030476     ELSE                                                         03047600
030477       PERFORM 6200-GET-VENDOR-NAME                               03047700
030478                                                                  03047800
030479       PERFORM 8100-WRITE-OUTPUT-REC                              03047900
030480                                                                  03048000
030481       PERFORM 8200-WRITE-REPORT-REC.                             03048100
030482                                                                  03048200
030483     PERFORM 7110-FETCH-PKSL-CSR2.                                03048300
030484                                                                  03048400
030485 4100-GET-SHIPMT-INFO.                                            03048500
030486                                                                  03048600
030487     EXEC SQL                                                     03048700
030488         SELECT TRIP_ID                                           03048800
030489             ,  EXPTED_PKG_QTY                                    03048900
030490           INTO :SHIPMT-TRIP-ID                                   03049000
030491             ,  :SHIPMT-EXPTED-PKG-QTY                            03049100
030492           FROM TSHIPMT                                           03049200
030493         WHERE SHIPT_ID = :DK-SHIPT-ID                            03049300
030494           WITH UR                                                03049400
030495     END-EXEC.                                                    03049500
030496                                                                  03049600
030497     EVALUATE TRUE                                                03049700
030498         WHEN SQLCODE = ZERO                                      03049800
030500               MOVE SHIPMT-TRIP-ID  TO PC068-TRIP-ID              03050000
030600                                       PC070-TRIP-ID              03060000
030700               IF WS-CTN-CNT = 0                                  03070000
030800                   MOVE SHIPMT-EXPTED-PKG-QTY TO WS-CTN-CNT       03080000
030900               END-IF                                             03090000
031000         WHEN SQLCODE = +100                                      03100000
031100             CONTINUE                                             03110000
031200         WHEN OTHER                                               03120000
031300             MOVE '4100-GET-TRIP-ID' TO WS-ABEND-PARAGRAPH        03130000
031400             MOVE 'SELECT'        TO WS-ABEND-OPERATION           03140000
031500             MOVE 'TSHIPMT'       TO WS-ABEND-STRUCTURE-1         03150000
031600             PERFORM 9900-DB2-ABEND                               03160000
031700     END-EVALUATE.                                                03170000
031800                                                                  03180000
031900 4200-GET-MATCH-CNT.                                              03190000
032000                                                                  03200000
032100     MOVE ZEROES                 TO PV-MATCHED-ITEMS.             03210000
032200                                                                  03220000
032300     EXEC SQL                                                     03230000
032400           SELECT SUM (PKSL_ITM_QTY)                              03240000
032500             INTO :PV-MATCHED-ITEMS :PV-MATCHED-IND               03250000
032600             FROM TPKITEM                                         03260000
032700            WHERE PO_NBR        = :DK-PO-NBR                      03270000
032800              AND SEQ_NBR       = :DK-SEQ-NBR                     03280000
032900              AND VER_STAT_CDE  = 'A'                             03290000
033000           WITH UR                                                03300000
033100     END-EXEC.                                                    03310000
033200                                                                  03320000
033300     EVALUATE TRUE                                                03330000
033400         WHEN SQLCODE = ZERO                                      03340000
033410               MOVE PV-MATCHED-ITEMS TO WS-MATCH-CNT              03341000
033420         WHEN SQLCODE = +100                                      03342000
033430             CONTINUE                                             03343000
033440         WHEN OTHER                                               03344000
033450             MOVE '4200-GET-MATCH-CNT' TO WS-ABEND-PARAGRAPH      03345000
033460             MOVE 'SELECT'        TO WS-ABEND-OPERATION           03346000
033470             MOVE 'TPKITEM'       TO WS-ABEND-STRUCTURE-1         03347000
033480             PERFORM 9900-DB2-ABEND                               03348000
033490     END-EVALUATE.                                                03349000
033500                                                                  03350000
033600 4300-GET-UNMATCH-CNT.                                            03360000
033700                                                                  03370000
033800     MOVE ZEROES                 TO PV-UNMATCHED-ITEMS.           03380000
033900                                                                  03390000
034000     EXEC SQL                                                     03400000
034100           SELECT SUM (PKSL_ITM_QTY)                              03410000
034200             INTO :PV-UNMATCHED-ITEMS :PV-UNMATCHED-IND           03420000
034300             FROM TUNPKSL                                         03430000
034400            WHERE PO_NBR        = :DK-PO-NBR                      03440000
034500              AND SEQ_NBR       = :PKSLIP-SEQ-NBR                 03450000
034600              AND VER_STAT_CDE  = 'A'                             03460000
034700           WITH UR                                                03470000
034800     END-EXEC.                                                    03480000
034900                                                                  03490000
035000     EVALUATE TRUE                                                03500000
035100         WHEN SQLCODE = ZERO                                      03510000
035200               MOVE PV-UNMATCHED-ITEMS TO WS-UNMATCH-CNT          03520000
035210         WHEN SQLCODE = +100                                      03521000
035220             CONTINUE                                             03522000
035221         WHEN OTHER                                               03522100
035222             MOVE '4300-GET-UNMATCH-CNT' TO WS-ABEND-PARAGRAPH    03522200
035223             MOVE 'SELECT'        TO WS-ABEND-OPERATION           03522300
035224             MOVE 'TUNPKSL'       TO WS-ABEND-STRUCTURE-1         03522400
035225             PERFORM 9900-DB2-ABEND                               03522500
035226     END-EVALUATE.                                                03522600
035227                                                                  03522700
035228 4400-GET-SSCC-CNT.                                               03522800
035229                                                                  03522900
035230     MOVE ZEROES                 TO PV-SSCC-CNT.                  03523000
035240                                                                  03524000
035241     EXEC SQL                                                     03524100
035242           SELECT COUNT(*)                                        03524200
035243             INTO :PV-SSCC-CNT :PV-SSCC-IND                       03524300
035244             FROM TINPKSU                                         03524400
035245            WHERE PO_NBR        = :DK-PO-NBR                      03524500
035246              AND SEQ_NBR       = :PKSLIP-SEQ-NBR                 03524600
035247           WITH UR                                                03524700
035248     END-EXEC.                                                    03524800
035249                                                                  03524900
035250     EVALUATE TRUE                                                03525000
035251         WHEN SQLCODE = ZERO                                      03525100
035252               MOVE PV-SSCC-CNT        TO WS-SSCC-CNT             03525200
035253         WHEN SQLCODE = +100                                      03525300
035254             CONTINUE                                             03525400
035255         WHEN OTHER                                               03525500
035256             MOVE '4400-GET-SSCC-CNT' TO WS-ABEND-PARAGRAPH       03525600
035257             MOVE 'SELECT'        TO WS-ABEND-OPERATION           03525700
035258             MOVE 'TINPKSU'       TO WS-ABEND-STRUCTURE-1         03525800
035259             PERFORM 9900-DB2-ABEND                               03525900
035260     END-EVALUATE.                                                03526000
035261                                                                  03526100
035262 5010-OPEN-PO-CURSOR.                                             03526200
035263                                                                  03526300
035264     EXEC SQL                                                     03526400
035265         OPEN PO-CURSOR                                           03526500
035266     END-EXEC.                                                    03526600
035267                                                                  03526700
035268     EVALUATE TRUE                                                03526800
035269         WHEN SQLCODE = ZERO                                      03526900
035270             CONTINUE                                             03527000
035271         WHEN SQLWARN0 NOT = SPACE                                03527100
035272         WHEN SQLCODE  NOT = ZERO                                 03527200
035273             MOVE '5010-OPEN-PO-CURSOR' TO WS-ABEND-PARAGRAPH     03527300
035274             MOVE 'OPEN CURSOR'         TO WS-ABEND-OPERATION     03527400
035275             MOVE 'TSHIPMT'             TO WS-ABEND-STRUCTURE-1   03527500
035276             PERFORM 9900-DB2-ABEND                               03527600
035277     END-EVALUATE.                                                03527700
035278                                                                  03527800
035279 5020-FETCH-PO-CURSOR.                                            03527900
035280                                                                  03528000
035281     EXEC SQL                                                     03528100
035282         FETCH PO-CURSOR                                          03528200
035283         INTO                                                     03528300
035284             :PKSLIP-PO-NBR                                       03528400
035285         ,   :PKSLIP-REC-SEQ-NBR                                  03528500
035286         ,   :PKSLIP-CRE-TMST                                     03528600
035287         ,   :PKSLIP-SEQ-NBR                                      03528700
035288         ,   :PKSLIP-EXPTED-PKG-QTY                               03528800
035289         ,   :PKSLIP-BOL-NBR                                      03528900
035290         ,   :PKSLIP-SHIPT-ID                                     03529000
035291     END-EXEC.                                                    03529100
035292                                                                  03529200
035293     EVALUATE TRUE                                                03529300
035294         WHEN SQLCODE = ZERO                                      03529400
035295             ADD 1                    TO WS-FETCH-PO-CNT          03529500
035296             MOVE PKSLIP-PO-NBR       TO DK-PO-NBR                03529600
035297             MOVE PKSLIP-REC-SEQ-NBR  TO DK-REC-SEQ-NBR           03529700
035298             MOVE PKSLIP-BOL-NBR      TO PC070-BOL-NBR            03529800
035299             MOVE PKSLIP-SEQ-NBR      TO DK-SEQ-NBR               03529900
035300                                         PC070-PKSLP-SEQ-NBR      03530000
035301                                         PC068-PO-LNE-NBR         03530100
035302             MOVE PKSLIP-PO-NBR       TO PC068-PO-NBR             03530200
035303                                         PC070-PO-NBR             03530300
035304             MOVE PKSLIP-REC-SEQ-NBR  TO PC068-REC-SEQ-NBR        03530400
035305                                         PC070-REC-SEQ-NBR        03530500
035306             MOVE PKSLIP-CRE-TMST     TO PC070-PKSLP-CRE-TS       03530600
035307                                         PV-PKSLP-TMST            03530700
035308             MOVE 0                   TO WS-UNIT-CNT              03530800
035309             MOVE 0                   TO WS-MATCH-CNT             03530900
035310             MOVE 0                   TO WS-UNMATCH-CNT           03531000
035311             MOVE 0                   TO WS-SSCC-CNT              03531100
035312             MOVE PKSLIP-EXPTED-PKG-QTY TO WS-CTN-CNT             03531200
035313             PERFORM 4200-GET-MATCH-CNT                           03531300
035314             PERFORM 4300-GET-UNMATCH-CNT                         03531400
035315             PERFORM 4400-GET-SSCC-CNT                            03531500
035316             ADD WS-MATCH-CNT            TO WS-UNIT-CNT           03531600
035317             ADD WS-UNMATCH-CNT          TO WS-UNIT-CNT           03531700
035318             MOVE WS-UNIT-CNT    TO PC068-UNIT-CNT-TRLR           03531800
035319                                    PC070-UNIT-CNT                03531900
035320             MOVE WS-CTN-CNT     TO PC068-TOT-CTN-CNT             03532000
035321                                    PC070-CARTON-CNT              03532100
035322             MOVE WS-SSCC-CNT    TO PC070-SSCC-CNT                03532200
035323             MOVE 1              TO PC068-PO-CNT-TRLR             03532300
035324             MOVE PV-PKSLP-YYYY  TO PV-PKSLIP-DATE-YYYY           03532400
035325             MOVE PV-PKSLP-MM    TO PV-PKSLIP-DATE-MM             03532500
035326             MOVE PV-PKSLP-DD    TO PV-PKSLIP-DATE-DD             03532600
035327             COMPUTE PV-INTEGER                                   03532700
035328                = FUNCTION INTEGER-OF-DATE (PV-PKSLIP-DATE)       03532800
035338             IF WS-SSCC-CNT > 0                                   03533800
035339                 ADD PV-FILTER-SSCC    TO PV-INTEGER              03533900
035341             ELSE                                                 03534100
035342                 ADD PV-FILTER-NO-SSCC TO PV-INTEGER              03534200
035344             END-IF                                               03534400
035345             COMPUTE PV-FUTURE-DATE                               03534500
035346                     = FUNCTION DATE-OF-INTEGER (PV-INTEGER)      03534600
035347             IF PV-FUTURE-DATE < PV-CURRENT-DATE                  03534700
035349                 CONTINUE                                         03534900
035352             ELSE                                                 03535200
035353                 PERFORM 6200-GET-VENDOR-NAME                     03535300
035354                 PERFORM 8100-WRITE-OUTPUT-REC                    03535400
035355                 PERFORM 8200-WRITE-REPORT-REC                    03535500
035356             END-IF                                               03535600
035357         WHEN SQLCODE = +100                                      03535700
035358             SET WS-END-PO-CSR           TO TRUE                  03535800
035359         WHEN SQLWARN0 NOT = SPACE                                03535900
035360         WHEN SQLCODE  NOT = ZERO                                 03536000
035361             MOVE '5020-FETCH-PO-CURSOR' TO WS-ABEND-PARAGRAPH    03536100
035362             MOVE 'FETCH CURSOR'         TO WS-ABEND-OPERATION    03536200
035363             MOVE 'TSHIPMT'              TO WS-ABEND-STRUCTURE-1  03536300
035364             PERFORM 9900-DB2-ABEND                               03536400
035365     END-EVALUATE.                                                03536500
035366                                                                  03536600
035367 5030-CLOSE-PO-CURSOR.                                            03536700
035368                                                                  03536800
035369     EXEC SQL                                                     03536900
035370         CLOSE PO-CURSOR                                          03537000
035371     END-EXEC.                                                    03537100
035372                                                                  03537200
035373     EVALUATE TRUE                                                03537300
035374         WHEN SQLCODE = ZERO                                      03537400
035375             CONTINUE                                             03537500
035376         WHEN SQLWARN0 NOT = SPACE                                03537600
035377         WHEN SQLCODE  NOT = ZERO                                 03537700
035378             MOVE '5030-CLOSE-PO-CURSOR' TO WS-ABEND-PARAGRAPH    03537800
035379             MOVE 'CLOSE CURSOR'         TO WS-ABEND-OPERATION    03537900
035380             MOVE 'TSHIPMT'              TO WS-ABEND-STRUCTURE-1  03538000
035381             PERFORM 9900-DB2-ABEND                               03538100
035382     END-EVALUATE.                                                03538200
035383                                                                  03538300
035384 6200-GET-VENDOR-NAME.                                            03538400
035385                                                                  03538500
035386         EXEC SQL                                                 03538600
035387              SELECT B.ENT_NAME_DESC                              03538700
035388                INTO :ENTNME-ENT-NAME-DESC                        03538800
035389                FROM TPURCHS A,                                   03538900
035390                     TENTNME B                                    03539000
035391               WHERE A.VER_STATUS_CDE = 'A'                       03539100
035392                 AND A.PO_NBR         = :DK-PO-NBR                03539200
035393                 AND A.ENT_ID         = B.ENT_ID                  03539300
035394                 AND B.TYPE_CDE       = '01'                      03539400
035395               WITH UR                                            03539500
035396         END-EXEC                                                 03539600
035397                                                                  03539700
035398         EVALUATE TRUE                                            03539800
035399           WHEN SQLCODE = ZERO                                    03539900
035400               MOVE ENTNME-ENT-NAME-DESC TO PC070-VENDOR-NAME     03540000
035401           WHEN OTHER                                             03540100
035402               CONTINUE                                           03540200
035403         END-EVALUATE.                                            03540300
035404                                                                  03540400
035405 6300-GET-TRIP.                                                   03540500
035406                                                                  03540600
035407     EXEC SQL                                                     03540700
035408         SELECT DISTINCT(B.TRIP_ID)                               03540800
035409          INTO :SHIPMT-TRIP-ID                                    03540900
035410          FROM TSHPTPO A                                          03541000
035411             , TSHIPMT B                                          03541100
035412             , TPKSLIP C                                          03541200
035413         WHERE C.PO_NBR        = :DK-PO-NBR                       03541300
035414           AND C.REC_SEQ_NBR   = :DK-REC-SEQ-NBR                  03541400
035415           AND C.OPER_UNT_ID   = :DK-OPER-UNT-ID                  03541500
035416           AND C.SEQ_NBR       = :DK-SEQ-NBR                      03541600
035417           AND C.CRE_TMST      = :DK-CRE-TMST                     03541700
035418           AND C.VER_STAT_CDE  = 'A'                              03541800
035419           AND C.SHIPT_ID      = B.SHIPT_ID                       03541900
035420           AND B.SHIPT_ID      = A.SHIPT_ID                       03542000
035421         WITH UR                                                  03542100
035422     END-EXEC.                                                    03542200
035430                                                                  03543000
035440     EVALUATE TRUE                                                03544000
035441         WHEN SQLCODE = ZERO                                      03544100
035442               MOVE SHIPMT-TRIP-ID   TO PC068-TRIP-ID             03544200
035443                                        PC070-TRIP-ID             03544300
035444         WHEN SQLCODE = +100                                      03544400
035445               MOVE 0                TO PC068-TRIP-ID             03544500
035446                                        PC070-TRIP-ID             03544600
035447         WHEN OTHER                                               03544700
035448             MOVE '6300-GET-TRIP'     TO WS-ABEND-PARAGRAPH       03544800
035449             MOVE 'SELECT'        TO WS-ABEND-OPERATION           03544900
035450             MOVE 'TSHIPMT'       TO WS-ABEND-STRUCTURE-1         03545000
035451             PERFORM 9900-DB2-ABEND                               03545100
035452     END-EVALUATE.                                                03545200
035453                                                                  03545300
035454 6310-GET-TRLR.                                                   03545400
035455                                                                  03545500
035456     EXEC SQL                                                     03545600
035457       SELECT VEH_NBR                                             03545700
035458          INTO :VHTRIP-VEH-NBR   :PV-VEH-NBR-NULL                 03545800
035459          FROM TVHTRIP                                            03545900
035460         WHERE TRIP_ID         = :DK-TRIP-ID                      03546000
035461       WITH UR                                                    03546100
035462     END-EXEC.                                                    03546200
035463                                                                  03546300
035464     EVALUATE TRUE                                                03546400
035465         WHEN SQLCODE = ZERO                                      03546500
035466               IF PV-VEH-NBR-NULL = -1                            03546600
035467                   MOVE SPACES           TO PC068-TRLR-NBR        03546700
035468               ELSE                                               03546800
035469                   MOVE VHTRIP-VEH-NBR   TO PC068-TRLR-NBR        03546900
035470                                            PC070-TRLR-NBR        03547000
035471               END-IF                                             03547100
035472         WHEN SQLCODE = +100                                      03547200
035473               CONTINUE                                           03547300
035474         WHEN OTHER                                               03547400
035475             MOVE '6310-GET-TRLR'     TO WS-ABEND-PARAGRAPH       03547500
035476             MOVE 'SELECT'        TO WS-ABEND-OPERATION           03547600
035477             MOVE 'TVHTRIP'       TO WS-ABEND-STRUCTURE-1         03547700
035478             PERFORM 9900-DB2-ABEND                               03547800
035479     END-EVALUATE.                                                03547900
035480                                                                  03548000
035481 7000-OPEN-PKSL-CSR1.                                             03548100
035490                                                                  03549000
035500     EXEC SQL                                                     03550000
035510         OPEN HNG-PKSL-1                                          03551000
035520     END-EXEC.                                                    03552000
035530                                                                  03553000
035540     EVALUATE TRUE                                                03554000
035550         WHEN SQLCODE = ZERO                                      03555000
035560             CONTINUE                                             03556000
035570         WHEN SQLWARN0 NOT = SPACE                                03557000
035571         WHEN SQLCODE  NOT = ZERO                                 03557100
035572             MOVE '7000-OPEN-PKSL-CSR1' TO WS-ABEND-PARAGRAPH     03557200
035573             MOVE 'OPEN CURSOR'         TO WS-ABEND-OPERATION     03557300
035574             MOVE 'TVHTRIP'             TO WS-ABEND-STRUCTURE-1   03557400
035575             PERFORM 9900-DB2-ABEND                               03557500
035576     END-EVALUATE.                                                03557600
035577                                                                  03557700
035578* CURSOR 1 - MISSING TRAILER                                      03557800
035579 7010-FETCH-PKSL-CSR1.                                            03557900
035580                                                                  03558000
035590     EXEC SQL                                                     03559000
035600         FETCH HNG-PKSL-1                                         03560000
035700         INTO                                                     03570000
035800             :VHTRIP-TRIP-ID                                      03580000
035900         ,   :TRIPST-OPER-UNT-ID                                  03590000
036000         ,   :VHTRIP-OWNER-SCAC-ID                                03600000
036100         ,   :VHTRIP-VEH-NBR          :PV-VEH-NBR-NULL            03610000
036200         ,   :TRIPST-TRIP-STATUS-CDE                              03620000
036300         ,   :VHTRIP-MANIFEST-NBR                                 03630000
036400     END-EXEC.                                                    03640000
036500                                                                  03650000
036600     EVALUATE TRUE                                                03660000
036700         WHEN SQLCODE = ZERO                                      03670000
036800             ADD 1                    TO WS-FETCH-CNT1            03680000
036900             MOVE VHTRIP-TRIP-ID TO PV-DISPLAY-TRIP               03690000
037000         WHEN SQLCODE = +100                                      03700000
037100             SET WS-END-CSR1          TO TRUE                     03710000
037200         WHEN SQLWARN0 NOT = SPACE                                03720000
037300         WHEN SQLCODE  NOT = ZERO                                 03730000
037400             MOVE '7010-FETCH-PKSL-CSR1' TO WS-ABEND-PARAGRAPH    03740000
037500             MOVE 'FETCH CURSOR'         TO WS-ABEND-OPERATION    03750000
037600             MOVE 'TVHTRIP'              TO WS-ABEND-STRUCTURE-1  03760000
037700             PERFORM 9900-DB2-ABEND                               03770000
037800     END-EVALUATE.                                                03780000
037900                                                                  03790000
038000 7020-CLOSE-PKSL-CSR1.                                            03800000
038100     EXEC SQL                                                     03810000
038200         CLOSE HNG-PKSL-1                                         03820000
038300     END-EXEC.                                                    03830000
038400                                                                  03840000
038500     EVALUATE TRUE                                                03850000
038600         WHEN SQLCODE = ZERO                                      03860000
038700             CONTINUE                                             03870000
038800         WHEN SQLWARN0 NOT = SPACE                                03880000
038900         WHEN SQLCODE  NOT = ZERO                                 03890000
039000             MOVE '7020-CLOSE-PKSL-CSR1' TO WS-ABEND-PARAGRAPH    03900000
039100             MOVE 'CLOSE CURSOR'         TO WS-ABEND-OPERATION    03910000
039200             MOVE 'TVHTRIP'              TO WS-ABEND-STRUCTURE-1  03920000
039300             PERFORM 9900-DB2-ABEND                               03930000
039400     END-EVALUATE.                                                03940000
039500                                                                  03950000
039600 7100-OPEN-PKSL-CSR2.                                             03960000
039700                                                                  03970000
039800     EXEC SQL                                                     03980000
039900         OPEN HNG-PKSL-2                                          03990000
040000     END-EXEC.                                                    04000000
040100                                                                  04010000
040200     EVALUATE TRUE                                                04020000
040300         WHEN SQLCODE = ZERO                                      04030000
040400             CONTINUE                                             04040000
040500         WHEN SQLWARN0 NOT = SPACE                                04050000
040600         WHEN SQLCODE  NOT = ZERO                                 04060000
040700             MOVE '7100-OPEN-PKSL-CSR2' TO WS-ABEND-PARAGRAPH     04070000
040800             MOVE 'OPEN CURSOR'         TO WS-ABEND-OPERATION     04080000
040900             MOVE 'TPKSLIP'             TO WS-ABEND-STRUCTURE-1   04090000
041000             PERFORM 9900-DB2-ABEND                               04100000
041100     END-EVALUATE.                                                04110000
041110                                                                  04111000
041120* CURSOR 2 - MISSING RECEIVER                                     04112000
041130 7110-FETCH-PKSL-CSR2.                                            04113000
041140                                                                  04114000
041150     EXEC SQL                                                     04115000
041160         FETCH HNG-PKSL-2                                         04116000
041170         INTO                                                     04117000
041180             :PKSLIP-PO-NBR                                       04118000
041190         ,   :PKSLIP-SEQ-NBR                                      04119000
041191         ,   :PKSLIP-REC-SEQ-NBR                                  04119100
041192         ,   :PKSLIP-OWNER-SCAC-ID                                04119200
041193         ,   :PKSLIP-OPER-UNT-ID                                  04119300
041194         ,   :PKSLIP-SHIPT-ID                                     04119400
041195         ,   :PKSLIP-CRE-TMST                                     04119500
041196         ,   :PKSLIP-EXPTED-PKG-QTY                               04119600
041197         ,   :PKSLIP-BOL-NBR                                      04119700
041198     END-EXEC.                                                    04119800
041199                                                                  04119900
041200     EVALUATE TRUE                                                04120000
041201         WHEN SQLCODE = ZERO                                      04120100
041202             ADD 1                    TO WS-FETCH-CNT2            04120200
041203         WHEN SQLCODE = +100                                      04120300
041204             SET WS-END-CSR2          TO TRUE                     04120400
041205         WHEN SQLWARN0 NOT = SPACE                                04120500
041206         WHEN SQLCODE  NOT = ZERO                                 04120600
041207             MOVE '7110-FETCH-PKSL-CSR2' TO WS-ABEND-PARAGRAPH    04120700
041208             MOVE 'FETCH CURSOR'         TO WS-ABEND-OPERATION    04120800
041209             MOVE 'TPKSLIP'              TO WS-ABEND-STRUCTURE-1  04120900
041210             PERFORM 9900-DB2-ABEND                               04121000
041220     END-EVALUATE.                                                04122000
041221                                                                  04122100
041222 7120-CLOSE-PKSL-CSR2.                                            04122200
041223                                                                  04122300
041224     EXEC SQL                                                     04122400
041225         CLOSE HNG-PKSL-2                                         04122500
041226     END-EXEC.                                                    04122600
041227                                                                  04122700
041228     EVALUATE TRUE                                                04122800
041229         WHEN SQLCODE = ZERO                                      04122900
041230             CONTINUE                                             04123000
041231         WHEN SQLWARN0 NOT = SPACE                                04123100
041232         WHEN SQLCODE  NOT = ZERO                                 04123200
041233             MOVE '7120-CLOSE-PKSL-CSR2' TO WS-ABEND-PARAGRAPH    04123300
041234             MOVE 'CLOSE CURSOR'         TO WS-ABEND-OPERATION    04123400
041235             MOVE 'TPKSLIP'              TO WS-ABEND-STRUCTURE-1  04123500
041236             PERFORM 9900-DB2-ABEND                               04123600
041237     END-EVALUATE.                                                04123700
041238                                                                  04123800
041239 8100-WRITE-OUTPUT-REC.                                           04123900
041240                                                                  04124000
041241     WRITE PKSL-EXTRACT-RECORD  FROM                              04124100
041242                          PC068-RECORD-LAYOUT.                    04124200
041243     ADD 1 TO WS-WRITE-COUNT1.                                    04124300
041244                                                                  04124400
041245 8200-WRITE-REPORT-REC.                                           04124500
041246                                                                  04124600
041247     WRITE PKSL-REPORT-RECORD FROM PC070-RECORD-LAYOUT.           04124700
041248                                                                  04124800
041249 9000-TERMINATE.                                                  04124900
041250                                                                  04125000
041260     PERFORM 7120-CLOSE-PKSL-CSR2.                                04126000
041261                                                                  04126100
041262     CLOSE PKSL-EXTRACT-FILE                                      04126200
041263           PKSL-REPORT-FILE.                                      04126300
041264                                                                  04126400
041265     DISPLAY '************************'.                          04126500
041266     DISPLAY '******* PCKUT097 *******'.                          04126600
041267     DISPLAY '************************'.                          04126700
041268     DISPLAY SPACES.                                              04126800
041269                                                                  04126900
041270     MOVE WS-FETCH-CNT1         TO WS-DISPLAY-COUNT.              04127000
041280     DISPLAY 'TOTAL RECS TYPE 1 = ' WS-DISPLAY-COUNT.             04128000
041290                                                                  04129000
041300     MOVE WS-FETCH-CNT2         TO WS-DISPLAY-COUNT.              04130000
041400     DISPLAY 'TOTAL RECS TYPE 2 = ' WS-DISPLAY-COUNT.             04140000
041500                                                                  04150000
041600     MOVE WS-WRITE-COUNT1        TO WS-DISPLAY-COUNT.             04160000
041700     DISPLAY 'TOTAL HANGING PACKSLIP RECORDS = '                  04170000
041800                                               WS-DISPLAY-COUNT.  04180000
041900     DISPLAY SPACES                                               04190000
042000     DISPLAY '************************'.                          04200000
042100                                                                  04210000
042200 9900-DB2-ABEND.                                                  04220000
042300                                                                  04230000
042400     MOVE SQLCODE TO WS-SQLCODE.                                  04240000
042500     DISPLAY '*** DB2 ERROR '.                                    04250000
042600     DISPLAY '*** SQLCODE   = ' WS-SQLCODE.                       04260000
042700     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 04270000
042800     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               04280000
042900     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               04290000
043000     DISPLAY '*** MESSAGE   = ' WS-DB2-OPERATION-MESSAGE-1.       04300000
043100     DISPLAY '***           = ' WS-DB2-OPERATION-MESSAGE-2.       04310000
043200     DISPLAY '***           = ' WS-DB2-OPERATION-MESSAGE-3.       04320000
043300     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             04330000
043400                                                                  04340000
043500     COPY DPPD004.                                                04350000
043600                                                                  04360000
043700     MOVE +4013                  TO WS-ABEND-CODE.                04370000
043800     CALL 'ILBOABN0' USING WS-ABEND-CODE.                         04380000
