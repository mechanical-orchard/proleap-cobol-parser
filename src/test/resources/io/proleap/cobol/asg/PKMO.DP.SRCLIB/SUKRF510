000100******************************************************************00010025
000200 IDENTIFICATION DIVISION.                                         00020025
000300******************************************************************00030025
000400                                                                  00040025
000500 PROGRAM-ID.             SUKRF510.                                00050025
000600 AUTHOR.                 MICHAEL WALTERS.                         00060025
000700 INSTALLATION.           KOHLS.                                   00070025
000800 DATE-WRITTEN            SEPTEMBER, 1997.                         00080025
000900 DATE-COMPILED.                                                   00090025
001000                                                                  00100025
001100******************************************************************00110025
001200* THIS PROGRAM DISPLAYS THE CARTON AUDIT STATUS/CONTINUATION      00120025
001300* SCREEN.  IT WILL ALLOW THE USER TO CONTINUE OR CLOSE THE AUDIT  00130025
001400* NUMBER THEY ENTERED ON THE PREVIOUS SCREEN. OR PRINT ONE OF THE 00140025
001500* WIDE VARIETY OF WONDERFUL REPORTS THAT THIS MARVELOUS SYSTEM    00150025
001600* WILL PRODUCE FOR THE USERS (A WONDER GROUP OF PEOPLE)           00160025
001700******************************************************************00170025
001710*  CHANGED 12/06/13 BY SHOBHIT BAIJAL                             00171025
001720*   PR# 5148D  ADD LOGIC TO SUBMIT ONE OR MORE JOBS FOR REPORTS   00172025
001730*              DEPENDING ON THE AUDIT TYPE                        00173025
001740*              QC OR RF AUDIT - SUBMIT JOB WITH 1 AUDIT CONTROL # 00174025
001750*              COMBINED AUDIT - SUBMIT 2 JOBS WITH 1 AUDIT CONTROL00175025
001760*                               FOR EACH OF RFID AND QC AUDIT     00176025
001770*              MANUAL AUDIT   - SUBMIT JOB WITH 1 AUDIT CONTROL # 00177025
001771*  CHANGED 04/28/14 BY SHOBHIT BAIJAL                             00177125
001772*   PR# 5148D  ADDED LOGIC TO IDENTIFY IF DEPARTMENT IS RFID      00177225
001773*              TAGGING OR NOT FOR MANUAL AUDITS AND SET THE COMBO 00177325
001774*              FLAG ACCORDINGLY.                                  00177425
001775*---------------------------------------------------------------* 00177525
001776* CHANGED 11/16/2021    BY JIM HUNTER      WR: CHG0263968         00177625
001777* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00177725
001778* MAKING THE CALL DYNAMIC VS STATIC.                              00177825
001779******************************************************************00177925
001780                                                                  00178025
001790******************************************************************00179025
001800 ENVIRONMENT DIVISION.                                            00180025
001900******************************************************************00190025
002000                                                                  00200025
002100******************************************************************00210025
002200 DATA DIVISION.                                                   00220025
002300******************************************************************00230025
002400                                                                  00240025
002500******************************************************************00250025
002600 WORKING-STORAGE SECTION.                                         00260025
002700******************************************************************00270025
002800 01  CA-COMMAREA.                                                 00280025
002900     COPY SUWS006.                                                00290025
003000    05  CA-PROGRAM-COMMAREA.                                      00300025
003100         10  CA-SELECTION-X              PIC  X(01)  VALUE SPACES.00310025
003200         10  CA-SELECTION  REDEFINES  CA-SELECTION-X              00320025
003300                                         PIC  9(01).              00330025
003400             88  CA-VALID-SELECTION      VALUE 1, 2, 3.           00340025
003500             88  CA-CONTINUE-SELECTION   VALUE 1.                 00350025
003600             88  CA-CLOSE-SELECTION      VALUE 2.                 00360025
003700             88  CA-PRINT-SELECTION      VALUE 3.                 00370025
003800         10  CA-CONFIRM-IND              PIC  X      VALUE SPACES.00380025
003900             88  CA-CONFIRM-OFF          VALUE ' '.               00390025
004000             88  CA-CONFIRM-RESTART      VALUE 'R'.               00400025
004100             88  CA-CONFIRM-CLOSE        VALUE 'C'.               00410025
004200         10  CA-PRTR-CNTL-IND            PIC  X(01).              00420025
004300         10  CA-TRACK-NBR                PIC  9(01).              00430025
004400         10  CA-LOGISTICS-PRINTER        PIC  X(08).              00440025
004410             88  CA-PRINT-TO-FILE             VALUE 'FILE'.       00441031
004500         10  CA-BRCDE-IND                PIC  X(01).              00450025
004600                                                                  00460025
004700*                                                                 00470025
004800 01  DK-DB2-KEYS.                                                 00480025
004900     05  DK-AUDIT-CNTL-NBR               PIC S9(09) COMP.         00490025
005000     05  DK-OPER-UNT-ID                  PIC S9(04) COMP.         00500025
005100*                                                                 00510025
006300 01  PC-PROGRAM-CONSTANTS.                                        00630025
006400     05  PC-01                           PIC  X(02)  VALUE '01'.  00640025
006500     05  PC-STARTED-STATUS               PIC  X(18)  VALUE        00650025
006600         'STARTED FOR:      '.                                    00660025
006700     05  PC-CLOSED-STATUS                PIC  X(18)  VALUE        00670025
006800         'CLOSED FOR:       '.                                    00680025
006900     05  PC-QC-AUD-CPLTE                 PIC  X(19)  VALUE        00690025
007000         'QC AUD CPLT-RF ONLY'.                                   00700025
007100     05  PC-RETURN-PGM                   PIC  X(08)  VALUE        00710025
007200         'SUKRF509'.                                              00720025
007300     05  PC-REPORT-PGM                   PIC  X(08)  VALUE        00730025
007400         'SUKRP002'.                                              00740025
007500     05  PC-PRTR-VALIDATION-PGM          PIC  X(08)  VALUE        00750025
007600         'DPKCS060'.                                              00760025
007700     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00770025
007800         'SUKRF510'.                                              00780025
007900     05  PC-PRINT-PROGRAM-NAME           PIC  X(08)  VALUE        00790025
008000         'SUKRF523'.                                              00800025
008100     05  PC-AUDIT-CONT-SCREEN            PIC  X(08)  VALUE        00810025
008200         'SUKRF520'.                                              00820025
008210     05  PC-OPEN-CARTON-PROGRAM-NAME     PIC  X(08)  VALUE        00821025
008220         'SUKRF511'.                                              00822025
008230     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE 'S510'.00823025
008240     05  PC-CANNOT-CLOSE-AUDIT           PIC  X(18)  VALUE        00824025
008250         'CANNOT CLOSE AUDIT'.                                    00825025
008260     05  PC-AUDIT-CLOSED-F3-EXIT-MSG     PIC  X(19)  VALUE        00826025
008270         'AUDIT CLOSD F3-EXIT'.                                   00827025
008280     05  PC-TRANS-UNAVAILABLE-MSG   PIC X(19) VALUE               00828025
008290                                           'TRANS NOT AVAILABLE'. 00829025
008300     05  PC-DEFAULT-TIME                 PIC  X(26)  VALUE        00830025
008310                                 '9999-09-09-09.09.09.999999'.    00831025
008311     05  PC-PRINT-TO-FILE                PIC  X(04) VALUE 'FILE'. 00831131
008312     05  PC-PRINT-TO-FILE-ERR-MSG   PIC X(19) VALUE               00831227
008313                                           'PRT-TO-FILE INVALID'. 00831327
008320                                                                  00832025
008330                                                                  00833025
008340 01  PS-PROGRAM-SWITCHES.                                         00834025
008350     05  PS-SYSTEM-AUDIT-FOUND-SW       PIC X(01)    VALUE 'N'.   00835025
008360         88  PS-SYSTEM-AUDIT-NOT-FOUND               VALUE 'N'.   00836025
008370         88  PS-SYSTEM-AUDIT-FOUND                   VALUE 'Y'.   00837025
008380     05  PS-ABEND-IND                   PIC X(01)    VALUE 'N'.   00838025
008390         88  PS-NO-ABEND-IN-PROGRESS                 VALUE 'N'.   00839025
008400         88  PS-ABEND-IN-PROGRESS                    VALUE 'Y'.   00840025
008500     05  PS-INTERNAL-READER-ENQ-DEQ-IND                           00850025
008600                                        PIC X(01)    VALUE 'D'.   00860025
008700         88  PS-INTERNAL-READER-ENQUEUED             VALUE 'E'.   00870025
008800         88  PS-INTERNAL-READER-DEQUEUED             VALUE 'D'.   00880025
008900     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   00890025
009000         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   00900025
009100         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   00910025
009200     05  PS-AUDIT-NBR-IND                PIC  X(01)  VALUE 'N'.   00920025
009300         88  PS-AUDIT-NBR-NOT-EXISTS                 VALUE 'N'.   00930025
009400         88  PS-AUDIT-NBR-EXISTS                     VALUE 'Y'.   00940025
009410     05  PS-SWITCHING-TO-RFID-AUDIT-IND  PIC  X(01)  VALUE 'N'.   00941025
009420         88  PS-SWITCHING-TO-RFID-AUDIT              VALUE 'Y'.   00942025
009430         88  PS-SWITCHING-TO-RFID-AUDIT-NO           VALUE 'N'.   00943025
009440                                                                  00944025
009450     05  PS-DEPT-RFID-TAGGING-SW         PIC  X(01)  VALUE SPACE. 00945025
009460         88 PS-DEPT-TAGGING              VALUE 'Y'.               00946025
009470         88 PS-DEPT-NOT-TAGGING          VALUE 'N'.               00947025
009471     05  PS-PRINT-TO-FILE-SW             PIC  X(01)  VALUE 'N'.   00947129
009472         88  PS-PRINT-TO-FILE-NO                     VALUE 'N'.   00947229
009473         88  PS-PRINT-TO-FILE-YES                    VALUE 'Y'.   00947329
009480                                                                  00948025
009490                                                                  00949025
009500 01  PV-PROGRAM-VARIABLES.                                        00950025
009600     05  PV-SYSTEM-ID.                                            00960025
009700         10  FILLER              PIC  X(04)   VALUE SPACE.        00970025
009800         10  PV-REGION-IND       PIC  X(01).                      00980025
009900             88  PV-TEST-CICS                 VALUE 'T'.          00990025
010000             88  PV-QA-CICS                   VALUE 'Q'.          01000025
010100             88  PV-PROD-CICS                 VALUE 'P'.          01010025
010200             88  PV-LEARN-CICS                VALUE 'L'.          01020025
010300         10  FILLER              PIC X(03)    VALUE SPACES.       01030025
010400     05  PV-DB2-COUNT                    PIC S9(09)  VALUE ZERO   01040025
010500                                                     COMP.        01050025
010600     05  PV-CLOSED-DAYS                  PIC S9(04)  VALUE ZERO   01060025
010700                                                     COMP.        01070025
010800     05  PV-CLOSED-HOURS                 PIC S9(02)  VALUE ZERO   01080025
010900                                                     COMP.        01090025
011000     05  PV-CLOSED-MINUTES               PIC S9(02)  VALUE ZERO   01100025
011100                                                     COMP.        01110025
011200     05  PV-TOTAL-CLOSED-MINUTES         PIC S9(09)  VALUE ZERO   01120025
011300                                                     COMP.        01130025
011400     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   01140025
011500                                                     COMP SYNC.   01150025
011600     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 01160025
011700     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 01170025
011800     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01180025
011900                                                     COMP SYNC.   01190025
012000     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 01200025
012100     05  PV-OPER-UNT-ID                  PIC S9(04)  VALUE ZEROS  01210025
012200                                                     COMP.        01220025
012300     05  PV-FCLTY-ID                     PIC S9(04)  VALUE ZEROS  01230025
012400                                                     COMP.        01240025
012500     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   01250025
012600                                                     COMP.        01260025
012700     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   01270025
012800                                                     COMP SYNC.   01280025
024900******************************************************************02490025
025000*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      02500025
025100******************************************************************02510025
025200     COPY DFHAID.                                                 02520025
025300                                                                  02530025
025400                                                                  02540025
025500******************************************************************02550025
025600*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                02560025
025700******************************************************************02570025
025800     COPY DPWS013.                                                02580025
025900                                                                  02590025
026000******************************************************************02600025
026100*  SENDING/RECEIVING AREA FOR THE                                 02610025
026200*  PRINTER VALIDATION ROUTING (DPKCS060)                          02620025
026300******************************************************************02630025
026400     COPY DPWS072.                                                02640025
026500                                                                  02650025
026600******************************************************************02660025
026700*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        02670025
026800******************************************************************02680025
026900     COPY DPWS008.                                                02690025
027000                                                                  02700025
027100******************************************************************02710025
027200*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 02720025
027300*****************************************************************.02730025
027400     COPY DPWS010I.                                               02740025
027500                                                                  02750025
027600******************************************************************02760025
027700*  RANDOM NUMBER AREA.                                            02770025
027800******************************************************************02780025
027900     COPY DPWS902.                                                02790025
028000                                                                  02800025
028100******************************************************************02810025
028200*  GENERATED DSECT FOR THE SUKM510 MAPSET                         02820025
028300******************************************************************02830025
028400     COPY SUKM510.                                                02840025
028500                                                                  02850025
028600******************************************************************02860025
028700*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   02870025
028800******************************************************************02880025
028900     COPY DPWS015.                                                02890025
029000                                                                  02900025
029100*----------------------------------------------------------------*02910025
029200* HELP SCREEN COMMAREA                                            02920025
029300     COPY PCWS192.                                                02930025
029400*----------------------------------------------------------------*02940025
029500* HELP SCREEN WORK AREA                                           02950025
029600     COPY PCWS188.                                                02960025
029700                                                                  02970025
029800                                                                  02980025
029900******************************************************************02990025
030000*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL MESSAGES      03000025
030100*  TO BE DISPLAYED ON THE LRT                                     03010025
030200******************************************************************03020025
030300     COPY SUWS005.                                                03030025
030400                                                                  03040025
030500******************************************************************03050025
030600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE COMPANY CONTROL    03060025
030700*  TABLE (TCOCNTL)                                                03070025
030800******************************************************************03080025
030900     EXEC SQL                                                     03090025
031000         INCLUDE TCOCNTL                                          03100025
031100     END-EXEC.                                                    03110025
031200                                                                  03120025
031300******************************************************************03130025
031400*    DB2 AREA FOR THE PO AUDIT REQUEST TABLE (SUT_PO_AUD_REQ)   * 03140025
031500******************************************************************03150025
031600     EXEC SQL                                                     03160025
031700         INCLUDE SUT00015                                         03170025
031800     END-EXEC.                                                    03180025
031900                                                                  03190025
032000******************************************************************03200025
032100*    DB2 AREA FOR THE PO AUDIT EXCEPTION TABLE (SUT_PO_AUD_EXC)  *03210025
032110******************************************************************03211025
032120     EXEC SQL                                                     03212025
032130         INCLUDE SUT00014                                         03213025
032140     END-EXEC.                                                    03214025
032150                                                                  03215025
032160******************************************************************03216025
032170*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      03217025
032180*  AUDIT TABLE (TSUNAUD)                                          03218025
032190******************************************************************03219025
032200     EXEC SQL                                                     03220025
032300         INCLUDE TSUNAUD                                          03230025
032400     END-EXEC.                                                    03240025
032500                                                                  03250025
032600******************************************************************03260025
032700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      03270025
032800*  AUDIT TRANSATION TABLE (TSUATRN)                               03280025
032900******************************************************************03290025
033000     EXEC SQL                                                     03300025
033100         INCLUDE TSUATRN                                          03310025
033200     END-EXEC.                                                    03320025
033300                                                                  03330025
033310******************************************************************03331025
033320*    DB2 DCLGEN FOR THE VENDOR PURCHASE TABLE                     03332025
033330*    (TPURCHS)                                                    03333025
033340******************************************************************03334025
033350     EXEC SQL                                                     03335025
033360          INCLUDE TPURCHS                                         03336025
033370     END-EXEC.                                                    03337025
033380                                                                  03338025
033390******************************************************************03339025
033391*    DB2 DCLGEN FOR THE VENDOR AGREEMENT TABLE                    03339125
033392*    (TVNDAGR)                                                    03339225
033393******************************************************************03339325
033394     EXEC SQL                                                     03339425
033395          INCLUDE TVNDAGR                                         03339525
033396     END-EXEC.                                                    03339625
033397                                                                  03339725
033399******************************************************************03339925
033400*    DB2 AREA FOR THE RIT_RFID_VRFN TABLE                       * 03340025
033401******************************************************************03340125
033402     EXEC SQL                                                     03340225
033403         INCLUDE RIT00000                                         03340325
033404     END-EXEC.                                                    03340425
033406                                                                  03340625
033407******************************************************************03340728
033408*    PARM TABLE                                                 * 03340828
033409******************************************************************03340928
033410     EXEC SQL                                                     03341028
033411         INCLUDE TKRPRPM                                          03341128
033412     END-EXEC.                                                    03341228
033413                                                                  03341328
033414******************************************************************03341425
033415*  COMMUNICATIONS AREA FOR DB2                                    03341525
033416******************************************************************03341625
033417     EXEC SQL                                                     03341725
033420         INCLUDE SQLCA                                            03342025
033430     END-EXEC.                                                    03343025
033440                                                                  03344025
033450******************************************************************03345025
033460 LINKAGE SECTION.                                                 03346025
033470******************************************************************03347025
033480 01  DFHCOMMAREA.                                                 03348025
033490     05  FILLER                         OCCURS  1 TO 4072 TIMES   03349025
033500                                        DEPENDING ON EIBCALEN.    03350025
033600         10  FILLER                     PIC X.                    03360025
033700                                                                  03370025
033800                                                                  03380025
033900******************************************************************03390025
034000 PROCEDURE DIVISION.                                              03400025
034100******************************************************************03410025
034200 0000-PROGRAM-MAINLINE.                                           03420025
034300     MOVE DFHCOMMAREA  TO  CA-COMMAREA.                           03430025
034400     MOVE LOW-VALUES   TO  SU510AI.                               03440025
034500                                                                  03450025
034600     MOVE SU006-SHIP-UNIT-NBR-X                                   03460025
034700                       TO  AMSGLNO.                               03470025
034800     EVALUATE TRUE                                                03480025
034900****************************************************************  03490025
035000* DPKRF278 IS THE PGM FOR THE HELP SCREEN.                        03500025
035100****************************************************************  03510025
035200         WHEN EIBTRNID = 'Z278'                                   03520025
035300             MOVE DFHCOMMAREA          TO PC192-COMMAREA          03530025
035400             MOVE PC192-HOST-SAVE-AREA TO CA-COMMAREA             03540025
035500             SET SU006-PROCESS-SCREEN  TO TRUE                    03550025
035600             SET SU006-PROCESS-SCREEN                             03560025
035700                 CA-CONFIRM-OFF     TO TRUE                       03570025
035800             PERFORM 1000-SETUP-SCREEN                            03580025
035900             PERFORM 8000-SEND-MAP                                03590025
036000             PERFORM 8200-RETURN-TRANID                           03600025
036100                                                                  03610025
036200         WHEN EIBCALEN = ZERO                                     03620025
036300         WHEN EIBAID = DFHCLEAR                                   03630025
036400         WHEN SU006-INITIALIZE-SCREEN                             03640025
036500             INITIALIZE CA-PROGRAM-COMMAREA                       03650025
036600             SET SU006-PROCESS-SCREEN                             03660025
036700                 CA-CONFIRM-OFF     TO TRUE                       03670025
036800             PERFORM 1000-SETUP-SCREEN                            03680025
036900                                                                  03690025
037000             PERFORM 8000-SEND-MAP                                03700025
037100             PERFORM 8200-RETURN-TRANID                           03710025
037200                                                                  03720025
037300         WHEN EIBAID = DFHENTER                                   03730025
037400             PERFORM 1200-RECEIVE-MAP                             03740025
037500             PERFORM 1300-EDIT-SELECTION                          03750025
037600             SET CA-CONFIRM-OFF     TO TRUE                       03760025
037700             PERFORM 2000-PROCESS-SCREEN                          03770025
037800                                                                  03780025
037900         WHEN EIBAID = DFHPF2                                     03790025
038000             EVALUATE TRUE                                        03800025
038100               WHEN CA-CONFIRM-CLOSE                              03810025
038200                   PERFORM 2300-CLOSE-AUDIT                       03820025
038300                   MOVE PM-AUDIT-CLOSE-MSG    TO AMSGLNO          03830025
038400                   MOVE PC-CLOSED-STATUS      TO ASTATUSO         03840025
038500                   IF SU006-SPOT-AUDIT-CHECK                      03850025
038600                      PERFORM 1030-GET-UNT-AUD-ERR-IND            03860025
038700                   END-IF                                         03870025
038710                                                                  03871025
038780               WHEN CA-CONFIRM-RESTART                            03878025
038790                   PERFORM 2200-RESTART-AUDIT                     03879025
038800                   IF SU006-SYSTEM-GENERATED-AUDIT                03880025
038900                       MOVE PC-OPEN-CARTON-PROGRAM-NAME           03890025
039000                                        TO PV-TRANSFER-PROGRAM    03900025
039100                   ELSE                                           03910025
039200                       MOVE PC-AUDIT-CONT-SCREEN                  03920025
039300                                        TO PV-TRANSFER-PROGRAM    03930025
039400                   END-IF                                         03940025
039500                   PERFORM 2100-XCTL-TO-SELECTED-PROGRAM          03950025
039510                                                                  03951025
039600               WHEN OTHER                                         03960025
039700                   MOVE PM-UNRECOGNIZED-PF-KEY-MSG                03970025
039800                                              TO  AMSGLNO         03980025
039900             END-EVALUATE                                         03990025
040000                                                                  04000025
040100         WHEN EIBAID = DFHPF3                                     04010025
040200             MOVE PC-RETURN-PGM         TO  PV-TRANSFER-PROGRAM   04020025
040300             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                04030025
040400                                                                  04040025
040500         WHEN EIBAID = DFHPF1                                     04050025
040600              PERFORM 1400-HELP-SCREEN                            04060025
040610                                                                  04061025
040620         WHEN OTHER                                               04062025
040630             MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO  AMSGLNO         04063025
040640                                                                  04064025
040650     END-EVALUATE.                                                04065025
040660                                                                  04066025
040670     PERFORM 8100-SEND-DATA-ONLY.                                 04067025
040680     PERFORM 8200-RETURN-TRANID.                                  04068025
040690                                                                  04069025
040700     GOBACK.                                                      04070025
040800****************************************************************  04080025
040900* 1000-SETUP-SCREEN                                               04090025
041000*    INITIAL SETUP OF AUDIT NUMBER AND STATUS                     04100025
041100****************************************************************  04110025
041200 1000-SETUP-SCREEN.                                               04120025
041300                                                                  04130025
041400*    SET STATUS FIELD                                             04140025
041500     EVALUATE TRUE                                                04150025
041600         WHEN SU006-AUDIT-INPROCESS                               04160025
041700         WHEN SU006-AUDIT-POSTPONE                                04170025
041800             MOVE PC-STARTED-STATUS   TO ASTATUSO                 04180025
041900         WHEN SU006-AUDIT-COMPLETE                                04190025
041901             SET PS-SWITCHING-TO-RFID-AUDIT-NO TO TRUE            04190125
041902             IF SU006-SYSTEM-GENERATED-AUDIT                      04190225
041903               IF SU006-QC-AND-RFID-AUD                           04190325
041904                 MOVE SU006-RFID-AUDIT-CNTL-NBR                   04190425
041905                   TO DK-AUDIT-CNTL-NBR                           04190525
041906                 PERFORM 3200-SELECT-AUDIT                        04190625
041907                 IF (SUT00015-AUD-STAT-CDE = 'P' OR               04190725
041908                     SUT00015-AUD-STAT-CDE = 'F' OR               04190825
041909                     SUT00015-AUD-STAT-CDE = 'N')                 04190925
041910                   MOVE PC-CLOSED-STATUS    TO ASTATUSO           04191025
041920                 ELSE                                             04192025
041930                   MOVE PC-STARTED-STATUS   TO ASTATUSO           04193025
041940                   SET SU006-RFID-AUDIT    TO TRUE                04194025
041950                   SET SU006-RFID-AUD-ONLY TO TRUE                04195025
041960                   SET SU006-NO-AUD-ERR    TO TRUE                04196025
041970                   SET PS-SWITCHING-TO-RFID-AUDIT TO TRUE         04197025
041980                   MOVE SU006-RFID-AUDIT-CNTL-NBR TO              04198025
041990                     SU006-AUDIT-CNTL-NBR                         04199025
041991                   MOVE ZERO TO SU006-RFID-AUDIT-CNTL-NBR         04199125
041992                 END-IF                                           04199225
041993               ELSE                                               04199325
041994                   MOVE PC-CLOSED-STATUS    TO ASTATUSO           04199425
041995               END-IF                                             04199525
041996             ELSE                                                 04199625
041997                 MOVE PC-CLOSED-STATUS    TO ASTATUSO             04199725
041998             END-IF                                               04199825
041999     END-EVALUATE.                                                04199925
042000                                                                  04200025
042100*    SET AUDIT CONTROL NUMBER                                     04210025
042200     MOVE SU006-AUDIT-CNTL-NBR-X      TO ACNTLO.                  04220025
042300                                                                  04230025
042400*    GET LAST SCANNED CARTON NUMBER (SHIPPING UNIT ID)            04240025
042500     PERFORM 1020-GET-SHIP-CODE.                                  04250025
042600                                                                  04260025
042700*** IF CHANGING FROM COMBO TO RF ONLY DISPLAY MESSAGE             04270025
042800     IF PS-SWITCHING-TO-RFID-AUDIT                                04280025
042810        MOVE PC-QC-AUD-CPLTE TO AMSGLNO                           04281025
042820     END-IF.                                                      04282025
042830*    IF NEEDED, GET DEFAULT PRINTER ID                            04283025
042840     IF SU006-PRINTER-DEST = SPACES                               04284025
042850         PERFORM 1010-GET-PRINTER-IDS                             04285025
042860                                                                  04286025
042870         EVALUATE TRUE                                            04287025
042880           WHEN  SU006-RECV-PRCS-AREA                             04288025
042890               MOVE COCNTL-CA-RCVG-PRTR-ID                        04289025
042900                                      TO SU006-PRINTER-DEST       04290025
043000           WHEN  SU006-FLAT-PRCS-AREA                             04300025
043100               MOVE COCNTL-CA-FLAT-PRTR-ID                        04310025
043200                                      TO SU006-PRINTER-DEST       04320025
043300           WHEN  SU006-SHIP-PRCS-AREA                             04330025
043400               MOVE COCNTL-CA-SHIP-PRTR-ID                        04340025
043500                                      TO SU006-PRINTER-DEST       04350025
043600         END-EVALUATE                                             04360025
043700         MOVE COCNTL-CA-LGS-PRTR-ID   TO CA-LOGISTICS-PRINTER     04370025
043800     END-IF.                                                      04380025
043900                                                                  04390025
044000     MOVE SU006-PRINTER-DEST TO ADESTO.                           04400025
044100                                                                  04410025
044200                                                                  04420025
044300******************************************************************04430025
044400* 1010-GET-PRINTER-IDS                                           *04440025
044500*    SELECT THE DEFAULT PROCESSING AREA PRINTER, AND THE DEFAULT *04450025
044600* LOGISTICS PRINTER FROM THE COMPANY CONTROL TABLE               *04460025
044700* THERE ARE DEFAULTS FOR EACH AUDITING PROCESS AREA & LOGISTICS  *04470025
044800* WITHIN EACH FACILITY.  SELECT OF ALL FOUR ID'S FOR THE GIVEN   *04480025
044900* OPER UNIT ID AND THEN DETERMINE WHICH TO DISPLAY.              *04490025
045000******************************************************************04500025
045100 1010-GET-PRINTER-IDS.                                            04510025
045200                                                                  04520025
045300     MOVE SU006-OPER-UNT-ID     TO DK-OPER-UNT-ID.                04530025
045400                                                                  04540025
045500     EXEC SQL                                                     04550025
045600            SELECT                                                04560025
045700                    CA_RCVG_PRTR_ID                               04570025
045800                   ,CA_FLAT_PRTR_ID                               04580025
045900                   ,CA_SHIP_PRTR_ID                               04590025
046000                   ,CA_LGS_PRTR_ID                                04600025
046100            INTO                                                  04610025
046200                   :COCNTL-CA-RCVG-PRTR-ID                        04620025
046300                  ,:COCNTL-CA-FLAT-PRTR-ID                        04630025
046400                  ,:COCNTL-CA-SHIP-PRTR-ID                        04640025
046500                  ,:COCNTL-CA-LGS-PRTR-ID                         04650025
046600            FROM                                                  04660025
046700                    TCOCNTL                                       04670025
046800            WHERE                                                 04680025
046900                  OPER_UNT_ID     = :DK-OPER-UNT-ID               04690025
047000              AND FCLTY_ID        = 1                             04700025
047100     END-EXEC.                                                    04710025
047200                                                                  04720025
047300     IF SQLCODE = ZERO                                            04730025
047400         CONTINUE                                                 04740025
047500     ELSE                                                         04750025
047600             MOVE '1010-GET-PRINTER-IDS'                          04760025
047700                                         TO DP013-PARAGRAPH       04770025
047800             MOVE 'SELECT OF TCOCNTL'    TO DP013-MESSAGE-TEXT (1)04780025
047900             MOVE DK-OPER-UNT-ID         TO DP013-MESSAGE-TEXT (2)04790025
048000             MOVE SQLCA                  TO DP013-SQLCA           04800025
048100             MOVE 'TCOCNTL'            TO DP013-DB2-TABLE-NAME (1)04810025
048200             SET DP013-DB2-ABEND         TO TRUE                  04820025
048300             SET DP013-NO-ROLLBACK       TO TRUE                  04830025
048400             PERFORM 9999-WRITE-CICS-LOG-MSG                      04840025
048500                                                                  04850025
048600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               04860025
048700             MOVE -1                     TO ASELECTL              04870025
048800             PERFORM 8100-SEND-DATA-ONLY                          04880025
048900             PERFORM 8200-RETURN-TRANID                           04890025
049000     END-IF.                                                      04900025
049100                                                                  04910025
049200                                                                  04920025
049300******************************************************************04930025
049400* 1020-GET-SHIP-CODE                                             *04940025
049500*    SELECT THE SHIPPING UNIT ID NUMBER FOR THE LAST CARTON THAT *04950025
049600* WAS BEING AUDITED (CARTON WITH THE LARGEST START TIMESTAMP)    *04960025
049700******************************************************************04970025
049800 1020-GET-SHIP-CODE.                                              04980025
049900                                                                  04990025
050000     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              05000025
050100                                                                  05010025
050200     EXEC SQL                                                     05020025
050300            SELECT                                                05030025
050400                   A.SHIPT_UNT_ID                                 05040025
050500            INTO                                                  05050025
050600                  :SUATRN-SHIPT-UNT-ID                            05060025
050700            FROM                                                  05070025
050800                   TSUATRN A                                      05080025
050900            WHERE                                                 05090025
051000                  A.AUD_CNTL_NBR  = :DK-AUDIT-CNTL-NBR            05100025
051100              AND A.UNT_AUD_STRT_TMST =                           05110025
051200            ( SELECT MAX (B.UNT_AUD_STRT_TMST)                    05120025
051300              FROM                                                05130025
051400                     TSUATRN B                                    05140025
051500              WHERE                                               05150025
051600                  B.AUD_CNTL_NBR  =     :DK-AUDIT-CNTL-NBR        05160025
051700              AND B.UNT_AUD_STRT_TMST <> :PC-DEFAULT-TIME)        05170025
051800     END-EXEC.                                                    05180025
051900                                                                  05190025
052000     EVALUATE TRUE                                                05200025
052100         WHEN SQLCODE = ZERO                                      05210025
052200             MOVE SUATRN-SHIPT-UNT-ID    TO SU006-SHIP-UNIT-NBR   05220025
052300             MOVE SU006-SHIP-UNIT-NBR-X  TO AMSGLNO               05230025
052400         WHEN SQLCODE = +100                                      05240025
052500             MOVE SPACES                 TO SU006-SHIP-UNIT-NBR-X 05250025
052600                                            AMSGLNO               05260025
052700         WHEN SQLWARN0 NOT = SPACES                               05270025
052800         WHEN SQLCODE < ZERO                                      05280025
052900         WHEN SQLCODE > ZERO                                      05290025
053000             MOVE '1020-GET-SHIP-CODE.'  TO DP013-PARAGRAPH       05300025
053100             MOVE 'SELECT OF TSUATRN'    TO DP013-MESSAGE-TEXT (1)05310025
053200             MOVE SU006-AUDIT-CNTL-NBR-X TO DP013-MESSAGE-TEXT (2)05320025
053300             MOVE SQLCA                  TO DP013-SQLCA           05330025
053400             MOVE 'TSUNAUD'            TO DP013-DB2-TABLE-NAME (1)05340025
053500             SET DP013-DB2-ABEND         TO TRUE                  05350025
053600             SET DP013-NO-ROLLBACK       TO TRUE                  05360025
053700             PERFORM 9999-WRITE-CICS-LOG-MSG                      05370025
053800                                                                  05380025
053900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               05390025
054000             MOVE -1                     TO ASELECTL              05400025
054100             PERFORM 8100-SEND-DATA-ONLY                          05410025
054200             PERFORM 8200-RETURN-TRANID                           05420025
054300     END-EVALUATE.                                                05430025
054400                                                                  05440025
054500******************************************************************05450025
054600* 1030-GET-UNT-AUD-ERR-IND.                                      *05460025
054700*    CHECK ALL THE UNIT AUDITS WITHIN THIS AUDIT TO SEE IF ANY   *05470025
054800* OF THEM HAVE THEIR ERROR INDICATORS SET                        *05480025
054900******************************************************************05490025
055000 1030-GET-UNT-AUD-ERR-IND.                                        05500025
055100                                                                  05510025
055200     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              05520025
055300                                                                  05530025
055400     EXEC SQL                                                     05540025
055500            SELECT UNT_AUD_ERR_IND                                05550025
055600            INTO   :SUATRN-UNT-AUD-ERR-IND                        05560025
055700            FROM   TSUATRN                                        05570025
055800            WHERE  AUD_CNTL_NBR   = :DK-AUDIT-CNTL-NBR            05580025
055810              AND  UNT_AUD_ERR_IND = 'Y'                          05581025
055820     END-EXEC.                                                    05582025
055830                                                                  05583025
055840     EVALUATE TRUE                                                05584025
055850       WHEN SQLCODE = ZERO                                        05585025
055860       WHEN SQLCODE = -811                                        05586025
055870           SET SU006-AUD-ERR         TO TRUE                      05587025
055880       WHEN SQLCODE = +100                                        05588025
055890           SET SU006-NO-AUD-ERR      TO TRUE                      05589025
055891       WHEN OTHER                                                 05589125
055892           MOVE '1030-GET-UNT-AUD-ERR-IND'                        05589225
055893                                         TO DP013-PARAGRAPH       05589325
055894           MOVE 'SELECT OF TSUATRN'    TO DP013-MESSAGE-TEXT (1)  05589425
055895           MOVE DK-OPER-UNT-ID         TO DP013-MESSAGE-TEXT (2)  05589525
055896           MOVE SQLCA                  TO DP013-SQLCA             05589625
055897           MOVE 'TSUATRN'            TO DP013-DB2-TABLE-NAME (1)  05589725
055898           SET DP013-DB2-ABEND         TO TRUE                    05589825
055899           SET DP013-NO-ROLLBACK       TO TRUE                    05589925
055900           PERFORM 9999-WRITE-CICS-LOG-MSG                        05590025
055901                                                                  05590125
055902           MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO                 05590225
055903           MOVE -1                     TO ASELECTL                05590325
055904           PERFORM 8100-SEND-DATA-ONLY                            05590425
055905           PERFORM 8200-RETURN-TRANID                             05590525
055906     END-EVALUATE.                                                05590625
055907                                                                  05590725
055908                                                                  05590825
055911 1200-RECEIVE-MAP.                                                05591125
055912     EXEC CICS                                                    05591225
055913         RECEIVE                                                  05591325
055914             MAP     ('SU510A')                                   05591425
055915             MAPSET  ('SUKM510')                                  05591525
055916             RESP    (PV-CICS-RESPONSE)                           05591625
055917     END-EXEC.                                                    05591725
055918                                                                  05591825
055919     EVALUATE TRUE                                                05591925
055920         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05592025
055930              PERFORM 1210-RECEIVE-SCREEN-FIELDS                  05593025
055940         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                05594025
055950              CONTINUE                                            05595025
055960         WHEN OTHER                                               05596025
055970              MOVE '1200-RECEIVE-MAP'                             05597025
055980                                     TO DP013-PARAGRAPH           05598025
055990              MOVE 'UNABLE TO RECEIVE MAP'                        05599025
056000                                     TO DP013-MESSAGE-TEXT (1)    05600025
056100              SET DP013-LOGIC-ABEND  TO TRUE                      05610025
056200              SET DP013-NO-ROLLBACK  TO TRUE                      05620025
056300              PERFORM 9999-WRITE-CICS-LOG-MSG                     05630025
056400     END-EVALUATE.                                                05640025
056500                                                                  05650025
056510                                                                  05651025
056600 1210-RECEIVE-SCREEN-FIELDS.                                      05660025
056700                                                                  05670025
056800     IF  ASELECTL > ZERO                                          05680025
056900         MOVE ASELECTI               TO CA-SELECTION-X            05690025
057000     END-IF.                                                      05700025
057100                                                                  05710025
057200     IF  ADESTL   > ZERO                                          05720025
057300         MOVE ADESTI                 TO SU006-PRINTER-DEST        05730025
057400     ELSE IF  ADESTF   = DP015-ERASE-EOF                          05740025
057500         MOVE SPACES                 TO SU006-PRINTER-DEST        05750025
057600                                        ADESTO                    05760025
057700     END-IF.                                                      05770025
057800                                                                  05780025
057810                                                                  05781025
057900**************************************************************    05790025
058000* EDIT ALL ENTERABLE FIELDS (OPERATING UNIT ID, AND SELECT)  *    05800025
058100**************************************************************    05810025
058200 1300-EDIT-SELECTION.                                             05820025
058300                                                                  05830025
058400*    CHECK TO MAKE SURE THE ENTERED SELECTION IS NUMERIC          05840025
058410                                                                  05841025
058500     MOVE CA-SELECTION-X             TO DP010I-UNEDITED-FIELD.    05850025
058600     MOVE 1                          TO DP010I-MAXIMUM-DIGITS.    05860025
058700     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  05870025
058800     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     05880025
058900                                                                  05890025
059000     CALL DP010I-NUMERIC-EDIT-ROUTINE                             05900025
059100          USING DP010I-NUMERIC-EDIT-AREA.                         05910025
059200                                                                  05920025
059300     IF  DP010I-ERROR-DETECTED                                    05930025
059400         MOVE PM-NUMERIC-VALUE-REQUIRED-MSG                       05940025
059500                                     TO AMSGLNO                   05950025
059600         MOVE -1                     TO ASELECTL                  05960025
059700         PERFORM 8100-SEND-DATA-ONLY                              05970025
059800         PERFORM 8200-RETURN-TRANID                               05980025
059900     ELSE                                                         05990025
060000         MOVE DP010I-NUMERIC-FIELD   TO CA-SELECTION              06000025
060100         IF NOT CA-VALID-SELECTION                                06010025
060200             MOVE PM-INVALID-SELECTION-MSG                        06020025
060300                                     TO AMSGLNO                   06030025
060400             MOVE -1                 TO ASELECTL                  06040025
060500             PERFORM 8100-SEND-DATA-ONLY                          06050025
060600             PERFORM 8200-RETURN-TRANID                           06060025
060700         END-IF                                                   06070025
060800     END-IF.                                                      06080025
060900                                                                  06090025
061000*    IF THE USER IS CLOSING THE AUDIT, CHECK THE PRINTER ID TO    06100025
061100*    MAKE SURE IT IS VALID (THIS IS THE DESTINATION THAT THE      06110025
061200*    AUTOMATIC CLOSE REPORTS ARE BEING SENT TO)                   06120025
061210                                                                  06121025
061300     IF CA-CLOSE-SELECTION                                        06130025
061400         IF SU006-SYSTEM-GENERATED-AUDIT                          06140025
061500             MOVE PC-CANNOT-CLOSE-AUDIT       TO  AMSGLNO         06150025
061600             MOVE -1                          TO  ADESTL          06160025
061700             PERFORM 8100-SEND-DATA-ONLY                          06170025
061800             PERFORM 8200-RETURN-TRANID                           06180025
061900         END-IF                                                   06190025
061910                                                                  06191025
062000         EVALUATE TRUE                                            06200025
062100           WHEN SU006-PRINTER-DEST = SPACES                       06210025
062200             MOVE PM-PRINTER-ID-REQUIRED-MSG  TO  AMSGLNO         06220025
062300             MOVE -1                          TO  ADESTL          06230025
062400             PERFORM 8100-SEND-DATA-ONLY                          06240025
062500             PERFORM 8200-RETURN-TRANID                           06250025
062510                                                                  06251025
062600           WHEN SU006-OVERRIDE-PRINT                              06260025
062700             CONTINUE                                             06270025
062701                                                                  06270127
062702           WHEN SU006-PRINTER-DEST = PC-PRINT-TO-FILE             06270227
062703                SET PS-PRINT-TO-FILE-NO  TO TRUE                  06270327
062704                PERFORM 1320-VALIDATE-PRINT-TO-FILE               06270427
062705                                                                  06270527
062706                IF  PS-PRINT-TO-FILE-YES                          06270627
062707                    MOVE SPACES           TO  CA-PRTR-CNTL-IND    06270727
062708                                              CA-BRCDE-IND        06270827
062709                    MOVE ZEROES           TO  CA-TRACK-NBR        06270927
062710                ELSE                                              06271027
062711                    MOVE PC-PRINT-TO-FILE-ERR-MSG  TO  AMSGLNO    06271127
062712                    MOVE -1                        TO  ADESTL     06271227
062713                    PERFORM 8100-SEND-DATA-ONLY                   06271327
062714                    PERFORM 8200-RETURN-TRANID                    06271427
062715                END-IF                                            06271527
062720                                                                  06272025
062800           WHEN OTHER                                             06280025
062900             PERFORM 1310-VALIDATE-PRINTER                        06290025
063000             IF DP072-PRTR-PRTR-TRK-STAT-CDE EQUAL 'A'            06300025
063100                 MOVE DP072-PRTR-PRTR-CNTL-IND                    06310025
063200                                          TO  CA-PRTR-CNTL-IND    06320025
063600                 MOVE DP072-PRTR-TRACK-NBR                        06360025
063700                                          TO  CA-TRACK-NBR        06370025
063800                 MOVE DP072-PRTR-PRTR-BRCDE-IND                   06380025
063900                                          TO  CA-BRCDE-IND        06390025
064000             ELSE                                                 06400025
064100                 MOVE PM-INVALID-PRINTER-ID-MSG TO  AMSGLNO       06410025
064200                 MOVE -1                        TO  ADESTL        06420025
064300                 PERFORM 8100-SEND-DATA-ONLY                      06430025
064400                 PERFORM 8200-RETURN-TRANID                       06440025
064500             END-IF                                               06450025
064600         END-EVALUATE                                             06460025
064700     END-IF.                                                      06470025
064800                                                                  06480025
064900                                                                  06490025
065000***************************************************************** 06500025
065100*   1310-VALIDATE-PRINTER                                       * 06510025
065200* CALLS DPKCS060 TO VALIDATE THE PRINTER ID                     * 06520025
065300***************************************************************** 06530025
065400 1310-VALIDATE-PRINTER.                                           06540025
065500                                                                  06550025
065600     MOVE SU006-PRINTER-DEST         TO DP072-PRINTER-ID.         06560025
065700     MOVE PC-REPORT-PGM              TO DP072-RPT-PGM-NME.        06570025
065800     MOVE PC-01                      TO DP072-RPT-PGM-TYP-ID.     06580025
065900     MOVE SU006-DFLT-OPER-UNT-ID     TO DP072-ORIGIN-OPER-UNT-ID. 06590025
066000     MOVE SU006-OPER-UNT-ID          TO DP072-OPER-UNT-ID.        06600025
066100     MOVE 1                          TO DP072-ORIGIN-FCLTY-ID     06610025
066200                                        DP072-FCLTY-ID.           06620025
066300     SET DP072-VALIDATE              TO TRUE.                     06630025
066400                                                                  06640025
066500     EXEC CICS                                                    06650025
066600         LINK PROGRAM  (PC-PRTR-VALIDATION-PGM)                   06660025
066700              COMMAREA (DP072-COMM-AREA)                          06670025
066800              RESP     (PV-CICS-RESPONSE)                         06680025
066900     END-EXEC                                                     06690025
067000                                                                  06700025
067100     EVALUATE TRUE                                                06710025
067200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06720025
067300             CONTINUE                                             06730025
067400         WHEN OTHER                                               06740025
067500               MOVE '1310-VALIDATE-PRINTER'                       06750025
067600                                    TO DP013-PARAGRAPH            06760025
067700               MOVE PV-CICS-RESPONSE                              06770025
067800                                    TO DP013-MESSAGE-TEXT(1)      06780025
067900               SET DP013-LINK-RETURN                              06790025
068000                   DP013-CICS-ABEND                               06800025
068100                   DP013-NO-ROLLBACK TO TRUE                      06810025
068200               PERFORM DP014-0000-PROCESS-ABEND                   06820025
068300     END-EVALUATE.                                                06830025
068400                                                                  06840025
068500                                                                  06850025
068510***************************************************************** 06851027
068520* CHECK TO SEE THAT DC IS SET UP TO SEND REPORT AS A .TXT       * 06852027
068530* INSTEAD OF PRINTING TO AN ACTUAL PRINTER.                     * 06853027
068540***************************************************************** 06854027
068550 1320-VALIDATE-PRINT-TO-FILE.                                     06855027
068560                                                                  06856027
068570     SET PS-PRINT-TO-FILE-NO  TO TRUE                             06857027
068580                                                                  06858027
068590     EXEC SQL                                                     06859027
068591            SELECT  FUNC_TXT                                      06859127
068592              INTO :KRPRPM-FUNC-TXT                               06859227
068593              FROM  TKRPRPM                                       06859327
068594             WHERE  LOC_ID            = :DK-OPER-UNT-ID           06859427
068595               AND  INTFC_SYS_CDE     = 'KHL'                     06859527
068596               AND  SYS_PRC_FUNC_CDE  = 'PRTFIL'                  06859627
068597               AND  FUNC_PRC_STAT_CDE = 'AC'                      06859727
068598               AND  FUNC_BEG_TMST    <= CURRENT TIMESTAMP         06859827
068599               AND  FUNC_END_TMST    >= CURRENT TIMESTAMP         06859927
068600               AND  FUNC_TXT          = 'Y'                       06860027
068601     END-EXEC.                                                    06860127
068602                                                                  06860227
068603     IF  SQLCODE = ZERO                                           06860327
068604         SET PS-PRINT-TO-FILE-YES TO TRUE                         06860427
068605     ELSE                                                         06860527
068606     IF  SQLCODE = +100                                           06860627
068607         SET PS-PRINT-TO-FILE-NO  TO TRUE                         06860727
068608     ELSE                                                         06860827
068609               MOVE '1320-VALIDATE-PRINT-TO-FILE'                 06860930
068610                                    TO DP013-PARAGRAPH            06861030
068611               MOVE PV-CICS-RESPONSE                              06861130
068612                                    TO DP013-MESSAGE-TEXT(1)      06861230
068613               SET DP013-LINK-RETURN                              06861330
068614                   DP013-CICS-ABEND                               06861430
068615                   DP013-NO-ROLLBACK TO TRUE                      06861530
068616               PERFORM DP014-0000-PROCESS-ABEND                   06861630
068634     END-IF.                                                      06863427
068635                                                                  06863527
068636                                                                  06863627
068637***************************************************************** 06863727
068638*                                                               * 06863827
068639*                                                               * 06863927
068640***************************************************************** 06864027
068650 1400-HELP-SCREEN.                                                06865025
068700     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      06870025
068800     MOVE 'SUKRF510'                  TO PC192-PROGRAM-NAME       06880025
068900     COPY PCPD188.                                                06890025
069000     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      06900025
069100     PERFORM 4200-XCTL-TO-HELP.                                   06910025
069200                                                                  06920025
069300                                                                  06930025
069400***************************************************************** 06940025
069500*  2000-PROCESS-SCREEN                                          * 06950025
069600* PROCESS THE SELECTED OPTION                                   * 06960025
069610***************************************************************** 06961025
069620 2000-PROCESS-SCREEN.                                             06962025
069630                                                                  06963025
069640     EVALUATE TRUE                                                06964025
069650         WHEN CA-CONTINUE-SELECTION                               06965025
069660             IF SU006-SYSTEM-GENERATED-AUDIT                      06966025
069670               IF SU006-AUDIT-COMPLETE                            06967025
069680                 IF SU006-QC-AND-RFID-AUD                         06968025
069690                   MOVE SU006-RFID-AUDIT-CNTL-NBR                 06969025
069700                     TO DK-AUDIT-CNTL-NBR                         06970025
069800                   PERFORM 3200-SELECT-AUDIT                      06980025
069900                   IF (SUT00015-AUD-STAT-CDE = 'P' OR             06990025
070000                       SUT00015-AUD-STAT-CDE = 'F' OR             07000025
070100                       SUT00015-AUD-STAT-CDE = 'N')               07010025
070200                       MOVE PC-AUDIT-CLOSED-F3-EXIT-MSG           07020025
070300                                          TO  AMSGLNO             07030025
070400                       PERFORM 8100-SEND-DATA-ONLY                07040025
070500                       PERFORM 8200-RETURN-TRANID                 07050025
070510                   ELSE                                           07051025
070511                                                                  07051125
070520*** QC AUDIT CLOSED ON COMBO- SWITCHING TO RF ONLY                07052025
070521                     SET SU006-RFID-AUDIT    TO TRUE              07052125
070522                     SET SU006-RFID-AUD-ONLY TO TRUE              07052225
070523                     SET SU006-NO-AUD-ERR    TO TRUE              07052325
070524                     MOVE PC-QC-AUD-CPLTE TO AMSGLNO              07052425
070525                     MOVE SU006-RFID-AUDIT-CNTL-NBR TO            07052525
070526                       SU006-AUDIT-CNTL-NBR                       07052625
070527                     MOVE ZERO TO SU006-RFID-AUDIT-CNTL-NBR       07052725
070528                   END-IF                                         07052825
070529                 ELSE                                             07052925
070530                   MOVE SU006-AUDIT-CNTL-NBR                      07053025
070531                       TO DK-AUDIT-CNTL-NBR                       07053125
070532                   PERFORM 3200-SELECT-AUDIT                      07053225
070533                   IF (SUT00015-AUD-STAT-CDE = 'P' OR             07053325
070534                       SUT00015-AUD-STAT-CDE = 'F' OR             07053425
070535                       SUT00015-AUD-STAT-CDE = 'N')               07053525
070536                       MOVE PC-AUDIT-CLOSED-F3-EXIT-MSG           07053625
070537                                          TO  AMSGLNO             07053725
070538                       PERFORM 8100-SEND-DATA-ONLY                07053825
070539                       PERFORM 8200-RETURN-TRANID                 07053925
070540                   END-IF                                         07054025
070541                 END-IF                                           07054125
070542               END-IF                                             07054225
070543             END-IF                                               07054325
070544                                                                  07054425
070545*            IF THE USER IS CONTINUING A COMPLETED OR POSTPONED   07054525
070546*            AUDIT, CALCULATE THE MINUTES IT WAS CLOSED/POSTPONED,07054625
070547*            AND RESET THE AUDIT STOP TIMESTAMP                   07054725
070548                                                                  07054825
070549             IF SU006-AUDIT-COMPLETE OR SU006-AUDIT-POSTPONE      07054925
070550                 SET CA-CONFIRM-RESTART TO TRUE                   07055025
070551                 MOVE PM-CONFIRM-CONT-MSG                         07055125
070552                                        TO AMSGLNO                07055225
070560*            OTHERWISE XFER TO THE AUDIT CONTINUE SCREEN          07056025
070561                                                                  07056125
070570             ELSE                                                 07057025
070580                 IF SU006-SYSTEM-GENERATED-AUDIT                  07058025
070590                     MOVE PC-OPEN-CARTON-PROGRAM-NAME             07059025
070600                                TO PV-TRANSFER-PROGRAM            07060025
070700                 ELSE                                             07070025
070800                     MOVE PC-AUDIT-CONT-SCREEN                    07080025
070900                                TO PV-TRANSFER-PROGRAM            07090025
071000                 END-IF                                           07100025
071100                 PERFORM 2100-XCTL-TO-SELECTED-PROGRAM            07110025
071200             END-IF                                               07120025
071300                                                                  07130025
071400                                                                  07140025
071500         WHEN CA-CLOSE-SELECTION                                  07150025
071600             IF SU006-SYSTEM-GENERATED-AUDIT                      07160025
071700                 MOVE SU006-AUDIT-CNTL-NBR                        07170025
071800                     TO DK-AUDIT-CNTL-NBR                         07180025
071810                 PERFORM 3200-SELECT-AUDIT                        07181025
071820                 IF (SUT00015-AUD-STAT-CDE = 'P' OR               07182025
071830                     SUT00015-AUD-STAT-CDE = 'F' OR               07183025
071840                     SUT00015-AUD-STAT-CDE = 'N')                 07184025
071850                     MOVE PC-AUDIT-CLOSED-F3-EXIT-MSG             07185025
071860                                        TO  AMSGLNO               07186025
071870                     PERFORM 8100-SEND-DATA-ONLY                  07187025
071880                     PERFORM 8200-RETURN-TRANID                   07188025
071890                 END-IF                                           07189025
071900             END-IF                                               07190025
071910                                                                  07191025
072000*            CHECK FOR OPEN CARTONS                               07200025
072001                                                                  07200125
072010             PERFORM 2400-CHECK-OPEN-CARTONS                      07201025
072020             IF PV-DB2-COUNT > 0                                  07202025
072030                 MOVE PV-DB2-COUNT      TO PM-CTN-COUNT           07203025
072040                 MOVE PM-OPEN-CARTON-MSG                          07204025
072050                                        TO AMSGLNO                07205025
072060                 PERFORM 8100-SEND-DATA-ONLY                      07206025
072070                 PERFORM 8200-RETURN-TRANID                       07207025
072080             END-IF                                               07208025
072090             SET CA-CONFIRM-CLOSE       TO TRUE                   07209025
072100             MOVE PM-CONFIRM-CLOSE-MSG  TO AMSGLNO                07210025
072200                                                                  07220025
072300         WHEN CA-PRINT-SELECTION                                  07230025
072400                                                                  07240025
072500             IF SU006-SYSTEM-GENERATED-AUDIT                      07250025
072600                 MOVE SU006-AUDIT-CNTL-NBR                        07260025
072700                     TO DK-AUDIT-CNTL-NBR                         07270025
072800                PERFORM 3200-SELECT-AUDIT                         07280025
072810                IF SUT00015-PKGNG-TYP-CDE = 'RF'                  07281025
072811                   SET SU006-RFID-AUDIT    TO TRUE                07281125
072812                   SET SU006-RFID-AUD-ONLY TO TRUE                07281225
072813                ELSE                                              07281325
072814                   SET SU006-QC-AUDIT    TO TRUE                  07281425
072815                   SET SU006-QC-AUD-ONLY TO TRUE                  07281525
072816                END-IF                                            07281625
072817             ELSE                                                 07281725
072818                                                                  07281825
072819*               SEARCH DC/PO FROM TSUNAUD AND TSUATRN             07281925
072820                                                                  07282025
072821                PERFORM 8300-FETCH-DC-PO                          07282125
072822                                                                  07282225
072823*               SEARCH PO-EXCEPTION                               07282325
072824                                                                  07282425
072830                PERFORM 8400-CHECK-PO-EXCEPTION                   07283025
072831                IF SUT00014-AUD-TYP-CDE = 'R'                     07283125
072832                   SET SU006-RFID-AUDIT     TO TRUE               07283225
072833                   SET SU006-RFID-AUD-ONLY  TO TRUE               07283325
072834                ELSE                                              07283425
072835                   IF SUT00014-AUD-TYP-CDE = 'Q'                  07283525
072836                      SET SU006-QC-AUDIT    TO TRUE               07283625
072837                      SET SU006-QC-AUD-ONLY TO TRUE               07283725
072838                   ELSE                                           07283825
072839                                                                  07283925
072840*                     CHECK IF VENDOR TAGGING                     07284025
072841                                                                  07284125
072842                      PERFORM 8500-CHECK-VENDOR-TAGGING           07284225
072843                      IF VNDAGR-TYP-CDE = 11 OR                   07284325
072844                         VNDAGR-TYP-CDE = 12                      07284425
072845                         PERFORM 8600-CHECK-DEPT-TAGGING          07284525
072846                      END-IF                                      07284625
072847                      IF SUT00014-AUD-TYP-CDE = 'A' OR            07284725
072848                         SUT00014-AUD-TYP-CDE = 'N'               07284825
072849                         IF (VNDAGR-TYP-CDE = 11 OR               07284925
072850                             VNDAGR-TYP-CDE = 12) AND             07285025
072851                             PS-DEPT-TAGGING                      07285125
072852                             SET SU006-QC-AUDIT        TO TRUE    07285225
072853                             SET SU006-QC-AND-RFID-AUD TO TRUE    07285325
072854                         ELSE                                     07285425
072855                             SET SU006-QC-AUDIT        TO TRUE    07285525
072856                             SET SU006-QC-AUD-ONLY     TO TRUE    07285625
072857                         END-IF                                   07285725
072858                      ELSE                                        07285825
072859                         IF VNDAGR-TYP-CDE = 11 AND               07285925
072860                            PS-DEPT-TAGGING                       07286025
072861                            SET SU006-QC-AUDIT        TO TRUE     07286125
072862                            SET SU006-QC-AND-RFID-AUD TO TRUE     07286225
072863                         ELSE                                     07286325
072864                            SET SU006-QC-AUDIT        TO TRUE     07286425
072865                            SET SU006-QC-AUD-ONLY     TO TRUE     07286525
072866                         END-IF                                   07286625
072867                      END-IF                                      07286725
072868                   END-IF                                         07286825
072869                END-IF                                            07286925
072870             END-IF                                               07287025
072871                                                                  07287125
072872             MOVE PC-PRINT-PROGRAM-NAME TO PV-TRANSFER-PROGRAM    07287225
072880             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                07288025
072890                                                                  07289025
072900                                                                  07290025
073000     END-EVALUATE.                                                07300025
073100                                                                  07310025
073200                                                                  07320025
073300 2100-XCTL-TO-SELECTED-PROGRAM.                                   07330025
073400     SET SU006-INITIALIZE-SCREEN   TO  TRUE.                      07340025
073500     MOVE LENGTH OF CA-COMMAREA    TO  PV-COMMAREA-LENGTH.        07350025
073600     MOVE PC-CURRENT-PROGRAM-NAME  TO  SU006-LAST-PROGRAM.        07360025
073700                                                                  07370025
073800     EXEC CICS                                                    07380025
073900         XCTL                                                     07390025
074000             PROGRAM   (PV-TRANSFER-PROGRAM)                      07400025
074100             COMMAREA  (CA-COMMAREA)                              07410025
074200             LENGTH    (PV-COMMAREA-LENGTH)                       07420025
074300             RESP      (PV-CICS-RESPONSE)                         07430025
074400     END-EXEC.                                                    07440025
074500                                                                  07450025
074600     EVALUATE TRUE                                                07460025
074700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07470025
074800              CONTINUE                                            07480025
074900         WHEN OTHER                                               07490025
075000              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                07500025
075100                                     TO DP013-PARAGRAPH           07510025
075200              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       07520025
075300                                     TO DP013-MESSAGE-TEXT (1)    07530025
075400              MOVE PV-TRANSFER-PROGRAM                            07540025
075500                                     TO DP013-MESSAGE-TEXT (2)    07550025
075600              SET DP013-CICS-ABEND   TO TRUE                      07560025
075700              SET DP013-NO-ROLLBACK  TO TRUE                      07570025
075800              PERFORM 9999-WRITE-CICS-LOG-MSG                     07580025
075900              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     07590025
076000                                     TO AMSGLNO                   07600025
076100              SET SU006-PROCESS-SCREEN TO TRUE                    07610025
076200              PERFORM 8100-SEND-DATA-ONLY                         07620025
076300              PERFORM 8200-RETURN-TRANID                          07630025
076400     END-EVALUATE.                                                07640025
076500                                                                  07650025
076600                                                                  07660025
076700***************************************************************** 07670025
076800*  2200-RESTART-AUDIT                                           * 07680025
076900* RESTART THE COMPLETED/POSTPONED AUDIT.                        * 07690025
077000* CALCULATE THE MINUTES IT WAS CLOSED/POSTPONED, AND RESET THE  * 07700025
077100* AUDIT STOP TIMESTAMP * *                                        07710025
077200***************************************************************** 07720025
077300 2200-RESTART-AUDIT.                                              07730025
077400                                                                  07740025
077500*    DETERMINE IF THE STOP TIMESTAMP WAS UPDATED                  07750025
077600     PERFORM 2205-CHECK-IF-STOPPED.                               07760025
077700                                                                  07770025
077800     IF SUNAUD-AUD-STP-TMST NOT EQUAL TO                          07780025
077900                               '9999-09-09-09.09.09.999999'       07790025
078000*    FIRST CALCULATED THE MINUTES SINCE IT WAS STOPPED            07800025
078100         PERFORM 2210-CALC-STOP-MINUTES                           07810025
078200     ELSE                                                         07820025
078210         MOVE 0               TO PV-TOTAL-CLOSED-MINUTES          07821025
078220     END-IF.                                                      07822025
078230                                                                  07823025
078240*    UPDATE THE MINUTES POSTPONED/COMPLETED AND RESET THE         07824025
078250*    STOP TIMESTAMP                                               07825025
078260     IF SU006-AUDIT-COMPLETE                                      07826025
078270         PERFORM 2220-UPDATE-COMPLETE-MINUTES                     07827025
078280     ELSE                                                         07828025
078290         IF SU006-AUDIT-POSTPONE                                  07829025
078300            PERFORM 2230-UPDATE-POSTPONE-MINUTES                  07830025
078400         END-IF                                                   07840025
078500     END-IF.                                                      07850025
078600                                                                  07860025
078700***************************************************************** 07870025
078800*  2205-CHECK-IF-STOPPED.                                       * 07880025
078900* RESTART THE COMPLETED/POSTPONED AUDIT.                        * 07890025
079000* DETERMINED IF THE AUDIT WAS STOPPED BY THE CORRECT PROCEDURE  * 07900025
079100* IF IT STOPPED BECAUSE OF FAILED COMMUNICATIONS, THE AUD-STP-TMST07910025
079200* WOULD NOT HAVE BEEN UPDATED.                                  * 07920025
079300***************************************************************** 07930025
079400 2205-CHECK-IF-STOPPED.                                           07940025
079500                                                                  07950025
079510     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              07951025
079520                                                                  07952025
079530     EXEC SQL                                                     07953025
079540         SELECT                                                   07954025
079550                AUD_STP_TMST                                      07955025
079560         INTO                                                     07956025
079570                :SUNAUD-AUD-STP-TMST                              07957025
079580         FROM                                                     07958025
079590                TSUNAUD                                           07959025
079591         WHERE                                                    07959125
079592                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             07959225
079593     END-EXEC.                                                    07959325
079594                                                                  07959425
079595     EVALUATE TRUE                                                07959525
079596         WHEN SQLCODE = ZERO                                      07959625
079597             CONTINUE                                             07959725
079598                                                                  07959825
079599         WHEN SQLWARN0 NOT = SPACES                               07959925
079600         WHEN SQLCODE < ZERO                                      07960025
079601         WHEN SQLCODE > ZERO                                      07960125
079602             MOVE '2205-CHECK-IF-STOPPED.'                        07960225
079603                 TO DP013-PARAGRAPH                               07960325
079604             MOVE 'SELECT OF TSUNAUD'                             07960425
079605                 TO DP013-MESSAGE-TEXT (1)                        07960525
079606             MOVE SU006-AUDIT-CNTL-NBR-X                          07960625
079607                 TO DP013-MESSAGE-TEXT (2)                        07960725
079608             MOVE SQLCA            TO DP013-SQLCA                 07960825
079609             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    07960925
079610             SET DP013-DB2-ABEND   TO TRUE                        07961025
079611             SET DP013-NO-ROLLBACK TO TRUE                        07961125
079612             PERFORM 9999-WRITE-CICS-LOG-MSG                      07961225
079613             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               07961325
079614             PERFORM 8100-SEND-DATA-ONLY                          07961425
079615             PERFORM 8200-RETURN-TRANID                           07961525
079616     END-EVALUATE.                                                07961625
079617                                                                  07961725
079618                                                                  07961825
079619***************************************************************** 07961925
079620*  2210-CALC-STOP-MINUTES.                                      * 07962025
079630* RESTART THE COMPLETED/POSTPONED AUDIT.                        * 07963025
079640* CALCULATE THE MINUTES IT WAS CLOSED/POSTPONED, AND RESET THE  * 07964025
079650* AUDIT STOP TIMESTAMP * *                                        07965025
079660***************************************************************** 07966025
079670 2210-CALC-STOP-MINUTES.                                          07967025
079680                                                                  07968025
079690     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              07969025
079700                                                                  07970025
079800     EXEC SQL                                                     07980025
079900         SELECT                                                   07990025
080000                DAYS(CURRENT DATE)     - DAYS(AUD_STP_TMST)       08000025
080100              , HOUR(CURRENT TIME)    - HOUR(AUD_STP_TMST)        08010025
080200              , MINUTE(CURRENT TIME)  - MINUTE(AUD_STP_TMST)      08020025
080300         INTO                                                     08030025
080400                :PV-CLOSED-DAYS                                   08040025
080500              , :PV-CLOSED-HOURS                                  08050025
080600              , :PV-CLOSED-MINUTES                                08060025
080700         FROM                                                     08070025
080800                TSUNAUD                                           08080025
080900         WHERE                                                    08090025
081000                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             08100025
081100     END-EXEC.                                                    08110025
081200                                                                  08120025
081300     EVALUATE TRUE                                                08130025
081400         WHEN SQLCODE = ZERO                                      08140025
081500             COMPUTE PV-TOTAL-CLOSED-MINUTES =                    08150025
081600                ((PV-CLOSED-DAYS     * 1440) +                    08160025
081700                 (PV-CLOSED-HOURS    * 60)   +                    08170025
081800                  PV-CLOSED-MINUTES)                              08180025
081900                                                                  08190025
082000         WHEN SQLWARN0 NOT = SPACES                               08200025
082100         WHEN SQLCODE < ZERO                                      08210025
082200         WHEN SQLCODE > ZERO                                      08220025
082300             MOVE '2210-CALC-STOP-MINUTES.'                       08230025
082400                 TO DP013-PARAGRAPH                               08240025
082500             MOVE 'SELECT OF TSUNAUD'                             08250025
082600                 TO DP013-MESSAGE-TEXT (1)                        08260025
082700             MOVE SU006-AUDIT-CNTL-NBR-X                          08270025
082800                 TO DP013-MESSAGE-TEXT (2)                        08280025
082900             MOVE SQLCA            TO DP013-SQLCA                 08290025
083000             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    08300025
083100             SET DP013-DB2-ABEND   TO TRUE                        08310025
083200             SET DP013-NO-ROLLBACK TO TRUE                        08320025
083300             PERFORM 9999-WRITE-CICS-LOG-MSG                      08330025
083400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               08340025
083500             PERFORM 8100-SEND-DATA-ONLY                          08350025
083600             PERFORM 8200-RETURN-TRANID                           08360025
083700     END-EVALUATE.                                                08370025
083800                                                                  08380025
083900                                                                  08390025
084000***************************************************************** 08400025
084100*  2220-UPDATE-COMPLETE-MINUTES                                 * 08410025
084200* UPDATE THE TABLE WITH THE ADDITION OF THE CURRENT CLOSED      * 08420025
084300* MINUTES TO THE EXISTING CLOSED MINUTES -- UPDATE THE STOP     * 08430025
084400* TIMESTAMP TO THE DEFAULT VALUE                                * 08440025
084500***************************************************************** 08450025
084600 2220-UPDATE-COMPLETE-MINUTES.                                    08460025
084700                                                                  08470025
084800     SET SU006-AUDIT-INPROCESS TO TRUE.                           08480025
084900     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              08490025
085000                                                                  08500025
085100     EXEC SQL                                                     08510025
085200         UPDATE TSUNAUD                                           08520025
085300                                                                  08530025
085400         SET AUD_CLO_MNIT_QTY = AUD_CLO_MNIT_QTY +                08540025
085500                                :PV-TOTAL-CLOSED-MINUTES          08550025
085600           , AUD_STP_TMST     = '9999-09-09-09.09.09.999999'      08560025
085700           , AUD_STAT_CDE     = :SU006-AUDIT-STATUS               08570025
085800                                                                  08580025
085900         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             08590025
086000     END-EXEC.                                                    08600025
086100                                                                  08610025
086200     EVALUATE TRUE                                                08620025
086300         WHEN SQLCODE = ZERO                                      08630025
086400             CONTINUE                                             08640025
086500         WHEN SQLWARN0 NOT = SPACES                               08650025
086600         WHEN SQLCODE < ZERO                                      08660025
086700         WHEN SQLCODE > ZERO                                      08670025
086800             MOVE '2220-UPDATE-COMPLETE-MINUTES'                  08680025
086900                 TO DP013-PARAGRAPH                               08690025
087000             MOVE 'UPDATE OF TSUNAUD'                             08700025
087100                 TO DP013-MESSAGE-TEXT (1)                        08710025
087200             MOVE SU006-AUDIT-CNTL-NBR-X                          08720025
087300                 TO DP013-MESSAGE-TEXT (2)                        08730025
087400             MOVE SQLCA            TO DP013-SQLCA                 08740025
087500             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    08750025
087600             SET DP013-DB2-ABEND   TO TRUE                        08760025
087700             SET DP013-NO-ROLLBACK TO TRUE                        08770025
087800             PERFORM 9999-WRITE-CICS-LOG-MSG                      08780025
087900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               08790025
088000             PERFORM 8100-SEND-DATA-ONLY                          08800025
088100             PERFORM 8200-RETURN-TRANID                           08810025
088200     END-EVALUATE.                                                08820025
088300                                                                  08830025
088400                                                                  08840025
088500***************************************************************** 08850025
088600*  2230-UPDATE-POSTPONE-MINUTES                                 * 08860025
088700* UPDATE THE TABLE WITH THE ADDITION OF THE CURRENT CLOSED      * 08870025
088800* MINUTES TO THE EXISTING POSTPONED MINUTES -- UPDATE THE STOP  * 08880025
088900* TIMESTAMP TO THE DEFAULT VALUE                                * 08890025
089000***************************************************************** 08900025
089100 2230-UPDATE-POSTPONE-MINUTES.                                    08910025
089200                                                                  08920025
089300     SET SU006-AUDIT-INPROCESS TO TRUE.                           08930025
089400     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              08940025
089500                                                                  08950025
089600     EXEC SQL                                                     08960025
089700         UPDATE TSUNAUD                                           08970025
089800                                                                  08980025
089900         SET AUD_PSPND_MNIT_QTY = AUD_PSPND_MNIT_QTY +            08990025
090000                                :PV-TOTAL-CLOSED-MINUTES          09000025
090100           , AUD_STP_TMST     = '9999-09-09-09.09.09.999999'      09010025
090200           , AUD_STAT_CDE     = :SU006-AUDIT-STATUS               09020025
090300                                                                  09030025
090400         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             09040025
090500     END-EXEC.                                                    09050025
090600                                                                  09060025
090700     EVALUATE TRUE                                                09070025
090800         WHEN SQLCODE = ZERO                                      09080025
090900             CONTINUE                                             09090025
091000         WHEN SQLWARN0 NOT = SPACES                               09100025
091100         WHEN SQLCODE < ZERO                                      09110025
091200         WHEN SQLCODE > ZERO                                      09120025
091300             MOVE '2230-UPDATE-POSTPONE-MINUTES'                  09130025
091400                 TO DP013-PARAGRAPH                               09140025
091500             MOVE 'UPDATE OF TSUNAUD'                             09150025
091600                 TO DP013-MESSAGE-TEXT (1)                        09160025
091700             MOVE SU006-AUDIT-CNTL-NBR-X                          09170025
091800                 TO DP013-MESSAGE-TEXT (2)                        09180025
091900             MOVE SQLCA            TO DP013-SQLCA                 09190025
092000             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    09200025
092100             SET DP013-DB2-ABEND   TO TRUE                        09210025
092200             SET DP013-NO-ROLLBACK TO TRUE                        09220025
092300             PERFORM 9999-WRITE-CICS-LOG-MSG                      09230025
092400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               09240025
092500             PERFORM 8100-SEND-DATA-ONLY                          09250025
092600             PERFORM 8200-RETURN-TRANID                           09260025
092700     END-EVALUATE.                                                09270025
092800                                                                  09280025
092900                                                                  09290025
093000***************************************************************** 09300025
093100*  2300-CLOSE-AUDIT                                             * 09310025
093200* UPDATE THE TABLE -- SET THE STOP TIMESTAMP TO THE CURRENT,    * 09320025
093300* AND UPDATE THE STATUS TO COMPETE                              * 09330025
093400***************************************************************** 09340025
093500 2300-CLOSE-AUDIT.                                                09350025
093600                                                                  09360025
093700     SET SU006-AUDIT-COMPLETE     TO TRUE.                        09370025
093800     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              09380025
093900                                                                  09390025
094000     EXEC SQL                                                     09400025
094100         UPDATE TSUNAUD                                           09410025
094200                                                                  09420025
094300         SET AUD_STP_TMST     = CURRENT TIMESTAMP                 09430025
094400           , AUD_STAT_CDE     = :SU006-AUDIT-STATUS               09440025
094500                                                                  09450025
094600         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             09460025
094700     END-EXEC.                                                    09470025
094800                                                                  09480025
094900     EVALUATE TRUE                                                09490025
095000         WHEN SQLCODE = ZERO                                      09500025
095100             CONTINUE                                             09510025
095200         WHEN SQLWARN0 NOT = SPACES                               09520025
095300         WHEN SQLCODE < ZERO                                      09530025
095400         WHEN SQLCODE > ZERO                                      09540025
095500             MOVE '2300-CLOSE-AUDIT'                              09550025
095600                 TO DP013-PARAGRAPH                               09560025
095700             MOVE 'UPDATE OF TSUNAUD'                             09570025
095800                 TO DP013-MESSAGE-TEXT (1)                        09580025
095900             MOVE SU006-AUDIT-CNTL-NBR-X                          09590025
096000                 TO DP013-MESSAGE-TEXT (2)                        09600025
096100             MOVE SQLCA            TO DP013-SQLCA                 09610025
096200             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    09620025
096300             SET DP013-DB2-ABEND   TO TRUE                        09630025
096400             SET DP013-NO-ROLLBACK TO TRUE                        09640025
096500             PERFORM 9999-WRITE-CICS-LOG-MSG                      09650025
096600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               09660025
096700             PERFORM 8100-SEND-DATA-ONLY                          09670025
096800             PERFORM 8200-RETURN-TRANID                           09680025
096900     END-EVALUATE.                                                09690025
097000                                                                  09700025
097100******************************************************************09710025
097200*  2400-CHECK-OPEN-CARTONS.                                      *09720025
097300*  SELECT THE NUMBER OF CARTONS THAT ARE NOT CLOSED              *09730025
097400******************************************************************09740025
097500 2400-CHECK-OPEN-CARTONS.                                         09750025
097600                                                                  09760025
097700     MOVE SU006-AUDIT-CNTL-NBR  TO DK-AUDIT-CNTL-NBR              09770025
097800                                                                  09780025
097900     EXEC SQL                                                     09790025
098000         SELECT                                                   09800025
098100            COUNT (DISTINCT SHIPT_UNT_ID)                         09810025
098200         INTO                                                     09820025
098300            :PV-DB2-COUNT                                         09830025
098400         FROM                                                     09840025
098500                TSUATRN                                           09850025
098600         WHERE                                                    09860025
098700                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             09870025
098800           AND  UNT_AUD_STAT_CDE <> 'CM'                          09880025
098900     END-EXEC.                                                    09890025
099000                                                                  09900025
099100     EVALUATE TRUE                                                09910025
099200         WHEN SQLCODE = ZERO                                      09920025
099300             CONTINUE                                             09930025
099400                                                                  09940025
099500         WHEN SQLCODE = -305                                      09950025
099600             MOVE +0                 TO PV-DB2-COUNT              09960025
099700                                                                  09970025
099800         WHEN SQLWARN0 NOT = SPACES                               09980025
099900         WHEN SQLCODE < ZERO                                      09990025
100000         WHEN SQLCODE > ZERO                                      10000025
100100             MOVE '2200-CHECK-OPEN-CARTONS'                       10010025
100200                 TO DP013-PARAGRAPH                               10020025
100300             MOVE 'SELECT OF TSUNAUD TABLE'                       10030025
100400                 TO DP013-MESSAGE-TEXT (1)                        10040025
100500             MOVE SU006-AUDIT-CNTL-NBR-X                          10050025
100600                 TO DP013-MESSAGE-TEXT (2)                        10060025
100700             MOVE SQLCA            TO DP013-SQLCA                 10070025
100800             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    10080025
100900             SET DP013-DB2-ABEND   TO TRUE                        10090025
101000             SET DP013-NO-ROLLBACK TO TRUE                        10100025
101100             PERFORM 9999-WRITE-CICS-LOG-MSG                      10110025
101200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               10120025
101300             PERFORM 8100-SEND-DATA-ONLY                          10130025
101400             PERFORM 8200-RETURN-TRANID                           10140025
101500     END-EVALUATE.                                                10150025
101600                                                                  10160025
101700                                                                  10170025
105100 3200-SELECT-AUDIT.                                               10510025
105200                                                                  10520025
105300                                                                  10530025
105400     EXEC SQL                                                     10540025
105500       SELECT AUD_STAT_CDE                                        10550025
105600                                                                  10560025
105700             ,PKGNG_TYP_CDE                                       10570025
105800                                                                  10580025
105900       INTO   :SUT00015-AUD-STAT-CDE                              10590025
105901                                                                  10590125
105902             ,:SUT00015-PKGNG-TYP-CDE                             10590225
105903                                                                  10590325
105904       FROM   SUT_PO_AUD_REQ                                      10590425
105905       WHERE  AUD_CNTL_NBR  = :DK-AUDIT-CNTL-NBR                  10590525
105906     END-EXEC.                                                    10590625
105907                                                                  10590725
105908     EVALUATE TRUE                                                10590825
105909         WHEN SQLCODE = ZERO                                      10590925
105910              CONTINUE                                            10591025
105920         WHEN SQLWARN0 NOT = SPACES                               10592025
105930         WHEN SQLCODE < ZERO                                      10593025
105940         WHEN SQLCODE > ZERO                                      10594025
105950             MOVE '3200-SELECT-AUDIT'                             10595025
105960                 TO DP013-PARAGRAPH                               10596025
105970             MOVE 'SELECT OF SUT_PO_AUD_REQ'                      10597025
105980                 TO DP013-MESSAGE-TEXT (1)                        10598025
105990             MOVE SU006-AUDIT-CNTL-NBR-X                          10599025
106000                 TO DP013-MESSAGE-TEXT (2)                        10600025
106100             MOVE SQLCA            TO DP013-SQLCA                 10610025
106200             MOVE 'SUT00015'       TO DP013-DB2-TABLE-NAME (1)    10620025
106300             SET DP013-DB2-ABEND   TO TRUE                        10630025
106400             SET DP013-NO-ROLLBACK TO TRUE                        10640025
106500             PERFORM 9999-WRITE-CICS-LOG-MSG                      10650025
106600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               10660025
106700             PERFORM 8100-SEND-DATA-ONLY                          10670025
106701             PERFORM 8200-RETURN-TRANID                           10670125
106702     END-EVALUATE.                                                10670225
106703                                                                  10670325
106704*                                                                 10670425
106705 4200-XCTL-TO-HELP.                                               10670525
106706                                                                  10670625
106707     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      10670725
106708     SET  SU006-INITIALIZE-SCREEN     TO TRUE.                    10670825
106709     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    10670925
106710                                                                  10671025
106711     EXEC CICS                                                    10671125
106712         XCTL                                                     10671225
106713             PROGRAM   (PV-TRANSFER-PROGRAM)                      10671325
106714             COMMAREA  (PC192-COMMAREA)                           10671425
106715             LENGTH    (PV-COMMAREA-LENGTH)                       10671525
106716             RESP      (PV-CICS-RESPONSE)                         10671625
106717     END-EXEC.                                                    10671725
106718                                                                  10671825
106719     EVALUATE TRUE                                                10671925
106720         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10672025
106721              CONTINUE                                            10672125
106722         WHEN OTHER                                               10672225
106723             MOVE '4200-XCTL-TO-HELP '                            10672325
106724                 TO DP013-PARAGRAPH                               10672425
106725             MOVE 'SUKRF510 - UNABLE TO XCTL TO PROGRAM: '        10672525
106726                 TO DP013-MESSAGE-TEXT (1)                        10672625
106727             MOVE PV-TRANSFER-PROGRAM                             10672725
106728                 TO DP013-MESSAGE-TEXT (2)                        10672825
106729             SET DP013-CICS-ABEND  TO TRUE                        10672925
106730             SET DP013-ROLLBACK TO TRUE                           10673025
106731             PERFORM 9999-WRITE-CICS-LOG-MSG                      10673125
106732             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             10673225
106733             SET SU006-PROCESS-SCREEN TO TRUE                     10673325
106734             PERFORM 8000-SEND-MAP                                10673425
106735             PERFORM 8200-RETURN-TRANID                           10673525
106736     END-EVALUATE.                                                10673625
106737******************************************************************10673725
106738*  8000-SEND-MAP                                                 *10673825
106739*  SEND THE REFRESHED MAP IMAGE TO THE SCREEN                    *10673925
106740******************************************************************10674025
106741 8000-SEND-MAP.                                                   10674125
106742     EXEC CICS                                                    10674225
106743         SEND                                                     10674325
106744             MAP     ('SU510A')                                   10674425
106745             MAPSET  ('SUKM510')                                  10674525
106746             ERASE                                                10674625
106747             RESP    (PV-CICS-RESPONSE)                           10674725
106748     END-EXEC.                                                    10674825
106749                                                                  10674925
106750     EVALUATE TRUE                                                10675025
106760         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10676025
106770             CONTINUE                                             10677025
106780         WHEN OTHER                                               10678025
106790             MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH            10679025
106800             MOVE 'UNABLE TO SEND MAP'                            10680025
106900                                    TO DP013-MESSAGE-TEXT (1)     10690025
107000             SET DP013-CICS-ABEND   TO TRUE                       10700025
107100             SET DP013-NO-ROLLBACK  TO TRUE                       10710025
107200             PERFORM 9999-WRITE-CICS-LOG-MSG                      10720025
107300     END-EVALUATE.                                                10730025
107400                                                                  10740025
107410                                                                  10741025
107500 8100-SEND-DATA-ONLY.                                             10750025
107600                                                                  10760025
107700     MOVE -1            TO ASELECTL.                              10770025
107800                                                                  10780025
107900     EXEC CICS                                                    10790025
108000         SEND                                                     10800025
108100             MAP       ('SU510A')                                 10810025
108200             MAPSET    ('SUKM510')                                10820025
108300             CURSOR                                               10830025
108400             DATAONLY                                             10840025
108500             RESP      (PV-CICS-RESPONSE)                         10850025
108600     END-EXEC.                                                    10860025
108700                                                                  10870025
108800     EVALUATE TRUE                                                10880025
108900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10890025
109000             CONTINUE                                             10900025
109100         WHEN OTHER                                               10910025
109200             MOVE '8100-SEND-DATA-ONLY'                           10920025
109300                                    TO DP013-PARAGRAPH            10930025
109400             MOVE 'UNABLE TO SEND DATA'                           10940025
109500                                    TO DP013-MESSAGE-TEXT (1)     10950025
109600             SET DP013-CICS-ABEND   TO TRUE                       10960025
109700             SET DP013-NO-ROLLBACK  TO TRUE                       10970025
109800             PERFORM 9999-WRITE-CICS-LOG-MSG                      10980025
109900     END-EVALUATE.                                                10990025
110000                                                                  11000025
110010                                                                  11001025
110100 8200-RETURN-TRANID.                                              11010025
110200     MOVE LENGTH OF CA-COMMAREA  TO  PV-COMMAREA-LENGTH.          11020025
110300                                                                  11030025
110400     EXEC CICS                                                    11040025
110500         RETURN                                                   11050025
110600             TRANSID   (PC-CURRENT-TRANID)                        11060025
110700             COMMAREA  (CA-COMMAREA)                              11070025
110800             LENGTH    (PV-COMMAREA-LENGTH)                       11080025
110900             RESP      (PV-CICS-RESPONSE)                         11090025
111000     END-EXEC.                                                    11100025
111100                                                                  11110025
111200     EVALUATE TRUE                                                11120025
111300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11130025
111400             CONTINUE                                             11140025
111500         WHEN OTHER                                               11150025
111600             MOVE '8200-RETURN-TRANID'                            11160025
111700                                    TO DP013-PARAGRAPH            11170025
111800             MOVE 'UNABLE TO RETURN TO TRANID'                    11180025
111900                                    TO DP013-MESSAGE-TEXT (1)     11190025
112000             SET DP013-CICS-ABEND   TO TRUE                       11200025
112100             SET DP013-NO-ROLLBACK  TO TRUE                       11210025
112200             PERFORM 9999-WRITE-CICS-LOG-MSG                      11220025
112300     END-EVALUATE.                                                11230025
112400                                                                  11240025
112500                                                                  11250025
112600 8300-FETCH-DC-PO.                                                11260025
112700                                                                  11270025
112800     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              11280025
112900                                                                  11290025
113000     EXEC SQL                                                     11300025
113100          SELECT A.OPER_UNT_ID                                    11310025
113110                ,B.TRN_NBR                                        11311025
113120          INTO  :SUNAUD-OPER-UNT-ID                               11312025
113130               ,:SUATRN-TRN-NBR                                   11313025
113140          FROM  TSUNAUD A                                         11314025
113150               ,TSUATRN B                                         11315025
113160          WHERE A.AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR               11316025
113170          AND   A.AUD_CNTL_NBR = B.AUD_CNTL_NBR                   11317025
113180          FETCH FIRST 1 ROW ONLY                                  11318025
113190     END-EXEC.                                                    11319025
113191                                                                  11319125
113192     EVALUATE SQLCODE                                             11319225
113193       WHEN 0                                                     11319325
113194             CONTINUE                                             11319425
113195                                                                  11319525
113196       WHEN OTHER                                                 11319625
113197             MOVE '8300-FETCH-DC-PO'  TO DP013-PARAGRAPH          11319725
113198             MOVE 'SELECT OF TSUATRN AND TSUNAUD'                 11319825
113199                        TO DP013-MESSAGE-TEXT (1)                 11319925
113200             MOVE SU006-AUDIT-CNTL-NBR-X TO DP013-MESSAGE-TEXT (2)11320025
113201             MOVE SQLCA                  TO DP013-SQLCA           11320125
113202             MOVE 'TSUNAUD'            TO DP013-DB2-TABLE-NAME (1)11320225
113203             MOVE 'TSUATRN'            TO DP013-DB2-TABLE-NAME (2)11320325
113204             SET DP013-DB2-ABEND         TO TRUE                  11320425
113205             SET DP013-NO-ROLLBACK       TO TRUE                  11320525
113206             PERFORM 9999-WRITE-CICS-LOG-MSG                      11320625
113207                                                                  11320725
113208             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               11320825
113209             MOVE -1                     TO ASELECTL              11320925
113210             PERFORM 8100-SEND-DATA-ONLY                          11321025
113211             PERFORM 8200-RETURN-TRANID                           11321125
113212     END-EVALUATE.                                                11321225
113213                                                                  11321325
113214 8400-CHECK-PO-EXCEPTION.                                         11321425
113215                                                                  11321525
113216     INITIALIZE DCLSUT00014.                                      11321625
113217     MOVE SUATRN-TRN-NBR     TO SUT00014-PO-NBR                   11321725
113218     MOVE SUNAUD-OPER-UNT-ID TO SUT00014-OPER-UNT-ID              11321825
113219                                                                  11321925
113220     EXEC SQL                                                     11322025
113221         SELECT DISTINCT                                          11322125
113222                AUD_TYP_CDE                                       11322225
113223         INTO   :SUT00014-AUD-TYP-CDE                             11322325
113224         FROM  SUT_PO_AUD_EXC                                     11322425
113225         WHERE PO_NBR      = :SUT00014-PO-NBR                     11322525
113226         AND   OPER_UNT_ID = :SUT00014-OPER-UNT-ID                11322625
113227     END-EXEC.                                                    11322725
113228                                                                  11322825
113229     EVALUATE SQLCODE                                             11322925
113230         WHEN 0                                                   11323025
113231              CONTINUE                                            11323125
113232         WHEN 100                                                 11323225
113233              MOVE SPACES TO SUT00014-AUD-TYP-CDE                 11323325
113234         WHEN OTHER                                               11323425
113235             MOVE '8400-CHECK-PO-EXCEPTION'  TO DP013-PARAGRAPH   11323525
113236             MOVE 'SELECT OF SUT_PO_AUD_EXC'                      11323625
113237                        TO DP013-MESSAGE-TEXT (1)                 11323725
113238             MOVE SU006-AUDIT-CNTL-NBR-X TO DP013-MESSAGE-TEXT (2)11323825
113239             MOVE SQLCA                  TO DP013-SQLCA           11323925
113240             MOVE 'SUT00014'           TO DP013-DB2-TABLE-NAME (1)11324025
113241             SET DP013-DB2-ABEND         TO TRUE                  11324125
113242             SET DP013-NO-ROLLBACK       TO TRUE                  11324225
113243             PERFORM 9999-WRITE-CICS-LOG-MSG                      11324325
113244                                                                  11324425
113245             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               11324525
113246             MOVE -1                     TO ASELECTL              11324625
113247             PERFORM 8100-SEND-DATA-ONLY                          11324725
113248             PERFORM 8200-RETURN-TRANID                           11324825
113249     END-EVALUATE.                                                11324925
113250                                                                  11325025
113260 8500-CHECK-VENDOR-TAGGING.                                       11326025
113270                                                                  11327025
113280     INITIALIZE DCLTPURCHS                                        11328025
113290                DCLTVNDAGR.                                       11329025
113291                                                                  11329125
113292     MOVE SUATRN-TRN-NBR  TO PURCHS-PO-NBR                        11329225
113293                                                                  11329325
113294     EXEC SQL                                                     11329425
113295         SELECT DEPT_NBR                                          11329525
113296               ,ENT_ID                                            11329625
113297         INTO   :PURCHS-DEPT-NBR                                  11329725
113298               ,:PURCHS-ENT-ID                                    11329825
113299         FROM TPURCHS                                             11329925
113300         WHERE PO_NBR = :PURCHS-PO-NBR                            11330025
113301         AND   VER_STATUS_CDE = 'A'                               11330125
113302     END-EXEC.                                                    11330225
113303                                                                  11330325
113304     EVALUATE SQLCODE                                             11330425
113305        WHEN 0                                                    11330525
113306             MOVE PURCHS-DEPT-NBR TO VNDAGR-DEPT-NBR              11330625
113307             MOVE PURCHS-ENT-ID   TO VNDAGR-ENT-ID                11330725
113308             EXEC SQL                                             11330825
113309                  SELECT TYP_CDE                                  11330925
113310                  INTO :VNDAGR-TYP-CDE                            11331025
113311                  FROM TVNDAGR                                    11331125
113312                  WHERE ENT_ID        = :VNDAGR-ENT-ID            11331225
113313                  AND DEPT_NBR        = :VNDAGR-DEPT-NBR          11331325
113314                  AND AGRMT_TYP_ID    = '4'                       11331425
113315                  AND TYP_CDE         IN (11,12)                  11331525
113316                  AND EFFECTIVE_DATE <= CURRENT DATE              11331625
113317                  AND EXPIRATION_DATE > CURRENT DATE              11331725
113318                  ORDER BY TYP_CDE                                11331825
113319                  FETCH FIRST 1 ROW ONLY                          11331925
113320             END-EXEC                                             11332025
113321                                                                  11332125
113322             EVALUATE SQLCODE                                     11332225
113323                WHEN 0                                            11332325
113324                     CONTINUE                                     11332425
113325                WHEN 100                                          11332525
113326                     MOVE ZEROS TO VNDAGR-TYP-CDE                 11332625
113327                WHEN OTHER                                        11332725
113328                     MOVE '8500-CHECK-VENDOR-TAGGING'             11332825
113329                           TO DP013-PARAGRAPH                     11332925
113330                     MOVE 'SELECT OF TPURCHS'                     11333025
113331                           TO DP013-MESSAGE-TEXT (1)              11333125
113332                     MOVE SU006-AUDIT-CNTL-NBR-X                  11333225
113333                           TO DP013-MESSAGE-TEXT (2)              11333325
113334                     MOVE SQLCA       TO DP013-SQLCA              11333425
113335                     MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1) 11333525
113336                     SET DP013-DB2-ABEND         TO TRUE          11333625
113337                     SET DP013-NO-ROLLBACK       TO TRUE          11333725
113338                     PERFORM 9999-WRITE-CICS-LOG-MSG              11333825
113339                                                                  11333925
113340                     MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO       11334025
113341                     MOVE -1                     TO ASELECTL      11334125
113342                     PERFORM 8100-SEND-DATA-ONLY                  11334225
113343                     PERFORM 8200-RETURN-TRANID                   11334325
113344             END-EVALUATE                                         11334425
113345                                                                  11334525
113346        WHEN 100                                                  11334625
113347             MOVE ZEROS TO VNDAGR-TYP-CDE                         11334725
113348        WHEN OTHER                                                11334825
113349             MOVE '8500-CHECK-VENDOR-TAGGING'  TO DP013-PARAGRAPH 11334925
113350             MOVE 'SELECT OF TVNDAGR'                             11335025
113360                        TO DP013-MESSAGE-TEXT (1)                 11336025
113361             MOVE SU006-AUDIT-CNTL-NBR-X TO DP013-MESSAGE-TEXT (2)11336125
113362             MOVE SQLCA                  TO DP013-SQLCA           11336225
113363             MOVE 'TVNDAGR'           TO DP013-DB2-TABLE-NAME (1) 11336325
113364             SET DP013-DB2-ABEND         TO TRUE                  11336425
113365             SET DP013-NO-ROLLBACK       TO TRUE                  11336525
113366             PERFORM 9999-WRITE-CICS-LOG-MSG                      11336625
113367                                                                  11336725
113368             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               11336825
113369             MOVE -1                     TO ASELECTL              11336925
113370             PERFORM 8100-SEND-DATA-ONLY                          11337025
113380             PERFORM 8200-RETURN-TRANID                           11338025
113381     END-EVALUATE.                                                11338125
113382                                                                  11338225
113383                                                                  11338325
113385 8600-CHECK-DEPT-TAGGING.                                         11338525
113386                                                                  11338625
113387     MOVE PURCHS-DEPT-NBR TO RIT00000-DEPT-NBR                    11338725
113388                                                                  11338825
113389     EXEC SQL                                                     11338925
113390          SELECT  'Y'                                             11339025
113391          INTO   :PS-DEPT-RFID-TAGGING-SW                         11339125
113392          FROM RIT_RFID_VRFN A                                    11339225
113393          WHERE RFID_LVL_CDE = 'STRDPT'                           11339325
113394            AND DEPT_NBR     = :RIT00000-DEPT-NBR                 11339425
113395            AND (CURRENT TIMESTAMP BETWEEN EFF_STRT_TMST          11339525
113396                AND EFF_END_TMST)                                 11339625
113397          FETCH FIRST ROW ONLY                                    11339725
113398     END-EXEC                                                     11339825
113399                                                                  11339925
113400     EVALUATE TRUE                                                11340025
113401         WHEN SQLCODE = +0                                        11340125
113402         WHEN SQLCODE = -811                                      11340225
113403             SET PS-DEPT-TAGGING TO TRUE                          11340325
113404         WHEN SQLCODE = +100                                      11340425
113405             SET PS-DEPT-NOT-TAGGING TO TRUE                      11340525
113406         WHEN OTHER                                               11340625
113407             MOVE '8600-CHECK-DEPT-TAGGING'  TO DP013-PARAGRAPH   11340725
113408             MOVE 'SELECT OF RIT_RFID_VRFN'                       11340825
113409                        TO DP013-MESSAGE-TEXT (1)                 11340925
113410             MOVE SU006-AUDIT-CNTL-NBR-X TO DP013-MESSAGE-TEXT (2)11341025
113420             MOVE SQLCA                  TO DP013-SQLCA           11342025
113421             MOVE 'RIT_RFID_VRFN'     TO DP013-DB2-TABLE-NAME (1) 11342125
113422             SET DP013-DB2-ABEND         TO TRUE                  11342225
113423             SET DP013-NO-ROLLBACK       TO TRUE                  11342325
113424             PERFORM 9999-WRITE-CICS-LOG-MSG                      11342425
113425                                                                  11342525
113426             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               11342625
113427             MOVE -1                     TO ASELECTL              11342725
113428             PERFORM 8100-SEND-DATA-ONLY                          11342825
113429             PERFORM 8200-RETURN-TRANID                           11342925
113430     END-EVALUATE.                                                11343025
113431                                                                  11343125
113432                                                                  11343225
136600 9999-WRITE-CICS-LOG-MSG.                                         13660025
136700     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            13670025
136800     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           13680025
136900     INITIALIZE DP013-SRC-TASK-NUMBER                             13690025
137000                DP013-STACK.                                      13700025
137100     SET DP013-LINK-RETURN           TO TRUE.                     13710025
137200                                                                  13720025
137300     EXEC CICS                                                    13730025
137400         LINK                                                     13740025
137500             PROGRAM   (DP013-NAME)                               13750025
137600             COMMAREA  (DP013-PARAMETERS)                         13760025
137700             LENGTH    (DP013-LENGTH)                             13770025
137800     END-EXEC.                                                    13780025
137900                                                                  13790025
138000*----------------------------------------------------------------*13800025
138100*    ABEND PROCESSOR MODULE                                      *13810025
138200*----------------------------------------------------------------*13820025
138300                                                                  13830025
138400     COPY DPPD014.                                                13840025
138500                                                                  13850025
