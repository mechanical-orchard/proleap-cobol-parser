000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    DPKCS041.                                         00040000
000500 AUTHOR.        CAL BUSH.                                         00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  03-10-93.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900*----------------------------------------------------------------*00090000
001000*    Z041 - UPDATE SHORT MESSAGE                                 *00100000
001100*                                                                *00110000
001200*    THIS PROGRAM ALLOWS THE USER TO UPDATE A SYSTEM MESSAGE.    *00120000
001300*    THE MESSAGE NUMBER IS A PROTECTED FIELD.  SYSTEM ID IS      *00130000
001400*    REQUIRED AND MUST BE ON TABLE TAPLSYS.  MESSAGE TEXT MUST   *00140000
001500*    NOT HAVE A SPACE AS THE FIRST BYTE.                         *00150000
001100*                                                                *00150102
262023*    CHANGED 09/28/2021    BY JIM HUNTER      WR: CHG0262023     *00151003
262023*    CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE *00152003
262023*    MAKING THE CALL DYNAMIC VS STATIC                           *00153003
001600*----------------------------------------------------------------*00160000
001700                                                                  00170000
001800                                                                  00180000
001900                                                                  00190000
002000 ENVIRONMENT DIVISION.                                            00200000
002100                                                                  00210000
002200                                                                  00220000
002300                                                                  00230000
002400 DATA DIVISION.                                                   00240000
002500                                                                  00250000
002600                                                                  00260000
002700 WORKING-STORAGE SECTION.                                         00270000
002800                                                                  00280000
002900 01  DK-DB2-KEYS.                                                 00290000
003000     05  DK-OPERATING-COMPANY           PIC  X(02)  VALUE SPACE.  00300000
003100     05  DK-APLSYS-CDE                  PIC  X(02)  VALUE SPACE.  00310000
003200     05  DK-MESSAGE-NUMBER              PIC S9(05)  COMP-3        00320000
003300                                                    VALUE ZERO.   00330000
003400*                                                                 00340000
003500 01  PC-PROGRAM-CONSTANTS.                                        00350000
003600     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'DPKCS041'.  00360000
003700     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'DP041A  '.  00370000
003800     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'DPKM041 '.  00380000
003900     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00390000
004000                                              COMP.               00400000
004100     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00410000
004200                                              COMP.               00420000
004300     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE  +1           00430000
004400                                              COMP.               00440000
004410     05  PC-UPD-VSAM              PIC  X(01)  VALUE 'Y'.          00441000
004500     05  PC-INTER-APPL-CODES.                                     00450000
004600         10  PC-INTER-APPL-CRIT-SPEC                              00460000
004700                                  PIC  X(01)  VALUE '1'.          00470000
004800         10  PC-INTER-APPL-LIST   PIC  X(01)  VALUE '2'.          00480000
004900     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       00490000
005000                                                                  00500000
005100     05  PC-TSYMSG-NUMBERS.                                       00510000
005200         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00520000
005300         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00530000
005400         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00540000
005500         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00550000
005600         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       00560000
005700         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       00570000
005800         10  PC-TSYMSG-00302      PIC  9(05)  VALUE  00302.       00580000
005900         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       00590000
006000         10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.       00600000
006100*                                                                 00610000
006200 01  PS-PROGRAM-SWITCHES.                                         00620000
006300     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00630000
006400         88  PS-ERROR                         VALUE  'Y'.         00640000
006500         88  PS-NO-ERROR                      VALUE  'N'.         00650000
006600*                                                                 00660000
006700 01  PV-PROGRAM-VARIABLES.                                        00670000
006800     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00680000
006900                                              COMP SYNC.          00690000
007000     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            00700000
007100                                              COMP SYNC.          00710000
007200     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0            00720000
007300                                              COMP SYNC.          00730000
007400                                                                  00740000
007500     EJECT                                                        00750000
007600**--------------------------------------------------------------**00760000
007700** THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING        **00770000
007800** SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.         **00780000
007900**--------------------------------------------------------------**00790000
008000     COPY DPWS057.                                                00800000
008100 EJECT                                                            00810000
008200                                                                  00820000
008300*----------------------------------------------------------------*00830000
008400*    MAP LAYOUT                                                  *00840000
008500*----------------------------------------------------------------*00850000
008600                                                                  00860000
008700     COPY DPKM041.                                                00870000
008800                                                                  00880000
008900 EJECT                                                            00890000
009000*----------------------------------------------------------------*00900000
009100*    ATTRIBUTE SETTINGS COPYBOOK.                                *00910000
009200*----------------------------------------------------------------*00920000
009300                                                                  00930000
009400     COPY DPWS015.                                                00940000
009500                                                                  00950000
009600*----------------------------------------------------------------*00960000
009700*    FUNCTION KEYS COPYBOOK                                      *00970000
009800*----------------------------------------------------------------*00980000
009900                                                                  00990000
010000     COPY DPWS016.                                                01000000
010100                                                                  01010000
010300**--------------------------------------------------------------**01030000
010400** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01040000
010500** SUB-ROUTINE (DPKUT100).                                      **01050000
010600**--------------------------------------------------------------**01060000
010700     COPY DPWS010I.                                               01070000
010800                                                                  01080004
      *----------------------------------------------------------------*01090005
      *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.           *01100005
      *----------------------------------------------------------------*01110005
                                                                        01120004
           COPY DPWS030.                                                01130004
           COPY DPWS930.                                                01131004
011400                                                                  01140004
011500**--------------------------------------------------------------**01150000
011600*    STANDARD COMMAREA.                                           01160000
011700**--------------------------------------------------------------**01170000
011800                                                                  01180000
011900     COPY DPWS020.                                                01190000
012000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01200000
012100                                                                  01210000
012200***************************************************************** 01220000
012300*    INTER-APPLICATION COMMAREA.                                  01230000
012400***************************************************************** 01240000
012500                                                                  01250000
012600         10  INTER-APPL-COMM-AREA PIC X(200).                     01260000
012700     COPY DPWS054.                                                01270000
012800     COPY DPWS056.                                                01280000
012900***************************************************************** 01290000
013000*    SPECIFIC COMMMAREA FOR DPKCS041.                             01300000
013100***************************************************************** 01310000
013200         10  ASC-SPECIFIC-COMMAREA.                               01320000
013300             15  ASC-INT-APPL-FORMAT-IND   PIC  X(01).            01330000
013400             15  ASC-MSG-NUMBER.                                  01340000
013500                 20  ASC-MSG-NUMBER-N      PIC  9(05).            01350000
013600             15  ASC-SYSTEM-ID             PIC  X(02).            01360000
013700             15  ASC-MSG-TEXT              PIC  X(70).            01370000
013800             15  ASC-USE-SELECTION-QUEUE-IND                      01380000
013900                                           PIC  X(01).            01390000
014000                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 01400000
014100             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            01410000
014200             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    01420000
014300             15  ASC-NUMBER-OF-SELECTED-ITEMS                     01430000
014400                                           PIC S9(09)  COMP-3.    01440000
014500             15  ASC-SEL-SUB               PIC S9(04)  COMP.      01450000
014600             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      01460000
014700         10  FILLER                        PIC  X(2766).          01470000
014800     EJECT                                                        01480000
014900*----------------------------------------------------------------*01490000
015000*    ABEND PROCESSING COPYBOOK.                                  *01500000
015100*----------------------------------------------------------------*01510000
015200                                                                  01520000
015300     COPY DPWS013.                                                01530000
015400                                                                  01540000
015500 EJECT                                                            01550000
015600                                                                  01560000
015700*    DB2 AREA FOR TSYMSG  (SYSTEM MESSAGE - SHORT MESSAGE)        01570000
015800                                                                  01580000
015900     EXEC SQL                                                     01590000
016000          INCLUDE TSYMSG                                          01600000
016100     END-EXEC.                                                    01610000
016200                                                                  01620000
016300*    DB2 AREA FOR TAPLSYS (APPLICATION SYSTEM MASTER)             01630000
016400                                                                  01640000
016500     EXEC SQL                                                     01650000
016600          INCLUDE TAPLSYS                                         01660000
016700     END-EXEC.                                                    01670000
016800                                                                  01680000
016900*    DB2 AREA FOR COMMUNICATIONS                                  01690000
017000                                                                  01700000
017100     EXEC SQL                                                     01710000
017200          INCLUDE SQLCA                                           01720000
017300     END-EXEC.                                                    01730000
017400                                                                  01740000
017500 EJECT                                                            01750000
017600 LINKAGE SECTION.                                                 01760000
017700                                                                  01770000
017800 01  DFHCOMMAREA.                                                 01780000
017900     05  FILLER                         OCCURS  1 TO 4072 TIMES   01790000
018000                                        DEPENDING ON EIBCALEN.    01800000
018100         10  FILLER                     PIC X.                    01810000
018200                                                                  01820000
018300                                                                  01830000
018400 PROCEDURE DIVISION.                                              01840000
018500***************************************************************** 01850000
018600** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01860000
018700** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01870000
018800** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01880000
018900**                                                             ** 01890000
019000** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01900000
019100** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01910000
019200***************************************************************** 01920000
019300 0000-MAIN-MODULE.                                                01930000
019400     INITIALIZE DP030-CICS-API-FIELDS.                            01940000
019500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01950000
019600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01960000
019700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01970000
019800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01980000
019900     MOVE LENGTH OF DP041AI        TO DP030-MAP-LENGTH (1).       01990000
020000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02000000
020100     PERFORM 0001-CALL-CICS-ARCH-API.                             02010000
020200*                                                                 02020000
020300     PERFORM 1000-CONTROL-PROCESSING                              02030000
020400*                                                                 02040000
020500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02050000
020600     PERFORM 0001-CALL-CICS-ARCH-API.                             02060000
020700                                                                  02070000
020800 0001-CALL-CICS-ARCH-API.                                         02080000
020900     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02090006
021000                                    DFHCOMMAREA                   02100006
021100                                    DP030-CICS-API-FIELDS         02110006
021200                                    DP020-STANDARD-COMMAREA       02120006
021300                                    DP041AI.                      02130006
021400*                                                                 02140000
021500     IF  DP030-RC-CALL-SUCCESSFUL                                 02150000
021600         CONTINUE                                                 02160000
021700     ELSE                                                         02170000
021800         SET DP013-NO-ROLLBACK                                    02180000
021900             DP013-XCTL-DISPLAY-RESTART                           02190000
022000             DP013-CICS-ABEND      TO TRUE                        02200000
022100         MOVE 'BEFORE 0000-MAIN-MODULE'                           02210000
022200                                   TO DP013-PARAGRAPH             02220000
022300         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02230007
022400-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02240007
022500         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02250000
022600         PERFORM DP013-0000-PROCESS-ABEND                         02260000
022700     END-IF.                                                      02270000
022800 EJECT                                                            02280000
022900*----------------------------------------------------------------*02290000
023000*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02300000
023100*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02310000
023200*----------------------------------------------------------------*02320000
023300                                                                  02330000
023400 1000-CONTROL-PROCESSING.                                         02340000
023500                                                                  02350000
023600     EVALUATE TRUE                                                02360000
023700         WHEN DP020-NEXT-ACT-INITIAL                              02370000
023800              PERFORM 1100-FIND-OBJECT-KEYS                       02380000
023900              IF  PS-ERROR                                        02390000
024000                  CONTINUE                                        02400000
024100              ELSE                                                02410000
024200                  PERFORM 4000-BUILD-INITIAL-PANEL                02420000
024300                  IF  SQLCODE = +100                              02430000
024400                      SET DP020-NEXT-ACT-APPL-ERROR TO TRUE       02440000
024500                      MOVE PC-TSYMSG-00148                        02450000
024600                                   TO DP020-MSG-NUMBER            02460000
024700                      SET DP020-MSG-INFORMATIONAL TO TRUE         02470000
024800                  END-IF                                          02480000
024900              END-IF                                              02490000
025000                                                                  02500000
025100         WHEN DP020-NEXT-ACT-READ-MAP                             02510000
025200             PERFORM 2000-PROCESS-PANEL                           02520000
025300                                                                  02530000
025400         WHEN DP020-NEXT-ACT-RETURN                               02540000
025500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02550000
025600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02560000
025700                                                                  02570000
025800         WHEN OTHER                                               02580000
025900             SET DP013-LOGIC-ABEND TO TRUE                        02590000
026000             SET DP013-NO-ROLLBACK TO TRUE                        02600000
026100             MOVE '1000-CONTROL-PROCESSING'                       02610000
026200                                   TO DP013-PARAGRAPH             02620000
026300             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02630000
026400                                   TO DP013-MESSAGE-TEXT(1)       02640000
026500             MOVE DP020-NEXT-APPL-ACTIVITY                        02650000
026600                                   TO DP013-MESSAGE-TEXT(2)       02660000
026700             PERFORM DP013-0000-PROCESS-ABEND                     02670000
026800     END-EVALUATE.                                                02680000
026900******************************************************************02690000
027000** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **02700000
027100** INTER-APPLICATION FORMAT CODE.                               **02710000
027200******************************************************************02720000
027300 1100-FIND-OBJECT-KEYS.                                           02730000
027400     INITIALIZE ASC-SPECIFIC-COMMAREA.                            02740000
027500     MOVE DP020-INT-APPL-FORMAT-IND                               02750000
027600                                   TO ASC-INT-APPL-FORMAT-IND.    02760000
027700     EVALUATE DP020-INT-APPL-FORMAT-IND                           02770000
027800         WHEN PC-INTER-APPL-CRIT-SPEC                             02780000
027900             IF  DP054-MESSAGE-NUMBER > ZERO                      02790000
028000                 MOVE DP054-MESSAGE-NUMBER                        02800000
028100                                   TO ASC-MSG-NUMBER-N            02810000
028200             ELSE                                                 02820000
028300                 MOVE PC-TSYMSG-00148                             02830000
028400                                   TO DP020-MSG-NUMBER            02840000
028500                 SET DP020-MSG-FATAL                              02850000
028600                     DP020-NEXT-ACT-APPL-ERROR                    02860000
028700                                   TO TRUE                        02870000
028800             END-IF                                               02880000
028900                                                                  02890000
029000         WHEN PC-INTER-APPL-LIST                                  02900000
029100             SET ASC-USE-SELECTION-QUEUE TO TRUE                  02910000
029200             MOVE DP056-NUMBER-OF-SELECTED-ITEMS                  02920000
029300                                   TO ASC-NUMBER-OF-SELECTED-ITEMS02930000
029400             MOVE DP056-NUMBER-OF-TS-ITEMS                        02940000
029500                                   TO ASC-NUMBER-OF-TS-ITEMS      02950000
029600             MOVE DP056-SEL-QUEUE-NAME                            02960000
029700                                   TO ASC-SEL-QUEUE-NAME          02970000
029800             PERFORM 1120-PREPARE-LIST-ENTRY                      02980000
029900                                                                  02990000
030000         WHEN OTHER                                               03000000
030100             IF  DP020-NAV-KEY-DATA > SPACE                       03010000
030200                 PERFORM 1110-EDIT-NAV-KEY                        03020000
030300             ELSE                                                 03030000
030400                 MOVE PC-TSYMSG-00148                             03040000
030500                                   TO DP020-MSG-NUMBER            03050000
030600                 SET DP020-MSG-FATAL                              03060000
030700                     DP020-NEXT-ACT-APPL-ERROR                    03070000
030800                                   TO TRUE                        03080000
030900             END-IF                                               03090000
031000     END-EVALUATE.                                                03100000
031100******************************************************************03110000
031200** EDIT THE KEY ENTERED BY THE USER INTO THE KEY FIELD OF THE   **03120000
031300** COMMAND LINE.  A VALID MESSAGE NUMBER IS THE ONLY KEY        **03130000
031400** ACCEPTED.                                                    **03140000
031500******************************************************************03150000
031600 1110-EDIT-NAV-KEY.                                               03160000
031700     IF  ASC-MSG-NUMBER > SPACE                                   03170000
031800         MOVE DP020-NAV-KEY-DATA   TO DP010I-UNEDITED-FIELD       03180000
031900         MOVE LENGTH OF ASC-MSG-NUMBER                            03190000
032000                                   TO DP010I-MAXIMUM-DIGITS       03200000
032100         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     03210000
032200         SET DP010I-NEGATIVE-NOT-ALLOWED                          03220000
032300                                   TO TRUE                        03230000
262023         CALL DP010I-NUMERIC-EDIT-ROUTINE                         03241003
262023              USING DP010I-NUMERIC-EDIT-AREA                      03242003
032500         IF  DP010I-ERROR-DETECTED                                03250000
032600             SET PS-ERROR                                         03260000
032700                 DP020-MSG-FATAL   TO TRUE                        03270000
032800*            -- INVALID DATA IN KEY FIELD ---                     03280000
032900             MOVE PC-TSYMSG-00302  TO DP020-MSG-NUMBER            03290000
033000             SET DP020-NEXT-ACT-APPL-ERROR                        03300000
033100                                   TO TRUE                        03310000
033200         ELSE                                                     03320000
033300             MOVE DP010I-NUMERIC-FIELD                            03330000
033400                                   TO ASC-MSG-NUMBER-N            03340000
033500         END-IF                                                   03350000
033600     END-IF.                                                      03360000
033700*----------------------------------------------------------------*03370000
033800* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *03380000
033900* STORAGE QUEUE PASSED FROM THE LIST.                            *03390000
034000*----------------------------------------------------------------*03400000
034100 1120-PREPARE-LIST-ENTRY.                                         03410000
034200     MOVE DP057-MAX-ITEMS          TO ASC-SEL-SUB.                03420000
034300     MOVE ZERO                     TO ASC-SEL-ITEM.               03430000
034400     PERFORM 2110-GET-NEXT-MESSAGE.                               03440000
034500*----------------------------------------------------------------*03450000
034600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *03460000
034700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *03470000
034800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *03480000
034900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *03490000
035000* FUNCTION KEYS CAN GET THIS FAR.                                *03500000
035100*----------------------------------------------------------------*03510000
035200                                                                  03520000
035300 2000-PROCESS-PANEL.                                              03530000
035400                                                                  03540000
035500     EVALUATE TRUE                                                03550000
035600                                                                  03560000
035700         WHEN DP020-SRC-AID = DP016-CLEAR                         03570000
035800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03580000
035900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03590000
036000                                                                  03600000
036100         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03610000
036200             SET DP030-DONT-ERASE                                 03620000
036300                 DP030-SEND-DATAONLY (PC-APPL-MAP)                03630000
036400                                   TO TRUE                        03640000
036500             PERFORM 4000-BUILD-INITIAL-PANEL                     03650000
036600             PERFORM 3200-RESET-ATTRIBUTES                        03660000
036700                                                                  03670000
036800         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             03680000
036900             IF  ASC-USE-SELECTION-QUEUE                          03690000
037000                 PERFORM 2110-GET-NEXT-MESSAGE                    03700000
037100                 PERFORM 4000-BUILD-INITIAL-PANEL                 03710000
037200                 PERFORM 3200-RESET-ATTRIBUTES                    03720000
037300             ELSE                                                 03730000
037400*                --- BOTTOM OF LIST ---                           03740000
037500                 MOVE PC-TSYMSG-00070                             03750000
037600                                   TO DP020-MSG-NUMBER            03760000
037700                 SET DP020-MSG-INFORMATIONAL                      03770000
037800                                   TO TRUE                        03780000
037900             END-IF                                               03790000
038000                                                                  03800000
038100         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             03810000
038200             IF  ASC-USE-SELECTION-QUEUE                          03820000
038300                 PERFORM 2120-GET-PREV-MESSAGE                    03830000
038400                 PERFORM 4000-BUILD-INITIAL-PANEL                 03840000
038500                 PERFORM 3200-RESET-ATTRIBUTES                    03850000
038600             ELSE                                                 03860000
038700*                --- TOP OF LIST ---                              03870000
038800                 MOVE PC-TSYMSG-00069                             03880000
038900                                   TO DP020-MSG-NUMBER            03890000
039000                 SET DP020-MSG-INFORMATIONAL                      03900000
039100                                   TO TRUE                        03910000
039200             END-IF                                               03920000
039300                                                                  03930000
039400         WHEN OTHER                                               03940000
039500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 03950000
039600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03960000
039700             IF  PS-NO-ERROR                                      03970000
039800                 SET DP030-CONTINUE-GO                            03980000
039900                                   TO TRUE                        03990000
040000                 PERFORM 2100-CHECK-FUNCTION-KEY                  04000000
040100             ELSE                                                 04010000
040200                 SET DP030-OVERRIDE-GO                            04020000
040300                                   TO TRUE                        04030000
040400             END-IF                                               04040000
040500     END-EVALUATE.                                                04050000
040600*----------------------------------------------------------------*04060000
040700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *04070000
040800* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *04080000
040900* FROM THE CICS ARCHITECTURE API.                                *04090000
041000*----------------------------------------------------------------*04100000
041100                                                                  04110000
041200 2100-CHECK-FUNCTION-KEY.                                         04120000
041300     EVALUATE TRUE                                                04130000
041400         WHEN DP020-SRC-AID = DP016-ENTER                         04140000
041500             CONTINUE                                             04150000
041600                                                                  04160000
041700         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04170000
041800             SET DP030-CONTINUE-GO TO TRUE                        04180000
041900             PERFORM 5000-UPDATE-SYSTEM-MESSAGE                   04190000
042000*            --- UPDATES SUCCESSFUL ---                           04200000
042100             MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER            04210000
042200             SET DP020-MSG-INFORMATIONAL                          04220000
042300                                   TO TRUE                        04230000
042400                                                                  04240000
042500         WHEN OTHER                                               04250000
042600             SET DP013-NO-ROLLBACK                                04260000
042700                 DP013-XCTL-DISPLAY-RESTART                       04270000
042800                 DP013-CICS-ABEND  TO TRUE                        04280000
042900             MOVE '2000-PROCESS-PANEL'                            04290000
043000                                   TO DP013-PARAGRAPH             04300000
043100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04310000
043200                                   TO DP013-MESSAGE-TEXT (1)      04320000
043300             PERFORM DP013-0000-PROCESS-ABEND                     04330000
043400     END-EVALUATE.                                                04340000
043500                                                                  04350000
043600 2110-GET-NEXT-MESSAGE.                                           04360000
043700     ADD +1                        TO ASC-SEL-SUB.                04370000
043800     IF  ASC-SEL-SUB > DP057-MAX-ITEMS                            04380000
043900         ADD +1                    TO ASC-SEL-ITEM                04390000
044000         MOVE +1                   TO ASC-SEL-SUB                 04400000
044100     END-IF.                                                      04410000
044200     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                04420000
044300         PERFORM 9100-READ-SEL-QUEUE                              04430000
044400         IF  DP057-ITEM (ASC-SEL-SUB) > ZERO                      04440000
044500             MOVE DP057-MESSAGE-NUMBER (ASC-SEL-SUB)              04450000
044600                                   TO ASC-MSG-NUMBER-N            04460000
044700             SET DP057-INQ (ASC-SEL-SUB)                          04470000
044800                                   TO TRUE                        04480000
044900             PERFORM 9200-REWRITE-LIST-QUEUE                      04490000
045000         ELSE                                                     04500000
045100             SUBTRACT +1 FROM ASC-SEL-SUB                         04510000
045200*            --- BOTTOM OF LIST ---                               04520000
045300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            04530000
045400             SET DP020-MSG-INFORMATIONAL                          04540000
045500                                   TO TRUE                        04550000
045600         END-IF                                                   04560000
045700     ELSE                                                         04570000
045800         SUBTRACT +1 FROM ASC-SEL-ITEM                            04580000
045900         MOVE DP057-MAX-ITEMS      TO ASC-SEL-SUB                 04590000
046000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            04600000
046100         SET DP020-MSG-INFORMATIONAL                              04610000
046200                                   TO TRUE                        04620000
046300     END-IF.                                                      04630000
046400******************************************************************04640000
046500** GET THE MESSAGE NUMBER (KEY) OF THE PREVIOUS SELECTED        **04650000
046600** OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.          **04660000
046700******************************************************************04670000
046800 2120-GET-PREV-MESSAGE.                                           04680000
046900     SUBTRACT +1 FROM ASC-SEL-SUB.                                04690000
047000     IF  ASC-SEL-SUB < +1                                         04700000
047100         SUBTRACT +1 FROM ASC-SEL-ITEM                            04710000
047200         MOVE DP057-MAX-ITEMS      TO ASC-SEL-SUB                 04720000
047300     END-IF.                                                      04730000
047400*                                                                 04740000
047500     IF  ASC-SEL-ITEM > ZERO                                      04750000
047600         PERFORM 9100-READ-SEL-QUEUE                              04760000
047700         MOVE DP057-MESSAGE-NUMBER (ASC-SEL-SUB)                  04770000
047800                                   TO ASC-MSG-NUMBER-N            04780000
047900     ELSE                                                         04790000
048000         MOVE +1                   TO ASC-SEL-ITEM                04800000
048100                                      ASC-SEL-SUB                 04810000
048200*        --- TOP OF LIST ---                                      04820000
048300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            04830000
048400         SET DP020-MSG-INFORMATIONAL                              04840000
048500                                   TO TRUE                        04850000
048600     END-IF.                                                      04860000
048700 EJECT                                                            04870000
048800*----------------------------------------------------------------*04880000
048900* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *04890000
049000* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *04900000
049100* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *04910000
049200*----------------------------------------------------------------*04920000
049300                                                                  04930000
049400 2200-MOVE-SCREEN-TO-COMMAREA.                                    04940000
049500     IF  ASYSIDL > ZERO                                           04950000
049600         MOVE ASYSIDI              TO ASC-SYSTEM-ID               04960000
049700     ELSE                                                         04970000
049800         IF  ASYSIDF = DP015-ERASE-EOF                            04980000
049900             MOVE SPACE            TO ASC-SYSTEM-ID               04990000
050000         END-IF                                                   05000000
050100     END-IF.                                                      05010000
050200                                                                  05020000
050300     IF  AMSGTXTL > ZERO                                          05030000
050400         MOVE AMSGTXTI             TO ASC-MSG-TEXT                05040000
050500     ELSE                                                         05050000
050600         IF  AMSGTXTF = DP015-ERASE-EOF                           05060000
050700             MOVE SPACE            TO ASC-MSG-TEXT                05070000
050800         END-IF                                                   05080000
050900     END-IF.                                                      05090000
051000 EJECT                                                            05100000
051100*----------------------------------------------------------------*05110000
051200* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *05120000
051300* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *05130000
051400* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *05140000
051500*----------------------------------------------------------------*05150000
051600                                                                  05160000
051700 3000-EDIT-DATA-IN-COMMAREA.                                      05170000
051800     PERFORM 3200-RESET-ATTRIBUTES.                               05180000
051900     IF  ASC-MSG-TEXT (1:1) = SPACE                               05190000
052000         SET PS-ERROR              TO TRUE                        05200000
052100         SET DP020-MSG-FATAL       TO TRUE                        05210000
052200         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            05220000
052300         MOVE DP015-UNP-ALP-BRT-OFF                               05230000
052400                                   TO AMSGTXTA                    05240000
052500         MOVE DP015-RED            TO AMSGTXTC                    05250000
052600         MOVE DP015-REVERSE        TO AMSGTXTH                    05260000
052700         MOVE -1                   TO AMSGTXTL                    05270000
052800         SET DP030-SET-CURSOR-APPL-1                              05280000
052900                                   TO TRUE                        05290000
053000     ELSE                                                         05300000
053100         INSPECT ASC-MSG-TEXT                                     05310000
053200             TALLYING PV-MSG-VAR-CNT                              05320000
053300             FOR ALL PC-MSG-VAR-SYMBOLIC                          05330000
053400         IF  PV-MSG-VAR-CNT > PC-MAX-MSG-VAR                      05340000
053500             SET PS-ERROR                                         05350000
053600                 DP020-MSG-FATAL   TO TRUE                        05360000
053700*            ---- ONLY 1 SYMBOLIC IS PERMITED ----                05370000
053800             MOVE PC-TSYMSG-00388  TO DP020-MSG-NUMBER            05380000
053900             MOVE DP015-UNP-ALP-BRT-OFF                           05390000
054000                                   TO AMSGTXTA                    05400000
054100             MOVE DP015-RED        TO AMSGTXTC                    05410000
054200             MOVE DP015-REVERSE    TO AMSGTXTH                    05420000
054300             MOVE -1               TO AMSGTXTL                    05430000
054400             SET DP030-SET-CURSOR-APPL-1                          05440000
054500                                   TO TRUE                        05450000
054600         END-IF                                                   05460000
054700     END-IF.                                                      05470000
054800                                                                  05480000
054900     IF  ASC-SYSTEM-ID = SPACE                                    05490000
055000         SET PS-ERROR              TO TRUE                        05500000
055100         SET DP020-MSG-FATAL       TO TRUE                        05510000
055200         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            05520000
055300         MOVE DP015-UNP-ALP-BRT-OFF                               05530000
055400                                   TO ASYSIDA                     05540000
055500         MOVE DP015-RED            TO ASYSIDC                     05550000
055600         MOVE DP015-REVERSE        TO ASYSIDH                     05560000
055700         MOVE -1                   TO ASYSIDL                     05570000
055800         SET DP030-SET-CURSOR-APPL-1                              05580000
055900                                   TO TRUE                        05590000
056000     ELSE                                                         05600000
056100         MOVE DP020-OPERATING-COMPANY                             05610000
056200                                   TO DK-OPERATING-COMPANY        05620000
056300         MOVE ASC-SYSTEM-ID        TO DK-APLSYS-CDE               05630000
056400         PERFORM 3310-SELECT-TAPLSYS                              05640000
056500         IF SQLCODE = +100                                        05650000
056600             SET PS-ERROR          TO TRUE                        05660000
056700             SET DP020-MSG-FATAL   TO TRUE                        05670000
056800*            --- SYSTEM DOES NOT EXIST ---                        05680000
056900             MOVE PC-TSYMSG-00095  TO DP020-MSG-NUMBER            05690000
057000             MOVE DP015-UNP-ALP-BRT-OFF                           05700000
057100                                   TO ASYSIDA                     05710000
057200             MOVE DP015-RED        TO ASYSIDC                     05720000
057300             MOVE DP015-REVERSE    TO ASYSIDH                     05730000
057400             MOVE -1               TO ASYSIDL                     05740000
057500             SET DP030-SET-CURSOR-APPL-1                          05750000
057600                                   TO TRUE                        05760000
057700         END-IF                                                   05770000
057800     END-IF.                                                      05780000
057900*                                                                 05790000
058000     IF  PS-NO-ERROR                                              05800000
058100         MOVE -1                   TO ASYSIDL                     05810000
058200         SET DP030-SET-CURSOR-APPL-1                              05820000
058300                                   TO TRUE                        05830000
058400     END-IF.                                                      05840000
058500*                                                                 05850000
058600*----------------------------------------------------------------*05860000
058700* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *05870000
058800* MAP.                                                           *05880000
058900*----------------------------------------------------------------*05890000
059000 3200-RESET-ATTRIBUTES.                                           05900000
059100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASYSIDA                     05910000
059200                                      AMSGTXTA.                   05920000
059300     MOVE DP015-GREEN              TO ASYSIDC                     05930000
059400                                      AMSGTXTC.                   05940000
059500     MOVE DP015-UNDERLINE          TO ASYSIDH                     05950000
059600                                      AMSGTXTH.                   05960000
059700*                                                                 05970000
059800*                                                                 05980000
059900 3310-SELECT-TAPLSYS.                                             05990000
060000     PERFORM                                                      06000000
060100         WITH TEST AFTER                                          06010000
060200         VARYING PV-RETRY-COUNTER                                 06020000
060300         FROM 1 BY 1                                              06030000
060400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06040000
060500                   OR (SQLCODE = ZERO)                            06050000
060600                   OR (SQLCODE = +100))                           06060000
060700*                                                                 06070000
060800         EXEC SQL                                                 06080000
060900             SELECT                                               06090000
061000                 APLSYS_CDE                                       06100000
061100             INTO                                                 06110000
061200                 :APLSYS-CDE                                      06120000
061300             FROM TAPLSYS                                         06130000
061400             WHERE                                                06140000
061500                ((OPERCO_NBR = :DK-OPERATING-COMPANY)             06150000
061600               AND (APLSYS_CDE = :DK-APLSYS-CDE))                 06160000
061700         END-EXEC                                                 06170000
061800                                                                  06180000
061900         EVALUATE TRUE                                            06190000
062000             WHEN SQLCODE = ZERO                                  06200000
062100             WHEN SQLCODE = +100                                  06210000
062200             WHEN SQLCODE = -904                                  06220000
062300             WHEN SQLCODE = -913                                  06230000
062400                 CONTINUE                                         06240000
062500             WHEN SQLWARN0 NOT = SPACES                           06250000
062600             WHEN SQLCODE < ZERO                                  06260000
062700             WHEN SQLCODE > ZERO                                  06270000
062800                 MOVE '3310-SELECT-TAPLSYS'                       06280000
062900                                   TO DP013-PARAGRAPH             06290000
063000                 MOVE 'SELECT APPLICATION SYSTEM ID FOR SYS ID:'  06300000
063100                                   TO DP013-MESSAGE-TEXT (1)      06310000
063200                 MOVE DK-APLSYS-CDE                               06320000
063300                                   TO DP013-MESSAGE-TEXT (2)      06330000
063400                 MOVE SQLCA        TO DP013-SQLCA                 06340000
063500                 MOVE 'TAPLSYS'    TO DP013-DB2-TABLE-NAME (1)    06350000
063600                 SET DP013-DB2-ABEND                              06360000
063700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06370000
063800                 PERFORM DP013-0000-PROCESS-ABEND                 06380000
063900         END-EVALUATE                                             06390000
064000     END-PERFORM.                                                 06400000
064100*                                                                 06410000
064200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06420000
064300         MOVE '3310-SELECT-TAPLSYS'                               06430000
064400                                   TO DP013-PARAGRAPH             06440000
064500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     06450000
064600                                   TO DP013-MESSAGE-TEXT (1)      06460000
064700         MOVE 'APLICATION SYS ID FOR SYS ID: '                    06470000
064800                                   TO DP013-MESSAGE-TEXT (2)      06480000
064900         MOVE DK-APLSYS-CDE        TO DP013-MESSAGE-TEXT (3)      06490000
065000         MOVE SQLCA                TO DP013-SQLCA                 06500000
065100         MOVE 'TAPLSYS'            TO DP013-DB2-TABLE-NAME (1)    06510000
065200         SET DP013-DB2-ABEND                                      06520000
065300             DP013-XCTL-DISPLAY-RESTART                           06530000
065400                                   TO TRUE                        06540000
065500         PERFORM DP013-0000-PROCESS-ABEND                         06550000
065600     END-IF.                                                      06560000
065700 EJECT                                                            06570000
065800*----------------------------------------------------------------*06580000
065900*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *06590000
066000*    ENTRY.                                                      *06600000
066100*----------------------------------------------------------------*06610000
066200                                                                  06620000
066300 4000-BUILD-INITIAL-PANEL.                                        06630000
066400     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        06640000
066500     MOVE -1                       TO ASYSIDL.                    06650000
066600     MOVE ASC-MSG-NUMBER-N         TO DK-MESSAGE-NUMBER           06660000
066700     PERFORM 4100-GET-MESSAGE.                                    06670000
066800     MOVE SYMSG-SHT-TXT            TO ASC-MSG-TEXT.               06680000
066900     MOVE SYMSG-APLSYS-CDE         TO ASC-SYSTEM-ID.              06690000
067000     IF  SQLCODE = ZERO                                           06700000
067100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     06710000
067200     END-IF.                                                      06720000
067300                                                                  06730000
067400*----------------------------------------------------------------*06740000
067500* SELECT A ROW FROM THE DB2 SYSTEM MESSAGE TABLE.                *06750000
067600*----------------------------------------------------------------*06760000
067700 4100-GET-MESSAGE.                                                06770000
067800     PERFORM                                                      06780000
067900         WITH TEST AFTER                                          06790000
068000         VARYING PV-RETRY-COUNTER                                 06800000
068100         FROM 1 BY 1                                              06810000
068200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06820000
068300                   OR (SQLCODE = ZERO)                            06830000
068400                   OR (SQLCODE = +100))                           06840000
068500*                                                                 06850000
068600         EXEC SQL                                                 06860000
068700             SELECT SYMSG_NBR,                                    06870000
068800                    APLSYS_CDE,                                   06880000
068900                    SHT_TXT                                       06890000
069000             INTO   :SYMSG-SYMSG-NBR,                             06900000
069100                    :SYMSG-APLSYS-CDE,                            06910000
069200                    :SYMSG-SHT-TXT                                06920000
069300             FROM   TSYMSG                                        06930000
069400             WHERE  SYMSG_NBR = :DK-MESSAGE-NUMBER                06940000
069500         END-EXEC                                                 06950000
069600                                                                  06960000
069700         EVALUATE TRUE                                            06970000
069800             WHEN SQLCODE = ZERO                                  06980000
069900             WHEN SQLCODE = +100                                  06990000
070000             WHEN SQLCODE = -904                                  07000000
070100             WHEN SQLCODE = -913                                  07010000
070200                 CONTINUE                                         07020000
070300             WHEN SQLWARN0 NOT = SPACES                           07030000
070400             WHEN SQLCODE < ZERO                                  07040000
070500             WHEN SQLCODE > ZERO                                  07050000
070600                 MOVE '4100-GET-MESSAGE'                          07060000
070700                                   TO DP013-PARAGRAPH             07070000
070800                 MOVE 'SELECT MESSAGE NUMBER'                     07080000
070900                                   TO DP013-MESSAGE-TEXT (1)      07090000
071000                 MOVE SQLCA        TO DP013-SQLCA                 07100000
071100                 MOVE 'TSYMSG '    TO DP013-DB2-TABLE-NAME (1)    07110000
071200                 SET DP013-DB2-ABEND                              07120000
071300                     DP013-XCTL-DISPLAY-RESTART                   07130000
071400                                   TO TRUE                        07140000
071500                 PERFORM DP013-0000-PROCESS-ABEND                 07150000
071600         END-EVALUATE                                             07160000
071700     END-PERFORM.                                                 07170000
071800*                                                                 07180000
071900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07190000
072000         MOVE '4100-GET-MESSAGE'                                  07200000
072100                                   TO DP013-PARAGRAPH             07210000
072200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     07220000
072300                                   TO DP013-MESSAGE-TEXT (1)      07230000
072400         MOVE 'SHORT MESSAGE'      TO DP013-MESSAGE-TEXT (2)      07240000
072500         MOVE SQLCA                TO DP013-SQLCA                 07250000
072600         MOVE 'TSYMSG '            TO DP013-DB2-TABLE-NAME (1)    07260000
072700         SET DP013-DB2-ABEND                                      07270000
072800             DP013-XCTL-DISPLAY-RESTART                           07280000
072900                                   TO TRUE                        07290000
073000         PERFORM DP013-0000-PROCESS-ABEND                         07300000
073100     END-IF.                                                      07310000
073200*----------------------------------------------------------------*07320000
073300*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *07330000
073400*----------------------------------------------------------------*07340000
073500                                                                  07350000
073600 4400-MOVE-COMMAREA-TO-SCREEN.                                    07360000
073700     MOVE ASC-MSG-NUMBER           TO AMSGNBRO.                   07370000
073800     MOVE ASC-SYSTEM-ID            TO ASYSIDO.                    07380000
073900     MOVE ASC-MSG-TEXT             TO AMSGTXTO.                   07390000
074000                                                                  07400000
074100 EJECT                                                            07410000
074200*----------------------------------------------------------------*07420000
074300* APPLY THE CHANGES TO THE MESSAGE TO THE DB2 TABLE.             *07430000
074400*----------------------------------------------------------------*07440000
074500 5000-UPDATE-SYSTEM-MESSAGE.                                      07450000
074600     MOVE ASC-MSG-NUMBER-N         TO DK-MESSAGE-NUMBER.          07460000
074700     MOVE ASC-SYSTEM-ID            TO SYMSG-APLSYS-CDE.           07470000
074800     MOVE ASC-MSG-TEXT             TO SYMSG-SHT-TXT.              07480000
074810     MOVE PC-UPD-VSAM              TO SYMSG-UPD-VSAM-IND.         07481000
074900     PERFORM 5100-UPDATE-MESSAGE.                                 07490000
075000     IF  ASC-USE-SELECTION-QUEUE                                  07500000
075100         PERFORM 5200-UPDATE-SELECTION-QUEUE                      07510000
075200     END-IF.                                                      07520000
075300******************************************************************07530000
075400** UPDATE THE ROW ON THE DB2 TABLE.                             **07540000
075500******************************************************************07550000
075600 5100-UPDATE-MESSAGE.                                             07560000
075700     PERFORM                                                      07570000
075800         WITH TEST AFTER                                          07580000
075900         VARYING PV-RETRY-COUNTER                                 07590000
076000         FROM 1 BY 1                                              07600000
076100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07610000
076200                   OR (SQLCODE = ZERO))                           07620000
076300         EXEC SQL                                                 07630000
076400             UPDATE TSYMSG                                        07640000
076500                 SET APLSYS_CDE    = :SYMSG-APLSYS-CDE,           07650000
076600                     SHT_TXT       = :SYMSG-SHT-TXT,              07660000
076610                     UPD_VSAM_IND  = :SYMSG-UPD-VSAM-IND          07661001
076700             WHERE SYMSG_NBR = :DK-MESSAGE-NUMBER                 07670000
076800         END-EXEC                                                 07680000
076900                                                                  07690000
077000         EVALUATE TRUE                                            07700000
077100             WHEN SQLCODE = ZERO                                  07710000
077200             WHEN SQLCODE = -904                                  07720000
077300             WHEN SQLCODE = -913                                  07730000
077400                 CONTINUE                                         07740000
077500             WHEN SQLWARN0 NOT = SPACES                           07750000
077600             WHEN SQLCODE < ZERO                                  07760000
077700             WHEN SQLCODE > ZERO                                  07770000
077800                 MOVE '5100-UPDATE-MESSAGE'                       07780000
077900                                   TO DP013-PARAGRAPH             07790000
078000                 MOVE 'UPDATE A ROW ON THE SYSTEM MESSAGE TABLE'  07800000
078100                                   TO DP013-MESSAGE-TEXT(1)       07810000
078200                 MOVE SQLCA        TO DP013-SQLCA                 07820000
078300                 MOVE 'TSYMSG'     TO DP013-DB2-TABLE-NAME (1)    07830000
078400                 SET DP013-DB2-ABEND                              07840000
078500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           07850000
078600                 PERFORM DP013-0000-PROCESS-ABEND                 07860000
078700         END-EVALUATE                                             07870000
078800     END-PERFORM.                                                 07880000
078900*                                                                 07890000
079000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07900000
079100         MOVE '5100-UPDATE-MESSAGE'                               07910000
079200                                   TO DP013-PARAGRAPH             07920000
079300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A SYS07930000
079400-             'TEM MESSAGE'        TO DP013-MESSAGE-TEXT (1)      07940000
079500         MOVE SQLCA                TO DP013-SQLCA                 07950000
079600         MOVE 'TSYMSG '            TO DP013-DB2-TABLE-NAME (1)    07960000
079700         SET DP013-DB2-ABEND                                      07970000
079800             DP013-XCTL-DISPLAY-RESTART                           07980000
079900                                   TO TRUE                        07990000
080000         PERFORM DP013-0000-PROCESS-ABEND                         08000000
080100     END-IF.                                                      08010000
080200 EJECT                                                            08020000
080300*----------------------------------------------------------------*08030000
080400* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *08040000
080500* OBJECT WAS UDPATED.                                            *08050000
080600*----------------------------------------------------------------*08060000
080700 5200-UPDATE-SELECTION-QUEUE.                                     08070000
080800     PERFORM 9100-READ-SEL-QUEUE.                                 08080000
080900     SET DP057-UPD (ASC-SEL-SUB) TO TRUE.                         08090000
081000     PERFORM 9200-REWRITE-LIST-QUEUE.                             08100000
081100 EJECT                                                            08110000
081200*----------------------------------------------------------------*08120000
081300* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *08130000
081400*----------------------------------------------------------------*08140000
081500                                                                  08150000
081600 9100-READ-SEL-QUEUE.                                             08160000
081700     EXEC CICS                                                    08170000
081800         READQ TS                                                 08180000
081900             QUEUE (ASC-SEL-QUEUE-NAME)                           08190000
082000             INTO  (DP057-MESSAGE-SEL-REC)                        08200000
082100             ITEM  (ASC-SEL-ITEM)                                 08210000
082200             RESP  (PV-CICS-RESPONSE)                             08220000
082300     END-EXEC.                                                    08230000
082400                                                                  08240000
082500     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   08250000
082600         CONTINUE                                                 08260000
082700     ELSE                                                         08270000
082800         SET DP013-LOGIC-ABEND                                    08280000
082900             DP013-NO-ROLLBACK     TO TRUE                        08290000
083000         MOVE '9100-READ-SEL-QUEUE'                               08300000
083100                                   TO DP013-PARAGRAPH             08310000
083200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   08320000
083300                                   TO DP013-MESSAGE-TEXT (1)      08330000
083400         PERFORM DP013-0000-PROCESS-ABEND                         08340000
083500     END-IF.                                                      08350000
083600*----------------------------------------------------------------*08360000
083700* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *08370000
083800*----------------------------------------------------------------*08380000
083900 9200-REWRITE-LIST-QUEUE.                                         08390000
084000     EXEC CICS                                                    08400000
084100          WRITEQ TS                                               08410000
084200              QUEUE  (ASC-SEL-QUEUE-NAME)                         08420000
084300              FROM   (DP057-MESSAGE-SEL-REC)                      08430000
084400              ITEM   (ASC-SEL-ITEM)                               08440000
084500              RESP   (PV-CICS-RESPONSE)                           08450000
084600              REWRITE                                             08460000
084700     END-EXEC.                                                    08470000
084800                                                                  08480000
084900     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               08490000
085000         SET DP013-CICS-ABEND                                     08500000
085100             DP013-NO-ROLLBACK     TO TRUE                        08510000
085200         MOVE '9200-REWRITE-LIST-QUEUE'                           08520000
085300                                   TO DP013-PARAGRAPH             08530000
085400         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   08540000
085500                                   TO DP013-MESSAGE-TEXT (1)      08550000
085600         PERFORM DP013-0000-PROCESS-ABEND                         08560000
085700     END-IF.                                                      08570000
085800                                                                  08580000
085900 EJECT                                                            08590000
086000*----------------------------------------------------------------*08600000
086100*    ABEND PROCESSOR MODULE                                      *08610000
086200*----------------------------------------------------------------*08620000
086300                                                                  08630000
086400     COPY DPPD013.                                                08640000
