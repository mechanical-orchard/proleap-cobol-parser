000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    XLKUT040.                                         00040000
000500 AUTHOR.        DEANNA BRANTNER.                                  00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   APRIL, 2003.                                      00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS PROGRAM WILL USE THE COMBINE FILE FROM XLKUT038 AND     * 00100000
001100*  TPOPRPK, TO CREATE PO DOMAIN TEMPLATE:  XXT_PO_INDB_ALLOC.     00110000
001200***************************************************************** 00120000
001300 ENVIRONMENT DIVISION.                                            00130000
001400 INPUT-OUTPUT SECTION.                                            00140000
001500                                                                  00150000
001600 FILE-CONTROL.                                                    00160000
001700                                                                  00170000
001800     SELECT XLKUT038-FILE                                         00180000
001900         ASSIGN TO INP01.                                         00190000
002000                                                                  00200000
002100     SELECT TPOPRPK-FILE                                          00210000
002200         ASSIGN TO INP02.                                         00220000
002300                                                                  00230000
002400     SELECT XL19-OUT-FILE                                         00240000
002500         ASSIGN TO OUT01.                                         00250000
002600                                                                  00260000
002700***************************************************************** 00270000
002800 DATA DIVISION.                                                   00280000
002900***************************************************************** 00290000
003000 FILE SECTION.                                                    00300000
003100                                                                  00310000
003200 FD  XLKUT038-FILE                                                00320000
003300     RECORDING MODE IS F                                          00330000
003400     BLOCK CONTAINS 0 RECORDS                                     00340000
003500     LABEL RECORDS ARE STANDARD.                                  00350000
003600                                                                  00360000
003700 01  XLKUT038-RECORD              PIC X(530).                     00370000
003800                                                                  00380000
003900 FD  TPOPRPK-FILE                                                 00390000
004000     RECORDING MODE IS F                                          00400000
004100     BLOCK CONTAINS 0 RECORDS                                     00410000
004200     LABEL RECORDS ARE STANDARD.                                  00420000
004300                                                                  00430000
004400 01  TPOPRPK-RECORD               PIC X(104).                     00440000
004500                                                                  00450000
004600 FD  XL19-OUT-FILE                                                00460000
004700     RECORDING MODE IS F                                          00470000
004800     BLOCK CONTAINS 0 RECORDS                                     00480000
004900     LABEL RECORDS ARE STANDARD.                                  00490000
005000                                                                  00500000
005100 01  XL19-OUT-REC                 PIC X(113).                     00510000
005200                                                                  00520000
005300***************************************************************** 00530000
005400 WORKING-STORAGE SECTION.                                         00540000
005500                                                                  00550000
005600 01  PS-PROGRAM-SWITCHES.                                         00560000
005700     05  PS-EOF-XLKUT038-SW           PIC X(01)  VALUE 'N'.       00570000
005800         88  PS-EOF-XLKUT038-YES                 VALUE 'Y'.       00580000
005900         88  PS-EOF-XLKUT038-NO                  VALUE 'N'.       00590000
006000     05  PS-EOF-TPOPRPK-SW            PIC X(01)  VALUE 'N'.       00600000
006100         88  PS-EOF-TPOPRPK-YES                  VALUE 'Y'.       00610000
006200         88  PS-EOF-TPOPRPK-NO                   VALUE 'N'.       00620000
006300     05  PS-TPOPRPK-FOUND-SW          PIC X(01)  VALUE 'N'.       00630000
006400         88  PS-TPOPRPK-FOUND                    VALUE 'Y'.       00640000
006500         88  PS-TPOPRPK-NOT-FOUND                VALUE 'N'.       00650000
006600     05  PS-FIRST-TIME-SW             PIC X(01)  VALUE 'Y'.       00660000
006700         88  PS-FIRST-TIME                       VALUE 'Y'.       00670000
006800         88  PS-NOT-FIRST-TIME                   VALUE 'N'.       00680000
006900                                                                  00690000
007000 01  PC-PROGRAM-CONSTANTS.                                        00700000
007100     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'XLKUT040'.00710000
007200     05  PC-ZEROES                    PIC  S9(9) COMP VALUE +0.   00720000
007300                                                                  00730000
007400 01  PV-PROGRAM-VARIABLES.                                        00740000
007500     05  PV-RECS-READ-XLKUT038        PIC  9(09) VALUE  0.        00750000
007600     05  PV-19-RECS-WRITTEN           PIC  9(09) VALUE  0.        00760000
007700     05  PV-PREV-KEY.                                             00770000
007800         10  PV-PO-NBR-OLD            PIC  9(09) VALUE  0.        00780000
007900         10  PV-PO-LNE-OLD            PIC  9(09) VALUE  0.        00790000
008000     05  PV-CURR-KEY.                                             00800000
008100         10  PV-PO-NBR-CUR            PIC  9(09) VALUE  0.        00810000
008200         10  PV-PO-LNE-CUR            PIC  9(09) VALUE  0.        00820000
008300     05  PV-REC-TYP-OLD               PIC  X(01) VALUE ' '.       00830000
008400     05  PV-REC-TYP-CUR               PIC  X(01) VALUE ' '.       00840000
008500     05  PV-PREV-LINE-KEY             PIC  9(04) VALUE  0.        00850000
008600     05  PV-CURR-LINE-KEY             PIC  9(04) VALUE  0.        00860000
008700     05  PV-DIR-STR-IND               PIC  X(01) VALUE ' '.       00870000
008800     05  PV-PKGNG-CDE                 PIC  X(01) VALUE ' '.       00880000
008900     05  PV-PREPK-RATO-QTY            PIC S9(04) COMP VALUE 0.    00890000
009000     05  PV-CURR-PO-PREPK-ID          PIC S9(04) COMP VALUE 0.    00900000
009100     05  PV-PREV-PO-PREPK-ID          PIC S9(04) COMP VALUE 0.    00910000
009200     05  PV-QTY-COUNT                 PIC S9(09) COMP-3.          00920000
009300     05  PV-DISPLAY-SQL               PIC ZZZ9-.                  00930000
009400                                                                  00940000
009500 01  PV-DATABASE-KEYS.                                            00950000
009600     05  DK-PO-NBR                    PIC S9(09) COMP.            00960000
009700     05  DK-LINE-NBR                  PIC S9(09) COMP.            00970000
009800                                                                  00980000
009900 01  ABEND-CODE                       PIC S9(4)  VALUE +0         00990000
010000                                                 COMP SYNC.       01000000
010100 01  PV-ABEND-FIELDS.                                             01010000
010200     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'XLKUT040'.01020000
010300     05  FILLER                       PIC  X(01) VALUE SPACES.    01030000
010400     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    01040000
010500     05  FILLER                       PIC  X(01) VALUE SPACES.    01050000
010600     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01060000
010700     05  FILLER                       PIC  X(01) VALUE SPACES.    01070000
010800     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01080000
010900                                                                  01090000
011000***********************************************************       01100000
011100*  COPYBOOK USED FOR THE XLKUT038 INPUT FILE              *       01110000
011200***********************************************************       01120000
011300     COPY XLRD029.                                                01130000
011400                                                                  01140000
011500***********************************************************       01150000
011600*  COPYBOOK USED FOR THE XXT_PO_INBD_ALLOC OUTPUT FILE            01160000
011700***********************************************************       01170000
011800 01  PC-19-OUT-RECORD.                                            01180000
011900     COPY XLRD019.                                                01190000
012000                                                                  01200000
012100***********************************************************       01210000
012200*  DB2 FORMATTED MESSAGE AREA                                     01220000
012300***********************************************************       01230000
012400      COPY DPWS004.                                               01240000
012500                                                                  01250000
012600***********************************************************       01260000
012700*  COMMUNICATIONS AREA FOR DB2                            *       01270000
012800***********************************************************       01280000
012900     EXEC SQL                                                     01290000
013000         INCLUDE SQLCA                                            01300000
013100     END-EXEC.                                                    01310000
013200                                                                  01320000
013300***********************************************************       01330000
013400*  COPYBOOK USED FOR THE TPOPRPK INPUT FILE               *       01340000
013500***********************************************************       01350000
013600     EXEC SQL                                                     01360000
013700         INCLUDE TPOPRPK                                          01370000
013800     END-EXEC.                                                    01380000
013900                                                                  01390000
014000***********************************************************       01400000
014100*  COPYBOOK USED FOR THE TALLPLN SELECT                   *       01410000
014200***********************************************************       01420000
014300     EXEC SQL                                                     01430000
014400         INCLUDE TALLPLN                                          01440000
014500     END-EXEC.                                                    01450000
014600                                                                  01460000
014700***************************************************************** 01470000
014800 PROCEDURE DIVISION.                                              01480000
014900***************************************************************** 01490000
015000     DISPLAY '**** BEGINNING XLKUT040 ****'.                      01500000
015100     DISPLAY ' '.                                                 01510000
015200                                                                  01520000
015300     OPEN INPUT  XLKUT038-FILE                                    01530000
015400*                TPOPRPK-FILE                                     01540000
015500          OUTPUT XL19-OUT-FILE.                                   01550000
015600                                                                  01560000
015700     PERFORM 1000-READ-XLKUT038-INPUT-FILE.                       01570000
015800     MOVE XL029-PO-NBR      TO  PV-PO-NBR-OLD                     01580000
015900                                PV-PO-NBR-CUR.                    01590000
016000     MOVE XL029-PO-LNE-NBR  TO  PV-PO-LNE-OLD                     01600000
016100                                PV-PO-LNE-CUR.                    01610000
016200                                                                  01620000
016300     INITIALIZE XL019-DATA-AREA.                                  01630000
016400                                                                  01640000
016500     PERFORM 2000-PROCESS-INPUT-FILE                              01650000
016600       UNTIL PS-EOF-XLKUT038-YES.                                 01660000
016700                                                                  01670000
016800     CLOSE XLKUT038-FILE                                          01680000
016900*          TPOPRPK-FILE                                           01690000
017000           XL19-OUT-FILE.                                         01700000
017100                                                                  01710000
017200     DISPLAY '  INPUT XLKUT038 RECS    = ' PV-RECS-READ-XLKUT038. 01720000
017300     DISPLAY '  OUTPUT XLRD019 RECS    = ' PV-19-RECS-WRITTEN.    01730000
017400     DISPLAY ' '.                                                 01740000
017500     DISPLAY '****  END OF  XLKUT040  ****'.                      01750000
017600                                                                  01760000
017700     GOBACK.                                                      01770000
017800                                                                  01780000
017900***************************************************************** 01790000
018000*  READ A XLKUT038 RECORD                                         01800000
018100***************************************************************** 01810000
018200 1000-READ-XLKUT038-INPUT-FILE.                                   01820000
018300                                                                  01830000
018400     MOVE '1000-READ-XLKUT038-INPUT-FILE' TO PV-ABEND-PARAGRAPH.  01840000
018500                                                                  01850000
018600     INITIALIZE XL029-DATA.                                       01860000
018700                                                                  01870000
018800     READ XLKUT038-FILE                                           01880000
018900          INTO XL029-DATA                                         01890000
019000            AT END                                                01900000
019100               SET PS-EOF-XLKUT038-YES TO TRUE                    01910000
019200     END-READ.                                                    01920000
019300                                                                  01930000
019400     IF PS-EOF-XLKUT038-YES                                       01940000
019500          IF PV-REC-TYP-CUR = PV-REC-TYP-OLD                      01950000
019600               IF PV-CURR-PO-PREPK-ID > 0                         01960000
019700                   IF PV-CURR-PO-PREPK-ID  =  PV-PREV-PO-PREPK-ID 01970000
019800                       IF PV-CURR-LINE-KEY  =  PV-PREV-LINE-KEY   01980000
019900                           PERFORM 7000-WRITE-OUTPUT              01990000
020000                       END-IF                                     02000000
020100                   END-IF                                         02010000
020200               ELSE                                               02020000
020300                   PERFORM 7000-WRITE-OUTPUT                      02030000
020400               END-IF                                             02040000
020500          END-IF                                                  02050000
020600     ELSE                                                         02060000
020700         ADD +1 TO PV-RECS-READ-XLKUT038                          02070000
020800         MOVE XL029-PO-NBR      TO PV-PO-NBR-CUR                  02080000
020900         MOVE XL029-PO-LNE-NBR  TO PV-PO-LNE-CUR                  02090000
021000         MOVE XL029-RECORD-TYPE TO PV-REC-TYP-CUR                 02100000
021100     END-IF.                                                      02110000
021200                                                                  02120000
021300***************************************************************** 02130000
021400*  PROCESS INPUT FILE                                           * 02140000
021500***************************************************************** 02150000
021600 2000-PROCESS-INPUT-FILE.                                         02160000
021700                                                                  02170000
021800     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       02180000
021900                                                                  02190000
022000     IF PV-CURR-KEY   =  PV-PREV-KEY                              02200000
022100         PERFORM 3000-CHECK-REC-TYPE                              02210000
022200     ELSE                                                         02220000
022300         IF PV-CURR-KEY   >  PV-PREV-KEY                          02230000
022400             PERFORM 4000-CHECK-LINE-NBR                          02240000
022500         END-IF                                                   02250000
022600     END-IF.                                                      02260000
022700                                                                  02270000
022800     MOVE PV-CURR-KEY   TO  PV-PREV-KEY.                          02280000
022900     PERFORM 1000-READ-XLKUT038-INPUT-FILE.                       02290000
023000                                                                  02300000
023100***************************************************************** 02310000
023200*  EVALUATE CUR RECORD TYPE.                                    * 02320000
023300***************************************************************** 02330000
023400 3000-CHECK-REC-TYPE.                                             02340000
023500     MOVE '3000-CHECK-REC-TYPE' TO PV-ABEND-PARAGRAPH.            02350000
023600******************************************************************02360000
023700*** 10/1/2003 DEANNA BRANTNER                                     02370000
023800*** THE USE OF TMESTDS INFO IS BEING REMOVED BECAUSE STORE NUMBER 02380000
023900*** IS STORED ON TALLPLN AND NO OTHER INFO IS NEEDED.             02390000
024000******************************************************************02400000
024100     EVALUATE XL029-RECORD-TYPE                                   02410000
024200         WHEN '1'                                                 02420000
024300             INITIALIZE XL019-DATA-AREA                           02430000
024400             MOVE XL029-PURCHS-PO-NBR       TO XL019-PO-NBR       02440000
024500             MOVE XL029-PURCHS-PKGNG-CDE    TO PV-PKGNG-CDE       02450000
024600             MOVE XL029-PURCHS-DIR-STR-IND  TO PV-DIR-STR-IND     02460000
024700             MOVE ' '                       TO PV-REC-TYP-OLD     02470000
024800                                                                  02480000
024900         WHEN '2'                                                 02490000
025000             PERFORM 3100-MOVE-TPURITM-INFO                       02500000
025100             MOVE '2'                       TO PV-REC-TYP-OLD     02510000
025200             INITIALIZE XL019-DC-ALLOC-MULT-QTY                   02520000
025300             INITIALIZE XL019-STR-ALLOC-MULT-QTY                  02530000
025400             INITIALIZE XL019-ALLOC-RND-CDE                       02540000
025500             INITIALIZE XL019-SHTG-PRRT-OPT-CDE                   02550000
025600             INITIALIZE XL019-OVRG-PRRT-OPT-CDE                   02560000
025700             INITIALIZE XL019-EXST-SHTG-THRS-IND                  02570000
                   INITIALIZE XL019-CNCLD-QTY                           02580000
025800                                                                  02590000
025900         WHEN '3'                                                 02600000
026000*JPL-START                                                        02610000
026100*AS PART OF THE FIX TO ACCOMMODATE ZERO QTY TALLPLN, THIS CODE WAS02620000
026200*ADDED TO BUILD AN '899' LOCATION ROW IF NO QTY WAS ALLOCATED OR  02630000
026300*CANCELLED.  A DB2 CALL WAS NEEDED TO VERIFY THAT NO ALLOCATIONS  02640000
026400*WERE CREATED AT ANY DC.  IF NONE, THE 899 ROW WILL BE CREATED.   02650000
026500             IF XL029-ALLPLN-CURR-SPLIT-QTY = ZEROES              02660000
026600               AND XL019-CNCLD-QTY NOT > ZEROES                   02670000
026700***              DISPLAY XL029-PO-NBR ' / ' XL029-PO-LNE-NBR      02680000
026800                 MOVE XL029-PO-NBR     TO DK-PO-NBR               02690000
026900                 MOVE XL029-PO-LNE-NBR TO DK-LINE-NBR             02700000
027000                 MOVE ZEROES           TO PV-QTY-COUNT            02710000
027100                 EXEC SQL                                         02720000
027200                     SELECT COUNT(*)                              02730000
027300                       INTO :PV-QTY-COUNT                         02740000
027400                       FROM TALLPLN A                             02750000
027500                      WHERE A.PO_NBR         = :DK-PO-NBR         02760000
027600                        AND A.PO_LNE_NBR     = :DK-LINE-NBR       02770000
027700                        AND A.CURR_SPLIT_QTY > :PC-ZEROES         02780000
027800                 END-EXEC                                         02790000
027900                 EVALUATE TRUE                                    02800000
028000                   WHEN SQLCODE = +0                              02810000
028100                       CONTINUE                                   02820000
028200                   WHEN OTHER                                     02830000
028300                       PERFORM 9100-SQL-ABEND                     02840000
028400                 END-EVALUATE                                     02850000
028500                 IF PV-QTY-COUNT = ZEROES                         02860000
028600                     PERFORM 7000-WRITE-OUTPUT                    02870000
028700***              ELSE                                             02880000
028800***                  DISPLAY '  COUNT = ' PV-QTY-COUNT            02890000
028900                 END-IF                                           02900000
029000             END-IF                                               02910000
029100*JPL-END                                                          02920000
029200             PERFORM 3200-MOVE-TALLPLN-INFO                       02930000
029300             MOVE ' '                       TO PV-REC-TYP-OLD     02940000
029400                                                                  02950000
029500         WHEN '4'                                                 02960000
029600*            IF PV-CURR-PO-PREPK-ID > 0                           02970000
029700                 CONTINUE                                         02980000
029800*            ELSE                                                 02990000
029900*                PERFORM 3300-MOVE-TMESTDS-INFO                   03000000
030000*                MOVE ' '                   TO PV-REC-TYP-OLD     03010000
030100*            END-IF                                               03020000
030200     END-EVALUATE.                                                03030000
030300                                                                  03040000
030400***************************************************************** 03050000
030500*  MOVE TPURITM INFO TO EXTRACT FILE                            * 03060000
030600***************************************************************** 03070000
030700 3100-MOVE-TPURITM-INFO.                                          03080000
030800                                                                  03090000
030900     MOVE '3100-MOVE-TPURITM-INFO ' TO PV-ABEND-PARAGRAPH.        03100000
031000                                                                  03110000
031100     MOVE XL029-PURITM-PO-NBR             TO XL019-PO-NBR.        03120000
031200     MOVE XL029-PURITM-PO-LNE-NBR         TO PV-CURR-LINE-KEY.    03130000
031300     MOVE 899                             TO XL019-LOC-NBR.       03140000
031400     MOVE XL029-PURITM-CNCLD-UNT-QTY      TO XL019-CNCLD-QTY.     03150000
031500     IF XL029-PURITM-PO-PREPK-ID > 0                              03160000
031600         NEXT SENTENCE                                            03170000
031900     ELSE                                                         03180000
032000         MOVE XL029-PURITM-RMS-PO-SKU-NBR TO XL019-SKU-NBR        03190000
033100     END-IF.                                                      03200000
033200     MOVE XL029-PURITM-PREPK-RATO-QTY  TO PV-PREPK-RATO-QTY.      03210000
033300     MOVE XL029-PURITM-PO-PREPK-ID     TO PV-CURR-PO-PREPK-ID.    03220000
033400     IF XL029-PURITM-PO-PREPK-ID > 0                              03230000
033500         IF PV-PREPK-RATO-QTY > 0                                 03240000
033600             COMPUTE XL019-ORD-QTY = XL029-PURITM-UNT-QTY /       03250000
033700                                 PV-PREPK-RATO-QTY                03260000
033800         ELSE                                                     03270000
033900             MOVE ZEROES TO  XL019-ORD-QTY                        03280000
034000         END-IF                                                   03290000
034100     ELSE                                                         03300000
034200         MOVE XL029-PURITM-UNT-QTY TO XL019-ORD-QTY               03310000
034300     END-IF.                                                      03320000
034400     IF XL029-PURITM-PO-PREPK-ID > 0                              03330000
034500         SET PS-TPOPRPK-NOT-FOUND TO TRUE                         03340000
034600         SET PS-EOF-TPOPRPK-NO    TO TRUE                         03350000
034700         IF XL029-PURITM-PO-NBR NOT = POPRPK-PO-NBR               03360000
034800             OPEN INPUT  TPOPRPK-FILE                             03370000
034900             PERFORM 5000-READ-TPOPRPK-INPUT-FILE                 03380000
035000                                           UNTIL PS-TPOPRPK-FOUND 03390000
035100             CLOSE TPOPRPK-FILE                                   03400000
035200         ELSE                                                     03410000
035300             IF XL029-PURITM-PO-NBR = POPRPK-PO-NBR               03420000
035400                 IF XL029-PURITM-PO-PREPK-ID = POPRPK-PO-PREPK-ID 03430000
035500                      MOVE XL029-PURITM-PO-PREPK-ID  TO           03440000
035600                                PV-CURR-PO-PREPK-ID               03450000
035700                                PV-PREV-PO-PREPK-ID               03460000
035800                      PERFORM 5100-MOVE-TPOPRPK-INFO              03470000
035900                 ELSE                                             03480000
036000                     OPEN INPUT  TPOPRPK-FILE                     03490000
036100                     PERFORM 5000-READ-TPOPRPK-INPUT-FILE         03500000
036200                                           UNTIL PS-TPOPRPK-FOUND 03510000
036300                     CLOSE TPOPRPK-FILE                           03520000
036400                 END-IF                                           03530000
036500             END-IF                                               03540000
036600         END-IF                                                   03550000
036700     END-IF.                                                      03560000
036800                                                                  03570000
036900***************************************************************** 03580000
037000*  MOVE TALLPLN INFO TO EXTRACT FILE                            * 03590000
037100***************************************************************** 03600000
037200 3200-MOVE-TALLPLN-INFO.                                          03610000
037300                                                                  03620000
037400     MOVE '3200-MOVE-TALLPLN-INFO ' TO PV-ABEND-PARAGRAPH.        03630000
037500                                                                  03640000
037600     MOVE XL029-ALLPLN-PO-NBR             TO XL019-PO-NBR.        03650000
037700     MOVE XL029-ALLPLN-PO-LNE-NBR         TO PV-CURR-LINE-KEY.    03660000
037800     IF PV-CURR-PO-PREPK-ID > 0                                   03670000
037900         IF PV-PREPK-RATO-QTY > 0                                 03680000
038000             COMPUTE XL019-ORD-QTY = XL029-ALLPLN-CURR-SPLIT-QTY /03690000
038100                                 PV-PREPK-RATO-QTY                03700000
038200         ELSE                                                     03710000
038300             MOVE ZEROES TO  XL019-ORD-QTY                        03720000
038400         END-IF                                                   03730000
038500     ELSE                                                         03740000
038600         MOVE XL029-ALLPLN-CURR-SPLIT-QTY TO XL019-ORD-QTY        03750000
038700     END-IF.                                                      03760000
                                                                        03770000
026000*AHP-START                                                        03780000
037800     IF PV-CURR-PO-PREPK-ID > 0                                   03790000
037900         IF PV-PREPK-RATO-QTY > 0                                 03800000
038000           COMPUTE XL019-CNCLD-QTY =                              03810000
                    XL029-ALLPLN-DC-SPLT-CNCLD-QTY / PV-PREPK-RATO-QTY  03820000
038200         ELSE                                                     03830000
038300             MOVE ZEROES TO  XL019-CNCLD-QTY                      03840000
038400         END-IF                                                   03850000
038500     ELSE                                                         03860000
038600         MOVE XL029-ALLPLN-DC-SPLT-CNCLD-QTY TO XL019-CNCLD-QTY   03870000
038700     END-IF.                                                      03880000
029100*AHP-END                                                          03890000
                                                                        03900000
038800     MOVE XL029-ALLPLN-ALLOC-OUTR-PK-QTY TO                       03910000
038900                                         XL019-DC-ALLOC-MULT-QTY. 03920000
039000     MOVE XL029-ALLPLN-ALOC-PACK-QTY  TO XL019-STR-ALLOC-MULT-QTY.03930000
039100     MOVE XL029-ALLPLN-PK-SIZE-RND-CDE   TO XL019-ALLOC-RND-CDE.  03940000
039200     MOVE XL029-ALLPLN-SHTG-PRRT-OPT-CDE TO                       03950000
039300                                          XL019-SHTG-PRRT-OPT-CDE.03960000
039400     MOVE XL029-ALLPLN-OVRG-PRRT-OPT-CDE TO                       03970000
039500                                          XL019-OVRG-PRRT-OPT-CDE.03980000
039600     MOVE XL029-ALLPLN-EXST-SHTG-THRS-IN TO                       03990000
039700                                         XL019-EXST-SHTG-THRS-IND.04000000
039800     IF PV-CURR-PO-PREPK-ID > 0                                   04010000
039900         IF PV-CURR-PO-PREPK-ID  =  PV-PREV-PO-PREPK-ID           04020000
040000             IF PV-CURR-LINE-KEY  =  PV-PREV-LINE-KEY             04030000
040100                 MOVE XL029-ALLPLN-DEST-NBR    TO XL019-LOC-NBR   04040000
040200                 PERFORM 7000-WRITE-OUTPUT                        04050000
040300                 MOVE XL029-ALLPLN-PO-LNE-NBR  TO PV-PREV-LINE-KEY04060000
040400             END-IF                                               04070000
040500         END-IF                                                   04080000
040600     ELSE                                                         04090000
040700*        IF PV-DIR-STR-IND = 'N'                                  04100000
040800             MOVE XL029-ALLPLN-DEST-NBR    TO XL019-LOC-NBR       04110000
040900             PERFORM 7000-WRITE-OUTPUT                            04120000
041000*        END-IF                                                   04130000
041100     END-IF.                                                      04140000
041200                                                                  04150000
041300***************************************************************** 04160000
041400*  MOVE TMESTDS INFO TO EXTRACT FILE                            * 04170000
041500***************************************************************** 04180000
041600 3300-MOVE-TMESTDS-INFO.                                          04190000
041700                                                                  04200000
041800     MOVE '3300-MOVE-TMESTDS-INFO ' TO PV-ABEND-PARAGRAPH.        04210000
041900                                                                  04220000
042000     MOVE XL029-MESTDS-PO-NBR         TO XL019-PO-NBR.            04230000
042100     IF PV-DIR-STR-IND = 'Y'                                      04240000
042200         MOVE XL029-MESTDS-STR-NBR    TO XL019-LOC-NBR            04250000
042300         PERFORM 7000-WRITE-OUTPUT                                04260000
042400     END-IF.                                                      04270000
042500                                                                  04280000
042600***************************************************************** 04290000
042700*  EVALUATE PREV LINE NUMBER.                                   * 04300000
042800***************************************************************** 04310000
042900 4000-CHECK-LINE-NBR.                                             04320000
043000                                                                  04330000
043100     MOVE '4000-CHECK-LINE-NBR' TO PV-ABEND-PARAGRAPH.            04340000
043200                                                                  04350000
043300     IF PV-REC-TYP-CUR = PV-REC-TYP-OLD                           04360000
043400         IF PV-CURR-PO-PREPK-ID > 0                               04370000
043500             IF PV-CURR-PO-PREPK-ID  =  PV-PREV-PO-PREPK-ID       04380000
043600                 IF PV-CURR-LINE-KEY  =  PV-PREV-LINE-KEY         04390000
043700                     PERFORM 7000-WRITE-OUTPUT                    04400000
043800                     MOVE XL029-PURITM-PO-LNE-NBR TO              04410000
043900                                                PV-CURR-LINE-KEY  04420000
044000                     INITIALIZE PV-PREPK-RATO-QTY                 04430000
044100                     PERFORM 3000-CHECK-REC-TYPE                  04440000
044200                 ELSE                                             04450000
044300                     INITIALIZE PV-PREPK-RATO-QTY                 04460000
044400                     PERFORM 3000-CHECK-REC-TYPE                  04470000
044500                 END-IF                                           04480000
044600             ELSE                                                 04490000
044700                 INITIALIZE PV-PREPK-RATO-QTY                     04500000
044800                 PERFORM 3000-CHECK-REC-TYPE                      04510000
044900             END-IF                                               04520000
045000         ELSE                                                     04530000
045100             PERFORM 7000-WRITE-OUTPUT                            04540000
045200             INITIALIZE PV-PREPK-RATO-QTY                         04550000
045300             PERFORM 3000-CHECK-REC-TYPE                          04560000
045400         END-IF                                                   04570000
045500     ELSE                                                         04580000
045600         IF PV-REC-TYP-CUR = '1' AND PV-REC-TYP-OLD = '2'         04590000
045700             IF PV-CURR-PO-PREPK-ID > 0                           04600000
045800                 CONTINUE                                         04610000
045900             ELSE                                                 04620000
046000                 PERFORM 7000-WRITE-OUTPUT                        04630000
046100                 INITIALIZE PV-PREPK-RATO-QTY                     04640000
046200                 INITIALIZE XL019-DATA-AREA                       04650000
046300                 PERFORM 3000-CHECK-REC-TYPE                      04660000
046400             END-IF                                               04670000
046500         ELSE                                                     04680000
046600             EVALUATE PV-PO-LNE-OLD                               04690000
046700                 WHEN  0                                          04700000
046800                     EVALUATE PV-PO-LNE-CUR                       04710000
046900                         WHEN  0                                  04720000
047000                            INITIALIZE PV-PREPK-RATO-QTY          04730000
047100                            PERFORM 3000-CHECK-REC-TYPE           04740000
047200                         WHEN  OTHER                              04750000
047300                            MOVE XL029-PO-LNE-NBR TO              04760000
047400                                                 PV-CURR-LINE-KEY 04770000
047500                                                 PV-PREV-LINE-KEY 04780000
047600                            PERFORM 3000-CHECK-REC-TYPE           04790000
047700                     END-EVALUATE                                 04800000
047800                 WHEN OTHER                                       04810000
047900                     INITIALIZE PV-PREPK-RATO-QTY                 04820000
048000                     PERFORM 3000-CHECK-REC-TYPE                  04830000
048100             END-EVALUATE                                         04840000
048200         END-IF                                                   04850000
048300     END-IF.                                                      04860000
048400                                                                  04870000
048500***************************************************************** 04880000
048600*  READ A TPOPRPK RECORD                                          04890000
048700***************************************************************** 04900000
048800 5000-READ-TPOPRPK-INPUT-FILE.                                    04910000
048900                                                                  04920000
049000     MOVE '5000-READ-TPOPRPK-INPUT-FILE' TO PV-ABEND-PARAGRAPH.   04930000
049100                                                                  04940000
049200     IF PS-EOF-TPOPRPK-YES                                        04950000
049300         SET PS-TPOPRPK-FOUND TO TRUE                             04960000
049400     ELSE                                                         04970000
049500         INITIALIZE DCLTPOPRPK                                    04980000
049600         READ TPOPRPK-FILE                                        04990000
049700              INTO DCLTPOPRPK                                     05000000
049800                AT END                                            05010000
049900                   SET PS-EOF-TPOPRPK-YES TO TRUE                 05020000
050000         END-READ                                                 05030000
050100         IF XL029-PURITM-PO-NBR = POPRPK-PO-NBR                   05040000
050200             IF XL029-PURITM-PO-PREPK-ID = POPRPK-PO-PREPK-ID     05050000
050300                 MOVE XL029-PURITM-PO-PREPK-ID  TO                05060000
050400                                PV-CURR-PO-PREPK-ID               05070000
050500                                PV-PREV-PO-PREPK-ID               05080000
050600                 MOVE XL029-PURITM-PO-LNE-NBR   TO                05090000
050700                                PV-CURR-LINE-KEY                  05100000
050800                                PV-PREV-LINE-KEY                  05110000
050900                 PERFORM 5100-MOVE-TPOPRPK-INFO                   05120000
051000                 SET PS-TPOPRPK-FOUND TO TRUE                     05130000
051100             END-IF                                               05140000
051200         ELSE                                                     05150000
051300             IF PS-EOF-TPOPRPK-YES                                05160000
051400                  SET PS-TPOPRPK-FOUND TO TRUE                    05170000
051500             END-IF                                               05180000
051600         END-IF                                                   05190000
051700     END-IF.                                                      05200000
051800                                                                  05210000
051900***************************************************************** 05220000
052000*  MOVE TPOPRPK INFO TO EXTRACT FILE                            * 05230000
052100***************************************************************** 05240000
052200 5100-MOVE-TPOPRPK-INFO.                                          05250000
052300                                                                  05260000
052400     MOVE '5100-MOVE-TPOPRPK-INFO ' TO PV-ABEND-PARAGRAPH.        05270000
052500                                                                  05280000
052600     IF PV-CURR-PO-PREPK-ID > 0                                   05290000
052700         MOVE POPRPK-PK-SKU-NBR    TO  XL019-SKU-NBR              05300000
052800     END-IF.                                                      05310000
052900                                                                  05320000
053000***************************************************************** 05330000
053100*  WRITE A RECORDS TO THE LOGISTICS SKU OUTPUT FILE             * 05340000
053200***************************************************************** 05350000
053300 7000-WRITE-OUTPUT.                                               05360000
053400                                                                  05370000
053500     WRITE XL19-OUT-REC  FROM                                     05380000
053600         XL019-RECORD                                             05390000
053700     END-WRITE.                                                   05400000
053800     ADD +1                 TO PV-19-RECS-WRITTEN.                05410000
053900                                                                  05420000
054000******************************************************************05430000
054100*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    05440000
054200*  ERROR OR WARNING CODE OCCURS.                                  05450000
054300******************************************************************05460000
054400 9100-SQL-ABEND.                                                  05470000
054500     DISPLAY '9100-SQL-ABEND'.                                    05480000
054600     DISPLAY '**** ABEND ****'.                                   05490000
054700     DISPLAY '** PROGRAM   ** = XLKUT040'                         05500000
054800     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             05510000
054900     MOVE SQLCODE  TO PV-DISPLAY-SQL.                             05520000
055000     DISPLAY '** SQLCODE   ** = ' PV-DISPLAY-SQL.                 05530000
055100                                                                  05540000
055200******************************************************************05550000
055300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    05560000
055400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05570000
055500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05580000
055600* FORMAT.                                                         05590000
055700******************************************************************05600000
055800     COPY DPPD004.                                                05610000
055900                                                                  05620000
056000     MOVE +4013         TO ABEND-CODE.                            05630000
056100     CALL 'ILBOABN0' USING ABEND-CODE.                            05640000
