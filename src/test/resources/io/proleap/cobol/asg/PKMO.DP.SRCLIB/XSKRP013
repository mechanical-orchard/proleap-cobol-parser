000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.      XSKRP013.                                       00020000
000300 AUTHOR.          DOUG JONES / NANCY MARTIN                       00030000
000400 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040000
000500 DATE-WRITTEN.    04/30/2003.                                     00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800**XS DOMAIN TABLE INTEGRITY CHECK - FOR TABLE XST_SKU_LOC_ATTR    00080000
000900******************************************************************00090000
001000**THIS PROGRAM VALIDATES THE DATA IN THE XS DOMAIN IS THE SAME    00100000
001100**AS THE DATA IN THE SOR                                          00110000
NEMADD**   THIS PROGRAM WAS CLONED FROM XSKRP009/XSKRP012               00120000
NEMADD**   PROGRAM CREATED FOR NEW PROMO SYSTEM WORK WR21428            00130000
001200******************************************************************00140000
001300 ENVIRONMENT DIVISION.                                            00150000
001400 CONFIGURATION SECTION.                                           00160000
001500 SOURCE-COMPUTER.        IBM-3090.                                00170000
001600 OBJECT-COMPUTER.        IBM-3090.                                00180000
001700 INPUT-OUTPUT SECTION.                                            00190000
001800 FILE-CONTROL.                                                    00200000
001900                                                                  00210000
002000     SELECT SKIP-RECD-CNTL-FILE                                   00220000
002100            ASSIGN TO INP01.                                      00230000
002400     SELECT SOR-SKU-LOC-ATTR-EXT-FILE                             00240000
002500            ASSIGN TO INP02.                                      00250000
002600     SELECT XS-SKU-LOC-ATTR-EXT-FILE                              00260000
002700            ASSIGN TO INP03.                                      00270000
002800     SELECT XS-SKU-LOC-INTEG-RPT-FILE                             00280000
002900            ASSIGN TO RPT01.                                      00290000
003000                                                                  00300000
003100 DATA DIVISION.                                                   00310000
003200 FILE SECTION.                                                    00320000
003300                                                                  00330000
003400 FD  SKIP-RECD-CNTL-FILE                                          00340000
003500     RECORDING MODE F                                             00350000
003600     BLOCK CONTAINS 0 RECORDS                                     00360000
003700     LABEL RECORDS ARE OMITTED                                    00370000
003800     DATA RECORD IS SKIP-RECD-CNTL-RECORD.                        00380000
003900 01  SKIP-RECD-CNTL-RECORD            PIC X(080).                 00390000
004700                                                                  00400000
004800 FD  SOR-SKU-LOC-ATTR-EXT-FILE                                    00410000
004900     RECORDING MODE F                                             00420000
005000     BLOCK CONTAINS 0 RECORDS                                     00430000
005100     LABEL RECORDS ARE OMITTED                                    00440000
005200     DATA RECORD IS SOR-SKU-LOC-ATTR-EXT-RECORD.                  00450000
005300 01  SOR-SKU-LOC-ATTR-EXT-RECORD     PIC X(173).                  00460000
005400                                                                  00470000
005500 FD  XS-SKU-LOC-ATTR-EXT-FILE                                     00480000
005600     RECORDING MODE F                                             00490000
005700     BLOCK CONTAINS 0 RECORDS                                     00500000
005800     LABEL RECORDS ARE OMITTED                                    00510000
005900     DATA RECORD IS XS-SKU-LOC-ATTR-EXT-RECORD.                   00520000
006000 01  XS-SKU-LOC-ATTR-EXT-RECORD      PIC X(006).                  00530000
006100                                                                  00540000
006200 FD  XS-SKU-LOC-INTEG-RPT-FILE                                    00550000
006300     RECORDING MODE IS F                                          00560000
006400     BLOCK CONTAINS 0  RECORDS.                                   00570000
006500 01  XS-SKU-LOC-INTEG-RPT-RECORD     PIC  X(200).                 00580000
006600                                                                  00590000
006700 WORKING-STORAGE SECTION.                                         00600000
006800                                                                  00610000
006900 01  FILLER                              PIC X(41)                00620000
007000     VALUE 'WORKING STORAGE STARTS HERE FOR XSKRP013'.            00630000
007100                                                                  00640000
007200 01  PS-PROGRAM-SWITCHES.                                         00650000
007300     05  PS-END-SKIP-RECD-FILE-SW        PIC X(01) VALUE 'N'.     00660000
007400         88  PS-END-SKIP-RECD-FILE                 VALUE 'Y'.     00670000
007500         88  PS-NOT-END-SKIP-RECD-FILE             VALUE 'N'.     00680000
007900     05  PS-END-OF-SOR-SKU-LOC-SW        PIC X(01) VALUE 'N'.     00690000
008000         88  PS-END-OF-SOR-SKU-LOC                 VALUE 'Y'.     00700000
008100         88  PS-NOT-END-OF-SOR-SKU-LOC             VALUE 'N'.     00710000
008200     05  PS-END-OF-XS-SKU-LOC-SW         PIC X(01) VALUE 'N'.     00720000
008300         88  PS-END-OF-XS-SKU-LOC                  VALUE 'Y'.     00730000
008400         88  PS-NOT-END-OF-XS-SKU-LOC              VALUE 'N'.     00740000
008500     05  PS-VENDOR-DESCRIPTION-ERROR-SW  PIC X(01) VALUE 'N'.     00750000
008600         88  PS-LOC-STR-NBR-ERROR                  VALUE 'Y'.     00760000
008700         88  PS-NO-LOC-STR-NBR-ERROR               VALUE 'N'.     00770000
008800     05  PS-INTR-UPC-ID-ERROR-SW         PIC X(01) VALUE 'N'.     00780000
008900         88  PS-INTR-UPC-ID-ERROR                  VALUE 'Y'.     00790000
009000         88  PS-NO-INTR-UPC-ID-ERROR               VALUE 'N'.     00800000
009100     05  PS-ERROR-FOUND-SW               PIC X(01) VALUE 'N'.     00810000
009200         88  PS-ERROR-FOUND                        VALUE 'Y'.     00820000
009300         88  PS-NO-ERROR-FOUND                     VALUE 'N'.     00830000
009400                                                                  00840000
010500 01  PC-PROGRAM-CONSTANTS.                                        00850000
010600     05  PC-CURRENT-PROGRAM-NAME         PIC X(08)  VALUE         00860000
010700                                                    'XSKRP013'.   00870000
010800     05  PC-REPORT-NBR-1                 PIC  9(01) VALUE 1.      00880000
010900     05  PC-ONE                          PIC  9(01) VALUE 1.      00890000
011200     05  PC-MAX-REPORT-LINES             PIC S9(05) VALUE +74     00900000
011300                                                    COMP-3.       00910000
011400                                                                  00920000
011500     05  PC-NO-ERROR-MESSAGE             PIC  X(200) VALUE        00930000
011600         'NO ERRORS'.                                             00940000
011900                                                                  00950000
012000     05  PC-MISMATCHED-INTR-UPC-ID       PIC  X(35) VALUE         00960000
012100         'INTR UPC ID NUMBERS NOT IN SYNCH   '.                   00970000
012200                                                                  00980000
012300     05  PC-MISMATCHED-STR-LOC-NBRS      PIC  X(53) VALUE         00990000
012400         'INTR UPC ID MATCH BUT LOCATION NOT ON BOTH FILES'.      01000000
012500                                                                  01010000
012600     05  PC-MISSING-FROM-SOR-SKU-LOC     PIC  X(53) VALUE         01020000
012700         'MATCHING DATA IS NOT FOUND ON SOR SKU LOC ATTR EXT'.    01030000
012800                                                                  01040000
012900     05  PC-MISSING-FROM-XS-SKU-LOC      PIC  X(52) VALUE         01050000
013000         'MATCHING DATA IS NOT FOUND ON XS SKU LOC ATTR EXT'.     01060000
013100                                                                  01070000
012600     05  PC-EXTRA-FOUND-SOR-SKU-LOC      PIC  X(53) VALUE         01080000
012700         'ADDITIONAL DATA FOUND FOR SOR SKU LOC ATTR EXT   '.     01090000
012800                                                                  01100000
012900     05  PC-EXTRA-FOUND-XS-SKU-LOC      PIC  X(52) VALUE          01101000
013000         'ADDITTIONAL DATA FOUND ON XS SKU LOC ATTR EXTRACT'.     01102000
013100                                                                  01103000
013200 01  PV-MISCELANEOUS.                                             01104000
013300     05  PV-TEMP-INTR-UPC-ID             PIC S9(11) COMP          01105000
                                                   VALUE ZEROS.         01106000
013400     05  PV-PRINT-RECORD                 PIC X(200) VALUE SPACE.  01107000
013500     05  PV-LINE-SPACING                 PIC S9(04) VALUE ZEROES  01108000
013600                                                    COMP SYNC.    01109000
013700     05  PV-CURR-TIME.                                            01110000
013800        10  PV-CURR-TIME-HH              PIC  9(02) VALUE ZEROES. 01120000
013900        10  PV-CURR-TIME-MM              PIC  9(02) VALUE ZEROES. 01130000
014000        10  PV-CURR-TIME-SSHH            PIC  9(04) VALUE ZEROES. 01140000
014100                                                                  01150000
014200     05  PV-CURR-DATE-CCYYMMDD.                                   01160000
014300         10  PV-CURR-DATE-CCYY           PIC  9(04) VALUE ZEROES. 01170000
014400         10  PV-CURR-DATE-MM             PIC  9(02) VALUE ZEROES. 01180000
014500         10  PV-CURR-DATE-DD             PIC  9(02) VALUE ZEROES. 01190000
014600                                                                  01200000
014700 01  PV-PROGRAM-COUNTER.                                          01210000
014800     05  PV-PAGE-CNT                     PIC  9(05) VALUE ZEROS.  01220000
014900     05  PV-LINE-CNT                     PIC S9(07) VALUE ZEROS.  01230000
015000     05  PV-SOR-SKU-LOC-RECS-READ-CNT    PIC  9(09) VALUE ZEROS.  01240000
015100     05  PV-SOR-READ-SKIP-CNT            PIC 9(09) VALUE ZEROS.   01250000
015200     05  PV-XS-EXTRACT-REC-READ-CNT      PIC  9(09) VALUE ZEROS.  01260000
015300     05  PV-ERROR-RECORD-WRITTEN-CNT     PIC  9(09) VALUE ZEROS.  01270000
015400     05  PV-VALID-MATCH-CNT              PIC  9(09) VALUE ZEROS.  01280000
015500                                                                  01290000
015600 01  PV-MISC-ABEND-FIELDS.                                        01300000
015700     05  PV-PARAGRAPH-NAME               PIC  X(30) VALUE SPACE.  01310000
015800     05  PV-OPERATION-MSG-1              PIC  X(40) VALUE SPACE.  01320000
NEMDEL******         123456789-123456789-123456789-123465789-           01330000
015900     05  PV-OPERATION-MSG-2              PIC  X(40) VALUE SPACE.  01340000
NEMDEL**   05  PV-DB2-OPERATION                PIC  X(30) VALUE SPACE.  01350000
016100                                                                  01360000
016200 01  PV-ABEND-CODE   COMP  SYNC          PIC S9(04) VALUE +0000.  01370000
016300     88  PV-ABEND-4008-DATA-ERROR                   VALUE +4008.  01380000
016400     88  PV-ABEND-4009-CARD-ERROR                   VALUE +4009.  01390000
NEMDEL***  88  PV-ABEND-4013-DB2-ERROR                    VALUE +4013.  01400000
016700                                                                  01410000
016800******************************************************************01420000
016900*  TOP OF PAGE HEADING LINE FOR PRINTING A 200 CHARACTER REPORT.  01430000
017000******************************************************************01440000
017100     COPY DPWS200.                                                01450000
017200                                                                  01460000
017300 01  HL2-HEADING-LINE-2.                                          01470000
017400     05  FILLER                  PIC X(84)   VALUE SPACES.        01480000
017500     05  FILLER                  PIC X(33)   VALUE                01490000
017600         'XS SKU LOC ATTR  INTEGRITY ERRORS'.                     01500000
017700     05  FILLER                  PIC X(83)   VALUE SPACES.        01510000
017800                                                                  01520000
017900 01  HL3-HEADING-LINE-3.                                          01530000
018000     05  FILLER                  PIC X(01)   VALUE SPACES.        01540000
018400     05  FILLER                  PIC X(19)   VALUE                01550000
018500         '------SOR KEY------'.                                   01560000
018600     05  FILLER                  PIC X(02)   VALUE SPACES.        01570000
018700     05  FILLER                  PIC X(19)   VALUE                01580000
018800         '------ XS KEY------'.                                   01590000
018900     05  FILLER                  PIC X(02)   VALUE SPACES.        01600000
019000     05  FILLER                  PIC X(35)   VALUE                01610000
019100         '--------------------- ERROR MESSAGE'.                   01620000
019200     05  FILLER                  PIC X(31)   VALUE                01630000
019300         ' ------------------------------'.                       01640000
019400     05  FILLER                  PIC X(091)  VALUE SPACES.        01650000
019500                                                                  01660000
019600******************************************************************01670000
019700*  DETAIL LINE LAYOUT FOR THE ERROR REPORT.                       01680000
019800******************************************************************01690000
019900 01  DL1-DETAIL-LINE-1.                                           01700000
020000     05  FILLER                  PIC X(01)     VALUE SPACES.      01710000
020100     05  DL1-SOR-INTR-UPC-ID     PIC Z(10)-    VALUE ZEROES.      01720000
020200     05  FILLER                  PIC X(02)     VALUE SPACES.      01730000
020300     05  DL1-SOR-STR-NBR         PIC ZZZZZ     VALUE ZEROES.      01740000
020400     05  FILLER                  PIC X(04)     VALUE SPACES.      01750000
020500     05  DL1-XS-INTR-UPC-ID      PIC Z(10)-    VALUE ZEROES.      01760000
020600     05  FILLER                  PIC X(01)     VALUE SPACES.      01770000
020700     05  DL1-XS-LOC-NBR          PIC ZZZZZ     VALUE ZEROES.      01780000
021000     05  FILLER                  PIC X(03)     VALUE SPACES.      01790000
021100     05  DL1-ERROR-MESSAGE       PIC X(55)     VALUE SPACES.      01800000
021200     05  FILLER                  PIC X(102)    VALUE SPACES.      01810000
021300                                                                  01820000
021400******************************************************************01830000
021500*  TRAILER LAYOUT FOR THE ERROR REPORT.                           01840000
021600******************************************************************01850000
021700 01  TR1-TRAILER-LINE-1.                                          01860000
021800     05  FILLER                  PIC X(25)   VALUE                01870000
021900         ' TOTAL NUMBER OF ERRORS: '.                             01880000
022000     05  TR1-TOTAL-ERROR-CNT     PIC Z(09)   VALUE ZEROS.         01890000
022100     05  FILLER                  PIC X(166)  VALUE SPACES.        01900000
022200                                                                  01910000
022300******************************************************************01920000
022400**COPYBOOKS                                                       01930000
022500******************************************************************01940000
022600                                                                  01950000
022700***VSM EXTRACT FILE LAYOUT                                        01960000
022800     COPY IMRD057.                                                01970000
022900                                                                  01980000
023000***XS EXTRACT FILE LAYOUT                                         01990000
023100     COPY XSRD030.                                                02000000
023200                                                                  02001000
023210***XS DOMAIN INTEGRITY CONTROL CARD                               02002000
023220     COPY XSRD046.                                                02003000
023230                                                                  02004000
023300***************************************************************** 02005000
023400 PROCEDURE DIVISION.                                              02006000
023500***************************************************************** 02007000
023600 0000-MAINLINE.                                                   02008000
023700                                                                  02009000
023800     PERFORM 1000-INITIALIZATION.                                 02010000
023900                                                                  02020000
024000     PERFORM 2000-PROCESS-RECORDS                                 02030000
024100       UNTIL PS-END-OF-SOR-SKU-LOC                                02040000
024200          OR PS-END-OF-XS-SKU-LOC.                                02050000
024300                                                                  02060000
024400     PERFORM 2500-PROCESS-EXTRA-RECORDS                           02070000
024500       UNTIL PS-END-OF-SOR-SKU-LOC                                02080000
024600         AND PS-END-OF-XS-SKU-LOC.                                02090000
024700                                                                  02100000
024710     IF PV-ERROR-RECORD-WRITTEN-CNT = 0                           02110000
024720         MOVE PC-NO-ERROR-MESSAGE TO DL1-DETAIL-LINE-1            02120000
024730         MOVE DL1-DETAIL-LINE-1   TO PV-PRINT-RECORD              02130000
024740         PERFORM 8900-WRITE-REPORT-LINE                           02140000
024750     ELSE                                                         02150000
024760         MOVE PV-ERROR-RECORD-WRITTEN-CNT TO                      02160000
024770                TR1-TOTAL-ERROR-CNT                               02170000
024780         MOVE TR1-TRAILER-LINE-1  TO PV-PRINT-RECORD              02180000
024790         PERFORM 8900-WRITE-REPORT-LINE                           02190000
024791     END-IF.                                                      02200000
024792                                                                  02210000
024800     PERFORM 9000-END-OF-PGM.                                     02220000
024900                                                                  02230000
025000     GOBACK.                                                      02240000
025100                                                                  02250000
025200******************************************************************02260000
025300*1000-INITIALIZATION.                                             02270000
025400* INITIALIZATION AREA                                             02280000
025500******************************************************************02290000
025600 1000-INITIALIZATION.                                             02300000
025700                                                                  02310000
025800     INITIALIZE PV-PROGRAM-COUNTER.                               02320000
025900                                                                  02330000
026000     OPEN INPUT  SKIP-RECD-CNTL-FILE                              02340000
026200                 SOR-SKU-LOC-ATTR-EXT-FILE                        02350000
026300                 XS-SKU-LOC-ATTR-EXT-FILE.                        02360000
026400                                                                  02370000
026500     OPEN OUTPUT XS-SKU-LOC-INTEG-RPT-FILE.                       02380000
026600                                                                  02390000
026700     READ SKIP-RECD-CNTL-FILE INTO XS046-CONTROL-CARD             02400000
026800        AT END                                                    02410000
026900           SET PS-END-SKIP-RECD-FILE TO TRUE.                     02420000
027000                                                                  02430000
027100     IF PS-END-SKIP-RECD-FILE                                     02440000
027200         MOVE '1000-INITIALIZE' TO PV-PARAGRAPH-NAME              02450000
027300         MOVE 'NO SKIP RECD CNTL FILE DATA' TO PV-OPERATION-MSG-1 02460000
027400         SET PV-ABEND-4009-CARD-ERROR TO TRUE                     02470000
027500         PERFORM 9999-ABEND                                       02480000
027600     END-IF.                                                      02490000
027700                                                                  02500000
027800     CLOSE SKIP-RECD-CNTL-FILE.                                   02510000
029200                                                                  02520000
029300     PERFORM 7000-READ-SOR-SKU-LOC-ATTR-EXT                       02530000
029400       UNTIL PV-SOR-READ-SKIP-CNT = XS046-START-POINT             02540000
029500          OR PS-END-OF-SOR-SKU-LOC.                               02550000
029600                                                                  02560000
029700     IF PS-END-OF-SOR-SKU-LOC                                     02570000
029800         MOVE '1000-INITIALIZE' TO PV-PARAGRAPH-NAME              02580000
029900         MOVE 'END OF SOR SKU LOC FILE ON PRIMING READ'           02590000
029950           TO PV-OPERATION-MSG-1                                  02600000
030000         SET PV-ABEND-4008-DATA-ERROR TO TRUE                     02610000
030100         PERFORM 9999-ABEND                                       02620000
030200     END-IF.                                                      02630000
030300                                                                  02640000
030400     IF XS046-READ-FREQUENCY = PC-ONE                             02650000
030500        PERFORM 7100-READ-XS-SKU-LOC-ATTR-EXT                     02660000
030550          XS046-START-POINT TIMES                                 02670000
NEMDEL*******   OR UNTIL PS-END-OF-XS-SKU-LOC                           02680000
030600     ELSE                                                         02690000
030700        PERFORM 7100-READ-XS-SKU-LOC-ATTR-EXT                     02700000
030800          UNTIL XS030-INTR-UPC-ID >= IM057-INTR-UPC-ID            02710000
NEMADD          OR PS-END-OF-XS-SKU-LOC                                 02720000
030900     END-IF.                                                      02730000
031000                                                                  02740000
031100     ACCEPT PV-CURR-TIME FROM TIME.                               02750000
031200     MOVE PV-CURR-TIME-HH          TO DP200-RUN-HOUR.             02760000
031300     MOVE PV-CURR-TIME-MM          TO DP200-RUN-MINUTE.           02770000
031400                                                                  02780000
031500     MOVE FUNCTION CURRENT-DATE (1:8)                             02790000
031600                                   TO PV-CURR-DATE-CCYYMMDD.      02800000
031700                                                                  02810000
031800     MOVE PV-CURR-DATE-MM          TO DP200-RUN-MONTH.            02820000
031900     MOVE PV-CURR-DATE-DD          TO DP200-RUN-DAY.              02830000
032000     MOVE PV-CURR-DATE-CCYY        TO DP200-RUN-YEAR.             02840000
032100                                                                  02850000
032200     MOVE PC-CURRENT-PROGRAM-NAME  TO DP200-PROGRAM-NAME.         02860000
032300                                                                  02870000
032400     PERFORM 8700-REPORT-HEADER-ROUTINE.                          02880000
032500                                                                  02890000
032600******************************************************************02900000
032700*2000-PROCESS-RECORDS.                                            02910000
032800* THIS SECTION COMPARES RECORDS ON THE SOR ITEM SKU LOC FILE &    02920000
032900* XS DOMAIN SKU LOC ATTR EXTRACT FILE. IF KEYS MATCH, PROGRAM     02930000
033000* DOES NO REPORTING. IF THE KEY (INTERNAL UPC ID & STR) DOES      02940000
033010* NOT APPEAR ON ONE FILE, BUT IS ON THE OTHER FILE THEN AN        02950000
033100* APPROPRIATE MESSAGE WILL BE WRITTEN TO THE ERROR FILE, ALONG    02960000
033200* WITH THE DATA ON THE CORRESPONDING FILES.                       02970000
033300******************************************************************02980000
033400 2000-PROCESS-RECORDS.                                            02990000
033500                                                                  03000000
033600     INITIALIZE DL1-DETAIL-LINE-1.                                03010000
033700     MOVE ZEROS TO PV-SOR-READ-SKIP-CNT.                          03020000
033800                                                                  03030000
NEMTST**   DISPLAY '>>> 2000-PROCESS KEYS ARE SOR*'                     03040000
NEMTST**           IM057-INTR-UPC-ID, '-', IM057-STR-NBR                03050000
NEMTST**              '== AND XS*'                                      03060000
NEMTST**           XS030-INTR-UPC-ID, '-', XS030-LOC-NBR, '**'          03070000
033900     EVALUATE TRUE                                                03080000
034000        WHEN IM057-INTR-UPC-ID = XS030-INTR-UPC-ID                03090000
034050           AND IM057-STR-NBR   = XS030-LOC-NBR                    03100000
034100             PERFORM 2100-COMPARE-FIELDS                          03110000
034200             PERFORM 7000-READ-SOR-SKU-LOC-ATTR-EXT               03120000
034300                UNTIL PV-SOR-READ-SKIP-CNT =                      03130000
034400                       XS046-READ-FREQUENCY OR                    03140000
034500                       PS-END-OF-SOR-SKU-LOC                      03150000
034600             IF XS046-READ-FREQUENCY = PC-ONE                     03160000
034700                PERFORM 7100-READ-XS-SKU-LOC-ATTR-EXT             03170000
034800                   XS046-START-POINT TIMES                        03180000
NEMDEL***************      OR UNTIL PS-END-OF-XS-SKU-LOC                03190000
034900             ELSE                                                 03200000
035000                PERFORM 7100-READ-XS-SKU-LOC-ATTR-EXT UNTIL       03210000
035100                  (XS030-INTR-UPC-ID >  IM057-INTR-UPC-ID         03220000
035100               OR (XS030-INTR-UPC-ID  = IM057-INTR-UPC-ID         03220100
035150                  AND IM057-STR-NBR  >= XS030-LOC-NBR))           03220200
034500                 OR PS-END-OF-XS-SKU-LOC                          03220300
035200             END-IF                                               03220400
034000        WHEN IM057-INTR-UPC-ID = XS030-INTR-UPC-ID                03220500
034050           AND IM057-STR-NBR   < XS030-LOC-NBR                    03220600
NEMTST***     DISPLAY '=== SAME UPC LOC MISMATCH XS HIGH SOR*'          03220700
NEMTST***          IM057-INTR-UPC-ID, '-', IM057-STR-NBR                03220800
NEMTST***             '== AND XS*'                                      03220900
NEMTST***          XS030-INTR-UPC-ID, '-', XS030-LOC-NBR, '**'          03221000
035400             PERFORM 2600-CHECK-IF-NEW-PG-NEEDED                  03222000
035500             PERFORM 2700-MOVE-SOR-VALUES                         03223000
NEMDEL************ PERFORM 2800-MOVE-XS-VALUES                          03224000
NEMDEL*****        MOVE PC-MISSING-FROM-SOR-SKU-LOC                     03225000
035600             MOVE PC-MISMATCHED-STR-LOC-NBRS                      03226000
035700                TO DL1-ERROR-MESSAGE                              03227000
035800             MOVE DL1-DETAIL-LINE-1 TO PV-PRINT-RECORD            03228000
035900             ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                03229000
036000             PERFORM 8900-WRITE-REPORT-LINE                       03230000
034200             PERFORM 7000-READ-SOR-SKU-LOC-ATTR-EXT               03231000
034300                UNTIL PV-SOR-READ-SKIP-CNT =                      03232000
034400                       XS046-READ-FREQUENCY OR                    03233000
034500                       PS-END-OF-SOR-SKU-LOC                      03234000
034000        WHEN IM057-INTR-UPC-ID = XS030-INTR-UPC-ID                03235000
034050           AND IM057-STR-NBR   > XS030-LOC-NBR                    03236000
NEMTST***     DISPLAY '=== SAME UPC LOC MISMATCH SOR HIGH SOR*'         03237000
NEMTST***          IM057-INTR-UPC-ID, '-', IM057-STR-NBR                03238000
NEMTST***             '== AND XS*'                                      03239000
NEMTST***          XS030-INTR-UPC-ID, '-', XS030-LOC-NBR, '**'          03239100
035400             PERFORM 2600-CHECK-IF-NEW-PG-NEEDED                  03239200
NEMDEL***          PERFORM 2700-MOVE-SOR-VALUES                         03239300
035500             PERFORM 2800-MOVE-XS-VALUES                          03239400
035600             MOVE PC-MISMATCHED-STR-LOC-NBRS                      03239500
035700               TO DL1-ERROR-MESSAGE                               03239600
035800             MOVE DL1-DETAIL-LINE-1 TO PV-PRINT-RECORD            03239700
035900             ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                03239800
036000             PERFORM 8900-WRITE-REPORT-LINE                       03239900
037000             PERFORM 7100-READ-XS-SKU-LOC-ATTR-EXT                03240000
035300        WHEN IM057-INTR-UPC-ID < XS030-INTR-UPC-ID                03241000
NEMTST***     DISPLAY '=== SOR LOWER *'                                 03241100
NEMTST***          IM057-INTR-UPC-ID, '-', IM057-STR-NBR                03241200
NEMTST***             '== AND XS*'                                      03241300
NEMTST***          XS030-INTR-UPC-ID, '-', XS030-LOC-NBR, '**'          03241400
035400             PERFORM 2600-CHECK-IF-NEW-PG-NEEDED                  03241500
035500             PERFORM 2700-MOVE-SOR-VALUES                         03241600
NEMDEL***          PERFORM 2800-MOVE-XS-VALUES                          03241700
035600             MOVE PC-MISSING-FROM-XS-SKU-LOC                      03241800
035700                TO DL1-ERROR-MESSAGE                              03241900
035800             MOVE DL1-DETAIL-LINE-1 TO PV-PRINT-RECORD            03242000
035900             ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                03243000
036000             PERFORM 8900-WRITE-REPORT-LINE                       03244000
036100             PERFORM 7000-READ-SOR-SKU-LOC-ATTR-EXT               03245000
036200        WHEN IM057-INTR-UPC-ID > XS030-INTR-UPC-ID                03246000
036300             PERFORM 2600-CHECK-IF-NEW-PG-NEEDED                  03247000
036400             PERFORM 2800-MOVE-XS-VALUES                          03248000
036500             MOVE PC-MISSING-FROM-SOR-SKU-LOC                     03249000
036600                TO DL1-ERROR-MESSAGE                              03250000
036700             MOVE DL1-DETAIL-LINE-1 TO PV-PRINT-RECORD            03260000
036800             ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                03270000
036900             PERFORM 8900-WRITE-REPORT-LINE                       03280000
037000             PERFORM 7100-READ-XS-SKU-LOC-ATTR-EXT                03290000
037100     END-EVALUATE.                                                03300000
037200                                                                  03310000
037300******************************************************************03320000
037400*2100-COMPARE-FIELDS.                                             03330000
037500* COMPARES FIELDS BETWEEN FILES TO SEE IF ANY DIFFERENCES EXIST   03340000
037600******************************************************************03350000
037700 2100-COMPARE-FIELDS.                                             03360000
037800                                                                  03370000
037900     SET                                                          03380000
038000         PS-NO-INTR-UPC-ID-ERROR                                  03390000
038100         PS-NO-ERROR-FOUND               TO TRUE.                 03400000
038200                                                                  03410000
038300     IF  IM057-INTR-UPC-ID  NOT EQUAL XS030-INTR-UPC-ID           03420000
038400         SET PS-ERROR-FOUND                                       03430000
038500         PS-INTR-UPC-ID-ERROR             TO TRUE                 03440000
038600     END-IF.                                                      03450000
038700                                                                  03460000
038800     IF  IM057-STR-NBR    NOT EQUAL XS030-LOC-NBR                 03470000
038900         SET PS-ERROR-FOUND                                       03480000
039000         PS-LOC-STR-NBR-ERROR             TO TRUE                 03490000
039100     END-IF.                                                      03500000
039200                                                                  03510000
039300     IF  PS-ERROR-FOUND                                           03520000
039400         PERFORM 2600-CHECK-IF-NEW-PG-NEEDED                      03530000
039500         PERFORM 2700-MOVE-SOR-VALUES                             03540000
039600         PERFORM 2800-MOVE-XS-VALUES                              03550000
039700         PERFORM 2900-MOVE-ERROR-MSG                              03560000
039800         MOVE DL1-DETAIL-LINE-1 TO PV-PRINT-RECORD                03570000
039900         ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                    03580000
040000         PERFORM 8900-WRITE-REPORT-LINE                           03590000
040100     ELSE                                                         03600000
040200         ADD +1 TO PV-VALID-MATCH-CNT                             03610000
040300     END-IF.                                                      03620000
040400                                                                  03630000
040500     MOVE ZEROS TO PV-SOR-READ-SKIP-CNT.                          03640000
040600                                                                  03650000
040700******************************************************************03660000
040800**  PROCESSES THRU END OF FILE FOR REMAINING RECORDS              03670000
040900******************************************************************03680000
041000 2500-PROCESS-EXTRA-RECORDS.                                      03690000
041100                                                                  03700000
041200     INITIALIZE DL1-DETAIL-LINE-1.                                03710000
041300     MOVE ZEROS TO PV-SOR-READ-SKIP-CNT.                          03720000
041400                                                                  03730000
041500     IF  PS-NOT-END-OF-SOR-SKU-LOC                                03740000
041600         IF IM057-INTR-UPC-ID NOT = XS030-INTR-UPC-ID             03750000
041700            PERFORM 2700-MOVE-SOR-VALUES                          03760000
041800            MOVE PC-EXTRA-FOUND-SOR-SKU-LOC                       03770000
041900               TO DL1-ERROR-MESSAGE                               03780000
042000            MOVE DL1-DETAIL-LINE-1   TO PV-PRINT-RECORD           03790000
042010            ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                 03800000
042100            PERFORM 8900-WRITE-REPORT-LINE                        03810000
042200         ELSE                                                     03820000
042210            IF IM057-STR-NBR NOT = XS030-LOC-NBR                  03830000
042220               PERFORM 2700-MOVE-SOR-VALUES                       03840000
042230               MOVE PC-MISMATCHED-STR-LOC-NBRS                    03850000
042240                    TO DL1-ERROR-MESSAGE                          03860000
042250               MOVE DL1-DETAIL-LINE-1   TO PV-PRINT-RECORD        03870000
042260               ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT              03880000
042270               PERFORM 8900-WRITE-REPORT-LINE                     03890000
042200            END-IF                                                03891000
042200         END-IF                                                   03892000
042300         PERFORM 7000-READ-SOR-SKU-LOC-ATTR-EXT                   03893000
042400     END-IF.                                                      03894000
042500                                                                  03895000
042600     IF  PS-NOT-END-OF-XS-SKU-LOC                                 03896000
042700         IF IM057-INTR-UPC-ID NOT = XS030-INTR-UPC-ID             03897000
042800            PERFORM 2800-MOVE-XS-VALUES                           03898000
042900            MOVE PC-EXTRA-FOUND-XS-SKU-LOC                        03899000
043000                TO DL1-ERROR-MESSAGE                              03900000
043100            MOVE DL1-DETAIL-LINE-1   TO PV-PRINT-RECORD           03910000
043110            ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                 03920000
043200            PERFORM 8900-WRITE-REPORT-LINE                        03930000
043210         ELSE                                                     03940000
042220            IF IM057-STR-NBR NOT = XS030-LOC-NBR                  03950000
042230               PERFORM 2800-MOVE-XS-VALUES                        03960000
042240               MOVE PC-MISMATCHED-STR-LOC-NBRS                    03970000
042250                    TO DL1-ERROR-MESSAGE                          03980000
042260               MOVE DL1-DETAIL-LINE-1   TO PV-PRINT-RECORD        03990000
042270               ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT              04000000
042280               PERFORM 8900-WRITE-REPORT-LINE                     04001000
042290            END-IF                                                04002000
043300         END-IF                                                   04003000
043400         PERFORM 7100-READ-XS-SKU-LOC-ATTR-EXT                    04004000
043500     END-IF.                                                      04005000
043600                                                                  04006000
043700******************************************************************04007000
043800* 2600-CHECK-IF-NEW-PG-NEEDED.                                    04008000
043900*     CHECKS TO SEE IF A NEW PAGE IS NEEDED.                      04009000
044000***************************************************************** 04010000
044100 2600-CHECK-IF-NEW-PG-NEEDED.                                     04020000
044200                                                                  04030000
044300     IF PV-LINE-CNT > PC-MAX-REPORT-LINES                         04040000
044400        PERFORM 8700-REPORT-HEADER-ROUTINE                        04050000
044500     END-IF.                                                      04060000
044600                                                                  04070000
044700******************************************************************04080000
044800* 2700-MOVE-SOR-VALUES.                                           04090000
044900*     MOVES THE SOR VENDOR VALUES TO THE ERROR RECORD.            04100000
045000***************************************************************** 04110000
045100 2700-MOVE-SOR-VALUES.                                            04120000
045200                                                                  04130000
045300     MOVE IM057-INTR-UPC-ID     TO PV-TEMP-INTR-UPC-ID            04140000
045400     MOVE PV-TEMP-INTR-UPC-ID   TO DL1-SOR-INTR-UPC-ID.           04150000
045500     MOVE IM057-STR-NBR         TO DL1-SOR-STR-NBR.               04160000
045700                                                                  04170000
045800******************************************************************04180000
045900* 2800-MOVE-XS-VALUES.                                            04190000
046000*     MOVES THE XS SKU LOC ATTR VALUES TO THE ERROR RECORD.       04200000
046100***************************************************************** 04210000
046200 2800-MOVE-XS-VALUES.                                             04220000
046300                                                                  04230000
046400     MOVE XS030-INTR-UPC-ID     TO PV-TEMP-INTR-UPC-ID.           04240000
046500     MOVE PV-TEMP-INTR-UPC-ID   TO DL1-XS-INTR-UPC-ID.            04250000
046600     MOVE XS030-LOC-NBR         TO DL1-XS-LOC-NBR.                04260000
046800                                                                  04270000
046900******************************************************************04280000
047000* 2900-MOVE-ERROR-MSG.                                            04290000
047100*     MOVES THE ERROR MESSAGE TO THE ERROR RECORD.                04300000
047200***************************************************************** 04310000
047300 2900-MOVE-ERROR-MSG.                                             04320000
047400                                                                  04330000
047500     IF PS-INTR-UPC-ID-ERROR                                      04340000
047600        MOVE PC-MISMATCHED-INTR-UPC-ID   TO DL1-ERROR-MESSAGE     04350000
047700     ELSE                                                         04360000
047800        IF PS-LOC-STR-NBR-ERROR                                   04370000
047900           MOVE PC-MISMATCHED-STR-LOC-NBRS                        04380000
048000                 TO DL1-ERROR-MESSAGE                             04390000
048100        END-IF                                                    04400000
048300     END-IF.                                                      04410000
048400                                                                  04420000
048500***************************************************************** 04430000
048600*7000-READ-SOR-SKU-LOC-ATTR-EXT.                                  04440000
048700*  READ SOR ITEM SKU EXTRACT FILE                                 04450000
048800*  READS THE VMS EXTRACT FILE, SKIPPING THE NUMBER OF RECORDS     04460000
048900*  SPECIFIED IN THE START/SKIP RECORD CONTROL CARD.               04470000
049100***************************************************************** 04480000
049200 7000-READ-SOR-SKU-LOC-ATTR-EXT.                                  04490000
049300                                                                  04500000
049400     IF  PS-NOT-END-OF-SOR-SKU-LOC                                04510000
049500         READ SOR-SKU-LOC-ATTR-EXT-FILE                           04520000
049550            INTO IM057-ITEM-SKU-LOC-DOMAIN-REC                    04530000
049600              AT END                                              04540000
049700                 SET PS-END-OF-SOR-SKU-LOC TO TRUE                04550000
049800         END-READ                                                 04560000
049900     END-IF.                                                      04570000
050000                                                                  04580000
050100     IF  PS-NOT-END-OF-SOR-SKU-LOC                                04590000
NEMTST***     DISPLAY '=== SYSTEM OF RECORD READ *'                     04600000
NEMTST***          IM057-INTR-UPC-ID, '-', IM057-STR-NBR, '**'          04610000
050900         ADD +1 TO PV-SOR-READ-SKIP-CNT                           04620000
052200         ADD +1 TO PV-SOR-SKU-LOC-RECS-READ-CNT                   04630000
052500     END-IF.                                                      04640000
052600                                                                  04650000
052700***************************************************************** 04660000
052800*7100-READ-XS-SKU-LOC-ATTR-EXT.                                   04670000
052900* READ XS EXTRACT FILE                                            04680000
053000***************************************************************** 04690000
053100 7100-READ-XS-SKU-LOC-ATTR-EXT.                                   04700000
053200                                                                  04710000
053300     IF  PS-NOT-END-OF-XS-SKU-LOC                                 04720000
053400         READ XS-SKU-LOC-ATTR-EXT-FILE                            04730000
053450           INTO XS030-SKU-LOC-ATTR-UNLOAD                         04740000
053500             AT END                                               04750000
053600                SET PS-END-OF-XS-SKU-LOC TO TRUE                  04760000
053700         END-READ                                                 04770000
053800     END-IF.                                                      04780000
053900                                                                  04790000
054000     IF  PS-NOT-END-OF-XS-SKU-LOC                                 04800000
NEMTST***     DISPLAY '=== XS READ *'                                   04801000
NEMTST***          XS030-INTR-UPC-ID, '-', XS030-LOC-NBR, '**'          04802000
054100         ADD +1                   TO PV-XS-EXTRACT-REC-READ-CNT   04803000
054200     END-IF.                                                      04804000
054300                                                                  04805000
054400******************************************************************04806000
054500* 8700-REPORT-HEADER-ROUTINE.                                     04807000
054600*     PRINT THE HEADINGS FOR THE REPORT.                          04808000
054700******************************************************************04809000
054800 8700-REPORT-HEADER-ROUTINE.                                      04810000
054900                                                                  04820000
055000     MOVE ZEROS                  TO PV-LINE-CNT.                  04830000
055100     ADD +1                      TO PV-PAGE-CNT.                  04840000
055200     MOVE PV-PAGE-CNT            TO DP200-PAGE-NUMBER.            04850000
055300                                                                  04860000
055400     MOVE PC-REPORT-NBR-1        TO DP200-REPORT-NUMBER.          04870000
055500     MOVE DP200-STANDRD-HEADER-200-COLS                           04880000
055600                                 TO PV-PRINT-RECORD.              04890000
055700                                                                  04900000
055800     PERFORM 8800-WRITE-RPT-TOP-OF-PAGE.                          04910000
055900                                                                  04920000
056000     MOVE HL2-HEADING-LINE-2     TO PV-PRINT-RECORD.              04930000
056100     MOVE +2                     TO PV-LINE-SPACING.              04940000
056200     PERFORM 8900-WRITE-REPORT-LINE.                              04950000
056300                                                                  04960000
056400     MOVE HL3-HEADING-LINE-3     TO PV-PRINT-RECORD.              04970000
056500     MOVE +3                     TO PV-LINE-SPACING.              04980000
056600     PERFORM 8900-WRITE-REPORT-LINE.                              04990000
056700                                                                  05000000
056800******************************************************************05010000
056900* 8800-WRITE-RPT-TOP-OF-PAGE                                      05020000
057000*     WRITE FIRST REPORT LINE AFTER PAGE BREAK.                   05030000
057100******************************************************************05040000
057200 8800-WRITE-RPT-TOP-OF-PAGE.                                      05050000
057300                                                                  05060000
057400     WRITE XS-SKU-LOC-INTEG-RPT-RECORD                            05070000
057500       FROM PV-PRINT-RECORD                                       05080000
057600         AFTER ADVANCING PAGE.                                    05090000
057700                                                                  05100000
057800     MOVE +1 TO PV-LINE-CNT.                                      05110000
057900                                                                  05120000
058000******************************************************************05130000
058100* 8900-WRITE-REPORT-LINE                                          05140000
058200*     WRITE REPORT LINE AFTER ADVANCING LINE SPACING.             05150000
058300******************************************************************05160000
058400 8900-WRITE-REPORT-LINE.                                          05170000
058500                                                                  05180000
058600     WRITE XS-SKU-LOC-INTEG-RPT-RECORD                            05190000
058700       FROM PV-PRINT-RECORD                                       05200000
058800         AFTER ADVANCING PV-LINE-SPACING.                         05210000
058900                                                                  05220000
059000     ADD PV-LINE-SPACING TO PV-LINE-CNT.                          05230000
059100                                                                  05240000
059200****************************************************************  05250000
059300*END OF PROGRAM ROUTINE                                           05260000
059400****************************************************************  05270000
059500 9000-END-OF-PGM.                                                 05280000
059600                                                                  05290000
060800     DISPLAY '******** XSKRP013 COUNTS *********'.                05300000
060900     DISPLAY ' INTEGRITY CHECK FOR SKU LOC ATTR'                  05310000
060900     DISPLAY '   SOR REC READ CNT= '                              05320000
060950                     PV-SOR-SKU-LOC-RECS-READ-CNT.                05330000
061000     DISPLAY 'XS SKU LOC ATTR CNT= ' PV-XS-EXTRACT-REC-READ-CNT.  05340000
061100     DISPLAY ' ERROR RECS WRITTEN= ' PV-ERROR-RECORD-WRITTEN-CNT. 05350000
061200     DISPLAY '  VALID MATCH COUNT= ' PV-VALID-MATCH-CNT.          05360000
061300     DISPLAY '                              '.                    05370000
061310     DISPLAY ' ==== CONTROL CARD VALUES     '.                    05380000
061400     DISPLAY '    START RECORD POINT= ' XS046-START-POINT.        05390000
061500     DISPLAY ' SKIP RECORD FREQUENCY= ' XS046-READ-FREQUENCY.     05400000
061700     DISPLAY '**********************************'.                05410000
061800                                                                  05420000
061900     IF  PV-ERROR-RECORD-WRITTEN-CNT > 0                          05430000
062000         MOVE 04               TO RETURN-CODE                     05440000
062100     END-IF.                                                      05450000
062200                                                                  05460000
062300     CLOSE SOR-SKU-LOC-ATTR-EXT-FILE                              05470000
062400           XS-SKU-LOC-ATTR-EXT-FILE                               05480000
062500           XS-SKU-LOC-INTEG-RPT-FILE.                             05490000
062600                                                                  05500000
062700******************************************************************05510000
062800*     9999-ABEND                                                 *05520000
062900* ==> PROCESSES:                                                 *05530000
063000*     -PERFORMS ABEND PROCESSING FOR NON-SQL-ERRORS.             *05540000
063100******************************************************************05550000
063200 9999-ABEND.                                                      05560000
063300                                                                  05570000
063400     DISPLAY '9999-ABEND'.                                        05580000
063500     DISPLAY '**  ABEND     **', PC-CURRENT-PROGRAM-NAME.         05590000
063600     DISPLAY '**  PARAGRAPH ** ' PV-PARAGRAPH-NAME.               05600000
063700     DISPLAY '**  OPERATION ** ' PV-OPERATION-MSG-1.              05610000
063800     DISPLAY '**            ** ' PV-OPERATION-MSG-2.              05620000
063900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05630000
