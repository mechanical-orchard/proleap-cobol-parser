000100*-----------------------------------------------------------------00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000210*-----------------------------------------------------------------00030001
000210*-----------------------------------------------------------------00031001
000310                                                                  00032001
000400 PROGRAM-ID.    RVKUT038.                                         00033001
000500 AUTHOR.        JOHN HUTCHINSON.                                  00034001
000600 INSTALLATION.  KOHLS.                                            00035001
000700 DATE-WRITTEN   SEPTEMBER 2011.                                   00036001
000800 DATE-COMPILED.                                                   00037001
000810                                                                  00038001
000900*-----------------------------------------------------------------00039001
001000*  THIS PROGRAM WILL READ THE CORE ITEM FILE AND LOOK UP THE      00040001
001100*  VENDOR TYPE FROM THE IMT_LBL TABLE.  THE PROGRAM WILL WRITE    00050001
001200*  OUT THE UPDATED CORE ITEM FILE W/ VENDOR TYPE.                 00060001
001300*  LAYOUT (RVRD064).                                              00070001
001310*-----------------------------------------------------------------00080001
001410                                                                  00090001
001500 ENVIRONMENT DIVISION.                                            00100001
001600 INPUT-OUTPUT SECTION.                                            00110001
001700                                                                  00120001
001800 FILE-CONTROL.                                                    00130001
002100                                                                  00140001
002201     SELECT CURRENT-ITEM-FILE        ASSIGN TO INP01.             00150001
002202                                                                  00160001
002203     SELECT NEW-ITEM-FILE            ASSIGN TO OUT01.             00170001
002208                                                                  00180001
002209*-----------------------------------------------------------------00190001
002300 DATA DIVISION.                                                   00200001
002310*-----------------------------------------------------------------00210001
002410                                                                  00220001
002500 FILE SECTION.                                                    00230001
003700                                                                  00240001
003701 FD  CURRENT-ITEM-FILE                                            00250001
003702     RECORDING MODE IS F                                          00260001
003703     BLOCK CONTAINS 0 RECORDS                                     00270001
003704     LABEL RECORDS ARE STANDARD.                                  00280001
003705                                                                  00290001
003706 01  OLD-ITEM-RECORD                  PIC X(296).                 00300001
003800                                                                  00310001
003801 FD  NEW-ITEM-FILE                                                00320001
003802     RECORDING MODE IS F                                          00330001
003803     BLOCK CONTAINS 0 RECORDS                                     00340001
003804     LABEL RECORDS ARE STANDARD.                                  00350001
003805                                                                  00360001
003806 01  NEW-ITEM-RECORD                  PIC X(316).                 00370001
003820                                                                  00380001
003830*-----------------------------------------------------------------00390001
004000 WORKING-STORAGE SECTION.                                         00400001
004010*-----------------------------------------------------------------00410001
004190                                                                  00420001
004200 01  PS-PROGRAM-SWITCHES.                                         00430001
004300     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00440001
004400         88  PS-EOF-INPUT-YES                    VALUE 'Y'.       00450001
004500         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00460001
           05  PS-PMDM-SKU-FOUND            PIC X(01)  VALUE 'N'.       00470001
               88  PS-PMDM-SKU-FOUND-YES               VALUE 'Y'.       00480001
               88  PS-PMDM-SKU-FOUND-NO                VALUE 'N'.       00490001
           05  PS-WRITE-RECORD-SW           PIC X(01)  VALUE 'Y'.       00491003
               88  PS-WRITE-RECORD-YES                 VALUE 'Y'.       00492003
               88  PS-WRITE-RECORD-NO                  VALUE 'N'.       00493003
004600                                                                  00500001
004700 01  PC-PROGRAM-CONSTANTS.                                        00510001
025400     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)  VALUE 'RVKUT038'.00520001
025401                                                                  00530001
025402 01  PV-PROGRAM-VARIABLES.                                        00540001
025403     05  PV-RECORDS-READ              PIC 9(09) VALUE  0.         00550001
025404     05  PV-RECORDS-WRITTEN           PIC 9(09) VALUE  0.         00560001
025405     05  PV-VENDOR-FOUND              PIC 9(09) VALUE  0.         00570001
025406     05  PV-VENDOR-NOT-FOUND          PIC 9(09) VALUE  0.         00580001
025407     05  PV-DUP-STYLE-IDS             PIC 9(09) VALUE  0.         00590001
025407     05  PV-COMMON-SKU-UPCS           PIC 9(09) VALUE  0.         00600001
025407     05  PV-COMMON-FNTCS-SKU          PIC 9(09) VALUE  0.         00610001
025407     05  PV-COMMON-KOHLS-SKU          PIC 9(09) VALUE  0.         00620001
025431     05  PV-VENDOR-TYPE               PIC X(01) VALUE 'R'.        00630001
025432     05  PV-STYL-ID                   PIC X(20) VALUE SPACES.     00640001
025433     05  FILLER                       REDEFINES                   00650001
025434         PV-STYL-ID.                                              00660001
025435         10  PV-STYL-ID-9             PIC 9(8).                   00670001
025436         10  FILLER                   PIC X(12).                  00680001
025437*PRB0049074 START                                                 00690001
025438     05  PV-SKU_NBR.                                              00700001
025439         10  PV-SKU-NBR-9             PIC 9(08).                  00710001
025440         10  FILLER                   PIC X(02).                  00720001
025441*PRB0049074 END                                                   00730001
009700     05  PV-UPC-NBR-X.                                            00740001
009700         10  PV-UPC-NBR               PIC  9(15) VALUE ZERO.      00750001
025403     05  PV-ATTR-ELEM-TXT-DEPT        PIC  X(50) VALUE  SPACE.    00751001
025403     05  PV-ATTR-ELEM-TXT-FLAG        PIC  X(50) VALUE  SPACE.    00752001
025403     05  PV-COMMON-UPC-DEPT           PIC  X(04) VALUE  SPACE.    00753001
025403     05  PV-COMMON-UPC-FLAG           PIC  X(04) VALUE  SPACE.    00754001
025442                                                                  00755001
025443 01  PV-ABEND-FIELDS.                                             00756001
025444     05  PV-ABEND-CODE                PIC S9(4) VALUE +0 COMP.    00757001
025445     05  PV-ABEND-PROGRAM             PIC X(08) VALUE 'RVKUT038'. 00758001
025446     05  PV-PARAGRAPH                 PIC X(50) VALUE SPACES.     00759001
025447     05  PV-ABEND-OPERATION           PIC X(50) VALUE SPACES.     00760001
025448     05  PV-ABEND-TABLE-1             PIC X(12) VALUE SPACES.     00770001
025449     05  PV-ABEND-TABLE-2             PIC X(12) VALUE SPACES.     00780001
025450     05  PV-ERROR-MSG                 PIC X(79) VALUE SPACES.     00790001
025460     05  PV-LAST-STYL-ID              PIC X(20) VALUE SPACES.     00800001
025470*PRB0049074 START                                                 00810001
025480     05  PV-LAST-SKU-NBR              PIC X(10) VALUE SPACES.     00820001
025490     05  PV-SQL-CODE                  PIC 9(4)- VALUE ZERO.       00830001
025491*PRB0049074 END                                                   00840001
025492                                                                  00850001
025493 01  DK-DB2-KEYS.                                                 00860001
025494     05  DK-VS-ID                     PIC S9(9)  VALUE +0 COMP.   00870001
025495                                                                  00880001
025496***  OLD CORE ITEM FILE LAYOUT                                    00890001
025497     COPY VLRD052.                                                00900001
025498                                                                  00910001
025499***  NEW RTV CORE ITEM FILE LAYOUT                                00920001
025500     COPY RVRD064.                                                00930001
025501                                                                  00940001
025502***  DATE ROUTINE COPYBOOK                                        00950001
025503     COPY DPWS500.                                                00960001
025504                                                                  00970001
025505***  DB2 ABEND COPYBOOK                                           00980001
025506     COPY DPWS004.                                                00990001
025507                                                                  01000001
040800*----------------------------------------------------------------*01010001
040900*    ABEND PROCESSING COPYBOOK.                                  *01020001
041000*----------------------------------------------------------------*01030001
041100                                                                  01040001
041200     COPY DPWS013.                                                01050001
041201                                                                  01060001
041202     EXEC SQL                                                     01070001
041203         INCLUDE SQLCA                                            01080001
041204     END-EXEC.                                                    01090001
041205                                                                  01100001
041206     COPY SQLCA2.                                                 01110001
041207                                                                  01120001
041208*---------------------------------------------------------------* 01130001
068000*    DB2 DCLGEN FOR THE XLT00004 TABLE                          * 01140001
068001*---------------------------------------------------------------* 01150001
068002                                                                  01160001
068003     EXEC SQL                                                     01170001
068004         INCLUDE XLT00004                                         01180001
068005     END-EXEC.                                                    01190001
068006                                                                  01200001
068007*---------------------------------------------------------------* 01210001
068008*    DB2 DCLGEN FOR THE TVNDSTL TABLE                           * 01220001
068009*---------------------------------------------------------------* 01230001
068010                                                                  01240001
068011     EXEC SQL                                                     01250001
068012         INCLUDE TVNDSTL                                          01260001
068013     END-EXEC.                                                    01270001
068014                                                                  01280001
068015*---------------------------------------------------------------* 01290001
068700*    DB2 DCLGEN FOR THE TMDARVS TABLE                           * 01300001
068701*---------------------------------------------------------------* 01310001
068702                                                                  01320001
068703     EXEC SQL                                                     01330001
068704         INCLUDE TMDARVS                                          01340001
068705     END-EXEC.                                                    01350001
068706                                                                  01360001
068707*---------------------------------------------------------------* 01370001
068708*    DB2 DCLGEN FOR THE IMT00000 TABLE                          * 01380001
068709*---------------------------------------------------------------* 01390001
068710                                                                  01400001
068711     EXEC SQL                                                     01410001
068712         INCLUDE IMT00000                                         01420001
068713     END-EXEC.                                                    01430001
068714                                                                  01440001
068715*PRB0049074 START                                                 01450001
068716*---------------------------------------------------------------* 01460001
068717*    DB2 DCLGEN FOR THE TWEBITM TABLE                           * 01470001
068718*---------------------------------------------------------------* 01480001
068719                                                                  01490001
068720     EXEC SQL                                                     01500001
068730         INCLUDE TWEBITM                                          01510001
068740     END-EXEC.                                                    01520001
068750                                                                  01530001
068760*---------------------------------------------------------------* 01540001
068770*    DB2 DCLGEN FOR THE XLT_SKU TABLE                           * 01550001
068780*---------------------------------------------------------------* 01560001
068790                                                                  01570001
068800     EXEC SQL                                                     01580001
068900         INCLUDE XLT00003                                         01590001
069000     END-EXEC.                                                    01600001
069100                                                                  01610001
069200*PRB0049074 END                                                   01620001
069201*PRB0053051 START                                                 01630001
069202*---------------------------------------------------------------* 01640001
069203*    DB2 DCLGEN FOR THE TSK TABLE                           *     01650001
069204*---------------------------------------------------------------* 01660001
069205                                                                  01670001
069206     EXEC SQL                                                     01680001
069207         INCLUDE TSK                                              01690001
069208     END-EXEC.                                                    01700001
069209                                                                  01710001
069210*PRB0053051 END                                                   01720001
069202*---------------------------------------------------------------* 01730001
069203*    DB2 DCLGEN FOR THE RVT_UPC_XREF TABLE                  *     01740001
069204*---------------------------------------------------------------* 01750001
069205                                                                  01760001
069206     EXEC SQL                                                     01770001
069207         INCLUDE RVT00007                                         01771001
069208     END-EXEC.                                                    01772001
069209                                                                  01773001
      *** INTEGRATION DATABASE - WST_INTGRTN_TYP                        01774001
      *                                                                 01775001
           EXEC SQL                                                     01776001
                INCLUDE WST00008                                        01777001
           END-EXEC.                                                    01778001
                                                                        01779001
      *                                                                 01779101
      *** ATTRIBUTE DEFINITION - WST_ATTR_DEFN                          01779201
      *                                                                 01779301
           EXEC SQL                                                     01779401
                INCLUDE WST00009                                        01779501
           END-EXEC.                                                    01779601
                                                                        01779701
      *                                                                 01779801
      *** ATTRIBUTE ELEMENT    - WST_ATTR_ELEM                          01779901
      *                                                                 01780001
           EXEC SQL                                                     01780101
                INCLUDE WST00010                                        01780201
           END-EXEC.                                                    01780301
                                                                        01780401
      /                                                                 01780501
069211*-----------------------------------------------------------------01780601
069212 PROCEDURE DIVISION.                                              01780701
069213*-----------------------------------------------------------------01780801
069214                                                                  01780901
069215     DISPLAY '-----------------------------------------------'.   01781001
069216     DISPLAY '**            BEGINNING RVKUT038             **'.   01782001
069217     DISPLAY '-----------------------------------------------'.   01783001
069218     DISPLAY ' '.                                                 01784001
069219                                                                  01785001
069220     OPEN INPUT  CURRENT-ITEM-FILE                                01786001
069221          OUTPUT NEW-ITEM-FILE.                                   01787001
069222                                                                  01788001
069223     PERFORM 1000-READ-OLD-ITEM-INPT.                             01789001
           PERFORM 1100-CHECK-COMMON-SKUDEPT.                           01790001
069224                                                                  01800001
069225     PERFORM 2000-PROCESS-INPUT-FILE                              01810001
069226       UNTIL PS-EOF-INPUT-YES                                     01820001
069227                                                                  01830001
069228     CLOSE CURRENT-ITEM-FILE                                      01840001
069229           NEW-ITEM-FILE.                                         01850001
069230                                                                  01860001
069231     PERFORM 9200-END-OF-PROGRAM.                                 01870001
069232                                                                  01880001
069233     DISPLAY ' '.                                                 01890001
069234     DISPLAY '-----------------------------------------------'.   01900001
069235     DISPLAY '**              END OF RVKUT038              **'.   01910001
069236     DISPLAY '-----------------------------------------------'.   01920001
141615                                                                  01930001
141616     GOBACK.                                                      01940001
141617                                                                  01950001
141618*-----------------------------------------------------------------01960001
141620*  READ THE ITEM EXTRACT FILE                                     01970001
141621*-----------------------------------------------------------------01980001
141623                                                                  01990001
141624 1000-READ-OLD-ITEM-INPT.                                         02000001
141625                                                                  02010001
141626     MOVE '1000-READ-INPUT-FILE    ' TO PV-PARAGRAPH.             02020001
141627                                                                  02030001
141628     INITIALIZE VL052-ITEM-RECORD.                                02040001
141629                                                                  02050001
141630     READ CURRENT-ITEM-FILE INTO VL052-ITEM-RECORD                02060001
141631         AT END                                                   02070001
141632             SET PS-EOF-INPUT-YES TO TRUE                         02080001
141633     END-READ.                                                    02090001
141634                                                                  02100001
141635     IF PS-EOF-INPUT-YES                                          02110001
141636         CONTINUE                                                 02120001
141637     ELSE                                                         02130001
141638         ADD +1 TO PV-RECORDS-READ                                02140001
141639     END-IF.                                                      02150001
141640                                                                  02160001
141906*-----------------------------------------------------------------02170001
283500 1100-CHECK-COMMON-SKUDEPT.                                       02180001
283501*-----------------------------------------------------------------02190001
283600                                                                  02200001
283601     MOVE '1100-CHECK-COMMON-SKUDEPT'  TO PV-PARAGRAPH.           02210001
284400                                                                  02220001
284700     EXEC SQL                                                     02230001
               SELECT C.ATTR_ELEM_TXT                                   02240001
                    , F.ATTR_ELEM_TXT                                   02250001
               INTO :PV-ATTR-ELEM-TXT-DEPT                              02260001
                 ,  :PV-ATTR-ELEM-TXT-FLAG                              02270001
               FROM WST_INTGRTN_TYP A                                   02271001
                   ,WST_ATTR_DEFN   B                                   02272001
                   ,WST_ATTR_ELEM   C                                   02273001
                   ,WST_ATTR_ELEM   D                                   02274001
                   ,WST_ATTR_ELEM   E                                   02275001
                   ,WST_ATTR_ELEM   F                                   02276001
              WHERE A.INTGRTN_TYP_CDE   = 'CMNUPCDEPT'                  02277001
                AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE             02278001
                AND B.ATTR_DEFN_SEQ_NBR = 1                             02279001
                AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE             02280001
                AND C.ATTR_DEFN_SEQ_NBR = 1                             02280101
                AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE             02280201
                AND D.ATTR_DEFN_SEQ_NBR = 2                             02280301
                AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE             02280401
                AND E.ATTR_DEFN_SEQ_NBR = 3                             02280501
                AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE             02280601
                AND F.ATTR_DEFN_SEQ_NBR = 4                             02280701
                AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR           02280801
                AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR           02280901
                AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR           02281001
                AND D.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP             02281101
                AND E.ATTR_ELEM_TMST = '9999-12-31-23.59.59.999999'     02281201
287600         WITH UR                                                  02281301
288000     END-EXEC.                                                    02281401
288100                                                                  02281501
288200     EVALUATE TRUE                                                02281601
288300         WHEN SQLCODE = ZERO                                      02281701
                 MOVE PV-ATTR-ELEM-TXT-DEPT TO PV-COMMON-UPC-DEPT       02281801
                 MOVE PV-ATTR-ELEM-TXT-FLAG TO PV-COMMON-UPC-FLAG       02281901
                 DISPLAY 'PV-COMMON-UPC-FLAG ' PV-COMMON-UPC-FLAG       02282001
                 DISPLAY 'PV-COMMON-UPC-DEPT ' PV-COMMON-UPC-DEPT       02282101
288400         WHEN SQLCODE = -811                                      02282201
288900         WHEN SQLCODE = +100                                      02282301
                 MOVE 'N'  TO PV-COMMON-UPC-DEPT                        02282401
                 MOVE ' '  TO PV-COMMON-UPC-FLAG                        02282501
                 DISPLAY 'PV-COMMON-UPC-FLAG ' PV-COMMON-UPC-FLAG       02282601
                 DISPLAY 'PV-COMMON-UPC-DEPT ' PV-COMMON-UPC-DEPT       02282701
289600         WHEN OTHER                                               02282801
289800              MOVE '1100-CHECK-COMMON-SKUDE'  TO PV-PARAGRAPH     02282901
289900              MOVE 'SELECT COMMON SKU DEPT INTEGRATION PARM'      02283001
290000                  TO PV-ERROR-MSG                                 02283101
290100              MOVE 'WST_ATTR_ELEM'   TO PV-ABEND-TABLE-1          02283201
290200              MOVE 'WST_ATTR_DEFN'   TO PV-ABEND-TABLE-2          02283301
290400              PERFORM 9100-SQL-ERROR                              02283401
290500     END-EVALUATE.                                                02283501
141641*-----------------------------------------------------------------02283601
141643 2000-PROCESS-INPUT-FILE.                                         02283701
141644*-----------------------------------------------------------------02283801
141646                                                                  02283901
141647     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-PARAGRAPH.             02284001
141648                                                                  02285001
141649     IF VL052-STYL-ID EQUAL PV-LAST-STYL-ID                       02286001
141650         MOVE PV-VENDOR-TYPE TO RV064-VENDOR-TYPE                 02287001
141651         ADD 1 TO PV-DUP-STYLE-IDS                                02288001
141652     ELSE                                                         02289001
141653         PERFORM 3000-GET-LBL-SEQ-NUMBER                          02290001
141654         MOVE VL052-STYL-ID TO PV-LAST-STYL-ID                    02300001
141655     END-IF.                                                      02310001
141656                                                                  02320001
141657*PRB0049074 START                                                 02330001
141658     IF VL052-SKU-NBR EQUAL PV-LAST-SKU-NBR                       02340001
               CONTINUE                                                 02341002
141660     ELSE                                                         02360001
141670         PERFORM 3500-GET-WEB-EXCLUSIVE-IND                       02370001
141680*PRB0053051 START                                                 02380001
141690         PERFORM 3600-GET-ORIG-RETAIL-AMOUNT                      02390001
141700*PRB0053051 END                                                   02400001
141800         MOVE VL052-SKU-NBR        TO PV-LAST-SKU-NBR             02450001
141900     END-IF.                                                      02460001
141901*PRB0049074 END                                                   02470001
           SET PS-WRITE-RECORD-YES  TO TRUE                             02470103
           IF PV-COMMON-UPC-FLAG = 'Y'                                  02471002
              PERFORM 2100-PROCESS-COMMON-SKU                           02473002
           END-IF.                                                      02474002
           IF PS-WRITE-RECORD-YES                                       02480003
141902        PERFORM 5000-WRITE-ITEM-FILE-RECORD                       02490004
141903     END-IF                                                       02500003
141904     PERFORM 1000-READ-OLD-ITEM-INPT.                             02510001
141905                                                                  02520001
141643 2100-PROCESS-COMMON-SKU.                                         02530001
           IF VL052-PRIMARY-UPC-FL = 'Y'                                02540002
              PERFORM 3800-GET-COMMON-SKU-UPC                           02541002
              IF PS-PMDM-SKU-FOUND-YES                                  02550001
                ADD +1                TO   PV-COMMON-SKU-UPCS           02560001
                IF VL052-DEPT-NBR(1:4) = PV-COMMON-UPC-DEPT             02561001
                   ADD  +1               TO   PV-COMMON-FNTCS-SKU       02562001
                   MOVE RVT00007-UPC-NBR TO   PV-UPC-NBR                02563001
                   MOVE PV-UPC-NBR-X     TO   VL052-UPC-NBR             02564001
                ELSE                                                    02565001
                   ADD  +1                TO   PV-COMMON-KOHLS-SKU      02566003
                   SET PS-WRITE-RECORD-NO TO TRUE                       02566103
BYPASS***          MOVE SPACES            TO   VL052-UPC-NBR            02567003
                END-IF                                                  02568001
              END-IF                                                    02569001
           END-IF.                                                      02569101
141906*-----------------------------------------------------------------02569201
283500 3000-GET-LBL-SEQ-NUMBER.                                         02569301
283501*-----------------------------------------------------------------02569401
283600                                                                  02569501
283601     MOVE '3000-GET-LBL-SEQ-NUMBER ' TO PV-PARAGRAPH.             02569601
283602                                                                  02569701
283700     MOVE VL052-STYL-ID TO PV-STYL-ID.                            02569801
283800     MOVE PV-STYL-ID-9  TO DK-VS-ID.                              02569901
284400                                                                  02570001
284700     EXEC SQL                                                     02580001
284800         SELECT DISTINCT                                          02590001
284900              B.LBL_SEQ_NBR                                       02600001
285000            , C.VS_ID                                             02610001
285800         INTO :MDARVS-LBL-SEQ-NBR                                 02620001
285900            , :XLT00004-VS-ID                                     02630001
286800         FROM   TVNDSTL A                                         02640001
286900              , TMDARVS B                                         02650001
287000              , XLT_VND_STYL C                                    02660001
287100         WHERE  C.STYL_ID      = :DK-VS-ID                        02670001
287110           AND  A.VS_ID        = B.VS_ID                          02680001
287200           AND  B.VS_ID        = C.VS_ID                          02690001
287300           AND  B.ACTV_IND     = 'Y'                              02700001
287400           AND  A.EFF_BEG_DTE <= CURRENT_DATE                     02710001
287500           AND  A.EFF_END_DTE IS NULL                             02720001
287600         WITH UR                                                  02730001
288000     END-EXEC.                                                    02740001
288100                                                                  02750001
288200     EVALUATE TRUE                                                02760001
288300         WHEN SQLCODE = ZERO                                      02770001
288310             PERFORM 4000-GET-VENDOR-TYPE-CODE                    02780001
288400         WHEN SQLCODE = -811                                      02790001
288900         WHEN SQLCODE = +100                                      02800001
289000              MOVE 'R' TO PV-VENDOR-TYPE                          02810001
289100              ADD 1 TO PV-VENDOR-NOT-FOUND                        02820001
289600         WHEN OTHER                                               02830001
289800              MOVE '3000-GET-LBL-SEQ-NUMBER ' TO PV-PARAGRAPH     02840001
289900              MOVE 'SELECT MDARVS-LBL-SEQ-NBR FROM TMDARVS '      02850001
290000                  TO PV-ERROR-MSG                                 02860001
290100              MOVE 'TVNDSTL' TO PV-ABEND-TABLE-1                  02870001
290200              MOVE 'TMDARVS' TO PV-ABEND-TABLE-2                  02880001
290400              PERFORM 9100-SQL-ERROR                              02890001
290500     END-EVALUATE.                                                02900001
290501                                                                  02910001
290502*PRB0049074 START                                                 02920001
290503*-----------------------------------------------------------------02930001
290504 3500-GET-WEB-EXCLUSIVE-IND.                                      02940001
290505*-----------------------------------------------------------------02950001
290506                                                                  02960001
290507     MOVE '3500-GET-WEB-EXCLUSIVE-IND' TO PV-PARAGRAPH.           02970001
290508     MOVE VL052-SKU-NBR                TO PV-SKU_NBR.             02980001
290509     MOVE PV-SKU-NBR-9                 TO XLT00003-SKU-NBR.       02990001
290510                                                                  03000001
290520     EXEC SQL                                                     03010001
290530         SELECT B.WEB_EXCLV_IND                                   03020001
290540           INTO :WEBITM-WEB-EXCLV-IND                             03030001
290550           FROM XLT_SKU A                                         03040001
290560               ,TWEBITM B                                         03050001
290570          WHERE A.SKU_NBR      = :XLT00003-SKU-NBR                03060001
290580            AND B.INTR_UPC_ID  = A.INTR_UPC_ID                    03070001
290590            AND B.EFF_END_TMST IS NULL                            03080001
                  FETCH FIRST ROW ONLY                                  03090001
290600         WITH UR                                                  03100001
290700     END-EXEC.                                                    03110001
290800                                                                  03120001
290900     EVALUATE TRUE                                                03130001
291000         WHEN SQLCODE = ZERO                                      03140001
291100             CONTINUE                                             03150001
291200         WHEN SQLCODE = +100                                      03160001
291300              MOVE 'N'                 TO WEBITM-WEB-EXCLV-IND    03170001
291400         WHEN OTHER                                               03180001
291500              MOVE SQLCODE             TO PV-SQL-CODE             03190001
291600              STRING 'SKU-NBR:'   DELIMITED BY SIZE               03200001
291700                     PV-SKU-NBR-9 DELIMITED BY SIZE               03210001
291800                     ' SQLCODE:'  DELIMITED BY SIZE               03220001
291900                     PV-SQL-CODE  DELIMITED BY SIZE               03230001
292000                INTO PV-ERROR-MSG                                 03240001
292100              MOVE 'XLT_SKU'           TO PV-ABEND-TABLE-1        03250001
292200              MOVE 'TWEBITM'           TO PV-ABEND-TABLE-2        03260001
292300              PERFORM 9100-SQL-ERROR                              03270001
292400     END-EVALUATE.                                                03280001
292500                                                                  03290001
292600*PRB0049074 END                                                   03300001
292610*PRB0053051 START                                                 03310001
292700*-----------------------------------------------------------------03320001
292800 3600-GET-ORIG-RETAIL-AMOUNT.                                     03330001
292900*-----------------------------------------------------------------03340001
293000                                                                  03350001
293100     MOVE '3600-GET-ORIG-RETAIL-AMOUNT' TO PV-PARAGRAPH.          03360001
293400                                                                  03370001
293500     EXEC SQL                                                     03380001
293600         SELECT A.ORIG_UNIT_RTL_AMT                               03390001
293700           INTO :TSK-ORIG-UNIT-RTL-AMT                            03400001
293800           FROM TSK     A                                         03410001
293900               ,XLT_SKU B                                         03420001
294000          WHERE B.SKU_NBR   = :XLT00003-SKU-NBR                   03430001
294100            AND A.ITEM_NMBR = B.ITM_NBR                           03440001
294300         WITH UR                                                  03450001
294400     END-EXEC.                                                    03460001
294500                                                                  03470001
294600     EVALUATE TRUE                                                03480001
294700         WHEN SQLCODE = ZERO                                      03490001
294800             CONTINUE                                             03500001
294900         WHEN SQLCODE = +100                                      03510001
295000              MOVE ZEROES TO TSK-ORIG-UNIT-RTL-AMT                03520001
295100         WHEN OTHER                                               03530001
295200              MOVE SQLCODE             TO PV-SQL-CODE             03540001
295300              STRING 'SKU-NBR:'   DELIMITED BY SIZE               03550001
295400                     PV-SKU-NBR-9 DELIMITED BY SIZE               03560001
295500                     ' SQLCODE:'  DELIMITED BY SIZE               03570001
295600                     PV-SQL-CODE  DELIMITED BY SIZE               03580001
295700                INTO PV-ERROR-MSG                                 03590001
295800              MOVE 'TSK'               TO PV-ABEND-TABLE-1        03600001
295900              MOVE 'XLT_SKU'           TO PV-ABEND-TABLE-2        03610001
296000              PERFORM 9100-SQL-ERROR                              03620001
296100     END-EVALUATE.                                                03630001
296200                                                                  03640001
296201*PRB0053051 END                                                   03650001
292700*-----------------------------------------------------------------03660001
292800 3800-GET-COMMON-SKU-UPC.                                         03670001
292900*-----------------------------------------------------------------03680001
293000                                                                  03690001
293100     MOVE '3800-GET-COMMON-SKU-UPC    ' TO PV-PARAGRAPH.          03700001
290509     MOVE PV-SKU-NBR-9                  TO RVT00007-SKU-NBR.      03710001
293400                                                                  03720001
293500     EXEC SQL                                                     03721001
293600         SELECT A.UPC_NBR                                         03722001
293700           INTO :RVT00007-UPC-NBR                                 03723001
293800           FROM RVT_UPC_XREF A                                    03724001
294000          WHERE A.SKU_NBR   = :RVT00007-SKU-NBR                   03725001
294300         WITH UR                                                  03726001
294400     END-EXEC.                                                    03727001
294500                                                                  03728001
294600     EVALUATE TRUE                                                03729001
294700         WHEN SQLCODE = ZERO                                      03730001
294800             SET PS-PMDM-SKU-FOUND-YES TO TRUE                    03730101
294900         WHEN SQLCODE = +100                                      03730301
295000             SET PS-PMDM-SKU-FOUND-NO  TO TRUE                    03730401
295100         WHEN OTHER                                               03730501
295200              MOVE SQLCODE             TO PV-SQL-CODE             03730601
295300              STRING 'SKU-NBR:'   DELIMITED BY SIZE               03730701
295400                     PV-SKU-NBR-9 DELIMITED BY SIZE               03730801
295500                     ' SQLCODE:'  DELIMITED BY SIZE               03730901
295600                     PV-SQL-CODE  DELIMITED BY SIZE               03731001
295700                INTO PV-ERROR-MSG                                 03731101
295800              MOVE 'RVT_UPC_XREF'      TO PV-ABEND-TABLE-1        03731201
296000              PERFORM 9100-SQL-ERROR                              03731301
296100     END-EVALUATE.                                                03731401
296200                                                                  03731501
296202*-----------------------------------------------------------------03731601
296203 4000-GET-VENDOR-TYPE-CODE.                                       03731701
296204*-----------------------------------------------------------------03731801
296205                                                                  03731901
296206     MOVE '4000-GET-VENDOR-TYPE-CODE ' TO PV-PARAGRAPH.           03732001
296207                                                                  03733001
296208     EXEC SQL                                                     03734001
296209         SELECT LBL_TYP_CDE                                       03735001
296210         INTO :IMT00000-LBL-TYP-CDE                               03736001
296211         FROM  IMT_LBL                                            03737001
296212         WHERE LBL_SEQ_NBR = :MDARVS-LBL-SEQ-NBR                  03738001
296213         WITH UR                                                  03739001
296214     END-EXEC.                                                    03740001
296215                                                                  03750001
296216     EVALUATE TRUE                                                03760001
296217         WHEN SQLCODE = ZERO                                      03770001
296218             MOVE IMT00000-LBL-TYP-CDE TO PV-VENDOR-TYPE          03780001
296219             ADD 1 TO PV-VENDOR-FOUND                             03790001
296220         WHEN SQLCODE = -811                                      03800001
296221         WHEN SQLCODE = +100                                      03810001
296222              MOVE 'R' TO PV-VENDOR-TYPE                          03820001
296223              ADD 1 TO PV-VENDOR-NOT-FOUND                        03830001
296224         WHEN OTHER                                               03840001
296225              MOVE '4000-GET-VENDOR-TYPE-CODE' TO PV-PARAGRAPH    03850001
296226              MOVE 'SELECT LBL-TYP-CDE FROM IMT00000'             03860001
296227                  TO PV-ERROR-MSG                                 03870001
296228              MOVE 'IMT_LBL' TO PV-ABEND-TABLE-1                  03880001
296229              MOVE SPACES    TO PV-ABEND-TABLE-2                  03890001
296230              PERFORM 9100-SQL-ERROR                              03900001
296231     END-EVALUATE.                                                03910001
296232                                                                  03920001
296233*-----------------------------------------------------------------03930001
296234*  WRITE UPDATED ITEM RECORD                                      03940001
296235*-----------------------------------------------------------------03950001
296236                                                                  03960001
296237 5000-WRITE-ITEM-FILE-RECORD.                                     03970001
296238                                                                  03980001
296239     MOVE SPACES                TO RV064-ITEM-RECORD.             03990001
296240     MOVE VL052-ACD-INDICATOR   TO RV064-ACD-INDICATOR            04000001
296241     MOVE VL052-SKU-NBR         TO RV064-SKU-NBR                  04010001
296242     MOVE VL052-UPC-NBR         TO RV064-UPC-NBR                  04020001
296243     MOVE VL052-STYL-ID         TO RV064-STYL-ID                  04030001
296244     MOVE VL052-STYL-DESC       TO RV064-STYL-DESC                04040001
296245     MOVE VL052-NRF-CLOR-CDE    TO RV064-NRF-CLOR-CDE             04050001
296246     MOVE VL052-CSTM-CLOR-DESC  TO RV064-CSTM-CLOR-DESC           04060001
296247     MOVE VL052-KOHLS-SIZE-CDE  TO RV064-KOHLS-SIZE-CDE           04070001
296248     MOVE VL052-SIZE-DESC       TO RV064-SIZE-DESC                04080001
296249     MOVE VL052-RTL-COST-SIGN   TO RV064-RTL-COST-SIGN            04090001
296250     MOVE VL052-RTL-COST-AMT    TO RV064-RTL-COST-AMT             04100001
296251     MOVE VL052-UNT-COST-SIGN   TO RV064-UNT-COST-SIGN            04110001
296252     MOVE VL052-UNT-COST-AMT    TO RV064-UNT-COST-AMT             04120001
296253     MOVE VL052-UPC-TYPE        TO RV064-UPC-TYPE                 04130001
296254     MOVE VL052-PREPK-IND       TO RV064-PREPK-IND                04140001
296255     MOVE VL052-VS-NBR          TO RV064-VS-NBR                   04150001
296256     MOVE VL052-BUY-UM          TO RV064-BUY-UM                   04160001
296257     MOVE VL052-SELL-UM         TO RV064-SELL-UM                  04170001
296258     MOVE VL052-SKU-LEAD-TIME   TO RV064-SKU-LEAD-TIME            04180001
296259     MOVE VL052-STATUS-FLAG     TO RV064-STATUS-FLAG              04190001
296260     MOVE VL052-PRO-NMFC        TO RV064-PRO-NMFC                 04200001
296261     MOVE VL052-DEPT-NBR        TO RV064-DEPT-NBR                 04210001
296262     MOVE VL052-MAJ-CL-NBR      TO RV064-MAJ-CL-NBR               04220001
296263     MOVE VL052-SUB-CL-NBR      TO RV064-SUB-CL-NBR               04230001
296264     MOVE VL052-SKU-STAT-CDE    TO RV064-SKU-STAT-CDE             04240001
296265     MOVE VL052-ENT-ID          TO RV064-ENT-ID                   04250001
296266     MOVE VL052-SKU-STAT-DESC   TO RV064-SKU-STAT-DESC            04260001
296267     MOVE VL052-PRIMARY-UPC-FL  TO RV064-PRIMARY-UPC-FL           04270001
296268     MOVE VL052-ANCHOR-CONSTANT TO RV064-ANCHOR-CONSTANT          04280001
296269     MOVE PV-VENDOR-TYPE        TO RV064-VENDOR-TYPE.             04290001
296270*PRB0049074 START                                                 04300001
296280     MOVE WEBITM-WEB-EXCLV-IND  TO RV064-WEB-EXCLUSIVE-IND        04310001
296290*PRB0049074 END                                                   04320001
296300*PRB0053051 START                                                 04330001
296400     MOVE TSK-ORIG-UNIT-RTL-AMT TO RV064-ORIG-UNIT-RTL-AMT.       04340001
296401*PRB0053051 END                                                   04350001
296402                                                                  04360001
296403     WRITE NEW-ITEM-RECORD FROM RV064-ITEM-RECORD.                04370001
296404                                                                  04380001
296405     ADD +1 TO PV-RECORDS-WRITTEN.                                04390001
296406                                                                  04400001
296407*-----------------------------------------------------------------04410001
296408* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    *04420001
296409* ERROR OR WARNING CODE OCCURS.                                  *04430001
296410*-----------------------------------------------------------------04440001
296411                                                                  04450001
296412 9100-SQL-ERROR.                                                  04460001
296413                                                                  04470001
296414     DISPLAY '**------------------------------------------**'.    04480001
296415     DISPLAY '**             PROGRAM ABEND                **'.    04490001
296416     DISPLAY '** PROGRAM       : ' PC-CURRENT-PROGRAM-NAME.       04500001
296417     DISPLAY '** PARAGRAPH     : ' PV-PARAGRAPH.                  04510001
296418     DISPLAY '** TABLE 1       : ' PV-ABEND-TABLE-1.              04520001
296419     DISPLAY '** TABLE 2       : ' PV-ABEND-TABLE-2.              04530001
296420     DISPLAY '** ERROR MESSAGE : ' PV-ERROR-MSG.                  04540001
296421     DISPLAY '**------------------------------------------**'.    04550001
296422                                                                  04560001
296423     MOVE +4013 TO PV-ABEND-CODE.                                 04570001
296424                                                                  04580001
296425     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04590001
296426                                                                  04600001
296427 9200-END-OF-PROGRAM.                                             04610001
296428                                                                  04620001
296429     DISPLAY '-----------------------------------------------'.   04630001
296430     DISPLAY '**        RVKUT038 SUMMARY STATISTICS        **'.   04640001
296431     DISPLAY '                                               '.   04650001
296432     DISPLAY 'INPUT ITEM RECORDS READ --> ' PV-RECORDS-READ.      04660001
296433     DISPLAY '                                               '.   04670001
296434     DISPLAY 'DUPLICATE STYLE IDS     --> ' PV-DUP-STYLE-IDS.     04680001
296435     DISPLAY 'VENDOR TYPES FOUND      --> ' PV-VENDOR-FOUND.      04690001
296436     DISPLAY 'VENDOR TYPES NOT FOUND  --> ' PV-VENDOR-NOT-FOUND.  04700001
296436     DISPLAY 'COMMON SKU UPCS  FOUND  --> ' PV-COMMON-SKU-UPCS.   04710001
296436     DISPLAY 'FANATICS UPCS UPDATED   --> ' PV-COMMON-FNTCS-SKU.  04720001
296436     DISPLAY 'KOHLS    UPCS SKIPPED   --> ' PV-COMMON-KOHLS-SKU.  04730005
296437     DISPLAY '                                               '.   04740001
296438     DISPLAY 'OUTPUT RECORDS WRITTEN  --> ' PV-RECORDS-WRITTEN.   04750001
296439     DISPLAY '-----------------------------------------------'.   04760001
296440                                                                  04770001
296441*-----------------------------------------------------------------04780001
296442*                       END OF PROGRAM                            04790001
296443*-----------------------------------------------------------------04800001
