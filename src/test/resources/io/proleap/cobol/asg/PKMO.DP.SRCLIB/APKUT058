000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    APKUT058.                                         00040000
000500 AUTHOR.        JOYCE KNOKE - TCC.                                00050000
000600 DATE-WRITTEN.  08/25/97.                                         00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*                                                               * 00090000
001000*         SUMMARIZE IMPORT PO INVOICES AND ESTIMATES            * 00100000
001100*                                                               * 00110000
001200*    THIS PROGRAM READS IN INVOICES FOR IMPORT PO'S, AND        * 00120000
001300*    RETRIEVES THE DETAIL COSTS FOR THE EXPENSE INVOICES.       * 00130000
001400*    AS EACH PO IS PROCESSED, THE PO TOTALS AND ESTIMATE        * 00140000
001500*    TOTALS ARE ALSO RETRIEVED. THIS INFORMATION IS THEN        * 00150000
001600*    SUMMARIZED BY PO FOR REPORTING PURPOSES.                   * 00160000
001700*                                                               * 00170000
001800*---------------------------------------------------------------* 00180000
001900*                                                               * 00190000
002000* DB2 TABLES:                                                   * 00200000
002100*  1. PO-PURCHASE ITEM TABLE           (TPUTITM)                * 00210000
002200*  2. PD-ESTIMATED LANDING COST        (TVSCPT)                 * 00220000
002300*  3. INVOICE CHARGES/ALLOWANCES TABLE (TALCHRG)                * 00230000
002400*  4. AP CHARGE TYPE TABLE             (TACCTYP)                * 00240000
002500*  5. AP-MERCHANDISE INVOICE           (TMDINVC)                * 00250000
002600*  6. PURCHASE TABLE                   (TPURCHS)                * 00260000
002630*  7. PO INSTRUCTIONS TABLE            (TPOINST)                * 00263004
002640*  8. INSTRUCTION CODE TABLE           (TINSTCD)                * 00264004
002700*                                                               * 00270000
002800* INPUT:                                                        * 00280000
002900*  1. INVOICE-EXTRACT-FILE                                      * 00290000
003000*                                                               * 00300000
003100* OUTPUT:                                                       * 00310000
003200*  1. INVOICE-SUMMARY-FILE                                      * 00320000
003300*  2. INVOICE-CST-COMPONENT-FILE                                * 00330000
003400*  3. INV-EST-CST-COMPONENT-FILE                                * 00340000
003500*  4. INV-EST-LANDED-CST-ERROR-FILE                             * 00350000
003600*                                                               * 00360000
003700*---------------------------------------------------------------* 00370000
003800*   CHANGES:                                                    * 00380000
003900*                                                               * 00390000
004000*  09/09/97                                                     * 00400000
004100*      ADDED A DISPLAY OF THE PO BEING PROCESSED TO THE ABEND   * 00410000
004200*      ROUTINE.                                                 * 00420000
004300*  BY: NANCY EILBES                            WR/IR# 112405    * 00430000
004400*                                                               * 00440000
004500*  10/20/97                                                     * 00450000
004600*      MODIFIED THE ELC CURSOR AND THE PO TOTAL SQL TO INCLUDE  * 00460000
004700*      ONLY PO LINES WITH STATUS OF 'AC' 'AP' 'CM' OR 'CB'.     * 00470000
004800*      THIS CORRECTS A PROBLEM WHERE CANCELLED LINES WERE BEING * 00480000
004900*      INCLUDED IN THE PO AND ELC TOTALS WHEN THEY SHOULD NOT   * 00490000
005000*      HAVE BEEN.                                               * 00500000
005100*  BY: NANCY EILBES                               WR#:4164      * 00510000
005200*                                                               * 00520000
005300*  01/16/98                                                     * 00530000
005400*      ADDED THE NEW FIELD PV-INV-NET-COST-AMT TO HOLD THE TOTAL* 00540000
005500*      OF THE MERCHANDISE INVOICE NET COSTS FOR A PURCHASE      * 00550000
005600*      ORDER.  THIS NEW FIELD WILL HOLD THE SUM OF ALL THE      * 00560000
005700*      AP060-NET-COST-AMT FIELDS FOR ONE PARTICULAR PURCHASE    * 00570000
005800*      ORDER.  THIS PURCHASE ORDER NET TOTAL AMOUNT IS THEN     * 00580000
005900*      MOVED INTO THE OUTPUT LAYOUT FIELD AP062-INV-NET-COST-AMT* 00590000
006000*      TO REFLECT THE TRUE NET COST AMOUNT.                     * 00600000
006100*  BY: MARK BURNSIDE                              WR#:4164 2    * 00610000
006200*                                                               * 00620000
006300*  01/23/98                                                     * 00630000
006400*      IN PARAGRAPH B200, MOVED THE LOGIC THAT DETERMINES THE   * 00640000
006500*      EARLIEST DATE TO BE INCLUDED IN THE SECTION OF CODE FOR  * 00650000
006600*      ONLY MERCHANDISE TYPE INVOICES.  PREVIOUSLY THE LOGIC    * 00660000
006700*      RETAINED THE EARLIEST INVOICE DATE FROM ANY TYPE OF      * 00670000
006800*      INVOICE.                                                 * 00680000
006900*  BY: MARK BURNSIDE                              WR#:4164 5    * 00690000
007000*                                                               * 00700000
007100*  01/30/98  ADDED CODE TO RETRIEVE THE FOB CODE FROM THE       * 00710000
007200*            PO PLANNED SHIPMENT DB2 TABLE.                     * 00720000
007300*        BY: ROBIN BERNOSKI                   WR#:6059          * 00730000
007400*                                                               * 00740000
007500*  06/25/98                                                     * 00750000
007600*      ADDED CODE THAT WILL CARRY THE INVOICE DATE FOR POS THAT * 00760000
007700*      HAVE ONLY EXPENSE INVOICES FROM THE EARLIEST EI.  IF A PO* 00770000
007800*      HAS A MIX OF MI AND EI INVOICES THEN ONLY THE EARLIEST MI* 00780000
007900*      INVOICE DATE WILL BE KEPT.  THIS CHANGE WILL CORRECT THE * 00790000
008000*      PROBLEM OF HAVING 00/00/0000 APPEAR ON VARIOUS IMPORT    * 00800000
008100*      REPORTS.                                                 * 00810000
008200*  BY: MIKE BESKE                       WR#:4164                * 00820000
008300*                                                               * 00830000
008400*  08/03/98                                                     * 00840000
008500*      ADDED LOGIC TO POPULATE THE TWO NEW FIELDS ADDED TO      * 00850000
008600*      APRD063.  THESE FIELDS ARE AP063-ENTR-DTE AND            * 00860000
008700*      AP063-GL-ACCT-NBR.                                       * 00870000
008800*  BY: ROBIN BERNOSKI                   WR#:4164                * 00880000
008900*                                                               * 00890000
009000*  08/25/98                                                     * 00900000
009100*      THIS VERSION WAS COPIED FROM TKMA.DP.SRCLIB(APKUT058)    * 00910000
009200*       ON 08-26-98 WHILE ROBBIN WAS TESTING THE LAST CHANGES.  * 00920000
009300*      MODIFED THE ELC_CSR TO ONLY INCLUDE VS.INCL_IN_ELC_IND   * 00930000
009400*       = 'Y'. THE INDICATOR ISN'T SELECTED ANYMORE, AND IS     * 00940000
009500*       NOT PASSED TO THE APRD064 FILE.                         * 00950000
009600*      REMOVED ALL FOB CODE LOGIC.                              * 00960000
009700*      MODIFIED S300-SELECT-PO-TOTALS TO ALLOW FOR SQLCODE =    * 00970000
009800*       -305. HANDLE THIS AS A NOT FOUND CONDITION.             * 00980000
009900*      S400-SELECT-TRIP-START  NEW PARAGRAPH TO PROCESS TELCPO  * 00990000
010000*      S500-SELECT-OTB-PER  NEW PARAGRAPH TO PROCESS TPURCHS    * 01000000
010100*      C100-  PERFORM S400-SELECT-TRIP-START. IF THIS IS A      * 01010000
010200*       'COLBY' PO, WRITE AN 'FCL' TO AP063 FILE.               * 01020000
010300*      C300-  PERFORM S500-SELECT-OTB-PER. CALCULATE 1ST-COST-  * 01030000
010400*       LOAD-PCT FOR AP062 RECORD.                              * 01040000
010500*      S100-  ADDED PAYT-REC-SEQ-NBR DISPLAY WHEN NOT FOUND.    * 01050000
010600*       CREATE DISPLAY PO NBR FIELD FOR Z999-DB2-ABEND DISPLAY. * 01060000
010700*      CHANGED SECOND OCCURANCE OF PS-FIRST-INVOICE-SW TO       * 01070000
010800*       PS-INVOICE-TYPE-SW FOR CLARITY.                         * 01080000
010900*      E100-  MOVE AP060-NET-COST-AMT TO AP063-INV-CHRG-AMT,    * 01090000
011000*       INSTEAD OF AP060-GROSS-COST-AMT.                        * 01100000
011100*  BY: CHRIS KUNSTMANN                  WR#:4164                * 01110000
011200*                                                               * 01120000
011300*  12/08/99                                                     * 01130000
011400*      ADDED CODE IN PARA R200- THAT WHENEVER A CHARGE CODE OF  * 01140000
011500*      'DUP' IS ENCOUNTERED, 'DUT' WILL BE USED IN ITS PLACE.   * 01150000
011600*      THIS WILL ALLOW THE AMOUNTS OF DUP AND DUT TO BE SORT    * 01160000
011700*      SUMMED TOGETHER.  THAT WAY WHEN THE ENTRY APPEARS ON     * 01170000
011800*      REPORTS, IT CAN BE COMPARED TO THE ESTIMATE COST WHICH IS* 01180000
011900*      NOT BROKEN DOWN.                                         * 01190000
012000*  BY: MIKE BESKE                       WR#:20529               * 01200000
012100*                                                               * 01210000
012200*  02/22/00                                                     * 01220000
012300*      CHANGED THE CURRENT LOAD PERCENT IN PARAGRAPH            * 01230000
012400*      E300-CREATE-AP062-RECORD FROM .040 TO .045 PER KYLE      * 01240000
012500*      HANSEN.  THIS CHANGE WAS INTENDED TO AFFECT POS FROM     * 01250000
012600*      THE SPRING 2000 SEASON FORWARD, BUT MAY AFFECT SOME      * 01260000
012700*      FALL 1999 POS THAT HAD NOT YET BEEN RELEASED AS OF THE   * 01270000
012800*      TIME OF THIS CHANGE.                                     * 01280000
012900*  BY: NANCY EILBES                     WR#:20704               * 01290000
013000*                                                               * 01300000
013100*  08/01/01                                                     * 01310000
013200*      ADDED 'RV' TO STATUS_CDE WHICH IS PART OF THE            * 01320000
013300*      TPURITM TABLE. IT WAS UPDATED IN A CURSOR AND A          * 01330000
013400*      SELECT STATEMENT.                                        * 01340000
013500*  BY: ALEXIS KEIKER                    WR#:?????               * 01350000
013600*                                                               * 01360000
013700*  06/17/2002                                                   * 01370000
013800*     ARK PO PROJECT PHASE 1.  RECOMPILE FROM PRODUCTION.       * 01380000
013900*  MADE BY: KEVIN CATLIN                    WR# 23500           * 01390000
014000*                                                               * 01400000
014100*  06/18/2002                                                   * 01410000
014200*     ARK PO PROJECT PHASE 1.  REMOVED REFERENCE TO             * 01420000
014300*     PAYT_REQ_SEQ_NBR FOR TABLE TMDINVC AND REPLACED WITH      * 01430000
014400*     THE NEW KEYS OF PO_NBR AND INVC_ID.                       * 01440000
014500*  MADE BY: KEVIN CATLIN                WR#: 23500              * 01450000
014600*                                                               * 01460000
014700*  08/08/2002                                                   * 01470000
014800*     COLBY HANGER EXPENSE PROCESSING.  MODIFIED PROGRAM TO     * 01480000
014900*     CREATE A SEPARATE ALC/ELC COMPONENT RECORD FOR HANGER     * 01490000
015000*     CHARGES ON COLBY MERCHANDISE INVOICES.  ALSO MODIFIED     * 01500000
015100*     CREATION OF THE INVOICE TOTAL COST FILE TO MAKE SURE THE  * 01510000
015200*     HANGER CHARGES ARE NOT INCLUDED IN THE TOTAL NET COST.    * 01520000
015300*     PARAGRAPH MODIFIED IS B200.                               * 01530000
015400*  MADE BY: KEVIN CATLIN                WR#: 23254              * 01540000
015500*                                                               * 01550000
015600*  08/09/2002                                                   * 01560000
015700*     ARCH PO PROJECT PHASE 2.  MODIFIED THE ALLOWANCE/CHARGE   * 01570000
015800*     CURSOR SO THAT IT USES THE PO NUMBER AND THEN INVOICE ID  * 01580000
015900*     ARE USED IN THE WHERE CONDITIONS. PAYMENT REQUEST         * 01590000
016000*     SEQUENCE NUMBER IS NO LONGER USED AS AN INDEX.            * 01600000
016100*  MADE BY: BRIAN HASSLINGER            WR#: 23500              * 01610000
016200*                                                               * 01620000
016300*  10/16/2002                                                   * 01630000
016400*     CHANGE MADE: ARK PO PROJECT PHASE 2 CORRECTION.           * 01640000
016500*     THE HOST VARIABLE USED IN THE ALW_CHRG_CSR WAS INCORRECTLY* 01650000
016600*     BEING POPULATED IN THE FETCH PARAGRAPH.  THE POPULATION OF* 01660000
016700*     THE HOST VARIABLE FOR THE PO NUMBER WAS DONE AFTER THE    * 01670000
016800*     READ OF EACH INPUT RECORD.                                * 01680000
016900*  MADE BY: MIKE BESKE                  WR#: 22902              * 01690000
017000*                                                               * 01700000
017100*  11/04/2002                                                   * 01710000
017200*     COLBY DATING PROJECT.  ADDED EFFECTIVE DATING TO THE ALW_ * 01720000
017300*     CHRG_CSR AND THE SQL IN S200-SELECT-ACCTYP.               * 01730000
017400*  MADE BY: MIKE BESKE                  WR#: 23750              * 01740000
017500*                                                               * 01750000
017600*  01/26/2005                                                   * 01760000
017700*     CHANGE FIRST COST LOAD TO 6% FOR ALL POS WITH OTB OF      * 01770000
017800*     FEBRUARY 2005 AND LATER.  REMOVED S400-SELECT-TRIP-START  * 01780000
017900*     BECAUSE THE TRIP START DATE IS NO LONGER BEING USED TO    * 01790000
018000*     DETERMINE WHICH LOAD PERCENT TO USE.                      * 01800000
018100*  MADE BY: NANCY EILBES                WR#: 28209              * 01810000
018200*                                                               * 01820000
018300* DATE  01/31/2005                                              * 01830000
018400*     CHANGE MADE: REPLACED THE 88 LEVEL PV-VENDOR-COLBY WITH A * 01840000
018500*     NEW 88 LEVEL UNDER PV-PRE-VENDOR-NBR USING THE LI & FUNG  * 01850000
018600*     (FORMERLY COLBY) VENDOR NUMBER 009206194.                 * 01860000
018700*     MADE BY: MIKE BESKE              WR/IR #: WR28114         * 01870000
018710*                                                               * 01871000
018720* DATE  03/11/2007                                              * 01872000
018730*     CHANGE MADE: MBDC PROJECT. RECOMPILE                      * 01873000
018760*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR21578         * 01876000
018770*                                                               * 01877000
018780* DATE  02/04/2008                                              * 01878000
018790*     CHANGE MADE: MODIFIED TO IDENTIFY POS REQUIRING PRIVATE   * 01879000
018791*     LABEL LOAD AND TO POPULATE LOAD PERCENT ON THE INVOICE    * 01879100
018792*     TOTAL AND INVOICE COMPONENT COST FILES. MODIFIED COPYBOOK * 01879200
018793*     APRD062 TO ADD NEW FIELD, LOAD-TYP-CDE. ADDED 2 DB2 TBLS, * 01879300
018794*     XMT_PRVT_BRND_FCTR AND TDTATTR. MODIFIED S500 TO ADD      * 01879400
018795*     DEPT_NBR AND LBL_TYP_CDE TO SELECT OF TPURCHS. MODIFIED   * 01879500
018796*     C100 TO PERFORM E150 IF VENDOR IS LIFUNG OR LBL-TYP-CDE IS* 01879600
018797*     PRIVATE. MODIFIED E300 TO APPLY CORRECT LOAD TO L&F AND   * 01879700
018798*     NON-LIFUNG PRIVATE LBLS, AS WELL AS POPULATE LOAD-TYP-CDE.* 01879800
018799*     ADDED E310 TO OBTAIN OTB BEGIN DATE FROM TDTATTR USING    * 01879900
018800*     OTB_PER_NBR. ALSO ADDED E320 TO GET PRIVATE LABEL LOAD %. * 01880000
018801*     WHEN CHARGE AMOUNT IS ZERO, USE GROSS INSTEAD OF NET      * 01880100
018802*     WHEN CALCULATING INVOICE CHARGE AMOUNT (USED IN APKUT080  * 01880200
018803*     TO CALC PERCENTS).                                        * 01880300
018804*     MADE BY: CHRISTINE TWIEHAUS      WR/IR #: WR32664         * 01880400
018805*                                                               * 01880500
018806* DATE  03/07/2008                                              * 01880600
018807*     CHANGE MADE: MODIFIED E100- TO CALCULATE THE INVOICE      * 01880700
018808*     CHARGE AMOUNT TO EQUAL NET COST LESS ANY ALLOW. CHARGES   * 01880800
018809*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: INC000000288116 * 01880900
018810*                                                               * 01881000
018811* DATE  10/28/2010                                              * 01881100
018812*     CHANGE MADE: MODIFIED E300- TO SET NO LOAD TO APPLY       * 01881200
018813*     WHEN CHARITY DEPT 830, 836                                * 01881300
018814*     ALSO MODIFIED C100 NOT TO PERFORM E150 WHEN CHARITY DEPT  * 01881400
018815*     MADE BY: TOM MARTIN              WR/IR #: WR38253         * 01881500
032600*                                                               * 03260004
032700* DATE  06/30/2011                                              * 03270004
032800*     CHANGE MADE: ACCEPT THE OPEN ACCOUNT PROCESSING OPTION    * 03280004
032900*     AND TO USE THE PO PAYMENT TERMS TO REASSIGN               * 03290004
033000*     THE OPEN ACCOUNT ALLOWANCE CHARGE CODE TO THE PURCHASE    * 03300004
033100*     ORDER IN THE OUTPUT FILE,                                 * 03310004
033101*     MADE BY: TOM MARTIN              WR/IR #: WR39735         * 03310104
033102*                                                               * 03310204
033103* DATE  08/24/2011                                              * 03310304
033104*     CHANGE MADE: REMOVE LOGIC TO USE PO PAYMENTS TERMS TO     * 03310404
033105*     THE OPEN ACCOUNT ALLOWANCE CHARGE CODE TO THE PURCHASE    * 03310504
033106*     ORDER IN THE OUTPUT FILE,                                 * 03310604
033107*     MADE BY: TOM MARTIN              WR/IR #: WR39735         * 03310704
033108*                                                               * 03310804
033109* DATE  05/11/2021                                              * 03310904
033110*     CHANGE MADE: RECOMPILE FOR UPDATED APWS008 COPYBOOK       * 03311004
033113*     MADE BY: JEAN KURK               WR/IR #: CHG0256545      * 03311304
033114*                                                               * 03311404
033115* DATE  09/13/2021                                              * 03311504
033116*     CHANGE MADE: PROD DEV LOAD SIMPLIFICATION. REMOVED TABLES * 03311604
033117*     XMT_PRVT_BRND_FCTR AND TDTATTR AND ADDED HARD-CODED       * 03311704
033118*     BRAND-PERCENT TO REPLACE THE LOGIC WHEN THIS LOOKUP WAS   * 03311804
033119*     USED.  ADDED TABLES TPOINST AND TINSTCD TO IDENTIFY 2021  * 03311904
033120*     POS THAT CONTAIN 2022 SKUS, SO THE NEW UNIFORM LOAD RATE  * 03312004
033122*     COULD BE APPLIED.  ALL POS WITH OTB OF 202202 AND LATER   * 03312204
033123*     WILL ALSO HAVE THE UNIFORM RATE APPLIED, REGARDLESS IF    * 03312304
033124*     THE VENDOR IS LI & FUNG OR NOT.  ADDED EXCLUSIVE BRAND    * 03312404
033125*     POS TO BE HANDLED LIKE PRIVATE BRAND POS.                 * 03312504
033126*     MADE BY: NANCY EILBES            WR/IR #: CHG0262261      * 03312611
033127*                                                               * 03312713
033128* DATE  10/12/2021                                              * 03312813
033129*     CHANGE MADE: MODIFIED NEW SQL ACCESSING PO INSTRUCTIONS   * 03312913
033130*     TO PREVENT ABEND WHEN MULTIPLE ROWS OF INSTRUCTIONS EXIST.* 03313013
033138*     MADE BY: NANCY EILBES            WR/IR #: CHG0262513      * 03313813
033139*---------------------------------------------------------------* 03313913
033140                                                                  03314013
033141                                                                  03314113
033142 ENVIRONMENT DIVISION.                                            03314213
033143 CONFIGURATION SECTION.                                           03314313
033144 SOURCE-COMPUTER. IBM-3090.                                       03314413
033145 OBJECT-COMPUTER. IBM-3090.                                       03314513
033146                                                                  03314613
033147*                                                                 03314713
033148 INPUT-OUTPUT SECTION.                                            03314813
033149 FILE-CONTROL.                                                    03314913
033150*                                                                 03315013
033151     SELECT INVOICE-EXTRACT-FILE           ASSIGN TO UT-S-INP01.  03315113
033152     SELECT INVOICE-SUMMARY-FILE           ASSIGN TO UT-S-OUT01.  03315213
033153     SELECT INVOICE-CST-COMPONENT-FILE     ASSIGN TO UT-S-OUT02.  03315313
033154     SELECT INV-EST-CST-COMPONENT-FILE     ASSIGN TO UT-S-OUT03.  03315413
033155     SELECT INV-EST-LANDED-CST-ERROR-FILE  ASSIGN TO UT-S-OUT04.  03315513
033156*                                                                 03315613
033157 DATA DIVISION.                                                   03315713
033158 FILE SECTION.                                                    03315813
033159*                                                                 03315913
033160 FD  INVOICE-EXTRACT-FILE                                         03316013
033161     RECORDING MODE IS F                                          03316113
033162     BLOCK CONTAINS 0 CHARACTERS                                  03316213
033163     LABEL RECORDS ARE STANDARD                                   03316313
033164     DATA RECORD IS INVOICE-EXTRACT-RECORD.                       03316413
033165*                                                                 03316513
033166 01  INVOICE-EXTRACT-RECORD       PIC X(175).                     03316613
033167*                                                                 03316713
033168 FD  INVOICE-SUMMARY-FILE                                         03316813
033169     RECORDING MODE IS F                                          03316913
033170     BLOCK CONTAINS 0 CHARACTERS                                  03317013
033171     LABEL RECORDS ARE STANDARD                                   03317113
033172     DATA RECORD IS INVOICE-SUMMARY-RECORD.                       03317213
033173*                                                                 03317313
033174 01  INVOICE-SUMMARY-RECORD       PIC X(150).                     03317413
033175*                                                                 03317513
033176 FD  INVOICE-CST-COMPONENT-FILE                                   03317613
033177     RECORDING MODE IS F                                          03317713
033178     BLOCK CONTAINS 0 CHARACTERS                                  03317813
033179     LABEL RECORDS ARE STANDARD                                   03317913
033180     DATA RECORD IS INVOICE-CST-COMPONENT-RECORD.                 03318013
033181*                                                                 03318113
033182 01  INVOICE-CST-COMPONENT-RECORD PIC X(120).                     03318213
033183*                                                                 03318313
033184 FD  INV-EST-CST-COMPONENT-FILE                                   03318413
033185     RECORDING MODE IS F                                          03318513
033186     BLOCK CONTAINS 0 CHARACTERS                                  03318613
033187     LABEL RECORDS ARE STANDARD                                   03318713
033188     DATA RECORD IS INV-EST-CST-COMPONENT-RECORD.                 03318813
033189*                                                                 03318913
033190 01  INV-EST-CST-COMPONENT-RECORD PIC X(50).                      03319013
033191*                                                                 03319113
033192 FD  INV-EST-LANDED-CST-ERROR-FILE                                03319213
033193     RECORDING MODE IS F                                          03319313
033194     BLOCK CONTAINS 0 CHARACTERS                                  03319413
033195     LABEL RECORDS ARE STANDARD                                   03319513
033196     DATA RECORD IS INV-EST-LANDED-CST-ERROR-REC.                 03319613
033197*                                                                 03319713
033198 01  INV-EST-LANDED-CST-ERROR-REC PIC X(80).                      03319813
033199*                                                                 03319913
033200 EJECT                                                            03320013
033201 WORKING-STORAGE SECTION.                                         03320113
033202                                                                  03320213
033203 01  PC-PROGRAM-CONSTANTS.                                        03320313
033204     05  PC-WS-PROGRAM           PIC  X(40)  VALUE                03320413
033205         '**** WORKING STORAGE ** APKUT058 ****'.                 03320513
033206     05  PC-DASH                 PIC  X(01)  VALUE '-'.           03320613
033207                                                                  03320713
033208 01  PV-PROGRAM-VARIABLES.                                        03320813
033209     05  PV-CURRENT-PARAGRAPH    PIC  X(35).                      03320913
033210     05  PV-NULL-IND             PIC S9(4)     VALUE ZERO         03321013
033211                                               COMP SYNC.         03321113
033212     05  PV-PREV-PO-NBR          PIC  S9(9)    VALUE ZEROS.       03321213
033213     05  PV-PREV-VENDOR-NAME     PIC  X(30)    VALUE SPACES.      03321313
033214     05  PV-PREV-VENDOR-NBR      PIC  X(09)    VALUE SPACES.      03321413
033215         88  PV-VENDOR-NBR-LIFUNG         VALUE '009206194'.      03321513
033216     05  PV-ALW-CHRG-CDE         PIC  X(03)    VALUE SPACES.      03321613
033217     05  PV-DIS-PO-NBR           PIC  9(9)     VALUE ZEROS.       03321713
033218     05  PV-DIS-DEPT-NBR         PIC  9(4)     VALUE ZEROS.       03321813
033219     05  PV-TRIP-START-DATE      PIC  X(10)    VALUE SPACE.       03321913
033220     05  PV-INV-CHRG-AMT         PIC S9(11)V999 VALUE ZEROES      03322013
033221                                               COMP-3.            03322113
033222     05  PV-TOT-CHRG-AMT         PIC S9(11)V999 VALUE ZEROES      03322213
033223                                               COMP-3.            03322313
033224     05  PV-PAYT-REQ-SEQ-NBR     PIC  9(9)     VALUE ZEROS.       03322413
033225     05  PV-PO-NBR               PIC S9(9)     VALUE ZEROS        03322513
033226                                               COMP.              03322613
033227     05  PV-VALID-COST-CODES     PIC X(03)     VALUE '   '.       03322713
033228         88  PV-VALID-1ST-COST                 VALUE '1ST',       03322813
033229                                                     '1LC',       03322913
033230                                                     '1OA',       03323013
033231                                                     'AMC'.       03323113
033232     05  PV-FIRST-INV-DTE        PIC 9(08)     VALUE ZEROS.       03323213
033233     05  FILLER   REDEFINES   PV-FIRST-INV-DTE.                   03323313
033234         10  PV-FST-INV-CCYY     PIC 9(04).                       03323413
033235         10  PV-FST-INV-MM       PIC 99.                          03323513
033236         10  PV-FST-INV-DD       PIC 99.                          03323613
033237     05  PV-FIRST-INV-DTE-X      PIC X(10)     VALUE SPACES.      03323713
033238     05  FILLER   REDEFINES   PV-FIRST-INV-DTE-X.                 03323813
033239         10  PV-FST-INV-CCYY-X   PIC XXXX.                        03323913
033240         10  PV-DASH1-X          PIC X.                           03324013
033241         10  PV-FST-INV-MM-X     PIC XX.                          03324113
033242         10  PV-DASH2-X          PIC X.                           03324213
033243         10  PV-FST-INV-DD-X     PIC XX.                          03324313
033244     05  PV-INVOICE-DTE          PIC 9(08)     VALUE ZEROS.       03324413
033245     05  PV-VSCPT-UNT-QTY        PIC S9(09)    VALUE ZEROS        03324513
033246                                               COMP-3.            03324613
033247     05  PV-VSCPT-UNT-COST       PIC S9(07)V999 VALUE ZEROS       03324713
033248                                               COMP-3.            03324813
033249     05  PV-INV-1ST-COST-AMT     PIC S9(09)V99 VALUE ZEROS        03324913
033250                                               COMP-3.            03325013
033251     05  PV-INV-TOT-COST-AMT     PIC S9(09)V99 VALUE ZEROS        03325113
033252                                               COMP-3.            03325213
033253     05  PV-INV-UNT-QTY          PIC S9(09)    VALUE ZEROS        03325313
033254                                               COMP-3.            03325413
033255     05  PV-EST-1ST-COST-AMT     PIC S9(09)V99 VALUE ZEROS        03325513
033256                                               COMP-3.            03325613
033257     05  PV-EST-TOT-COST-AMT     PIC S9(09)V99 VALUE ZEROS        03325713
033258                                               COMP-3.            03325813
033259     05  PV-EST-UNT-QTY          PIC S9(09)    VALUE ZEROS        03325913
033260                                               COMP-3.            03326013
033261     05  PV-PO-1ST-COST-AMT      PIC S9(09)V99 VALUE ZEROS        03326113
033262                                               COMP-3.            03326213
033263     05  PV-PO-TOT-COST-AMT      PIC S9(09)V99 VALUE ZEROS        03326313
033264                                               COMP-3.            03326413
033265     05  PV-PO-UNT-QTY           PIC S9(09)    VALUE ZEROS        03326513
033266                                               COMP-3.            03326613
033267     05  PV-IMP-EXT-COUNT        PIC  9(9)     VALUE ZEROS.       03326713
033268     05  PV-AP062-COUNT          PIC  9(9)     VALUE ZEROS.       03326813
033269     05  PV-AP063-COUNT          PIC  9(9)     VALUE ZEROS.       03326913
033270     05  PV-AP064-COUNT          PIC  9(9)     VALUE ZEROS.       03327013
033271     05  PV-AP035-COUNT          PIC  9(9)     VALUE ZEROS.       03327113
033272     05  PV-INV-NET-COST-AMT     PIC S9(09)V99 VALUE ZEROS        03327213
033273                                               COMP-3.            03327313
033274     05  PV-UNIFORM-PCT          PIC S9V9999 VALUE +0.0375        03327413
033275                                               COMP-3.            03327513
033276     05  PV-LIFUNG-PCT           PIC S9V9999 VALUE +0.06          03327613
033277                                               COMP-3.            03327713
033278     05  PV-BRAND-PCT            PIC S9V9999 VALUE +0.05          03327813
033279                                               COMP-3.            03327913
033280     05  PV-DEPT-NBR             PIC S9(4)V VALUE ZEROES          03328013
033281                                               COMP-3.            03328113
033282     05  WS-DEPT-NBR             PIC S9(4)V VALUE ZEROES          03328213
033283                                               COMP-3.            03328313
033284        88 WS-CHARITY-DEPT       VALUES 830, 836.                 03328413
033285 01  PS-PROGRAM-SWITCHES.                                         03328513
033290     05  PS-END-INVOICES-SW      PIC  X(01)  VALUE ' '.           03329003
033300         88  PS-END-INVOICES                 VALUE 'Y'.           03330000
033400         88  PS-MORE-INVOICES                VALUE ' '.           03340000
033500     05  PS-END-ELC-SW           PIC  X(01)  VALUE ' '.           03350000
033600         88  PS-END-ELC                      VALUE 'Y'.           03360000
033700         88  PS-MORE-ELC                     VALUE ' '.           03370000
033800     05  PS-END-EXTRACT-SW       PIC  X(01)  VALUE ' '.           03380000
033900         88  PS-END-EXTRACT                  VALUE 'Y'.           03390000
034000         88  PS-MORE-EXTRACT                 VALUE ' '.           03400000
034100     05  PS-END-ALW-CHARGES-SW   PIC  X(01)  VALUE ' '.           03410000
034200         88  PS-END-ALW-CHARGES              VALUE 'Y'.           03420000
034300         88  PS-MORE-ALW-CHARGES             VALUE ' '.           03430000
034400     05  PS-FIRST-INVOICE-SW     PIC  X(01)  VALUE ' '.           03440000
034500         88  PS-NOT-FIRST-INVOICE            VALUE 'Y'.           03450000
034600         88  PS-FIRST-INVOICE                VALUE ' '.           03460000
034700     05  PS-INVOICE-TYPE-SW      PIC  X(01)  VALUE ' '.           03470000
034800         88  PS-EXPENSE-INVOICES-ONLY        VALUE 'Y'.           03480000
034900         88  PS-MIXED-INVOICES               VALUE ' '.           03490000
034910     05  PS-SP22-PO-SW           PIC  X(01)  VALUE 'N'.           03491005
034920         88  PS-SP22-PO                      VALUE 'Y'.           03492005
034930         88  PS-NOT-SP22-PO                  VALUE 'N'.           03493005
035000/                                                                 03500000
035100*                                                                 03510000
035200*    INVOICE-EXTRACT-RECORD                                       03520000
035300*                                                                 03530000
035400     COPY APRD060.                                                03540000
035500/                                                                 03550000
035600*                                                                 03560000
035700*    INVOICE-SUMMARY-RECORD                                       03570000
035800*                                                                 03580000
035900     COPY APRD062.                                                03590000
036000/                                                                 03600000
036100*                                                                 03610000
036200*    INVOICE-CST-COMPONENT-RECORD                                 03620000
036300*                                                                 03630000
036400     COPY APRD063.                                                03640000
036500/                                                                 03650000
036600*                                                                 03660000
036700*    INV-EST-CST-COMPONENT-RECORD                                 03670000
036800*                                                                 03680000
036900     COPY APRD064.                                                03690000
037000/                                                                 03700000
037100*                                                                 03710000
037200*    INV-EST-LANDED-CST-ERROR-REC                                 03720000
037300*                                                                 03730000
037400     COPY APRD035.                                                03740000
037500/                                                                 03750000
037600*                                                                 03760000
037700*    TPURITM DCLGEN                                               03770000
037800*                                                                 03780000
037900     EXEC SQL                                                     03790000
038000         INCLUDE TPURITM                                          03800000
038100     END-EXEC.                                                    03810000
038200/                                                                 03820000
038300*                                                                 03830000
038400*    TVSCPT DCLGEN                                                03840000
038500*                                                                 03850000
038600     EXEC SQL                                                     03860000
038700         INCLUDE TVSCPT                                           03870000
038800     END-EXEC.                                                    03880000
038900/                                                                 03890000
039000*                                                                 03900000
039100*    TALCHRG DCLGEN                                               03910000
039200*                                                                 03920000
039300     EXEC SQL                                                     03930000
039400         INCLUDE TALCHRG                                          03940000
039500     END-EXEC.                                                    03950000
039600/                                                                 03960000
039700*                                                                 03970000
039800*    TACCTYP DCLGEN                                               03980000
039900*                                                                 03990000
040000     EXEC SQL                                                     04000000
040100         INCLUDE TACCTYP                                          04010000
040200     END-EXEC.                                                    04020000
040300/                                                                 04030000
040400*                                                                 04040000
040500*    TMDINVC DCLGEN                                               04050000
040600*                                                                 04060000
040700     EXEC SQL                                                     04070000
040800         INCLUDE TMDINVC                                          04080000
040900     END-EXEC.                                                    04090000
041080/                                                                 04108000
041100*----------------------------------------------------------------*04110000
041200*  PURCHASE TABLE                                                *04120000
041300*----------------------------------------------------------------*04130000
041400     EXEC SQL                                                     04140000
041500          INCLUDE TPURCHS                                         04150000
041600     END-EXEC.                                                    04160000
041610/                                                                 04161002
041620*----------------------------------------------------------------*04162002
041630*  PURCHASE ORDER INSTRUCTIONS TABLE                             *04163002
041640*----------------------------------------------------------------*04164002
041650     EXEC SQL                                                     04165002
041660          INCLUDE TPOINST                                         04166002
041670     END-EXEC.                                                    04167002
041680/                                                                 04168002
041690*----------------------------------------------------------------*04169002
041691*  INSTRUCTION CODE TABLE                                        *04169102
041692*----------------------------------------------------------------*04169202
041693     EXEC SQL                                                     04169302
041694          INCLUDE TINSTCD                                         04169402
041695     END-EXEC.                                                    04169502
041700/                                                                 04170000
041800*                                                                 04180000
041900*    SQL COMMUNICATIONS AREA DCLGEN                               04190000
042000*                                                                 04200000
042100     EXEC SQL                                                     04210000
042200         INCLUDE SQLCA                                            04220000
042300     END-EXEC.                                                    04230000
042400/                                                                 04240000
042500*---------------------------------------------------------------- 04250000
042600*    CURSOR DECLARATIONS                                          04260000
042700*---------------------------------------------------------------- 04270000
042800*---------------------------------------------------------------- 04280000
042900* ELC_CSR RETURNS ALL CHARGES FOR PO BEING PROCESSED              04290000
043000*---------------------------------------------------------------- 04300000
043100     EXEC SQL                                                     04310000
043200         DECLARE ELC_CSR CURSOR                                   04320000
043300             FOR SELECT                                           04330000
043400                 SUM (PU.UNT_QTY)                                 04340000
043500                ,SUM (PU.UNT_QTY * VS.CPT_CHRG_AMT)               04350000
043600                ,VS.ALW_CHRG_CDE                                  04360000
043700             FROM                                                 04370000
043800                 TPURITM PU                                       04380000
043900                ,TVSCPT  VS                                       04390000
044000             WHERE  PU.PO_NBR          = :PV-PO-NBR               04400000
044100               AND  PU.PO_NBR          =  VS.PO_NBR               04410000
044200               AND  PU.VEND_STYL_NAME  =  VS.VND_STYL_NM          04420000
044300               AND  PU.VER_STATUS_CDE  = 'A'                      04430000
044400               AND  PU.STATUS_CDE      IN ('AC','AP','CB','CM',   04440000
044500                                           'RV')                  04450000
044600               AND  VS.INCL_IN_ELC_IND = 'Y'                      04460000
044700             GROUP BY VS.ALW_CHRG_CDE                             04470000
044800     END-EXEC.                                                    04480000
044900                                                                  04490000
045000/                                                                 04500000
045100*---------------------------------------------------------------- 04510000
045200* ALW_CHRG_CSR RETRIEVES ALL CHARGES AND CORRESPONDING ACCOUNT    04520000
045300* NUMBERS, FOR AN EXPENSE INVOICE OR LI & FUNG MERCHANDISE        04530000
045400* INVOICE.                                                        04540000
045500*---------------------------------------------------------------- 04550000
045600     EXEC SQL                                                     04560000
045700       DECLARE ALW_CHRG_CSR CURSOR FOR                            04570000
045800         SELECT AC.ALW_CHRG_CDE                                   04580000
045900               ,AC.ALW_CHRG_AMT                                   04590000
046000               ,AT.INCL_IN_ALC_IND                                04600000
046100               ,AT.GL_ACCT_NBR                                    04610000
046200            FROM TALCHRG AC                                       04620000
046300                ,TACCTYP AT                                       04630000
046400            WHERE AC.PO_NBR           = :ALCHRG-PO-NBR            04640000
046500              AND AC.INVC_ID          = :AP060-INVOICE-NUMBER     04650000
046600              AND AC.ALW_CHRG_CDE     =  AT.ALW_CHRG_CDE          04660000
046700              AND AC.ALW_CHRG_TYP_CDE = 'C'                       04670000
046800              AND AT.STAT_CDE         = 'A'                       04680000
046900              AND AT.INCL_IN_ALC_IND  = 'Y'                       04690000
047000              AND :PV-FIRST-INV-DTE-X BETWEEN AT.EFF_STRT_DTE     04700000
047100                                          AND AT.EFF_END_DTE      04710000
047200     END-EXEC.                                                    04720000
047300/                                                                 04730000
047400*---------------------------------------------------------------- 04740000
047500*  ABEND DATA AREAS                                               04750000
047600*---------------------------------------------------------------- 04760000
047700 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          04770000
047800                                             COMP SYNC.           04780000
047900     88  AC-DB2-ERROR                        VALUE +4013.         04790000
048000                                                                  04800000
048100                                                                  04810000
048200 01  ABEND-AREAS.                                                 04820000
048300     05  AA-ABEND-LIT            PIC  X(40)  VALUE                04830000
048400             '*****       ABEND'.                                 04840000
048500     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                04850000
048600             '*****   PROGRAM: APKUT058'.                         04860000
048700     05  AA-PARAGRAPH-LIT.                                        04870000
048800         10  FILLER              PIC  X(17)  VALUE                04880000
048900             '***** PARAGRAPH: '.                                 04890000
049000         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        04900000
049100     05  AA-MESSAGE-LINE.                                         04910000
049200         10  FILLER              PIC  X(06)  VALUE '*****'.       04920000
049300         10  AA-MESSAGE.                                          04930000
049400             15 AA-MESS-1        PIC  X(30)  VALUE SPACES.        04940000
049500             15 AA-MESS-2        PIC  X(97)  VALUE SPACES.        04950000
049600     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                04960000
049700             '*****    DB2 ERROR'.                                04970000
049800     05  AA-DB2-OPERATION-LIT.                                    04980000
049900         10  FILLER              PIC  X(17)  VALUE                04990000
050000             '***** OPERATION: '.                                 05000000
050100         10  AA-DB2-OPERATION.                                    05010000
050200             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        05020000
050300             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        05030000
050400     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        05040000
050500     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        05050000
050600     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        05060000
050700     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        05070000
050800                                                                  05080000
050900/                                                                 05090000
051000*---------------------------------------------------------------- 05100000
051100*  SQLCA FORMATTED MESSAGE AREA                                   05110000
051200*---------------------------------------------------------------- 05120000
051300     COPY DPWS004.                                                05130000
051400*                                                                 05140000
051500/                                                                 05150000
051600 01  FILLER                      PIC  X(35)  VALUE                05160000
051700     '**** END OF W/S ** APKUT058 ****'.                          05170000
051800 EJECT                                                            05180000
051900 PROCEDURE DIVISION.                                              05190000
052000                                                                  05200000
052100     PERFORM A100-MAINLINE.                                       05210000
052200     GOBACK.                                                      05220000
052300                                                                  05230000
052400 EJECT                                                            05240000
052500 A100-MAINLINE.                                                   05250000
052600                                                                  05260000
052700     MOVE 'A100-MAINLINE' TO PV-CURRENT-PARAGRAPH.                05270000
052800                                                                  05280000
052900     PERFORM B100-INITIALIZE.                                     05290000
053000                                                                  05300000
053100     PERFORM B200-PROCESS-EXTRACT-FILE                            05310000
053200         UNTIL PS-END-EXTRACT.                                    05320000
053300                                                                  05330000
053400     PERFORM B300-END-OF-PROGRAM.                                 05340000
053500                                                                  05350000
053600 EJECT                                                            05360000
053700*---------------------------------------------------------------- 05370000
053800*    INITIALIZATION PROCESSING                                    05380000
053900*---------------------------------------------------------------- 05390000
054000 B100-INITIALIZE.                                                 05400000
054100                                                                  05410000
054200     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              05420000
054300                                                                  05430000
054400     OPEN INPUT  INVOICE-EXTRACT-FILE.                            05440000
054500     OPEN OUTPUT INVOICE-SUMMARY-FILE                             05450000
054600                 INVOICE-CST-COMPONENT-FILE                       05460000
054700                 INV-EST-CST-COMPONENT-FILE                       05470000
054800                 INV-EST-LANDED-CST-ERROR-FILE.                   05480000
054900                                                                  05490000
055000     INITIALIZE DCLTPURITM                                        05500000
055100                DCLTVSCPT                                         05510000
055200                DCLTALCHRG                                        05520000
055300                DCLTACCTYP                                        05530000
055400                DCLTMDINVC                                        05540000
055500                DCLTPOINST                                        05550002
055510                DCLTINSTCD                                        05551002
055520                DCLTPURCHS.                                       05552002
055600                                                                  05560000
055700     INITIALIZE PS-PROGRAM-SWITCHES.                              05570000
055800                                                                  05580000
055900     PERFORM R100-READ-EXTRACT-FILE.                              05590000
056000                                                                  05600000
056100     MOVE AP060-PO-NBR        TO PV-PREV-PO-NBR                   05610000
056200                                 ALCHRG-PO-NBR                    05620002
056210                                 POINST-PO-NBR.                   05621002
056300     MOVE AP060-VENDOR-NUMBER TO PV-PREV-VENDOR-NBR.              05630000
056400     MOVE AP060-VENDOR-NAME   TO PV-PREV-VENDOR-NAME.             05640000
056500                                                                  05650000
056600 EJECT                                                            05660000
056700*---------------------------------------------------------------- 05670000
056800*    CONTROLS THE PROCESSING OF EXPENSE INVOICES                  05680000
056900*    CHECKS FOR PO NBR BREAKS                                     05690000
057000*    THE EARLIEST INVOICE DATE IS SAVED FOR FUTURE PROCESSING     05700000
057100*    MERCHANDISE INVOICES                                         05710000
057200*      SELECT MERCHANDISE INVOICE                                 05720000
057300*      CREATE AP063 RECORDS                                       05730000
057400*    EXPENSE INVOICES                                             05740000
057500*      FETCH ALL CHARGES FOR INVOICE                              05750000
057600*---------------------------------------------------------------- 05760000
057700 B200-PROCESS-EXTRACT-FILE.                                       05770000
057800                                                                  05780000
057900     MOVE 'B200-PROCESS-EXTRACT-FILE' TO                          05790000
058000                             PV-CURRENT-PARAGRAPH.                05800000
058100                                                                  05810000
058200     IF AP060-PO-NBR NOT = PV-PREV-PO-NBR                         05820000
058300         PERFORM C100-PO-NBR-BREAK                                05830000
058400     END-IF.                                                      05840000
058500     STRING AP060-INVOICE-CENT      DELIMITED BY SIZE             05850000
058600            AP060-INVOICE-YEAR      DELIMITED BY SIZE             05860000
058700            AP060-INVOICE-MONTH     DELIMITED BY SIZE             05870000
058800            AP060-INVOICE-DAY       DELIMITED BY SIZE             05880000
058900       INTO PV-INVOICE-DTE                                        05890000
059000     END-STRING.                                                  05900000
059100                                                                  05910000
059200     IF PS-FIRST-INVOICE                                          05920000
059300        SET PS-NOT-FIRST-INVOICE TO TRUE                          05930000
059400        IF AP060-EXPENSE-INVOICE                                  05940000
059500           SET PS-EXPENSE-INVOICES-ONLY TO TRUE                   05950000
059600        END-IF                                                    05960000
059700     END-IF.                                                      05970000
059800                                                                  05980000
059900     IF  AP060-MERCHANDISE-INVOICE                                05990000
060000         IF  PV-FIRST-INV-DTE = ZEROS                             06000000
060100         OR  PV-FIRST-INV-DTE > PV-INVOICE-DTE                    06010000
060200             MOVE PV-INVOICE-DTE  TO PV-FIRST-INV-DTE             06020000
060300             MOVE PV-FST-INV-CCYY TO PV-FST-INV-CCYY-X            06030000
060400             MOVE PV-FST-INV-MM   TO PV-FST-INV-MM-X              06040000
060500             MOVE PV-FST-INV-DD   TO PV-FST-INV-DD-X              06050000
060600             MOVE '-'             TO PV-DASH1-X                   06060000
060700                                     PV-DASH2-X                   06070000
060800         END-IF                                                   06080000
060900         PERFORM X100-OPEN-CHARGE-CODE-CSR                        06090000
061000         SET PS-MORE-ALW-CHARGES TO TRUE                          06100000
061100         PERFORM R200-FETCH-ALW-CHRG                              06110000
061200         PERFORM E100-CREATE-AP063-RECORD                         06120000
061300             UNTIL PS-END-ALW-CHARGES                             06130000
061400         PERFORM Y100-CLOSE-CHARGE-CODE-CSR                       06140000
061500         ADD AP060-GROSS-COST-AMT  TO PV-INV-TOT-COST-AMT         06150000
061600                                      PV-INV-1ST-COST-AMT         06160000
061700         ADD AP060-TOT-INVOICE-QTY TO PV-INV-UNT-QTY              06170000
061800         ADD AP060-NET-COST-AMT    TO PV-INV-NET-COST-AMT         06180000
061900         MOVE AP060-PO-NBR         TO MDINVC-PO-NBR               06190000
062000         MOVE AP060-INVOICE-NUMBER TO MDINVC-INVC-ID              06200000
062100         PERFORM S100-GET-MERCHANDISE-INVOICE                     06210000
062200         MOVE MDINVC-IMPRT-CHRG-PRC-CDE TO PV-ALW-CHRG-CDE        06220000
062300         PERFORM S200-SELECT-ACCTYP                               06230000
062400         PERFORM E100-CREATE-AP063-RECORD                         06240000
062500     END-IF.                                                      06250000
062600                                                                  06260000
062700     IF  AP060-EXPENSE-INVOICE                                    06270000
062800         IF  (PS-EXPENSE-INVOICES-ONLY)                           06280000
062900         AND (PV-FIRST-INV-DTE = ZEROS                            06290000
063000              OR PV-FIRST-INV-DTE > PV-INVOICE-DTE)               06300000
063100            MOVE PV-INVOICE-DTE  TO PV-FIRST-INV-DTE              06310000
063200            MOVE PV-FST-INV-CCYY TO PV-FST-INV-CCYY-X             06320000
063300            MOVE PV-FST-INV-MM   TO PV-FST-INV-MM-X               06330000
063400            MOVE PV-FST-INV-DD   TO PV-FST-INV-DD-X               06340000
063500            MOVE '-'             TO PV-DASH1-X                    06350000
063600                                    PV-DASH2-X                    06360000
063700         END-IF                                                   06370000
063800         PERFORM X100-OPEN-CHARGE-CODE-CSR                        06380000
063900         SET PS-MORE-ALW-CHARGES TO TRUE                          06390000
064000         PERFORM R200-FETCH-ALW-CHRG                              06400000
064100         PERFORM E100-CREATE-AP063-RECORD                         06410000
064200             UNTIL PS-END-ALW-CHARGES                             06420000
064300         PERFORM Y100-CLOSE-CHARGE-CODE-CSR                       06430000
064400     END-IF.                                                      06440000
064500                                                                  06450000
064600     PERFORM R100-READ-EXTRACT-FILE.                              06460000
064700                                                                  06470000
064800 EJECT                                                            06480000
064900*---------------------------------------------------------------- 06490000
065000*    END OF PROGRAM                                               06500000
065100*---------------------------------------------------------------- 06510000
065200 B300-END-OF-PROGRAM.                                             06520000
065300                                                                  06530000
065400     PERFORM C100-PO-NBR-BREAK.                                   06540000
065500                                                                  06550000
065600     DISPLAY 'NBR OF IMPORT-EXTRACT-RECORDS = ' PV-IMP-EXT-COUNT. 06560000
065700     DISPLAY 'NBR OF AP062 RECS CREATED     = ' PV-AP062-COUNT.   06570000
065800     DISPLAY 'NBR OF AP063 RECS CREATED     = ' PV-AP063-COUNT.   06580000
065900     DISPLAY 'NBR OF AP064 RECS CREATED     = ' PV-AP064-COUNT.   06590000
066000     DISPLAY 'NBR OF AP035 RECS CREATED     = ' PV-AP035-COUNT.   06600000
066100                                                                  06610000
066200     CLOSE INVOICE-EXTRACT-FILE                                   06620000
066300           INVOICE-SUMMARY-FILE                                   06630000
066400           INVOICE-CST-COMPONENT-FILE                             06640000
066500           INV-EST-CST-COMPONENT-FILE                             06650000
066600           INV-EST-LANDED-CST-ERROR-FILE.                         06660000
066700                                                                  06670000
066800 EJECT                                                            06680000
066900*---------------------------------------------------------------- 06690000
067000*   PURCHASE ORDER NUMBER BREAK                                   06700000
067100*     FETCH ESTIMATE COST FOR PO                                  06710000
067200*     IF NO ROWS FOUND FOR ESTIMATE COST AP035 RECORD CREATED     06720000
067300*     SELECT PO TOTALS                                            06730000
067400*     CREATE AP062 RECORD                                         06740000
067500*---------------------------------------------------------------- 06750000
067600 C100-PO-NBR-BREAK.                                               06760000
067700                                                                  06770000
067800     MOVE 'C100-PO-NBR-BREAK' TO  PV-CURRENT-PARAGRAPH.           06780000
067900                                                                  06790000
068000     MOVE PV-PREV-PO-NBR TO PV-PO-NBR.                            06800000
068100     SET PS-MORE-ELC TO TRUE.                                     06810000
068200     PERFORM X200-OPEN-ELC-CSR.                                   06820000
068300     PERFORM R300-FETCH-ELC.                                      06830000
068400                                                                  06840000
068500     IF PS-END-ELC                                                06850000
068600         PERFORM E200-CREATE-AP035-RECORD                         06860000
068700     END-IF.                                                      06870000
068800                                                                  06880000
068900     PERFORM E400-CREATE-AP064-RECORD                             06890000
069000         UNTIL PS-END-ELC.                                        06900000
069100                                                                  06910000
069200     PERFORM Y200-CLOSE-ELC-CSR.                                  06920000
069300                                                                  06930000
069400     PERFORM S300-SELECT-PO-TOTALS.                               06940000
069500     PERFORM E300-CREATE-AP062-RECORD.                            06950000
069510                                                                  06951000
069600*----------------------------------------------------------------*06960000
069610* FIRST COST LOAD RECORDS NEED TO BE CREATED FOR LI & FUNG POS   *06961000
069611* AND FOR PRIVATE LABEL POS                                      *06961100
069612*----------------------------------------------------------------*06961200
069613     IF  PV-VENDOR-NBR-LIFUNG                                     06961300
069614     OR  PURCHS-DERVD-LBL-TYP-CDE = 'P'                           06961400
069615     OR  PURCHS-DERVD-LBL-TYP-CDE = 'E'                           06961508
069616         MOVE PURCHS-DEPT-NBR        TO WS-DEPT-NBR               06961608
069617                                                                  06961708
069618         IF NOT WS-CHARITY-DEPT                                   06961808
069700            PERFORM E150-CREATE-AP063-FCL-RECORD                  06970000
069710         END-IF                                                   06971000
069800     END-IF.                                                      06980000
069900                                                                  06990000
070000     MOVE AP060-PO-NBR        TO PV-PREV-PO-NBR                   07000000
070100                                 ALCHRG-PO-NBR.                   07010000
070200     MOVE AP060-VENDOR-NUMBER TO PV-PREV-VENDOR-NBR.              07020000
070300     MOVE AP060-VENDOR-NAME   TO PV-PREV-VENDOR-NAME.             07030000
070400     SET PS-FIRST-INVOICE     TO TRUE.                            07040000
070500     SET PS-MIXED-INVOICES    TO TRUE.                            07050000
070600     INITIALIZE PV-INV-1ST-COST-AMT                               07060000
070800                PV-INV-TOT-COST-AMT                               07080000
070900                PV-INV-UNT-QTY                                    07090000
071000                PV-EST-1ST-COST-AMT                               07100000
071100                PV-EST-TOT-COST-AMT                               07110000
071200                PV-EST-UNT-QTY                                    07120000
071300                PV-PO-1ST-COST-AMT                                07130000
071400                PV-PO-TOT-COST-AMT                                07140000
071500                PV-PO-UNT-QTY                                     07150000
071600                PV-FIRST-INV-DTE                                  07160000
071800                PV-INV-NET-COST-AMT.                              07180000
071900                                                                  07190000
072000 EJECT                                                            07200000
072100*---------------------------------------------------------------- 07210000
072200*   CREATES AP063 INVOICE COST COMPONENT RECORD                   07220000
072300*---------------------------------------------------------------- 07230000
072400 E100-CREATE-AP063-RECORD.                                        07240000
072500                                                                  07250000
072600     MOVE 'E100-CREATE-AP063-RECORD'   TO PV-CURRENT-PARAGRAPH.   07260000
072700                                                                  07270000
072800     INITIALIZE AP063-RECORD.                                     07280000
072900     MOVE AP060-VENDOR-NAME      TO AP063-VENDOR-NAME.            07290000
073000     MOVE AP060-VENDOR-NUMBER    TO AP063-VENDOR-NBR.             07300000
073100     MOVE AP060-PO-NBR           TO AP063-PO-NBR.                 07310000
073200     MOVE AP060-INVOICE-NUMBER   TO AP063-INVC-ID.                07320000
073300     IF  AP060-MERCHANDISE-INVOICE                                07330000
073400         IF PS-MORE-ALW-CHARGES                                   07340000
073500            MOVE ALCHRG-ALW-CHRG-CDE    TO AP063-ALW-CHRG-CDE     07350000
073600            MOVE ALCHRG-ALW-CHRG-AMT    TO AP063-INV-CHRG-AMT     07360000
073700            ADD  ALCHRG-ALW-CHRG-AMT    TO PV-TOT-CHRG-AMT        07370000
073800*** ALW-CHRG-AMT IS NOT ADDED TO PV-INV-TOT-COST-AMT FOR          07380000
073900*** MERCHANDISE INVOICES B/C IT'S ALREADY ADDED IN BEFORE THIS.   07390000
074000*** TOTAL CHARGES ARE BACKED OUT FOR MERCHANDISE INVOICES BELOW   07400000
074100*** BECAUSE THEY HAVE THEIR OWN AP063 RECORD.                     07410000
074200         ELSE                                                     07420000
074300            MOVE MDINVC-IMPRT-CHRG-PRC-CDE TO AP063-ALW-CHRG-CDE  07430000
074320            COMPUTE AP063-INV-CHRG-AMT =                          07432000
074330                        AP060-NET-COST-AMT - PV-TOT-CHRG-AMT      07433000
074700            INITIALIZE PV-TOT-CHRG-AMT                            07470000
075100         END-IF                                                   07510000
075200     ELSE                                                         07520000
075300         IF AP060-EXPENSE-INVOICE                                 07530000
075400            MOVE ALCHRG-ALW-CHRG-CDE     TO AP063-ALW-CHRG-CDE    07540000
075500            MOVE ALCHRG-ALW-CHRG-AMT     TO AP063-INV-CHRG-AMT    07550000
075600            ADD ALCHRG-ALW-CHRG-AMT      TO PV-INV-TOT-COST-AMT   07560000
075700         END-IF                                                   07570000
075800     END-IF.                                                      07580000
075900     MOVE AP060-INVOICE-DATE     TO AP063-INVC-DTE.               07590000
076000     MOVE ACCTYP-INCL-IN-ALC-IND TO AP063-INCL-IN-ALC-IND.        07600000
076100     MOVE AP060-ENTRY-DATE       TO AP063-ENTR-DTE.               07610000
076200     MOVE ACCTYP-GL-ACCT-NBR     TO AP063-GL-ACCT-NBR.            07620000
076300     PERFORM W100-WRITE-AP063-RECORD.                             07630000
076400     IF PS-MORE-ALW-CHARGES                                       07640000
076500         PERFORM R200-FETCH-ALW-CHRG                              07650000
076600     END-IF.                                                      07660000
076700                                                                  07670000
076800 EJECT                                                            07680000
076900 E150-CREATE-AP063-FCL-RECORD.                                    07690000
077000*---------------------------------------------------------------- 07700000
077100*   CREATES AP063 'FCL' COST COMPONENT RECORD                     07710000
077200*---------------------------------------------------------------- 07720000
077300                                                                  07730000
077400     MOVE 'E150-CREATE-AP063-FCL-RECORD'                          07740000
077500                                 TO PV-CURRENT-PARAGRAPH.         07750000
077600                                                                  07760000
077700     INITIALIZE AP063-RECORD.                                     07770000
077800     COMPUTE PV-INV-CHRG-AMT =                                    07780000
077900       ( PV-INV-1ST-COST-AMT * AP062-1ST-COST-LOAD-PCT ) + .005   07790000
078000     MOVE PV-INV-CHRG-AMT        TO AP063-INV-CHRG-AMT.           07800000
078100     MOVE PV-PREV-VENDOR-NAME    TO AP063-VENDOR-NAME.            07810000
078200     MOVE PV-PREV-VENDOR-NBR     TO AP063-VENDOR-NBR.             07820000
078300     MOVE PV-PREV-PO-NBR         TO AP063-PO-NBR.                 07830000
078400     MOVE 'FCL'                  TO AP063-ALW-CHRG-CDE.           07840000
078500     MOVE 'N'                    TO AP063-INCL-IN-ALC-IND.        07850000
078600                                                                  07860000
078700     MOVE SPACES                 TO AP063-INVC-ID                 07870000
078800                                    AP063-ENTR-DTE.               07880000
078900                                                                  07890000
078910     MOVE PV-INVOICE-DTE         TO PV-FIRST-INV-DTE.             07891000
078920     MOVE PV-FST-INV-CCYY        TO PV-FST-INV-CCYY-X.            07892000
078930     MOVE PV-FST-INV-MM          TO PV-FST-INV-MM-X.              07893000
078940     MOVE PV-FST-INV-DD          TO PV-FST-INV-DD-X.              07894000
078950     MOVE '-'                    TO PV-DASH1-X                    07895000
078960                                    PV-DASH2-X.                   07896000
078970     MOVE PV-FIRST-INV-DTE-X     TO AP063-INVC-DTE.               07897000
079000                                                                  07900000
079100     MOVE SPACES                 TO AP063-GL-ACCT-NBR.            07910000
079200     PERFORM W100-WRITE-AP063-RECORD.                             07920000
079300                                                                  07930000
079400*---------------------------------------------------------------- 07940000
079500*   CREATES AP035 ESTIMATE LANDED COST ERROR RECORD               07950000
079600*---------------------------------------------------------------- 07960000
079700 E200-CREATE-AP035-RECORD.                                        07970000
079800                                                                  07980000
079900     MOVE 'E200-CREATE-AP035-RECORD'   TO PV-CURRENT-PARAGRAPH.   07990000
080000                                                                  08000000
080100     INITIALIZE AP035-RECORD.                                     08010000
080200     MOVE PV-PREV-VENDOR-NAME    TO AP035-VENDOR-NAME.            08020000
080300     MOVE PV-PREV-PO-NBR         TO AP035-PO-NBR.                 08030000
080400     SET AP035-NO-ELC-FOR-PO     TO TRUE.                         08040000
080500     PERFORM W200-WRITE-AP035-RECORD.                             08050000
080600                                                                  08060000
080700 EJECT                                                            08070000
080800*----------------------------------------------------------------*08080000
080900*  CREATES AP062 INVOICE SUMMARY RECORD                          *08090000
080901*                                                                *08090100
080910*  SPECIAL LOGIC DETERMINES WHAT, IF ANY, FIRST COST LOAD IS TO  *08091000
080920*  BE APPLIED.  THE APPROPRIATE PERCENT IS MOVED AND A FLAG IS   *08092000
080930*  SET TO INDICATE WHICH LOAD TYPE IS BEING PROCESSED.           *08093000
081000*----------------------------------------------------------------*08100000
081100 E300-CREATE-AP062-RECORD.                                        08110000
081200                                                                  08120000
081300     MOVE 'E300-CREATE-AP062-RECORD'   TO PV-CURRENT-PARAGRAPH.   08130000
081400                                                                  08140000
081500     INITIALIZE AP062-RECORD.                                     08150000
081600     MOVE PV-PREV-VENDOR-NAME    TO AP062-VENDOR-NAME.            08160000
081700     MOVE PV-PREV-VENDOR-NBR     TO AP062-VENDOR-NBR.             08170000
081800     MOVE PV-PREV-PO-NBR         TO AP062-PO-NBR.                 08180000
081900                                                                  08190000
082000     PERFORM S500-SELECT-OTB-PER.                                 08200000
082100                                                                  08210000
082200     MOVE PURCHS-DEPT-NBR        TO WS-DEPT-NBR.                  08220000
082300                                                                  08230000
082310     PERFORM S700-GET-PO-INSTRUCTIONS.                            08231002
082320                                                                  08232002
082400     IF WS-CHARITY-DEPT                                           08240000
082501        MOVE ZERO TO AP062-1ST-COST-LOAD-PCT                      08250107
082510     ELSE                                                         08251000
082511         IF  PURCHS-OTB-PER-NBR > '202201'                        08251107
082512         OR  PS-SP22-PO                                           08251207
082513             IF PV-VENDOR-NBR-LIFUNG                              08251307
082514             OR PURCHS-DERVD-LBL-TYP-CDE = 'P'                    08251407
082515             OR PURCHS-DERVD-LBL-TYP-CDE = 'E'                    08251507
082516                MOVE PV-UNIFORM-PCT TO AP062-1ST-COST-LOAD-PCT    08251607
082517             ELSE                                                 08251707
082518                MOVE ZERO TO AP062-1ST-COST-LOAD-PCT              08251807
082519             END-IF                                               08251907
082520         ELSE                                                     08252007
082530             IF PV-VENDOR-NBR-LIFUNG                              08253007
082552                MOVE PV-LIFUNG-PCT TO AP062-1ST-COST-LOAD-PCT     08255207
082560             ELSE                                                 08256007
082570                IF PURCHS-DERVD-LBL-TYP-CDE = 'P'                 08257007
082580                OR PURCHS-DERVD-LBL-TYP-CDE = 'E'                 08258009
082596                   MOVE PV-BRAND-PCT TO AP062-1ST-COST-LOAD-PCT   08259607
082598                ELSE                                              08259807
082600                   MOVE ZERO TO AP062-1ST-COST-LOAD-PCT           08260007
082604                END-IF                                            08260407
082609             END-IF                                               08260907
082614         END-IF                                                   08261407
082615     END-IF.                                                      08261507
082616                                                                  08261607
082617     IF  AP062-1ST-COST-LOAD-PCT = ZERO                           08261707
082618         SET AP062-NO-LOAD-TO-APPLY TO TRUE                       08261807
082619     ELSE                                                         08261907
082622         IF  PV-VENDOR-NBR-LIFUNG                                 08262207
082623             SET AP062-LIFUNG-LOAD TO TRUE                        08262307
082624         ELSE                                                     08262407
082625             SET AP062-PRIVATE-LABEL-LOAD TO TRUE                 08262507
082626         END-IF                                                   08262607
082627     END-IF.                                                      08262707
082630                                                                  08263000
082700     STRING PV-FST-INV-CCYY         DELIMITED BY SIZE             08270000
082800            PC-DASH                 DELIMITED BY SIZE             08280000
082900            PV-FST-INV-MM           DELIMITED BY SIZE             08290000
083000            PC-DASH                 DELIMITED BY SIZE             08300000
083100            PV-FST-INV-DD           DELIMITED BY SIZE             08310000
083200                                INTO AP062-FIRST-INVC-DTE         08320000
083300     END-STRING.                                                  08330000
083400     MOVE PV-INV-1ST-COST-AMT    TO AP062-INV-1ST-COST-AMT.       08340000
083500     MOVE PV-INV-TOT-COST-AMT    TO AP062-INV-TOT-COST-AMT.       08350000
083600     MOVE PV-INV-UNT-QTY         TO AP062-INV-UNT-QTY.            08360000
083700     MOVE PV-EST-1ST-COST-AMT    TO AP062-EST-1ST-COST-AMT.       08370000
083800     MOVE PV-EST-TOT-COST-AMT    TO AP062-EST-TOT-COST-AMT.       08380000
083900     MOVE PV-EST-UNT-QTY         TO AP062-EST-UNT-QTY.            08390000
084000     MOVE PV-PO-1ST-COST-AMT     TO AP062-PO-1ST-COST-AMT.        08400000
084100     MOVE PV-PO-TOT-COST-AMT     TO AP062-PO-TOT-COST-AMT.        08410000
084200     MOVE PV-PO-UNT-QTY          TO AP062-PO-UNT-QTY.             08420000
084300     MOVE PV-INV-NET-COST-AMT    TO AP062-INV-NET-COST-AMT.       08430000
084400     PERFORM W300-WRITE-AP062-RECORD.                             08440000
084500                                                                  08450000
084600 EJECT                                                            08460000
084780*---------------------------------------------------------------- 08478000
084800*   CREATES AP064 ESTIMATE COST COMPONENT RECORD                  08480000
084900*---------------------------------------------------------------- 08490000
085000 E400-CREATE-AP064-RECORD.                                        08500000
085100                                                                  08510000
085200     MOVE 'E400-CREATE-AP064-RECORD'   TO PV-CURRENT-PARAGRAPH.   08520000
085300     MOVE VSCPT-ALW-CHRG-CDE TO PV-ALW-CHRG-CDE.                  08530000
085400     PERFORM S200-SELECT-ACCTYP.                                  08540000
085500                                                                  08550000
085600     INITIALIZE AP064-RECORD.                                     08560000
085700     MOVE PV-PREV-PO-NBR         TO AP064-PO-NBR.                 08570000
085800     MOVE VSCPT-ALW-CHRG-CDE     TO AP064-ALW-CHRG-CDE.           08580000
085900     MOVE ACCTYP-INCL-IN-ALC-IND TO AP064-INCL-IN-ALC-IND.        08590000
086000     MOVE PV-VSCPT-UNT-COST      TO AP064-EST-COST-AMT.           08600000
086100     MOVE PV-VSCPT-UNT-QTY       TO AP064-EST-UNT-QTY.            08610000
086200     PERFORM W400-WRITE-AP064-RECORD.                             08620000
086300     MOVE PV-VSCPT-UNT-QTY       TO PV-EST-UNT-QTY.               08630000
086400     ADD PV-VSCPT-UNT-COST       TO PV-EST-TOT-COST-AMT.          08640000
086500     MOVE VSCPT-ALW-CHRG-CDE     TO PV-VALID-COST-CODES.          08650000
086600     IF PV-VALID-1ST-COST                                         08660000
086700         ADD PV-VSCPT-UNT-COST   TO PV-EST-1ST-COST-AMT           08670000
086800     END-IF.                                                      08680000
086900                                                                  08690000
087000     PERFORM R300-FETCH-ELC.                                      08700000
087100                                                                  08710000
087200 EJECT                                                            08720000
088910*---------------------------------------------------------------- 08891000
088920*    READ THE INVOICE-EXTRACT-FILE INTO COPYBOOK APRD060          08892000
088930*---------------------------------------------------------------- 08893000
088940 R100-READ-EXTRACT-FILE.                                          08894000
088950                                                                  08895000
088960     MOVE 'R100-READ-EXTRACT-FILE' TO                             08896000
088970                             PV-CURRENT-PARAGRAPH.                08897000
088980                                                                  08898000
088990     READ INVOICE-EXTRACT-FILE INTO AP060-INVOICE-EXTRACT         08899000
088991         AT END                                                   08899100
088992             SET PS-END-EXTRACT TO TRUE.                          08899200
088993                                                                  08899300
088994     IF PS-MORE-EXTRACT                                           08899400
088995         ADD 1 TO PV-IMP-EXT-COUNT                                08899500
088996     END-IF.                                                      08899600
088997                                                                  08899700
088998 EJECT                                                            08899800
089000*---------------------------------------------------------------- 08900000
089100*    RETRIEVES THE CHARGES AND CORRESPONDING ACCOUNT NUMBERS      08910000
089200*    FROM THE TALCHRG AND TACCTYP TABLES.                         08920000
089300*---------------------------------------------------------------- 08930000
089400 R200-FETCH-ALW-CHRG.                                             08940000
089500                                                                  08950000
089600     MOVE 'R200-FETCH-ALW-CHRG' TO PV-CURRENT-PARAGRAPH.          08960000
089800                                                                  08980000
089900     EXEC SQL                                                     08990000
090000         FETCH ALW_CHRG_CSR                                       09000000
090100         INTO  :ALCHRG-ALW-CHRG-CDE                               09010000
090200             , :ALCHRG-ALW-CHRG-AMT                               09020000
090300             , :ACCTYP-INCL-IN-ALC-IND                            09030000
090400             , :ACCTYP-GL-ACCT-NBR                                09040000
090500     END-EXEC.                                                    09050000
090600                                                                  09060000
090700     EVALUATE TRUE                                                09070000
090800         WHEN SQLCODE = ZERO                                      09080000
090900             IF ALCHRG-ALW-CHRG-CDE = 'DUP'                       09090000
091000                MOVE 'DUT' TO ALCHRG-ALW-CHRG-CDE                 09100000
091100             END-IF                                               09110000
091200         WHEN SQLCODE = +100                                      09120000
091300              SET PS-END-ALW-CHARGES TO TRUE                      09130000
091400         WHEN SQLWARN0 NOT = SPACES                               09140000
091500         WHEN SQLCODE  NOT = ZERO                                 09150000
091600             MOVE AP060-PO-NBR   TO PV-DIS-PO-NBR                 09160000
091700             MOVE PV-CURRENT-PARAGRAPH TO AA-PARAGRAPH-NAME       09170000
091900             MOVE 'UNSUCCESSFUL FETCH WITH ALW_CHRG_CSR'          09190000
092100                                       TO AA-DB2-OPERATION        09210000
092200             MOVE 'TALCHRG'            TO AA-DB2-TABLE-1          09220000
092300             MOVE 'TACCTYP'            TO AA-DB2-TABLE-2          09230000
092500             PERFORM Z999-DB2-ABEND                               09250000
092600     END-EVALUATE.                                                09260000
092700                                                                  09270000
092800 EJECT                                                            09280000
092900*---------------------------------------------------------------- 09290000
093000*    RETRIEVES ALL ESTIMATE LANDED COSTS                          09300000
093100*---------------------------------------------------------------- 09310000
093200 R300-FETCH-ELC.                                                  09320000
093300                                                                  09330000
093400     MOVE 'R300-FETCH-ELC' TO PV-CURRENT-PARAGRAPH.               09340000
093500                                                                  09350000
093600     EXEC SQL                                                     09360000
093700         FETCH ELC_CSR                                            09370000
093800         INTO :PV-VSCPT-UNT-QTY                                   09380000
093900             ,:PV-VSCPT-UNT-COST                                  09390000
094000             ,:VSCPT-ALW-CHRG-CDE                                 09400000
094100     END-EXEC.                                                    09410000
094200                                                                  09420000
094300     EVALUATE TRUE                                                09430000
094400         WHEN SQLCODE = ZERO                                      09440000
094500              CONTINUE                                            09450000
094600                                                                  09460000
094700         WHEN SQLCODE = +100                                      09470000
094800              SET PS-END-ELC TO TRUE                              09480000
094900                                                                  09490000
095000         WHEN SQLWARN0 NOT = SPACES                               09500000
095100         WHEN SQLCODE  NOT = ZERO                                 09510000
095200             MOVE AP060-PO-NBR   TO PV-DIS-PO-NBR                 09520000
095300             MOVE PV-CURRENT-PARAGRAPH TO AA-PARAGRAPH-NAME       09530000
095500             MOVE 'BAD FETCH WITH ELC_CSR' TO AA-DB2-OPERATION    09550000
095700             MOVE 'TPURITM'     TO AA-DB2-TABLE-1                 09570000
095800             MOVE 'TVSCPT'      TO AA-DB2-TABLE-2                 09580000
095900             PERFORM Z999-DB2-ABEND                               09590000
096000     END-EVALUATE.                                                09600000
096100                                                                  09610000
096200 EJECT                                                            09620000
096300*---------------------------------------------------------------- 09630000
096400*   SELECTS MERCHANDISE INVOICE CHARGE PRICE CODE FROM TMDINVC    09640000
096500*---------------------------------------------------------------- 09650000
096600 S100-GET-MERCHANDISE-INVOICE.                                    09660000
096700                                                                  09670000
096800     MOVE 'S100-GET-MERCHANDISE-INVOICE' TO PV-CURRENT-PARAGRAPH. 09680000
097000                                                                  09700000
097100     EXEC SQL                                                     09710000
097200         SELECT IMPRT_CHRG_PRC_CDE                                09720000
097400           INTO :MDINVC-IMPRT-CHRG-PRC-CDE                        09740000
097600           FROM TMDINVC                                           09760000
097700          WHERE PO_NBR  = :MDINVC-PO-NBR                          09770000
097800            AND INVC_ID = :MDINVC-INVC-ID                         09780000
097900     END-EXEC.                                                    09790000
098000                                                                  09800000
098100     EVALUATE TRUE                                                09810000
098200         WHEN SQLCODE = ZERO                                      09820000
098300            CONTINUE                                              09830000
098400                                                                  09840000
098500         WHEN SQLCODE = +100                                      09850000
098600         WHEN SQLWARN0 NOT = SPACES                               09860000
098700         WHEN SQLCODE  NOT = ZERO                                 09870000
098800             MOVE AP060-PO-NBR   TO PV-DIS-PO-NBR                 09880000
098900             DISPLAY 'INVOICE ID = ' MDINVC-INVC-ID               09890000
099000             MOVE PV-CURRENT-PARAGRAPH TO AA-PARAGRAPH-NAME       09900000
099200             MOVE 'UNSUCCESSFUL SELECT FOR MERCH INVOICE'         09920000
099300                                 TO AA-DB2-OPERATION              09930000
099400             MOVE 'TMDINVC'      TO AA-DB2-TABLE-1                09940000
099700             PERFORM Z999-DB2-ABEND                               09970000
099800     END-EVALUATE.                                                09980000
099900                                                                  09990000
100000 EJECT                                                            10000000
100100*---------------------------------------------------------------- 10010000
100200* SELECTS THE ALC-IND FROM THE ACCTYP                             10020000
100300*---------------------------------------------------------------- 10030000
100400 S200-SELECT-ACCTYP.                                              10040000
100500                                                                  10050000
100600     MOVE 'S200-SELECT-ACCTYP'   TO PV-CURRENT-PARAGRAPH.         10060000
100700                                                                  10070000
100800     EXEC SQL                                                     10080000
100900         SELECT INCL_IN_ALC_IND                                   10090000
101100              , GL_ACCT_NBR                                       10110000
101200           INTO                                                   10120000
101300                :ACCTYP-INCL-IN-ALC-IND                           10130000
101400              , :ACCTYP-GL-ACCT-NBR                               10140000
101500           FROM TACCTYP                                           10150000
101600          WHERE ALW_CHRG_CDE = :PV-ALW-CHRG-CDE                   10160000
101700            AND :PV-FIRST-INV-DTE-X BETWEEN EFF_STRT_DTE          10170000
101800                                        AND EFF_END_DTE           10180000
101900     END-EXEC.                                                    10190000
102000                                                                  10200000
102100     EVALUATE TRUE                                                10210000
102200         WHEN SQLCODE = ZERO                                      10220000
102300            CONTINUE                                              10230000
102400                                                                  10240000
102500         WHEN SQLCODE = +100                                      10250000
102600         WHEN SQLWARN0 NOT = SPACES                               10260000
102700         WHEN SQLCODE  NOT = ZERO                                 10270000
102800             MOVE AP060-PO-NBR   TO PV-DIS-PO-NBR                 10280000
102900             MOVE PV-CURRENT-PARAGRAPH TO AA-PARAGRAPH-NAME       10290000
103100             MOVE 'UNSUCCESSFUL SELECT FOR ACCTYP'                10310000
103200                                 TO AA-DB2-OPERATION              10320000
103300             MOVE 'PV-ALW-CHRG-CDE = ' TO AA-MESS-1               10330000
103400             MOVE PV-ALW-CHRG-CDE      TO AA-MESS-2               10340000
103500             MOVE 'TACCTYP'      TO AA-DB2-TABLE-1                10350000
103800             PERFORM Z999-DB2-ABEND                               10380000
103900     END-EVALUATE.                                                10390000
104000                                                                  10400000
104200*---------------------------------------------------------------- 10420000
104300*  SELECTS THE SUM OF THE PO QTY COST-AMT AND 1ST-COST-AMT        10430000
104400*---------------------------------------------------------------- 10440000
104500 S300-SELECT-PO-TOTALS.                                           10450000
104600                                                                  10460000
104700     MOVE 'S300-SELECT-PO-TOTALS'       TO PV-CURRENT-PARAGRAPH.  10470000
104800                                                                  10480000
104900     EXEC SQL                                                     10490000
105000         SELECT SUM(UNT_QTY)                                      10500000
105200              , SUM(UNT_QTY * UNT_COST_AMT)                       10520000
105300              , SUM(UNT_QTY * PRD_1ST_COST_AMT)                   10530000
105400           INTO                                                   10540000
105500                :PV-PO-UNT-QTY      :PV-NULL-IND                  10550000
105600              , :PV-PO-TOT-COST-AMT :PV-NULL-IND                  10560000
105700              , :PV-PO-1ST-COST-AMT :PV-NULL-IND                  10570000
105800           FROM TPURITM                                           10580000
105900          WHERE PO_NBR          = :PV-PO-NBR                      10590000
106000            AND VER_STATUS_CDE  = 'A'                             10600000
106100            AND STATUS_CDE      IN ('AC','AP','CB','CM','RV')     10610000
106200     END-EXEC.                                                    10620000
106300                                                                  10630000
106400     EVALUATE TRUE                                                10640000
106500           WHEN SQLCODE = ZERO                                    10650000
106600           WHEN SQLCODE = +100                                    10660000
106700           WHEN SQLCODE = -305                                    10670000
106800                     CONTINUE                                     10680000
106900           WHEN SQLWARN0 NOT = SPACES                             10690000
107000           WHEN SQLCODE  NOT = ZERO                               10700000
107100               MOVE PV-PO-NBR    TO PV-DIS-PO-NBR                 10710000
107200               MOVE PV-CURRENT-PARAGRAPH   TO AA-PARAGRAPH-NAME   10720000
107400               MOVE 'UNSUCCESSFUL SELECT ' TO AA-DB2-OPERATION    10740000
107600               MOVE 'TPURITM'              TO AA-DB2-TABLE-1      10760000
107900               PERFORM Z999-DB2-ABEND                             10790000
108000     END-EVALUATE.                                                10800000
108100                                                                  10810000
108200*----------------------------------------------------------------*10820000
108300*  RETRIEVES OTB PERIOD,DEPT AND BRAND TYP FOR PO BEING PROCESSED.10830000
108400*----------------------------------------------------------------*10840000
108500 S500-SELECT-OTB-PER.                                             10850000
108600                                                                  10860000
108700     EXEC SQL                                                     10870000
108800         SELECT OTB_PER_NBR                                       10880000
108810              , DEPT_NBR                                          10881000
108820              , DERVD_LBL_TYP_CDE                                 10882000
108900           INTO :PURCHS-OTB-PER-NBR                               10890000
108910              , :PURCHS-DEPT-NBR                                  10891000
108920              , :PURCHS-DERVD-LBL-TYP-CDE                         10892000
109000           FROM TPURCHS                                           10900000
109100          WHERE PO_NBR         = :PV-PO-NBR                       10910000
109200            AND VER_STATUS_CDE = 'A'                              10920000
109300     END-EXEC.                                                    10930000
109400                                                                  10940000
109500     EVALUATE TRUE                                                10950000
109600         WHEN SQLCODE = ZERO                                      10960000
109700             CONTINUE                                             10970000
110200         WHEN SQLWARN0 NOT = SPACES                               11020000
110300         WHEN SQLCODE  NOT = ZERO                                 11030000
110400             MOVE PV-PO-NBR      TO PV-DIS-PO-NBR                 11040000
110500             MOVE 'S500-SELECT-OTB-PER ' TO AA-PARAGRAPH-NAME     11050000
110700             MOVE 'UNSUCCESSFUL SELECT'  TO AA-DB2-OPERATION      11070000
110900             MOVE 'TPURCHS'              TO AA-DB2-TABLE-1        11090000
111300             PERFORM Z999-DB2-ABEND                               11130000
111400     END-EVALUATE.                                                11140000
111624*---------------------------------------------------------------- 11162400
111625*    SELECT PRIVATE LABEL LOAD PERCENT FROM XMT00022.             11162500
111626*---------------------------------------------------------------- 11162600
111627 S700-GET-PO-INSTRUCTIONS.                                        11162702
111628                                                                  11162800
111629     MOVE 'S700-GET-PO-INSTRUCTIONS' TO PV-CURRENT-PARAGRAPH.     11162902
111630                                                                  11163002
111631     SET PS-NOT-SP22-PO TO TRUE.                                  11163105
111632                                                                  11163200
111633     EXEC SQL                                                     11163300
111634          SELECT B.INSTR_DESC                                     11163402
111635           INTO  :INSTCD-INSTR-DESC                               11163505
111636            FROM TPOINST A                                        11163602
111637               , TINSTCD B                                        11163702
111638          WHERE A.PO_NBR = :PV-PO-NBR                             11163808
111639            AND A.RECIP_CDE IN ('AP', 'VN')                       11163902
111640            AND B.INSTR_DESC = 'SP22'                             11164012
111641            AND A.INSTR_NBR = B.INSTR_NBR                         11164112
111642     END-EXEC.                                                    11164212
111650                                                                  11165000
111653     EVALUATE TRUE                                                11165300
111654       WHEN SQLCODE = ZERO                                        11165400
111655       WHEN SQLCODE = -811                                        11165512
111656**   MOVE PV-PO-NBR      TO PV-DIS-PO-NBR                         11165612
111657**   DISPLAY 'PO = ' PV-DIS-PO-NBR  ', INST = ' INSTCD-INSTR-DESC 11165712
111658            IF INSTCD-INSTR-DESC = 'SP22'                         11165812
111659               SET PS-SP22-PO        TO TRUE                      11165912
111660            END-IF                                                11166012
111661       WHEN SQLCODE = +100                                        11166112
111662            SET PS-NOT-SP22-PO TO TRUE                            11166212
111664       WHEN SQLWARN0 NOT = SPACES                                 11166412
111665       WHEN SQLCODE  NOT = ZERO                                   11166512
111666            MOVE PV-DEPT-NBR      TO PV-DIS-DEPT-NBR              11166612
111667            MOVE 'S700-GET-PRIV-LBL-LOAD-PCT' TO AA-PARAGRAPH-NAME11166712
111668            MOVE 'UNSUCCESSFUL SELECT '       TO AA-DB2-OPERATION 11166812
111669            MOVE 'XMT00022'                   TO AA-DB2-TABLE-1   11166912
111670            PERFORM Z999-DB2-ABEND                                11167012
111671     END-EVALUATE.                                                11167112
111672                                                                  11167212
111673 EJECT                                                            11167312
111674                                                                  11167412
111680*---------------------------------------------------------------- 11168000
111700*    WRITES THE AP063 RECORD                                      11170000
111800*---------------------------------------------------------------- 11180000
111900 W100-WRITE-AP063-RECORD.                                         11190000
112000                                                                  11200000
112100     MOVE 'W100-WRITE-AP063-RECORD' TO PV-CURRENT-PARAGRAPH.      11210000
112200                                                                  11220000
112300     WRITE INVOICE-CST-COMPONENT-RECORD FROM AP063-RECORD.        11230000
112400     ADD +1 TO PV-AP063-COUNT.                                    11240000
112500                                                                  11250000
112600 EJECT                                                            11260000
112700*---------------------------------------------------------------- 11270000
112800*    WRITES THE AP035 RECORD                                      11280000
112900*---------------------------------------------------------------- 11290000
113000 W200-WRITE-AP035-RECORD.                                         11300000
113100                                                                  11310000
113200     MOVE 'W200-WRITE-AP035-RECORD' TO PV-CURRENT-PARAGRAPH.      11320000
113300                                                                  11330000
113400     WRITE INV-EST-LANDED-CST-ERROR-REC FROM AP035-RECORD.        11340000
113500     ADD +1 TO PV-AP035-COUNT.                                    11350000
113600                                                                  11360000
113700 EJECT                                                            11370000
113800*---------------------------------------------------------------- 11380000
113900*    WRITES THE AP062 RECORD                                      11390000
114000*---------------------------------------------------------------- 11400000
114100 W300-WRITE-AP062-RECORD.                                         11410000
114200                                                                  11420000
114300     MOVE 'W300-WRITE-AP062-RECORD' TO PV-CURRENT-PARAGRAPH.      11430000
114400                                                                  11440000
114500     WRITE INVOICE-SUMMARY-RECORD FROM AP062-RECORD.              11450000
114600     ADD +1 TO PV-AP062-COUNT.                                    11460000
114700                                                                  11470000
114800 EJECT                                                            11480000
114900*---------------------------------------------------------------- 11490000
115000*    WRITES THE AP064 RECORD                                      11500000
115100*---------------------------------------------------------------- 11510000
115200 W400-WRITE-AP064-RECORD.                                         11520000
115300                                                                  11530000
115400     MOVE 'W400-WRITE-AP064-RECORD' TO PV-CURRENT-PARAGRAPH.      11540000
115500                                                                  11550000
115600     WRITE INV-EST-CST-COMPONENT-RECORD FROM AP064-RECORD.        11560000
115700     ADD +1 TO PV-AP064-COUNT.                                    11570000
115800                                                                  11580000
115900 EJECT                                                            11590000
116000*---------------------------------------------------------------- 11600000
116100*    OPENS THE CHARGE CODE CURSOR.                                11610000
116200*---------------------------------------------------------------- 11620000
116300 X100-OPEN-CHARGE-CODE-CSR.                                       11630000
116400                                                                  11640000
116500     MOVE 'X100-OPEN-CHARGE-CODE-CSR' TO PV-CURRENT-PARAGRAPH.    11650000
116600                                                                  11660000
116700     EXEC SQL                                                     11670000
116800         OPEN ALW_CHRG_CSR                                        11680000
116900     END-EXEC.                                                    11690000
117000                                                                  11700000
117100     EVALUATE TRUE                                                11710000
117200         WHEN SQLCODE = ZERO                                      11720000
117300              CONTINUE                                            11730000
117400                                                                  11740000
117500         WHEN SQLWARN0 NOT = SPACES                               11750000
117600         WHEN SQLCODE  NOT = ZERO                                 11760000
117700             MOVE AP060-PO-NBR   TO PV-DIS-PO-NBR                 11770000
117800             MOVE PV-CURRENT-PARAGRAPH                            11780000
117900                                 TO AA-PARAGRAPH-NAME             11790000
118000             MOVE 'UNSUCCESSFUL OPEN ON ALW_CHRG_CSR'             11800000
118100                                 TO AA-DB2-OPERATION              11810000
118200             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                11820000
118300             MOVE 'TACCTYP'      TO AA-DB2-TABLE-2                11830000
118400             MOVE SPACES         TO AA-DB2-TABLE-3                11840000
118500             PERFORM Z999-DB2-ABEND                               11850000
118600     END-EVALUATE.                                                11860000
118700                                                                  11870000
118800 EJECT                                                            11880000
118900*---------------------------------------------------------------- 11890000
119000*    OPENS THE ESTIMATE LANDED COST CURSOR                        11900000
119100*---------------------------------------------------------------- 11910000
119200 X200-OPEN-ELC-CSR.                                               11920000
119300                                                                  11930000
119400     MOVE 'X200-OPEN-ELC-CSR '      TO PV-CURRENT-PARAGRAPH.      11940000
119500                                                                  11950000
119600     EXEC SQL                                                     11960000
119700         OPEN ELC_CSR                                             11970000
119800     END-EXEC.                                                    11980000
119900                                                                  11990000
120000     EVALUATE TRUE                                                12000000
120100         WHEN SQLCODE = ZERO                                      12010000
120200              CONTINUE                                            12020000
120300                                                                  12030000
120400         WHEN SQLWARN0 NOT = SPACES                               12040000
120500         WHEN SQLCODE  NOT = ZERO                                 12050000
120600             MOVE AP060-PO-NBR   TO PV-DIS-PO-NBR                 12060000
120700             MOVE PV-CURRENT-PARAGRAPH TO AA-PARAGRAPH-NAME       12070000
120900             MOVE 'UNSUCCESSFUL OPEN ON ELC_CSR'                  12090000
121000                                       TO AA-DB2-OPERATION        12100000
121100             MOVE 'TPURITM'            TO AA-DB2-TABLE-1          12110000
121200             MOVE 'TVSCPT'             TO AA-DB2-TABLE-2          12120000
121300             PERFORM Z999-DB2-ABEND                               12130000
121400     END-EVALUATE.                                                12140000
121500                                                                  12150000
121600 EJECT                                                            12160000
121700*---------------------------------------------------------------- 12170000
121800*    CLOSES THE CHARGE CODE CURSOR.                               12180000
121900*---------------------------------------------------------------- 12190000
122000 Y100-CLOSE-CHARGE-CODE-CSR.                                      12200000
122100                                                                  12210000
122200     MOVE 'Y100-CLOSE-CHARGE-CODE-CSR' TO PV-CURRENT-PARAGRAPH.   12220000
122300                                                                  12230000
122400     EXEC SQL                                                     12240000
122500         CLOSE ALW_CHRG_CSR                                       12250000
122600     END-EXEC.                                                    12260000
122700                                                                  12270000
122800     EVALUATE TRUE                                                12280000
122900         WHEN SQLCODE = ZERO                                      12290000
123000              CONTINUE                                            12300000
123100                                                                  12310000
123200         WHEN SQLWARN0 NOT = SPACES                               12320000
123300         WHEN SQLCODE  NOT = ZERO                                 12330000
123400             MOVE PV-CURRENT-PARAGRAPH TO AA-PARAGRAPH-NAME       12340000
123600             MOVE 'UNSUCCESSFUL CLOSE ON ALW_CHRG_CSR'            12360000
123700                                       TO AA-DB2-OPERATION        12370000
123800             MOVE 'TALCHRG'            TO AA-DB2-TABLE-1          12380000
123900             MOVE 'TACCTYP'            TO AA-DB2-TABLE-2          12390000
124100             PERFORM Z999-DB2-ABEND                               12410000
124200     END-EVALUATE.                                                12420000
124300                                                                  12430000
124400 EJECT                                                            12440000
124500*---------------------------------------------------------------- 12450000
124600*    CLOSES THE ESTIMATE LANDED COST CURSOR                       12460000
124700*---------------------------------------------------------------- 12470000
124800 Y200-CLOSE-ELC-CSR.                                              12480000
124900                                                                  12490000
125000     MOVE 'Y200-CLOSE-ELC-CSR'       TO PV-CURRENT-PARAGRAPH.     12500000
125100                                                                  12510000
125200     EXEC SQL                                                     12520000
125300         CLOSE ELC_CSR                                            12530000
125400     END-EXEC.                                                    12540000
125500                                                                  12550000
125600     EVALUATE TRUE                                                12560000
125700         WHEN SQLCODE = ZERO                                      12570000
125800              CONTINUE                                            12580000
125900                                                                  12590000
126000         WHEN SQLWARN0 NOT = SPACES                               12600000
126100         WHEN SQLCODE  NOT = ZERO                                 12610000
126200             MOVE PV-CURRENT-PARAGRAPH TO AA-PARAGRAPH-NAME       12620000
126400             MOVE 'UNSUCCESSFUL CLOSE OF ELC_CSR'                 12640000
126500                                       TO AA-DB2-OPERATION        12650000
126600             MOVE 'TPURITM'            TO AA-DB2-TABLE-1          12660000
126700             MOVE 'TVSCPT'             TO AA-DB2-TABLE-2          12670000
126800             PERFORM Z999-DB2-ABEND                               12680000
126900     END-EVALUATE.                                                12690000
127000                                                                  12700000
127100 EJECT                                                            12710000
127200*---------------------------------------------------------------- 12720000
127300*    ABEND ROUTINE FOR DB2 ERRORS                                 12730000
127400*---------------------------------------------------------------- 12740000
127500 Z999-DB2-ABEND.                                                  12750000
127600                                                                  12760000
127700     CLOSE INVOICE-EXTRACT-FILE.                                  12770000
127800     DISPLAY 'PO   BEING PROCESSED    = ' PV-DIS-PO-NBR.          12780000
127810     DISPLAY 'DEPT BEING PROCESSED    = ' PV-DIS-DEPT-NBR.        12781000
127900     DISPLAY AA-ABEND-LIT.                                        12790000
128000     DISPLAY AA-MESSAGE-LINE.                                     12800000
128100     DISPLAY AA-DB2-ERROR-LIT.                                    12810000
128200     DISPLAY AA-PROGRAM-LIT.                                      12820000
128300     DISPLAY AA-PARAGRAPH-LIT.                                    12830000
128400     DISPLAY AA-DB2-OPERATION-LIT.                                12840000
128500     DISPLAY AA-DB2-TABLE-1.                                      12850000
128600     DISPLAY AA-DB2-TABLE-2.                                      12860000
128700     DISPLAY AA-DB2-TABLE-3.                                      12870000
128800     SET AC-DB2-ERROR TO TRUE.                                    12880000
128900                                                                  12890000
129000     COPY DPPD004.                                                12900000
129100                                                                  12910000
129200     CALL 'ILBOABN0' USING ABEND-CODE.                            12920000
