       IDENTIFICATION DIVISION.                                         00010002
       PROGRAM-ID.    MLKUT406.                                         00020002
       AUTHOR.        BARBARA HULL -- COMPUWARE CORP.                   00030002
       DATE-WRITTEN.  AUGUST 11, 1998.                                  00040002
                                                                        00050002
      *---------------------------------------------------------------* 00060002
      *         MERCHANDISE LEDGER EXTRACT FOR EXCEL PC DOWNLOAD      * 00070002
      *                                                               * 00080002
      *    COPIED FROM MLKUT022.                                      * 00090002
      *                                                               * 00100002
      *    READ THE TMNDPT DB2 TABLE IN ORDER TO CREATE ONE RECORD    * 00110002
      *    FOR EACH DEPARTMENT THAT IS AVAILABLE TO THE ML SYSTEM.    * 00120002
      *                                                               * 00130002
      *    USE DB2 TABLE TMDSEAR TO VERIFY THAT THE DEPARTMENT JUST   * 00140002
      *    RETRIEVED IS AVAILABLE FOR USE.  IF SO, CREATE AN OUTPUT   * 00150002
      *    RECORD IN MICROSOFT EXCEL "CSV" FORMAT; ALL FIELDS ARE     * 00160002
      *    SEPARATED BY COMMAS.                                       * 00170002
      *                                                               * 00180002
      *    THE DB2 TABLE COLUMNS REFLECT "TO DATE" DATA.  THEREFORE,  * 00190002
      *    FOR ANY MONTH (EXCEPT THE CURRENT MONTH) THE DATA REFLECTS * 00200002
      *    AN END OF MONTH TOTAL.                                     * 00210002
      *                                                               * 00220002
      *---------------------------------------------------------------* 00230002
      *    02/08/99  PAUL KEBER - STRATAGEM     WR# 10522             * 00240033
      *    - ADDED FOLLOWING NEW FIELDS TO EXTRACT FILE: GROSS MARGIN * 00250033
      *      DOLLARS, RECEIPTS RETAIL DOLLARS, MARKON PERCENTAGE,     * 00260033
      *      CUMMULATIVE MARKON PERCENTAGE, AND PURCHASE ADJUSTMENTS  * 00270048
      *      RETAIL AMOUNT.                                           * 00280048
      *    - WRITE BUYER TOTALS AND DMM TOTALS TO THE EXTRACT FILE.   * 00290048
      *    - CORRECT THE PV-ER-BOM-COST AND PV-ER-BOM-RETAIL FIELDS.  * 00300048
      *    - CHANGE CUM-BOM-COST AND CUM-BOM-RETAIL LABELS TO         * 00310048
      *      CUM-EOM-COST AND CUM-EOM-RETAIL.                         * 00320048
      *---------------------------------------------------------------* 00330033
      *    05/24/00  AMY LAWSON                                       * 00340052
      *    - CORRECT LOGIC.  THE CUMULATIVE MARKON PERCENT WAS BEING  * 00350052
      *      CALCULATED INCORRECTLY.                                  * 00360052
      *---------------------------------------------------------------* 00370052
      *    06/05/00  AMY LAWSON                                       * 00380054
      *    - CHANGED OPEN DATE TO POSTING DATE.  WHEN TWO MONTHS ARE  * 00390054
      *      OPEN THE EXTRACT WAS CREATED FOR THE OPEN MONTH.  THE    * 00400054
      *      USERS NEED THE EXTRACT CREATED FOR THE POSTING MONTH.    * 00410054
      *---------------------------------------------------------------* 00420054
      *    04/23/01  SCOTT JACKSON  *****                               00430064
      *  CHANGE MADE: PROGRAM ABENDED WITH A 'DIVIDE BY ZERO' ERROR.    00440064
      *  CHANGED PARAGRAPHS 6300-CUM-MARKON-PCT AND 8500-CUM-MARKON-PCT 00450064
      *  TO CHECK IF DIVISOR = 0. IF SO, THEN CALCULATION OF MARKON PCT 00460064
      *  IS BYPASSED AND A '0' IS MOVED MARKUP PERCENT.                 00470064
      *---------------------------------------------------------------* 00470167
      *    06/11/01  AMY LAWSON                                         00471067
      *  CHANGE MADE: REMOVED LOGIC THAT WAS CAUSING THE                00472067
      *  PV-ER-CUM-EOM-COST AND PV-ER-CUM-EOM-RETAIL TO BE CALCULATED   00473067
      *  INCORRECTLY.   IF THE FISCAL MONTH WAS LESS THAN 7 IT WAS NOT  00474067
      *  INCLUDING THE SEASON ENDING COST OR RETAIL INTO THE CALCULATION00475067
      *    06/11/01  D THEEL  WR26603                                   00476068
      *  CHANGE MADE: INCREASED EXCEL RECORD LAYOUTS FROM 195 TO 223    00477069
      *  DUE TO INCREASES IN ALL ACCUMULATOR BUCKETS.  ADDED WITH UR    00478069
      *  TO ALL SELECTS, MODIFIED SQL TO USE DCLGEN HOST VARIABLES      00479069
      *  IN WHERE CLAUSES.                                              00479169
      *---------------------------------------------------------------* 00480064
                                                                        00490054
       ENVIRONMENT DIVISION.                                            00500002
       CONFIGURATION SECTION.                                           00510002
       SOURCE-COMPUTER. IBM-3090.                                       00520002
       OBJECT-COMPUTER. IBM-3090.                                       00530002
                                                                        00540002
       INPUT-OUTPUT SECTION.                                            00550065
       FILE-CONTROL.                                                    00560002
                                                                        00570002
           SELECT EXCEL-FILE                                            00580002
               ASSIGN TO OUT01.                                         00590002
                                                                        00600002
       DATA DIVISION.                                                   00610002
       FILE SECTION.                                                    00620002
                                                                        00630002
       FD  EXCEL-FILE                                                   00640002
           RECORDING MODE IS F.                                         00650002
                                                                        00660002
W26603 01  EXCEL-RECORD                PIC X(223).                      00670068
                                                                        00680002
       EJECT                                                            00690002
                                                                        00700000
       WORKING-STORAGE SECTION.                                         00710002
                                                                        00720002
       01  PC-PROGRAM-CONSTANTS.                                        00730002
           05  PC-MAX-BUYERS           PIC S9(4) VALUE +999 COMP.       00740037
           05  PC-MAX-DMM              PIC S9(4) VALUE +99 COMP.        00750037
W26603*    05  PC-DPT                  PIC X(03) VALUE 'DPT'.           00760069
W26603*    05  PC-ML                   PIC X(03) VALUE 'ML'.            00770069
W26603*    05  PC-COMPANY              PIC X(02) VALUE '03'.            00780069
           05  PC-01                   PIC X(02) VALUE '01'.            00790003
           05  PC-06                   PIC X(02) VALUE '06'.            00800005
           05  PC-07                   PIC X(02) VALUE '07'.            00810005
                                                                        00820002
       01  PS-PROGRAM-SWITCHES.                                         00830002
           05  PS-CONTINUE-SW          PIC X     VALUE 'Y'.             00840002
               88  PS-CONTINUE                   VALUE 'Y'.             00850002
               88  PS-DONT-PROCESS               VALUE 'N'.             00860002
           05  PS-END-OF-DATA-SW       PIC X     VALUE 'N'.             00870002
               88  PS-END-OF-DATA                VALUE 'Y'.             00880002
               88  PS-NOT-END-OF-DATA            VALUE 'N'.             00890002
                                                                        00900002
       01  PV-PROGRAM-VARIABLES.                                        00910002
           05  PV-COUNTERS.                                             00920002
               10  PV-EXCEL-WRITTEN    PIC S9(9) VALUE ZERO COMP-3.     00930002
               10  PV-C-MO-TMNDPT-FETCHED                               00940002
                                       PIC S9(9) VALUE ZERO COMP-3.     00950002
               10  PV-TMDSEAR-SELECTED PIC S9(9) VALUE ZERO COMP-3.     00960004
               10  PV-P-MO-TMNDPT-SELECTED                              00970002
                                       PIC S9(9) VALUE ZERO COMP-3.     00980002
               10  PV-P-SEA-TMNDPT-SELECTED                             00990004
                                       PIC S9(9) VALUE ZERO COMP-3.     01000002
               10  PV-C-SEA-TMNDPT-SELECTED                             01010004
                                       PIC S9(9) VALUE ZERO COMP-3.     01020004
                                                                        01030002
           05  PV-SUBSCRIPTS.                                           01040036
               10  PV-BUYER-SUB        PIC S9(4) VALUE +0 COMP.         01050036
               10  PV-DMM-SUB          PIC S9(4) VALUE +0 COMP.         01060036
                                                                        01070036
           05  PV-WORK-FIELDS.                                          01080002
               10  PV-WORK-AMOUNT.                                      01090070
                   15  FILLER          PIC X.                           01100002
                       88  PV-WA-ZERO            VALUE '0'.             01110002
                       88  PV-WA-DASH            VALUE '-'.             01120002
W26603             15  PV-WA-AMOUNT    PIC 9(11)V99.                    01130068
W26603         10  PV-COMPUTE-AMOUNT   PIC S9(11)V99 VALUE +0 COMP-3.   01140068
*****          10  PV-PURCH-COMPUTED   PIC S9(11)V99 VALUE +0 COMP-3.   01150068
W26603         10  PV-PURCHASES-COST   PIC S9(11)V99 VALUE +0 COMP-3.   01160068
W26603         10  PV-SEA-END-INV-COST PIC S9(11)V99 VALUE +0 COMP-3.   01170068
W26603         10  PV-PADJ-RETAIL      PIC S9(11)V99 VALUE +0 COMP-3.   01180068
W26603         10  PV-PURCHASES-RTL    PIC S9(11)V99 VALUE +0 COMP-3.   01190068
W26603         10  PV-SEA-END-INV-RTL  PIC S9(11)V99 VALUE +0 COMP-3.   01200068
               10  PV-BUYER-NUM        PIC  9(3)    VALUE ZERO.         01210050
               10  PV-DMM-NUM          PIC  9(2)    VALUE ZERO.         01220050
               10  PV-DMA-TTLS-DEPT.                                    01230050
                   15  FILLER          PIC X        VALUE 'A'.          01240050
                   15  PV-DMA-TTLS-DEPT-DMM                             01250050
                                       PIC 9(2)     VALUE ZERO.         01260037
                                                                        01270037
           05  PV-TMLCNTL-COLS.                                         01280002
               10  PV-PSTG-FSCL-MN-DTE PIC X(10).                       01290054
               10  PV-PSTG-FSCL-MN-NBR PIC X(2).                        01300054
                                                                        01310003
           05  PV-TDTATTR-COLS.                                         01320003
               10  PV-SEA-BEG-DTE      PIC X(10).                       01330003
               10  PV-PREV-SEA-END-DTE PIC X(10).                       01340003
               10  PV-PFM-END-DTE      PIC X(10).                       01350003
                                                                        01360002
           05  PV-CURRENT-MONTH-TMNDPT-COLS.                            01370002
               10  PV-C-MO-DEPT-NBR    PIC X(3).                        01380002
W26603         10  PV-C-MO-SLS-RTL-AMT PIC S9(11)V9(2) COMP-3.          01390068
W26603         10  PV-C-MO-MKDN-RTL-AMT                                 01400068
W26603                                 PIC S9(11)V9(2) COMP-3.          01410068
W26603         10  PV-C-MO-MKUP-RTL-AMT                                 01420068
W26603                                 PIC S9(11)V9(2) COMP-3.          01430068
W26603         10  PV-C-MO-XFER-IN-RTL-AMT                              01440068
W26603                                 PIC S9(11)V9(2) COMP-3.          01450068
W26603         10  PV-C-MO-XFER-OUT-RTL-AMT                             01460068
W26603                                 PIC S9(11)V9(2) COMP-3.          01470068
W26603         10  PV-C-MO-RCPT-RTL-AMT                                 01480068
W26603                                 PIC S9(11)V9(2) COMP-3.          01490068
W26603         10  PV-C-MO-RCPT-NET-COST-AMT                            01500068
W26603                                 PIC S9(11)V9(2) COMP-3.          01510068
W26603         10  PV-C-MO-PADJ-RTL-AMT                                 01520068
W26603                                 PIC S9(11)V9(2) COMP-3.          01530068
W26603         10  PV-C-MO-PADJ-NET-COST-AMT                            01540068
W26603                                 PIC S9(11)V9(2) COMP-3.          01550068
W26603         10  PV-C-MO-END-INV-RTL-AMT                              01560068
W26603                                 PIC S9(11)V9(2) COMP-3.          01570068
W26603         10  PV-C-MO-END-INV-COST-AMT                             01580068
W26603                                 PIC S9(11)V9(2) COMP-3.          01590068
W26603         10  PV-C-MO-SLS-COST-AMT                                 01600068
W26603                                 PIC S9(11)V9(2) COMP-3.          01610068
W26603         10  PV-C-MO-GRO-MRGN-AMT                                 01620068
W26603                                 PIC S9(11)V9(2) COMP-3.          01630068
                                                                        01640002
           05  PV-PRIOR-MONTH-TMNDPT-COLS.                              01650002
W26603         10  PV-P-MO-END-INV-RTL-AMT                              01660068
W26603                                 PIC S9(11)V9(2) COMP-3.          01670068
W26603         10  PV-P-MO-END-INV-COST-AMT                             01680068
W26603                                 PIC S9(11)V9(2) COMP-3.          01690068
                                                                        01700002
           05  PV-PRIOR-SEASON-TMNDPT-COLS.                             01710005
W26603         10  PV-P-SEA-END-INV-RTL-AMT                             01720068
W26603                                 PIC S9(11)V9(2) COMP-3.          01730068
W26603         10  PV-P-SEA-END-INV-COST-AMT                            01740068
W26603                                 PIC S9(11)V9(2) COMP-3.          01750068
                                                                        01760005
           05  PV-SEASON-TO-DATE-TMNDPT-COLS.                           01770004
W26603         10  PV-SEASON-MKUP-RTL-AMT                               01780068
W26603                                 PIC S9(11)V9(2) COMP-3.          01790068
W26603         10  PV-SEASON-XFER-IN-RTL-AMT                            01800068
W26603                                 PIC S9(11)V9(2) COMP-3.          01810068
W26603         10  PV-SEASON-XFER-OUT-RTL-AMT                           01820068
W26603                                 PIC S9(11)V9(2) COMP-3.          01830068
W26603         10  PV-SEASON-RCPT-RTL-AMT                               01840068
W26603                                 PIC S9(11)V9(2) COMP-3.          01850068
W26603         10  PV-SEASON-RCPT-NET-COST-AMT                          01860068
W26603                                 PIC S9(11)V9(2) COMP-3.          01870068
W26603         10  PV-SEASON-PADJ-RTL-AMT                               01880068
W26603                                 PIC S9(11)V9(2) COMP-3.          01890068
W26603         10  PV-SEASON-PADJ-NET-COST-AMT                          01900068
W26603                                 PIC S9(11)V9(2) COMP-3.          01910068
                                                                        01920002
       01  BUYER-TABLE.                                                 01930036
           05  BUYER-ENTRY OCCURS 999 TIMES.                            01940039
               10  BUYER-GMA           PIC X(2).                        01950036
               10  BUYER-DMA           PIC X(2).                        01960036
W26603         10  BUYER-SALES         PIC S9(11)V99 COMP-3.            01970068
W26603         10  BUYER-BOM-COST      PIC S9(11)V99 COMP-3.            01980068
W26603         10  BUYER-BOM-RETAIL    PIC S9(11)V99 COMP-3.            01990068
W26603         10  BUYER-CUM-EOM-COST  PIC S9(11)V99 COMP-3.            02000068
W26603         10  BUYER-CUM-EOM-RETAIL                                 02010068
W26603                                 PIC S9(11)V99 COMP-3.            02020068
W26603         10  BUYER-COST-OF-SALES PIC S9(11)V99 COMP-3.            02030068
W26603         10  BUYER-EOM-COST      PIC S9(11)V99 COMP-3.            02040068
W26603         10  BUYER-EOM-RETAIL    PIC S9(11)V99 COMP-3.            02050068
W26603         10  BUYER-MARKDOWNS     PIC S9(11)V99 COMP-3.            02060068
W26603         10  BUYER-GROSS-MARGIN  PIC S9(11)V99 COMP-3.            02070068
W26603         10  BUYER-RCPTS-RETAIL  PIC S9(11)V99 COMP-3.            02080068
W26603         10  BUYER-MRKN-PCT-COST PIC S9(11)V99 COMP-3.            02090068
W26603         10  BUYER-MRKN-PCT-RTL  PIC S9(11)V99 COMP-3.            02100068
W26603         10  BUYER-CUM-PCT-COST  PIC S9(11)V99 COMP-3.            02110068
W26603         10  BUYER-SEA-END-COST  PIC S9(11)V99 COMP-3.            02120068
W26603         10  BUYER-CUM-PCT-RTL   PIC S9(11)V99 COMP-3.            02130068
W26603         10  BUYER-SEA-END-RTL   PIC S9(11)V99 COMP-3.            02140068
W26603         10  BUYER-PADJ-RETAIL   PIC S9(11)V99 COMP-3.            02150068
                                                                        02160036
       01  DMM-TABLE.                                                   02170036
           05  DMM-ENTRY  OCCURS 99 TIMES.                              02180036
               10  DMM-GMA             PIC X(2).                        02190036
W26603         10  DMM-SALES           PIC S9(11)V99 COMP-3.            02200068
W26603         10  DMM-BOM-COST        PIC S9(11)V99 COMP-3.            02210068
W26603         10  DMM-BOM-RETAIL      PIC S9(11)V99 COMP-3.            02220068
W26603         10  DMM-CUM-EOM-COST    PIC S9(11)V99 COMP-3.            02230068
W26603         10  DMM-CUM-EOM-RETAIL  PIC S9(11)V99 COMP-3.            02240068
W26603         10  DMM-COST-OF-SALES   PIC S9(11)V99 COMP-3.            02250068
W26603         10  DMM-EOM-COST        PIC S9(11)V99 COMP-3.            02260068
W26603         10  DMM-EOM-RETAIL      PIC S9(11)V99 COMP-3.            02270068
W26603         10  DMM-MARKDOWNS       PIC S9(11)V99 COMP-3.            02280068
W26603         10  DMM-GROSS-MARGIN    PIC S9(11)V99 COMP-3.            02290068
W26603         10  DMM-RCPTS-RETAIL    PIC S9(11)V99 COMP-3.            02300068
W26603         10  DMM-MRKN-PCT-COST   PIC S9(11)V99 COMP-3.            02310068
W26603         10  DMM-MRKN-PCT-RTL    PIC S9(11)V99 COMP-3.            02320068
W26603         10  DMM-CUM-PCT-COST    PIC S9(11)V99 COMP-3.            02330068
W26603         10  DMM-SEA-END-COST    PIC S9(11)V99 COMP-3.            02340068
W26603         10  DMM-CUM-PCT-RTL     PIC S9(11)V99 COMP-3.            02350068
W26603         10  DMM-SEA-END-RTL     PIC S9(11)V99 COMP-3.            02360068
W26603         10  DMM-PADJ-RETAIL     PIC S9(11)V99 COMP-3.            02370068
                                                                        02380036
       01 ABEND-AREAS.                                                  02390002
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           02400002
                                                   COMP SYNC.           02410002
               88  AC-BAD-DATA                     VALUE +4003.         02420002
               88  AC-DB2-ERROR                    VALUE +4013.         02430002
           05  AA-ABEND-LIT            PIC X(40)   VALUE                02440002
                 '*****       ABEND'.                                   02450002
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                02460002
                   '*****   PROGRAM: MLKUT406'.                         02470002
           05  AA-PARAGRAPH-LIT.                                        02480002
               10  FILLER              PIC X(17)   VALUE                02490002
                   '***** PARAGRAPH: '.                                 02500002
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        02510002
           05  AA-MESSAGE-LINE.                                         02520002
               10  FILLER              PIC X(06)   VALUE '*****'.       02530002
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        02540002
           05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                02550002
                   '*****    DB2 ERROR'.                                02560002
           05  AA-DB2-OPERATION-LIT.                                    02570002
               10  FILLER              PIC X(17)   VALUE                02580002
                   '***** OPERATION: '.                                 02590002
               10  AA-DB2-OPERATION.                                    02600002
                   15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        02610002
                   15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        02620002
           05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        02630002
           05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        02640002
           05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        02650002
           05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        02660002
                                                                        02670002
       EJECT                                                            02680002
                                                                        02690002
      *    RECORD LAYOUT FOR THE OUTPUT DEPARTMENT FILE.                02700002
                                                                        02710002
       01  PV-EXCEL-RECORD.                                             02720002
           05  PV-ER-DEPARTMENT        PIC X(3)  VALUE '999'.           02730002
           05  FILLER                  PIC X     VALUE ','.             02740002
           05  PV-ER-GMA               PIC X(2)  VALUE '09'.            02750002
           05  FILLER                  PIC X     VALUE ','.             02760002
           05  PV-ER-DMA               PIC X(2)  VALUE '09'.            02770002
           05  FILLER                  PIC X     VALUE ','.             02780002
           05  PV-ER-BUYER             PIC X(3)  VALUE '099'.           02790002
           05  FILLER                  PIC X     VALUE ','.             02800002
W26603     05  PV-ER-SALES             PIC X(14) VALUE ALL '0'.         02810068
           05  FILLER                  PIC X     VALUE ','.             02820002
W26603     05  PV-ER-BOM-COST          PIC X(14) VALUE ALL '0'.         02830068
           05  FILLER                  PIC X     VALUE ','.             02840002
W26603     05  PV-ER-BOM-RETAIL        PIC X(14) VALUE ALL '0'.         02850068
           05  FILLER                  PIC X     VALUE ','.             02860002
W26603     05  PV-ER-CUM-EOM-COST      PIC X(14) VALUE ALL '0'.         02870068
           05  FILLER                  PIC X     VALUE ','.             02880002
W26603     05  PV-ER-CUM-EOM-RETAIL    PIC X(14) VALUE ALL '0'.         02890068
           05  FILLER                  PIC X     VALUE ','.             02900002
W26603     05  PV-ER-COST-OF-SALES     PIC X(14) VALUE ALL '0'.         02910068
           05  FILLER                  PIC X     VALUE ','.             02920002
W26603     05  PV-ER-EOM-COST          PIC X(14) VALUE ALL '0'.         02930068
           05  FILLER                  PIC X     VALUE ','.             02940002
W26603     05  PV-ER-EOM-RETAIL        PIC X(14) VALUE ALL '0'.         02950068
           05  FILLER                  PIC X     VALUE ','.             02960002
W26603     05  PV-ER-MARKDOWNS         PIC X(14) VALUE ALL '0'.         02970068
           05  FILLER                  PIC X     VALUE ','.             02980034
W26603     05  PV-ER-GROSS-MARGIN      PIC X(14) VALUE ALL '0'.         02990068
           05  FILLER                  PIC X     VALUE ','.             03000034
W26603     05  PV-ER-RCPTS-RETAIL      PIC X(14) VALUE ALL '0'.         03010068
           05  FILLER                  PIC X     VALUE ','.             03020034
W26603     05  PV-ER-MARKON-PCT        PIC X(14) VALUE ALL '0'.         03030068
           05  FILLER                  PIC X     VALUE ','.             03040034
W26603     05  PV-ER-CUM-MARKON-PCT    PIC X(14) VALUE ALL '0'.         03050068
           05  FILLER                  PIC X     VALUE ','.             03060048
W26603     05  PV-ER-PADJ-RETAIL       PIC X(14) VALUE ALL '0'.         03070068
                                                                        03080002
       01  PV-DUMMY-EXCEL-RECORD.                                       03090028
           05  FILLER                  PIC X(3)  VALUE '999'.           03100028
           05  FILLER                  PIC X     VALUE ','.             03110028
           05  FILLER                  PIC X(2)  VALUE '09'.            03120028
           05  FILLER                  PIC X     VALUE ','.             03130028
           05  FILLER                  PIC X(2)  VALUE '09'.            03140028
           05  FILLER                  PIC X     VALUE ','.             03150028
           05  FILLER                  PIC X(3)  VALUE '099'.           03160028
           05  FILLER                  PIC X     VALUE ','.             03170028
W26603     05  FILLER                  PIC X(14) VALUE ALL '0'.         03180068
           05  FILLER                  PIC X     VALUE ','.             03190028
W26603     05  FILLER                  PIC X(14) VALUE ALL '0'.         03200068
           05  FILLER                  PIC X     VALUE ','.             03210028
W26603     05  FILLER                  PIC X(14) VALUE ALL '0'.         03220068
           05  FILLER                  PIC X     VALUE ','.             03230028
W26603     05  FILLER                  PIC X(14) VALUE ALL '0'.         03240068
           05  FILLER                  PIC X     VALUE ','.             03250028
W26603     05  FILLER                  PIC X(14) VALUE ALL '0'.         03260068
           05  FILLER                  PIC X     VALUE ','.             03270028
W26603     05  FILLER                  PIC X(14) VALUE ALL '0'.         03280068
           05  FILLER                  PIC X     VALUE ','.             03290028
W26603     05  FILLER                  PIC X(14) VALUE ALL '0'.         03300068
           05  FILLER                  PIC X     VALUE ','.             03310028
W26603     05  FILLER                  PIC X(14) VALUE ALL '0'.         03320068
           05  FILLER                  PIC X     VALUE ','.             03330028
W26603     05  FILLER                  PIC X(14) VALUE ALL '0'.         03340068
           05  FILLER                  PIC X     VALUE ','.             03350034
W26603     05  FILLER                  PIC X(14) VALUE ALL '0'.         03360068
           05  FILLER                  PIC X     VALUE ','.             03370034
W26603     05  FILLER                  PIC X(14) VALUE ALL '0'.         03380068
           05  FILLER                  PIC X     VALUE ','.             03390034
W26603     05  FILLER                  PIC X(14) VALUE ALL '0'.         03400068
           05  FILLER                  PIC X     VALUE ','.             03410034
W26603     05  FILLER                  PIC X(14) VALUE ALL '0'.         03420068
           05  FILLER                  PIC X     VALUE ','.             03430048
W26603     05  FILLER                  PIC X(14) VALUE ALL '0'.         03440068
                                                                        03450028
           EJECT                                                        03460002
                                                                        03470002
      *---------------------------------------------------------------* 03480002
      *    DB2 TABLE DEFINITIONS                                      * 03490002
      *---------------------------------------------------------------* 03500002
                                                                        03510002
      *    MLCNTL DCLGEN                                                03520002
                                                                        03530002
           EXEC SQL                                                     03540002
               INCLUDE TMLCNTL                                          03550002
           END-EXEC.                                                    03560002
                                                                        03570002
      *    DTATTR DCLGEN                                                03580002
                                                                        03590002
           EXEC SQL                                                     03600002
               INCLUDE TDTATTR                                          03610002
           END-EXEC.                                                    03620002
                                                                        03630002
      *    MNDPT DCLGEN                                                 03640002
                                                                        03650002
           EXEC SQL                                                     03660002
               INCLUDE TMNDPT                                           03670002
           END-EXEC.                                                    03680002
                                                                        03690002
      *    MDSEAR DCLGEN                                                03700002
                                                                        03710002
           EXEC SQL                                                     03720002
               INCLUDE TMDSEAR                                          03730002
           END-EXEC.                                                    03740002
                                                                        03750002
      *    APLAVL DCLGEN                                                03760002
                                                                        03770002
           EXEC SQL                                                     03780002
               INCLUDE TAPLAVL                                          03790002
           END-EXEC.                                                    03800002
                                                                        03810002
      *    SQL COMMUNICATIONS AREA DCLGEN                               03820002
                                                                        03830002
           EXEC SQL                                                     03840002
               INCLUDE SQLCA                                            03850002
           END-EXEC.                                                    03860002
                                                                        03870002
      *    ERROR MESSAGE AREA FOR DB2                                   03880002
                                                                        03890002
           COPY DPWS004.                                                03900025
                                                                        03910002
       EJECT                                                            03920002
                                                                        03930001
      ******************************************************************03940001
      *  SQL DB2 TMNDPT CURSOR DECLARATION                              03950001
      ******************************************************************03960001
           EXEC SQL                                                     03970001
               DECLARE TMNDPT_CURSOR CURSOR FOR                         03980001
                   SELECT DEPT_NBR,                                     03990001
                          SLS_RTL_AMT,                                  04000001
                          MKDN_RTL_AMT,                                 04010001
                          MKUP_RTL_AMT,                                 04020035
                          XFER_IN_RTL_AMT,                              04030035
                          XFER_OUT_RTL_AMT,                             04040035
                          RCPT_RTL_AMT,                                 04050034
                          RCPT_NET_COST_AMT,                            04060034
                          PADJ_RTL_AMT,                                 04070035
                          PADJ_NET_COST_AMT,                            04080035
                          END_INV_RTL_AMT,                              04090001
                          END_INV_COST_AMT,                             04100001
                          SLS_COST_AMT,                                 04110044
                          GRO_MRGN_AMT                                  04120044
                   FROM TMNDPT                                          04130001
                   WHERE (FSCL_MN_NBR      = :PV-PSTG-FSCL-MN-NBR)      04140054
                     AND (FSCL_MN_END_DTE  = :PV-PSTG-FSCL-MN-DTE)      04150054
                   ORDER BY DEPT_NBR                                    04160001
               FOR FETCH ONLY                                           04170001
               WITH UR                                                  04171068
           END-EXEC.                                                    04180001
                                                                        04190001
       EJECT                                                            04200002
                                                                        04210002
      ******************************************************************04220026
       PROCEDURE DIVISION.                                              04230002
      ******************************************************************04240026
                                                                        04250002
      ******************************************************************04260000
       0000-MAINLINE-MLKUT406.                                          04270025
      ******************************************************************04280000
      *                                                                 04290002
           PERFORM 1000-INITIALIZATION.                                 04300025
                                                                        04310000
           PERFORM 2000-MAIN-PROCESS                                    04320025
               UNTIL PS-END-OF-DATA.                                    04330002
                                                                        04340000
           PERFORM 8000-EOJ.                                            04350025
                                                                        04360002
           GOBACK.                                                      04370002
                                                                        04380000
       EJECT                                                            04390002
                                                                        04400000
      ******************************************************************04410000
       1000-INITIALIZATION.                                             04420025
      ******************************************************************04430000
      *                                                                 04440001
           OPEN OUTPUT EXCEL-FILE.                                      04450001
                                                                        04460001
           PERFORM 7000-SELECT-TMLCNTL.                                 04470025
                                                                        04480001
      *--------TEST ONLY------------------------------------------------04490017
      *    MOVE '12' TO PV-PSTG-FSCL-MN-NBR.                            04500054
      *    MOVE '1999-01-30' TO PV-PSTG-FSCL-MN-DTE.                    04510054
      *-----------------------------------------------------------------04520017
           DISPLAY ' '.                                                 04530013
           DISPLAY '*** OPEN FISCAL DATES USED ARE:  '                  04540013
           DISPLAY '      MLCNTL-PSTG-FSCL-MN-DTE = '                   04550055
             PV-PSTG-FSCL-MN-DTE.                                       04560054
           DISPLAY '      MLCNTL-PSTG-FSCL-MN-NBR = '                   04570055
             PV-PSTG-FSCL-MN-NBR.                                       04580054
                                                                        04590013
           PERFORM 7100-SELECT-TDTATTR.                                 04600025
           DISPLAY ' '.                                                 04610013
           DISPLAY '*** DATE ATTRIBUTES USED ARE:  '                    04620013
           DISPLAY '      DTATTR-SEA-BEG-DTE = '                        04630013
             PV-SEA-BEG-DTE.                                            04640013
           DISPLAY '      DTATTR-PREV-SEA-END-DTE = '                   04650013
             PV-PREV-SEA-END-DTE.                                       04660013
           DISPLAY '      DTATTR-PFM-END-DTE = '                        04670013
             PV-PFM-END-DTE.                                            04680013
                                                                        04690012
           PERFORM 7200-OPEN-TMNDPT-CURSOR.                             04700025
                                                                        04710000
           INITIALIZE BUYER-TABLE                                       04720036
                      DMM-TABLE.                                        04730036
                                                                        04740036
       EJECT                                                            04750002
                                                                        04760002
      ******************************************************************04770000
       2000-MAIN-PROCESS.                                               04780025
      ******************************************************************04790000
      *                                                                 04800001
           SET PS-CONTINUE             TO TRUE.                         04810001
                                                                        04820000
           PERFORM 7210-FETCH-TMNDPT.                                   04830025
                                                                        04840000
           IF PS-CONTINUE                                               04850001
               PERFORM 2100-VALIDATE-DEPARTMENT                         04860025
               IF PS-CONTINUE                                           04870001
                   INITIALIZE PV-PRIOR-MONTH-TMNDPT-COLS                04880003
                   PERFORM 7400-SELECT-PRIOR-MTH-TMNDPT                 04890026
                   INITIALIZE PV-PRIOR-SEASON-TMNDPT-COLS               04900005
      *AML         IF PV-PSTG-FSCL-MN-NBR > PC-06                       04910054
      *AML             PERFORM 7500-SELECT-P-SEA-TMNDPT                 04920051
      *AML         END-IF                                               04930051
                   PERFORM 7500-SELECT-P-SEA-TMNDPT                     04940051
                   INITIALIZE PV-SEASON-TO-DATE-TMNDPT-COLS             04950004
                   PERFORM 7600-SELECT-SEASON-TMNDPT                    04960026
                   PERFORM 5000-CREATE-OUTPUT                           04970026
               END-IF                                                   04980001
           END-IF.                                                      04990001
                                                                        05000001
       EJECT                                                            05010001
                                                                        05020001
      ******************************************************************05030000
       2100-VALIDATE-DEPARTMENT.                                        05040025
      ******************************************************************05050000
      *                                                                 05060001
           PERFORM 7300-SELECT-TMDSEAR-TAPLAVL.                         05070026
                                                                        05080001
       EJECT                                                            05090001
                                                                        05100001
      ******************************************************************05110000
       5000-CREATE-OUTPUT.                                              05120026
      ******************************************************************05130000
      *                                                                 05140001
           MOVE PV-C-MO-DEPT-NBR       TO PV-ER-DEPARTMENT.             05150015
           MOVE MDSEAR-GMA-NBR         TO PV-ER-GMA.                    05160002
           MOVE MDSEAR-DMA-NBR         TO PV-ER-DMA                     05170036
                                          PV-DMM-SUB.                   05180036
           MOVE MDSEAR-BYR-NBR         TO PV-ER-BUYER                   05190036
                                          PV-BUYER-SUB.                 05200036
           MOVE MDSEAR-GMA-NBR         TO BUYER-GMA (PV-BUYER-SUB)      05210036
                                          DMM-GMA (PV-DMM-SUB).         05220036
           MOVE MDSEAR-DMA-NBR         TO BUYER-DMA (PV-BUYER-SUB).     05230036
                                                                        05240036
           PERFORM 5100-SALES.                                          05250026
                                                                        05260002
           PERFORM 5200-BOM-COST.                                       05270026
                                                                        05280002
           PERFORM 5300-BOM-RETAIL.                                     05290026
                                                                        05300002
           PERFORM 5400-CUM-EOM-COST.                                   05310032
                                                                        05320002
           PERFORM 5500-CUM-EOM-RETAIL.                                 05330032
                                                                        05340002
           PERFORM 5600-COST-OF-SALES.                                  05350026
                                                                        05360002
           PERFORM 5700-EOM-COST.                                       05370026
                                                                        05380002
           PERFORM 5800-EOM-RETAIL.                                     05390026
                                                                        05400001
           PERFORM 5900-MARKDOWNS.                                      05410026
                                                                        05420011
           PERFORM 6000-GROSS-MARGIN.                                   05430034
                                                                        05440034
           PERFORM 6100-RCPTS-RETAIL.                                   05450034
                                                                        05460034
           PERFORM 6200-MARKON-PERCENT.                                 05470034
                                                                        05480034
           PERFORM 6300-CUM-MARKON-PERCENT.                             05490034
                                                                        05500034
           PERFORM 6400-PADJ-RETAIL.                                    05510048
                                                                        05520048
           WRITE EXCEL-RECORD          FROM PV-EXCEL-RECORD.            05530001
           ADD 1                       TO PV-EXCEL-WRITTEN.             05540001
                                                                        05550001
       EJECT                                                            05560001
                                                                        05570001
      ******************************************************************05580002
       5100-SALES.                                                      05590026
      ******************************************************************05600002
      *                                                                 05610002
           MOVE PV-C-MO-SLS-RTL-AMT    TO PV-COMPUTE-AMOUNT             05620002
                                          PV-WA-AMOUNT.                 05630036
           ADD PV-C-MO-SLS-RTL-AMT     TO BUYER-SALES (PV-BUYER-SUB)    05640036
                                          DMM-SALES (PV-DMM-SUB).       05650036
                                                                        05660036
           IF PV-COMPUTE-AMOUNT < ZERO                                  05670002
               SET PV-WA-DASH          TO TRUE                          05680002
           ELSE                                                         05690002
               SET PV-WA-ZERO          TO TRUE                          05700002
           END-IF.                                                      05710002
                                                                        05720002
           MOVE PV-WORK-AMOUNT         TO PV-ER-SALES.                  05730002
                                                                        05740002
       EJECT                                                            05750002
                                                                        05760002
      ******************************************************************05770002
       5200-BOM-COST.                                                   05780026
      ******************************************************************05790002
      *                                                                 05800002
           MOVE PV-P-MO-END-INV-COST-AMT                                05810032
                                       TO PV-COMPUTE-AMOUNT             05820002
                                          PV-WA-AMOUNT.                 05830036
           ADD PV-P-MO-END-INV-COST-AMT                                 05840036
                                       TO BUYER-BOM-COST (PV-BUYER-SUB) 05850036
                                          DMM-BOM-COST (PV-DMM-SUB).    05860036
                                                                        05870036
           IF PV-COMPUTE-AMOUNT < ZERO                                  05880002
               SET PV-WA-DASH          TO TRUE                          05890002
           ELSE                                                         05900002
               SET PV-WA-ZERO          TO TRUE                          05910002
           END-IF.                                                      05920002
                                                                        05930002
           MOVE PV-WORK-AMOUNT         TO PV-ER-BOM-COST.               05940002
                                                                        05950002
       EJECT                                                            05960002
                                                                        05970002
      ******************************************************************05980002
       5300-BOM-RETAIL.                                                 05990026
      ******************************************************************06000002
      *                                                                 06010002
           MOVE PV-P-MO-END-INV-RTL-AMT                                 06020032
                                       TO PV-COMPUTE-AMOUNT             06030002
                                          PV-WA-AMOUNT.                 06040036
           ADD PV-P-MO-END-INV-RTL-AMT TO BUYER-BOM-RETAIL(PV-BUYER-SUB)06050036
                                          DMM-BOM-RETAIL (PV-DMM-SUB).  06060036
                                                                        06070002
           IF PV-COMPUTE-AMOUNT < ZERO                                  06080002
               SET PV-WA-DASH          TO TRUE                          06090002
           ELSE                                                         06100002
               SET PV-WA-ZERO          TO TRUE                          06110002
           END-IF.                                                      06120002
           MOVE PV-WORK-AMOUNT         TO PV-ER-BOM-RETAIL.             06130002
                                                                        06140002
       EJECT                                                            06150002
                                                                        06160002
      ******************************************************************06170003
       5400-CUM-EOM-COST.                                               06180032
      ******************************************************************06190003
      *                                                                 06200003
           MOVE PV-P-SEA-END-INV-COST-AMT                               06250066
                                       TO PV-COMPUTE-AMOUNT.            06260066
           ADD PV-SEASON-RCPT-NET-COST-AMT                              06290005
                                       TO PV-COMPUTE-AMOUNT.            06300005
           ADD PV-SEASON-PADJ-NET-COST-AMT                              06310005
                                       TO PV-COMPUTE-AMOUNT.            06320005
                                                                        06330003
           MOVE PV-COMPUTE-AMOUNT      TO PV-WA-AMOUNT.                 06340036
           ADD PV-COMPUTE-AMOUNT    TO BUYER-CUM-EOM-COST (PV-BUYER-SUB)06350036
                                       DMM-CUM-EOM-COST (PV-DMM-SUB).   06360036
                                                                        06370004
           IF PV-COMPUTE-AMOUNT < ZERO                                  06380003
               SET PV-WA-DASH          TO TRUE                          06390003
           ELSE                                                         06400003
               SET PV-WA-ZERO          TO TRUE                          06410003
           END-IF.                                                      06420003
                                                                        06430004
           MOVE PV-WORK-AMOUNT         TO PV-ER-CUM-EOM-COST.           06440032
                                                                        06450003
       EJECT                                                            06460003
                                                                        06470003
      ******************************************************************06480003
       5500-CUM-EOM-RETAIL.                                             06490032
      ******************************************************************06500003
      *                                                                 06510003
           MOVE PV-P-SEA-END-INV-RTL-AMT                                06560066
                                       TO PV-COMPUTE-AMOUNT.            06570066
           ADD PV-SEASON-MKUP-RTL-AMT  TO PV-COMPUTE-AMOUNT.            06600005
           ADD PV-SEASON-RCPT-RTL-AMT  TO PV-COMPUTE-AMOUNT.            06610005
           ADD PV-SEASON-PADJ-RTL-AMT  TO PV-COMPUTE-AMOUNT.            06620005
                                                                        06630003
           MOVE PV-COMPUTE-AMOUNT      TO PV-WA-AMOUNT.                 06640036
           ADD PV-COMPUTE-AMOUNT  TO BUYER-CUM-EOM-RETAIL (PV-BUYER-SUB)06650036
                                     DMM-CUM-EOM-RETAIL (PV-DMM-SUB).   06660036
                                                                        06670004
           IF PV-COMPUTE-AMOUNT < ZERO                                  06680005
               SET PV-WA-DASH          TO TRUE                          06690003
           ELSE                                                         06700003
               SET PV-WA-ZERO          TO TRUE                          06710003
           END-IF.                                                      06720003
                                                                        06730004
           MOVE PV-WORK-AMOUNT         TO PV-ER-CUM-EOM-RETAIL.         06740032
                                                                        06750003
       EJECT                                                            06760003
                                                                        06770003
      ******************************************************************06780002
       5600-COST-OF-SALES.                                              06790026
      ******************************************************************06800002
      *                                                                 06810002
           MOVE PV-C-MO-SLS-COST-AMT   TO PV-COMPUTE-AMOUNT             06820002
                                          PV-WA-AMOUNT.                 06830036
           ADD PV-C-MO-SLS-COST-AMT    TO                               06840036
                                      BUYER-COST-OF-SALES (PV-BUYER-SUB)06850036
                                      DMM-COST-OF-SALES (PV-DMM-SUB).   06860036
                                                                        06870002
           IF PV-COMPUTE-AMOUNT < ZERO                                  06880002
               SET PV-WA-DASH          TO TRUE                          06890002
           ELSE                                                         06900002
               SET PV-WA-ZERO          TO TRUE                          06910002
           END-IF.                                                      06920002
                                                                        06930002
           MOVE PV-WORK-AMOUNT         TO PV-ER-COST-OF-SALES.          06940002
                                                                        06950002
       EJECT                                                            06960002
                                                                        06970002
      ******************************************************************06980002
       5700-EOM-COST.                                                   06990026
      ******************************************************************07000002
      *                                                                 07010002
           MOVE PV-C-MO-END-INV-COST-AMT                                07020011
                                       TO PV-COMPUTE-AMOUNT             07030011
                                          PV-WA-AMOUNT.                 07040036
           ADD PV-C-MO-END-INV-COST-AMT                                 07050036
                                       TO BUYER-EOM-COST (PV-BUYER-SUB) 07060036
                                          DMM-EOM-COST (PV-DMM-SUB).    07070036
                                                                        07080002
           IF PV-COMPUTE-AMOUNT < ZERO                                  07090002
               SET PV-WA-DASH          TO TRUE                          07100002
           ELSE                                                         07110002
               SET PV-WA-ZERO          TO TRUE                          07120002
           END-IF.                                                      07130002
                                                                        07140002
           MOVE PV-WORK-AMOUNT         TO PV-ER-EOM-COST.               07150002
                                                                        07160002
       EJECT                                                            07170002
                                                                        07180002
      ******************************************************************07190002
       5800-EOM-RETAIL.                                                 07200026
      ******************************************************************07210002
      *                                                                 07220002
           MOVE PV-C-MO-END-INV-RTL-AMT                                 07230011
                                       TO PV-COMPUTE-AMOUNT             07240011
                                          PV-WA-AMOUNT.                 07250036
           ADD PV-C-MO-END-INV-RTL-AMT TO BUYER-EOM-RETAIL(PV-BUYER-SUB)07260036
                                          DMM-EOM-RETAIL (PV-DMM-SUB).  07270036
                                                                        07280002
           IF PV-COMPUTE-AMOUNT < ZERO                                  07290002
               SET PV-WA-DASH          TO TRUE                          07300002
           ELSE                                                         07310002
               SET PV-WA-ZERO          TO TRUE                          07320002
           END-IF.                                                      07330002
                                                                        07340002
           MOVE PV-WORK-AMOUNT         TO PV-ER-EOM-RETAIL.             07350002
                                                                        07360002
       EJECT                                                            07370002
                                                                        07380002
      ******************************************************************07390011
       5900-MARKDOWNS.                                                  07400026
      ******************************************************************07410011
      *                                                                 07420011
           MOVE PV-C-MO-MKDN-RTL-AMT   TO PV-COMPUTE-AMOUNT             07430011
                                          PV-WA-AMOUNT.                 07440036
           ADD PV-C-MO-MKDN-RTL-AMT    TO BUYER-MARKDOWNS (PV-BUYER-SUB)07450036
                                          DMM-MARKDOWNS (PV-DMM-SUB).   07460036
                                                                        07470011
           IF PV-COMPUTE-AMOUNT < ZERO                                  07480011
               SET PV-WA-DASH          TO TRUE                          07490011
           ELSE                                                         07500011
               SET PV-WA-ZERO          TO TRUE                          07510011
           END-IF.                                                      07520011
                                                                        07530011
           MOVE PV-WORK-AMOUNT         TO PV-ER-MARKDOWNS.              07540011
                                                                        07550011
       EJECT                                                            07560026
                                                                        07570026
      ******************************************************************07580034
       6000-GROSS-MARGIN.                                               07590034
      ******************************************************************07600034
      *                                                                 07610034
           MOVE PV-C-MO-GRO-MRGN-AMT   TO PV-COMPUTE-AMOUNT             07620044
                                          PV-WA-AMOUNT.                 07630044
           ADD PV-C-MO-GRO-MRGN-AMT TO BUYER-GROSS-MARGIN (PV-BUYER-SUB)07640044
                                       DMM-GROSS-MARGIN (PV-DMM-SUB).   07650044
                                                                        07660034
           IF PV-COMPUTE-AMOUNT < ZERO                                  07670034
               SET PV-WA-DASH          TO TRUE                          07680034
           ELSE                                                         07690034
               SET PV-WA-ZERO          TO TRUE                          07700034
           END-IF.                                                      07710034
                                                                        07720034
           MOVE PV-WORK-AMOUNT         TO PV-ER-GROSS-MARGIN.           07730034
                                                                        07740034
       EJECT                                                            07750034
                                                                        07760034
      ******************************************************************07770034
       6100-RCPTS-RETAIL.                                               07780034
      ******************************************************************07790034
      *                                                                 07800034
           MOVE PV-C-MO-RCPT-RTL-AMT   TO PV-COMPUTE-AMOUNT             07810034
                                          PV-WA-AMOUNT.                 07820034
           ADD PV-C-MO-RCPT-RTL-AMT TO BUYER-RCPTS-RETAIL (PV-BUYER-SUB)07830036
                                       DMM-RCPTS-RETAIL (PV-DMM-SUB).   07840036
                                                                        07850034
           IF PV-COMPUTE-AMOUNT < ZERO                                  07860034
               SET PV-WA-DASH          TO TRUE                          07870034
           ELSE                                                         07880034
               SET PV-WA-ZERO          TO TRUE                          07890034
           END-IF.                                                      07900034
                                                                        07910034
           MOVE PV-WORK-AMOUNT         TO PV-ER-RCPTS-RETAIL.           07920034
                                                                        07930034
       EJECT                                                            07940034
                                                                        07950034
      ******************************************************************07960034
       6200-MARKON-PERCENT.                                             07970034
      ******************************************************************07980034
      *                                                                 07990034
           COMPUTE PV-PURCHASES-COST = PV-C-MO-RCPT-NET-COST-AMT +      08000035
                                       PV-C-MO-PADJ-NET-COST-AMT.       08010035
           COMPUTE PV-PURCHASES-RTL  = PV-C-MO-RCPT-RTL-AMT +           08020035
                                       PV-C-MO-PADJ-RTL-AMT +           08030035
                                       PV-C-MO-MKUP-RTL-AMT +           08040035
                                       PV-C-MO-XFER-IN-RTL-AMT -        08050035
                                       PV-C-MO-XFER-OUT-RTL-AMT.        08060035
           ADD PV-PURCHASES-COST    TO BUYER-MRKN-PCT-COST(PV-BUYER-SUB)08070036
                                       DMM-MRKN-PCT-COST (PV-DMM-SUB).  08080036
           ADD PV-PURCHASES-RTL     TO BUYER-MRKN-PCT-RTL (PV-BUYER-SUB)08090036
                                       DMM-MRKN-PCT-RTL (PV-DMM-SUB).   08100036
                                                                        08110036
           IF PV-PURCHASES-RTL = ZERO                                   08120036
               MOVE ZERO               TO PV-WA-AMOUNT                  08130036
           ELSE                                                         08140036
               COMPUTE PV-COMPUTE-AMOUNT ROUNDED =                      08150042
                     ((PV-PURCHASES-RTL - PV-PURCHASES-COST) * 100)     08160036
                      / PV-PURCHASES-RTL                                08170036
               MOVE PV-COMPUTE-AMOUNT TO PV-WA-AMOUNT                   08180036
           END-IF.                                                      08190036
                                                                        08200036
           IF PV-COMPUTE-AMOUNT < ZERO                                  08210036
               SET PV-WA-DASH          TO TRUE                          08220036
           ELSE                                                         08230036
               SET PV-WA-ZERO          TO TRUE                          08240036
           END-IF.                                                      08250036
                                                                        08260036
           MOVE PV-WORK-AMOUNT         TO PV-ER-MARKON-PCT.             08270036
                                                                        08280036
       EJECT                                                            08290036
                                                                        08300036
      ******************************************************************08310036
       6300-CUM-MARKON-PERCENT.                                         08320036
      ******************************************************************08330036
      *                                                                 08340035
           COMPUTE PV-PURCHASES-COST = PV-SEASON-RCPT-NET-COST-AMT +    08350035
                                       PV-SEASON-PADJ-NET-COST-AMT.     08360046
           COMPUTE PV-PURCHASES-RTL  = PV-SEASON-RCPT-RTL-AMT +         08370035
                                       PV-SEASON-PADJ-RTL-AMT +         08380035
                                       PV-SEASON-MKUP-RTL-AMT +         08390035
                                       PV-SEASON-XFER-IN-RTL-AMT -      08400035
                                       PV-SEASON-XFER-OUT-RTL-AMT.      08410046
           ADD PV-PURCHASES-COST    TO BUYER-CUM-PCT-COST (PV-BUYER-SUB)08420044
                                       DMM-CUM-PCT-COST (PV-DMM-SUB).   08430044
           ADD PV-P-SEA-END-INV-COST-AMT                                08440046
                                    TO BUYER-SEA-END-COST (PV-BUYER-SUB)08450046
                                       DMM-SEA-END-COST (PV-DMM-SUB).   08460046
           ADD PV-PURCHASES-RTL     TO BUYER-CUM-PCT-RTL (PV-BUYER-SUB) 08470046
                                       DMM-CUM-PCT-RTL (PV-DMM-SUB).    08480046
           ADD PV-P-SEA-END-INV-RTL-AMT                                 08490046
                                    TO BUYER-SEA-END-RTL (PV-BUYER-SUB) 08500046
                                       DMM-SEA-END-RTL (PV-DMM-SUB).    08510046
                                                                        08520046
*****      COMPUTE PV-PURCH-COMPUTED =                                  08530056
*****                (PV-PURCHASES-RTL + PV-P-SEA-END-INV-RTL-AMT)      08540056
*****                                                                   08550056
*****      IF PV-PURCH-COMPUTED = ZERO                                  08560056
*****           MOVE ZERO TO PV-COMPUTE-AMOUNT                          08570063
*****                        PV-WA-AMOUNT                               08580057
*****      ELSE                                                         08590057
               IF PV-PURCHASES-RTL = ZERO                               08600058
                   MOVE ZERO               TO PV-WA-AMOUNT              08610058
               ELSE                                                     08620058
                   COMPUTE PV-COMPUTE-AMOUNT ROUNDED =                  08630058
                       (((PV-PURCHASES-RTL + PV-P-SEA-END-INV-RTL-AMT) -08640061
                        (PV-PURCHASES-COST + PV-P-SEA-END-INV-COST-AMT))08650060
                       * 100) /                                         08660060
                       (PV-PURCHASES-RTL + PV-P-SEA-END-INV-RTL-AMT)    08670060
                   MOVE PV-COMPUTE-AMOUNT TO PV-WA-AMOUNT               08680058
               END-IF                                                   08690058
*****      END-IF.                                                      08700057
                                                                        08710057
           IF PV-COMPUTE-AMOUNT < ZERO                                  08720057
               SET PV-WA-DASH          TO TRUE                          08730057
           ELSE                                                         08740057
               SET PV-WA-ZERO          TO TRUE                          08750057
           END-IF.                                                      08760057
                                                                        08770057
           MOVE PV-WORK-AMOUNT         TO PV-ER-CUM-MARKON-PCT.         08780057
                                                                        08790057
       EJECT                                                            08800057
                                                                        08810057
      ******************************************************************08820057
       6400-PADJ-RETAIL.                                                08830057
      ******************************************************************08840057
      *                                                                 08850057
           COMPUTE PV-PADJ-RETAIL    = PV-C-MO-PADJ-RTL-AMT +           08860057
                                       PV-C-MO-MKUP-RTL-AMT +           08870057
                                       PV-C-MO-XFER-IN-RTL-AMT -        08880057
                                       PV-C-MO-XFER-OUT-RTL-AMT.        08890057
           MOVE PV-PADJ-RETAIL      TO PV-COMPUTE-AMOUNT                08900057
                                       PV-WA-AMOUNT.                    08910057
           ADD PV-PADJ-RETAIL       TO BUYER-PADJ-RETAIL (PV-BUYER-SUB) 08920057
                                       DMM-PADJ-RETAIL (PV-DMM-SUB).    08930057
                                                                        08940057
           IF PV-COMPUTE-AMOUNT < ZERO                                  08950057
               SET PV-WA-DASH          TO TRUE                          08960057
           ELSE                                                         08970057
               SET PV-WA-ZERO          TO TRUE                          08980057
           END-IF.                                                      08990057
                                                                        09000057
           MOVE PV-WORK-AMOUNT         TO PV-ER-PADJ-RETAIL.            09010057
                                                                        09020057
       EJECT                                                            09030057
                                                                        09040057
      ******************************************************************09050057
       7000-SELECT-TMLCNTL.                                             09060025
      ******************************************************************09070001
      *                                                                 09080001
           EXEC SQL                                                     09090001
               SELECT PSTG_FSCL_MN_DTE,                                 09100053
                      PSTG_FSCL_MN_NBR                                  09110053
               INTO  :PV-PSTG-FSCL-MN-DTE,                              09120054
                     :PV-PSTG-FSCL-MN-NBR                               09130054
               FROM TMLCNTL                                             09140001
               WITH UR                                                  09141068
           END-EXEC.                                                    09150001
                                                                        09160001
           EVALUATE TRUE                                                09170001
               WHEN SQLCODE = ZERO                                      09180001
                   CONTINUE                                             09190001
               WHEN OTHER                                               09200001
                   MOVE '7000-SELECT-TMLCNTL'                           09210025
                                       TO AA-PARAGRAPH-NAME             09220001
                   MOVE 'TMLCNTL ROW NOT FOUND'                         09230001
                                       TO AA-MESSAGE                    09240001
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              09250001
                   PERFORM 9901-SQL-ERROR                               09260026
           END-EVALUATE.                                                09270001
                                                                        09280001
       EJECT                                                            09290001
                                                                        09300003
      ******************************************************************09310003
       7100-SELECT-TDTATTR.                                             09320025
      ******************************************************************09330003
      *                                                                 09340003
           EXEC SQL                                                     09350003
               SELECT SEA_BEG_DTE,                                      09360003
                      PREV_SEA_END_DTE,                                 09370003
                      PFM_END_DTE                                       09380003
               INTO  :PV-SEA-BEG-DTE,                                   09390003
                     :PV-PREV-SEA-END-DTE,                              09400003
                     :PV-PFM-END-DTE                                    09410003
               FROM TDTATTR                                             09420003
               WHERE (KY_DTE = :PV-PSTG-FSCL-MN-DTE)                    09430054
               WITH UR                                                  09431068
           END-EXEC.                                                    09440003
                                                                        09450003
           EVALUATE TRUE                                                09460003
               WHEN SQLCODE = ZERO                                      09470003
                   CONTINUE                                             09480003
               WHEN OTHER                                               09490003
                   MOVE '7100-SELECT-TDTATTR'                           09500025
                                       TO AA-PARAGRAPH-NAME             09510003
                   MOVE 'TDTATTR ROW NOT FOUND'                         09520003
                                       TO AA-MESSAGE                    09530003
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              09540003
                   PERFORM 9901-SQL-ERROR                               09550026
           END-EVALUATE.                                                09560003
                                                                        09570001
       EJECT                                                            09580003
                                                                        09590003
      ******************************************************************09600001
       7200-OPEN-TMNDPT-CURSOR.                                         09610025
      ******************************************************************09620001
      *                                                                 09630001
           EXEC SQL                                                     09640001
               OPEN TMNDPT_CURSOR                                       09650001
           END-EXEC.                                                    09660001
                                                                        09670001
           EVALUATE TRUE                                                09680001
               WHEN SQLCODE = ZERO                                      09690001
                   CONTINUE                                             09700001
               WHEN OTHER                                               09710001
                   MOVE '7200-OPEN-CURSOR-TMNDPT'                       09720025
                                       TO AA-PARAGRAPH-NAME             09730001
                   MOVE 'TMNDPT TABLE ERROR'                            09740001
                                       TO AA-MESSAGE                    09750001
                   MOVE 'OPEN CURSOR'  TO AA-DB2-OPERATION              09760001
                   PERFORM 9901-SQL-ERROR                               09770026
           END-EVALUATE.                                                09780001
                                                                        09790001
       EJECT                                                            09800001
                                                                        09810001
      ******************************************************************09820001
       7210-FETCH-TMNDPT.                                               09830025
      ******************************************************************09840001
      *                                                                 09850001
           EXEC SQL                                                     09860001
               FETCH TMNDPT_CURSOR                                      09870001
                INTO :PV-C-MO-DEPT-NBR,                                 09880002
                     :PV-C-MO-SLS-RTL-AMT,                              09890002
                     :PV-C-MO-MKDN-RTL-AMT,                             09900002
                     :PV-C-MO-MKUP-RTL-AMT,                             09910035
                     :PV-C-MO-XFER-IN-RTL-AMT,                          09920035
                     :PV-C-MO-XFER-OUT-RTL-AMT,                         09930035
                     :PV-C-MO-RCPT-RTL-AMT,                             09940034
                     :PV-C-MO-RCPT-NET-COST-AMT,                        09950034
                     :PV-C-MO-PADJ-RTL-AMT,                             09960035
                     :PV-C-MO-PADJ-NET-COST-AMT,                        09970035
                     :PV-C-MO-END-INV-RTL-AMT,                          09980002
                     :PV-C-MO-END-INV-COST-AMT,                         09990002
                     :PV-C-MO-SLS-COST-AMT,                             10000044
                     :PV-C-MO-GRO-MRGN-AMT                              10010044
           END-EXEC.                                                    10020001
                                                                        10030001
           EVALUATE TRUE                                                10040001
               WHEN SQLCODE = ZERO                                      10050001
                   ADD 1               TO PV-C-MO-TMNDPT-FETCHED        10060002
               WHEN SQLCODE = +100                                      10070001
                   SET PS-END-OF-DATA                                   10080001
                       PS-DONT-PROCESS TO TRUE                          10090001
               WHEN OTHER                                               10100001
                   MOVE '7210-FETCH-TMNDPT'                             10110025
                                       TO AA-PARAGRAPH-NAME             10120001
                   MOVE 'TMNDPT TABLE ERROR'                            10130001
                                       TO AA-MESSAGE                    10140001
                   MOVE 'FETCH'        TO AA-DB2-OPERATION              10150001
                   PERFORM 9901-SQL-ERROR                               10160026
           END-EVALUATE.                                                10170001
                                                                        10180001
       EJECT                                                            10190001
                                                                        10200001
      ******************************************************************10210001
       7220-CLOSE-TMNDPT-CURSOR.                                        10220026
      ******************************************************************10230001
      *                                                                 10240001
           EXEC SQL                                                     10250001
               CLOSE TMNDPT_CURSOR                                      10260001
           END-EXEC.                                                    10270001
                                                                        10280001
           EVALUATE TRUE                                                10290001
               WHEN SQLCODE = ZERO                                      10300001
                   CONTINUE                                             10310001
               WHEN OTHER                                               10320001
                   MOVE '7220-CLOSE-TMNDPT-CURSOR'                      10330026
                                       TO AA-PARAGRAPH-NAME             10340001
                   MOVE 'TMNDPT TABLE ERROR'                            10350001
                                       TO AA-MESSAGE                    10360001
                   MOVE 'CLOSE CURSOR' TO AA-DB2-OPERATION              10370001
                   PERFORM 9901-SQL-ERROR                               10380026
           END-EVALUATE.                                                10390001
                                                                        10400001
       EJECT                                                            10410001
                                                                        10420002
      ******************************************************************10430002
       7300-SELECT-TMDSEAR-TAPLAVL.                                     10440026
      ******************************************************************10450002
      *                                                                 10460002
W26603     MOVE PV-C-MO-DEPT-NBR           TO MDSEAR-DEPT-NBR.          10462069
      *                                                                 10463069
           EXEC SQL                                                     10470002
               SELECT M.GMA_NBR,                                        10480002
                      M.DMA_NBR,                                        10490002
                      M.BYR_NBR                                         10500002
               INTO   :MDSEAR-GMA-NBR,                                  10510002
                      :MDSEAR-DMA-NBR,                                  10520002
                      :MDSEAR-BYR-NBR                                   10530002
               FROM   TMDSEAR M,                                        10540002
                      TAPLAVL A                                         10550002
W26603          WHERE (M.OPERCO_NBR      = '03'                         10560069
W26603            AND  M.DEPT_NBR        = :MDSEAR-DEPT-NBR             10570069
W26603            AND  M.MDSELV_CDE      = 'DPT'                        10580069
W26603            AND  A.APLSYS_CDE      = 'ML'                         10590069
                  AND  M.MDSEAR_DKEY     = A.MDSEAR_DKEY)               10600002
                  AND (:PV-PSTG-FSCL-MN-DTE BETWEEN                     10610054
                       A.MDSEAR_STRT_DTE AND                            10620002
                       A.MDSEAR_END_DTE)                                10630002
W26603         WITH UR                                                  10631069
           END-EXEC.                                                    10640002
                                                                        10650002
           EVALUATE TRUE                                                10660002
               WHEN SQLCODE = 0                                         10670002
                   ADD 1               TO PV-TMDSEAR-SELECTED           10680004
               WHEN SQLCODE = +100                                      10690002
                   SET PS-DONT-PROCESS TO TRUE                          10700002
                   DISPLAY ' '                                          10710021
                   DISPLAY 'NO TMDSEAR/TAPLAVL FOR DEPT '               10720021
                     PV-C-MO-DEPT-NBR                                   10730021
               WHEN OTHER                                               10740002
                   MOVE '7300-SELECT-TMDSEAR-TAPLAVL'                   10750026
                                       TO AA-PARAGRAPH-NAME             10760002
                   MOVE 'VALIDATE ML DEPARTMENT'                        10770002
                                       TO AA-MESSAGE                    10780002
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              10790002
                   PERFORM 9901-SQL-ERROR                               10800026
           END-EVALUATE.                                                10810002
                                                                        10820002
       EJECT                                                            10830002
                                                                        10840002
      ******************************************************************10850002
       7400-SELECT-PRIOR-MTH-TMNDPT.                                    10860026
      ******************************************************************10870002
      *                                                                 10880002
W26603     MOVE PV-PFM-END-DTE              TO MNDPT-FSCL-MN-END-DTE.   10880169
W26603     MOVE PV-C-MO-DEPT-NBR            TO MNDPT-DEPT-NBR.          10880269
      *                                                                 10881069
           EXEC SQL                                                     10890002
               SELECT END_INV_RTL_AMT,                                  10900002
                      END_INV_COST_AMT                                  10910002
               INTO   :PV-P-MO-END-INV-RTL-AMT,                         10920006
                      :PV-P-MO-END-INV-COST-AMT                         10930006
               FROM TMNDPT                                              10940002
W26603         WHERE FSCL_MN_END_DTE  = :MNDPT-FSCL-MN-END-DTE          10950069
W26603           AND DEPT_NBR         = :MNDPT-DEPT-NBR                 10960069
W26603         WITH UR                                                  10961069
           END-EXEC.                                                    10970002
                                                                        10980002
           EVALUATE TRUE                                                10990002
               WHEN SQLCODE = ZERO                                      11000002
                   ADD 1               TO PV-P-MO-TMNDPT-SELECTED       11010002
               WHEN SQLCODE = +100                                      11020002
                   DISPLAY ' '                                          11030021
                   DISPLAY 'NO PRIOR MONTH TMNDPT FOR DEPT '            11040019
                     PV-C-MO-DEPT-NBR                                   11050019
               WHEN OTHER                                               11060002
                   MOVE '7400-SELECT-PRIOR-MTH-TMNDPT'                  11070026
                                       TO AA-PARAGRAPH-NAME             11080002
                   MOVE 'TMNDPT TABLE ERROR'                            11090002
                                       TO AA-MESSAGE                    11100002
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              11110002
                   PERFORM 9901-SQL-ERROR                               11120026
           END-EVALUATE.                                                11130002
                                                                        11140002
       EJECT                                                            11150002
                                                                        11160002
      ******************************************************************11170002
       7500-SELECT-P-SEA-TMNDPT.                                        11180026
      ******************************************************************11190002
      *                                                                 11200002
W26603     MOVE PV-PREV-SEA-END-DTE         TO MNDPT-FSCL-MN-END-DTE.   11201069
W26603     MOVE PV-C-MO-DEPT-NBR            TO MNDPT-DEPT-NBR.          11202069
      *                                                                 11203069
           EXEC SQL                                                     11210002
               SELECT END_INV_RTL_AMT,                                  11220002
                      END_INV_COST_AMT                                  11230002
               INTO   :PV-P-SEA-END-INV-RTL-AMT,                        11240006
                      :PV-P-SEA-END-INV-COST-AMT                        11250006
               FROM TMNDPT                                              11260002
W26603         WHERE FSCL_MN_END_DTE  = :MNDPT-FSCL-MN-END-DTE          11261069
W26603           AND DEPT_NBR         = :MNDPT-DEPT-NBR                 11262069
               WITH UR                                                  11281069
           END-EXEC.                                                    11290002
                                                                        11300002
           EVALUATE TRUE                                                11310002
               WHEN SQLCODE = ZERO                                      11320002
                   ADD 1               TO PV-P-SEA-TMNDPT-SELECTED      11330004
               WHEN SQLCODE = +100                                      11340002
                   DISPLAY ' '                                          11350021
                   DISPLAY 'NO PRIOR SEASON TMNDPT FOR DEPT '           11360019
                     PV-C-MO-DEPT-NBR                                   11370019
               WHEN OTHER                                               11380002
                   MOVE '7500-SELECT-P-SEA-TMNDPT'                      11390026
                                       TO AA-PARAGRAPH-NAME             11400002
                   MOVE 'TMNDPT TABLE ERROR'                            11410002
                                       TO AA-MESSAGE                    11420002
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              11430002
                   PERFORM 9901-SQL-ERROR                               11440026
           END-EVALUATE.                                                11450002
                                                                        11460002
       EJECT                                                            11470002
                                                                        11480002
      ******************************************************************11490004
       7600-SELECT-SEASON-TMNDPT.                                       11500026
      ******************************************************************11510004
      *                                                                 11520004
W26603     MOVE PV-C-MO-DEPT-NBR            TO MNDPT-DEPT-NBR.          11520269
      *                                                                 11520669
           EXEC SQL                                                     11530004
               SELECT SUM(MKUP_RTL_AMT),                                11540005
                      SUM(XFER_IN_RTL_AMT),                             11550035
                      SUM(XFER_OUT_RTL_AMT),                            11560035
                      SUM(RCPT_RTL_AMT),                                11570035
                      SUM(RCPT_NET_COST_AMT),                           11580005
                      SUM(PADJ_RTL_AMT),                                11590005
                      SUM(PADJ_NET_COST_AMT)                            11600005
               INTO   :PV-SEASON-MKUP-RTL-AMT,                          11610005
                      :PV-SEASON-XFER-IN-RTL-AMT,                       11620035
                      :PV-SEASON-XFER-OUT-RTL-AMT,                      11630035
                      :PV-SEASON-RCPT-RTL-AMT,                          11640035
                      :PV-SEASON-RCPT-NET-COST-AMT,                     11650005
                      :PV-SEASON-PADJ-RTL-AMT,                          11660005
                      :PV-SEASON-PADJ-NET-COST-AMT                      11670005
               FROM TMNDPT                                              11680004
               WHERE FSCL_MN_END_DTE >  :PV-SEA-BEG-DTE                 11690069
                 AND FSCL_MN_END_DTE <= :PV-PSTG-FSCL-MN-DTE            11700069
W26603           AND DEPT_NBR         = :MNDPT-DEPT-NBR                 11710069
W26603         WITH UR                                                  11711069
           END-EXEC.                                                    11720004
                                                                        11730004
           EVALUATE TRUE                                                11740004
               WHEN SQLCODE = ZERO                                      11750004
                   ADD 1               TO PV-C-SEA-TMNDPT-SELECTED      11760007
               WHEN SQLCODE = +100                                      11770004
                   CONTINUE                                             11780004
               WHEN OTHER                                               11790004
                   MOVE '7600-SELECT-SEASON-TMNDPT'                     11800026
                                       TO AA-PARAGRAPH-NAME             11810004
                   MOVE 'TMNDPT TABLE ERROR'                            11820004
                                       TO AA-MESSAGE                    11830004
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              11840004
                   PERFORM 9901-SQL-ERROR                               11850026
           END-EVALUATE.                                                11860004
                                                                        11870004
       EJECT                                                            11880004
                                                                        11890004
      ******************************************************************11900004
       8000-EOJ.                                                        11910025
      ******************************************************************11920004
      *                                                                 11930004
           PERFORM 7220-CLOSE-TMNDPT-CURSOR.                            11940026
                                                                        11950004
           WRITE EXCEL-RECORD          FROM PV-DUMMY-EXCEL-RECORD.      11960040
           ADD 1                       TO PV-EXCEL-WRITTEN.             11970040
                                                                        11980040
           MOVE SPACES                 TO PV-ER-DEPARTMENT.             11990037
           PERFORM 8100-WRITE-BUYER-TOTALS                              12000037
               VARYING PV-BUYER-SUB                                     12010037
               FROM 1 BY 1                                              12020037
               UNTIL PV-BUYER-SUB > PC-MAX-BUYERS.                      12030037
                                                                        12040037
           MOVE SPACES                 TO PV-ER-BUYER.                  12050037
           PERFORM 8200-WRITE-DMM-TOTALS                                12060037
               VARYING PV-DMM-SUB                                       12070037
               FROM 1 BY 1                                              12080037
               UNTIL PV-DMM-SUB > PC-MAX-DMM.                           12090037
                                                                        12100037
           CLOSE EXCEL-FILE.                                            12110004
                                                                        12120004
           PERFORM 9100-DISPLAY-TOTALS.                                 12130004
                                                                        12140004
       EJECT                                                            12150037
                                                                        12160037
      ******************************************************************12170037
       8100-WRITE-BUYER-TOTALS.                                         12180037
      ******************************************************************12190037
      *                                                                 12200037
           IF BUYER-GMA (PV-BUYER-SUB) = SPACES                         12210037
               NEXT SENTENCE                                            12220037
           ELSE                                                         12230037
               MOVE BUYER-GMA (PV-BUYER-SUB) TO PV-ER-GMA               12240037
               MOVE BUYER-DMA (PV-BUYER-SUB) TO PV-ER-DMA               12250037
               MOVE PV-BUYER-SUB             TO PV-BUYER-NUM            12260040
               MOVE PV-BUYER-NUM             TO PV-ER-BUYER             12270040
                                                                        12280040
               MOVE BUYER-SALES (PV-BUYER-SUB)                          12290040
                                             TO PV-COMPUTE-AMOUNT       12300040
                                                PV-WA-AMOUNT            12310040
               PERFORM 8300-SET-SIGN                                    12320040
               MOVE PV-WORK-AMOUNT           TO PV-ER-SALES             12330040
                                                                        12340040
               MOVE BUYER-BOM-COST (PV-BUYER-SUB)                       12350040
                                             TO PV-COMPUTE-AMOUNT       12360040
                                                PV-WA-AMOUNT            12370040
               PERFORM 8300-SET-SIGN                                    12380040
               MOVE PV-WORK-AMOUNT           TO PV-ER-BOM-COST          12390040
                                                                        12400040
               MOVE BUYER-BOM-RETAIL (PV-BUYER-SUB)                     12410040
                                             TO PV-COMPUTE-AMOUNT       12420040
                                                PV-WA-AMOUNT            12430040
               PERFORM 8300-SET-SIGN                                    12440040
               MOVE PV-WORK-AMOUNT           TO PV-ER-BOM-RETAIL        12450040
                                                                        12460040
               MOVE BUYER-CUM-EOM-COST (PV-BUYER-SUB)                   12470040
                                             TO PV-COMPUTE-AMOUNT       12480040
                                                PV-WA-AMOUNT            12490040
               PERFORM 8300-SET-SIGN                                    12500040
               MOVE PV-WORK-AMOUNT           TO PV-ER-CUM-EOM-COST      12510040
                                                                        12520040
               MOVE BUYER-CUM-EOM-RETAIL (PV-BUYER-SUB)                 12530040
                                             TO PV-COMPUTE-AMOUNT       12540040
                                                PV-WA-AMOUNT            12550040
               PERFORM 8300-SET-SIGN                                    12560040
               MOVE PV-WORK-AMOUNT           TO PV-ER-CUM-EOM-RETAIL    12570040
                                                                        12580040
               MOVE BUYER-COST-OF-SALES (PV-BUYER-SUB)                  12590040
                                             TO PV-COMPUTE-AMOUNT       12600040
                                                PV-WA-AMOUNT            12610040
               PERFORM 8300-SET-SIGN                                    12620040
               MOVE PV-WORK-AMOUNT           TO PV-ER-COST-OF-SALES     12630040
                                                                        12640040
               MOVE BUYER-EOM-COST (PV-BUYER-SUB)                       12650040
                                             TO PV-COMPUTE-AMOUNT       12660040
                                                PV-WA-AMOUNT            12670040
               PERFORM 8300-SET-SIGN                                    12680040
               MOVE PV-WORK-AMOUNT           TO PV-ER-EOM-COST          12690040
                                                                        12700040
               MOVE BUYER-EOM-RETAIL (PV-BUYER-SUB)                     12710040
                                             TO PV-COMPUTE-AMOUNT       12720040
                                                PV-WA-AMOUNT            12730040
               PERFORM 8300-SET-SIGN                                    12740040
               MOVE PV-WORK-AMOUNT           TO PV-ER-EOM-RETAIL        12750040
                                                                        12760040
               MOVE BUYER-MARKDOWNS (PV-BUYER-SUB)                      12770040
                                             TO PV-COMPUTE-AMOUNT       12780040
                                                PV-WA-AMOUNT            12790040
               PERFORM 8300-SET-SIGN                                    12800040
               MOVE PV-WORK-AMOUNT           TO PV-ER-MARKDOWNS         12810040
                                                                        12820040
               MOVE BUYER-GROSS-MARGIN (PV-BUYER-SUB)                   12830040
                                             TO PV-COMPUTE-AMOUNT       12840040
                                                PV-WA-AMOUNT            12850040
               PERFORM 8300-SET-SIGN                                    12860040
               MOVE PV-WORK-AMOUNT           TO PV-ER-GROSS-MARGIN      12870040
                                                                        12880040
               MOVE BUYER-RCPTS-RETAIL (PV-BUYER-SUB)                   12890040
                                             TO PV-COMPUTE-AMOUNT       12900040
                                                PV-WA-AMOUNT            12910040
               PERFORM 8300-SET-SIGN                                    12920040
               MOVE PV-WORK-AMOUNT           TO PV-ER-RCPTS-RETAIL      12930040
                                                                        12940040
               MOVE BUYER-MRKN-PCT-COST (PV-BUYER-SUB)                  12950040
                                             TO PV-PURCHASES-COST       12960040
               MOVE BUYER-MRKN-PCT-RTL (PV-BUYER-SUB)                   12970040
                                             TO PV-PURCHASES-RTL        12980040
               PERFORM 8400-MARKON-PERCENT                              12990037
               MOVE PV-WORK-AMOUNT           TO PV-ER-MARKON-PCT        13000037
                                                                        13010037
               MOVE BUYER-CUM-PCT-COST (PV-BUYER-SUB)                   13020038
                                             TO PV-PURCHASES-COST       13030037
               MOVE BUYER-SEA-END-COST (PV-BUYER-SUB)                   13040046
                                             TO PV-SEA-END-INV-COST     13050046
               MOVE BUYER-CUM-PCT-RTL (PV-BUYER-SUB)                    13060046
                                             TO PV-PURCHASES-RTL        13070046
               MOVE BUYER-SEA-END-RTL (PV-BUYER-SUB)                    13080046
                                             TO PV-SEA-END-INV-RTL      13090046
               PERFORM 8500-CUM-MARKON-PERCENT                          13100046
               MOVE PV-WORK-AMOUNT           TO PV-ER-CUM-MARKON-PCT    13110046
                                                                        13120046
               MOVE BUYER-PADJ-RETAIL (PV-BUYER-SUB)                    13130048
                                             TO PV-COMPUTE-AMOUNT       13140048
                                                PV-WA-AMOUNT            13150048
               PERFORM 8300-SET-SIGN                                    13160048
               MOVE PV-WORK-AMOUNT           TO PV-ER-PADJ-RETAIL       13170048
                                                                        13180048
               WRITE EXCEL-RECORD            FROM PV-EXCEL-RECORD       13190037
               ADD 1                         TO PV-EXCEL-WRITTEN        13200037
           END-IF.                                                      13210037
                                                                        13220037
       EJECT                                                            13230037
                                                                        13240037
      ******************************************************************13250037
       8200-WRITE-DMM-TOTALS.                                           13260037
      ******************************************************************13270037
      *                                                                 13280037
           IF DMM-GMA (PV-DMM-SUB) = SPACES                             13290037
               NEXT SENTENCE                                            13300037
           ELSE                                                         13310037
               MOVE PV-DMM-SUB               TO PV-DMA-TTLS-DEPT-DMM    13320037
               MOVE PV-DMA-TTLS-DEPT         TO PV-ER-DEPARTMENT        13330037
               MOVE DMM-GMA (PV-DMM-SUB)     TO PV-ER-GMA               13340037
               MOVE PV-DMM-SUB               TO PV-DMM-NUM              13350040
               MOVE PV-DMM-NUM               TO PV-ER-DMA               13360040
                                                                        13370040
               MOVE DMM-SALES (PV-DMM-SUB)                              13380040
                                             TO PV-COMPUTE-AMOUNT       13390040
                                                PV-WA-AMOUNT            13400040
               PERFORM 8300-SET-SIGN                                    13410040
               MOVE PV-WORK-AMOUNT           TO PV-ER-SALES             13420040
                                                                        13430040
               MOVE DMM-BOM-COST (PV-DMM-SUB)                           13440040
                                             TO PV-COMPUTE-AMOUNT       13450040
                                                PV-WA-AMOUNT            13460040
               PERFORM 8300-SET-SIGN                                    13470040
               MOVE PV-WORK-AMOUNT           TO PV-ER-BOM-COST          13480040
                                                                        13490040
               MOVE DMM-BOM-RETAIL (PV-DMM-SUB)                         13500040
                                             TO PV-COMPUTE-AMOUNT       13510040
                                                PV-WA-AMOUNT            13520040
               PERFORM 8300-SET-SIGN                                    13530040
               MOVE PV-WORK-AMOUNT           TO PV-ER-BOM-RETAIL        13540040
                                                                        13550040
               MOVE DMM-CUM-EOM-COST (PV-DMM-SUB)                       13560040
                                             TO PV-COMPUTE-AMOUNT       13570040
                                                PV-WA-AMOUNT            13580040
               PERFORM 8300-SET-SIGN                                    13590040
               MOVE PV-WORK-AMOUNT           TO PV-ER-CUM-EOM-COST      13600040
                                                                        13610040
               MOVE DMM-CUM-EOM-RETAIL (PV-DMM-SUB)                     13620040
                                             TO PV-COMPUTE-AMOUNT       13630040
                                                PV-WA-AMOUNT            13640040
               PERFORM 8300-SET-SIGN                                    13650040
               MOVE PV-WORK-AMOUNT           TO PV-ER-CUM-EOM-RETAIL    13660040
                                                                        13670040
               MOVE DMM-COST-OF-SALES (PV-DMM-SUB)                      13680040
                                             TO PV-COMPUTE-AMOUNT       13690040
                                                PV-WA-AMOUNT            13700040
               PERFORM 8300-SET-SIGN                                    13710040
               MOVE PV-WORK-AMOUNT           TO PV-ER-COST-OF-SALES     13720040
                                                                        13730040
               MOVE DMM-EOM-COST (PV-DMM-SUB)                           13740040
                                             TO PV-COMPUTE-AMOUNT       13750040
                                                PV-WA-AMOUNT            13760040
               PERFORM 8300-SET-SIGN                                    13770040
               MOVE PV-WORK-AMOUNT           TO PV-ER-EOM-COST          13780040
                                                                        13790040
               MOVE DMM-EOM-RETAIL (PV-DMM-SUB)                         13800040
                                             TO PV-COMPUTE-AMOUNT       13810040
                                                PV-WA-AMOUNT            13820040
               PERFORM 8300-SET-SIGN                                    13830040
               MOVE PV-WORK-AMOUNT           TO PV-ER-EOM-RETAIL        13840040
                                                                        13850040
               MOVE DMM-MARKDOWNS (PV-DMM-SUB)                          13860040
                                             TO PV-COMPUTE-AMOUNT       13870040
                                                PV-WA-AMOUNT            13880040
               PERFORM 8300-SET-SIGN                                    13890040
               MOVE PV-WORK-AMOUNT           TO PV-ER-MARKDOWNS         13900040
                                                                        13910040
               MOVE DMM-GROSS-MARGIN (PV-DMM-SUB)                       13920040
                                             TO PV-COMPUTE-AMOUNT       13930040
                                                PV-WA-AMOUNT            13940040
               PERFORM 8300-SET-SIGN                                    13950040
               MOVE PV-WORK-AMOUNT           TO PV-ER-GROSS-MARGIN      13960040
                                                                        13970040
               MOVE DMM-RCPTS-RETAIL (PV-DMM-SUB)                       13980040
                                             TO PV-COMPUTE-AMOUNT       13990040
                                                PV-WA-AMOUNT            14000040
               PERFORM 8300-SET-SIGN                                    14010040
               MOVE PV-WORK-AMOUNT           TO PV-ER-RCPTS-RETAIL      14020040
                                                                        14030040
               MOVE DMM-MRKN-PCT-COST (PV-DMM-SUB)                      14040040
                                             TO PV-PURCHASES-COST       14050040
               MOVE DMM-MRKN-PCT-RTL (PV-DMM-SUB)                       14060040
                                             TO PV-PURCHASES-RTL        14070040
               PERFORM 8400-MARKON-PERCENT                              14080040
               MOVE PV-WORK-AMOUNT           TO PV-ER-MARKON-PCT        14090040
                                                                        14100040
               MOVE DMM-CUM-PCT-COST (PV-DMM-SUB)                       14110040
                                             TO PV-PURCHASES-COST       14120040
               MOVE DMM-SEA-END-COST (PV-DMM-SUB)                       14130046
                                             TO PV-SEA-END-INV-COST     14140046
               MOVE DMM-CUM-PCT-RTL (PV-DMM-SUB)                        14150046
                                             TO PV-PURCHASES-RTL        14160046
               MOVE DMM-SEA-END-RTL (PV-DMM-SUB)                        14170046
                                             TO PV-SEA-END-INV-RTL      14180046
               PERFORM 8500-CUM-MARKON-PERCENT                          14190046
               MOVE PV-WORK-AMOUNT           TO PV-ER-CUM-MARKON-PCT    14200040
                                                                        14210040
               MOVE DMM-PADJ-RETAIL (PV-DMM-SUB)                        14220048
                                             TO PV-COMPUTE-AMOUNT       14230048
                                                PV-WA-AMOUNT            14240048
               PERFORM 8300-SET-SIGN                                    14250048
               MOVE PV-WORK-AMOUNT           TO PV-ER-PADJ-RETAIL       14260048
                                                                        14270048
               WRITE EXCEL-RECORD            FROM PV-EXCEL-RECORD       14280040
               ADD 1                         TO PV-EXCEL-WRITTEN        14290040
           END-IF.                                                      14300040
                                                                        14310040
       EJECT                                                            14320040
                                                                        14330040
      ******************************************************************14340040
       8300-SET-SIGN.                                                   14350040
      ******************************************************************14360040
      *                                                                 14370040
           IF PV-COMPUTE-AMOUNT < ZERO                                  14380040
               SET PV-WA-DASH          TO TRUE                          14390040
           ELSE                                                         14400040
               SET PV-WA-ZERO          TO TRUE                          14410040
           END-IF.                                                      14420040
                                                                        14430037
       EJECT                                                            14440037
                                                                        14450037
      ******************************************************************14460037
       8400-MARKON-PERCENT.                                             14470037
      ******************************************************************14480037
      *                                                                 14490037
           IF PV-PURCHASES-RTL = ZERO                                   14500037
               MOVE ZERO               TO PV-WA-AMOUNT                  14510037
           ELSE                                                         14520037
               COMPUTE PV-COMPUTE-AMOUNT ROUNDED =                      14530043
                     ((PV-PURCHASES-RTL - PV-PURCHASES-COST) * 100)     14540037
                      / PV-PURCHASES-RTL                                14550037
               MOVE PV-COMPUTE-AMOUNT TO PV-WA-AMOUNT                   14560037
           END-IF.                                                      14570037
                                                                        14580037
           PERFORM 8300-SET-SIGN.                                       14590037
                                                                        14600037
       EJECT                                                            14610046
                                                                        14620046
      ******************************************************************14630046
       8500-CUM-MARKON-PERCENT.                                         14640046
      ******************************************************************14650046
      *                                                                 14660046
*****      COMPUTE PV-PURCH-COMPUTED =                                  14670062
*****                (PV-PURCHASES-RTL + PV-SEA-END-INV-RTL)            14680062
*****                                                                   14690062
*****      IF PV-PURCH-COMPUTED = ZERO                                  14700062
*****           MOVE  100 TO PV-COMPUTE-AMOUNT                          14710062
*****                        PV-WA-AMOUNT                               14720062
*****      ELSE                                                         14730062
               IF PV-PURCHASES-RTL = ZERO                               14740062
                   MOVE ZERO               TO PV-WA-AMOUNT              14750062
               ELSE                                                     14760062
                   COMPUTE PV-COMPUTE-AMOUNT ROUNDED =                  14770062
                         (((PV-PURCHASES-RTL + PV-SEA-END-INV-RTL) -    14780062
                          (PV-PURCHASES-COST + PV-SEA-END-INV-COST))    14790062
                         * 100) /                                       14800062
                         (PV-PURCHASES-RTL + PV-SEA-END-INV-RTL)        14810062
                   MOVE PV-COMPUTE-AMOUNT TO PV-WA-AMOUNT               14820062
               END-IF                                                   14830062
*****      END-IF.                                                      14840062
                                                                        14850062
           PERFORM 8300-SET-SIGN.                                       14860062
                                                                        14870062
       EJECT                                                            14880062
                                                                        14890046
      ******************************************************************14900037
       9100-DISPLAY-TOTALS.                                             14910003
      ******************************************************************14920000
      *                                                                 14930001
           DISPLAY ' '.                                                 14940001
           DISPLAY '*--------------------------------------------*'.    14950012
           DISPLAY '*                                            *'.    14960012
           DISPLAY '*         **MLKUT406 COUNTS**                *'.    14970012
           DISPLAY '* '                                                 14980001
                   PV-C-MO-TMNDPT-FETCHED                               14990002
                   ' CURRENT MONTH TMNDPT ROWS READ   *'.               15000014
           DISPLAY '* '                                                 15010004
                   PV-TMDSEAR-SELECTED                                  15020004
                   ' TMDSEAR ROWS READ                *'.               15030014
           DISPLAY '* '                                                 15040002
                   PV-P-MO-TMNDPT-SELECTED                              15050002
                   ' PRIOR MONTH TMNDPT ROWS READ     *'.               15060014
           DISPLAY '* '                                                 15070002
                   PV-P-SEA-TMNDPT-SELECTED                             15080004
                   ' PRIOR SEASON TMNDPT ROWS READ    *'.               15090014
           DISPLAY '* '                                                 15100004
                   PV-C-SEA-TMNDPT-SELECTED                             15110004
                   ' SEASON TO DATE TMNDPT ROWS READ  *'.               15120014
           DISPLAY '* '                                                 15130001
                   PV-EXCEL-WRITTEN                                     15140001
                   ' RECORDS WRITTEN                  *'.               15150014
           DISPLAY '*                                            *'.    15160012
           DISPLAY '*--------------------------------------------*'.    15170012
                                                                        15180001
       EJECT                                                            15190001
                                                                        15200001
                                                                        15210001
      ******************************************************************15220001
       9901-SQL-ERROR.                                                  15230026
      ******************************************************************15240001
      *                                                                 15250001
           CLOSE EXCEL-FILE.                                            15260002
                                                                        15270001
           DISPLAY AA-ABEND-LIT.                                        15280001
           DISPLAY AA-DB2-ERROR-LIT.                                    15290001
           DISPLAY AA-PROGRAM-LIT.                                      15300001
           DISPLAY AA-PARAGRAPH-LIT.                                    15310001
           DISPLAY AA-MESSAGE-LINE.                                     15320001
           DISPLAY AA-DB2-OPERATION-LIT.                                15330001
           SET AC-DB2-ERROR TO TRUE.                                    15340001
           MOVE +4013                  TO ABEND-CODE.                   15350001
                                                                        15360001
           COPY DPPD004.                                                15370001
           CALL 'ILBOABN0' USING ABEND-CODE.                            15380001
                                                                        15390001
