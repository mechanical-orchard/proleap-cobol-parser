000100 IDENTIFICATION DIVISION.                                         00010004
000200 PROGRAM-ID.     DSKUT406.                                        00020004
000300 AUTHOR.         RICHARD MOORE.                                   00030004
000400*DATE-WRITTEN.   11/12/98.                                        00040004
000500*DATE-COMPILED.                                                   00050004
000600*************************************************************     00060004
000700*    DELETE GROUP 2 DATA - QA                               *     00070004
000800*************************************************************     00080004
000810*  CHANGES:                                                       00081004
000811*                                                                 00081104
000812*  08/10/2022  J KURK   - RECOMPILE FOR COPYBOOK DSPD002          00081204
000820*************************************************************     00082004
000900                                                                  00090004
001000 ENVIRONMENT DIVISION.                                            00100004
001100                                                                  00110004
001200 INPUT-OUTPUT SECTION.                                            00120004
001300                                                                  00130004
001400 FILE-CONTROL.                                                    00140004
001500                                                                  00150004
001600     SELECT PO-NBR-FILE                                           00160004
001700         ASSIGN         TO UT-S-PO01.                             00170004
001800     SELECT TBLE-FILE                                             00180004
001900         ASSIGN         TO UT-S-TBL01.                            00190004
002000     SELECT CONTROL-FILE                                          00200004
002100         ASSIGN         TO UT-S-CTL01.                            00210004
002200                                                                  00220004
002300 DATA DIVISION.                                                   00230004
002400                                                                  00240004
002500 FILE SECTION.                                                    00250004
002600******************************************************************00260004
002700     COPY DSFD001.                                                00270004
002800******************************************************************00280004
002900                                                                  00290004
003000 WORKING-STORAGE SECTION.                                         00300004
003100 01  PV-OTHER-CRAPOLA.                                            00310004
003200     05  PV-TOTAL-COUNT               PIC S9(7) COMP-3            00320004
003300                                               VALUE ZERO.        00330004
003400     05  PV-WHEN-COMPILED.                                        00340004
003500         10  PV-COMPILE-DATE          PIC X(08).                  00350004
003600         10  PV-COMPILE-TIME          PIC X(08).                  00360004
003700     05  PV-DISP-SQLCODE              PIC -999.                   00370004
003800     05  PV-DISP-NBR                  PIC -Z(08)9.                00380004
003801                                                                  00380104
003810 01  PC-CONSTANTS.                                                00381004
003820     05  PC-90                       PIC S9(04)    COMP           00382004
003830                                                   VALUE 90.      00383004
003840     05  PC-A                        PIC  X(01)    VALUE 'A'.     00384004
003850     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     00385004
003860     05  PC-RCV                      PIC  X(03)    VALUE 'RCV'.   00386004
003870     05  PC-KHL                      PIC  X(03)    VALUE 'KHL'.   00387004
003880     05  PC-PRDCHK                   PIC  X(06)    VALUE 'PRDCHK'.00388004
003890     05  PC-PARM-TEXT                PIC  X(25)    VALUE          00389004
003891         'LOWER LEVEL ONLY         '.                             00389104
003892     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00389204
003893         'DSKUT406'.                                              00389304
003894                                                                  00389404
003895 01  WS-LOCAL-SERVER.                                             00389504
003896     05  WS-SUBSYS                   PIC X(04)  VALUE SPACES.     00389604
003897     05  FILLER                      PIC X(12)  VALUE SPACES.     00389704
003898*                                                                 00389804
003900/                                                                 00390004
004000     COPY DSWS08Q.                                                00400004
004100     COPY DSWS009.                                                00410004
004200     COPY DSWS10Q.                                                00420004
004300     COPY DSRD002.                                                00430004
004400     COPY DPWS004.                                                00440004
004500*                                                                 00450004
004600*  DCLGENS FOR PROD TO TEST UTILITIES                             00460004
004700     COPY DSWS11Q.                                                00470004
004800/                                                                 00480004
004900     EXEC SQL                                                     00490004
005000         DECLARE TLBPTDA-CSR CURSOR WITH HOLD FOR                 00500004
005100             SELECT TRIP_ID                                       00510004
005200             FROM TLBPTDA                                         00520004
005300           WHERE TRIP_ID = :HOLD-TRIP-ID                          00530004
005400             FOR UPDATE OF TRIP_ID                                00540004
005500     END-EXEC.                                                    00550004
005600/                                                                 00560004
005700 PROCEDURE DIVISION.                                              00570004
005800                                                                  00580004
005900 A100-MAINLINE.                                                   00590004
006000                                                                  00600004
006100     MOVE WHEN-COMPILED TO PV-WHEN-COMPILED                       00610004
006200     DISPLAY SPACES                                               00620004
006300     DISPLAY ' *** DSKUT406 VERSION 2 ***'                        00630004
006400     DISPLAY 'COMPILE DATE: ' PV-COMPILE-DATE                     00640004
006500             ' ' PV-COMPILE-TIME                                  00650004
006610                                                                  00661004
006620     PERFORM 1100-GET-DB2-INSTANCE.                               00662004
006630     PERFORM 1200-CHECK-IF-PRODUCTION.                            00663004
006700                                                                  00670004
006800     SET DS009-D-PGM TO TRUE.                                     00680004
006900     PERFORM DS002-INITIAL-PROCESSING.                            00690004
007000     PERFORM B100-PROCESSING                                      00700004
007100         UNTIL TABLE-EOF.                                         00710004
007200                                                                  00720004
007300     DISPLAY '  ****  DELETE TOTALS  ****'                        00730004
007400                                                                  00740004
007500     PERFORM VARYING CNTL-I FROM 1 BY 1 UNTIL                     00750004
007600           CNTL-I > CNTL-SUB-MAX OR CNTL-I > 200                  00760004
007700         IF CNTL-TABLE(CNTL-I) NOT = SPACES                       00770004
007800             IF DS009-GROUP-NBR(CNTL-I) = '2'                     00780004
007900                 MOVE DS009-READ-COUNT (CNTL-I) TO DS009-DISP-NBR 00790004
008000                 ADD DS009-READ-COUNT (CNTL-I)  TO PV-TOTAL-COUNT 00800004
008100                 DISPLAY 'TABLE = ' CNTL-TABLE(CNTL-I)            00810004
008200                            DS009-DISP-NBR                        00820004
008300             END-IF                                               00830004
008400         END-IF                                                   00840004
008500     END-PERFORM                                                  00850004
008600     MOVE PV-TOTAL-COUNT              TO DS009-DISP-NBR           00860004
008700     DISPLAY 'TOTAL DELETES  =          '  DS009-DISP-NBR         00870004
008800                                                                  00880004
008900     PERFORM DS002-END-OF-JOB.                                    00890004
009000                                                                  00900004
009100     GOBACK.                                                      00910004
009200/                                                                 00920004
009300                                                                  00930004
009400 B100-PROCESSING.                                                 00940004
009500*                                                                 00950004
009600***************************************************************** 00960004
009700*     FOR EACH TABLE, DELETE ANY EXISTING DATA AND THEN INSERT    00970004
009800*     THE DATA FROM THE FILE.                                     00980004
009900***************************************************************** 00990004
010000*                                                                 01000004
010100     READ TBLE-FILE                                               01010004
010200         AT END SET TABLE-EOF TO TRUE.                            01020004
010300                                                                  01030004
010400     IF NOT-TABLE-EOF                                             01040004
010500        MOVE TBLE-DATA-SIZE TO DS009-TBLE-DATA-SIZE               01050004
010600        MOVE TBLE-NAME  TO DS009-PROCESS-TABLE                    01060004
010700        MOVE TBLE-KEYS  TO DS009-PKYS                             01070004
010800        PERFORM DS002-DO-PROCESS                                  01080004
010900        IF DS009-DO-PROCESS                                       01090004
011000*       DISPLAY '**********************************'              01100004
011100*       DISPLAY DS009-PROCESS-TABLE                               01110004
011200        EVALUATE TRUE                                             01120004
011300         WHEN DS009-PROCESS-TABLE = 'TSHPTPO'                     01130004
011400             MOVE TBLE-DATA-ITEM TO WS-SHPTPO                     01140004
011500             MOVE WS-SHPTPO-PO-NBR TO HOLD-PO-NBR                 01150004
011600*            DISPLAY HOLD-PO-NBR                                  01160004
011700*            DISPLAY WS-SHPTPO                                    01170004
011800             PERFORM R100-DELETE                                  01180004
011900             PERFORM B101-ADD-TO-DELETE-COUNTS                    01190004
012000         WHEN DS009-PROCESS-TABLE = 'TPKSLIP'                     01200004
012100             MOVE TBLE-DATA-ITEM TO WS-PKSLIP                     01210004
012200             MOVE WS-PKSLIP-PO-NBR TO HOLD-PO-NBR                 01220004
012300*            DISPLAY HOLD-PO-NBR                                  01230004
012400*            DISPLAY WS-PKSLIP                                    01240004
012500             PERFORM R100-DELETE                                  01250004
012600             PERFORM B101-ADD-TO-DELETE-COUNTS                    01260004
012700         WHEN DS009-PROCESS-TABLE = 'TPKITEM'                     01270004
012800             MOVE TBLE-DATA-ITEM TO WS-PKITEM                     01280004
012900             MOVE WS-PKITEM-PO-NBR TO HOLD-PO-NBR                 01290004
013000*            DISPLAY HOLD-PO-NBR                                  01300004
013100*            DISPLAY WS-PKITEM                                    01310004
013200             PERFORM R100-DELETE                                  01320004
013300             PERFORM B101-ADD-TO-DELETE-COUNTS                    01330004
013400         WHEN DS009-PROCESS-TABLE = 'TRECEIV'                     01340004
013500             MOVE TBLE-DATA-ITEM TO WS-RECEIV                     01350004
013600             MOVE WS-RECEIV-ORD-NBR TO HOLD-PO-NBR                01360004
013700*            DISPLAY HOLD-PO-NBR                                  01370004
013800*            DISPLAY WS-RECEIV                                    01380004
013900             PERFORM R100-DELETE                                  01390004
014000             PERFORM B101-ADD-TO-DELETE-COUNTS                    01400004
014100         WHEN DS009-PROCESS-TABLE = 'TRECITM'                     01410004
014200             MOVE TBLE-DATA-ITEM TO WS-RECITM                     01420004
014300             MOVE WS-RECITM-ORD-NBR TO HOLD-PO-NBR                01430004
014400*            DISPLAY HOLD-PO-NBR                                  01440004
014500*            DISPLAY WS-RECITM                                    01450004
014600             PERFORM R100-DELETE                                  01460004
014700             PERFORM B101-ADD-TO-DELETE-COUNTS                    01470004
014800         WHEN DS009-PROCESS-TABLE = 'TRECDIS'                     01480004
014900             MOVE TBLE-DATA-ITEM TO WS-RECDIS                     01490004
015000             MOVE WS-RECDIS-ORD-NBR TO HOLD-PO-NBR                01500004
015100*            DISPLAY HOLD-PO-NBR                                  01510004
015200*            DISPLAY WS-RECDIS                                    01520004
015300             PERFORM R100-DELETE                                  01530004
015400             PERFORM B101-ADD-TO-DELETE-COUNTS                    01540004
015500         WHEN DS009-PROCESS-TABLE = 'TVHTRIP'                     01550004
015600             MOVE TBLE-DATA-ITEM TO WS-VHTRIP                     01560004
015700             MOVE WS-VHTRIP-TRIP-ID  TO HOLD-TRIP-ID              01570004
015800*            DISPLAY HOLD-TRIP-ID                                 01580004
015900*            DISPLAY WS-VHTRIP                                    01590004
016000             PERFORM R100-DELETE                                  01600004
016100             PERFORM B101-ADD-TO-DELETE-COUNTS                    01610004
016200         WHEN DS009-PROCESS-TABLE = 'TSHIPMT'                     01620004
016300             MOVE TBLE-DATA-ITEM TO WS-SHIPMT                     01630004
016400             MOVE WS-SHIPMT-SHIPT-ID TO HOLD-SHIPT-ID             01640004
016500*            DISPLAY HOLD-SHIPT-ID                                01650004
016600*            DISPLAY WS-SHIPMT                                    01660004
016700             PERFORM R100-DELETE                                  01670004
016800             PERFORM B101-ADD-TO-DELETE-COUNTS                    01680004
016900         WHEN DS009-PROCESS-TABLE = 'TSHIPST'                     01690004
017000             MOVE TBLE-DATA-ITEM TO WS-SHIPST                     01700004
017100             MOVE WS-SHIPST-SHIPT-ID TO HOLD-SHIPT-ID             01710004
017200*            DISPLAY HOLD-SHIPT-ID                                01720004
017300*            DISPLAY WS-SHIPST                                    01730004
017400             PERFORM R100-DELETE                                  01740004
017500             PERFORM B101-ADD-TO-DELETE-COUNTS                    01750004
017600         WHEN DS009-PROCESS-TABLE = 'TTRIPST'                     01760004
017700             MOVE TBLE-DATA-ITEM TO WS-TRIPST                     01770004
017800             MOVE WS-TRIPST-TRIP-ID  TO HOLD-TRIP-ID              01780004
017900*            DISPLAY HOLD-TRIP-ID                                 01790004
018000*            DISPLAY WS-TRIPST                                    01800004
018100             PERFORM R100-DELETE                                  01810004
018200             PERFORM B101-ADD-TO-DELETE-COUNTS                    01820004
018300         WHEN DS009-PROCESS-TABLE = 'TVEHICL'                     01830004
018400             MOVE TBLE-DATA-ITEM TO WS-VEHICL                     01840004
018500             MOVE WS-VEHICL-OWNER-SCAC-ID TO HOLD-SCAC-ID         01850004
018600             MOVE WS-VEHICL-VEH-NBR       TO HOLD-VEH-NBR         01860004
018700*            DISPLAY HOLD-VEH-NBR                                 01870004
018800*            DISPLAY HOLD-SCAC-ID                                 01880004
018900*            DISPLAY WS-VEHICL                                    01890004
019000             PERFORM R100-DELETE                                  01900004
019100             PERFORM B101-ADD-TO-DELETE-COUNTS                    01910004
019200         WHEN DS009-PROCESS-TABLE = 'TRECDVS'                     01920004
019300             MOVE TBLE-DATA-ITEM TO WS-RECDVS                     01930004
019400             MOVE WS-RECDVS-ORD-NBR       TO HOLD-PO-NBR          01940004
019500*            DISPLAY HOLD-PO-NBR                                  01950004
019600*            DISPLAY WS-RECDVS                                    01960004
019700             PERFORM R100-DELETE                                  01970004
019800             PERFORM B101-ADD-TO-DELETE-COUNTS                    01980004
019900         WHEN DS009-PROCESS-TABLE = 'TAUTRIP'                     01990004
020000             MOVE TBLE-DATA-ITEM TO WS-AUTRIP                     02000004
020100             MOVE WS-AUTRIP-TRIP-ID       TO HOLD-TRIP-ID         02010004
020200*            DISPLAY HOLD-TRIP-ID                                 02020004
020300*            DISPLAY WS-AUTRIP                                    02030004
020400             PERFORM R100-DELETE                                  02040004
020500             PERFORM B101-ADD-TO-DELETE-COUNTS                    02050004
020600         WHEN DS009-PROCESS-TABLE = 'TAUSHIP'                     02060004
020700             MOVE TBLE-DATA-ITEM          TO WS-AUSHIP            02070004
020800             MOVE WS-AUSHIP-SHIPT-ID      TO HOLD-SHIPT-ID        02080004
020900*            DISPLAY HOLD-SHIPT-ID                                02090004
021000*            DISPLAY WS-AUSHIP                                    02100004
021100             PERFORM R100-DELETE                                  02110004
021200             PERFORM B101-ADD-TO-DELETE-COUNTS                    02120004
021300         WHEN DS009-PROCESS-TABLE = 'TAUSHPO'                     02130004
021400             MOVE TBLE-DATA-ITEM          TO WS-AUSHPO            02140004
021500             MOVE WS-AUSHPO-PO-NBR        TO HOLD-PO-NBR          02150004
021600*            DISPLAY HOLD-PO-NBR                                  02160004
021700*            DISPLAY WS-AUSHPO                                    02170004
021800             PERFORM R100-DELETE                                  02180004
021900             PERFORM B101-ADD-TO-DELETE-COUNTS                    02190004
022000         WHEN DS009-PROCESS-TABLE = 'TAUVHCL'                     02200004
022100             MOVE TBLE-DATA-ITEM          TO WS-AUVHCL            02210004
022200             MOVE WS-AUVHCL-OWNER-SCAC-ID TO HOLD-OWNER-SCAC-ID   02220004
022300             MOVE WS-AUVHCL-VEH-NBR       TO HOLD-VEH-NBR         02230004
022400*            DISPLAY HOLD-OWNER-SCAC-ID                           02240004
022500*            DISPLAY HOLD-VEH-NBR                                 02250004
022600*            DISPLAY WS-AUVHCL                                    02260004
022700             PERFORM R100-DELETE                                  02270004
022800             PERFORM B101-ADD-TO-DELETE-COUNTS                    02280004
022900         WHEN DS009-PROCESS-TABLE = 'TDISTHD'                     02290004
023000             MOVE TBLE-DATA-ITEM          TO WS-DISTHD            02300004
023100             MOVE WS-DISTHD-ORD-NBR       TO HOLD-ORD-NBR         02310004
023200*            DISPLAY HOLD-ORD-NBR                                 02320004
023300*            DISPLAY WS-DISTHD                                    02330004
023400             PERFORM R100-DELETE                                  02340004
023500             PERFORM B101-ADD-TO-DELETE-COUNTS                    02350004
023600         WHEN DS009-PROCESS-TABLE = 'TDISTDT'                     02360004
023700             MOVE TBLE-DATA-ITEM          TO WS-DISTDT            02370004
023800             MOVE WS-DISTDT-ORD-NBR       TO HOLD-ORD-NBR         02380004
023900*            DISPLAY HOLD-ORD-NBR                                 02390004
024000*            DISPLAY WS-DISTDT                                    02400004
024100             PERFORM R100-DELETE                                  02410004
024200             PERFORM B101-ADD-TO-DELETE-COUNTS                    02420004
024300         WHEN DS009-PROCESS-TABLE = 'TWRKORD'                     02430004
024400             MOVE TBLE-DATA-ITEM          TO WS-WRKORD            02440004
024500             MOVE WS-WRKORD-ORD-NBR       TO HOLD-ORD-NBR         02450004
024600*            DISPLAY HOLD-ORD-NBR                                 02460004
024700*            DISPLAY WS-WRKORD                                    02470004
024800             PERFORM R100-DELETE                                  02480004
024900             PERFORM B101-ADD-TO-DELETE-COUNTS                    02490004
025000         WHEN DS009-PROCESS-TABLE = 'TWKORIN'                     02500004
025100             MOVE TBLE-DATA-ITEM          TO WS-WKORIN            02510004
025200             MOVE WS-WKORIN-ORD-NBR       TO HOLD-ORD-NBR         02520004
025300*            DISPLAY HOLD-ORD-NBR                                 02530004
025400*            DISPLAY WS-WKORIN                                    02540004
025500             PERFORM R100-DELETE                                  02550004
025600             PERFORM B101-ADD-TO-DELETE-COUNTS                    02560004
025700         WHEN DS009-PROCESS-TABLE = 'TSHPSUM'                     02570004
025800             MOVE TBLE-DATA-ITEM          TO WS-SHPSUM            02580004
025900             MOVE WS-SHPSUM-PO-NBR        TO HOLD-PO-NBR          02590004
026000*            DISPLAY HOLD-PO-NBR                                  02600004
026100*            DISPLAY WS-SHPSUM                                    02610004
026200             PERFORM R100-DELETE                                  02620004
026300             PERFORM B101-ADD-TO-DELETE-COUNTS                    02630004
026400         WHEN DS009-PROCESS-TABLE = 'TLBVRDA'                     02640004
026500             MOVE TBLE-DATA-ITEM          TO WS-LBVRDA            02650004
026600             MOVE WS-LBVRDA-PO-NBR        TO HOLD-PO-NBR          02660004
026700*            DISPLAY HOLD-PO-NBR                                  02670004
026800*            DISPLAY WS-LBVRDA                                    02680004
026900             PERFORM R100-DELETE                                  02690004
027000             PERFORM B101-ADD-TO-DELETE-COUNTS                    02700004
027100                                                                  02710004
027200         WHEN DS009-PROCESS-TABLE = 'TLBPTDA'                     02720004
027300             MOVE TBLE-DATA-ITEM         TO WS-LBPTDA             02730004
027400             MOVE WS-LBPTDA-TRIP-ID      TO HOLD-TRIP-ID          02740004
027500*            DISPLAY HOLD-TRIP-ID                                 02750004
027600*            DISPLAY WS-LBPTDA                                    02760004
027700                                                                  02770004
027800             SET MORE-LBPTDA-DATA         TO TRUE                 02780004
027900             PERFORM 7010-OPEN-TLBPTDA-CSR                        02790004
028000             PERFORM 7011-FETCH-TLBPTDA-CSR                       02800004
028100                                                                  02810004
028200             IF SQLCODE = ZERO AND                                02820004
028300                      LBPTDA-TRIP-ID = 224760256                  02830004
028400                 DISPLAY 'TRAP1'                                  02840004
028500             END-IF                                               02850004
028600             PERFORM UNTIL NO-MORE-LBPTDA-DATA                    02860004
028700                 PERFORM 7012-DELETE-TLBPTDA-CSR                  02870004
028800                 PERFORM B100A-CONTROL-COMMIT                     02880004
028900                 PERFORM B101-ADD-TO-DELETE-COUNTS                02890004
029000                 PERFORM 7011-FETCH-TLBPTDA-CSR                   02900004
029100             END-PERFORM                                          02910004
029200             PERFORM 7013-CLOSE-TLBPTDA-CSR                       02920004
029300                                                                  02930004
029400         END-EVALUATE                                             02940004
029500                                                                  02950004
029600*        DISPLAY 'DELETE RETURN SQLCODE:' SQLCODE                 02960004
029700*        DISPLAY 'NUMBER OF ROWS DELETED:' SQLERRD (3)            02970004
029800         PERFORM B100A-CONTROL-COMMIT                             02980004
029900         END-IF                                                   02990004
030000     END-IF.                                                      03000004
030100                                                                  03010004
030200 B100A-CONTROL-COMMIT.                                            03020004
030300     ADD SQLERRD(3) TO DS009-UPDATE-COUNT                         03030004
030400     IF DS009-UPDATE-COUNT > DS009-COMMIT-COUNT                   03040004
030500            EXEC SQL                                              03050004
030600                COMMIT                                            03060004
030700            END-EXEC                                              03070004
030800            IF SQLCODE NOT = ZERO                                 03080004
030900               PERFORM DS002-SQL-ABEND-COMMIT                     03090004
031000            END-IF                                                03100004
031100            MOVE +0  TO DS009-UPDATE-COUNT                        03110004
031200*           DISPLAY 'COMMIT TAKEN AFTER RECORD: '                 03120004
031300*                                     DS009-TUPDATE-COUNT         03130004
031400         ADD SQLERRD(3) TO DS009-UPDATE-COUNT                     03140004
031500         ADD SQLERRD(3) TO DS009-TUPDATE-COUNT                    03150004
031600     END-IF.                                                      03160004
031700                                                                  03170004
031800 B101-ADD-TO-DELETE-COUNTS.                                       03180004
031900     IF SQLCODE = ZERO OR +100                                    03190004
032000         IF NOT-TABLE-EOF AND DS009-DO-PROCESS                    03200004
032100             SET DS009-SRCH-IDX TO +1                             03210004
032200             SEARCH DS009-CNTL-RECORDS                            03220004
032300                 VARYING DS009-SRCH-IDX                           03230004
032400                 AT END                                           03240004
032500                    CONTINUE                                      03250004
032600                 WHEN CNTL-TABLE (DS009-SRCH-IDX) =               03260004
032700                           DS009-PROCESS-TABLE                    03270004
032800                     ADD SQLERRD(3)                               03280004
032900                        TO DS009-READ-COUNT (DS009-SRCH-IDX)      03290004
033000             END-SEARCH                                           03300004
033100         END-IF                                                   03310004
033200     END-IF.                                                      03320004
033300 EJECT                                                            03330004
033400*                                                                 03340004
033500***************************************************************** 03350004
033600*     DELETE RECORD                                               03360004
033700***************************************************************** 03370004
033800*                                                                 03380004
033900 R100-DELETE.                                                     03390004
034000     PERFORM WITH TEST AFTER                                      03400004
034100         VARYING DS009-RETRY-COUNTER FROM 1 BY 1                  03410004
034200         UNTIL   DS009-RETRY-COUNTER > 3 OR                       03420004
034300                 SQLCODE = ZERO OR +100                           03430004
034400         EVALUATE TRUE                                            03440004
034500           WHEN DS009-PROCESS-TABLE = 'TSHPTPO'                   03450004
034600             EXEC SQL                                             03460004
034700                 DELETE FROM TSHPTPO                              03470004
034800                 WHERE PO_NBR = :HOLD-PO-NBR                      03480004
034900             END-EXEC                                             03490004
035000           WHEN DS009-PROCESS-TABLE = 'TPKSLIP'                   03500004
035100             EXEC SQL                                             03510004
035200                DELETE FROM TPKSLIP                               03520004
035300                WHERE PO_NBR = :HOLD-PO-NBR                       03530004
035400             END-EXEC                                             03540004
035500           WHEN DS009-PROCESS-TABLE = 'TPKITEM'                   03550004
035600             EXEC SQL                                             03560004
035700                DELETE FROM TPKITEM                               03570004
035800                WHERE PO_NBR = :HOLD-PO-NBR                       03580004
035900             END-EXEC                                             03590004
036000           WHEN DS009-PROCESS-TABLE = 'TRECEIV'                   03600004
036100             EXEC SQL                                             03610004
036200                DELETE FROM TRECEIV                               03620004
036300                WHERE ORD_NBR = :HOLD-PO-NBR                      03630004
036400             END-EXEC                                             03640004
036500           WHEN DS009-PROCESS-TABLE = 'TRECITM'                   03650004
036600             EXEC SQL                                             03660004
036700                DELETE FROM TRECITM                               03670004
036800                WHERE ORD_NBR = :HOLD-PO-NBR                      03680004
036900             END-EXEC                                             03690004
037000           WHEN DS009-PROCESS-TABLE = 'TRECDIS'                   03700004
037100             EXEC SQL                                             03710004
037200                DELETE FROM TRECDIS                               03720004
037300                WHERE ORD_NBR = :HOLD-PO-NBR                      03730004
037400             END-EXEC                                             03740004
037500           WHEN DS009-PROCESS-TABLE = 'TSHIPMT'                   03750004
037600             EXEC SQL                                             03760004
037700                DELETE FROM TSHIPMT                               03770004
037800                WHERE SHIPT_ID = :HOLD-SHIPT-ID                   03780004
037900             END-EXEC                                             03790004
038000           WHEN DS009-PROCESS-TABLE = 'TSHIPST'                   03800004
038100             EXEC SQL                                             03810004
038200                DELETE FROM TSHIPST                               03820004
038300                WHERE SHIPT_ID = :HOLD-SHIPT-ID                   03830004
038400             END-EXEC                                             03840004
038500           WHEN DS009-PROCESS-TABLE = 'TTRIPST'                   03850004
038600             EXEC SQL                                             03860004
038700                DELETE FROM TTRIPST                               03870004
038800                WHERE TRIP_ID = :HOLD-TRIP-ID                     03880004
038900             END-EXEC                                             03890004
039000           WHEN DS009-PROCESS-TABLE = 'TVHTRIP'                   03900004
039100             EXEC SQL                                             03910004
039200                DELETE FROM TVHTRIP                               03920004
039300                WHERE TRIP_ID = :HOLD-TRIP-ID                     03930004
039400             END-EXEC                                             03940004
039500*            MOVE HOLD-TRIP-ID TO PV-DISP-NBR                     03950004
039600*            DISPLAY 'TRIP-ID= ' PV-DISP-NBR                      03960004
039700*            IF SQLCODE NOT = ZERO                                03970004
039800*                MOVE SQLCODE TO PV-DISP-SQLCODE                  03980004
039900*                DISPLAY 'TVHTRIP SQLCODE= ' PV-DISP-SQLCODE      03990004
040000*            END-IF                                               04000004
040100*            MOVE SQLERRD (3) TO PV-DISP-NBR                      04010004
040200*            DISPLAY 'ROWS DELETED= ' PV-DISP-NBR                 04020004
040300           WHEN DS009-PROCESS-TABLE = 'TVEHICL'                   04030004
040400             EXEC SQL                                             04040004
040500                DELETE FROM TVEHICL                               04050004
040600                WHERE VEH_NBR = :HOLD-VEH-NBR                     04060004
040700                AND   OWNER_SCAC_ID = :HOLD-SCAC-ID               04070004
040800             END-EXEC                                             04080004
040900           WHEN DS009-PROCESS-TABLE = 'TRECDVS'                   04090004
041000             EXEC SQL                                             04100004
041100                DELETE FROM TRECDVS                               04110004
041200                WHERE ORD_NBR = :HOLD-PO-NBR                      04120004
041300             END-EXEC                                             04130004
041400           WHEN DS009-PROCESS-TABLE = 'TAUTRIP'                   04140004
041500             EXEC SQL                                             04150004
041600                DELETE FROM TAUTRIP                               04160004
041700                WHERE TRIP_ID = :HOLD-TRIP-ID                     04170004
041800             END-EXEC                                             04180004
041900           WHEN DS009-PROCESS-TABLE = 'TAUSHIP'                   04190004
042000             EXEC SQL                                             04200004
042100                DELETE FROM TAUSHIP                               04210004
042200                WHERE SHIPT_ID     = :HOLD-SHIPT-ID               04220004
042300             END-EXEC                                             04230004
042400           WHEN DS009-PROCESS-TABLE = 'TAUSHPO'                   04240004
042500             EXEC SQL                                             04250004
042600                DELETE FROM TAUSHPO                               04260004
042700                WHERE PO_NBR       = :HOLD-PO-NBR                 04270004
042800             END-EXEC                                             04280004
042900           WHEN DS009-PROCESS-TABLE = 'TAUVHCL'                   04290004
043000             EXEC SQL                                             04300004
043100                DELETE FROM TAUVHCL                               04310004
043200                WHERE OWNER_SCAC_ID = :HOLD-OWNER-SCAC-ID         04320004
043300                AND   VEH_NBR       = :HOLD-VEH-NBR               04330004
043400             END-EXEC                                             04340004
043500           WHEN DS009-PROCESS-TABLE = 'TDISTHD'                   04350004
043600             EXEC SQL                                             04360004
043700                DELETE FROM TDISTHD                               04370004
043800                WHERE ORD_NBR      = :HOLD-ORD-NBR                04380004
043900             END-EXEC                                             04390004
044000           WHEN DS009-PROCESS-TABLE = 'TDISTDT'                   04400004
044100             EXEC SQL                                             04410004
044200                DELETE FROM TDISTDT                               04420004
044300                WHERE ORD_NBR      = :HOLD-ORD-NBR                04430004
044400             END-EXEC                                             04440004
044500           WHEN DS009-PROCESS-TABLE = 'TWRKORD'                   04450004
044600             EXEC SQL                                             04460004
044700                DELETE FROM TWRKORD                               04470004
044800                WHERE ORD_NBR      = :HOLD-ORD-NBR                04480004
044900             END-EXEC                                             04490004
045000           WHEN DS009-PROCESS-TABLE = 'TWKORIN'                   04500004
045100             EXEC SQL                                             04510004
045200                DELETE FROM TWKORIN                               04520004
045300                WHERE ORD_NBR      = :HOLD-ORD-NBR                04530004
045400             END-EXEC                                             04540004
045500           WHEN DS009-PROCESS-TABLE = 'TSHPSUM'                   04550004
045600             EXEC SQL                                             04560004
045700                DELETE FROM TSHPSUM                               04570004
045800                WHERE PO_NBR       = :HOLD-PO-NBR                 04580004
045900             END-EXEC                                             04590004
046000           WHEN DS009-PROCESS-TABLE = 'TLBVRDA'                   04600004
046100             PERFORM 7000-LOCK-TLBVRDA                            04610004
046200             EXEC SQL                                             04620004
046300                DELETE FROM TLBVRDA                               04630004
046400                WHERE PO_NBR       = :HOLD-PO-NBR                 04640004
046500             END-EXEC                                             04650004
046600           WHEN DS009-PROCESS-TABLE = 'TLBPTDA'                   04660004
046700             EXEC SQL                                             04670004
046800                DELETE FROM TLBPTDA                               04680004
046900                WHERE TRIP_ID      = :HOLD-TRIP-ID                04690004
047000             END-EXEC                                             04700004
047100         END-EVALUATE                                             04710004
047200     END-PERFORM.                                                 04720004
047300     PERFORM DS002-SQL-ABEND-DELETE.                              04730004
047400 EJECT                                                            04740004
047410                                                                  04741004
047420 1100-GET-DB2-INSTANCE.                                           04742004
047430                                                                  04743004
047440     MOVE '1100-GET-DB2-INSTANCE'                                 04744004
047450          TO DS009-PARAGRAPH.                                     04745004
047460     MOVE 'GET DB2 INSTANCE'                                      04746004
047470          TO DS009-OPERATION.                                     04747004
047480                                                                  04748004
047490     EXEC SQL                                                     04749004
047491         SELECT CURRENT SERVER INTO :WS-LOCAL-SERVER              04749104
047492             FROM SYSIBM.SYSDUMMY1 WITH UR                        04749204
047493     END-EXEC.                                                    04749304
047494                                                                  04749404
047495     EVALUATE TRUE                                                04749504
047496         WHEN SQLCODE = +0                                        04749604
047497             CONTINUE                                             04749704
047498         WHEN SQLWARN0 NOT = SPACES                               04749804
047499         WHEN SQLCODE < +0                                        04749904
047500         WHEN SQLCODE > +0                                        04750004
047501             PERFORM DS002-SQL-ERROR                              04750104
047502     END-EVALUATE.                                                04750204
047503*                                                                 04750304
047504 1200-CHECK-IF-PRODUCTION.                                        04750404
047505                                                                  04750504
047506     MOVE '1200-CHECK-IF-PRODUCTION'                              04750604
047507          TO DS009-PARAGRAPH.                                     04750704
047508     MOVE 'SELECT PRDCHK TKRPRPM '                                04750804
047509          TO DS009-OPERATION.                                     04750904
047510                                                                  04751004
047511     EXEC SQL                                                     04751104
047512       SELECT FUNC_TXT                                            04751204
047513         INTO :KRPRPM-FUNC-TXT                                    04751304
047514       FROM   TKRPRPM                                             04751404
047515       WHERE  SYS_PRC_FUNC_CDE  = :PC-PRDCHK                      04751504
047516         AND  INTFC_SYS_CDE     = :PC-KHL                         04751604
047517         AND  LOC_ID            = :PC-90                          04751704
047518         AND  FUNC_TXT          = :PC-PARM-TEXT                   04751804
047519     END-EXEC                                                     04751904
047520                                                                  04752004
047521     EVALUATE TRUE                                                04752104
047522         WHEN SQLCODE = +0                                        04752204
047523             CONTINUE                                             04752304
047524         WHEN SQLCODE = +100                                      04752404
047525             DISPLAY '*******************************************'04752504
047526             DISPLAY '** ABEND - DO NOT RUN THIS DSKUT406 PROGRAM'04752604
047527             DISPLAY '** ABEND - AGAINST PRODUCTION'              04752704
047528             DISPLAY '** ABEND - THIS SHOULD ONLY EVER BE'        04752804
047529             DISPLAY '** ABEND - RUN AGAINST TEST DATA'           04752904
047530             DISPLAY '*******************************************'04753004
047531             DISPLAY '** ABEND - THIS RUN IS GOING AGAINST'       04753104
047532             DISPLAY '** ABEND - DB2 INSTANCE:  '                 04753204
047533                     WS-LOCAL-SERVER                              04753304
047534             DISPLAY '*******************************************'04753404
047535             PERFORM DS002-SQL-ERROR                              04753504
047536                                                                  04753604
047537         WHEN SQLWARN0 NOT = SPACES                               04753704
047538         WHEN SQLCODE < +0                                        04753804
047539         WHEN SQLCODE > +0                                        04753904
047540             PERFORM DS002-SQL-ERROR                              04754004
047541     END-EVALUATE.                                                04754104
047542                                                                  04754204
047543 7000-LOCK-TLBVRDA.                                               04754304
047544                                                                  04754404
047545*                                                                 04754504
047546     MOVE '7000-LOCK-TLBVRDA'         TO DS009-PARAGRAPH.         04754604
047547     MOVE 'LOCK TABLE'                TO DS009-OPERATION.         04754704
047548                                                                  04754804
047549     EXEC SQL                                                     04754904
047550         LOCK TABLE                                               04755004
047551             TLBVRDA                                              04755104
047552         IN EXCLUSIVE MODE                                        04755204
047553     END-EXEC.                                                    04755304
047554                                                                  04755404
047555     IF SQLCODE = ZERO                                            04755504
047556         MOVE 'R100-DELETE'           TO DS009-PARAGRAPH          04755604
047557         MOVE 'DELETE'                TO DS009-OPERATION          04755704
047558     ELSE                                                         04755804
047559         PERFORM DS002-SQL-ERROR                                  04755904
047560     END-IF.                                                      04756004
047561/                                                                 04756104
047562 7010-OPEN-TLBPTDA-CSR.                                           04756204
047563     PERFORM WITH TEST AFTER                                      04756304
047564             VARYING DS009-RETRY-COUNTER FROM 1 BY 1              04756404
047565             UNTIL   DS009-RETRY-COUNTER > 3 OR                   04756504
047566                     SQLCODE = ZERO                               04756604
047567                                                                  04756704
047570             EXEC SQL                                             04757004
047580                 OPEN TLBPTDA-CSR                                 04758004
047590             END-EXEC                                             04759004
047600                                                                  04760004
047700             EVALUATE TRUE                                        04770004
047800                 WHEN SQLCODE = ZERO                              04780004
047900                 WHEN SQLCODE = -904                              04790004
048000                 WHEN SQLCODE = -913                              04800004
048100                 WHEN SQLCODE = -911                              04810004
048200                      CONTINUE                                    04820004
048300             END-EVALUATE                                         04830004
048400     END-PERFORM.                                                 04840004
048500                                                                  04850004
048600     PERFORM DS002-SQL-ABEND-OPEN-CSR.                            04860004
048700                                                                  04870004
048800 7011-FETCH-TLBPTDA-CSR.                                          04880004
048900     PERFORM WITH TEST AFTER                                      04890004
049000             VARYING DS009-RETRY-COUNTER FROM 1 BY 1              04900004
049100             UNTIL   DS009-RETRY-COUNTER > 3 OR                   04910004
049200                     SQLCODE = ZERO OR SQLCODE = +100             04920004
049300                                                                  04930004
049400        EXEC SQL                                                  04940004
049500            FETCH TLBPTDA-CSR                                     04950004
049600            INTO                                                  04960004
049700                 :LBPTDA-TRIP-ID                                  04970004
049800        END-EXEC                                                  04980004
049900                                                                  04990004
050000         EVALUATE TRUE                                            05000004
050100             WHEN SQLCODE = ZERO                                  05010004
050200                 CONTINUE                                         05020004
050300             WHEN SQLCODE = +100                                  05030004
050400                 SET NO-MORE-LBPTDA-DATA TO TRUE                  05040004
050500             WHEN SQLCODE = -904                                  05050004
050600             WHEN SQLCODE = -913                                  05060004
050700             WHEN SQLCODE = -911                                  05070004
050800                 CONTINUE                                         05080004
050900             END-EVALUATE                                         05090004
051000     END-PERFORM.                                                 05100004
051100                                                                  05110004
051200     PERFORM DS002-SQL-ABEND-FETCH.                               05120004
051300                                                                  05130004
051400 7012-DELETE-TLBPTDA-CSR.                                         05140004
051500     PERFORM WITH TEST AFTER                                      05150004
051600             VARYING DS009-RETRY-COUNTER FROM 1 BY 1              05160004
051700             UNTIL   DS009-RETRY-COUNTER > 3 OR                   05170004
051800                     SQLCODE = ZERO OR SQLCODE = +100             05180004
051900                                                                  05190004
052000        EXEC SQL                                                  05200004
052100            DELETE FROM                                           05210004
052200                TLBPTDA                                           05220004
052300             WHERE CURRENT OF TLBPTDA-CSR                         05230004
052400        END-EXEC                                                  05240004
052500                                                                  05250004
052600             EVALUATE TRUE                                        05260004
052700                 WHEN SQLCODE = ZERO                              05270004
052800                 WHEN SQLCODE = -904                              05280004
052900                 WHEN SQLCODE = -913                              05290004
053000                 WHEN SQLCODE = -911                              05300004
053100                      CONTINUE                                    05310004
053200             END-EVALUATE                                         05320004
053300     END-PERFORM.                                                 05330004
053400                                                                  05340004
053500     PERFORM DS002-SQL-ABEND-DELETE.                              05350004
053600                                                                  05360004
053700 7013-CLOSE-TLBPTDA-CSR.                                          05370004
053800     PERFORM WITH TEST AFTER                                      05380004
053900             VARYING DS009-RETRY-COUNTER FROM 1 BY 1              05390004
054000             UNTIL   DS009-RETRY-COUNTER > 3 OR                   05400004
054100                     SQLCODE = ZERO                               05410004
054200                                                                  05420004
054300             EXEC SQL                                             05430004
054400                 CLOSE TLBPTDA-CSR                                05440004
054500             END-EXEC                                             05450004
054600                                                                  05460004
054700             EVALUATE TRUE                                        05470004
054800                 WHEN SQLCODE = ZERO                              05480004
054900                 WHEN SQLCODE = -904                              05490004
055000                 WHEN SQLCODE = -913                              05500004
055100                 WHEN SQLCODE = -911                              05510004
055200                      CONTINUE                                    05520004
055300             END-EVALUATE                                         05530004
055400     END-PERFORM.                                                 05540004
055500                                                                  05550004
055600     PERFORM DS002-SQL-ABEND-CLOSE-CSR.                           05560004
055700                                                                  05570004
055800/                                                                 05580004
055900***************************************************************** 05590004
056000*     PRODUCTION - TO - TEST STANDARD PARAGRAPHS                * 05600004
056100***************************************************************** 05610004
056200     COPY DSPD02Q.                                                05620004
