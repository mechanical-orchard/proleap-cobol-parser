000100*-----------------------*                                         00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300*-----------------------*                                         00030002
000400 PROGRAM-ID.    PCKCS757.                                         00040002
000500 AUTHOR.        DEANNA BRANTNER.                                  00050002
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060002
000700 DATE-WRITTEN.  APRIL, 2002.                                      00070029
000800 DATE-COMPILED.                                                   00080002
000900*---------------------------------------------------------------* 00090002
001000*    E757 - UNITS WORKED - PROCESS AREA/GROUP ASSOCIATION         00100029
001100*---------------------------------------------------------------* 00110029
001110* DATE  11/04/2021                                                00111032
001120*            - CHANGE CALL OF 'DPKUT100' TO                     * 00112032
001130*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00113032
001140*              MAKING THE CALL DYNAMIC VS STATIC                * 00114032
001150*     MADE BY: GERMAN BANDA            WR/IR #: CHG0264232        00115033
001160*-----------------------------------------------------------------00116032
1122RM* DATE  11/07/2022                                              * 00117034
1122RM*            - ADD COPYBOOK DPWS930                             * 00118034
1122RM*              CHANGE CALL TO DPWS030 FROM STATIC TO            * 00119034
1122RM*              DYNAMIC.                                         * 00119134
1122RM*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910      * 00119234
1122RM*-----------------------------------------------------------------00119334
001200 ENVIRONMENT DIVISION.                                            00120029
001300 DATA DIVISION.                                                   00130029
001400                                                                  00140029
001500 WORKING-STORAGE SECTION.                                         00150029
001600 01  DK-DB2-KEYS.                                                 00160029
001700     05  DK-OPER-UNT-ID                PIC S9(04) COMP VALUE ZERO.00170029
001900     05  DK-PROCESS-AREA               PIC X(06) VALUE SPACES.    00190029
001910     05  DK-PROCESS-GROUP              PIC X(06) VALUE SPACES.    00191029
003500                                                                  00350029
003600 01  PC-PROGRAM-CONSTANTS.                                        00360029
003700     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'PC757A  '.  00370029
003800     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'PCKM757'.   00380029
003900     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'PCKCS757'.  00390029
004000     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00400029
004100     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00410029
004200     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00420029
004300     05  PC-LIST-FORMAT            PIC  X(01)  VALUE '2'.         00430029
004400     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +14          00440029
004500                                               COMP SYNC.         00450029
004600     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00460029
004700                                               COMP SYNC.         00470029
004800     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00480029
004900                                               COMP-3.            00490029
005000     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00500029
005100                                               COMP SYNC.         00510029
005200     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00520029
005300                                               COMP-3.            00530029
005400     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00540029
005500     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00550029
005600     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00560029
005700     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00570029
005800     05  PC-SLASH                  PIC  X(01)  VALUE '/'.         00580029
005900     05  PC-ZERO                   PIC S9(04)  VALUE ZEROES       00590029
006000                                               COMP.              00600029
006100     05  PC-01                     PIC  X(02)  VALUE '01'.        00610029
006500     05  PC-A                      PIC  X(01)  VALUE 'A'.         00650029
006600*                                                                 00660029
006700*----------------------------------------------------------------*00670029
006800*  SYSTEM MESSAGES                                               *00680029
006900*----------------------------------------------------------------*00690029
007000*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00700029
007100*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00710029
007200*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00720029
007300*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00730029
007400*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00740029
008000*   00069 - TOP OF LIST                                          *00800029
008100*   00070 - BOTTOM OF LIST                                       *00810029
008200*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00820029
008400*   00279 - MORE ITEMS TO DISPLAY                                *00840029
008410*   00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN; IF UNSUCCESSFUL*00841029
008500*   00840 - YOU ARE NOT AUTHORIZED TO VIEW THIS INFORMATION      *00850029
008600*   00984 - DATABASE IS BUSY, TRY AGAIN IN A FEW MINUTES         *00860029
008700*   02227 = APPLICATION UNAVAILABLE AT THIS TIME                 *00870029
009100*   99901 = INVALID COMMAND WAS ENTERED                          *00910029
009200*----------------------------------------------------------------*00920029
009300     05  PC-TSYMSG-NUMBERS.                                       00930029
009400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00940029
009500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00950029
009600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00960029
009700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00970029
009800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00980029
010400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01040029
010500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01050029
010600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01060029
010900         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01090029
010910         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01091029
011000         10  PC-TSYMSG-00840            PIC  9(05)  VALUE 00840.  01100029
011200         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  01120029
011300         10  PC-TSYMSG-02227            PIC  9(05)  VALUE 02227.  01130029
011700         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01170029
011800                                                                  01180029
011900 01  PS-PROGRAM-SWITCHES.                                         01190029
012000     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    01200029
012100         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    01210029
012200         88  PS-BLOCK-ERROR                         VALUE 'N'.    01220029
012300     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01230029
012400         88  PS-NO-ERROR                            VALUE 'Y'.    01240029
012500         88  PS-ERROR                               VALUE 'N'.    01250029
012600     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE  'N'.   01260029
012700         88  PS-SOFT-ABORT-ERROR                    VALUE  'Y'.   01270029
012800         88  PS-NO-SOFT-ABORT-ERROR                 VALUE  'N'.   01280029
012900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01290029
013000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01300029
013100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01310029
013200     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01320029
013300         88  PS-DONE                                VALUE 'Y'.    01330029
013400         88  PS-NOT-DONE                            VALUE 'N'.    01340029
013500     05  PS-LIST-END-SW                 PIC  X(01)  VALUE  'N'.   01350029
013600         88  PS-LIST-END                            VALUE  'Y'.   01360029
013700         88  PS-NO-LIST-END                         VALUE  'N'.   01370029
013800     05  PS-ACCESS-SW                   PIC  X(01)  VALUE  'N'.   01380002
013900         88  PS-ACCESS-ALLOWED                      VALUE  'Y'.   01390002
014000         88  PS-ACCESS-NOT-ALLOWED                  VALUE  'N'.   01400002
014100     05  PS-CURSOR-SW                   PIC  X(01)  VALUE  ' '.   01410029
014200         88  PS-PROCESS-AREA-CSR                    VALUE  'A'.   01420029
014300         88  PS-UK-OPER-AREA-CSR                    VALUE  'B'.   01430029
014301         88  PS-PROCESS-GROUP-CSR                   VALUE  'C'.   01430129
014302         88  PS-UK-OPER-GROUP-CSR                   VALUE  'D'.   01430229
014600*                                                                 01460002
014700 01  PV-PROGRAM-VARIABLES.                                        01470002
014800     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01480002
014900                                                     COMP SYNC.   01490002
015000     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01500002
015100     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01510002
015200     05  PV-RACF-ERROR-CODE             PIC  9(04)  VALUE ZEROES. 01520002
015300     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  01530002
015400                                        COMP SYNC.                01540002
015500     05  PV-SUB                         PIC S9(04)  VALUE +0      01550002
015600                                                    COMP SYNC.    01560002
015700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01570002
015800                                                    COMP SYNC.    01580002
015900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01590002
016000                                                    COMP-3.       01600002
016100     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01610002
016200                                                    COMP-3.       01620002
016300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01630002
016400                                                    COMP-3.       01640002
016500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01650002
016600                                                    COMP-3.       01660002
016700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01670002
016800                                                    COMP-3.       01680002
016900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01690002
017000                                                    COMP-3.       01700002
017100     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01710002
017200                                                    COMP-3.       01720002
017300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01730002
017400                                                    COMP SYNC.    01740002
017500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01750002
017600                                                    COMP SYNC.    01760002
017700     05  PV-ITEM                        PIC S9(04)  VALUE +0      01770002
017800                                                    COMP SYNC.    01780002
017900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01790002
018000                                                    COMP SYNC.    01800002
018100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01810002
018200                                                    COMP SYNC.    01820002
018300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01830002
018400                                                    COMP SYNC.    01840002
018500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01850002
018600                                                    COMP SYNC.    01860002
018700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01870002
018800                                                    COMP SYNC.    01880002
018900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01890002
019000                                                    COMP SYNC.    01900002
019100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01910002
019200                                                    COMP SYNC.    01920002
019300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01930002
019400                                                    COMP SYNC.    01940002
019500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01950002
019600                                                    COMP SYNC.    01960002
019700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01970002
019800                                                    COMP SYNC.    01980002
019900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01990002
020000                                                    COMP SYNC.    02000002
020100     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      02010002
020200                                                    COMP SYNC.    02020002
020300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02030002
020400                                                    COMP SYNC.    02040002
020500     05  PV-NULL-IND-1                  PIC S9(04)  VALUE +0      02050002
020600                                                    COMP.         02060002
020700     05  PV-NULL-IND-2                  PIC S9(04)  VALUE +0      02070002
020800                                                    COMP.         02080002
020900     05  PV-NULL-IND-3                  PIC S9(04)  VALUE +0      02090002
021000                                                    COMP.         02100002
021100     05  PV-SOFT-ABORT-MSG.                                       02110002
021200         10  FILLER            PIC X(12) VALUE ' PCKCS757 - '.    02120002
021300         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       02130002
021400         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    02140002
021500         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    02150002
021600         10  PV-SOFT-PARAGRAPH PIC X(30).                         02160002
021700     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     02170002
021800                                                     COMP SYNC.   02180002
021900     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 02190002
022000     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 02200002
022100     05  PV-CICS-MSG-HOLD.                                        02210002
022200         10  FILLER                      PIC  X(01)  VALUE SPACE. 02220002
022300         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 02230002
022400     05  PV-CICS-MSG-HOLD2.                                       02240002
022500         10  FILLER                      PIC  X(01)  VALUE SPACE. 02250002
022600         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 02260002
022700                                                                  02270002
024300     05  PV-SELECT-LIST-SEQ             PIC  X(01) VALUE SPACES.  02430005
024400     05  PV-NBR-ITEMS                   PIC  9(05) VALUE ZEROES.  02440005
024500     05  PV-SEL-TERM-ID                 PIC  X(04).               02450005
024600     05  PV-SEL-TASK-NUMBER             PIC  9(05).               02460005
024700     05  PV-SEL-SEQ                     PIC  9(01).               02470005
028600                                                                  02860002
029200*---------------------------------------------------------------* 02920002
029300*    MAP LAYOUT                                                 * 02930002
029400*---------------------------------------------------------------* 02940002
029500     COPY PCKM757.                                                02950002
029600*                                                                 02960002
029700 01  MR-OCCURS-LAYOUT                   REDEFINES  PC757AO.       02970002
029800     05  FILLER                         PIC X(042).               02980029
029900     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          02990002
030000*        10  MR-SELECTL                 PIC S9(04) COMP.          03000002
030100*        10  MR-SELECTA                 PIC  X(01).               03010002
030200*        10  MR-SELECTC                 PIC  X(01).               03020002
030300*        10  MR-SELECTH                 PIC  X(01).               03030002
030400*        10  MR-SELECTI                 PIC  X(01).               03040002
030500                                                                  03050002
030600*        10  MR-ACTIONL                 PIC S9(04) COMP.          03060002
030700*        10  MR-ACTIONA                 PIC  X(01).               03070002
030800*        10  MR-ACTIONC                 PIC  X(01).               03080002
030900*        10  MR-ACTIONH                 PIC  X(01).               03090002
031000*        10  MR-ACTION                  PIC  X(03).               03100002
031100                                                                  03110002
031200         10  MR-AREAL                   PIC S9(04) COMP.          03120002
031300         10  MR-AREAA                   PIC  X(01).               03130002
031400         10  MR-AREAC                   PIC  X(01).               03140002
031500         10  MR-AREAH                   PIC  X(01).               03150002
031600         10  MR-AREA                    PIC  X(06).               03160002
031700                                                                  03170002
031800         10  MR-GROUPL                  PIC S9(04) COMP.          03180002
031900         10  MR-GROUPA                  PIC  X(01).               03190002
032000         10  MR-GROUPC                  PIC  X(01).               03200002
032100         10  MR-GROUPH                  PIC  X(01).               03210002
032200         10  MR-GROUP                   PIC  X(06).               03220002
032500                                                                  03250002
032600         10  MR-UNITL                   PIC S9(04) COMP.          03260002
032700         10  MR-UNITA                   PIC  X(01).               03270002
032800         10  MR-UNITC                   PIC  X(01).               03280002
032900         10  MR-UNITH                   PIC  X(01).               03290002
033000         10  MR-UNIT                    PIC  9(04).               03300002
033100         10  MR-UNIT-X REDEFINES MR-UNIT PIC X(04).               03310029
033300                                                                  03330002
033400         10  MR-AREA-DESCL              PIC S9(04) COMP.          03340002
033500         10  MR-AREA-DESCA              PIC  X(01).               03350002
033600         10  MR-AREA-DESCC              PIC  X(01).               03360002
033700         10  MR-AREA-DESCH              PIC  X(01).               03370002
033800         10  MR-AREA-DESC               PIC  X(25).               03380002
034100                                                                  03410002
034200         10  MR-GROUP-DESCL             PIC S9(04) COMP.          03420002
034300         10  MR-GROUP-DESCA             PIC  X(01).               03430002
034400         10  MR-GROUP-DESCC             PIC  X(01).               03440002
034500         10  MR-GROUP-DESCH             PIC  X(01).               03450002
034600         10  MR-GROUP-DESC              PIC  X(25).               03460002
034900                                                                  03490002
038100                                                                  03810002
038200*---------------------------------------------------------------* 03820002
038300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03830002
038400*---------------------------------------------------------------* 03840002
038500     COPY DPWS015.                                                03850002
038600                                                                  03860002
038700*---------------------------------------------------------------* 03870002
038800*    FUNCTION KEYS COPYBOOK.                                    * 03880002
038900*---------------------------------------------------------------* 03890002
039000     COPY DPWS016.                                                03900002
039100                                                                  03910002
039200*---------------------------------------------------------------* 03920002
039300*    NUMERIC EDIT LAYOUT.                                       * 03930002
039400*---------------------------------------------------------------* 03940002
039500     COPY DPWS010I.                                               03950002
039600                                                                  03960002
039700*---------------------------------------------------------------* 03970002
039800*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 03980002
039900*---------------------------------------------------------------* 03990002
040000     COPY DPWS030.                                                04000002
1122RM     COPY DPWS930.                                                04001034
040100                                                                  04010002
040200*---------------------------------------------------------------* 04020002
040300*    STANDARD COMMAREA.                                         * 04030002
040400*---------------------------------------------------------------* 04040002
040500     COPY DPWS020.                                                04050002
040600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04060002
040700                                                                  04070002
040800*---------------------------------------------------------------* 04080002
040900* INTER-APPLICATION COMMAREA.                                   * 04090002
041000*   PCWS213 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 04100002
041100*             SPEC SCREEN.                                      * 04110002
041400*---------------------------------------------------------------* 04140002
041500                                                                  04150002
041600         10  INTER-APPL-COMM-AREA       PIC X(200).               04160002
041700     COPY PCWS213.                                                04170002
041900*---------------------------------------------------------------* 04190002
042000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04200002
042100*---------------------------------------------------------------* 04210007
042200         10  ASC-SPECIFIC-COMMAREA.                               04220002
042300             15  ASC-OPER-NBR-X              PIC  X(04).          04230002
042400             15  ASC-OPER-NBR-N REDEFINES ASC-OPER-NBR-X.         04240002
042500                 20  ASC-OPER-NBR            PIC  9(04).          04250002
044300             15  ASC-PROCESS-GROUP           PIC  X(06).          04430002
044400             15  ASC-PROCESS-AREA            PIC  X(06).          04440002
044700             15  ASC-AREA-DESC               PIC  X(25).          04470029
044800             15  ASC-GROUP-DESC              PIC  X(25).          04480029
045300             15  FILLER                      PIC  X(025).         04530002
045400*-----------------------------------------------------------------04540002
045500             15  ASC-BLK-SUB                  PIC S9(04) COMP     04550002
045600                                                         SYNC.    04560002
045700             15  ASC-ITEM-SUB                 PIC S9(04) COMP     04570002
045800                                                         SYNC.    04580002
045900             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  04590002
046000             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  04600002
046100             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  04610002
046200             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  04620002
046300             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  04630002
046400             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     04640002
046500                                                         SYNC.    04650002
046600             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  04660002
046700             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  04670002
046800             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         04680002
046900                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     04690002
047000                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     04700002
047100             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         04710002
047200                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     04720002
047300                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04730002
047400             15  ASC-LIST-QUEUE-NAME.                             04740002
047500                 20  ASC-LIST-TERM-ID         PIC  X(04).         04750002
047600                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  04760002
047700                 20  ASC-LIST-SEQ             PIC  9(01).         04770002
047800                                                                  04780002
047900             15  ASC-START-ITEM-REQUEST.                          04790002
048000                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         04800002
048100                                                                  04810002
048200             15  ASC-SEL-SUB                  PIC S9(4) COMP.     04820002
048300             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     04830002
048400             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          04840002
048500                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 04850002
048600             15  ASC-SEL-QUEUE-NAME.                              04860002
048700                 20  ASC-SEL-TERM-ID          PIC  X(04).         04870002
048800                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  04880002
048900                 20  ASC-SEL-SEQ              PIC  9(01).         04890002
049000             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  04900002
049100                                                                  04910002
049200*-----------------------------------------------------------------04920002
049300             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04930002
049400                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04940002
049500                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04950002
049600                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04960002
049700                                                                  04970002
049800                 20  ASC-ITEM-ARRAY.                              04980002
049900                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        04990002
050000                         30  ASC-LIST-ITEM-NUMBER                 05000002
050100                                                     PIC S9(09)   05010002
050200                                                     COMP-3.      05020002
050300                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  05030002
050400                             88  ASC-VALID-SELECT    VALUE ' '    05040002
050500                                                           'S'    05050002
050600                                                           'B'    05060002
050700                                                           'E'.   05070002
050800                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   05080002
050900                             88  ASC-TEMP-SELECT     VALUE 'S'.   05090002
051000                             88  ASC-TEMP-BEGIN      VALUE 'B'.   05100002
051100                             88  ASC-TEMP-END        VALUE 'E'.   05110002
051200                         30  ASC-SELECTED-SW         PIC  X(01).  05120002
051300                             88  ASC-NO-SELECT       VALUE ' '.   05130002
051400                             88  ASC-SELECT          VALUE 'S'.   05140002
051500                             88  ASC-BEGIN           VALUE 'B'.   05150002
051600                             88  ASC-END             VALUE 'E'.   05160002
051700*                        30  ASC-ACTION             PIC  X(03).   05170017
051800                         30  ASC-AREA               PIC  X(06).   05180002
051900                         30  ASC-GROUP              PIC  X(06).   05190029
052000                         30  ASC-UNIT               PIC  9(04).   05200029
052100                         30  ASC-AREADESC           PIC  X(25).   05210029
052200                         30  ASC-GROUPDESC          PIC  X(25).   05220029
052700                                                                  05270002
052800*---------------------------------------------------------------* 05280002
052900*    ABEND PROCESSING COPYBOOK.                                 * 05290002
053000*---------------------------------------------------------------* 05300002
053100     COPY DPWS013.                                                05310002
053200                                                                  05320002
053300*---------------------------------------------------------------* 05330002
053400*    TFLAREA  - AREA TABLE                                        05340029
053500*---------------------------------------------------------------* 05350002
053600     EXEC SQL                                                     05360002
053700          INCLUDE TFLAREA                                         05370011
053800     END-EXEC.                                                    05380002
053900                                                                  05390002
053901*---------------------------------------------------------------* 05390129
053902*    PCT_PRC_AREA_ASSN - PROCESS AREA ASSOCIATION TABLE           05390211
053903*---------------------------------------------------------------* 05390302
053904     EXEC SQL                                                     05390402
053905          INCLUDE PCT00003                                        05390511
053906     END-EXEC.                                                    05390602
053907                                                                  05390702
055400*---------------------------------------------------------------* 05540011
055500*    PCT_PRC_AREA_GP - PROCESS GROUP DESCRIPTION TABLE            05550029
055600*---------------------------------------------------------------* 05560011
055700     EXEC SQL                                                     05570011
055800          INCLUDE PCT00002                                        05580029
055900     END-EXEC.                                                    05590011
056000                                                                  05600011
056100*---------------------------------------------------------------* 05610010
056200*    PROCESS AREA CURSOR                                          05620010
056300*---------------------------------------------------------------* 05630010
056400     EXEC SQL                                                     05640010
056500          DECLARE PROCESS-AREA-CSR CURSOR FOR                     05650010
056600          SELECT  A.PRCG_AREA_CDE                                 05660029
056700                 ,A.PRC_AREA_GP_CDE                               05670029
056800                 ,A.OPER_UNT_ID                                   05680029
056900                 ,B.FCLTY_AREA_DESC                               05690029
057000                 ,C.PRC_AREA_GP_DESC                              05700029
057100            FROM  PCT_PRC_AREA_ASSN A                             05710029
057200                 ,TFLAREA B                                       05720029
057300                 ,PCT_PRC_AREA_GP C                               05730029
057400            WHERE A.PRCG_AREA_CDE   = B.FCLTY_AREA_ID             05740029
057500              AND A.OPER_UNT_ID     = B.OPER_UNT_ID               05750029
057600              AND A.PRC_AREA_GP_CDE = C.PRC_AREA_GP_CDE           05760029
057700              AND A.OPER_UNT_ID     = :DK-OPER-UNT-ID             05770029
057800              AND B.FCLTY_ID        = 1                           05780029
057801              ORDER BY A.PRCG_AREA_CDE                            05780129
057802     END-EXEC.                                                    05780210
057803                                                                  05780310
057804*---------------------------------------------------------------* 05780429
057805*    UNKNOWN OPER UNIT PROCESS AREA CURSOR                        05780529
057806*---------------------------------------------------------------* 05780629
057807     EXEC SQL                                                     05780729
057808          DECLARE UK-OPER-AREA-CSR CURSOR FOR                     05780829
057809          SELECT  A.PRCG_AREA_CDE                                 05780929
057810                 ,A.PRC_AREA_GP_CDE                               05781029
057820                 ,A.OPER_UNT_ID                                   05782029
057830                 ,B.FCLTY_AREA_DESC                               05783029
057840                 ,C.PRC_AREA_GP_DESC                              05784029
057850            FROM  PCT_PRC_AREA_ASSN A                             05785029
057860                 ,TFLAREA B                                       05786029
057870                 ,PCT_PRC_AREA_GP C                               05787029
057880            WHERE A.PRCG_AREA_CDE   = B.FCLTY_AREA_ID             05788029
057890              AND A.OPER_UNT_ID     = B.OPER_UNT_ID               05789029
057900              AND A.PRC_AREA_GP_CDE = C.PRC_AREA_GP_CDE           05790029
058000              AND B.FCLTY_ID        = 1                           05800029
058001              ORDER BY A.PRCG_AREA_CDE                            05800129
058002     END-EXEC.                                                    05800229
058003                                                                  05800329
058004*---------------------------------------------------------------* 05800429
058005*    PROCESS GROUP CURSOR                                         05800529
058006*---------------------------------------------------------------* 05800629
058007     EXEC SQL                                                     05800729
058008          DECLARE PROCESS-GROUP-CSR CURSOR FOR                    05800829
058009          SELECT  A.PRCG_AREA_CDE                                 05800929
058010                 ,A.PRC_AREA_GP_CDE                               05801029
058020                 ,A.OPER_UNT_ID                                   05802029
058030                 ,B.FCLTY_AREA_DESC                               05803029
058040                 ,C.PRC_AREA_GP_DESC                              05804029
058050            FROM  PCT_PRC_AREA_ASSN A                             05805029
058060                 ,TFLAREA B                                       05806029
058070                 ,PCT_PRC_AREA_GP C                               05807029
058080            WHERE A.PRCG_AREA_CDE   = B.FCLTY_AREA_ID             05808029
058090              AND A.OPER_UNT_ID     = B.OPER_UNT_ID               05809029
058100              AND A.PRC_AREA_GP_CDE = C.PRC_AREA_GP_CDE           05810029
058200              AND A.OPER_UNT_ID     = :DK-OPER-UNT-ID             05820029
058300              AND B.FCLTY_ID        = 1                           05830029
058301            ORDER BY A.PRC_AREA_GP_CDE, A.PRCG_AREA_CDE           05830129
058302     END-EXEC.                                                    05830229
058303                                                                  05830329
058304*---------------------------------------------------------------* 05830429
058305*    UNKNOWN OPER UNIT PROCESS GROUP CURSOR                       05830529
058306*---------------------------------------------------------------* 05830629
058307     EXEC SQL                                                     05830729
058308          DECLARE UK-OPER-GROUP-CSR CURSOR FOR                    05830829
058309          SELECT  A.PRCG_AREA_CDE                                 05830929
058310                 ,A.PRC_AREA_GP_CDE                               05831029
058320                 ,A.OPER_UNT_ID                                   05832029
058330                 ,B.FCLTY_AREA_DESC                               05833029
058340                 ,C.PRC_AREA_GP_DESC                              05834029
058350            FROM  PCT_PRC_AREA_ASSN A                             05835029
058360                 ,TFLAREA B                                       05836029
058370                 ,PCT_PRC_AREA_GP C                               05837029
058380            WHERE A.PRCG_AREA_CDE   = B.FCLTY_AREA_ID             05838029
058390              AND A.OPER_UNT_ID     = B.OPER_UNT_ID               05839029
058400              AND A.PRC_AREA_GP_CDE = C.PRC_AREA_GP_CDE           05840029
058500              AND B.FCLTY_ID        = 1                           05850029
058600            ORDER BY A.PRC_AREA_GP_CDE, A.PRCG_AREA_CDE,          05860029
058601                     A.OPER_UNT_ID                                05860129
058602     END-EXEC.                                                    05860229
058603                                                                  05860329
061160*---------------------------------------------------------------* 06116029
061200*    DB2 AREA FOR COMMUNICATIONS                                * 06120002
061300*---------------------------------------------------------------* 06130002
061400     EXEC SQL                                                     06140002
061500          INCLUDE SQLCA                                           06150002
061600     END-EXEC.                                                    06160002
061700                                                                  06170002
061800*-----------------------------------------------------------------06180002
061900 LINKAGE SECTION.                                                 06190002
062000                                                                  06200002
062100 01  DFHCOMMAREA.                                                 06210002
062200     05  FILLER                         OCCURS  1 TO 4072 TIMES   06220002
062300                                        DEPENDING ON EIBCALEN.    06230002
062400         10  FILLER                     PIC X.                    06240002
062500                                                                  06250002
062600                                                                  06260002
062700 PROCEDURE DIVISION.                                              06270002
062800******************************************************************06280002
062900**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **06290002
063000**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **06300002
063100**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **06310002
063200******************************************************************06320002
063300 0000-MAIN-MODULE.                                                06330002
063400     INITIALIZE DP030-CICS-API-FIELDS.                            06340002
063500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06350002
063600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06360002
063700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06370002
063800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06380002
063900     MOVE LENGTH OF PC757AI        TO DP030-MAP-LENGTH (1).       06390002
064000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06400002
064100     PERFORM 0001-CALL-CICS-ARCH-API.                             06410002
064200*                                                                 06420002
064300     PERFORM 1000-CONTROL-PROCESSING                              06430002
064400*                                                                 06440002
064500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06450002
064600     PERFORM 0001-CALL-CICS-ARCH-API.                             06460002
064700                                                                  06470002
064800******************************************************************06480002
064900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06490002
065000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06500002
065100******************************************************************06510002
065200 0001-CALL-CICS-ARCH-API.                                         06520002
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               06530034
1122RM     CALL DP930-CICS-ARCH-API                                     06531034
1122RM                     USING DFHEIBLK                               06532034
065400                           DFHCOMMAREA                            06540002
065500                           DP030-CICS-API-FIELDS                  06550002
065600                           DP020-STANDARD-COMMAREA                06560002
065700                           PC757AI.                               06570002
065800*                                                                 06580002
065900     IF  DP030-RC-CALL-SUCCESSFUL                                 06590002
066000         CONTINUE                                                 06600002
066100     ELSE                                                         06610002
066200         SET DP013-NO-ROLLBACK                                    06620002
066300             DP013-XCTL-DISPLAY-RESTART                           06630002
066400             DP013-CICS-ABEND      TO TRUE                        06640002
066500         MOVE '0001-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        06650002
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX06660034
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      06670034
1122rm         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06671034
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06672034
066800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06680002
066900         PERFORM DP013-0000-PROCESS-ABEND                         06690002
067000     END-IF.                                                      06700002
067100                                                                  06710002
067200*----------------------------------------------------------------*06720002
067300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06730002
067400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06740002
067500*                                                                *06750002
067600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06760002
067700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06770002
067800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06780002
067900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06790002
068000*----------------------------------------------------------------*06800002
068100 1000-CONTROL-PROCESSING.                                         06810002
068200                                                                  06820002
068300     EVALUATE TRUE                                                06830002
068400         WHEN DP020-NEXT-ACT-INITIAL                              06840002
068500             INITIALIZE ASC-SPECIFIC-COMMAREA                     06850002
068600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06860002
068700                                      ASC-SEL-TERM-ID             06870002
068800             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   06880002
068900                                           ASC-SEL-TASK-NUMBER    06890002
069000             MOVE PC-LIST-QUEUE-SEQ  TO ASC-LIST-SEQ              06900002
069100             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06910002
069200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06920002
069300             MOVE SPACE TO PS-CURSOR-SW                           06930029
069400             IF ASC-OPER-NBR > ZEROES                             06940029
069500                 MOVE ASC-OPER-NBR TO DK-OPER-UNT-ID              06950029
069600                 SET PS-PROCESS-AREA-CSR TO TRUE                  06960029
069700             ELSE                                                 06970029
069800                 SET PS-UK-OPER-AREA-CSR TO TRUE                  06980029
069801             END-IF                                               06980129
069802             PERFORM 4000-BUILD-INITIAL-PANEL                     06980202
070300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07030002
070301                                                                  07030129
070302         WHEN DP020-NEXT-ACT-READ-MAP                             07030202
070303             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         07030302
070304             PERFORM 2000-PROCESS-PANEL                           07030402
070305                                                                  07030502
070306         WHEN DP020-NEXT-ACT-RETURN                               07030602
070307             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         07030702
070308             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               07030802
070309             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07030902
070400                                                                  07040002
070500         WHEN OTHER                                               07050002
070600             SET DP013-LOGIC-ABEND TO TRUE                        07060002
070700             SET DP013-NO-ROLLBACK TO TRUE                        07070002
070800             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    07080002
070900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    07090002
071000                                   TO DP013-MESSAGE-TEXT(1)       07100002
071100             PERFORM DP013-0000-PROCESS-ABEND                     07110002
071200     END-EVALUATE.                                                07120002
071300                                                                  07130002
071400*----------------------------------------------------------------*07140002
071500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *07150002
071600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *07160002
071700*----------------------------------------------------------------*07170002
071800 1100-PROCESS-INTER-APPL-COMM.                                    07180029
071900                                                                  07190002
072000     SET PS-COMMAREA-VALID         TO TRUE.                       07200002
072100     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07210002
072200                                                                  07220002
072300     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          07230002
072400         MOVE PC213-OPER-UNT-ID       TO ASC-OPER-NBR             07240007
074600     END-IF.                                                      07460002
074700                                                                  07470002
082900*----------------------------------------------------------------*08290002
083000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08300002
083100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08310002
083200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08320002
083300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08330002
083400* FUNCTION KEYS CAN GET THIS FAR.                                *08340002
083500*----------------------------------------------------------------*08350002
083600 2000-PROCESS-PANEL.                                              08360002
083700     EVALUATE TRUE                                                08370002
083800         WHEN DP020-SRC-AID = DP016-CLEAR                         08380002
083900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08390002
084100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08410002
084200                                                                  08420002
084300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08430002
084600             PERFORM 2050-DELETE-LIST-QUEUE                       08460029
084700             MOVE SPACE TO PS-CURSOR-SW                           08470029
084800             IF ASC-OPER-NBR > ZEROES                             08480029
084900                 MOVE ASC-OPER-NBR TO DK-OPER-UNT-ID              08490029
085000                 SET PS-PROCESS-AREA-CSR TO TRUE                  08500029
085100             ELSE                                                 08510029
085200                 SET PS-UK-OPER-AREA-CSR TO TRUE                  08520029
085201             END-IF                                               08520129
085202             PERFORM 4000-BUILD-INITIAL-PANEL                     08520229
085203             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08520329
085204                                                                  08520402
088300         WHEN OTHER                                               08830002
088700             IF  PS-NO-ERROR                                      08870002
088800                 SET DP030-CONTINUE-GO TO TRUE                    08880002
088810                 PERFORM 2200-MOVE-SCREEN-TO-COMMAREA             08881029
088900                 PERFORM 2100-CHECK-FUNCTION-KEY                  08890002
089000             ELSE                                                 08900002
089100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08910002
089200                 SET DP030-OVERRIDE-GO TO TRUE                    08920002
089300             END-IF                                               08930002
089400     END-EVALUATE.                                                08940002
089500                                                                  08950002
089600*----------------------------------------------------------------*08960029
089700*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08970029
089800*----------------------------------------------------------------*08980029
089900 2050-DELETE-LIST-QUEUE.                                          08990029
090000                                                                  09000029
090100     EXEC CICS                                                    09010029
090200         DELETEQ TS                                               09020029
090300             QUEUE (ASC-LIST-QUEUE-NAME)                          09030029
090400             RESP  (PV-CICS-RESP)                                 09040029
090500     END-EXEC.                                                    09050029
090600                                                                  09060029
090700     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       09070029
090800        (PV-CICS-RESP = DFHRESP(QIDERR))                          09080029
090900         CONTINUE                                                 09090029
091000     ELSE                                                         09100029
091100         SET DP013-CICS-ABEND      TO TRUE                        09110029
091200         SET DP013-NO-ROLLBACK     TO TRUE                        09120029
091300                                                                  09130029
091400         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         09140029
091500         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09150029
091600                                   TO DP013-MESSAGE-TEXT (1)      09160029
091700         PERFORM DP013-0000-PROCESS-ABEND                         09170029
091800     END-IF.                                                      09180029
091900                                                                  09190029
092000     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09200029
092100                                                                  09210029
092200*----------------------------------------------------------------*09220002
092300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09230002
092400* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09240002
092500* CICS ARCHITECTURE API.                                         *09250002
092600*----------------------------------------------------------------*09260002
092700 2100-CHECK-FUNCTION-KEY.                                         09270029
092800                                                                  09280029
092900     EVALUATE TRUE                                                09290029
093000*                                                                 09300029
093100* F17 - SORT BY PROCESS AREA                                      09310029
093200         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09320029
093300             MOVE SPACE TO PS-CURSOR-SW                           09330029
093400             IF ASC-OPER-NBR > ZEROES                             09340029
093500                 MOVE ASC-OPER-NBR TO DK-OPER-UNT-ID              09350029
093600                 SET PS-PROCESS-AREA-CSR TO TRUE                  09360029
093700             ELSE                                                 09370029
093800                 SET PS-UK-OPER-AREA-CSR TO TRUE                  09380029
093900             END-IF                                               09390029
094000             PERFORM 2050-DELETE-LIST-QUEUE                       09400029
094100             PERFORM 4000-BUILD-INITIAL-PANEL                     09410029
094200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09420029
094300                                                                  09430029
094400* F18 - SORT BY PROCESS GROUP                                     09440029
094500         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              09450029
094600             MOVE SPACE TO PS-CURSOR-SW                           09460029
094700             IF ASC-OPER-NBR > ZEROES                             09470029
094800                 MOVE ASC-OPER-NBR TO DK-OPER-UNT-ID              09480029
094900                 SET PS-PROCESS-GROUP-CSR TO TRUE                 09490029
095000             ELSE                                                 09500029
095100                 SET PS-UK-OPER-GROUP-CSR TO TRUE                 09510029
095200             END-IF                                               09520029
095300             PERFORM 2050-DELETE-LIST-QUEUE                       09530029
095400             PERFORM 4000-BUILD-INITIAL-PANEL                     09540029
095500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09550029
095600                                                                  09560029
104500* F6 - FIRST PAGE                                                 10450002
104600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  10460002
104700             MOVE +1               TO PV-TOP-ITEM                 10470002
104800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10480002
104900*                                                                 10490002
105000* F7 - PREVIOUS PAGE                                              10500002
105100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   10510002
105200             PERFORM 2110-BROWSE-BACKWARD                         10520002
105300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10530002
105400*                                                                 10540002
105500* F8 - NEXT PAGE                                                  10550002
105600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   10560002
105700             PERFORM 2120-BROWSE-FORWARD                          10570002
105800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10580002
105900*                                                                 10590002
106000* ENTER KEY                                                       10600002
106100         WHEN DP020-SRC-AID = DP016-ENTER                         10610002
106200             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   10620002
106300             IF  PS-ERROR                                         10630002
106400                 CONTINUE                                         10640002
106500             ELSE                                                 10650002
106600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10660002
106700             END-IF                                               10670002
106800                                                                  10680002
106900         WHEN OTHER                                               10690002
107000             SET DP013-NO-ROLLBACK                                10700002
107100                 DP013-XCTL-DISPLAY-RESTART                       10710002
107200                 DP013-CICS-ABEND  TO TRUE                        10720002
107300             MOVE '2100-CHECK-FUNCTION-KEY'                       10730002
107400                                   TO DP013-PARAGRAPH             10740002
107500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10750002
107600                                   TO DP013-MESSAGE-TEXT (1)      10760002
107700             PERFORM DP013-0000-PROCESS-ABEND                     10770002
107800     END-EVALUATE.                                                10780002
107900*                                                                 10790002
108000*----------------------------------------------------------------*10800002
108100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *10810002
108200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *10820002
108300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *10830002
108400*    MESSAGE.                                                    *10840002
108500*----------------------------------------------------------------*10850002
108600 2110-BROWSE-BACKWARD.                                            10860002
108700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    10870002
108800         GIVING PV-TOP-ITEM.                                      10880002
108900*                                                                 10890002
109000     IF  ((PV-TOP-ITEM < +1)                                      10900002
109100       OR (PV-TOP-ITEM = +1))                                     10910002
109200         MOVE +1                   TO PV-TOP-ITEM                 10920002
109300*        -- TOP OF LIST --                                        10930002
109400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            10940002
109500         SET DP020-MSG-INFORMATIONAL TO TRUE                      10950002
109600     END-IF.                                                      10960002
109700                                                                  10970002
109800*----------------------------------------------------------------*10980002
109900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *10990002
110000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *11000002
110100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *11010002
110200*----------------------------------------------------------------*11020002
110300 2120-BROWSE-FORWARD.                                             11030002
110400                                                                  11040002
110500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              11050002
110600         GIVING PV-TOP-ITEM.                                      11060002
110700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   11070002
110800         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             11080002
110900*        -- BOTTOM OF LIST --                                     11090002
111000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            11100002
111100         SET DP020-MSG-INFORMATIONAL  TO TRUE                     11110002
111200     ELSE                                                         11120002
111300         COMPUTE PV-BOTTOM-ITEM =                                 11130002
111400             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 11140002
111500         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            11150002
111600*            -- BOTTOM OF LIST --                                 11160002
111700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11170002
111800             SET DP020-MSG-INFORMATIONAL TO TRUE                  11180002
111900         END-IF                                                   11190002
112000     END-IF.                                                      11200002
112100                                                                  11210002
112200*----------------------------------------------------------------*11220002
112300*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *11230002
112400*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *11240002
112500*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *11250002
112600*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *11260002
112700*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *11270002
112800*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *11280002
112900*----------------------------------------------------------------*11290002
113000 2130-CHECK-FOR-JUMP-BROWSE.                                      11300002
113100     SET PS-NO-ERROR               TO TRUE.                       11310002
113200     IF (ASC-START-ITEM-REQUEST = SPACE)                          11320002
113300         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             11330002
113400     ELSE                                                         11340002
113500         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     11350002
113600         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       11360002
113700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     11370002
113800         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  11380002
113910         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11391031
113920                         USING DP010I-NUMERIC-EDIT-AREA           11392031
114000                                                                  11400002
114100         IF  NOT DP010I-ERROR-DETECTED                            11410002
114200             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N11420002
114300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  11430002
114400                 IF  ASC-START-ITEM-REQUEST-N >                   11440002
114500                                          ASC-NUMBER-OF-ITEMS-READ11450002
114600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         11460002
114700                     COMPUTE PV-TOP-ITEM =                        11470002
114800                             ASC-NUMBER-OF-ITEMS-READ             11480002
114900                             - PC-ITEMS-PER-PANEL + 1             11490002
115000                     IF  PV-TOP-ITEM < +1                         11500002
115100                         MOVE +1   TO PV-TOP-ITEM                 11510002
115200                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 11520002
115300                         SET DP020-MSG-INFORMATIONAL TO TRUE      11530002
115400                     END-IF                                       11540002
115500                 ELSE                                             11550002
115600                     MOVE ASC-START-ITEM-REQUEST-N TO PV-TOP-ITEM 11560002
115700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      11570002
115800                     COMPUTE PV-BOTTOM-ITEM =                     11580002
115900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     11590002
116000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ11600002
116100*                        -- BOTTOM OF LIST --                     11610002
116200                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 11620002
116300                         SET DP020-MSG-INFORMATIONAL TO TRUE      11630002
116400                     END-IF                                       11640002
116500                 END-IF                                           11650002
116600             ELSE                                                 11660002
116700*                --- VALUE OUT OF RANGE ----                      11670002
116800                 MOVE PC-TSYMSG-00101  TO DP020-MSG-NUMBER        11680002
116900                 MOVE -1           TO ASTRTITL                    11690002
117000                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              11700002
117100                 MOVE DP015-REVERSE TO ASTRTITH                   11710002
117200                 MOVE DP015-RED    TO ASTRTITC                    11720002
117300                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           11730002
117400                 SET DP020-MSG-FATAL                              11740002
117500                     PS-ERROR        TO TRUE                      11750002
117600             END-IF                                               11760002
117700         ELSE                                                     11770002
117900             MOVE -1               TO ASTRTITL                    11790002
118000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11800002
118100             MOVE DP015-REVERSE    TO ASTRTITH                    11810002
118200             MOVE DP015-RED        TO ASTRTITC                    11820002
118300             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               11830002
118400             SET DP020-MSG-FATAL   TO TRUE                        11840002
118500             SET PS-ERROR          TO TRUE                        11850002
118600         END-IF                                                   11860002
118700     END-IF.                                                      11870002
118800                                                                  11880002
118900******************************************************************11890029
119000** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **11900029
119100** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **11910029
119200******************************************************************11920029
119300 2200-MOVE-SCREEN-TO-COMMAREA.                                    11930029
119400                                                                  11940029
119500     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             11950029
119600     MOVE +1                       TO PV-SUB.                     11960029
119700*                                                                 11970029
119800     PERFORM 3100-SET-SUBSCRIPTS.                                 11980029
119900     IF  ASTRTITL > ZERO                                          11990029
120000         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12000029
120100     ELSE                                                         12010029
120200         IF  ASTRTITF = DP015-ERASE-EOF                           12020029
120300             INITIALIZE ASC-START-ITEM-REQUEST                    12030029
120400         END-IF                                                   12040029
120500     END-IF.                                                      12050029
120600                                                                  12060029
120700*----------------------------------------------------------------*12070029
120800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12080029
120900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12090029
121000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12100029
121100*                                                                *12110029
121200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12120029
121300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12130029
121400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12140029
121500*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12150029
121600*----------------------------------------------------------------*12160029
121700 3100-SET-SUBSCRIPTS.                                             12170029
121800                                                                  12180029
121900     COMPUTE ASC-ITEM-SUB =                                       12190029
122000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12200029
122100                                                                  12210029
122200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12220029
122300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12230029
122400         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               12240029
122500     ELSE                                                         12250029
122600         MOVE +1                     TO ASC-BLK-SUB               12260029
122700     END-IF.                                                      12270029
150000******************************************************************15000002
150100** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **15010002
150200** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **15020002
150300** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**15030002
150400** THE ENDING.                                                  **15040002
150500******************************************************************15050002
150600 3310-EDIT-RANGE.                                                 15060002
150700     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                15070002
150800         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   15080002
150900             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)15090002
151000                                   TO ASC-SELECTED-SW             15100002
151100                                        (ASC-BLK-SUB ASC-ITEM-SUB)15110002
151200             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 15120002
151300         ELSE                                                     15130002
151400             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     15140002
151500                 CONTINUE                                         15150002
151600             ELSE                                                 15160002
151700*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        15170002
151800                 MOVE PC-TSYMSG-00054                             15180002
151900                                       TO DP020-MSG-NUMBER        15190002
152000                 MOVE -1               TO ASTRTITL                15200002
152100                 SET DP020-MSG-FATAL                              15210002
152200                     DP030-SET-CURSOR-APPL-1                      15220002
152300                     PS-ERROR          TO TRUE                    15230002
152400             END-IF                                               15240002
152500         END-IF                                                   15250002
152600     ELSE                                                         15260002
152700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15270002
152800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15280002
152900                                   TO ASC-SELECTED-SW             15290002
153000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15300002
153100             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15310002
153200         ELSE                                                     15320002
153300             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15330002
153400                 CONTINUE                                         15340002
153500             ELSE                                                 15350002
153600*                -- ONLY ONE END-OF-RANGE ALLOWED --              15360002
153700                 MOVE PC-TSYMSG-00055                             15370002
153800                                        TO DP020-MSG-NUMBER       15380002
153900                 MOVE -1                TO ASTRTITL               15390002
154000                 SET DP020-MSG-FATAL                              15400002
154100                     DP030-SET-CURSOR-APPL-1                      15410002
154200                     PS-ERROR           TO TRUE                   15420002
154300             END-IF                                               15430002
154400         END-IF                                                   15440002
154500     END-IF.                                                      15450002
154600*                                                                 15460002
154700******************************************************************15470002
154800** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **15480002
154900** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **15490002
155000******************************************************************15500002
155100 3400-CHECK-RANGE-SEQUENCE.                                       15510002
155200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       15520002
155300       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      15530002
155400       AND  ASC-START-OF-SELECTED-RANGE >                         15540002
155500                                         ASC-END-OF-SELECTED-RANGE15550002
155600*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                15560002
155700         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 15570002
155800         SET DP020-MSG-FATAL TO TRUE                              15580002
155900         SET PS-ERROR TO TRUE                                     15590002
156000         PERFORM 3410-POSITION-AT-ERROR                           15600002
156100     END-IF.                                                      15610002
156200******************************************************************15620002
156300** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **15630002
156400** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **15640002
156500** SHOULD BE POSITIONED ON A RANGE ERROR.                       **15650002
156600******************************************************************15660002
156700 3410-POSITION-AT-ERROR.                                          15670002
156800     SET DP030-SET-CURSOR-APPL-1                                  15680002
156900                                   TO TRUE.                       15690002
157000     MOVE -1                       TO ASTRTITL                    15700002
157100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15710002
157200                    - PV-TOP-ITEM + 1.                            15720002
157300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15730002
157400         CONTINUE                                                 15740002
157500     END-IF.                                                      15750002
157600*                                                                 15760002
157700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15770002
157800                    - PV-TOP-ITEM + 1.                            15780002
157900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15790002
158000         CONTINUE                                                 15800002
158100     END-IF.                                                      15810002
158200                                                                  15820002
169600*----------------------------------------------------------------*16960002
169700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16970002
169800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16980002
169900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16990002
170000*    DISPLAY THE PANEL TO USER.                                  *17000002
170100*----------------------------------------------------------------*17010002
170200 4000-BUILD-INITIAL-PANEL.                                        17020002
170300                                                                  17030002
170400     INITIALIZE    ASC-BLOCK-ENTRIES (1)                          17040029
170500                   ASC-BLOCK-ENTRIES (2).                         17050029
170600     MOVE +1                 TO ASC-BLK-SUB.                      17060002
170700     SET ASC-ITEMS-LEFT-ON-DB   TO TRUE.                          17070002
170900                                                                  17090002
171000     MOVE +0                 TO ASC-ITEM-SUB                      17100002
171100                                ASC-NUMBER-OF-ITEMS-READ          17110002
171200                                ASC-NUMBER-OF-SELECTED-ITEMS      17120002
171300                                ASC-HIGHEST-BLOCK-WRITTEN         17130002
171400                                ASC-START-OF-SELECTED-RANGE       17140002
171500                                ASC-END-OF-SELECTED-RANGE         17150002
171600                                ASC-ITEM-AT-TOP-OF-PANEL.         17160002
171700                                                                  17170002
174200     PERFORM 4010-OPEN-CURSOR.                                    17420002
174300     PERFORM 4300-READ-ITEMS-FROM-DB.                             17430002
174400     PERFORM 4020-CLOSE-CURSOR.                                   17440002
174500                                                                  17450002
174600     MOVE +1                   TO  PV-TOP-ITEM.                   17460002
174700     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          17470002
174800         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    17480002
174900         SET DP020-MSG-FATAL   TO  TRUE                           17490002
175100     ELSE                                                         17510002
175200*        MOVE -1               TO MR-SELECTL (1)                  17520029
175210         MOVE -1               TO  ASTRTITL                       17521029
175300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      17530002
175400*        PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17540002
175500     END-IF.                                                      17550002
175600                                                                  17560002
196400*----------------------------------------------------------------*19640028
196500* OPEN THE CURSOR                                                 19650002
196600*----------------------------------------------------------------*19660002
196700 4010-OPEN-CURSOR.                                                19670002
196800     PERFORM                                                      19680002
196900         WITH TEST AFTER                                          19690002
197000         VARYING PV-RETRY-COUNTER                                 19700002
197100         FROM 1 BY 1                                              19710002
197200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19720002
197300                   OR (SQLCODE = ZERO))                           19730002
197400                                                                  19740002
197500         EVALUATE TRUE                                            19750029
197600             WHEN PS-PROCESS-AREA-CSR                             19760029
197700                 EXEC SQL                                         19770029
197800                      OPEN PROCESS-AREA-CSR                       19780029
197900                 END-EXEC                                         19790029
198000             WHEN PS-UK-OPER-AREA-CSR                             19800029
198100                 EXEC SQL                                         19810029
198200                      OPEN UK-OPER-AREA-CSR                       19820029
198300                 END-EXEC                                         19830029
198310             WHEN PS-PROCESS-GROUP-CSR                            19831029
198320                 EXEC SQL                                         19832029
198330                      OPEN PROCESS-GROUP-CSR                      19833029
198340                 END-EXEC                                         19834029
198350             WHEN PS-UK-OPER-GROUP-CSR                            19835029
198360                 EXEC SQL                                         19836029
198370                      OPEN UK-OPER-GROUP-CSR                      19837029
198380                 END-EXEC                                         19838029
198400         END-EVALUATE                                             19840029
198500                                                                  19850029
198600         EVALUATE TRUE                                            19860002
198700             WHEN SQLCODE = ZERO                                  19870002
198800             WHEN SQLCODE = -904                                  19880002
198900             WHEN SQLCODE = -913                                  19890002
199000                 CONTINUE                                         19900002
199100             WHEN SQLWARN0 NOT = SPACES                           19910002
199200             WHEN SQLCODE < ZERO                                  19920002
199300             WHEN SQLCODE > ZERO                                  19930002
199400                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       19940002
199500                 MOVE 'OPEN CURSOR PROBLEM    - '                 19950002
199600                                   TO DP013-MESSAGE-TEXT (1)      19960002
199700                 MOVE SQLCA        TO DP013-SQLCA                 19970002
199800                 MOVE 'PCT_PRC_AREA_ASSN' TO                      19980010
199900                                    DP013-DB2-TABLE-NAME (1)      19990010
200000                 SET DP013-DB2-ABEND                              20000002
200100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20010002
200200                 PERFORM DP013-0000-PROCESS-ABEND                 20020002
200300         END-EVALUATE                                             20030002
200400     END-PERFORM.                                                 20040002
200500*                                                                 20050002
200600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20060002
200700         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             20070002
200800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   20080002
200900                                   TO DP013-MESSAGE-TEXT (1)      20090002
201000         MOVE SQLCA                TO DP013-SQLCA                 20100002
201100         MOVE 'PCT_PRC_AREA_ASSN'  TO DP013-DB2-TABLE-NAME (1)    20110010
201200         SET DP013-DB2-ABEND                                      20120002
201300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   20130002
201400         PERFORM DP013-0000-PROCESS-ABEND                         20140002
201500     END-IF.                                                      20150002
201600                                                                  20160002
201700*----------------------------------------------------------------*20170002
201800* CLOSE THE CURSOR.                                               20180002
201900*----------------------------------------------------------------*20190002
202000 4020-CLOSE-CURSOR.                                               20200002
202100                                                                  20210002
202200     EVALUATE TRUE                                                20220029
202300         WHEN PS-PROCESS-AREA-CSR                                 20230029
202400             EXEC SQL                                             20240029
202500                CLOSE PROCESS-AREA-CSR                            20250029
202600             END-EXEC                                             20260029
202700         WHEN PS-UK-OPER-AREA-CSR                                 20270029
202800             EXEC SQL                                             20280029
202900                CLOSE UK-OPER-AREA-CSR                            20290029
203000             END-EXEC                                             20300029
203010         WHEN PS-PROCESS-GROUP-CSR                                20301029
203020             EXEC SQL                                             20302029
203030                CLOSE PROCESS-GROUP-CSR                           20303029
203040             END-EXEC                                             20304029
203050         WHEN PS-UK-OPER-GROUP-CSR                                20305029
203060             EXEC SQL                                             20306029
203070                CLOSE UK-OPER-GROUP-CSR                           20307029
203080             END-EXEC                                             20308029
203100     END-EVALUATE                                                 20310029
203300                                                                  20330002
203400     EVALUATE TRUE                                                20340002
203500         WHEN SQLCODE = ZERO                                      20350002
203600         WHEN SQLCODE = +100                                      20360002
203700             CONTINUE                                             20370002
203800         WHEN SQLWARN0 NOT = SPACES                               20380002
203900         WHEN SQLCODE < ZERO                                      20390002
204000         WHEN SQLCODE > ZERO                                      20400002
204100             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          20410002
204200             MOVE 'CLOSE CURSOR PROBLEM   '                       20420002
204300                               TO DP013-MESSAGE-TEXT (1)          20430002
204400             MOVE SQLCA        TO DP013-SQLCA                     20440002
204500             MOVE 'PCT_PRC_AREA_ASSN' TO DP013-DB2-TABLE-NAME (1) 20450010
204600             SET DP013-DB2-ABEND                                  20460002
204700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20470002
204800             PERFORM DP013-0000-PROCESS-ABEND                     20480002
204900     END-EVALUATE.                                                20490002
205000                                                                  20500002
220800*----------------------------------------------------------------*22080010
220900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *22090002
221000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *22100002
221100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *22110002
221200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *22120002
221300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *22130002
221400*                                                                *22140002
221500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *22150002
221600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *22160002
221700*    UPON INITIALIZATION.                                        *22170002
221800*----------------------------------------------------------------*22180002
221900 4300-READ-ITEMS-FROM-DB.                                         22190002
222000                                                                  22200002
222100     PERFORM                                                      22210002
222200         VARYING PV-READ-COUNT                                    22220002
222300         FROM 1 BY 1                                              22230002
222400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    22240002
222500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         22250002
222600                                                                  22260002
222700             PERFORM 4310-FETCH                                   22270029
222800                                                                  22280002
222900             IF  ASC-ITEMS-LEFT-ON-DB                             22290029
223000                 IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL            22300029
223100                     ADD +1            TO ASC-ITEM-SUB            22310029
223200                 ELSE                                             22320029
223300                     ADD +1            TO ASC-BLK-SUB             22330029
223400                     MOVE +1           TO ASC-ITEM-SUB            22340029
223500                                                                  22350029
223600                     IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY     22360029
223700                         MOVE +1       TO ASC-BLK-SUB             22370029
223800                         SET ASC-BLOCK-MODIFIED (1) TO TRUE       22380029
223900                         PERFORM 5100-WRITE-TEMP-STORAGE          22390029
224000                         MOVE ASC-BLOCK-ENTRIES                   22400029
224100                                         (PC-MAX-BLOCKS-IN-ARRAY) 22410029
224200                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 22420029
224300                         ADD +1        TO ASC-BLK-SUB             22430029
224400                         INITIALIZE ASC-BLOCK-ENTRIES(ASC-BLK-SUB)22440029
224500                         SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)  22450029
224600                                                          TO TRUE 22460029
224700                    END-IF                                        22470029
224800                 END-IF                                           22480029
224900                 ADD +1   TO ASC-NUMBER-OF-ITEMS-READ             22490029
225000                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE      22500029
225100                 MOVE ASC-NUMBER-OF-ITEMS-READ                    22510029
225200                                   TO ASC-LIST-ITEM-NUMBER        22520029
225300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22530029
225400                 MOVE PCT00003-PRCG-AREA-CDE TO                   22540029
225500                              ASC-AREA (ASC-BLK-SUB ASC-ITEM-SUB) 22550029
225600                 MOVE PCT00003-PRC-AREA-GP-CDE                    22560029
225700                          TO ASC-GROUP (ASC-BLK-SUB ASC-ITEM-SUB) 22570029
225800                 MOVE PCT00003-OPER-UNT-ID                        22580029
225900                           TO ASC-UNIT (ASC-BLK-SUB ASC-ITEM-SUB) 22590029
226000                 MOVE FLAREA-FCLTY-AREA-DESC                      22600029
226100                        TO ASC-AREADESC (ASC-BLK-SUB ASC-ITEM-SUB)22610029
226200                 MOVE PCT00002-PRC-AREA-GP-DESC                   22620029
226300                        TO ASC-GROUPDESC(ASC-BLK-SUB ASC-ITEM-SUB)22630029
232200         END-IF                                                   23220026
232300     END-PERFORM.                                                 23230026
232400                                                                  23240026
232500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          23250002
232600         MOVE +1               TO ASC-BLK-SUB                     23260002
232700         PERFORM 5100-WRITE-TEMP-STORAGE                          23270002
232800         ADD +1                TO ASC-BLK-SUB                     23280002
232900         PERFORM 5100-WRITE-TEMP-STORAGE                          23290002
233000                                                                  23300002
233100         MOVE 1                TO ASC-BLK-SUB                     23310002
233200                                  PV-BLOCK-NUMBER                 23320002
233300         PERFORM 4410-READ-TEMP-STORAGE                           23330002
233400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             23340002
233500             MOVE 2            TO ASC-BLK-SUB                     23350002
233600                                  PV-BLOCK-NUMBER                 23360002
233700             PERFORM 4410-READ-TEMP-STORAGE                       23370002
233800         END-IF                                                   23380002
233900     END-IF.                                                      23390002
234000                                                                  23400002
234100*----------------------------------------------------------------*23410002
234200*    FETCH THE CURSOR                                             23420002
234300*----------------------------------------------------------------*23430002
234400 4310-FETCH.                                                      23440002
234500     EVALUATE TRUE                                                23450029
234600         WHEN PS-PROCESS-AREA-CSR                                 23460029
234700             EXEC SQL                                             23470029
234800                 FETCH PROCESS-AREA-CSR                           23480029
234900                  INTO :PCT00003-PRCG-AREA-CDE                    23490029
235000                      ,:PCT00003-PRC-AREA-GP-CDE                  23500029
235100                      ,:PCT00003-OPER-UNT-ID                      23510029
235200                      ,:FLAREA-FCLTY-AREA-DESC                    23520029
235201                      ,:PCT00002-PRC-AREA-GP-DESC                 23520129
235202             END-EXEC                                             23520229
235203         WHEN PS-UK-OPER-AREA-CSR                                 23520329
235204             EXEC SQL                                             23520429
235300                 FETCH UK-OPER-AREA-CSR                           23530029
235400                  INTO :PCT00003-PRCG-AREA-CDE                    23540029
235500                      ,:PCT00003-PRC-AREA-GP-CDE                  23550029
235600                      ,:PCT00003-OPER-UNT-ID                      23560029
235700                      ,:FLAREA-FCLTY-AREA-DESC                    23570029
235701                      ,:PCT00002-PRC-AREA-GP-DESC                 23570129
235702             END-EXEC                                             23570229
235703         WHEN PS-PROCESS-GROUP-CSR                                23570329
235704             EXEC SQL                                             23570429
235705                 FETCH PROCESS-GROUP-CSR                          23570529
235706                  INTO :PCT00003-PRCG-AREA-CDE                    23570629
235707                      ,:PCT00003-PRC-AREA-GP-CDE                  23570729
235708                      ,:PCT00003-OPER-UNT-ID                      23570829
235709                      ,:FLAREA-FCLTY-AREA-DESC                    23570929
235710                      ,:PCT00002-PRC-AREA-GP-DESC                 23571029
235711             END-EXEC                                             23571129
235712         WHEN PS-UK-OPER-GROUP-CSR                                23571229
235713             EXEC SQL                                             23571329
235714                 FETCH UK-OPER-GROUP-CSR                          23571429
235715                  INTO :PCT00003-PRCG-AREA-CDE                    23571529
235716                      ,:PCT00003-PRC-AREA-GP-CDE                  23571629
235717                      ,:PCT00003-OPER-UNT-ID                      23571729
235718                      ,:FLAREA-FCLTY-AREA-DESC                    23571829
235719                      ,:PCT00002-PRC-AREA-GP-DESC                 23571929
235720             END-EXEC                                             23572029
235721     END-EVALUATE.                                                23572129
235722                                                                  23572202
235800     EVALUATE TRUE                                                23580002
235900         WHEN SQLCODE = ZERO                                      23590002
236200         WHEN SQLCODE = +100                                      23620002
236300              CONTINUE                                            23630002
236400         WHEN SQLWARN0 NOT = SPACE                                23640029
236500         WHEN SQLCODE NOT = ZERO                                  23650002
236600              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         23660002
236700              MOVE 'FETCH CURSOR PROBLEM '                        23670002
236800                               TO DP013-MESSAGE-TEXT (1)          23680002
236900              MOVE SQLCA       TO DP013-SQLCA                     23690002
237000              MOVE 'PCT_PRC_AREA_ASSN' TO DP013-DB2-TABLE-NAME (1)23700010
237100              SET DP013-DB2-ABEND TO TRUE                         23710002
237200              PERFORM DP013-0000-PROCESS-ABEND                    23720002
237300     END-EVALUATE.                                                23730002
237400                                                                  23740002
237500     IF  SQLCODE EQUAL +100                                       23750002
237600         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      23760002
237700     END-IF.                                                      23770002
237800                                                                  23780002
237900*----------------------------------------------------------------*23790002
238000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *23800002
238100*----------------------------------------------------------------*23810002
238200 4400-MOVE-COMMAREA-TO-SCREEN.                                    23820002
238300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             23830002
238400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          23840002
238500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          23850002
238600             MOVE +1    TO ASC-BLK-SUB                            23860002
238700             PERFORM 5100-WRITE-TEMP-STORAGE                      23870002
238800             ADD +1     TO ASC-BLK-SUB                            23880002
238900             PERFORM 5100-WRITE-TEMP-STORAGE                      23890002
239000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             23900002
239100                 GIVING PV-BLOCK-NUMBER                           23910002
239200                 REMAINDER PV-REMAINDER                           23920002
239300             IF  PV-REMAINDER > ZERO                              23930002
239400                 ADD +1 TO PV-BLOCK-NUMBER                        23940002
239500             END-IF                                               23950002
239600             MOVE +1    TO ASC-BLK-SUB                            23960002
239700             PERFORM 4410-READ-TEMP-STORAGE                       23970002
239800             ADD +1     TO ASC-BLK-SUB                            23980002
239900                           PV-BLOCK-NUMBER                        23990002
240000             PERFORM 4410-READ-TEMP-STORAGE                       24000002
240100     END-IF.                                                      24010002
240200     MOVE +1            TO ASC-BLK-SUB.                           24020002
240300     COMPUTE ASC-ITEM-SUB =                                       24030002
240400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              24040002
240500         + PC-ITEMS-PER-PANEL).                                   24050002
240600*                                                                 24060002
240700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        24070002
240800         ADD +1         TO ASC-BLK-SUB                            24080002
240900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            24090002
241000     END-IF.                                                      24100002
241100*                                                                 24110002
241200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           24120002
241300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                24130002
241400     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        24140002
241500     PERFORM 4420-FORMAT-LIST-LINES                               24150002
241600         VARYING PV-SUB                                           24160002
241700         FROM PC-ITEMS-PER-PANEL BY -1                            24170002
241800         UNTIL PV-SUB < +1.                                       24180002
241900*                                                                 24190002
242000     COMPUTE ASC-ITEMS-DISPLAYED =                                24200002
242100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          24210002
242200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    24220002
242300                                      ASTRTITO.                   24230002
242400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    24240002
242500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    24250002
242600                                                                  24260002
245600     IF  DP020-MSG-NUMBER-X = SPACE                               24560002
245700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  24570002
245800*            --- MORE ITEMS TO DISPLAY ----                       24580002
245900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            24590002
246000             SET DP020-MSG-INFORMATIONAL TO TRUE                  24600002
246100         END-IF                                                   24610002
246200     END-IF.                                                      24620002
246300                                                                  24630002
246400*----------------------------------------------------------------*24640002
246500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *24650002
246600*----------------------------------------------------------------*24660002
246700 4410-READ-TEMP-STORAGE.                                          24670002
246800                                                                  24680002
246900     EXEC CICS                                                    24690002
247000         READQ TS                                                 24700002
247100             QUEUE (ASC-LIST-QUEUE-NAME)                          24710002
247200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24720002
247300             ITEM  (PV-BLOCK-NUMBER)                              24730002
247400             RESP  (PV-CICS-RESP)                                 24740002
247500     END-EXEC.                                                    24750002
247600                                                                  24760002
247700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       24770002
247800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     24780002
247900         CONTINUE                                                 24790002
248000     ELSE                                                         24800002
248100         SET DP013-CICS-ABEND     TO TRUE                         24810002
248200         SET DP013-NO-ROLLBACK    TO TRUE                         24820002
248300         MOVE '4410-READ-TEMP-STORAGE'                            24830002
248400                                  TO DP013-PARAGRAPH              24840002
248500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      24850002
248600                                  TO DP013-MESSAGE-TEXT(1)        24860002
248700         PERFORM DP013-0000-PROCESS-ABEND                         24870002
248800     END-IF.                                                      24880002
248900                                                                  24890002
249000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             24900002
249100*                                                                 24910002
249200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         24920002
249300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               24930002
249400     END-IF.                                                      24940002
249500                                                                  24950002
249600*----------------------------------------------------------------*24960002
249700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *24970002
249800*----------------------------------------------------------------*24980002
249900 4420-FORMAT-LIST-LINES.                                          24990002
250000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      25000002
250100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                25010002
250200*        MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           25020003
250300*        MOVE DP015-HL-OFF       TO MR-SELECTH  (PV-SUB)          25030003
250400*        MOVE SPACE              TO MR-SELECTI  (PV-SUB)          25040003
250500         MOVE SPACE              TO MR-AREA     (PV-SUB)          25050003
250600                                    MR-GROUP    (PV-SUB)          25060003
250700                                    MR-AREA-DESC(PV-SUB)          25070003
250800                                    MR-GROUP-DESC(PV-SUB)         25080029
250900                                    MR-UNIT-X    (PV-SUB)         25090029
251400     ELSE                                                         25140002
251500*        IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      25150004
251600*                                                  > SPACE        25160004
251700*            MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 25170004
251800*                                TO MR-SELECTI (PV-SUB)           25180004
251900*        ELSE                                                     25190004
252000*            MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      25200004
252100*                                TO MR-SELECTI (PV-SUB)           25210004
252200*        END-IF                                                   25220004
252300         IF  DP030-SET-CURSOR-TRAILER                             25230002
252400             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)25240002
252500                 > SPACE)                                         25250002
252600               OR (PV-SUB = 1))                                   25260002
252700                SET DP030-SET-CURSOR-APPL-1 TO TRUE               25270002
252800                MOVE -1               TO ASTRTITL                 25280002
252900             END-IF                                               25290002
253000         END-IF                                                   25300002
253100*                                                                 25310002
253200         MOVE ASC-AREA (ASC-BLK-SUB ASC-ITEM-SUB)                 25320004
253300                                              TO MR-AREA (PV-SUB) 25330004
253400         MOVE ASC-GROUP (ASC-BLK-SUB ASC-ITEM-SUB)                25340029
253500                                             TO MR-GROUP (PV-SUB) 25350029
253600         MOVE ASC-UNIT (ASC-BLK-SUB ASC-ITEM-SUB)                 25360029
253700                                              TO MR-UNIT (PV-SUB) 25370029
253800         MOVE ASC-AREADESC (ASC-BLK-SUB ASC-ITEM-SUB)             25380029
253900                                         TO MR-AREA-DESC (PV-SUB) 25390029
254000         MOVE ASC-GROUPDESC (ASC-BLK-SUB ASC-ITEM-SUB)            25400029
254100                                        TO MR-GROUP-DESC (PV-SUB) 25410029
255000     END-IF.                                                      25500002
255100     SUBTRACT +1 FROM ASC-ITEM-SUB                                25510002
255200     IF  ASC-ITEM-SUB < + 1                                       25520002
255300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  25530002
255400         MOVE +1                 TO ASC-BLK-SUB                   25540002
255500     END-IF.                                                      25550002
255600                                                                  25560002
255700******************************************************************25570002
255800** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **25580002
255900** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **25590002
256000** ISSUE A WARNING.                                             **25600002
256100******************************************************************25610002
256200 4430-CHECK-FOR-BEGIN-AND-END.                                    25620002
256300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       25630002
256400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     25640002
256500*            -- NO END-OF-RANGE SPECFIED ---                      25650002
256600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            25660002
256700             SET DP020-MSG-WARNING TO TRUE                        25670002
256800             PERFORM 4431-POSITION-AT-WARNING                     25680002
256900         END-IF                                                   25690002
257000     ELSE                                                         25700002
257100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     25710002
257200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                25720002
257300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            25730002
257400             SET DP020-MSG-WARNING TO TRUE                        25740002
257500             PERFORM 4431-POSITION-AT-WARNING                     25750002
257600         END-IF                                                   25760002
257700     END-IF.                                                      25770002
257800******************************************************************25780002
257900** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **25790002
258000** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **25800002
258100** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **25810002
258200** POSITION THE CURSOR THERE.                                   **25820002
258300******************************************************************25830002
258400 4431-POSITION-AT-WARNING.                                        25840002
258500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 25850002
258600                    - PV-TOP-ITEM + 1.                            25860002
258700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25870002
258800         CONTINUE                                                 25880002
258900     ELSE                                                         25890002
259000         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      25900002
259100         MOVE -1                    TO ASTRTITL                   25910002
259200     END-IF.                                                      25920002
259300*                                                                 25930002
259400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   25940002
259500                    - PV-TOP-ITEM + 1.                            25950002
259600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25960002
259700         CONTINUE                                                 25970002
259800     ELSE                                                         25980002
259900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      25990002
260000         MOVE -1                   TO ASTRTITL                    26000002
260100     END-IF.                                                      26010002
260200                                                                  26020002
260300*----------------------------------------------------------------*26030029
260400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *26040029
260500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *26050029
260600*----------------------------------------------------------------*26060029
260700 5100-WRITE-TEMP-STORAGE.                                         26070029
260800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     26080029
260900                                   TO PV-LIST-ITEM-NUMBER.        26090029
261000     COMPUTE PV-BLOCK-NUMBER =                                    26100029
261100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    26110029
261200                                                                  26120029
261300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             26130029
261400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             26140029
261500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      26150029
261600             PERFORM 5105-REWRITE-ASC-LISTQ                       26160029
261700         END-IF                                                   26170029
261800     ELSE                                                         26180029
261900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       26190029
262000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            26200029
262100         PERFORM 5110-WRITE-ASC-LISTQ                             26210029
262200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   26220029
262300     END-IF.                                                      26230029
262400                                                                  26240029
262500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             26250029
262600                                                                  26260029
262700******************************************************************26270029
262800** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **26280029
262900** SPECIFIC COMMAREA.                                           **26290029
263000******************************************************************26300029
263100 5105-REWRITE-ASC-LISTQ.                                          26310029
263200     EXEC CICS                                                    26320029
263300         WRITEQ TS                                                26330029
263400             QUEUE (ASC-LIST-QUEUE-NAME)                          26340029
263500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26350029
263600             ITEM  (PV-BLOCK-NUMBER)                              26360029
263700             REWRITE                                              26370029
263800             RESP  (PV-CICS-RESP)                                 26380029
263900     END-EXEC.                                                    26390029
264000                                                                  26400029
264100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           26410029
264200         CONTINUE                                                 26420029
264300     ELSE                                                         26430029
264400         SET DP013-CICS-ABEND            TO TRUE                  26440029
264500         SET DP013-NO-ROLLBACK           TO TRUE                  26450029
264600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       26460029
264700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     26470029
264800                                         TO DP013-MESSAGE-TEXT(1) 26480029
264900         PERFORM DP013-0000-PROCESS-ABEND                         26490029
265000     END-IF.                                                      26500029
265100                                                                  26510029
265200******************************************************************26520029
265300** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **26530029
265400** SPECIFIC COMMAREA.                                           **26540029
265500******************************************************************26550029
265600 5110-WRITE-ASC-LISTQ.                                            26560029
265700     EXEC CICS                                                    26570029
265800         WRITEQ TS                                                26580029
265900             QUEUE (ASC-LIST-QUEUE-NAME)                          26590029
266000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26600029
266100             ITEM  (PV-BLOCK-NUMBER)                              26610029
266200             RESP  (PV-CICS-RESP)                                 26620029
266300     END-EXEC.                                                    26630029
266400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      26640029
266500         SET DP013-CICS-ABEND      TO TRUE                        26650029
266600         SET DP013-NO-ROLLBACK     TO TRUE                        26660029
266700         MOVE '5110-WRITE-ASC-LISTQ'                              26670029
266800                                   TO DP013-PARAGRAPH             26680029
266900         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           26690029
267000                                   TO DP013-MESSAGE-TEXT(1)       26700029
267100         PERFORM DP013-0000-PROCESS-ABEND                         26710029
267200     END-IF.                                                      26720029
267300                                                                  26730029
301700*----------------------------------------------------------------*30170002
301800*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *30180002
301900*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *30190002
302000*----------------------------------------------------------------*30200002
302100 9900-SOFT-ABORT.                                                 30210002
302200                                                                  30220002
302300     EXEC CICS SYNCPOINT                                          30230002
302400          ROLLBACK                                                30240002
302500     END-EXEC.                                                    30250002
302600                                                                  30260002
302700     SET  PS-ERROR                                                30270002
302800          PS-SOFT-ABORT-ERROR                                     30280002
302900          DP020-MSG-FATAL       TO  TRUE.                         30290002
303000                                                                  30300002
303100*----------------------------------------------------------------*30310002
303200*    ABEND PROCESSOR MODULE                                      *30320002
303300*----------------------------------------------------------------*30330002
303400                                                                  30340002
303500     COPY DPPD013.                                                30350002
