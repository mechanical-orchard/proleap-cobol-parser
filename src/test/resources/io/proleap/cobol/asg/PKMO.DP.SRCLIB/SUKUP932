000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    SUKUP932.                                         00020000
000300 AUTHOR.        RON KRIER.                                        00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   FEBRUARY, 2015.                                   00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800* ************************************************************** *00080000
000900* * SUKUP932 - WILL PROCESS THREE DIFFERENT INPUT FILES AND    * *00090000
001000* *            FOR THESE FILES, WILL READ A RECORD, DELETE     * *00100000
001100* *            THE DATA FROM THE CORRESPONDING TABLE IF        * *00110000
001200* *            NEEDED AND THEN WILL INSERT THE DATA INTO THE   * *00120000
001300* *            CORRESPONDING TABLE.                            * *00130000
001400* *                                                            * *00140000
001500* * PURPOSE:                                                   * *00150000
001600* * GETTING TEST DATA FOR THE THE STORE EXPECTED/IN-TRANSIT    * *00160000
001700* * DATABASES HAS ALWAYS BEEN A CHALLENGE.  THIS PROGRAM WILL  * *00170000
001800* * TAKE IN INPUT FILES FROM SUKUT931 AND LOAD THE DATA INTO   * *00180000
001900* * THE TEST TABLES.                                           * *00190000
002000* * FIRST FILE WILL BE THE OUTBOUND TRIP TABLE - IF THE        * *00200000
002100* * DATA ALREADY EXISTS FOR THE TRIP, THEN NOTHING WILL        * *00210000
002200* * HAPPEN.  IF THE DATA DOES NOT EXIST FOR THE TRIP, THEN THE * *00220000
002300* * PROGRAM WILL INSERT IT.                                    * *00230000
002400* * SECOND FILE WILL BE THE PCT_TRN_CLSN_BAL FILE.  IF THERE   * *00240000
002500* * IS DATA ON THE PCT_TRN_CLSN_BAL TABLE, IT WILL DELETE IT   * *00250000
002600* * AND THEN DO THE INSERTS.  IF THE DATA DOES NOT EXIST, IT   * *00260000
002700* * WILL INSERT IT.                                            * *00270000
002800* * THIRD FILE WILL BE THE PCT_TRN_CLSN_DTL FILE.  IT WILL     * *00280000
002900* * SIMPLY ADD THE DATA TO THE TABLE (SINCE THE CORRESPONDING  * *00290000
003000* * DATA WOULD HAVE BEEN DELETED WITH PROCESSING THE DATA FROM * *00300000
003100* * THE BALANCE FILE).                                         * *00310003
003110* * FOURTH FILE WILL BE THE XLT_SKU FILE.  IT WILL SIMPLY ADD  * *00311003
003120* * THE DATA TO THE TABLE.  IF THE INTERNAL UPC ID ALREADY IS  * *00312003
003130* * ON THE TABLE, IT WILL JUST MOVE TO THE NEXT ITEM.          * *00313003
003200* *                                                            * *00320000
003300* ************************************************************** *00330000
003400 ENVIRONMENT DIVISION.                                            00340000
003500 CONFIGURATION SECTION.                                           00350000
003600 SOURCE-COMPUTER.        IBM-3090.                                00360000
003700 OBJECT-COMPUTER.        IBM-3090.                                00370000
003800                                                                  00380000
003900 INPUT-OUTPUT SECTION.                                            00390000
004000 FILE-CONTROL.                                                    00400000
004100                                                                  00410000
004200     SELECT INPUT-BAL-FILE                ASSIGN TO IN01.         00420002
004300     SELECT INPUT-DTL-FILE                ASSIGN TO IN02.         00430002
004400     SELECT INPUT-OBTR-FILE               ASSIGN TO IN03.         00440002
004410     SELECT INPUT-SKU-FILE                ASSIGN TO IN04.         00441003
004500                                                                  00450000
004600******************************************************************00460000
004700 DATA DIVISION.                                                   00470000
004800 FILE SECTION.                                                    00480000
004900                                                                  00490000
005000 FD  INPUT-BAL-FILE                                               00500000
005100     RECORDING MODE IS F                                          00510000
005200     LABEL RECORDS ARE STANDARD                                   00520000
005300     BLOCK CONTAINS 0 RECORDS.                                    00530000
005400 01  INPUT-BAL-RECORD                PIC  X(22).                  00540000
005500                                                                  00550000
005600 FD  INPUT-DTL-FILE                                               00560000
005700     RECORDING MODE IS F                                          00570000
005800     LABEL RECORDS ARE STANDARD                                   00580000
005900     BLOCK CONTAINS 0 RECORDS.                                    00590000
006000 01  INPUT-DTL-RECORD                PIC  X(64).                  00600000
006100                                                                  00610000
006200 FD  INPUT-OBTR-FILE                                              00620000
006300     RECORDING MODE IS F                                          00630000
006400     LABEL RECORDS ARE STANDARD                                   00640000
006500     BLOCK CONTAINS 0 RECORDS.                                    00650000
006600 01  INPUT-OBTR-RECORD               PIC  X(71).                  00660000
006610                                                                  00661003
006620 FD  INPUT-SKU-FILE                                               00662003
006630     RECORDING MODE IS F                                          00663003
006640     LABEL RECORDS ARE STANDARD                                   00664003
006650     BLOCK CONTAINS 0 RECORDS.                                    00665003
006660 01  INPUT-SKU-RECORD                PIC  X(131).                 00666003
006700                                                                  00670000
006800                                                                  00680000
006900                                                                  00690000
007000 WORKING-STORAGE SECTION.                                         00700000
007100                                                                  00710000
007120 01  WS-LOCAL-SERVER.                                             00712009
007130     05  WS-SUBSYS                   PIC X(04)  VALUE SPACES.     00713009
007140     05  FILLER                      PIC X(12)  VALUE SPACES.     00714009
007150                                                                  00715009
007200 01  PC-PROGRAM-CONSTANTS.                                        00720000
007300     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'SUKUP932'.  00730000
007400     05  PC-PGM-PROGRESS-DESC.                                    00740000
007500         10  PC-ORD-SKU-ADD          PIC X(20) VALUE              00750000
007600             'ORD_SKU_ADD         '.                              00760000
007700     05  PC-ABEND-INFO.                                           00770000
007800         10  PC-ABEND                PIC X(11) VALUE              00780000
007900                                               '** ABEND **'.     00790000
008000         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00800000
008100                                               '- PARA       : '. 00810000
008200         10  PC-ABEND-MSG-DISPLAY-PARA                            00820000
008300                                     PIC X(15) VALUE              00830000
008400                                               '  CALLED PARA: '. 00840000
008500         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00850000
008600                                               '  FOR ABEND# : '. 00860000
008700         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00870000
008800                                               '- ERROR IS   : '. 00880000
008900         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00890000
009000         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00900000
009100                                               '- ACTION     : '. 00910000
009200     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 5000.        00920000
009300     05  PC-1                        PIC 9(04) VALUE 0001.        00930000
009400     05  PC-2                        PIC 9(04) VALUE 0002.        00940000
009500     05  PC-3                        PIC 9(04) VALUE 0003.        00950000
009600     05  PC-4                        PIC 9(04) VALUE 0004.        00960000
009700     05  PC-5                        PIC 9(04) VALUE 0005.        00970000
009800     05  PC-6                        PIC 9(04) VALUE 0006.        00980000
009900     05  PC-7                        PIC 9(04) VALUE 0007.        00990000
010000     05  PC-8                        PIC 9(04) VALUE 0008.        01000000
010100     05  PC-200                      PIC 9(04) VALUE 0200.        01010001
010110     05  PC-90                       PIC S9(04)    COMP           01011009
010120                                                   VALUE 90.      01012009
010130     05  PC-A                        PIC  X(01)    VALUE 'A'.     01013009
010140     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     01014009
010150     05  PC-RCV                      PIC  X(03)    VALUE 'RCV'.   01015009
010160     05  PC-KHL                      PIC  X(03)    VALUE 'KHL'.   01016009
010170     05  PC-PRDCHK                   PIC  X(06)    VALUE 'PRDCHK'.01017009
010180     05  PC-PARM-TEXT                PIC  X(25)    VALUE          01018009
010190         'LOWER LEVEL ONLY         '.                             01019009
010200                                                                  01020000
010300 01  PS-PROGRAM-SWITCHES.                                         01030000
010400     05  PS-INPUT-EOF-SW             PIC X(01) VALUE 'N'.         01040000
010500         88  PS-INPUT-EOF                      VALUE 'Y'.         01050000
010600         88  PS-INPUT-NOT-EOF                  VALUE 'N'.         01060000
010700     05  PS-INPUT-MATCH-SW           PIC X(01) VALUE 'N'.         01070000
010800         88  PS-INPUT-MATCH                    VALUE 'Y'.         01080000
010900         88  PS-INPUT-NOT-MATCH                VALUE 'N'.         01090000
011000     05  PS-WRITE-FROM-SW            PIC X(01) VALUE 'N'.         01100000
011100         88  PS-WRITE-FROM-INPUT               VALUE 'I'.         01110000
011200         88  PS-WRITE-FROM-CURSOR              VALUE 'C'.         01120000
011300     05  PS-END-OF-BAL-CSR-SW        PIC X(01) VALUE 'N'.         01130000
011400         88  PS-END-OF-BAL-CSR                 VALUE 'Y'.         01140000
011500     05  PS-END-OF-DTL-CSR-SW        PIC X(01) VALUE 'N'.         01150000
011600         88  PS-END-OF-DTL-CSR                 VALUE 'Y'.         01160000
011700     05  PS-CURSOR-HAS-DATA-SW       PIC X(01) VALUE 'N'.         01170000
011800         88  PS-CURSOR-HAS-DATA                VALUE 'Y'.         01180000
011900         88  PS-CURSOR-HAS-NO-DATA             VALUE 'N'.         01190000
012000     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         01200000
012100         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         01210000
012200         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         01220000
012300     05  PS-OPEN-SW                  PIC X(01) VALUE 'N'.         01230000
012400         88  PS-OPEN-DID-WORK                  VALUE 'Y'.         01240000
012500         88  PS-OPEN-DID-NOT-WORK              VALUE 'N'.         01250000
012600     05  PS-PO-ON-TPURCHS-SW         PIC X(01) VALUE 'Y'.         01260000
012700         88  PS-PO-ON-TPURCHS                  VALUE 'Y'.         01270000
012800         88  PS-PO-NOT-ON-TPURCHS              VALUE 'N'.         01280000
012900     05  PS-PO-PREV-PACK-PO-SW       PIC X(01) VALUE 'N'.         01290000
013000         88  PS-PO-NOT-PREV-PACK-PO            VALUE 'N'.         01300000
013100         88  PS-PO-PREV-PACK-PO                VALUE 'Y'.         01310000
013200     05  PS-PO-SKU-ON-TPURITM-SW     PIC X(01) VALUE 'Y'.         01320000
013300         88  PS-PO-SKU-ON-TPURITM              VALUE 'Y'.         01330000
013400         88  PS-PO-SKU-NOT-ON-TPURITM          VALUE 'N'.         01340000
013500     05  PS-PO-ON-TPOPRPK-SW         PIC X(01) VALUE 'Y'.         01350000
013600         88  PS-PO-ON-TPOPRPK                  VALUE 'Y'.         01360000
013700         88  PS-PO-NOT-ON-TPOPRPK              VALUE 'N'.         01370000
013800     05  PS-SKU-ON-XLT-SKU-SW        PIC X(01) VALUE 'Y'.         01380000
013900         88  PS-SKU-ON-XLT-SKU                 VALUE 'Y'.         01390000
014000         88  PS-SKU-NOT-ON-XLT-SKU             VALUE 'N'.         01400000
014100     05  PS-SKU-ON-XLT-PK-SW         PIC X(01) VALUE 'Y'.         01410000
014200         88  PS-SKU-ON-XLT-PK                  VALUE 'Y'.         01420000
014300         88  PS-SKU-NOT-ON-XLT-PK              VALUE 'N'.         01430000
014400     05  PS-PO-IS-PREPACK-SW         PIC X(01) VALUE 'Y'.         01440000
014500         88  PS-PO-IS-PREPACK                  VALUE 'Y'.         01450000
014600         88  PS-PO-IS-NOT-PREPACK              VALUE 'N'.         01460000
014700     05  PS-PO-IS-UPDATED-SW         PIC X(01) VALUE 'Y'.         01470000
014800         88  PS-PO-IS-UPDATED                  VALUE 'Y'.         01480000
014900         88  PS-PO-IS-NOT-UPDATED              VALUE 'N'.         01490000
015000     05  PS-SKU-TBL-SW               PIC X(04) VALUE 'SKU '.      01500000
015100         88  PS-SKU-ON-XLT-SKU-TBL             VALUE 'SKU '.      01510000
015200         88  PS-SKU-ON-XLT-PK-TBL              VALUE 'PACK'.      01520000
015300         88  PS-SKU-ON-BOTH-TBL                VALUE 'BOTH'.      01530000
015400         88  PS-SKU-NOT-FOUND                  VALUE 'NFND'.      01540000
015500                                                                  01550000
015600 01  PV-PROGRAM-VARIABLES.                                        01560000
015700     05  PV-PREV-INTR-UPC-ID         PIC S9(9) COMP.              01570000
015800     05  PV-PREV-LOC-NBR             PIC S9(4) COMP.              01580000
015900     05  PV-PREV-OTBND-TRIP-ID       PIC S9(9) COMP.              01590000
016000     05  PV-PREV-DISP-UPC-ID         PIC  9(9) VALUE 0.           01600000
016100     05  PV-PREV-DISP-LOC-NBR        PIC  9(4) VALUE 0.           01610000
016200     05  PV-DISP-INTR-UPC-ID         PIC  9(9) VALUE 0.           01620000
016300     05  PV-DISP-LOC-NBR             PIC  9(4) VALUE 0.           01630000
016400     05  PV-DISP-OTBND-TRIP-ID       PIC  9(9) VALUE 0.           01640000
016500     05  PV-INPUT-READ               PIC  9(9) VALUE 0.           01650000
016600     05  PV-INPUT-CHECK-CNT          PIC  9(9) VALUE 0.           01660000
016700     05  PV-INPUT-BAL-READ           PIC  9(9) VALUE 0.           01670000
016800     05  PV-INPUT-DTL-READ           PIC  9(9) VALUE 0.           01680000
016900     05  PV-INPUT-OBTR-READ          PIC  9(9) VALUE 0.           01690000
017000     05  PV-TSUOBTR-INSERTS          PIC  9(9) VALUE 0.           01700000
017100     05  PV-TSUOBTR-EXISTS           PIC  9(9) VALUE 0.           01710000
017110     05  PV-INPUT-SKU-READ           PIC  9(9) VALUE 0.           01711003
017120     05  PV-SKU-INSERTS              PIC  9(9) VALUE 0.           01712003
017130     05  PV-SKU-EXISTS               PIC  9(9) VALUE 0.           01713003
017200     05  PV-BAL-DELETES              PIC  9(9) VALUE 0.           01720000
017300     05  PV-BAL-DELETE-NOT-EXISTS    PIC  9(9) VALUE 0.           01730000
017400     05  PV-BAL-INSERTS              PIC  9(9) VALUE 0.           01740000
017500     05  PV-BAL-DUPLICATE            PIC  9(9) VALUE 0.           01750000
017600     05  PV-DTL-INSERTS              PIC  9(9) VALUE 0.           01760000
017700     05  PV-DTL-DUPLICATE            PIC  9(9) VALUE 0.           01770000
017800     05  PV-OUTPUT-FROM-INPUT        PIC  9(9) VALUE 0.           01780000
017900     05  PV-DIFF-FOUND               PIC  9(9) VALUE 0.           01790000
018000     05  PV-COMMIT-CNT               PIC  9(9) VALUE 0.           01800001
018100     05  PV-DISPLAY-FIELD            PIC  9(9) VALUE 0.           01810000
018200     05  PV-DISPLAY-FIELD2           PIC  9(9) VALUE 0.           01820000
018300     05  PV-DISPLAY-FIELD3           PIC  9(4) VALUE 0.           01830000
018400     05  PV-DISPLAY-FIELD4           PIC  9(5) VALUE 0.           01840000
018500     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           01850000
018600     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           01860000
018700     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01870000
018800                                                                  01880000
018900     05  PV-NULL-IND                 PIC S9(4) VALUE ZEROS        01890000
019000                                               COMP SYNC.         01900000
019100                                                                  01910000
019200     05  PV-SPACE-CNTR               PIC 9(04) VALUE 0.           01920000
019300     05  PV-CHAR-CNTR                PIC 9(04) VALUE 0.           01930000
019400     05  PV-CONVERSION-FIELD-9       PIC 9(08) VALUE 0.           01940000
019500                                                                  01950000
019600     05  PV-CC-TIMESTAMP             PIC X(26) VALUE SPACES.      01960000
019700     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01970000
019800     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      01980000
019900     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01990000
020000     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           02000000
020100     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           02010000
020200     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        02020000
020300                                                                  02030000
020400     05  PV-EVENT-TMST              PIC  X(26).                   02040000
020500     05  FILLER REDEFINES     PV-EVENT-TMST.                      02050000
020600         10 PV-TMST-CC              PIC  9(02).                   02060000
020700         10 PV-TMST-YY              PIC  9(02).                   02070000
020800         10 FILLER                  PIC  X(01).                   02080000
020900         10 PV-TMST-MM              PIC  9(02).                   02090000
021000         10 FILLER                  PIC  X(01).                   02100000
021100         10 PV-TMST-DD              PIC  9(02).                   02110000
021200         10 FILLER                  PIC  X(01).                   02120000
021300         10 PV-TMST-HH              PIC  9(02).                   02130000
021400         10 FILLER                  PIC  X(01).                   02140000
021500         10 PV-TMST-MN              PIC  9(02).                   02150000
021600         10 FILLER                  PIC  X(01).                   02160000
021700         10 PV-TMST-SS              PIC  9(02).                   02170000
021800         10 FILLER                  PIC  X(07).                   02180000
021900                                                                  02190000
022000                                                                  02200000
022100 01  IR-BAL-INPUT-RECORD.                                         02210000
022200     05  IR-BAL-INTR-UPC-ID          PIC S9(9) COMP.              02220000
022300     05  IR-BAL-LOC-NBR              PIC S9(4) COMP.              02230000
022400     05  IR-BAL-TRN-CLSN-CDE         PIC  X(2).                   02240000
022500     05  IR-BAL-TRN-CLSN-QTY         PIC S9(9) COMP.              02250000
022600     05  IR-BAL-LAST-UPD-DTE         PIC  X(10).                  02260000
022700                                                                  02270000
022800 01  IR-DTL-INPUT-RECORD.                                         02280000
022900     05  IR-DTL-INTR-UPC-ID          PIC S9(9) COMP.              02290000
023000     05  IR-DTL-LOC-NBR              PIC S9(4) COMP.              02300000
023100     05  IR-DTL-TRN-CLSN-CDE         PIC  X(2).                   02310000
023200     05  IR-DTL-IN-TRNST-TRN-TMST    PIC  X(26).                  02320000
023300     05  IR-DTL-TRN-TYP-CDE          PIC  X(2).                   02330000
023400     05  IR-DTL-TRN-CLSN-PRCG-QTY    PIC S9(9) COMP.              02340000
023500     05  IR-DTL-TRN-CLSN-BAL-QTY     PIC S9(9) COMP.              02350000
023600     05  IR-DTL-UPD-USR-ID           PIC  X(8).                   02360000
023700     05  IR-DTL-OTBND-TRIP-ID        PIC S9(9) COMP.              02370000
023800     05  IR-DTL-PO-NBR               PIC S9(9) COMP.              02380000
023900     05  IR-DTL-RCVR-SEQ-NBR         PIC S9(9) COMP.              02390000
024000                                                                  02400000
024100 01  IR-OBTR-INPUT-RECORD.                                        02410000
024200     05  IR-OBTR-OTBND-TRIP-ID       PIC S9(9) COMP.              02420000
024300     05  IR-OBTR-ORGN-OPER-UNT-ID    PIC S9(4) COMP.              02430000
024400     05  IR-OBTR-DEST-OPER-UNT-ID    PIC S9(4) COMP.              02440000
024500     05  IR-OBTR-TRLR-SRL-NBR        PIC S9(9) COMP.              02450000
024600     05  IR-OBTR-BOL-ID              PIC  X(30).                  02460000
024700     05  IR-OBTR-EST-ARRVL-TMST      PIC  X(26).                  02470000
024800     05  IR-OBTR-TRIP-ACTV-CDE       PIC  X(1).                   02480000
024900     05  IR-OBTR-DOOR-TYP-CDE        PIC  X(2).                   02490000
025000                                                                  02500000
025010 01  IR-SKU-INPUT-RECORD.                                         02501005
025020     05  IR-SKU-INTR-UPC-ID          PIC S9(9) COMP.              02502003
025030     05  IR-SKU-STYL-ID              PIC S9(8)V COMP-3.           02503003
025040     05  IR-SKU-ITM-NBR              PIC S9(15)V COMP-3.          02504003
025050     05  IR-SKU-SKU-NBR              PIC S9(8)V COMP-3.           02505003
025060     05  IR-SKU-SKU-STAT-CDE         PIC  X(2).                   02506003
025070     05  IR-SKU-SKU-STAT-DESC        PIC  X(10).                  02507003
025080     05  IR-SKU-INNR-PK-QTY          PIC S9(4) COMP.              02508003
025090     05  IR-SKU-OUTR-PK-QTY          PIC S9(4) COMP.              02509003
025091     05  IR-SKU-SKU-DESC             PIC  X(30).                  02509103
025092     05  IR-SKU-KOHLS-SIZE-CDE       PIC S9(9) COMP.              02509203
025093     05  IR-SKU-SIZE-DESC            PIC  X(10).                  02509303
025094     05  IR-SKU-NRF-CLOR-CDE         PIC  X(3).                   02509403
025095     05  IR-SKU-SHRT-CLOR-DESC       PIC  X(4).                   02509503
025096     05  IR-SKU-CSTM-CLOR-DESC       PIC  X(10).                  02509603
025097     05  IR-SKU-REGN-PRIC-IND        PIC  X(1).                   02509703
025098     05  IR-SKU-KY-ITM-IND           PIC  X(1).                   02509803
025099     05  IR-SKU-GP-CDE               PIC  X(3).                   02509903
025100     05  IR-SKU-LAST-UPD-TMST        PIC  X(26).                  02510003
025101     05  IR-SKU-WHSE-RPLNT-IND       PIC  X(1).                   02510103
025102                                                                  02510203
025110 01  DK-DATA-KEY-FIELDS.                                          02511000
025200     05  DK-INTR-UPC-ID              PIC  S9(9) COMP    VALUE 0.  02520000
025300     05  DK-LOC-NBR                  PIC  S9(4) COMP    VALUE 0.  02530000
025400     05  DK-OTBND-TRIP-ID            PIC  S9(9) COMP    VALUE 0.  02540000
025500                                                                  02550000
025600 01  DM-DISPLAY-MESSAGE.                                          02560000
025700     05  DM-01-10.                                                02570000
025800         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       02580000
025900         10  FILLER                  PIC X(02) VALUE ': '.        02590000
026000     05  DM-11-80.                                                02600000
026100         10  FILLER                  PIC X(37) VALUE              02610000
026200                        'SELECT ROWS MATCHING PO DRIVER FILE, '.  02620000
026300         10  FILLER                  PIC X(30) VALUE              02630000
026400                        'CREATING TRECDIS EXTRACT FILE.'.         02640000
026500         10  FILLER                  PIC X(01) VALUE SPACE.       02650000
026600         10  FILLER                  PIC X(01) VALUE ALL '*'.     02660000
026700     05  DM-81-120.                                               02670000
026800         10  FILLER                  PIC X(40) VALUE ALL '*'.     02680000
026900                                                                  02690000
027000 01  DP-DISPLAY-PROGRESS-MSG.                                     02700000
027100     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       02710000
027200     05  FILLER                      PIC X(02) VALUE SPACE.       02720000
027300     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       02730000
027400     05  FILLER                      PIC X(04) VALUE ' AT '.      02740000
027500     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       02750000
027600     05  FILLER                      PIC X(03) VALUE '.  '.       02760000
027700     05  FILLER                      PIC X(03) VALUE              02770000
027800                                         'IN:'.                   02780000
027900     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              02790000
028000                                               VALUE ZERO.        02800000
028100     05  FILLER                      PIC X(02) VALUE ', '.        02810000
028200     05  FILLER                      PIC X(14) VALUE              02820000
028300                                         'ROWS SELECTED:'.        02830000
028400     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              02840000
028500                                               VALUE ZERO.        02850000
028600     05  FILLER                      PIC X(02) VALUE ', '.        02860000
028700     05  FILLER                      PIC X(04) VALUE              02870000
028800                                         'OUT:'.                  02880000
028900     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              02890000
029000                                               VALUE ZERO.        02900000
029100     05  FILLER                      PIC X(01) VALUE '.'.         02910000
029200                                                                  02920000
029300 01  ABEND-CODE                      PIC S9(04)                   02930000
029400                                               VALUE ZEROES       02940000
029500                                               COMP SYNC.         02950000
029600                                                                  02960000
029700*---------------------------------------------------------------* 02970000
029800*  DB2 FORMATTED MESSAGE AREA                                     02980000
029900*---------------------------------------------------------------* 02990000
030000     COPY DPWS004.                                                03000000
030100                                                                  03010000
030200                                                                  03020000
030231*---------------------------------------------------------------* 03023109
030232*    DB2 AREA FOR TKRPRPM                                       * 03023209
030233*---------------------------------------------------------------* 03023309
030240     EXEC SQL                                                     03024009
030250          INCLUDE TKRPRPM                                         03025009
030260     END-EXEC.                                                    03026009
030270                                                                  03027009
030300*---------------------------------------------------------------* 03030000
030400*    DB2 AREA FOR PCT_TRN_CLSN_BAL                              * 03040000
030500*---------------------------------------------------------------* 03050000
030600     EXEC SQL                                                     03060000
030700          INCLUDE PCT00014                                        03070000
030800     END-EXEC.                                                    03080000
030900                                                                  03090000
031000*---------------------------------------------------------------* 03100000
031100*    DB2 AREA FOR PCT_TRN_CLSN_DTL                              * 03110000
031200*---------------------------------------------------------------* 03120000
031300     EXEC SQL                                                     03130000
031400          INCLUDE PCT00015                                        03140000
031500     END-EXEC.                                                    03150000
031600                                                                  03160000
031700*---------------------------------------------------------------* 03170000
031800*    DB2 AREA FOR TSUOBTR                                       * 03180000
031900*---------------------------------------------------------------* 03190000
032000     EXEC SQL                                                     03200000
032100          INCLUDE TSUOBTR                                         03210000
032200     END-EXEC.                                                    03220000
032310                                                                  03231003
032320*---------------------------------------------------------------* 03232003
032330*    DB2 AREA FOR XLT_SKU                                       * 03233003
032340*---------------------------------------------------------------* 03234003
032350     EXEC SQL                                                     03235003
032360          INCLUDE XLT00003                                        03236003
032370     END-EXEC.                                                    03237003
032380                                                                  03238003
032400*---------------------------------------------------------------* 03240000
032500*    DB2 AREA FOR COMMUNICATIONS                                * 03250000
032600*---------------------------------------------------------------* 03260000
032700     EXEC SQL                                                     03270000
032800          INCLUDE SQLCA                                           03280000
032900     END-EXEC.                                                    03290000
033000                                                                  03300000
033100                                                                  03310000
033200 PROCEDURE DIVISION.                                              03320000
033300                                                                  03330000
033400 0000-PROGRAM-MAINLINE.                                           03340000
033500                                                                  03350000
033600     PERFORM 1000-INITIALIZE.                                     03360000
033700                                                                  03370000
033800     PERFORM 2000-PROCESS-OBTR-INPUT-FILE                         03380000
033900         UNTIL PS-INPUT-EOF.                                      03390000
034000                                                                  03400000
034100     IF  PV-COMMIT-CNT > 0                                        03410001
034200         PERFORM 7000-TABLE-COMMIT                                03420001
034300         MOVE ZERO TO PV-COMMIT-CNT                               03430001
034400     END-IF.                                                      03440001
034401                                                                  03440106
034410     DISPLAY 'PROCESSING OF OBTR FILE COMPLETE'.                  03441006
034500                                                                  03450001
034501     SET PS-INPUT-NOT-EOF TO TRUE.                                03450103
034502     MOVE ZERO TO PV-INPUT-CHECK-CNT.                             03450203
034503     PERFORM 9080-READ-SKU-INPUT-FILE.                            03450303
034510     PERFORM 3000-PROCESS-SKU-INPUT-FILE                          03451003
034520         UNTIL PS-INPUT-EOF.                                      03452003
034530                                                                  03453003
034540     IF  PV-COMMIT-CNT > 0                                        03454003
034550         PERFORM 7000-TABLE-COMMIT                                03455003
034560         MOVE ZERO TO PV-COMMIT-CNT                               03456003
034570     END-IF.                                                      03457003
034571                                                                  03457106
034572     DISPLAY 'PROCESSING OF SKU FILE COMPLETE'.                   03457206
034580                                                                  03458003
034600     SET PS-INPUT-NOT-EOF TO TRUE.                                03460000
034700     MOVE ZERO TO PV-INPUT-CHECK-CNT.                             03470000
034800     PERFORM 9050-READ-BAL-INPUT-FILE.                            03480000
034900     PERFORM 4000-PROCESS-BAL-INPUT-FILE                          03490000
035000         UNTIL PS-INPUT-EOF.                                      03500000
035100                                                                  03510001
035200     IF  PV-COMMIT-CNT > 0                                        03520001
035300         PERFORM 7000-TABLE-COMMIT                                03530001
035400         MOVE ZERO TO PV-COMMIT-CNT                               03540001
035500     END-IF.                                                      03550001
035600                                                                  03560000
035610     DISPLAY 'PROCESSING OF BAL FILE COMPLETE'.                   03561006
035620                                                                  03562006
035700     SET PS-INPUT-NOT-EOF TO TRUE.                                03570000
035800     MOVE ZERO TO PV-INPUT-CHECK-CNT.                             03580000
035900     PERFORM 9060-READ-DTL-INPUT-FILE.                            03590000
036000     PERFORM 6000-PROCESS-DTL-INPUT-FILE                          03600000
036100         UNTIL PS-INPUT-EOF.                                      03610000
036200                                                                  03620001
036300     IF  PV-COMMIT-CNT > 0                                        03630001
036400         PERFORM 7000-TABLE-COMMIT                                03640001
036500         MOVE ZERO TO PV-COMMIT-CNT                               03650001
036600     END-IF.                                                      03660001
036610                                                                  03661006
036620     DISPLAY 'PROCESSING OF DTL FILE COMPLETE'.                   03662006
036700                                                                  03670001
036800     CLOSE INPUT-BAL-FILE.                                        03680000
036900     CLOSE INPUT-DTL-FILE.                                        03690000
037000     CLOSE INPUT-OBTR-FILE.                                       03700000
037010     CLOSE INPUT-SKU-FILE.                                        03701005
037100                                                                  03710000
037200     MOVE PV-INPUT-OBTR-READ TO PV-DISPLAY-FIELD.                 03720000
037300     DISPLAY 'INPUT OBTR RECORDS READ :  ' PV-DISPLAY-FIELD.      03730000
037400     MOVE PV-TSUOBTR-INSERTS TO PV-DISPLAY-FIELD.                 03740000
037500     DISPLAY 'TSUOBTR ROWS INSERTED   :  ' PV-DISPLAY-FIELD.      03750000
037600     MOVE PV-TSUOBTR-EXISTS  TO PV-DISPLAY-FIELD.                 03760000
037700     DISPLAY 'TSUOBTR ALREADY EXISTS  :  ' PV-DISPLAY-FIELD.      03770000
037800                                                                  03780000
037810     MOVE PV-INPUT-SKU-READ TO PV-DISPLAY-FIELD.                  03781003
037820     DISPLAY 'INPUT SKU RECORDS READ  :  ' PV-DISPLAY-FIELD.      03782003
037830     MOVE PV-SKU-INSERTS TO PV-DISPLAY-FIELD.                     03783003
037840     DISPLAY 'XLT_SKU ROWS INSERTED   :  ' PV-DISPLAY-FIELD.      03784003
037850     MOVE PV-SKU-EXISTS   TO PV-DISPLAY-FIELD.                    03785003
037860     DISPLAY 'XLT_SKU ALREADY EXISTS  :  ' PV-DISPLAY-FIELD.      03786003
037870                                                                  03787003
037900     MOVE PV-INPUT-BAL-READ TO PV-DISPLAY-FIELD.                  03790000
038000     DISPLAY 'INPUT BAL RECORDS READ  :  ' PV-DISPLAY-FIELD.      03800008
038100     MOVE PV-BAL-DELETES TO PV-DISPLAY-FIELD.                     03810000
038200     DISPLAY 'BAL TABLE DELETES       :  ' PV-DISPLAY-FIELD.      03820008
038300     MOVE PV-BAL-DELETE-NOT-EXISTS TO PV-DISPLAY-FIELD.           03830000
038400     DISPLAY 'BAL DELETE NOT EXISTS   :  ' PV-DISPLAY-FIELD.      03840008
038500     MOVE PV-BAL-INSERTS     TO PV-DISPLAY-FIELD.                 03850000
038600     DISPLAY 'BAL ROWS INSERTED       :  ' PV-DISPLAY-FIELD.      03860000
038700     MOVE PV-BAL-DUPLICATE   TO PV-DISPLAY-FIELD.                 03870000
038800     DISPLAY 'BAL ROWS DUPLICATED     :  ' PV-DISPLAY-FIELD.      03880000
038900                                                                  03890000
039000     MOVE PV-INPUT-DTL-READ TO PV-DISPLAY-FIELD.                  03900000
039100     DISPLAY 'INPUT DTL RECORDS READ  :  ' PV-DISPLAY-FIELD.      03910008
039200     MOVE PV-DTL-INSERTS     TO PV-DISPLAY-FIELD.                 03920000
039300     DISPLAY 'DTL ROWS INSERTED       :  ' PV-DISPLAY-FIELD.      03930000
039400     MOVE PV-DTL-DUPLICATE   TO PV-DISPLAY-FIELD.                 03940000
039500     DISPLAY 'DTL ROWS DUPLICATED     :  ' PV-DISPLAY-FIELD.      03950000
039600                                                                  03960000
039700     STOP RUN.                                                    03970000
039800                                                                  03980000
039900                                                                  03990000
040000* ************************************************************** *04000000
040100* * INITIALIZATIONS                                            * *04010000
040200* ************************************************************** *04020000
040300 1000-INITIALIZE.                                                 04030000
040400                                                                  04040000
040410     PERFORM 1100-GET-DB2-INSTANCE.                               04041009
040420     PERFORM 1200-CHECK-IF-PRODUCTION.                            04042009
040430                                                                  04043009
040500     OPEN  INPUT INPUT-BAL-FILE.                                  04050000
040600     OPEN  INPUT INPUT-DTL-FILE.                                  04060000
040700     OPEN  INPUT INPUT-OBTR-FILE.                                 04070000
040710     OPEN  INPUT INPUT-SKU-FILE.                                  04071005
040800                                                                  04080000
040900     MOVE ZERO TO PV-PREV-INTR-UPC-ID.                            04090000
041000     MOVE ZERO TO PV-PREV-LOC-NBR.                                04100000
041100                                                                  04110000
041200     PERFORM 9070-READ-OBTR-INPUT-FILE.                           04120000
041300                                                                  04130000
041310 1100-GET-DB2-INSTANCE.                                           04131009
041320                                                                  04132009
041330     MOVE '1100-GET-DB2-INSTANCE'                                 04133009
041340          TO PV-PARAGRAPH-NAME.                                   04134009
041350     MOVE 'GET DB2 INSTANCE'                                      04135009
041360          TO PV-DB2-OPERATION-MSG-1.                              04136010
041370                                                                  04137009
041380     EXEC SQL                                                     04138009
041390         SELECT CURRENT SERVER INTO :WS-LOCAL-SERVER              04139009
041391             FROM SYSIBM.SYSDUMMY1 WITH UR                        04139109
041392     END-EXEC.                                                    04139209
041393                                                                  04139309
041394     EVALUATE TRUE                                                04139409
041395         WHEN SQLCODE = +0                                        04139509
041396             CONTINUE                                             04139609
041397         WHEN SQLWARN0 NOT = SPACES                               04139709
041398         WHEN SQLCODE < +0                                        04139809
041399         WHEN SQLCODE > +0                                        04139909
041400             PERFORM 9999-DB2-ABEND                               04140009
041401     END-EVALUATE.                                                04140109
041402*                                                                 04140209
041403 1200-CHECK-IF-PRODUCTION.                                        04140309
041404                                                                  04140409
041405     MOVE '1200-CHECK-IF-PRODUCTION'                              04140509
041406          TO PV-PARAGRAPH-NAME.                                   04140609
041407     MOVE 'SELECT PRDCHK TKRPRPM '                                04140709
041408          TO PV-DB2-OPERATION-MSG-1.                              04140810
041409                                                                  04140909
041410     EXEC SQL                                                     04141009
041411       SELECT FUNC_TXT                                            04141109
041412         INTO :KRPRPM-FUNC-TXT                                    04141209
041413       FROM   TKRPRPM                                             04141309
041414       WHERE  SYS_PRC_FUNC_CDE  = :PC-PRDCHK                      04141409
041415         AND  INTFC_SYS_CDE     = :PC-KHL                         04141509
041416         AND  LOC_ID            = :PC-90                          04141609
041417         AND  FUNC_TXT          = :PC-PARM-TEXT                   04141709
041418     END-EXEC                                                     04141809
041419                                                                  04141909
041420     EVALUATE TRUE                                                04142009
041421         WHEN SQLCODE = +0                                        04142109
041422             CONTINUE                                             04142209
041423         WHEN SQLCODE = +100                                      04142309
041424             DISPLAY '*******************************************'04142409
041425             DISPLAY '** ABEND - DO NOT RUN THIS SUKUP932 PROGRAM'04142512
041426             DISPLAY '** ABEND - AGAINST PRODUCTION'              04142609
041427             DISPLAY '** ABEND - THIS SHOULD ONLY EVER BE'        04142709
041428             DISPLAY '** ABEND - RUN AGAINST TEST DATA'           04142809
041429             DISPLAY '*******************************************'04142909
041430             DISPLAY '** ABEND - THIS RUN IS GOING AGAINST'       04143009
041431             DISPLAY '** ABEND - DB2 INSTANCE:  '                 04143109
041432                     WS-LOCAL-SERVER                              04143209
041433             DISPLAY '*******************************************'04143309
041434             PERFORM 9999-DB2-ABEND                               04143409
041435                                                                  04143509
041436         WHEN SQLWARN0 NOT = SPACES                               04143609
041437         WHEN SQLCODE < +0                                        04143709
041438         WHEN SQLCODE > +0                                        04143809
041439             PERFORM 9999-DB2-ABEND                               04143909
041440     END-EVALUATE.                                                04144009
041441                                                                  04144109
041450 2000-PROCESS-OBTR-INPUT-FILE.                                    04145000
041500                                                                  04150000
041600     EXEC SQL                                                     04160000
041700       INSERT INTO TSUOBTR                                        04170000
041800           ( OTBND_TRIP_ID                                        04180000
041900            ,ORGN_OPER_UNT_ID                                     04190000
042000            ,DEST_OPER_UNT_ID                                     04200000
042100            ,TRLR_SRL_NBR                                         04210000
042200            ,BOL_ID                                               04220000
042300            ,EST_ARRVL_TMST                                       04230000
042400            ,TRIP_ACTV_CDE                                        04240000
042500            ,DOOR_TYP_CDE)                                        04250000
042600       VALUES                                                     04260000
042700           ( :IR-OBTR-OTBND-TRIP-ID                               04270000
042800           , :IR-OBTR-ORGN-OPER-UNT-ID                            04280000
042900           , :IR-OBTR-DEST-OPER-UNT-ID                            04290000
043000           , :IR-OBTR-TRLR-SRL-NBR                                04300000
043100           , :IR-OBTR-BOL-ID                                      04310000
043200           , :IR-OBTR-EST-ARRVL-TMST                              04320000
043300           , :IR-OBTR-TRIP-ACTV-CDE                               04330000
043400           , :IR-OBTR-DOOR-TYP-CDE)                               04340000
043500     END-EXEC.                                                    04350000
043600                                                                  04360000
043700     EVALUATE TRUE                                                04370000
043800         WHEN SQLCODE = ZERO                                      04380000
043900          ADD +1 TO PV-TSUOBTR-INSERTS                            04390000
044000         WHEN SQLCODE = -803                                      04400000
044100          ADD +1 TO PV-TSUOBTR-EXISTS                             04410000
044200         WHEN SQLWARN0 NOT = SPACE                                04420000
044300         WHEN SQLCODE < ZERO                                      04430000
044400         WHEN SQLCODE > ZERO                                      04440000
044500          MOVE IR-OBTR-OTBND-TRIP-ID TO                           04450000
044600               PV-DISP-OTBND-TRIP-ID                              04460000
044700          DISPLAY 'OUTBOUND TRIP: ' PV-DISP-OTBND-TRIP-ID         04470000
044800          MOVE '2000-PROCESS-OBTR-INPUT-FILE'                     04480000
044900                             TO PV-PARAGRAPH-NAME                 04490000
045000          MOVE 'INSERT TSUOBTR'                                   04500000
045100                             TO PV-DB2-OPERATION-MSG-1            04510000
045200          MOVE 'TSUOBTR'     TO PV-DB2-TABLE-NAME                 04520000
045300          PERFORM 9999-DB2-ABEND                                  04530000
045400     END-EVALUATE.                                                04540000
045500                                                                  04550000
045600     ADD +1 TO PV-COMMIT-CNT.                                     04560001
045700                                                                  04570001
045800     IF  PV-COMMIT-CNT = PC-200                                   04580001
045900         PERFORM 7000-TABLE-COMMIT                                04590001
046000         MOVE ZERO TO PV-COMMIT-CNT                               04600001
046100     END-IF.                                                      04610001
046200                                                                  04620001
046300     PERFORM 9070-READ-OBTR-INPUT-FILE.                           04630000
046400                                                                  04640000
046410 3000-PROCESS-SKU-INPUT-FILE.                                     04641004
046420                                                                  04642003
046430     EXEC SQL                                                     04643003
046440       INSERT INTO XLT_SKU                                        04644004
046450           ( INTR_UPC_ID                                          04645004
046460            ,STYL_ID                                              04646004
046470            ,ITM_NBR                                              04647004
046480            ,SKU_NBR                                              04648004
046490            ,SKU_STAT_CDE                                         04649004
046491            ,SKU_STAT_DESC                                        04649104
046492            ,INNR_PK_QTY                                          04649204
046493            ,OUTR_PK_QTY                                          04649304
046494            ,SKU_DESC                                             04649404
046495            ,KOHLS_SIZE_CDE                                       04649504
046496            ,SIZE_DESC                                            04649604
046497            ,NRF_CLOR_CDE                                         04649704
046498            ,SHRT_CLOR_DESC                                       04649804
046499            ,CSTM_CLOR_DESC                                       04649904
046500            ,REGN_PRIC_IND                                        04650004
046501            ,KY_ITM_IND                                           04650104
046502            ,GP_CDE                                               04650204
046503            ,LAST_UPD_TMST                                        04650304
046504            ,WHSE_RPLNT_IND)                                      04650404
046509       VALUES                                                     04650904
046510           ( :IR-SKU-INTR-UPC-ID                                  04651004
046511           , :IR-SKU-STYL-ID                                      04651104
046512           , :IR-SKU-ITM-NBR                                      04651204
046513           , :IR-SKU-SKU-NBR                                      04651304
046514           , :IR-SKU-SKU-STAT-CDE                                 04651404
046515           , :IR-SKU-SKU-STAT-DESC                                04651504
046516           , :IR-SKU-INNR-PK-QTY                                  04651604
046517           , :IR-SKU-OUTR-PK-QTY                                  04651704
046518           , :IR-SKU-SKU-DESC                                     04651804
046519           , :IR-SKU-KOHLS-SIZE-CDE                               04651904
046520           , :IR-SKU-SIZE-DESC                                    04652004
046521           , :IR-SKU-NRF-CLOR-CDE                                 04652104
046522           , :IR-SKU-SHRT-CLOR-DESC                               04652204
046523           , :IR-SKU-CSTM-CLOR-DESC                               04652304
046524           , :IR-SKU-REGN-PRIC-IND                                04652404
046525           , :IR-SKU-KY-ITM-IND                                   04652504
046526           , :IR-SKU-GP-CDE                                       04652604
046527           , :IR-SKU-LAST-UPD-TMST                                04652704
046528           , :IR-SKU-WHSE-RPLNT-IND)                              04652804
046533     END-EXEC.                                                    04653304
046534                                                                  04653404
046535     EVALUATE TRUE                                                04653504
046536         WHEN SQLCODE = ZERO                                      04653604
046537          ADD +1 TO PV-SKU-INSERTS                                04653704
046538         WHEN SQLCODE = -803                                      04653804
046539          ADD +1 TO PV-SKU-EXISTS                                 04653904
046540         WHEN SQLWARN0 NOT = SPACE                                04654004
046541         WHEN SQLCODE < ZERO                                      04654104
046542         WHEN SQLCODE > ZERO                                      04654204
046543          MOVE IR-SKU-INTR-UPC-ID TO                              04654304
046544               PV-DISP-INTR-UPC-ID                                04654404
046545          DISPLAY 'INTERNAL UPC ID: ' PV-DISP-INTR-UPC-ID         04654504
046546          DISPLAY 'SKU NUMBER     : ' IR-SKU-SKU-NBR              04654604
046547          MOVE '3000-PROCESS-SKU-INPUT-FILE'                      04654704
046548                             TO PV-PARAGRAPH-NAME                 04654804
046549          MOVE 'INSERT XLT_SKU'                                   04654904
046550                             TO PV-DB2-OPERATION-MSG-1            04655004
046551          MOVE 'XLT_SKU'     TO PV-DB2-TABLE-NAME                 04655104
046552          PERFORM 9999-DB2-ABEND                                  04655204
046553     END-EVALUATE.                                                04655304
046554                                                                  04655404
046555     ADD +1 TO PV-COMMIT-CNT.                                     04655504
046556                                                                  04655604
046557     IF  PV-COMMIT-CNT = PC-200                                   04655704
046558         PERFORM 7000-TABLE-COMMIT                                04655804
046559         MOVE ZERO TO PV-COMMIT-CNT                               04655904
046560     END-IF.                                                      04656004
046561                                                                  04656104
046562     PERFORM 9080-READ-SKU-INPUT-FILE.                            04656204
046563                                                                  04656304
046570 4000-PROCESS-BAL-INPUT-FILE.                                     04657004
046600                                                                  04660000
046700     IF  PV-PREV-INTR-UPC-ID = IR-BAL-INTR-UPC-ID                 04670000
046800     AND PV-PREV-LOC-NBR     = IR-BAL-LOC-NBR                     04680000
046900         NEXT SENTENCE                                            04690000
047000     ELSE                                                         04700000
047100         PERFORM 4100-DELETE-ENTRIES                              04710000
047200         MOVE IR-BAL-INTR-UPC-ID TO PV-PREV-INTR-UPC-ID           04720000
047300         MOVE IR-BAL-LOC-NBR     TO PV-PREV-LOC-NBR               04730000
047400     END-IF.                                                      04740000
047500                                                                  04750000
047600     EXEC SQL                                                     04760000
047700             INSERT INTO PCT_TRN_CLSN_BAL                         04770000
047800           ( INTR_UPC_ID                                          04780000
047900            ,LOC_NBR                                              04790000
048000            ,TRN_CLSN_CDE                                         04800000
048100            ,TRN_CLSN_QTY                                         04810000
048200            ,LAST_UPD_DTE                                         04820000
048300           )                                                      04830000
048400             VALUES                                               04840000
048500           (                                                      04850000
048600             :IR-BAL-INTR-UPC-ID                                  04860000
048700           , :IR-BAL-LOC-NBR                                      04870000
048800           , :IR-BAL-TRN-CLSN-CDE                                 04880000
048900           , :IR-BAL-TRN-CLSN-QTY                                 04890000
049000           , :IR-BAL-LAST-UPD-DTE                                 04900000
049100           )                                                      04910000
049200     END-EXEC.                                                    04920000
049300                                                                  04930000
049400     EVALUATE TRUE                                                04940000
049500         WHEN SQLCODE = ZERO                                      04950000
049600          ADD +1 TO PV-BAL-INSERTS                                04960000
049700         WHEN SQLCODE = -803                                      04970000
049800          ADD +1 TO PV-BAL-DUPLICATE                              04980000
049900         WHEN SQLWARN0 NOT = SPACE                                04990000
050000         WHEN SQLCODE < ZERO                                      05000000
050100         WHEN SQLCODE > ZERO                                      05010000
050200          MOVE IR-BAL-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID          05020000
050300          MOVE IR-BAL-LOC-NBR     TO PV-DISP-LOC-NBR              05030000
050400          DISPLAY 'INTR UPC ID  : ' PV-DISP-INTR-UPC-ID           05040000
050500          DISPLAY 'LOC NBR      : ' PV-DISP-LOC-NBR               05050000
050600          MOVE '4000-PROCESS-BAL-INPUT-FILE'                      05060000
050700                             TO PV-PARAGRAPH-NAME                 05070000
050800          MOVE 'INSERT PCT_TRN_CLSN_BAL'                          05080000
050900                             TO PV-DB2-OPERATION-MSG-1            05090000
051000          MOVE 'PCT_TRN_CLSN_BAL' TO PV-DB2-TABLE-NAME            05100005
051100          PERFORM 9999-DB2-ABEND                                  05110000
051200     END-EVALUATE.                                                05120000
051300                                                                  05130000
051400     ADD +1 TO PV-COMMIT-CNT.                                     05140001
051500                                                                  05150001
051600     IF  PV-COMMIT-CNT = PC-200                                   05160001
051700         PERFORM 7000-TABLE-COMMIT                                05170001
051800         MOVE ZERO TO PV-COMMIT-CNT                               05180001
051900     END-IF.                                                      05190001
052000                                                                  05200001
052100     PERFORM 9050-READ-BAL-INPUT-FILE.                            05210000
052200                                                                  05220000
052300 4100-DELETE-ENTRIES.                                             05230000
052400                                                                  05240000
052500     EXEC SQL                                                     05250000
052600             DELETE                                               05260000
052700              FROM  PCT_TRN_CLSN_BAL                              05270000
052800             WHERE                                                05280000
052900                   INTR_UPC_ID  = :IR-BAL-INTR-UPC-ID             05290000
053000               AND LOC_NBR      = :IR-BAL-LOC-NBR                 05300000
053100     END-EXEC.                                                    05310000
053200                                                                  05320000
053300     EVALUATE TRUE                                                05330000
053400         WHEN SQLCODE = ZERO                                      05340000
053500          ADD +1 TO PV-BAL-DELETES                                05350000
053600         WHEN SQLCODE = +100                                      05360000
053700          ADD +1 TO PV-BAL-DELETE-NOT-EXISTS                      05370000
053800         WHEN SQLWARN0 NOT = SPACE                                05380000
053900         WHEN SQLCODE < ZERO                                      05390000
054000         WHEN SQLCODE > ZERO                                      05400000
054100          MOVE IR-BAL-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID          05410000
054200          MOVE IR-BAL-LOC-NBR     TO PV-DISP-LOC-NBR              05420000
054300          DISPLAY 'INTR UPC ID  : ' PV-DISP-INTR-UPC-ID           05430000
054400          DISPLAY 'LOC NBR      : ' PV-DISP-LOC-NBR               05440000
054500          MOVE '4100-DELETE-ENTRIES'                              05450000
054600                             TO PV-PARAGRAPH-NAME                 05460000
054700          MOVE 'DELETE PCT_TRN_CLSN_BAL'                          05470000
054800                             TO PV-DB2-OPERATION-MSG-1            05480000
054900          MOVE 'PCT_TRN_CLSN_BAL' TO PV-DB2-TABLE-NAME            05490005
055000          PERFORM 9999-DB2-ABEND                                  05500000
055100     END-EVALUATE.                                                05510000
055200                                                                  05520000
055300 6000-PROCESS-DTL-INPUT-FILE.                                     05530000
055400                                                                  05540000
055500     IF  IR-DTL-OTBND-TRIP-ID = ZERO                              05550000
055600         PERFORM 6100-INSERT-DTL-NULL                             05560000
055700     ELSE                                                         05570000
055800         PERFORM 6200-INSERT-DTL-TRIP                             05580000
055900     END-IF.                                                      05590000
056000                                                                  05600000
056100     ADD +1 TO PV-COMMIT-CNT.                                     05610001
056200                                                                  05620001
056300     IF  PV-COMMIT-CNT = PC-200                                   05630001
056400         PERFORM 7000-TABLE-COMMIT                                05640001
056500         MOVE ZERO TO PV-COMMIT-CNT                               05650001
056600     END-IF.                                                      05660001
056700                                                                  05670001
056800     PERFORM 9060-READ-DTL-INPUT-FILE.                            05680000
056900                                                                  05690000
057000 6100-INSERT-DTL-NULL.                                            05700000
057100                                                                  05710000
057200     EXEC SQL                                                     05720000
057300             INSERT INTO PCT_TRN_CLSN_DTL                         05730000
057400           ( INTR_UPC_ID                                          05740000
057500            ,LOC_NBR                                              05750000
057600            ,TRN_CLSN_CDE                                         05760000
057700            ,IN_TRNST_TRN_TMST                                    05770000
057800            ,TRN_TYP_CDE                                          05780000
057900            ,TRN_CLSN_PRCG_QTY                                    05790000
058000            ,TRN_CLSN_BAL_QTY                                     05800000
058100            ,UPD_USR_ID                                           05810000
058200            ,OTBND_TRIP_ID                                        05820000
058300            ,PO_NBR                                               05830000
058400            ,RCVR_SEQ_NBR)                                        05840000
058500             VALUES                                               05850000
058600           ( :IR-DTL-INTR-UPC-ID                                  05860000
058700           , :IR-DTL-LOC-NBR                                      05870000
058800           , :IR-DTL-TRN-CLSN-CDE                                 05880000
058900           , :IR-DTL-IN-TRNST-TRN-TMST                            05890000
059000           , :IR-DTL-TRN-TYP-CDE                                  05900000
059100           , :IR-DTL-TRN-CLSN-PRCG-QTY                            05910000
059200           , :IR-DTL-TRN-CLSN-BAL-QTY                             05920000
059300           , :IR-DTL-UPD-USR-ID                                   05930000
059400           , NULL                                                 05940000
059500           , :IR-DTL-PO-NBR                                       05950000
059600           , :IR-DTL-RCVR-SEQ-NBR                                 05960000
059700           )                                                      05970000
059800     END-EXEC.                                                    05980000
059900                                                                  05990000
060000     EVALUATE TRUE                                                06000000
060100         WHEN SQLCODE = ZERO                                      06010000
060200          ADD +1 TO PV-DTL-INSERTS                                06020000
060300         WHEN SQLCODE = -803                                      06030000
060400          ADD +1 TO PV-DTL-DUPLICATE                              06040000
060500         WHEN SQLWARN0 NOT = SPACE                                06050000
060600         WHEN SQLCODE < ZERO                                      06060000
060700         WHEN SQLCODE > ZERO                                      06070000
060800          MOVE IR-DTL-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID          06080000
060900          MOVE IR-DTL-LOC-NBR     TO PV-DISP-LOC-NBR              06090000
061000          DISPLAY 'INTR UPC ID  : ' PV-DISP-INTR-UPC-ID           06100000
061100          DISPLAY 'LOC NBR      : ' PV-DISP-LOC-NBR               06110000
061200          MOVE '6100-INSERT-DTL-NULL'                             06120000
061300                             TO PV-PARAGRAPH-NAME                 06130000
061400          MOVE 'INSERT PCT_TRN_CLSN_DTL'                          06140000
061500                             TO PV-DB2-OPERATION-MSG-1            06150000
061600          MOVE 'PCT_TRN_CLSN_DTL' TO PV-DB2-TABLE-NAME            06160005
061700          PERFORM 9999-DB2-ABEND                                  06170000
061800     END-EVALUATE.                                                06180000
061900                                                                  06190000
062000 6200-INSERT-DTL-TRIP.                                            06200000
062100                                                                  06210000
062200     EXEC SQL                                                     06220000
062300             INSERT INTO PCT_TRN_CLSN_DTL                         06230000
062400           ( INTR_UPC_ID                                          06240000
062500            ,LOC_NBR                                              06250000
062600            ,TRN_CLSN_CDE                                         06260000
062700            ,IN_TRNST_TRN_TMST                                    06270000
062800            ,TRN_TYP_CDE                                          06280000
062900            ,TRN_CLSN_PRCG_QTY                                    06290000
063000            ,TRN_CLSN_BAL_QTY                                     06300000
063100            ,UPD_USR_ID                                           06310000
063200            ,OTBND_TRIP_ID                                        06320000
063300            ,PO_NBR                                               06330000
063400            ,RCVR_SEQ_NBR)                                        06340000
063500             VALUES                                               06350000
063600           ( :IR-DTL-INTR-UPC-ID                                  06360000
063700           , :IR-DTL-LOC-NBR                                      06370000
063800           , :IR-DTL-TRN-CLSN-CDE                                 06380000
063900           , :IR-DTL-IN-TRNST-TRN-TMST                            06390000
064000           , :IR-DTL-TRN-TYP-CDE                                  06400000
064100           , :IR-DTL-TRN-CLSN-PRCG-QTY                            06410000
064200           , :IR-DTL-TRN-CLSN-BAL-QTY                             06420000
064300           , :IR-DTL-UPD-USR-ID                                   06430000
064400           , :IR-DTL-OTBND-TRIP-ID                                06440000
064500           , :IR-DTL-PO-NBR                                       06450000
064600           , :IR-DTL-RCVR-SEQ-NBR                                 06460000
064700           )                                                      06470000
064800     END-EXEC.                                                    06480000
064900                                                                  06490000
065000     EVALUATE TRUE                                                06500000
065100         WHEN SQLCODE = ZERO                                      06510000
065200          ADD +1 TO PV-DTL-INSERTS                                06520000
065300         WHEN SQLCODE = -803                                      06530000
065400          ADD +1 TO PV-DTL-DUPLICATE                              06540000
065500         WHEN SQLWARN0 NOT = SPACE                                06550000
065600         WHEN SQLCODE < ZERO                                      06560000
065700         WHEN SQLCODE > ZERO                                      06570000
065800          MOVE IR-DTL-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID          06580000
065900          MOVE IR-DTL-LOC-NBR     TO PV-DISP-LOC-NBR              06590000
066000          DISPLAY 'INTR UPC ID  : ' PV-DISP-INTR-UPC-ID           06600000
066100          DISPLAY 'LOC NBR      : ' PV-DISP-LOC-NBR               06610000
066200          MOVE '6200-INSERT-DTL-TRIP'                             06620000
066300                             TO PV-PARAGRAPH-NAME                 06630000
066400          MOVE 'INSERT PCT_TRN_CLSN_DTL'                          06640000
066500                             TO PV-DB2-OPERATION-MSG-1            06650000
066600          MOVE 'PCT_TRN_CLSN_DTL' TO PV-DB2-TABLE-NAME            06660011
066700          PERFORM 9999-DB2-ABEND                                  06670000
066800     END-EVALUATE.                                                06680000
066900                                                                  06690001
067000***************************************************************** 06700001
067100* COMMIT THE PENDING TABLE CHANGES.                             * 06710001
067200***************************************************************** 06720001
067300 7000-TABLE-COMMIT.                                               06730001
067400                                                                  06740001
067500     EXEC SQL                                                     06750001
067600          COMMIT                                                  06760001
067700     END-EXEC.                                                    06770001
067800                                                                  06780000
067900 9050-READ-BAL-INPUT-FILE.                                        06790000
068000                                                                  06800000
068100     READ INPUT-BAL-FILE                                          06810000
068200          INTO IR-BAL-INPUT-RECORD                                06820000
068300          AT END                                                  06830000
068400              SET PS-INPUT-EOF TO TRUE.                           06840000
068500                                                                  06850000
068600     IF  PS-INPUT-EOF                                             06860000
068700         CONTINUE                                                 06870000
068800     ELSE                                                         06880000
068900         ADD +1 TO PV-INPUT-BAL-READ                              06890000
069000                   PV-INPUT-CHECK-CNT                             06900000
069100         IF  PV-INPUT-CHECK-CNT = 7500                            06910007
069200             MOVE PV-INPUT-BAL-READ TO                            06920000
069300                  DP-OUT-CNT                                      06930000
069400             DISPLAY 'PROGRAM PROGRESS BAL READS : '              06940000
069500                     DP-OUT-CNT                                   06950000
069600             MOVE +0 TO PV-INPUT-CHECK-CNT                        06960000
069700         END-IF                                                   06970000
069800     END-IF.                                                      06980000
069900                                                                  06990000
070000 9060-READ-DTL-INPUT-FILE.                                        07000000
070100                                                                  07010000
070200     READ INPUT-DTL-FILE                                          07020000
070300          INTO IR-DTL-INPUT-RECORD                                07030000
070400          AT END                                                  07040000
070500              SET PS-INPUT-EOF TO TRUE.                           07050000
070600                                                                  07060000
070700     IF  PS-INPUT-EOF                                             07070000
070800         CONTINUE                                                 07080000
070900     ELSE                                                         07090000
071000         ADD +1 TO PV-INPUT-DTL-READ                              07100000
071100                   PV-INPUT-CHECK-CNT                             07110000
071200         IF  PV-INPUT-CHECK-CNT = 7500                            07120007
071300             MOVE PV-INPUT-DTL-READ TO                            07130000
071400                  DP-OUT-CNT                                      07140000
071500             DISPLAY 'PROGRAM PROGRESS DTL READS : '              07150000
071600                     DP-OUT-CNT                                   07160000
071700             MOVE +0 TO PV-INPUT-CHECK-CNT                        07170000
071800         END-IF                                                   07180000
071900     END-IF.                                                      07190000
072000                                                                  07200000
072100 9070-READ-OBTR-INPUT-FILE.                                       07210000
072200                                                                  07220000
072300     READ INPUT-OBTR-FILE                                         07230000
072400          INTO IR-OBTR-INPUT-RECORD                               07240000
072500          AT END                                                  07250000
072600              SET PS-INPUT-EOF TO TRUE.                           07260000
072700                                                                  07270000
072800     IF  PS-INPUT-EOF                                             07280000
072900         CONTINUE                                                 07290000
073000     ELSE                                                         07300000
073100         ADD +1 TO PV-INPUT-OBTR-READ                             07310000
073200                   PV-INPUT-CHECK-CNT                             07320000
073300         IF  PV-INPUT-CHECK-CNT = 750                             07330007
073400             MOVE PV-INPUT-OBTR-READ TO                           07340000
073500                  DP-OUT-CNT                                      07350000
073600             DISPLAY 'PROGRAM PROGRESS OBTR READS: '              07360000
073700                     DP-OUT-CNT                                   07370000
073800             MOVE +0 TO PV-INPUT-CHECK-CNT                        07380000
073900         END-IF                                                   07390000
074000     END-IF.                                                      07400000
074100                                                                  07410000
074110 9080-READ-SKU-INPUT-FILE.                                        07411003
074120                                                                  07412003
074130     READ INPUT-SKU-FILE                                          07413003
074140          INTO IR-SKU-INPUT-RECORD                                07414003
074150          AT END                                                  07415003
074160              SET PS-INPUT-EOF TO TRUE.                           07416003
074170                                                                  07417003
074180     IF  PS-INPUT-EOF                                             07418003
074190         CONTINUE                                                 07419003
074191     ELSE                                                         07419103
074192         ADD +1 TO PV-INPUT-SKU-READ                              07419203
074193                   PV-INPUT-CHECK-CNT                             07419303
074194         IF  PV-INPUT-CHECK-CNT = 750                             07419407
074195             MOVE PV-INPUT-SKU-READ TO                            07419503
074196                  DP-OUT-CNT                                      07419603
074197             DISPLAY 'PROGRAM PROGRESS SKU READS: '               07419703
074198                     DP-OUT-CNT                                   07419803
074199             MOVE +0 TO PV-INPUT-CHECK-CNT                        07419903
074200         END-IF                                                   07420003
074201     END-IF.                                                      07420103
074202                                                                  07420203
074210* ************************************************************** *07421003
074300* * DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *07430000
074400* * AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN          * *07440000
074500* * SQL ERROR OR WARNING CODE OCCURS.                          * *07450000
074600* ************************************************************** *07460000
074700 9999-DB2-ABEND.                                                  07470000
074800                                                                  07480000
074900     DISPLAY PC-CURRENT-PROGRAM-NAME                              07490000
075000             ' 9999-DB2-ABEND'.                                   07500000
075100     DISPLAY PC-CURRENT-PROGRAM-NAME                              07510000
075200             ' ** ABEND           **'.                            07520000
075300     DISPLAY PC-CURRENT-PROGRAM-NAME                              07530000
075400             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       07540000
075500     DISPLAY PC-CURRENT-PROGRAM-NAME                              07550000
075600             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       07560000
075700     DISPLAY PC-CURRENT-PROGRAM-NAME                              07570000
075800             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  07580000
075900                                                                  07590000
076000     DISPLAY PC-CURRENT-PROGRAM-NAME                              07600000
076100             ' ** SQLCODE         ** = ' SQLCODE.                 07610000
076200     MOVE SQLCODE TO PV-SQLCODE.                                  07620000
076300     DISPLAY PC-CURRENT-PROGRAM-NAME                              07630000
076400             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          07640000
076500                                                                  07650000
076600     DISPLAY PC-CURRENT-PROGRAM-NAME                              07660000
076700             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            07670000
076800                                                                  07680000
076900                                                                  07690000
077000*----------------------------------------------------------------*07700000
077100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *07710000
077200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *07720000
077300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *07730000
077400* FORMAT.                                                        *07740000
077500*----------------------------------------------------------------*07750000
077600     COPY DPPD004.                                                07760000
077700                                                                  07770000
077800                                                                  07780000
077900*----------------------------------------------------------------*07790000
078000* CALL ABEND                                                     *07800000
078100*----------------------------------------------------------------*07810000
078200     MOVE +4013                  TO ABEND-CODE.                   07820000
078300     CALL 'ILBOABN0' USING ABEND-CODE.                            07830000
078400*                                                                 07840000
