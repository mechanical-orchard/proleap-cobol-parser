000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    POKCS107.                                         00040000
000500 AUTHOR.        RENEE JAEGER.                                     00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  11/97.                                            00070000
000800 DATE-COMPILED.                                                   00080000
000900*----------------------------------------------------------------*00090000
001000*    W107 - IMPORT ORDER TRACKING                                *00100000
001100*                                                                *00110000
001200*    THIS PROGRAM ALLOWS THE USER TO VIEW IMPORT INFORMATION     *00120000
001300*    FOR A PURCHASE ORDER IN INQUIRY ONLY.                       *00130000
001400*----------------------------------------------------------------*00140000
001100* 11/15/99 TKMA340 THIS PROGRAM IS ESSENTIALLY A CLONE OF        *00150011
001100*                  POKCS088, THE HARD CODED DC NUMBERS OF 085    *00160011
001100*                  AND 810 WERE REPLACED WITH HARD CODING FOR    *00170011
001100*                  DC'S 845 AND 840.                             *00180011
001100*                  THE INTER-APPLICATION COMMAREA IS BEING USED  *00190011
001100*                  TO RECEIVE THE DC VERIFIED TOTAL FROM         *00200011
001100*                  POKCS088.                                     *00210011
001100*                  THE TOTAL COLUMN DISPLYS THE QUANTITIES       *00220011
001100*                  FROM BOTH POKCS088 AND POKCS107.              *00230011
001400*----------------------------------------------------------------*00240011
001100* 11/23/99 TKMA340 DISPLAY DC 840 FIRST, FOLLOWED BY 845.        *00250014
001100*                  MODIFY PROGRAM TO DISPLAY TOTALS FROM POKCS088*00260014
001100*                  DC'S 085, 810, 830 WHEN NO DATA IS PRESENT FOR*00270014
001100*                  840 AND 845.                                  *00280014
001400*----------------------------------------------------------------*00290014
001100* 10/01/01 TKMA609 PROGRAM WILL NOW DISPLAY INFORMATION FOR DC   *00300016
001100*                  870, ALONG WITH TOTALS FOR ALL DCS INSTEAD    *00310018
001100*                  OF DISPLAYING 840, 845, AND TOTALS.           *00320018
001400*----------------------------------------------------------------*00330016
001100* 08/07/02 TKMA609 ADDED DC 865 TO DISPLAY.                      *00340023
001400*----------------------------------------------------------------*00350020
C98147* 11/21/14 TKMA394  LINDA FRIESS              - CHG0098147        00360025
C98147*   - EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND COMMAREA          00370025
C98147*   - REMOVED UNUSED FIELDS & LOGIC FROM PARAGRAPH 4000           00380025
C98147*----------------------------------------------------------------*00390025
CICS  *  CHANGED 11/16/2022    BY BARB SCHULTZ    WR: CHG0278485        00391028
CICS  *                                                                 00392027
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     00393027
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00394027
CICS  *----------------------------------------------------------------*00394127
C98147*                                                                 00396027
001500                                                                  00400000
001600 ENVIRONMENT DIVISION.                                            00410000
001700 DATA DIVISION.                                                   00420000
001800 WORKING-STORAGE SECTION.                                         00430000
001900                                                                  00440000
002000 01  DK-DB2-KEYS.                                                 00450000
002100     05  DK-PO-NBR                PIC S9(09) VALUE +0 COMP.       00460000
002200                                                                  00470000
002300 01  PC-PROGRAM-CONSTANTS.                                        00480000
002310     05  PC-PCT                         PIC  X(01)  VALUE '%'.    00490000
002400     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'POKCS107'.  00500000
002500     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'PO107A  '.  00510000
002600     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'POKM107 '.  00520000
002700     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00530000
002800                                              COMP.               00540000
002900     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00550000
003000                                              COMP.               00560000
003100     05  PC-MAX-ITEMS             PIC S9(09)  VALUE +1000000      00570000
003200                                              COMP-3.             00580000
003300     05  PC-TSYMSG-NUMBERS.                                       00590000
003410         10  PC-TSYMSG-00050      PIC  9(05)  VALUE  00050.       00600000
003420         10  PC-TSYMSG-00726      PIC  9(05)  VALUE  00726.       00610000
003440 01  PS-PROGRAM-SWITCHES.                                         00620000
003450     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00630000
003460         88  PS-ERROR                         VALUE  'Y'.         00640000
003470         88  PS-NO-ERROR                      VALUE  'N'.         00650000
003471     05  PS-VSORAIR-SW            PIC  X(01)  VALUE  'Y'.         00660000
003473         88  PS-ALL-VSORAIR                   VALUE  'Y'.         00670000
003474         88  PS-NOT-ALL-VSORAIR               VALUE  'N'.         00680000
003480*                                                                 00690000
003490 01  PV-PROGRAM-VARIABLES.                                        00700000
003493     05  PV-TOT-REC-PCT                 PIC S9(03)V99             00710000
003494                                                     COMP-3.      00720000
003495    05  PV-NORMAL-TOTALS.                                         00730000
003501        10  PV-TOTREC1PCT-X.                                      00740000
003502           15 PV-TREC-PCT1                  PIC  ZZ9.             00750000
003503           15 PV-TREC-PCT1-SIGN             PIC  X(01).           00760000
003504        10  FILLER                          PIC X(08).            00770000
003505        10  PV-TOTREC2PCT-X.                                      00780000
003506           15 PV-TREC-PCT2                  PIC  ZZ9.             00790000
003507           15 PV-TREC-PCT2-SIGN             PIC  X(01).           00800000
003508        10  FILLER                          PIC X(08).            00810008
003505        10  PV-TOTREC3PCT-X.                                      00820008
003506           15 PV-TREC-PCT3                  PIC  ZZ9.             00830008
003507           15 PV-TREC-PCT3-SIGN             PIC  X(01).           00840008
003508        10  FILLER                          PIC X(08).            00850008
003513        10  PV-TOTRECPCT-X.                                       00860000
003514           15 PV-TREC-PCT                   PIC  ZZ9.             00870000
003515           15 PV-TREC-PCT-SIGN              PIC  X(01).           00880000
003516     05  PV-DC-REC-QTY                  PIC S9(09)   VALUE +0     00890000
003517                                                     COMP.        00900000
003518     05  PV-QTY-NULL                    PIC S9(04)   VALUE +0     00910000
003519                                                     COMP.        00920000
003530     05  PV-OTB                         PIC X(06)    VALUE SPACES.00930000
003600     05  PV-OTB-RED REDEFINES PV-OTB.                             00940000
003700         10 PV-OTB-CC                   PIC X(02).                00950000
003710         10 PV-OTB-YY                   PIC X(02).                00960000
003800         10 PV-OTB-MM                   PIC X(02).                00970000
003910     05  PV-OTB2                        PIC X(06)    VALUE SPACES.00980000
004000     05  PV-OTB-RED2 REDEFINES PV-OTB2.                           00990000
004100         10 PV-OTB-MM2                  PIC X(02).                01000000
004200         10 PV-OTB-YY2                  PIC X(02).                01010000
004201         10 PV-OTB-CC2                  PIC X(02).                01020000
004206     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01030000
004207                                              COMP SYNC.          01040000
004208     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01050000
004209                                              COMP SYNC.          01060000
004210     05  PV-READ-COUNT            PIC S9(09)  VALUE +0            01070000
004211                                              COMP-3.             01080000
004220     05  PV-OPER-UNT-ID           PIC  S9(4)  COMP.               01090000
004230     05  PV-MAX-STATUS-DTE        PIC  X(10).                     01100000
004240     05  PV-MIN-STATUS-DTE        PIC  X(10).                     01110000
004241     05  PV-MAX-VERIFD-DTE        PIC  X(10).                     01120000
004242     05  PV-MIN-VERIFD-DTE        PIC  X(10).                     01130000
004250     05  PV-SHIPST-ETA-DATE       PIC  X(10).                     01140000
004260     05  PV-DATE-BREAK.                                           01150000
004270         10  FILLER               PIC  X(02).                     01160000
004280         10  PV-DB-YY             PIC  X(02).                     01170000
004290         10  FILLER               PIC  X(01).                     01180000
004300         10  PV-DB-MM             PIC  X(02).                     01190000
004400         10  FILLER               PIC  X(01).                     01200000
004500         10  PV-DB-DD             PIC  X(02).                     01210000
004600     05  PV-DATE-DISPLAY.                                         01220000
004700         10  PV-DD-MM             PIC  X(02).                     01230000
004800         10  FILLER               PIC  X(01) VALUE '/'.           01240000
004900         10  PV-DD-DD             PIC  X(02).                     01250000
005000         10  FILLER               PIC  X(01) VALUE '/'.           01260000
005100         10  PV-DD-YY             PIC  X(02).                     01270000
005200                                                                  01280000
005300*----------------------------------------------------------------*01290000
005400*    MAP LAYOUT                                                  *01300000
005500*----------------------------------------------------------------*01310000
005600     COPY POKM107.                                                01320000
005610 01  MR-OCCURS-LAYOUT                   REDEFINES  PO107AO.       01330000
C98147     05  FILLER                         PIC X(426).               01340026
005633     05  MR-TOTAL-LINEL                 PIC S9(04) COMP.          01350000
005634     05  MR-TOTAL-LINEA                 PIC  X(01).               01360000
005635     05  MR-TOTAL-LINEC                 PIC  X(01).               01370000
005636     05  MR-TOTAL-LINEH                 PIC  X(01).               01380000
005640     05  MR-TOTAL-LINE                  PIC  X(40).               01390000
005720*----------------------------------------------------------------*01400000
005800*    ATTRIBUTE SETTINGS COPYBOOK.                                *01410000
005900*----------------------------------------------------------------*01420000
006000     COPY DPWS015.                                                01430000
006100*----------------------------------------------------------------*01440000
006200*    FUNCTION KEYS COPYBOOK                                      *01450000
006300*----------------------------------------------------------------*01460000
006400                                                                  01470000
006500     COPY DPWS016.                                                01480000
006600 EJECT                                                            01490000
006700                                                                  01500000
006800**--------------------------------------------------------------**01510000
CICS  ** PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.            **01520027
007000**--------------------------------------------------------------**01530000
007100     COPY DPWS030.                                                01540000
CICS       COPY DPWS930.                                                01541027
007200 EJECT                                                            01550000
007300                                                                  01560000
007400**--------------------------------------------------------------**01570000
007500*    STANDARD COMMAREA.                                           01580000
007600**--------------------------------------------------------------**01590000
007700                                                                  01600000
007800     COPY DPWS020.                                                01610000
007900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01620000
008000                                                                  01630000
008100***************************************************************** 01640000
008200*    INTER-APPLICATION COMMAREA.                                  01650000
008300***************************************************************** 01660000
008400                                                                  01670000
008500         10  INTER-APPL-COMM-AREA PIC X(200).                     01680000
008600     COPY POWS017.                                                01690004
008610     COPY TRWS105.                                                01700000
008700***************************************************************** 01710000
010700*    SPECIFIC COMMMAREA FOR POKCS107.                             01720000
008900***************************************************************** 01730000
009000         10  ASC-SPECIFIC-COMMAREA.                               01740000
009100           15 ASC-SCREEN-FIELDS.                                  01750000
009200             20  ASC-KEY-PO-NUMBER         PIC S9(09) COMP.       01760000
C98147             20  ASC-PO-NBR                PIC  9(08).            01770026
009400             20  ASC-STRT-FCTRY-DTE        PIC  X(10).            01780000
009500             20  ASC-SHIP-DATE             PIC  X(08).            01790000
009600             20  ASC-OTB                   PIC  X(04).            01800000
009700             20  ASC-LAST-FCTRY-DTE        PIC  X(10).            01810000
009800             20  ASC-CANCEL-DATE           PIC  X(08).            01820000
009900             20  ASC-FOB-POINT             PIC  X(30).            01830000
010000             20  ASC-VENDOR                PIC  X(30).            01840000
010100             20  ASC-DEPT                  PIC  X(03).            01850000
010200             20  ASC-DC1                   PIC  X(10).            01860000
010300             20  ASC-DC2                   PIC  X(10).            01870000
010400             20  ASC-DC3                   PIC  X(10).            01880000
010500             20  ASC-DECON-DATE1           PIC  X(08).            01890000
010600             20  ASC-DECON-DATE2           PIC  X(08).            01900000
010800             20  ASC-DC-DEL-DATE1          PIC  X(08).            01910000
010900             20  ASC-DC-DEL-DATE2          PIC  X(08).            01920000
011100             20  ASC-FST-RCPT-DT1          PIC  X(08).            01930000
011200             20  ASC-FST-RCPT-DT2          PIC  X(08).            01940000
011400             20  ASC-LST-RCPT-DT1          PIC  X(08).            01950000
011500             20  ASC-LST-RCPT-DT2          PIC  X(08).            01960000
011610             20  ASC-FST-VFD-DT1           PIC  X(08).            01970000
011620             20  ASC-FST-VFD-DT2           PIC  X(08).            01980000
011640             20  ASC-LST-VFD-DT1           PIC  X(08).            01990000
011650             20  ASC-LST-VFD-DT2           PIC  X(08).            02000000
011670             20  ASC-UNT-ORD1              PIC  S9(09) COMP-3.    02010000
011680             20  ASC-UNT-ORD2              PIC  S9(09) COMP-3.    02020000
011691             20  ASC-TOT-ORD               PIC  S9(09) COMP-3.    02030000
011692             20  ASC-UNT-VFD1              PIC  S9(09) COMP-3.    02040000
011693             20  ASC-UNT-VFD1-C            PIC  X(1).             02050000
011694             20  ASC-UNT-VFD2              PIC  S9(09) COMP-3.    02060000
011695             20  ASC-UNT-VFD2-C            PIC  X(1).             02070000
011698             20  ASC-TOT-VFD               PIC  S9(09) COMP-3.    02080000
011699             20  ASC-PCT-RCD1              PIC  X(4).             02090000
011700             20  FILLER REDEFINES ASC-PCT-RCD1.                   02100000
011701                 25  ASC-PCT-RCD1-N        PIC  9(03).            02110000
011702                 25  ASC-PCT-RCD1-SIGN     PIC  X(01).            02120000
011703             20  ASC-PCT-RCD2              PIC  X(4).             02130000
011710             20  FILLER REDEFINES ASC-PCT-RCD2.                   02140000
011711                 25  ASC-PCT-RCD2-N        PIC  9(03).            02150000
011712                 25  ASC-PCT-RCD2-SIGN     PIC  X(01).            02160000
011719             20  ASC-TOT-PCT-RCD           PIC  X(4).             02170000
011720             20  FILLER REDEFINES ASC-TOT-PCT-RCD.                02180000
011721                 25  ASC-TOT-PCT-RCD-N     PIC  9(03).            02190000
011722                 25  ASC-TOT-PCT-RCD-SIGN  PIC  X(01).            02200000
011730                                                                  02210000
011800             15  ASC-ITEMS-LEFT-INDICATOR  PIC  X(01).            02220000
011900                 88 ASC-ITEMS-LEFT-ON-DB    VALUE 'Y'.            02230000
012000                 88 ASC-NO-ITEMS-LEFT-ON-DB VALUE 'N'.            02240000
012100             15  ASC-NUMBER-OF-ITEMS-READ  PIC S9(09)             02250000
012200                                               COMP-3.            02260000
012300                                                                  02270000
012400*----------------------------------------------------------------*02280000
012500*    ABEND PROCESSING COPYBOOK.                                  *02290000
012600*----------------------------------------------------------------*02300000
012700                                                                  02310000
012800     COPY DPWS013.                                                02320000
012900                                                                  02330000
013000*----------------------------------------------------------------*02340000
013100*    DB2 AREA FOR PURCHASE ORDER                                 *02350000
013200*----------------------------------------------------------------*02360000
013300     EXEC SQL                                                     02370000
013400          INCLUDE TPURCHS                                         02380000
013500     END-EXEC.                                                    02390000
013501     EXEC SQL                                                     02400000
013502          INCLUDE TENTNME                                         02410000
013503     END-EXEC.                                                    02420000
013504*----------------------------------------------------------------*02430000
013505*    DB2 AREA FOR PURCHASE LINE ITEM TABLE                       *02440000
013506*----------------------------------------------------------------*02450000
013507     EXEC SQL                                                     02460000
013508          INCLUDE TPURITM                                         02470000
013509     END-EXEC.                                                    02480000
013510*----------------------------------------------------------------*02490000
013511*    DB2 AREA FOR DC SPLIT QUANTITIES TABLE                      *02500000
013512*----------------------------------------------------------------*02510000
013513     EXEC SQL                                                     02520000
013514          INCLUDE TALLPLN                                         02530000
013515     END-EXEC.                                                    02540000
013516*----------------------------------------------------------------*02550000
013520*    DB2 AREA FOR RECEIPTS TABLE                                 *02560000
013530*----------------------------------------------------------------*02570000
013540     EXEC SQL                                                     02580000
013550          INCLUDE TRECEIV                                         02590000
013560     END-EXEC.                                                    02600000
013570     EXEC SQL                                                     02610000
013580          INCLUDE TRECITM                                         02620000
013590     END-EXEC.                                                    02630000
013591     EXEC SQL                                                     02640000
013592          INCLUDE TRECDIS                                         02650000
013593     END-EXEC.                                                    02660000
013600*----------------------------------------------------------------*02670000
013700*    DB2 AREA FOR TRIP STATUS TABLE                              *02680000
013800*----------------------------------------------------------------*02690000
013900     EXEC SQL                                                     02700000
014000          INCLUDE TTRIPST                                         02710000
014100     END-EXEC.                                                    02720000
014200*----------------------------------------------------------------*02730000
014300*    DB2 AREA FOR LOCATION TABLE                                 *02740024
014400*----------------------------------------------------------------*02750000
014500     EXEC SQL                                                     02760000
014600          INCLUDE XMT00001                                        02770024
014700     END-EXEC.                                                    02780000
014800*----------------------------------------------------------------*02790000
014900*    DB2 AREA FOR SHIPMENTS                                      *02800000
015000*----------------------------------------------------------------*02810000
015100     EXEC SQL                                                     02820000
015200          INCLUDE TSHIPMT                                         02830000
015300     END-EXEC.                                                    02840000
015400*----------------------------------------------------------------*02850000
015500*    DB2 AREA FOR SHIPMENTS BY PO                                *02860000
015600*----------------------------------------------------------------*02870000
015700     EXEC SQL                                                     02880000
015800          INCLUDE TSHPTPO                                         02890000
015900     END-EXEC.                                                    02900000
016330*----------------------------------------------------------------*02910000
016340*    DB2 AREA FOR VEHICLES PER TRIP                              *02920000
016350*----------------------------------------------------------------*02930000
016360     EXEC SQL                                                     02940000
016370          INCLUDE TVEHICL                                         02950000
016380     END-EXEC.                                                    02960000
016390*----------------------------------------------------------------*02970000
016400*    DB2 AREA FOR SHIPMENT STATUSES                              *02980000
016401*----------------------------------------------------------------*02990000
016402     EXEC SQL                                                     03000000
016403          INCLUDE TSHIPST                                         03010000
016404     END-EXEC.                                                    03020000
016405*----------------------------------------------------------------*03030000
016406*    DB2 AREA FOR PLANNED SHIPMENTS                              *03040000
016407*----------------------------------------------------------------*03050000
016408     EXEC SQL                                                     03060000
016409          INCLUDE TPLNSHP                                         03070000
016410     END-EXEC.                                                    03080000
016420*----------------------------------------------------------------*03090000
016430*    DB2 AREA FOR THE FREE ON BOARD TABLE                        *03100000
016440*----------------------------------------------------------------*03110000
016450     EXEC SQL                                                     03120000
016460          INCLUDE TIMFOB                                          03130000
016470     END-EXEC.                                                    03140000
016480*----------------------------------------------------------------*03150000
016490*    DB2 AREA FOR COMMUNICATIONS                                 *03160000
016500*----------------------------------------------------------------*03170000
016600     EXEC SQL                                                     03180000
016700          INCLUDE SQLCA                                           03190000
016800     END-EXEC.                                                    03200000
016900                                                                  03210000
017000                                                                  03220000
017100* THIS CURSOR WILL PULL BACK ALL THE SHIPMENTS FOR A GIVEN PO     03230000
017200     EXEC SQL                                                     03240000
017300       DECLARE SHIPMT-CSR CURSOR                                  03250000
017400          FOR SELECT DISTINCT                                     03260000
017500               A.SHIPT_ID,                                        03270000
017600               A.TRIP_ID,                                         03280000
017700               E.OPER_UNT_ID                                      03290000
017800          FROM TSHIPMT A,                                         03300000
017900               TSHPTPO B,                                         03310000
018000               TTRIPST E                                          03320000
018100          WHERE B.PO_NBR   =:ASC-KEY-PO-NUMBER                    03330000
018200            AND A.SHIPT_ID = B.SHIPT_ID                           03340000
018300            AND E.TRIP_ID = A.TRIP_ID                             03350000
018500          ORDER BY E.OPER_UNT_ID                                  03360000
018600          FOR FETCH ONLY                                          03370000
018700     END-EXEC.                                                    03380000
018800                                                                  03390000
018900 LINKAGE SECTION.                                                 03400000
019000                                                                  03410000
019100 01  DFHCOMMAREA.                                                 03420000
019200     05  FILLER                         OCCURS  1 TO 4072 TIMES   03430000
019300                                        DEPENDING ON EIBCALEN.    03440000
019400         10  FILLER                     PIC X.                    03450000
019500                                                                  03460000
019600                                                                  03470000
019700 PROCEDURE DIVISION.                                              03480000
019800***************************************************************** 03490000
019900** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03500000
020000** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03510000
020100** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03520000
020200**                                                             ** 03530000
020300** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03540000
020400** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03550000
020500***************************************************************** 03560000
020600 0000-MAIN-MODULE.                                                03570000
020700     INITIALIZE DP030-CICS-API-FIELDS.                            03580000
020800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03590000
020900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03600000
021000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03610000
021100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03620000
021200     MOVE LENGTH OF PO107AI        TO DP030-MAP-LENGTH (1).       03630000
021300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03640000
021400     PERFORM 0001-CALL-CICS-ARCH-API.                             03650000
021500     PERFORM 1000-CONTROL-PROCESSING                              03660000
021600*                                                                 03670000
021700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03680000
021800     PERFORM 0001-CALL-CICS-ARCH-API.                             03690000
021900                                                                  03700000
022000 0001-CALL-CICS-ARCH-API.                                         03710000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03720027
022200                                    DFHCOMMAREA                   03730027
022300                                    DP030-CICS-API-FIELDS         03740027
022400                                    DP020-STANDARD-COMMAREA       03750027
022500                                    PO107AI.                      03760027
022600*                                                                 03770000
022700     IF  DP030-RC-CALL-SUCCESSFUL                                 03780000
022800         CONTINUE                                                 03790000
022900     ELSE                                                         03800000
023000         SET DP013-NO-ROLLBACK                                    03810000
023100             DP013-XCTL-DISPLAY-RESTART                           03820000
023200             DP013-CICS-ABEND      TO TRUE                        03830000
CICS           MOVE '0001-CALL-CICS-ARCH-API'                           03840027
023400                                   TO DP013-PARAGRAPH             03850000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03860027
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03870027
023700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03880000
023800         PERFORM DP013-0000-PROCESS-ABEND                         03890000
023900     END-IF.                                                      03900000
024000 EJECT                                                            03910000
024100                                                                  03920000
024200*----------------------------------------------------------------*03930000
024300*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03940000
024400*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03950000
024500*----------------------------------------------------------------*03960000
024600 1000-CONTROL-PROCESSING.                                         03970000
024700                                                                  03980000
024800     EVALUATE TRUE                                                03990000
024900         WHEN DP020-NEXT-ACT-INITIAL                              04000000
025000             PERFORM 1100-FIND-OBJECT-KEYS                        04010000
025100             PERFORM 4120-GET-PO-TYP                              04020000
025311             SET ASC-ITEMS-LEFT-ON-DB TO TRUE                     04030000
025312             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04040000
025320             PERFORM 4220-PRESCAN-ITEMS-FROM-DB                   04050000
025330             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04060000
025340             IF PS-ALL-VSORAIR                                    04070000
025350                 MOVE DP016-PF14 TO DP020-SRC-AID                 04080000
025360             ELSE                                                 04090000
025500                  PERFORM 2000-PROCESS-PANEL                      04100000
025700                  IF  PS-ERROR                                    04110000
025800                    CONTINUE                                      04120000
025900                  ELSE                                            04130000
026000                     PERFORM 4000-BUILD-INITIAL-PANEL             04140000
026100                  END-IF                                          04150000
026110             END-IF                                               04160000
026120                                                                  04170000
026130         WHEN DP020-NEXT-ACT-READ-MAP                             04180000
026140             PERFORM 2000-PROCESS-PANEL                           04190000
026150                                                                  04200000
026160         WHEN DP020-NEXT-ACT-RETURN                               04210000
026190             MOVE ASC-KEY-PO-NUMBER TO TR105-PO-NBR               04220000
026420             MOVE 0 TO ASC-TOT-VFD                                04230000
026430             MOVE 0 TO ASC-TOT-PCT-RCD                            04240000
026440                                                                  04250000
026450             SET ASC-ITEMS-LEFT-ON-DB TO TRUE                     04260000
026460             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04270000
026470             PERFORM 4220-PRESCAN-ITEMS-FROM-DB                   04280000
026480             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04290000
026490             IF PS-ALL-VSORAIR                                    04300000
026491                 MOVE DP016-PF3  TO DP020-SRC-AID                 04310000
026492             ELSE                                                 04320000
026500                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              04330000
026600             END-IF                                               04340000
026700                                                                  04350000
026800         WHEN OTHER                                               04360000
026900             SET DP013-LOGIC-ABEND TO TRUE                        04370000
027000             SET DP013-NO-ROLLBACK TO TRUE                        04380000
027100             MOVE '1000-CONTROL-PROCESSING'                       04390000
027101                                   TO DP013-PARAGRAPH             04400000
027102             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   04410000
027103                                   TO DP013-MESSAGE-TEXT(1)       04420000
027104             MOVE DP020-NEXT-APPL-ACTIVITY                        04430000
027105                                   TO DP013-MESSAGE-TEXT(2)       04440000
027106             PERFORM DP013-0000-PROCESS-ABEND                     04450000
027107     END-EVALUATE.                                                04460000
027108 EJECT                                                            04470000
027109                                                                  04480000
027110******************************************************************04490000
027120 1100-FIND-OBJECT-KEYS.                                           04500000
027130     INITIALIZE ASC-SPECIFIC-COMMAREA.                            04510000
027140     MOVE TR105-PO-NBR TO ASC-KEY-PO-NUMBER.                      04520000
027170 EJECT                                                            04530000
027180                                                                  04540000
027190*----------------------------------------------------------------*04550000
027200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04560000
027300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04570000
027400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04580000
027500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04590000
027600* FUNCTION KEYS CAN GET THIS FAR.                                *04600000
027700*----------------------------------------------------------------*04610000
027800                                                                  04620000
027900 2000-PROCESS-PANEL.                                              04630000
028000     EVALUATE TRUE                                                04640000
028400         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04650000
028410             INITIALIZE ASC-SCREEN-FIELDS                         04660000
028420             MOVE TR105-PO-NBR TO ASC-KEY-PO-NUMBER               04670000
028450             PERFORM 4120-GET-PO-TYP                              04680000
028460             PERFORM 4000-BUILD-INITIAL-PANEL                     04690000
028470                                                                  04700000
028480         WHEN DP020-SRC-AID = DP016-CLEAR                         04710000
028482              MOVE 0 TO ASC-TOT-VFD                               04720000
028483              MOVE 0 TO ASC-TOT-PCT-RCD                           04730000
028490             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04740000
028500                                                                  04750000
028600         WHEN OTHER                                               04760000
028820             MOVE 0 TO ASC-TOT-VFD                                04770000
028830             MOVE 0 TO ASC-TOT-PCT-RCD                            04780000
028840                                                                  04790000
028850             SET ASC-ITEMS-LEFT-ON-DB TO TRUE                     04800000
028860             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04810000
028870             PERFORM 4220-PRESCAN-ITEMS-FROM-DB                   04820000
028880             MOVE 0 TO ASC-NUMBER-OF-ITEMS-READ                   04830000
028890             IF PS-ALL-VSORAIR                                    04840000
028891                 MOVE DP016-PF3  TO DP020-SRC-AID                 04850000
028892             ELSE                                                 04860000
028900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04870000
029000             END-IF                                               04880000
029100     END-EVALUATE.                                                04890000
029200                                                                  04900000
029300  EJECT                                                           04910000
029400*----------------------------------------------------------------*04920000
029500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *04930000
029600* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *04940000
029700* FROM THE CICS ARCHITECTURE API.                                *04950000
029800*----------------------------------------------------------------*04960000
029900                                                                  04970000
030000 2100-CHECK-FUNCTION-KEY.                                         04980000
030410                                                                  04990000
030420     EVALUATE TRUE                                                05000000
030450                                                                  05010000
030460         WHEN DP020-SRC-AID = DP016-ENTER                         05020000
030470             CONTINUE                                             05030000
030480                                                                  05040000
030490         WHEN OTHER                                               05050000
030500             SET DP013-NO-ROLLBACK                                05060000
030600                 DP013-XCTL-DISPLAY-RESTART                       05070000
030700                 DP013-CICS-ABEND  TO TRUE                        05080000
030800             MOVE '2100-CHECK-FUNCTION-KEY'                       05090000
030900                                   TO DP013-PARAGRAPH             05100000
031000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05110000
031100                                   TO DP013-MESSAGE-TEXT (1)      05120000
031200             PERFORM DP013-0000-PROCESS-ABEND                     05130000
031300     END-EVALUATE.                                                05140000
031400                                                                  05150000
031500 EJECT                                                            05160000
031600                                                                  05170000
031700*----------------------------------------------------------------*05180000
031800** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **05190000
031900** INTER-APPLICATION COMMAREA.                                  **05200000
032000*----------------------------------------------------------------*05210000
032100 2110-PREPARE-INTER-APPL-COMM.                                    05220000
032200     MOVE ASC-KEY-PO-NUMBER        TO TR105-PO-NBR.               05230000
032300                                                                  05240000
032400/                                                                 05250000
032500*----------------------------------------------------------------*05260000
032600*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *05270000
032700*    ENTRY.                                                      *05280000
032800*----------------------------------------------------------------*05290000
032900                                                                  05300000
033000 4000-BUILD-INITIAL-PANEL.                                        05310000
033001                                                                  05320000
033002     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            05330000
C98147     MOVE +0 TO ASC-NUMBER-OF-ITEMS-READ.                         05340026
C98147     MOVE ASC-KEY-PO-NUMBER TO ASC-PO-NBR.                        05350026
                                                                        05360026
033015     IF PURCHS-PO-TYP-CDE = ('IM' OR 'IE' OR 'IF')                05370015
033016        PERFORM 4100-GET-IMPORT                                   05380000
033017     ELSE                                                         05390000
033018        PERFORM 4200-GET-DOMESTIC                                 05400000
033019     END-IF                                                       05410000
033040         IF PURCHS-PO-TYP-CDE = ('IM' OR 'IE' OR 'IF')            05420015
033050             MOVE PLNSHP-STRT-FCTRY-DTE                           05430000
033060                                   TO ASC-STRT-FCTRY-DTE          05440000
033070             MOVE PLNSHP-LAST-FCTRY-DTE                           05450000
033080                                   TO ASC-LAST-FCTRY-DTE          05460000
033081             MOVE IMFOB-FOB-CTY-NM TO ASC-FOB-POINT               05470000
033082         ELSE                                                     05480000
033083             MOVE SPACES TO ASC-STRT-FCTRY-DTE                    05490000
033084                            ASC-LAST-FCTRY-DTE                    05500000
033085                            ASC-FOB-POINT                         05510000
033086         END-IF                                                   05520000
033087             MOVE ENTNME-ENT-NAME-DESC TO ASC-VENDOR              05530000
033107             MOVE PURCHS-DEPT-NBR TO ASC-DEPT                     05540000
033090             MOVE PURCHS-OTB-PER-NBR TO PV-OTB                    05550000
033100             MOVE PV-OTB-CC TO PV-OTB-CC2                         05560000
033110             MOVE PV-OTB-YY TO PV-OTB-YY2                         05570000
033200             MOVE PV-OTB-MM TO PV-OTB-MM2                         05580000
033310             MOVE PV-OTB2(1:4) TO ASC-OTB                         05590000
033400             MOVE PLNSHP-DONT-SHIP-BEF-DTE TO PV-DATE-BREAK       05600000
033500             MOVE PV-DB-YY TO PV-DD-YY                            05610000
033600             MOVE PV-DB-MM TO PV-DD-MM                            05620000
033700             MOVE PV-DB-DD TO PV-DD-DD                            05630000
033800             IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES AND       05640000
033900                PV-DD-MM = SPACES                                 05650000
034000                  MOVE SPACES TO ASC-SHIP-DATE                    05660000
034100             ELSE                                                 05670000
034200                 MOVE PV-DATE-DISPLAY TO ASC-SHIP-DATE            05680000
034300             END-IF                                               05690000
034400             MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO PV-DATE-BREAK      05700000
034500             MOVE PV-DB-YY TO PV-DD-YY                            05710000
034600             MOVE PV-DB-MM TO PV-DD-MM                            05720000
034700             MOVE PV-DB-DD TO PV-DD-DD                            05730000
034800             IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES AND       05740000
034900                PV-DD-MM = SPACES                                 05750000
035000                  MOVE SPACES TO ASC-CANCEL-DATE                  05760000
035100             ELSE                                                 05770000
035200                 MOVE PV-DATE-DISPLAY TO ASC-CANCEL-DATE          05780000
035300             END-IF                                               05790000
035440              MOVE 0 TO ASC-TOT-VFD                               05800000
035495              MOVE 0 TO ASC-TOT-PCT-RCD                           05810000
035510             PERFORM 4300-READ-ITEMS-FROM-DB                      05820000
035600             IF ASC-NUMBER-OF-ITEMS-READ = ZERO                   05830000
035700                SET DP020-NEXT-ACT-APPL-ERROR TO TRUE             05840000
035800                SET DP020-MSG-FATAL TO TRUE                       05850000
035900                MOVE PC-TSYMSG-00050 TO DP020-MSG-NUMBER          05860000
036000             ELSE                                                 05870000
036020                 MOVE 0 TO ASC-TOT-VFD                            05880000
036030                 MOVE 0 TO ASC-TOT-PCT-RCD                        05890000
036100                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              05900000
036200             END-IF.                                              05910000
036900  EJECT                                                           05920000
037000                                                                  05930000
037100*----------------------------------------------------------------*05940000
037200* OPEN THE SHIPMT-CSR CURSOR.                                    *05950000
037300*----------------------------------------------------------------*05960000
037400                                                                  05970000
037500 4010-OPEN-CURSOR.                                                05980000
037600     PERFORM                                                      05990000
037700         WITH TEST AFTER                                          06000000
037800         VARYING PV-RETRY-COUNTER                                 06010000
037900         FROM 1 BY 1                                              06020000
038000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06030000
038100                   OR (SQLCODE = ZERO))                           06040000
038200                                                                  06050000
038300              EXEC SQL                                            06060000
038400                 OPEN SHIPMT-CSR                                  06070000
038500              END-EXEC                                            06080000
038600                                                                  06090000
038700         EVALUATE TRUE                                            06100000
038800             WHEN SQLCODE = ZERO                                  06110000
038900             WHEN SQLCODE = -904                                  06120000
039000             WHEN SQLCODE = -913                                  06130000
039100                 CONTINUE                                         06140000
039200             WHEN SQLWARN0 NOT = SPACES                           06150000
039300             WHEN SQLCODE < ZERO                                  06160000
039400             WHEN SQLCODE > ZERO                                  06170000
039500                 MOVE '4010-OPEN-CURSOR'                          06180000
039600                                   TO DP013-PARAGRAPH             06190000
039700                 MOVE 'OPEN SHIPMT-CSR CURSOR - '                 06200000
039800                                   TO DP013-MESSAGE-TEXT (1)      06210000
039900                 MOVE SQLCA        TO DP013-SQLCA                 06220000
040000                 MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)    06230000
040100                 SET DP013-DB2-ABEND                              06240000
040200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06250000
040300                 PERFORM DP013-0000-PROCESS-ABEND                 06260000
040400         END-EVALUATE                                             06270000
040500     END-PERFORM.                                                 06280000
040600*                                                                 06290000
040700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06300000
040800         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             06310000
040900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   06320000
041000                                   TO DP013-MESSAGE-TEXT (1)      06330000
041100         MOVE SQLCA                TO DP013-SQLCA                 06340000
041200         MOVE 'TSHIPMT '           TO DP013-DB2-TABLE-NAME (1)    06350000
041300         SET DP013-DB2-ABEND                                      06360000
041310             DP013-XCTL-DISPLAY-RESTART                           06370000
041320                                   TO TRUE                        06380000
041330         PERFORM DP013-0000-PROCESS-ABEND                         06390000
041340     END-IF.                                                      06400000
041341                                                                  06410000
041342 EJECT                                                            06420000
041343                                                                  06430000
041344*----------------------------------------------------------------*06440000
041345* CLOSE THE SHIPMT-CSR CURSOR.                                   *06450000
041346*----------------------------------------------------------------*06460000
041347                                                                  06470000
041348 4020-CLOSE-CURSOR.                                               06480000
041349*                                                                 06490000
041350     EXEC SQL                                                     06500000
041351         CLOSE SHIPMT-CSR                                         06510000
041352     END-EXEC                                                     06520000
041353                                                                  06530000
041354     EVALUATE TRUE                                                06540000
041355         WHEN SQLCODE = ZERO                                      06550000
041356             CONTINUE                                             06560000
041357         WHEN SQLWARN0 NOT = SPACES                               06570000
041358         WHEN SQLCODE < ZERO                                      06580000
041359         WHEN SQLCODE > ZERO                                      06590000
041360             MOVE '4020-CLOSE-CURSOR'                             06600000
041361                               TO DP013-PARAGRAPH                 06610000
041362             MOVE 'CLOSE SHIPMT-CSR CURSOR '                      06620000
041363                               TO DP013-MESSAGE-TEXT (1)          06630000
041364             MOVE SQLCA        TO DP013-SQLCA                     06640000
041365             MOVE 'SHIPMT  '   TO DP013-DB2-TABLE-NAME (1)        06650000
041366             SET DP013-DB2-ABEND                                  06660000
041367                 DP013-XCTL-DISPLAY-RESTART TO TRUE               06670000
041368             PERFORM DP013-0000-PROCESS-ABEND                     06680000
041369     END-EVALUATE.                                                06690000
041370                                                                  06700000
041371  EJECT                                                           06710000
041372                                                                  06720000
041373*----------------------------------------------------------------*06730000
041374* GET IMPORT SCREEN FIELDS                                       *06740000
041375*----------------------------------------------------------------*06750000
041376                                                                  06760000
041377 4100-GET-IMPORT.                                                 06770000
041378     PERFORM                                                      06780000
041379         WITH TEST AFTER                                          06790000
041380         VARYING PV-RETRY-COUNTER                                 06800000
041390         FROM 1 BY 1                                              06810000
041400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06820000
041500             OR (SQLCODE = ZERO)                                  06830000
041600             OR (SQLCODE = +100))                                 06840000
041700             EXEC SQL                                             06850000
041800                 SELECT A.OTB_PER_NBR,                            06860000
041810                        A.PO_TYP_CDE,                             06870000
041820                        A.TOT_UNT_QTY,                            06880000
041900                        B.STRT_FCTRY_DTE,                         06890000
042000                        B.LAST_FCTRY_DTE,                         06900000
042100                        B.DONT_SHIP_BEF_DTE,                      06910000
042200                        B.CAN_IFNOT_SHIP_DTE,                     06920000
042300                        C.FOB_CTY_NM,                             06930000
042310                        A.DEPT_NBR,                               06940000
042320                        D.ENT_NAME_DESC                           06950000
042400                 INTO :PURCHS-OTB-PER-NBR,                        06960000
042410                      :PURCHS-PO-TYP-CDE,                         06970000
042420                      :PURCHS-TOT-UNT-QTY,                        06980000
042500                      :PLNSHP-STRT-FCTRY-DTE,                     06990000
042600                      :PLNSHP-LAST-FCTRY-DTE,                     07000000
042700                      :PLNSHP-DONT-SHIP-BEF-DTE,                  07010000
042800                      :PLNSHP-CAN-IFNOT-SHIP-DTE,                 07020000
042900                      :IMFOB-FOB-CTY-NM,                          07030000
042910                      :PURCHS-DEPT-NBR,                           07040000
042920                      :ENTNME-ENT-NAME-DESC                       07050000
043000                 FROM TPURCHS A,                                  07060000
043100                      TPLNSHP B,                                  07070000
043200                      TIMFOB C,                                   07080000
043210                      TENTNME D                                   07090000
043300                 WHERE A.PO_NBR = :ASC-KEY-PO-NUMBER              07100000
043400                   AND A.VER_STATUS_CDE = 'A'                     07110000
043500                   AND B.VER_STATUS_CDE = 'A'                     07120000
043700                   AND B.PO_NBR = A.PO_NBR                        07130000
043800                   AND C.FOB_CDE = B.FOB_CDE                      07140000
043810                   AND A.ENT_ID = D.ENT_ID                        07150000
043820                   AND D.TYPE_CDE = '04'                          07160000
043900             END-EXEC                                             07170000
044000         EVALUATE TRUE                                            07180000
044010             WHEN SQLCODE = +100                                  07190000
044020               PERFORM 4150-GET-QTY-ORDERED                       07200000
044100             WHEN SQLCODE = ZERO                                  07210000
044300             WHEN SQLCODE = -904                                  07220000
044400             WHEN SQLCODE = -913                                  07230000
044500                 CONTINUE                                         07240000
044600             WHEN SQLWARN0 NOT = SPACES                           07250000
044700             WHEN SQLCODE < ZERO                                  07260000
044800             WHEN SQLCODE > ZERO                                  07270000
044900                 MOVE '4100-GET-IMPORT'                           07280000
045000                                   TO DP013-PARAGRAPH             07290000
045100                 MOVE 'SQL ERROR SELECTING IMPORT INFO'           07300000
045200                                   TO DP013-MESSAGE-TEXT (1)      07310000
045300                 MOVE SQLCA        TO DP013-SQLCA                 07320000
045400                 MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)    07330000
045500                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)    07340000
045600                 MOVE 'TIMFOB  '   TO DP013-DB2-TABLE-NAME (3)    07350000
045700                 SET DP013-DB2-ABEND                              07360000
045800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           07370000
045900                 PERFORM DP013-0000-PROCESS-ABEND                 07380000
046000         END-EVALUATE                                             07390000
046100     END-PERFORM.                                                 07400000
046200*                                                                 07410000
046300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07420000
046400         MOVE '4100-GET-IMPORT'    TO DP013-PARAGRAPH             07430000
046500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  07440000
046600                                   TO DP013-MESSAGE-TEXT (1)      07450000
046700         MOVE SQLCA                TO DP013-SQLCA                 07460000
046800         MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)            07470000
046900         MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)            07480000
047000         MOVE 'TIMFOB  '   TO DP013-DB2-TABLE-NAME (3)            07490000
047100         SET DP013-DB2-ABEND                                      07500000
047200             DP013-XCTL-DISPLAY-RESTART                           07510000
047300                                   TO TRUE                        07520000
047400         PERFORM DP013-0000-PROCESS-ABEND                         07530000
047500     END-IF.                                                      07540000
047600                                                                  07550000
047700  EJECT                                                           07560000
047701                                                                  07570000
047702*----------------------------------------------------------------*07580000
047703* GET TOTAL QUANTITY ORDERED FROM TPURCHS                        *07590000
047704*----------------------------------------------------------------*07600000
047705 4150-GET-QTY-ORDERED.                                            07610000
047706     PERFORM                                                      07620000
047707         WITH TEST AFTER                                          07630000
047708         VARYING PV-RETRY-COUNTER                                 07640000
047709         FROM 1 BY 1                                              07650000
047710         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07660000
047711             OR (SQLCODE = ZERO)                                  07670000
047712             OR (SQLCODE = +100))                                 07680000
047713             EXEC SQL                                             07690000
047716                 SELECT TOT_UNT_QTY                               07700000
047724                 INTO :PURCHS-TOT-UNT-QTY                         07710000
047730                 FROM TPURCHS                                     07720000
047733                 WHERE PO_NBR = :ASC-KEY-PO-NUMBER                07730000
047734                   AND VER_STATUS_CDE = 'A'                       07740000
047738             END-EXEC                                             07750000
047739         EVALUATE TRUE                                            07760000
047740             WHEN SQLCODE = ZERO                                  07770000
047741             WHEN SQLCODE = +100                                  07780000
047742             WHEN SQLCODE = -904                                  07790000
047743             WHEN SQLCODE = -913                                  07800000
047744                 CONTINUE                                         07810000
047745             WHEN SQLWARN0 NOT = SPACES                           07820000
047746             WHEN SQLCODE < ZERO                                  07830000
047747             WHEN SQLCODE > ZERO                                  07840000
047748                 MOVE '4150-GET-QTY-ORDERED'                      07850000
047749                                   TO DP013-PARAGRAPH             07860000
047750                 MOVE 'SQL ERROR SELECTING QTY ORDERED'           07870000
047751                                   TO DP013-MESSAGE-TEXT (1)      07880000
047752                 MOVE SQLCA        TO DP013-SQLCA                 07890000
047753                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    07900000
047754                 SET DP013-DB2-ABEND                              07910000
047755                     DP013-XCTL-DISPLAY-RESTART TO TRUE           07920000
047756                 PERFORM DP013-0000-PROCESS-ABEND                 07930000
047757         END-EVALUATE                                             07940000
047758     END-PERFORM.                                                 07950000
047759*                                                                 07960000
047760     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07970000
047761         MOVE '4150-GET-QTY-ORDERED' TO DP013-PARAGRAPH           07980000
047762         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  07990000
047763                                   TO DP013-MESSAGE-TEXT (1)      08000000
047764         MOVE SQLCA                TO DP013-SQLCA                 08010000
047765         MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)            08020000
047766         SET DP013-DB2-ABEND                                      08030000
047767             DP013-XCTL-DISPLAY-RESTART                           08040000
047768                                   TO TRUE                        08050000
047769         PERFORM DP013-0000-PROCESS-ABEND                         08060000
047770     END-IF.                                                      08070000
047771                                                                  08080000
047772  EJECT                                                           08090000
047773                                                                  08100000
047774                                                                  08110000
047775*----------------------------------------------------------------*08120000
047776* GET IMPORT SCREEN FIELDS FOR DOMESTIC ORDERS                   *08130000
047777*----------------------------------------------------------------*08140000
047778                                                                  08150000
047779 4200-GET-DOMESTIC.                                               08160000
047780     PERFORM                                                      08170000
047781         WITH TEST AFTER                                          08180000
047782         VARYING PV-RETRY-COUNTER                                 08190000
047790         FROM 1 BY 1                                              08200000
047791         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08210000
047792             OR (SQLCODE = ZERO)                                  08220000
047793             OR (SQLCODE = +100))                                 08230000
047794             EXEC SQL                                             08240000
047795                 SELECT A.OTB_PER_NBR,                            08250000
047796                        A.PO_TYP_CDE,                             08260000
047799                        B.DONT_SHIP_BEF_DTE,                      08270000
047800                        B.CAN_IFNOT_SHIP_DTE,                     08280000
047801                        A.TOT_UNT_QTY,                            08290000
047802                        A.DEPT_NBR,                               08300000
047803                        C.ENT_NAME_DESC                           08310000
047804                 INTO :PURCHS-OTB-PER-NBR,                        08320000
047805                      :PURCHS-PO-TYP-CDE,                         08330000
047806                      :PLNSHP-DONT-SHIP-BEF-DTE,                  08340000
047807                      :PLNSHP-CAN-IFNOT-SHIP-DTE,                 08350000
047808                      :PURCHS-TOT-UNT-QTY,                        08360000
047809                      :PURCHS-DEPT-NBR,                           08370000
047810                      :ENTNME-ENT-NAME-DESC                       08380000
047811                 FROM TPURCHS A,                                  08390000
047812                      TPLNSHP B,                                  08400000
047813                      TENTNME C                                   08410000
047814                 WHERE A.PO_NBR = :ASC-KEY-PO-NUMBER              08420000
047815                   AND A.VER_STATUS_CDE = 'A'                     08430000
047816                   AND B.VER_STATUS_CDE = 'A'                     08440000
047817                   AND B.PO_NBR = A.PO_NBR                        08450000
047818                   AND A.ENT_ID = C.ENT_ID                        08460000
047819                   AND C.TYPE_CDE = '04'                          08470000
047820             END-EXEC                                             08480000
047821         EVALUATE TRUE                                            08490000
047822             WHEN SQLCODE = ZERO                                  08500000
047823             WHEN SQLCODE = +100                                  08510000
047824             WHEN SQLCODE = -904                                  08520000
047825             WHEN SQLCODE = -913                                  08530000
047826                 CONTINUE                                         08540000
047827             WHEN SQLWARN0 NOT = SPACES                           08550000
047828             WHEN SQLCODE < ZERO                                  08560000
047829             WHEN SQLCODE > ZERO                                  08570000
047830                 MOVE '4200-GET-DOMESTIC'                         08580000
047831                                   TO DP013-PARAGRAPH             08590000
047832                 MOVE 'SQL ERROR SELECTING IMPORT INFO'           08600000
047833                                   TO DP013-MESSAGE-TEXT (1)      08610000
047834                 MOVE SQLCA        TO DP013-SQLCA                 08620000
047835                 MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)    08630000
047836                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)    08640000
047837                 MOVE 'TIMFOB  '   TO DP013-DB2-TABLE-NAME (3)    08650000
047838                 SET DP013-DB2-ABEND                              08660000
047839                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08670000
047840                 PERFORM DP013-0000-PROCESS-ABEND                 08680000
047841         END-EVALUATE                                             08690000
047842     END-PERFORM.                                                 08700000
047843*                                                                 08710000
047844     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08720000
047845         MOVE '4200-GET-DOMESTIC'  TO DP013-PARAGRAPH             08730000
047846         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  08740000
047847                                   TO DP013-MESSAGE-TEXT (1)      08750000
047848         MOVE SQLCA                TO DP013-SQLCA                 08760000
047849         MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)            08770000
047850         MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)            08780000
047851         SET DP013-DB2-ABEND                                      08790000
047852             DP013-XCTL-DISPLAY-RESTART                           08800000
047853                                   TO TRUE                        08810000
047854         PERFORM DP013-0000-PROCESS-ABEND                         08820000
047855     END-IF.                                                      08830000
047856                                                                  08840000
047857  EJECT                                                           08850000
047860                                                                  08860000
047900*----------------------------------------------------------------*08870000
048000* GET DC NAME                                                    *08880000
048100*----------------------------------------------------------------*08890000
048200                                                                  08900000
048300 4110-GET-DC-NAME.                                                08910000
048400     PERFORM                                                      08920000
048500         WITH TEST AFTER                                          08930000
048600         VARYING PV-RETRY-COUNTER                                 08940000
048700         FROM 1 BY 1                                              08950000
048800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08960000
048900             OR (SQLCODE = ZERO)                                  08970000
049000             OR (SQLCODE = +100))                                 08980000
049100             EXEC SQL                                             08990000
049200             SELECT LOC_5_ABBR_NM                                 09000024
049300             INTO :XMT00001-LOC-5-ABBR-NM                         09010024
049400             FROM XMT_LOC                                         09020024
049500             WHERE LOC_NBR = :PV-OPER-UNT-ID                      09030024
049510             END-EXEC                                             09040024
049530         EVALUATE TRUE                                            09050024
049540             WHEN SQLCODE = +100                                  09060024
049550               MOVE SPACES TO XMT00001-LOC-5-ABBR-NM              09070024
049570             WHEN SQLCODE = ZERO                                  09080000
049580             WHEN SQLCODE = -904                                  09090000
049590             WHEN SQLCODE = -913                                  09100000
049600                 CONTINUE                                         09110000
049601             WHEN SQLWARN0 NOT = SPACES                           09120000
049602             WHEN SQLCODE < ZERO                                  09130000
049603             WHEN SQLCODE > ZERO                                  09140000
049604                 MOVE '4110-GET-DC-NAME'                          09150000
049605                                   TO DP013-PARAGRAPH             09160000
049606                 MOVE 'SQL ERROR SELECTING DC NAME'               09170000
049607                                   TO DP013-MESSAGE-TEXT (1)      09180000
049608                 MOVE SQLCA        TO DP013-SQLCA                 09190000
049609                 MOVE 'XMT_LOC '   TO DP013-DB2-TABLE-NAME (1)    09200024
049610                 SET DP013-DB2-ABEND                              09210000
049611                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09220000
049612                 PERFORM DP013-0000-PROCESS-ABEND                 09230000
049613         END-EVALUATE                                             09240000
049614     END-PERFORM.                                                 09250000
049615*                                                                 09260000
049616     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09270000
049617         MOVE '4110-GET-DC NAME'   TO DP013-PARAGRAPH             09280000
049618         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT DC'  09290000
049619                                   TO DP013-MESSAGE-TEXT (1)      09300000
049620         MOVE SQLCA                TO DP013-SQLCA                 09310000
049621         MOVE 'XMT_LOC '   TO DP013-DB2-TABLE-NAME (1)            09320024
049622         SET DP013-DB2-ABEND                                      09330000
049623             DP013-XCTL-DISPLAY-RESTART                           09340000
049624                                   TO TRUE                        09350000
049625         PERFORM DP013-0000-PROCESS-ABEND                         09360000
049626     END-IF.                                                      09370000
049627                                                                  09380000
049628  EJECT                                                           09390000
049629                                                                  09400000
049630*----------------------------------------------------------------*09410000
049631* GET THE PO TYPE CODE                                           *09420000
049632*----------------------------------------------------------------*09430000
049633                                                                  09440000
049634 4120-GET-PO-TYP.                                                 09450000
049635     PERFORM                                                      09460000
049636         WITH TEST AFTER                                          09470000
049637         VARYING PV-RETRY-COUNTER                                 09480000
049638         FROM 1 BY 1                                              09490000
049639         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09500000
049640             OR (SQLCODE = ZERO)                                  09510000
049641             OR (SQLCODE = +100))                                 09520000
049642             EXEC SQL                                             09530000
049643                 SELECT PO_TYP_CDE                                09540000
049644                 INTO :PURCHS-PO-TYP-CDE                          09550000
049645                 FROM TPURCHS                                     09560000
049646                 WHERE PO_NBR = :ASC-KEY-PO-NUMBER                09570000
049647                   AND VER_STATUS_CDE = 'A'                       09580000
049648             END-EXEC                                             09590000
049649         EVALUATE TRUE                                            09600000
049651             WHEN SQLCODE = +100                                  09610000
049652                SET DP020-NEXT-ACT-APPL-ERROR TO TRUE             09620000
049653                SET DP020-MSG-FATAL TO TRUE                       09630000
049654                MOVE PC-TSYMSG-00726 TO DP020-MSG-NUMBER          09640000
049655             WHEN SQLCODE = ZERO                                  09650000
049656             WHEN SQLCODE = -904                                  09660000
049657             WHEN SQLCODE = -913                                  09670000
049658                 CONTINUE                                         09680000
049659             WHEN SQLWARN0 NOT = SPACES                           09690000
049660             WHEN SQLCODE < ZERO                                  09700000
049661             WHEN SQLCODE > ZERO                                  09710000
049662                 MOVE '4120-GET-PO-TYP'                           09720000
049663                                   TO DP013-PARAGRAPH             09730000
049664                 MOVE 'SQL ERROR SELECTING PO TYP CODE'           09740000
049665                                   TO DP013-MESSAGE-TEXT (1)      09750000
049666                 MOVE SQLCA        TO DP013-SQLCA                 09760000
049667                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    09770000
049668                 SET DP013-DB2-ABEND                              09780000
049669                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09790000
049670                 PERFORM DP013-0000-PROCESS-ABEND                 09800000
049671         END-EVALUATE                                             09810000
049672     END-PERFORM.                                                 09820000
049673*                                                                 09830000
049674     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09840000
049675         MOVE '4120-GET-PO-TYP'    TO DP013-PARAGRAPH             09850000
049676         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO T'09860000
049677                                   TO DP013-MESSAGE-TEXT (1)      09870000
049678         MOVE SQLCA                TO DP013-SQLCA                 09880000
049679         MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)            09890000
049680         SET DP013-DB2-ABEND                                      09900000
049681             DP013-XCTL-DISPLAY-RESTART                           09910000
049682                                   TO TRUE                        09920000
049683         PERFORM DP013-0000-PROCESS-ABEND                         09930000
049684     END-IF.                                                      09940000
049685                                                                  09950000
049686  EJECT                                                           09960000
049687                                                                  09970000
049688 4220-PRESCAN-ITEMS-FROM-DB.                                      09980000
049689     SET PS-ALL-VSORAIR TO TRUE.                                  09990000
049690     PERFORM 4010-OPEN-CURSOR.                                    10000000
049691     PERFORM                                                      10010000
049692         VARYING PV-READ-COUNT                                    10020000
049693         FROM 1 BY 1                                              10030000
049694         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    10040000
049695         OR  ASC-NO-ITEMS-LEFT-ON-DB)                             10050000
049696             PERFORM 4310-FETCH                                   10060000
049697               IF ASC-ITEMS-LEFT-ON-DB                            10070000
049698                  ADD +1 TO ASC-NUMBER-OF-ITEMS-READ              10080000
049699                    IF NOT VEHICL-CURR-OPER-UNT-ID = 90           10090000
049700                        SET PS-NOT-ALL-VSORAIR TO TRUE            10100000
049701                    END-IF                                        10110000
049702               END-IF                                             10120000
049703     END-PERFORM.                                                 10130000
049704                                                                  10140000
049705     IF ASC-NUMBER-OF-ITEMS-READ = 0 AND PS-ALL-VSORAIR           10150000
049706       SET PS-NOT-ALL-VSORAIR TO TRUE                             10160000
049707     END-IF.                                                      10170000
049708                                                                  10180000
049709     PERFORM 4020-CLOSE-CURSOR.                                   10190000
049710*----------------------------------------------------------------*10200000
049711*    READ EACH SHIPMENT FROM THE DB                              *10210000
049712*----------------------------------------------------------------*10220000
049713 4300-READ-ITEMS-FROM-DB.                                         10230000
049714     PERFORM 4010-OPEN-CURSOR.                                    10240000
049715     PERFORM                                                      10250000
049716         VARYING PV-READ-COUNT                                    10260000
049717         FROM 1 BY 1                                              10270000
049718         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    10280000
049719         OR  ASC-NO-ITEMS-LEFT-ON-DB)                             10290000
                 PERFORM 4310-FETCH                                     10300022
                 IF ASC-ITEMS-LEFT-ON-DB                                10310022
049722             ADD +1 TO ASC-NUMBER-OF-ITEMS-READ                   10320021
049723             MOVE VEHICL-CURR-OPER-UNT-ID TO PV-OPER-UNT-ID       10330021
049724             PERFORM 4110-GET-DC-NAME                             10340021
049725             PERFORM 5000-RETRIEVE-MAXDATES                       10350021
049726             PERFORM 5020-RETRIEVE-MAXDATES                       10360021
049727             PERFORM 5030-RETRIEVE-RCPTDATES                      10370021
049728             PERFORM 5040-RETRIEVE-VERDATES                       10380021
049729             PERFORM 5050-RETRIEVE-UNITS-ORD                      10390021
049730             PERFORM 5060-RETRIEVE-UNITS-VFD                      10400021
049731             PERFORM 5070-DETERMINE-IN-PROCESS                    10410021
049732                                                                  10420021
049733             IF PV-OPER-UNT-ID = 865                              10430021
049734                IF SQLCODE = +0                                   10440021
049735                   MOVE DP015-YELLOW TO ASC-UNT-VFD1-C            10450021
049736                ELSE                                              10460021
049737                   MOVE DP015-BLUE TO ASC-UNT-VFD1-C              10470021
049738                END-IF                                            10480021
049739                MOVE PV-DC-REC-QTY TO ASC-UNT-VFD1                10490021
049740                MOVE ALLPLN-CURR-SPLIT-QTY TO ASC-UNT-ORD1        10500021
049741                IF ASC-UNT-VFD1 = 0 OR ASC-UNT-ORD1 = 0           10510021
049742                   MOVE ZEROES TO ASC-PCT-RCD1-N                  10520021
049743                   MOVE SPACES TO ASC-PCT-RCD1-SIGN               10530021
049744                ELSE                                              10540021
049745                  COMPUTE PV-TOT-REC-PCT                          10550021
049746                  ROUNDED =                                       10560021
049747                           (ASC-UNT-VFD1 / ASC-UNT-ORD1)          10570021
049748                  COMPUTE PV-TOT-REC-PCT =                        10580021
049749                          PV-TOT-REC-PCT * 100                    10590021
049750                  IF PV-TOT-REC-PCT = ZERO AND ASC-UNT-VFD1 > 0   10600021
049751                           MOVE 1 TO ASC-PCT-RCD1-N               10610021
049752                           MOVE '%' TO ASC-PCT-RCD1-SIGN          10620021
049753                  ELSE                                            10630021
049754                     MOVE PV-TOT-REC-PCT TO ASC-PCT-RCD1-N        10640021
049755                     MOVE '%' TO ASC-PCT-RCD1-SIGN                10650021
049756                  END-IF                                          10660021
049757                END-IF                                            10670021
049758                MOVE PV-MAX-VERIFD-DTE TO PV-DATE-BREAK           10680021
049759                MOVE PV-DB-MM          TO PV-DD-MM                10690021
049760                MOVE PV-DB-DD          TO PV-DD-DD                10700021
049761                MOVE PV-DB-YY          TO PV-DD-YY                10710021
049762                IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES        10720021
049763                                     AND PV-DD-MM = SPACES        10730021
049764                   MOVE SPACES TO ASC-LST-VFD-DT1                 10740021
049765                ELSE                                              10750021
049766                   MOVE PV-DATE-DISPLAY TO ASC-LST-VFD-DT1        10760021
049767                END-IF                                            10770021
049768                MOVE PV-MIN-VERIFD-DTE TO PV-DATE-BREAK           10780021
049769                MOVE PV-DB-MM          TO PV-DD-MM                10790021
049770                MOVE PV-DB-DD          TO PV-DD-DD                10800021
049771                MOVE PV-DB-YY          TO PV-DD-YY                10810021
049772                IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES        10820021
049773                                     AND PV-DD-MM = SPACES        10830021
049774                   MOVE SPACES TO ASC-FST-VFD-DT1                 10840021
049775                ELSE                                              10850021
049776                   MOVE PV-DATE-DISPLAY TO ASC-FST-VFD-DT1        10860021
049777                END-IF                                            10870021
049778                IF ASC-LST-VFD-DT1 = ASC-FST-VFD-DT1              10880021
049779                   MOVE SPACES TO ASC-LST-VFD-DT1                 10890021
049780                END-IF                                            10900021
049781                                                                  10910021
049782                MOVE XMT00001-LOC-5-ABBR-NM TO ASC-DC1            10920024
049783                MOVE PV-MAX-STATUS-DTE TO PV-DATE-BREAK           10930021
049784                MOVE PV-DB-MM          TO PV-DD-MM                10940021
049785                MOVE PV-DB-DD          TO PV-DD-DD                10950021
049786                MOVE PV-DB-YY          TO PV-DD-YY                10960021
049787                IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES        10970021
049788                                     AND PV-DD-MM = SPACES        10980021
049789                   MOVE SPACES TO ASC-LST-RCPT-DT1                10990021
049790                ELSE                                              11000021
049791                   MOVE PV-DATE-DISPLAY TO ASC-LST-RCPT-DT1       11010021
049792                END-IF                                            11020021
049793                MOVE PV-MIN-STATUS-DTE TO PV-DATE-BREAK           11030021
049794                MOVE PV-DB-MM          TO PV-DD-MM                11040021
049795                MOVE PV-DB-DD          TO PV-DD-DD                11050021
049796                MOVE PV-DB-YY          TO PV-DD-YY                11060021
049797                IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES        11070021
049798                                     AND PV-DD-MM = SPACES        11080021
049799                   MOVE SPACES TO ASC-FST-RCPT-DT1                11090021
049800                ELSE                                              11100021
049801                   MOVE PV-DATE-DISPLAY TO ASC-FST-RCPT-DT1       11110021
049802                END-IF                                            11120021
049803                IF ASC-LST-RCPT-DT1 = ASC-FST-RCPT-DT1            11130021
049804                   MOVE SPACES TO ASC-LST-RCPT-DT1                11140021
049805                END-IF                                            11150021
049806                MOVE PV-SHIPST-ETA-DATE TO PV-DATE-BREAK          11160021
049807                MOVE PV-DB-MM          TO PV-DD-MM                11170021
049808                MOVE PV-DB-DD          TO PV-DD-DD                11180021
049809                MOVE PV-DB-YY          TO PV-DD-YY                11190021
049810                IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES        11200021
049811                                     AND PV-DD-MM = SPACES        11210021
049812                   MOVE SPACES TO ASC-DC-DEL-DATE1                11220021
049813                ELSE                                              11230021
049814                   MOVE PV-DATE-DISPLAY TO ASC-DC-DEL-DATE1       11240021
049815                END-IF                                            11250021
049816                MOVE SHIPST-STATUS-DTE TO PV-DATE-BREAK           11260021
049817                MOVE PV-DB-MM          TO PV-DD-MM                11270021
049818                MOVE PV-DB-DD          TO PV-DD-DD                11280021
049819                MOVE PV-DB-YY          TO PV-DD-YY                11290021
049820                IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES        11300021
049821                                     AND PV-DD-MM = SPACES        11310021
049822                   MOVE SPACES TO ASC-DECON-DATE1                 11320021
049823                ELSE                                              11330021
049824                   MOVE PV-DATE-DISPLAY TO ASC-DECON-DATE1        11340021
049825                END-IF                                            11350021
049826              ELSE                                                11360021
049827                IF PV-OPER-UNT-ID = 870                           11370021
049828                   IF SQLCODE = +0                                11380021
049829                      MOVE DP015-YELLOW TO ASC-UNT-VFD2-C         11390021
049830                   ELSE                                           11400021
049831                      MOVE DP015-BLUE TO ASC-UNT-VFD2-C           11410021
049832                   END-IF                                         11420021
049833                   MOVE PV-DC-REC-QTY TO ASC-UNT-VFD2             11430021
049834                   MOVE ALLPLN-CURR-SPLIT-QTY TO ASC-UNT-ORD2     11440021
049835                   IF ASC-UNT-VFD2 = 0 OR ASC-UNT-ORD2 = 0        11450021
049836                      MOVE ZEROES TO ASC-PCT-RCD2                 11460021
049837                   ELSE                                           11470021
049838                      COMPUTE PV-TOT-REC-PCT                      11480021
049839                      ROUNDED =                                   11490021
049840                         (ASC-UNT-VFD2 / ASC-UNT-ORD2)            11500021
049841                         COMPUTE PV-TOT-REC-PCT =                 11510021
049842                                 PV-TOT-REC-PCT * 100             11520021
049843                      IF PV-TOT-REC-PCT = ZERO                    11530021
049843                         AND ASC-UNT-VFD2 > 0                     11540021
049844                         MOVE 1 TO ASC-PCT-RCD2-N                 11550021
049845                           MOVE '%' TO ASC-PCT-RCD2-SIGN          11560021
049846                      ELSE                                        11570021
049847                        MOVE PV-TOT-REC-PCT TO ASC-PCT-RCD2-N     11580021
049848                        MOVE '%' TO ASC-PCT-RCD2-SIGN             11590021
049849                      END-IF                                      11600021
049850                   END-IF                                         11610021
049851                   MOVE PV-MAX-VERIFD-DTE TO PV-DATE-BREAK        11620021
049852                   MOVE PV-DB-MM          TO PV-DD-MM             11630021
049853                   MOVE PV-DB-DD          TO PV-DD-DD             11640021
049854                   MOVE PV-DB-YY          TO PV-DD-YY             11650021
049855                   IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES     11660021
049856                                        AND PV-DD-MM = SPACES     11670021
049857                      MOVE SPACES TO ASC-LST-VFD-DT2              11680021
049858                   ELSE                                           11690021
049859                      MOVE PV-DATE-DISPLAY TO ASC-LST-VFD-DT2     11700021
049860                   END-IF                                         11710021
049861                   MOVE PV-MIN-VERIFD-DTE TO PV-DATE-BREAK        11720021
049862                   MOVE PV-DB-MM          TO PV-DD-MM             11730021
049863                   MOVE PV-DB-DD          TO PV-DD-DD             11740021
049864                   MOVE PV-DB-YY          TO PV-DD-YY             11750021
049865                   IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES     11760021
049866                                        AND PV-DD-MM = SPACES     11770021
049867                      MOVE SPACES TO ASC-FST-VFD-DT2              11780021
049868                   ELSE                                           11790021
049869                      MOVE PV-DATE-DISPLAY TO ASC-FST-VFD-DT2     11800021
049870                   END-IF                                         11810021
049871                   IF ASC-LST-VFD-DT2 = ASC-FST-VFD-DT2           11820021
049872                      MOVE SPACES TO ASC-LST-VFD-DT2              11830021
049873                   END-IF                                         11840021
049874                   MOVE XMT00001-LOC-5-ABBR-NM TO ASC-DC2         11850024
049875                   MOVE PV-MAX-STATUS-DTE TO PV-DATE-BREAK        11860021
049876                   MOVE PV-DB-MM          TO PV-DD-MM             11870021
049877                   MOVE PV-DB-DD          TO PV-DD-DD             11880021
049878                   MOVE PV-DB-YY          TO PV-DD-YY             11890021
049879                   IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES     11900021
049880                                        AND PV-DD-MM = SPACES     11910021
049881                      MOVE SPACES TO ASC-LST-RCPT-DT2             11920021
049882                   ELSE                                           11930021
049883                      MOVE PV-DATE-DISPLAY TO ASC-LST-RCPT-DT2    11940021
049884                   END-IF                                         11950021
049885                   MOVE PV-MIN-STATUS-DTE TO PV-DATE-BREAK        11960021
049886                   MOVE PV-DB-MM          TO PV-DD-MM             11970021
049887                   MOVE PV-DB-DD          TO PV-DD-DD             11980021
049888                   MOVE PV-DB-YY          TO PV-DD-YY             11990021
049889                   IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES     12000021
049890                                        AND PV-DD-MM = SPACES     12010021
049891                      MOVE SPACES TO ASC-FST-RCPT-DT2             12020021
049892                   ELSE                                           12030021
049893                      MOVE PV-DATE-DISPLAY TO ASC-FST-RCPT-DT2    12040021
049894                   END-IF                                         12050021
049895                   IF ASC-LST-RCPT-DT2 = ASC-FST-RCPT-DT2         12060021
049896                      MOVE SPACES TO ASC-LST-RCPT-DT2             12070021
049897                   END-IF                                         12080021
049898                   MOVE PV-SHIPST-ETA-DATE TO PV-DATE-BREAK       12090021
049899                   MOVE PV-DB-MM           TO PV-DD-MM            12100021
049900                   MOVE PV-DB-DD           TO PV-DD-DD            12110021
049901                   MOVE PV-DB-YY           TO PV-DD-YY            12120021
049902                   IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES     12130021
049903                                        AND PV-DD-MM = SPACES     12140021
049904                      MOVE SPACES TO ASC-DC-DEL-DATE2             12150021
049905                   ELSE                                           12160021
049906                      MOVE PV-DATE-DISPLAY TO ASC-DC-DEL-DATE2    12170021
049907                   END-IF                                         12180021
049908                   MOVE SHIPST-STATUS-DTE TO PV-DATE-BREAK        12190021
049910                   MOVE PV-DB-MM          TO PV-DD-MM             12200021
049911                   MOVE PV-DB-DD          TO PV-DD-DD             12210021
049912                   MOVE PV-DB-YY          TO PV-DD-YY             12220021
049913                   IF PV-DD-DD = SPACES AND PV-DD-YY = SPACES     12230021
049914                                        AND PV-DD-MM = SPACES     12240021
049915                      MOVE SPACES TO ASC-DECON-DATE2              12250021
049916                   ELSE                                           12260021
049917                      MOVE PV-DATE-DISPLAY TO ASC-DECON-DATE2     12270021
049918                   END-IF                                         12280021
                       END-IF                                           12290021
050019             END-IF                                               12300021
                   MOVE PURCHS-TOT-UNT-QTY TO ASC-TOT-ORD               12310022
                 END-IF                                                 12320022
050022     END-PERFORM.                                                 12330021
050023                                                                  12340021
050024     PERFORM 4020-CLOSE-CURSOR.                                   12350021
050025    EJECT                                                         12360000
050026                                                                  12370000
050027*----------------------------------------------------------------*12380000
050028*    FETCH THE SHIPMT-CSR CURSOR.                                *12390000
050029*----------------------------------------------------------------*12400000
050030                                                                  12410000
050031 4310-FETCH.                                                      12420000
050040     EXEC SQL                                                     12430000
050100        FETCH SHIPMT-CSR                                          12440000
050200          INTO  :SHIPMT-SHIPT-ID                                  12450000
050300               ,:SHIPMT-TRIP-ID                                   12460000
050400               ,:VEHICL-CURR-OPER-UNT-ID                          12470000
050500         END-EXEC.                                                12480000
050600     EVALUATE TRUE                                                12490000
050610         WHEN SQLCODE = ZERO                                      12500000
050620            CONTINUE                                              12510000
050621         WHEN SQLCODE = +100                                      12520000
050622             SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                  12530000
050623         WHEN SQLWARN0 NOT = SPACE                                12540000
050624         WHEN SQLCODE NOT = ZERO                                  12550000
050625              MOVE '4310-FETCH-CURSOR'                            12560000
050626                               TO DP013-PARAGRAPH                 12570000
050627              MOVE 'FETCH SHIPMT-CSR CURSOR'                      12580000
050628                               TO DP013-MESSAGE-TEXT (1)          12590000
050629              MOVE SQLCA       TO DP013-SQLCA                     12600000
050630              SET DP013-DB2-ABEND                                 12610000
050631                               TO TRUE                            12620000
050632              PERFORM DP013-0000-PROCESS-ABEND                    12630000
050633     END-EVALUATE.                                                12640000
050634  EJECT                                                           12650000
050635                                                                  12660000
050636*----------------------------------------------------------------*12670000
050637*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *12680000
050638*----------------------------------------------------------------*12690000
050639                                                                  12700000
050640 4400-MOVE-COMMAREA-TO-SCREEN.                                    12710000
050650                                                                  12720000
050660     MOVE ASC-PO-NBR               TO APONUMO.                    12730000
050670     MOVE ASC-LAST-FCTRY-DTE       TO PV-DATE-BREAK.              12740000
050680     MOVE PV-DB-MM                 TO PV-DD-MM.                   12750000
050690     MOVE PV-DB-DD                 TO PV-DD-DD.                   12760000
050700     MOVE PV-DB-YY                 TO PV-DD-YY.                   12770000
050800     MOVE PV-DATE-DISPLAY          TO ALASEXTO.                   12780000
050900     MOVE ASC-STRT-FCTRY-DTE       TO PV-DATE-BREAK.              12790000
051000     MOVE PV-DB-MM                 TO PV-DD-MM.                   12800000
051100     MOVE PV-DB-DD                 TO PV-DD-DD.                   12810000
051200     MOVE PV-DB-YY                 TO PV-DD-YY.                   12820000
051300     MOVE PV-DATE-DISPLAY          TO ASTEXTO.                    12830000
051400     MOVE ASC-DC1                  TO ADCNBR1O.                   12840000
051500     MOVE ASC-DC2                  TO ADCNBR2O.                   12850000
051700     MOVE ASC-SHIP-DATE            TO ASHIPDTO.                   12860000
051800     MOVE ASC-OTB                  TO AOTBPERO.                   12870000
051900     MOVE ASC-CANCEL-DATE          TO ACNCLDTO.                   12880000
052000     MOVE ASC-FOB-POINT            TO AFOBNMEO.                   12890000
052100     MOVE ASC-VENDOR               TO AVDRNAMO.                   12900000
052200     MOVE ASC-DEPT                 TO ADEPTNOO.                   12910000
052300     MOVE ASC-DECON-DATE1          TO ADECDT1O.                   12920000
052400     MOVE ASC-DECON-DATE2          TO ADECDT2O.                   12930000
052600     MOVE ASC-DC-DEL-DATE1         TO ADCDEL1O.                   12940000
052700     MOVE ASC-DC-DEL-DATE2         TO ADCDEL2O.                   12950000
052900     MOVE ASC-FST-RCPT-DT1         TO AFSTRCP1O.                  12960000
053000     MOVE ASC-FST-RCPT-DT2         TO AFSTRCP2O.                  12970000
053200     MOVE ASC-LST-RCPT-DT1         TO ALSTRCP1O.                  12980000
053300     MOVE ASC-LST-RCPT-DT2         TO ALSTRCP2O.                  12990000
053410     MOVE ASC-FST-VFD-DT1          TO AFSTVFD1O.                  13000000
053420     MOVE ASC-FST-VFD-DT2          TO AFSTVFD2O.                  13010000
053440     MOVE ASC-LST-VFD-DT1          TO ALSTVFD1O.                  13020000
053450     MOVE ASC-LST-VFD-DT2          TO ALSTVFD2O.                  13030000
053470     MOVE ASC-UNT-ORD1             TO AUNORD1O.                   13040000
053480     MOVE ASC-UNT-ORD2             TO AUNORD2O.                   13050000
053495     MOVE ASC-TOT-ORD              TO ATOTORDO.                   13060000
053496     ADD  ASC-UNT-VFD1             TO ASC-TOT-VFD                 13070000
053497     ADD  ASC-UNT-VFD2             TO ASC-TOT-VFD                 13080000
           ADD  PO017-TOTVFD             TO ASC-TOT-VFD.                13090004
053499     MOVE ASC-TOT-VFD              TO ATOTVFDO.                   13100000
053500     IF ASC-TOT-VFD = 0 OR ASC-TOT-ORD = 0                        13110000
053501           MOVE ZEROES TO ASC-TOT-PCT-RCD-N                       13120000
053502           MOVE SPACES TO ASC-TOT-PCT-RCD-SIGN                    13130000
053503     ELSE                                                         13140000
053504            COMPUTE PV-TOT-REC-PCT                                13150000
053505            ROUNDED =                                             13160000
053506                 (ASC-TOT-VFD / ASC-TOT-ORD)                      13170000
053507            COMPUTE PV-TOT-REC-PCT =                              13180000
053508                      PV-TOT-REC-PCT * 100                        13190000
053510            IF PV-TOT-REC-PCT = ZERO AND ASC-TOT-VFD > 0          13200000
053511                     MOVE 1 TO ASC-TOT-PCT-RCD-N                  13210000
053512                     MOVE '%' TO ASC-TOT-PCT-RCD-SIGN             13220000
053513            ELSE                                                  13230000
053514                     MOVE PV-TOT-REC-PCT TO ASC-TOT-PCT-RCD-N     13240000
053515                     MOVE '%' TO ASC-TOT-PCT-RCD-SIGN             13250000
053516            END-IF                                                13260000
053517     END-IF.                                                      13270000
053519     MOVE ASC-TOT-PCT-RCD-N        TO PV-TREC-PCT.                13280000
053520     MOVE ASC-TOT-PCT-RCD-SIGN     TO PV-TREC-PCT-SIGN.           13290000
053521     MOVE ASC-UNT-VFD1             TO AUNVFD1O.                   13300000
053522     MOVE ASC-UNT-VFD1-C           TO AUNVFD1C.                   13310000
053523     MOVE ASC-UNT-VFD2             TO AUNVFD2O.                   13320000
053524     MOVE ASC-UNT-VFD2-C           TO AUNVFD2C.                   13330000
053527     MOVE ASC-PCT-RCD1-N           TO PV-TREC-PCT1.               13340000
053531     MOVE ASC-PCT-RCD1-SIGN        TO PV-TREC-PCT1-SIGN.          13350000
053535     MOVE ASC-PCT-RCD2-N           TO PV-TREC-PCT2.               13360000
053536     MOVE ASC-PCT-RCD2-SIGN        TO PV-TREC-PCT2-SIGN.          13370000
053542     MOVE PV-NORMAL-TOTALS         TO MR-TOTAL-LINE.              13380000
053550                                                                  13390000
053600   EJECT                                                          13400000
053700                                                                  13410000
053800*----------------------------------------------------------------*13420000
053900* RETRIEVE THE MAX PICKUP DATE AND MAX VHTRIP ETA DATE PER DC    *13430000
054000*----------------------------------------------------------------*13440000
054100 5000-RETRIEVE-MAXDATES.                                          13450000
054200     PERFORM                                                      13460000
054300         WITH TEST AFTER                                          13470000
054400         VARYING PV-RETRY-COUNTER                                 13480000
054500         FROM 1 BY 1                                              13490000
054600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13500000
054700             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              13510000
054800             OR (SQLCODE = -305))                                 13520000
054900           EXEC SQL                                               13530000
055000             SELECT MAX(F.STATUS_DTE)                             13540000
055100             INTO :PV-SHIPST-ETA-DATE                             13550000
055200             FROM TSHIPMT A,                                      13560000
055300                  TSHPTPO B,                                      13570000
055400                  TTRIPST C,                                      13580000
055500                  TSHIPST F                                       13590000
055600             WHERE B.PO_NBR = :ASC-KEY-PO-NUMBER                  13600000
055700               AND A.SHIPT_ID = B.SHIPT_ID                        13610000
055800               AND C.TRIP_ID = A.TRIP_ID                          13620000
055900               AND C.OPER_UNT_ID = :PV-OPER-UNT-ID                13630000
056000               AND F.SHIPT_STATUS_CDE = 'AG'                      13640000
056010               AND F.SHIPT_ID = A.SHIPT_ID                        13650000
056100           END-EXEC                                               13660000
056200       EVALUATE TRUE                                              13670000
056300           WHEN SQLCODE = +100                                    13680000
056400           WHEN SQLCODE = -305                                    13690000
056500               MOVE SPACES TO PV-SHIPST-ETA-DATE                  13700000
056600           WHEN SQLCODE = ZERO                                    13710000
056700           WHEN SQLCODE = -904                                    13720000
056710           WHEN SQLCODE = -913                                    13730000
056720               CONTINUE                                           13740000
056730           WHEN SQLWARN0 NOT = SPACES                             13750000
056740           WHEN SQLCODE < ZERO                                    13760000
056750           WHEN SQLCODE > ZERO                                    13770000
056751               MOVE '5000-RETRIEVE-MAXDATES'                      13780000
056752                                 TO DP013-PARAGRAPH               13790000
056753               MOVE 'SQL ERROR GET MAX DATES'                     13800000
056754                                 TO DP013-MESSAGE-TEXT (1)        13810000
056755               MOVE SQLCA        TO DP013-SQLCA                   13820000
056756               MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (1)       13830000
056757               SET DP013-DB2-ABEND                                13840000
056758                   DP013-XCTL-DISPLAY-RESTART TO TRUE             13850000
056759               PERFORM DP013-0000-PROCESS-ABEND                   13860000
056760       END-EVALUATE                                               13870000
056761      END-PERFORM.                                                13880000
056762                                                                  13890000
056763      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       13900000
056764       MOVE '5000-RETRIEVE-MAXDATES'                              13910000
056765                                 TO DP013-PARAGRAPH               13920000
056766       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET MAX DTES'     13930000
056767                                 TO DP013-MESSAGE-TEXT (1)        13940000
056768       MOVE SQLCA                TO DP013-SQLCA                   13950000
056769       MOVE 'TSHIPMT'           TO DP013-DB2-TABLE-NAME (1)       13960000
056770       SET DP013-DB2-ABEND                                        13970000
056771           DP013-XCTL-DISPLAY-RESTART                             13980000
056772                                 TO TRUE                          13990000
056773       PERFORM DP013-0000-PROCESS-ABEND                           14000000
056774      END-IF.                                                     14010000
056775                                                                  14020000
056845*----------------------------------------------------------------*14030000
056846* RETRIEVE THE MAX PICKUP DATE AND MAX VHTRIP ETA DATE PER DC    *14040000
056847*----------------------------------------------------------------*14050000
056848 5020-RETRIEVE-MAXDATES.                                          14060000
056849     PERFORM                                                      14070000
056850         WITH TEST AFTER                                          14080000
056851         VARYING PV-RETRY-COUNTER                                 14090000
056852         FROM 1 BY 1                                              14100000
056853         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14110000
056854             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              14120000
056855             OR (SQLCODE = -305))                                 14130000
056856           EXEC SQL                                               14140000
056857             SELECT MAX(F.STATUS_DTE)                             14150000
056858             INTO :SHIPST-STATUS-DTE                              14160000
056859             FROM TSHIPMT A,                                      14170000
056860                  TSHPTPO B,                                      14180000
056861                  TTRIPST C,                                      14190000
056862                  TSHIPST F                                       14200000
056863             WHERE B.PO_NBR = :ASC-KEY-PO-NUMBER                  14210000
056864               AND A.SHIPT_ID = B.SHIPT_ID                        14220000
056865               AND C.TRIP_ID = A.TRIP_ID                          14230000
056866               AND C.OPER_UNT_ID = :PV-OPER-UNT-ID                14240000
056867               AND F.SHIPT_STATUS_CDE = 'AM'                      14250000
056868               AND F.SHIPT_ID = A.SHIPT_ID                        14260000
056869           END-EXEC                                               14270000
056870       EVALUATE TRUE                                              14280000
056871           WHEN SQLCODE = +100                                    14290000
056872           WHEN SQLCODE = -305                                    14300000
056873             PERFORM 5025-GET-AF-STATUS-DTE                       14310000
056876           WHEN SQLCODE = ZERO                                    14320000
056877           WHEN SQLCODE = -904                                    14330000
056878           WHEN SQLCODE = -913                                    14340000
056879               CONTINUE                                           14350000
056880           WHEN SQLWARN0 NOT = SPACES                             14360000
056881           WHEN SQLCODE < ZERO                                    14370000
056882           WHEN SQLCODE > ZERO                                    14380000
056883               MOVE '5020-RETRIEVE-MAXDATES'                      14390000
056884                                 TO DP013-PARAGRAPH               14400000
056885               MOVE 'SQL ERROR GET MAX DATES'                     14410000
056886                                 TO DP013-MESSAGE-TEXT (1)        14420000
056887               MOVE SQLCA        TO DP013-SQLCA                   14430000
056888               MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (1)       14440000
056889               SET DP013-DB2-ABEND                                14450000
056890                   DP013-XCTL-DISPLAY-RESTART TO TRUE             14460000
056891               PERFORM DP013-0000-PROCESS-ABEND                   14470000
056892       END-EVALUATE                                               14480000
056893      END-PERFORM.                                                14490000
056894                                                                  14500000
056895      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       14510000
056896       MOVE '5020-RETRIEVE-MAXDATES'                              14520000
056897                                 TO DP013-PARAGRAPH               14530000
056898       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET MAX DTES'     14540000
056899                                 TO DP013-MESSAGE-TEXT (1)        14550000
056900       MOVE SQLCA                TO DP013-SQLCA                   14560000
056901       MOVE 'TSHIPMT'           TO DP013-DB2-TABLE-NAME (1)       14570000
056902       SET DP013-DB2-ABEND                                        14580000
056903           DP013-XCTL-DISPLAY-RESTART                             14590000
056904                                 TO TRUE                          14600000
056905       PERFORM DP013-0000-PROCESS-ABEND                           14610000
056906      END-IF.                                                     14620000
056907                                                                  14630000
056908  EJECT                                                           14640000
056909                                                                  14650000
056910*----------------------------------------------------------------*14660000
056911* RETRIEVE THE MAX PICKUP DATE AND MAX VHTRIP ETA DATE PER DC    *14670000
056912*----------------------------------------------------------------*14680000
056913 5025-GET-AF-STATUS-DTE.                                          14690000
056914     PERFORM                                                      14700000
056915         WITH TEST AFTER                                          14710000
056916         VARYING PV-RETRY-COUNTER                                 14720000
056917         FROM 1 BY 1                                              14730000
056918         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14740000
056919             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              14750000
056920             OR (SQLCODE = -305))                                 14760000
056921           EXEC SQL                                               14770000
056922             SELECT MAX(F.STATUS_DTE)                             14780000
056923             INTO :SHIPST-STATUS-DTE                              14790000
056924             FROM TSHIPMT A,                                      14800000
056925                  TSHPTPO B,                                      14810000
056926                  TTRIPST C,                                      14820000
056927                  TSHIPST F                                       14830000
056928             WHERE B.PO_NBR = :ASC-KEY-PO-NUMBER                  14840000
056929               AND A.SHIPT_ID = B.SHIPT_ID                        14850000
056930               AND C.TRIP_ID = A.TRIP_ID                          14860000
056931               AND C.OPER_UNT_ID = :PV-OPER-UNT-ID                14870000
056932               AND F.SHIPT_STATUS_CDE = 'AF'                      14880000
056933               AND F.SHIPT_ID = A.SHIPT_ID                        14890000
056934           END-EXEC                                               14900000
056935       EVALUATE TRUE                                              14910000
056936           WHEN SQLCODE = +100                                    14920000
056937           WHEN SQLCODE = -305                                    14930000
056938             MOVE SPACES TO SHIPST-STATUS-DTE                     14940000
056939           WHEN SQLCODE = ZERO                                    14950000
056940           WHEN SQLCODE = -904                                    14960000
056941           WHEN SQLCODE = -913                                    14970000
056942               CONTINUE                                           14980000
056943           WHEN SQLWARN0 NOT = SPACES                             14990000
056944           WHEN SQLCODE < ZERO                                    15000000
056945           WHEN SQLCODE > ZERO                                    15010000
056946               MOVE '5025-GET-AF-STATUS-DTE'                      15020000
056947                                 TO DP013-PARAGRAPH               15030000
056948               MOVE 'SQL ERROR GET MAX DATES'                     15040000
056949                                 TO DP013-MESSAGE-TEXT (1)        15050000
056950               MOVE SQLCA        TO DP013-SQLCA                   15060000
056951               MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (1)       15070000
056952               SET DP013-DB2-ABEND                                15080000
056953                   DP013-XCTL-DISPLAY-RESTART TO TRUE             15090000
056954               PERFORM DP013-0000-PROCESS-ABEND                   15100000
056955       END-EVALUATE                                               15110000
056956      END-PERFORM.                                                15120000
056957                                                                  15130000
056958      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       15140000
056959       MOVE '5025-GET-AF-STATUS-DTE'                              15150000
056960                                 TO DP013-PARAGRAPH               15160000
056961       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET MAX DTES'     15170000
056962                                 TO DP013-MESSAGE-TEXT (1)        15180000
056963       MOVE SQLCA                TO DP013-SQLCA                   15190000
056964       MOVE 'TSHIPMT'           TO DP013-DB2-TABLE-NAME (1)       15200000
056965       SET DP013-DB2-ABEND                                        15210000
056966           DP013-XCTL-DISPLAY-RESTART                             15220000
056967                                 TO TRUE                          15230000
056968       PERFORM DP013-0000-PROCESS-ABEND                           15240000
056969      END-IF.                                                     15250000
056970                                                                  15260000
056971  EJECT                                                           15270000
056972                                                                  15280000
056973*----------------------------------------------------------------*15290000
056974* RETRIEVE THE MAX AND MIN RCPT DATES PER DC                     *15300000
056975*----------------------------------------------------------------*15310000
056976 5030-RETRIEVE-RCPTDATES.                                         15320000
056977     PERFORM                                                      15330000
056978         WITH TEST AFTER                                          15340000
056979         VARYING PV-RETRY-COUNTER                                 15350000
056980         FROM 1 BY 1                                              15360000
056981         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15370000
056982             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              15380000
056983             OR (SQLCODE = -305))                                 15390000
056984           EXEC SQL                                               15400000
056985             SELECT MAX(E.STATUS_DTE),                            15410000
056986                    MIN(E.STATUS_DTE)                             15420000
056987             INTO  :PV-MAX-STATUS-DTE                             15430000
056988                  ,:PV-MIN-STATUS-DTE                             15440000
056989             FROM   TSHIPMT A,                                    15450000
056990                    TSHPTPO B,                                    15460000
056991                    TTRIPST C,                                    15470000
056992                    TSHIPST E                                     15480000
056993             WHERE B.PO_NBR = :ASC-KEY-PO-NUMBER                  15490000
056994               AND A.SHIPT_ID = B.SHIPT_ID                        15500000
056995               AND C.TRIP_ID = A.TRIP_ID                          15510000
056996               AND C.OPER_UNT_ID = :PV-OPER-UNT-ID                15520000
056997               AND E.SHIPT_STATUS_CDE = 'AR'                      15530000
056998               AND E.SHIPT_ID = A.SHIPT_ID                        15540000
056999           END-EXEC                                               15550000
057000       EVALUATE TRUE                                              15560000
057001           WHEN SQLCODE = +100                                    15570000
057002           WHEN SQLCODE = -305                                    15580000
057003             MOVE SPACES TO PV-MAX-STATUS-DTE PV-MIN-STATUS-DTE   15590000
057004           WHEN SQLCODE = ZERO                                    15600000
057005           WHEN SQLCODE = -904                                    15610000
057006           WHEN SQLCODE = -913                                    15620000
057007               CONTINUE                                           15630000
057008           WHEN SQLWARN0 NOT = SPACES                             15640000
057009           WHEN SQLCODE < ZERO                                    15650000
057010           WHEN SQLCODE > ZERO                                    15660000
057011               MOVE '5030-RETRIEVE-RCPTDATES'                     15670000
057012                                 TO DP013-PARAGRAPH               15680000
057013               MOVE 'SQL ERROR GET MAX AND MIN RCPT DATES'        15690000
057014                                 TO DP013-MESSAGE-TEXT (1)        15700000
057015               MOVE SQLCA        TO DP013-SQLCA                   15710000
057016               MOVE 'TSHIPST'   TO DP013-DB2-TABLE-NAME (1)       15720000
057017               SET DP013-DB2-ABEND                                15730000
057018                   DP013-XCTL-DISPLAY-RESTART TO TRUE             15740000
057019               PERFORM DP013-0000-PROCESS-ABEND                   15750000
057020       END-EVALUATE                                               15760000
057021      END-PERFORM.                                                15770000
057022                                                                  15780000
057023      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       15790000
057024       MOVE '5030-RETRIEVE-RCPTDATES'                             15800000
057025                                 TO DP013-PARAGRAPH               15810000
057026       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET RCPT DTES'    15820000
057027                                 TO DP013-MESSAGE-TEXT (1)        15830000
057028       MOVE SQLCA                TO DP013-SQLCA                   15840000
057029       MOVE 'TSHIPST'           TO DP013-DB2-TABLE-NAME (1)       15850000
057030       SET DP013-DB2-ABEND                                        15860000
057031           DP013-XCTL-DISPLAY-RESTART                             15870000
057032                                 TO TRUE                          15880000
057033       PERFORM DP013-0000-PROCESS-ABEND                           15890000
057034      END-IF.                                                     15900000
057035                                                                  15910000
057036 EJECT                                                            15920000
057037*----------------------------------------------------------------*15930000
057038* RETRIEVE THE MAX AND MIN VERIFIED DATES PER DC                 *15940000
057039*----------------------------------------------------------------*15950000
057040 5040-RETRIEVE-VERDATES.                                          15960000
057041     PERFORM                                                      15970000
057042         WITH TEST AFTER                                          15980000
057043         VARYING PV-RETRY-COUNTER                                 15990000
057044         FROM 1 BY 1                                              16000000
057045         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16010000
057046             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              16020000
057047             OR (SQLCODE = -305))                                 16030000
057048           EXEC SQL                                               16040000
057049             SELECT MAX(DATE(VERFYD_TMST)),                       16050000
057050                    MIN(DATE(VERFYD_TMST))                        16060000
057051             INTO  :PV-MAX-VERIFD-DTE                             16070000
057052                  ,:PV-MIN-VERIFD-DTE                             16080000
057053             FROM TRECEIV                                         16090000
057057             WHERE ORD_NBR = :ASC-KEY-PO-NUMBER                   16100000
057058               AND VER_STATUS_CDE = 'A'                           16110000
057059               AND STATUS_CDE = 'VE'                              16120000
057060               AND OPER_UNT_ID = :PV-OPER-UNT-ID                  16130000
057063           END-EXEC                                               16140000
057064       EVALUATE TRUE                                              16150000
057065           WHEN SQLCODE = +100                                    16160000
057066           WHEN SQLCODE = -305                                    16170000
057068             MOVE SPACES TO PV-MAX-VERIFD-DTE PV-MIN-VERIFD-DTE   16180000
057069           WHEN SQLCODE = ZERO                                    16190000
057070           WHEN SQLCODE = -904                                    16200000
057071           WHEN SQLCODE = -913                                    16210000
057072               CONTINUE                                           16220000
057073           WHEN SQLWARN0 NOT = SPACES                             16230000
057074           WHEN SQLCODE < ZERO                                    16240000
057075           WHEN SQLCODE > ZERO                                    16250000
057076               MOVE '5040-RETRIEVE-VERDATES'                      16260000
057077                                 TO DP013-PARAGRAPH               16270000
057078               MOVE 'SQL ERROR GET MAX AND MIN VERFD DATES'       16280000
057079                                 TO DP013-MESSAGE-TEXT (1)        16290000
057080               MOVE SQLCA        TO DP013-SQLCA                   16300000
057081               MOVE 'TRECEIV'   TO DP013-DB2-TABLE-NAME (1)       16310000
057082               SET DP013-DB2-ABEND                                16320000
057083                   DP013-XCTL-DISPLAY-RESTART TO TRUE             16330000
057084               PERFORM DP013-0000-PROCESS-ABEND                   16340000
057085       END-EVALUATE                                               16350000
057086      END-PERFORM.                                                16360000
057087                                                                  16370000
057107      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       16380000
057089       MOVE '5040-RETRIEVE-VERDATES'                              16390000
057090                                 TO DP013-PARAGRAPH               16400000
057091       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET VERFD DTES'   16410000
057092                                 TO DP013-MESSAGE-TEXT (1)        16420000
057093       MOVE SQLCA                TO DP013-SQLCA                   16430000
057094       MOVE 'TRECEIV'           TO DP013-DB2-TABLE-NAME (1)       16440000
057095       SET DP013-DB2-ABEND                                        16450000
057096           DP013-XCTL-DISPLAY-RESTART                             16460000
057097                                 TO TRUE                          16470000
057098       PERFORM DP013-0000-PROCESS-ABEND                           16480000
057099      END-IF.                                                     16490000
057100                                                                  16500000
057101 EJECT                                                            16510000
057102*----------------------------------------------------------------*16520000
057103* RETRIEVE THE QTY PER DC ORDERED                                *16530000
057104*----------------------------------------------------------------*16540000
057105 5050-RETRIEVE-UNITS-ORD.                                         16550000
057106     PERFORM                                                      16560000
057107         WITH TEST AFTER                                          16570000
057108         VARYING PV-RETRY-COUNTER                                 16580000
057109         FROM 1 BY 1                                              16590000
057110         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16600000
057111             OR (SQLCODE = ZERO) OR (SQLCODE = +100)              16610000
057112             OR (SQLCODE = -305))                                 16620000
057113           EXEC SQL                                               16630000
057114             SELECT SUM(CURR_SPLIT_QTY)                           16640000
057116             INTO  :ALLPLN-CURR-SPLIT-QTY:PV-QTY-NULL             16650000
057117             FROM TPURITM A,                                      16660000
057118                  TALLPLN B                                       16670000
057119             WHERE A.PO_NBR   = :ASC-KEY-PO-NUMBER                16680000
057122               AND B.DEST_NBR = :PV-OPER-UNT-ID                   16690000
057129               AND A.VER_STATUS_CDE = 'A'                         16700000
057130               AND A.STATUS_CDE NOT IN ('CA')                     16710000
057131               AND A.PO_NBR         = B.PO_NBR                    16720000
057132               AND A.PO_LNE_NBR     = B.PO_LNE_NBR                16730000
057134           END-EXEC                                               16740000
057135       EVALUATE TRUE                                              16750000
057136           WHEN SQLCODE = +100                                    16760000
057137           WHEN SQLCODE = -305                                    16770000
057138             MOVE 0 TO ALLPLN-CURR-SPLIT-QTY                      16780000
057139           WHEN SQLCODE = ZERO                                    16790000
057140           WHEN SQLCODE = -904                                    16800000
057141           WHEN SQLCODE = -913                                    16810000
057142               CONTINUE                                           16820000
057143           WHEN SQLWARN0 NOT = SPACES                             16830000
057144           WHEN SQLCODE < ZERO                                    16840000
057145           WHEN SQLCODE > ZERO                                    16850000
057146               MOVE '5050-RETRIEVE-UNITS-ORD'                     16860000
057147                                 TO DP013-PARAGRAPH               16870000
057148               MOVE 'SQL ERROR GET UNITS ORDERED'                 16880000
057149                                 TO DP013-MESSAGE-TEXT (1)        16890000
057150               MOVE SQLCA        TO DP013-SQLCA                   16900000
057151               MOVE 'TALLPLN'   TO DP013-DB2-TABLE-NAME (1)       16910000
057152               MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (2)       16920000
057153               SET DP013-DB2-ABEND                                16930000
057154                   DP013-XCTL-DISPLAY-RESTART TO TRUE             16940000
057155               PERFORM DP013-0000-PROCESS-ABEND                   16950000
057156       END-EVALUATE                                               16960000
057157      END-PERFORM.                                                16970000
057158                                                                  16980000
057159      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       16990000
057160       MOVE '5050-RETRIEVE-UNITS-ORD'                             17000000
057161                                 TO DP013-PARAGRAPH               17010000
057162       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET UNITS ORDERED'17020000
057163                                 TO DP013-MESSAGE-TEXT (1)        17030000
057164       MOVE SQLCA                TO DP013-SQLCA                   17040000
057165       MOVE 'TALLPLN'           TO DP013-DB2-TABLE-NAME (1)       17050000
057166       MOVE 'TPURITM'           TO DP013-DB2-TABLE-NAME (2)       17060000
057167       SET DP013-DB2-ABEND                                        17070000
057168           DP013-XCTL-DISPLAY-RESTART                             17080000
057169                                 TO TRUE                          17090000
057170       PERFORM DP013-0000-PROCESS-ABEND                           17100000
057171      END-IF.                                                     17110000
057172                                                                  17120000
057173 EJECT                                                            17130000
057174*----------------------------------------------------------------*17140000
057175* RETRIEVE THE RECEIVED QUANTITY FOR A DC.                       *17150000
057176*----------------------------------------------------------------*17160000
057177 5060-RETRIEVE-UNITS-VFD.                                         17170000
057178                                                                  17180000
057179     MOVE +0                       TO PV-DC-REC-QTY.              17190000
057180                                                                  17200000
057181     PERFORM                                                      17210000
057182         WITH TEST AFTER                                          17220000
057183         VARYING PV-RETRY-COUNTER                                 17230000
057184         FROM 1 BY 1                                              17240000
057185         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17250000
057186                   OR (SQLCODE = ZERO)                            17260000
057187                   OR (SQLCODE = 100))                            17270000
057188         EXEC SQL                                                 17280000
057189             SELECT SUM(AP_VERIFY_ITM_QTY)                        17290000
057190               INTO :PV-DC-REC-QTY:PV-QTY-NULL                    17300000
057191               FROM TRECITM A,                                    17310000
057192                    TRECDIS B                                     17320000
057193              WHERE                                               17330000
057194                    A.ORD_NBR        = :ASC-KEY-PO-NUMBER         17340000
057195                AND A.VER_STATUS_CDE = 'A'                        17350000
057196                AND A.OPER_UNT_ID    = :PV-OPER-UNT-ID            17360000
057197                AND A.STATUS_CDE     = 'VE'                       17370000
057198                AND A.ORD_NBR        = B.ORD_NBR                  17380000
057199                AND A.ORD_LNE_NBR    = B.ORD_LNE_NBR              17390000
057200                AND A.REC_SEQ_NBR    = B.REC_SEQ_NBR              17400000
057201                AND A.OPER_UNT_ID    = B.OPER_UNT_ID              17410000
057202                AND A.FCLTY_ID       = B.FCLTY_ID                 17420000
057203                AND B.VER_STATUS_CDE = 'A'                        17430000
057204         END-EXEC                                                 17440000
057205                                                                  17450000
057206         EVALUATE TRUE                                            17460000
057207             WHEN SQLCODE = ZERO                                  17470000
057208                 CONTINUE                                         17480000
057209             WHEN SQLCODE = +100                                  17490000
057210                 CONTINUE                                         17500000
057211             WHEN SQLCODE = -904                                  17510000
057212             WHEN SQLCODE = -913                                  17520000
057213                 CONTINUE                                         17530000
057214             WHEN SQLWARN0 NOT = SPACES                           17540000
057215             WHEN SQLCODE < ZERO                                  17550000
057216             WHEN SQLCODE > ZERO                                  17560000
057217                 MOVE '5060-RETRIEVE-UNITS-VFD'                   17570000
057218                                   TO DP013-PARAGRAPH             17580000
057219                 MOVE 'RETRIEVING RECEIVED QTY'                   17590000
057220                                   TO DP013-MESSAGE-TEXT (1)      17600000
057221                 MOVE SQLCA        TO DP013-SQLCA                 17610000
057222                 MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)    17620000
057223                 MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (2)    17630000
057224                 SET DP013-DB2-ABEND                              17640000
057225                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17650000
057226                 PERFORM DP013-0000-PROCESS-ABEND                 17660000
057227         END-EVALUATE                                             17670000
057228     END-PERFORM.                                                 17680000
057229*                                                                 17690000
057230     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17700000
057231         MOVE '5060-RETRIEVE-UNITS-VFD' TO DP013-PARAGRAPH        17710000
057232         MOVE 'MAXIMUM RETRIES EXCEEDED'                          17720000
057233                                   TO DP013-MESSAGE-TEXT (1)      17730000
057234         MOVE SQLCA                TO DP013-SQLCA                 17740000
057235         MOVE 'TRECITM '           TO DP013-DB2-TABLE-NAME (1)    17750000
057236         MOVE 'TRECDIS '           TO DP013-DB2-TABLE-NAME (2)    17760000
057237         SET DP013-DB2-ABEND                                      17770000
057238             DP013-XCTL-DISPLAY-RESTART                           17780000
057239                                   TO TRUE                        17790000
057240         PERFORM DP013-0000-PROCESS-ABEND                         17800000
057241     END-IF.                                                      17810000
057242                                                                  17820000
057243*----------------------------------------------------------------*17830000
057244* FIND OUT IF ANY RECEIVERS ARE STILL IN PROCESS FOR THIS DC     *17840000
057245*----------------------------------------------------------------*17850000
057246 5070-DETERMINE-IN-PROCESS.                                       17860000
057247     PERFORM                                                      17870000
057248         WITH TEST AFTER                                          17880000
057249         VARYING PV-RETRY-COUNTER                                 17890000
057250         FROM 1 BY 1                                              17900000
057251         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17910000
057252             OR (SQLCODE = ZERO) OR (SQLCODE = +100) OR           17920000
057253                (SQLCODE = -305))                                 17930000
057254           EXEC SQL                                               17940000
057261             SELECT MAX(REC_SEQ_NBR)                              17950000
057262             INTO :RECITM-REC-SEQ-NBR                             17960000
057263             FROM TRECITM                                         17970000
057264             WHERE ORD_NBR =: ASC-KEY-PO-NUMBER                   17980000
057265               AND VER_STATUS_CDE = 'A'                           17990000
057266               AND OPER_UNT_ID = :PV-OPER-UNT-ID                  18000000
057267               AND STATUS_CDE = 'IP'                              18010000
057268               AND CRE_TMST IN                                    18020000
057269                       (SELECT MAX(CRE_TMST)                      18030000
057270                        FROM TRECITM                              18040000
057271                        WHERE ORD_NBR = : ASC-KEY-PO-NUMBER       18050000
057272                          AND VER_STATUS_CDE = 'A'                18060000
057273                          AND OPER_UNT_ID = :PV-OPER-UNT-ID       18070000
057274                          AND STATUS_CDE = 'IP')                  18080000
057275           END-EXEC                                               18090000
057276       EVALUATE TRUE                                              18100000
057277           WHEN SQLCODE = ZERO                                    18110000
057278           WHEN SQLCODE = -305                                    18120000
057279           WHEN SQLCODE = +100                                    18130000
057280           WHEN SQLCODE = -904                                    18140000
057281           WHEN SQLCODE = -913                                    18150000
057282               CONTINUE                                           18160000
057283           WHEN SQLWARN0 NOT = SPACES                             18170000
057284           WHEN SQLCODE < ZERO                                    18180000
057285           WHEN SQLCODE > ZERO                                    18190000
057286               MOVE '5070-DETERMINE-IN-PROCESS'                   18200000
057287                                 TO DP013-PARAGRAPH               18210000
057288               MOVE 'SQL ERROR GET RCVR STATUS'                   18220000
057289                                 TO DP013-MESSAGE-TEXT (1)        18230000
057290               MOVE SQLCA        TO DP013-SQLCA                   18240000
057291               MOVE 'TRECITM'   TO DP013-DB2-TABLE-NAME (1)       18250000
057292               SET DP013-DB2-ABEND                                18260000
057293                   DP013-XCTL-DISPLAY-RESTART TO TRUE             18270000
057294               PERFORM DP013-0000-PROCESS-ABEND                   18280000
057295       END-EVALUATE                                               18290000
057296      END-PERFORM.                                                18300000
057297                                                                  18310000
057298      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       18320000
057299       MOVE '5070-DETERMINE-IN-PROCESS'                           18330000
057300                                 TO DP013-PARAGRAPH               18340000
057301       MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO GET RCVR STATUS'  18350000
057302                                 TO DP013-MESSAGE-TEXT (1)        18360000
057303       MOVE SQLCA                TO DP013-SQLCA                   18370000
057304       MOVE 'TRECITM'           TO DP013-DB2-TABLE-NAME (1)       18380000
057305       SET DP013-DB2-ABEND                                        18390000
057306           DP013-XCTL-DISPLAY-RESTART                             18400000
057307                                 TO TRUE                          18410000
057308       PERFORM DP013-0000-PROCESS-ABEND                           18420000
057309      END-IF.                                                     18430000
057310                                                                  18440000
057311*----------------------------------------------------------------*18450000
057312*    ABEND PROCESSOR MODULE                                      *18460000
057320*----------------------------------------------------------------*18470000
057400     COPY DPPD013.                                                18480000
