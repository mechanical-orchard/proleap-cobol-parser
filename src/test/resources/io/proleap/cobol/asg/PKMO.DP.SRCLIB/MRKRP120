000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             MRKRP120.                                00050000
000600 AUTHOR.                 LINDA FRIESS.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            05-31-01.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*                                                               * 00120000
001300*  THIS PROGRAM WILL PRINT THE INFOREM SERVICE LEVEL REPORT     * 00130000
001400*  FOR E-COMMERCE STORES WITH FT = O (ORDER POINT/ORDER-UP-TO). * 00140000
001500*  (MRKRP105 PRINTS THE REPORT FOR FT = U.)                     * 00150000
001600*  SERVICE LEVELS ARE CALCULATED & REPORTED BY STYLE/COLOR.     * 00160000
001700*  THE ZERO-ONHAND FILE CONTAINS ALL ITEM/STORES THAT HAVE HAD  * 00170024
001800*  AN ONHAND QUANTITY = 0 AT ANY TIME DURING THE PREVIOUS       * 00180024
001900*  WEEK.  THIS IS USED TO DETERMINE THE SERVICE LEVEL.  COUNTS  * 00190000
002000*  ARE GENERATED FOR THE NUMBER OF ITEMS AND STORES THAT FELL   * 00200000
002100*  BELOW A SET SERVICE LEVEL LIMIT (WHICH IS INPUT THROUGH A    * 00210000
002200*  CONTROL CARD).  ANY DEPARTMENT CAN ALSO BE SUMMED UP TO THE  * 00220000
002300*  SUBCLASS LEVEL (THESE ARE ALSO INPUT THROUGH CONTROL CARDS). * 00230000
002400*                                                               * 00240000
002500***************************************************************** 00250000
002600*  CHANGE MADE:                                                 * 00260000
002700*                                                               * 00270000
002800*  CHANGED 06/19/01 BY LINDA FRIESS               WR# 22377     * 00280000
002900*    INITIAL PROGRAM CODE                                       * 00290000
003000*                                                               * 00300000
003100***************************************************************** 00310000
003200* 04/19/2002 - DON TOMLINSON  NI-SKU MR PHASE 4 CHANGES         * 00320000
003300* -  TSKXREF ADDED. MRRD031 CHANGED.                            * 00330000
003400* -  ADDED ISWS006 COPYBOOK TO HANDLE DIFFERENT FORMATS / SIZES * 00340000
003500*    IN FIELDS.                                                 * 00350000
003600* -  SQL CHANGED FOR WHERE STATEMENTS TO REFERENCE DCLGEN       * 00360000
003700*    FIELDS INSTEAD OF PROGRAM VARAIABLES IN WORKING STORAGE    * 00370000
003800* -  REPORT FORMAT CHANGED TO SHOW CL (SUBCLASS). DEPT IS STILL * 00380000
003900*    IN HEADING.                                                * 00390000
003100***************************************************************** 00400016
003200* 06/10/2004 - BOB FORD WR#26363 - STORE NUMBER EXPANSION       * 00410016
003300*    CHANGED PROGRAM TO HANDLE 5-DIGIT STORE NUMBERS.  CHANGED  * 00420016
003300*    COPYBOOK, PRINT LINES, WORK FIELDS, REPLACED TSTR000 WITH  * 00430016
003300*    XMT_LOC, CHANGED TO ACCESS NUMERIC STORE ON TSKST, TSKTOO, * 00440016
003300*    TMRITST.                                                   * 00450016
004100***************************************************************** 00460000
003200* 05/15/2006 - CHRIS DOMINO WR#31066 -                          * 00470040
003300*    CHANGED PROGRAM TO USE THE ZERO-ONHAND FILE, WHICH         * 00480024
001700*    CONTAINS ALL ITEM/STORES THAT HAVE HAD AN ONHAND           * 00490024
001800*    QUANTITY = 0 AT ANY TIME DURING THE PREVIOUS WEEK.         * 00500024
001800*    ALL REPORT DATA COLUMNS HAVE BEEN LEFT UNCHANGED.          * 00510025
004100***************************************************************** 00520021
003200* 09/26/2022 - JEAN KURK            CHG0274970                  * 00521043
003300*    FIX FIELD NAMES FOR TMDSEBG                                * 00522043
001700*    FIX ZERO-ONHAND-FILE                                       * 00523043
004100***************************************************************** 00526043
004200 ENVIRONMENT DIVISION.                                            00530000
    00***************************************************************** 00540024
004400                                                                  00550000
004500 CONFIGURATION SECTION.                                           00560000
004600                                                                  00570000
004700 SOURCE-COMPUTER.        IBM-3090.                                00580000
004800 OBJECT-COMPUTER.        IBM-3090.                                00590000
004900                                                                  00600000
005000 INPUT-OUTPUT SECTION.                                            00610000
005100                                                                  00620000
005200 FILE-CONTROL.                                                    00630000
005300*                                                                 00640000
005400     SELECT CONTROL-FILE                                          00650000
005500                             ASSIGN       TO INP01.               00660000
005600                                                                  00670000
005700     SELECT ZERO-ONHAND-FILE                                      00680024
005800                            ASSIGN       TO INP02                 00690027
005900                            ORGANIZATION IS INDEXED               00700027
006000                            ACCESS       IS SEQUENTIAL            00710027
006100                            RECORD KEY   IS ZERO-ONHAND-KEY       00720027
006200                            FILE STATUS  IS PV-VSAM-STATUS.       00730027
006300                                                                  00740000
006400     SELECT PRINT-REPORT                                          00750000
006500                             ASSIGN       TO OUT01.               00760000
006600*                                                                 00770000
006700***************************************************************** 00780000
006800 DATA DIVISION.                                                   00790000
006900***************************************************************** 00800000
007000*                                                                 00810000
007100 FILE SECTION.                                                    00820000
007200*                                                                 00830000
007300 FD  CONTROL-FILE                                                 00840000
007400     RECORDING MODE IS F                                          00850000
007500     DATA RECORD IS CONTROL-RECORD.                               00860000
007600                                                                  00870000
007700 01  CONTROL-RECORD                    PIC X(80).                 00880000
007800*                                                                 00890000
007900*FD  ZERO-ONHAND-FILE                                             00900043
008000*    LABEL RECORDS ARE STANDARD                                   00910043
008100*    RECORD CONTAINS 65 CHARACTERS                                00920043
008200*    BLOCK CONTAINS 0 RECORDS.                                    00930043
008300*                                                                 00940000
007900 FD  ZERO-ONHAND-FILE.                                            00941043
008400 01  ZERO-ONHAND-RECORD.                                          00950024
008500     05  ZERO-ONHAND-KEY              PIC  X(65).                 00960024
008600*                                                                 00970000
008700 FD  PRINT-REPORT                                                 00980000
008800     LABEL RECORDS ARE STANDARD                                   00990000
008900     RECORDING MODE IS F                                          01000000
009000     RECORD CONTAINS 132 CHARACTERS                               01010000
009100     BLOCK CONTAINS 0 RECORDS.                                    01020000
009200                                                                  01030000
009300 01  PRINT-LINE                       PIC X(132).                 01040000
009400*                                                                 01050000
009500*                                                                 01060000
009600 WORKING-STORAGE SECTION.                                         01070000
009700*                                                                 01080000
009800 01  CONTROL-DATA-IN.                                             01090000
009900     05 CTL-PERCENTAGES-CARD.                                     01100000
010000        10 CTL-SKU-SVC-LEVEL-PCT       PIC 9(03).                 01110000
010100        10 FILLER                      PIC X.                     01120000
010200        10 CTL-STORE-SVC-LEVEL-PCT     PIC 9(03).                 01130000
010300     05 CTL-DEPT-CARD REDEFINES CTL-PERCENTAGES-CARD.             01140000
010400        10 CTL-DEPT                    PIC X(03).                 01150000
010500        10 FILLER                      PIC X(04).                 01160000
010600     05 FILLER                         PIC X(73).                 01170000
010700*                                                                 01180000
010800*                                                                 01190000
010900     COPY MRRD119.                                                01200000
011000*                                                                 01210000
011100******************************************************            01220000
011200** STANDARD HEADER LINE - KOHLS 132 COL                           01230000
011300******************************************************            01240000
011400     COPY DPWS132.                                                01250000
011500*                                                                 01260000
011600 01  HEADING-LINE-2.                                              01270000
011700     05  FILLER                       PIC X(02)  VALUE SPACES.    01280000
011800     05  FILLER                       PIC X(07)  VALUE 'BUYER: '. 01290000
011900     05  HL2-BYR-NMBR                 PIC X(03).                  01300000
012000     05  FILLER                       PIC X(02)  VALUE SPACES.    01310000
012100     05  HL2-BYR-NAME                 PIC X(25).                  01320000
012200     05  FILLER                       PIC X(01)  VALUE SPACES.    01330000
012300     05  FILLER                       PIC X(33)  VALUE            01340000
012400         'INFOREM SERVICE LEVEL REPORT FOR '.                     01350000
012500     05  FILLER                       PIC X(23)  VALUE            01360000
012600         'E-COMMERCE SKUS ON FT O'.                               01370000
012700     05  FILLER                       PIC X(36)  VALUE SPACES.    01380000
012800*                                                                 01390000
012900 01  HEADING-LINE-3.                                              01400000
013000     05  FILLER                       PIC X(02)  VALUE SPACES.    01410000
013100     05  FILLER                       PIC X(07)  VALUE 'DEPT:  '. 01420000
013200     05  HL3-DEPT                     PIC ZZ9.                    01430000
013300     05  FILLER                       PIC X(02)  VALUE SPACES.    01440000
013400     05  FILLER                       PIC X(17)  VALUE            01450000
013500         'BUSINESS GROUP:  '.                                     01460000
013600     05  HL3-BG-NUMBER                PIC X(03).                  01470000
013700     05  FILLER                       PIC X(01)  VALUE SPACES.    01480000
013800     05  HL3-BG-DESC                  PIC X(25).                  01490000
013900     05  FILLER                       PIC X(06)  VALUE SPACES.    01500000
014000     05  FILLER                       PIC X(53)  VALUE            01510000
014100         '* INDICATES SOME STORES DO NOT CONTAIN ALL THE ITEMS '. 01520000
014200     05  FILLER                       PIC X(13)  VALUE            01530000
014300         'IN THIS STYLE'.                                         01540000
014400*                                                                 01550000
014500 01  HEADING-LINE-4.                                              01560000
014600     05  FILLER                       PIC X(04)  VALUE SPACES.    01570000
014700     05  FILLER                       PIC X(56)  VALUE SPACES.    01580017
014800     05  FILLER                       PIC X(52)  VALUE            01590000
014900         'TOTAL    TOTAL    AVG     AVG          SVC    # SKUS'.  01600000
015000     05  FILLER                       PIC X(20)  VALUE            01610017
015100         ' # STORES  AVG.     '.                                  01620017
015200*                                                                 01630000
015300 01  HEADING-LINE-5.                                              01640000
015400     05  FILLER                       PIC X(01)  VALUE SPACES.    01650000
015500     05  FILLER                       PIC X(05)  VALUE 'CLASS'.   01660000
015600     05  FILLER                       PIC X(01)  VALUE SPACES.    01670000
015700     05  FILLER                       PIC X(38)  VALUE            01680000
015800         'STYLE           DESCRIPTION           '.                01690000
015900     05  FILLER                       PIC X(24)  VALUE            01700016
016000         '    COLOR      STORES   '.                              01710016
016100     05  FILLER                       PIC X(39)  VALUE            01720000
016200         'SKUS      OH      OO  CSTOCK  LVL %   <'.               01730000
016300     05  HL5-SKU-LIMIT                PIC ZZ9.                    01740000
016400     05  FILLER                       PIC X(05)  VALUE '%   <'.   01750017
016500     05  HL5-STORE-LIMIT              PIC ZZ9.                    01760000
016600     05  FILLER                       PIC X(13)  VALUE            01770000
016700         '%  OSTRAT  LT'.                                         01780000
016800*                                                                 01790000
016900 01  DETAIL-LINE-1.                                               01800000
017000     05  FILLER                       PIC X(02)  VALUE SPACES.    01810000
017100     05  DL1-CLASS                    PIC X(02).                  01820000
017200     05  FILLER                       PIC X(02)  VALUE SPACES.    01830000
017300     05  DL1-STYLE                    PIC X(15).                  01840000
017400     05  FILLER                       PIC X(01)  VALUE SPACES.    01850000
017500     05  DL1-DESC                     PIC X(25).                  01860000
017600     05  FILLER                       PIC X(01)  VALUE SPACES.    01870000
017700     05  DL1-COLOR                    PIC X(10).                  01880000
017800     05  FILLER                       PIC X(01)  VALUE SPACES.    01890000
017900     05  DL1-TOT-STORES               PIC ZZZZ9.                  01900016
018000     05  FILLER                       PIC X(01)  VALUE SPACES.    01910000
018100     05  DL1-ASTERISK                 PIC X(01)  VALUE SPACES.    01920000
018200     05  FILLER                       PIC X(02)  VALUE SPACES.    01930000
018300     05  DL1-TOT-SKUS                 PIC Z,ZZ9.                  01940000
018400     05  FILLER                       PIC X(01)  VALUE SPACES.    01950000
018500     05  DL1-AVG-OH                   PIC ZZZZ9.9-.               01960000
018600     05  DL1-AVG-OO                   PIC ZZZZ9.9-.               01970000
018700     05  DL1-CSTOCK                   PIC ZZZZZZ9.                01980000
018800     05  FILLER                       PIC X(02)  VALUE SPACES.    01990000
018900     05  DL1-SVC-LEVEL                PIC ZZ9.                    02000000
019000     05  FILLER                       PIC X(05)  VALUE SPACES.    02010000
019100     05  DL1-SKUS-BELOW               PIC Z,ZZ9.                  02020000
019200     05  FILLER                       PIC X(02)  VALUE SPACES.    02030017
019300     05  DL1-STORES-BELOW             PIC ZZ,ZZ9.                 02040017
019400     05  FILLER                       PIC X(03)  VALUE SPACES.    02050000
019500     05  DL1-AVG-OSTRAT               PIC ZZ9.9.                  02060000
019600     05  FILLER                       PIC X(01)  VALUE SPACES.    02070000
019700     05  DL1-LEAD-TIME                PIC ZZ9.                    02080000
019800*                                                                 02090000
019900 01  TOTAL-LINE-1.                                                02100000
020000     05  FILLER                       PIC X(02)  VALUE SPACES.    02110000
020100     05  TL1-CLASS                    PIC X(02).                  02120000
020200     05  FILLER                       PIC X(04)  VALUE SPACES.    02130000
020300     05  TL1-STYLE-DESC               PIC X(18).                  02140000
020400     05  FILLER                       PIC X(01)  VALUE SPACES.    02150000
020500     05  TL1-NBR-OF-STYLES            PIC ZZZZ.                   02160000
020600     05  FILLER                       PIC X(07)  VALUE SPACES.    02170000
020700     05  TL1-TOTAL-DESC               PIC X(20).                  02180000
020800     05  FILLER                       PIC X(05)  VALUE SPACES.    02190000
020900     05  TL1-TOT-SKUS                 PIC Z,ZZZ,ZZ9.              02200000
021000     05  FILLER                       PIC X(01)  VALUE SPACES.    02210000
021100     05  TL1-AVG-OH                   PIC ZZZZ9.9-.               02220000
021200     05  TL1-AVG-OO                   PIC ZZZZ9.9-.               02230000
021300     05  TL1-CSTOCK                   PIC ZZZZZZ9.                02240000
021400     05  FILLER                       PIC X(02)  VALUE SPACES.    02250000
021500     05  TL1-SVC-LEVEL                PIC ZZ9.                    02260000
021600     05  FILLER                       PIC X(01)  VALUE SPACES.    02270000
021700     05  TL1-SKUS-BELOW               PIC Z,ZZZ,ZZ9.              02280000
021800     05  FILLER                       PIC X(01)  VALUE SPACES.    02290000
021900     05  TL1-STORES-BELOW             PIC ZZZZ,ZZ9.               02300000
022000     05  FILLER                       PIC X(03)  VALUE SPACES.    02310000
022100     05  TL1-AVG-OSTRAT               PIC ZZ9.9.                  02320000
022200     05  FILLER                       PIC X(01)  VALUE SPACES.    02330000
022300     05  TL1-LEAD-TIME                PIC ZZ9.                    02340000
022400*                                                                 02350000
022500 01  TOTAL-LINE-2.                                                02360000
022600     05  FILLER                       PIC X(02)  VALUE SPACES.    02370000
022700     05  TL2-CLASS                    PIC X(02).                  02380000
022800     05  FILLER                       PIC X(34)  VALUE SPACES.    02390000
022900     05  TL2-TOTAL-DESC               PIC X(20).                  02400000
023000     05  FILLER                       PIC X(05)  VALUE SPACES.    02410000
023100     05  TL2-TOT-SKUS                 PIC Z,ZZZ,ZZ9.              02420000
023200     05  FILLER                       PIC X(26)  VALUE SPACES.    02430000
023300     05  TL2-SVC-LEVEL                PIC ZZ9.                    02440000
023400     05  FILLER                       PIC X(01)  VALUE SPACES.    02450000
023500     05  TL2-SKUS-BELOW               PIC Z,ZZZ,ZZ9.              02460000
023600     05  FILLER                       PIC X(01)  VALUE SPACES.    02470000
023700     05  TL2-STORES-BELOW             PIC ZZZZ,ZZ9.               02480000
023800     05  FILLER                       PIC X(12)  VALUE SPACES.    02490000
023900*                                                                 02500000
024000 01  DASHED-LINE.                                                 02510000
024100     05  FILLER                       PIC X(65)  VALUE SPACES.    02520000
024200     05  FILLER                       PIC X(50)  VALUE            02530000
024300         '--------------------------------------------------'.    02540000
024400     05  FILLER                       PIC X(06)  VALUE            02550000
024500         '------'.                                                02560000
024600     05  FILLER                       PIC X(11)  VALUE SPACES.    02570000
024700*                                                                 02580000
024800 01  BLANK-LINE.                                                  02590000
024900     05  FILLER                       PIC X(132) VALUE SPACES.    02600000
025000*                                                                 02610000
025100 01  END-OF-REPORT-LINE.                                          02620000
025200     05  FILLER                       PIC X(25)      VALUE        02630000
025300         ' ** END OF REPORT **     '.                             02640000
025400*                                                                 02650000
025500*                                                                 02660000
025600 01  PROGRAM-SWITCHES.                                            02670000
025700     05  PS-EOF-CONTROL-FILE         PIC  X(01)    VALUE 'N'.     02680000
025800         88  EOF-CONTROL-FILE                      VALUE 'Y'.     02690000
025900     05  PS-EOF-BG-DEPT-CURSOR       PIC  X(01)    VALUE 'N'.     02700000
026000         88  EOF-BG-DEPT-CURSOR                    VALUE 'Y'.     02710000
026100     05  PS-EOF-ITEM-CURSOR          PIC  X(01)    VALUE 'N'.     02720000
026200         88  EOF-ITEM-CURSOR                       VALUE 'Y'.     02730000
026300         88  NOT-EOF-ITEM-CURSOR                   VALUE 'N'.     02740000
026400     05  PS-EOF-STORE-CURSOR         PIC  X(01)    VALUE 'N'.     02750000
026500         88  EOF-STORE-CURSOR                      VALUE 'Y'.     02760000
026600         88  NOT-EOF-STORE-CURSOR                  VALUE 'N'.     02770000
026700     05  PS-ITEMS-FOUND-FOR-DEPT     PIC  X(01)    VALUE 'N'.     02780000
026800         88  ITEMS-FOUND-FOR-DEPT                  VALUE 'Y'.     02790000
026900         88  ITEMS-NOT-FOUND-FOR-DEPT              VALUE 'N'.     02800000
027000     05  PS-ITEMS-FOUND-FOR-BG       PIC  X(01)    VALUE 'N'.     02810000
027100         88  ITEMS-FOUND-FOR-BG                    VALUE 'Y'.     02820000
027200         88  ITEMS-NOT-FOUND-FOR-BG                VALUE 'N'.     02830000
027300     05  PS-END-OF-ITEM-STORES       PIC  X(01)    VALUE 'N'.     02840000
027400         88  END-OF-ITEM-STORES                    VALUE 'Y'.     02850000
027500         88  NOT-END-OF-ITEM-STORES                VALUE 'N'.     02860000
027600     05  PS-OH-FILE-EMPTY            PIC  X(01)    VALUE 'N'.     02870000
027700         88  OH-FILE-EMPTY                         VALUE 'Y'.     02880000
027800         88  OH-FILE-NOT-EMPTY                     VALUE 'N'.     02890000
027900     05  PS-STYLE-COLOR-CHANGE       PIC  X(01)    VALUE 'N'.     02900000
028000         88  STYLE-COLOR-CHANGE                    VALUE 'Y'.     02910000
028100     05  PS-ITEM-NBR-CHANGE          PIC  X(01)    VALUE 'N'.     02920000
028200         88  ITEM-NBR-CHANGE                       VALUE 'Y'.     02930000
028300     05  PS-PRINT-DETAIL-FOR-DEPT    PIC  X(01)    VALUE 'N'.     02940000
028400         88  PRINT-DETAIL-FOR-DEPT                 VALUE 'Y'.     02950000
028500         88  NO-DETAIL-FOR-DEPT                    VALUE 'N'.     02960000
028600*                                                                 02970000
028700 01  ABEND-CODE                       PIC S9(04)     VALUE +0     02980000
028800                                                     COMP SYNC.   02990000
028900     88  ABEND-4013                                  VALUE +4013. 03000000
029000*                                                                 03010000
029100 01  PC-CONSTANTS.                                                03020000
029200     05  PC-SKU-SVC-LEVEL-LIMIT      PIC 9(03).                   03030000
029300     05  PC-STORE-SVC-LEVEL-LIMIT    PIC 9(03).                   03040000
029400     05  PC-STORE-TABLE-MAX          PIC S9(4)  VALUE +9999       03050016
029500                                                COMP-3.           03060000
029600     05  PC-DEPT-TABLE-MAX           PIC S9(3)  VALUE +200        03070000
029700                                                COMP-3.           03080000
029800     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     03090000
029900                                                   COMP SYNC.     03100000
030000     05  PC-NOT-REF-INTEGRAL         PIC S9(04)    VALUE -530     03110000
030100                                                   COMP SYNC.     03120000
030200     05  PC-MAX-RETRIES              PIC S9(03) VALUE 3 COMP-3.   03130000
030300     05  PC-MAX-LINES                PIC S9(3)     VALUE +54      03140000
030400                                                   COMP-3.        03150000
030500     05  PC-1                        PIC S9(03)    VALUE +1       03160000
030600                                                   COMP-3.        03170000
030700     05  PC-2                        PIC S9(03)    VALUE +2       03180000
030800                                                   COMP-3.        03190000
030900     05  PC-3                        PIC S9(03)    VALUE +3       03200000
031000                                                   COMP-3.        03210000
031100     05  PC-5                        PIC S9(03)    VALUE +5       03220000
031200                                                   COMP-3.        03230000
031300     05  PC-7                        PIC S9(03)    VALUE +7       03240000
031400                                                   COMP-3.        03250000
031500     05  PC-100                      PIC S9(03)    VALUE +100     03260000
031600                                                   COMP-3.        03270000
031700     05  PC-N                        PIC  X(01)    VALUE 'N'.     03280000
031800     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     03290000
031900     05  PC-MRKRP120                 PIC  X(08)    VALUE          03300000
032000                                                   'MRKRP120'.    03310000
032100     05  PC-ASTERISK                 PIC  X(01)    VALUE '*'.     03320000
032200     05  PC-STYLE-DESC               PIC  X(18)    VALUE          03330000
032300         '# OF STYLE/COLORS:'.                                    03340000
032400 EJECT                                                            03350000
032500 01  PV-ACCUMULATOR-FIELDS.                                       03360000
032600     05  PV-TOT-STORES-FOR-ITEM      PIC S9(05)    VALUE ZERO     03370000
032700                                                   COMP-3.        03380000
032800     05  PV-TOT-ITEMS-FOR-STORE      PIC S9(05)    VALUE ZERO     03390000
032900                                                   COMP-3.        03400000
033000     05  PV-TOTAL-STORES             PIC S9(05)    VALUE ZERO     03410000
033100                                                   COMP-3.        03420000
033200     05  PV-TOTAL-SKUS               PIC S9(05)    VALUE ZERO     03430000
033300                                                   COMP-3.        03440000
033400     05  PV-NBR-ZERO-ONHAND          PIC S9(05)    VALUE ZERO     03480027
033500                                                   COMP-3.        03490027
033600     05  PV-NBR-INSTOCK              PIC S9(05)    VALUE ZERO     03510000
033700                                                   COMP-3.        03520000
033800     05  PV-INSTOCKS-STYLE           PIC S9(07)    VALUE ZERO     03530000
033900                                                   COMP-3.        03540000
034000     05  PV-SKU-STORE-COMBOS         PIC S9(07)    VALUE ZERO     03550000
034100                                                   COMP-3.        03560000
034200     05  PV-SKUS-BELOW               PIC S9(05)    VALUE ZERO     03570000
034300                                                   COMP-3.        03580000
034400     05  PV-STORES-BELOW             PIC S9(05)    VALUE ZERO     03590000
034500                                                   COMP-3.        03600000
034600     05  PV-SC-INSTOCKS              PIC S9(07)    VALUE ZERO     03610000
034700                                                   COMP-3.        03620000
034800     05  PV-SC-COMBOS                PIC S9(07)    VALUE ZERO     03630000
034900                                                   COMP-3.        03640000
035000     05  PV-SC-TOTAL-SKUS            PIC S9(07)    VALUE ZERO     03650000
035100                                                   COMP-3.        03660000
035200     05  PV-SC-SKUS-BELOW            PIC S9(07)    VALUE ZERO     03670000
035300                                                   COMP-3.        03680000
035400     05  PV-SC-STORES-BELOW          PIC S9(07)    VALUE ZERO     03690000
035500                                                   COMP-3.        03700000
035600     05  PV-MC-INSTOCKS              PIC S9(07)    VALUE ZERO     03710000
035700                                                   COMP-3.        03720000
035800     05  PV-MC-COMBOS                PIC S9(07)    VALUE ZERO     03730000
035900                                                   COMP-3.        03740000
036000     05  PV-MC-TOTAL-SKUS            PIC S9(07)    VALUE ZERO     03750000
036100                                                   COMP-3.        03760000
036200     05  PV-MC-SKUS-BELOW            PIC S9(07)    VALUE ZERO     03770000
036300                                                   COMP-3.        03780000
036400     05  PV-MC-STORES-BELOW          PIC S9(07)    VALUE ZERO     03790000
036500                                                   COMP-3.        03800000
036600     05  PV-DP-INSTOCKS              PIC S9(07)    VALUE ZERO     03810000
036700                                                   COMP-3.        03820000
036800     05  PV-DP-COMBOS                PIC S9(07)    VALUE ZERO     03830000
036900                                                   COMP-3.        03840000
037000     05  PV-DP-TOTAL-SKUS            PIC S9(07)    VALUE ZERO     03850000
037100                                                   COMP-3.        03860000
037200     05  PV-DP-SKUS-BELOW            PIC S9(07)    VALUE ZERO     03870000
037300                                                   COMP-3.        03880000
037400     05  PV-DP-STORES-BELOW          PIC S9(07)    VALUE ZERO     03890000
037500                                                   COMP-3.        03900000
037600     05  PV-BG-INSTOCKS              PIC S9(07)    VALUE ZERO     03910000
037700                                                   COMP-3.        03920000
037800     05  PV-BG-COMBOS                PIC S9(07)    VALUE ZERO     03930000
037900                                                   COMP-3.        03940000
038000     05  PV-BG-TOTAL-SKUS            PIC S9(07)    VALUE ZERO     03950000
038100                                                   COMP-3.        03960000
038200     05  PV-BG-SKUS-BELOW            PIC S9(07)    VALUE ZERO     03970000
038300                                                   COMP-3.        03980000
038400     05  PV-BG-STORES-BELOW          PIC S9(07)    VALUE ZERO     03990000
038500                                                   COMP-3.        04000000
038600     05  PV-NBR-OF-STYLES            PIC S9(05)    VALUE ZERO     04010000
038700                                                   COMP-3.        04020000
038800*                                                                 04030000
038900 01  PV-MISC-FIELDS.                                              04040000
039000     05  PV-DP-SUB                   PIC S9(04)  VALUE +0         04050000
039100                                                 COMP SYNC.       04060000
039200     05  PV-SQL-SUB                  PIC S9(04)  VALUE +0         04070000
039300                                                 COMP SYNC.       04080000
039400     05  PV-ST-SUB                   PIC S9(05)  COMP SYNC.       04090016
039800     05  PV-MDSEBG-NBR               PIC X(03)     VALUE SPACES.  04100000
039900     05  PV-DEPT-NBR                 PIC X(03)     VALUE SPACES.  04110000
040000     05  PV-CLASS                    PIC X(02).                   04120000
040100     05  FILLER REDEFINES PV-CLASS.                               04130000
040200         10  PV-MAJOR-CLASS          PIC X.                       04140000
040300         10  PV-SUB-CLASS            PIC X.                       04150000
040400     05  PV-XREF-CLASS.                                           04160000
040500         10  PV-XREF-MAJOR-CLASS     PIC X.                       04170000
040600         10  PV-XREF-SUB-CLASS       PIC X.                       04180000
040700     05  PV-ITEM-NBR                 PIC S9(15)V   VALUE ZERO     04190000
040800                                                   COMP-3.        04200000
040900     05  PV-VENDOR-STYLE             PIC X(20).                   04210000
041000     05  PV-COLOR-DESC               PIC X(20).                   04220000
041100     05  PV-ITEM-DESC                PIC X(25).                   04230000
041200     05  PV-FIRST-STORE-COUNT        PIC S9(05)    VALUE ZERO     04240000
041300                                                   COMP-3.        04250000
041400     05  PV-HOLD-SVC-LVL             PIC S9(04)V9(03) VALUE ZERO  04260000
041500                                                   COMP-3.        04270000
041600     05  PV-SVC-LEVEL-PCT            PIC S9(03)    VALUE ZERO     04280000
041700                                                   COMP-3.        04290000
041800     05  PV-AVG-OSTRAT               PIC S9(04)V9  VALUE ZERO     04300000
041900                                                   COMP-3.        04310000
042000     05  PV-TOTAL-CSTOCK             PIC S9(13)    VALUE ZERO     04320000
042100                                                   COMP-3.        04330000
042200     05  PV-NULL-IND-OSTRAT          PIC S9(04)    COMP.          04340000
042300     05  PV-NULL-IND-CSTOCK          PIC S9(04)    COMP.          04350000
042400     05  PV-NULL-IND-ONHAND          PIC S9(04)    COMP.          04360000
042500     05  PV-NULL-IND-ONORDER         PIC S9(04)    COMP.          04370000
042600     05  PV-AVG-ONHAND               PIC S9(06)V9  VALUE ZERO     04380000
042700                                                   COMP-3.        04390000
042800     05  PV-SUM-ONORDER              PIC S9(09)    VALUE ZERO     04400000
042900                                                   COMP-3.        04410000
043000     05  PV-AVG-ONORDER              PIC S9(09)V9  VALUE ZERO     04420000
043100                                                   COMP-3.        04430000
043200     05  PV-HOLD-AVG-OO              PIC S9(09)V9(04) VALUE ZERO  04440000
043300                                                   COMP-3.        04450000
043400     05  PV-LEAD-TIME                PIC S9(03)    VALUE ZERO     04460000
043500                                                   COMP-3.        04470000
043600     05  PV-PAGE-CNT                 PIC S9(5)     VALUE +0       04480000
043700                                                   COMP-3.        04490000
043800     05  PV-LINE-CNT                 PIC S9(3)     VALUE +0       04500000
043900                                                   COMP-3.        04510000
044000     05  PV-PARAGRAPH-NAME           PIC X(30)     VALUE SPACES.  04520000
044100     05  PV-DB2-OPER-ATTEMPTED       PIC X(30)     VALUE SPACES.  04530000
044200     05  PV-VSAM-STATUS              PIC X(02)     VALUE SPACE.   04540000
044300         88  PV-VSAM-SUCCESSFUL                    VALUE '00'.    04550000
044400         88  PV-VSAM-NOT-FOUND                     VALUE '23'.    04560000
044500         88  PV-VSAM-EMPTY                         VALUE '35'.    04570000
044600     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     04580000
044700                                                   COMP SYNC.     04590000
044800     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  04600000
044900*                                                                 04610000
045000 01  CD-CPU-DATE                      PIC 9(08).                  04620000
045100 01  FILLER REDEFINES CD-CPU-DATE.                                04630000
045200     05  CD-CPU-YEAR                  PIC 9(04).                  04640000
045300     05  FILLER REDEFINES CD-CPU-YEAR.                            04650000
045400         10  CD-CPU-CC                PIC 9(02).                  04660000
045500         10  CD-CPU-YR                PIC 9(02).                  04670000
045600     05  CD-CPU-MO                    PIC 9(02).                  04680000
045700     05  CD-CPU-DY                    PIC 9(02).                  04690000
045800                                                                  04700000
045900 01  CT-CPU-TIME.                                                 04710000
046000     05  CT-CPU-HR                    PIC 9(02)     VALUE ZEROS.  04720000
046100     05  CT-CPU-MIN                   PIC 9(02)     VALUE ZEROS.  04730000
046200     05  CT-CPU-SEC                   PIC 9(02)     VALUE ZEROS.  04740000
046300     05  CT-CPU-HSEC                  PIC 9(02)     VALUE ZEROS.  04750000
046400                                                                  04760000
046500******************************************************************04770000
046600*    NI SKU WORK AREA FIELDS                                      04780000
046700******************************************************************04790000
046800     COPY ISWS006.                                                04800000
046900******************************************************************04810000
047000 EJECT                                                            04820000
047100*                                                                 04830000
047200***********************                                           04840000
047300*  DB2 TABLE LAYOUTS  *                                           04850000
047400***********************                                           04860000
047500*                                                                 04870000
047600     EXEC SQL                                                     04880000
047700         INCLUDE TSKXREF                                          04890000
047800     END-EXEC.                                                    04900000
047900*                                                                 04910000
048000     EXEC SQL                                                     04920000
048100         INCLUDE TMDSEAR                                          04930000
048200     END-EXEC.                                                    04940000
048300*                                                                 04950000
048400     EXEC SQL                                                     04960000
048500         INCLUDE TMDSEDP                                          04970000
048600     END-EXEC.                                                    04980000
048700*                                                                 04990000
048800     EXEC SQL                                                     05000000
048900         INCLUDE TMDSEBG                                          05010000
049000     END-EXEC.                                                    05020000
049100*                                                                 05030000
049200     EXEC SQL                                                     05040000
049300         INCLUDE TRSPBAR                                          05050000
049400     END-EXEC.                                                    05060000
049500*                                                                 05070000
049600     EXEC SQL                                                     05080000
049700         INCLUDE TSK                                              05090000
049800     END-EXEC.                                                    05100000
049900*                                                                 05110000
050000     EXEC SQL                                                     05120000
050100         INCLUDE TSKST                                            05130000
050200     END-EXEC.                                                    05140000
050300*                                                                 05150000
050400     EXEC SQL                                                     05160000
050500         INCLUDE XMT00001                                         05170017
050600     END-EXEC.                                                    05180000
050700*                                                                 05190000
050800     EXEC SQL                                                     05200000
050900         INCLUDE TMRITST                                          05210000
051000     END-EXEC.                                                    05220000
051100*                                                                 05230000
051200     EXEC SQL                                                     05240000
051300         INCLUDE TMRITEM                                          05250000
051400     END-EXEC.                                                    05260000
051500*                                                                 05270000
051600     EXEC SQL                                                     05280000
051700         INCLUDE TSKSTOO                                          05290000
051800     END-EXEC.                                                    05300000
051900 EJECT                                                            05310000
052000*                                                                 05320000
052100* DB2 COMMUNICATION AREA                                          05330000
052200*                                                                 05340000
052300     EXEC SQL                                                     05350000
052400         INCLUDE SQLCA                                            05360000
052500     END-EXEC.                                                    05370000
052600*                                                                 05380000
052700* DB2 COMMUNICATION AREA2                                         05390000
052800*                                                                 05400000
052900     COPY SQLCA2.                                                 05410000
053000 EJECT                                                            05420000
053100*                                                                 05430000
053200* CURSOR FOR BUSINESS GROUP, DEPARTMENT SELECTION                 05440000
053300*                                                                 05450000
053400     EXEC SQL                                                     05460000
053500       DECLARE BG_DEPT_CSR CURSOR FOR                             05470000
053600       SELECT                                                     05480000
053700             C.MDSEBG_NBR,                                        05490000
053800             C.MDSEBG_DESC,                                       05500000
053900             A.DEPT_NBR,                                          05510000
054000             A.BYR_NBR,                                           05520000
054100             A.MDSEAR_DKEY                                        05530000
054200        FROM TMDSEAR A,                                           05540000
054300             TMDSEDP B,                                           05550000
054400             TMDSEBG C                                            05560020
054500       WHERE A.MDSELV_CDE  = 'DPT'                                05570000
054600         AND A.OPERCO_NBR  = '03'                                 05580000
054700         AND CURRENT DATE BETWEEN A.STRT_DTE AND A.END_DTE        05590000
054800         AND A.MDSEAR_DKEY = B.MDSEAR_DKEY                        05600000
054900         AND B.MDSEBG_NBR  = C.MDSEBG_NBR                         05610000
055000       ORDER BY C.MDSEBG_NBR,                                     05620000
055100                A.DEPT_NBR                                        05630000
055200       FOR FETCH ONLY                                             05640000
055300     END-EXEC.                                                    05650000
055400*                                                                 05660000
055500* CURSOR FOR CLASS, STYLE, COLOR, ITEM SELECTION                  05670000
055600*                                                                 05680000
055700     EXEC SQL                                                     05690000
055800       DECLARE ITEM_CSR CURSOR FOR                                05700000
055900       SELECT E.DEPT,                                             05710000
056000              E.SUBCLASS,                                         05720000
056100              A.LONG_VENDOR_STYLE,                                05730000
056200              A.LONG_COLOR_DESC,                                  05740000
056300              A.ITEM_NMBR,                                        05750000
056400              A.SKU_DESC,                                         05760000
056500              B.LT_QTY                                            05770000
056600         FROM TSK     A,                                          05780000
056700              TMRITEM B,                                          05790000
056800              TMRITST C,                                          05800000
056900              XMT_LOC D,                                          05810016
057000              TSKXREF E                                           05820000
057120        WHERE E.DEPT      = :SKXREF-DEPT                          05830000
057200          AND A.ITEM_NMBR = B.ITEM_NBR                            05840000
057300          AND A.ITEM_NMBR = C.ITEM_NBR                            05850000
057400          AND A.ITEM_NMBR = E.ITM_NBR                             05860000
057500          AND C.STR_NBR   = D.LOC_NBR                             05870016
057600          AND C.FT_CDE    = 'O'                                   05880000
057700          AND D.E_BUS_IND = 'Y'                                   05890016
057800          AND D.LOC_TYP_CDE   = 'DS'                              05900016
057900        GROUP BY E.DEPT,                                          05910000
058000                 E.SUBCLASS,                                      05920000
058100                 A.LONG_VENDOR_STYLE,                             05930000
058200                 A.LONG_COLOR_DESC,                               05940000
058300                 A.ITEM_NMBR,                                     05950000
058400                 A.SKU_DESC,                                      05960000
058500                 B.LT_QTY                                         05970000
058600        ORDER BY E.DEPT,                                          05980000
058700                 E.SUBCLASS,                                      05990000
058800                 A.LONG_VENDOR_STYLE,                             06000000
058900                 A.LONG_COLOR_DESC                                06010000
059000        FOR FETCH ONLY                                            06020000
059100     END-EXEC.                                                    06030000
059200*                                                                 06040000
059300* CURSOR FOR STORE SELECTION                                      06050000
059400*                                                                 06060000
059500     EXEC SQL                                                     06070000
059600       DECLARE STORE_CSR CURSOR FOR                               06080000
059700       SELECT LOC_NBR                                             06090016
059800         FROM XMT_LOC                                             06100016
059900        WHERE E_BUS_IND = 'Y'                                     06110016
060000          AND LOC_TYP_CDE = 'DS'                                  06120019
060100        FOR FETCH ONLY                                            06130000
060200     END-EXEC.                                                    06140000
060300*                                                                 06150000
060400*---------------------------------------------------------------* 06160000
060500*   ERROR MESSAGE AREA FOR DB2                                    06170000
060600*---------------------------------------------------------------* 06180000
060700     COPY DPWS004.                                                06190000
060800*                                                                 06200000
060900 EJECT                                                            06210000
061000*                                                                 06220000
061100**************************************************************    06230000
061200*                                                                 06240000
061300*  TABLE FOR HOLDING DEPARTMENTS THAT WILL HAVE NO DETAIL         06250000
061400*  LINES ON REPORT (SUBCLASS WILL BE LOWEST LEVEL).               06260000
061500*                                                                 06270000
061600**************************************************************    06280000
061700*                                                                 06290000
061800 01  DP-DEPT-TABLE.                                               06300000
061900     05  DP-DEPT-ENTRIES OCCURS 200 TIMES                         06310000
062000                         INDEXED BY DP-INDEX.                     06320000
062100         10  DP-DEPT-NBR              PIC X(03).                  06330000
062200*                                                                 06340000
062300***************************************************************   06350000
062400*                                                                 06360000
062500*  TABLE FOR STORING NUMBER OF ITEMS THAT HAD ONHAND < CSTOCK FOR 06370000
062600*  EACH STORE.  ACCESSED BY USING STORE NUMBER AS SUBSCRIPT.      06380000
062700*  VALID STORES ARE IDENTIFIED BY A 'Y' IN THE VALID-STORE-FLAG   06390000
062800*  FIELD.                                                         06400000
062900*                                                                 06410000
063000***************************************************************   06420000
063100*                                                                 06430000
063200 01  ST-STORE-TABLE.                                              06440000
063300     05  ST-STORE-ENTRIES OCCURS 9999 TIMES.                      06450016
063400         10  ST-VALID-STORE-FLAG      PIC X(01).                  06460000
063500         10  ST-ZERO-ONHAND-ITEMS     PIC S9(05)  COMP-3.         06470027
063600*                                                                 06480000
063700 EJECT                                                            06490000
063800*                                                                 06500000
063900 LINKAGE SECTION.                                                 06510000
064000***************************************************************** 06520000
064100*PROCEDURE DIVISION.                                              06530000
064200***************************************************************** 06540000
064300 PROCEDURE DIVISION.                                              06550000
064400*                                                                 06560000
064500 A100-MAINLINE-PROCESSING.                                        06570000
064600*                                                                 06580000
064700     PERFORM B100-INITIALIZATION.                                 06590000
064800                                                                  06600000
064900     PERFORM B200-PROCESS-BG-DEPT-CURSOR                          06610000
065000             UNTIL EOF-BG-DEPT-CURSOR.                            06620000
065100*                                                                 06630000
065200     PERFORM B300-END-ROUTINE.                                    06640000
065300                                                                  06650000
065400     GOBACK.                                                      06660000
065500*                                                                 06670000
065600 EJECT                                                            06680000
065700***************************************************************** 06690000
065800*                                                                 06700000
065900*  LOAD STORE NUMBERS INTO STORE TABLE; READ CONTROL CARDS AND    06710000
066000*  PUT DEPARTMENT NUMBERS INTO TABLE                              06720000
066100*                                                                 06730000
066200***************************************************************** 06740000
066300 B100-INITIALIZATION.                                             06750000
066400*                                                                 06760000
066500     ACCEPT CT-CPU-TIME FROM TIME.                                06770000
066600     ACCEPT CD-CPU-DATE FROM DATE.                                06780000
066700                                                                  06790000
066800     MOVE CT-CPU-HR     TO DP132-RUN-HOUR.                        06800000
066900     MOVE CT-CPU-MIN    TO DP132-RUN-MINUTE.                      06810000
067000     MOVE CD-CPU-MO     TO DP132-RUN-MONTH.                       06820000
067100     MOVE CD-CPU-DY     TO DP132-RUN-DAY.                         06830000
067200     IF CD-CPU-YR > 80                                            06840000
067300        MOVE 19 TO CD-CPU-CC                                      06850000
067400     ELSE                                                         06860000
067500        MOVE 20 TO CD-CPU-CC.                                     06870000
067600     MOVE CD-CPU-YEAR   TO DP132-RUN-YEAR.                        06880000
067700                                                                  06890000
067800     MOVE 1           TO DP132-REPORT-NUMBER                      06900000
067900                         DP132-PAGE-NUMBER.                       06910000
068000     MOVE PC-MRKRP120 TO DP132-PROGRAM-NAME.                      06920000
068100*                                                                 06930000
068200     INITIALIZE DP-DEPT-TABLE                                     06940000
068300                ST-STORE-TABLE.                                   06950000
068400*                                                                 06960000
068500     SET NOT-EOF-STORE-CURSOR TO TRUE.                            06970000
068600     PERFORM X300-OPEN-STORE-CURSOR.                              06980000
068700*                                                                 06990000
068800     PERFORM C500-LOAD-STORE-TABLE                                07000000
068900         UNTIL EOF-STORE-CURSOR.                                  07010000
069000*                                                                 07020000
069100     PERFORM Y300-CLOSE-STORE-CURSOR.                             07030000
069200*                                                                 07040000
069300     PERFORM X700-OPEN-FILES.                                     07050000
069400*                                                                 07060000
069500     PERFORM Z100-READ-CONTROL-FILE                               07070000
069600         VARYING PV-DP-SUB FROM 1 BY 1                            07080000
069700         UNTIL EOF-CONTROL-FILE OR                                07090000
069800               (PV-DP-SUB > PC-DEPT-TABLE-MAX).                   07100000
069900*                                                                 07110000
070000     PERFORM X100-OPEN-BG-DEPT-CURSOR.                            07120000
070100*                                                                 07130000
070200***************************************************************** 07140000
070300*                                                                 07150000
070400*  FETCH BUSINESS GROUP/DEPT. CURSOR; CHECK FOR DEPT. BREAK AND   07160000
070500*  BUSINESS GROUP BREAK; PROCESS ALL ITEMS FOR THE DEPT.          07170000
070600*                                                                 07180000
070700***************************************************************** 07190000
070800 B200-PROCESS-BG-DEPT-CURSOR.                                     07200000
070900     PERFORM C100-FETCH-BG-DEPT-CSR                               07210000
071000*                                                                 07220000
071100     IF EOF-BG-DEPT-CURSOR                                        07230000
071200        PERFORM Y100-CLOSE-BG-DEPT-CURSOR                         07240000
071300        PERFORM C200-DEPT-BREAK                                   07250000
071400        PERFORM C300-BUSINESS-GROUP-BREAK                         07260000
071500     ELSE                                                         07270000
071600        PERFORM C200-DEPT-BREAK                                   07280000
071700                                                                  07290000
071800*       IF MDSEBG-NBR NOT = PV-MDSEBG-NBR                         07300042
071800        IF MDSEBG-MDSEBG-NBR NOT = PV-MDSEBG-NBR                  07301042
071900           PERFORM C300-BUSINESS-GROUP-BREAK                      07310000
072000        END-IF                                                    07320000
072100                                                                  07330000
072200        MOVE MDSEAR-DEPT-NBR TO PV-DEPT-NBR                       07340000
072300        MOVE PV-DEPT-NBR     TO NI-DEPT-X-3                       07350000
072400        MOVE NI-DEPT-9-3     TO SKXREF-DEPT                       07360000
072500                                                                  07370000
072600        SET NOT-EOF-ITEM-CURSOR TO TRUE                           07380000
072700        PERFORM X200-OPEN-ITEM-CURSOR                             07390000
072800                                                                  07400000
072900        PERFORM C400-PROCESS-ITEM-CURSOR                          07410000
073000            UNTIL EOF-ITEM-CURSOR                                 07420000
073100     END-IF.                                                      07430000
073200*                                                                 07440000
073300*                                                                 07450000
073400***************************************************************** 07460000
073500 B300-END-ROUTINE.                                                07470000
073600*                                                                 07480000
073700     WRITE PRINT-LINE FROM END-OF-REPORT-LINE                     07490000
073800         AFTER ADVANCING PC-2.                                    07500000
073900*                                                                 07510000
074000     PERFORM Y700-CLOSE-FILES.                                    07520000
074100*                                                                 07530000
074200*                                                                 07540000
074300***************************************************************** 07550000
074400 C100-FETCH-BG-DEPT-CSR.                                          07560000
074500     MOVE 'C100-FETCH-BG-DEPT-CSR'  TO PV-PARAGRAPH-NAME.         07570000
074600     MOVE 'BG CURSOR FETCH '        TO PV-DB2-OPER-ATTEMPTED.     07580000
074700     PERFORM                                                      07590000
074800         WITH TEST AFTER                                          07600000
074900         VARYING PV-SQL-SUB                                       07610000
075000         FROM 1 BY 1                                              07620000
075100         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        07630000
075200            OR SQLCODE = ZERO                                     07640000
075300            OR SQLCODE = +100                                     07650000
075400                                                                  07660000
075500         EXEC SQL                                                 07670000
075600             FETCH BG_DEPT_CSR                                    07680000
075700              INTO :MDSEBG-MDSEBG-NBR,                            07690042
075700*             INTO :MDSEBG-NBR,                                   07691042
075800                   :MDSEBG-MDSEBG-DESC,                           07700042
075800*                  :MDSEBG-DESC,                                  07701042
075900                   :MDSEAR-DEPT-NBR,                              07710000
076000                   :MDSEAR-BYR-NBR,                               07720000
076100                   :MDSEAR-DKEY                                   07730000
076200         END-EXEC                                                 07740000
076300         EVALUATE TRUE                                            07750000
076400             WHEN SQLCODE = ZERO                                  07760000
076500             WHEN SQLCODE = -904                                  07770000
076600             WHEN SQLCODE = -913                                  07780000
076700                 CONTINUE                                         07790000
076800             WHEN SQLCODE = +100                                  07800000
076900                 SET EOF-BG-DEPT-CURSOR TO TRUE                   07810000
077000             WHEN SQLWARN0 NOT = SPACES                           07820000
077100             WHEN SQLCODE  NOT = ZERO                             07830000
077200                  PERFORM Z999-SQL-ABEND                          07840000
077300         END-EVALUATE                                             07850000
077400     END-PERFORM.                                                 07860000
077500*                                                                 07870000
077600     IF PV-SQL-SUB > PC-MAX-RETRIES                               07880000
077700        MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'              07890000
077800                                   TO PV-DB2-OPER-ATTEMPTED       07900000
077900        PERFORM Z999-SQL-ABEND                                    07910000
078000     END-IF.                                                      07920000
078100*                                                                 07930000
078200 EJECT                                                            07940000
078300***************************************************************** 07950000
078400*                                                                 07960000
078500*  IF THERE WERE INFOREM E-COMMERCE ITEMS FOUND FOR THIS          07970000
078600*  DEPARTMENT, PRINT DEPT. TOTALS                                 07980000
078700*                                                                 07990000
078800***************************************************************** 08000000
078900 C200-DEPT-BREAK.                                                 08010000
079000*                                                                 08020000
079100     IF ITEMS-FOUND-FOR-DEPT                                      08030000
079200        SET ITEMS-FOUND-FOR-BG                                    08040000
079300            ITEMS-NOT-FOUND-FOR-DEPT TO TRUE                      08050000
079400                                                                  08060000
079500        IF PV-DP-COMBOS > ZERO                                    08070000
079600           COMPUTE PV-HOLD-SVC-LVL =                              08080000
079700                    (PV-DP-INSTOCKS / PV-DP-COMBOS) * 100         08090000
079800           COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL     08100000
079900        ELSE                                                      08110000
080000           MOVE ZERO TO PV-SVC-LEVEL-PCT                          08120000
080100        END-IF                                                    08130000
080200*                                                                 08140000
080300        MOVE SPACES             TO TL2-CLASS                      08150000
080400        MOVE 'DEPARTMENT TOTAL' TO TL2-TOTAL-DESC                 08160000
080500        MOVE PV-DP-TOTAL-SKUS   TO TL2-TOT-SKUS                   08170000
080600        MOVE PV-SVC-LEVEL-PCT   TO TL2-SVC-LEVEL                  08180000
080700        MOVE PV-DP-SKUS-BELOW   TO TL2-SKUS-BELOW                 08190000
080800        MOVE PV-DP-STORES-BELOW TO TL2-STORES-BELOW               08200000
080900        PERFORM T300-PRINT-DEPT-TOTALS                            08210000
081000*                                                                 08220000
081100        ADD PV-DP-INSTOCKS     TO PV-BG-INSTOCKS                  08230000
081200        ADD PV-DP-COMBOS       TO PV-BG-COMBOS                    08240000
081300        ADD PV-DP-TOTAL-SKUS   TO PV-BG-TOTAL-SKUS                08250000
081400        ADD PV-DP-SKUS-BELOW   TO PV-BG-SKUS-BELOW                08260000
081500        ADD PV-DP-STORES-BELOW TO PV-BG-STORES-BELOW              08270000
081600*                                                                 08280000
081700        MOVE ZERO TO PV-DP-INSTOCKS                               08290000
081800                     PV-DP-COMBOS                                 08300000
081900                     PV-DP-TOTAL-SKUS                             08310000
082000                     PV-DP-SKUS-BELOW                             08320000
082100                     PV-DP-STORES-BELOW                           08330000
082200     END-IF.                                                      08340000
082300*                                                                 08350000
082400***************************************************************** 08360000
082500*                                                                 08370000
082600*  IF THERE WERE INFOREM E-COMMERCE ITEMS FOUND FOR THIS BUSINESS 08380000
082700*  GROUP, PRINT BUSINESS GROUP TOTALS                             08390000
082800*                                                                 08400000
082900***************************************************************** 08410000
083000 C300-BUSINESS-GROUP-BREAK.                                       08420000
083100*                                                                 08430000
083200     IF ITEMS-FOUND-FOR-BG                                        08440000
083300        SET ITEMS-NOT-FOUND-FOR-BG TO TRUE                        08450000
083400                                                                  08460000
083500        IF PV-BG-COMBOS > ZERO                                    08470000
083600           COMPUTE PV-HOLD-SVC-LVL =                              08480000
083700                    (PV-BG-INSTOCKS / PV-BG-COMBOS) * 100         08490000
083800           COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL     08500000
083900        ELSE                                                      08510000
084000           MOVE ZERO TO PV-SVC-LEVEL-PCT                          08520000
084100        END-IF                                                    08530000
084200*                                                                 08540000
084300        MOVE SPACES                 TO TL2-CLASS                  08550000
084400        MOVE 'BUSINESS GROUP TOTAL' TO TL2-TOTAL-DESC             08560000
084500        MOVE PV-BG-TOTAL-SKUS       TO TL2-TOT-SKUS               08570000
084600        MOVE PV-SVC-LEVEL-PCT       TO TL2-SVC-LEVEL              08580000
084700        MOVE PV-BG-SKUS-BELOW       TO TL2-SKUS-BELOW             08590000
084800        MOVE PV-BG-STORES-BELOW     TO TL2-STORES-BELOW           08600000
084900        PERFORM T400-PRINT-BG-TOTALS                              08610000
085000*                                                                 08620000
085100        MOVE ZERO TO PV-BG-INSTOCKS                               08630000
085200                     PV-BG-COMBOS                                 08640000
085300                     PV-BG-TOTAL-SKUS                             08650000
085400                     PV-BG-SKUS-BELOW                             08660000
085500                     PV-BG-STORES-BELOW                           08670000
085600     END-IF.                                                      08680000
085700*                                                                 08690000
085800*    MOVE MDSEBG-NBR  TO PV-MDSEBG-NBR                            08700042
085800     MOVE MDSEBG-MDSEBG-NBR  TO PV-MDSEBG-NBR                     08701042
085900                         HL3-BG-NUMBER.                           08710000
086000*    MOVE MDSEBG-DESC TO HL3-BG-DESC.                             08720042
086000     MOVE MDSEBG-MDSEBG-DESC TO HL3-BG-DESC.                      08721042
086100*                                                                 08730000
086200***************************************************************** 08740000
086300*                                                                 08750000
086400*  FETCH ITEM CURSOR; IF PV-TOTAL-SKUS = 0, IT IS THE FIRST ITEM  08760000
086500*  OF A NEW DEPT. (PERFORM "NEW DEPT." ROUTINES)                  08770000
086600*                                                                 08780000
086700*  IF PV-TOTAL-SKUS > 0, CHECK FOR A STYLE/COLOR BREAK, THEN      08790000
086800*  CHECK FOR SUBCLASS & MAJOR CLASS BREAKS.                       08800000
086900*                                                                 08810000
087000*  IF PV-TOTAL-SKUS = 1, IT IS THE FIRST ITEM OF A STYLE/COLOR.   08820000
087100*  READ THE ZERO-ONHAND FILE FOR EACH E-STORE ASSOCIATED WITH     08830024
087200*  THE CURRENT ITEM, THEN CALCULATE THE ITEM'S SERVICE LEVEL.     08840024
087300*  IF BELOW THE SET LIMIT, INCREMENT COUNTER.                     08850000
087400*                                                                 08860000
087500*  FOR FIRST ITEM IN STYLE/COLOR, SAVE NUMBER OF STORES, THEN     08870000
087600*  COMPARE IT AGAINST SUBSEQUENT ITEMS;  IF DIFFERENT, MOVE * TO  08880000
087700*  REPORT LINE.                                                   08890000
087800*                                                                 08900000
087900***************************************************************** 08910000
088000 C400-PROCESS-ITEM-CURSOR.                                        08920000
088100*                                                                 08930000
088200     PERFORM D100-FETCH-ITEM-CSR                                  08940000
088300*                                                                 08950000
088400     IF EOF-ITEM-CURSOR                                           08960000
088500        PERFORM Y200-CLOSE-ITEM-CURSOR                            08970000
088600        IF ITEMS-FOUND-FOR-DEPT                                   08980000
088700           PERFORM D200-STYLE-COLOR-BREAK                         08990000
088800           PERFORM D300-SUBCLASS-BREAK                            09000000
088900           PERFORM D400-MAJOR-CLASS-BREAK                         09010000
089000        END-IF                                                    09020000
089100     ELSE                                                         09030000
089200        IF PV-TOTAL-SKUS = ZERO                                   09040000
089300           SET ITEMS-FOUND-FOR-DEPT TO TRUE                       09050000
089400           MOVE PV-DEPT-NBR    TO NI-DEPT-X-3                     09060000
089410           MOVE NI-DEPT-9-3    TO HL3-DEPT                        09070000
089500           MOVE MDSEAR-BYR-NBR TO HL2-BYR-NMBR                    09080000
089600                                                                  09090000
089700           PERFORM D600-CHECK-DEPT-TABLE                          09100000
089800           PERFORM D700-GET-BUYER-NAME                            09110000
089900           PERFORM Z400-PRINT-REPORT-HEADERS                      09120000
090000        ELSE                                                      09130000
090100           IF (TSK-LONG-VENDOR-STYLE NOT = PV-VENDOR-STYLE) OR    09140000
090200              (TSK-LONG-COLOR-DESC   NOT = PV-COLOR-DESC)         09150000
090300              PERFORM D200-STYLE-COLOR-BREAK                      09160000
090400           ELSE                                                   09170000
090500              MOVE SKXREF-SUBCLASS   TO NI-SUB-CLASS-9-2          09180000
090600              IF NI-SUB-CLASS-X-2 NOT = PV-CLASS                  09190000
090700                 PERFORM D200-STYLE-COLOR-BREAK                   09200000
090800              END-IF                                              09210000
090900           END-IF                                                 09220000
091000                                                                  09230000
091100           MOVE SKXREF-SUBCLASS      TO NI-SUB-CLASS-9-2          09240000
091200           MOVE NI-SUB-CLASS-X-2     TO PV-XREF-CLASS             09250000
091300           IF NI-SUB-CLASS-X-2     NOT = PV-CLASS                 09260000
091400              PERFORM D300-SUBCLASS-BREAK                         09270000
091500           END-IF                                                 09280000
091600           IF PV-XREF-MAJOR-CLASS NOT = PV-MAJOR-CLASS            09290000
091700              PERFORM D400-MAJOR-CLASS-BREAK                      09300000
091800           END-IF                                                 09310000
091900        END-IF                                                    09320000
092000*                                                                 09330000
092100        ADD PC-1 TO PV-TOTAL-SKUS                                 09340000
092200        IF PV-TOTAL-SKUS = PC-1                                   09350000
092300           MOVE TSK-LONG-VENDOR-STYLE TO PV-VENDOR-STYLE          09360000
092400           MOVE TSK-LONG-COLOR-DESC   TO PV-COLOR-DESC            09370000
092500           MOVE SKXREF-SUBCLASS       TO NI-SUB-CLASS-9-2         09380000
092600           MOVE NI-SUB-CLASS-X-2      TO PV-CLASS                 09390000
092700           MOVE MRITEM-LT-QTY         TO PV-LEAD-TIME             09400000
092800           MOVE TSK-SKU-DESC          TO PV-ITEM-DESC             09410000
092900        END-IF                                                    09420000
093000*                                                                 09430000
093100        MOVE TSK-ITEM-NMBR       TO PV-ITEM-NBR                   09440000
093200                                                                  09450000
093300        PERFORM D800-GET-STORE-COUNT                              09460000
093400*                                                                 09470000
093500        IF PV-TOT-STORES-FOR-ITEM > ZERO                          09480000
093600           IF OH-FILE-NOT-EMPTY                                   09490000
093700              SET NOT-END-OF-ITEM-STORES TO TRUE                  09500000
093800              MOVE PV-DEPT-NBR           TO MR119-DEPT-NBR        09510000
093900              MOVE PV-CLASS              TO MR119-CLASS-NBR       09520000
094000              MOVE PV-VENDOR-STYLE       TO MR119-VENDOR-STYLE    09530000
094100              MOVE PV-COLOR-DESC         TO MR119-COLOR-DESC      09540000
094200              MOVE PV-ITEM-NBR           TO MR119-ITEM-NBR        09550000
094300              MOVE ZERO                  TO MR119-STORE-NBR       09560000
094400              MOVE MR119-ZERO-ONHAND-KEY TO ZERO-ONHAND-KEY       09580024
094500              PERFORM Z500-START-BROWSE-OH-FILE                   09590000
094600                                                                  09600000
094700              PERFORM D500-PROCESS-ITEM-STORES                    09610000
094800                  UNTIL END-OF-ITEM-STORES                        09620000
094900           ELSE                                                   09630000
095000              SET END-OF-ITEM-STORES TO TRUE                      09640000
095100           END-IF                                                 09650000
095200                                                                  09660024
                 IF PV-NBR-ZERO-ONHAND = 0                              09741037
                   MOVE PV-TOT-STORES-FOR-ITEM TO PV-NBR-INSTOCK        09742038
095500             COMPUTE PV-HOLD-SVC-LVL =                            09743037
095600                   (PV-NBR-INSTOCK / PV-TOT-STORES-FOR-ITEM) * 10009744037
095                COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL   09745037
                 ELSE                                                   09746037
095900             MOVE ZERO TO PV-SVC-LEVEL-PCT                        09748037
096000                          PV-NBR-INSTOCK                          09749037
                 END-IF                                                 09749137
095800        ELSE                                                      09820036
095900           MOVE ZERO TO PV-SVC-LEVEL-PCT                          09830036
096000                        PV-NBR-INSTOCK                            09840036
096100        END-IF                                                    09850000
096200                                                                  09860024
096300        IF PV-SVC-LEVEL-PCT < PC-SKU-SVC-LEVEL-LIMIT              09870024
096400           ADD PC-1 TO PV-SKUS-BELOW                              09880024
096500        END-IF                                                    09890024
096600*                                                                 09900000
096700        ADD PV-NBR-INSTOCK TO PV-INSTOCKS-STYLE                   09910000
096800*                                                                 09920000
096900        IF PV-FIRST-STORE-COUNT = ZERO                            09930000
097000           MOVE PV-TOT-STORES-FOR-ITEM TO PV-FIRST-STORE-COUNT    09940000
097100        ELSE                                                      09950000
097200           IF PV-TOT-STORES-FOR-ITEM NOT = PV-FIRST-STORE-COUNT   09960000
097300              MOVE PC-ASTERISK TO DL1-ASTERISK                    09970000
097400           END-IF                                                 09980000
097500        END-IF                                                    09990000
097600                                                                  10000000
097700        MOVE ZERO TO PV-NBR-INSTOCK                               10010000
097800                     PV-TOT-STORES-FOR-ITEM                       10020000
097900                     PV-NBR-ZERO-ONHAND                           10030027
098000     END-IF.                                                      10040000
098100*                                                                 10050000
098200***************************************************************** 10060000
098300*                                                                 10070000
098400*  LOAD TABLE WITH STORES FROM XMT_LOC                            10080016
098500*                                                                 10090000
098600***************************************************************** 10100000
098700 C500-LOAD-STORE-TABLE.                                           10110000
098800*                                                                 10120000
098900     PERFORM F100-FETCH-STORE-CURSOR.                             10130000
099000                                                                  10140000
099100     IF EOF-STORE-CURSOR                                          10150000
099200        CONTINUE                                                  10160000
099300     ELSE                                                         10170000
099400        MOVE XMT00001-LOC-NBR   TO PV-ST-SUB                      10180016
099600        MOVE PC-Y TO ST-VALID-STORE-FLAG (PV-ST-SUB)              10190000
099700     END-IF.                                                      10200000
099800*                                                                 10210000
099900***************************************************************** 10220000
100000 D100-FETCH-ITEM-CSR.                                             10230000
100100     MOVE 'D100-FETCH-ITEM-CSR' TO PV-PARAGRAPH-NAME.             10240000
100200     MOVE 'ITEM CURSOR FETCH '  TO PV-DB2-OPER-ATTEMPTED.         10250000
100300     PERFORM                                                      10260000
100400         WITH TEST AFTER                                          10270000
100500         VARYING PV-SQL-SUB                                       10280000
100600         FROM 1 BY 1                                              10290000
100700         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        10300000
100800            OR SQLCODE = ZERO                                     10310000
100900            OR SQLCODE = +100                                     10320000
101000                                                                  10330000
101100         EXEC SQL                                                 10340000
101200             FETCH ITEM_CSR                                       10350000
101300              INTO :SKXREF-DEPT,                                  10360000
101400                   :SKXREF-SUBCLASS,                              10370000
101500                   :TSK-LONG-VENDOR-STYLE,                        10380000
101600                   :TSK-LONG-COLOR-DESC,                          10390000
101700                   :TSK-ITEM-NMBR,                                10400000
101800                   :TSK-SKU-DESC,                                 10410000
101900                   :MRITEM-LT-QTY                                 10420000
102000         END-EXEC                                                 10430000
102100         EVALUATE TRUE                                            10440000
102200             WHEN SQLCODE = ZERO                                  10450000
102300             WHEN SQLCODE = -904                                  10460000
102400             WHEN SQLCODE = -913                                  10470000
102500                 CONTINUE                                         10480000
102600             WHEN SQLCODE = +100                                  10490000
102700                 SET EOF-ITEM-CURSOR TO TRUE                      10500000
102800             WHEN SQLWARN0 NOT = SPACES                           10510000
102900             WHEN SQLCODE  NOT = ZERO                             10520000
103000                  PERFORM Z999-SQL-ABEND                          10530000
103100         END-EVALUATE                                             10540000
103200     END-PERFORM.                                                 10550000
103300*                                                                 10560000
103400     IF PV-SQL-SUB > PC-MAX-RETRIES                               10570000
103500        MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'              10580000
103600                                   TO PV-DB2-OPER-ATTEMPTED       10590000
103700        PERFORM Z999-SQL-ABEND                                    10600000
103800     END-IF.                                                      10610000
103900*                                                                 10620000
104000***************************************************************** 10630000
104100*                                                                 10640000
104200*  OBTAIN OSTRAT, CSTOCK, ONORDER, & ONHAND FOR THE STYLE/COLOR.  10650000
104300*  READ THROUGH THE INTERNAL STORE TABLE TO CALCULATE EACH VALID  10660000
104400*  STORE'S SERVICE LEVEL.                                         10670000
104500*  THEN CALC THE SERVICE LEVEL FOR THE STYLE/COLOR AND PRINT THE  10680000
104600*  DETAIL LINE.                                                   10690000
104700*                                                                 10700000
104800***************************************************************** 10710000
104900 D200-STYLE-COLOR-BREAK.                                          10720000
105000*                                                                 10730000
105100     MOVE ZERO TO PV-AVG-OSTRAT                                   10740000
105200                  PV-TOTAL-CSTOCK                                 10750000
105300                  PV-AVG-ONORDER                                  10760000
105400                  PV-AVG-ONHAND.                                  10770000
105500*                                                                 10780000
105600     PERFORM E200-GET-OSTRAT-QTY.                                 10790000
105700*                                                                 10800000
105800     IF PRINT-DETAIL-FOR-DEPT                                     10810000
105900        PERFORM E300-GET-ONORDER-QTY                              10820000
106000        PERFORM E600-GET-ONHAND-QTY                               10830000
106100     END-IF                                                       10840000
106200*                                                                 10850000
106300     PERFORM E400-CALC-STORE-SVC-LEVELS                           10860000
106400         VARYING PV-ST-SUB FROM 1 BY 1                            10870000
106500         UNTIL PV-ST-SUB GREATER THAN PC-STORE-TABLE-MAX.         10880000
106600*                                                                 10890000
106700     IF PV-SKU-STORE-COMBOS > ZERO                                10900000
106800        COMPUTE PV-HOLD-SVC-LVL =                                 10910000
106900                 (PV-INSTOCKS-STYLE / PV-SKU-STORE-COMBOS) * 100  10920000
107000        COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL        10930000
107100     ELSE                                                         10940000
107200        MOVE ZERO TO PV-SVC-LEVEL-PCT                             10950000
107300     END-IF                                                       10960000
107400*                                                                 10970000
107500     IF PRINT-DETAIL-FOR-DEPT                                     10980000
107600        PERFORM E500-FORMAT-DETAIL-LINE                           10990000
107700     END-IF                                                       11000000
107800*                                                                 11010000
107900     ADD PV-INSTOCKS-STYLE   TO PV-SC-INSTOCKS                    11020000
108000     ADD PV-SKU-STORE-COMBOS TO PV-SC-COMBOS                      11030000
108100     ADD PV-TOTAL-SKUS       TO PV-SC-TOTAL-SKUS                  11040000
108200     ADD PV-SKUS-BELOW       TO PV-SC-SKUS-BELOW                  11050000
108300     ADD PV-STORES-BELOW     TO PV-SC-STORES-BELOW                11060000
108400     ADD PC-1                TO PV-NBR-OF-STYLES                  11070000
108500*                                                                 11080000
108600     MOVE ZERO TO PV-INSTOCKS-STYLE                               11090000
108700                  PV-SKU-STORE-COMBOS                             11100000
108800                  PV-TOTAL-SKUS                                   11110000
108900                  PV-SKUS-BELOW                                   11120000
109000                  PV-STORES-BELOW                                 11130000
109100                  PV-FIRST-STORE-COUNT.                           11140000
109200*                                                                 11150000
109300***************************************************************** 11160000
109400*                                                                 11170000
109500*  CALCULATE THE SUBCLASS SERVICE LEVEL AND PRINT TOTALS          11180000
109600*                                                                 11190000
109700***************************************************************** 11200000
109800 D300-SUBCLASS-BREAK.                                             11210000
109900*                                                                 11220000
110000     MOVE ZERO TO PV-AVG-OSTRAT                                   11230000
110100                  PV-TOTAL-CSTOCK                                 11240000
110200                  PV-AVG-ONORDER                                  11250000
110300                  PV-AVG-ONHAND.                                  11260000
110400*                                                                 11270000
110500     PERFORM E700-GET-SUBCL-OSTRAT-QTY.                           11280000
110600     PERFORM E800-GET-SUBCL-ONORDER-QTY.                          11290000
110700     PERFORM E900-GET-SUBCL-ONHAND-QTY.                           11300000
110800*                                                                 11310000
110900     IF PV-SC-COMBOS > ZERO                                       11320000
111000        COMPUTE PV-HOLD-SVC-LVL =                                 11330000
111100                 (PV-SC-INSTOCKS / PV-SC-COMBOS) * 100            11340000
111200        COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL        11350000
111300     ELSE                                                         11360000
111400        MOVE ZERO TO PV-SVC-LEVEL-PCT                             11370000
111500     END-IF                                                       11380000
111600*                                                                 11390000
111700     IF PRINT-DETAIL-FOR-DEPT                                     11400000
111800        MOVE SPACES TO TL1-STYLE-DESC                             11410000
111900        MOVE ZERO   TO TL1-NBR-OF-STYLES                          11420000
112000     ELSE                                                         11430000
112100        MOVE PC-STYLE-DESC    TO TL1-STYLE-DESC                   11440000
112200        MOVE PV-NBR-OF-STYLES TO TL1-NBR-OF-STYLES                11450000
112300     END-IF                                                       11460000
112400*                                                                 11470000
112500     MOVE PV-CLASS           TO TL1-CLASS.                        11480000
112600     MOVE 'SUBCLASS TOTAL'   TO TL1-TOTAL-DESC.                   11490000
112700     MOVE PV-SC-TOTAL-SKUS   TO TL1-TOT-SKUS.                     11500000
112800     MOVE PV-AVG-ONHAND      TO TL1-AVG-OH.                       11510000
112900     MOVE PV-AVG-ONORDER     TO TL1-AVG-OO.                       11520000
113000     MOVE PV-TOTAL-CSTOCK    TO TL1-CSTOCK.                       11530000
113100     MOVE PV-SVC-LEVEL-PCT   TO TL1-SVC-LEVEL.                    11540000
113200     MOVE PV-SC-SKUS-BELOW   TO TL1-SKUS-BELOW.                   11550000
113300     MOVE PV-SC-STORES-BELOW TO TL1-STORES-BELOW.                 11560000
113400     MOVE PV-AVG-OSTRAT      TO TL1-AVG-OSTRAT.                   11570000
113500     MOVE PV-LEAD-TIME       TO TL1-LEAD-TIME.                    11580000
113600     PERFORM T100-PRINT-SUBCLASS-TOTALS.                          11590000
113700*                                                                 11600000
113800     ADD PV-SC-INSTOCKS     TO PV-MC-INSTOCKS                     11610000
113900     ADD PV-SC-COMBOS       TO PV-MC-COMBOS                       11620000
114000     ADD PV-SC-TOTAL-SKUS   TO PV-MC-TOTAL-SKUS                   11630000
114100     ADD PV-SC-SKUS-BELOW   TO PV-MC-SKUS-BELOW                   11640000
114200     ADD PV-SC-STORES-BELOW TO PV-MC-STORES-BELOW                 11650000
114300*                                                                 11660000
114400     MOVE ZERO TO PV-SC-INSTOCKS                                  11670000
114500                  PV-SC-COMBOS                                    11680000
114600                  PV-SC-TOTAL-SKUS                                11690000
114700                  PV-SC-SKUS-BELOW                                11700000
114800                  PV-SC-STORES-BELOW                              11710000
114900                  PV-NBR-OF-STYLES.                               11720000
115000*                                                                 11730000
115100     MOVE PV-XREF-SUB-CLASS TO PV-SUB-CLASS.                      11740000
115200*                                                                 11750000
115300***************************************************************** 11760000
115400*                                                                 11770000
115500*  CALCULATE THE MAJOR CLASS SERVICE LEVEL AND PRINT TOTALS       11780000
115600*                                                                 11790000
115700***************************************************************** 11800000
115800 D400-MAJOR-CLASS-BREAK.                                          11810000
115900*                                                                 11820000
116000     IF PV-MC-COMBOS > ZERO                                       11830000
116100        COMPUTE PV-HOLD-SVC-LVL =                                 11840000
116200                 (PV-MC-INSTOCKS / PV-MC-COMBOS) * 100            11850000
116300        COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL        11860000
116400     ELSE                                                         11870000
116500        MOVE ZERO TO PV-SVC-LEVEL-PCT                             11880000
116600     END-IF                                                       11890000
116700*                                                                 11900000
116800     MOVE PV-MAJOR-CLASS      TO TL2-CLASS.                       11910000
116900     MOVE 'MAJOR CLASS TOTAL' TO TL2-TOTAL-DESC.                  11920000
117000     MOVE PV-MC-TOTAL-SKUS    TO TL2-TOT-SKUS.                    11930000
117100     MOVE PV-SVC-LEVEL-PCT    TO TL2-SVC-LEVEL.                   11940000
117200     MOVE PV-MC-SKUS-BELOW    TO TL2-SKUS-BELOW.                  11950000
117300     MOVE PV-MC-STORES-BELOW  TO TL2-STORES-BELOW.                11960000
117400     PERFORM T200-PRINT-MAJOR-CLASS-TOTALS.                       11970000
117500*                                                                 11980000
117600     ADD PV-MC-INSTOCKS     TO PV-DP-INSTOCKS                     11990000
117700     ADD PV-MC-COMBOS       TO PV-DP-COMBOS                       12000000
117800     ADD PV-MC-TOTAL-SKUS   TO PV-DP-TOTAL-SKUS                   12010000
117900     ADD PV-MC-SKUS-BELOW   TO PV-DP-SKUS-BELOW                   12020000
118000     ADD PV-MC-STORES-BELOW TO PV-DP-STORES-BELOW                 12030000
118100*                                                                 12040000
118200     MOVE ZERO TO PV-MC-INSTOCKS                                  12050000
118300                  PV-MC-COMBOS                                    12060000
118400                  PV-MC-TOTAL-SKUS                                12070000
118500                  PV-MC-SKUS-BELOW                                12080000
118600                  PV-MC-STORES-BELOW.                             12090000
118700*                                                                 12100000
118800     MOVE SKXREF-SUBCLASS TO NI-SUB-CLASS-9-2.                    12110000
118900     MOVE NI-SUB-CLASS-X-2 TO PV-CLASS.                           12120000
119000*                                                                 12130000
119100***************************************************************** 12140000
119200*                                                                 12150000
119300*  READ THE ZERO-ONHAND FILE FOR AN ITEM/STORE.                   12160026
119400*  IF RECORD FOUND, UPDATE THE COUNTER IN THE STORE TABLE.        12170000
119500*                                                                 12180000
119600***************************************************************** 12190000
119700 D500-PROCESS-ITEM-STORES.                                        12200000
119800*                                                                 12210000
119900     PERFORM Z600-READ-NEXT-OH-FILE.                              12220000
120000                                                                  12230000
120100     IF END-OF-ITEM-STORES                                        12240000
120200        CONTINUE                                                  12250000
120300     ELSE                                                         12260000
120400        IF MR119-ITEM-NBR NOT = PV-ITEM-NBR                       12270000
120500           SET END-OF-ITEM-STORES TO TRUE                         12280000
120600        ELSE                                                      12290000
120700           MOVE MR119-STORE-NBR  TO PV-ST-SUB                     12300016
120900           ADD PC-1 TO ST-ZERO-ONHAND-ITEMS (PV-ST-SUB)           12310027
121000                       PV-NBR-ZERO-ONHAND                         12320027
121100        END-IF                                                    12330000
121200     END-IF.                                                      12340000
121300*                                                                 12350000
121400***************************************************************** 12360000
121500*                                                                 12370000
121600*  IF DEPT. NUMBER IS FOUND IN TABLE, SET FLAG TO INDICATE THAT   12380000
121700*  NO STYLE/COLOR DETAIL SHOULD BE PRINTED FOR THIS DEPT.         12390000
121800*  (WILL BE SUMMED UP TO SUBCLASS LEVEL)                          12400000
121900*                                                                 12410000
122000***************************************************************** 12420000
122100 D600-CHECK-DEPT-TABLE.                                           12430000
122200*                                                                 12440000
122300     SET DP-INDEX TO 1.                                           12450000
122400     SEARCH DP-DEPT-ENTRIES                                       12460000
122500        AT END                                                    12470000
122600           SET PRINT-DETAIL-FOR-DEPT TO TRUE                      12480000
122700        WHEN DP-DEPT-NBR (DP-INDEX) = PV-DEPT-NBR                 12490000
122800           SET NO-DETAIL-FOR-DEPT TO TRUE                         12500000
122900     END-SEARCH.                                                  12510000
123000*                                                                 12520000
123100***************************************************************** 12530000
123200 D700-GET-BUYER-NAME.                                             12540000
123300*                                                                 12550000
123400     MOVE 'D700-GET-BUYER-NAME'   TO PV-PARAGRAPH-NAME.           12560000
123500     MOVE 'SELECT FOR BUYER NAME' TO PV-DB2-OPER-ATTEMPTED.       12570000
123600     MOVE SPACES                  TO HL2-BYR-NAME.                12580000
123700*                                                                 12590000
123800     PERFORM                                                      12600000
123900         WITH TEST AFTER                                          12610000
124000         VARYING PV-SQL-SUB                                       12620000
124100         FROM 1 BY 1                                              12630000
124200         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        12640000
124300            OR SQLCODE = ZERO                                     12650000
124400            OR SQLCODE = +100                                     12660000
124500                                                                  12670000
124600     EXEC SQL                                                     12680000
124700       SELECT WORKER_FIR_NAME,                                    12690000
124800              WORKER_LAST_NAME                                    12700000
124900         INTO :RSPBAR-WORKER-FIR-NAME,                            12710000
125000              :RSPBAR-WORKER-LAST-NAME                            12720000
125100         FROM TRSPBAR                                             12730000
125200        WHERE MDSEAR_DKEY = :MDSEAR-DKEY                          12740000
125300          AND RSPLVL_CDE  = 'BYR'                                 12750000
125400          AND OPERCO_NBR  = '03'                                  12760000
125500          AND CURRENT DATE BETWEEN                                12770000
125600                 WORKER_STRT_DTE AND WORKER_END_DTE               12780000
125700     END-EXEC                                                     12790000
125800         EVALUATE TRUE                                            12800000
125900             WHEN SQLCODE = ZERO                                  12810000
126000                  STRING RSPBAR-WORKER-FIR-NAME  DELIMITED BY ' ' 12820000
126100                  ' '                     DELIMITED BY SIZE       12830000
126200                  RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE       12840000
126300                          INTO HL2-BYR-NAME                       12850000
126400             WHEN SQLCODE = -904                                  12860000
126500             WHEN SQLCODE = -913                                  12870000
126600             WHEN SQLCODE = +100                                  12880000
126700                 CONTINUE                                         12890000
126800             WHEN SQLWARN0 NOT = SPACES                           12900000
126900             WHEN SQLCODE  NOT = ZERO                             12910000
127000                  PERFORM Z999-SQL-ABEND                          12920000
127100         END-EVALUATE                                             12930000
127200     END-PERFORM.                                                 12940000
127300*                                                                 12950000
127400     IF PV-SQL-SUB > PC-MAX-RETRIES                               12960000
127500        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    12970000
127600                                   TO PV-DB2-OPER-ATTEMPTED       12980000
127700        PERFORM Z999-SQL-ABEND                                    12990000
127800     END-IF.                                                      13000000
127900*                                                                 13010000
128000***************************************************************** 13020000
128100*                                                                 13030000
128200*  OBTAIN THE NUMBER OF STORES ASSOCIATED WITH AN ITEM            13040000
128300*                                                                 13050000
128400***************************************************************** 13060000
128500 D800-GET-STORE-COUNT.                                            13070000
128600     MOVE 'D800-GET-STORE-COUNT'   TO PV-PARAGRAPH-NAME.          13080000
128700     MOVE 'SELECT FOR STORE COUNT' TO PV-DB2-OPER-ATTEMPTED.      13090000
128800     PERFORM                                                      13100000
128900         WITH TEST AFTER                                          13110000
129000         VARYING PV-SQL-SUB                                       13120000
129100         FROM 1 BY 1                                              13130000
129200         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        13140000
129300            OR SQLCODE = ZERO                                     13150000
129400            OR SQLCODE = +100                                     13160000
129500                                                                  13170000
129600         EXEC SQL                                                 13180000
129700         SELECT COUNT (DISTINCT A.STR_NBR)                        13190000
129800           INTO :PV-TOT-STORES-FOR-ITEM                           13200000
129900           FROM TMRITST A,                                        13210000
130000                TSKST   B,                                        13220000
130100                XMT_LOC C                                         13230016
130200          WHERE A.ITEM_NBR = :PV-ITEM-NBR                         13240000
130300            AND A.ITEM_NBR = B.ITEM_NMBR                          13250000
130400            AND A.STR_NBR  = B.LOC_NBR                            13260016
130500            AND A.STR_NBR  = C.LOC_NBR                            13270016
130600            AND A.FT_CDE   = 'O'                                  13280000
130700            AND C.E_BUS_IND = 'Y'                                 13290016
130800            AND C.LOC_TYP_CDE   = 'DS'                            13300016
130900         END-EXEC                                                 13310000
131000         EVALUATE TRUE                                            13320000
131100             WHEN SQLCODE = ZERO                                  13330000
131200             WHEN SQLCODE = -904                                  13340000
131300             WHEN SQLCODE = -913                                  13350000
131400                 CONTINUE                                         13360000
131500             WHEN SQLCODE = +100                                  13370000
131600                  SET EOF-STORE-CURSOR TO TRUE                    13380000
131700             WHEN SQLWARN0 NOT = SPACES                           13390000
131800             WHEN SQLCODE  NOT = ZERO                             13400000
131900                  PERFORM Z999-SQL-ABEND                          13410000
132000         END-EVALUATE                                             13420000
132100     END-PERFORM.                                                 13430000
132200*                                                                 13440000
132300     IF PV-SQL-SUB > PC-MAX-RETRIES                               13450000
132400        MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'              13460000
132500                                   TO PV-DB2-OPER-ATTEMPTED       13470000
132600        PERFORM Z999-SQL-ABEND                                    13480000
132700     END-IF.                                                      13490000
132800*                                                                 13500000
132900***************************************************************** 13510000
133000*                                                                 13520000
133100*  AT THE STYLE/COLOR LEVEL (INFOREM E-COMMERCE ITEMS/STORES ONLY)13530000
133200*  OBTAIN:                                                        13540000
133300*  -- AVERAGE OSTRAT                                              13550000
133400*  -- TOTAL CSTOCK                                                13560000
133500*  -- NUMBER OF SKU/STORE COMBINATIONS                            13570000
133600*  -- NUMBER OF DISTINCT STORE NUMBERS                            13580000
133700*                                                                 13590000
133800***************************************************************** 13600000
133900 E200-GET-OSTRAT-QTY.                                             13610000
134000     MOVE 'E200-GET-OSTRAT-QTY'   TO PV-PARAGRAPH-NAME.           13620000
134100     MOVE 'SELECT FOR OSTRAT QTY' TO PV-DB2-OPER-ATTEMPTED.       13630000
134200                                                                  13640000
134300     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                 13650000
134400     MOVE NI-DEPT-9-3             TO NI-DEPT-9-4.                 13660000
134500     MOVE PV-CLASS                TO NI-SUB-CLASS-X-2.            13670000
134600     MOVE NI-SUB-CLASS-9-2        TO NI-SUB-CLASS-9-4.            13680000
134700                                                                  13690000
135000                                                                  13700000
135100     PERFORM                                                      13710000
135200         WITH TEST AFTER                                          13720000
135300         VARYING PV-SQL-SUB                                       13730000
135400         FROM 1 BY 1                                              13740000
135500         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        13750000
135600            OR SQLCODE = ZERO                                     13760000
135700            OR SQLCODE = +100                                     13770000
135800                                                                  13780000
135900         EXEC SQL                                                 13790000
136000           SELECT AVG(B.OSTRAT_QTY),                              13800000
136100                  SUM(B.CSTOCK_QTY),                              13810000
136200                  COUNT (*),                                      13820000
136300                  COUNT (DISTINCT B.STR_NBR)                      13830000
136400             INTO :PV-AVG-OSTRAT:PV-NULL-IND-OSTRAT,              13840000
136500                  :PV-TOTAL-CSTOCK:PV-NULL-IND-CSTOCK,            13850000
136600                  :PV-SKU-STORE-COMBOS,                           13860000
136700                  :PV-TOTAL-STORES                                13870000
136800             FROM TSK     A,                                      13880000
136900                  TMRITST B,                                      13890000
137000                  TSKST   C,                                      13900000
137100                  XMT_LOC D,                                      13910016
137200                  TSKXREF E                                       13920000
137300            WHERE E.DEPT              = :NI-DEPT-9-4              13930000
137400              AND E.SUBCLASS          = :NI-SUB-CLASS-9-4         13940000
137500              AND A.LONG_VENDOR_STYLE = :PV-VENDOR-STYLE          13950000
137600              AND A.LONG_COLOR_DESC   = :PV-COLOR-DESC            13960000
137700              AND A.ITEM_NMBR = B.ITEM_NBR                        13970000
137800              AND B.ITEM_NBR  = C.ITEM_NMBR                       13980000
137900              AND B.ITEM_NBR  = E.ITM_NBR                         13990000
138000              AND B.STR_NBR   = C.LOC_NBR                         14000016
138100              AND B.STR_NBR   = D.LOC_NBR                         14010016
138200              AND B.FT_CDE = 'O'                                  14020000
138300              AND D.E_BUS_IND = 'Y'                               14030016
138400              AND D.LOC_TYP_CDE   = 'DS'                          14040016
138500         END-EXEC                                                 14050000
138600         EVALUATE TRUE                                            14060000
138700             WHEN SQLCODE = ZERO                                  14070000
138800             WHEN SQLCODE = -904                                  14080000
138900             WHEN SQLCODE = -913                                  14090000
139000             WHEN SQLCODE = +100                                  14100000
139100                  CONTINUE                                        14110000
139200             WHEN SQLWARN0 NOT = SPACES                           14120000
139300             WHEN SQLCODE  NOT = ZERO                             14130000
139400                  PERFORM Z999-SQL-ABEND                          14140000
139500         END-EVALUATE                                             14150000
139600     END-PERFORM.                                                 14160000
139700*                                                                 14170000
139800     IF PV-SQL-SUB > PC-MAX-RETRIES                               14180000
139900        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    14190000
140000                                   TO PV-DB2-OPER-ATTEMPTED       14200000
140100        PERFORM Z999-SQL-ABEND                                    14210000
140200     END-IF.                                                      14220000
140300*                                                                 14230000
140400***************************************************************** 14240000
140500*                                                                 14250000
140600*  GET THE AVERAGE ONORDER QUANTITY FOR A STYLE/COLOR (INFOREM    14260000
140700*  E-COMMERCE ITEMS/STORES ONLY)                                  14270000
140800*                                                                 14280000
140900***************************************************************** 14290000
141000 E300-GET-ONORDER-QTY.                                            14300000
141100                                                                  14310000
141200     MOVE 'E300-GET-ONORDER-QTY' TO PV-PARAGRAPH-NAME.            14320000
141300     MOVE 'SELECT FOR ONORDER '  TO PV-DB2-OPER-ATTEMPTED.        14330000
141400                                                                  14340000
141500     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                 14350000
141600     MOVE NI-DEPT-9-3             TO NI-DEPT-9-4.                 14360000
141610                                                                  14370000
141700     MOVE PV-CLASS                TO NI-SUB-CLASS-X-2.            14380000
141800     MOVE NI-SUB-CLASS-9-2        TO NI-SUB-CLASS-9-4.            14390000
141900                                                                  14400000
142200                                                                  14410000
142300     PERFORM                                                      14420000
142400         WITH TEST AFTER                                          14430000
142500         VARYING PV-SQL-SUB                                       14440000
142600         FROM 1 BY 1                                              14450000
142700         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        14460000
142800            OR SQLCODE = ZERO                                     14470000
142900            OR SQLCODE = +100                                     14480000
143000                                                                  14490000
143100         EXEC SQL                                                 14500000
143200           SELECT SUM(A.ONORD_UNT_QTY)                            14510000
143300             INTO :PV-SUM-ONORDER:PV-NULL-IND-ONORDER             14520000
143400             FROM TSKSTOO A,                                      14530000
143500                  TSK     B,                                      14540000
143600                  XMT_LOC C,                                      14550016
143700                  TMRITST D,                                      14560000
143800                  TSKXREF E                                       14570000
143900            WHERE E.DEPT              = :NI-DEPT-9-4              14580000
144000              AND E.SUBCLASS          = :NI-SUB-CLASS-9-4         14590000
144100              AND B.LONG_VENDOR_STYLE = :PV-VENDOR-STYLE          14600000
144200              AND B.LONG_COLOR_DESC   = :PV-COLOR-DESC            14610000
144300              AND E.ITM_NBR     = B.ITEM_NMBR                     14620000
144400              AND A.ITM_NBR     = B.ITEM_NMBR                     14630000
144500              AND B.ITEM_NMBR   = D.ITEM_NBR                      14640000
144600              AND A.STR_NBR     = C.LOC_NBR                       14650016
144700              AND C.LOC_NBR     = D.STR_NBR                       14660016
144800              AND D.FT_CDE = 'O'                                  14670000
144900              AND C.E_BUS_IND = 'Y'                               14680016
145000              AND C.LOC_TYP_CDE   = 'DS'                          14690016
145100         END-EXEC                                                 14700000
145200         EVALUATE TRUE                                            14710000
145300             WHEN SQLCODE = ZERO                                  14720000
145400             WHEN SQLCODE = -904                                  14730000
145500             WHEN SQLCODE = -913                                  14740000
145600             WHEN SQLCODE = +100                                  14750000
145700                 CONTINUE                                         14760000
145800             WHEN SQLWARN0 NOT = SPACES                           14770000
145900             WHEN SQLCODE  NOT = ZERO                             14780000
146000                  PERFORM Z999-SQL-ABEND                          14790000
146100         END-EVALUATE                                             14800000
146200     END-PERFORM.                                                 14810000
146300                                                                  14820000
146400     IF PV-SQL-SUB > PC-MAX-RETRIES                               14830000
146500        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    14840000
146600                                   TO PV-DB2-OPER-ATTEMPTED       14850000
146700        PERFORM Z999-SQL-ABEND                                    14860000
146800     ELSE                                                         14870000
146900        IF SQLCODE = ZERO                                         14880000
147000           IF (PV-NULL-IND-ONORDER = -1) OR                       14890000
147100              (PV-SKU-STORE-COMBOS = ZERO)                        14900000
147200              MOVE ZERO TO PV-AVG-ONORDER                         14910000
147300           ELSE                                                   14920000
147400              DIVIDE PV-SUM-ONORDER BY PV-SKU-STORE-COMBOS        14930000
147500                  GIVING PV-HOLD-AVG-OO                           14940000
147600              COMPUTE PV-AVG-ONORDER ROUNDED = PV-HOLD-AVG-OO     14950000
147700           END-IF                                                 14960000
147800        END-IF                                                    14970000
147900     END-IF.                                                      14980000
148000*                                                                 14990000
148100***************************************************************** 15000000
148200*                                                                 15010000
148300*  FOR A VALID STORE NUMBER IN THE INTERNAL STORE TABLE,          15020000
148400*  GET THE NUMBER OF ITEMS IN THE STYLE/COLOR FOR THAT STORE.     15030000
148500*  THEN CALCULATE THE STORE'S SERVICE LEVEL.  IF BELOW THE SET    15040000
148600*  LIMIT, INCREMENT COUNTER.                                      15050000
148700*                                                                 15060000
148800***************************************************************** 15070000
148900 E400-CALC-STORE-SVC-LEVELS.                                      15080000
149000*                                                                 15090000
149100     IF ST-VALID-STORE-FLAG (PV-ST-SUB) = PC-Y                    15100000
149200        MOVE ZERO          TO PV-TOT-ITEMS-FOR-STORE              15110000
149300        MOVE PV-ST-SUB     TO MRITST-STR-NBR                      15120018
149500        PERFORM F300-GET-TOTAL-ITEMS                              15130000
149600                                                                  15140000
149700        IF PV-TOT-ITEMS-FOR-STORE GREATER THAN ZERO               15150000
149800                                                                  15160000
149900           IF ST-ZERO-ONHAND-ITEMS (PV-ST-SUB) = ZERO             15170027
150000              MOVE PC-100 TO PV-SVC-LEVEL-PCT                     15180000
150100           ELSE                                                   15190000
150800              MOVE ZERO TO PV-NBR-INSTOCK                         15280035
150700                           PV-SVC-LEVEL-PCT                       15290035
150900           END-IF                                                 15310000
151000*                                                                 15320000
151100           IF PV-SVC-LEVEL-PCT < PC-STORE-SVC-LEVEL-LIMIT         15330000
151200              ADD PC-1 TO PV-STORES-BELOW                         15340000
151300           END-IF                                                 15350000
151400        END-IF                                                    15360000
151500                                                                  15370000
151600        MOVE ZERO TO ST-ZERO-ONHAND-ITEMS (PV-ST-SUB)             15380027
151700     END-IF.                                                      15390000
151800*                                                                 15400000
151900***************************************************************** 15410000
152000 E500-FORMAT-DETAIL-LINE.                                         15420000
152100*                                                                 15430000
152200     MOVE PV-CLASS         TO DL1-CLASS.                          15440000
152300     MOVE PV-VENDOR-STYLE  TO DL1-STYLE.                          15450000
152400     MOVE PV-ITEM-DESC     TO DL1-DESC.                           15460000
152500     MOVE PV-COLOR-DESC    TO DL1-COLOR.                          15470000
152600     MOVE PV-TOTAL-STORES  TO DL1-TOT-STORES.                     15480000
152700     MOVE PV-TOTAL-SKUS    TO DL1-TOT-SKUS.                       15490000
152800     MOVE PV-AVG-ONHAND    TO DL1-AVG-OH.                         15500000
152900     MOVE PV-AVG-ONORDER   TO DL1-AVG-OO.                         15510000
153000     MOVE PV-TOTAL-CSTOCK  TO DL1-CSTOCK.                         15520000
153100     MOVE PV-SVC-LEVEL-PCT TO DL1-SVC-LEVEL.                      15530000
153200     MOVE PV-SKUS-BELOW    TO DL1-SKUS-BELOW.                     15540000
153300     MOVE PV-STORES-BELOW  TO DL1-STORES-BELOW.                   15550000
153400     MOVE PV-AVG-OSTRAT    TO DL1-AVG-OSTRAT.                     15560000
153500     MOVE PV-LEAD-TIME     TO DL1-LEAD-TIME.                      15570000
153600*                                                                 15580000
153700     PERFORM Z300-WRITE-DETAIL-LINE.                              15590000
153800*                                                                 15600000
153900     MOVE SPACE TO DL1-ASTERISK.                                  15610000
154000*                                                                 15620000
154100***************************************************************** 15630000
154200*                                                                 15640000
154300*  GET AVERAGE ONHAND QUANTITY FOR THE STYLE/COLOR (INFOREM       15650000
154400*  E-COMMERCE ITEMS/STORES ONLY)                                  15660000
154500*                                                                 15670000
154600***************************************************************** 15680000
154700 E600-GET-ONHAND-QTY.                                             15690000
154800     MOVE 'E600-GET-ONHAND-QTY'   TO PV-PARAGRAPH-NAME.           15700000
154900     MOVE 'SELECT FOR ONHAND QTY' TO PV-DB2-OPER-ATTEMPTED.       15710000
155000                                                                  15720000
155100     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                 15730000
155200     MOVE NI-DEPT-9-3             TO NI-DEPT-9-4.                 15740000
155300     MOVE PV-CLASS                TO NI-SUB-CLASS-X-2.            15750000
155400     MOVE NI-SUB-CLASS-9-2        TO NI-SUB-CLASS-9-4.            15760000
155500                                                                  15770000
155800                                                                  15780000
155900     PERFORM                                                      15790000
156000         WITH TEST AFTER                                          15800000
156100         VARYING PV-SQL-SUB                                       15810000
156200         FROM 1 BY 1                                              15820000
156300         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        15830000
156400            OR SQLCODE = ZERO                                     15840000
156500            OR SQLCODE = +100                                     15850000
156600                                                                  15860000
156700         EXEC SQL                                                 15870000
156800           SELECT DECIMAL((AVG(B.ONHAND_QTY)+.05),6,1)            15880000
156900             INTO :PV-AVG-ONHAND:PV-NULL-IND-ONHAND               15890000
157000             FROM TSK     A,                                      15900000
157100                  TSKST   B,                                      15910000
157200                  XMT_LOC C,                                      15920016
157300                  TMRITST D,                                      15930000
157400                  TSKXREF E                                       15940000
157500            WHERE E.DEPT              = :NI-DEPT-9-4              15950000
157600              AND E.SUBCLASS          = :NI-SUB-CLASS-9-4         15960000
157700              AND A.LONG_VENDOR_STYLE = :PV-VENDOR-STYLE          15970000
157800              AND A.LONG_COLOR_DESC   = :PV-COLOR-DESC            15980000
157900              AND A.ITEM_NMBR = B.ITEM_NMBR                       15990000
158000              AND A.ITEM_NMBR = D.ITEM_NBR                        16000000
158100              AND A.ITEM_NMBR = E.ITM_NBR                         16010000
158200              AND B.LOC_NBR    = C.LOC_NBR                        16020019
158300              AND C.LOC_NBR    = D.STR_NBR                        16030016
158400              AND C.E_BUS_IND = 'Y'                               16040016
158500              AND C.LOC_TYP_CDE   = 'DS'                          16050016
158600              AND D.FT_CDE = 'O'                                  16060000
158700         END-EXEC                                                 16070000
158800         EVALUATE TRUE                                            16080000
158900             WHEN SQLCODE = ZERO                                  16090000
159000             WHEN SQLCODE = -904                                  16100000
159100             WHEN SQLCODE = -913                                  16110000
159200             WHEN SQLCODE = +100                                  16120000
159300                 CONTINUE                                         16130000
159400             WHEN SQLWARN0 NOT = SPACES                           16140000
159500             WHEN SQLCODE  NOT = ZERO                             16150000
159600                  PERFORM Z999-SQL-ABEND                          16160000
159700         END-EVALUATE                                             16170000
159800     END-PERFORM.                                                 16180000
159900*                                                                 16190000
160000     IF PV-SQL-SUB > PC-MAX-RETRIES                               16200000
160100        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    16210000
160200                                   TO PV-DB2-OPER-ATTEMPTED       16220000
160300        PERFORM Z999-SQL-ABEND                                    16230000
160400     END-IF.                                                      16240000
160500***************************************************************** 16250000
160600*                                                                 16260000
160700*  AT THE SUBCLASS LEVEL (INFOREM E-COMMERCE ITEMS/STORES ONLY)   16270000
160800*  OBTAIN:                                                        16280000
160900*  -- AVERAGE OSTRAT                                              16290000
161000*  -- TOTAL CSTOCK                                                16300000
161100*                                                                 16310000
161200***************************************************************** 16320000
161300 E700-GET-SUBCL-OSTRAT-QTY.                                       16330000
161400     MOVE 'E700-GET-SUBCL-OSTRAT-QTY' TO PV-PARAGRAPH-NAME.       16340000
161500     MOVE 'SELECT FOR OSTRAT QTY'     TO PV-DB2-OPER-ATTEMPTED.   16350000
161600                                                                  16360000
161700     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                 16370000
161800     MOVE NI-DEPT-9-3             TO NI-DEPT-9-4.                 16380000
161900     MOVE PV-CLASS                TO NI-SUB-CLASS-X-2.            16390000
162000     MOVE NI-SUB-CLASS-9-2        TO NI-SUB-CLASS-9-4.            16400000
162100                                                                  16410000
162200     PERFORM                                                      16420000
162300         WITH TEST AFTER                                          16430000
162400         VARYING PV-SQL-SUB                                       16440000
162500         FROM 1 BY 1                                              16450000
162600         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        16460000
162700            OR SQLCODE = ZERO                                     16470000
162800            OR SQLCODE = +100                                     16480000
162900                                                                  16490000
163000         EXEC SQL                                                 16500000
163100           SELECT AVG(B.OSTRAT_QTY),                              16510000
163200                  SUM(B.CSTOCK_QTY)                               16520000
163300             INTO :PV-AVG-OSTRAT:PV-NULL-IND-OSTRAT,              16530000
163400                  :PV-TOTAL-CSTOCK:PV-NULL-IND-CSTOCK             16540000
163500             FROM TMRITST B,                                      16550000
163600                  TSKST   C,                                      16560000
163700                  XMT_LOC D,                                      16570016
163800                  TSKXREF E                                       16580000
163900            WHERE E.DEPT      = :NI-DEPT-9-4                      16590000
164000              AND E.SUBCLASS  = :NI-SUB-CLASS-9-4                 16600000
164100              AND B.ITEM_NBR  = C.ITEM_NMBR                       16610000
164200              AND B.ITEM_NBR  = E.ITM_NBR                         16620000
164300              AND B.STR_NBR   = C.LOC_NBR                         16630016
164400              AND B.STR_NBR   = D.LOC_NBR                         16640016
164500              AND B.FT_CDE = 'O'                                  16650000
164600              AND D.E_BUS_IND = 'Y'                               16660016
164700              AND D.LOC_TYP_CDE   = 'DS'                          16670016
164800         END-EXEC                                                 16680000
164900         EVALUATE TRUE                                            16690000
165000             WHEN SQLCODE = ZERO                                  16700000
165100             WHEN SQLCODE = -904                                  16710000
165200             WHEN SQLCODE = -913                                  16720000
165300             WHEN SQLCODE = +100                                  16730000
165400                  CONTINUE                                        16740000
165500             WHEN SQLWARN0 NOT = SPACES                           16750000
165600             WHEN SQLCODE  NOT = ZERO                             16760000
165700                  PERFORM Z999-SQL-ABEND                          16770000
165800         END-EVALUATE                                             16780000
165900     END-PERFORM.                                                 16790000
166000*                                                                 16800000
166100     IF PV-SQL-SUB > PC-MAX-RETRIES                               16810000
166200        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    16820000
166300                                   TO PV-DB2-OPER-ATTEMPTED       16830000
166400        PERFORM Z999-SQL-ABEND                                    16840000
166500     END-IF.                                                      16850000
166600*                                                                 16860000
166700***************************************************************** 16870000
166800*                                                                 16880000
166900*  GET THE AVERAGE ONORDER QUANTITY FOR A SUBCLASS (INFOREM       16890000
167000*  E-COMMERCE ITEMS/STORES ONLY)                                  16900000
167100*                                                                 16910000
167200***************************************************************** 16920000
167300 E800-GET-SUBCL-ONORDER-QTY.                                      16930000
167400                                                                  16940000
167500     MOVE 'E800-GET-SUBCL-ONORDER-QTY' TO PV-PARAGRAPH-NAME.      16950000
167600     MOVE 'SELECT FOR ONORDER '        TO PV-DB2-OPER-ATTEMPTED.  16960000
167700                                                                  16970000
167800     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                 16980000
167900     MOVE NI-DEPT-9-3             TO NI-DEPT-9-4.                 16990000
168000     MOVE PV-CLASS                TO NI-SUB-CLASS-X-2.            17000000
168100     MOVE NI-SUB-CLASS-9-2        TO NI-SUB-CLASS-9-4.            17010000
168200                                                                  17020000
168300     PERFORM                                                      17030000
168400         WITH TEST AFTER                                          17040000
168500         VARYING PV-SQL-SUB                                       17050000
168600         FROM 1 BY 1                                              17060000
168700         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        17070000
168800            OR SQLCODE = ZERO                                     17080000
168900            OR SQLCODE = +100                                     17090000
169000                                                                  17100000
169100         EXEC SQL                                                 17110000
169200           SELECT SUM(A.ONORD_UNT_QTY)                            17120000
169300             INTO :PV-SUM-ONORDER:PV-NULL-IND-ONORDER             17130000
169400             FROM TSKSTOO A,                                      17140000
169500                  XMT_LOC C,                                      17150016
169600                  TMRITST D,                                      17160000
169700                  TSKXREF E                                       17170000
169800            WHERE E.DEPT        = :NI-DEPT-9-4                    17180000
169900              AND E.SUBCLASS    = :NI-SUB-CLASS-9-4               17190000
170000              AND A.ITM_NBR     = D.ITEM_NBR                      17200000
170100              AND A.ITM_NBR     = E.ITM_NBR                       17210000
170200              AND A.STR_NBR     = C.LOC_NBR                       17220016
170300              AND C.LOC_NBR     = D.STR_NBR                       17230016
170400              AND D.FT_CDE = 'O'                                  17240000
170500              AND C.E_BUS_IND = 'Y'                               17250016
170600              AND C.LOC_TYP_CDE   = 'DS'                          17260016
170700         END-EXEC                                                 17270000
170800         EVALUATE TRUE                                            17280000
170900             WHEN SQLCODE = ZERO                                  17290000
171000             WHEN SQLCODE = -904                                  17300000
171100             WHEN SQLCODE = -913                                  17310000
171200             WHEN SQLCODE = +100                                  17320000
171300                 CONTINUE                                         17330000
171400             WHEN SQLWARN0 NOT = SPACES                           17340000
171500             WHEN SQLCODE  NOT = ZERO                             17350000
171600                  PERFORM Z999-SQL-ABEND                          17360000
171700         END-EVALUATE                                             17370000
171800     END-PERFORM.                                                 17380000
171900                                                                  17390000
172000     IF PV-SQL-SUB > PC-MAX-RETRIES                               17400000
172100        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    17410000
172200                                   TO PV-DB2-OPER-ATTEMPTED       17420000
172300        PERFORM Z999-SQL-ABEND                                    17430000
172400     ELSE                                                         17440000
172500        IF SQLCODE = ZERO                                         17450000
172600           IF (PV-NULL-IND-ONORDER = -1) OR                       17460000
172700              (PV-SC-COMBOS = ZERO)                               17470000
172800              MOVE ZERO TO PV-AVG-ONORDER                         17480000
172900           ELSE                                                   17490000
173000              DIVIDE PV-SUM-ONORDER BY PV-SC-COMBOS               17500000
173100                  GIVING PV-HOLD-AVG-OO                           17510000
173200              COMPUTE PV-AVG-ONORDER ROUNDED = PV-HOLD-AVG-OO     17520000
173300           END-IF                                                 17530000
173400        END-IF                                                    17540000
173500     END-IF.                                                      17550000
173600*                                                                 17560000
173700***************************************************************** 17570000
173800*                                                                 17580000
173900*  GET AVERAGE ONHAND QUANTITY FOR THE SUBCLASS (INFOREM          17590000
174000*  E-COMMERCE ITEMS/STORES ONLY)                                  17600000
174100*                                                                 17610000
174200***************************************************************** 17620000
174300 E900-GET-SUBCL-ONHAND-QTY.                                       17630000
174400     MOVE 'E900-GET-SUBCL-ONHAND-QTY' TO PV-PARAGRAPH-NAME.       17640000
174500     MOVE 'SELECT FOR ONHAND QTY'     TO PV-DB2-OPER-ATTEMPTED.   17650000
174600                                                                  17660000
174700     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                 17670000
174800     MOVE NI-DEPT-9-3             TO NI-DEPT-9-4.                 17680000
174900     MOVE PV-CLASS                TO NI-SUB-CLASS-X-2.            17690000
175000     MOVE NI-SUB-CLASS-9-2        TO NI-SUB-CLASS-9-4.            17700000
175100                                                                  17710000
175200     PERFORM                                                      17720000
175300         WITH TEST AFTER                                          17730000
175400         VARYING PV-SQL-SUB                                       17740000
175500         FROM 1 BY 1                                              17750000
175600         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        17760000
175700            OR SQLCODE = ZERO                                     17770000
175800            OR SQLCODE = +100                                     17780000
175900                                                                  17790000
176000         EXEC SQL                                                 17800000
176100           SELECT DECIMAL((AVG(B.ONHAND_QTY)+.05),6,1)            17810000
176200             INTO :PV-AVG-ONHAND:PV-NULL-IND-ONHAND               17820000
176300             FROM TSKST   B,                                      17830000
176400                  XMT_LOC C,                                      17840016
176500                  TMRITST D,                                      17850000
176600                  TSKXREF E                                       17860000
176700            WHERE E.DEPT      = :NI-DEPT-9-4                      17870000
176800              AND E.SUBCLASS  = :NI-SUB-CLASS-9-4                 17880000
176900              AND B.ITEM_NMBR = D.ITEM_NBR                        17890000
177000              AND B.ITEM_NMBR = E.ITM_NBR                         17900000
177100              AND B.LOC_NBR    = C.LOC_NBR                        17910016
177200              AND C.LOC_NBR    = D.STR_NBR                        17920016
177300              AND C.E_BUS_IND = 'Y'                               17930016
177400              AND C.LOC_TYP_CDE   = 'DS'                          17940016
177500              AND D.FT_CDE = 'O'                                  17950000
177600         END-EXEC                                                 17960000
177700         EVALUATE TRUE                                            17970000
177800             WHEN SQLCODE = ZERO                                  17980000
177900             WHEN SQLCODE = -904                                  17990000
178000             WHEN SQLCODE = -913                                  18000000
178100             WHEN SQLCODE = +100                                  18010000
178200                 CONTINUE                                         18020000
178300             WHEN SQLWARN0 NOT = SPACES                           18030000
178400             WHEN SQLCODE  NOT = ZERO                             18040000
178500                  PERFORM Z999-SQL-ABEND                          18050000
178600         END-EVALUATE                                             18060000
178700     END-PERFORM.                                                 18070000
178800*                                                                 18080000
178900     IF PV-SQL-SUB > PC-MAX-RETRIES                               18090000
179000        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    18100000
179100                                   TO PV-DB2-OPER-ATTEMPTED       18110000
179200        PERFORM Z999-SQL-ABEND                                    18120000
179300     END-IF.                                                      18130000
179400*                                                                 18140000
179500***************************************************************** 18150000
179600 F100-FETCH-STORE-CURSOR.                                         18160000
179700     MOVE 'F100-FETCH-STORE-CSR' TO PV-PARAGRAPH-NAME.            18170000
179800     MOVE 'STORE CURSOR FETCH '  TO PV-DB2-OPER-ATTEMPTED.        18180000
179900     PERFORM                                                      18190000
180000         WITH TEST AFTER                                          18200000
180100         VARYING PV-SQL-SUB                                       18210000
180200         FROM 1 BY 1                                              18220000
180300         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        18230000
180400            OR SQLCODE = ZERO                                     18240000
180500            OR SQLCODE = +100                                     18250000
180600                                                                  18260000
180700         EXEC SQL                                                 18270000
180800             FETCH STORE_CSR                                      18280000
180900              INTO :XMT00001-LOC-NBR                              18290016
181000         END-EXEC                                                 18300000
181100         EVALUATE TRUE                                            18310000
181200             WHEN SQLCODE = ZERO                                  18320000
181300             WHEN SQLCODE = -904                                  18330000
181400             WHEN SQLCODE = -913                                  18340000
181500                 CONTINUE                                         18350000
181600             WHEN SQLCODE = +100                                  18360000
181700                 SET EOF-STORE-CURSOR TO TRUE                     18370000
181800             WHEN SQLWARN0 NOT = SPACES                           18380000
181900             WHEN SQLCODE  NOT = ZERO                             18390000
182000                  PERFORM Z999-SQL-ABEND                          18400000
182100         END-EVALUATE                                             18410000
182200     END-PERFORM.                                                 18420000
182300*                                                                 18430000
182400     IF PV-SQL-SUB > PC-MAX-RETRIES                               18440000
182500        MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'              18450000
182600                                   TO PV-DB2-OPER-ATTEMPTED       18460000
182700        PERFORM Z999-SQL-ABEND                                    18470000
182800     END-IF.                                                      18480000
182900*                                                                 18490000
183000*                                                                 18500000
183100***************************************************************** 18510000
183200*                                                                 18520000
183300*  OBTAIN THE TOTAL NUMBER OF ITEMS IN A STYLE/COLOR FOR A        18530000
183400*  PARTICULAR STORE (INFOREM E-COMMERCE ITEMS/STORES ONLY)        18540000
183500*                                                                 18550000
183600***************************************************************** 18560000
183700 F300-GET-TOTAL-ITEMS.                                            18570000
183800*                                                                 18580000
183900     MOVE 'F300-GET-TOTAL-ITEMS'    TO PV-PARAGRAPH-NAME.         18590000
184000     MOVE 'SELECT FOR TOTAL ITEMS ' TO PV-DB2-OPER-ATTEMPTED.     18600000
184100                                                                  18610000
184200     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                 18620000
184300     MOVE NI-DEPT-9-3             TO NI-DEPT-9-4.                 18630000
184400     MOVE PV-CLASS                TO NI-SUB-CLASS-X-2.            18640000
184500     MOVE NI-SUB-CLASS-9-2        TO NI-SUB-CLASS-9-4.            18650000
184600                                                                  18660000
184900                                                                  18670000
185000     PERFORM                                                      18680000
185100         WITH TEST AFTER                                          18690000
185200         VARYING PV-SQL-SUB                                       18700000
185300         FROM 1 BY 1                                              18710000
185400         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        18720000
185500            OR SQLCODE = ZERO                                     18730000
185600            OR SQLCODE = +100                                     18740000
185700                                                                  18750000
185800         EXEC SQL                                                 18760000
185900           SELECT COUNT (*)                                       18770000
186000             INTO :PV-TOT-ITEMS-FOR-STORE                         18780000
186100             FROM TMRITST A,                                      18790000
186200                  TSK     B,                                      18800000
186300                  TSKXREF C                                       18810000
186400            WHERE A.STR_NBR           = :MRITST-STR-NBR           18820016
186500              AND A.FT_CDE            = 'O'                       18830000
186600              AND C.DEPT              = :NI-DEPT-9-4              18840000
186700              AND C.SUBCLASS          = :NI-SUB-CLASS-9-4         18850000
186800              AND B.LONG_VENDOR_STYLE = :PV-VENDOR-STYLE          18860000
186900              AND B.LONG_COLOR_DESC   = :PV-COLOR-DESC            18870000
187000              AND A.ITEM_NBR  = B.ITEM_NMBR                       18880000
187100              AND A.ITEM_NBR  = C.ITM_NBR                         18890000
187200         END-EXEC                                                 18900000
187300         EVALUATE TRUE                                            18910000
187400             WHEN SQLCODE = ZERO                                  18920000
187500             WHEN SQLCODE = -904                                  18930000
187600             WHEN SQLCODE = -913                                  18940000
187700             WHEN SQLCODE = +100                                  18950000
187800                  CONTINUE                                        18960000
187900             WHEN SQLWARN0 NOT = SPACES                           18970000
188000             WHEN SQLCODE  NOT = ZERO                             18980000
188100                  PERFORM Z999-SQL-ABEND                          18990000
188200         END-EVALUATE                                             19000000
188300     END-PERFORM.                                                 19010000
188400*                                                                 19020000
188500     IF PV-SQL-SUB > PC-MAX-RETRIES                               19030000
188600        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    19040000
188700                                   TO PV-DB2-OPER-ATTEMPTED       19050000
188800        PERFORM Z999-SQL-ABEND                                    19060000
188900     END-IF.                                                      19070000
189000*                                                                 19080000
189100***************************************************************** 19090000
189200 T100-PRINT-SUBCLASS-TOTALS.                                      19100000
189300*                                                                 19110000
189400     IF NO-DETAIL-FOR-DEPT                                        19120000
189500        ADD PC-1 TO PV-LINE-CNT                                   19130000
189600     ELSE                                                         19140000
189700        ADD PC-5 TO PV-LINE-CNT                                   19150000
189800     END-IF                                                       19160000
189900*                                                                 19170000
190000     IF PV-LINE-CNT > PC-MAX-LINES                                19180000
190100        PERFORM Z400-PRINT-REPORT-HEADERS                         19190000
190200        IF NO-DETAIL-FOR-DEPT                                     19200000
190300           ADD PC-1 TO PV-LINE-CNT                                19210000
190400        ELSE                                                      19220000
190500           ADD PC-5 TO PV-LINE-CNT                                19230000
190600        END-IF                                                    19240000
190700     END-IF                                                       19250000
190800*                                                                 19260000
190900     IF PRINT-DETAIL-FOR-DEPT                                     19270000
191000        WRITE PRINT-LINE FROM DASHED-LINE                         19280000
191100            AFTER ADVANCING PC-1                                  19290000
191200     END-IF                                                       19300000
191300*                                                                 19310000
191400     WRITE PRINT-LINE FROM TOTAL-LINE-1                           19320000
191500         AFTER ADVANCING PC-1.                                    19330000
191600*                                                                 19340000
191700     IF PRINT-DETAIL-FOR-DEPT                                     19350000
191800        WRITE PRINT-LINE FROM DASHED-LINE                         19360000
191900            AFTER ADVANCING PC-1                                  19370000
192000        WRITE PRINT-LINE FROM DASHED-LINE                         19380000
192100            AFTER ADVANCING PC-1                                  19390000
192200        WRITE PRINT-LINE FROM BLANK-LINE                          19400000
192300            AFTER ADVANCING PC-1                                  19410000
192400     END-IF.                                                      19420000
192500*                                                                 19430000
192600***************************************************************** 19440000
192700 T200-PRINT-MAJOR-CLASS-TOTALS.                                   19450000
192800*                                                                 19460000
192900     ADD PC-5 TO PV-LINE-CNT.                                     19470000
193000     IF PV-LINE-CNT > PC-MAX-LINES                                19480000
193100        PERFORM Z400-PRINT-REPORT-HEADERS                         19490000
193200        ADD PC-5 TO PV-LINE-CNT                                   19500000
193300     END-IF                                                       19510000
193400*                                                                 19520000
193500     IF NO-DETAIL-FOR-DEPT                                        19530000
193600        WRITE PRINT-LINE FROM DASHED-LINE                         19540000
193700            AFTER ADVANCING PC-1                                  19550000
193800        ADD PC-1 TO PV-LINE-CNT                                   19560000
193900     END-IF.                                                      19570000
194000*                                                                 19580000
194100     WRITE PRINT-LINE FROM TOTAL-LINE-2                           19590000
194200         AFTER ADVANCING PC-1.                                    19600000
194300*                                                                 19610000
194400     WRITE PRINT-LINE FROM DASHED-LINE                            19620000
194500         AFTER ADVANCING PC-1.                                    19630000
194600     WRITE PRINT-LINE FROM DASHED-LINE                            19640000
194700         AFTER ADVANCING PC-1.                                    19650000
194800     WRITE PRINT-LINE FROM BLANK-LINE                             19660000
194900         AFTER ADVANCING PC-2.                                    19670000
195000*                                                                 19680000
195100***************************************************************** 19690000
195200 T300-PRINT-DEPT-TOTALS.                                          19700000
195300*                                                                 19710000
195400     IF PV-LINE-CNT > PC-MAX-LINES                                19720000
195500        PERFORM Z400-PRINT-REPORT-HEADERS                         19730000
195600     END-IF.                                                      19740000
195700*                                                                 19750000
195800     WRITE PRINT-LINE FROM TOTAL-LINE-2                           19760000
195900         AFTER ADVANCING PC-1.                                    19770000
196000     ADD PC-1 TO PV-LINE-CNT.                                     19780000
196100*                                                                 19790000
196200***************************************************************** 19800000
196300 T400-PRINT-BG-TOTALS.                                            19810000
196400*                                                                 19820000
196500     ADD PC-7 TO PV-LINE-CNT.                                     19830000
196600     IF PV-LINE-CNT > PC-MAX-LINES                                19840000
196700        PERFORM Z400-PRINT-REPORT-HEADERS                         19850000
196800     END-IF.                                                      19860000
196900*                                                                 19870000
197000     WRITE PRINT-LINE FROM DASHED-LINE                            19880000
197100         AFTER ADVANCING PC-1.                                    19890000
197200     WRITE PRINT-LINE FROM DASHED-LINE                            19900000
197300         AFTER ADVANCING PC-1.                                    19910000
197400     WRITE PRINT-LINE FROM BLANK-LINE                             19920000
197500         AFTER ADVANCING PC-3.                                    19930000
197600*                                                                 19940000
197700     WRITE PRINT-LINE FROM TOTAL-LINE-2                           19950000
197800         AFTER ADVANCING PC-2.                                    19960000
197900*                                                                 19970000
198000*                                                                 19980000
198100***************************************************************** 19990000
198200 X100-OPEN-BG-DEPT-CURSOR.                                        20000000
198300     MOVE 'X100-OPEN-BG-DEPT-CURSOR' TO PV-PARAGRAPH-NAME.        20010000
198400     MOVE 'OPEN BG-DEPT CURSOR'      TO PV-DB2-OPER-ATTEMPTED.    20020000
198500                                                                  20030000
198600     EXEC SQL                                                     20040000
198700         OPEN BG_DEPT_CSR                                         20050000
198800     END-EXEC                                                     20060000
198900                                                                  20070000
199000     EVALUATE TRUE                                                20080000
199100         WHEN SQLCODE = ZERO                                      20090000
199200         WHEN SQLCODE = PC-ROW-NOT-FOUND                          20100000
199300             CONTINUE                                             20110000
199400         WHEN OTHER                                               20120000
199500             PERFORM Z999-SQL-ABEND                               20130000
199600       END-EVALUATE.                                              20140000
199700*                                                                 20150000
199800***************************************************************** 20160000
199900 X200-OPEN-ITEM-CURSOR.                                           20170000
200000     MOVE 'X200-OPEN-ITEM-CURSOR' TO PV-PARAGRAPH-NAME.           20180000
200100     MOVE 'OPEN ITEM CURSOR'      TO PV-DB2-OPER-ATTEMPTED.       20190000
200200*                                                                 20200000
200300     EXEC SQL                                                     20210000
200400         OPEN ITEM_CSR                                            20220000
200500     END-EXEC                                                     20230000
200600                                                                  20240000
200700     EVALUATE TRUE                                                20250000
200800         WHEN SQLCODE = ZERO                                      20260000
200900         WHEN SQLCODE = PC-ROW-NOT-FOUND                          20270000
201000             CONTINUE                                             20280000
201100         WHEN OTHER                                               20290000
201200             PERFORM Z999-SQL-ABEND                               20300000
201300       END-EVALUATE.                                              20310000
201400*                                                                 20320000
201500***************************************************************** 20330000
201600 X300-OPEN-STORE-CURSOR.                                          20340000
201700     MOVE 'X300-OPEN-STORE-CURSOR' TO PV-PARAGRAPH-NAME.          20350000
201800     MOVE 'OPEN STORE CURSOR'      TO PV-DB2-OPER-ATTEMPTED.      20360000
201900*                                                                 20370000
202000     EXEC SQL                                                     20380000
202100         OPEN STORE_CSR                                           20390000
202200     END-EXEC                                                     20400000
202300                                                                  20410000
202400     EVALUATE TRUE                                                20420000
202500         WHEN SQLCODE = ZERO                                      20430000
202600         WHEN SQLCODE = PC-ROW-NOT-FOUND                          20440000
202700             CONTINUE                                             20450000
202800         WHEN OTHER                                               20460000
202900             PERFORM Z999-SQL-ABEND                               20470000
203000       END-EVALUATE.                                              20480000
203100*                                                                 20490000
203200***************************************************************** 20500000
203300 X700-OPEN-FILES.                                                 20510000
203400*                                                                 20520000
203500     OPEN INPUT ZERO-ONHAND-FILE.                                 20530024
203600*                                                                 20540000
203700     IF PV-VSAM-SUCCESSFUL                                        20550000
203800        CONTINUE                                                  20560000
203900     ELSE                                                         20570000
204000        IF PV-VSAM-EMPTY                                          20580000
204100           SET OH-FILE-EMPTY TO TRUE                              20590000
204200        ELSE                                                      20600000
204300           DISPLAY '** ABEND **'                                  20610000
204400           DISPLAY '** PROGRAM    = MRKRP120'                     20620000
204500           DISPLAY '** PARAGRAPH  = X700-OPEN-FILES'              20630000
204600           DISPLAY '** MESSAGE    = '                             20640000
204700                   'BAD VSAM OPEN, STATUS = ' PV-VSAM-STATUS      20650000
204800           MOVE +4005           TO PV-ABEND-CODE                  20660000
204900           CALL 'ILBOABN0'      USING PV-ABEND-CODE               20670000
205000        END-IF                                                    20680000
205100     END-IF.                                                      20690000
205200*                                                                 20700000
205300     OPEN INPUT  CONTROL-FILE                                     20710000
205400          OUTPUT PRINT-REPORT.                                    20720000
205500*                                                                 20730000
205600***************************************************************** 20740000
205700 Y100-CLOSE-BG-DEPT-CURSOR.                                       20750000
205800     EXEC SQL                                                     20760000
205900         CLOSE BG_DEPT_CSR                                        20770000
206000     END-EXEC                                                     20780000
206100                                                                  20790000
206200     EVALUATE TRUE                                                20800000
206300         WHEN SQLCODE = ZERO                                      20810000
206400             CONTINUE                                             20820000
206500         WHEN OTHER                                               20830000
206600             DISPLAY 'Y100-CLOSE-BG-DEPT-CURSOR'                  20840000
206700             PERFORM Z999-SQL-ABEND                               20850000
206800       END-EVALUATE.                                              20860000
206900*                                                                 20870000
207000***************************************************************** 20880000
207100 Y200-CLOSE-ITEM-CURSOR.                                          20890000
207200*                                                                 20900000
207300     EXEC SQL                                                     20910000
207400         CLOSE ITEM_CSR                                           20920000
207500     END-EXEC                                                     20930000
207600                                                                  20940000
207700     EVALUATE TRUE                                                20950000
207800         WHEN SQLCODE = ZERO                                      20960000
207900             CONTINUE                                             20970000
208000         WHEN OTHER                                               20980000
208100             DISPLAY 'Y200-CLOSE-ITEM-CURSOR'                     20990000
208200             PERFORM Z999-SQL-ABEND                               21000000
208300       END-EVALUATE.                                              21010000
208400*                                                                 21020000
208500***************************************************************** 21030000
208600 Y300-CLOSE-STORE-CURSOR.                                         21040000
208700     EXEC SQL                                                     21050000
208800         CLOSE STORE_CSR                                          21060000
208900     END-EXEC                                                     21070000
209000                                                                  21080000
209100     EVALUATE TRUE                                                21090000
209200         WHEN SQLCODE = ZERO                                      21100000
209300             CONTINUE                                             21110000
209400         WHEN OTHER                                               21120000
209500             DISPLAY 'Y300-CLOSE-STORE-CURSOR'                    21130000
209600             PERFORM Z999-SQL-ABEND                               21140000
209700       END-EVALUATE.                                              21150000
209800*                                                                 21160000
209900***************************************************************** 21170000
210000 Y700-CLOSE-FILES.                                                21180000
210100*                                                                 21190000
210200     CLOSE CONTROL-FILE                                           21200000
210300           PRINT-REPORT.                                          21210000
210400*                                                                 21220000
210500     IF OH-FILE-NOT-EMPTY                                         21230000
210600        CLOSE ZERO-ONHAND-FILE                                    21240024
210700*                                                                 21250000
210800        IF PV-VSAM-SUCCESSFUL                                     21260000
210900           CONTINUE                                               21270000
211000        ELSE                                                      21280000
211100           DISPLAY '** ABEND **'                                  21290000
211200           DISPLAY '** PROGRAM    = MRKRP120'                     21300000
211300           DISPLAY '** PARAGRAPH  = Y700-CLOSE-FILES'             21310000
211400           DISPLAY '** MESSAGE    = '                             21320000
211500                   'BAD VSAM CLOSE, STATUS = ' PV-VSAM-STATUS     21330000
211600           MOVE +4005           TO PV-ABEND-CODE                  21340000
211700           CALL 'ILBOABN0'      USING PV-ABEND-CODE               21350000
211800        END-IF                                                    21360000
211900     END-IF.                                                      21370000
212000*                                                                 21380000
212100***************************************************************** 21390000
212200*                                                                 21400000
212300*  READ CONTROL CARDS--FIRST ONE CONTAINS THE SKU SERVICE         21410000
212400*  LEVEL LIMIT AND STORE SERVICE LEVEL LIMIT, THE REST            21420000
212500*  ARE DEPARTMENT NUMBERS AND ARE PUT INTO A TABLE.  THESE        21430000
212600*  DEPARTMENTS WILL ONLY SHOW DETAIL TO THE SUBCLASS LEVEL ON     21440000
212700*  THE REPORT.                                                    21450000
212800*                                                                 21460000
212900***************************************************************** 21470000
213000 Z100-READ-CONTROL-FILE.                                          21480000
213100*                                                                 21490000
213200     READ CONTROL-FILE INTO CONTROL-DATA-IN                       21500000
213300          AT END SET EOF-CONTROL-FILE TO TRUE.                    21510000
213400*                                                                 21520000
213500     IF NOT EOF-CONTROL-FILE                                      21530000
213600        IF PV-DP-SUB = 1                                          21540000
213700           MOVE CTL-SKU-SVC-LEVEL-PCT TO PC-SKU-SVC-LEVEL-LIMIT   21550000
213800                                         HL5-SKU-LIMIT            21560000
213900           MOVE CTL-STORE-SVC-LEVEL-PCT TO                        21570000
214000                                         PC-STORE-SVC-LEVEL-LIMIT 21580000
214100                                         HL5-STORE-LIMIT          21590000
214200        ELSE                                                      21600000
214300           MOVE CTL-DEPT TO DP-DEPT-NBR (PV-DP-SUB - 1)           21610000
214400        END-IF                                                    21620000
214500     END-IF.                                                      21630000
214600*                                                                 21640000
214700***************************************************************** 21650000
214800 Z300-WRITE-DETAIL-LINE.                                          21660000
214900*                                                                 21670000
215000     IF PV-LINE-CNT > PC-MAX-LINES                                21680000
215100        PERFORM Z400-PRINT-REPORT-HEADERS                         21690000
215200     END-IF                                                       21700000
215300*                                                                 21710000
215400     WRITE PRINT-LINE FROM DETAIL-LINE-1                          21720000
215500         AFTER ADVANCING PC-1.                                    21730000
215600     ADD PC-1 TO PV-LINE-CNT.                                     21740000
215700*                                                                 21750000
215800***************************************************************** 21760000
215900 Z400-PRINT-REPORT-HEADERS.                                       21770000
216000*                                                                 21780000
216100     ADD PC-1 TO PV-PAGE-CNT.                                     21790000
216200     MOVE PV-PAGE-CNT TO DP132-PAGE-NUMBER.                       21800000
216300*                                                                 21810000
216400     WRITE PRINT-LINE FROM DP132-STANDRD-HEADER-132-COLS          21820000
216500         AFTER ADVANCING PAGE.                                    21830000
216600*                                                                 21840000
216700     WRITE PRINT-LINE FROM HEADING-LINE-2                         21850000
216800         AFTER ADVANCING PC-1.                                    21860000
216900*                                                                 21870000
217000     WRITE PRINT-LINE FROM HEADING-LINE-3                         21880000
217100         AFTER ADVANCING PC-2.                                    21890000
217200*                                                                 21900000
217300     WRITE PRINT-LINE FROM HEADING-LINE-4                         21910000
217400         AFTER ADVANCING PC-2.                                    21920000
217500*                                                                 21930000
217600     WRITE PRINT-LINE FROM HEADING-LINE-5                         21940000
217700         AFTER ADVANCING PC-1.                                    21950000
217800*                                                                 21960000
217900     WRITE PRINT-LINE FROM BLANK-LINE                             21970000
218000         AFTER ADVANCING PC-1.                                    21980000
218100*                                                                 21990000
218200     MOVE ZERO TO PV-LINE-CNT.                                    22000000
218300*                                                                 22010000
218400***************************************************************** 22020000
218500 Z500-START-BROWSE-OH-FILE.                                       22030000
218600*                                                                 22040000
218700     MOVE SPACES TO PV-VSAM-STATUS.                               22050000
218800*                                                                 22060000
218900     START ZERO-ONHAND-FILE                                       22070024
219000         KEY GREATER THAN ZERO-ONHAND-KEY.                        22080024
219100*                                                                 22090000
219200     IF PV-VSAM-SUCCESSFUL OR PV-VSAM-NOT-FOUND                   22100000
219300        CONTINUE                                                  22110000
219400     ELSE                                                         22120000
219500        DISPLAY '** ABEND **'                                     22130000
219600        DISPLAY '** PROGRAM    = MRKRP120'                        22140000
219700        DISPLAY '** PARAGRAPH  = Z500-START-BROWSE-OH-FILE'       22150000
219800        DISPLAY '** MESSAGE    = '                                22160000
219900                'BAD VSAM READ, STATUS = ' PV-VSAM-STATUS         22170000
220000        MOVE +4005           TO PV-ABEND-CODE                     22180000
220100        CALL 'ILBOABN0'      USING PV-ABEND-CODE                  22190000
220200     END-IF.                                                      22200000
220300*                                                                 22210000
220400***************************************************************** 22220000
220500 Z600-READ-NEXT-OH-FILE.                                          22230000
220600*                                                                 22240000
220700     MOVE SPACES TO PV-VSAM-STATUS.                               22250000
220800*                                                                 22260000
220900     READ ZERO-ONHAND-FILE NEXT RECORD                            22270024
221000        INTO MR119-ZERO-ONHAND-RECORD.                            22280024
221100*                                                                 22290000
221200     IF PV-VSAM-SUCCESSFUL                                        22300000
221300        CONTINUE                                                  22310000
221400     ELSE                                                         22320000
221500        SET END-OF-ITEM-STORES TO TRUE                            22330000
221600     END-IF.                                                      22340000
221700*                                                                 22350000
221800*                                                                 22360000
221900***************************************************************** 22370000
222000 Z999-SQL-ABEND.                                                  22380000
222100*                                                                 22390000
222200     SET ABEND-4013            TO TRUE.                           22400000
222300     DISPLAY '**  ABEND     **'.                                  22410000
222400     DISPLAY '**  PROGRAM   **  = MRKRP120'.                      22420000
222500     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            22430000
222600     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        22440000
222700                                                                  22450000
222800*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         22460000
222900*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        22470000
223000                                                                  22480000
223100     COPY DPPD004.                                                22490000
223200                                                                  22500000
223300     CALL 'ILBOABN0'  USING ABEND-CODE.                           22510000
223400*                                                                 22520000
223500***************************************************************** 22530000
223600***********************END OF PROGRAM**************************** 22540000
