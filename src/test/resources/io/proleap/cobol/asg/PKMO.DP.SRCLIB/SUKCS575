000100*-----------------------*                                         00010018
000200 IDENTIFICATION DIVISION.                                         00020018
000300*-----------------------*                                         00030018
000400 PROGRAM-ID.    SUKCS575.                                         00040018
000500 AUTHOR.        GERMAN BANDA.                                     00050018
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060018
000700 DATE-WRITTEN.  11-01-2001.                                       00070018
000800 DATE-COMPILED.                                                   00080018
000900*----------------------------------------------------------------*00090018
001000*    E575 - SU -RANKING MAINTENANCE CRIT SPEC                    *00100018
001100*                                                                *00110018
001200*    THIS PROGRAM WILL BE USED TO DISPLAY AND MAINTAIN AUDIT     *00120018
001300*    RANKINGS                                                    *00130018
001400*    THE ASSOCIATE CAN SELECT AN FKEY TO GO TO SCREENS THAT      *00140018
001500*    CAN ADD RANK, UPDATE RANK OR DISPLAY A VEND RANK LIST.      *00150018
001600*    TO UPDATE A RANK, THE RANK MUST EXIST, TO ADD A RANK OR GO   00160018
001610*    TO LIST, NO INPUT IS REQUIRED                                00161018
001130*                                                                 00161119
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00161219
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00161319
001620*----------------------------------------------------------------*00162018
001630 ENVIRONMENT DIVISION.                                            00163018
001640 DATA DIVISION.                                                   00164018
001650                                                                  00165018
001660 WORKING-STORAGE SECTION.                                         00166018
001670*----------------------------------------------------------------*00167018
001680*   PROGRAM CONSTANTS                                            *00168018
001690*----------------------------------------------------------------*00169018
001700 01  PC-PROGRAM-CONSTANTS.                                        00170018
001800     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'SU575A  '. 00180018
001900     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'SUKM575 '. 00190018
002000     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'SUKCS575'. 00200018
002100     05  PC-MAX-RETRIES            PIC S9(04)  VALUE  +2.         00210018
002200     05  PC-01                     PIC  X(02)  VALUE '01'.        00220018
002300*                                                                 00230018
002400                                                                  00240018
002500*----------------------------------------------------------------*00250018
002600*   PROGRAM VARIABLES                                            *00260018
002700*----------------------------------------------------------------*00270018
002800 01  PV-PROGRAM-VARIABLES.                                        00280018
002900     05  PV-RETRY-COUNT            PIC S9(04)  VALUE ZERO         00290018
003000                                   COMP SYNC.                     00300018
003100     05  PV-DB2-COUNT              PIC S9(09)   VALUE +0          00310018
003200                                               COMP-3.            00320018
003300     05  PV-CICS-RESP              PIC S9(08)  VALUE ZEROES       00330018
003400                                   COMP SYNC.                     00340018
003500     05  PV-CICS-RESPONSE          PIC S9(08)  VALUE ZEROES       00350018
003600                                   COMP SYNC.                     00360018
003700*-----------------------------------------------------------------00370018
003800*                                                                 00380018
003900*-----------------------------------------------------------------00390018
004000 01  DK-DB2-KEYS.                                                 00400018
004100     05  DK-PRINTER-ID                  PIC X(08)   VALUE SPACES. 00410018
004200                                                                  00420018
004300*----------------------------------------------------------------*00430018
004400*  SYSTEM MESSAGES                                               *00440018
004500*----------------------------------------------------------------*00450018
004600*   00007 = REQUIRED ENTRY                                        00460018
004700*   02843  SU   YOU DO NOT HAVE AUTHORITY TO ADD A RANK           00470018
004800*   02844  SU   YOU DO NOT HAVE THE AUTHORITY TO UPDATE RANK      00480018
004900*   02845  SU   AUDIT RANK ALREADY EXISTS                         00490018
005000*   02846  SU   INVALID AUDIT RANK                                00500018
005100*----------------------------------------------------------------*00510018
005200 01  PC-TSYMSG-NUMBERS.                                           00520018
005300     05  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.          00530018
005400     05  PC-TSYMSG-02843       PIC  9(05)  VALUE  02843.          00540018
005500     05  PC-TSYMSG-02844       PIC  9(05)  VALUE  02844.          00550018
005600     05  PC-TSYMSG-02845       PIC  9(05)  VALUE  02845.          00560018
005700     05  PC-TSYMSG-02846       PIC  9(05)  VALUE  02846.          00570018
005800                                                                  00580018
005900                                                                  00590018
006000*----------------------------------------------------------------*00600018
006100*   SWITCHES                                                     *00610018
006200*----------------------------------------------------------------*00620018
006300 01  PS-PROGRAM-SWITCHES.                                         00630018
006400     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00640018
006500         88  PS-ERROR                          VALUE  'Y'.        00650018
006600         88  PS-NO-ERROR                       VALUE  'N'.        00660018
006700     05  PS-ACCESS-SW                   PIC  X(01)  VALUE 'N'.    00670018
006800         88  PS-ACCESS-ALLOWED                      VALUE 'Y'.    00680018
006900         88  PS-ACCESS-NOT-ALLOWED                  VALUE 'N'.    00690018
007000                                                                  00700018
007100*----------------------------------------------------------------*00710018
007200*   PROGRAM MESSAGES                                             *00720018
007300*----------------------------------------------------------------*00730018
007400 01  PM-PROGRAM-MESSAGES.                                         00740018
007500     05  PM-ABEND-INFO-A.                                         00750018
007600         10  FILLER                PIC X(15)   VALUE              00760018
007700                                   'DP020-SRC-AID: '.             00770018
007800         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      00780018
007900         10  FILLER                PIC X(19)   VALUE              00790018
008000                                   '. DP020-FK-ACTION: '.         00800018
008100         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      00810018
008200         10  FILLER                PIC X(22)   VALUE              00820018
008300                                   '. DP020-FK-DISPN-IND: '.      00830018
008400         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      00840018
008500         10  FILLER                PIC X(01)   VALUE '.'.         00850018
008600         10  FILLER                PIC X(19)   VALUE SPACE.       00860018
008700                                                                  00870018
008800*----------------------------------------------------------------*00880018
008900*    MAP LAYOUT                                                  *00890018
009000*----------------------------------------------------------------*00900018
009100     COPY SUKM575.                                                00910018
009200                                                                  00920018
009300                                                                  00930018
009400*----------------------------------------------------------------*00940018
009500**  SECURITY SUBROUTINE PARAMETERS                                00950018
009600*----------------------------------------------------------------*00960018
009700     COPY DPWS008.                                                00970019
009800                                                                  00980018
009900                                                                  00990018
010000*----------------------------------------------------------------*01000018
010100*    ATTRIBUTE SETTINGS COPYBOOK.                                *01010018
010200*----------------------------------------------------------------*01020018
010300     COPY DPWS015.                                                01030019
010400                                                                  01040018
010500                                                                  01050018
010600*----------------------------------------------------------------*01060018
010700*    FUNCTION KEYS COPYBOOK                                      *01070018
010800*----------------------------------------------------------------*01080018
010900     COPY DPWS016.                                                01090019
011000                                                                  01100018
011100                                                                  01110018
011200*----------------------------------------------------------------*01120018
011300*    ABEND PROCESSING COPYBOOK.                                  *01130018
011400*----------------------------------------------------------------*01140018
011500     COPY DPWS013.                                                01150019
011600                                                                  01160018
011700                                                                  01170018
011800*----------------------------------------------------------------*01180018
012000*  PARAMETERS FOR CALLING CICS ARCHITECTURE API                  *01200019
012100*----------------------------------------------------------------*01210018
012200     COPY DPWS030.                                                01220019
012200     COPY DPWS930.                                                01221019
012300                                                                  01230018
012400                                                                  01240018
012500*----------------------------------------------------------------*01250018
012600*    STANDARD COMMAREA.                                          *01260018
012700*----------------------------------------------------------------*01270018
012800     COPY DPWS020.                                                01280019
012900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01290018
013000                                                                  01300018
013100*----------------------------------------------------------------*01310018
013200*    INTER-APPLICATION COMMAREA.                                 *01320018
013300*----------------------------------------------------------------*01330018
013400         10  INTER-APPL-COMM-AREA PIC X(200).                     01340018
013500     COPY SUWS014.                                                01350019
013600                                                                  01360018
013700                                                                  01370018
013800*----------------------------------------------------------------*01380018
013900*    SPECIFIC COMMMAREA FOR SUKCS575.                            *01390018
014000*----------------------------------------------------------------*01400018
014100         10  ASC-SPECIFIC-COMMAREA.                               01410018
014200             15  ASC-VEND-RNK-CDE            PIC  X(06).          01420018
014300             15  ASC-VEND-RNK-DESC           PIC  X(30).          01430018
014400             15  ASC-ACTV-SMTHNG-EXISTS-SW   PIC  X(1).           01440018
014500                 88  ASC-AUDIT-RANK-EXISTS        VALUE  'Y'.     01450018
014600                 88  ASC-NO-AUDIT-RANK-EXISTS     VALUE  'N'.     01460018
014700             15  FILLER                      PIC  X(163).         01470018
014800         10  ASC-HOLD-INTER-APPL             PIC X(200).          01480018
014900                                                                  01490018
015000                                                                  01500018
015100*-----------------------------------------------------------------01510018
015200*  SQL AND COBOL DECLARATIONS FOR THE AUDIT RANKING CODE TABLE    01520018
015300*  (SUT_VND_RNKG_CDE)                                             01530018
015400*-----------------------------------------------------------------01540018
015500     EXEC SQL                                                     01550018
015600          INCLUDE SUT00016                                        01560018
015700     END-EXEC.                                                    01570018
015800                                                                  01580018
015900                                                                  01590018
016000*-----------------------------------------------------------------01600018
016100*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                01610018
016200*-----------------------------------------------------------------01620018
016300     EXEC SQL                                                     01630018
016400          INCLUDE SQLCA                                           01640018
016500     END-EXEC.                                                    01650018
016600                                                                  01660018
016700                                                                  01670018
016800*-----------------------------------------------------------------01680018
016900*                                                                 01690018
017000*-----------------------------------------------------------------01700018
017100                                                                  01710018
017200                                                                  01720018
017300 LINKAGE SECTION.                                                 01730018
017400                                                                  01740018
017500                                                                  01750018
017600 01  DFHCOMMAREA.                                                 01760018
017700     05  FILLER                         OCCURS  1 TO 4072 TIMES   01770018
017800                                        DEPENDING ON EIBCALEN.    01780018
017900         10  FILLER                     PIC X.                    01790018
018000                                                                  01800018
018100                                                                  01810018
018200 PROCEDURE DIVISION.                                              01820018
018300*----------------------------------------------------------------*01830018
018400*  THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM.   *01840018
018500*  THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API    *01850018
018600*  MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.              *01860018
018700*                                                                *01870018
018800*  THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE    *01880018
018900*  LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.         *01890018
019000*----------------------------------------------------------------*01900018
019100 0000-MAIN-MODULE.                                                01910018
019200     INITIALIZE DP030-CICS-API-FIELDS.                            01920018
019300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01930018
019400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01940018
019500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01950018
019600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01960018
019700     MOVE LENGTH OF SU575AI        TO DP030-MAP-LENGTH (1).       01970018
019800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01980018
019900     PERFORM 0001-CALL-CICS-ARCH-API.                             01990018
020000                                                                  02000018
020100     PERFORM 1000-CONTROL-PROCESSING                              02010018
020200                                                                  02020018
020300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02030018
020400     PERFORM 0001-CALL-CICS-ARCH-API.                             02040018
020500                                                                  02050018
020600                                                                  02060018
020700 0001-CALL-CICS-ARCH-API.                                         02070018
020800*    CALL 'DPKCS030' USING DFHEIBLK                               02080019
020800     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02081019
020900                           DFHCOMMAREA                            02090018
021000                           DP030-CICS-API-FIELDS                  02100018
021100                           DP020-STANDARD-COMMAREA                02110018
021200                           SU575AI.                               02120018
021300*                                                                 02130018
021400     IF  DP030-RC-CALL-SUCCESSFUL                                 02140018
021500         CONTINUE                                                 02150018
021600     ELSE                                                         02160018
021700         SET DP013-NO-ROLLBACK                                    02170018
021800             DP013-XCTL-DISPLAY-RESTART                           02180018
021900             DP013-CICS-ABEND      TO TRUE                        02190018
022000         MOVE 'BEFORE 0000-MAIN-MODULE'                           02200018
022100                                   TO DP013-PARAGRAPH             02210018
022200*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX02220019
022300*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      02230019
022200         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL. RETURN-CODE O02231019
022300-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02232019
022400         MOVE DP030-RETURN-CODE                                   02240018
022500                                   TO DP013-MESSAGE-TEXT (3)      02250018
022600         PERFORM DP013-0000-PROCESS-ABEND                         02260018
022700     END-IF.                                                      02270018
022800                                                                  02280018
022900                                                                  02290018
023000*----------------------------------------------------------------*02300018
023100*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02310018
023200*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02320018
023300*----------------------------------------------------------------*02330018
023400 1000-CONTROL-PROCESSING.                                         02340018
023500                                                                  02350018
023600     EVALUATE TRUE                                                02360018
023700       WHEN DP020-NEXT-ACT-INITIAL                                02370018
023800       WHEN DP020-NEXT-ACT-RETURN                                 02380018
023900           INITIALIZE ASC-SPECIFIC-COMMAREA                       02390018
024000           PERFORM 4000-BUILD-INITIAL-PANEL                       02400018
024100                                                                  02410018
024200       WHEN DP020-NEXT-ACT-READ-MAP                               02420018
024300             PERFORM 2000-FKEY-PROCESSING                         02430018
024400                                                                  02440018
024500       WHEN OTHER                                                 02450018
024600             SET DP013-LOGIC-ABEND                                02460018
024700                 DP013-NO-ROLLBACK TO TRUE                        02470018
024800             MOVE '1000-CONTROL-PROCESSING'                       02480018
024900                                   TO  DP013-PARAGRAPH            02490018
025000             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02500018
025100                                   TO  DP013-MESSAGE-TEXT(1)      02510018
025200             MOVE DP020-NEXT-APPL-ACTIVITY                        02520018
025300                                   TO DP013-MESSAGE-TEXT(2)       02530018
025400             PERFORM DP013-0000-PROCESS-ABEND                     02540018
025500     END-EVALUATE.                                                02550018
025600                                                                  02560018
025700******************************************************************02570018
025800*----------------------------------------------------------------*02580018
025900* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02590018
026000* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02600018
026100* EDITS.                                                         *02610018
026200*----------------------------------------------------------------*02620018
026300 2000-FKEY-PROCESSING.                                            02630018
026400                                                                  02640018
026500     EVALUATE TRUE                                                02650018
026600                                                                  02660018
026700         WHEN DP020-SRC-AID = DP016-CLEAR                         02670018
026800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02680018
026900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02690018
027000                                                                  02700018
027100         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02710018
027200             INITIALIZE ASC-SPECIFIC-COMMAREA                     02720018
027300             PERFORM 4000-BUILD-INITIAL-PANEL                     02730018
027400             PERFORM 3200-RESET-ATTRIBUTES                        02740018
027500                                                                  02750018
027600         WHEN OTHER                                               02760018
027700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02770018
027800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02780018
027900             IF  PS-NO-ERROR                                      02790018
028000                 SET DP030-CONTINUE-GO TO TRUE                    02800018
028100                 PERFORM 2100-CHECK-FUNCTION-KEY                  02810018
028200             ELSE                                                 02820018
028300                 SET DP030-OVERRIDE-GO TO TRUE                    02830018
028400             END-IF                                               02840018
028500     END-EVALUATE.                                                02850018
028600                                                                  02860018
028700                                                                  02870018
028800*----------------------------------------------------------------*02880018
028900*  ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED      *02890018
029000*  FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED  *02900018
029100*  FROM THE CICS ARCHITECTURE API.                               *02910018
029200*----------------------------------------------------------------*02920018
029300 2100-CHECK-FUNCTION-KEY.                                         02930018
029400                                                                  02940018
029500     EVALUATE TRUE                                                02950018
029600*************                                                     02960018
029700*F13 ADDRANK                                                      02970018
029800*************                                                     02980018
029900         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              02990018
030000             MOVE 'SUVNDRKA' TO DP008-FUNCTION-NAME               03000018
030100             PERFORM 2105-RACF-ACCESS                             03010018
030200             IF  PS-ACCESS-NOT-ALLOWED                            03020018
030300                 SET  PS-ERROR                                    03030018
030400                      DP020-MSG-FATAL TO TRUE                     03040018
030500                 MOVE PC-TSYMSG-02843 TO DP020-MSG-NUMBER         03050018
030600                 MOVE -1              TO ARANKL                   03060018
030700                 SET  DP030-SET-CURSOR-APPL-1 TO TRUE             03070018
030800                 SET  DP030-OVERRIDE-GO TO TRUE                   03080018
030900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             03090018
031000             END-IF                                               03100018
031100                                                                  03110018
031200             IF PS-NO-ERROR                                       03120018
031300                 IF ASC-AUDIT-RANK-EXISTS                         03130018
031400                    SET  PS-ERROR                                 03140018
031500                         DP020-MSG-FATAL TO TRUE                  03150018
031600                    MOVE PC-TSYMSG-02845 TO DP020-MSG-NUMBER      03160018
031700                    MOVE -1              TO ARANKL                03170018
031800                    SET  DP030-SET-CURSOR-APPL-1 TO TRUE          03180018
031900                    SET  DP030-OVERRIDE-GO TO TRUE                03190018
032000                    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN          03200018
032100                 ELSE                                             03210018
032200                    PERFORM 2110-PREPARE-INTER-APPL-COMM          03220018
032300                 END-IF                                           03230018
032400             END-IF                                               03240018
032500*************                                                     03250018
032600*F15 UPD RANK                                                     03260018
032700*************                                                     03270018
032800         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              03280018
034000                                                                  03400018
034100             IF  PS-NO-ERROR                                      03410018
034200                 IF ASC-VEND-RNK-CDE = SPACES                     03420018
034300                    SET  PS-ERROR                                 03430018
034400                         DP020-MSG-FATAL TO TRUE                  03440018
034500                    MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER      03450018
034600                    MOVE -1              TO ARANKL                03460018
034700                    SET  DP030-SET-CURSOR-APPL-1 TO TRUE          03470018
034800                    SET  DP030-OVERRIDE-GO TO TRUE                03480018
034900                    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN          03490018
035000                 ELSE                                             03500018
035100                    IF ASC-AUDIT-RANK-EXISTS                      03510018
035200                        PERFORM 2110-PREPARE-INTER-APPL-COMM      03520018
035300                    ELSE                                          03530018
035400                        SET  PS-ERROR                             03540018
035500                             DP020-MSG-FATAL TO TRUE              03550018
035600                        MOVE PC-TSYMSG-02846 TO DP020-MSG-NUMBER  03560018
035700                        MOVE -1              TO ARANKL            03570018
035800                        SET  DP030-SET-CURSOR-APPL-1 TO TRUE      03580018
035900                        SET  DP030-OVERRIDE-GO TO TRUE            03590018
036000                        PERFORM 4400-MOVE-COMMAREA-TO-SCREEN      03600018
036100                    END-IF                                        03610018
036200                 END-IF                                           03620018
036300             END-IF                                               03630018
036400*************                                                     03640018
036500*F24 RANKLIST                                                     03650018
036600*************                                                     03660018
036700         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              03670018
036800               PERFORM 2110-PREPARE-INTER-APPL-COMM               03680018
036900                                                                  03690018
037000         WHEN DP020-SRC-AID = DP016-ENTER                         03700018
037100             CONTINUE                                             03710018
037200                                                                  03720018
037300         WHEN OTHER                                               03730018
037400             SET DP013-NO-ROLLBACK                                03740018
037500                 DP013-XCTL-DISPLAY-RESTART                       03750018
037600                 DP013-CICS-ABEND  TO TRUE                        03760018
037700             MOVE '2100-CHECK-FUNCTION-KEY'                       03770018
037800                                   TO DP013-PARAGRAPH             03780018
037900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      03790018
038000                                   TO DP013-MESSAGE-TEXT (1)      03800018
038100             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 03810018
038200                                   TO DP013-MESSAGE-TEXT (2)      03820018
038300             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                03830018
038400             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 03840018
038500                                   TO PM-A-FK-ACTION              03850018
038600             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              03860018
038700                                   TO PM-A-FK-DISPN               03870018
038800             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      03880018
038900             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        03890018
039000                                   TO DP013-MESSAGE-TEXT (4)      03900018
039100             PERFORM DP013-0000-PROCESS-ABEND                     03910018
039200     END-EVALUATE.                                                03920018
039300                                                                  03930018
039400                                                                  03940018
039500*----------------------------------------------------------------*03950018
039600* CHECK TO SEE IF USER HAS RACF AUTHORIZATION                     03960018
039700*----------------------------------------------------------------*03970018
039800 2105-RACF-ACCESS.                                                03980018
039900                                                                  03990018
040000      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  04000018
040100      SET DP008-ACCESS-TYPE-USE          TO TRUE                  04010018
040200                                                                  04020018
040300      EXEC CICS                                                   04030018
040400         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 04040018
040500              COMMAREA (DP008-SECURITY-COMMAREA)                  04050018
040600              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             04060018
040700      END-EXEC                                                    04070018
040800                                                                  04080018
040900      IF DP008-CALL-SUCCESSFUL                                    04090018
041000         IF DP008-ACCESS-ALLOWED                                  04100018
041100             SET PS-ACCESS-ALLOWED TO TRUE                        04110018
041200         ELSE                                                     04120018
041300             SET PS-ACCESS-NOT-ALLOWED TO TRUE                    04130018
041400         END-IF                                                   04140018
041500     ELSE                                                         04150018
041600         MOVE '2105-RACF-ACCESS'                                  04160018
041700                               TO DP013-PARAGRAPH                 04170018
041800          MOVE 'UNABLE TO ACCESS CICS'                            04180018
041900                               TO DP013-MESSAGE-TEXT (1)          04190018
042000          MOVE SQLCA                 TO DP013-SQLCA               04200018
042100          SET DP013-DB2-ABEND                                     04210018
042200              DP013-XCTL-DISPLAY-RESTART                          04220018
042300                               TO TRUE                            04230018
042400          PERFORM DP013-0000-PROCESS-ABEND                        04240018
042500      END-IF.                                                     04250018
042600                                                                  04260018
042700                                                                  04270018
042800*----------------------------------------------------------------*04280018
042900*  MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE    *04290018
043000*  INTER-APPLICATION COMMAREA.                                   *04300018
043100*----------------------------------------------------------------*04310018
043200 2110-PREPARE-INTER-APPL-COMM.                                    04320018
043300                                                                  04330018
043400     INITIALIZE SU014-INTER-APPL-COMMAREA.                        04340018
043500                                                                  04350018
043600     IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID) OR                04360018
043700         DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                   04370018
043800           IF ASC-VEND-RNK-CDE > SPACES                           04380018
043900              MOVE ASC-VEND-RNK-CDE     TO SU014-VEND-RNK-CDE     04390018
044000              MOVE ASC-VEND-RNK-DESC    TO SU014-VEND-RNK-DESC    04400018
044100           END-IF                                                 04410018
044200     ELSE                                                         04420018
044300     IF  DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                   04430018
044400           MOVE ASC-VEND-RNK-CDE     TO SU014-VEND-RNK-CDE        04440018
044500           MOVE ASC-VEND-RNK-DESC    TO SU014-VEND-RNK-DESC       04450018
044600     END-IF.                                                      04460018
044700                                                                  04470018
044800*----------------------------------------------------------------*04480018
044900* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*04490018
045000* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *04500018
045100* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *04510018
045200*----------------------------------------------------------------*04520018
045300 2200-MOVE-SCREEN-TO-COMMAREA.                                    04530018
045400                                                                  04540018
045500* VENDOR RANK PARAMETER                                           04550018
045600     IF  ARANKL > ZEROES                                          04560018
045700         MOVE ARANKI               TO ASC-VEND-RNK-CDE            04570018
045800     ELSE                                                         04580018
045900         IF  ARANKF = DP015-ERASE-EOF                             04590018
046000             MOVE SPACES           TO ASC-VEND-RNK-CDE            04600018
046100         END-IF                                                   04610018
046200     END-IF.                                                      04620018
046300                                                                  04630018
046400*----------------------------------------------------------------*04640018
046500* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *04650018
046600* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *04660018
046700* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*04670018
046800* IN THE DESTINATION PROGRAM, NOT HERE.                          *04680018
046900*----------------------------------------------------------------*04690018
047000 3000-EDIT-DATA-IN-COMMAREA.                                      04700018
047100                                                                  04710018
047200     PERFORM 3200-RESET-ATTRIBUTES.                               04720018
047300     IF ASC-VEND-RNK-CDE  NOT = SPACES                            04730018
047400        PERFORM 4750-CHECK-VND-RNK-DESC                           04740018
047500        MOVE SUT00016-VND-RNKG-DESC TO ARNKDSCO                   04750018
047600                                       ASC-VEND-RNK-DESC          04760018
047700     END-IF.                                                      04770018
047800*----------------------------------------------------------------*04780018
047900*  MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE  *04790018
048000*  MAP.                                                          *04800018
048100*----------------------------------------------------------------*04810018
048200 3200-RESET-ATTRIBUTES.                                           04820018
048300     MOVE DP015-UNP-ALP-NOR-OFF    TO ARANKA.                     04830018
048400     MOVE DP015-GREEN              TO ARANKC.                     04840018
048500     MOVE DP015-HL-OFF             TO ARANKH.                     04850018
048600     MOVE DP015-UNDERLINE          TO ARANKH.                     04860018
048700                                                                  04870018
048800*----------------------------------------------------------------*04880018
048900*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *04890018
049000*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *04900018
049100*  IT HERE.                                                      *04910018
049200*----------------------------------------------------------------*04920018
049300 4000-BUILD-INITIAL-PANEL.                                        04930018
049400     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        04940018
049500     MOVE -1                       TO ARANKL.                     04950018
049600                                                                  04960018
049700     MOVE SPACES                   TO ARANKO                      04970018
049800                                      ARNKDSCO.                   04980018
049900                                                                  04990018
050000*----------------------------------------------------------------*05000018
050100*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *05010018
050200*----------------------------------------------------------------*05020018
050300 4400-MOVE-COMMAREA-TO-SCREEN.                                    05030018
050400                                                                  05040018
050500     MOVE ASC-VEND-RNK-CDE         TO ARANKO.                     05050018
050600                                                                  05060018
050700     PERFORM 4750-CHECK-VND-RNK-DESC.                             05070018
050800     MOVE SUT00016-VND-RNKG-DESC   TO ARNKDSCO.                   05080018
050900******************************************************************05090018
051000*----------------------------------------------------------------*05100018
051100*  CHECK IF THE RANK NAME EXISTS, IF SO, RETURN DESCRIPTION      *05110018
051200*----------------------------------------------------------------*05120018
051300 4750-CHECK-VND-RNK-DESC.                                         05130018
051400     MOVE  ASC-VEND-RNK-CDE TO SUT00016-VND-RNKG-CDE.             05140018
051500                                                                  05150018
051600     PERFORM                                                      05160018
051700         WITH TEST AFTER                                          05170018
051800         VARYING PV-RETRY-COUNT                                   05180018
051900         FROM 1 BY 1                                              05190018
052000         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 05200018
052100             OR (SQLCODE = +0)                                    05210018
052200             OR (SQLCODE = +100))                                 05220018
052300                                                                  05230018
052400     EXEC SQL                                                     05240018
052500         SELECT VND_RNKG_DESC                                     05250018
052600           INTO :SUT00016-VND-RNKG-DESC                           05260018
052700           FROM SUT_VND_RNKG_CDE                                  05270018
052800           WHERE VND_RNKG_CDE = :SUT00016-VND-RNKG-CDE            05280018
052900     END-EXEC                                                     05290018
053000                                                                  05300018
053100         EVALUATE TRUE                                            05310018
053200             WHEN SQLCODE = +0                                    05320018
053300                SET ASC-AUDIT-RANK-EXISTS TO TRUE                 05330018
053400             WHEN SQLCODE = +100                                  05340018
053500                  SET ASC-NO-AUDIT-RANK-EXISTS TO TRUE            05350018
053600                  MOVE SPACES  TO SUT00016-VND-RNKG-DESC          05360018
053700             WHEN SQLCODE = -904                                  05370018
053800             WHEN SQLCODE = -913                                  05380018
053900                  CONTINUE                                        05390018
054000             WHEN SQLWARN0 NOT = +0                               05400018
054100             WHEN SQLCODE < +0                                    05410018
054200             WHEN SQLCODE > +0                                    05420018
054300                  MOVE '4750-CHECK-VND-RNK-DESC'                  05430018
054400                                  TO DP013-PARAGRAPH              05440018
054500                  MOVE 'UNSUCCESSFUL SELECT OF VEND RNK CDE  '    05450018
054600                                  TO DP013-MESSAGE-TEXT (1)       05460018
054700                  MOVE SQLCA      TO DP013-SQLCA                  05470018
054800                  MOVE 'SUT00016' TO DP013-DB2-TABLE-NAME (1)     05480018
054900                  SET DP013-DB2-ABEND                             05490018
055000                      DP013-XCTL-DISPLAY-RESTART                  05500018
055100                                  TO TRUE                         05510018
055200              PERFORM DP013-0000-PROCESS-ABEND                    05520018
055300         END-EVALUATE                                             05530018
055400     END-PERFORM.                                                 05540018
055500                                                                  05550018
055600     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          05560018
055700         MOVE '4750-CHECK-VND-RNK-DESC'                           05570018
055800                                  TO DP013-PARAGRAPH              05580018
055900         MOVE 'MAX RETRIES EXCEEDED ON SELECT FACILITY TABLE'     05590018
056000                                  TO DP013-MESSAGE-TEXT (1)       05600018
056100         MOVE SQLCA               TO DP013-SQLCA                  05610018
056200         MOVE 'SUT_VND_RNKG_CDE'  TO DP013-DB2-TABLE-NAME (1)     05620018
056300         SET DP013-DB2-ABEND                                      05630018
056400             DP013-XCTL-DISPLAY-RESTART                           05640018
056500                                  TO TRUE                         05650018
056600         PERFORM DP013-0000-PROCESS-ABEND                         05660018
056700     END-IF.                                                      05670018
056800                                                                  05680018
056900                                                                  05690018
057000*----------------------------------------------------------------*05700018
057100*    ABEND PROCESSOR MODULE                                      *05710018
057200*----------------------------------------------------------------*05720018
057300                                                                  05730018
057400     COPY DPPD013.                                                05740019
