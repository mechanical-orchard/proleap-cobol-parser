000100 IDENTIFICATION DIVISION.                                         00010007
000200 PROGRAM-ID.             ARKUP015.                                00020007
000300 AUTHOR.                 TODD MICHALEK.                           00030007
000400 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00040007
000500 DATE-WRITTEN.           APRIL 1995.                              00050007
000600 DATE-COMPILED.                                                   00060007
000700******************************************************************00070007
000800*                                                                *00080007
000900*    ARKUP015 - UPDATE MONTHLY EMPLOYEE ACTIVITY BY STORE        *00090007
001000*                                                                *00100007
001100*       THIS PROGRAM MERGES THE CREDIT POSTING FILE AND THE      *00110007
001200*  EMPLOYEE ACTIVITY BY STORE FILE TO PRODUCE AN UPDATED         *00120007
001300*  EMPLOYEE ACTIVITY BY STORE FILE.  EACH EMPLOYEE ACTIVITY      *00130007
001400*  RECORD TRACKS THE ACTIVITY BY DAY AT A PARTICULAR STORE OVER  *00140007
001500*  ONE ACCOUNTING MONTH.  A CONTROL CARD IS READ AT THE          *00150007
001600*  BEGINNING OF THE PROGRAM TO ACQUIRE THE P.O.S. DATE AND TO    *00160007
001700*  DETERMINE THE EMPLOYEE ACTIVITY PROCESSING METHOD (REPLACE OR *00170007
001800*  UPDATE) REQUESTED FOR THE CURRENT RUN.  THE CALENDAR ROUTINE  *00180007
001900*  IS USED TO VALIDATE THE P.O.S. DATE, AND TO GATHER FISCAL     *00190007
002000*  PERIOD INFORMATION IN ORDER TO COMPUTE THE DAY NUMBER WITHIN  *00200007
002100*  THE CURRENT ACCOUNTING MONTH.  THIS DAY NUMBER BECOMES THE    *00210007
002200*  OCCURANCE OF THE DAILY ACTIVITY TABLE IN EACH EMPLOYEE        *00220007
002300*  ACTIVITY RECORD THAT IS PROCESSED.                            *00230007
002400*                                                                *00240007
002500*       MERGE LOGIC IS USED TO UPDATE THE EMPLOYEE ACTIVITY FILE.*00250007
002600*  AN ENTIRE STORE'S SALES AND RETURNS ARE ACCUMULATED FROM THE  *00260007
002700*  CREDIT POSTING FILE AND USED IN THE MERGE (RATHER THAN        *00270007
002800*  MERGING INDIVIDUAL RECORDS).  THE ACCOUNT NUMBER ON EACH      *00280007
002900*  TRANSACTION RECORD IS LOOKED UP ON THE EMPLOYEE ACCOUNT FILE. *00290007
003000*  IF THE ACCOUNT IS ACTIVELY RECEIVING DISCOUNT, THE            *00300007
003100*  TRANSACTION AMOUNT IS ACCUMULATED, BY TRANSACTION TYPE, FOR   *00310007
003200*  THE STORE.  THE CATAGORIES ACCUMULATED ARE SALES, RETURNS,    *00320007
003300*  DISCOUNT CREDIT, AND DISCOUNT DEBIT.  MISCELLANEOUS           *00330007
003400*  TRANSACTIONS OTHER THAN DISCOUNT ARE NOT ACCUMULATED.         *00340007
003500*                                                                *00350007
003600*  NOTE: THIS PROGRAM ASSUMES THE CREDIT POSTING FILE IS IN      *00360007
003700*        ASCENDING STORE NUMBER ORDER, AND THE EMPLOYEE ACTIVITY *00370007
003800*        BY STORE FILE IS IN ASCENDING STORE NUMBER ORDER.       *00380007
003900******************************************************************00390007
P1043 * 06/15/2015 ACCENTURE                                           *00390127
P1043 *    CHG0118696                                                  *00390231
P1043 *   -ADDED CHANGES IN 5000-ACCUMULATE-STORE-DETAIL PARAGRAPH     *00390327
P1043 *    TO HANDLE ONLY 12 DIGIT ACCOUNT NUMBER AS IN THIS PARAGRAPH *00390427
P1043 *    IT FETCHES THE DATA FROM ART_EMP_DISC TABLE BASED ON        *00390527
P1043 *    THE ACCOUNT NUMBER AND THE TABLE DOES NOT CONTAIN 18 DIGIT  *00390627
P1043 *    ACCOUNT NUMBER.                                             *00390727
P10237******************************************************************00391027
P10237* DATE:        06/03/2015                                        *00392016
P10237* WR/IR#:      CHG0104429                                        *00393016
P10237* PROGRAMMER:  COGNIZANT                                         *00394016
P10237* DESCRIPTION: CHANGES TO DETOKENIZE THE CARD NUMBER FROM POSTING*00395016
P10237*              FILE TO QUERY AGAINST ART EMP TABLE.              *00396016
P10237******************************************************************00399016
C25054* DATE:        08/06/2015                                        *00399134
C25054* WR/IR#:      CHG0125054                                        *00399234
C25054* PROGRAMMER:  COGNIZANT                                         *00399334
C25054* DESCRIPTION: CHANGES TO REMOVE THE DETOKENIZE LOGIC OF CARD    *00399435
C25054*              NUMBER FROM POSTING FILE.                         *00399535
C25054******************************************************************00399635
004000 ENVIRONMENT DIVISION.                                            00400007
004100 CONFIGURATION SECTION.                                           00410007
004200 SOURCE-COMPUTER.        IBM-3090.                                00420007
004300 OBJECT-COMPUTER.        IBM-3090.                                00430007
004400                                                                  00440007
004500 INPUT-OUTPUT SECTION.                                            00450007
004600                                                                  00460007
004700 FILE-CONTROL.                                                    00470007
004800                                                                  00480007
004900     SELECT CR-POSTING-FILE                                       00490007
005000         ASSIGN TO INP01.                                         00500007
005100                                                                  00510007
005200     SELECT STORE-EMPL-ACTIV-FILE                                 00520007
005300         ASSIGN TO INP02.                                         00530007
005400                                                                  00540007
005500     SELECT NEW-STORE-EMPL-ACTIV-FILE                             00550007
005600         ASSIGN TO OUT01.                                         00560007
005700                                                                  00570007
005800 DATA DIVISION.                                                   00580007
005900                                                                  00590007
006000 FILE SECTION.                                                    00600007
006100                                                                  00610007
006200 FD  CR-POSTING-FILE                                              00620007
006300     RECORDING MODE IS F                                          00630007
006400     BLOCK CONTAINS 0 RECORDS                                     00640007
006500     LABEL RECORDS ARE STANDARD.                                  00650007
006600                                                                  00660007
006700 01  CR-POSTING-RECORD           PIC X(157).                      00670014
006800                                                                  00680007
006900 FD  STORE-EMPL-ACTIV-FILE                                        00690007
007000     RECORDING MODE IS F                                          00700007
007100     BLOCK CONTAINS 0 RECORDS                                     00710007
007200     LABEL RECORDS ARE STANDARD.                                  00720007
007300                                                                  00730007
007400 01  STORE-EMPL-ACTIV-RECORD     PIC X(850).                      00740007
007500                                                                  00750007
007600 FD  NEW-STORE-EMPL-ACTIV-FILE                                    00760007
007700     RECORDING MODE IS F                                          00770007
007800     BLOCK CONTAINS 0 RECORDS                                     00780007
007900     LABEL RECORDS ARE STANDARD.                                  00790007
008000                                                                  00800007
008100 01  NS-NEW-STORE-EMPL-ACTIV-RECORD                               00810007
008200                                 PIC X(850).                      00820007
008300                                                                  00830007
008400 WORKING-STORAGE SECTION.                                         00840007
008500******************************************************************00850007
008600*    ACCOUNTS RECEIVABLE - CREDIT - CONSTANTS                     00860007
008700******************************************************************00870007
008800     COPY ARWS004.                                                00880007
008900                                                                  00890008
009000******************************************************************00900007
009100*    CREDIT POSTING FILE LAYOUT                                   00910007
009200******************************************************************00920007
009300     COPY ARRD021.                                                00930007
009400                                                                  00940008
009500******************************************************************00950007
009600*  EMPLOYEE ACTIVITY BY STORE FILE RECORD LAYOUT - INPUT          00960007
009700******************************************************************00970007
009800     COPY ARRD007I.                                               00980007
009900                                                                  00990008
010000******************************************************************01000007
010100*  EMPLOYEE ACTIVITY BY STORE FILE RECORD LAYOUT - OUTPUT         01010007
010200******************************************************************01020007
010300     COPY ARRD007O.                                               01030007
010400                                                                  01040008
010500******************************************************************01050007
010600*  PARAMETER LIST FOR THE CALENDAR SUBROUTINE (DPKUT500)          01060007
010700******************************************************************01070007
010800     COPY DPWS500.                                                01080007
010900                                                                  01090008
011000******************************************************************01100008
011100*  MESSAGE AREA FOR DB2 ERRORS                                    01110008
011200******************************************************************01120008
011300     COPY DPWS004.                                                01130008
011400                                                                  01140008
011500 01  ABEND-CODE                  PIC S9(4)    VALUE ZERO          01150007
011600                                              COMP SYNC.          01160007
011700     88  AC-CONTROL-CARD-ERROR                VALUE +4003.        01170007
011800     88  AC-DB2-ERROR                         VALUE +4013.        01180008
011900                                                                  01190007
012000 01  PS-PROGRAM-SWITCHES.                                         01200007
012100     05  PS-END-OF-SALES-RETURNS-IND                              01210007
012200                                 PIC X(1)     VALUE 'N'.          01220007
012300         88  PS-END-OF-SALES-RETURNS-FILE     VALUE 'Y'.          01230007
012400     05  PS-END-OF-EMPL-ACTIV-IND                                 01240007
012500                                 PIC X(1)     VALUE 'N'.          01250007
012600         88  PS-END-OF-EMPL-ACTIV-FILE        VALUE 'Y'.          01260007
012700     05  PS-EMPLOYEE-ACCOUNT-IND PIC X(1)     VALUE 'N'.          01270007
012800         88  PS-NOT-AN-EMPLOYEE-ACCOUNT       VALUE 'N'.          01280007
012900         88  PS-EMPLOYEE-ACCOUNT              VALUE 'Y'.          01290007
013000                                                                  01300007
013100 01  PC-PROGRAM-CONSTANTS.                                        01310007
013200     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'ARKUP015'.   01320007
013300     05  PC-DAYS-IN-WEEK         PIC S9(4)    VALUE +7            01330007
013400                                              COMP SYNC.          01340007
013500                                                                  01350007
013600 01  PV-PROGRAM-VARIABLES.                                        01360007
013700     05  PV-ACCT-NBR             PIC 9(10)    VALUE ZERO.         01370010
013701     05  PV-DAY-INDEX            PIC 9(2)     VALUE ZERO.         01370110
013710     05  PV-X                    PIC X(01)    VALUE SPACES.       01371009
013800     05  PV-PARAGRAPH-NAME       PIC X(30)    VALUE SPACES.       01380007
013900     05  PV-DB2-OPERATION        PIC X(40)    VALUE SPACES.       01390008
014000     05  PV-OPERATION-MSG-1      PIC X(40)    VALUE SPACES.       01400008
014100     05  PV-OPERATION-MSG-2.                                      01410007
014200         10  PV-OPERATION-MSG-2-MSG                               01420007
014300                                 PIC X(17).                       01430007
014400         10  PV-OPERATION-MSG-2-CODE                              01440007
014500                                 PIC X(02).                       01450007
014600         10  FILLER              PIC X(21).                       01460007
014700                                                                  01470007
014800 01  CK-CURRENT-KEY-AREA.                                         01480007
014900     05  CK-STORE-NUMBER         PIC X(4)     VALUE SPACES.       01490007
015000     05  CK-EMPLOYEE-SALES       PIC S9(9)V99 VALUE ZERO          01500007
015100                                              COMP-3.             01510007
015200     05  CK-EMPLOYEE-DISCOUNT-CREDIT                              01520007
015300                                 PIC S9(9)V99 VALUE ZERO          01530007
015400                                              COMP-3.             01540007
015500     05  CK-EMPLOYEE-RETURNS     PIC S9(9)V99 VALUE ZERO          01550007
015600                                              COMP-3.             01560007
015700     05  CK-EMPLOYEE-DISCOUNT-DEBIT                               01570007
015800                                 PIC S9(9)V99 VALUE ZERO          01580007
015900                                              COMP-3.             01590007
016000                                                                  01600008
016100 01  CC-CONTROL-CARD.                                             01610007
016200     05  CC-CONTROL-CARD-DISPLAY.                                 01620007
016300         10  CC-POS-DATE-MDY     PIC 9(8)     VALUE ZERO.         01630007
016400         10  CC-PROCESSING-METHOD                                 01640007
016500                                 PIC X(1)     VALUE SPACES.       01650007
016600             88  CC-REPLACE-DAILY-ACTIVITY    VALUE 'R'.          01660007
016700             88  CC-UPDATE-DAILY-ACTIVITY     VALUE 'U'.          01670007
016800     05  FILLER                  PIC X(71)    VALUE SPACES.       01680007
016900                                                                  01690008
017000******************************************************************01700008
017100* ART_EMP_DISC                                                  **01710008
017200******************************************************************01720008
017300     EXEC SQL                                                     01730008
017400         INCLUDE ART00001                                         01740008
017500     END-EXEC.                                                    01750008
017600                                                                  01760008
017700******************************************************************01770008
017800* SQL COMMON AREA                                               **01780008
017900******************************************************************01790008
018000     EXEC SQL                                                     01800008
018100         INCLUDE SQLCA                                            01810008
018200     END-EXEC.                                                    01820008
018300                                                                  01830008
018400 PROCEDURE DIVISION.                                              01840007
018500                                                                  01850007
018600 0000-MAINLINE.                                                   01860007
018700     PERFORM 1000-INITIALIZE.                                     01870007
018800*                                                                 01880007
018900*  THIS PARAGRAPH IS PERFORMED UNTIL CK-STORE-NUMBER = HIGH-VALUES01890007
019000*  RATHER THAN UNTIL PS-END-OF-SALES-RETURNS-FILE SINCE           01900007
019100*  END-OF-FILE WILL BE REACHED DURING THE ACCUMULATION OF THE LAST01910007
019200*  STORE'S DETAIL.  ONE ADDITIONAL PASS THROUGH THE PARAGRAPH IS  01920007
019300*  REQUIRED, IF THAT STORE DOES NOT EXIST ON THE CURRENT MASTER   01930007
019400*  FILE, TO COMPLETE THE MERGE.  HIGH-VALUES IS NOT MOVED UNTIL   01940007
019500*  THE LAST STORE'S DETAIL HAS BEEN MERGED.                       01950007
019600*                                                                 01960007
019700     PERFORM 2000-MERGE-FILES                                     01970007
019800         UNTIL ((PS-END-OF-EMPL-ACTIV-FILE)                       01980007
019900                 AND (CK-STORE-NUMBER = HIGH-VALUES)).            01990007
020000                                                                  02000007
020100     PERFORM 9000-EOJ-ROUTINE.                                    02010007
020200     STOP RUN.                                                    02020007
020300                                                                  02030008
020400******************************************************************02040007
020500*  SET UP FOR PROGRAM PROCESSING BY ACCEPTING, DISPLAYING, AND   *02050007
020600*  VALIDATING THE CONTROL CARD, OPENING ALL FILES, ACCUMULATING  *02060007
020700*  THE FIRST STORES DETAIL FROM THE CREDIT POSTING FILE, AND     *02070007
020800*  READING THE FIRST EMPLOYEE ACTIVITY BY STORE RECORD.          *02080007
020900******************************************************************02090007
021000 1000-INITIALIZE.                                                 02100007
021100     ACCEPT CC-CONTROL-CARD.                                      02110007
021200     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - CONTROL CARD - '        02120007
021300               CC-CONTROL-CARD-DISPLAY.                           02130007
021400                                                                  02140007
021500     PERFORM 1100-VALIDATE-CONTROL-CARD.                          02150007
021600                                                                  02160007
021700     OPEN INPUT  CR-POSTING-FILE                                  02170007
021800                 STORE-EMPL-ACTIV-FILE                            02180007
021900          OUTPUT NEW-STORE-EMPL-ACTIV-FILE.                       02190007
022000                                                                  02200007
022100     PERFORM 7000-READ-SALES-RETURNS-FILE.                        02210007
022200     PERFORM 5000-ACCUMULATE-STORE-DETAIL.                        02220007
022300                                                                  02230007
022400     PERFORM 7100-READ-EMPL-ACTIVITY-FILE.                        02240007
022500                                                                  02250008
022600******************************************************************02260007
022700*  VALIDATE THE CONTROL CARD.  ENSURE THAT A VALID P.O.S. DATE   *02270007
022800*  AND A VALID PROCESSING METHOD HAVE BEEN PROVIDED.  OBTAIN THE *02280007
022900*  NUMBER OF THE FISCAL WEEK WITHIN THE FISCAL PERIOD, AND THE   *02290007
023000*  NUMERIC DAY OF THE WEEK TO COMPUTE THE INDEX FOR THE DAILY    *02300007
023100*  ACTIVITY BUCKETS.                                             *02310007
023200******************************************************************02320007
023300 1100-VALIDATE-CONTROL-CARD.                                      02330007
023400     ACCEPT DPG51-SYSTEM-DATE FROM DATE.                          02340007
023500     SET DPG51-FISCAL-454-CALENDAR                                02350007
023600                                 TO TRUE.                         02360007
023700     SET DPG51-DO-NOT-INCR-DECR-DATE                              02370007
023800                                 TO TRUE.                         02380007
023900     MOVE CC-POS-DATE-MDY        TO DPG52-LK-DATE-INPUT.          02390007
024000     SET DPG52-LK-DTE-GREG-CC    TO TRUE.                         02400007
024100                                                                  02410007
024200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          02420007
024300                                             DPG53 DPG54          02430007
024400                                             DPG55 DPG56.         02440007
024500                                                                  02450007
024600     EVALUATE TRUE                                                02460007
024700         WHEN DPG54-SEVERE-ERROR                                  02470007
024800         WHEN DPG54-DATE-INVALID                                  02480007
024900             MOVE '1100-VALIDATE-CONTROL-CARD'                    02490007
025000                                 TO PV-PARAGRAPH-NAME             02500007
025100             MOVE 'INVALID CONTROL POS DATE'                      02510007
025200                                 TO PV-OPERATION-MSG-1            02520007
025300             MOVE DPG54-ERROR-MESSAGE                             02530007
025400                                 TO PV-OPERATION-MSG-2            02540007
025500             SET AC-CONTROL-CARD-ERROR                            02550007
025600                                 TO TRUE                          02560007
025700             PERFORM 9999-ABEND                                   02570007
025800     END-EVALUATE.                                                02580007
025900                                                                  02590007
026000     IF ((NOT CC-REPLACE-DAILY-ACTIVITY)                          02600007
026100             AND (NOT CC-UPDATE-DAILY-ACTIVITY))                  02610007
026200         MOVE '1100-VALIDATE-CONTROL-CARD'                        02620007
026300                                 TO PV-PARAGRAPH-NAME             02630007
026400         MOVE 'INVALID PROCESSING METHOD'                         02640007
026500                                 TO PV-OPERATION-MSG-1            02650007
026600         SET AC-CONTROL-CARD-ERROR                                02660007
026700                                 TO TRUE                          02670007
026800         PERFORM 9999-ABEND                                       02680007
026900     END-IF.                                                      02690007
027000                                                                  02700007
027100     COMPUTE PV-DAY-INDEX = (((DPG56-FISCAL-PERIOD-WEEK - 1) *    02710007
027200               PC-DAYS-IN-WEEK) + DPG55-NUMERIC-WEEK-DAY).        02720007
027300                                                                  02730007
027400     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - DAY NUMBER = ('         02740007
027500               PV-DAY-INDEX  ')'.                                 02750007
027600                                                                  02760008
027700******************************************************************02770007
027800*  MERGE THE FILES.  IF THE EMPLOYEE ACTIVITY STORE NUMBER IS    *02780007
027900*  EQUAL TO THE CREDIT POSTING FILE STORE NUMBER, REPLACE OR     *02790007
028000*  UPDATE (AS SPECIFIED ON THE CONTROL CARD) THE EMPLOYEE        *02800007
028100*  ACTIVITY INFORMATION FOR THE SPECIFIED DAY WITHIN THE         *02810007
028200*  ACCOUNTING MONTH, WRITE THE UPDATED RECORD TO THE NEW         *02820007
028300*  EMPLOYEE ACTIVITY FILE, ACCUMULATE THE TOTALS FOR THE NEXT    *02830007
028400*  STORE ON THE CREDIT POSTING FILE, AND READ THE NEXT EMPLOYEE  *02840007
028500*  ACTIVITY STORE RECORD.  IF THE EMPLOYEE ACTIVITY STORE        *02850007
028600*  NUMBER IS GREATER THAN THE CREDIT POSTING FILE STORE NUMBER,  *02860007
028700*  CREATE A RECORD FOR THE NEW EMPLOYEE ACTIVITY STORE USING THE *02870007
028800*  CREDIT POSTING FILE INFORMATION, WRITE THE NEW RECORD TO THE  *02880007
028900*  EMPLOYEE ACTIVITY FILE, AND ACCUMULATE THE TOTALS FOR THE     *02890007
029000*  NEXT STORE ON THE CREDIT POSTING FILE.  IF THE EMPLOYEE       *02900007
029100*  ACTIVITY STORE NUMBER IS LESS THAN THE CREDIT POSTING FILE    *02910007
029200*  STORE, WRITE THE EMPLOYEE ACTIVITY RECORD DIRECTLY TO THE NEW *02920007
029300*  EMPLOYEE ACTIVITY FILE, AND READ THE NEXT EMPLOYEE ACTIVITY   *02930007
029400*  RECORD.  WHEN END-OF-FILE IS REACHED ON EITHER FILE, HIGH     *02940007
029500*  VALUES ARE MOVED TO THE STORE NUMBER FIELD TO ALLOW THE       *02950007
029600*  MERGING TO CONTINUE UNTIL END-OF-FILE IS REACHED ON BOTH      *02960007
029700*  FILES.                                                        *02970007
029800******************************************************************02980007
029900 2000-MERGE-FILES.                                                02990007
030000     EVALUATE TRUE                                                03000007
030100         WHEN AR007I-STORE-NUMBER = CK-STORE-NUMBER               03010007
030200             MOVE AR007I-STORE-EMPL-ACTIV-RECORD TO               03020007
030300                       AR007O-STORE-EMPL-ACTIV-RECORD             03030007
030400             SET AR007O-DAY-INDEX TO PV-DAY-INDEX                 03040007
030500             IF CC-REPLACE-DAILY-ACTIVITY                         03050007
030600                 MOVE CK-EMPLOYEE-SALES TO                        03060007
030700                           AR007O-EMPLOYEE-SALES                  03070007
030800                                             (AR007O-DAY-INDEX)   03080007
030900                 MOVE CK-EMPLOYEE-DISCOUNT-CREDIT TO              03090007
031000                           AR007O-EMPLOYEE-DISCOUNT-CRED          03100007
031100                                             (AR007O-DAY-INDEX)   03110007
031200                 MOVE CK-EMPLOYEE-RETURNS TO                      03120007
031300                           AR007O-EMPLOYEE-RETURNS                03130007
031400                                             (AR007O-DAY-INDEX)   03140007
031500                 MOVE CK-EMPLOYEE-DISCOUNT-DEBIT TO               03150007
031600                           AR007O-EMPLOYEE-DISCOUNT-DEB           03160007
031700                                             (AR007O-DAY-INDEX)   03170007
031800             ELSE                                                 03180007
031900                 COMPUTE AR007O-EMPLOYEE-SALES                    03190007
032000                                             (AR007O-DAY-INDEX) = 03200007
032100                           (AR007O-EMPLOYEE-SALES                 03210007
032200                                             (AR007O-DAY-INDEX) + 03220007
032300                           CK-EMPLOYEE-SALES)                     03230007
032400                 COMPUTE AR007O-EMPLOYEE-DISCOUNT-CRED            03240007
032500                                             (AR007O-DAY-INDEX) = 03250007
032600                           (AR007O-EMPLOYEE-DISCOUNT-CRED         03260007
032700                                             (AR007O-DAY-INDEX) + 03270007
032800                           CK-EMPLOYEE-DISCOUNT-CREDIT)           03280007
032900                 COMPUTE AR007O-EMPLOYEE-RETURNS                  03290007
033000                                             (AR007O-DAY-INDEX) = 03300007
033100                           (AR007O-EMPLOYEE-RETURNS               03310007
033200                                             (AR007O-DAY-INDEX) + 03320007
033300                           CK-EMPLOYEE-RETURNS)                   03330007
033400                 COMPUTE AR007O-EMPLOYEE-DISCOUNT-DEB             03340007
033500                                             (AR007O-DAY-INDEX) = 03350007
033600                           (AR007O-EMPLOYEE-DISCOUNT-DEB          03360007
033700                                             (AR007O-DAY-INDEX) + 03370007
033800                           CK-EMPLOYEE-DISCOUNT-DEBIT)            03380007
033900             END-IF                                               03390007
034000             PERFORM 8000-WRITE-EMPL-ACTIV-RECORD                 03400007
034100             PERFORM 5000-ACCUMULATE-STORE-DETAIL                 03410007
034200             PERFORM 7100-READ-EMPL-ACTIVITY-FILE                 03420007
034300         WHEN AR007I-STORE-NUMBER > CK-STORE-NUMBER               03430007
034400             INITIALIZE AR007O-STORE-EMPL-ACTIV-RECORD            03440007
034500             SET AR007O-DAY-INDEX TO PV-DAY-INDEX                 03450007
034600             MOVE CK-STORE-NUMBER TO AR007O-STORE-NUMBER          03460007
034700             MOVE CK-EMPLOYEE-SALES TO                            03470007
034800                       AR007O-EMPLOYEE-SALES (AR007O-DAY-INDEX)   03480007
034900             MOVE CK-EMPLOYEE-DISCOUNT-CREDIT TO                  03490007
035000                       AR007O-EMPLOYEE-DISCOUNT-CRED              03500007
035100                                             (AR007O-DAY-INDEX)   03510007
035200             MOVE CK-EMPLOYEE-RETURNS TO                          03520007
035300                       AR007O-EMPLOYEE-RETURNS                    03530007
035400                                             (AR007O-DAY-INDEX)   03540007
035500             MOVE CK-EMPLOYEE-DISCOUNT-DEBIT TO                   03550007
035600                       AR007O-EMPLOYEE-DISCOUNT-DEB               03560007
035700                                             (AR007O-DAY-INDEX)   03570007
035800             PERFORM 8000-WRITE-EMPL-ACTIV-RECORD                 03580007
035900             PERFORM 5000-ACCUMULATE-STORE-DETAIL                 03590007
036000         WHEN AR007I-STORE-NUMBER < CK-STORE-NUMBER               03600007
036100             MOVE AR007I-STORE-EMPL-ACTIV-RECORD TO               03610007
036200                       AR007O-STORE-EMPL-ACTIV-RECORD             03620007
036300             PERFORM 8000-WRITE-EMPL-ACTIV-RECORD                 03630007
036400             PERFORM 7100-READ-EMPL-ACTIVITY-FILE                 03640007
036500     END-EVALUATE.                                                03650007
036600                                                                  03660008
036700******************************************************************03670007
036800*  ACCUMULATE STORE DETAIL TOTALS FOR THE CURRENT STORE ON THE   *03680007
036900*  CREDIT POSTING FILE.  ACCUMULATE VALID TRANSACTIONS (8105 -   *03690007
037000*  SALES, 8115 - RETURNS, 8155 - DISCOUNT CREDIT, AND 8165 -     *03700007
037100*  DISCOUNT DEBIT) FOR EMPLOYEES THAT RECEIVE A DISCOUNT UNTIL   *03710007
037200*  THE STORE NUMBER CHANGES.                                     *03720007
037300******************************************************************03730007
037400 5000-ACCUMULATE-STORE-DETAIL.                                    03740007
037500     INITIALIZE CK-CURRENT-KEY-AREA.                              03750007
037600                                                                  03760007
037700     IF PS-END-OF-SALES-RETURNS-FILE                              03770007
037800         MOVE HIGH-VALUES        TO CK-STORE-NUMBER               03780007
037900     ELSE                                                         03790007
038000         MOVE AR021-STORE-NO     TO CK-STORE-NUMBER               03800007
038100     END-IF.                                                      03810007
038300     PERFORM UNTIL PS-END-OF-SALES-RETURNS-FILE OR                03830007
038400            (AR021-STORE-NO NOT = CK-STORE-NUMBER)                03840027
P1043        IF  AR021-BIN-NUMBER  = SPACES                             03850027
C25054           MOVE AR021-ACCOUNT-NUMBER TO PV-ACCT-NBR               03850935
038510           MOVE PV-ACCT-NBR          TO ART00001-ACCT-NBR         03852027
038600           PERFORM 7200-CHECK-IF-EMPLOYEE                         03860027
038700           IF PS-EMPLOYEE-ACCOUNT                                 03870027
038800              PERFORM 5100-ACCUM-TRANSACTION-DETAIL               03880027
038900           END-IF                                                 03890027
P1043        END-IF                                                     03891027
039000       PERFORM 7000-READ-SALES-RETURNS-FILE                       03900027
039100     END-PERFORM.                                                 03910007
039300******************************************************************03930007
039400*  ACCUMULATE TRANSACTION DETAIL FOR THE CURRENT STORE.          *03940007
039500*  SALES ARE INDICATED BY TRANS-TYPE - 8105                      *03950007
039600*  RETURNS ARE INDICATED BY TRANS-TYPE - 8115                    *03960007
039700*  DISCOUNT CREDITS ARE INDICATED BY TRANS-TYPE - 8155           *03970007
039800*  DISCOUNT DEBITS ARE INDICATED BY TRANS-TYPE - 8165            *03980007
039900******************************************************************03990007
040000 5100-ACCUM-TRANSACTION-DETAIL.                                   04000007
040100     EVALUATE TRUE                                                04010007
040200         WHEN AR021-TRANS-TYPE = AR004-TRANS-STORE-SLS-CD         04020007
040300             ADD AR021-AMOUNT    TO CK-EMPLOYEE-SALES             04030007
040400         WHEN AR021-TRANS-TYPE = AR004-TRANS-STORE-RET-CD         04040007
040500             ADD AR021-AMOUNT    TO CK-EMPLOYEE-RETURNS           04050007
040600         WHEN AR021-TRANS-TYPE = AR004-TRANS-EMPL-DISC-SLS-CD     04060007
040700             ADD AR021-AMOUNT    TO CK-EMPLOYEE-DISCOUNT-CREDIT   04070007
040800         WHEN AR021-TRANS-TYPE = AR004-TRANS-EMPL-DISC-RET-CD     04080007
040900             ADD AR021-AMOUNT    TO CK-EMPLOYEE-DISCOUNT-DEBIT    04090007
041000     END-EVALUATE.                                                04100007
041100                                                                  04110008
041200******************************************************************04122015
041300*  READ THE CREDIT POSTING FILE                                  *04130007
041400******************************************************************04140007
041500 7000-READ-SALES-RETURNS-FILE.                                    04150007
041600     READ CR-POSTING-FILE                                         04160007
041700         INTO AR021-AR-POSTING-RECORD                             04170007
041800         AT END                                                   04180007
041900             SET PS-END-OF-SALES-RETURNS-FILE TO TRUE             04190007
042000     END-READ.                                                    04200007
042100                                                                  04210008
042200******************************************************************04220007
042300*  READ AN EMPLOYEE ACTIVITY BY STORE FILE RECORD.               *04230007
042400******************************************************************04240007
042500 7100-READ-EMPL-ACTIVITY-FILE.                                    04250007
042600     READ STORE-EMPL-ACTIV-FILE                                   04260007
042700         INTO AR007I-STORE-EMPL-ACTIV-RECORD                      04270007
042800         AT END                                                   04280007
042900             SET PS-END-OF-EMPL-ACTIV-FILE TO TRUE                04290007
043000             MOVE HIGH-VALUES TO AR007I-STORE-NUMBER              04300007
043100     END-READ.                                                    04310007
043200                                                                  04320008
043300******************************************************************04330007
043400*  SELECT THE ACCOUNT NUMBER FROM ART_EMP_DISC TO FIND OUT       *04340008
043500*  WHETHER THE ACCT RELATES TO AN EMPLOYEE.                      *04350008
043600******************************************************************04360007
043700 7200-CHECK-IF-EMPLOYEE.                                          04370008
043800                                                                  04380008
043900     EXEC SQL                                                     04390008
044000         SELECT 'X'                                               04400008
044100           INTO :PV-X                                             04410008
044200           FROM ART_EMP_DISC                                      04420011
044300          WHERE ACCT_NBR = :ART00001-ACCT-NBR                     04430008
044400            AND DISC_STAT_CDE <> 'N'                              04440008
044500     END-EXEC.                                                    04450008
044600                                                                  04460008
044700     EVALUATE SQLCODE                                             04470008
044800         WHEN ZERO                                                04480008
044900         WHEN -811                                                04490008
045000             SET PS-EMPLOYEE-ACCOUNT        TO TRUE               04500008
045100         WHEN +100                                                04510008
045110             SET PS-NOT-AN-EMPLOYEE-ACCOUNT TO TRUE               04511013
045300         WHEN OTHER                                               04530008
045400             MOVE '7200-CHECK-IF-EMPLOYEE'  TO PV-PARAGRAPH-NAME  04540008
045500             MOVE 'ERROR SELECTING FROM ART_EMP_DISC'             04550008
045600                                            TO PV-DB2-OPERATION   04560008
045700             PERFORM 9200-SQL-ABEND                               04570008
045800     END-EVALUATE.                                                04580008
045900                                                                  04590008
046010******************************************************************04601011
046100*  WRITE A NEW EMPLOYEE ACTIVITY BY STORE RECORD.                *04610007
046200******************************************************************04620007
046300 8000-WRITE-EMPL-ACTIV-RECORD.                                    04630007
046400     WRITE NS-NEW-STORE-EMPL-ACTIV-RECORD                         04640007
046500         FROM AR007O-STORE-EMPL-ACTIV-RECORD.                     04650007
046600                                                                  04660008
046700******************************************************************04670007
046800*  CLOSE ALL FILES.                                              *04680007
046900******************************************************************04690007
047000 9000-EOJ-ROUTINE.                                                04700007
047100     CLOSE CR-POSTING-FILE                                        04710007
047200           STORE-EMPL-ACTIV-FILE                                  04720007
047300           NEW-STORE-EMPL-ACTIV-FILE.                             04730007
047400                                                                  04740007
047500******************************************************************04750008
047600* 9200-SQL-ABEND                                                  04760008
047700*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.04770008
047800******************************************************************04780008
047900 9200-SQL-ABEND.                                                  04790008
048000                                                                  04800008
048100     DISPLAY '** ABEND        **'.                                04810008
048200     DISPLAY '** PROGRAM      ** = ' PC-CURRENT-PROGRAM-NAME.     04820008
048300     DISPLAY '** PARAGRAPH    ** = ' PV-PARAGRAPH-NAME.           04830008
048400     DISPLAY '** OPERATION    ** = ' PV-DB2-OPERATION.            04840008
048500                                                                  04850008
048600******************************************************************04860008
048700* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     04870008
048800* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      04880008
048900******************************************************************04890008
049000     COPY DPPD004.                                                04900008
049100                                                                  04910008
049200     SET AC-DB2-ERROR TO TRUE.                                    04920008
049300     CALL 'ILBOABN0' USING ABEND-CODE.                            04930008
049400                                                                  04940008
049500******************************************************************04950007
049600*    9999-ABEND - PERFORMS A NON-SQL-ABEND                       *04960007
049700******************************************************************04970007
049800 9999-ABEND.                                                      04980007
049900     DISPLAY '** ABEND           **'.                             04990007
050000     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  05000007
050100     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        05010007
050200     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       05020007
050300     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       05030007
050400     CALL 'ILBOABN0' USING ABEND-CODE.                            05040007
049400                                                                  05050016
