      ******************************************************************00010020
       IDENTIFICATION DIVISION.                                         00020020
      ******************************************************************00030020
                                                                        00040020
       PROGRAM-ID.             TFKUT476.                                00050020
       AUTHOR.                 WILLIAM B. BURT.                         00060020
       INSTALLATION.           KOHLS.                                   00070020
       DATE-WRITTEN            JUNE, 1997.                              00080020
       DATE-COMPILED.                                                   00090020
                                                                        00100020
      ******************************************************************00110020
      *  THIS PROGRAM PRODUCES AN OUTPUT FILE SHOWING ALL TRANSFERS WITH00120020
      *  DISCREPANCIES, EXCLUDING THOSE TRANSFER ITEMS WHICH HAVE HAD   00120120
      *  MANUAL OR AUTOMATIC REVERSALS ON THEM.                         00120220
      ******************************************************************00120320
      ******************************************************************00120520
      *  2/28/2003 - CHRIS ALBRIGHT                                     00120620
      *   PROCESS NONINTELLIGENT SKU.                                   00120720
      ******************************************************************00120820
100404** 10/04/2004 CHANGED BY: RAY GRAF                                00120927
100404**     EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                00121027
SR3403** 03/12/2012 CHANGED BY: JALAJ KUMAR                             00121130
SR3403**     CHANGED FILE LENGTH AS PART OF LARGE RETAIL ENHANCEMENTS.  00121230
      ***************************************************************** 00121330
      ******************************************************************00121430
       ENVIRONMENT DIVISION.                                            00121530
      ******************************************************************00121630
                                                                        00121730
       CONFIGURATION SECTION.                                           00121830
                                                                        00121930
       SOURCE-COMPUTER.        IBM-3090.                                00122020
       OBJECT-COMPUTER.        IBM-3090.                                00123020
                                                                        00124020
       INPUT-OUTPUT SECTION.                                            00125020
                                                                        00126020
       FILE-CONTROL.                                                    00127020
                                                                        00128020
           SELECT PROCESS-DATES-FILE                                    00129020
               ASSIGN TO INP01.                                         00130020
                                                                        00140020
           SELECT XFER-DISCREPANCY-FILE                                 00150020
               ASSIGN TO OUT01.                                         00160020
                                                                        00170020
      ******************************************************************00180020
       DATA DIVISION.                                                   00190020
      ******************************************************************00200020
                                                                        00210020
       FILE SECTION.                                                    00220020
                                                                        00230020
       FD  XFER-DISCREPANCY-FILE                                        00240020
           RECORDING MODE IS F                                          00250020
           LABEL RECORDS ARE STANDARD                                   00260020
           BLOCK CONTAINS 0 RECORDS.                                    00270020
                                                                        00280020
SR3403 01  XFER-DISCREPANCY-RECORD             PIC  X(100).             00291030
                                                                        00300020
       FD  PROCESS-DATES-FILE                                           00310020
           RECORDING MODE IS F                                          00320020
           LABEL RECORDS ARE STANDARD                                   00330020
           BLOCK CONTAINS 0 RECORDS.                                    00340020
                                                                        00350020
       01  PROCESS-DATES-RECORD                PIC  X(16).              00360020
                                                                        00370020
      ******************************************************************00380020
       WORKING-STORAGE SECTION.                                         00390020
      ******************************************************************00400020
                                                                        00410020
      *                                                                 00420020
      *  RECORD LAYOUT FOR THE PROCESS DATES FILE                       00430020
      *                                                                 00440020
           COPY TFRD029.                                                00450020
                                                                        00460020
      *                                                                 00470020
      *  RECORD LAYOUT FOR THE TRANSFER DISCREPANCY FILE                00480020
      *                                                                 00490020
           COPY TFRD030.                                                00500020
                                                                        00510020
      *                                                                 00520020
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER STATUS    00530020
      *  TABLE                                                          00540020
      *                                                                 00550020
           EXEC SQL                                                     00560020
               INCLUDE TTFSTAT                                          00570020
           END-EXEC.                                                    00580020
                                                                        00590020
      *                                                                 00600020
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER TYPE CODE 00610020
      *  TABLE                                                          00620020
      *                                                                 00630020
           EXEC SQL                                                     00640020
               INCLUDE TTFTYCD                                          00650020
           END-EXEC.                                                    00660020
                                                                        00670020
      *                                                                 00680020
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER MASTER    00690020
      *  TABLE                                                          00700020
      *                                                                 00710020
           EXEC SQL                                                     00720020
               INCLUDE TTFMSTR                                          00730020
           END-EXEC.                                                    00740020
                                                                        00750020
      *                                                                 00760020
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER ITEM TABLE00770020
      *                                                                 00780020
           EXEC SQL                                                     00790020
               INCLUDE TTFITEM                                          00800020
           END-EXEC.                                                    00810020
                                                                        00820020
      *                                                                 00830020
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER ITEM      00840020
      *  RECEIPT TABLE                                                  00850020
      *                                                                 00860020
           EXEC SQL                                                     00870020
               INCLUDE TTFITRC                                          00880020
           END-EXEC.                                                    00890020
                                                                        00900020
      *                                                                 00910020
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER ITEM      00920020
      *  POSTING TABLE                                                  00930020
      *                                                                 00940020
           EXEC SQL                                                     00950020
               INCLUDE TTFITPS                                          00960020
           END-EXEC.                                                    00970020
      *                                                                 00980020
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR NIS CROSS REFERENCE    00981020
      *  TABLE                                                          00982020
      *                                                                 00983020
022803     EXEC SQL                                                     00984021
022803         INCLUDE TSKXREF                                          00985021
022803     END-EXEC.                                                    00986021
                                                                        00987020
      *                                                                 00990020
      *  COMMUNICATIONS AREA FOR DB2                                    01000020
      *                                                                 01010020
           EXEC SQL                                                     01020020
               INCLUDE SQLCA                                            01030020
           END-EXEC.                                                    01040020
                                                                        01050020
      *                                                                 01060020
      *  DB2 FORMATTED ERROR MESSAGE                                    01070020
      *                                                                 01080020
           COPY DPWS004.                                                01090020
                                                                        01100020
       01  ABEND-CODE                          PIC S9(04)  VALUE +0     01110020
                                                           COMP SYNC.   01120020
                                                                        01130020
       01  CK-CURRENT-KEYS.                                             01140020
100404*    05  CK-XFER-NBR                     PIC  9(09)  VALUE ZEROS. 01150028
100404     05  CK-XFER-NBR                     PIC  9(10)  VALUE ZEROS. 01151028
           05  FILLER  REDEFINES  CK-XFER-NBR.                          01160020
100404*        10  CK-FROM-STR-NBR             PIC  9(03).              01170028
100404         10  CK-FROM-STR-NBR             PIC  9(04).              01171028
               10  CK-XFER-SEQ-NBR             PIC  9(06).              01180021
022803     05  CK-SKU                          PIC  9(08)  VALUE ZEROS. 01224022
                                                                        01230020
       01  PC-PROGRAM-CONSTANTS.                                        01240020
           05  PC-POSITIVELY-RECEIVED          PIC  X(02)  VALUE 'PR'.  01250020
           05  PC-MANUAL-REVERSAL              PIC  X(02)  VALUE 'MR'.  01260020
           05  PC-AUTO-REVERSAL                PIC  X(02)  VALUE 'AR'.  01270020
           05  PC-YES                          PIC  X(01)  VALUE 'Y'.   01280020
           05  PC-NO                           PIC  X(01)  VALUE 'N'.   01290020
           05  PC-DASH                         PIC  X(01)  VALUE '-'.   01300020
           05  PC-DEFAULT-BEG-TIME             PIC  X(16)  VALUE        01310020
               '-00.00.00.000000'.                                      01320020
           05  PC-DEFAULT-END-TIME             PIC  X(16)  VALUE        01330020
               '-23.59.59.999999'.                                      01340020
                                                                        01350020
       01  PS-PROGRAM-SWITCHES.                                         01360020
           05  PS-END-OF-DISCREPANCIES-IND     PIC  X(01)  VALUE 'N'.   01370020
               88  PS-MORE-DISCREPANCIES                   VALUE 'N'.   01380020
               88  PS-END-OF-DISCREPANCIES                 VALUE 'Y'.   01390020
           05  PS-END-OF-REVERSALS-IND         PIC  X(01)  VALUE 'N'.   01400020
               88  PS-MORE-REVERSALS                       VALUE 'N'.   01410020
               88  PS-END-OF-REVERSALS                     VALUE 'Y'.   01420020
                                                                        01430020
       01  PV-PROGRAM-VARIABLES.                                        01440020
022803     05  PV-SKU                          PIC  9(08)  VALUE ZEROS. 01484023
100404*    05  PV-XFER-NBR                     PIC  9(09)  VALUE ZEROS. 01490028
100404     05  PV-XFER-NBR                     PIC  9(10)  VALUE ZEROS. 01491028
           05  FILLER  REDEFINES  PV-XFER-NBR.                          01500020
100404*        10  PV-FROM-STR-NBR             PIC  9(03).              01510028
100404         10  PV-FROM-STR-NBR             PIC  9(04).              01511028
               10  PV-XFER-SEQ-NBR             PIC  9(06).              01520022
           05  PV-PARAGRAPH-NAME               PIC  X(30)  VALUE SPACE. 01530020
           05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(30)  VALUE SPACE. 01540020
           05  PV-BEG-TMST                     PIC  X(26)  VALUE SPACE. 01550020
           05  FILLER  REDEFINES  PV-BEG-TMST.                          01560020
               10 PV-BEG-CENTURY               PIC  X(02).              01570020
               10 PV-BEG-YEAR                  PIC  X(02).              01580020
               10 PV-BEG-DASH-ONE              PIC  X(01).              01590020
               10 PV-BEG-MONTH                 PIC  X(02).              01600020
               10 PV-BEG-DASH-TWO              PIC  X(01).              01610020
               10 PV-BEG-DAY                   PIC  X(02).              01620020
               10 PV-BEG-TIME                  PIC  X(16).              01630020
           05  PV-END-TMST                     PIC  X(26)  VALUE SPACE. 01640020
           05  FILLER  REDEFINES  PV-END-TMST.                          01650020
               10 PV-END-CENTURY               PIC  X(02).              01660020
               10 PV-END-YEAR                  PIC  X(02).              01670020
               10 PV-END-DASH-ONE              PIC  X(01).              01680020
               10 PV-END-MONTH                 PIC  X(02).              01690020
               10 PV-END-DASH-TWO              PIC  X(01).              01700020
               10 PV-END-DAY                   PIC  X(02).              01710020
               10 PV-END-TIME                  PIC  X(16).              01720020
           05  PV-CMPT-XFER-END-TMST           PIC  X(26)  VALUE SPACE. 01730020
           05  FILLER  REDEFINES  PV-CMPT-XFER-END-TMST.                01740020
               10 PV-CMPT-XFER-END-CENTURY     PIC  X(02).              01750020
               10 PV-CMPT-XFER-END-YEAR        PIC  X(02).              01760020
               10 FILLER                       PIC  X(01).              01770020
               10 PV-CMPT-XFER-END-MONTH       PIC  X(02).              01780020
               10 FILLER                       PIC  X(01).              01790020
               10 PV-CMPT-XFER-END-DAY         PIC  X(02).              01800020
               10 PV-CMPT-XFER-END-TIME        PIC  X(16).              01810020
           05  PV-XFER-STAT-TMST               PIC  X(26)  VALUE SPACE. 01820020
           05  FILLER  REDEFINES  PV-XFER-STAT-TMST.                    01830020
               10 PV-XFER-STAT-CENTURY         PIC  X(02).              01840020
               10 PV-XFER-STAT-YEAR            PIC  X(02).              01850020
               10 FILLER                       PIC  X(01).              01860020
               10 PV-XFER-STAT-MONTH           PIC  X(02).              01870020
               10 FILLER                       PIC  X(01).              01880020
               10 PV-XFER-STAT-DAY             PIC  X(02).              01890020
               10 PV-XFER-STAT-TIME            PIC  X(16).              01900020
                                                                        01910020
      *                                                                 01920020
      * CURSOR TO RETRIEVE ALL TRANSFERS WITH DISCREPANCIES WITHIN      01930020
      * A SPECIFIED TIME PERIOD                                         01940020
      *                                                                 01950020
           EXEC SQL                                                     01960020
              DECLARE  XFER_DSCRP_CSR CURSOR FOR                        01970020
               SELECT  A.XFER_TYP_CDE,                                  01980020
                       A.FR_STR_NBR,                                    01990020
                       A.XFER_SEQ_NBR,                                  02000022
                       A.CMPT_XFER_END_TMST,                            02010020
                       B.XFER_STAT_TMST,                                02020020
                       D.XFER_DKEY_ID,                                  02030020
022803                 F.SKU,                                           02064022
                       D.XFER_PRIC_AMT,                                 02070020
                       D.XFER_QTY,                                      02080020
                       E.XFER_LNE_SEQ_NBR,                              02090020
                       E.RCVD_XFER_PRIC_AMT,                            02100020
                       E.RCVD_XFER_QTY                                  02110020
                 FROM  TTFMSTR  A,                                      02120020
                       TTFSTAT  B,                                      02130020
                       TTFTYCD  C,                                      02140020
                       TTFITEM  D,                                      02150020
                       TTFITRC  E,                                      02160020
022803                 TSKXREF  F                                       02161022
                WHERE  ((A.CMPT_XFER_END_TMST  BETWEEN  :PV-BEG-TMST    02170020
                                                            AND         02180020
                                                        :PV-END-TMST)   02190020
                  AND   A.XFER_TYP_CDE        =  C.XFER_TYP_CDE         02200020
                  AND   C.BYP_ASMTV_RCPT_IND  =  :PC-NO                 02210020
                  AND   A.XFER_DKEY_ID        =  B.XFER_DKEY_ID         02220020
                  AND   B.XFER_STAT_CDE       =  :PC-POSITIVELY-RECEIVED02230020
                  AND   A.XFER_DKEY_ID        =  D.XFER_DKEY_ID         02240020
                  AND   D.XFER_DKEY_ID        =  E.XFER_DKEY_ID         02250020
                  AND   D.XFER_LNE_NBR        =  E.XFER_LNE_NBR         02260020
                  AND   E.XFER_ITM_DSCRP_IND  =  :PC-YES                02270020
022803            AND   D.ITM_NBR             =  F.ITM_NBR)             02271022
             ORDER BY  A.FR_STR_NBR,                                    02280020
                       A.XFER_SEQ_NBR,                                  02290020
                       E.XFER_LNE_SEQ_NBR                               02330020
             WITH UR                                                    02331028
           END-EXEC.                                                    02340020
                                                                        02350020
      *                                                                 02360020
      * CURSOR TO RETRIEVE ALL MANUAL/AUTOMATIC REVERSAL ADJUSTMENT(S)  02370020
      * FOR A SPECIFIED TRANSFER                                        02380020
      *                                                                 02390020
           EXEC SQL                                                     02400020
              DECLARE  REVERSAL_CSR CURSOR FOR                          02410020
022803         SELECT  DISTINCT C.SKU                                   02444022
                 FROM  TTFITEM   A,                                     02450020
                       TTFITPS   B,                                     02460020
022803                 TSKXREF   C                                      02461022
                WHERE  (B.XFER_DKEY_ID   =  :TFITEM-XFER-DKEY-ID        02470020
                  AND   B.XFER_DKEY_ID   =  A.XFER_DKEY_ID              02480020
                  AND   A.XFER_LNE_NBR   =  B.XFER_LNE_NBR              02490020
                  AND   B.ADJ_RSN_CDE   IN  (:PC-MANUAL-REVERSAL,       02500020
                                             :PC-AUTO-REVERSAL)         02510020
022803            AND   A.ITM_NBR        =  C.ITM_NBR)                  02511022
                 WITH UR                                                02512028
           END-EXEC.                                                    02550020
                                                                        02560020
      ******************************************************************02570020
       PROCEDURE DIVISION.                                              02580020
      ******************************************************************02590020
                                                                        02600020
      ******************************************************************02610020
      *  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    02620020
      ******************************************************************02630020
       0000-PROGRAM-MAINLINE.                                           02640020
           PERFORM 1000-INITIALIZE.                                     02650020
                                                                        02660020
           PERFORM 2000-CREATE-XFER-DISCRP-FILE.                        02670020
                                                                        02680020
           PERFORM 9000-EOJ-ROUTINE.                                    02690020
                                                                        02700020
           STOP RUN.                                                    02710020
      *                                                                 02720020
       1000-INITIALIZE.                                                 02730020
           OPEN  INPUT PROCESS-DATES-FILE                               02740020
                OUTPUT XFER-DISCREPANCY-FILE.                           02750020
                                                                        02760020
           PERFORM 7000-READ-PROCESS-DATES-FILE.                        02770020
                                                                        02780020
           MOVE PC-DASH                      TO  PV-BEG-DASH-ONE        02790020
                                                 PV-BEG-DASH-TWO        02800020
                                                 PV-END-DASH-ONE        02810020
                                                 PV-END-DASH-TWO.       02820020
                                                                        02830020
           MOVE PC-DEFAULT-BEG-TIME          TO  PV-BEG-TIME.           02840020
           MOVE PC-DEFAULT-END-TIME          TO  PV-END-TIME.           02850020
                                                                        02860020
           MOVE TF029-PROCESS-START-CENTURY  TO  PV-BEG-CENTURY.        02870020
           MOVE TF029-PROCESS-START-YEAR     TO  PV-BEG-YEAR.           02880020
           MOVE TF029-PROCESS-START-MONTH    TO  PV-BEG-MONTH.          02890020
           MOVE TF029-PROCESS-START-DAY      TO  PV-BEG-DAY.            02900020
           MOVE TF029-PROCESS-END-CENTURY    TO  PV-END-CENTURY.        02910020
           MOVE TF029-PROCESS-END-YEAR       TO  PV-END-YEAR.           02920020
           MOVE TF029-PROCESS-END-MONTH      TO  PV-END-MONTH.          02930020
           MOVE TF029-PROCESS-END-DAY        TO  PV-END-DAY.            02940020
                                                                        02950020
           DISPLAY 'PV-BEG-TMST  =  '  PV-BEG-TMST.                     02960020
           DISPLAY 'PV-END-TMST  =  '  PV-END-TMST.                     02970020
      *                                                                 02980020
      ******************************************************************02990020
      * 2000-CREATE-XFER-DISCRP-FILE.                                   03000020
      ******************************************************************03010020
       2000-CREATE-XFER-DISCRP-FILE.                                    03020020
           PERFORM 2010-OPEN-XFER-DSCRP-CSR.                            03030020
           PERFORM 7100-FETCH-XFER-DSCRP-CSR.                           03040020
                                                                        03050020
           PERFORM 2020-PROCESS-DISCREPANCIES                           03060020
               UNTIL PS-END-OF-DISCREPANCIES.                           03070020
                                                                        03080020
           PERFORM 2050-CLOSE-XFER-DSCRP-CSR.                           03090020
      *                                                                 03100020
       2010-OPEN-XFER-DSCRP-CSR.                                        03110020
           EXEC SQL                                                     03120020
               OPEN XFER_DSCRP_CSR                                      03130020
           END-EXEC.                                                    03140020
                                                                        03150020
           EVALUATE TRUE                                                03160020
               WHEN SQLCODE = ZERO                                      03161028
                   CONTINUE                                             03162028
               WHEN OTHER                                               03170028
                   MOVE '2010-OPEN-XFER-DSCRP-CSR'                      03200020
                       TO PV-PARAGRAPH-NAME                             03210020
                   MOVE 'OPEN THE XFER_DSCRP_CSR'                       03220020
                       TO PV-DB2-OPERATION-ATTEMPTED                    03230020
                   PERFORM 9100-SQL-ABEND                               03240020
           END-EVALUATE.                                                03270020
      *                                                                 03280020
       2020-PROCESS-DISCREPANCIES.                                      03290020
           MOVE TFMSTR-FR-STR-NBR    TO  CK-FROM-STR-NBR.               03300020
           MOVE TFMSTR-XFER-SEQ-NBR  TO  CK-XFER-SEQ-NBR.               03310022
           SET  PS-MORE-REVERSALS    TO  TRUE.                          03320020
                                                                        03330020
           PERFORM 2025-OPEN-REVERSAL-CSR.                              03340020
           PERFORM 7200-FETCH-REVERSAL-CSR.                             03350020
                                                                        03360020
           PERFORM 2030-PROCESS-DSCRP-ITEMS                             03370020
               UNTIL  (PS-END-OF-DISCREPANCIES                          03380020
                  OR   PV-XFER-NBR  NOT =  CK-XFER-NBR).                03390020
                                                                        03400020
           PERFORM 2040-CLOSE-REVERSAL-CSR.                             03410020
      *                                                                 03420020
       2025-OPEN-REVERSAL-CSR.                                          03430020
           EXEC SQL                                                     03440020
               OPEN REVERSAL_CSR                                        03450020
           END-EXEC.                                                    03460020
                                                                        03470020
           EVALUATE TRUE                                                03480020
               WHEN SQLCODE = ZERO                                      03481028
                   CONTINUE                                             03482028
               WHEN OTHER                                               03490028
                   MOVE '2025-OPEN-REVERSAL-CSR'                        03520020
                       TO PV-PARAGRAPH-NAME                             03530020
                   MOVE 'OPEN THE REVERSAL_CSR'                         03540020
                       TO PV-DB2-OPERATION-ATTEMPTED                    03550020
                   PERFORM 9100-SQL-ABEND                               03560020
           END-EVALUATE.                                                03590020
      *                                                                 03600020
       2030-PROCESS-DSCRP-ITEMS.                                        03610020
           IF PS-END-OF-REVERSALS                                       03620020
               PERFORM 2035-FILL-XFER-DSCRP-RECORD                      03630020
               PERFORM 7100-FETCH-XFER-DSCRP-CSR                        03640020
           ELSE                                                         03650020
022803         IF PV-SKU = CK-SKU                                       03660022
                   PERFORM 7100-FETCH-XFER-DSCRP-CSR                    03670020
               ELSE                                                     03680020
022803             IF CK-SKU < PV-SKU                                   03690022
                       PERFORM 2035-FILL-XFER-DSCRP-RECORD              03700020
                       PERFORM 7100-FETCH-XFER-DSCRP-CSR                03710020
                   ELSE                                                 03720020
                       PERFORM 7200-FETCH-REVERSAL-CSR                  03730020
                   END-IF                                               03740020
               END-IF                                                   03750020
           END-IF.                                                      03760020
      *                                                                 03770020
       2035-FILL-XFER-DSCRP-RECORD.                                     03780020
           INITIALIZE TF030-XFER-DSCRP-RECORD.                          03790020
                                                                        03800020
           MOVE TFMSTR-XFER-SEQ-NBR        TO  TF030-XFER-SEQ-NBR.      03801026
           MOVE TFMSTR-FR-STR-NBR          TO  TF030-FROM-STR-NBR.      03810020
           MOVE TFMSTR-XFER-TYP-CDE        TO  TF030-XFER-TYP-CDE.      03830020
           MOVE TFMSTR-CMPT-XFER-END-TMST  TO  PV-CMPT-XFER-END-TMST.   03840020
           MOVE TFSTAT-XFER-STAT-TMST      TO  PV-XFER-STAT-TMST.       03850020
           MOVE PV-CMPT-XFER-END-CENTURY   TO  TF030-COMPLETED-CENTURY. 03860020
           MOVE PV-CMPT-XFER-END-YEAR      TO  TF030-COMPLETED-YEAR.    03870020
           MOVE PV-CMPT-XFER-END-MONTH     TO  TF030-COMPLETED-MONTH.   03880020
           MOVE PV-CMPT-XFER-END-DAY       TO  TF030-COMPLETED-DAY.     03890020
           MOVE PV-XFER-STAT-CENTURY       TO  TF030-RECEIVED-CENTURY.  03900020
           MOVE PV-XFER-STAT-YEAR          TO  TF030-RECEIVED-YEAR.     03910020
           MOVE PV-XFER-STAT-MONTH         TO  TF030-RECEIVED-MONTH.    03920020
           MOVE PV-XFER-STAT-DAY           TO  TF030-RECEIVED-DAY.      03930020
                                                                        03940020
           MOVE TFITEM-XFER-QTY            TO  TF030-XFER-QTY.          03950020
           MOVE TFITEM-XFER-PRIC-AMT       TO  TF030-XFER-PRICE.        03960020
           MOVE TFITRC-RCVD-XFER-QTY       TO  TF030-RCVD-QTY.          03970020
           MOVE TFITRC-RCVD-XFER-PRIC-AMT  TO  TF030-RCVD-PRICE.        03980020
           MOVE TFITRC-XFER-LNE-SEQ-NBR    TO  TF030-XFER-LNE-SEQ-NBR.  03990020
022803     MOVE CK-SKU                     TO  TF030-SKU.               04003022
                                                                        04010020
           PERFORM 8000-WRITE-XFER-DSCRP-FILE.                          04020020
      *                                                                 04030020
       2040-CLOSE-REVERSAL-CSR.                                         04040020
           EXEC SQL                                                     04050020
               CLOSE REVERSAL_CSR                                       04060020
           END-EXEC.                                                    04070020
                                                                        04080020
           EVALUATE TRUE                                                04090020
               WHEN SQLCODE = ZERO                                      04091028
                   CONTINUE                                             04092028
               WHEN OTHER                                               04100028
                   MOVE '2040-CLOSE-REVERSAL-CSR'                       04130020
                       TO PV-PARAGRAPH-NAME                             04140020
                   MOVE 'CLOSE THE REVERSAL_CSR'                        04150020
                       TO PV-DB2-OPERATION-ATTEMPTED                    04160020
                   PERFORM 9100-SQL-ABEND                               04170020
           END-EVALUATE.                                                04200020
      *                                                                 04210020
       2050-CLOSE-XFER-DSCRP-CSR.                                       04220020
           EXEC SQL                                                     04230020
               CLOSE XFER_DSCRP_CSR                                     04240020
           END-EXEC.                                                    04250020
                                                                        04260020
           EVALUATE TRUE                                                04270020
               WHEN SQLCODE = ZERO                                      04271028
                   CONTINUE                                             04272028
               WHEN OTHER                                               04280028
                   MOVE '2050-CLOSE-XFER-DSCRP-CSR'                     04310020
                       TO PV-PARAGRAPH-NAME                             04320020
                   MOVE 'CLOSE THE XFER_DSCRP_CSR'                      04330020
                       TO PV-DB2-OPERATION-ATTEMPTED                    04340020
                   PERFORM 9100-SQL-ABEND                               04350020
           END-EVALUATE.                                                04380020
      *                                                                 04390020
       7000-READ-PROCESS-DATES-FILE.                                    04400020
           READ PROCESS-DATES-FILE                                      04410020
               INTO TF029-PROCESS-DATES-RECORD                          04420020
           END-READ.                                                    04430020
      *                                                                 04440020
       7100-FETCH-XFER-DSCRP-CSR.                                       04450020
           INITIALIZE DCLTTFMSTR                                        04460020
                      DCLTTFSTAT                                        04470020
                      DCLTTFITEM                                        04480020
                      DCLTTFITRC                                        04490020
022803                DCLTSKXREF.                                       04500022
           EXEC SQL                                                     04510020
               FETCH  XFER_DSCRP_CSR                                    04520020
                INTO  :TFMSTR-XFER-TYP-CDE,                             04530020
                      :TFMSTR-FR-STR-NBR,                               04540020
                      :TFMSTR-XFER-SEQ-NBR,                             04550022
                      :TFMSTR-CMPT-XFER-END-TMST,                       04560020
                      :TFSTAT-XFER-STAT-TMST,                           04570020
                      :TFITEM-XFER-DKEY-ID,                             04580020
                      :SKXREF-SKU,                                      04614020
                      :TFITEM-XFER-PRIC-AMT,                            04620020
                      :TFITEM-XFER-QTY,                                 04630020
                      :TFITRC-XFER-LNE-SEQ-NBR,                         04640020
                      :TFITRC-RCVD-XFER-PRIC-AMT,                       04650020
                      :TFITRC-RCVD-XFER-QTY                             04660020
           END-EXEC.                                                    04670020
                                                                        04680020
           EVALUATE TRUE                                                04690020
               WHEN SQLCODE = ZERO                                      04691028
                   MOVE TFMSTR-FR-STR-NBR    TO  PV-FROM-STR-NBR        04692028
                   MOVE TFMSTR-XFER-SEQ-NBR  TO  PV-XFER-SEQ-NBR        04693028
022803             MOVE SKXREF-SKU           TO  CK-SKU                 04694028
               WHEN SQLCODE = +100                                      04700020
                   SET PS-END-OF-DISCREPANCIES  TO  TRUE                04710020
               WHEN OTHER                                               04720028
                   MOVE '7100-FETCH-XFER-DSCRP-CSR'                     04750020
                       TO PV-PARAGRAPH-NAME                             04760020
                   MOVE 'FETCH THE XFER_DSCRP_CSR'                      04770020
                       TO PV-DB2-OPERATION-ATTEMPTED                    04780020
                   PERFORM 9100-SQL-ABEND                               04790020
           END-EVALUATE.                                                04860020
      *                                                                 04870020
       7200-FETCH-REVERSAL-CSR.                                         04880020
022803     INITIALIZE SKXREF-SKU.                                       04911022
                                                                        04920020
           EXEC SQL                                                     04930020
               FETCH  REVERSAL_CSR                                      04940020
022803          INTO  :SKXREF-SKU                                       04971022
           END-EXEC.                                                    04980020
                                                                        04990020
           EVALUATE TRUE                                                05000020
               WHEN SQLCODE = ZERO                                      05001028
022803             MOVE SKXREF-SKU           TO  PV-SKU                 05002028
               WHEN SQLCODE = +100                                      05010020
                   SET PS-END-OF-REVERSALS  TO  TRUE                    05020020
               WHEN OTHER                                               05030028
                   MOVE '7200-FETCH-REVERSAL-CSR'                       05060020
                       TO PV-PARAGRAPH-NAME                             05070020
                   MOVE 'FETCH THE REVERSAL_CSR'                        05080020
                       TO PV-DB2-OPERATION-ATTEMPTED                    05090020
                   PERFORM 9100-SQL-ABEND                               05100020
           END-EVALUATE.                                                05150020
      *                                                                 05160020
       8000-WRITE-XFER-DSCRP-FILE.                                      05170020
           WRITE XFER-DISCREPANCY-RECORD                                05180020
               FROM TF030-XFER-DSCRP-RECORD                             05190020
           END-WRITE.                                                   05200020
      *                                                                 05210020
       9000-EOJ-ROUTINE.                                                05220020
           CLOSE XFER-DISCREPANCY-FILE                                  05230020
                 PROCESS-DATES-FILE.                                    05240020
      *                                                                 05250020
      ******************************************************************05260020
      *  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    05270020
      *  ERROR OR WARNING CODE OCCURS.                                  05280020
      ******************************************************************05290020
       9100-SQL-ABEND.                                                  05300020
           DISPLAY '** ABEND     **'.                                   05310020
           DISPLAY '** PROGRAM   ** = TFKUT476'.                        05320020
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05330020
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     05340020
                                                                        05350020
      ******************************************************************05360020
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    05370020
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05380020
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05390020
      * FORMAT.                                                         05400020
      ******************************************************************05410020
           COPY DPPD004.                                                05420020
                                                                        05430020
           MOVE +4013  TO  ABEND-CODE.                                  05440020
           CALL 'ILBOABN0' USING ABEND-CODE.                            05450020
