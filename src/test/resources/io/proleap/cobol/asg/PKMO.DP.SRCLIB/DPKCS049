000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.    DPKCS049.                                         00030000
000400 AUTHOR.        C. MASTEL.                                        00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  04-23-96.                                         00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*                                                                *00100000
001100*    UPDATE THE SYSTEM MESSAGES VSAM FILE(S).                    *00110000
001200*                                                                *00120000
001300*    FOR EACH SYSTEM MESSAGE ON THE DB2 'TSYMSG' TABLE           *00130000
001400*    WHOSE UPD-VSAM-IND IS SET TO 'Y'                            *00140000
001500*    1) UPDATE THE CORRESPONDING RECORD IN THE VSAM 'DPSYSMSG'   *00150000
001600*       FILE USED BY KOHL'S PROPRIETARY CICS ARCHITECTURE.       *00160000
001700*    2) DETERMINE WHETHER THERE IS CORRESPONDING 'EXTENDED TEXT' *00170000
001800*       2.A) ON THE DB2 'TSYMSGT' TABLE.                         *00180000
001900*       2.B) ON THE VSAM 'DPSYMSGT' FILE.                        *00190000
002000*       MAKE APPROPRIATE UPDATES TO THE VSAM 'DPSYMSGT' FILE,    *00200000
002100*       ADDING, REPLACING, OR DELETING THE EXTENDED TEXT.        *00210000
002200*    3) UPDATE THE SYSTEM MESSAGE ON THE DB2 'TSYMSG' TABLE,     *00220000
002300*       SETTING THE UPD-VSAM-IND TO 'N'.                         *00230000
002400*                                                                *00240000
002500*----------------------------------------------------------------*00250000
002600*  04/27/2000  JEFF ROUBIK                                       *00260000
002700*              FIXED A BUG IN PROCEDURE 9420-...                 *00270000
002800*  05/03/2000  JEFF ROUBIK                                       *00280000
002900*              REMOVED ABEND LOGIC WHEN THERE ARE NO MESSAGES    *00290000
003000*              TO UPDATE.  LET PROGRAM END GRACEFULLY.           *00300000
003100******************************************************************00310000
003200                                                                  00320000
003300                                                                  00330000
003400 ENVIRONMENT DIVISION.                                            00340000
003500                                                                  00350000
003600 DATA DIVISION.                                                   00360000
003700                                                                  00370000
003800 WORKING-STORAGE SECTION.                                         00380000
003900                                                                  00390000
004000 01  PC-PROGRAM-CONSTANTS.                                        00400000
004100     05  PC-CURRENT-PROGRAM-NAME        PIC X(8)     VALUE        00410000
004200                                                     'DPKCS049'.  00420000
004300     05  PC-MAX-RETRIES                 PIC 9(02)    VALUE  3.    00430000
004400     05  PC-UPD-VSAM-IND.                                         00440000
004500         10  PC-N-NOT-NEEDED            PIC X(1)     VALUE 'N'.   00450000
004600         10  PC-Y-UPDATE-REQUESTED      PIC X(1)     VALUE 'Y'.   00460000
004700                                                                  00470000
004800     05  PC-TSYMSG                      PIC X(8)     VALUE        00480000
004900                                                     'TSYMSG'.    00490000
005000     05  PC-TSYMSGT                     PIC X(8)     VALUE        00500000
005100                                                     'TSYMSGT'.   00510000
005200                                                                  00520000
005300     05  PC-MSG-VSAM-FILE               PIC X(8)     VALUE        00530000
005400                                                     'DPSYSMSG'.  00540000
005500     05  PC-MSG-VSAM-LEN                PIC S9(4)    VALUE +0075. 00550000
005600                                                                  00560000
005700     05  PC-TXT-VSAM-FILE               PIC X(8)     VALUE        00570000
005800                                                     'DPSYMSGT'.  00580000
005900     05  PC-TXT-VSAM-LEN                PIC S9(4)    VALUE +0080. 00590000
006000                                                                  00600000
006100     05  PC-LOG-QUEUE-RESOURCE          PIC  X(04)   VALUE 'CSSL'.00610000
006200     05  PC-LOG-QUEUE                   PIC  X(04)   VALUE 'CSSL'.00620000
006300                                                                  00630000
006400     05  PC-MESSAGES                    PIC X(10)    VALUE        00640000
006500                                                     'MESSAGES: '.00650000
006600     05  PC-EXT-TEXT                    PIC X(10)    VALUE        00660000
006700                                                     'EXT TEXT: '.00670000
006800                                                                  00680000
006900******************************************************************00690000
007000*    LAYOUT USED TO GET THE SYSTEM DATE AND TIME                  00700000
007100******************************************************************00710000
007200 01  DT-DATE-TIME-VARIABLES.                                      00720000
007300     05  DT-ABSTIME                  PIC S9(15)  VALUE ZERO       00730000
007400                                                 COMP-3.          00740000
007500     05  DT-YEAR-BIN                 PIC S9(09)  VALUE ZERO       00750000
007600                                                 COMP SYNC.       00760000
007700     05  DT-FORMATTED-TIME           PIC  X(08)  VALUE SPACE.     00770000
007800     05  DT-FORMATTED-DATE           PIC  X(10)  VALUE SPACE.     00780000
007900     05  FILLER                      REDEFINES DT-FORMATTED-DATE. 00790000
008000         10  DT-FORMATTED-MMDDYY     PIC  X(08).                  00800000
008100         10  FILLER                  PIC  X(02).                  00810000
008200     05  FILLER                      REDEFINES DT-FORMATTED-DATE. 00820000
008300         10  FILLER                  PIC  X(06).                  00830000
008400         10  DT-FORMATTED-YYYY       PIC  9(04).                  00840000
008500                                                                  00850000
008600                                                                  00860000
008700     05  PM-PROGRAM-MESSAGE-SCOREBOARD.                           00870000
008800         10  FILLER                     PIC X(21)    VALUE        00880000
008900                                        'DPKCS049 COMPLETE.'.     00890000
009000         10  PM-HEX15-LINEBREAK1        PIC X(1)     VALUE X'15'. 00900000
009100         10  FILLER                     PIC X(15)    VALUE        00910000
009200                                        'FINAL SCORE IS:'.        00920000
009300         10  PM-HEX15-LINEBREAK2        PIC X(1)     VALUE X'15'. 00930000
009400         10  PM-MSG-SCORE.                                        00940000
009500             15  FILLER                 PIC X(10)    VALUE        00950000
009600                                                     'MESSAGES: '.00960000
009700             15  PM-MSG-SUCCESSES       PIC 9(6)     VALUE ZERO.  00970000
009800             15  FILLER                 PIC X(1)     VALUE '-'.   00980000
009900             15  PM-MSG-AWRY            PIC 9(6)     VALUE ZERO.  00990000
010000         10  PM-HEX15-LINEBREAK3        PIC X(1)     VALUE X'15'. 01000000
010100         10  PM-TXT-SCORE.                                        01010000
010200             15  FILLER                 PIC X(10)    VALUE        01020000
010300                                                     'EXT TEXT: '.01030000
010400             15  PM-TXT-SUCCESSES       PIC 9(6)     VALUE ZERO.  01040000
010500             15  FILLER                 PIC X(1)     VALUE '-'.   01050000
010600             15  PM-TXT-AWRY            PIC 9(6)     VALUE ZERO.  01060000
010700     05  PM-SCOREBOARD-LENGTH           PIC S9(4)    COMP         01070000
010800                                                     VALUE 085.   01080000
010900                                                                  01090000
011000 01  PS-PROGRAM-SWITCHES.                                         01100000
011100     05  PS-MSG-VSAM-FOUND-SW           PIC X(01)    VALUE 'N'.   01110000
011200         88  PS-MSG-VSAM-FOUND                       VALUE 'Y'.   01120000
011300         88  PS-MSG-VSAM-NOT-FOUND                   VALUE 'N'.   01130000
011400                                                                  01140000
011500     05  PS-MSG-VSAM-UPDT-SW            PIC X(01)    VALUE 'N'.   01150000
011600         88  PS-MSG-VSAM-UPDT-OK                     VALUE 'Y'.   01160000
011700         88  PS-MSG-VSAM-UPDT-ERR                    VALUE 'N'.   01170000
011800                                                                  01180000
011900     05  PS-TXT-DB2-FOUND-SW            PIC X(01)    VALUE 'N'.   01190000
012000         88  PS-TXT-DB2-FOUND                        VALUE 'Y'.   01200000
012100         88  PS-TXT-DB2-NOT-FOUND                    VALUE 'N'.   01210000
012200                                                                  01220000
012300     05  PS-TXT-VSAM-FOUND-SW           PIC X(01)    VALUE 'N'.   01230000
012400         88  PS-TXT-VSAM-FOUND                       VALUE 'Y'.   01240000
012500         88  PS-TXT-VSAM-NOT-FOUND                   VALUE 'N'.   01250000
012600                                                                  01260000
012700     05  PS-TXT-VSAM-UPDT-SW            PIC X(01)    VALUE 'N'.   01270000
012800         88  PS-TXT-VSAM-UPDT-OK                     VALUE 'Y'.   01280000
012900         88  PS-TXT-VSAM-UPDT-ERR                    VALUE 'N'.   01290000
013000                                                                  01300000
013100     05  PS-TXT-VSAM-ACTION-SW          PIC X(01)    VALUE 'N'.   01310000
013200         88  PS-TXT-VSAM-ACTION                      VALUE 'Y'.   01320000
013300         88  PS-TXT-VSAM-NO-ACTION                   VALUE 'N'.   01330000
013400                                                                  01340000
013500     05  PS-TRANSACTION-SW              PIC X(01)    VALUE 'Y'.   01350000
013600         88  PS-TRANSACTION-ALLGOOD                  VALUE 'Y'.   01360000
013700         88  PS-TRANSACTION-AWRY                     VALUE 'N'.   01370000
013800                                                                  01380000
013900 01  PV-CURRENT-SYMSG-NBR-PACKED        PIC S9(5)V   VALUE ZERO   01390000
014000                                                     COMP-3.      01400000
014100 01  PV-CURRENT-SYMSG-NBR-NUMERIC       PIC 9(5)     VALUE ZERO.  01410000
014200                                                                  01420000
014300 01  PV-PROGRAM-VARIABLES.                                        01430000
014400     05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0     01440000
014500                                                     COMP SYNC.   01450000
014600     05  PV-RETRY-COUNTER               PIC S9(3)    VALUE ZERO   01460000
014700                                                     COMP-3.      01470000
014800     05  PV-SQL-SUB                     PIC S9(3)    VALUE ZERO   01480000
014900                                                     COMP-3.      01490000
015000     05  PV-SUB                         PIC S9(4)    VALUE ZERO   01500000
015100                                                     COMP.        01510000
015200     05  PV-RESP                        PIC S9(4)    VALUE ZERO   01520000
015300                                                     COMP.        01530000
015400     05  PV-NULL-IND                    PIC S9(4)    VALUE ZERO   01540000
015500                                                     COMP.        01550000
015600     05  PV-ABEND-INFO.                                           01560000
015700         10  PV-ABEND-SYMSG             PIC X(8)     VALUE SPACE. 01570000
015800         10  FILLER                     PIC X(2)     VALUE ', '.  01580000
015900         10  PV-ABEND-TIMESTAMP         PIC X(26)    VALUE SPACE. 01590000
016000                                                                  01600000
016100     05  PV-PROGRAM-SCOREBOARD.                                   01610000
016200         10  PV-MSG-SUCCESSES           PIC 9(6)     VALUE ZERO.  01620000
016300         10  PV-MSG-AWRY                PIC 9(6)     VALUE ZERO.  01630000
016400         10  PV-TXT-SUCCESSES           PIC 9(6)     VALUE ZERO.  01640000
016500         10  PV-TXT-AWRY                PIC 9(6)     VALUE ZERO.  01650000
016600                                                                  01660000
016700     05  PV-LOG-LINE                    PIC  X(60)  VALUE SPACE.  01670000
016800     05  PV-LOG-START-LINE.                                       01680000
016900         10  FILLER                     PIC  X(22)  VALUE         01690000
017000                                        ' DPKCS049: STARTED AT '. 01700000
017100         10  PV-LOG-START-TIME          PIC  X(08)  VALUE SPACE.  01710000
017200         10  FILLER                     PIC  X(01)  VALUE SPACE.  01720000
017300         10  PV-LOG-START-DATE          PIC  X(10)  VALUE SPACE.  01730000
017400                                                                  01740000
017500     05  PV-LOG-STATS-LINE.                                       01750000
017600         10  FILLER                     PIC  X(11)   VALUE        01760000
017700                                        ' DPKCS049: '.            01770000
017800         10  PV-LOG-STATS-DESC          PIC  X(10)   VALUE SPACE. 01780000
017900         10  PV-LOG-SUCCESSES           PIC 9(6)     VALUE ZERO.  01790000
018000         10  FILLER                     PIC X(1)     VALUE '-'.   01800000
018100         10  PV-LOG-AWRY                PIC 9(6)     VALUE ZERO.  01810000
018200*                                                                 01820000
018300     05  PV-LOG-END-LINE.                                         01830000
018400         10  FILLER                     PIC  X(20)  VALUE         01840000
018500                                        ' DPKCS049: ENDED AT '.   01850000
018600         10  PV-LOG-END-TIME            PIC  X(08)  VALUE SPACE.  01860000
018700         10  FILLER                     PIC  X(01)  VALUE SPACE.  01870000
018800         10  PV-LOG-END-DATE            PIC  X(10)  VALUE SPACE.  01880000
018900*                                                                 01890000
019000***************************************************************** 01900000
019100*    SYMSG (MESSAGE) VSAM RECORD LAYOUT.                          01910000
019200***************************************************************** 01920000
019300     COPY DPRD507O.                                               01930000
019400                                                                  01940000
019500                                                                  01950000
019600***************************************************************** 01960000
019700*    SYMSGT (EXTENDED TEXT) VSAM RECORD LAYOUT.                   01970000
019800***************************************************************** 01980000
019900     COPY DPRD508O.                                               01990000
020000                                                                  02000000
020100                                                                  02010000
020200***************************************************************** 02020000
020300*    ABEND PROCESSING COPYBOOK.                                   02030000
020400***************************************************************** 02040000
020500     COPY DPWS013.                                                02050000
020600                                                                  02060000
020700                                                                  02070000
020800***************************************************************** 02080000
020900*    DB2 SYMSG TABLE: SHORT TEXT                                  02090000
021000***************************************************************** 02100000
021100     EXEC SQL                                                     02110000
021200          INCLUDE TSYMSG                                          02120000
021300     END-EXEC.                                                    02130000
021400                                                                  02140000
021500                                                                  02150000
021600***************************************************************** 02160000
021700*    DB2 SYMSGT TABLE: EXTENDED TEXT                              02170000
021800***************************************************************** 02180000
021900     EXEC SQL                                                     02190000
022000          INCLUDE TSYMSGT                                         02200000
022100     END-EXEC.                                                    02210000
022200                                                                  02220000
022300                                                                  02230000
022400***************************************************************** 02240000
022500*    DB2 COMMUNICATIONS AREA                                      02250000
022600***************************************************************** 02260000
022700     EXEC SQL                                                     02270000
022800          INCLUDE SQLCA                                           02280000
022900     END-EXEC.                                                    02290000
023000                                                                  02300000
023100                                                                  02310000
023200***************************************************************** 02320000
023300*    TSYMSG CURSOR FOR SELECTING ALL SYMSGS MARKED FOR UPDATE.    02330000
023400***************************************************************** 02340000
023500     EXEC SQL                                                     02350000
023600          DECLARE MSG-CURSOR CURSOR FOR                           02360000
023700          SELECT  SYMSG_NBR                                       02370000
023800               ,  APLSYS_CDE                                      02380000
023900               ,  REV_IND                                         02390000
024000               ,  SHT_TXT                                         02400000
024100               ,  UPD_VSAM_IND                                    02410000
024200          FROM    TSYMSG                                          02420000
024300          WHERE   UPD_VSAM_IND    =  :PC-Y-UPDATE-REQUESTED       02430000
024400          ORDER BY                                                02440000
024500                  SYMSG_NBR                                       02450000
024600     END-EXEC.                                                    02460000
024700                                                                  02470000
024800                                                                  02480000
024900***************************************************************** 02490000
025000*    TSYMSGT CURSOR FOR ALL CORRESPONDING ROWS FROM THE           02500000
025100*    EXTENDED TEXT TABLE.                                         02510000
025200***************************************************************** 02520000
025300     EXEC SQL                                                     02530000
025400          DECLARE TXT-CURSOR CURSOR FOR                           02540000
025500          SELECT  SYMSG_NBR                                       02550000
025600               ,  TYP_CDE                                         02560000
025700               ,  LNE_SEQ_NBR                                     02570000
025800               ,  APLSYS_CDE                                      02580000
025900               ,  LNE_TXT                                         02590000
026000          FROM    TSYMSGT                                         02600000
026100          WHERE   SYMSG_NBR       =  :PV-CURRENT-SYMSG-NBR-PACKED 02610000
026200          ORDER BY                                                02620000
026300                  TYP_CDE,                                        02630000
026400                  LNE_SEQ_NBR                                     02640000
026500     END-EXEC.                                                    02650000
026600                                                                  02660000
026700                                                                  02670000
026800********************                                              02680000
026900 PROCEDURE DIVISION.                                              02690000
027000********************                                              02700000
027100                                                                  02710000
027200 0000-MAIN-MODULE.                                                02720000
027300                                                                  02730000
027400     PERFORM 1000-INITIALIZATIONS.                                02740000
027500                                                                  02750000
027600     PERFORM 2000-CONTROL-PROCESSING.                             02760000
027700                                                                  02770000
027800     PERFORM 5000-TERMINATION.                                    02780000
027900                                                                  02790000
028000     GOBACK.                                                      02800000
028100*                                                                 02810000
028200                                                                  02820000
028300 1000-INITIALIZATIONS.                                            02830000
028400******************************************************************02840000
028500*    INITIALIZATIONS.                                             02850000
028600******************************************************************02860000
028700     PERFORM 9000-GET-CURR-DATE-TIME.                             02870000
028800     MOVE DT-FORMATTED-TIME   TO PV-LOG-START-TIME.               02880000
028900     MOVE DT-FORMATTED-DATE   TO PV-LOG-START-DATE.               02890000
029000     MOVE PV-LOG-START-LINE   TO PV-LOG-LINE.                     02900000
029100     PERFORM 9800-ENQUEUE.                                        02910000
029200     PERFORM 9810-WRITEQ-TD.                                      02920000
029300                                                                  02930000
029400                                                                  02940000
029500 2000-CONTROL-PROCESSING.                                         02950000
029600******************************************************************02960000
029700*    PROCESS SYSMSG UPDATES.                                      02970000
029800******************************************************************02980000
029900     PERFORM 9100-OPEN-MSG-CURSOR.                                02990000
030000     PERFORM 9110-FETCH-MSG-CURSOR.                               03000000
030100                                                                  03010000
030200**** IF  SQLCODE = +100                                           03020000
030300****     SET PS-TRANSACTION-AWRY        TO  TRUE                  03030000
030400****     MOVE '2000-CONTROL-PROCESSING' TO  DP013-PARAGRAPH       03040000
030500****     INITIALIZE                         DP013-MESSAGE-TABLE   03050000
030600****     MOVE 'THERE ARE NO TSYMSG ROWS WITH UPD_VSAM_IND = '     03060000
030700****                                    TO  DP013-MESSAGE-TEXT (1)03070000
030800****     MOVE PC-Y-UPDATE-REQUESTED                               03080000
030900****                                    TO  DP013-MESSAGE-TEXT (2)03090000
031000****     MOVE SQLCA                     TO  DP013-SQLCA           03100000
031100****     MOVE PC-TSYMSG                 TO                        03110000
031200****                                    DP013-DB2-TABLE-NAME (1)  03120000
031300****     SET DP013-LINK-RETURN          TO  TRUE                  03130000
031400****     SET DP013-NO-ROLLBACK          TO  TRUE                  03140000
031500****     SET DP013-DB2-ABEND            TO  TRUE                  03150000
031600****     PERFORM DP014-0000-PROCESS-ABEND                         03160000
031700**** END-IF.                                                      03170000
031800                                                                  03180000
031900     PERFORM                                                      03190000
032000     UNTIL SQLCODE NOT EQUAL ZERO                                 03200000
032100         MOVE SYMSG-SYMSG-NBR TO PV-CURRENT-SYMSG-NBR-PACKED      03210000
032200                                 PV-CURRENT-SYMSG-NBR-NUMERIC     03220000
032300         PERFORM 3000-CONTROL-MSG-VSAM-UPDATE                     03230000
032400         PERFORM 9110-FETCH-MSG-CURSOR                            03240000
032500     END-PERFORM.                                                 03250000
032600     PERFORM 9130-CLOSE-MSG-CURSOR.                               03260000
032700                                                                  03270000
032800                                                                  03280000
032900 3000-CONTROL-MSG-VSAM-UPDATE.                                    03290000
033000******************************************************************03300000
033100*    1) READ THE VSAM MSG FILE FOR THE CURRENT MSG NBR.           03310000
033200*       - IF RECORD EXISTS, IT WILL BE UPDATED (REWRITE).         03320000
033300*       - IF RECORD DOES NOT EXIST, IT WILL BE ADDED (WRITE).     03330000
033400******************************************************************03340000
033500     SET  PS-TRANSACTION-ALLGOOD       TO TRUE.                   03350000
033600     INITIALIZE PS-MSG-VSAM-FOUND-SW                              03360000
033700                PS-MSG-VSAM-UPDT-SW                               03370000
033800                DP507O-MESSAGES-OUTPUT-RECORD.                    03380000
033900                                                                  03390000
034000     MOVE PV-CURRENT-SYMSG-NBR-NUMERIC TO  DP507O-MSG-NUMBER.     03400000
034100     PERFORM 9400-READ-MSG-VSAM.                                  03410000
034200                                                                  03420000
034300     IF PS-TRANSACTION-ALLGOOD                                    03430000
034400         MOVE SYMSG-SHT-TXT            TO  DP507O-MSG-TEXT        03440000
034500         IF  PS-MSG-VSAM-FOUND                                    03450000
034600             PERFORM 9410-REWRITE-MSG-VSAM                        03460000
034700         ELSE                                                     03470000
034800             PERFORM 9420-WRITE-MSG-VSAM                          03480000
034900         END-IF                                                   03490000
035000     ELSE                                                         03500000
035100         PERFORM 9401-UNLOCK-MSG-VSAM                             03510000
035200     END-IF.                                                      03520000
035300                                                                  03530000
035400     IF PS-TRANSACTION-ALLGOOD                                    03540000
035500         PERFORM 4000-CONTROL-TXT-VSAM-UPDATE.                    03550000
035600                                                                  03560000
035700     IF  PS-TRANSACTION-ALLGOOD                                   03570000
035800     AND PS-MSG-VSAM-UPDT-OK                                      03580000
035900         PERFORM 9120-UPDATE-MSG-ROW.                             03590000
036000                                                                  03600000
036100*    *************************************************************03610000
036200*    * ACCUMULATE COUNTS IN THE SCOREBOARD.                       03620000
036300*    *************************************************************03630000
036400     IF  PS-TRANSACTION-ALLGOOD                                   03640000
036500         ADD 1 TO PV-MSG-SUCCESSES                                03650000
036600     ELSE                                                         03660000
036700         ADD 1 TO PV-MSG-AWRY                                     03670000
036800     END-IF.                                                      03680000
036900                                                                  03690000
037000                                                                  03700000
037100 4000-CONTROL-TXT-VSAM-UPDATE.                                    03710000
037200******************************************************************03720000
037300*    ALSO UPDATE THE EXTENDED TEXT RECORD IF APPLICABLE.          03730000
037400*    1) CHECK THE SYMSGT DB2 TABLE FOR THE PRESENCE OF ANY        03740000
037500*       EXTENDED MESSAGE LINES.                                   03750000
037600*       A) IF ROW(S) OF EXTENDED MESSAGE LINES EXIST:             03760000
037700*          READ THE TXT VSAM FILE FOR THE EXTENDED TEXT.          03770000
037800*            - IF RECORD(S) EXISTS, REPLACE EXTENDED TEXT.        03780000
037900*              (DELETE ALL RECORDS OF EXTENDED TEXT FOR THIS MSG, 03790000
038000*              THEN WRITE TO ADD EACH NEW EXTENDED TEXT RECORD).  03800000
038100*            - IF NO RECORD(S) EXIST, ADD EXTENDED TEXT (WRITE).  03810000
038200*       B) IF ROW(S) OF EXTENDED MESSAGE LINES DO NOT EXIST:      03820000
038300*          READ THE TXT VSAM FILE FOR THE EXTENDED TEXT.          03830000
038400*            - IF RECORD(S) EXISTS, DELETE EXTENDED TEXT.         03840000
038500*            - IF NO RECORD(S) EXIST, NO ACTION NEEDED.           03850000
038600******************************************************************03860000
038700     INITIALIZE DP508O-SYSTEM-MESSAGE-TEXT-RCD.                   03870000
038800     SET        PS-TXT-DB2-NOT-FOUND  TO TRUE.                    03880000
038900     SET        PS-TXT-VSAM-NOT-FOUND TO TRUE.                    03890000
039000     SET        PS-TXT-VSAM-UPDT-ERR  TO TRUE.                    03900000
039100     SET        PS-TXT-VSAM-NO-ACTION TO TRUE.                    03910000
039200                                                                  03920000
039300*    *************************************************************03930000
039400*    * DETERMINE WHETHER TXT DB2 UPDATE ROW(S) EXIST.             03940000
039500*    *************************************************************03950000
039600     PERFORM 9200-OPEN-TXT-CURSOR.                                03960000
039700     PERFORM 9210-FETCH-TXT-CURSOR.                               03970000
039800                                                                  03980000
039900                                                                  03990000
040000*    *************************************************************04000000
040100*    * DETERMINE WHETHER TXT VSAM RECORD(S) EXIST.                04010000
040200*    *************************************************************04020000
040300     MOVE PV-CURRENT-SYMSG-NBR-NUMERIC                            04030000
040400                                 TO  DP508O-SYSTEM-MESSAGE-NUMBER.04040000
040500     PERFORM 9500-READ-TXT-VSAM.                                  04050000
040600                                                                  04060000
040700                                                                  04070000
040800*    *************************************************************04080000
040900*    * DETERMINE ACTION, BASED ON WHAT EXISTS.                    04090000
041000*    *************************************************************04100000
041100     IF PS-TXT-DB2-FOUND                                          04110000
041200         IF PS-TXT-VSAM-FOUND                                     04120000
041300             PERFORM 9530-DELETE-TXT-VSAM                         04130000
041400             PERFORM 4100-CONTROL-TXT-ADD                         04140000
041500             SET PS-TXT-VSAM-ACTION    TO TRUE                    04150000
041600         ELSE                                                     04160000
041700             PERFORM 4100-CONTROL-TXT-ADD                         04170000
041800             SET PS-TXT-VSAM-ACTION    TO TRUE                    04180000
041900         END-IF                                                   04190000
042000     END-IF.                                                      04200000
042100                                                                  04210000
042200     IF PS-TXT-DB2-NOT-FOUND                                      04220000
042300         IF PS-TXT-VSAM-FOUND                                     04230000
042400             PERFORM 9530-DELETE-TXT-VSAM                         04240000
042500             SET PS-TXT-VSAM-ACTION    TO TRUE                    04250000
042600         ELSE                                                     04260000
042700             SET PS-TXT-VSAM-NO-ACTION TO TRUE                    04270000
042800         END-IF                                                   04280000
042900     END-IF.                                                      04290000
043000                                                                  04300000
043100                                                                  04310000
043200*    *************************************************************04320000
043300*    * ACTION, IF NEEDED, IS NOW COMPLETE; CLOSE CURSOR.          04330000
043400*    *************************************************************04340000
043500     PERFORM 9230-CLOSE-TXT-CURSOR.                               04350000
043600                                                                  04360000
043700                                                                  04370000
043800     IF  PS-TXT-VSAM-ACTION                                       04380000
043900*        *********************************************************04390000
044000*        * ACCUMULATE COUNTS IN THE SCOREBOARD.                   04400000
044100*        *********************************************************04410000
044200         IF  PS-TRANSACTION-ALLGOOD                               04420000
044300             ADD 1 TO PV-TXT-SUCCESSES                            04430000
044400         ELSE                                                     04440000
044500             ADD 1 TO PV-TXT-AWRY                                 04450000
044600         END-IF                                                   04460000
044700     END-IF.                                                      04470000
044800                                                                  04480000
044900                                                                  04490000
045000 4100-CONTROL-TXT-ADD.                                            04500000
045100******************************************************************04510000
045200* ADD NEW RECORDS TO VSAM TXT, FROM THE DB2 EXTENDED MESSAGE      04520000
045300* TABLE.                                                          04530000
045400******************************************************************04540000
045500     PERFORM                                                      04550000
045600        UNTIL SQLCODE NOT EQUAL ZERO                              04560000
045700             INITIALIZE DP508O-SYSTEM-MESSAGE-TEXT-RCD            04570000
045800             MOVE SYMSGT-SYMSG-NBR TO DP508O-SYSTEM-MESSAGE-NUMBER04580000
045900             MOVE SYMSGT-TYP-CDE   TO DP508O-MESSAGE-TYPE-CODE    04590000
046000             MOVE SYMSGT-LNE-SEQ-NBR                              04600000
046100                                   TO                             04610000
046200                                   DP508O-MESSAGE-LINE-SEQ-NUMBER 04620000
046300             MOVE SYMSGT-APLSYS-CDE                               04630000
046400                                   TO DP508O-APPL-SYSTEM-CODE     04640000
046500             MOVE SYMSGT-LNE-TXT   TO DP508O-SYSTEM-MESSAGE-TEXT  04650000
046600             PERFORM 9520-WRITE-TXT-VSAM                          04660000
046700             PERFORM 9210-FETCH-TXT-CURSOR                        04670000
046800     END-PERFORM.                                                 04680000
046900                                                                  04690000
047000                                                                  04700000
047100 5000-TERMINATION.                                                04710000
047200******************************************************************04720000
047300* END-OF-RUN ROUTINE.                                             04730000
047400******************************************************************04740000
047500                                                                  04750000
047600                                                                  04760000
047700*    *************************************************************04770000
047800*    * WRITE FINAL SCOREBOARD STATS TO THE CICS LOG.              04780000
047900*    *************************************************************04790000
048000     MOVE PV-MSG-SUCCESSES    TO PM-MSG-SUCCESSES                 04800000
048100                                 PV-LOG-SUCCESSES.                04810000
048200     MOVE PV-MSG-AWRY         TO PM-MSG-AWRY                      04820000
048300                                 PV-LOG-AWRY.                     04830000
048400     MOVE PC-MESSAGES         TO PV-LOG-STATS-DESC.               04840000
048500     MOVE PV-LOG-STATS-LINE   TO PV-LOG-LINE.                     04850000
048600     PERFORM 9810-WRITEQ-TD.                                      04860000
048700                                                                  04870000
048800                                                                  04880000
048900     MOVE PV-TXT-SUCCESSES    TO PM-TXT-SUCCESSES                 04890000
049000                                 PV-LOG-SUCCESSES                 04900000
049100     MOVE PV-TXT-AWRY         TO PM-TXT-AWRY                      04910000
049200                                 PV-LOG-AWRY.                     04920000
049300     MOVE PC-EXT-TEXT         TO PV-LOG-STATS-DESC.               04930000
049400     MOVE PV-LOG-STATS-LINE   TO PV-LOG-LINE.                     04940000
049500     PERFORM 9810-WRITEQ-TD.                                      04950000
049600                                                                  04960000
049700                                                                  04970000
049800     PERFORM 9000-GET-CURR-DATE-TIME.                             04980000
049900     MOVE DT-FORMATTED-TIME   TO PV-LOG-END-TIME.                 04990000
050000     MOVE DT-FORMATTED-DATE   TO PV-LOG-END-DATE.                 05000000
050100     MOVE PV-LOG-END-LINE     TO PV-LOG-LINE.                     05010000
050200     PERFORM 9810-WRITEQ-TD.                                      05020000
050300     PERFORM 9820-DEQUEUE.                                        05030000
050400                                                                  05040000
050500                                                                  05050000
050600*    *************************************************************05060000
050700*    * DISPLAY SCOREBOARD.                                        05070000
050800*    *************************************************************05080000
050900     PERFORM 9900-SEND-TEXT.                                      05090000
051000                                                                  05100000
051100     EXEC CICS                                                    05110000
051200         RETURN                                                   05120000
051300     END-EXEC.                                                    05130000
051400                                                                  05140000
051500                                                                  05150000
051600 9000-GET-CURR-DATE-TIME.                                         05160000
051700******************************************************************05170000
051800*   GET THE CURRENT FORMATTED DATE AND TIME                       05180000
051900******************************************************************05190000
052000     EXEC CICS                                                    05200000
052100         ASKTIME                                                  05210000
052200             ABSTIME (DT-ABSTIME)                                 05220000
052300     END-EXEC.                                                    05230000
052400                                                                  05240000
052500     EXEC CICS                                                    05250000
052600         FORMATTIME                                               05260000
052700             ABSTIME (DT-ABSTIME)                                 05270000
052800             MMDDYY  (DT-FORMATTED-MMDDYY)                        05280000
052900             DATESEP                                              05290000
053000             TIME    (DT-FORMATTED-TIME)                          05300000
053100             TIMESEP                                              05310000
053200     END-EXEC.                                                    05320000
053300*                                                                 05330000
053400     EXEC CICS                                                    05340000
053500         FORMATTIME                                               05350000
053600             ABSTIME (DT-ABSTIME)                                 05360000
053700             YEAR    (DT-YEAR-BIN)                                05370000
053800     END-EXEC.                                                    05380000
053900     MOVE DT-YEAR-BIN   TO DT-FORMATTED-YYYY.                     05390000
054000                                                                  05400000
054100                                                                  05410000
054200******************************************************************05420000
054300******************************************************************05430000
054400*    ALL FILE ACCESS PARAGRAPHS IN THIS PROGRAM BEGIN WITH        05440000
054500*    NINE-THOUSAND:                                               05450000
054600*    1) DB2 MSG TABLE ACCESS...TSYMSG   - 91XX                    05460000
054700*    2) DB2 TXT TABLE ACCESS...TSYMSGT  - 92XX                    05470000
054800*    3) VSAM MSG FILE ACCESS...DPSYSMSG - 94XX                    05480000
054900*    4) VSAM TXT FILE ACCESS...DPSYMSGT - 95XX                    05490000
055000******************************************************************05500000
055100******************************************************************05510000
055200                                                                  05520000
055300                                                                  05530000
055400 9100-OPEN-MSG-CURSOR.                                            05540000
055500******************************************************************05550000
055600*    OPEN THE CURSOR OF ALL MSGS MARKED FOR DELETION.             05560000
055700******************************************************************05570000
055800     MOVE SPACES TO DP013-ABEND-TYPE-IND.                         05580000
055900     PERFORM WITH TEST AFTER                                      05590000
056000         VARYING PV-SQL-SUB                                       05600000
056100         FROM 1 BY 1                                              05610000
056200         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             05620000
056300            OR SQLCODE EQUAL ZERO                                 05630000
056400            OR SQLCODE EQUAL +100                                 05640000
056500            OR DP013-DB2-ABEND                                    05650000
056600                                                                  05660000
056700         EXEC SQL                                                 05670000
056800              OPEN                                                05680000
056900                   MSG-CURSOR                                     05690000
057000         END-EXEC                                                 05700000
057100                                                                  05710000
057200         EVALUATE TRUE                                            05720000
057300             WHEN SQLCODE = ZERO                                  05730000
057400             WHEN SQLCODE = +100                                  05740000
057500             WHEN SQLCODE = -904                                  05750000
057600             WHEN SQLCODE = -913                                  05760000
057700*                 ************************************************05770000
057800*                 *    0 SUCCESSFUL                               05780000
057900*                 * +100 NOT FOUND                                05790000
058000*                 * -904 UNAVAILABLE RESOURCE                     05800000
058100*                 * -913 DEADLOCK OR TIMEOUT                      05810000
058200*                 ************************************************05820000
058300                  CONTINUE                                        05830000
058400             WHEN SQLWARN0 NOT EQUAL SPACE                        05840000
058500             WHEN SQLCODE NOT EQUAL ZERO                          05850000
058600*                 ************************************************05860000
058700*                 * ALL OTHER                                     05870000
058800*                 ************************************************05880000
058900                  SET PS-TRANSACTION-AWRY                         05890000
059000                                        TO  TRUE                  05900000
059100                  MOVE '9100-OPEN-MSG-CURSOR'                     05910000
059200                                        TO  DP013-PARAGRAPH       05920000
059300                  INITIALIZE                DP013-MESSAGE-TABLE   05930000
059400                  MOVE 'OPEN FAILED'    TO  DP013-MESSAGE-TEXT (1)05940000
059500                  MOVE SQLCA            TO  DP013-SQLCA           05950000
059600                  MOVE PC-TSYMSG        TO                        05960000
059700                                        DP013-DB2-TABLE-NAME (1)  05970000
059800                  SET DP013-LINK-RETURN TO  TRUE                  05980000
059900                  SET DP013-NO-ROLLBACK TO  TRUE                  05990000
060000                  SET DP013-DB2-ABEND   TO  TRUE                  06000000
060100                  PERFORM DP014-0000-PROCESS-ABEND                06010000
060200         END-EVALUATE                                             06020000
060300     END-PERFORM.                                                 06030000
060400                                                                  06040000
060500     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   06050000
060600         SET PS-TRANSACTION-AWRY        TO  TRUE                  06060000
060700         MOVE '9100-OPEN-MSG-CURSOR'    TO  DP013-PARAGRAPH       06070000
060800         INITIALIZE                         DP013-MESSAGE-TABLE   06080000
060900         MOVE 'MAX RETRIES EXCEEDED FOR CURSOR OPEN'              06090000
061000                                        TO  DP013-MESSAGE-TEXT (1)06100000
061100         MOVE SQLCA                     TO  DP013-SQLCA           06110000
061200         MOVE PC-TSYMSG                 TO                        06120000
061300                                        DP013-DB2-TABLE-NAME (1)  06130000
061400         SET DP013-LINK-RETURN          TO  TRUE                  06140000
061500         SET DP013-NO-ROLLBACK          TO  TRUE                  06150000
061600         SET DP013-DB2-ABEND            TO  TRUE                  06160000
061700         PERFORM DP014-0000-PROCESS-ABEND                         06170000
061800     END-IF.                                                      06180000
061900                                                                  06190000
062000                                                                  06200000
062100 9110-FETCH-MSG-CURSOR.                                           06210000
062200******************************************************************06220000
062300*    FETCH THE NEXT RECORD FROM THE CURSOR OF ALL MSGS            06230000
062400*    MARKED FOR UPDATING.                                         06240000
062500******************************************************************06250000
062600     MOVE SPACES TO DP013-ABEND-TYPE-IND.                         06260000
062700     PERFORM WITH TEST AFTER                                      06270000
062800         VARYING PV-SQL-SUB                                       06280000
062900         FROM 1 BY 1                                              06290000
063000         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             06300000
063100            OR SQLCODE EQUAL ZERO                                 06310000
063200            OR SQLCODE EQUAL +100                                 06320000
063300            OR DP013-DB2-ABEND                                    06330000
063400                                                                  06340000
063500         EXEC SQL                                                 06350000
063600              FETCH                                               06360000
063700                   MSG-CURSOR                                     06370000
063800              INTO                                                06380000
063900                  :SYMSG-SYMSG-NBR                                06390000
064000                , :SYMSG-APLSYS-CDE                               06400000
064100                , :SYMSG-REV-IND                                  06410000
064200                , :SYMSG-SHT-TXT                                  06420000
064300                , :SYMSG-UPD-VSAM-IND                             06430000
064400         END-EXEC                                                 06440000
064500                                                                  06450000
064600         EVALUATE TRUE                                            06460000
064700             WHEN SQLCODE = ZERO                                  06470000
064800             WHEN SQLCODE = +100                                  06480000
064900             WHEN SQLCODE = -904                                  06490000
065000             WHEN SQLCODE = -913                                  06500000
065100*                 ************************************************06510000
065200*                 *    0 SUCCESSFUL                               06520000
065300*                 * +100 NOT FOUND                                06530000
065400*                 * -904 UNAVAILABLE RESOURCE                     06540000
065500*                 * -913 DEADLOCK OR TIMEOUT                      06550000
065600*                 ************************************************06560000
065700                  CONTINUE                                        06570000
065800             WHEN SQLWARN0 NOT EQUAL SPACE                        06580000
065900             WHEN SQLCODE NOT EQUAL ZERO                          06590000
066000*                 ************************************************06600000
066100*                 * ALL OTHER                                     06610000
066200*                 ************************************************06620000
066300                  SET PS-TRANSACTION-AWRY                         06630000
066400                                        TO  TRUE                  06640000
066500                  MOVE '9110-FETCH-MSG-CURSOR'                    06650000
066600                                        TO  DP013-PARAGRAPH       06660000
066700                  INITIALIZE                DP013-MESSAGE-TABLE   06670000
066800                  MOVE 'FETCH FAILED'   TO  DP013-MESSAGE-TEXT (1)06680000
066900                  MOVE SQLCA            TO  DP013-SQLCA           06690000
067000                  MOVE PC-TSYMSG        TO                        06700000
067100                                        DP013-DB2-TABLE-NAME (1)  06710000
067200                  SET DP013-LINK-RETURN TO  TRUE                  06720000
067300                  SET DP013-NO-ROLLBACK TO  TRUE                  06730000
067400                  SET DP013-DB2-ABEND   TO  TRUE                  06740000
067500                  PERFORM DP014-0000-PROCESS-ABEND                06750000
067600         END-EVALUATE                                             06760000
067700     END-PERFORM.                                                 06770000
067800                                                                  06780000
067900     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   06790000
068000         SET PS-TRANSACTION-AWRY        TO  TRUE                  06800000
068100         MOVE '9110-FETCH-MSG-CURSOR'   TO  DP013-PARAGRAPH       06810000
068200         INITIALIZE                         DP013-MESSAGE-TABLE   06820000
068300         MOVE 'MAX RETRIES EXCEEDED FOR FETCH'                    06830000
068400                                        TO  DP013-MESSAGE-TEXT (1)06840000
068500         MOVE SQLCA                     TO  DP013-SQLCA           06850000
068600         MOVE PC-TSYMSG                 TO                        06860000
068700                                        DP013-DB2-TABLE-NAME (1)  06870000
068800         SET DP013-DB2-ABEND            TO  TRUE                  06880000
068900         PERFORM DP014-0000-PROCESS-ABEND                         06890000
069000     END-IF.                                                      06900000
069100                                                                  06910000
069200                                                                  06920000
069300 9120-UPDATE-MSG-ROW.                                             06930000
069400******************************************************************06940000
069500*    UPDATE THE TSYMSG TABLE, FOR THE INFORMATION WHICH HAS      *06950000
069600*    BEEN SUCCESSFULLY COPIED TO THE MSG VSAM FILE.              *06960000
069700******************************************************************06970000
069800     MOVE SPACES TO DP013-ABEND-TYPE-IND.                         06980000
069900     PERFORM WITH TEST AFTER                                      06990000
070000         VARYING PV-SQL-SUB                                       07000000
070100         FROM 1 BY 1                                              07010000
070200         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             07020000
070300            OR SQLCODE EQUAL ZERO                                 07030000
070400            OR SQLCODE EQUAL +100                                 07040000
070500            OR DP013-DB2-ABEND                                    07050000
070600                                                                  07060000
070700       EXEC SQL                                                   07070000
070800           UPDATE TSYMSG                                          07080000
070900             SET  UPD_VSAM_IND   = :PC-N-NOT-NEEDED               07090000
071000            WHERE (SYMSG_NBR     = :PV-CURRENT-SYMSG-NBR-PACKED)  07100000
071100       END-EXEC                                                   07110000
071200                                                                  07120000
071300       EVALUATE TRUE                                              07130000
071400             WHEN SQLCODE = ZERO                                  07140000
071500             WHEN SQLCODE = +100                                  07150000
071600             WHEN SQLCODE = -904                                  07160000
071700             WHEN SQLCODE = -913                                  07170000
071800*                 ************************************************07180000
071900*                 *    0 SUCCESSFUL                               07190000
072000*                 * +100 NOT FOUND                                07200000
072100*                 * -904 UNAVAILABLE RESOURCE                     07210000
072200*                 * -913 DEADLOCK OR TIMEOUT                      07220000
072300*                 ************************************************07230000
072400                  CONTINUE                                        07240000
072500             WHEN SQLWARN0 NOT EQUAL SPACE                        07250000
072600             WHEN SQLCODE NOT EQUAL ZERO                          07260000
072700*                 ************************************************07270000
072800*                 * ALL OTHER                                     07280000
072900*                 ************************************************07290000
073000                  SET PS-TRANSACTION-AWRY                         07300000
073100                                        TO  TRUE                  07310000
073200                  MOVE '9120-UPDATE-MSG-ROW'                      07320000
073300                                        TO  DP013-PARAGRAPH       07330000
073400                  INITIALIZE                DP013-MESSAGE-TABLE   07340000
073500                  MOVE 'UPDATE FAILED FOR MSG:'                   07350000
073600                                        TO  DP013-MESSAGE-TEXT (1)07360000
073700                  MOVE PV-CURRENT-SYMSG-NBR-NUMERIC               07370000
073800                                        TO  DP013-MESSAGE-TEXT (2)07380000
073900                  MOVE SQLCA            TO  DP013-SQLCA           07390000
074000                  MOVE PC-TSYMSG        TO                        07400000
074100                                        DP013-DB2-TABLE-NAME (1)  07410000
074200                  SET DP013-LINK-RETURN TO  TRUE                  07420000
074300                  SET DP013-NO-ROLLBACK TO  TRUE                  07430000
074400                  SET DP013-DB2-ABEND   TO  TRUE                  07440000
074500                  PERFORM DP014-0000-PROCESS-ABEND                07450000
074600         END-EVALUATE                                             07460000
074700     END-PERFORM.                                                 07470000
074800                                                                  07480000
074900     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   07490000
075000         SET PS-TRANSACTION-AWRY        TO  TRUE                  07500000
075100         MOVE '9120-UPDATE-MSG-ROW'     TO  DP013-PARAGRAPH       07510000
075200         INITIALIZE                         DP013-MESSAGE-TABLE   07520000
075300         MOVE 'MAX RETRIES EXCEEDED FOR UPDATE'                   07530000
075400                                        TO  DP013-MESSAGE-TEXT (1)07540000
075500         MOVE SQLCA                     TO  DP013-SQLCA           07550000
075600         MOVE PC-TSYMSG                 TO                        07560000
075700                                        DP013-DB2-TABLE-NAME (1)  07570000
075800         SET DP013-DB2-ABEND            TO  TRUE                  07580000
075900         SET DP013-LINK-RETURN          TO  TRUE                  07590000
076000         SET DP013-NO-ROLLBACK          TO  TRUE                  07600000
076100         PERFORM DP014-0000-PROCESS-ABEND                         07610000
076200     END-IF.                                                      07620000
076300                                                                  07630000
076400                                                                  07640000
076500 9130-CLOSE-MSG-CURSOR.                                           07650000
076600******************************************************************07660000
076700*    CLOSE THE CURSOR OF ALL SYMSGS MARKED FOR UPDATING TO VSAM.  07670000
076800******************************************************************07680000
076900     MOVE SPACES TO DP013-ABEND-TYPE-IND.                         07690000
077000     PERFORM WITH TEST AFTER                                      07700000
077100         VARYING PV-SQL-SUB                                       07710000
077200         FROM 1 BY 1                                              07720000
077300         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             07730000
077400            OR SQLCODE EQUAL ZERO                                 07740000
077500            OR SQLCODE EQUAL +100                                 07750000
077600            OR DP013-DB2-ABEND                                    07760000
077700                                                                  07770000
077800         EXEC SQL                                                 07780000
077900              CLOSE                                               07790000
078000                   MSG-CURSOR                                     07800000
078100         END-EXEC                                                 07810000
078200                                                                  07820000
078300         EVALUATE TRUE                                            07830000
078400             WHEN SQLCODE = ZERO                                  07840000
078500             WHEN SQLCODE = +100                                  07850000
078600             WHEN SQLCODE = -904                                  07860000
078700             WHEN SQLCODE = -913                                  07870000
078800*                 ************************************************07880000
078900*                 *    0 SUCCESSFUL                               07890000
079000*                 * +100 NOT FOUND                                07900000
079100*                 * -904 UNAVAILABLE RESOURCE                     07910000
079200*                 * -913 DEADLOCK OR TIMEOUT                      07920000
079300*                 ************************************************07930000
079400                  CONTINUE                                        07940000
079500             WHEN SQLWARN0 NOT EQUAL SPACE                        07950000
079600             WHEN SQLCODE NOT EQUAL ZERO                          07960000
079700*                 ************************************************07970000
079800*                 * ALL OTHER                                     07980000
079900*                 ************************************************07990000
080000                  SET PS-TRANSACTION-AWRY                         08000000
080100                                        TO  TRUE                  08010000
080200                  MOVE '9130-CLOSE-MSG-CURSOR'                    08020000
080300                                        TO  DP013-PARAGRAPH       08030000
080400                  INITIALIZE                DP013-MESSAGE-TABLE   08040000
080500                  MOVE 'CLOSE FAILED'   TO  DP013-MESSAGE-TEXT (1)08050000
080600                  MOVE SQLCA            TO  DP013-SQLCA           08060000
080700                  MOVE PC-TSYMSG        TO                        08070000
080800                                        DP013-DB2-TABLE-NAME (1)  08080000
080900                  SET DP013-LINK-RETURN TO  TRUE                  08090000
081000                  SET DP013-NO-ROLLBACK TO  TRUE                  08100000
081100                  SET DP013-DB2-ABEND   TO  TRUE                  08110000
081200                  PERFORM DP014-0000-PROCESS-ABEND                08120000
081300         END-EVALUATE                                             08130000
081400     END-PERFORM.                                                 08140000
081500                                                                  08150000
081600     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   08160000
081700         MOVE '9130-CLOSE-MSG-CURSOR' TO    DP013-PARAGRAPH       08170000
081800         INITIALIZE                         DP013-MESSAGE-TABLE   08180000
081900         MOVE 'MAX RETRIES EXCEEDED FOR CURSOR CLOSE'             08190000
082000                                        TO  DP013-MESSAGE-TEXT (1)08200000
082100         MOVE SQLCA                     TO  DP013-SQLCA           08210000
082200         MOVE PC-TSYMSG                 TO                        08220000
082300                                        DP013-DB2-TABLE-NAME (1)  08230000
082400         SET DP013-LINK-RETURN          TO  TRUE                  08240000
082500         SET DP013-NO-ROLLBACK          TO  TRUE                  08250000
082600         SET DP013-DB2-ABEND            TO  TRUE                  08260000
082700         PERFORM DP014-0000-PROCESS-ABEND                         08270000
082800     END-IF.                                                      08280000
082900                                                                  08290000
083000                                                                  08300000
083100 9200-OPEN-TXT-CURSOR.                                            08310000
083200******************************************************************08320000
083300*    OPEN THE CURSOR OF ALL EXTENDED TEXT ROWS FOR THIS MESSAGE.  08330000
083400******************************************************************08340000
083500     MOVE SPACES TO DP013-ABEND-TYPE-IND.                         08350000
083600     PERFORM WITH TEST AFTER                                      08360000
083700         VARYING PV-SQL-SUB                                       08370000
083800         FROM 1 BY 1                                              08380000
083900         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             08390000
084000            OR SQLCODE EQUAL ZERO                                 08400000
084100            OR SQLCODE EQUAL +100                                 08410000
084200            OR DP013-DB2-ABEND                                    08420000
084300                                                                  08430000
084400         EXEC SQL                                                 08440000
084500              OPEN                                                08450000
084600                   TXT-CURSOR                                     08460000
084700         END-EXEC                                                 08470000
084800                                                                  08480000
084900         EVALUATE TRUE                                            08490000
085000             WHEN SQLCODE = ZERO                                  08500000
085100             WHEN SQLCODE = +100                                  08510000
085200             WHEN SQLCODE = -904                                  08520000
085300             WHEN SQLCODE = -913                                  08530000
085400*                 ************************************************08540000
085500*                 *    0 SUCCESSFUL                               08550000
085600*                 * +100 NOT FOUND                                08560000
085700*                 * -904 UNAVAILABLE RESOURCE                     08570000
085800*                 * -913 DEADLOCK OR TIMEOUT                      08580000
085900*                 ************************************************08590000
086000                  CONTINUE                                        08600000
086100             WHEN SQLWARN0 NOT EQUAL SPACE                        08610000
086200             WHEN SQLCODE NOT EQUAL ZERO                          08620000
086300*                 ************************************************08630000
086400*                 * ALL OTHER                                     08640000
086500*                 ************************************************08650000
086600                  SET PS-TRANSACTION-AWRY                         08660000
086700                                        TO  TRUE                  08670000
086800                  MOVE '9200-OPEN-TXT-CURSOR'                     08680000
086900                                        TO  DP013-PARAGRAPH       08690000
087000                  INITIALIZE                DP013-MESSAGE-TABLE   08700000
087100                  MOVE 'OPEN FAILED'    TO  DP013-MESSAGE-TEXT (1)08710000
087200                  MOVE SQLCA            TO  DP013-SQLCA           08720000
087300                  MOVE PC-TSYMSGT       TO                        08730000
087400                                        DP013-DB2-TABLE-NAME (1)  08740000
087500                  SET DP013-LINK-RETURN TO  TRUE                  08750000
087600                  SET DP013-NO-ROLLBACK TO  TRUE                  08760000
087700                  SET DP013-DB2-ABEND   TO  TRUE                  08770000
087800                  PERFORM DP014-0000-PROCESS-ABEND                08780000
087900         END-EVALUATE                                             08790000
088000     END-PERFORM.                                                 08800000
088100                                                                  08810000
088200     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   08820000
088300         SET PS-TRANSACTION-AWRY        TO  TRUE                  08830000
088400         MOVE '9200-OPEN-TXT-CURSOR'    TO  DP013-PARAGRAPH       08840000
088500         INITIALIZE                         DP013-MESSAGE-TABLE   08850000
088600         MOVE 'MAX RETRIES EXCEEDED FOR CURSOR OPEN'              08860000
088700                                        TO  DP013-MESSAGE-TEXT (1)08870000
088800         MOVE SQLCA                     TO  DP013-SQLCA           08880000
088900         MOVE PC-TSYMSGT                TO                        08890000
089000                                        DP013-DB2-TABLE-NAME (1)  08900000
089100         SET DP013-LINK-RETURN          TO  TRUE                  08910000
089200         SET DP013-NO-ROLLBACK          TO  TRUE                  08920000
089300         SET DP013-DB2-ABEND            TO  TRUE                  08930000
089400         PERFORM DP014-0000-PROCESS-ABEND                         08940000
089500     END-IF.                                                      08950000
089600                                                                  08960000
089700                                                                  08970000
089800 9210-FETCH-TXT-CURSOR.                                           08980000
089900******************************************************************08990000
090000*    FETCH THE NEXT RECORD FROM THE CURSOR OF ALL SYMSGT          09000000
090100*    EXTENDED TEXT ROWS FOR THIS MESSAGE.                         09010000
090200******************************************************************09020000
090300     MOVE SPACES              TO DP013-ABEND-TYPE-IND.            09030000
090400     PERFORM WITH TEST AFTER                                      09040000
090500         VARYING PV-SQL-SUB                                       09050000
090600         FROM 1 BY 1                                              09060000
090700         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             09070000
090800            OR SQLCODE EQUAL ZERO                                 09080000
090900            OR SQLCODE EQUAL +100                                 09090000
091000            OR DP013-DB2-ABEND                                    09100000
091100                                                                  09110000
091200         EXEC SQL                                                 09120000
091300              FETCH                                               09130000
091400                   TXT-CURSOR                                     09140000
091500              INTO                                                09150000
091600                  :SYMSGT-SYMSG-NBR                               09160000
091700                , :SYMSGT-TYP-CDE                                 09170000
091800                , :SYMSGT-LNE-SEQ-NBR                             09180000
091900                , :SYMSGT-APLSYS-CDE                              09190000
092000                , :SYMSGT-LNE-TXT                                 09200000
092100         END-EXEC                                                 09210000
092200                                                                  09220000
092300         EVALUATE TRUE                                            09230000
092400             WHEN SQLCODE = ZERO                                  09240000
092500             WHEN SQLCODE = +100                                  09250000
092600             WHEN SQLCODE = -904                                  09260000
092700             WHEN SQLCODE = -913                                  09270000
092800*                 ************************************************09280000
092900*                 *    0 SUCCESSFUL                               09290000
093000*                 * +100 NOT FOUND                                09300000
093100*                 * -904 UNAVAILABLE RESOURCE                     09310000
093200*                 * -913 DEADLOCK OR TIMEOUT                      09320000
093300*                 ************************************************09330000
093400                  CONTINUE                                        09340000
093500             WHEN SQLWARN0 NOT EQUAL SPACE                        09350000
093600             WHEN SQLCODE NOT EQUAL ZERO                          09360000
093700*                 ************************************************09370000
093800*                 * ALL OTHER                                     09380000
093900*                 ************************************************09390000
094000                  SET PS-TRANSACTION-AWRY                         09400000
094100                                        TO  TRUE                  09410000
094200                  MOVE '9210-FETCH-TXT-CURSOR'                    09420000
094300                                        TO  DP013-PARAGRAPH       09430000
094400                  INITIALIZE                DP013-MESSAGE-TABLE   09440000
094500                  MOVE 'FETCH FAILED'   TO  DP013-MESSAGE-TEXT (1)09450000
094600                  MOVE SQLCA            TO  DP013-SQLCA           09460000
094700                  MOVE PC-TSYMSGT       TO                        09470000
094800                                        DP013-DB2-TABLE-NAME (1)  09480000
094900                  SET DP013-LINK-RETURN TO  TRUE                  09490000
095000                  SET DP013-NO-ROLLBACK TO  TRUE                  09500000
095100                  SET DP013-DB2-ABEND   TO  TRUE                  09510000
095200                  PERFORM DP014-0000-PROCESS-ABEND                09520000
095300         END-EVALUATE                                             09530000
095400     END-PERFORM.                                                 09540000
095500                                                                  09550000
095600     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   09560000
095700         SET PS-TRANSACTION-AWRY        TO  TRUE                  09570000
095800         MOVE '9210-FETCH-TXT-CURSOR'                             09580000
095900                                        TO  DP013-PARAGRAPH       09590000
096000         INITIALIZE                         DP013-MESSAGE-TABLE   09600000
096100         MOVE 'MAX RETRIES EXCEEDED FOR FETCH'                    09610000
096200                                        TO  DP013-MESSAGE-TEXT (1)09620000
096300         MOVE SQLCA                     TO  DP013-SQLCA           09630000
096400         MOVE PC-TSYMSGT                TO                        09640000
096500                                        DP013-DB2-TABLE-NAME (1)  09650000
096600         SET DP013-DB2-ABEND            TO  TRUE                  09660000
096700         PERFORM DP014-0000-PROCESS-ABEND                         09670000
096800     END-IF.                                                      09680000
096900                                                                  09690000
097000     IF SQLCODE = ZERO                                            09700000
097100         SET PS-TXT-DB2-FOUND           TO  TRUE                  09710000
097200     END-IF.                                                      09720000
097300                                                                  09730000
097400                                                                  09740000
097500 9230-CLOSE-TXT-CURSOR.                                           09750000
097600******************************************************************09760000
097700*    CLOSE THE CURSOR OF ALL SYMSGT EXTENDED TEXT MASSAGES.       09770000
097800******************************************************************09780000
097900     MOVE SPACES TO DP013-ABEND-TYPE-IND.                         09790000
098000     PERFORM WITH TEST AFTER                                      09800000
098100         VARYING PV-SQL-SUB                                       09810000
098200         FROM 1 BY 1                                              09820000
098300         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             09830000
098400            OR SQLCODE EQUAL ZERO                                 09840000
098500            OR SQLCODE EQUAL +100                                 09850000
098600            OR DP013-DB2-ABEND                                    09860000
098700                                                                  09870000
098800         EXEC SQL                                                 09880000
098900              CLOSE                                               09890000
099000                   TXT-CURSOR                                     09900000
099100         END-EXEC                                                 09910000
099200                                                                  09920000
099300         EVALUATE TRUE                                            09930000
099400             WHEN SQLCODE = ZERO                                  09940000
099500             WHEN SQLCODE = +100                                  09950000
099600             WHEN SQLCODE = -904                                  09960000
099700             WHEN SQLCODE = -913                                  09970000
099800*                 ************************************************09980000
099900*                 *    0 SUCCESSFUL                               09990000
100000*                 * +100 NOT FOUND                                10000000
100100*                 * -904 UNAVAILABLE RESOURCE                     10010000
100200*                 * -913 DEADLOCK OR TIMEOUT                      10020000
100300*                 ************************************************10030000
100400                  CONTINUE                                        10040000
100500             WHEN SQLWARN0 NOT EQUAL SPACE                        10050000
100600             WHEN SQLCODE NOT EQUAL ZERO                          10060000
100700*                 ************************************************10070000
100800*                 * ALL OTHER                                     10080000
100900*                 ************************************************10090000
101000                  SET PS-TRANSACTION-AWRY                         10100000
101100                                        TO  TRUE                  10110000
101200                  MOVE '9230-CLOSE-TXT-CURSOR'                    10120000
101300                                        TO  DP013-PARAGRAPH       10130000
101400                  INITIALIZE                DP013-MESSAGE-TABLE   10140000
101500                  MOVE 'CLOSE FAILED'   TO  DP013-MESSAGE-TEXT (1)10150000
101600                  MOVE SQLCA            TO  DP013-SQLCA           10160000
101700                  MOVE PC-TSYMSGT       TO                        10170000
101800                                        DP013-DB2-TABLE-NAME (1)  10180000
101900                  SET DP013-LINK-RETURN TO  TRUE                  10190000
102000                  SET DP013-NO-ROLLBACK TO  TRUE                  10200000
102100                  SET DP013-DB2-ABEND   TO  TRUE                  10210000
102200                  PERFORM DP014-0000-PROCESS-ABEND                10220000
102300         END-EVALUATE                                             10230000
102400     END-PERFORM.                                                 10240000
102500                                                                  10250000
102600     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   10260000
102700         MOVE '9230-CLOSE-TXT-CURSOR'                             10270000
102800                                        TO  DP013-PARAGRAPH       10280000
102900         INITIALIZE                         DP013-MESSAGE-TABLE   10290000
103000         MOVE 'MAX RETRIES EXCEEDED FOR CURSOR CLOSE'             10300000
103100                                        TO  DP013-MESSAGE-TEXT (1)10310000
103200         MOVE SQLCA                     TO  DP013-SQLCA           10320000
103300         MOVE PC-TSYMSGT                TO                        10330000
103400                                        DP013-DB2-TABLE-NAME (1)  10340000
103500         SET DP013-LINK-RETURN          TO  TRUE                  10350000
103600         SET DP013-NO-ROLLBACK          TO  TRUE                  10360000
103700         SET DP013-DB2-ABEND            TO  TRUE                  10370000
103800         PERFORM DP014-0000-PROCESS-ABEND                         10380000
103900     END-IF.                                                      10390000
104000                                                                  10400000
104100                                                                  10410000
104200 9400-READ-MSG-VSAM.                                              10420000
104300******************************************************************10430000
104400*    READ THE SYMSG VSAM FILE.                                    10440000
104500******************************************************************10450000
104600                                                                  10460000
104700     EXEC CICS READ                                               10470000
104800          INTO   (DP507O-MESSAGES-OUTPUT-RECORD)                  10480000
104900          FILE   (PC-MSG-VSAM-FILE)                               10490000
105000          RIDFLD (DP507O-MSG-NUMBER)                              10500000
105100          RESP   (PV-RESP)                                        10510000
105200          UPDATE                                                  10520000
105300     END-EXEC.                                                    10530000
105400                                                                  10540000
105500     IF PV-RESP EQUAL DFHRESP(NORMAL)                             10550000
105600             SET PS-MSG-VSAM-FOUND      TO  TRUE                  10560000
105700     ELSE                                                         10570000
105800         IF  PV-RESP EQUAL DFHRESP(NOTFND)                        10580000
105900             SET PS-MSG-VSAM-NOT-FOUND  TO  TRUE                  10590000
106000         ELSE                                                     10600000
106100             SET PS-TRANSACTION-AWRY    TO  TRUE                  10610000
106200             SET DP013-CICS-ABEND       TO  TRUE                  10620000
106300             SET DP013-LINK-RETURN      TO  TRUE                  10630000
106400             SET DP013-NO-ROLLBACK      TO  TRUE                  10640000
106500             MOVE '9400-READ-MSG-VSAM'                            10650000
106600                                        TO  DP013-PARAGRAPH       10660000
106700             INITIALIZE                     DP013-MESSAGE-TABLE   10670000
106800             MOVE 'BAD RETURN CODE FROM SYMSG VSAM READ FOR:'     10680000
106900                                        TO  DP013-MESSAGE-TEXT (1)10690000
107000             MOVE PV-CURRENT-SYMSG-NBR-NUMERIC                    10700000
107100                                        TO  DP013-MESSAGE-TEXT (2)10710000
107200             PERFORM DP014-0000-PROCESS-ABEND                     10720000
107300         END-IF                                                   10730000
107400     END-IF.                                                      10740000
107500                                                                  10750000
107600                                                                  10760000
107700 9401-UNLOCK-MSG-VSAM.                                            10770000
107800******************************************************************10780000
107900*    UNLOCK SYSMSG VSAM FILE.                                    *10790000
108000*    RELEASE THE RECORD HELD EXCLUSIVELY BY THE "READ... UPDATE".*10800000
108100******************************************************************10810000
108200     EXEC CICS UNLOCK                                             10820000
108300          FILE(PC-MSG-VSAM-FILE)                                  10830000
108400     END-EXEC.                                                    10840000
108500                                                                  10850000
108600                                                                  10860000
108700 9410-REWRITE-MSG-VSAM.                                           10870000
108800******************************************************************10880000
108900*    REWRITE THE UPDATED SYMSG RECORD.                            10890000
109000******************************************************************10900000
109100     EXEC CICS REWRITE                                            10910000
109200          FROM(DP507O-MESSAGES-OUTPUT-RECORD)                     10920000
109300          FILE(PC-MSG-VSAM-FILE)                                  10930000
109400          RESP(PV-RESP)                                           10940000
109500     END-EXEC.                                                    10950000
109600                                                                  10960000
109700     IF PV-RESP EQUAL DFHRESP(NORMAL)                             10970000
109800         SET PS-MSG-VSAM-UPDT-OK        TO  TRUE                  10980000
109900     ELSE                                                         10990000
110000         SET PS-TRANSACTION-AWRY        TO  TRUE                  11000000
110100         SET PS-MSG-VSAM-UPDT-ERR       TO  TRUE                  11010000
110200         SET DP013-CICS-ABEND           TO  TRUE                  11020000
110300         SET DP013-LINK-RETURN          TO  TRUE                  11030000
110400         SET DP013-NO-ROLLBACK          TO  TRUE                  11040000
110500         MOVE '9410-REWRITE-MSG-VSAM'                             11050000
110600                                        TO  DP013-PARAGRAPH       11060000
110700         INITIALIZE                         DP013-MESSAGE-TABLE   11070000
110800         MOVE 'BAD RETURN CODE FROM SYMSG VSAM REWRITE FOR:'      11080000
110900                                        TO  DP013-MESSAGE-TEXT (1)11090000
111000         MOVE PV-CURRENT-SYMSG-NBR-NUMERIC                        11100000
111100                                        TO  DP013-MESSAGE-TEXT (2)11110000
111200         PERFORM DP014-0000-PROCESS-ABEND                         11120000
111300     END-IF.                                                      11130000
111400                                                                  11140000
111500                                                                  11150000
111600 9420-WRITE-MSG-VSAM.                                             11160000
111700******************************************************************11170000
111800*    WRITE THE NEW SYMSG RECORD.                                  11180000
111900******************************************************************11190000
112000                                                                  11200000
112100     EXEC CICS WRITE                                              11210000
112200          FROM   (DP507O-MESSAGES-OUTPUT-RECORD)                  11220000
112300          FILE   (PC-MSG-VSAM-FILE)                               11230000
112400          RIDFLD (DP507O-MSG-NUMBER)                              11240000
112500          RESP   (PV-RESP)                                        11250000
112600     END-EXEC.                                                    11260000
112700                                                                  11270000
112800     IF PV-RESP EQUAL DFHRESP(NORMAL)                             11280000
112900         SET PS-MSG-VSAM-UPDT-OK        TO  TRUE                  11290000
113000     ELSE                                                         11300000
113100         SET PS-TRANSACTION-AWRY        TO  TRUE                  11310000
113200         SET PS-MSG-VSAM-UPDT-ERR       TO  TRUE                  11320000
113300         SET DP013-CICS-ABEND           TO  TRUE                  11330000
113400         SET DP013-LINK-RETURN          TO  TRUE                  11340000
113500         SET DP013-NO-ROLLBACK          TO  TRUE                  11350000
113600         MOVE '9420-WRITE-MSG-VSAM'                               11360000
113700                                        TO  DP013-PARAGRAPH       11370000
113800         INITIALIZE                         DP013-MESSAGE-TABLE   11380000
113900         MOVE 'BAD RETURN CODE FROM SYMSG VSAM WRITE FOR:'        11390000
114000                                        TO  DP013-MESSAGE-TEXT (1)11400000
114100         MOVE PV-CURRENT-SYMSG-NBR-NUMERIC                        11410000
114200                                        TO  DP013-MESSAGE-TEXT (2)11420000
114300         PERFORM DP014-0000-PROCESS-ABEND                         11430000
114400     END-IF.                                                      11440000
114500                                                                  11450000
114600                                                                  11460000
114700 9500-READ-TXT-VSAM.                                              11470000
114800******************************************************************11480000
114900*    READ THE SYMSGT (EXTENDED TEXT) VSAM FILE.                   11490000
115000*    THIS IS A GENERIC READ; ONLY THE FIRST 5 BYTES OF THE 9-BYTE 11500000
115100*    KEY ARE USED TO DETERMINE WHETHER RECORD(S) EXIST.           11510000
115200******************************************************************11520000
115300                                                                  11530000
115400*    EXEC CICS READ                                               11540000
115500*         INTO     (DP508O-SYSTEM-MESSAGE-TEXT-RCD)               11550000
115600*         FILE     (PC-TXT-VSAM-FILE)                             11560000
115700*         RIDFLD   (DP508O-SYSTEM-MESSAGE-TEXT-KEY)               11570000
115800*         KEYLENGTH(5)                                            11580000
115900*         GENERIC                                                 11590000
116000*         RESP     (PV-RESP)                                      11600000
116100*    END-EXEC.                                                    11610000
116200                                                                  11620000
116300     EXEC CICS READ                                               11630000
116400          INTO     (DP508O-SYSTEM-MESSAGE-TEXT-RCD)               11640000
116500          FILE     (PC-TXT-VSAM-FILE)                             11650000
116600          RIDFLD   (DP508O-SYSTEM-MESSAGE-TEXT-KEY)               11660000
116700          GTEQ                                                    11670000
116800          RESP     (PV-RESP)                                      11680000
116900     END-EXEC.                                                    11690000
117000                                                                  11700000
117100     IF PV-RESP EQUAL DFHRESP(NORMAL)                             11710000
117200         IF DP508O-SYSTEM-MESSAGE-NUMBER =                        11720000
117300                                     PV-CURRENT-SYMSG-NBR-NUMERIC 11730000
117400             SET PS-TXT-VSAM-FOUND      TO TRUE                   11740000
117500         ELSE                                                     11750000
117600             SET PS-TXT-VSAM-NOT-FOUND  TO TRUE                   11760000
117700             PERFORM 9501-UNLOCK-TXT-VSAM                         11770000
117800         END-IF                                                   11780000
117900     ELSE                                                         11790000
118000         IF  PV-RESP EQUAL DFHRESP(NOTFND)                        11800000
118100             SET PS-TXT-VSAM-NOT-FOUND  TO TRUE                   11810000
118200         ELSE                                                     11820000
118300             SET PS-TRANSACTION-AWRY    TO  TRUE                  11830000
118400             SET DP013-CICS-ABEND       TO  TRUE                  11840000
118500             SET DP013-LINK-RETURN      TO  TRUE                  11850000
118600             SET DP013-NO-ROLLBACK      TO  TRUE                  11860000
118700             MOVE '9500-READ-TXT-VSAM'                            11870000
118800                                        TO  DP013-PARAGRAPH       11880000
118900             INITIALIZE                     DP013-MESSAGE-TABLE   11890000
119000             MOVE 'BAD RETURN CODE FROM SYMSG VSAM READ FOR:'     11900000
119100                                        TO  DP013-MESSAGE-TEXT (1)11910000
119200             MOVE PV-CURRENT-SYMSG-NBR-NUMERIC                    11920000
119300                                        TO  DP013-MESSAGE-TEXT (2)11930000
119400             PERFORM DP014-0000-PROCESS-ABEND                     11940000
119500         END-IF                                                   11950000
119600     END-IF.                                                      11960000
119700                                                                  11970000
119800                                                                  11980000
119900 9501-UNLOCK-TXT-VSAM.                                            11990000
120000******************************************************************12000000
120100*    UNLOCK SYMSGT (EXTENDED TEXT) VSAM FILE.                    *12010000
120200*    RELEASE THE RECORD HELD EXCLUSIVELY BY THE "READ... UPDATE".*12020000
120300******************************************************************12030000
120400     EXEC CICS UNLOCK                                             12040000
120500          FILE(PC-TXT-VSAM-FILE)                                  12050000
120600     END-EXEC.                                                    12060000
120700                                                                  12070000
120800                                                                  12080000
120900 9520-WRITE-TXT-VSAM.                                             12090000
121000******************************************************************12100000
121100*    WRITE THE NEW SYMSGT (EXTENDED TEXT) RECORD.                 12110000
121200******************************************************************12120000
121300                                                                  12130000
121400     EXEC CICS WRITE                                              12140000
121500          FROM   (DP508O-SYSTEM-MESSAGE-TEXT-RCD)                 12150000
121600          FILE   (PC-TXT-VSAM-FILE)                               12160000
121700          RIDFLD (DP508O-SYSTEM-MESSAGE-TEXT-KEY)                 12170000
121800          RESP   (PV-RESP)                                        12180000
121900     END-EXEC.                                                    12190000
122000                                                                  12200000
122100     IF PV-RESP EQUAL DFHRESP(NORMAL)                             12210000
122200         SET PS-TXT-VSAM-UPDT-OK        TO TRUE                   12220000
122300     ELSE                                                         12230000
122400         SET PS-TRANSACTION-AWRY        TO  TRUE                  12240000
122500         SET PS-TXT-VSAM-UPDT-ERR       TO  TRUE                  12250000
122600         SET DP013-CICS-ABEND           TO  TRUE                  12260000
122700         SET DP013-LINK-RETURN          TO  TRUE                  12270000
122800         SET DP013-NO-ROLLBACK          TO  TRUE                  12280000
122900         MOVE '9520-WRITE-TXT-VSAM'                               12290000
123000                                        TO DP013-PARAGRAPH        12300000
123100         MOVE 'BAD RETURN CODE FROM SYMSGT VSAM WRITE FOR:'       12310000
123200                                        TO  DP013-MESSAGE-TEXT (1)12320000
123300         MOVE PV-CURRENT-SYMSG-NBR-NUMERIC                        12330000
123400                                        TO  DP013-MESSAGE-TEXT (2)12340000
123500         PERFORM DP014-0000-PROCESS-ABEND                         12350000
123600     END-IF.                                                      12360000
123700                                                                  12370000
123800                                                                  12380000
123900 9530-DELETE-TXT-VSAM.                                            12390000
124000******************************************************************12400000
124100*    DELETE THE UPDATED SYMSGT (EXTENDED TEXT) RECORD(S).         12410000
124200*    THIS IS A GENERIC DLET; ONLY THE FIRST 5 BYTES OF THE 9-BYTE 12420000
124300*    KEY ARE USED TO DELETE THE RECORD(S).                        12430000
124400******************************************************************12440000
124500     EXEC CICS DELETE                                             12450000
124600          FILE     (PC-TXT-VSAM-FILE)                             12460000
124700          RIDFLD   (DP508O-SYSTEM-MESSAGE-TEXT-KEY)               12470000
124800          KEYLENGTH(5)                                            12480000
124900          GENERIC                                                 12490000
125000          RESP     (PV-RESP)                                      12500000
125100     END-EXEC.                                                    12510000
125200                                                                  12520000
125300     IF PV-RESP EQUAL DFHRESP(NORMAL)                             12530000
125400         SET PS-TXT-VSAM-UPDT-OK        TO  TRUE                  12540000
125500     ELSE                                                         12550000
125600         SET PS-TRANSACTION-AWRY        TO  TRUE                  12560000
125700         SET PS-TXT-VSAM-UPDT-ERR       TO  TRUE                  12570000
125800         SET DP013-CICS-ABEND           TO  TRUE                  12580000
125900         SET DP013-LINK-RETURN          TO  TRUE                  12590000
126000         SET DP013-NO-ROLLBACK          TO  TRUE                  12600000
126100         MOVE '9530-DELETE-TXT-VSAM'    TO  DP013-PARAGRAPH       12610000
126200         MOVE 'BAD RETURN CODE FROM SYMSGT VSAM DELETE FOR:'      12620000
126300                                        TO  DP013-MESSAGE-TEXT (1)12630000
126400         MOVE PV-CURRENT-SYMSG-NBR-NUMERIC                        12640000
126500                                        TO  DP013-MESSAGE-TEXT (2)12650000
126600         PERFORM DP014-0000-PROCESS-ABEND                         12660000
126700     END-IF.                                                      12670000
126800                                                                  12680000
126900                                                                  12690000
127000 9800-ENQUEUE.                                                    12700000
127100******************************************************************12710000
127200* ENQUEUE THE CICS LOG                                            12720000
127300******************************************************************12730000
127400     EXEC CICS                                                    12740000
127500         ENQ                                                      12750000
127600             RESOURCE (PC-LOG-QUEUE-RESOURCE)                     12760000
127700     END-EXEC.                                                    12770000
127800                                                                  12780000
127900                                                                  12790000
128000 9810-WRITEQ-TD.                                                  12800000
128100******************************************************************12810000
128200* WRITE TO THE CICS LOG                                           12820000
128300******************************************************************12830000
128400     EXEC CICS                                                    12840000
128500         WRITEQ TD                                                12850000
128600             QUEUE (PC-LOG-QUEUE)                                 12860000
128700             FROM  (PV-LOG-LINE)                                  12870000
128800             RESP  (PV-CICS-RESPONSE)                             12880000
128900     END-EXEC.                                                    12890000
129000*                                                                 12900000
129100     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       12910000
129200         CONTINUE                                                 12920000
129300     ELSE                                                         12930000
129400         SET DP013-CICS-ABEND           TO  TRUE                  12940000
129500         SET DP013-LINK-RETURN          TO  TRUE                  12950000
129600         SET DP013-NO-ROLLBACK          TO  TRUE                  12960000
129700         MOVE '9810-WRITEQ-TD'                                    12970000
129800                                        TO  DP013-PARAGRAPH       12980000
129900         INITIALIZE                         DP013-MESSAGE-TABLE   12990000
130000         MOVE 'BAD RETURN CODE FROM WRITE TO CSSL'                13000000
130100                                        TO  DP013-MESSAGE-TEXT (1)13010000
130200         PERFORM DP014-0000-PROCESS-ABEND                         13020000
130300     END-IF.                                                      13030000
130400                                                                  13040000
130500                                                                  13050000
130600 9820-DEQUEUE.                                                    13060000
130700******************************************************************13070000
130800* DEQUEUE THE CICS LOG                                            13080000
130900******************************************************************13090000
131000     EXEC CICS                                                    13100000
131100         DEQ                                                      13110000
131200             RESOURCE (PC-LOG-QUEUE-RESOURCE)                     13120000
131300     END-EXEC.                                                    13130000
131400                                                                  13140000
131500                                                                  13150000
131600 9900-SEND-TEXT.                                                  13160000
131700****************************************************************  13170000
131800* SEND TEXT TO TERMINAL WHERE TRANSACTION INITIATED               13180000
131900****************************************************************  13190000
132000     EXEC CICS                                                    13200000
132100          SEND TEXT                                               13210000
132200          FROM   (PM-PROGRAM-MESSAGE-SCOREBOARD)                  13220000
132300          LENGTH (PM-SCOREBOARD-LENGTH)                           13230000
132400          RESP   (PV-RESP)                                        13240000
132500     END-EXEC.                                                    13250000
132600     IF (PV-RESP EQUAL DFHRESP(NORMAL))                           13260000
132700         CONTINUE                                                 13270000
132800     ELSE                                                         13280000
132900         SET DP013-CICS-ABEND           TO  TRUE                  13290000
133000         SET DP013-LINK-RETURN          TO  TRUE                  13300000
133100         SET DP013-NO-ROLLBACK          TO  TRUE                  13310000
133200         MOVE '9800-SEND-TEXT'          TO  DP013-PARAGRAPH       13320000
133300         MOVE 'BAD RETURN CODE FROM SEND TEXT FOR SCOREBOARD:'    13330000
133400                                        TO  DP013-MESSAGE-TEXT (1)13340000
133500         MOVE PM-PROGRAM-MESSAGE-SCOREBOARD                       13350000
133600                                        TO  DP013-MESSAGE-TEXT (2)13360000
133700         PERFORM DP014-0000-PROCESS-ABEND                         13370000
133800     END-IF.                                                      13380000
133900                                                                  13390000
134000                                                                  13400000
134100******************************************************************13410000
134200*    ABEND PROCESSOR MODULE - FOR NON-ARCHITECTURE PROGRAMS       13420000
134300******************************************************************13430000
134400     COPY DPPD014.                                                13440000
