000100*--------------- APPD052 STARTS HERE ----------------------------*00010000
000200*                                                                *00020000
000300*     INCLUDE MEMBERS REQUIRED:                                  *00030000
000400*                                                                *00040000
000500*         APWS052  - WORKING STORAGE FOR APPD052                 *00050000
000600*                                                                *00060000
000700*     THIS PARAGRAPH ASSUMES A ROW HAS BEEN RETURNED FROM THE    *00070000
000800*     ALLOWANCE/CHARGE TABLE FOR AN INVOICE.  IT IS USED TO      *00080000
000900*     CALCULATE THE NEW STORE DISCOUNT PERCENT, TRADE DISCOUNT   *00090000
001000*     PERCENT, ALLOWANCE AMOUNT, DNP CHARGES, MISCELLANEOUS      *00100000
001100*     CHARGES AND FREIGHT CHARGES.                               *00110000
001200*                                                                *00120000
001300*     DATE: 01/20/99   MARY KING                                 *00130000
001400*     ADDED CALCULATION OF NEW STORE AND TRADE AMTS.             *00140000
001500*                                                                *00150000
001600*     DATE: 08/25/00   MIKE BESKE      WR#: 20224                *00160000
001700*     ADDED MOS AND ADV AS NEW CHARGE CODES.  THE ADV DISCOUNT   *00170000
001800*     AMOUNT IS INTENTIONALLY NOT INCLUDED IN APPD052-ALLOWANCE- *00180000
001900*     AMT BECAUSE IT REQUIRES SPECIAL HANDLING IN THE AP SYSTEM. *00190000
002000*     THE ADV-DISC-AMT WILL BE KEPT SEPARATE SO THAT IT CAN BE   *00200000
002100*     PROCESSED INDIVIDUALLY.                                    *00210000
002200*                                                                *00220000
002300*     DATE: 06/25/02   KEVIN CATLIN    WR#: 23839                *00230000
002400*       ADDED CHECK FOR VENDOR, ANDEL JEWELRY.  IF THE VALUE OF  *00240000
002500*     APPD052-DNP-MISC = 'INS', THE VALUE OF THE 'INS' CHARGE    *00250000
002600*     SHOULD JUST BE INCLUDED IN THE MISC-CHARGES AND NOT IN THE *00260000
002700*     DNP-CHARGES.                                               *00270000
002800*                                                                *00280000
002900* DATE  01/30/2004                                               *00290004
003000*     CHANGE MADE: CODED A NEW 88 LEVEL FOR INSURANCE CHARGE     *00300004
003100*     CODES 'INS' AND '445'. THIS 88 FIELD WILL BE REFERENCED    *00310004
003200*     IN APPD052 WHEN PROCESSING APPD052-DNP-MISC CHARGES.       *00320004
003300*     TWO VENDORS (ANDEL JEWELRY '117498121' & CITIZEN WATCH     *00330004
003400*     '078822863') ARE EXEMPT FROM THE NORMAL PROCESS OF         *00340004
003500*     CHARGING BACK INSURANCE CHARGES.  CITIZEN WATCH WAS        *00350004
003600*     NOT BEING PROCESSED CORRECTLY BECAUSE ONLY 'INS' WAS       *00360004
003700*     BEING CHECKED, NOT '445'. CITIZEN WATCH HAS ONLY SENT      *00370004
003800*     '445' CODES AS OF THIS CHANGE DATE. ANDEL JEWELRY HAS      *00380004
003900*     ONLY SENT 'INS' CODES AS OF THIS CHANGE DATE.              *00390004
004000*     MADE BY: MIKE BESKE              WR/IR #: P000628860       *00400004
004001*                                                                *00400105
004010* DATE  03/17/2005                                               *00401006
004020*     CHANGE MADE: E-COMM DIRECT TO CONSUMER PROJECT             *00402005
004030*     INCLUDED LOGIC TO PROCESS THE GIFT WRAP AND HANDLING       *00403006
004040*     CHARGES.  THESE CHARGES ARE ACCUMULATED SEPARATELY TO BE   *00404006
004050*     PASSED TO THE CLASS DISTRIBUTION PROCESS, BUT ARE ROLLED   *00405006
004060*     INTO THE MISCELLANEOUS CHARGES FOR POSTING TO PEOPLESOFT.  *00406006
004093*     MADE BY: KRYSTEN LEARY           WR/IR #: WR28461          *00409305
004094*                                                                *00409408
004095* DATE  04/13/2005                                               *00409508
004096*     CHANGE MADE: OFF-INVOICE CO-OP ADVERTISING ALLOWANCES      *00409608
004097*     INCLUDED LOGIC TO PROCESS THE CO-OP ADVERTISING            *00409711
004098*     ALLOWANCES.  THESE ALLOWANCES ARE ACCUMULATED SEPARATELY   *00409808
004099*     TO BE PASSED TO THE CLASS DISTRIBUTION PROCESS.            *00409908
004101*     MADE BY: KRYSTEN LEARY           WR/IR #: WR28651          *00410108
004102* DATE  03/13/2006                                               *00410213
004103*     CHANGE MADE: ADDED LOGIC TO CHANGE WHEN CLAUSE TO INCLUDE  *00410312
004104*     TRD AND ALW AND TO ACCUMULATE OTHERS TO NEW MISC FIELD.    *00410412
004105*     STOP THE SEPARATE ACCUMULATION OF CO-OP AND ADV AND ADD    *00410512
004106*     THEM TO THE APPD052-ALLOWANCE-AMT.                         *00410612
004107*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR26790          *00410712
004121*                                                                *00410815
004102* DATE  03/15/2024                                               *00410915
004103*     CHANGE MADE: ADDED LOGIC FOR PEPSI - BOTTLE DEPOSITS ARE   *00411015
004104*     ADDED TO MISC-CHARGES AND BOTTLE-DEP.  SUGAR TAX IS ADDED  *00411115
004105*     TO MISC-CHARGES                                             00411215
004107*     MADE BY: JEAN KURK               WR/IR #: CHG0301938       *00411315
004110*----------------------------------------------------------------*00411408
004120*----------------------------------------------------------------*00412012
004121*                                                                *00412112
004122*     ALL PROGRAMS USING THIS COPYBOOK SHOULD NEVER USE THE      *00412212
004123*     APPD052-ALLOWANCE-AMT AND INDIVIDUAL ALLOWANCE AMOUNTS.    *00412312
004124*     ALL ALLOWANCE AMOUNTS ARE NOW ACCUMULATED TOGETHER.        *00412412
004125*                                                                *00412512
004126*----------------------------------------------------------------*00412612
004130*----------------------------------------------------------------*00413012
004200 CALC-ALW-CHRG.                                                   00420000
004300                                                                  00430000
004400     IF  ALCHRG-ALW-CHRG-AMT > ZERO                               00440002
004500         MOVE ALCHRG-ALW-CHRG-AMT TO APPD052-ALW-CHRG-AMT         00450002
004600         IF  APPD052-GROSS-INVOICE-COST = ZERO                    00460002
004700             MOVE ZERO TO APPD052-ALW-CHRG-PCT                    00470000
004800         ELSE                                                     00480000
004900             COMPUTE APPD052-ALW-CHRG-PCT ROUNDED = 100 *         00490002
005000               (ALCHRG-ALW-CHRG-AMT / APPD052-GROSS-INVOICE-COST) 00500002
005100         END-IF                                                   00510000
005200     ELSE                                                         00520000
005300         MULTIPLY ALCHRG-ALW-CHRG-PCT BY 100                      00530002
005400                                  GIVING APPD052-ALW-CHRG-PCT     00540002
005500         COMPUTE APPD052-ALW-CHRG-AMT = (ALCHRG-ALW-CHRG-PCT *    00550002
005600                               APPD052-GROSS-INVOICE-COST) + .005 00560002
005700     END-IF.                                                      00570000
005800                                                                  00580000
005900     MOVE ALCHRG-ALW-CHRG-CDE TO APPD052-CHARGE-CODES.            00590000
006000                                                                  00600002
006100     IF ALCHRG-ALW-CHRG-TYP-CDE = APPD052-ALLOWANCE               00610002
006200        EVALUATE TRUE                                             00620002
006300        WHEN APPD052-NEW-STORE                                    00630002
006400            ADD APPD052-ALW-CHRG-PCT TO APPD052-NEW-STORE-DISC-PCT00640002
006500            ADD APPD052-ALW-CHRG-AMT TO APPD052-NEW-STORE-AMT     00650002
006600            ADD APPD052-ALW-CHRG-AMT TO APPD052-ALLOWANCE-AMT     00660003
006700        WHEN APPD052-MOS-DISCOUNT                                 00670002
006800            ADD APPD052-ALW-CHRG-PCT TO APPD052-MOS-DISC-PCT      00680002
006900            ADD APPD052-ALW-CHRG-AMT TO APPD052-MOS-DISC-AMT      00690002
007000            ADD APPD052-ALW-CHRG-AMT TO APPD052-ALLOWANCE-AMT     00700003
007100        WHEN APPD052-ADV-DISCOUNT                                 00710002
007200            ADD APPD052-ALW-CHRG-PCT TO APPD052-ADV-DISC-PCT      00720002
007300            ADD APPD052-ALW-CHRG-AMT TO APPD052-ADV-DISC-AMT      00730002
007301            ADD APPD052-ALW-CHRG-AMT TO APPD052-ALLOWANCE-AMT     00730113
007310        WHEN APPD052-COOP-ADV-ALLOW                               00731008
007320            ADD APPD052-ALW-CHRG-PCT TO APPD052-COOP-ADV-ALLOW-PCT00732008
007330            ADD APPD052-ALW-CHRG-AMT TO APPD052-COOP-ADV-ALLOW-AMT00733008
007340            ADD APPD052-ALW-CHRG-AMT TO APPD052-ALLOWANCE-AMT     00734013
007400        WHEN APPD052-TRADE-DISCOUNT                               00740013
007500            ADD APPD052-ALW-CHRG-PCT TO APPD052-TRADE-DISC-PCT    00750002
007600            ADD APPD052-ALW-CHRG-AMT TO APPD052-TRADE-AMT         00760002
007700            ADD APPD052-ALW-CHRG-AMT TO APPD052-ALLOWANCE-AMT     00770003
007710        WHEN APPD052-PRFT-ASST-COOP                               00771013
007720            ADD APPD052-ALW-CHRG-PCT TO APPD052-PRFT-ASST-COOP-PCT00772013
007730            ADD APPD052-ALW-CHRG-AMT TO APPD052-PRFT-ASST-COOP-AMT00773013
007740            ADD APPD052-ALW-CHRG-AMT TO APPD052-ALLOWANCE-AMT     00774013
007750        WHEN OTHER                                                00775013
007760            ADD APPD052-ALW-CHRG-PCT TO APPD052-MISC-DISC-PCT     00776013
007770            ADD APPD052-ALW-CHRG-AMT TO APPD052-MISC-DISC-AMT     00777013
007780            ADD APPD052-ALW-CHRG-AMT TO APPD052-ALLOWANCE-AMT     00778013
007800        END-EVALUATE                                              00780002
007900     END-IF.                                                      00790002
008000                                                                  00800000
008100     IF ALCHRG-ALW-CHRG-TYP-CDE = APPD052-CHARGE                  00810002
008200        EVALUATE TRUE                                             00820002
008300        WHEN APPD052-DNP-MISC                                     00830002
008400             IF  APPD052-INSURANCE-EXCEPTION                      00840004
008500             AND APPD052-INS-VENDOR                               00850002
008600                ADD APPD052-ALW-CHRG-AMT TO APPD052-MISC-CHARGES  00860002
008400             ELSE                                                 00861016
008400                IF  APPD052-BOTTLE-DEPOSIT                        00861116
008500                AND APPD052-PEPSI                                 00862016
008600                   ADD APPD052-ALW-CHRG-AMT                       00863016
008600                                         TO APPD052-MISC-CHARGES  00863116
008600                   ADD APPD052-ALW-CHRG-AMT                       00864016
008600                                         TO APPD052-BOTTLE-DEP-AMT00864116
008700                ELSE                                              00864217
009720                   IF  APPD052-SUGAR-TAX                          00864317
008400                   AND APPD052-PEPSI                              00864417
009730                      ADD APPD052-ALW-CHRG-AMT                    00864517
009730                                         TO APPD052-MISC-CHARGES  00864617
008700                   ELSE                                           00870017
008800                      ADD APPD052-ALW-CHRG-AMT                    00880017
008800                                         TO APPD052-DNP-CHARGES   00881016
008900                      ADD APPD052-ALW-CHRG-AMT                    00890017
008900                                         TO APPD052-MISC-CHARGES  00890116
008700                   END-IF                                         00891017
008700                END-IF                                            00892017
009000             END-IF                                               00900002
008700*            ELSE                                                 00901016
008800*               ADD APPD052-ALW-CHRG-AMT TO APPD052-DNP-CHARGES   00902016
008900*               ADD APPD052-ALW-CHRG-AMT TO APPD052-MISC-CHARGES  00903016
009000*            END-IF                                               00904016
009100        WHEN APPD052-FREIGHT                                      00910002
009200             ADD APPD052-ALW-CHRG-AMT  TO APPD052-FREIGHT-CHARGES 00920002
009300             IF APPD052-CALC-FRT-PCT > 0                          00930002
009400                COMPUTE APPD052-VENDOR-FRT-AMT ROUNDED =          00940002
009500                    APPD052-VENDOR-FRT-AMT +                      00950002
009600                   (APPD052-ALW-CHRG-AMT * APPD052-CALC-FRT-PCT)  00960002
009700             END-IF                                               00970002
009710        WHEN APPD052-CD-GIFT-WRAP                                 00971007
009711             ADD APPD052-ALW-CHRG-AMT  TO APPD052-MISC-CHARGES    00971105
009712             ADD APPD052-ALW-CHRG-AMT  TO APPD052-CD-GIFT-WRAP-AMT00971205
009720        WHEN APPD052-CD-HANDLING                                  00972007
009730             ADD APPD052-ALW-CHRG-AMT  TO APPD052-MISC-CHARGES    00973005
009740             ADD APPD052-ALW-CHRG-AMT  TO APPD052-CD-HANDLING-AMT 00974005
009800        WHEN OTHER                                                00980002
009900             ADD APPD052-ALW-CHRG-AMT  TO APPD052-MISC-CHARGES    00990002
010000        END-EVALUATE                                              01000002
010100     END-IF.                                                      01010002
010200                                                                  01020002
