000100*------------------------------------------------------------     00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*------------------------------------------------------------     00030000
000400 PROGRAM-ID.    EPKUT223.                                         00040000
000500 AUTHOR.        MEDHA CHOUDHURY.                                  00050000
000600 DATE-WRITTEN.  JUL 31, 2009.                                     00060000
000700                                                                  00070000
000800*------------------------------------------------------------     00080000
000810*    THE PURPOSE OF THIS PROGRAM IS TO ELIMINATE CLEARANCE    *   00081000
000900*    SKU FROM FUTURE FULL FILE FOR WHICH THERE EXISTS AN          00090000
001000*    UPDATED ACTIVE SKU IN CURRENT WITH MORE RECENT UPDATES       00100000
001100*------------------------------------------------------------     00110000
001200*------------------------------------------------------------ *   00120000
001300*  INPUT:                                                     *   00130000
001400*        CUR-PRICE-FULL                   EPRD220             *   00140000
001410*        FUT-PRICE-FULL                   EPRD220             *   00141000
001500*                                                             *   00150000
001600*  OUTPUT:                                                    *   00160000
001700*        FUR-PRICE-MOD-FUL                EPRD220             *   00170000
001800*-------------------------------------------------------------*   00180000
001900* HISTORY LOG:                                                *   00190000
002000*                                                             *   00200000
002100*-------------------------------------------------------------*   00210000
002200* DATE: JUL 31 2009                                           *   00220000
002300* WR/IR#: INC# 890237                                         *   00230008
002400* PROGRAMMER: MEDHA CHOUDHURY                                 *   00240000
002500* DESCRIPTION: INITIAL PROGRAM CREATION                       *   00250000
002600*-------------------------------------------------------------*   00260000
002700* DATE:                                                       *   00270000
002800* WR/IR#:                                                     *   00280000
002900* PROGRAMMER:                                                 *   00290000
003000* DESCRIPTION:                                                *   00300000
003100*                                                             *   00310000
003200****************************************************************  00320000
003300 ENVIRONMENT DIVISION.                                            00330000
003400****************************************************************  00340000
003500 CONFIGURATION SECTION.                                           00350000
003600 SOURCE-COMPUTER. IBM-3090.                                       00360000
003700 OBJECT-COMPUTER. IBM-3090.                                       00370000
003800                                                                  00380000
003900 INPUT-OUTPUT SECTION.                                            00390000
004000                                                                  00400000
004100 FILE-CONTROL.                                                    00410000
004200     SELECT CUR-PRICE-FULL-FILE                                   00420000
004300       ASSIGN TO INP01.                                           00430000
004400                                                                  00440000
004410     SELECT FUT-PRICE-FULL-FILE                                   00441000
004420       ASSIGN TO INP02.                                           00442000
004430                                                                  00443000
004500     SELECT FUT-PRICE-MOD-FULL-FILE                               00450000
004600       ASSIGN TO OUT01.                                           00460000
004700                                                                  00470000
004800****************************************************************  00480000
004900 DATA DIVISION.                                                   00490000
005000****************************************************************  00500000
005100 FILE SECTION.                                                    00510000
005200                                                                  00520000
005300 FD  CUR-PRICE-FULL-FILE                                          00530000
005400     RECORDING MODE IS F                                          00540000
005500     LABEL RECORDS ARE STANDARD                                   00550000
005600     DATA RECORD IS CUR-PRICE-DATA-REC.                           00560000
005700                                                                  00570000
005800 01  CUR-PRICE-DATA-REC                            PIC X(260).    00580000
005900*  COPYBOOK IS EPRD220                                            00590000
006000                                                                  00600000
006100 FD  FUT-PRICE-FULL-FILE                                          00610000
006200     RECORDING MODE IS F                                          00620000
006300     LABEL RECORDS ARE STANDARD                                   00630000
006400     DATA RECORD IS FUT-PRICE-DATA-REC.                           00640000
006500                                                                  00650000
006600 01  FUT-PRICE-DATA-REC                            PIC X(260).    00660000
006700*  COPYBOOK IS EPRD220                                            00670000
006800                                                                  00680000
006810 FD  FUT-PRICE-MOD-FULL-FILE                                      00681000
006820     RECORDING MODE IS F                                          00682000
006830     LABEL RECORDS ARE STANDARD                                   00683000
006840     DATA RECORD IS FUT-PRICE-MOD-DATA-REC.                       00684000
006850                                                                  00685000
006860 01  FUT-PRICE-MOD-DATA-REC                            PIC X(260).00686000
006870*  COPYBOOK IS EPRD220                                            00687000
006880                                                                  00688000
006900*-------------------------------------------------------------    00690000
007000 WORKING-STORAGE SECTION.                                         00700000
007100*-------------------------------------------------------------    00710000
007200 01  AC-ABEND-CODE                  PIC S9(04) VALUE ZERO         00720000
007300                                               COMP SYNC.         00730000
007500     88  AC-4008-INVALID-EMPTY-INPUT           VALUE +4008.       00750000
007700                                                                  00770000
007800*-------------------------------------------------------------    00780000
007900* PC- PROGRAM CONSTANTS                                           00790000
008000*-------------------------------------------------------------    00800000
008100 01  PC-PROGRAM-CONSTANTS.                                        00810000
008200     05  PC-PROGRAM-NAME            PIC  X(08) VALUE 'EPKUT223'.  00820000
008300     05  PC-SKU-STAT-ACT            PIC  X(02) VALUE '20'.        00830000
008400     05  PC-SKU-STAT-CLR            PIC  X(02) VALUE '30'.        00840000
008500     05  PC-SKU-STAT-MXD            PIC  X(02) VALUE '25'.        00850000
008600     05  PC-CUR-FULL-STR-GRP        PIC  X(05) VALUE '99998'.     00860000
009000                                                                  00900000
009100*-------------------------------------------------------------    00910000
009200* PS- PROGRAM SWITCHES                                            00920000
009300*-------------------------------------------------------------    00930000
009400 01  PS-PROGRAM-SWITCHES.                                         00940000
009500     05  PS-END-OF-CUR-SW             PIC  X(01) VALUE 'N'.       00950000
009600         88  PS-END-OF-CUR-FILE                  VALUE 'Y'.       00960000
009700         88  PS-NOT-END-CUR-FILE                 VALUE 'N'.       00970000
009701     05  PS-END-OF-FUT-SW             PIC  X(01) VALUE 'N'.       00970100
009702         88  PS-END-OF-FUT-FILE                  VALUE 'Y'.       00970200
009703         88  PS-NOT-END-FUT-FILE                 VALUE 'N'.       00970300
009710     05  PS-END-OF-FUT-MOD-SW         PIC  X(01) VALUE 'N'.       00971000
009720         88  PS-END-OF-FUT-MOD-FILE              VALUE 'Y'.       00972000
009730         88  PS-NOT-END-FUT-MOD-FILE             VALUE 'N'.       00973000
009731     05  PS-FIRST-TIME-SW             PIC  X(01) VALUE 'N'.       00973100
009732         88  PS-FIRST-TIME-YES                   VALUE 'Y'.       00973200
009733         88  PS-FIRST-TIME-NO                    VALUE 'N'.       00973300
009740     05  PS-GLB-REC-EXIST-SW          PIC  X(01) VALUE 'N'.       00974000
009750         88  PS-GLB-REC-EXISTS                   VALUE 'Y'.       00975000
009751         88  PS-ONLY-GLB-REC-EXISTS              VALUE 'O'.       00975100
009760         88  PS-GLB-REC-DSNT-EXIST               VALUE 'N'.       00976000
009800     05  PS-END-OF-PROCES-SW          PIC  X(01) VALUE 'N'.       00980000
009900         88  PS-END-OF-PROCESSING                VALUE 'Y'.       00990000
010000         88  PS-NOT-END-OF-PROCESSING            VALUE 'N'.       01000000
010700                                                                  01070000
010800* ------------------------------------------------------------    01080000
010900*  COUNTERS                                                       01090000
011000* ------------------------------------------------------------    01100000
011100 01  PV-COUNTERS.                                                 01110000
011200     05  PV-CUR-RECS-READ             PIC  9(09) VALUE ZERO.      01120000
011210     05  PV-FUT-RECS-READ             PIC  9(09) VALUE ZERO.      01121000
011300     05  PV-FUT-REC-WRITEN            PIC  9(09) VALUE ZERO.      01130000
011310     05  PV-FUT-REC-ELIMINATED        PIC  9(09) VALUE ZERO.      01131000
011400*-------------------------------------------------------------    01140000
011500* PV- PROGRAM VARIABLES                                           01150000
011600*-------------------------------------------------------------    01160000
011700 01  PV-PROGRAM-VARIABLES.                                        01170000
011800     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01180000
011900     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACES.    01190000
012000     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACES.    01200000
012100     05  PV-FUT-SKU-NBR-PROCESS       PIC  9(08)  VALUE ZEROES.   01210000
012300                                                                  01230000
012400 01  PV-FUTURE-GLB-ROW.                                           01240000
012500     05  PV-SKU-NBR                   PIC 9(08)  VALUE ZEROES.    01250000
012600     05  PV-LOC-STAT-CDE              PIC X(02)  VALUE SPACES.    01260000
012700     05  PV-LAST-PRCHG-TMST           PIC X(19)  VALUE SPACES.    01270000
013170                                                                  01317000
013180 01  PV-FUT-LAST-PRCHG-TMST.                                      01318000
013190     05  PV-FUT-LAST-PRCHG-DTE        PIC X(10)  VALUE ZEROES.    01319000
013191     05  PV-FUT-SPACE                 PIC X(01)  VALUE SPACES.    01319100
013192     05  PV-FUT-TIME                  PIC X(08)  VALUE SPACES.    01319200
013193                                                                  01319300
013194 01  PV-CUR-LAST-PRCHG-TMST.                                      01319400
013195     05  PV-CUR-LAST-PRCHG-DTE        PIC X(10)  VALUE ZEROES.    01319500
013196     05  PV-CUR-SPACE                 PIC X(01)  VALUE SPACES.    01319600
013197     05  PV-CUR-TIME                  PIC X(08)  VALUE SPACES.    01319700
013198                                                                  01319800
013200*-------------------------------------------------------------    01320000
013300*  COPY BOOK FOR CURRENT FILE PROCESSING                          01330000
013400*-------------------------------------------------------------    01340000
013500     COPY EPRD220 REPLACING EP220 BY PVCUR.                       01350000
013600                                                                  01360000
013700*-------------------------------------------------------------    01370000
013800*  COPY BOOK FOR FUTURE FILE PROCESSING                           01380000
013900*-------------------------------------------------------------    01390000
014000     COPY EPRD220 REPLACING EP220 BY PVFUT.                       01400000
014200                                                                  01420000
014300****************************************************************  01430000
014400 PROCEDURE DIVISION.                                              01440000
014500****************************************************************  01450000
014600 0000-MAINLINE.                                                   01460000
014700                                                                  01470000
014800     PERFORM 1000-INITIALIZATION.                                 01480000
014900                                                                  01490000
015000     PERFORM 2000-PROCESS-FUTURE-FILE                             01500000
015100       UNTIL PS-END-OF-PROCESSING.                                01510000
015200                                                                  01520000
015300     PERFORM 9200-WRAPUP.                                         01530000
015400                                                                  01540000
015500     GOBACK.                                                      01550000
015600                                                                  01560000
015700*0000-EXIT.                                                       01570000
015900                                                                  01590000
016000*----------------------------------------------------------       01600000
016100* 1000-INITIALIZATION.                                            01610000
016200*     INITIALIZES VARIABLES, OPENS ANY FILES, AND READS           01620000
016300*     THE INPUT FILES, SAVES VARIABLES, AND CLOSES THE INPUT      01630000
016400*     FILES.                                                      01640000
016500*----------------------------------------------------------       01650000
016600 1000-INITIALIZATION.                                             01660000
016700                                                                  01670000
016800     INITIALIZE PS-PROGRAM-SWITCHES.                              01680000
016900     INITIALIZE PV-PROGRAM-VARIABLES.                             01690000
017000     INITIALIZE PV-COUNTERS.                                      01700000
017100                                                                  01710000
017200     DISPLAY '****************************************'.          01720000
017300     DISPLAY '**          EPKUT223 STARTED          **'.          01730000
017400     DISPLAY '****************************************'.          01740000
017500                                                                  01750000
017600     PERFORM 1100-OPEN-FILES.                                     01760000
017700                                                                  01770000
017710     SET PS-NOT-END-CUR-FILE  TO TRUE.                            01771000
017711     SET PS-NOT-END-FUT-FILE  TO TRUE.                            01771100
017712     SET PS-NOT-END-OF-PROCESSING TO TRUE.                        01771200
017713     SET PS-GLB-REC-DSNT-EXIST  TO TRUE.                          01771300
017720                                                                  01772000
017730     INITIALIZE PV-FUT-LAST-PRCHG-TMST.                           01773000
017740     INITIALIZE PV-CUR-LAST-PRCHG-TMST.                           01774000
017741     INITIALIZE PV-FUTURE-GLB-ROW.                                01774100
017760                                                                  01776000
017800     PERFORM 8100-READ-CUR-PRICE-FILE.                            01780000
017810     PERFORM 8200-READ-FUT-PRICE-FILE.                            01781000
017820                                                                  01782001
017830     IF PS-END-OF-FUT-FILE                                        01783001
017840        DISPLAY ' INPUT FUTURE FILE IS EMPTY PROGRAM WILL END'    01784001
017841        SET PS-END-OF-PROCESSING  TO TRUE                         01784101
017842     END-IF.                                                      01784201
017850                                                                  01785001
017900                                                                  01790000
018800*1000-EXIT.                                                       01880000
019000                                                                  01900000
019100*----------------------------------------------------------       01910000
019200* 1100-OPEN-FILES.                                                01920000
019300*     OPEN THE INPUT AND OUTPUT FILES                             01930000
019400*----------------------------------------------------------       01940000
019500 1100-OPEN-FILES.                                                 01950000
019600                                                                  01960000
019700     OPEN INPUT CUR-PRICE-FULL-FILE                               01970000
019710                FUT-PRICE-FULL-FILE.                              01971000
019800                                                                  01980000
019900     OPEN OUTPUT FUT-PRICE-MOD-FULL-FILE.                         01990000
020300                                                                  02030000
020400*1100-EXIT.                                                       02040000
020600                                                                  02060000
020620*----------------------------------------------------------       02062000
020621* 2000-PROCESS-FUTURE-FILE                                        02062100
020630*     THIS PARAGRAPH HAS RECORD FROM EACH OF THE INPUT FILES      02063000
020640*    (CURRENT AND FUTURE PRICING SORTED FILES).                   02064000
020641*  - WHEN THE CURRENT SKU < FUTURE SKU IT IMPLIES THAT THIS       02064100
020642*    SKU DOES NOT EXISTS IN FUTURE FILE, SO IT WILL READ THE      02064200
020643*    NEXT RECORD FROM CURRENT FILE.                               02064300
020644*  - WHEN THE CURRENT SKU > FUTURE SKU,IT IMPLIES THAT THIS       02064400
020645*    SKU DOES NOT EXISTS IN CURRENT FILE, SO IT WILL FIRST        02064500
020646*    WRITE THE FUTURE RECORD AND THEN READS NEXT FUTURE RECORD.   02064600
020647*  - WHEN BOTH ARE EQUAL IT IS PROCESSED FURTHER.                 02064700
020648*                                                                 02064800
020650*----------------------------------------------------------       02065000
020660 2000-PROCESS-FUTURE-FILE.                                        02066000
020670                                                                  02067000
020680     EVALUATE TRUE                                                02068000
020681         WHEN PS-END-OF-CUR-FILE AND                              02068102
020682              PS-NOT-END-FUT-FILE                                 02068202
020684              PERFORM 2200-PROCESS-ONLY-FUTURE                    02068402
020685                                                                  02068502
020686         WHEN PVFUT-SKU-NBR = '~'                                 02068606
020688              PERFORM 2500-WRITE-FUTR-SKU                         02068806
020689                                                                  02068906
020690         WHEN PVCUR-SKU-NBR < PVFUT-SKU-NBR                       02069000
020700              PERFORM 8100-READ-CUR-PRICE-FILE                    02070000
020701                                                                  02070100
020710         WHEN PVCUR-SKU-NBR > PVFUT-SKU-NBR                       02071000
020720              PERFORM 2500-WRITE-FUTR-SKU                         02072000
020721                                                                  02072100
020722         WHEN PVCUR-SKU-NBR = PVFUT-SKU-NBR                       02072200
020723          AND PVFUT-LOC-SKU-STAT-CDE = PC-SKU-STAT-ACT            02072300
020725              PERFORM 2500-WRITE-FUTR-SKU                         02072500
020726              PERFORM 8100-READ-CUR-PRICE-FILE                    02072600
020727                                                                  02072700
020728         WHEN PVCUR-SKU-NBR = PVFUT-SKU-NBR                       02072800
020729          AND PVFUT-LOC-SKU-STAT-CDE = PC-SKU-STAT-CLR            02072900
020732              MOVE PVFUT-SKU-NBR TO PV-FUT-SKU-NBR-PROCESS        02073200
020733              SET PS-FIRST-TIME-YES TO TRUE                       02073300
020734              PERFORM 2100-VALIDATE-FUTR-CLR-SKU                  02073400
020735                UNTIL PVFUT-SKU-NBR NOT = PV-FUT-SKU-NBR-PROCESS  02073500
020736                   OR PS-END-OF-FUT-FILE                          02073600
020737                                                                  02073700
020739     END-EVALUATE.                                                02073900
020740                                                                  02074000
020741     EVALUATE TRUE                                                02074100
020742         WHEN PS-END-OF-CUR-FILE AND                              02074200
020743              PS-END-OF-FUT-FILE                                  02074300
020744               SET PS-END-OF-PROCESSING TO TRUE                   02074400
020745         WHEN PS-END-OF-CUR-FILE AND                              02074500
020746              PS-NOT-END-FUT-FILE                                 02074600
020747              PERFORM 2200-PROCESS-ONLY-FUTURE                    02074700
020748         WHEN PS-NOT-END-CUR-FILE AND                             02074800
020749              PS-END-OF-FUT-FILE                                  02074900
020750               SET PS-END-OF-PROCESSING TO TRUE                   02075000
020751     END-EVALUATE.                                                02075100
020752                                                                  02075200
020753*2000-EXIT.                                                       02075300
020754                                                                  02075400
020755*----------------------------------------------------------       02075500
020756* 2100-VALIDATE-FUTR-CLR-SKU                                      02075600
020757*   IT WILL VALIDATE ONLY THE CLEARANCE SKU, IF THE ROW IN THE    02075700
020758*   FUTURE FILE HAS ANY OTHER STATUS, THE RECORD IS WRITEN OUT.   02075800
020761*----------------------------------------------------------       02076100
020762 2100-VALIDATE-FUTR-CLR-SKU.                                      02076200
020763                                                                  02076300
020764     INITIALIZE PV-FUT-LAST-PRCHG-TMST.                           02076400
020765     INITIALIZE PV-CUR-LAST-PRCHG-TMST.                           02076500
020766                                                                  02076600
020767     IF PS-FIRST-TIME-YES                                         02076700
020768        IF PVCUR-STR-GRP-TYP-CDE = PC-CUR-FULL-STR-GRP            02076800
020769           MOVE PVCUR-SKU-NBR           TO PV-SKU-NBR             02076900
020770           MOVE PVCUR-LOC-SKU-STAT-CDE  TO PV-LOC-STAT-CDE        02077000
020771           MOVE PVCUR-LAST-PRCHG-TMST   TO PV-LAST-PRCHG-TMST     02077100
020772           SET PS-GLB-REC-EXISTS  TO TRUE                         02077200
020773           PERFORM 8100-READ-CUR-PRICE-FILE                       02077300
020774           IF PVCUR-SKU-NBR NOT = PVFUT-SKU-NBR                   02077400
020775              SET PS-ONLY-GLB-REC-EXISTS TO TRUE                  02077500
020776           END-IF                                                 02077600
020777        ELSE                                                      02077700
020778           SET PS-GLB-REC-DSNT-EXIST TO TRUE                      02077800
020779           DISPLAY ' NO  GLOBAL RECORD IN CURRENT FOR SKU : '     02077900
020780                          PVCUR-SKU-NBR                           02078000
020781        END-IF                                                    02078100
020782        SET PS-FIRST-TIME-NO TO TRUE                              02078200
020783     END-IF.                                                      02078300
020784                                                                  02078400
020785     EVALUATE TRUE                                                02078500
020786         WHEN PS-ONLY-GLB-REC-EXISTS                              02078600
020788              PERFORM 2350-ONLY-GLOBAL-CHECK                      02078800
020789                                                                  02078900
020790         WHEN  PVCUR-SKU-NBR = PVFUT-SKU-NBR                      02079000
020791          AND PVCUR-STR-GRP-TYP-CDE = PVFUT-STR-GRP-TYP-CDE       02079100
020792          AND PVCUR-STR-GRP-ID = PVFUT-STR-GRP-ID                 02079200
020793              PERFORM 2300-STORE-SPECIFIC-CHK                     02079300
020794              PERFORM 8100-READ-CUR-PRICE-FILE                    02079400
020795                                                                  02079500
020796         WHEN  PVCUR-SKU-NBR = PVFUT-SKU-NBR                      02079600
020797          AND PVCUR-STR-GRP-TYP-CDE = PVFUT-STR-GRP-TYP-CDE       02079700
020798          AND PVCUR-STR-GRP-ID > PVFUT-STR-GRP-ID                 02079800
020799              IF PS-GLB-REC-EXISTS                                02079900
020800                 PERFORM 2400-GLOBAL-CHECK                        02080000
020801              ELSE                                                02080100
020802                  PERFORM 2500-WRITE-FUTR-SKU                     02080200
020803              END-IF                                              02080300
020804                                                                  02080400
020805         WHEN  PVCUR-SKU-NBR = PVFUT-SKU-NBR                      02080500
020806          AND PVCUR-STR-GRP-TYP-CDE = PVFUT-STR-GRP-TYP-CDE       02080600
020807          AND PVCUR-STR-GRP-ID < PVFUT-STR-GRP-ID                 02080700
020812              PERFORM 8100-READ-CUR-PRICE-FILE                    02081200
020813                                                                  02081300
020814*-- FOLLOWING CONDITION IMPLIES THAT FOR THS PARTICULAR ROW       02081400
020815*-- IN FUTURE THERE IS NOT STORE SPECIFIC ROW IN CURRENT VERIFY   02081500
020816*-- AGAINST THE CURRENT SAVED GLOBAL AND DO NOT READ CURRENT AGAIN02081600
020817         WHEN  PVCUR-SKU-NBR NOT = PVFUT-SKU-NBR AND              02081700
020818               PVFUT-SKU-NBR = PV-SKU-NBR                         02081800
020821              IF PS-GLB-REC-EXISTS                                02082100
020822                 PERFORM 2400-GLOBAL-CHECK                        02082200
020823              ELSE                                                02082300
020824                  PERFORM 2500-WRITE-FUTR-SKU                     02082400
020825              END-IF                                              02082500
020826                                                                  02082600
020827         WHEN OTHER                                               02082700
020828             PERFORM 2500-WRITE-FUTR-SKU                          02082800
020829             DISPLAY 'FUTURE SKU ' PVFUT-SKU-NBR                  02082900
020830                    '  ' PVFUT-STR-GRP-ID                         02083000
020831             DISPLAY 'CURREN SKU ' PVCUR-SKU-NBR                  02083100
020832                    '  ' PVCUR-STR-GRP-ID                         02083200
020833     END-EVALUATE.                                                02083300
020834                                                                  02083400
020835*2100-EXIT.                                                       02083500
020836*----------------------------------------------------------       02083600
020837* 2200-PROCESS-ONLY-FUTURE                                        02083700
020838*  CONTROL REACHES THIS PARAGRAPH WHEN THERE ARE NO MORE RECORDS  02083800
020839*  IN CURRENT FILE, BUT THERE ARE STILL RECORDS TO BE PROCESSED IN02083900
020840*  FUTURE FILE. NOW THESE NEEDS TO BE WRITEN OUT TO THE OUTPUT    02084000
020841*  FILE WITHOUT FURTHER CHECKING.                                 02084100
020842*----------------------------------------------------------       02084200
020843 2200-PROCESS-ONLY-FUTURE.                                        02084300
020844                                                                  02084400
020845     PERFORM 2500-WRITE-FUTR-SKU                                  02084500
020846       UNTIL PS-END-OF-FUT-FILE.                                  02084600
020847                                                                  02084700
020848     IF PS-END-OF-FUT-FILE AND                                    02084800
020849        PS-END-OF-CUR-FILE                                        02084900
020850        SET PS-END-OF-PROCESSING TO TRUE                          02085000
020851     END-IF.                                                      02085100
020852                                                                  02085200
020853*2200-EXIT.                                                       02085300
020854*----------------------------------------------------------       02085400
020855* 2300-STORE-SPECIFIC-CHK                                         02085500
020856*                                                                 02085600
020857*                                                                 02085700
020858*----------------------------------------------------------       02085800
020859 2300-STORE-SPECIFIC-CHK.                                         02085900
020860                                                                  02086000
020861     IF PVCUR-LOC-SKU-STAT-CDE = PC-SKU-STAT-ACT                  02086100
020862        MOVE PVCUR-LAST-PRCHG-TMST TO PV-CUR-LAST-PRCHG-TMST      02086200
020863        MOVE PVFUT-LAST-PRCHG-TMST TO PV-FUT-LAST-PRCHG-TMST      02086300
020866        IF PV-CUR-LAST-PRCHG-DTE > PV-FUT-LAST-PRCHG-DTE          02086600
020867           DISPLAY ' FOLLOWING FUTURE RECORD ELIMINATED '         02086700
020868           DISPLAY ' SKU    : ' PVFUT-SKU-NBR                     02086800
020869           DISPLAY ' STATUS : ' PVFUT-LOC-SKU-STAT-CDE            02086900
020870           DISPLAY ' TMST   : ' PVFUT-LAST-PRCHG-TMST             02087000
020871           ADD 1 TO PV-FUT-REC-ELIMINATED                         02087100
020872           PERFORM 8200-READ-FUT-PRICE-FILE                       02087200
020874        ELSE                                                      02087400
020875           PERFORM 2400-GLOBAL-CHECK                              02087500
020876        END-IF                                                    02087600
020877     ELSE                                                         02087700
020878           PERFORM 2400-GLOBAL-CHECK                              02087800
020879     END-IF.                                                      02087900
020880                                                                  02088000
020881*2300-EXIT.                                                       02088100
020882*----------------------------------------------------------       02088200
020883* 2350-ONLY-GLOBAL-CHECK                                          02088300
020884* THIS PARAGRAPH IS PERFORMED WHEN THERE IS ONLY GLOBAL REC FOR   02088400
020885* THAT SKU IN THE CURRENT PRICING FILE                            02088500
020886*----------------------------------------------------------       02088600
020887 2350-ONLY-GLOBAL-CHECK.                                          02088700
020888                                                                  02088800
020891     PERFORM 2400-GLOBAL-CHECK UNTIL                              02089100
020892        PVFUT-SKU-NBR NOT = PV-SKU-NBR                            02089200
020893         OR PS-END-OF-FUT-FILE.                                   02089300
020894                                                                  02089400
020895*2350-EXIT.                                                       02089500
020896*----------------------------------------------------------       02089600
020897* 2400-GLOBAL-CHECK                                               02089700
020898* VALIDATING FUTURE CLEARANCE SKU WITH GLOBAL ACTIVE              02089800
020899*----------------------------------------------------------       02089900
020900 2400-GLOBAL-CHECK.                                               02090000
020901                                                                  02090100
020902     IF PV-LOC-STAT-CDE = PC-SKU-STAT-ACT                         02090200
020903        MOVE PV-LAST-PRCHG-TMST    TO PV-CUR-LAST-PRCHG-TMST      02090300
020904        MOVE PVFUT-LAST-PRCHG-TMST TO PV-FUT-LAST-PRCHG-TMST      02090400
020905        IF PV-CUR-LAST-PRCHG-DTE > PV-FUT-LAST-PRCHG-DTE          02090500
020906           DISPLAY ' FOLLOWING FUTURE RECORD ELIMINATED '         02090600
020907           DISPLAY '  SKU   : ' PVFUT-SKU-NBR                     02090700
020908           DISPLAY ' STATUS : ' PVFUT-LOC-SKU-STAT-CDE            02090800
020909           DISPLAY ' TMST   : ' PVFUT-LAST-PRCHG-TMST             02090900
020910           ADD 1 TO PV-FUT-REC-ELIMINATED                         02091000
020911           PERFORM 8200-READ-FUT-PRICE-FILE                       02091100
020913        ELSE                                                      02091300
020914           PERFORM 2500-WRITE-FUTR-SKU                            02091400
020915     ELSE                                                         02091500
020916        PERFORM 2500-WRITE-FUTR-SKU                               02091600
020917     END-IF.                                                      02091700
020918                                                                  02091800
020921*2400-EXIT.                                                       02092100
020923*----------------------------------------------------------       02092300
020924* 2500-WRITE-FUTR-SKU                                             02092400
020925*  THIS PARAGRAPH WILL WRITE THE CURRENT FUT RECORDS TO THE       02092500
020926*  OUTPUT FILE AND WILL READ THE NEXT FUTURE RECORD.              02092600
020927*----------------------------------------------------------       02092700
020928 2500-WRITE-FUTR-SKU.                                             02092800
020929                                                                  02092900
020930     MOVE PVFUT-XST-SKU-PRICG-RECORD TO FUT-PRICE-MOD-DATA-REC.   02093000
020931     PERFORM 8300-WRITE-FUT-PRICE-FILE                            02093100
020932     PERFORM 8200-READ-FUT-PRICE-FILE.                            02093200
020933                                                                  02093300
020934*2500-EXIT.                                                       02093400
020935                                                                  02093500
020936*----------------------------------------------------------       02093600
020937* 8100-READ-CUR-PRICE-FILE                                        02093700
020938*     PROCESS THE INPUT RECORDS AND BASED ON THE CONDITIONS       02093800
020939*     WRITE THE DATA OUT TO EACH OF THE FOUR FILES                02093900
020940*----------------------------------------------------------       02094000
020941 8100-READ-CUR-PRICE-FILE.                                        02094100
020942                                                                  02094200
020943     READ CUR-PRICE-FULL-FILE                                     02094300
020944         INTO PVCUR-XST-SKU-PRICG-RECORD                          02094400
020945     AT END                                                       02094500
020946        SET PS-END-OF-CUR-FILE TO TRUE                            02094600
020947     END-READ.                                                    02094700
020948                                                                  02094800
020949     IF PS-NOT-END-CUR-FILE                                       02094900
020950        ADD 1 TO PV-CUR-RECS-READ                                 02095000
020951     END-IF.                                                      02095100
020952                                                                  02095200
020953*8100-EXIT.                                                       02095300
020954                                                                  02095400
020955*----------------------------------------------------------       02095500
020956* 8200-READ-FUT-PRICE-FILE                                        02095600
020957*     PROCESS THE INPUT RECORDS AND BASED ON THE CONDITIONS       02095700
020960*     WRITE THE DATA OUT TO EACH OF THE FOUR FILES                02096000
021000*----------------------------------------------------------       02100000
021100 8200-READ-FUT-PRICE-FILE.                                        02110000
021200                                                                  02120000
021210     READ FUT-PRICE-FULL-FILE                                     02121000
021220         INTO PVFUT-XST-SKU-PRICG-RECORD                          02122000
021230     AT END                                                       02123000
021240        SET PS-END-OF-FUT-FILE TO TRUE                            02124000
021250     END-READ.                                                    02125000
021260                                                                  02126000
021270     IF PS-NOT-END-FUT-FILE                                       02127000
021280        ADD 1 TO PV-FUT-RECS-READ                                 02128000
021290     END-IF.                                                      02129000
021291                                                                  02129100
021400*8200-EXIT.                                                       02140000
021500                                                                  02150000
021600*----------------------------------------------------------       02160000
021700* 8300-WRITE-FUT-PRICE-FILE                                       02170000
021800*     PROCESS THE INPUT RECORDS AND BASED ON THE CONDITIONS       02180000
021900*     WRITE THE DATA OUT TO EACH OF THE FOUR FILES                02190000
022000*----------------------------------------------------------       02200000
022100 8300-WRITE-FUT-PRICE-FILE.                                       02210000
022110                                                                  02211000
022200     WRITE FUT-PRICE-MOD-DATA-REC.                                02220000
022300                                                                  02230000
022310     ADD 1 TO PV-FUT-REC-WRITEN.                                  02231000
022320                                                                  02232000
022400*8300-EXIT.                                                       02240000
022602                                                                  02260200
022700******************************************************************02270000
022800*     CLOSES ALL FILES AND DISPLAYS ANY NEEDED INFORMATION.      *02280000
022900******************************************************************02290000
023000 9200-WRAPUP.                                                     02300000
023100     MOVE '9200-WRAPUP                     ' TO PV-PARAGRAPH-NAME.02310000
023200                                                                  02320000
023300     PERFORM 9920-DISPLAY-TOTALS.                                 02330000
023400                                                                  02340000
023500     DISPLAY '****************************************'.          02350000
023600     DISPLAY '**          EPKUT223 END              **'.          02360000
023700     DISPLAY '****************************************'.          02370000
023800                                                                  02380000
023900     CLOSE CUR-PRICE-FULL-FILE                                    02390000
023901           FUT-PRICE-FULL-FILE                                    02390100
023902           FUT-PRICE-MOD-FULL-FILE.                               02390200
024000                                                                  02400000
024600*9200-EXIT.  EXIT.                                                02460000
024700******************************************************************02470000
024800*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.              *   02480000
024900******************************************************************02490000
025000 9910-ABEND.                                                      02500000
025100                                                                  02510000
025200     PERFORM 9920-DISPLAY-TOTALS.                                 02520000
025300                                                                  02530000
025400     DISPLAY '** ABEND           **'.                             02540000
025500     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          02550000
025600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        02560000
025700     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       02570000
025800     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       02580000
025900                                                                  02590000
026000     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         02600000
026100                                                                  02610000
026200*9910-EXIT.  EXIT.                                                02620000
026300******************************************************************02630000
026400*     DISPLAY END OF JOB TOTALS                                  *02640000
026500******************************************************************02650000
026600 9920-DISPLAY-TOTALS.                                             02660000
026700                                                                  02670000
026800     DISPLAY '****************************************'.          02680000
026900     DISPLAY '**     STATISTICS  FOR  EPKUT223      **'.          02690000
027000     DISPLAY '****************************************'.          02700000
027100                                                                  02710000
027200     DISPLAY '** CURRENT PRICE RECORDS READ  ====> '              02720000
027300             PV-CUR-RECS-READ                                     02730000
027400             ' **'.                                               02740000
027410     DISPLAY '** FUTURE PRICE RECORDS READ  ====> '               02741000
027420             PV-FUT-RECS-READ                                     02742000
027430             ' **'.                                               02743000
027500     DISPLAY '** FUTURE PRICE RECORDS WRITEN ====> '              02750000
027600             PV-FUT-REC-WRITEN                                    02760000
027700             ' **'.                                               02770000
027800     DISPLAY '** CLEARANCE SKU ELIMINATED ====> '                 02780000
027900             PV-FUT-REC-ELIMINATED                                02790000
028000             ' **'.                                               02800000
028700     DISPLAY '****************************************'.          02870000
028800                                                                  02880000
028900*9920-EXIT.  EXIT.                                                02890000
029000                                                                  02900000
