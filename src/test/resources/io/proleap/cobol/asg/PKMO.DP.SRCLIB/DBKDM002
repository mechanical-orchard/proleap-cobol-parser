000100 IDENTIFICATION DIVISION.                                         00010010
000200 PROGRAM-ID.     DBKDM002.                                        00020012
000300 AUTHOR.         CRAIG MARTIN.                                    00030010
000400 INSTALLATION.   KOHLS.                                           00040010
000500 DATE-WRITTEN.   OCTOBER 1998.                                    00050010
000600****************************************************************  00060010
000700***   DB2 TABLE PLAN/PACKAGE DEPENDENCIES                    ***  00070010
000800***               E.K.R.2 TSO OPTION                         ***  00080010
000900****************************************************************  00090010
001000*                                                                 00100010
001010***********************************************************       00101025
001020* 03/08  LARRY SCHLEICHER                                         00102030
001030*     ADDED SUPPORT FOR DB2 VERSION 8.  ALLOW THE LENGTH          00103025
001040*     OF TABLE NAMES TO INCREASE FROM 18 CHARACTERS TO 128.       00104029
001050***********************************************************       00105025
001020* 05/08  LARRY SCHLEICHER                                         00106033
001030*     CHANGED THE SETTING OF THE CURSOR FROM THE CMNEKTAB         00107033
001040*     FIELD TO THE CMNEKCRE FIELD.                                00108033
001050***********************************************************       00109033
001020* 03/14  BETSY JEFFERY                                            00109140
001030*     INCREASED THE SIZE OF THE TEMPORARY FILE NAME TO            00109240
001040*     MULTI-LOGON ISPF REQUIREMENTS.                              00109340
001050***********************************************************       00109440
001100 ENVIRONMENT DIVISION.                                            00110010
001200 CONFIGURATION SECTION.                                           00120010
001300 SOURCE-COMPUTER.        IBM.                                     00130010
001400 OBJECT-COMPUTER.        IBM.                                     00140010
001500 INPUT-OUTPUT SECTION.                                            00150010
001600                                                                  00160010
001700 FILE-CONTROL.                                                    00170010
001800                                                                  00180010
001900     SELECT BROWSE-FILE ASSIGN TO PDEPDATA.                       00190013
002100                                                                  00210010
002200 DATA DIVISION.                                                   00220010
002300 FILE SECTION.                                                    00230010
002400 FD  BROWSE-FILE                                                  00240010
002500     RECORDING MODE IS F                                          00250010
002600     LABEL RECORDS ARE STANDARD                                   00260010
002700     RECORD CONTAINS 080 CHARACTERS                               00270010
002800     BLOCK CONTAINS 0 RECORDS                                     00280010
002900     DATA RECORD IS BROWSE-RECORD.                                00290010
003000 01  BROWSE-RECORD           PIC X(080).                          00300010
003800                                                                  00380010
003900*                                                                 00390010
004000     EJECT                                                        00400010
004100 WORKING-STORAGE SECTION.                                         00410010
004200*                                                                 00420010
004300 01  SQL-FILLER          PIC X.                                   00430010
004400                                                                  00440010
004500 01  NO-MATCH-INFO.                                               00450010
004600     05  PIC X(02)  VALUE  SPACES.                                00460010
004700     05  PIC X(33)  VALUE  'NO DB2 TABLE MATCHED FOR CREATOR'.    00470010
004800     05  NO-MATCH-INFO-CREATOR         PIC X(08)   VALUE SPACES.  00480010
004900     05  PIC X(15)  VALUE  'AND TABLE NAME'.                      00490010
005000     05  NO-MATCH-INFO-TABLE-NAME      PIC X(18)   VALUE SPACES.  00500010
005100                                                                  00510010
005200 01  REPORT-TITLE1.                                               00520010
005300     05  PIC X(20)  VALUE  SPACES.                                00530010
005400     05  PIC X(35)  VALUE  'DB2 TABLE PLAN/PACKAGE DEPENDENCIES'. 00540010
005500     05  PIC X(25)  VALUE  SPACES.                                00550010
005600                                                                  00560010
005700 01  REPORT-TITLE2.                                               00570010
005800     05  PIC X(02)  VALUE  SPACES.                                00580027
005900     05  PIC X(10)  VALUE  'TABLE  =  '.                          00590010
006000     05  TITLE-TABLE1   PIC X(64)   VALUE SPACES.                 00600027
006400                                                                  00640010
006401 01  REPORT-TITLE3.                                               00640127
006402     05  PIC X(12)  VALUE  SPACES.                                00640227
006404     05  TITLE-TABLE2   PIC X(64)   VALUE SPACES.                 00640427
006405                                                                  00640527
006410 01  REPORT-TITLE4.                                               00641027
006420     05  PIC X(02)  VALUE  SPACES.                                00642028
006460     05  PIC X(12)  VALUE  'CREATOR  =  '.                        00646028
006470     05  TITLE-CREATOR  PIC X(8)    VALUE SPACES.                 00647027
006480                                                                  00648027
006500 01  REPORT-LINE-HDR1.                                            00650010
006600     05  PIC X(03)  VALUE  SPACES.                                00660010
006700     05  PIC X(08)  VALUE  'PACKAGE '.                            00670010
006800     05  PIC X(02)  VALUE  SPACES.                                00680010
006900     05  PIC X(18)  VALUE  'COLLID  '.                            00690010
007000     05  PIC X(01)  VALUE  SPACES.                                00700010
007100     05  PIC X(08)  VALUE  'PLAN    '.                            00710010
007200     05  PIC X(02)  VALUE  SPACES.                                00720010
007300     05  PIC X(08)  VALUE  'PROC    '.                            00730010
007400     05  PIC X(02)  VALUE  SPACES.                                00740010
007500     05  PIC X(28)  VALUE  'FUNCTION'.                            00750010
007600                                                                  00760010
007700 01  REPORT-LINE-HDR2.                                            00770010
007800     05  PIC X(03)  VALUE  SPACES.                                00780010
007900     05  PIC X(08)  VALUE  '------- '.                            00790010
008000     05  PIC X(02)  VALUE  SPACES.                                00800010
008100     05  PIC X(18)  VALUE  '------  '.                            00810010
008200     05  PIC X(01)  VALUE  SPACES.                                00820010
008300     05  PIC X(08)  VALUE  '----    '.                            00830010
008400     05  PIC X(02)  VALUE  SPACES.                                00840010
008500     05  PIC X(08)  VALUE  '----    '.                            00850010
008600     05  PIC X(02)  VALUE  SPACES.                                00860010
008700     05  PIC X(28)  VALUE  '--------'.                            00870010
008800                                                                  00880010
008900 01  REPORT-LINE-DTL.                                             00890010
009000     05  PIC X(03)  VALUE  SPACES.                                00900010
009100     05  RL-PACKAGE PIC X(08)  VALUE SPACES.                      00910010
009200     05  PIC X(02)  VALUE  SPACES.                                00920010
009300     05  RL-COLLID  PIC X(18)  VALUE SPACES.                      00930010
009400     05  PIC X(01)  VALUE  SPACES.                                00940010
009500     05  RL-PLAN    PIC X(08)  VALUE SPACES.                      00950010
009600     05  PIC X(02)  VALUE  SPACES.                                00960010
009700     05  RL-PROC    PIC X(08)  VALUE SPACES.                      00970010
009800     05  PIC X(01)  VALUE  SPACES.                                00980010
009900     05  RL-FUNCTIONS.                                            00990010
010000         10  RL-FUNCTION-OCC OCCURS 4 TIMES.                      01000010
010100             15  RL-DELIMIT  PIC X(1).                            01010010
010200             15  RL-FUNCTION PIC X(6).                            01020010
010300                                                                  01030010
010400 01  ISP-FUNCTIONS.                                               01040010
010500     05  ISP-DISPLAY     PIC X(8) VALUE 'DISPLAY'.                01050010
010600     05  ISP-ADDPOP      PIC X(8) VALUE 'ADDPOP  '.               01060010
010700     05  ISP-REMPOP      PIC X(8) VALUE 'REMPOP  '.               01070010
010800     05  ISP-VDEFINE     PIC X(8) VALUE 'VDEFINE'.                01080010
010900     05  ISP-VDELETE     PIC X(8) VALUE 'VDELETE'.                01090010
011000     05  ISP-VGET        PIC X(8) VALUE 'VGET'.                   01100010
011100     05  ISP-VPUT        PIC X(8) VALUE 'VPUT'.                   01110010
011200     05  ISP-VRESET      PIC X(8) VALUE 'VRESET'.                 01120010
011300     05  ISP-VCOPY       PIC X(8) VALUE 'VCOPY'.                  01130010
011400     05  ISP-VREPLACE    PIC X(8) VALUE 'VREPLACE'.               01140010
011500     05  ISP-TBOPEN      PIC X(8) VALUE 'TBOPEN'.                 01150010
011600     05  ISP-TBCREATE    PIC X(8) VALUE 'TBCREATE'.               01160010
011700     05  ISP-TBCLOSE     PIC X(8) VALUE 'TBCLOSE'.                01170010
011800     05  ISP-TBEND       PIC X(8) VALUE 'TBEND  '.                01180010
011900     05  ISP-TBDISPL     PIC X(8) VALUE 'TBDISPL'.                01190010
012000     05  ISP-TBSORT      PIC X(8) VALUE 'TBSORT'.                 01200010
012100     05  ISP-TBTOP       PIC X(8) VALUE 'TBTOP'.                  01210010
012200     05  ISP-TBBOTTOM    PIC X(8) VALUE 'TBBOTTOM'.               01220010
012300     05  ISP-TBSKIP      PIC X(8) VALUE 'TBSKIP'.                 01230010
012400     05  ISP-TBADD       PIC X(8) VALUE 'TBADD '.                 01240010
012500     05  ISP-TBPUT       PIC X(8) VALUE 'TBPUT '.                 01250010
012600     05  ISP-TBMOD       PIC X(8) VALUE 'TBMOD '.                 01260010
012700     05  ISP-TBDELETE    PIC X(8) VALUE 'TBDELETE'.               01270010
012800     05  ISP-TBEXIST     PIC X(8) VALUE 'TBEXIST '.               01280010
012900     05  ISP-TBSCAN      PIC X(8) VALUE 'TBSCAN'.                 01290010
013000     05  ISP-TBPAD       PIC 9(8) COMP VALUE 0.                   01300010
013100     05  ISP-NEWCOPY     PIC X(8) VALUE 'NEWCOPY'.                01310010
013200     05  ISP-FTOPEN      PIC X(8) VALUE 'FTOPEN'.                 01320010
013300     05  ISP-FTINCL      PIC X(8) VALUE 'FTINCL'.                 01330010
013400     05  ISP-FTCLOSE     PIC X(8) VALUE 'FTCLOSE'.                01340010
013500     05  ISP-SELECT      PIC X(8) VALUE 'SELECT'.                 01350010
013600     05  ISP-BROWSE      PIC X(8) VALUE 'BROWSE'.                 01360010
013700     05  ISP-SETMSG      PIC X(8) VALUE 'SETMSG'.                 01370010
013800     05  ISP-CONTROL     PIC X(8) VALUE 'CONTROL'.                01380010
013900     05  ISP-NONDISPL    PIC X(8) VALUE 'NONDISPL'.               01390010
014000     05  ISP-SPLIT       PIC X(8) VALUE 'SPLIT'.                  01400010
014100     05  ISP-DISABLE     PIC X(8) VALUE 'DISABLE'.                01410010
014200     05  ISP-ENABLE      PIC X(8) VALUE 'ENABLE'.                 01420010
014300     05  ISP-NO          PIC X(8) VALUE 'NO'.                     01430010
014400     05  ISP-YES         PIC X(8) VALUE 'YES'.                    01440010
014500*                                                                 01450010
014600 01  ISP-MISC-DEFS.                                               01460010
014700     05  ISP-FORMAT      PIC X(8) VALUE 'CHAR'.                   01470010
014800     05  ISP-MOVE        PIC X(8) VALUE 'MOVE'.                   01480010
014900     05  ISP-WRITE       PIC X(8) VALUE 'WRITE'.                  01490010
015000     05  ISP-NOWRITE     PIC X(8) VALUE 'NOWRITE'.                01500010
015100     05  ISP-REPLACE     PIC X(8) VALUE 'REPLACE'.                01510010
015200     05  ISP-ORDERED     PIC X(8) VALUE 'ORDERED'.                01520010
015300     05  ISP-SHARED      PIC X(8) VALUE 'SHARED'.                 01530010
015400     05  ISP-PROFILE     PIC X(8) VALUE 'PROFILE'.                01540010
015500     05  ISP-ASIS        PIC X(8) VALUE 'ASIS'.                   01550010
015600     05  ISP-NOREAD      PIC X(8) VALUE 'NOREAD'.                 01560010
015700     05  ISP-NEXT        PIC X(8) VALUE 'NEXT'.                   01570010
015800     05  ISP-TEMP        PIC X(8) VALUE 'TEMP'.                   01580010
015900     05  ISP-PANEL       PIC X(8) VALUE  SPACES.                  01590010
016000     05  ISP-DUMMY       PIC X(8) VALUE  SPACES.                  01600010
016100     05  ISP-MSG         PIC X(8) VALUE  'CMN000  '.              01610010
016200     05  ISP-CSR         PIC X(8) VALUE  SPACES.                  01620010
016300     05  ISP-FIELD       PIC X(8) VALUE  SPACES.                  01630010
016400     05  ISP-SKEL        PIC X(8) VALUE  SPACES.                  01640010
016500     05  ISP-ERRORS      PIC X(8) VALUE 'ERRORS'.                 01650010
016600     05  ISP-RETURN      PIC X(8) VALUE 'RETURN'.                 01660010
016700     05  ISP-CANCEL      PIC X(8) VALUE 'CANCEL'.                 01670010
016800     05  ISP-SAVE        PIC X(8) VALUE 'SAVE'.                   01680010
016900     05  ISP-RESTORE     PIC X(8) VALUE 'RESTORE'.                01690010
017000     05  TBL-LIST-GT     PIC X(4) VALUE '(GT)'.                   01700010
017100*                                                                 01710010
017200***  DEFINE DATA TYPE PARAMETER FOR VARIABLE DEFINE SERVICE CALL. 01720010
017300*                                                                 01730010
017400 01  CHAR                PIC X(08)     VALUE 'CHAR    '.          01740010
017500                                                                  01750013
017700*                                                                 01770013
017800*  PARAMETER LIST FOR THE DYNAMIC ALLOCATION ROUTINE              01780013
017900*                                                                 01790013
018000     COPY DPWS023.                                                01800013
018100                                                                  01810013
018200*                                                                 01820013
018300*  PARAMETER LIST FOR THE ISPF PRINT PANEL ROUTINE                01830013
018400*                                                                 01840013
018500     COPY DPWS300.                                                01850013
018600                                                                  01860013
018700 01  VAR-SMSG                    PIC X(24)   VALUE SPACES.        01870021
018800 01  FILLER                      REDEFINES VAR-SMSG.              01880021
018900     05  VAR-SMSG-FILLER         PIC X(20).                       01890021
019000     05  VAR-SMSG-SQLCODE        PIC 9(4).                        01900021
019100 01  VAR-LMSG                    PIC X(72)   VALUE SPACES.        01910021
020700 01  PV-PROGRAM-VARIABLES.                                        02070013
020800     05  VAR-ZTEMPF              PIC X(44)   VALUE SPACES.        02080010
020900     05  VAR-DSNAME              PIC X(46)   VALUE SPACES.        02090010
021000     05  VAR-VOLUME              PIC X(06)   VALUE SPACES.        02100010
021100     05  VAR-PASSWORD            PIC X(08)   VALUE SPACES.        02110010
021110     05  PV-DYNALC-ROUTINE-ERROR-MSG.                             02111013
021120         10  FILLER              PIC X(13)    VALUE               02112013
021130             'DYNALC ERROR '.                                     02113013
021140         10  PV-DR-RETURN-CODE   PIC 9999     VALUE ZEROS.        02114013
021150         10  FILLER              PIC X(2)     VALUE '; '.         02115013
021160         10  PV-DR-DDNAME        PIC X(8)     VALUE SPACES.       02116013
021170         10  FILLER              PIC X(5)     VALUE ' DD; '.      02117013
021180         10  PV-DR-ERROR-DESC    PIC X(41)    VALUE SPACES.       02118013
021190     05  PV-BROWSE-DSNAME        PIC X(44)   VALUE SPACES.        02119019
021200     05  PV-COUNTR               PIC S9(4)   COMP.                02120010
021300     05  PV-FIELD-LENGTH         PIC 9(8)     VALUE ZEROS         02130022
021400                                              COMP SYNC.          02140022
022300*                                                                 02230010
022400***  DEFINE STORAGE FOR DIALOG VARIABLES.                         02240010
022500*                                                                 02250010
022600 01  VAR-CMNEKTAB        PIC X(43)     VALUE SPACES.              02260025
022610 01  VAR-CMNEKTB2        PIC X(43)     VALUE SPACES.              02261025
022620 01  VAR-CMNEKTB3        PIC X(42)     VALUE SPACES.              02262025
022630 01  VAR-128-TABLE-NAME  PIC X(128)    VALUE SPACES.              02263025
022700 01  VAR-CMNEKCRE        PIC X(08)     VALUE SPACES.              02270010
022800 01  ABEND-CODE                    PIC S9(4) VALUE ZERO           02280010
022900                                             COMP.                02290010
023000     88  ABEND-4013                          VALUE 4013.          02300010
023100                                                                  02310010
023300 01  HOLD-COLLID                 PIC X(18)   VALUE SPACES.        02330010
023400 01  HOLD-GRANTEE                PIC X(08)   VALUE SPACES.        02340010
023500 01  HOLD-PROCNUM                PIC S99     VALUE ZEROS.         02350010
023600 01  HOLD-SUBSCRIPT              PIC S99     VALUE ZEROS.         02360010
023700                                                                  02370010
023800 01  PS-PRINT-SWITCH               PIC X(1)  VALUE 'N'.           02380010
023900     88  PS-EOF-PRINT                        VALUE 'Y'.           02390010
024000     88  PS-NOT-EOF-PRINT                    VALUE 'N'.           02400010
024100 01  PS-TABLE-VALIDITY             PIC X(1)  VALUE 'N'.           02410010
024200     88  PS-TABLE-IS-VALID                   VALUE 'Y'.           02420010
024300     88  PS-TABLE-IS-NOT-VALID               VALUE 'N'.           02430010
024400 01  PS-ALLOCATE-SW                PIC X(1)  VALUE 'N'.           02440010
024500     88  PS-IS-ALLOCATED                     VALUE 'Y'.           02450010
024600     88  PS-IS-NOT-ALLOCATED                 VALUE 'N'.           02460010
024700 01  PS-DB2-ERROR-INDICATOR        PIC X(1)  VALUE 'N'.           02470010
024800     88  PS-DB2-ERROR                        VALUE 'Y'.           02480010
024900     88  PS-NO-DB2-ERROR                     VALUE 'N'.           02490010
025000 01  PS-USER-INPUT                 PIC X(1)  VALUE 'N'.           02500010
025100     88  PS-USER-INPUT-VALID                 VALUE 'Y'.           02510010
025200     88  PS-USER-INPUT-NOT-VALID             VALUE 'N'.           02520010
025300 01  PS-PKEY                       PIC X(1)  VALUE 'N'.           02530010
025400     88  PS-PKEY-DEFINED                     VALUE 'Y'.           02540010
025500     88  PS-PKEY-NOT-DEFINED                 VALUE 'N'.           02550010
025600 01  PS-KEY-COLUMN-SELECT          PIC X(1)  VALUE 'N'.           02560010
025700     88  PS-KEY-COLUMN-SELECTED              VALUE 'Y'.           02570010
025800     88  PS-KEY-COLUMN-NOT-SELECTED          VALUE 'N'.           02580010
025900 01  PS-PROCS-SW                   PIC X(1)  VALUE 'Y'.           02590010
026000     88  MORE-PROCS                          VALUE 'Y'.           02600010
026100     88  NO-MORE-PROCS                       VALUE 'N'.           02610010
026200 01  PS-PLANS-SW                   PIC X(1)  VALUE 'Y'.           02620010
026300     88  MORE-PLANS                          VALUE 'Y'.           02630010
026400     88  NO-MORE-PLANS                       VALUE 'N'.           02640010
026500                                                                  02650010
026600**                                                                02660010
026700 01  PROGRAM-CONSTANTS.                                           02670010
026710     05  PC-CURRENT-PROGRAM-NAME   PIC X(08)  VALUE 'DBKDM002'.   02671017
026720     05  PC-BROWSE-DDNAME          PIC X(08)  VALUE 'PDEPDATA'.   02672019
026730     05  PC-BROWSE-DSNAME-SUFFIX   PIC X(05)  VALUE '.PDEP'.      02673019
026800     05  PC-MAX-RETRIES            PIC S9(3)  VALUE +3            02680010
026900                                              COMP-3.             02690010
027000     05  PC-COMMIT-MAX             PIC S9(3)  VALUE +49           02700010
027100                                              COMP-3.             02710010
027200*                                                                 02720010
027300 01  COMMON-NAMELIST.                                             02730010
028000     05  NAM-ZTEMPF      PIC X(08)     VALUE 'ZTEMPF'.            02800010
028100     05  NAM-SMSG        PIC X(08)     VALUE 'SMSG'.              02810010
028200     05  NAM-LMSG        PIC X(08)     VALUE 'LMSG'.              02820010
028300*                                                                 02830010
028400***  DEFINE DIALOG VARIABLE NAMES FOR DIALOG SERVICE CALLS.       02840010
028500*                                                                 02850010
028600 01  NAM-CMNEKTAB        PIC X(08)     VALUE 'CMNEKTAB'.          02860010
028610 01  NAM-CMNEKTB2        PIC X(08)     VALUE 'CMNEKTB2'.          02861025
028620 01  NAM-CMNEKTB3        PIC X(08)     VALUE 'CMNEKTB3'.          02862025
028700 01  NAM-CMNEKCRE        PIC X(08)     VALUE 'CMNEKCRE'.          02870010
030700*                                                                 03070010
030800***                                                               03080010
030900************************************************************      03090010
031000*    SYSIBM.SYSTABLES     DCLGEN                           *      03100010
031100************************************************************      03110010
031200     EXEC SQL                                                     03120010
031300         INCLUDE SYSTABLE                                         03130010
031400     END-EXEC.                                                    03140010
031500*                                                                 03150010
031600***                                                               03160010
031700*                                                                 03170010
031800***                                                               03180010
031900************************************************************      03190010
032000*    SYSIBM.SYSTABAUTH    DCLGEN                           *      03200010
032100************************************************************      03210010
032200     EXEC SQL                                                     03220010
032300         INCLUDE SYSTABAU                                         03230010
032400     END-EXEC.                                                    03240010
032500*                                                                 03250010
032600***                                                               03260010
032700************************************************************      03270010
032800*    SYSIBM.SYSPACKLIST   DCLGEN                           *      03280010
032900************************************************************      03290010
033000     EXEC SQL                                                     03300010
033100         INCLUDE SYSPACKL                                         03310010
033200     END-EXEC.                                                    03320010
033300*                                                                 03330010
033400***                                                               03340010
033500************************************************************      03350010
033600*    TP1PROST             DCLGEN                           *      03360010
033700************************************************************      03370010
033800     EXEC SQL                                                     03380010
033900         INCLUDE TP1PROST                                         03390010
034000     END-EXEC.                                                    03400010
034100*                                                                 03410010
034200***                                                               03420010
034300************************************************************      03430010
034400*    DECLARE SYSAUTH_CURSOR CURSOR                         *      03440010
034500************************************************************      03450010
034600*                                                                 03460010
034700     EXEC SQL                                                     03470010
034800      DECLARE SYSAUTH_CURSOR CURSOR FOR                           03480010
034900      SELECT                                                      03490010
035000                GRANTEE                                           03500010
035100               ,COLLID                                            03510010
035200               ,SELECTAUTH                                        03520010
035300               ,INSERTAUTH                                        03530010
035400               ,UPDATEAUTH                                        03540010
035500               ,DELETEAUTH                                        03550010
035600      FROM      SYSIBM.SYSTABAUTH                                 03560010
035700      WHERE     TTNAME      = :VAR-128-TABLE-NAME                 03570025
035800      AND       TCREATOR    = :VAR-CMNEKCRE                       03580010
035900      AND       GRANTEETYPE = 'P'                                 03590010
036000      ORDER BY  GRANTEE, COLLID                                   03600010
036100                                                                  03610010
036200   END-EXEC.                                                      03620010
036300     EJECT                                                        03630010
036400************************************************************      03640010
036500*    DECLARE SYSPKLS_CURSOR CURSOR                         *      03650010
036600************************************************************      03660010
036700*                                                                 03670010
036800     EXEC SQL                                                     03680010
036900      DECLARE SYSPKLS_CURSOR CURSOR FOR                           03690010
037000      SELECT                                                      03700010
037100                PLANNAME                                          03710010
037200      FROM      SYSIBM.SYSPACKLIST                                03720010
037300      WHERE     COLLID    = :HOLD-COLLID                          03730010
037400      AND      (NAME      = '*'                                   03740010
037500      OR        NAME      = :HOLD-GRANTEE)                        03750010
037600   END-EXEC.                                                      03760010
037700     EJECT                                                        03770010
037800************************************************************      03780010
037900*    DECLARE TP1PROST_CURSOR CURSOR                        *      03790010
038000************************************************************      03800010
038100*                                                                 03810010
038200     EXEC SQL                                                     03820010
038300      DECLARE TP1PROST_CURSOR CURSOR FOR                          03830010
038400      SELECT                                                      03840010
038500                PROC_NAME                                         03850010
038600      FROM      TP1PROST                                          03860010
038700      WHERE     PGM_NAME  = :HOLD-GRANTEE                         03870010
038800   END-EXEC.                                                      03880010
038900                                                                  03890015
041300************************************************************      04130010
041400*    SQL COMMUNICATIONS AREA DCLGEN                        *      04140010
041500************************************************************      04150010
041600*                                                                 04160010
041700     EXEC SQL                                                     04170010
041800         INCLUDE SQLCA                                            04180010
041900     END-EXEC.                                                    04190010
042000*                                                                 04200010
042100*                                                                 04210010
042200 PROCEDURE DIVISION.                                              04220010
042300                                                                  04230010
042400************************************************************      04240010
042500*    VDEFINES FOR PANEL                                    *      04250010
042600************************************************************      04260010
042700     MOVE LENGTH OF VAR-ZTEMPF TO PV-FIELD-LENGTH.                04270023
042800     CALL 'ISPLINK' USING ISP-VDEFINE NAM-ZTEMPF VAR-ZTEMPF       04280023
042900                          ISP-FORMAT PV-FIELD-LENGTH.             04290023
043000     MOVE LENGTH OF VAR-SMSG TO PV-FIELD-LENGTH.                  04300023
043100     CALL 'ISPLINK' USING ISP-VDEFINE NAM-SMSG VAR-SMSG           04310023
043200                          ISP-FORMAT PV-FIELD-LENGTH.             04320023
043300     MOVE LENGTH OF VAR-LMSG TO PV-FIELD-LENGTH.                  04330023
043400     CALL 'ISPLINK' USING ISP-VDEFINE NAM-LMSG VAR-LMSG           04340023
043500                          ISP-FORMAT PV-FIELD-LENGTH.             04350023
043600     MOVE LENGTH OF VAR-CMNEKTAB TO PV-FIELD-LENGTH.              04360023
043700     CALL 'ISPLINK' USING ISP-VDEFINE                             04370023
043800         NAM-CMNEKTAB  VAR-CMNEKTAB  CHAR  PV-FIELD-LENGTH.       04380023
043810     MOVE LENGTH OF VAR-CMNEKTB2 TO PV-FIELD-LENGTH.              04381025
043820     CALL 'ISPLINK' USING ISP-VDEFINE                             04382025
043830         NAM-CMNEKTB2  VAR-CMNEKTB2  CHAR  PV-FIELD-LENGTH.       04383025
043840     MOVE LENGTH OF VAR-CMNEKTB3 TO PV-FIELD-LENGTH.              04384025
043850     CALL 'ISPLINK' USING ISP-VDEFINE                             04385025
043860         NAM-CMNEKTB3  VAR-CMNEKTB3  CHAR  PV-FIELD-LENGTH.       04386025
043900     MOVE LENGTH OF VAR-CMNEKCRE TO PV-FIELD-LENGTH.              04390023
044000     CALL 'ISPLINK' USING ISP-VDEFINE                             04400023
044010         NAM-CMNEKCRE  VAR-CMNEKCRE  CHAR  PV-FIELD-LENGTH.       04401023
044100                                                                  04410010
044200************************************************************      04420010
044300*    VGETS FROM PROFILES                                   *      04430010
044400************************************************************      04440010
044500                                                                  04450010
044600     CALL 'ISPLINK' USING ISP-VGET NAM-ZTEMPF ISP-SHARED.         04460010
044700     MOVE SPACES TO ISP-MSG.                                      04470010
044710                                                                  04471013
044800     INSPECT VAR-ZTEMPF TALLYING PV-COUNTR FOR CHARACTERS         04480013
044900                 BEFORE INITIAL '.CNTL'.                          04490013
044910     MOVE VAR-ZTEMPF (1:PV-COUNTR)  TO PV-BROWSE-DSNAME.          04491019
044920     ADD 1 TO PV-COUNTR.                                          04492013
044930     MOVE PC-BROWSE-DSNAME-SUFFIX TO                              04493018
044940               PV-BROWSE-DSNAME (PV-COUNTR:5).                    04494020
045000                                                                  04500010
045100     PERFORM 1700-DISPLAY-PANEL THRU 1700-EXIT UNTIL              04510010
045200          RETURN-CODE NOT = 0.                                    04520010
045300                                                                  04530010
045400     IF PS-IS-ALLOCATED                                           04540013
045500         PERFORM 9100-DELETE-FILE                                 04550013
045510     END-IF.                                                      04551013
045600                                                                  04560010
045700     GOBACK.                                                      04570010
045800                                                                  04580010
045900************************************************************      04590010
046000*    DISPLAY THE PANEL                                     *      04600010
046100************************************************************      04610010
046200*                                                                 04620010
046300 1700-DISPLAY-PANEL.                                              04630010
046400                                                                  04640010
046500     MOVE 'CMNEKCRE' TO ISP-CSR.                                  04650032
046600     MOVE 'CMNEKR6' TO ISP-PANEL.                                 04660010
046700     CALL 'ISPLINK' USING ISP-DISPLAY,                            04670010
046800                          ISP-PANEL,                              04680010
046900                          ISP-MSG,                                04690010
047000                          ISP-CSR.                                04700010
047100                                                                  04710010
047200     MOVE SPACES TO ISP-MSG.                                      04720010
047300     MOVE SPACES TO VAR-SMSG.                                     04730010
047400     MOVE SPACES TO VAR-LMSG.                                     04740010
047500                                                                  04750010
047600     IF RETURN-CODE NOT = 0                                       04760010
047700         GO TO 1700-EXIT.                                         04770010
047800                                                                  04780010
047900     PERFORM 2100-EDIT-INPUT THRU 2100-EXIT.                      04790010
048000     IF PS-USER-INPUT-NOT-VALID                                   04800010
048100         GO TO 1700-EXIT.                                         04810010
048200                                                                  04820010
048300     IF PS-IS-NOT-ALLOCATED                                       04830013
048310         PERFORM 3000-ALLOCATE-TEMP-FILE                          04831013
048320     END-IF.                                                      04832013
048400                                                                  04840010
048500     IF PS-IS-ALLOCATED                                           04850010
048600         OPEN OUTPUT BROWSE-FILE                                  04860010
048700         WRITE BROWSE-RECORD FROM REPORT-TITLE1                   04870010
048800         MOVE SPACES TO BROWSE-RECORD                             04880010
048900         WRITE BROWSE-RECORD                                      04890010
049000         PERFORM 4000-DB2-TABLE-FUNCTIONS                         04900010
049100             THRU 4000-EXIT                                       04910010
049200         CLOSE BROWSE-FILE                                        04920013
049210     END-IF.                                                      04921013
049300                                                                  04930010
049400     IF ((PS-IS-ALLOCATED)                                        04940013
049500             AND (PS-NO-DB2-ERROR))                               04950013
049510         PERFORM 8000-BROWSE-FILE                                 04951013
049520     END-IF.                                                      04952013
049600                                                                  04960010
049700 1700-EXIT.                                                       04970010
049800     EXIT.                                                        04980010
049900     EJECT                                                        04990010
050000************************************************************      05000010
050100* SET SWITCHES TO INDICATE WHAT OPTION HAS BEEN SPECIFIED  *      05010010
050200* BY THE USER                                              *      05020010
050300************************************************************      05030010
050400 2100-EDIT-INPUT.                                                 05040010
050500                                                                  05050010
050600     SET PS-NOT-EOF-PRINT TO TRUE.                                05060010
050700     SET PS-NO-DB2-ERROR TO TRUE.                                 05070010
050800     MOVE 'Y' TO PS-USER-INPUT.                                   05080010
050900                                                                  05090010
050910     IF (VAR-CMNEKTAB = SPACES  AND                               05091025
050920         VAR-CMNEKTB2 = SPACES  AND                               05092025
050930         VAR-CMNEKTB3 = SPACES) OR                                05093025
050940        VAR-CMNEKCRE = SPACES                                     05094025
050950          MOVE 'N' TO PS-USER-INPUT                               05095025
050960          MOVE 'SPECIFY REQUIRED PARM' TO VAR-SMSG                05096025
050970          MOVE                                                    05097025
050971          'SUPPLY THE NAME OF THE DB2 TABLE AND ITS CREATOR'      05097125
050972              TO VAR-LMSG                                         05097225
050980          MOVE 'CMN000  ' TO ISP-MSG                              05098025
050981          GO TO 2100-EXIT                                         05098125
050990     ELSE                                                         05099025
050991         MOVE 'Y' TO PS-USER-INPUT                                05099125
050992         IF VAR-CMNEKTB2 NOT = SPACES                             05099225
050993             STRING VAR-CMNEKTAB        DELIMITED BY ' ',         05099325
050994                    VAR-CMNEKTB2        DELIMITED BY ' '          05099425
050995                 INTO VAR-128-TABLE-NAME                          05099525
050996             IF VAR-CMNEKTB3 NOT = SPACES                         05099625
050997                 STRING VAR-128-TABLE-NAME  DELIMITED BY ' '      05099725
050998                        VAR-CMNEKTB3        DELIMITED BY ' '      05099825
050999                     INTO VAR-128-TABLE-NAME                      05099925
051000             END-IF                                               05100025
051001         ELSE                                                     05100125
051002             IF VAR-CMNEKTB3 NOT = SPACES                         05100225
051003                 STRING VAR-CMNEKTAB        DELIMITED BY ' ',     05100325
051004                        VAR-CMNEKTB3        DELIMITED BY ' '      05100425
051005                     INTO VAR-128-TABLE-NAME                      05100525
051006             ELSE                                                 05100625
051007                 MOVE VAR-CMNEKTAB   TO VAR-128-TABLE-NAME        05100725
051008             END-IF                                               05100831
051009         END-IF                                                   05100931
051010     END-IF.                                                      05101031
052000                                                                  05200010
052100     EXEC SQL                                                     05210010
052200       SELECT    '1'                                              05220010
052300         INTO                                                     05230010
052400            :SQL-FILLER                                           05240010
052500       FROM      SYSIBM.SYSTABLES                                 05250010
052600       WHERE     NAME    = :VAR-128-TABLE-NAME                    05260025
052700       AND       CREATOR = :VAR-CMNEKCRE                          05270010
052800     END-EXEC.                                                    05280010
052900     IF SQLCODE = ZERO                                            05290010
053000         GO TO 2100-EXIT.                                         05300010
053100     IF SQLCODE = +100                                            05310010
053200         MOVE 'TABLE NOT FOUND' TO VAR-SMSG                       05320010
053300          MOVE 'N' TO PS-USER-INPUT                               05330010
053400       ELSE                                                       05340010
053500          MOVE 'N' TO PS-USER-INPUT                               05350010
053600         MOVE 'SQLCODE = ' TO VAR-SMSG-FILLER                     05360010
053700         MOVE SQLCODE TO VAR-SMSG-SQLCODE                         05370010
053800         MOVE '2100-EDIT-INPUT ABEND, CONTACT DATA RESOURCE'      05380010
053900             TO VAR-LMSG.                                         05390010
054000     MOVE 'CMN000  ' TO ISP-MSG .                                 05400010
054100     SET  PS-DB2-ERROR TO TRUE.                                   05410010
054200 2100-EXIT.                                                       05420010
054300     EXIT.                                                        05430010
054400     EJECT                                                        05440010
054500************************************************************      05450010
054600* USE DYNALLOC TO ALLOCATE TEMP FILE THAT WILL BE DISPLAYED*      05460010
054700************************************************************      05470010
054800 3000-ALLOCATE-TEMP-FILE.                                         05480013
054900     PERFORM 9100-DELETE-FILE.                                    05490013
055000                                                                  05500013
055100     IF ((DP023-LASTRC = ZERO)                                    05510013
055200             OR (DP023-LASTRC = DP023-RC-DATASET-DOESNT-EXIST))   05520013
055300         INITIALIZE DP023-DYNALC-PARMS                            05530013
055400         MOVE PC-BROWSE-DDNAME TO DP023-DDNAME                    05540019
055500         MOVE PV-BROWSE-DSNAME TO DP023-DSNAME                    05550019
055600         SET DP023-DISP-NEW TO TRUE                               05560013
055700         SET DP023-FREE-CLOSE-NO TO TRUE                          05570013
055800         SET DP023-RECFM-FIXED-BLOCK TO TRUE                      05580013
055900         MOVE LENGTH OF BROWSE-RECORD TO DP023-RECSZ              05590024
056000         MOVE 2000 TO DP023-RECOUNT                               05600013
056100                                                                  05610013
056200         SET DP023-DISABLE-DISPLAY-ABEND TO TRUE                  05620013
056300                                                                  05630013
056400         PERFORM DP023-0000-DYNALC                                05640013
056500         IF DP023-LASTRC = ZERO                                   05650013
056600             SET PS-IS-ALLOCATED TO TRUE                          05660013
056700         ELSE                                                     05670013
056800             SET PS-IS-NOT-ALLOCATED TO TRUE                      05680013
056900             MOVE DP023-DDNAME TO PV-DR-DDNAME                    05690013
057000             MOVE DP023-RC (DP023-SUB) TO PV-DR-RETURN-CODE       05700013
057100             MOVE DP023-DESC (DP023-SUB) TO PV-DR-ERROR-DESC      05710013
057200             MOVE PV-DYNALC-ROUTINE-ERROR-MSG TO VAR-LMSG         05720013
057300             MOVE 'CMN000  ' TO ISP-MSG                           05730013
057400         END-IF                                                   05740013
057500     ELSE                                                         05750013
057600         SET PS-IS-NOT-ALLOCATED TO TRUE                          05760013
057700         MOVE DP023-DDNAME TO PV-DR-DDNAME                        05770013
057800         MOVE DP023-RC (DP023-SUB) TO PV-DR-RETURN-CODE           05780013
057900         MOVE DP023-DESC (DP023-SUB) TO PV-DR-ERROR-DESC          05790013
058000         MOVE PV-DYNALC-ROUTINE-ERROR-MSG TO VAR-LMSG             05800013
058100         MOVE 'CMN000  ' TO ISP-MSG                               05810013
058200     END-IF.                                                      05820013
058300                                                                  05830013
059600************************************************************      05960010
059700* MAIN-LINE LOGIC                                          *      05970010
059800************************************************************      05980010
059900 4000-DB2-TABLE-FUNCTIONS.                                        05990010
060000                                                                  06000010
060100     PERFORM 4200-OPEN-SYSTBAUTH-CURSOR                           06010010
060200         THRU 4200-EXIT.                                          06020010
060300     IF PS-DB2-ERROR                                              06030010
060400         GO TO 4000-EXIT.                                         06040010
060500                                                                  06050010
060600     MOVE 'N' TO PS-PKEY.                                         06060010
060700     MOVE VAR-128-TABLE-NAME (1:64) TO TITLE-TABLE1.              06070027
060900     WRITE BROWSE-RECORD FROM REPORT-TITLE2.                      06090010
061000     MOVE SPACES TO BROWSE-RECORD.                                06100010
061001     MOVE VAR-128-TABLE-NAME (65:64) TO TITLE-TABLE2.             06100128
061010     WRITE BROWSE-RECORD FROM REPORT-TITLE3.                      06101027
061011     MOVE SPACES TO BROWSE-RECORD.                                06101127
061012     MOVE VAR-CMNEKCRE TO TITLE-CREATOR.                          06101227
061013     WRITE BROWSE-RECORD FROM REPORT-TITLE4.                      06101327
061020     MOVE SPACES TO BROWSE-RECORD.                                06102027
061100     WRITE BROWSE-RECORD.                                         06110010
061200                                                                  06120010
061300     WRITE BROWSE-RECORD FROM REPORT-LINE-HDR1.                   06130010
061400     WRITE BROWSE-RECORD FROM REPORT-LINE-HDR2.                   06140010
061500                                                                  06150010
061600     PERFORM 4300-FETCH-SYSTBAUTH THRU 4300-EXIT                  06160010
061700         UNTIL SQLCODE NOT = ZERO.                                06170010
061800     IF PS-DB2-ERROR                                              06180010
061900         GO TO 4000-EXIT.                                         06190010
062000                                                                  06200010
062100     PERFORM 4400-CLOSE-SYSTBAUTH-CURSOR                          06210010
062200         THRU 4400-EXIT.                                          06220010
062300                                                                  06230010
062400 4000-EXIT.                                                       06240010
062500     EXIT.                                                        06250010
062600     EJECT                                                        06260010
062700************************************************************      06270010
062800* OPEN SYSTBAUTH_CURSOR CURSOR                             *      06280010
062900************************************************************      06290010
063000 4200-OPEN-SYSTBAUTH-CURSOR.                                      06300010
063100                                                                  06310010
063200      EXEC SQL                                                    06320010
063300          OPEN SYSAUTH_CURSOR                                     06330010
063400      END-EXEC.                                                   06340010
063500                                                                  06350010
063600      IF SQLCODE NOT = 0                                          06360010
063700          SET PS-DB2-ERROR TO TRUE                                06370010
063800          MOVE 'SQLCODE =' TO VAR-SMSG-FILLER                     06380010
063900          MOVE SQLCODE TO VAR-SMSG-SQLCODE                        06390010
064000          MOVE '4200-OPEN CURSOR ABEND, CONTACT DATA RESOURCE'    06400010
064100               TO VAR-LMSG                                        06410010
064200          MOVE 'CMN000  ' TO ISP-MSG.                             06420010
064300                                                                  06430010
064400 4200-EXIT.                                                       06440010
064500     EXIT.                                                        06450010
064600     EJECT                                                        06460010
064700************************************************************      06470010
064800* FETCH THE ROWS FROM SYSIBM.SYSCOLUMNS                    *      06480010
064900************************************************************      06490010
065000 4300-FETCH-SYSTBAUTH.                                            06500010
065100                                                                  06510010
065200     INITIALIZE DCLSYSTABAUTH.                                    06520010
065300                                                                  06530010
065400     EXEC SQL                                                     06540010
065500         FETCH SYSAUTH_CURSOR                                     06550010
065600         INTO                                                     06560010
065700               :SYSTABAU-GRANTEE                                  06570010
065800              ,:SYSTABAU-COLLID                                   06580010
065900              ,:SYSTABAU-SELECTAUTH                               06590010
066000              ,:SYSTABAU-INSERTAUTH                               06600010
066100              ,:SYSTABAU-UPDATEAUTH                               06610010
066200              ,:SYSTABAU-DELETEAUTH                               06620010
066300     END-EXEC.                                                    06630010
066400                                                                  06640010
066500     IF SQLCODE = ZERO                                            06650010
066600         PERFORM 4310-CREATE-RPT THRU 4310-EXIT                   06660010
066700         GO TO 4300-EXIT.                                         06670010
066800     IF SQLCODE NOT = +100                                        06680010
066900         PERFORM 4400-CLOSE-SYSTBAUTH-CURSOR THRU 4400-EXIT       06690010
067000         SET PS-DB2-ERROR TO TRUE                                 06700010
067100         MOVE 'SQLCODE =' TO VAR-SMSG-FILLER                      06710010
067200         MOVE SQLCODE TO VAR-SMSG-SQLCODE                         06720010
067300         MOVE                                                     06730010
067400         '4300-FETCH-SYSCOLUMNS ABEND, CONTACT DATA RESOURCE'     06740010
067500             TO VAR-LMSG                                          06750010
067600         MOVE 'CMN000  ' TO ISP-MSG.                              06760010
067700                                                                  06770010
067800  4300-EXIT.                                                      06780010
067900     EXIT.                                                        06790010
068000     EJECT                                                        06800010
068100************************************************************      06810010
068200* CREATE REPORT                                            *      06820010
068300************************************************************      06830010
068400 4310-CREATE-RPT.                                                 06840010
068500                                                                  06850010
068600     MOVE SPACES TO BROWSE-RECORD.                                06860010
068700     WRITE BROWSE-RECORD.                                         06870010
068800                                                                  06880010
068900     MOVE 'Y' TO PS-PROCS-SW                                      06890010
069000                 PS-PLANS-SW.                                     06900010
069100                                                                  06910010
069200     MOVE ZEROS TO HOLD-PROCNUM.                                  06920010
069300                                                                  06930010
069400     MOVE SPACES TO REPORT-LINE-DTL.                              06940010
069500                                                                  06950010
069600     IF SYSTABAU-COLLID-TEXT = SPACES                             06960026
069700         MOVE SYSTABAU-GRANTEE-TEXT TO RL-PLAN                    06970026
069800         MOVE SPACES TO RL-PACKAGE                                06980010
069900                        RL-COLLID                                 06990010
070000         MOVE 'N' TO PS-PLANS-SW                                  07000010
070100     ELSE                                                         07010010
070200         MOVE SYSTABAU-GRANTEE-TEXT TO RL-PACKAGE                 07020026
070300         MOVE SYSTABAU-COLLID-TEXT TO RL-COLLID                   07030026
070400     END-IF.                                                      07040010
070500                                                                  07050010
070600     PERFORM 4320-GET-FUNCTION THRU 4320-EXIT.                    07060010
070700                                                                  07070010
070800     MOVE SYSTABAU-GRANTEE-TEXT TO HOLD-GRANTEE.                  07080026
070900                                                                  07090010
071000     IF SYSTABAU-COLLID-TEXT > SPACES                             07100026
071100         MOVE SYSTABAU-COLLID-TEXT TO HOLD-COLLID                 07110026
071200         PERFORM 5200-OPEN-SYSPKLS-CURSOR                         07120010
071300            THRU 5200-EXIT                                        07130010
071400         IF PS-DB2-ERROR                                          07140010
071500             GO TO 4310-EXIT                                      07150010
071600         END-IF                                                   07160010
071700                                                                  07170010
071800         PERFORM 5300-FETCH-SYSPKLS THRU 5300-EXIT                07180010
071900         IF PS-DB2-ERROR                                          07190010
072000             GO TO 4310-EXIT                                      07200010
072100         END-IF                                                   07210010
072200     END-IF.                                                      07220010
072300                                                                  07230010
072400     PERFORM 6200-OPEN-TP1PROST-CURSOR                            07240010
072500         THRU 6200-EXIT.                                          07250010
072600     IF PS-DB2-ERROR                                              07260010
072700         GO TO 4310-EXIT.                                         07270010
072800                                                                  07280010
072900     PERFORM 6300-FETCH-TP1PROST THRU 6300-EXIT.                  07290010
073000     IF PS-DB2-ERROR                                              07300010
073100         GO TO 4310-EXIT                                          07310010
073200     END-IF.                                                      07320010
073300                                                                  07330010
073400     WRITE BROWSE-RECORD FROM REPORT-LINE-DTL.                    07340010
073500     MOVE SPACES TO REPORT-LINE-DTL.                              07350010
073600                                                                  07360010
073700     PERFORM UNTIL NO-MORE-PLANS AND NO-MORE-PROCS                07370010
073800         IF MORE-PLANS                                            07380010
073900             PERFORM 5300-FETCH-SYSPKLS THRU 5300-EXIT            07390010
074000             IF PS-DB2-ERROR                                      07400010
074100                 GO TO 4310-EXIT                                  07410010
074200             END-IF                                               07420010
074300         END-IF                                                   07430010
074400                                                                  07440010
074500         IF MORE-PROCS                                            07450010
074600            PERFORM 6300-FETCH-TP1PROST THRU 6300-EXIT            07460010
074700            IF PS-DB2-ERROR                                       07470010
074800                GO TO 4310-EXIT                                   07480010
074900             END-IF                                               07490010
075000         END-IF                                                   07500010
075100                                                                  07510010
075200         IF MORE-PLANS OR MORE-PROCS                              07520010
075300             WRITE BROWSE-RECORD FROM REPORT-LINE-DTL             07530010
075400         END-IF                                                   07540010
075500                                                                  07550010
075600     END-PERFORM.                                                 07560010
075700                                                                  07570010
075800     IF SYSTABAU-COLLID-TEXT > SPACES                             07580026
075900         PERFORM 5400-CLOSE-SYSPKLS-CURSOR                        07590010
076000             THRU 5400-EXIT                                       07600010
076100         IF PS-DB2-ERROR                                          07610010
076200             GO TO 4310-EXIT                                      07620010
076300         END-IF                                                   07630010
076400     END-IF.                                                      07640010
076500                                                                  07650010
076600     PERFORM 6400-CLOSE-TP1PROST-CURSOR                           07660010
076700         THRU 6400-EXIT.                                          07670010
076800  4310-EXIT.                                                      07680010
076900     EXIT.                                                        07690010
077000     EJECT                                                        07700010
077100************************************************************      07710010
077200* GET FUNCTION (PRIVILEGES)                                *      07720010
077300************************************************************      07730010
077400 4320-GET-FUNCTION.                                               07740010
077500     MOVE 1 TO HOLD-SUBSCRIPT.                                    07750010
077600     IF SYSTABAU-SELECTAUTH NOT = SPACES                          07760010
077700         MOVE 'SELECT     ' TO RL-FUNCTION (HOLD-SUBSCRIPT)       07770010
077800         ADD 1 TO HOLD-SUBSCRIPT.                                 07780010
077900     IF SYSTABAU-INSERTAUTH NOT = SPACES                          07790010
078000         IF HOLD-SUBSCRIPT > 1                                    07800010
078100             MOVE ','       TO RL-DELIMIT  (HOLD-SUBSCRIPT)       07810010
078200         END-IF                                                   07820010
078300         MOVE 'INSERT     ' TO RL-FUNCTION (HOLD-SUBSCRIPT)       07830010
078400         ADD 1 TO HOLD-SUBSCRIPT.                                 07840010
078500     IF SYSTABAU-UPDATEAUTH NOT = SPACES                          07850010
078600         IF HOLD-SUBSCRIPT > 1                                    07860010
078700             MOVE ','       TO RL-DELIMIT  (HOLD-SUBSCRIPT)       07870010
078800         END-IF                                                   07880010
078900         MOVE 'UPDATE     ' TO RL-FUNCTION (HOLD-SUBSCRIPT)       07890010
079000         ADD 1 TO HOLD-SUBSCRIPT.                                 07900010
079100     IF SYSTABAU-DELETEAUTH NOT = SPACES                          07910010
079200         IF HOLD-SUBSCRIPT > 1                                    07920010
079300             MOVE ','       TO RL-DELIMIT  (HOLD-SUBSCRIPT)       07930010
079400         END-IF                                                   07940010
079500         MOVE 'DELETE     ' TO RL-FUNCTION (HOLD-SUBSCRIPT).      07950010
079600                                                                  07960010
079700  4320-EXIT.                                                      07970010
079800     EXIT.                                                        07980010
079900     EJECT                                                        07990010
080000************************************************************      08000010
080100* CLOSE SYSTBAUTH_CURSOR                                  *       08010010
080200************************************************************      08020010
080300 4400-CLOSE-SYSTBAUTH-CURSOR.                                     08030010
080400                                                                  08040010
080500     EXEC SQL                                                     08050010
080600         CLOSE SYSAUTH_CURSOR                                     08060010
080700     END-EXEC.                                                    08070010
080800                                                                  08080010
080900     IF SQLCODE NOT = ZERO                                        08090010
081000         SET PS-DB2-ERROR TO TRUE                                 08100010
081100         MOVE 'SQLCODE =' TO VAR-SMSG-FILLER                      08110010
081200         MOVE SQLCODE TO VAR-SMSG-SQLCODE                         08120010
081300         MOVE '4400-CLOSE CURSOR ABEND, CONTACT DATA RESOURCE'    08130010
081400              TO VAR-LMSG                                         08140010
081500         MOVE 'CMN000  ' TO ISP-MSG.                              08150010
081600*                                                                 08160010
081700 4400-EXIT.                                                       08170010
081800     EXIT.                                                        08180010
081900     EJECT                                                        08190010
082000************************************************************      08200010
082100* OPEN SYSPKLS_CURSOR CURSOR                               *      08210010
082200************************************************************      08220010
082300 5200-OPEN-SYSPKLS-CURSOR.                                        08230010
082400                                                                  08240010
082500      EXEC SQL                                                    08250010
082600          OPEN SYSPKLS_CURSOR                                     08260010
082700      END-EXEC.                                                   08270010
082800                                                                  08280010
082900      IF SQLCODE NOT = 0                                          08290010
083000          SET PS-DB2-ERROR TO TRUE                                08300010
083100          MOVE 'SQLCODE =' TO VAR-SMSG-FILLER                     08310010
083200          MOVE SQLCODE TO VAR-SMSG-SQLCODE                        08320010
083300          MOVE '5200-OPEN CURSOR ABEND, CONTACT DATA RESOURCE'    08330010
083400               TO VAR-LMSG                                        08340010
083500          MOVE 'CMN000  ' TO ISP-MSG.                             08350010
083600                                                                  08360010
083700 5200-EXIT.                                                       08370010
083800     EXIT.                                                        08380010
083900     EJECT                                                        08390010
084000************************************************************      08400010
084100* FETCH THE ROWS FROM SYSIBM.SYSPACKLIST                   *      08410010
084200************************************************************      08420010
084300 5300-FETCH-SYSPKLS.                                              08430010
084400                                                                  08440010
084500     INITIALIZE DCLSYSPACKLIST.                                   08450010
084600                                                                  08460010
084700     EXEC SQL                                                     08470010
084800         FETCH SYSPKLS_CURSOR                                     08480010
084900         INTO                                                     08490010
085000               :SYSPACKL-PLANNAME                                 08500010
085100     END-EXEC.                                                    08510010
085200                                                                  08520010
085300     IF SQLCODE = ZERO                                            08530010
085400         MOVE SYSPACKL-PLANNAME-TEXT TO RL-PLAN                   08540026
085500         GO TO 5300-EXIT.                                         08550010
085600     IF SQLCODE = +100                                            08560010
085700         MOVE SPACES TO RL-PLAN                                   08570010
085800         MOVE 'N' TO PS-PLANS-SW                                  08580010
085900         GO TO 5300-EXIT.                                         08590010
086000     IF SQLCODE NOT = +100                                        08600010
086100         SET PS-DB2-ERROR TO TRUE                                 08610010
086200         MOVE 'SQLCODE =' TO VAR-SMSG-FILLER                      08620010
086300         MOVE SQLCODE TO VAR-SMSG-SQLCODE                         08630010
086400         MOVE                                                     08640010
086500         '5300-FETCH-SYSPKLS ABEND, CONTACT DATA RESOURCE'        08650010
086600             TO VAR-LMSG                                          08660010
086700         MOVE 'CMN000  ' TO ISP-MSG.                              08670010
086800                                                                  08680010
086900  5300-EXIT.                                                      08690010
087000     EXIT.                                                        08700010
087100     EJECT                                                        08710010
087200************************************************************      08720010
087300* CLOSE SYSPKLS_CURSOR                                     *      08730010
087400************************************************************      08740010
087500 5400-CLOSE-SYSPKLS-CURSOR.                                       08750010
087600                                                                  08760010
087700     EXEC SQL                                                     08770010
087800         CLOSE SYSPKLS_CURSOR                                     08780010
087900     END-EXEC.                                                    08790010
088000                                                                  08800010
088100     IF SQLCODE NOT = ZERO                                        08810010
088200         SET PS-DB2-ERROR TO TRUE                                 08820010
088300         MOVE 'SQLCODE =' TO VAR-SMSG-FILLER                      08830010
088400         MOVE SQLCODE TO VAR-SMSG-SQLCODE                         08840010
088500         MOVE '5400-CLOSE CURSOR ABEND, CONTACT DATA RESOURCE'    08850010
088600              TO VAR-LMSG                                         08860010
088700         MOVE 'CMN000  ' TO ISP-MSG.                              08870010
088800*                                                                 08880010
088900 5400-EXIT.                                                       08890010
089000     EXIT.                                                        08900010
089100     EJECT                                                        08910010
089200************************************************************      08920010
089300* OPEN TP1PROST_CURSOR CURSOR                              *      08930010
089400************************************************************      08940010
089500 6200-OPEN-TP1PROST-CURSOR.                                       08950010
089600                                                                  08960010
089700      EXEC SQL                                                    08970010
089800          OPEN TP1PROST_CURSOR                                    08980010
089900      END-EXEC.                                                   08990010
090000                                                                  09000010
090100      IF SQLCODE NOT = 0                                          09010010
090200          SET PS-DB2-ERROR TO TRUE                                09020010
090300          MOVE 'SQLCODE =' TO VAR-SMSG-FILLER                     09030010
090400          MOVE SQLCODE TO VAR-SMSG-SQLCODE                        09040010
090500          MOVE '6200-OPEN CURSOR ABEND, CONTACT DATA RESOURCE'    09050010
090600               TO VAR-LMSG                                        09060010
090700          MOVE 'CMN000  ' TO ISP-MSG.                             09070010
090800                                                                  09080010
090900 6200-EXIT.                                                       09090010
091000     EXIT.                                                        09100010
091100     EJECT                                                        09110010
091200************************************************************      09120010
091300* FETCH THE ROWS FROM TP1PROST                             *      09130010
091400************************************************************      09140010
091500 6300-FETCH-TP1PROST.                                             09150010
091600                                                                  09160010
091700     INITIALIZE DCLTP1PROST.                                      09170010
091800                                                                  09180010
091900     EXEC SQL                                                     09190010
092000         FETCH TP1PROST_CURSOR                                    09200010
092100         INTO                                                     09210010
092200               :TP1PROST-PROC-NAME                                09220010
092300     END-EXEC.                                                    09230010
092400                                                                  09240010
092500     IF SQLCODE = ZERO                                            09250010
092600         MOVE TP1PROST-PROC-NAME TO RL-PROC                       09260010
092700         MOVE 1 TO HOLD-PROCNUM                                   09270010
092800         GO TO 6300-EXIT.                                         09280010
092900     IF SQLCODE = +100                                            09290010
093000         MOVE 'N' TO PS-PROCS-SW                                  09300010
093100         IF HOLD-PROCNUM = ZERO                                   09310010
093200             MOVE 'NONE' TO RL-PROC                               09320010
093300         ELSE                                                     09330010
093400             MOVE SPACES TO RL-PROC                               09340010
093500         END-IF                                                   09350010
093600         GO TO 6300-EXIT.                                         09360010
093700     IF SQLCODE NOT = +100                                        09370010
093800         SET PS-DB2-ERROR TO TRUE                                 09380010
093900         MOVE 'SQLCODE =' TO VAR-SMSG-FILLER                      09390010
094000         MOVE SQLCODE TO VAR-SMSG-SQLCODE                         09400010
094100         MOVE                                                     09410010
094200         '6300-FETCH-TP1PROST ABEND, CONTACT DATA RESOURCE'       09420010
094300             TO VAR-LMSG                                          09430010
094400         MOVE 'CMN000  ' TO ISP-MSG.                              09440010
094500         MOVE 'NONE' TO RL-PROC.                                  09450010
094600                                                                  09460010
094700  6300-EXIT.                                                      09470010
094800     EXIT.                                                        09480010
094900     EJECT                                                        09490010
095000************************************************************      09500010
095100* CLOSE TP1PRQST_CURSOR                                     *     09510010
095200************************************************************      09520010
095300 6400-CLOSE-TP1PROST-CURSOR.                                      09530010
095400                                                                  09540010
095500     EXEC SQL                                                     09550010
095600         CLOSE TP1PROST_CURSOR                                    09560010
095700     END-EXEC.                                                    09570010
095800                                                                  09580010
095900     IF SQLCODE NOT = ZERO                                        09590010
096000         SET PS-DB2-ERROR TO TRUE                                 09600010
096100         MOVE 'SQLCODE =' TO VAR-SMSG-FILLER                      09610010
096200         MOVE SQLCODE TO VAR-SMSG-SQLCODE                         09620010
096300         MOVE '6400-CLOSE CURSOR ABEND, CONTACT DATA RESOURCE'    09630010
096400              TO VAR-LMSG                                         09640010
096500         MOVE 'CMN000  ' TO ISP-MSG.                              09650010
096600*                                                                 09660010
096700 6400-EXIT.                                                       09670010
096800     EXIT.                                                        09680010
096900     EJECT                                                        09690010
097000************************************************************      09700013
097100* DISPLAY BROWSE-FILE                                      *      09710013
097200************************************************************      09720013
097300 8000-BROWSE-FILE.                                                09730013
097400     MOVE ZERO TO PV-COUNTR.                                      09740013
097500     INSPECT PV-BROWSE-DSNAME TALLYING PV-COUNTR FOR              09750019
097600                 CHARACTERS BEFORE INITIAL '.'.                   09760013
097700     ADD 2 TO PV-COUNTR.                                          09770013
097800*BLJ MOVE PV-BROWSE-DSNAME (PV-COUNTR:13) TO VAR-DSNAME.          09780040
097800     MOVE PV-BROWSE-DSNAME (PV-COUNTR:21) TO VAR-DSNAME.          09781039
097900     MOVE 'CMNEKR6D' TO ISP-PANEL.                                09790013
098000     CALL 'ISPLINK' USING ISP-BROWSE,                             09800013
098100                          VAR-DSNAME,                             09810013
098200                          VAR-VOLUME,                             09820013
098300                          VAR-PASSWORD,                           09830013
098400                          ISP-PANEL.                              09840013
098500*                                                                 09850013
098600*  CALL THE COMMON PRINT REQUEST PANEL PROGRAM TO ALLOW THE OPTION09860013
098700*  OF PRINTING THE FILE THAT WAS JUST BROWSED.                    09870013
098800*                                                                 09880013
098900     INITIALIZE DP300-ISPF-PRINT-PARMS.                           09890013
099000     MOVE PC-CURRENT-PROGRAM-NAME TO                              09900013
099100               DP300-CALLING-PROGRAM-NAME.                        09910013
099200     MOVE 1 TO DP300-CALLING-REPORT-NUMBER.                       09920013
099300     MOVE PV-BROWSE-DSNAME TO DP300-FILE-DSNAME.                  09930019
099400     SET DP300-FR-FIXED-BLOCK TO TRUE.                            09940013
099500     MOVE 80 TO DP300-FILE-LRECL.                                 09950013
099600     SET DP300-PT-PRINT-TITLE-LINE                                09960013
099700         DP300-RH-REPEAT-HEADINGS TO TRUE.                        09970013
099800     MOVE 7 TO DP300-HEADING-LINE-COUNT.                          09980014
099900     CALL DP300-ISPF-PRINT-REQ-PROGRAM                            09990013
100000               USING DP300-ISPF-PRINT-PARMS.                      10000013
100100     MOVE 'CMN000  ' TO ISP-MSG                                   10010013
100200     MOVE DP300-ERROR-MESSAGE TO VAR-LMSG.                        10020013
100300     IF DP300-RI-PRINT-REQUESTED                                  10030013
100400         MOVE DP300-ERROR-MESSAGE TO VAR-SMSG                     10040013
100500     END-IF.                                                      10050013
100600                                                                  10060013
100700************************************************************      10070013
100800* DELETE BROWSE FILE                                       *      10080013
100900************************************************************      10090013
101000 9100-DELETE-FILE.                                                10100013
101100     INITIALIZE DP023-DYNALC-PARMS.                               10110013
101200     MOVE PC-BROWSE-DDNAME TO DP023-DDNAME.                       10120019
101300     MOVE PV-BROWSE-DSNAME TO DP023-DSNAME.                       10130019
101400     SET DP023-DISP-DELETE TO TRUE.                               10140013
101500     SET DP023-FREE-CLOSE-NO TO TRUE.                             10150013
101600     SET DP023-RECFM-FIXED-BLOCK TO TRUE.                         10160013
101610     MOVE LENGTH OF BROWSE-RECORD TO DP023-RECSZ.                 10161024
101800     MOVE ZEROES TO DP023-RECOUNT.                                10180024
101900                                                                  10190013
102000     SET DP023-DISABLE-DISPLAY-ABEND TO TRUE.                     10200013
102100                                                                  10210013
102200     PERFORM DP023-0000-DYNALC.                                   10220013
102300                                                                  10230013
102400     SET PS-IS-NOT-ALLOCATED TO TRUE.                             10240013
102500                                                                  10250013
102600*                                                                 10260013
102700*  DYNAMIC ALLOCATION ROUTINE                                     10270013
102800*                                                                 10280013
102900     COPY DPPD023.                                                10290013
