000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    CNKCS242.                                         00020001
000300 AUTHOR.        DENISE HAHN.                                      00030001
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040001
000500 DATE-WRITTEN.  JUNE, 2012.                                       00050001
000600 DATE-COMPILED.                                                   00060001
000700******************************************************************00070001
000800*  CICS         Y242 - AIR/LANDED VENDOR ADD                     *00080001
000900*  THIS PROGRAM ADD NEW AIR/LANDED VENDOR TO TRT_IMPRT_PRTNRFIL  *00090001
001000*  DCLGEN:  TRT00004                                             *00100001
001300******************************************************************00130001
263455* CHANGED 11/03/2021    BY JIM HUNTER      WR: CHG0263455         00131017
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00132017
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00133017
263455*----------------------------------------------------------------*00134017
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00135018
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00136018
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00137018
CICS  *-----------------------------------------------------------------00138018
001400 DATA DIVISION.                                                   00140001
001500 WORKING-STORAGE SECTION.                                         00150001
001600 01  PS-PROGRAM-SWITCHES.                                         00160001
001700     05  PS-ERROR-SW              PIC  X(01)  VALUE 'N'.          00170001
001800         88  PS-ERROR                         VALUE 'Y'.          00180001
001900         88  PS-NO-ERROR                      VALUE 'N'.          00190001
003800                                                                  00380001
003900 01  PC-PROGRAM-CONSTANTS.                                        00390001
004000     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE 'CN242A  '.   00400001
004100     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE 'CNKM242 '.   00410001
004200     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE 'CNKCS242'.   00420001
004300     05  PC-MAX-RETRIES           PIC S9(04)  VALUE +3 COMP.      00430001
004400     05  PC-MAX-LOCK-RETRIES      PIC S9(04)  VALUE +3 COMP.      00440001
004500     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE +1  COMP.     00450001
004600     05  PC-UPD-VSAM              PIC  X(01)  VALUE 'Y'.          00460001
004700     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       00470001
004800     05  PC-APPL-MAP              PIC S9(04)  VALUE +1 COMP.      00480001
004900                                                                  00490001
004910******************************************************************00491001
004911* 00007 - REQUIRED ENTRY (DP)                                     00491101
004912* 00008 - MUST BE NUMERIC (DP)                                    00491201
004913* 00045 - INVALID FUNCTION KEY (DP)                               00491301
004914* 00059 - UPDATE SUCCESSFUL                                       00491413
004926* 03551 - WEB SKU DC ATTRIBUTES NOT FOUND.                        00492601
004927* 03716 - INVALID ENTITY ID                                       00492703
004928* 03719 - ENTITY ID ALREADY EXISTS                                00492813
004930******************************************************************00493001
004940                                                                  00494003
005000     05  PC-TSYMSG-NUMBERS.                                       00500003
005200         10  PC-TSYMSG-00007      PIC  9(05)  VALUE 00007.        00520003
005400         10  PC-TSYMSG-00008      PIC  9(05)  VALUE 00008.        00540003
005500         10  PC-TSYMSG-00045      PIC  9(05)  VALUE 00045.        00550007
005600         10  PC-TSYMSG-00059      PIC  9(05)  VALUE 00059.        00560007
006400         10  PC-TSYMSG-00984      PIC  9(05)  VALUE 00984.        00640003
008210         10  PC-TSYMSG-03716      PIC  9(05)  VALUE 03716.        00821003
008220         10  PC-TSYMSG-03719      PIC  9(05)  VALUE 03719.        00822013
008300                                                                  00830003
008900 01  PV-PROGRAM-VARIABLES.                                        00890007
009100     05  PV-RETRY-COUNTER         PIC S9(4) VALUE +0 COMP SYNC.   00910007
010500                                                                  01050004
012400                                                                  01240004
012500*----------------------------------------------------------------*01250001
012600*    SECURITY SUBROUTINE PARAMETERS                              *01260001
012700*----------------------------------------------------------------*01270001
012800     COPY DPWS008.                                                01280007
012900                                                                  01290007
013000*----------------------------------------------------------------*01300001
013100*    THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT   *01310001
013200*    SUB-ROUTINE (DPKUT100).                                     *01320001
013300*----------------------------------------------------------------*01330001
013400     COPY DPWS010I.                                               01340007
013500                                                                  01350007
013600*----------------------------------------------------------------*01360001
013700*  WORK AREA PASSED IN CALL TO DPKUT500                          *01370001
013800*----------------------------------------------------------------*01380001
013900*    COPY DPWS500.                                                01390001
014000*                                                                 01400001
014600*----------------------------------------------------------------*01460001
014700*    MAP LAYOUT                                                  *01470001
014800*----------------------------------------------------------------*01480001
014900     COPY CNKM242.                                                01490001
015000                                                                  01500001
015100*----------------------------------------------------------------*01510001
015200*    ATTRIBUTE SETTINGS COPYBOOK.                                *01520001
015300*----------------------------------------------------------------*01530001
015400     COPY DPWS015.                                                01540007
015500                                                                  01550007
015600*----------------------------------------------------------------*01560001
015700*    FUNCTION KEYS COPYBOOK                                      *01570001
015800*----------------------------------------------------------------*01580001
015900     COPY DPWS016.                                                01590007
016000                                                                  01600007
016100***************************************************************** 01610001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01620018
016300***************************************************************** 01630001
016400     COPY DPWS030.                                                01640007
CICS       COPY DPWS930.                                                01641018
016500                                                                  01650007
016600***************************************************************** 01660001
016700*    STANDARD COMMAREA.                                           01670001
016800***************************************************************** 01680001
016900     COPY DPWS020.                                                01690001
017000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01700001
017100                                                                  01710001
017200***************************************************************** 01720001
017300*    INTER-APPLICATION COMMAREA.                                  01730001
017400***************************************************************** 01740001
017500         10  INTER-APPL-COMM-AREA PIC X(200).                     01750001
017600*                                                                 01760001
017700***************************************************************** 01770001
017800*    SPECIFIC COMMMAREA FOR CNKCS242.                             01780001
017900***************************************************************** 01790001
018000         10  ASC-SPECIFIC-COMMAREA.                               01800002
018100             15  ASC-ENT-ID              PIC X(09).               01810002
018300             15  ASC-ENT-ID-N  REDEFINES                          01830002
018400                 ASC-ENT-ID              PIC 9(09).               01840002
018410             15  ASC-ENT-NAME            PIC X(30).               01841002
018500             15  ASC-FILE-TYPE-CODE      PIC X(02).               01850002
018510                 88  ASC-CONTAINER           VALUE 'CN'.          01851002
018600             15  ASC-TRACKING-IND        PIC X(01).               01860002
018610                 88  ASC-TRACKING            VALUE 'N'.           01861002
018700             15  ASC-STATUS-CODE         PIC X(01).               01870002
018800                 88 ASC-ACTIVE               VALUE 'A'.           01880002
018810                 88 ASC-INACTIVE             VALUE 'I'.           01881002
024900         10  FILLER                      PIC X(200).              02490002
025000*                                                                 02500001
025100*----------------------------------------------------------------*02510001
025200*    ABEND PROCESSING COPYBOOK.                                  *02520001
025300*----------------------------------------------------------------*02530001
025400     COPY DPWS013.                                                02540001
025500                                                                  02550001
025600*** TRT_IMPRT_PRTNRFIL                                            02560001
025610*                                                                 02561001
025700     EXEC SQL                                                     02570001
025800          INCLUDE TRT00004                                        02580005
025900     END-EXEC.                                                    02590001
026000                                                                  02600001
026700*** TENTNME  - ENTITY NAME                                        02670003
026800*                                                                 02680003
026900     EXEC SQL                                                     02690003
027000          INCLUDE TENTNME                                         02700003
027100     END-EXEC.                                                    02710003
027200                                                                  02720003
030600*DB2 AREA FOR COMMUNICATIONS                                      03060001
030700     EXEC SQL                                                     03070001
030800          INCLUDE SQLCA                                           03080001
030900     END-EXEC.                                                    03090001
031000                                                                  03100001
031100/*****************************************************************03110001
031200 LINKAGE SECTION.                                                 03120001
031300******************************************************************03130001
031400 01  DFHCOMMAREA.                                                 03140001
031500     05  FILLER                         OCCURS  1 TO 4072 TIMES   03150001
031600                                        DEPENDING ON EIBCALEN.    03160001
031700         10  FILLER                     PIC  X(01).               03170001
031800                                                                  03180001
031900 PROCEDURE DIVISION.                                              03190001
032000***************************************************************** 03200001
032100** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03210001
032200** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03220001
032300** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03230001
032400**                                                             ** 03240001
032500** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03250001
032600** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03260001
032700***************************************************************** 03270001
032800 0000-MAIN-MODULE.                                                03280001
032900                                                                  03290001
033000     INITIALIZE DP030-CICS-API-FIELDS.                            03300001
033100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03310001
033200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03320001
033300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03330001
033400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03340001
033500     MOVE LENGTH OF CN242AI        TO DP030-MAP-LENGTH (1).       03350001
033600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03360001
033700     PERFORM 0001-CALL-CICS-ARCH-API.                             03370001
033800                                                                  03380001
033900     PERFORM 1000-CONTROL-PROCESSING                              03390001
034000                                                                  03400001
034100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03410001
034200     PERFORM 0001-CALL-CICS-ARCH-API.                             03420001
034300                                                                  03430001
034400******************************************************************03440001
034500 0001-CALL-CICS-ARCH-API.                                         03450001
034600                                                                  03460001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03470018
034800                                    DFHCOMMAREA                   03480018
034900                                    DP030-CICS-API-FIELDS         03490018
035000                                    DP020-STANDARD-COMMAREA       03500018
035100                                    CN242AI.                      03510018
035200                                                                  03520001
035300     IF  DP030-RC-CALL-SUCCESSFUL                                 03530001
035400         CONTINUE                                                 03540001
035500     ELSE                                                         03550001
035600         SET DP013-NO-ROLLBACK                                    03560001
035700             DP013-XCTL-DISPLAY-RESTART                           03570001
035800             DP013-CICS-ABEND      TO TRUE                        03580001
035900         MOVE 'BEFORE 0000-MAIN-MODULE'                           03590001
036000                                   TO DP013-PARAGRAPH             03600001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03601018
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03602018
036300         MOVE DP030-RETURN-CODE                                   03630001
036400                                   TO DP013-MESSAGE-TEXT (3)      03640001
036500         PERFORM DP013-0000-PROCESS-ABEND                         03650001
036600     END-IF.                                                      03660001
036700                                                                  03670001
036800*----------------------------------------------------------------*03680001
036900*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03690001
037000*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03700001
037100*----------------------------------------------------------------*03710001
037200 1000-CONTROL-PROCESSING.                                         03720001
037300                                                                  03730001
037400     EVALUATE TRUE                                                03740001
037500        WHEN DP020-NEXT-ACT-INITIAL                               03750003
037600             INITIALIZE ASC-SPECIFIC-COMMAREA                     03760003
037610                                                                  03761002
037700             MOVE ZEROES         TO ASC-ENT-ID-N                  03770003
037800             SET  ASC-CONTAINER  TO  TRUE                         03780003
037900             SET  ASC-TRACKING   TO  TRUE                         03790003
038000             SET  ASC-ACTIVE     TO  TRUE                         03800003
038100                                                                  03810002
038300             PERFORM 1100-CHECK-SECURITY                          03830003
038400             PERFORM 3200-RESET-ATTRIBUTES                        03840003
038500             PERFORM 4000-BUILD-INITIAL-PANEL                     03850003
038600                                                                  03860001
038700       WHEN DP020-NEXT-ACT-READ-MAP                               03870001
038800            PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                  03880003
039900                                                                  03990001
040000           IF  PS-ERROR                                           04000003
040400               CONTINUE                                           04040001
040500           ELSE                                                   04050001
040600               PERFORM 2000-PROCESS-PANEL                         04060001
040700           END-IF                                                 04070001
040800                                                                  04080001
040900       WHEN DP020-NEXT-ACT-RETURN                                 04090001
041100           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   04110001
041200                                                                  04120001
041300       WHEN OTHER                                                 04130001
041400           SET DP013-LOGIC-ABEND                                  04140001
041500               DP013-NO-ROLLBACK TO TRUE                          04150001
041600           MOVE '1000-CONTROL-PROCESSING'                         04160001
041700                                 TO DP013-PARAGRAPH               04170001
041800           MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'     04180001
041900                                 TO DP013-MESSAGE-TEXT(1)         04190001
042000           MOVE DP020-NEXT-APPL-ACTIVITY                          04200001
042100                                 TO DP013-MESSAGE-TEXT(2)         04210001
042200           PERFORM DP013-0000-PROCESS-ABEND                       04220001
042300     END-EVALUATE.                                                04230001
042400                                                                  04240001
042500*----------------------------------------------------------------*04250001
042600*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *04260001
042700*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *04270001
042800*----------------------------------------------------------------*04280001
042900 1100-CHECK-SECURITY.                                             04290001
043000                                                                  04300001
043100     SET DP008-RSRC-TYPE-FUNC       TO TRUE.                      04310001
043200     SET DP008-ACCESS-TYPE-USE      TO TRUE.                      04320001
043300     PERFORM 1110-LINK-TO-SECURITY.                               04330001
043400                                                                  04340001
043500******************************************************************04350001
043600 1110-LINK-TO-SECURITY.                                           04360001
043700                                                                  04370001
043800     EXEC CICS LINK                                               04380001
043900               PROGRAM  (DP008-SECURITY-SUBROUTINE)               04390001
044000               COMMAREA (DP008-SECURITY-COMMAREA)                 04400001
044100               LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)          04410001
044200     END-EXEC.                                                    04420001
044300                                                                  04430001
044400     IF DP008-CALL-SUCCESSFUL                                     04440001
044500         CONTINUE                                                 04450001
044600     ELSE                                                         04460001
044700         SET DP013-XCTL-DISPLAY-LOGOFF TO TRUE                    04470001
044800         SET DP013-SECURITY-ABEND      TO TRUE                    04480001
044900         MOVE '1110-LINK-TO-SECURITY'  TO DP013-PARAGRAPH         04490001
045000         MOVE DP008-SECURITY-COMMAREA  TO DP013-SECURITY-INFO     04500001
045100         PERFORM DP013-0000-PROCESS-ABEND                         04510001
045200     END-IF.                                                      04520001
045300                                                                  04530001
045400*----------------------------------------------------------------*04540001
045500* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*04550001
045600* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*04560001
045700* EDITS.                                                         *04570001
045800*----------------------------------------------------------------*04580001
045900 2000-PROCESS-PANEL.                                              04590001
046000                                                                  04600001
046100     EVALUATE TRUE                                                04610001
046200       WHEN DP020-SRC-AID = DP016-CLEAR                           04620001
046300           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   04630001
046400           PERFORM 3000-EDIT-DATA-IN-COMMAREA                     04640001
046500                                                                  04650001
046600       WHEN DP020-FK-REFRESH(DP020-SRC-AID)                       04660001
046610           INITIALIZE ASC-SPECIFIC-COMMAREA                       04661002
046620                                                                  04662002
046630           MOVE ZEROES         TO ASC-ENT-ID-N                    04663002
046640           SET  ASC-CONTAINER  TO  TRUE                           04664002
046650           SET  ASC-TRACKING   TO  TRUE                           04665002
046660           SET  ASC-ACTIVE     TO  TRUE                           04666002
046670                                                                  04667002
047400           PERFORM 3200-RESET-ATTRIBUTES                          04740001
047500           PERFORM 4000-BUILD-INITIAL-PANEL                       04750001
047600                                                                  04760001
047700       WHEN OTHER                                                 04770001
047800           PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                   04780001
047900           PERFORM 3000-EDIT-DATA-IN-COMMAREA                     04790001
048000           IF PS-NO-ERROR                                         04800001
048100               SET DP030-CONTINUE-GO TO TRUE                      04810001
048200               PERFORM 2100-CHECK-FUNCTION-KEY                    04820001
048300           ELSE                                                   04830001
048400               SET DP030-OVERRIDE-GO TO TRUE                      04840001
048500               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               04850001
048600           END-IF                                                 04860001
048700     END-EVALUATE.                                                04870001
048800                                                                  04880001
048900******************************************************************04890001
049000** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **04900001
049100** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **04910001
049200** FROM THE CICS ARCHITECTURE API.                              **04920001
049300******************************************************************04930001
049400 2100-CHECK-FUNCTION-KEY.                                         04940001
049500                                                                  04950001
049600     EVALUATE TRUE                                                04960001
049700         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04970003
051000              PERFORM 5000-INSERT                                 05100003
051600                   IF PS-NO-ERROR                                 05160001
051700* SUCCESSFUL INSERT                                               05170004
051800                      MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER    05180004
051900                      MOVE DP015-UNP-ALP-BRT-OFF   TO AENTIDA     05190004
052000                      MOVE -1                      TO AENTIDL     05200004
052100                      SET DP030-SET-CURSOR-APPL-1                 05210004
052200                          DP020-MSG-INFORMATIONAL  TO TRUE        05220004
052900                   END-IF                                         05290001
054100                                                                  05410001
054200           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   05420001
054400                                                                  05440001
054500       WHEN DP020-SRC-AID = DP016-ENTER                           05450001
055200           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   05520001
055300                                                                  05530001
055400       WHEN OTHER                                                 05540001
055500           SET DP013-NO-ROLLBACK                                  05550001
055600               DP013-XCTL-DISPLAY-RESTART                         05560001
055700               DP013-CICS-ABEND  TO TRUE                          05570001
055800           MOVE '2100-CHECK-FUNCTION-KEY'                         05580001
055900                                 TO DP013-PARAGRAPH               05590001
056000           MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'        05600001
056100                                 TO DP013-MESSAGE-TEXT (1)        05610001
056200           PERFORM DP013-0000-PROCESS-ABEND                       05620001
056300     END-EVALUATE.                                                05630001
056400                                                                  05640001
056500*----------------------------------------------------------------*05650001
056600* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*05660001
056700* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *05670001
056800* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *05680001
056900*----------------------------------------------------------------*05690001
057000 2200-MOVE-SCREEN-TO-COMMAREA.                                    05700001
057100                                                                  05710001
057400     IF AENTIDL > ZERO                                            05740002
058200         MOVE AENTIDI TO ASC-ENT-ID                               05820002
058700     ELSE                                                         05870001
058800         IF  ASC-ENT-ID  >  SPACES                                05880002
058900             CONTINUE                                             05890001
059000         ELSE                                                     05900001
059100             SET PS-ERROR                                         05910001
059200                 DP020-MSG-FATAL         TO TRUE                  05920001
059300             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      05930002
059400             MOVE DP015-UNP-ALP-BRT-OFF  TO AENTIDA               05940002
059500             MOVE DP015-RED              TO AENTIDC               05950002
059600             MOVE DP015-REVERSE          TO AENTIDH               05960002
059700             MOVE -1                     TO AENTIDL               05970007
059800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  05980001
059900         END-IF                                                   05990001
060002                                                                  06000202
060311     IF ATYPEL > ZERO                                             06031102
060312         MOVE ATYPEI TO ASC-FILE-TYPE-CODE                        06031202
060313     ELSE                                                         06031302
060314         IF  ASC-FILE-TYPE-CODE  >  SPACES                        06031402
060315             CONTINUE                                             06031502
060316         ELSE                                                     06031602
060317             SET PS-ERROR                                         06031702
060318                 DP020-MSG-FATAL         TO TRUE                  06031802
060319             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      06031902
060320             MOVE DP015-UNP-ALP-BRT-OFF  TO ATYPEA                06032002
060321             MOVE DP015-RED              TO ATYPEC                06032102
060322             MOVE DP015-REVERSE          TO ATYPEH                06032202
060323             MOVE -1                     TO ATYPEL                06032302
060324             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06032402
060325         END-IF                                                   06032502
060326     END-IF.                                                      06032602
060327                                                                  06032702
060328     IF ATRKNGL > ZERO                                            06032802
060329         MOVE ATRKNGI TO ASC-TRACKING-IND                         06032902
060330     ELSE                                                         06033002
060331         IF  ASC-TRACKING-IND   >  SPACES                         06033102
060332             CONTINUE                                             06033202
060333         ELSE                                                     06033302
060334             SET PS-ERROR                                         06033402
060335                 DP020-MSG-FATAL         TO TRUE                  06033502
060336             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      06033602
060337             MOVE DP015-UNP-ALP-BRT-OFF  TO ATRKNGA               06033702
060338             MOVE DP015-RED              TO ATRKNGC               06033802
060339             MOVE DP015-REVERSE          TO ATRKNGH               06033902
060340             MOVE -1                     TO ATRKNGL               06034002
060341             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06034102
060342         END-IF                                                   06034202
060343     END-IF.                                                      06034302
060344                                                                  06034402
060345     IF ASTATL > ZERO                                             06034502
060346         MOVE ASTATI TO ASC-STATUS-CODE                           06034602
060347     ELSE                                                         06034702
060348         IF  ASC-STATUS-CODE  >  SPACES                           06034802
060349             CONTINUE                                             06034902
060350         ELSE                                                     06035002
060351             SET PS-ERROR                                         06035102
060352                 DP020-MSG-FATAL         TO TRUE                  06035202
060353             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      06035302
060354             MOVE DP015-UNP-ALP-BRT-OFF  TO ASTATA                06035402
060355             MOVE DP015-RED              TO ASTATC                06035502
060356             MOVE DP015-REVERSE          TO ASTATH                06035602
060357             MOVE -1                     TO ASTATL                06035702
060358             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06035802
060359         END-IF                                                   06035902
060360     END-IF.                                                      06036002
065100                                                                  06510001
065110                                                                  06511002
065200*----------------------------------------------------------------*06520001
065300* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *06530001
065400* IS FOUND THE CURSOR IS POSITIONED AT THAT FIELD AND AN         *06540001
065500* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *06550001
065600*----------------------------------------------------------------*06560001
065700 3000-EDIT-DATA-IN-COMMAREA.                                      06570001
065800                                                                  06580001
065900     PERFORM 3200-RESET-ATTRIBUTES.                               06590001
066000                                                                  06600001
066010*-----------------------------------------------------------------06601002
066020* VERIFY THAT ENTITY ID IS NUMERIC                                06602002
066030*-----------------------------------------------------------------06603002
066040     IF  ASC-ENT-ID  >  SPACES                                    06604002
066050         MOVE ASC-ENT-ID              TO DP010I-UNEDITED-FIELD    06605002
066060         MOVE LENGTH OF ASC-ENT-ID    TO DP010I-MAXIMUM-DIGITS    06606002
066070         MOVE ZERO                    TO DP010I-MAXIMUM-DECIMALS  06607002
066080         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  06608002
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06609117
263455              USING DP010I-NUMERIC-EDIT-AREA                      06609217
066091         IF  DP010I-ERROR-DETECTED                                06609302
066092             SET PS-ERROR                                         06609402
066093                 DP020-MSG-FATAL         TO TRUE                  06609502
066094             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      06609602
066095             MOVE DP015-UNP-ALP-BRT-OFF  TO AENTIDA               06609702
066096             MOVE DP015-RED              TO AENTIDC               06609802
066097             MOVE DP015-REVERSE          TO AENTIDH               06609902
066098             MOVE -1                     TO AENTIDL               06610002
066099             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06610102
066100         ELSE                                                     06610202
066101             MOVE DP010I-NUMERIC-FIELD TO ASC-ENT-ID-N            06610302
066102             MOVE ASC-ENT-ID           TO AENTIDO                 06610402
066103         END-IF                                                   06610502
066104     END-IF.                                                      06610602
087600                                                                  08760001
087610*-----------------------------------------------------------------08761002
087620* GET ENTITY NAME                                                 08762002
087630*-----------------------------------------------------------------08763002
087640     IF  ASC-ENT-ID  >  SPACES                                    08764002
087641         PERFORM 3100-GET-ENTITY-NAME                             08764102
087704     END-IF.                                                      08770402
087705                                                                  08770502
087710     IF PS-NO-ERROR                                               08771001
087800         MOVE -1                     TO AENTIDL                   08780007
087900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      08790001
088000     END-IF.                                                      08800001
088100                                                                  08810001
088200*---------------------------------------------------------------* 08820001
088300* GET ENTITY NAME                                                 08830002
088400*---------------------------------------------------------------* 08840001
088410 3100-GET-ENTITY-NAME.                                            08841002
093000                                                                  09300002
093100     MOVE ASC-ENT-ID-N  TO  ENTNME-ENT-ID.                        09310002
093200                                                                  09320002
093300     EXEC SQL                                                     09330003
093400         SELECT ENT_NAME_DESC                                     09340003
093500           INTO :ENTNME-ENT-NAME-DESC                             09350003
093600           FROM TENTNME                                           09360006
094000          WHERE ENT_ID         =  :ENTNME-ENT-ID                  09400003
094100            AND TYPE_CDE       =  '01'                            09410003
094200     END-EXEC                                                     09420003
096300                                                                  09630002
096400     EVALUATE TRUE                                                09640002
096500       WHEN SQLCODE = ZERO                                        09650002
096700           MOVE ENTNME-ENT-NAME-DESC TO ASC-ENT-NAME              09670003
097200                                                                  09720003
097300       WHEN SQLCODE = +100                                        09730003
097410             SET PS-ERROR                                         09741003
097420                 DP020-MSG-FATAL         TO TRUE                  09742003
097430             MOVE PC-TSYMSG-03716        TO DP020-MSG-NUMBER      09743003
097440             MOVE DP015-UNP-ALP-BRT-OFF  TO AENTIDA               09744003
097450             MOVE DP015-RED              TO AENTIDC               09745003
097460             MOVE DP015-REVERSE          TO AENTIDH               09746003
097470             MOVE -1                     TO AENTIDL               09747003
097480             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09748003
097500                                                                  09750003
097600       WHEN OTHER                                                 09760003
097610            SET PS-ERROR                                          09761003
097620                DP020-MSG-FATAL         TO TRUE                   09762003
097630            MOVE PC-TSYMSG-00984        TO DP020-MSG-NUMBER       09763003
097640            MOVE DP015-UNP-ALP-BRT-OFF  TO AENTIDA                09764003
097650            MOVE DP015-RED              TO AENTIDC                09765003
097660            MOVE DP015-REVERSE          TO AENTIDH                09766003
097670            MOVE -1                     TO AENTIDL                09767003
097680            SET DP030-SET-CURSOR-APPL-1 TO TRUE                   09768003
097690                                                                  09769003
097700            MOVE '3100-GET-ENTITY-NAME' TO DP013-PARAGRAPH        09770006
097800            MOVE 'TEXTENT SELECT'  TO DP013-MESSAGE-TEXT (1)      09780003
097900            MOVE SQLCA             TO DP013-SQLCA                 09790003
098000            MOVE 'TEXTENT'         TO DP013-DB2-TABLE-NAME (1)    09800003
098100            SET DP013-DB2-ABEND                                   09810003
098200                DP013-XCTL-DISPLAY-RESTART TO TRUE                09820003
098300            PERFORM DP013-0000-PROCESS-ABEND                      09830003
098400     END-EVALUATE.                                                09840003
098500                                                                  09850003
098600                                                                  09860003
105800*---------------------------------------------------------------* 10580001
105900*                                                                 10590001
106000*---------------------------------------------------------------* 10600001
106100 3200-RESET-ATTRIBUTES.                                           10610001
106200                                                                  10620001
106300     MOVE DP015-GREEN                TO AENTIDC                   10630002
106400                                        ATYPEC                    10640002
106410                                        ATRKNGC                   10641002
106420                                        ASTATC.                   10642002
106500     MOVE DP015-UNDERLINE            TO AENTIDH                   10650002
106600                                        ATYPEH                    10660002
106610                                        ATRKNGH                   10661002
106620                                        ASTATH.                   10662002
106700     MOVE -1                         TO AENTIDL.                  10670012
106800     SET DP030-SET-CURSOR-APPL-1     TO TRUE.                     10680001
106900     MOVE DP015-UNP-ALP-NOR-OFF      TO AENTIDA                   10690002
107000                                        ATYPEA                    10700002
107100                                        ATRKNGA                   10710002
107200                                        ASTATA.                   10720002
108800                                                                  10880001
109900*----------------------------------------------------------------*10990001
110000* BUILD THE INITIAL PANEL OF THE SCREEN AND POSITION THE CURSOR  *11000001
110100* AT ENTITY ID                                                   *11010004
110200*----------------------------------------------------------------*11020001
110300 4000-BUILD-INITIAL-PANEL.                                        11030001
110400                                                                  11040001
110500     SET DP030-SET-CURSOR-APPL-1 TO TRUE.                         11050001
110600                                                                  11060001
110700     MOVE DP015-UNP-ALP-NOR-OFF    TO AENTIDA                     11070004
110800                                      ATYPEA                      11080004
110810                                      ATRKNGA                     11081004
110820                                      ASTATA.                     11082004
110900     MOVE DP015-GREEN              TO AENTIDC                     11090004
111000                                      ATYPEC                      11100004
111010                                      ATRKNGC                     11101004
111020                                      ASTATC.                     11102004
111100     MOVE DP015-UNDERLINE          TO AENTIDH                     11110004
111200                                      ATYPEH                      11120004
111210                                      ATRKNGH                     11121004
111220                                      ASTATH.                     11122004
112800     MOVE -1                       TO AENTIDL.                    11280004
112900                                                                  11290001
115800                                                                  11580001
115900                                                                  11590001
131900*----------------------------------------------------------------*13190001
132000*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *13200001
132100*----------------------------------------------------------------*13210001
132200 4400-MOVE-COMMAREA-TO-SCREEN.                                    13220001
132300                                                                  13230001
132400     MOVE ASC-ENT-ID           TO AENTIDO.                        13240004
132410     MOVE ASC-ENT-NAME         TO ANAMEO.                         13241004
132500     MOVE ASC-FILE-TYPE-CODE   TO ATYPEO.                         13250004
132600     MOVE ASC-TRACKING-IND     TO ATRKNGO.                        13260004
132700     MOVE ASC-STATUS-CODE      TO ASTATO.                         13270011
132900                                                                  13290001
139010                                                                  13901003
176600******************************************************************17660001
176700* 5000-INSERT.                                                    17670006
177300******************************************************************17730001
177400 5000-INSERT.                                                     17740006
177500                                                                  17750001
177600     INITIALIZE PV-RETRY-COUNTER.                                 17760001
177700                                                                  17770001
177720     MOVE ASC-ENT-ID-N        TO TRT00004-ENT-ID.                 17772006
177750     MOVE ASC-FILE-TYPE-CODE  TO TRT00004-FIL-TYP-CDE.            17775006
177770     MOVE ASC-TRACKING-IND    TO TRT00004-TRKNG-IND.              17777006
177790     MOVE ASC-STATUS-CODE     TO TRT00004-STAT-CDE.               17779006
178100                                                                  17810001
178600         EXEC SQL                                                 17860001
178700             INSERT INTO TRT_IMPRT_PRTNRFIL                       17870006
178800                     (ENT_ID                                      17880001
178900                     ,FIL_TYP_CDE                                 17890006
179000                     ,TRKNG_IND                                   17900006
179100                     ,STAT_CDE                                    17910006
179200                     ,LAST_UPD_TMST)                              17920006
179800             VALUES (:TRT00004-ENT-ID                             17980006
179900                    ,:TRT00004-FIL-TYP-CDE                        17990006
180000                    ,:TRT00004-TRKNG-IND                          18000006
180100                    ,:TRT00004-STAT-CDE                           18010006
180200                    , CURRENT TIMESTAMP)                          18020006
180800         END-EXEC                                                 18080001
180900                                                                  18090001
181000         EVALUATE TRUE                                            18100001
181100           WHEN SQLCODE = ZERO                                    18110001
181200           WHEN SQLCODE = +100                                    18120001
181300              CONTINUE                                            18130001
181400           WHEN SQLCODE = -911                                    18140001
181500           WHEN SQLCODE = -913                                    18150001
181600               ADD 1 TO PV-RETRY-COUNTER                          18160001
181700           WHEN SQLCODE = -803                                    18170001
182100             SET PS-ERROR                                         18210014
182200                 DP020-MSG-FATAL             TO TRUE              18220014
182300                 MOVE PC-TSYMSG-03719        TO DP020-MSG-NUMBER  18230014
182400                 MOVE DP015-UNP-ALP-BRT-OFF  TO AENTIDA           18240014
182500                 MOVE DP015-RED              TO AENTIDC           18250014
182600                 MOVE DP015-REVERSE          TO AENTIDH           18260014
182700                 MOVE -1                     TO AENTIDL           18270014
182800                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              18280014
182801                                                                  18280114
182900           WHEN OTHER                                             18290001
183000               SET DP013-DB2-ABEND TO TRUE                        18300001
183100               SET DP013-ROLLBACK  TO TRUE                        18310001
183200               MOVE 'TRT00004'     TO DP013-DB2-TABLE-NAME (1)    18320006
183300               MOVE '5000-INSERT'                                 18330006
183400                                   TO DP013-PARAGRAPH             18340001
183500                 MOVE SQLCA        TO DP013-SQLCA                 18350001
183600                 MOVE 'INSERT TRT_IMPRT_PRTNRFIL'                 18360006
183700                                   TO DP013-MESSAGE-TEXT(1)       18370001
183800                 MOVE ASC-ENT-ID   TO DP013-MESSAGE-TEXT (2)      18380006
184000                 PERFORM DP013-0000-PROCESS-ABEND                 18400001
184100         END-EVALUATE.                                            18410016
184300                                                                  18430001
243200                                                                  24320003
243210                                                                  24321003
243300*----------------------------------------------------------------*24330001
243400*    ABEND PROCESSOR MODULE                                      *24340001
243500*----------------------------------------------------------------*24350001
243600     COPY DPPD013.                                                24360001
243700                                                                  24370001
