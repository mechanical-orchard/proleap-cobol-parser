000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.             SUKRF534.                                00050001
000600 AUTHOR.                 LARRY SCHLEICHER.                        00060001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070001
000800 DATE-WRITTEN.           DEC, 2000.                               00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100*----------------------------------------------------------------*00110001
001200* THIS PROGRAM WILL BE DISPLAYED WHEN IT IS DETERMINED THAT THE   00120001
001300* CARTON THAT IS BEING PROCESSED NEEDS TO BE AUDITED AND THE      00130001
001400* PROMPT INDICATOR IS SET TO 'Y'.  THE OPERATOR CAN INDICATE      00140001
001500* THAT THEY WILL BE DOING THE AUDIT NOW, THAT THEY WANT TO DEFER  00150001
001600* THE AUDIT FOR THIS CARTON, OR THAT THEY WANT TO DEFER THE AUDIT 00160001
001700* FOR THIS CARTON AND CHANGE THE PROMPT INDICATOR TO 'N'.         00170001
001800* BY ENTERING 'Y' AND PRESSING F2, THE PROGRAM WILL PASS          00180001
001900* CONTROL TO THE SUKRF511 TO CONTINUE THE AUDIT.                  00190001
002000* BY ENTERING 'N' AND PRESSING F2, THE PROGRAM WILL PASS          00200001
002100* CONTROL TO THE SUKRF502 AND THE AUDIT WILL BE DEFERRED.         00210001
002200* THE AUDIT LABEL WILL BE PRINTED WITH THE DEFER AUDIT CODE.      00220001
002300* BY PRESSING F5, THE PROMPT INDICATOR WILL BE TURNED OFF AND     00230001
002400* THE AUDIT WILL BE DEFERRED.                                     00240001
002500*----------------------------------------------------------------*00250001
002600                                                                  00260001
002700******************************************************************00270001
002800 ENVIRONMENT DIVISION.                                            00280001
002900******************************************************************00290001
003000                                                                  00300001
003100******************************************************************00310001
003200 DATA DIVISION.                                                   00320001
003300******************************************************************00330001
003400                                                                  00340001
003500******************************************************************00350001
003600 WORKING-STORAGE SECTION.                                         00360001
003700******************************************************************00370001
003800*                                                                 00380001
003900 01  CA-COMMAREA.                                                 00390001
004000*----------------------------------------------------------------*00400001
004100*  COMMAREA LAYOUT FOR THE CARTON CHECK-IN RF SCREEN              00410001
004200*----------------------------------------------------------------*00420001
004300     COPY SUWS001.                                                00430003
004400                                                                  00440001
004500    05  CA-PROGRAM-COMMAREA.                                      00450001
004600         10  CA-FAILED-AUDITS-FOUND-SW   PIC X(01)  VALUE SPACE.  00460001
004700             88  CA-FAILED-AUDIT         VALUE 'Y'.               00470001
004800             88  CA-NO-FAILED-AUDID      VALUE 'N'.               00480001
               10  CA-RFID-QC-AUDIT-IND     PIC X(01)   VALUE SPACES.   00481013
                   88  CA-RFID-AUDIT                     VALUE 'R'.     00482013
                   88  CA-QC-AUDIT                       VALUE 'S'.     00483013
               10  CA-RFID-QC-AUD-CMB-IND   PIC X(01)   VALUE SPACES.   00484013
                   88  CA-RFID-AUD-ONLY                  VALUE 'R'.     00485013
                   88  CA-QC-AUD-ONLY                    VALUE 'S'.     00486013
                   88  CA-QC-AND-RFID-AUD                VALUE 'B'.     00487013
               10  CA-RF-AUDIT-NUMBER                  PIC S9(09).      00488014
004900*                                                                 00490001
005000 01  CA-COMMAREA-CRTN-AUD.                                        00500001
005100*----------------------------------------------------------------*00510001
005200*  COMMAREA LAYOUT FOR THE CARTON CHECK-IN RF SCREEN              00520001
005300*----------------------------------------------------------------*00530001
005400     COPY SUWS006.                                                00540003
005500                                                                  00550001
005600*----------------------------------------------------------------*00560001
005700*  DB2 KEYS                                                      *00570001
005800*----------------------------------------------------------------*00580001
005900 01  DK-DB2-KEYS.                                                 00590001
006000     05  DK-OPER-UNT-ID                  PIC  S9(4) COMP.         00600001
006100     05  DK-FCLTY-ID                     PIC  S9(4) VALUE +1      00610001
006200                                                    COMP.         00620001
006300     05  DK-AUDIT-CNTL-NBR               PIC S9(09) COMP.         00630001
006400     05  DK-PO-NBR                       PIC S9(09) COMP.         00640001
006500     05  DK-PO-LINE-NBR                  PIC S9(09) COMP.         00650001
006600     05  DK-PREPK-ID                     PIC S9(04) COMP.         00660001
006700                                                                  00670001
006800*----------------------------------------------------------------*00680001
006900*  PROGRAM CONSTANTS                                             *00690001
007000*----------------------------------------------------------------*00700001
007100 01  PC-PROGRAM-CONSTANTS.                                        00710001
007200     05  PC-TRANID                       PIC  X(04)  VALUE 'S534'.00720001
007300*    05  PC-COMMAREA-LENGTH              PIC S9(04)  VALUE +300   00730001
007400     05  PC-M                            PIC  X(01)  VALUE 'M'.   00740001
007500     05  PC-I                            PIC  X(01)  VALUE 'I'.   00750001
007600     05  PC-F                            PIC  X(01)  VALUE 'F'.   00760001
007700                                                                  00770001
007800     05  PC-CURRENT-PROGRAM-NAME    PIC X(08) VALUE 'SUKRF534'.   00780001
007900     05  PC-SU-SHIP-CODE-PGM        PIC X(08) VALUE 'SUKRF502'.   00790001
008000     05  PC-PREV-FAILED-AUDIT-PGM   PIC X(08) VALUE 'SUKRF535'.   00800001
008100     05  PC-OPEN-CARTON-SCREEN      PIC X(08) VALUE 'SUKRF511'.   00810001
008200                                                                  00820001
008300*----------------------------------------------------------------*00830001
008400*   ERROR MESSAGES                                                00840001
008500*----------------------------------------------------------------*00850001
008600     05  PC-UNRECOGNIZED-PF-KEY-MSG PIC X(19)                     00860001
008700                                    VALUE  'UNRECOGNIZED PF KEY'. 00870001
008800     05  PC-NO-FAILED-AUDITS        PIC X(19)                     00880001
008900                                    VALUE  'NO FAILED AUDITS   '. 00890001
009000     05  PC-ENTER-F2-OR-F4          PIC X(19)                     00900001
009100                                    VALUE  'ENTER F2 OR F4     '. 00910001
009200     05  PC-ENTER-F2                PIC X(19)                     00920001
009300                                    VALUE  'ENTER F2           '. 00930001
009400     05  PC-ENTER-THROUGH-MENU-MSG  PIC X(19)                     00940001
009500                                    VALUE  'ENTER THROUGH MENU '. 00950001
009600     05  PC-TRANS-UNAVAILABLE-MSG   PIC X(19)                     00960001
009700                                    VALUE  'TRANS NOT AVAILABLE'. 00970001
009800     05  PC-AUDIT-OF-Y-OR-N         PIC X(19)                     00980001
009900                                    VALUE 'AUDIT MUST = Y OR N'.  00990001
010000     05  PC-DB2-FATAL-ERROR-MSG     PIC  X(19)                    01000001
010100                                    VALUE 'DB2 ERR/HELP DESK  '.  01010001
010200                                                                  01020001
010300*----------------------------------------------------------------*01030001
010400* PROGRAM SWITCHES                                               *01040001
010500*----------------------------------------------------------------*01050001
010600 01  PS-PROGRAM-SWITCHES.                                         01060001
010700     05  PS-VALID-INPUT-SW               PIC  X(01)  VALUE 'Y'.   01070001
010800         88  PS-VALID-INPUT                          VALUE 'Y'.   01080001
010900         88  PS-INVALID-INPUT                        VALUE 'N'.   01090001
011000     05  PS-AUDIT-SW                     PIC  X(01)  VALUE ' '.   01100001
011100         88  PS-VALID-AUDIT-NBR                      VALUE 'Y'.   01110001
011200         88  PS-INVALID-AUDIT-NBR                    VALUE 'N'.   01120001
011300     05  PS-FAILED-AUDITS-FOUND-SW       PIC  X(01)  VALUE 'N'.   01130001
011400         88  PS-FAILED-AUDITS-FOUND                  VALUE 'Y'.   01140001
011500         88  PS-NO-FAILED-AUDITS-FOUND               VALUE 'N'.   01150001
011600                                                                  01160001
011700*----------------------------------------------------------------*01170001
011800* PROGRAM VARIABLES                                              *01180001
011900*----------------------------------------------------------------*01190001
012000 01  PV-PROGRAM-VARIABLES.                                        01200001
012100     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 01210001
012200     05  PV-CICS-RESPONSE                PIC S9(09)  VALUE ZEROS  01220001
012300                                                     COMP SYNC.   01230001
012400     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 01240001
012500     05  PV-AUDIT-IND                    PIC  X(01).              01250001
012600     05  PV-PROMPT-IND                   PIC  X(01).              01260001
012700     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01270001
012800                                                     COMP SYNC.   01280001
012900     05  PV-LIMIT-DAYS                   PIC S9(09) COMP.         01290001
013000     05  PV-DISPLAY-OPER-UNT-ID          PIC S9(04).              01300001
013100     05  PV-DISPLAY-PO-NBR               PIC S9(09).              01310001
013200     05  PV-DISPLAY-PREPK-ID             PIC S9(04).              01320001
013300     05  PV-DISPLAY-PO-LINE-NBR          PIC S9(09).              01330001
013400*----------------------------------------------------------------*01340001
013500*  GENERATED DSECT FOR THE SUKM534 MAPSET                         01350001
013600*----------------------------------------------------------------*01360001
013700     COPY SUKM534.                                                01370001
013800                                                                  01380001
013900*----------------------------------------------------------------*01390001
014000*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 01400001
014100*----------------------------------------------------------------*01410001
014200     COPY DPWS010I.                                               01420003
014300                                                                  01430001
014400*----------------------------------------------------------------*01440001
014500*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01450001
014600*----------------------------------------------------------------*01460001
014700     COPY DPWS013.                                                01470003
014800                                                                  01480001
014900*----------------------------------------------------------------*01490001
015000*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01500001
015100*----------------------------------------------------------------*01510001
015200     COPY DPWS015.                                                01520003
015300                                                                  01530001
015310*----------------------------------------------------------------*01531001
015320* HELP SCREEN COMMAREA                                            01532001
015330     COPY PCWS192.                                                01533001
015340*----------------------------------------------------------------*01534001
015350* HELP SCREEN WORK AREA                                           01535001
015360     COPY PCWS188.                                                01536001
015370                                                                  01537001
015400******************************************************************01540001
015500*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL MESSAGES      01550001
015600*  TO BE DISPLAYED ON THE LRT                                     01560001
015700******************************************************************01570001
015800     COPY SUWS005.                                                01580003
015900                                                                  01590001
016500*----------------------------------------------------------------*01650001
016600*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01660001
016700*----------------------------------------------------------------*01670001
016800     COPY DFHAID.                                                 01680001
016900                                                                  01690001
017000*---------------------------------------------------------------* 01700001
017100*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      01710001
017200*  AUDIT TABLE (TSUNAUD)                                          01720001
017300*---------------------------------------------------------------* 01730001
017400     EXEC SQL                                                     01740001
017500         INCLUDE TSUNAUD                                          01750001
017600     END-EXEC.                                                    01760001
017700*---------------------------------------------------------------* 01770001
017800*    DB2 AREA FOR THE PO AUDIT REQUEST TABLE (SUT_PO_AUD_REQ)   * 01780001
017900*---------------------------------------------------------------* 01790001
018000     EXEC SQL                                                     01800001
018100         INCLUDE SUT00015                                         01810001
018200     END-EXEC.                                                    01820001
018300*---------------------------------------------------------------* 01830001
018400*    DB2 AREA FOR THE PO AUDIT PARM TABLE (SUT_PO_AUD_PARM)     * 01840001
018500*---------------------------------------------------------------* 01850001
018600     EXEC SQL                                                     01860001
018700         INCLUDE SUT00017                                         01870001
018800     END-EXEC.                                                    01880001
018900*---------------------------------------------------------------* 01890001
019000*  COMMUNICATIONS AREA FOR DB2                                    01900001
019100*---------------------------------------------------------------* 01910001
019200     EXEC SQL                                                     01920001
019300         INCLUDE SQLCA                                            01930001
019400     END-EXEC.                                                    01940001
019500                                                                  01950001
019600***************************************************************** 01960001
019700 LINKAGE SECTION.                                                 01970001
019800******************************************************************01980001
019900 01  DFHCOMMAREA.                                                 01990001
020000     05  FILLER                       OCCURS 1 TO 4072 TIMES      02000001
020100                                      DEPENDING ON EIBCALEN.      02010001
020200         10  FILLER                   PIC X.                      02020001
020300                                                                  02030001
020400******************************************************************02040001
020500 PROCEDURE DIVISION.                                              02050001
020600******************************************************************02060001
020700 0000-PROGRAM-MAINLINE.                                           02070001
020800                                                                  02080001
020810     IF EIBTRNID = 'S502' OR 'S504'                               02081015
059900       SET  SU006-INITIALIZE-SCREEN TO TRUE                       02082013
020900       MOVE DFHCOMMAREA TO CA-COMMAREA-CRTN-AUD                   02090013
021000       MOVE SU006-HOST-SAVE-AREA TO CA-COMMAREA                   02100013
021001       SET SU001-INITIALIZE-SCREEN TO TRUE                        02100113
             MOVE SU006-RFID-QC-AUDIT-IND TO CA-RFID-QC-AUDIT-IND       02100213
             MOVE SU006-RFID-QC-AUD-CMB-IND TO CA-RFID-QC-AUD-CMB-IND   02100513
             MOVE SU006-RFID-AUDIT-CNTL-NBR TO                          02100614
                              CA-RF-AUDIT-NUMBER                        02100714
021003     ELSE                                                         02101009
021004        MOVE DFHCOMMAREA TO CA-COMMAREA                           02101109
021005     END-IF.                                                      02101209
021006                                                                  02102009
021100     EVALUATE TRUE                                                02110001
021200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02120001
021300             CONTINUE                                             02130001
021400         WHEN OTHER                                               02140001
021500            MOVE '0000-PROGRAM-MAINLINE' TO DP013-PARAGRAPH       02150001
021600            MOVE 'UNABLE TO ASSIGN USER-ID'                       02160001
021700              TO DP013-MESSAGE-TEXT (1)                           02170001
021800            SET DP013-LOGIC-ABEND        TO TRUE                  02180001
021900            SET DP013-NO-ROLLBACK        TO TRUE                  02190001
022000            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                02200001
022100     END-EVALUATE.                                                02210001
022200                                                                  02220001
022300                                                                  02230001
022400     EVALUATE TRUE                                                02240001
022500         WHEN EIBCALEN = ZERO                                     02250001
022600             MOVE PC-ENTER-THROUGH-MENU-MSG TO PV-MESSAGE-AREA    02260001
022700             PERFORM 8300-RETURN                                  02270001
022800                                                                  02280001
022810****************************************************************  02281001
022820* DPKRF278 IS THE PGM FOR THE HELP SCREEN.                        02282001
022830****************************************************************  02283001
022840         WHEN EIBTRNID = 'Z278'                                   02284001
022850             MOVE DFHCOMMAREA          TO PC192-COMMAREA          02285001
022860             MOVE PC192-HOST-SAVE-AREA TO CA-COMMAREA             02286001
022870             SET SU001-PROCESS-SCREEN  TO TRUE                    02287001
022880             PERFORM 1000-INITIALIZE                              02288001
022881             PERFORM 3000-SELECT-AUDIT-NBR                        02288101
022882             IF PS-VALID-AUDIT-NBR                                02288201
022883                 PERFORM 1100-CHECK-FAILED-AUDITS                 02288301
022884             END-IF                                               02288401
022885             MOVE PS-FAILED-AUDITS-FOUND-SW                       02288501
022886                                      TO APRVFAILO                02288601
022887                                         CA-FAILED-AUDITS-FOUND-SW02288701
022888             MOVE PC-CURRENT-PROGRAM-NAME TO SU001-LAST-PROGRAM   02288801
022889             MOVE DP015-UNP-ALP-NOR-MDT   TO AAUDTINDA            02288901
022890             MOVE -1  TO AAUDTINDL                                02289001
022891             PERFORM 8000-SEND-MAP                                02289101
022892             PERFORM 8200-RETURN-TRANID                           02289201
022893                                                                  02289301
022900         WHEN SU001-INITIALIZE-SCREEN                             02290001
023000         WHEN EIBAID = DFHCLEAR                                   02300001
023100             SET SU001-PROCESS-SCREEN TO TRUE                     02310001
023200             PERFORM 1000-INITIALIZE                              02320001
023300             PERFORM 3000-SELECT-AUDIT-NBR                        02330001
023400             IF PS-VALID-AUDIT-NBR                                02340001
023500                 PERFORM 1100-CHECK-FAILED-AUDITS                 02350001
023600             END-IF                                               02360001
023700             MOVE PS-FAILED-AUDITS-FOUND-SW                       02370001
023800                                      TO APRVFAILO                02380001
023900                                         CA-FAILED-AUDITS-FOUND-SW02390001
024000             MOVE PC-CURRENT-PROGRAM-NAME TO SU001-LAST-PROGRAM   02400001
024100             MOVE DP015-UNP-ALP-NOR-MDT   TO AAUDTINDA            02410001
024200             MOVE -1  TO AAUDTINDL                                02420001
024300             PERFORM 8000-SEND-MAP                                02430001
024400             PERFORM 8200-RETURN-TRANID                           02440001
024500                                                                  02450001
024600         WHEN EIBAID = DFHENTER                                   02460001
024700             PERFORM 2000-PROCESS-SCREEN-FIELDS                   02470001
024800                                                                  02480001
024900             IF PS-VALID-INPUT                                    02490001
025000                 IF PV-AUDIT-IND  = 'N'                           02500001
025100                     MOVE PC-SU-SHIP-CODE-PGM                     02510001
025200                                        TO PV-TRANSFER-PROGRAM    02520001
025300                     SET SU001-INITIALIZE-SCREEN TO TRUE          02530001
025400                     PERFORM 4000-XCTL-LRT-MENU                   02540001
025500                 ELSE                                             02550001
025600                     MOVE PC-OPEN-CARTON-SCREEN                   02560001
025700                                        TO PV-TRANSFER-PROGRAM    02570001
025800                     PERFORM 4100-XCTL-CRTN-AUDIT                 02580001
025900                 END-IF                                           02590001
026000             END-IF                                               02600001
026100             MOVE -1  TO AAUDTINDL                                02610001
026200             PERFORM 8100-SEND-DATA-ONLY                          02620001
026300             PERFORM 8200-RETURN-TRANID                           02630001
026400                                                                  02640001
026500         WHEN EIBAID = DFHPF2                                     02650001
026600             PERFORM 2000-PROCESS-SCREEN-FIELDS                   02660001
026700             IF PS-VALID-INPUT                                    02670001
026800                 IF PV-AUDIT-IND  = 'N'                           02680001
026900                     MOVE PC-SU-SHIP-CODE-PGM                     02690001
027000                                        TO PV-TRANSFER-PROGRAM    02700001
027100                     SET SU001-INITIALIZE-SCREEN TO TRUE          02710001
027200                     PERFORM 4000-XCTL-LRT-MENU                   02720001
027300                 ELSE                                             02730001
027400                     MOVE PC-OPEN-CARTON-SCREEN                   02740001
027500                                        TO PV-TRANSFER-PROGRAM    02750001
027600                     PERFORM 4100-XCTL-CRTN-AUDIT                 02760001
027700                 END-IF                                           02770001
027800             END-IF                                               02780001
027900             MOVE -1  TO AAUDTINDL                                02790001
028000             PERFORM 8100-SEND-DATA-ONLY                          02800001
028100             PERFORM 8200-RETURN-TRANID                           02810001
028200                                                                  02820001
028300         WHEN EIBAID = DFHPF3                                     02830001
028400             PERFORM 2000-PROCESS-SCREEN-FIELDS                   02840001
028500             IF PS-VALID-INPUT                                    02850001
028600                 IF PV-AUDIT-IND  = 'N'                           02860001
028700                   MOVE PC-SU-SHIP-CODE-PGM TO PV-TRANSFER-PROGRAM02870001
028800                   SET SU001-INITIALIZE-SCREEN TO TRUE            02880001
028900                   PERFORM 4000-XCTL-LRT-MENU                     02890001
029000                 ELSE                                             02900001
029100                     IF CA-FAILED-AUDIT                           02910001
029200                       MOVE PC-ENTER-F2-OR-F4   TO AMSGLNO        02920001
029300                     ELSE                                         02930001
029400                       MOVE PC-ENTER-F2         TO AMSGLNO        02940001
029500                     END-IF                                       02950001
029600                 END-IF                                           02960001
029700             END-IF                                               02970001
029800             MOVE -1  TO AAUDTINDL                                02980001
029900             PERFORM 8100-SEND-DATA-ONLY                          02990001
030000             PERFORM 8200-RETURN-TRANID                           03000001
030100                                                                  03010001
030200         WHEN EIBAID = DFHPF4                                     03020001
030300             IF CA-FAILED-AUDIT                                   03030001
030400                 SET  SU001-INITIALIZE-SCREEN TO TRUE             03040001
030500                 MOVE PC-PREV-FAILED-AUDIT-PGM                    03050001
030600                                        TO PV-TRANSFER-PROGRAM    03060001
030700                 PERFORM 4000-XCTL-LRT-MENU                       03070001
030800             ELSE                                                 03080001
030900                MOVE PC-NO-FAILED-AUDITS        TO AMSGLNO        03090001
031000                MOVE -1                         TO AAUDTINDL      03100001
031100                PERFORM 8100-SEND-DATA-ONLY                       03110001
031200                PERFORM 8200-RETURN-TRANID                        03120001
031300             END-IF                                               03130001
031400                                                                  03140001
031500         WHEN EIBAID = DFHPF5                                     03150001
031600             PERFORM 2000-PROCESS-SCREEN-FIELDS                   03160001
031700             IF PS-VALID-INPUT                                    03170001
031800                 MOVE 'N'     TO SU001-PROMPT-IND                 03180001
031900                 IF PV-AUDIT-IND  = 'N'                           03190001
032000                     MOVE PC-SU-SHIP-CODE-PGM                     03200001
032100                                        TO PV-TRANSFER-PROGRAM    03210001
032200                     SET SU001-INITIALIZE-SCREEN TO TRUE          03220001
032300                     PERFORM 4000-XCTL-LRT-MENU                   03230001
032400                 ELSE                                             03240001
032500                     MOVE PC-OPEN-CARTON-SCREEN                   03250001
032600                                        TO PV-TRANSFER-PROGRAM    03260001
032700                     PERFORM 4100-XCTL-CRTN-AUDIT                 03270001
032800                 END-IF                                           03280001
032900             END-IF                                               03290001
033000             MOVE -1  TO AAUDTINDL                                03300001
033100             PERFORM 8100-SEND-DATA-ONLY                          03310001
033200             PERFORM 8200-RETURN-TRANID                           03320001
033300                                                                  03330001
033310         WHEN EIBAID = DFHPF1                                     03331001
033320              PERFORM 1400-HELP-SCREEN                            03332001
033330                                                                  03333001
033400         WHEN OTHER                                               03340001
033500             MOVE -1                         TO AAUDTINDL         03350001
033600             MOVE PC-UNRECOGNIZED-PF-KEY-MSG TO AMSGLNO           03360001
033700             PERFORM 8100-SEND-DATA-ONLY                          03370001
033800             PERFORM 8200-RETURN-TRANID                           03380001
033900     END-EVALUATE.                                                03390001
034000                                                                  03400001
034100     GOBACK.                                                      03410001
034200                                                                  03420001
034300*                                                                 03430001
034400 1000-INITIALIZE.                                                 03440001
034500*                                                                 03450001
034600     MOVE PC-CURRENT-PROGRAM-NAME TO SU001-LAST-PROGRAM.          03460001
034700     MOVE 'Y'                     TO AAUDTINDO                    03470001
034800                                     PV-PROMPT-IND.               03480001
034900*-----------------------------------------------------------------03490001
035000 1100-CHECK-FAILED-AUDITS.                                        03500001
035100     MOVE SUT00015-PO-NBR       TO DK-PO-NBR.                     03510001
035200     MOVE SUT00015-PO-LNE-NBR   TO DK-PO-LINE-NBR.                03520001
035300     MOVE SUT00015-PO-PREPK-ID  TO DK-PREPK-ID.                   03530001
035400     PERFORM 3300-SELECT-FAILED.                                  03540001
035500*                                                                 03550001
035501 1400-HELP-SCREEN.                                                03550101
035502     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      03550201
035503     MOVE 'SUKRF534'                  TO PC192-PROGRAM-NAME       03550301
035504     COPY PCPD188.                                                03550401
035505     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      03550501
035506     PERFORM 4200-XCTL-TO-HELP.                                   03550601
035510*                                                                 03551001
035600 2000-PROCESS-SCREEN-FIELDS.                                      03560001
035700                                                                  03570001
035800     PERFORM 2100-RECEIVE-MAP.                                    03580001
035900     PERFORM 2200-EDIT-INPUT.                                     03590001
036000*                                                                 03600001
036100 2100-RECEIVE-MAP.                                                03610001
036200                                                                  03620001
036300     EXEC CICS                                                    03630001
036400         RECEIVE MAP    ('SU534A')                                03640001
036500                 MAPSET ('SUKM534')                               03650001
036600                 RESP   (PV-CICS-RESPONSE)                        03660001
036700     END-EXEC.                                                    03670001
036800                                                                  03680001
036900     EVALUATE TRUE                                                03690001
037000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03700001
037100             PERFORM 2110-RECEIVE-SCREEN-FIELDS                   03710001
037200         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                03720001
037300             CONTINUE                                             03730001
037400         WHEN OTHER                                               03740001
037500            MOVE '2100-RECEIVE-MAP'      TO DP013-PARAGRAPH       03750001
037600            MOVE 'UNABLE TO RECEIVE MAP' TO DP013-MESSAGE-TEXT (1)03760001
037700            SET DP013-LOGIC-ABEND        TO TRUE                  03770001
037800            SET DP013-NO-ROLLBACK        TO TRUE                  03780001
037900            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                03790001
038000     END-EVALUATE.                                                03800001
038100*                                                                 03810001
038200 2110-RECEIVE-SCREEN-FIELDS.                                      03820001
038300                                                                  03830001
038400     IF  AAUDTINDL > ZERO                                         03840001
038500         MOVE AAUDTINDI TO PV-AUDIT-IND                           03850001
038600     ELSE                                                         03860001
038700         IF AAUDTINDA = DP015-ERASE-EOF                           03870001
038800             MOVE SPACES TO PV-AUDIT-IND                          03880001
038900         END-IF                                                   03890001
039000     END-IF.                                                      03900001
039100*                                                                 03910001
039200 2200-EDIT-INPUT.                                                 03920001
039300                                                                  03930001
039400     EVALUATE TRUE                                                03940001
039500         WHEN PV-AUDIT-IND = SPACES                               03950001
039600              SET PS-INVALID-INPUT        TO TRUE                 03960001
039700              MOVE DP015-UNP-ALP-BRT-MDT  TO AAUDTINDA            03970001
039800              MOVE -1                     TO AAUDTINDL            03980001
039900              MOVE PC-AUDIT-OF-Y-OR-N     TO AMSGLNO              03990001
040000                                                                  04000001
040100         WHEN OTHER                                               04010001
040200             IF PV-AUDIT-IND  = 'Y' OR                            04020001
040300                PV-AUDIT-IND  = 'N'                               04030001
040400                 MOVE DP015-UNP-ALP-NOR-MDT  TO AAUDTINDA         04040001
040500             ELSE                                                 04050001
040600                 SET PS-INVALID-INPUT        TO TRUE              04060001
040700                 MOVE DP015-UNP-ALP-BRT-MDT  TO AAUDTINDA         04070001
040800                 MOVE -1                     TO AAUDTINDL         04080001
040900                 MOVE PC-AUDIT-OF-Y-OR-N     TO AMSGLNO           04090001
041000             END-IF                                               04100001
041100     END-EVALUATE.                                                04110001
041200*                                                                 04120001
041300 3000-SELECT-AUDIT-NBR.                                           04130001
041400                                                                  04140001
041500     MOVE SU001-AUDIT-CNTL-NBR     TO DK-AUDIT-CNTL-NBR.          04150001
041600                                                                  04160001
041700     EXEC SQL                                                     04170001
041800       SELECT PO_NBR                                              04180001
041900           ,  PO_LNE_NBR                                          04190001
042000           ,  PO_PREPK_ID                                         04200001
042100           ,  OPER_UNT_ID                                         04210001
042200           ,  CART_QTY                                            04220001
042300           ,  UNT_QTY                                             04230001
042400           ,  AUD_CART_QTY                                        04240001
042500           ,  AUD_UNT_QTY                                         04250001
042600           ,  DAYS(CURRENT DATE) - (B.CK_AFT_DAY_QTY + 1)         04260001
042700       INTO   :SUT00015-PO-NBR                                    04270001
042800           ,  :SUT00015-PO-LNE-NBR                                04280001
042900           ,  :SUT00015-PO-PREPK-ID                               04290001
043000           ,  :SUT00015-OPER-UNT-ID                               04300001
043100           ,  :SUT00015-CART-QTY                                  04310001
043200           ,  :SUT00015-UNT-QTY                                   04320001
043300           ,  :SUT00015-AUD-CART-QTY                              04330001
043400           ,  :SUT00015-AUD-UNT-QTY                               04340001
043500           ,  :PV-LIMIT-DAYS                                      04350001
043600       FROM   SUT_PO_AUD_REQ A                                    04360001
043700           ,  SUT_PO_AUD_PARM B                                   04370001
043800       WHERE  A.AUD_CNTL_NBR  = :DK-AUDIT-CNTL-NBR                04380001
043900         AND  A.VND_RNKG_CDE  = B.VND_RNKG_CDE                    04390001
044000         AND  A.PKGNG_TYP_CDE = B.PKGNG_TYP_CDE                   04400001
044100         AND  A.EFF_BEG_TMST  = B.EFF_BEG_TMST                    04410001
044200     END-EXEC.                                                    04420001
044300                                                                  04430001
044400     EVALUATE TRUE                                                04440001
044500         WHEN SQLCODE = ZERO                                      04450001
044600             SET PS-VALID-AUDIT-NBR TO TRUE                       04460001
044700             MOVE SUT00015-PO-NBR      TO DK-PO-NBR               04470001
044800             MOVE SUT00015-PO-LNE-NBR  TO DK-PO-LINE-NBR          04480001
044900             MOVE SUT00015-PO-PREPK-ID TO DK-PREPK-ID             04490001
045000         WHEN SQLCODE = +100                                      04500001
045100             SET PS-INVALID-AUDIT-NBR TO TRUE                     04510001
045200         WHEN SQLWARN0 NOT = SPACES                               04520001
045300         WHEN SQLCODE NOT EQUAL ZERO                              04530001
045400             MOVE '3000-SELECT-AUDIT-NBR'                         04540001
045500                             TO DP013-PARAGRAPH                   04550001
045600             MOVE 'RETRIEVE AUDIT INFO '                          04560001
045700                             TO DP013-MESSAGE-TEXT(1)             04570001
045800             MOVE SU006-AUDIT-CNTL-NBR-X                          04580001
045900                             TO DP013-MESSAGE-TEXT(2)             04590001
046000             MOVE SQLCA      TO DP013-SQLCA                       04600001
046100             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           04610001
046200             MOVE 'SUT00017' TO DP013-DB2-TABLE-NAME(2)           04620001
046300             SET DP013-DB2-ABEND   TO TRUE                        04630001
046400             SET DP013-NO-ROLLBACK TO TRUE                        04640001
046500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               04650001
046600             MOVE PC-DB2-FATAL-ERROR-MSG TO AMSGLNO               04660001
046700             MOVE -1                     TO  AAUDTINDL            04670001
046800             PERFORM 8100-SEND-DATA-ONLY                          04680001
046900             PERFORM 8200-RETURN-TRANID                           04690001
047000     END-EVALUATE.                                                04700001
047100*                                                                 04710001
047200                                                                  04720001
047300 3300-SELECT-FAILED.                                              04730001
047400                                                                  04740001
047500     EXEC SQL                                                     04750001
047600          SELECT AUD_CNTL_NBR                                     04760001
047700          INTO   :SUT00015-AUD-CNTL-NBR                           04770001
047800          FROM   SUT_PO_AUD_REQ                                   04780001
047900          WHERE  PO_NBR         = :DK-PO-NBR                      04790001
048000            AND  PO_LNE_NBR     = :DK-PO-LINE-NBR                 04800001
048100            AND  PO_PREPK_ID    = :DK-PREPK-ID                    04810001
048200            AND  AUD_STAT_CDE   = :PC-F                           04820001
048300            AND  DAYS(CRE_TMST) > :PV-LIMIT-DAYS                  04830001
048400     END-EXEC.                                                    04840001
048500                                                                  04850001
048600     EVALUATE TRUE                                                04860001
048700         WHEN SQLCODE = ZERO                                      04870001
048800         WHEN SQLCODE = -811                                      04880001
048900             SET PS-FAILED-AUDITS-FOUND TO TRUE                   04890001
049000         WHEN SQLCODE = +100                                      04900001
049100             SET PS-NO-FAILED-AUDITS-FOUND TO TRUE                04910001
049200         WHEN SQLWARN0 NOT = SPACES                               04920001
049300         WHEN SQLCODE NOT EQUAL ZERO                              04930001
049400             MOVE '3300-SELECT-FAILED'                            04940001
049500                             TO DP013-PARAGRAPH                   04950001
049600             MOVE 'SUKCS583 - GET FAILED AUDITS'                  04960001
049700                             TO DP013-MESSAGE-TEXT(1)             04970001
049800             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 04980001
049900             STRING 'PO NBR: '         DELIMITED BY SIZE          04990001
050000                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          05000001
050100                           INTO DP013-MESSAGE-TEXT(2)             05010001
050200             STRING 'PO LINE NBR: '    DELIMITED BY SIZE          05020001
050300                PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE          05030001
050400                           INTO DP013-MESSAGE-TEXT(3)             05040001
050500             MOVE DK-PREPK-ID    TO PV-DISPLAY-PREPK-ID           05050001
050600             STRING 'PRE PACK ID: '    DELIMITED BY SIZE          05060001
050700                PV-DISPLAY-PREPK-ID    DELIMITED BY SIZE          05070001
050800                           INTO DP013-MESSAGE-TEXT(4)             05080001
050900             MOVE SQLCA      TO DP013-SQLCA                       05090001
051000             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           05100001
051100             SET DP013-DB2-ABEND                                  05110001
051200                             TO TRUE                              05120001
051300             SET DP013-NO-ROLLBACK                                05130001
051400                             TO TRUE                              05140001
051500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               05150001
051600             MOVE PC-DB2-FATAL-ERROR-MSG TO AMSGLNO               05160001
051700             MOVE -1                     TO  AAUDTINDL            05170001
051800             PERFORM 8100-SEND-DATA-ONLY                          05180001
051900             PERFORM 8200-RETURN-TRANID                           05190001
052000     END-EVALUATE.                                                05200001
052100                                                                  05210001
052200                                                                  05220001
052300 3400-SELECT-AUDIT.                                               05230001
052400                                                                  05240001
052500     INITIALIZE DCLTSUNAUD.                                       05250001
052600                                                                  05260001
052700     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              05270001
052800                                                                  05280001
052900     EXEC SQL                                                     05290001
053000         SELECT  AUD_TYP_CDE                                      05300001
053100              ,  AUD_STAT_CDE                                     05310001
053200              ,  PRC_FCLTY_AREA_ID                                05320001
053300           INTO  :SUNAUD-AUD-TYP-CDE                              05330001
053400             ,   :SUNAUD-AUD-STAT-CDE                             05340001
053500             ,   :SUNAUD-PRC-FCLTY-AREA-ID                        05350001
053600           FROM  TSUNAUD                                          05360001
053700          WHERE  AUD_CNTL_NBR      =  :DK-AUDIT-CNTL-NBR          05370001
053800     END-EXEC.                                                    05380001
053900                                                                  05390001
054000     EVALUATE TRUE                                                05400001
054100         WHEN SQLCODE = ZERO                                      05410001
054200             MOVE SUNAUD-AUD-TYP-CDE  TO SU006-AUDIT-TYPE         05420001
054300             MOVE SUNAUD-AUD-STAT-CDE TO SU006-AUDIT-STATUS       05430001
054400             MOVE SUNAUD-PRC-FCLTY-AREA-ID                        05440001
054500                                      TO SU006-PRCS-AREA          05450001
054600         WHEN SQLWARN0 NOT = SPACES                               05460001
054700         WHEN SQLCODE < ZERO                                      05470001
054800         WHEN SQLCODE > ZERO                                      05480001
054900             MOVE '3400-SELECT-AUDIT'                             05490001
055000                 TO DP013-PARAGRAPH                               05500001
055100             MOVE 'SELECT OF TSUNAUD TABLE'                       05510001
055200                 TO DP013-MESSAGE-TEXT (1)                        05520001
055300             MOVE SU006-AUDIT-CNTL-NBR-X                          05530001
055400                 TO DP013-MESSAGE-TEXT (2)                        05540001
055500             MOVE SQLCA            TO DP013-SQLCA                 05550001
055600             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    05560001
055700             SET DP013-DB2-ABEND   TO TRUE                        05570001
055800             SET DP013-NO-ROLLBACK TO TRUE                        05580001
055900             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               05590001
056000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               05600001
056100             MOVE -1                     TO  AAUDTINDL            05610001
056200             PERFORM 8100-SEND-DATA-ONLY                          05620001
056300             PERFORM 8200-RETURN-TRANID                           05630001
056400     END-EVALUATE.                                                05640001
056500                                                                  05650001
056600                                                                  05660001
056700 4000-XCTL-LRT-MENU.                                              05670001
056800     SET SU001-INITIALIZE-SCREEN     TO TRUE.                     05680001
056900     MOVE PC-CURRENT-PROGRAM-NAME TO SU001-LAST-PROGRAM.          05690001
057000                                                                  05700001
057100     MOVE LENGTH OF CA-COMMAREA    TO PV-COMMAREA-LENGTH          05710001
057200     EXEC CICS                                                    05720001
057300         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    05730001
057400               COMMAREA  (CA-COMMAREA)                            05740001
057500               LENGTH    (PV-COMMAREA-LENGTH)                     05750001
057600               RESP      (PV-CICS-RESPONSE)                       05760001
057700     END-EXEC.                                                    05770001
057800                                                                  05780001
057900     EVALUATE TRUE                                                05790001
058000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05800001
058100             CONTINUE                                             05810001
058200         WHEN OTHER                                               05820001
058300             MOVE '4000-XCTL-TO-LRT-MENU'                         05830001
058400                 TO DP013-PARAGRAPH                               05840001
058500             MOVE 'UNABLE TO XCTL TO PROGRAM: '                   05850001
058600                 TO DP013-MESSAGE-TEXT (1)                        05860001
058700             MOVE PV-TRANSFER-PROGRAM                             05870001
058800                 TO DP013-MESSAGE-TEXT (2)                        05880001
058900             SET DP013-CICS-ABEND  TO TRUE                        05890001
059000             SET DP013-NO-ROLLBACK TO TRUE                        05900001
059100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               05910001
059200             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             05920001
059300             SET SU001-PROCESS-SCREEN TO TRUE                     05930001
059400             PERFORM 8000-SEND-MAP                                05940001
059500             PERFORM 8200-RETURN-TRANID                           05950001
059600     END-EVALUATE.                                                05960001
059700*                                                                 05970001
059800 4100-XCTL-CRTN-AUDIT.                                            05980001
059900     SET  SU006-INITIALIZE-SCREEN TO TRUE.                        05990012
060000     MOVE PC-CURRENT-PROGRAM-NAME TO SU006-LAST-PROGRAM.          06000001
060100     MOVE SU001-COMMON-DATA       TO SU006-HOST-SAVE-AREA.        06010001
060200     MOVE SU001-OPER-UNT-ID       TO SU006-OPER-UNT-ID.           06020001
060300     MOVE SU001-CARTON            TO SU006-SHIP-UNIT-NBR.         06030001
060400     MOVE SU001-PO                TO SU006-PO.                    06040001
060500     MOVE SU001-RCVR-SEQ-NBR      TO SU006-REC-SEQ-NBR.           06050001
060600     MOVE SU001-USER-ID           TO SU006-USERID                 06060001
060700     MOVE SU001-AUDIT-CNTL-NBR    TO SU006-AUDIT-CNTL-NBR.        06070001
060710     MOVE SU001-ASGMT-STRT-DTE    TO SU006-ASGMT-STRT-DTE.        06071003
060720     MOVE SU001-ASGMT-NBR-TXT     TO SU006-ASGMT-NBR-TXT.         06072003
060730     MOVE SU001-ASGMT-NBR-SEQ-NBR TO SU006-ASGMT-NBR-SEQ-NBR.     06073003
060731     MOVE SU001-DOOR-ID           TO SU006-DOOR-ID.               06073104
           MOVE CA-RFID-QC-AUDIT-IND TO SU006-RFID-QC-AUDIT-IND         06073313
           MOVE CA-RFID-QC-AUD-CMB-IND TO SU006-RFID-QC-AUD-CMB-IND     06073413
           MOVE CA-RF-AUDIT-NUMBER     TO  SU006-RFID-AUDIT-CNTL-NBR    06073514
060740                                                                  06074003
060800     PERFORM 3400-SELECT-AUDIT.                                   06080001
060900     SET SU006-INSTREAM-AUDIT TO TRUE.                            06090001
061000     SET SU006-SYSTEM-GENERATED-AUDIT TO TRUE.                    06100001
061100     MOVE LENGTH OF CA-COMMAREA-CRTN-AUD                          06110001
061200                                  TO PV-COMMAREA-LENGTH.          06120001
061300     EXEC CICS                                                    06130001
061400         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    06140001
061500               COMMAREA  (CA-COMMAREA-CRTN-AUD)                   06150001
061600               LENGTH    (PV-COMMAREA-LENGTH)                     06160001
061700               RESP      (PV-CICS-RESPONSE)                       06170001
061800     END-EXEC.                                                    06180001
061900                                                                  06190001
062000     EVALUATE TRUE                                                06200001
062100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06210001
062200             CONTINUE                                             06220001
062300         WHEN OTHER                                               06230001
062400             MOVE '4100-XCTL-CRTN-AUDIT '                         06240001
062500                 TO DP013-PARAGRAPH                               06250001
062600             MOVE 'SUKRF502 - UNABLE TO XCTL TO PROGRAM: '        06260001
062700                 TO DP013-MESSAGE-TEXT (1)                        06270001
062800             MOVE PV-TRANSFER-PROGRAM                             06280001
062900                 TO DP013-MESSAGE-TEXT (2)                        06290001
063000             SET DP013-CICS-ABEND  TO TRUE                        06300001
063100             SET DP013-ROLLBACK TO TRUE                           06310001
063200             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06320001
063300             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             06330001
063400             SET SU001-PROCESS-SCREEN TO TRUE                     06340001
063500             PERFORM 8000-SEND-MAP                                06350001
063600             PERFORM 8200-RETURN-TRANID                           06360001
063700     END-EVALUATE.                                                06370001
063800                                                                  06380001
063801 4200-XCTL-TO-HELP.                                               06380101
063802                                                                  06380201
063803     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      06380301
063804     SET  SU001-INITIALIZE-SCREEN     TO TRUE.                    06380401
063805     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    06380501
063806                                                                  06380601
063807     EXEC CICS                                                    06380701
063808         XCTL                                                     06380801
063809             PROGRAM   (PV-TRANSFER-PROGRAM)                      06380901
063810             COMMAREA  (PC192-COMMAREA)                           06381001
063811             LENGTH    (PV-COMMAREA-LENGTH)                       06381101
063812             RESP      (PV-CICS-RESPONSE)                         06381201
063813     END-EXEC.                                                    06381301
063814                                                                  06381401
063815     EVALUATE TRUE                                                06381501
063816         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06381601
063817              CONTINUE                                            06381701
063818         WHEN OTHER                                               06381801
063819             MOVE '4200-XCTL-TO-HELP '                            06381901
063820                 TO DP013-PARAGRAPH                               06382001
063821             MOVE 'SUKRF534 - UNABLE TO XCTL TO PROGRAM: '        06382101
063822                 TO DP013-MESSAGE-TEXT (1)                        06382201
063823             MOVE PV-TRANSFER-PROGRAM                             06382301
063824                 TO DP013-MESSAGE-TEXT (2)                        06382401
063825             SET DP013-CICS-ABEND  TO TRUE                        06382501
063826             SET DP013-ROLLBACK TO TRUE                           06382601
063827             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06382702
063828             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             06382801
063829             SET SU001-PROCESS-SCREEN TO TRUE                     06382901
063830             PERFORM 8000-SEND-MAP                                06383001
063831             PERFORM 8200-RETURN-TRANID                           06383101
063832     END-EVALUATE.                                                06383201
063840                                                                  06384001
063900 8000-SEND-MAP.                                                   06390001
064000                                                                  06400001
064100     EXEC CICS                                                    06410001
064200         SEND MAP       ('SU534A')                                06420001
064300              MAPSET    ('SUKM534')                               06430001
064400              ERASE                                               06440001
064500              CURSOR                                              06450001
064600              RESP      (PV-CICS-RESPONSE)                        06460001
064700     END-EXEC.                                                    06470001
064800                                                                  06480001
064900     EVALUATE TRUE                                                06490001
065000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06500001
065100             CONTINUE                                             06510001
065200         WHEN OTHER                                               06520001
065300             MOVE '8000-SEND-MAP'      TO DP013-PARAGRAPH         06530001
065400             MOVE 'UNABLE TO SEND MAP' TO DP013-MESSAGE-TEXT (1)  06540001
065500             SET DP013-CICS-ABEND      TO TRUE                    06550001
065600             SET DP013-NO-ROLLBACK     TO TRUE                    06560001
065700             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06570001
065800     END-EVALUATE.                                                06580001
065900*                                                                 06590001
066000 8100-SEND-DATA-ONLY.                                             06600001
066100                                                                  06610001
066200     EXEC CICS                                                    06620001
066300         SEND MAP       ('SU534A')                                06630001
066400              MAPSET    ('SUKM534')                               06640001
066500              CURSOR                                              06650001
066600              DATAONLY                                            06660001
066700              RESP      (PV-CICS-RESPONSE)                        06670001
066800     END-EXEC.                                                    06680001
066900                                                                  06690001
067000     EVALUATE TRUE                                                06700001
067100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06710001
067200             CONTINUE                                             06720001
067300         WHEN OTHER                                               06730001
067400             MOVE '8100-SEND-DATA-ONLY' TO DP013-PARAGRAPH        06740001
067500             MOVE 'UNABLE TO SEND DATA' TO DP013-MESSAGE-TEXT (1) 06750001
067600             SET DP013-CICS-ABEND       TO TRUE                   06760001
067700             SET DP013-NO-ROLLBACK      TO TRUE                   06770001
067800             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06780001
067900     END-EVALUATE.                                                06790001
068000*                                                                 06800001
068100 8200-RETURN-TRANID.                                              06810001
068200                                                                  06820001
068300     MOVE LENGTH OF CA-COMMAREA   TO PV-COMMAREA-LENGTH           06830001
068400     EXEC CICS                                                    06840001
068500         RETURN TRANSID  (PC-TRANID)                              06850001
068600                COMMAREA (CA-COMMAREA)                            06860001
068700                LENGTH   (PV-COMMAREA-LENGTH)                     06870001
068800                RESP     (PV-CICS-RESPONSE)                       06880001
068900     END-EXEC.                                                    06890001
069000                                                                  06900001
069100     EVALUATE TRUE                                                06910001
069200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06920001
069300             CONTINUE                                             06930001
069400         WHEN OTHER                                               06940001
069500             MOVE '8200-RETURN-TRANIND' TO DP013-PARAGRAPH        06950001
069600             MOVE 'UNABLE TO RETURN TO TRANID'                    06960001
069700                 TO DP013-MESSAGE-TEXT (1)                        06970001
069800             SET DP013-CICS-ABEND       TO TRUE                   06980001
069900             SET DP013-NO-ROLLBACK      TO TRUE                   06990001
070000             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               07000001
070100     END-EVALUATE.                                                07010001
070200*                                                                 07020001
070300 8300-RETURN.                                                     07030001
070400                                                                  07040001
070500     EXEC CICS                                                    07050001
070600         SEND FROM (PV-MESSAGE-AREA)                              07060001
070700              LENGTH (19)                                         07070001
070800              ERASE                                               07080001
070900     END-EXEC.                                                    07090001
071000                                                                  07100001
071100     EXEC CICS                                                    07110001
071200         RETURN                                                   07120001
071300     END-EXEC.                                                    07130001
071400*                                                                 07140001
071500 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  07150001
071600                                                                  07160001
071700     MOVE PC-CURRENT-PROGRAM-NAME  TO DP013-PROGRAM.              07170001
071800     MOVE DFHEIBLK                 TO DP013-DFHEIBLK.             07180001
071900     INITIALIZE DP013-SRC-TASK-NUMBER                             07190001
072000                DP013-STACK.                                      07200001
072100     SET DP013-LINK-RETURN TO TRUE.                               07210001
072200                                                                  07220001
072300     EXEC CICS                                                    07230001
072400         LINK                                                     07240001
072500             PROGRAM   (DP013-NAME)                               07250001
072600             COMMAREA  (DP013-PARAMETERS)                         07260001
072700             LENGTH    (DP013-LENGTH)                             07270001
072800     END-EXEC.                                                    07280001
