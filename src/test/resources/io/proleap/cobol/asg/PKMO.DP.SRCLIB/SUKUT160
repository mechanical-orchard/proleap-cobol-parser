000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.    SUKUT160.                                         00040012
000500 AUTHOR.        ACCENTURE.                                        00050043
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   FEB, 2015.                                        00070012
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000*   THIS PROGRAM READS INTRANSIT FILE AND IF 'CL' ENTRIES         00100018
001100*   EXISTS THEN IT CHANGES CL ENTRIES TO UNLOAD MEMO ENTRIES      00110018
001200*   AND WRITE IT TO OUTPUT FILE, IF 'CL' ENTRIES ARE NOT PRESENT  00120018
001210*   THEN IT WRITES THE DATA WHICH HAS BEEN READ TO OUTPUT FILE.   00130039
001211*   ADDITIONAL PROCESSING HAS BEEN ADDED TO GENERATE A NEW FILE   00140053
001212*   WHICH WOULD CONTAIN ONLY 'IT' RECORDS AND ONLY THOSE 'IT'     00150053
001213*   RECORDS WHERE THE CORRESPONDING SE UN RECORD HAD NOT BEEN     00160053
001214*   CHANGED TO SE UM RECORD.                                      00170060
001220******************************************************************00180003
001230 ENVIRONMENT DIVISION.                                            00190004
001240 CONFIGURATION SECTION.                                           00200004
001250                                                                  00210004
001260 SOURCE-COMPUTER.        IBM-3090.                                00220004
001270 OBJECT-COMPUTER.        IBM-3090.                                00230004
001280                                                                  00240004
001290 INPUT-OUTPUT SECTION.                                            00250004
001300 FILE-CONTROL.                                                    00260004
001400                                                                  00270004
001500     SELECT UNLOAD-MEMO-INP-FILE                                  00280012
001600         ASSIGN TO IN01.                                          00290004
001700                                                                  00300004
001800     SELECT UNLOAD-MEMO-OUT-FILE                                  00310012
001900         ASSIGN TO OUT01.                                         00320004
002000                                                                  00330004
002100******************************************************************00340004
002200 DATA DIVISION.                                                   00350004
002300 FILE SECTION.                                                    00360004
002400                                                                  00370004
002500 FD  UNLOAD-MEMO-INP-FILE                                         00380013
002600     RECORDING MODE IS F                                          00390004
002700     LABEL RECORDS ARE STANDARD                                   00400004
002800     BLOCK CONTAINS 0 RECORDS.                                    00410004
002900                                                                  00420004
003000 01  UNLOAD-MEMO-INP-RECORD  PIC  X(100).                         00430013
003100*                                                                 00440004
003200 FD  UNLOAD-MEMO-OUT-FILE                                         00450013
003300     RECORDING MODE IS F                                          00460004
003400     LABEL RECORDS ARE STANDARD                                   00470004
003500     BLOCK CONTAINS 0 RECORDS.                                    00480004
003600                                                                  00490004
003700 01  UNLOAD-MEMO-OUT-RECORD PIC  X(100).                          00500013
003701*                                                                 00510051
003900******************************************************************00520004
004000 WORKING-STORAGE SECTION.                                         00530004
004100******************************************************************00540004
004200******************************************************************00550004
004300*  UNLOAD MEMO OUTPUT FILE LAYOUT                                 00560013
004400******************************************************************00570004
004500     COPY PCRD010.                                                00580004
004600                                                                  00590004
004700******************************************************************00600004
004800*  COMMUNICATIONS AREA FOR DB2                                    00610004
004900******************************************************************00620004
005000     EXEC SQL                                                     00630004
005100          INCLUDE SQLCA                                           00640004
005200     END-EXEC.                                                    00650004
005300                                                                  00660004
005400******************************************************************00670004
005500*  PCT_TRN_CLSN_DTL TABLE                                         00680018
005600******************************************************************00690004
005700     EXEC SQL                                                     00700004
005800          INCLUDE PCT00015                                        00710014
005900     END-EXEC.                                                    00720004
006000                                                                  00730004
006720******************************************************************00740004
006730 01  PS-PROGRAM-SWITCHES.                                         00750004
006740     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     00760004
006750         88  PS-END-OF-FILE                        VALUE 'Y'.     00770004
006760         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     00780004
006770     05  PS-CL-STK-IN-TRANSIT-SW     PIC  X(01)    VALUE 'N'.     00790021
006780         88  PS-CL-ENTRY-FOUND                     VALUE 'Y'.     00800021
006790         88  PS-CL-ENTRY-NOT-FOUND                 VALUE 'N'.     00810021
007100                                                                  00820004
007200 01  PC-PROGRAM-CONSTANTS.                                        00830004
007300     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUT160'. 00840018
007400                                                                  00850004
007500 01  PV-PROGRAM-VARIABLES.                                        00860004
007600     05  PV-PARAGRAPH-NAME           PIC  X(30)     VALUE SPACES. 00870004
007700     05  PV-INTR-UPC-ID              PIC  S9(9) COMP VALUE ZEROS. 00880058
007800     05  PV-STR-NBR                  PIC  S9(4) COMP VALUE ZEROS. 00890058
007810     05  PV-PO-NBR                   PIC  S9(9) COMP VALUE ZEROS. 00900058
007820     05  PV-RCVR-SEQ-NBR             PIC  S9(9) COMP VALUE ZEROS. 00910058
007900     05  PV-READ-COUNT               PIC  9(9) COMP VALUE ZEROS.  00920004
008001     05  PV-WRITE-COUNT              PIC  9(9) COMP VALUE ZEROS.  00930000
008002     05  PV-MEMO-REC-COUNT           PIC  9(9) COMP VALUE ZEROS.  00940018
008003     05  PV-SE-REC-READ-COUNT        PIC  9(9) COMP VALUE ZEROS.  00950052
008004     05  PV-IT-REC-READ-COUNT        PIC  9(9) COMP VALUE ZEROS.  00960052
008008     05  PV-DISPLAY-COUNT1           PIC  ZZZ,ZZZ,ZZ9.            00970018
008009     05  PV-DISPLAY-COUNT2           PIC  ZZZ,ZZZ,ZZ9.            00980001
008010     05  PV-DISPLAY-COUNT3           PIC  ZZZ,ZZZ,ZZ9.            00990018
008011     05  PV-DISPLAY-COUNT4           PIC  ZZZ,ZZZ,ZZ9.            01000052
008012     05  PV-DISPLAY-COUNT5           PIC  ZZZ,ZZZ,ZZ9.            01010052
008013     05  PV-DISPLAY-COUNT6           PIC  ZZZ,ZZZ,ZZ9.            01020052
008014     05  PV-DISPLAY-COUNT7           PIC  ZZZ,ZZZ,ZZ9.            01030052
008015     05  PV-DISPLAY-INTR-UPC-ID      PIC 9(9).                    01040066
008016     05  PV-DISPLAY-STR-NBR          PIC 9(4).                    01050067
008017     05  PV-DISPLAY-PO-NBR           PIC 9(9).                    01060067
008018     05  PV-DISPLAY-RCVR-SEQ-NBR     PIC 9(9).                    01070067
008019     05  PV-DISPLAY-SQLCODE          PIC  +999.                   01080001
008020                                                                  01090001
008021 01  PV-ABEND-CODE                    PIC S9(04)   VALUE ZERO     01100007
008022                                                   COMP SYNC.     01110007
008023 01  PV-ABEND-FIELDS.                                             01120007
008024     05  PV-ABEND-PROGRAM             PIC X(8)  VALUE 'SUKUT160'. 01130025
008025     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    01140004
008026     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    01150004
008027     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    01160004
008028     05  PV-ABEND-STRUCTURE-2         PIC X(20)  VALUE SPACES.    01170004
008029     05  PV-ABEND-STRUCTURE-3         PIC X(20)  VALUE SPACES.    01180004
008030     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    01190004
008031     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01200004
008032     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01210004
008033     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01220004
008034     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01230004
008035*  USED FOR DB2 ERROR MESSAGE BUILDING                            01240006
008036     COPY DPWS004.                                                01250006
008037******************************************************************01260001
008038 PROCEDURE DIVISION.                                              01270001
008039******************************************************************01280001
008040******************************************************************01290004
008041* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01300004
008042*      PROGRAM.                                                   01310004
008043******************************************************************01320004
008044 0000-PROGRAM-MAINLINE.                                           01330004
008045                                                                  01340004
008046     DISPLAY '***** SUKUT160 STARTED *****'.                      01350014
008047     DISPLAY '                       '.                           01360041
008048                                                                  01370004
008049     PERFORM 1000-INITIALIZE.                                     01380004
008050     PERFORM 2000-PROCESS-UNLOAD-FILE                             01390014
008051         UNTIL PS-END-OF-FILE                                     01400027
008052     PERFORM 9000-EOJ-ROUTINE.                                    01410004
008053                                                                  01420004
008054     STOP RUN.                                                    01430004
008055                                                                  01440004
008060******************************************************************01450004
008070*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01460004
008080*    -- OPEN INPUT FILE                                           01470004
008090*    -- OPEN OUTPUT FILE                                          01480004
008100*    -- READ INPUT FILE                                           01490004
008200******************************************************************01500004
008300 1000-INITIALIZE.                                                 01510004
008400                                                                  01520004
008500     OPEN INPUT  UNLOAD-MEMO-INP-FILE.                            01530014
008600     OPEN OUTPUT UNLOAD-MEMO-OUT-FILE.                            01540069
008710                                                                  01550052
008800     PERFORM 7000-READ-FILE.                                      01560004
008900                                                                  01570004
009000******************************************************************01580004
009100*  RETRIEVING RECORDS AND WRITE THOSE RECORDS INTO OUTPUT FILE    01590018
009200******************************************************************01600004
009300 2000-PROCESS-UNLOAD-FILE.                                        01610014
009400                                                                  01620004
009500     IF  (PC010-TRN-STR-EXPECTED AND                              01630071
009510         (PC010-UNLOAD-ST         OR                              01640071
164325          PC010-MISLOAD-UNLOAD    OR                              01650071
164325          PC010-ASSUMPTIVE-UNLOAD))                               01660071
009520         PERFORM 2100-FETCH-UNLOAD-DATA                           01670052
009530         IF  PS-CL-ENTRY-FOUND                                    01680052
164325             IF PC010-UNLOAD-ST                                   01690071
009540                SET PC010-UNLOAD-MEMO         TO TRUE             01700071
164325             END-IF                                               01710071
164325             IF PC010-MISLOAD-UNLOAD                              01720071
164325                SET PC010-MISLOAD-UNLOAD-MEMO TO TRUE             01730071
164325             END-IF                                               01740071
164325             IF PC010-ASSUMPTIVE-UNLOAD                           01750071
164325                SET PC010-ASSUMPT-UNLOAD-MEMO TO TRUE             01760071
164325             END-IF                                               01770071
009550             MOVE PC010-INTR-UPC-ID                               01780055
009560               TO PV-INTR-UPC-ID                                  01790056
009570             MOVE PC010-STR-NBR                                   01800055
009580               TO PV-STR-NBR                                      01810057
009590             MOVE PC010-PO-NBR                                    01820055
009600               TO PV-PO-NBR                                       01830056
009601             MOVE PC010-RCVR-SEQ-NBR                              01840055
009602               TO PV-RCVR-SEQ-NBR                                 01850056
009605             PERFORM 8000-WRITE-OUTPUT                            01860043
009608             ADD +1 TO PV-MEMO-REC-COUNT                          01870043
009612         ELSE                                                     01880016
009630             PERFORM 8000-WRITE-OUTPUT                            01890043
009720         END-IF                                                   01900016
009730     ELSE                                                         01910043
009731         PERFORM 8000-WRITE-OUTPUT                                01920055
009800     END-IF.                                                      01930004
010580     PERFORM 7000-READ-FILE.                                      01940004
010590                                                                  01950004
010600******************************************************************01960004
010700* FETCH RECORDS FROM PCT_TRN_CLSN_DTL TABLE FOR                   01970018
010800* SPECIFIED CRITERIA                                              01980018
010900******************************************************************01990004
011000 2100-FETCH-UNLOAD-DATA.                                          02000018
013500                                                                  02010004
013600     EXEC SQL                                                     02020004
013700          SELECT INTR_UPC_ID                                      02030030
013710               ,LOC_NBR                                           02040030
013720               ,TRN_CLSN_CDE                                      02050030
013730               ,TRN_TYP_CDE                                       02060030
013740               ,PO_NBR                                            02070030
013750               ,RCVR_SEQ_NBR                                      02080030
013760          INTO  :PCT00015-INTR-UPC-ID                             02090038
013770               ,:PCT00015-LOC-NBR                                 02100038
013780               ,:PCT00015-TRN-CLSN-CDE                            02110038
013790               ,:PCT00015-TRN-TYP-CDE                             02120038
013800               ,:PCT00015-PO-NBR                                  02130038
013810               ,:PCT00015-RCVR-SEQ-NBR                            02140038
013900          FROM   PCT_TRN_CLSN_DTL                                 02150033
014000          WHERE  TRN_CLSN_CDE = 'SE'                              02160030
014100           AND   TRN_TYP_CDE  = 'CL'                              02170039
014500           AND   INTR_UPC_ID  = :PC010-INTR-UPC-ID                02180039
014930           AND   LOC_NBR      = :PC010-STR-NBR                    02190039
014931           AND   PO_NBR       = :PC010-PO-NBR                     02200039
014932           AND   RCVR_SEQ_NBR = :PC010-RCVR-SEQ-NBR               02210039
014936        WITH UR                                                   02220030
014937     END-EXEC.                                                    02230030
014941                                                                  02240008
014944     EVALUATE TRUE                                                02250008
014945         WHEN (SQLCODE = -811  OR  SQLCODE = ZERO)                02260049
014946             SET  PS-CL-ENTRY-FOUND       TO TRUE                 02270047
014960         WHEN SQLCODE = +100                                      02280004
014961             SET  PS-CL-ENTRY-NOT-FOUND   TO  TRUE                02290049
014962         WHEN SQLWARN0 NOT = SPACES                               02300004
014963         WHEN SQLCODE < ZERO                                      02310004
014964         WHEN SQLCODE > ZERO                                      02320004
014966             MOVE  SQLCODE         TO  PV-DISPLAY-SQLCODE         02330004
014967             MOVE  '2100-FETCH-UNLOAD-DATA'                       02340018
014968                                   TO  PV-ABEND-PARAGRAPH         02350004
014969             MOVE 'SELECT PCT_TRN_CLSN_DTL'                       02360039
014970                                   TO PV-ABEND-OPERATION          02370004
014980             MOVE  PC010-INTR-UPC-ID                              02380066
014981               TO  PV-DISPLAY-INTR-UPC-ID                         02390066
014982             MOVE  PC010-STR-NBR                                  02400066
014983               TO  PV-DISPLAY-STR-NBR                             02410066
014984             MOVE  PC010-PO-NBR                                   02420066
014985               TO  PV-DISPLAY-PO-NBR                              02430066
014986             MOVE  PC010-RCVR-SEQ-NBR                             02440066
014987               TO  PV-DISPLAY-RCVR-SEQ-NBR                        02450066
014988             DISPLAY 'INTR UPC ID  :' PV-DISPLAY-INTR-UPC-ID      02460066
014989             DISPLAY 'STR NBR      :' PV-DISPLAY-STR-NBR          02470066
014990             DISPLAY 'PO NBR       :' PV-DISPLAY-PO-NBR           02480066
014991             DISPLAY 'RCVR SEQ NBR :' PV-DISPLAY-RCVR-SEQ-NBR     02490066
014992             DISPLAY 'INPUT REC COUNT :' PV-READ-COUNT            02500066
014993             PERFORM 9900-DB2-ABEND                               02510004
015000     END-EVALUATE.                                                02520004
015147                                                                  02530004
015164******************************************************************02540004
015165*  READ INPUT FILE.                                               02550004
015166******************************************************************02560004
015167 7000-READ-FILE.                                                  02570004
015168      INITIALIZE PC010-PCT-INTRANSIT-REC.                         02580004
015169                                                                  02590004
015170      READ UNLOAD-MEMO-INP-FILE INTO                              02600017
015180          PC010-PCT-INTRANSIT-REC                                 02610004
015190            AT END SET PS-END-OF-FILE TO TRUE.                    02620004
015200                                                                  02630004
015300      IF PS-END-OF-FILE                                           02640004
015400         CONTINUE                                                 02650004
015500      ELSE                                                        02660004
016200         ADD +1 TO PV-READ-COUNT                                  02670004
016300         IF PC010-TRN-STR-EXPECTED                                02680055
016400            ADD +1 TO PV-SE-REC-READ-COUNT                        02690055
016500         END-IF                                                   02700056
016600         IF PC010-TRN-IN-TRANSIT                                  02710056
016610            ADD +1 TO PV-IT-REC-READ-COUNT                        02720056
016620         END-IF                                                   02730056
016630      END-IF.                                                     02740004
016640                                                                  02750004
016650******************************************************************02760004
016660*  WRITE OUTPUT FILE.                                             02770004
016670******************************************************************02780004
016680 8000-WRITE-OUTPUT.                                               02790004
016690                                                                  02800004
016700     WRITE UNLOAD-MEMO-OUT-RECORD FROM                            02810019
016800         PC010-PCT-INTRANSIT-REC.                                 02820004
016900                                                                  02830004
017000     ADD +1 TO PV-WRITE-COUNT.                                    02840004
017100                                                                  02850004
017200******************************************************************02860004
017300*  CLOSE INPUT FILE.  DISPLAY COUNTS.                             02870004
017400******************************************************************02880004
017500 9000-EOJ-ROUTINE.                                                02890004
017600     CLOSE UNLOAD-MEMO-INP-FILE                                   02900017
017700           UNLOAD-MEMO-OUT-FILE.                                  02910069
017810                                                                  02920053
018300     MOVE PV-READ-COUNT              TO  PV-DISPLAY-COUNT1.       02930053
018400     DISPLAY 'TOTAL RECORDS READ         : ' PV-DISPLAY-COUNT1.   02940053
018500                                                                  02950004
018510     DISPLAY '                       '.                           02960004
018520                                                                  02970004
018521     MOVE PV-SE-REC-READ-COUNT       TO  PV-DISPLAY-COUNT2.       02980053
018522     DISPLAY 'TOTAL INPUT SE RECORDS READ: ' PV-DISPLAY-COUNT2.   02990053
018523                                                                  03000053
018524     DISPLAY '                       '.                           03010053
018525                                                                  03020053
018526     MOVE PV-IT-REC-READ-COUNT       TO  PV-DISPLAY-COUNT3.       03030053
018527     DISPLAY 'TOTAL INPUT IT RECORDS READ: ' PV-DISPLAY-COUNT3.   03040053
018528                                                                  03050053
018529     DISPLAY '                       '.                           03060053
018530                                                                  03070053
018531     MOVE PV-MEMO-REC-COUNT          TO  PV-DISPLAY-COUNT4.       03080053
018540     DISPLAY 'TOTAL MEMO RECORDS CHANGED : ' PV-DISPLAY-COUNT4.   03090053
018550                                                                  03100053
018560     DISPLAY '                       '.                           03110053
018561                                                                  03120053
018931     MOVE PV-WRITE-COUNT             TO  PV-DISPLAY-COUNT6.       03130053
018932     DISPLAY 'TOTAL RECORDS WRITTEN TO OUTPUT FILE1 :'            03140053
018933              PV-DISPLAY-COUNT6.                                  03150053
018934                                                                  03160053
018944     DISPLAY '                       '.                           03170004
018945     DISPLAY '*****  SUKUT160 ENDED  *****'.                      03180018
018946                                                                  03190004
018948 9900-DB2-ABEND.                                                  03200004
018949     MOVE SQLCODE TO PV-DISPLAY-SQLCODE.                          03210039
018950     DISPLAY 'SQLCODE...........: ' PV-DISPLAY-SQLCODE.           03220039
018951                                                                  03230004
018952     DISPLAY '*** DB2 ERROR '.                                    03240004
018953     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               03250039
018960     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 03260039
018970     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               03270004
018980     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               03280004
018990     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       03290004
019000     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       03300004
019100     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       03310004
019200     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             03320004
019400                                                                  03330004
019600                                                                  03340004
019700     COPY DPPD004.                                                03350004
019800                                                                  03360004
019900     IF SQLCODE NOT = -911                                        03370004
020000         EXEC SQL                                                 03380004
020100              ROLLBACK                                            03390004
020200         END-EXEC                                                 03400004
020300     END-IF.                                                      03410004
020400                                                                  03420004
020500     MOVE +4013                  TO PV-ABEND-CODE.                03430004
020600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         03440004
020700                                                                  03450004
