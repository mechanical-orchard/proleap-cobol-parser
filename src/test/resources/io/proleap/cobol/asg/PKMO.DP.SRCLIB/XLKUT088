000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.       XLKUT088.                                      00050000
000600 AUTHOR.           GERMAN BANDA.                                  00060000
000700 INSTALLATION.     KOHLS.                                         00070000
000800 DATE-WRITTEN      APRIL, 2005.                                   00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  PROGRAM REQUESTS FOR SKU/STORE ONHAND.                         00120000
001300*      PROGRAMS WILL CALL THIS DRIVER MODULE WHEN REQUESTING      00130000
001400*      ONHAND DATA. THIS MODULE WILL THEN                         00140000
001500*      CALL THE APPROPRIATE MODULE(S) TO ACQUIRE THE DATA.        00150000
001510*                                                                 00151000
001520*  PLEASE NOTE THAT WHEN LINKING TO THIS MODULE THE CALLING       00152000
001530*  PROGRAM'S DB2 PLAN MUST INCLUDE THE XM COLLECTION ID.          00153000
001540*                                                                 00154000
001550******************************************************************00155000
001560                                                                  00156000
001570******************************************************************00157000
001580 ENVIRONMENT DIVISION.                                            00158000
001590******************************************************************00159000
001600                                                                  00160000
001700******************************************************************00170000
001800 DATA DIVISION.                                                   00180000
001900******************************************************************00190000
002000                                                                  00200000
002100 WORKING-STORAGE SECTION.                                         00210000
002200                                                                  00220000
002210*----------------------------------------------------------------*00221000
002220*  DB2 KEYS                                                      *00222000
002230*----------------------------------------------------------------*00223000
002240 01  DK-DB2-KEYS.                                                 00224000
002250     05  DK-PRC-MSG-CDE                  PIC  X(02).              00225000
002260                                                                  00226000
002270 01  PC-PROGRAM-CONSTANTS.                                        00227000
002280     05  PC-ONHAND-PROGRAM      PIC  X(08)  VALUE 'XMKCS002'.     00228000
002290     05  PC-SMOOTHING-PROCESS   PIC  X(08)  VALUE 'PCKCS728'.     00229000
002300     05  PC-DEFAULT-TMST        PIC X(26)  VALUE                  00230000
002400                                  '0001-01-01-01.01.01.000000'.   00240000
002500     05  PC-DEFAULT-RCVD-DTE    PIC X(10)  VALUE                  00250000
002501                                  '2000-00-00'.                   00250100
002502     05  PC-RP                  PIC  X(02)  VALUE 'RP'.           00250200
002503     05  PC-NS                  PIC  X(02)  VALUE 'NS'.           00250300
002504     05  PC-RF                  PIC  X(02)  VALUE 'RF'.           00250400
002505     05  PC-RD                  PIC  X(02)  VALUE 'RD'.           00250508
002506                                                                  00250608
002507 01  PS-PROGRAM-SWITCHES.                                         00250708
002508     05  PS-CARTON-UPC-CSR-SW            PIC  X(01)  VALUE 'N'.   00250808
002509         88  PS-EO-CRTN-UPC-CSR                      VALUE 'Y'.   00250908
002510         88  PS-NOT-EO-CRTN-UPC-CSR                  VALUE 'N'.   00251008
002511     05  PS-LINE-ITEM-CSR-SW             PIC  X(01)  VALUE 'N'.   00251108
002520         88  PS-EO-LINE-ITEM-CSR                     VALUE 'Y'.   00252000
002530         88  PS-NOT-EO-LINE-ITEM-CSR                 VALUE 'N'.   00253000
002540     05  PS-PRC-MSG-INSERT-CSR           PIC  X(01)  VALUE 'N'.   00254000
002541         88  PS-EO-PRC-MSG-INSRT-CSR                 VALUE 'Y'.   00254100
002542         88  PS-NOT-EO-PRC-MSG-INSRT-CSR             VALUE 'N'.   00254200
002543     05  PS-ZERO-BALANCE-ON-HND-SW       PIC  X(01)  VALUE 'N'.   00254300
002544         88  PS-ZERO-BOH-UPC-YES                     VALUE 'Y'.   00254400
002545         88  PS-ZERO-BOH-UPC-NO                      VALUE 'N'.   00254500
002546     05  PS-CHECK-STORE-BOH-SW           PIC  X(01)  VALUE 'N'.   00254600
002547         88  PS-CHCK-STORE-BOH-YES                   VALUE 'Y'.   00254700
002548         88  PS-CHCK-STORE-BOH-NO                    VALUE 'N'.   00254800
002549     05  PS-FETCH-CRTN-CURSOR-SW         PIC  X(01)  VALUE 'C'.   00254900
002550         88  PS-CRTN-CSR-CLEARANCE                   VALUE 'C'.   00255000
002560         88  PS-CRTN-CSR-BAL-ON-HAND                 VALUE 'B'.   00256000
002570     05  PS-NEW-STORE-SW                 PIC  X(01)  VALUE 'N'.   00257000
002580         88  PS-NEW-STORE-FOUND                      VALUE 'Y'.   00258000
002590         88  PS-NO-NEW-STORE-FOUND                   VALUE 'N'.   00259000
002591     05  PS-PREV-PROCESS-MSG-FND-SW      PIC  X(01)  VALUE 'N'.   00259100
002592         88  PS-PREV-PROCESS-MSG-FND-YES             VALUE 'Y'.   00259200
002593         88  PS-PREV-PROCESS-MSG-FND-NO              VALUE 'N'.   00259300
002594     05  PS-CLEARANCE-ITEM-SW            PIC  X(01)  VALUE 'N'.   00259400
002595         88  PS-CLEARANCE-ITEM-YES                   VALUE 'Y'.   00259500
002596         88  PS-CLEARANCE-ITEM-NO                    VALUE 'N'.   00259600
002597     05  PS-PROCESS-INSERT-NEEDED-SW     PIC  X(01)  VALUE 'N'.   00259700
002598         88  PS-PROCESS-INSERT-NEEDED                VALUE 'Y'.   00259800
002599         88  PS-PROCESS-INSERT-NOT-NEEDED            VALUE 'N'.   00259900
002600 01  PV-PROGRAM-VARIABLES.                                        00260000
002601     05  PV-DISPLAY-SQLCODE              PIC -9(05) VALUE ZEROES. 00260100
002602     05  PV-DISPLAY-ITM-NBR              PIC   9(15).             00260200
002603     05  PV-DISPLAY-INTR-UPC             PIC   9(15).             00260300
002604     05  PV-DISPLAY-UPC-NBR              PIC   9(15).             00260400
002605     05  PV-DISPLAY-SKU-NBR              PIC   9(09).             00260500
002606     05  PV-DISPLAY-CARTON               PIC   9(20).             00260600
002607     05  PV-DISPLAY-STORE                PIC   9(9).              00260700
002608     05  PV-DISPLAY-PO                   PIC   9(9).              00260800
002609     05  PV-DISPLAY-RCVR                 PIC   9(4).              00260900
002610                                                                  00261000
002620     05  PV-CICS-MSG-AREA       PIC  X(100) VALUE SPACE.          00262000
002630     05  PV-COMMAREA-LENGTH     PIC S9(04)  VALUE +0              00263000
002640                                            COMP SYNC.            00264000
002650     05  PV-CICS-RESPONSE       PIC S9(08)  VALUE ZEROS           00265000
002660                                            COMP SYNC.            00266000
002670     05  PV-SKU                 PIC S9(8)V  VALUE ZEROS           00267000
002680                                            COMP-3.               00268000
002690     05  PV-FSHN-ON-HAND-WORK   PIC S9(9) COMP.                   00269000
002700                                                                  00270000
002800     05  PV-STORE-EXP-WORK      PIC S9(9) COMP.                   00280000
002900                                                                  00290000
003000     05  PV-BAL-ON-HAND-WRK     PIC S9(9) COMP.                   00300000
003100                                                                  00310000
003200     05  PV-OTBND-CRTN          PIC  9(20)  VALUE ZEROS.          00320000
003300                                                                  00330000
003310     05  PV-DB2-NEW-STR-CNT     PIC S9(09)  VALUE ZEROS           00331000
003320                                            COMP SYNC.            00332000
003330     05  PV-PREV-PROC-MSG-CNT   PIC S9(09)  VALUE ZEROS           00333000
003340                                            COMP SYNC.            00334000
003341                                                                  00334100
003342                                                                  00334200
003343 01  PV-BOH-BY-STORE-WORK-AREA.                                   00334300
003344     05  PV-STORE-01                    PIC X(04)   VALUE SPACE.  00334400
003345     05  PV-STORE-01-N REDEFINES PV-STORE-01    PIC  9(04).       00334500
003346     05  PV-STORE-02                    PIC X(04)   VALUE SPACE.  00334600
003347     05  PV-STORE-02-N REDEFINES PV-STORE-02    PIC  9(04).       00334700
003348     05  PV-STORE-03                    PIC X(04)   VALUE SPACE.  00334800
003349     05  PV-STORE-03-N REDEFINES PV-STORE-03    PIC  9(04).       00334900
003350     05  PV-STORE-04                    PIC X(04)   VALUE SPACE.  00335000
003351     05  PV-STORE-04-N REDEFINES PV-STORE-04    PIC  9(04).       00335100
003352     05  PV-STORE-05                    PIC X(04)   VALUE SPACE.  00335200
003353     05  PV-STORE-05-N REDEFINES PV-STORE-05    PIC  9(04).       00335300
003354     05  PV-STORE-06                    PIC X(04)   VALUE SPACE.  00335400
003355     05  PV-STORE-06-N REDEFINES PV-STORE-06    PIC  9(04).       00335500
003356     05  FILLER                         PIC X(01)   VALUE SPACE.  00335600
003357                                                                  00335700
003358                                                                  00335800
003359*---------------------------------------------------------------  00335900
003360*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE XLT_SKU            00336000
003370*---------------------------------------------------------------  00337000
003380     EXEC SQL                                                     00338000
003390         INCLUDE XLT00003                                         00339000
003400     END-EXEC.                                                    00340000
003500                                                                  00350000
003501*---------------------------------------------------------------  00350100
003502*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE XLT_UPC            00350200
003503*---------------------------------------------------------------  00350300
003504     EXEC SQL                                                     00350400
003505         INCLUDE XLT00006                                         00350500
003506     END-EXEC.                                                    00350600
003507                                                                  00350700
003508*---------------------------------------------------------------  00350800
003509*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE OTBND CRTN TABLE   00350900
003510*---------------------------------------------------------------  00351000
003520     EXEC SQL                                                     00352000
003530         INCLUDE SUT00024                                         00353000
003540     END-EXEC.                                                    00354000
003550                                                                  00355000
003560*---------------------------------------------------------------  00356000
003570*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE OTBND UPC TABLE    00357000
003580*---------------------------------------------------------------  00358000
003590     EXEC SQL                                                     00359000
003591         INCLUDE SUT00028                                         00359100
003592     END-EXEC.                                                    00359200
003593                                                                  00359300
003594*----------------------------------------------------------------*00359400
003595* SQL AND COBOL DECLARATIONS FOR PARMS (TKRPRPM)                  00359500
003596*----------------------------------------------------------------*00359600
003597     EXEC SQL                                                     00359700
003598         INCLUDE TKRPRPM                                          00359800
003599     END-EXEC.                                                    00359900
003600*----------------------------------------------------------------*00360000
003601* SQL AND COBOL DECLARATIONS FOR LOCATION TABLE (XLT_LOC)         00360100
003602*----------------------------------------------------------------*00360200
003603     EXEC SQL                                                     00360300
003604         INCLUDE XLT00010                                         00360400
003605     END-EXEC.                                                    00360500
003606*----------------------------------------------------------------*00360600
003607* SQL AND COBOL DECLARATIONS FOR PROCESS MESSAGE CONTROL          00360700
003608* TABLE (SUT_PRC_MSG_CNTL)                                        00360800
003609*----------------------------------------------------------------*00360900
003610     EXEC SQL                                                     00361000
003611         INCLUDE SUT00094                                         00361100
003612     END-EXEC.                                                    00361200
003613*----------------------------------------------------------------*00361300
003614* SQL AND COBOL DECLARATIONS FOR PROCESS MESSAGE CONTROL          00361400
003615* TABLE (SUT_PRC_MSG_CDE)                                         00361500
003616*----------------------------------------------------------------*00361600
003617     EXEC SQL                                                     00361700
003618         INCLUDE SUT00093                                         00361800
003619     END-EXEC.                                                    00361900
003626*----------------------------------------------------------------*00362603
003627* SQL AND COBOL DECLARATIONS                                      00362703
003628*----------------------------------------------------------------*00362803
003629     EXEC SQL                                                     00362903
003630         INCLUDE TUPCPLS                                          00363003
003631     END-EXEC.                                                    00363103
003632*----------------------------------------------------------------*00363203
003633* SQL AND COBOL DECLARATIONS FOR RECEIVER ITEM TABLE              00363303
003634*----------------------------------------------------------------*00363403
003635     EXEC SQL                                                     00363503
003636         INCLUDE TRECITM                                          00363603
003637     END-EXEC.                                                    00363703
003638*----------------------------------------------------------------*00363803
003639* SQL AND COBOL DECLARATIONS FOR RECEIVER STORE DISTRIBUTION TABLE00363903
003640*----------------------------------------------------------------*00364003
003641     EXEC SQL                                                     00364103
003642         INCLUDE TRECDIS                                          00364203
003643     END-EXEC.                                                    00364303
003644*----------------------------------------------------------------*00364403
003645* COMMAREA USED WHEN LINKING FROM A CALLING PROGRAM               00364503
003646*----------------------------------------------------------------*00364603
003650     COPY XMWS003.                                                00365000
003660                                                                  00366000
003670*----------------------------------------------------------------*00367000
003680* COMMAREA USED WHEN LINKING TO STORE EXPECTED MODULE             00368000
003690*----------------------------------------------------------------*00369000
003700     COPY XLWS074.                                                00370000
003800                                                                  00380000
003900*---------------------------------------------------------------  00390000
004000*  COMMUNICATIONS AREA FOR DB2                                    00400000
004100*---------------------------------------------------------------  00410000
004200     EXEC SQL                                                     00420000
004300         INCLUDE SQLCA                                            00430000
004400     END-EXEC.                                                    00440000
004500                                                                  00450000
004600*---------------------------------------------------------------* 00460000
004700*  CURSOR TO RETURN THE UPC'S FROM AN OUTBOUND CARTON           * 00470000
004800*  SUT_OTBND_UPC (SUT00028)                                       00480000
004810*---------------------------------------------------------------* 00481000
004820     EXEC SQL                                                     00482000
004830          DECLARE OTBND_CRTN_UPC_CSR CURSOR FOR                   00483000
004840           SELECT DISTINCT(UPC_NBR)                               00484000
004850                , TRN_LNE_NBR                                     00485000
004860           FROM SUT_OTBND_CART A                                  00486000
004870              , SUT_OTBND_UPC  B                                  00487000
004880           WHERE A.SHIPT_UNT_ID = B.SHIPT_UNT_ID                  00488000
004890             AND B.SHIPT_UNT_ID = :SUT00028-SHIPT-UNT-ID          00489000
004891             AND A.ACTV_IND     = 'Y'                             00489100
004892             AND B.SHPD_UNT_QTY > 0                               00489200
004893           ORDER BY TRN_LNE_NBR                                   00489300
004894          WITH UR                                                 00489407
004895     END-EXEC                                                     00489500
004896                                                                  00489600
004897*---------------------------------------------------------------* 00489700
004898*  CURSOR TO RETURN THE UPC'S FROM AN OUTBOUND CARTON           * 00489800
004899*  SUT_OTBND_UPC (SUT00028)                                       00489900
004900*---------------------------------------------------------------* 00490000
004901     EXEC SQL                                                     00490100
004910          DECLARE PRC_MSG_INS_CSR CURSOR FOR                      00491000
004920           SELECT DISTINCT(UPC_NBR)                               00492000
004930                , TRN_LNE_NBR                                     00493000
004940           FROM SUT_OTBND_CART A                                  00494000
004950              , SUT_OTBND_UPC  B                                  00495000
004960           WHERE A.SHIPT_UNT_ID = B.SHIPT_UNT_ID                  00496000
004970             AND B.SHIPT_UNT_ID = :SUT00028-SHIPT-UNT-ID          00497000
004980             AND A.ACTV_IND     = 'Y'                             00498000
004990             AND B.SHPD_UNT_QTY > 0                               00499000
004991           ORDER BY TRN_LNE_NBR                                   00499100
004992          WITH UR                                                 00499207
004993     END-EXEC                                                     00499300
004994*----------------------------------------------------------------*00499400
004995*  CURSOR TO DETERMINE LINE/ITEMS FOR SMOOTHED CARTONS        *   00499500
004996*----------------------------------------------------------------*00499600
004997     EXEC SQL                                                     00499700
004998          DECLARE LINE_ITEM_CSR CURSOR WITH HOLD FOR              00499800
004999          SELECT   A.ORD_LNE_NBR                                  00499900
005000                 , A.ITM_NBR                                      00500000
005001           FROM    TRECITM A                                      00500100
005002                 , TRECDIS B                                      00500200
005003           WHERE     A.ORD_NBR        = :RECITM-ORD-NBR           00500300
005004              AND    A.REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR       00500400
005005              AND    B.STR_NBR        = :RECDIS-STR-NBR           00500500
005006              AND    A.ORD_NBR        =  B.ORD_NBR                00500600
005007              AND    A.ORD_LNE_NBR    =  B.ORD_LNE_NBR            00500700
005008              AND    A.REC_SEQ_NBR    =  B.REC_SEQ_NBR            00500800
005009              AND    A.VER_STATUS_CDE = 'A'                       00500900
005011           GROUP BY                                               00501100
005012                  A.ORD_LNE_NBR                                   00501200
005013                , A.ITM_NBR                                       00501300
005014          WITH UR                                                 00501407
005015     END-EXEC.                                                    00501500
005016                                                                  00501600
005017 LINKAGE SECTION.                                                 00501700
005018     COPY XLWS088.                                                00501800
005019                                                                  00501900
005020******************************************************************00502000
005021 PROCEDURE DIVISION USING XL088-ITEM-COMMAREA.                    00502100
005022******************************************************************00502200
005023                                                                  00502300
005030     SET XL088-SUCCESSFUL             TO TRUE.                    00503000
005040     SET XL088-ONHAND-ERROR-N         TO TRUE.                    00504000
005050     SET XL088-NO-PROCESS-MESSAGE     TO TRUE.                    00505000
005060     SET PS-PROCESS-INSERT-NOT-NEEDED                             00506000
005070         PS-CLEARANCE-ITEM-NO         TO TRUE                     00507000
005080                                                                  00508000
005090     MOVE XL088-KEY-PO                TO SUT00094-PO-NBR          00509000
005100                                         RECITM-ORD-NBR.          00510000
005200     MOVE XL088-KEY-REC-SEQ-NBR       TO SUT00094-RCVR-SEQ-NBR    00520000
005300                                         RECITM-REC-SEQ-NBR.      00530000
005400     MOVE XL088-KEY-STR-NBR           TO SUT00094-DEST-LOC-NBR    00540000
005500                                         RECDIS-STR-NBR           00550000
005600     MOVE XL088-OTBND-CRTN            TO SUT00094-SHIPT-UNT-ID    00560000
005700                                                                  00570000
005800     PERFORM 0400-CHECK-DC-STORE-DISTR.                           00580000
005900                                                                  00590000
006000     IF PS-CHCK-STORE-BOH-NO                                      00600000
006100        PERFORM 0500-CHECK-DC-STORE-PARM                          00610000
006200        IF KRPRPM-FUNC-BEG-TMST = PC-DEFAULT-TMST                 00620000
006210           PERFORM 0600-CHECK-PARM-BY-STORE                       00621000
006220        ELSE                                                      00622000
006221           SET PS-CHCK-STORE-BOH-YES TO TRUE                      00622100
006222        END-IF                                                    00622200
006223     END-IF.                                                      00622300
006224                                                                  00622400
006225     IF PS-CHCK-STORE-BOH-YES                                     00622500
006226        PERFORM 0700-SEL-LOCATION-OPN-DTE                         00622600
006227        IF PS-NO-NEW-STORE-FOUND                                  00622700
006228           PERFORM 0800-SEL-PRC-QTY-CURR-STR                      00622800
006229           MOVE PC-RP   TO DK-PRC-MSG-CDE                         00622900
006230        ELSE                                                      00623000
006240           PERFORM 0850-SEL-PRC-QTY-NEW-STR                       00624000
006250           MOVE PC-NS   TO DK-PRC-MSG-CDE                         00625000
006260        END-IF                                                    00626000
006270     END-IF.                                                      00627000
006280                                                                  00628000
006290     IF PS-CHCK-STORE-BOH-YES                                     00629000
006300        IF XL088-CALLING-PROGRAM = PC-SMOOTHING-PROCESS           00630000
006310           PERFORM 0950-CHECK-PROCESS-MSG-SMTHG                   00631000
006320        ELSE                                                      00632000
006330           PERFORM 0900-CHECK-PROCESS-MSG                         00633000
006331        END-IF                                                    00633100
006332     END-IF.                                                      00633200
006333                                                                  00633300
006334     IF PS-PROCESS-INSERT-NEEDED AND XL088-SUCCESSFUL             00633400
006335        PERFORM 7000-LOAD-PROCESS-MSG                             00633500
006336     END-IF.                                                      00633600
006337                                                                  00633700
006338     GOBACK.                                                      00633800
006339                                                                  00633900
006340 0400-CHECK-DC-STORE-DISTR.                                       00634000
006350                                                                  00635000
006360       MOVE XL088-KEY-STR-NBR  TO XLT00010-LOC-NBR                00636000
006370                                                                  00637000
006380       EXEC SQL                                                   00638000
006390           SELECT  B.LOC_ID                                       00639000
006400             INTO  :KRPRPM-LOC-ID                                 00640000
006500           FROM XLT_LOC A                                         00650000
006600              , TKRPRPM B                                         00660000
006700           WHERE A.DIST_NBR  = B.LOC_ID                           00670000
006800             AND B.INTFC_SYS_CDE  = 'STR'                         00680000
006900             AND B.SYS_PRC_FUNC_CDE = 'PRCONH'                    00690000
007000             AND B.FUNC_BEG_TMST   < CURRENT TIMESTAMP            00700000
007100             AND B.FUNC_TXT        = 'Y'                          00710000
007200             AND A.LOC_NBR         = :XLT00010-LOC-NBR            00720000
007210            WITH UR                                               00721010
007300       END-EXEC.                                                  00730000
007400                                                                  00740000
007500       EVALUATE TRUE                                              00750000
007600           WHEN SQLCODE = ZERO                                    00760000
007700                SET PS-CHCK-STORE-BOH-YES  TO TRUE                00770000
007800           WHEN SQLCODE = +100                                    00780000
007900              SET PS-CHCK-STORE-BOH-NO                            00790000
008000                  XL088-ONHND-QTY-NOT-ZERO TO TRUE                00800000
008001           WHEN SQLWARN0 NOT = SPACES                             00800100
008002           WHEN SQLCODE < ZERO                                    00800200
008003           WHEN SQLCODE > ZERO                                    00800300
008004                SET XL088-ONHAND-ERROR-Y TO TRUE                  00800400
008005                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                00800500
008006                STRING   ' XLKUT088-0400-'                        00800600
008007                        ' CALLED BY-'                             00800700
008008                        XL088-CALLING-PROGRAM                     00800800
008009                        ' SQLCODE= '                              00800900
008010                        PV-DISPLAY-SQLCODE                        00801000
008011                        ' INTRN UPC'                              00801100
008012                        PV-DISPLAY-INTR-UPC                       00801200
008013                        DELIMITED BY SIZE                         00801300
008014                                        INTO PV-CICS-MSG-AREA     00801400
008015                PERFORM 9999-WRITE-TO-CSSL                        00801500
008016                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   00801600
008017               SET XL088-NOT-SUCCESSFUL TO TRUE                   00801700
008018               MOVE SQLCODE TO XL088-RETURN-SQLCODE               00801800
008019       END-EVALUATE.                                              00801900
008020                                                                  00802000
008021 0500-CHECK-DC-STORE-PARM.                                        00802100
008022                                                                  00802200
008023       EXEC SQL                                                   00802300
008024           SELECT  FUNC_TXT                                       00802400
008025                ,  FUNC_BEG_TMST                                  00802500
008026             INTO  :KRPRPM-FUNC-TXT                               00802600
008027                 , :KRPRPM-FUNC-BEG-TMST                          00802700
008028             FROM  TKRPRPM                                        00802800
008029            WHERE SYS_PRC_FUNC_CDE   = 'BALONH'                   00802900
008030              AND FUNC_PRC_STAT_CDE  =  'AC'                      00803000
008040              AND LOC_ID             =  090                       00804000
008041             WITH UR                                              00804110
008050       END-EXEC.                                                  00805000
008060                                                                  00806000
008070       EVALUATE TRUE                                              00807000
008080           WHEN SQLCODE = ZERO                                    00808000
008090                CONTINUE                                          00809000
008100           WHEN SQLWARN0 NOT = SPACES                             00810000
008110           WHEN SQLCODE < ZERO                                    00811000
008120           WHEN SQLCODE > ZERO                                    00812000
008130                SET XL088-ONHAND-ERROR-Y TO TRUE                  00813000
008140                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                00814000
008150                STRING   ' XLKUT088-0500-'                        00815000
008160                        ' CALLED BY-'                             00816000
008170                        XL088-CALLING-PROGRAM                     00817000
008180                        ' SQLCODE= '                              00818000
008190                        PV-DISPLAY-SQLCODE                        00819000
008191                        ' INTRN UPC'                              00819100
008192                        PV-DISPLAY-INTR-UPC                       00819200
008193                        DELIMITED BY SIZE                         00819300
008194                                        INTO PV-CICS-MSG-AREA     00819400
008195                PERFORM 9999-WRITE-TO-CSSL                        00819500
008196                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   00819600
008197               SET XL088-NOT-SUCCESSFUL TO TRUE                   00819700
008198               MOVE SQLCODE TO XL088-RETURN-SQLCODE               00819800
008199       END-EVALUATE.                                              00819900
008200                                                                  00820000
008201 0600-CHECK-PARM-BY-STORE.                                        00820100
008202                                                                  00820200
008203     MOVE KRPRPM-FUNC-TXT   TO PV-BOH-BY-STORE-WORK-AREA.         00820300
008204                                                                  00820400
008205     IF (XL088-KEY-STR-NBR  = PV-STORE-01-N OR                    00820500
008206         XL088-KEY-STR-NBR  = PV-STORE-02-N OR                    00820600
008207         XL088-KEY-STR-NBR  = PV-STORE-03-N OR                    00820700
008208         XL088-KEY-STR-NBR  = PV-STORE-04-N OR                    00820800
008209         XL088-KEY-STR-NBR  = PV-STORE-05-N OR                    00820900
008210         XL088-KEY-STR-NBR  = PV-STORE-06-N)                      00821000
008220           SET PS-CHCK-STORE-BOH-YES TO TRUE                      00822000
008221     ELSE                                                         00822100
008222         SET PS-CHCK-STORE-BOH-NO                                 00822200
008223             XL088-ONHND-QTY-NOT-ZERO TO TRUE                     00822300
008224     END-IF.                                                      00822400
008225                                                                  00822500
008226 0700-SEL-LOCATION-OPN-DTE.                                       00822600
008227     MOVE ZEROES               TO PV-DB2-NEW-STR-CNT.             00822700
008228     SET PS-NO-NEW-STORE-FOUND TO TRUE                            00822800
008229     MOVE XL088-KEY-STR-NBR  TO XLT00010-LOC-NBR.                 00822900
008230                                                                  00823000
008240     EXEC SQL                                                     00824000
008250        SELECT COUNT(*)                                           00825000
008260          INTO :PV-DB2-NEW-STR-CNT                                00826000
008270         FROM  XLT_LOC                                            00827000
008280         WHERE OPN_DTE    > CURRENT DATE                          00828000
008281          AND  LOC_NBR    = :XLT00010-LOC-NBR                     00828100
008282          AND  LOC_TYP_CDE = 'DS'                                 00828200
008283         WITH UR                                                  00828310
008284     END-EXEC.                                                    00828400
008285                                                                  00828500
008286     EVALUATE TRUE                                                00828600
008287         WHEN SQLCODE = ZERO                                      00828700
008288            IF PV-DB2-NEW-STR-CNT > 0                             00828800
008289               SET PS-NEW-STORE-FOUND TO TRUE                     00828900
008290            END-IF                                                00829000
008291         WHEN SQLWARN0 NOT = SPACES                               00829100
008292         WHEN SQLCODE < ZERO                                      00829200
008293         WHEN SQLCODE > ZERO                                      00829300
008294              SET XL088-ONHAND-ERROR-Y TO TRUE                    00829400
008295              MOVE SQLCODE TO PV-DISPLAY-STORE                    00829500
008296              MOVE XLT00010-LOC-NBR TO PV-DISPLAY-SQLCODE         00829600
008297              STRING   ' XLKUT088-0700-'                          00829700
008298                      ' CALLED BY-'                               00829800
008299                      XL088-CALLING-PROGRAM                       00829900
008300                      ' SQLCODE= '                                00830000
008301                      PV-DISPLAY-SQLCODE                          00830100
008302                      ' STORE NBR'                                00830200
008303                      PV-DISPLAY-STORE                            00830300
008304                      DELIMITED BY SIZE                           00830400
008305                                      INTO PV-CICS-MSG-AREA       00830500
008306              PERFORM 9999-WRITE-TO-CSSL                          00830600
008307              MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG     00830700
008308             SET XL088-NOT-SUCCESSFUL TO TRUE                     00830800
008309             MOVE SQLCODE TO XL088-RETURN-SQLCODE                 00830900
008310         END-EVALUATE.                                            00831000
008311                                                                  00831100
008312 0800-SEL-PRC-QTY-CURR-STR.                                       00831200
008313     MOVE ZEROES               TO KRPRPM-FUNC-QTY.                00831300
008314                                                                  00831400
008315     EXEC SQL                                                     00831500
008316        SELECT FUNC_QTY                                           00831600
008317         INTO  :KRPRPM-FUNC-QTY                                   00831700
008318         FROM  TKRPRPM A                                          00831800
008319         WHERE A.LOC_ID           = 090                           00831900
008320           AND A.INTFC_SYS_CDE    = 'KHL'                         00832000
008321           AND A.SYS_PRC_FUNC_CDE = 'PRCCUR'                      00832100
008330           AND A.FUNC_BEG_TMST    < CURRENT TIMESTAMP             00833000
008331          WITH UR                                                 00833110
008332     END-EXEC.                                                    00833200
008333                                                                  00833300
008334     EVALUATE TRUE                                                00833400
008335         WHEN SQLCODE = ZERO                                      00833500
008336            CONTINUE                                              00833600
008337         WHEN SQLCODE = +100                                      00833700
008338            MOVE ZEROES TO KRPRPM-FUNC-QTY                        00833800
008339         WHEN SQLWARN0 NOT = SPACES                               00833900
008340         WHEN SQLCODE < ZERO                                      00834000
008341         WHEN SQLCODE > ZERO                                      00834100
008342              SET XL088-ONHAND-ERROR-Y TO TRUE                    00834200
008343              MOVE SQLCODE TO PV-DISPLAY-STORE                    00834300
008344              STRING   ' XLKUT088-0800-'                          00834400
008345                      ' CALLED BY-'                               00834500
008346                      XL088-CALLING-PROGRAM                       00834600
008347                      ' SQLCODE= '                                00834700
008348                      PV-DISPLAY-SQLCODE                          00834800
008349                      ' SELECT OF TKRPRPM '                       00834900
008350                      DELIMITED BY SIZE                           00835000
008351                                      INTO PV-CICS-MSG-AREA       00835100
008352              PERFORM 9999-WRITE-TO-CSSL                          00835200
008353              MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG     00835300
008354             SET XL088-NOT-SUCCESSFUL TO TRUE                     00835400
008355             MOVE SQLCODE TO XL088-RETURN-SQLCODE                 00835500
008356         END-EVALUATE.                                            00835600
008357                                                                  00835700
008358 0850-SEL-PRC-QTY-NEW-STR.                                        00835800
008359     MOVE ZEROES               TO KRPRPM-FUNC-QTY.                00835900
008360                                                                  00836000
008361     EXEC SQL                                                     00836100
008362        SELECT FUNC_QTY                                           00836200
008363         INTO  :KRPRPM-FUNC-QTY                                   00836300
008364         FROM  TKRPRPM A                                          00836400
008365         WHERE A.LOC_ID           = 090                           00836500
008366           AND A.INTFC_SYS_CDE    = 'KHL'                         00836600
008367           AND A.SYS_PRC_FUNC_CDE = 'PRCNEW'                      00836700
008368           AND A.FUNC_BEG_TMST    < CURRENT TIMESTAMP             00836800
008369          WITH UR                                                 00836910
008370     END-EXEC.                                                    00837000
008371                                                                  00837100
008372     EVALUATE TRUE                                                00837200
008373         WHEN SQLCODE = ZERO                                      00837300
008374            CONTINUE                                              00837400
008375         WHEN SQLCODE = +100                                      00837500
008376            MOVE ZEROES TO KRPRPM-FUNC-QTY                        00837600
008377         WHEN SQLWARN0 NOT = SPACES                               00837700
008378         WHEN SQLCODE < ZERO                                      00837800
008379         WHEN SQLCODE > ZERO                                      00837900
008380              SET XL088-ONHAND-ERROR-Y TO TRUE                    00838000
008381              MOVE SQLCODE TO PV-DISPLAY-STORE                    00838100
008382              STRING   ' XLKUT088-0850-'                          00838200
008383                      ' CALLED BY-'                               00838300
008384                      XL088-CALLING-PROGRAM                       00838400
008385                      ' SQLCODE= '                                00838500
008386                      PV-DISPLAY-SQLCODE                          00838600
008387                      ' SELECT OF TKRPRPM '                       00838700
008388                      DELIMITED BY SIZE                           00838800
008389                                      INTO PV-CICS-MSG-AREA       00838900
008390              PERFORM 9999-WRITE-TO-CSSL                          00839000
008391              MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG     00839100
008392             SET XL088-NOT-SUCCESSFUL TO TRUE                     00839200
008393             MOVE SQLCODE TO XL088-RETURN-SQLCODE                 00839300
008394         END-EVALUATE.                                            00839400
008395                                                                  00839500
008396 0900-CHECK-PROCESS-MSG.                                          00839600
008397                                                                  00839700
008398       IF KRPRPM-FUNC-QTY > 0                                     00839800
008399           PERFORM 4500-CHECK-PROCESS-MESSAGE                     00839900
008400           IF PS-PREV-PROCESS-MSG-FND-NO                          00840000
008401             IF XL088-BY-OTBND-CRTN                               00840100
008402                PERFORM 4000-PROCESS-CRTN-CSR-CLRNCE              00840200
008403                IF PS-CLEARANCE-ITEM-NO AND XL088-SUCCESSFUL      00840300
008404                   PERFORM 4050-PROCESS-CRTN-CSR-BOH              00840400
008405                   IF PS-PROCESS-INSERT-NEEDED                    00840500
008406                      PERFORM 6000-PROCESS-PRC-MSG-INSRT-CSR      00840600
008407                      SET PS-PROCESS-INSERT-NOT-NEEDED TO TRUE    00840700
008408                   END-IF                                         00840800
008409                END-IF                                            00840900
008410             END-IF                                               00841000
008411           ELSE                                                   00841100
008412              MOVE SUT00094-PRC-MSG-CDE TO XL088-PROCESS-MSG-CDE  00841200
008413              PERFORM 7100-SELECT-PROCESS-MSG-DESC                00841300
008414           END-IF                                                 00841400
008415       ELSE                                                       00841500
008416           SET XL088-NO-PROCESS-MESSAGE                           00841600
008417               PS-PROCESS-INSERT-NOT-NEEDED TO TRUE               00841700
008418       END-IF.                                                    00841800
008419                                                                  00841900
008420 0950-CHECK-PROCESS-MSG-SMTHG.                                    00842000
008421                                                                  00842100
008422       IF KRPRPM-FUNC-QTY > 0                                     00842200
008430           PERFORM 4500-CHECK-PROCESS-MESSAGE                     00843000
008440           IF PS-PREV-PROCESS-MSG-FND-NO                          00844000
008450              PERFORM 3200-PROCESS-LNE-ITM-CSR-CLR                00845000
008451              IF PS-CLEARANCE-ITEM-NO AND XL088-SUCCESSFUL        00845100
008452                 PERFORM 3250-PROCESS-CRTN-CSR-BOH                00845200
008453                 IF PS-PROCESS-INSERT-NEEDED                      00845300
008454                    PERFORM 6000-PROCESS-PRC-MSG-INSRT-CSR        00845400
008455                    SET PS-PROCESS-INSERT-NOT-NEEDED TO TRUE      00845500
008456                 END-IF                                           00845600
008457              END-IF                                              00845700
008458           ELSE                                                   00845800
008459              MOVE SUT00094-PRC-MSG-CDE TO XL088-PROCESS-MSG-CDE  00845900
008460              PERFORM 7100-SELECT-PROCESS-MSG-DESC                00846000
008461           END-IF                                                 00846100
008462       ELSE                                                       00846200
008463           SET XL088-NO-PROCESS-MESSAGE                           00846300
008464               PS-PROCESS-INSERT-NOT-NEEDED TO TRUE               00846400
008465       END-IF.                                                    00846500
008466                                                                  00846600
008467 1000-CALL-INTR-STREXP-MODULE.                                    00846700
008468       SET XL074-BY-STORE          TO TRUE                        00846800
008469       MOVE XL088-KEY-STR-NBR      TO XL074-KEY-LOC-NBR           00846900
008470       EVALUATE TRUE                                              00847000
008480          WHEN XL088-BY-UPC-NBR                                   00848000
008490             MOVE XL088-UPC-NBR   TO XL074-KEY-UPC-NBR            00849000
008500             SET XL074-BY-UPC-NBR TO TRUE                         00850000
008600          WHEN XL088-BY-ITEM                                      00860000
008700             MOVE XL088-ITEM-NBR TO XL074-KEY-ITEM-NBR            00870000
008800             SET XL074-BY-ITEM   TO TRUE                          00880000
008900          WHEN XL088-BY-SKU                                       00890000
009000             MOVE XL088-KEY-SKU TO XL074-KEY-SKU                  00900000
009100             SET XL074-BY-SKU   TO TRUE                           00910000
009200       END-EVALUATE                                               00920000
009300                                                                  00930000
009400       CALL XL074-ONLINE-PGM USING DFHEIBLK                       00940000
009500                                   XL074-COMMAREA                 00950000
009600                                   XL074-ITEM-COMMAREA.           00960000
009700                                                                  00970000
009710       EVALUATE TRUE                                              00971000
009711          WHEN XL074-SUCCESSFUL                                   00971100
009712               PERFORM 1500-CHECK-BAL-ON-HAND-QTY                 00971200
009713          WHEN XL074-INTR-UPC-NOT-FOUND                           00971300
009714          WHEN XL074-UPC-NOT-FOUND                                00971400
009715          WHEN XL074-ITEM-NBR-NOT-FOUND                           00971500
009716          WHEN XL074-SKU-NOT-FOUND                                00971600
009717               CONTINUE                                           00971700
009718          WHEN OTHER                                              00971800
009719             SET XL088-NOT-SUCCESSFUL TO TRUE                     00971900
009720             MOVE SQLCODE TO XL088-RETURN-SQLCODE                 00972000
009721       END-EVALUATE.                                              00972100
009722                                                                  00972200
009723 1500-CHECK-BAL-ON-HAND-QTY.                                      00972300
009724                                                                  00972400
009725     IF XL088-SUCCESSFUL                                          00972500
009726        IF NOT XL088-BY-ITEM                                      00972600
009727           PERFORM 2000-SELECT-ITEM-NBR                           00972700
009728           MOVE XLT00003-ITM-NBR     TO XL088-ITEM-NBR            00972800
009729        END-IF                                                    00972900
009730                                                                  00973000
009740        IF XL088-SUCCESSFUL                                       00974000
009750           PERFORM 8000-CALL-ONHAND-MODULE                        00975000
009760        END-IF                                                    00976000
009770                                                                  00977000
009780                                                                  00978000
009790        IF XL074-IT-QTY > 0                                       00979000
009800           SET XL088-ONHND-QTY-NOT-ZERO TO TRUE                   00980000
009810        ELSE                                                      00981000
009820          PERFORM 3000-CALC-BAL-ON-HAND                           00982000
009830          IF XL088-ONHND-QTY-ZERO                                 00983000
009840             IF (XM003-FIRST-RCVD-DATE = PC-DEFAULT-RCVD-DTE) OR  00984000
009841                (XM003-FIRST-RCVD-DATE = SPACES)                  00984100
009842                 SET XL088-FIRST-STORE-RCPT TO TRUE               00984200
009843             END-IF                                               00984300
009844          END-IF                                                  00984400
009845        END-IF.                                                   00984500
009846                                                                  00984600
009847*---------------------------------------------------------------  00984700
009848*  SELECT ITEM NUMBER.                                            00984800
009849*---------------------------------------------------------------  00984900
009850 2000-SELECT-ITEM-NBR.                                            00985000
009860                                                                  00986000
009870       MOVE XL074-INTR-UPC    TO                                  00987000
009880                                 XLT00003-INTR-UPC-ID             00988000
009881                                 PV-DISPLAY-INTR-UPC              00988100
009882                                                                  00988200
009883       EXEC SQL                                                   00988300
009884           SELECT  ITM_NBR                                        00988400
009885             INTO  :XLT00003-ITM-NBR                              00988500
009886             FROM  XLT_SKU                                        00988600
009887            WHERE  INTR_UPC_ID = :XLT00003-INTR-UPC-ID            00988700
009888             WITH UR                                              00988810
009889       END-EXEC.                                                  00988900
009890                                                                  00989000
009891       EVALUATE TRUE                                              00989100
009900           WHEN SQLCODE = ZERO                                    00990000
010000               SET XL088-SUCCESSFUL   TO TRUE                     01000000
010100           WHEN SQLCODE = +100                                    01010000
010200               SET XL088-NOT-SUCCESSFUL TO TRUE                   01020000
010300               MOVE SQLCODE TO XL088-RETURN-SQLCODE               01030000
010400                SET XL088-ONHAND-ERROR-Y TO TRUE                  01040000
010500                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01050000
010600                STRING   ' XLKUT088-2000-'                        01060000
010700                        ' CALLED BY-'                             01070000
010800                        XL088-CALLING-PROGRAM                     01080000
010900                        ' SQLCODE= '                              01090000
011000                        PV-DISPLAY-SQLCODE                        01100000
011100                        ' INTRN UPC'                              01110000
011110                        PV-DISPLAY-INTR-UPC                       01111000
011120                        DELIMITED BY SIZE                         01112000
011130                                        INTO PV-CICS-MSG-AREA     01113000
011140                PERFORM 9999-WRITE-TO-CSSL                        01114000
011150                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01115000
011160           WHEN SQLWARN0 NOT = SPACES                             01116000
011170           WHEN SQLCODE < ZERO                                    01117000
011180           WHEN SQLCODE > ZERO                                    01118000
011190                SET XL088-ONHAND-ERROR-Y TO TRUE                  01119000
011200                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01120000
011300                STRING   ' XLKUT088-2000-'                        01130000
011400                        ' CALLED BY-'                             01140000
011410                        XL088-CALLING-PROGRAM                     01141000
011420                        ' SQLCODE= '                              01142000
011430                        PV-DISPLAY-SQLCODE                        01143000
011440                        ' INTRN UPC'                              01144000
011450                        PV-DISPLAY-INTR-UPC                       01145000
011460                        DELIMITED BY SIZE                         01146000
011470                                        INTO PV-CICS-MSG-AREA     01147000
011480                PERFORM 9999-WRITE-TO-CSSL                        01148000
011490                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01149000
011500               SET XL088-NOT-SUCCESSFUL TO TRUE                   01150000
011600               MOVE SQLCODE TO XL088-RETURN-SQLCODE               01160000
011700       END-EVALUATE.                                              01170000
011800                                                                  01180000
011900                                                                  01190000
012000 3000-CALC-BAL-ON-HAND.                                           01200000
012100      MOVE ZEROES          TO PV-BAL-ON-HAND-WRK                  01210000
012200      MOVE XM003-ONHAND TO PV-FSHN-ON-HAND-WORK                   01220000
012300      MOVE XL074-SE-QTY TO PV-STORE-EXP-WORK                      01230000
012400                                                                  01240000
012500      COMPUTE PV-BAL-ON-HAND-WRK =                                01250000
012600              PV-FSHN-ON-HAND-WORK - PV-STORE-EXP-WORK            01260000
012700      IF PV-BAL-ON-HAND-WRK > 0                                   01270000
012800         SET XL088-ONHND-QTY-NOT-ZERO TO TRUE                     01280000
012900      ELSE                                                        01290000
013000         SET XL088-ONHND-QTY-ZERO TO TRUE                         01300000
013100      END-IF.                                                     01310000
013200                                                                  01320000
013210                                                                  01321000
013220 3200-PROCESS-LNE-ITM-CSR-CLR.                                    01322000
013230                                                                  01323000
013240      SET PS-NOT-EO-LINE-ITEM-CSR                                 01324000
013250          PS-CRTN-CSR-CLEARANCE  TO TRUE                          01325000
013251                                                                  01325100
013252      PERFORM 3300-OPEN-LINE-ITEM-CSR.                            01325200
013253                                                                  01325300
013254      PERFORM 3400-FETCH-LINE-ITEM-CSR                            01325400
013255      UNTIL PS-EO-LINE-ITEM-CSR OR                                01325500
013256              PS-CLEARANCE-ITEM-YES OR                            01325600
013257              XL088-NOT-SUCCESSFUL                                01325700
013258      PERFORM 3500-CLOSE-LINE-ITEM-CSR.                           01325800
013259                                                                  01325900
013260      IF PS-CLEARANCE-ITEM-YES                                    01326000
013261         SET PS-PROCESS-INSERT-NEEDED                             01326100
013262             XL088-CLEARANCE          TO TRUE                     01326200
013263      END-IF.                                                     01326300
013264                                                                  01326400
013265 3250-PROCESS-CRTN-CSR-BOH.                                       01326500
013266      SET PS-NOT-EO-LINE-ITEM-CSR                                 01326600
013267          PS-CRTN-CSR-BAL-ON-HAND TO TRUE                         01326700
013268                                                                  01326800
013269      PERFORM 3300-OPEN-LINE-ITEM-CSR.                            01326900
013270      PERFORM 3400-FETCH-LINE-ITEM-CSR                            01327000
013271        UNTIL PS-EO-LINE-ITEM-CSR OR                              01327100
013272              XL088-ONHND-QTY-ZERO OR                             01327200
013273              XL088-NOT-SUCCESSFUL                                01327300
013274      PERFORM 3500-CLOSE-LINE-ITEM-CSR.                           01327400
013275                                                                  01327500
013276      IF XL088-ONHND-QTY-ZERO                                     01327600
013277         MOVE DK-PRC-MSG-CDE          TO XL088-PROCESS-MSG-CDE    01327700
013278         SET PS-PROCESS-INSERT-NEEDED TO TRUE                     01327800
013279      END-IF.                                                     01327900
013280                                                                  01328000
013281                                                                  01328100
013282 3300-OPEN-LINE-ITEM-CSR.                                         01328200
013283                                                                  01328300
013284       EXEC SQL                                                   01328400
013285            OPEN LINE_ITEM_CSR                                    01328500
013286       END-EXEC                                                   01328600
013287                                                                  01328700
013288       EVALUATE TRUE                                              01328800
013289           WHEN SQLCODE = ZERO                                    01328900
013290               SET XL088-SUCCESSFUL   TO TRUE                     01329000
013291           WHEN SQLWARN0 NOT = SPACES                             01329100
013292           WHEN SQLCODE < ZERO                                    01329200
013293           WHEN SQLCODE > ZERO                                    01329300
013294                MOVE SUT00028-SHIPT-UNT-ID TO                     01329400
013295                     PV-DISPLAY-CARTON                            01329500
013296                SET XL088-ONHAND-ERROR-Y TO TRUE                  01329600
013297                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01329700
013298                STRING   ' XLKUT088-3300-'                        01329800
013299                        ' CALLED BY-'                             01329900
013300                        XL088-CALLING-PROGRAM                     01330000
013301                        ' SQLCODE= '                              01330100
013302                        PV-DISPLAY-SQLCODE                        01330200
013303                        ' CARTON ID='                             01330300
013304                        PV-DISPLAY-CARTON                         01330400
013305                        DELIMITED BY SIZE                         01330500
013306                                        INTO PV-CICS-MSG-AREA     01330600
013307                PERFORM 9999-WRITE-TO-CSSL                        01330700
013308                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01330800
013309               SET XL088-NOT-SUCCESSFUL TO TRUE                   01330900
013310               MOVE SQLCODE TO XL088-RETURN-SQLCODE               01331000
013311       END-EVALUATE.                                              01331100
013312                                                                  01331200
013313                                                                  01331300
013314                                                                  01331400
013315                                                                  01331500
013316 3400-FETCH-LINE-ITEM-CSR.                                        01331600
013317     EXEC SQL                                                     01331700
013318        FETCH   LINE_ITEM_CSR                                     01331800
013319        INTO   :RECITM-ORD-LNE-NBR                                01331900
013320            ,  :RECITM-ITM-NBR                                    01332000
013321     END-EXEC.                                                    01332100
013322                                                                  01332200
013323     EVALUATE TRUE                                                01332300
013324         WHEN SQLCODE = ZERO                                      01332400
013325            SET XL088-BY-ITEM    TO TRUE                          01332500
013326            MOVE RECITM-ITM-NBR   TO XL088-ITEM-NBR               01332600
013327            IF PS-CRTN-CSR-CLEARANCE                              01332700
013328               PERFORM 5000-CHECK-FOR-CLEARANCE                   01332800
013329            ELSE                                                  01332900
013330               PERFORM 1000-CALL-INTR-STREXP-MODULE               01333000
013331*              IF XL088-ONHND-QTY-ZERO                            01333100
013332*                 MOVE RECITM-ORD-LNE-NBR                         01333200
013333*                            TO SUT00094-RCVR-LNE-NBR             01333300
013334*                 PERFORM 7070-CHECK-PREV-PRC-COUNT               01333400
013335*              END-IF                                             01333500
013336            END-IF                                                01333600
013337         WHEN SQLCODE = +100                                      01333700
013338            SET PS-EO-LINE-ITEM-CSR TO TRUE                       01333800
013339         WHEN SQLWARN0 NOT = SPACES                               01333900
013340         WHEN SQLCODE < ZERO                                      01334000
013341         WHEN SQLCODE > ZERO                                      01334100
013342                MOVE SUT00028-SHIPT-UNT-ID TO                     01334200
013343                     PV-DISPLAY-CARTON                            01334300
013344                SET XL088-ONHAND-ERROR-Y TO TRUE                  01334400
013345                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01334500
013346                STRING   ' XLKUT088-3400-'                        01334600
013347                        ' CALLED BY-'                             01334700
013348                        XL088-CALLING-PROGRAM                     01334800
013349                        ' SQLCODE= '                              01334900
013350                        PV-DISPLAY-SQLCODE                        01335000
013351                        ' CARTON ID='                             01335100
013352                        PV-DISPLAY-CARTON                         01335200
013353                        DELIMITED BY SIZE                         01335300
013354                                        INTO PV-CICS-MSG-AREA     01335400
013355                PERFORM 9999-WRITE-TO-CSSL                        01335500
013356                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01335600
013357                SET XL088-NOT-SUCCESSFUL TO TRUE                  01335700
013358                MOVE SQLCODE TO XL088-RETURN-SQLCODE              01335800
013359     END-EVALUATE.                                                01335900
013360                                                                  01336000
013361 3500-CLOSE-LINE-ITEM-CSR.                                        01336100
013362                                                                  01336200
013363       EXEC SQL                                                   01336300
013364            CLOSE LINE_ITEM_CSR                                   01336400
013365       END-EXEC                                                   01336500
013366                                                                  01336600
013367       EVALUATE TRUE                                              01336700
013368           WHEN SQLCODE = ZERO                                    01336800
013369               SET XL088-SUCCESSFUL   TO TRUE                     01336900
013370           WHEN SQLWARN0 NOT = SPACES                             01337000
013371           WHEN SQLCODE < ZERO                                    01337100
013372           WHEN SQLCODE > ZERO                                    01337200
013373                MOVE SUT00028-SHIPT-UNT-ID TO                     01337300
013374                     PV-DISPLAY-CARTON                            01337400
013375                SET XL088-ONHAND-ERROR-Y TO TRUE                  01337500
013376                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01337600
013377                STRING   ' XLKUT088-3500-'                        01337700
013378                        ' CALLED BY-'                             01337800
013379                        XL088-CALLING-PROGRAM                     01337900
013380                        ' SQLCODE= '                              01338000
013381                        PV-DISPLAY-SQLCODE                        01338100
013382                        ' CARTON ID='                             01338200
013383                        PV-DISPLAY-CARTON                         01338300
013384                        DELIMITED BY SIZE                         01338400
013385                                        INTO PV-CICS-MSG-AREA     01338500
013386                PERFORM 9999-WRITE-TO-CSSL                        01338600
013387                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01338700
013388                SET XL088-NOT-SUCCESSFUL TO TRUE                  01338800
013389                MOVE SQLCODE TO XL088-RETURN-SQLCODE              01338900
013390       END-EVALUATE.                                              01339000
013391                                                                  01339100
013392 4000-PROCESS-CRTN-CSR-CLRNCE.                                    01339200
013393                                                                  01339300
013394      SET PS-NOT-EO-CRTN-UPC-CSR                                  01339400
013395          PS-CRTN-CSR-CLEARANCE  TO TRUE                          01339500
013396      MOVE XL088-OTBND-CRTN   TO PV-OTBND-CRTN.                   01339600
013397      MOVE PV-OTBND-CRTN      TO SUT00028-SHIPT-UNT-ID.           01339700
013398                                                                  01339800
013399      PERFORM 4100-OPEN-CRTN-UPC-CSR.                             01339900
013400                                                                  01340000
013401      PERFORM 4200-FETCH-CRTN-UPC-CSR                             01340100
013402      UNTIL PS-EO-CRTN-UPC-CSR OR                                 01340200
013403              PS-CLEARANCE-ITEM-YES OR                            01340300
013404              XL088-NOT-SUCCESSFUL                                01340400
013405      PERFORM 4300-CLOSE-CRTN-UPC-CSR.                            01340500
013406                                                                  01340600
013407      IF PS-CLEARANCE-ITEM-YES                                    01340700
013408         SET PS-PROCESS-INSERT-NEEDED                             01340800
013409             XL088-CLEARANCE          TO TRUE                     01340900
013410      END-IF.                                                     01341000
013411                                                                  01341100
013412 4050-PROCESS-CRTN-CSR-BOH.                                       01341200
013413      SET PS-NOT-EO-CRTN-UPC-CSR                                  01341300
013414          PS-CRTN-CSR-BAL-ON-HAND TO TRUE                         01341400
013415      MOVE XL088-OTBND-CRTN   TO PV-OTBND-CRTN.                   01341500
013416      MOVE PV-OTBND-CRTN      TO SUT00028-SHIPT-UNT-ID.           01341600
013417                                                                  01341700
013418      PERFORM 4100-OPEN-CRTN-UPC-CSR.                             01341800
013419      PERFORM 4200-FETCH-CRTN-UPC-CSR                             01341900
013420        UNTIL PS-EO-CRTN-UPC-CSR OR                               01342000
013421              XL088-ONHND-QTY-ZERO OR                             01342100
013422              XL088-NOT-SUCCESSFUL                                01342200
013423      PERFORM 4300-CLOSE-CRTN-UPC-CSR.                            01342300
013424                                                                  01342400
013425      IF XL088-ONHND-QTY-ZERO                                     01342500
013426         MOVE DK-PRC-MSG-CDE          TO XL088-PROCESS-MSG-CDE    01342600
013427         SET PS-PROCESS-INSERT-NEEDED TO TRUE                     01342700
013428      END-IF.                                                     01342800
013429                                                                  01342900
013430                                                                  01343000
013431                                                                  01343100
013432 4100-OPEN-CRTN-UPC-CSR.                                          01343200
013433                                                                  01343300
013434       EXEC SQL                                                   01343400
013435            OPEN OTBND_CRTN_UPC_CSR                               01343500
013436       END-EXEC                                                   01343600
013437                                                                  01343700
013438       EVALUATE TRUE                                              01343800
013439           WHEN SQLCODE = ZERO                                    01343900
013440               SET XL088-SUCCESSFUL   TO TRUE                     01344000
013441           WHEN SQLWARN0 NOT = SPACES                             01344100
013442           WHEN SQLCODE < ZERO                                    01344200
013443           WHEN SQLCODE > ZERO                                    01344300
013444                MOVE SUT00028-SHIPT-UNT-ID TO                     01344400
013445                     PV-DISPLAY-CARTON                            01344500
013446                SET XL088-ONHAND-ERROR-Y TO TRUE                  01344600
013447                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01344700
013448                STRING   ' XLKUT088-4100-'                        01344800
013449                        ' CALLED BY-'                             01344900
013450                        XL088-CALLING-PROGRAM                     01345000
013451                        ' SQLCODE= '                              01345100
013452                        PV-DISPLAY-SQLCODE                        01345200
013453                        ' CARTON ID='                             01345300
013454                        PV-DISPLAY-CARTON                         01345400
013455                        DELIMITED BY SIZE                         01345500
013456                                        INTO PV-CICS-MSG-AREA     01345600
013457                PERFORM 9999-WRITE-TO-CSSL                        01345700
013458                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01345800
013459               SET XL088-NOT-SUCCESSFUL TO TRUE                   01345900
013460               MOVE SQLCODE TO XL088-RETURN-SQLCODE               01346000
013461       END-EVALUATE.                                              01346100
013462                                                                  01346200
013463                                                                  01346300
013464                                                                  01346400
013465                                                                  01346500
013466 4200-FETCH-CRTN-UPC-CSR.                                         01346600
013467     EXEC SQL                                                     01346700
013468        FETCH   OTBND_CRTN_UPC_CSR                                01346800
013469        INTO   :SUT00028-UPC-NBR                                  01346900
013470            ,  :SUT00028-TRN-LNE-NBR                              01347000
013471     END-EXEC.                                                    01347100
013472                                                                  01347200
013473     EVALUATE TRUE                                                01347300
013474         WHEN SQLCODE = ZERO                                      01347400
013475            SET XL088-BY-UPC-NBR TO TRUE                          01347500
013476            MOVE SUT00028-UPC-NBR TO XL088-UPC-NBR                01347600
013477            IF PS-CRTN-CSR-CLEARANCE                              01347700
013478               PERFORM 5000-CHECK-FOR-CLEARANCE                   01347800
013479            ELSE                                                  01347900
013480               PERFORM 1000-CALL-INTR-STREXP-MODULE               01348000
013481               IF XL088-ONHND-QTY-ZERO                            01348100
013482                  MOVE SUT00028-TRN-LNE-NBR                       01348200
013483                             TO SUT00094-RCVR-LNE-NBR             01348300
013484**                                                                01348400
013485** FOR SMOOTHING FLAG ALL CARTONS FOR THE PO/RCVR/STORE           01348500
013486**                                                                01348600
013487                  IF XL088-CALLING-PROGRAM =                      01348700
013488                                          PC-SMOOTHING-PROCESS    01348800
013489                     CONTINUE                                     01348900
013490                  ELSE                                            01349000
013491                     PERFORM 7070-CHECK-PREV-PRC-COUNT            01349100
013492                  END-IF                                          01349200
013493               END-IF                                             01349300
013494            END-IF                                                01349400
013495         WHEN SQLCODE = +100                                      01349500
013496            SET PS-EO-CRTN-UPC-CSR TO TRUE                        01349600
013497         WHEN SQLWARN0 NOT = SPACES                               01349700
013498         WHEN SQLCODE < ZERO                                      01349800
013499         WHEN SQLCODE > ZERO                                      01349900
013500                MOVE SUT00028-SHIPT-UNT-ID TO                     01350000
013501                     PV-DISPLAY-CARTON                            01350100
013502                SET XL088-ONHAND-ERROR-Y TO TRUE                  01350200
013503                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01350300
013504                STRING   ' XLKUT088-4200-'                        01350400
013505                        ' CALLED BY-'                             01350500
013506                        XL088-CALLING-PROGRAM                     01350600
013507                        ' SQLCODE= '                              01350700
013508                        PV-DISPLAY-SQLCODE                        01350800
013509                        ' CARTON ID='                             01350900
013510                        PV-DISPLAY-CARTON                         01351000
013511                        DELIMITED BY SIZE                         01351100
013512                                        INTO PV-CICS-MSG-AREA     01351200
013513                PERFORM 9999-WRITE-TO-CSSL                        01351300
013514                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01351400
013515                SET XL088-NOT-SUCCESSFUL TO TRUE                  01351500
013516                MOVE SQLCODE TO XL088-RETURN-SQLCODE              01351600
013517     END-EVALUATE.                                                01351700
013518                                                                  01351800
013519 4300-CLOSE-CRTN-UPC-CSR.                                         01351900
013520                                                                  01352000
013521       EXEC SQL                                                   01352100
013522            CLOSE OTBND_CRTN_UPC_CSR                              01352200
013523       END-EXEC                                                   01352300
013524                                                                  01352400
013525       EVALUATE TRUE                                              01352500
013526           WHEN SQLCODE = ZERO                                    01352600
013527               SET XL088-SUCCESSFUL   TO TRUE                     01352700
013528           WHEN SQLWARN0 NOT = SPACES                             01352800
013529           WHEN SQLCODE < ZERO                                    01352900
013530           WHEN SQLCODE > ZERO                                    01353000
013531                MOVE SUT00028-SHIPT-UNT-ID TO                     01353100
013532                     PV-DISPLAY-CARTON                            01353200
013533                SET XL088-ONHAND-ERROR-Y TO TRUE                  01353300
013534                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01353400
013535                STRING   ' XLKUT088-4300-'                        01353500
013536                        ' CALLED BY-'                             01353600
013537                        XL088-CALLING-PROGRAM                     01353700
013538                        ' SQLCODE= '                              01353800
013539                        PV-DISPLAY-SQLCODE                        01353900
013540                        ' CARTON ID='                             01354000
013541                        PV-DISPLAY-CARTON                         01354100
013542                        DELIMITED BY SIZE                         01354200
013543                                        INTO PV-CICS-MSG-AREA     01354300
013544                PERFORM 9999-WRITE-TO-CSSL                        01354400
013545                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01354500
013546                SET XL088-NOT-SUCCESSFUL TO TRUE                  01354600
013547                MOVE SQLCODE TO XL088-RETURN-SQLCODE              01354700
013548       END-EVALUATE.                                              01354800
013549                                                                  01354900
013550*** GB 9/1/12 ADDED A.PRC_MSG_CDE <> :PC-RD TO SELECT             01355008
013551*** TO NOT SELECT CARTONS THAT ARE RFID                           01355108
013560                                                                  01356000
013570 4500-CHECK-PROCESS-MESSAGE.                                      01357000
013580                                                                  01358000
013590       EXEC SQL                                                   01359000
013600           SELECT  A.PRC_MSG_CDE                                  01360000
013601             INTO  :SUT00094-PRC-MSG-CDE                          01360100
013602             FROM  SUT_PRC_MSG_CNTL A                             01360200
013603                ,  SUT_OTBND_CART B                               01360300
013604                ,  SUT_PRC_MSG_CDE C                              01360400
013605            WHERE  A.SHIPT_UNT_ID = :SUT00094-SHIPT-UNT-ID        01360500
013606              AND  A.SHIPT_UNT_ID = B.SHIPT_UNT_ID                01360600
013607              AND  A.DEST_LOC_NBR = :SUT00094-DEST-LOC-NBR        01360700
013608              AND  A.PO_NBR       = :SUT00094-PO-NBR              01360800
013609              AND  A.RCVR_SEQ_NBR = :SUT00094-RCVR-SEQ-NBR        01360900
013610              AND  B.ACTV_IND     = 'Y'                           01361000
013611              AND  A.PRC_MSG_CDE  = C.PRC_MSG_CDE                 01361100
013612              AND  A.PRC_MSG_CDE <> :PC-RD                        01361208
013613            WITH UR                                               01361308
013614       END-EXEC.                                                  01361408
013615                                                                  01361508
013616       EVALUATE TRUE                                              01361608
013617           WHEN SQLCODE = ZERO                                    01361708
013618           WHEN SQLCODE = -811                                    01361808
013619                IF SUT00094-PRC-MSG-CDE = PC-RF                   01361908
013620                   SET XL088-FIRST-STORE-RCPT TO TRUE             01362008
013621                END-IF                                            01362108
013622                SET PS-PREV-PROCESS-MSG-FND-YES TO TRUE           01362208
013623           WHEN SQLCODE = +100                                    01362308
013624                SET PS-PREV-PROCESS-MSG-FND-NO TO TRUE            01362408
013625           WHEN SQLWARN0 NOT = SPACES                             01362508
013626           WHEN SQLCODE < ZERO                                    01362608
013627           WHEN SQLCODE > ZERO                                    01362708
013628                SET XL088-ONHAND-ERROR-Y TO TRUE                  01362808
013629                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01362908
013630                MOVE SUT00094-SHIPT-UNT-ID TO PV-DISPLAY-CARTON   01363008
013631                MOVE SUT00094-PO-NBR       TO PV-DISPLAY-PO       01363108
013632                STRING   ' XLKUT088-4500-'                        01363208
013633                        ' CALLED BY-'                             01363308
013634                        XL088-CALLING-PROGRAM                     01363408
013635                        ' SQLCODE= '                              01363508
013636                        PV-DISPLAY-SQLCODE                        01363608
013637                        ' OTBND CART '                            01363708
013638                        PV-DISPLAY-CARTON                         01363808
013639                        ' PO NUMBER '                             01363908
013640                        PV-DISPLAY-PO                             01364008
013641                        DELIMITED BY SIZE                         01364108
013642                                        INTO PV-CICS-MSG-AREA     01364208
013643                PERFORM 9999-WRITE-TO-CSSL                        01364308
013644                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01364408
013645               SET XL088-NOT-SUCCESSFUL TO TRUE                   01364508
013646               MOVE SQLCODE TO XL088-RETURN-SQLCODE               01364608
013647       END-EVALUATE.                                              01364708
013648                                                                  01364808
013649 5000-CHECK-FOR-CLEARANCE.                                        01364908
013650                                                                  01365008
013651       MOVE XL088-KEY-STR-NBR      TO XL074-KEY-LOC-NBR.          01365108
013652                                                                  01365208
013653       EVALUATE TRUE                                              01365308
013654          WHEN XL088-BY-UPC-NBR                                   01365408
013655             PERFORM 5100-CLEARANCE-BY-UPC                        01365508
013656          WHEN XL088-BY-ITEM                                      01365608
013657             PERFORM 5200-CLEARANCE-BY-ITEM                       01365708
013658          WHEN XL088-BY-SKU                                       01365808
013659             PERFORM 5300-CLEARANCE-BY-SKU                        01365908
013660       END-EVALUATE                                               01366008
013661       PERFORM 5350-SELECT-CLRNCE-UPCPLS                          01366108
013662******************************************************************01366208
013663****** SKU STAT CODE                                              01366308
013664******************************************************************01366408
013665******     CODE = 30  ITEM CLEARANCED AT ALL STORES               01366508
013666******     CODE = 25  ITEM CLEARANCED AT SOME STORE               01366608
013667******************************************************************01366708
013668                                                                  01366808
013669       IF XL088-ONHAND-ERROR-N                                    01366908
013670          EVALUATE TRUE                                           01367008
013671            WHEN UPCPLS-UPC-STAT-CDE   = 30                       01367108
013672               SET PS-CLEARANCE-ITEM-YES TO TRUE                  01367208
013673            WHEN UPCPLS-UPC-STAT-CDE   = 25                       01367308
013674               PERFORM 5400-CLEARANCE-ITM-STR                     01367408
013675            WHEN OTHER                                            01367508
013676               SET PS-CLEARANCE-ITEM-NO TO TRUE                   01367608
013677          END-EVALUATE                                            01367708
013678       END-IF.                                                    01367808
013679                                                                  01367908
013680 5100-CLEARANCE-BY-UPC.                                           01368008
013681                                                                  01368108
013682       MOVE XL088-UPC-NBR       TO XLT00006-UPC-NBR.              01368208
013683                                                                  01368308
013684       EXEC SQL                                                   01368408
013685         SELECT A.INTR_UPC_ID                                     01368508
013686              , A.ITM_NBR                                         01368608
013687          INTO  :XLT00003-INTR-UPC-ID                             01368708
013688              , :XLT00003-ITM-NBR                                 01368808
013689          FROM  XLT_SKU A                                         01368908
013690             ,  XLT_UPC B                                         01369008
013691          WHERE A.INTR_UPC_ID  = B.INTR_UPC_ID                    01369108
013692            AND UPC_NBR        = :XLT00006-UPC-NBR                01369208
013693           WITH UR                                                01369310
013694       END-EXEC.                                                  01369408
013695                                                                  01369508
013696       EVALUATE TRUE                                              01369608
013697           WHEN SQLCODE = ZERO                                    01369708
013698           WHEN SQLCODE = +100                                    01369808
013699                CONTINUE                                          01369908
013700           WHEN SQLWARN0 NOT = SPACES                             01370008
013701           WHEN SQLCODE < ZERO                                    01370108
013702           WHEN SQLCODE > ZERO                                    01370208
013703                SET XL088-ONHAND-ERROR-Y TO TRUE                  01370308
013704                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01370408
013705                MOVE XLT00006-UPC-NBR TO PV-DISPLAY-UPC-NBR       01370508
013706                STRING   ' XLKUT088-5100-'                        01370608
013707                        ' CALLED BY-'                             01370708
013708                        XL088-CALLING-PROGRAM                     01370808
013709                        ' SQLCODE= '                              01370908
013710                        PV-DISPLAY-SQLCODE                        01371008
013711                        ' UPC NBR  '                              01371108
013712                        PV-DISPLAY-UPC-NBR                        01371208
013713                        DELIMITED BY SIZE                         01371308
013714                                        INTO PV-CICS-MSG-AREA     01371408
013715                PERFORM 9999-WRITE-TO-CSSL                        01371508
013716                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01371608
013717               SET XL088-NOT-SUCCESSFUL TO TRUE                   01371708
013718               MOVE SQLCODE TO XL088-RETURN-SQLCODE               01371808
013719       END-EVALUATE.                                              01371908
013720                                                                  01372008
013721 5200-CLEARANCE-BY-ITEM.                                          01372108
013722                                                                  01372208
013723       MOVE XL088-ITEM-NBR      TO XLT00003-ITM-NBR.              01372308
013724                                                                  01372408
013725       EXEC SQL                                                   01372508
013726          SELECT INTR_UPC_ID                                      01372608
013727           INTO :XLT00003-INTR-UPC-ID                             01372708
013728           FROM  XLT_SKU                                          01372808
013729          WHERE ITM_NBR = :XLT00003-ITM-NBR                       01372908
013730           WITH UR                                                01373010
013731       END-EXEC.                                                  01373108
013732                                                                  01373208
013733       EVALUATE TRUE                                              01373308
013734           WHEN SQLCODE = ZERO                                    01373408
013735           WHEN SQLCODE = +100                                    01373508
013736                CONTINUE                                          01373608
013737           WHEN SQLWARN0 NOT = SPACES                             01373708
013738           WHEN SQLCODE < ZERO                                    01373808
013739           WHEN SQLCODE > ZERO                                    01373908
013740                SET XL088-ONHAND-ERROR-Y TO TRUE                  01374008
013741                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01374108
013742                MOVE XLT00003-ITM-NBR TO PV-DISPLAY-ITM-NBR       01374208
013743                STRING   ' XLKUT088-5200-'                        01374308
013744                        ' CALLED BY-'                             01374408
013745                        XL088-CALLING-PROGRAM                     01374508
013746                        ' SQLCODE= '                              01374608
013747                        PV-DISPLAY-SQLCODE                        01374708
013748                        ' ITEM NBR '                              01374808
013749                        PV-DISPLAY-SKU-NBR                        01374908
013750                        DELIMITED BY SIZE                         01375008
013751                                        INTO PV-CICS-MSG-AREA     01375108
013752                PERFORM 9999-WRITE-TO-CSSL                        01375208
013753                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01375308
013754               SET XL088-NOT-SUCCESSFUL TO TRUE                   01375408
013755               MOVE SQLCODE TO XL088-RETURN-SQLCODE               01375508
013756       END-EVALUATE.                                              01375608
013757                                                                  01375708
013758 5300-CLEARANCE-BY-SKU.                                           01375808
013759                                                                  01375908
013760       MOVE XL088-KEY-SKU       TO XLT00003-SKU-NBR.              01376008
013761                                                                  01376108
013762       EXEC SQL                                                   01376208
013763          SELECT INTR_UPC_ID                                      01376308
013764               , ITM_NBR                                          01376408
013765           INTO :XLT00003-INTR-UPC-ID                             01376508
013766              , :XLT00003-ITM-NBR                                 01376608
013767           FROM  XLT_SKU                                          01376708
013768           WHERE SKU_NBR = :XLT00003-SKU-NBR                      01376808
013769            WITH UR                                               01376910
013770       END-EXEC.                                                  01377008
013771                                                                  01377108
013772       EVALUATE TRUE                                              01377208
013773           WHEN SQLCODE = ZERO                                    01377308
013774           WHEN SQLCODE = +100                                    01377408
013775                CONTINUE                                          01377508
013776           WHEN SQLWARN0 NOT = SPACES                             01377608
013777           WHEN SQLCODE < ZERO                                    01377708
013778           WHEN SQLCODE > ZERO                                    01377808
013779                SET XL088-ONHAND-ERROR-Y TO TRUE                  01377908
013780                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01378008
013781                MOVE XLT00003-SKU-NBR TO PV-DISPLAY-SKU-NBR       01378108
013782                STRING   ' XLKUT088-5300-'                        01378208
013783                        ' CALLED BY-'                             01378308
013784                        XL088-CALLING-PROGRAM                     01378408
013785                        ' SQLCODE= '                              01378508
013786                        PV-DISPLAY-SQLCODE                        01378608
013787                        ' SKU NBR  '                              01378708
013788                        PV-DISPLAY-SKU-NBR                        01378808
013789                        DELIMITED BY SIZE                         01378908
013790                                        INTO PV-CICS-MSG-AREA     01379008
013791                PERFORM 9999-WRITE-TO-CSSL                        01379108
013792                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01379208
013793               SET XL088-NOT-SUCCESSFUL TO TRUE                   01379308
013794               MOVE SQLCODE TO XL088-RETURN-SQLCODE               01379408
013795       END-EVALUATE.                                              01379508
013796                                                                  01379608
013797 5350-SELECT-CLRNCE-UPCPLS.                                       01379708
013798                                                                  01379808
013799       MOVE XLT00003-INTR-UPC-ID TO UPCPLS-UPC-ID.                01379908
013800                                                                  01380008
013801       EXEC SQL                                                   01380108
013802         SELECT DISTINCT                                          01380208
013803             UPC_STAT_CDE                                         01380308
013804           INTO                                                   01380408
013805            :UPCPLS-UPC-STAT-CDE                                  01380508
013806           FROM TUPCPLS                                           01380608
013807          WHERE  UPC_ID        = :UPCPLS-UPC-ID                   01380708
013808            AND  OPERCO_NBR    = '03'                             01380808
013809            AND  STR_NBR       = 0                                01380908
013810            AND  EFF_BEG_TMST <= CURRENT TIMESTAMP                01381008
013811            AND (EFF_END_TMST >= CURRENT TIMESTAMP                01381108
013812             OR  EFF_END_TMST IS NULL)                            01381208
013813         WITH UR                                                  01381308
013814       END-EXEC.                                                  01381408
013815                                                                  01381508
013816       EVALUATE TRUE                                              01381608
013817           WHEN SQLCODE = ZERO                                    01381708
013818           WHEN SQLCODE = +100                                    01381808
013819                CONTINUE                                          01381908
013820           WHEN SQLWARN0 NOT = SPACES                             01382008
013821           WHEN SQLCODE < ZERO                                    01382108
013822           WHEN SQLCODE > ZERO                                    01382208
013823                SET XL088-ONHAND-ERROR-Y TO TRUE                  01382308
013824                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01382408
013825                MOVE UPCPLS-UPC-ID  TO PV-DISPLAY-INTR-UPC        01382508
013826                STRING   ' XLKUT088-5350-'                        01382608
013827                        ' CALLED BY-'                             01382708
013828                        XL088-CALLING-PROGRAM                     01382808
013829                        ' SQLCODE= '                              01382908
013830                        PV-DISPLAY-SQLCODE                        01383008
013831                        ' INTRNL UPC '                            01383108
013832                        PV-DISPLAY-INTR-UPC                       01383208
013833                        DELIMITED BY SIZE                         01383308
013834                                        INTO PV-CICS-MSG-AREA     01383408
013835                PERFORM 9999-WRITE-TO-CSSL                        01383508
013836                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01383608
013837               SET XL088-NOT-SUCCESSFUL TO TRUE                   01383708
013838               MOVE SQLCODE TO XL088-RETURN-SQLCODE               01383808
013839       END-EVALUATE.                                              01383908
013840                                                                  01384008
013841 5400-CLEARANCE-ITM-STR.                                          01384108
013842                                                                  01384208
013843       MOVE XL088-KEY-STR-NBR TO UPCPLS-STR-NBR                   01384308
013844                                                                  01384408
013845       EXEC SQL                                                   01384508
013846         SELECT DISTINCT                                          01384608
013847             UPC_STAT_CDE                                         01384708
013848           INTO                                                   01384808
013849            :UPCPLS-UPC-STAT-CDE                                  01384908
013850           FROM TUPCPLS                                           01385008
013851          WHERE  UPC_ID        = :UPCPLS-UPC-ID                   01385108
013852            AND  OPERCO_NBR    = '03'                             01385208
013853            AND  STR_NBR       = :UPCPLS-STR-NBR                  01385308
013854            AND  EFF_BEG_TMST <= CURRENT TIMESTAMP                01385408
013855            AND (EFF_END_TMST >= CURRENT TIMESTAMP                01385508
013856             OR  EFF_END_TMST IS NULL)                            01385608
013857         WITH UR                                                  01385708
013859       END-EXEC.                                                  01385901
013860                                                                  01386001
013861       EVALUATE TRUE                                              01386101
013862           WHEN SQLCODE = ZERO                                    01386201
013863                 SET PS-CLEARANCE-ITEM-YES TO TRUE                01386301
013864           WHEN SQLCODE = +100                                    01386401
013865                 SET PS-CLEARANCE-ITEM-NO  TO TRUE                01386501
013866           WHEN SQLWARN0 NOT = SPACES                             01386601
013867           WHEN SQLCODE < ZERO                                    01386701
013868           WHEN SQLCODE > ZERO                                    01386801
013869                SET XL088-ONHAND-ERROR-Y TO TRUE                  01386901
013870                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01387001
013871                MOVE UPCPLS-UPC-ID  TO PV-DISPLAY-INTR-UPC        01387106
013872                MOVE XLT00003-ITM-NBR TO PV-DISPLAY-ITM-NBR       01387201
013873                MOVE UPCPLS-STR-NBR   TO PV-DISPLAY-STORE         01387306
013874                STRING   ' XLKUT088-5400-'                        01387401
013875                        ' CALLED BY-'                             01387501
013876                        XL088-CALLING-PROGRAM                     01387601
013877                        ' SQLCODE= '                              01387701
013878                        PV-DISPLAY-SQLCODE                        01387801
013879                        ' INT UPC ID '                            01387906
013880                        PV-DISPLAY-INTR-UPC                       01388006
013881                        ' STORE NBR '                             01388101
013882                        PV-DISPLAY-STORE                          01388201
013883                        DELIMITED BY SIZE                         01388301
013884                                        INTO PV-CICS-MSG-AREA     01388401
013885                PERFORM 9999-WRITE-TO-CSSL                        01388501
013886                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01388601
013887               SET XL088-NOT-SUCCESSFUL TO TRUE                   01388701
013888               MOVE SQLCODE TO XL088-RETURN-SQLCODE               01388801
013889       END-EVALUATE.                                              01388901
013890                                                                  01389001
013891 6000-PROCESS-PRC-MSG-INSRT-CSR.                                  01389101
013892      SET PS-NOT-EO-PRC-MSG-INSRT-CSR TO TRUE                     01389201
013893      MOVE XL088-OTBND-CRTN   TO PV-OTBND-CRTN.                   01389301
013894      MOVE PV-OTBND-CRTN      TO SUT00028-SHIPT-UNT-ID.           01389401
013895                                                                  01389501
013896      PERFORM 6100-OPEN-PRC-MSG-INSRT-CSR.                        01389601
013897      PERFORM 6200-FETCH-PRC-MSG-INSRT-CSR                        01389701
013898        UNTIL PS-EO-PRC-MSG-INSRT-CSR OR                          01389801
013899              XL088-NOT-SUCCESSFUL                                01389901
013900      PERFORM 6300-CLOSE-PRC-MSG-INSRT-CSR.                       01390001
013901                                                                  01390101
013902 6100-OPEN-PRC-MSG-INSRT-CSR.                                     01390201
013903                                                                  01390301
013904       EXEC SQL                                                   01390401
013905            OPEN PRC_MSG_INS_CSR                                  01390501
013906       END-EXEC                                                   01390601
013907                                                                  01390701
013908       EVALUATE TRUE                                              01390801
013909           WHEN SQLCODE = ZERO                                    01390901
013910               SET XL088-SUCCESSFUL   TO TRUE                     01391001
013911           WHEN SQLWARN0 NOT = SPACES                             01391101
013912           WHEN SQLCODE < ZERO                                    01391201
013913           WHEN SQLCODE > ZERO                                    01391301
013914                MOVE SUT00028-SHIPT-UNT-ID TO                     01391401
013915                     PV-DISPLAY-CARTON                            01391501
013916                SET XL088-ONHAND-ERROR-Y TO TRUE                  01391601
013917                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01391701
013918                STRING   ' XLKUT088-6100-'                        01391801
013919                        ' CALLED BY-'                             01391901
013920                        XL088-CALLING-PROGRAM                     01392001
013921                        ' SQLCODE= '                              01392101
013922                        PV-DISPLAY-SQLCODE                        01392201
013923                        ' CARTON ID='                             01392301
013924                        PV-DISPLAY-CARTON                         01392401
013925                        DELIMITED BY SIZE                         01392501
013926                                        INTO PV-CICS-MSG-AREA     01392601
013927                PERFORM 9999-WRITE-TO-CSSL                        01392701
013928                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01392801
013929               SET XL088-NOT-SUCCESSFUL TO TRUE                   01392901
013930               MOVE SQLCODE TO XL088-RETURN-SQLCODE               01393001
013931       END-EVALUATE.                                              01393101
013932                                                                  01393201
013933                                                                  01393301
013934                                                                  01393401
013935                                                                  01393501
013936 6200-FETCH-PRC-MSG-INSRT-CSR.                                    01393601
013937     EXEC SQL                                                     01393701
013938        FETCH   PRC_MSG_INS_CSR                                   01393801
013939        INTO   :SUT00028-UPC-NBR                                  01393901
013940            ,  :SUT00028-TRN-LNE-NBR                              01394001
013941     END-EXEC.                                                    01394101
013942                                                                  01394201
013943     EVALUATE TRUE                                                01394301
013944         WHEN SQLCODE = ZERO                                      01394401
013945            PERFORM 7000-LOAD-PROCESS-MSG                         01394501
013946         WHEN SQLCODE = +100                                      01394601
013947            SET PS-EO-PRC-MSG-INSRT-CSR TO TRUE                   01394701
013948         WHEN SQLWARN0 NOT = SPACES                               01394801
013949         WHEN SQLCODE < ZERO                                      01394901
013950         WHEN SQLCODE > ZERO                                      01395001
013951                MOVE SUT00028-SHIPT-UNT-ID TO                     01395101
013952                     PV-DISPLAY-CARTON                            01395201
013953                SET XL088-ONHAND-ERROR-Y TO TRUE                  01395301
013954                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01395401
013955                STRING   ' XLKUT088-6200-'                        01395501
013956                        ' CALLED BY-'                             01395601
013957                        XL088-CALLING-PROGRAM                     01395701
013958                        ' SQLCODE= '                              01395801
013959                        PV-DISPLAY-SQLCODE                        01395901
013960                        ' CARTON ID='                             01396001
013961                        PV-DISPLAY-CARTON                         01396101
013962                        DELIMITED BY SIZE                         01396201
013963                                        INTO PV-CICS-MSG-AREA     01396301
013964                PERFORM 9999-WRITE-TO-CSSL                        01396401
013965                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01396501
013966                SET XL088-NOT-SUCCESSFUL TO TRUE                  01396601
013967                MOVE SQLCODE TO XL088-RETURN-SQLCODE              01396701
013968     END-EVALUATE.                                                01396801
013969                                                                  01396901
013970 6300-CLOSE-PRC-MSG-INSRT-CSR.                                    01397001
013971                                                                  01397101
013972       EXEC SQL                                                   01397201
013973            CLOSE PRC_MSG_INS_CSR                                 01397301
013974       END-EXEC                                                   01397401
013975                                                                  01397501
013976       EVALUATE TRUE                                              01397601
013977           WHEN SQLCODE = ZERO                                    01397701
013978               SET XL088-SUCCESSFUL   TO TRUE                     01397801
013979           WHEN SQLWARN0 NOT = SPACES                             01397901
013980           WHEN SQLCODE < ZERO                                    01398001
013981           WHEN SQLCODE > ZERO                                    01398101
013982                MOVE SUT00028-SHIPT-UNT-ID TO                     01398201
013983                     PV-DISPLAY-CARTON                            01398301
013984                SET XL088-ONHAND-ERROR-Y TO TRUE                  01398401
013985                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01398501
013986                STRING   ' XLKUT088-6300-'                        01398601
013987                        ' CALLED BY-'                             01398701
013988                        XL088-CALLING-PROGRAM                     01398801
013989                        ' SQLCODE= '                              01398901
013990                        PV-DISPLAY-SQLCODE                        01399001
013991                        ' CARTON ID='                             01399101
013992                        PV-DISPLAY-CARTON                         01399201
013993                        DELIMITED BY SIZE                         01399301
013994                                        INTO PV-CICS-MSG-AREA     01399401
013995                PERFORM 9999-WRITE-TO-CSSL                        01399501
013996                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01399601
013997                SET XL088-NOT-SUCCESSFUL TO TRUE                  01399701
013998                MOVE SQLCODE TO XL088-RETURN-SQLCODE              01399801
013999       END-EVALUATE.                                              01399901
014000                                                                  01400001
014001                                                                  01400101
014002 7000-LOAD-PROCESS-MSG.                                           01400201
014003                                                                  01400301
014004      MOVE XL088-KEY-PO          TO SUT00094-PO-NBR               01400401
014005                                    RECITM-ORD-NBR.               01400501
014006      MOVE XL088-KEY-REC-SEQ-NBR TO SUT00094-RCVR-SEQ-NBR         01400601
014007                                    RECITM-REC-SEQ-NBR.           01400701
014008      MOVE XL088-KEY-STR-NBR     TO SUT00094-DEST-LOC-NBR.        01400801
014009      MOVE XL088-OTBND-CRTN      TO SUT00094-SHIPT-UNT-ID.        01400901
014010      MOVE XL088-PROCESS-MSG-CDE TO SUT00094-PRC-MSG-CDE.         01401001
014011                                                                  01401101
014012      MOVE SUT00028-TRN-LNE-NBR  TO SUT00094-RCVR-LNE-NBR         01401201
014013      IF XL088-FIRST-STORE-RCPT                                   01401301
014014         MOVE PC-RF TO SUT00094-PRC-MSG-CDE                       01401401
014015                       XL088-PROCESS-MSG-CDE                      01401501
014016      END-IF                                                      01401601
014017                                                                  01401701
014018      PERFORM 7100-SELECT-PROCESS-MSG-DESC.                       01401801
014019      PERFORM 7500-INSERT-PROCESS-MSG.                            01401901
014020                                                                  01402001
014021 7070-CHECK-PREV-PRC-COUNT.                                       01402101
014022                                                                  01402201
014023       MOVE ZEROES TO PV-PREV-PROC-MSG-CNT.                       01402301
014024                                                                  01402401
014025       EXEC SQL                                                   01402501
014026         SELECT  COUNT(A.SHIPT_UNT_ID)                            01402601
014027           INTO  :PV-PREV-PROC-MSG-CNT                            01402701
014028           FROM  SUT_PRC_MSG_CNTL A                               01402801
014029              ,  SUT_OTBND_CART B                                 01402901
014030          WHERE  A.SHIPT_UNT_ID = B.SHIPT_UNT_ID                  01403001
014031            AND  A.PO_NBR       = :SUT00094-PO-NBR                01403101
014032            AND  A.RCVR_SEQ_NBR = :SUT00094-RCVR-SEQ-NBR          01403201
014033            AND  A.RCVR_LNE_NBR = :SUT00028-TRN-LNE-NBR           01403301
014034********    AND  A.PRC_MSG_CDE  = :DK-PRC-MSG-CDE                 01403401
014035            AND  A.DEST_LOC_NBR = :SUT00094-DEST-LOC-NBR          01403501
014036            AND  B.ACTV_IND     = 'Y'                             01403601
014037          WITH UR                                                 01403707
014038       END-EXEC.                                                  01403801
014039                                                                  01403901
014040       EVALUATE TRUE                                              01404001
014041           WHEN SQLCODE = ZERO                                    01404101
014042                IF PV-PREV-PROC-MSG-CNT < KRPRPM-FUNC-QTY         01404201
014043                   CONTINUE                                       01404301
014044                ELSE                                              01404401
014045                   SET XL088-ONHND-QTY-NOT-ZERO TO TRUE           01404501
014046                END-IF                                            01404601
014047           WHEN SQLCODE = +100                                    01404701
014048                SET XL088-ONHND-QTY-NOT-ZERO TO TRUE              01404801
014049           WHEN SQLWARN0 NOT = SPACES                             01404901
014050           WHEN SQLCODE < ZERO                                    01405001
014051           WHEN SQLCODE > ZERO                                    01405101
014052                SET XL088-ONHAND-ERROR-Y TO TRUE                  01405201
014053                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01405301
014054                MOVE RECITM-ITM-NBR   TO PV-DISPLAY-ITM-NBR       01405401
014055                STRING   ' XLKUT088-7070-'                        01405501
014056                        ' CALLED BY-'                             01405601
014057                        XL088-CALLING-PROGRAM                     01405701
014058                        ' SQLCODE= '                              01405801
014059                        PV-DISPLAY-SQLCODE                        01405901
014060                        ' PO NBR '                                01406001
014061                        PV-DISPLAY-PO                             01406101
014062                        ' ITEM NBR '                              01406201
014063                        PV-DISPLAY-ITM-NBR                        01406301
014064                        DELIMITED BY SIZE                         01406401
014065                                        INTO PV-CICS-MSG-AREA     01406501
014066                PERFORM 9999-WRITE-TO-CSSL                        01406601
014067                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01406701
014068               SET XL088-NOT-SUCCESSFUL TO TRUE                   01406801
014069               MOVE SQLCODE TO XL088-RETURN-SQLCODE               01406901
014070       END-EVALUATE.                                              01407001
014071                                                                  01407101
014072 7100-SELECT-PROCESS-MSG-DESC.                                    01407201
014073                                                                  01407301
014074       INITIALIZE SUT00093-PRC-MSG-CDE-DESC.                      01407401
014075                                                                  01407501
014076       EXEC SQL                                                   01407601
014077         SELECT  PRC_MSG_CDE_DESC                                 01407701
014078           INTO  :SUT00093-PRC-MSG-CDE-DESC                       01407801
014079           FROM  SUT_PRC_MSG_CDE                                  01407901
014080          WHERE  PRC_MSG_CDE    = :SUT00094-PRC-MSG-CDE           01408001
014081           WITH UR                                                01408110
014082       END-EXEC.                                                  01408201
014083                                                                  01408301
014084       EVALUATE TRUE                                              01408401
014085           WHEN SQLCODE = ZERO                                    01408501
014086               SET XL088-PROCESS-MSG-YES TO TRUE                  01408601
014087               MOVE SUT00093-PRC-MSG-CDE-DESC-TEXT (1:35)         01408701
014088                            TO XL088-PROCESS-MESSAGE-TXT          01408801
014089           WHEN SQLCODE = +100                                    01408901
014090                MOVE SPACES TO XL088-PROCESS-MESSAGE-TXT          01409001
014091           WHEN SQLWARN0 NOT = SPACES                             01409101
014092           WHEN SQLCODE < ZERO                                    01409201
014093           WHEN SQLCODE > ZERO                                    01409301
014094                SET XL088-ONHAND-ERROR-Y TO TRUE                  01409401
014095                MOVE SQLCODE TO PV-DISPLAY-SQLCODE                01409501
014096                MOVE RECITM-ITM-NBR   TO PV-DISPLAY-ITM-NBR       01409601
014097                STRING   ' XLKUT088-7100-'                        01409701
014098                        ' CALLED BY-'                             01409801
014099                        XL088-CALLING-PROGRAM                     01409901
014100                        ' SQLCODE= '                              01410001
014101                        PV-DISPLAY-SQLCODE                        01410101
014102                        ' PROCESS MESSAGE CODE '                  01410201
014103                        SUT00093-PRC-MSG-CDE                      01410301
014104                        ' ITEM NBR '                              01410401
014105                        PV-DISPLAY-ITM-NBR                        01410501
014106                        DELIMITED BY SIZE                         01410601
014107                                        INTO PV-CICS-MSG-AREA     01410701
014108                PERFORM 9999-WRITE-TO-CSSL                        01410801
014109                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01410901
014110               SET XL088-NOT-SUCCESSFUL TO TRUE                   01411001
014111               MOVE SQLCODE TO XL088-RETURN-SQLCODE               01411101
014112       END-EVALUATE.                                              01411201
014113                                                                  01411301
014114 7500-INSERT-PROCESS-MSG.                                         01411401
014115                                                                  01411501
014116                                                                  01411601
014117     EXEC SQL                                                     01411701
014118         INSERT INTO SUT_PRC_MSG_CNTL                             01411801
014119               (PO_NBR                                            01411901
014120              , RCVR_LNE_NBR                                      01412001
014121              , RCVR_SEQ_NBR                                      01412101
014122              , DEST_LOC_NBR                                      01412201
014123              , SHIPT_UNT_ID                                      01412301
014124              , CRE_TMST                                          01412401
014125              , PRC_MSG_CDE )                                     01412501
014126         VALUES                                                   01412601
014127              (:SUT00094-PO-NBR                                   01412701
014128             , :SUT00094-RCVR-LNE-NBR                             01412801
014129             , :SUT00094-RCVR-SEQ-NBR                             01412901
014130             , :SUT00094-DEST-LOC-NBR                             01413001
014131             , :SUT00094-SHIPT-UNT-ID                             01413101
014132             ,  CURRENT TIMESTAMP                                 01413201
014133             , :SUT00094-PRC-MSG-CDE )                            01413301
014134     END-EXEC.                                                    01413401
014135                                                                  01413501
014136     EVALUATE TRUE                                                01413601
014137         WHEN SQLCODE = ZERO                                      01413701
014138         WHEN SQLCODE = -803                                      01413809
014139              CONTINUE                                            01413909
014140         WHEN SQLWARN0 NOT = SPACES                               01414009
014141         WHEN SQLCODE < ZERO                                      01414109
014142         WHEN SQLCODE > ZERO                                      01414209
014143              SET XL088-ONHAND-ERROR-Y TO TRUE                    01414309
014144              MOVE SUT00094-SHIPT-UNT-ID TO PV-DISPLAY-CARTON     01414409
014145              MOVE SQLCODE TO PV-DISPLAY-SQLCODE                  01414509
014146              STRING   ' XLKUT088-7500-'                          01414609
014147                      ' CALLED BY-'                               01414709
014148                      XL088-CALLING-PROGRAM                       01414809
014149                      ' SQLCODE= '                                01414909
014150                      PV-DISPLAY-SQLCODE                          01415009
014151                      ' OTBND CRTN FAILED INSERT '                01415109
014152                      PV-DISPLAY-CARTON                           01415209
014153                      DELIMITED BY SIZE                           01415309
014154                                      INTO PV-CICS-MSG-AREA       01415409
014155              PERFORM 9999-WRITE-TO-CSSL                          01415509
014156              MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG     01415609
014157             SET XL088-NOT-SUCCESSFUL TO TRUE                     01415709
014158             MOVE SQLCODE TO XL088-RETURN-SQLCODE                 01415809
014159     END-EVALUATE.                                                01415909
014160*---------------------------------------------------------------  01416009
014161*  LINK TO THE ON-HAND XM MODULE.                                 01416109
014162*  1/30/06 CHANGE- CHECK FOR RETURN OF XM003-ONHAND-ERROR-Y       01416209
014163*  WHEN FOUND TREAT ITEM AS ZERO ON HAND AND CONTINUE PROCESSING  01416309
014164*---------------------------------------------------------------  01416409
014165 8000-CALL-ONHAND-MODULE.                                         01416509
014166                                                                  01416609
014167     MOVE XL088-ITEM-NBR       TO XM003-ITEM-NBR                  01416709
014168                                  PV-DISPLAY-ITM-NBR.             01416809
014169     MOVE XL088-KEY-STR-NBR    TO XM003-KEY-STR-NBR               01416909
014170                                  PV-DISPLAY-STORE.               01417009
014171     MOVE LENGTH OF XM003-ITEM-COMMAREA TO PV-COMMAREA-LENGTH.    01417109
014172                                                                  01417209
014173     EXEC CICS                                                    01417309
014174         LINK                                                     01417409
014175             PROGRAM   (PC-ONHAND-PROGRAM)                        01417509
014176             COMMAREA  (XM003-ITEM-COMMAREA)                      01417609
014177             LENGTH    (PV-COMMAREA-LENGTH)                       01417709
014178             RESP      (PV-CICS-RESPONSE)                         01417809
014179     END-EXEC.                                                    01417909
014180                                                                  01418009
014181     EVALUATE TRUE                                                01418109
014182        WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                  01418209
014183           EVALUATE TRUE                                          01418309
014184             WHEN XM003-SUCCESSFUL                                01418409
014185               IF XM003-ONHAND-ERROR-Y                            01418509
014186                  MOVE 0       TO XM003-ONHAND                    01418609
014190                                  XM003-YTD-SALES-AMT             01419000
014200                                  XM003-YTD-SALES-UNIT-QTY        01420000
014300                  MOVE SPACES  TO XM003-LAST-SALE-DATE            01430000
014400                                  XM003-FIRST-RCVD-DATE           01440000
014500                                  XM003-FIRST-SALE-DATE           01450000
014600                                  XM003-LAST-RCVD-DATE            01460000
014700               ELSE                                               01470000
014800                  SET XM003-ONHAND-ERROR-N TO TRUE                01480000
014900               END-IF                                             01490000
015000             WHEN OTHER                                           01500000
015100                MOVE 0         TO XM003-ONHAND                    01510000
015200                                  XM003-YTD-SALES-AMT             01520000
015300                                  XM003-YTD-SALES-UNIT-QTY        01530000
015310                MOVE SPACES    TO XM003-LAST-SALE-DATE            01531000
015320                                  XM003-FIRST-RCVD-DATE           01532000
015330                                  XM003-FIRST-SALE-DATE           01533000
015340                                  XM003-LAST-RCVD-DATE            01534000
015350                MOVE XM003-RETURN-SQLCODE TO PV-DISPLAY-SQLCODE   01535000
015360                STRING   ' XLKUT088-8000-'                        01536000
015370                        ' CALLED BY-'                             01537000
015380                        XL088-CALLING-PROGRAM                     01538000
015390                        ' SQLCODE= '                              01539000
015400                        PV-DISPLAY-SQLCODE                        01540000
015410                        ' ITM NBR= '                              01541000
015420                        PV-DISPLAY-ITM-NBR                        01542000
015430                        ' STORE = '                               01543000
015440                        PV-DISPLAY-STORE                          01544000
015450                        DELIMITED BY SIZE                         01545000
015460                                        INTO PV-CICS-MSG-AREA     01546000
015470                PERFORM 9999-WRITE-TO-CSSL                        01547000
015480                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01548000
015490           END-EVALUATE                                           01549000
015500        WHEN OTHER                                                01550000
015600                SET XL088-ONHAND-ERROR-Y TO TRUE                  01560000
015700                SET XM003-ONHAND-ERROR-Y TO TRUE                  01570000
015710                MOVE XM003-RETURN-SQLCODE TO PV-DISPLAY-SQLCODE   01571000
015720                STRING   ' XLKUT088-8000-'                        01572000
015730                        ' CALLED BY-'                             01573000
015740                        XL088-CALLING-PROGRAM                     01574000
015750                        ' SQLCODE= '                              01575000
015760                        PV-DISPLAY-SQLCODE                        01576000
015770                        ' ITM NBR= '                              01577000
015780                        PV-DISPLAY-ITM-NBR                        01578000
015790                        ' STORE = '                               01579000
015791                        PV-DISPLAY-STORE                          01579100
015792                        DELIMITED BY SIZE                         01579200
015793                                        INTO PV-CICS-MSG-AREA     01579300
015794                PERFORM 9999-WRITE-TO-CSSL                        01579400
015795                MOVE PV-CICS-MSG-AREA      TO XL088-CRA-RET-MSG   01579500
015796     END-EVALUATE.                                                01579600
015797                                                                  01579700
015798                                                                  01579800
015799 9999-WRITE-TO-CSSL.                                              01579900
015800                                                                  01580000
015900     MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.      01590000
016000                                                                  01600000
016100     EXEC CICS                                                    01610000
016200          WRITEQ TD                                               01620000
016300           QUEUE   ('CSSL')                                       01630000
016400            FROM   (PV-CICS-MSG-AREA)                             01640000
016500          LENGTH   (PV-COMMAREA-LENGTH)                           01650000
016600            RESP   (PV-CICS-RESPONSE)                             01660000
016700     END-EXEC.                                                    01670000
016800                                                                  01680000
