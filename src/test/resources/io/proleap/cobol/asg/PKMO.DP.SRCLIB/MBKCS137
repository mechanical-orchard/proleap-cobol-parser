00001 *************************                                         06/04/92
00002  IDENTIFICATION DIVISION.                                         MBKCS137
00003 *************************                                            LV001
00004                                                                      CL**2
00005  PROGRAM-ID.    MBKCS137.                                            CL**2
00006  AUTHOR.        JO ANN M SCHMIDT.                                    CL**2
00007  INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**2
00008  DATE-WRITTEN.  04-01-92.                                            CL**2
00009  DATE-COMPILED.                                                      CL**2
00010                                                                      CL**2
00011 *****************************************************************    CL**2
00012 *    R137 - WORKER LIST SCREEN                                       CL**2
00013 *                                                                    CL**2
00014 *    THIS PROGRAM GENERATES A LIST OF WORKERS BASED UPON THE         CL**2
00015 *    SELECTION CRITERIA SPECIFIED ON THE WORKER SELECTION SCREEN     CL**2
00016 *    (MBKCS136 - R136).                                              CL**2
00017 *                                                                    CL**2
00018 *    THE OPERATOR MAY INVOKE THE ADD, DELETE, OR UPDATE MAINTENANC   CL**2
00019 *    FUNCTIONS FROM THIS PROGRAM.  AT LEAST ONE ITEM MUST BE         CL**2
00020 *    SELECTED FROM THE LIST TO PASS CONTROL.                         CL**2
00021 *                                                                    CL**2
00022 *****************************************************************    CL**2
262978* CHANGED 10/22/2021    BY JIM HUNTER      WR: CHG0262978                 
262978* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
262978* MAKING THE CALL DYNAMIC VS STATIC.                                      
262978******************************************************************        
00023 *                                                                    CL**2
00024 *                                                                    CL**2
00025 *                                                                    CL**2
00026  ENVIRONMENT DIVISION.                                               CL**2
00027 *                                                                    CL**2
00028 *                                                                    CL**2
00029 *                                                                    CL**2
00030  DATA DIVISION.                                                      CL**2
00031 *                                                                    CL**2
00032      EJECT                                                           CL**2
00033 *                                                                    CL**2
00034  WORKING-STORAGE SECTION.                                            CL**2
00035 *                                                                    CL**2
00036  01  PC-PROGRAM-CONSTANTS.                                           CL**2
00037      05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.   CL**2
00038      05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072     CL**2
00039                                                      COMP SYNC.      CL**2
00040      05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE           CL**2
00041      'MB137A  '.                                                     CL**2
00042      05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE           CL**2
00043      'MBKM137 '.                                                     CL**2
00044      05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE           CL**2
00045      'MBKCS137'.                                                     CL**2
00046      05  PC-WKR-ADD-MNEMONIC            PIC X(08)    VALUE           CL**2
00047      'MBAWORKR'.                                                     CL**2
00048      05  PC-WKR-DEL-MNEMONIC            PIC X(08)    VALUE           CL**2
00049      'MBDWORKR'.                                                     CL**2
00050      05  PC-WKR-UPD-MNEMONIC            PIC X(08)    VALUE           CL**2
00051      'MBUWORKR'.                                                     CL**2
00052 *                                                                    CL**2
00053      05  PC-COMPANY                     PIC X(2)     VALUE '03'.     CL**2
00054 *                                                                    CL**2
00055      05  PC-BEGINNING                   PIC X(01)    VALUE 'B'.      CL**2
00056      05  PC-ENDING                      PIC X(01)    VALUE 'E'.      CL**2
00057      05  PC-SELECTED                    PIC X(01)    VALUE 'S'.      CL**2
00058 *                                                                    CL**2
00059      05  PC-ITEMS-PER-PANEL             PIC S9(04)   VALUE +12       CL**2
00060                                                      COMP SYNC.      CL**2
00061      05  PC-ITEMS-PER-BLOCK             PIC S9(04)   VALUE +12       CL**2
00062                                                      COMP SYNC.      CL**2
00063 *                                                                    CL**2
00064 *      ** PC-BLOCK-LENGTH  OF  +661  WAS COMPUTED AS :               CL**2
00065 *      ** = (1 + ((A ROW = 55 BYTES) X (12 ENTRIES PER BLOCK))       CL**2
00066      05  PC-BLOCK-LENGTH                PIC S9(04)   VALUE +661      CL**2
00067                                                      COMP SYNC.      CL**2
00068 *                                                                    CL**2
00069      05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)   VALUE +2        CL**2
00070                                                      COMP SYNC.      CL**2
00071 *                                                                    CL**2
00072 *    **  LENGTH OF THE ENTERABLE BEGINING OF LIST VALUE **           CL**2
00073      05  PC-FIELD-LENGTH                PIC S9(04)   VALUE +5        CL**2
00074                                                      COMP SYNC.      CL**2
00075 *    **  THE FARTHEST FWD/BKWD JUMP A USER CAN MAKE (ITEMS) **       CL**2
00076      05  PC-MAX-ITEMS-TO-BE-READ        PIC S9(04)   VALUE +100      CL**2
00077                                                      COMP SYNC.      CL**2
00078 *    **  MAX. NBR OF ITEMS TO APPEAR IN A LIST **                    CL**2
00079      05  PC-MAX-ITEMS                   PIC S9(09)   VALUE           CL**2
00080                                                      +1000000        CL**2
00081                                                      COMP-3.         CL**2
00082 *                                                                    CL**2
00083      05  PC-ERASE-EOF-COMP              PIC S9(04)   VALUE +128      CL**2
00084                                                      COMP SYNC.      CL**2
00085      05  FILLER REDEFINES PC-ERASE-EOF-COMP.                         CL**2
00086          10  FILLER                     PIC X(01).                   CL**2
00087          10  PC-ERASE-EOF               PIC X(01).                   CL**2
00088 *                                                                    CL**2
00089 *    **  THE MAX. NUMBER OF SQL EXECUTION ATTEMPTS BEFORE ABEND **   CL**2
00090      05  PC-MAX-RETRIES                 PIC S9(3)    VALUE +3        CL**2
00091                                                      COMP-3.         CL**2
00092      EJECT                                                           CL**2
00093                                                                      CL**2
00094  01  PC-TSYMSG-NUMBERS.                                              CL**2
00095      05  PC-TSYMSG-00005                PIC 9(5)    VALUE 00005.     CL**2
00096      05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.     CL**2
00097      05  PC-TSYMSG-00045                PIC 9(5)    VALUE 00045.     CL**2
00098      05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.     CL**2
00099      05  PC-TSYMSG-00051                PIC 9(5)    VALUE 00051.     CL**2
00100      05  PC-TSYMSG-00052                PIC 9(5)    VALUE 00052.     CL**2
00101      05  PC-TSYMSG-00053                PIC 9(5)    VALUE 00053.     CL**2
00102      05  PC-TSYMSG-00054                PIC 9(5)    VALUE 00054.     CL**2
00103      05  PC-TSYMSG-00055                PIC 9(5)    VALUE 00055.     CL**2
00104      05  PC-TSYMSG-00057                PIC 9(5)    VALUE 00057.     CL**2
00105      05  PC-TSYMSG-00061                PIC 9(5)    VALUE 00061.     CL**2
00106      05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.     CL**2
00107      05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.     CL**2
00108      05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.     CL**2
00109      05  PC-TSYMSG-00146                PIC 9(5)    VALUE 00146.     CL**2
00110      05  PC-TSYMSG-00207                PIC 9(5)    VALUE 00207.     CL**2
00111      05  PC-TSYMSG-99901                PIC 9(5)    VALUE 99901.     CL**2
00112 *                                                                    CL**2
00113  01  PM-PROGRAM-MESSAGES.                                            CL**2
00114      05  PM-PROGRAM-MESSAGE-1           PIC X(78)    VALUE           CL**2
00115          'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.               CL**2
00116      05  PM-PROGRAM-MESSAGE-2.                                       CL**2
00117          10  FILLER                     PIC X(39)    VALUE           CL**2
00118               'ERROR READING TWORKER TABLE; SQLCODE = '.             CL**2
00119          10  PM-SQLCODE-2               PIC Z(08)9-.                 CL**2
00120          10  FILLER                     PIC X(30)    VALUE SPACES.   CL**2
00121      05  PM-PROGRAM-MESSAGE-3.                                       CL**2
00122          10  FILLER                     PIC X(28)    VALUE           CL**2
00123               'INTER APPLICATION DATA ERROR'.                        CL**2
00124          10  FILLER                     PIC X(50)    VALUE SPACES.   CL**2
00125      05  PM-PROGRAM-MESSAGE-5.                                       CL**2
00126          10  FILLER                     PIC X(28)    VALUE           CL**2
00127               'ERROR DURING DELETE ATTEMPT '.                        CL**2
00128          10  FILLER                     PIC X(50)    VALUE SPACES.   CL**2
00129      05  PM-PROGRAM-MESSAGE-6.                                       CL**2
00130          10  FILLER                     PIC X(28)    VALUE           CL**2
00131               'ERROR DURING UPDATE ATTEMPT '.                        CL**2
00132          10  FILLER                     PIC X(50)    VALUE SPACES.   CL**2
00133      05  PM-PROGRAM-MESSAGE-7.                                       CL**2
00134          10  FILLER                     PIC X(36)    VALUE           CL**2
00135               'ERROR ATTEMPTING WORKER ADD FUNCTION'.                CL**2
00136          10  FILLER                     PIC X(42)    VALUE SPACES.   CL**2
00137      05  PM-PROGRAM-MESSAGE-9           PIC X(78)    VALUE           CL**2
00138      'ERROR TRYING TO REWRITE  TEMP STORAGE QUEUE - RESP '.          CL**2
00139      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-9.                      CL**2
00140          10  FILLER                     PIC X(51).                   CL**2
00141          10  PM-RESP-9                  PIC Z(03)9-.                 CL**2
00142          10  FILLER                     PIC X(22).                   CL**2
00143      05  PM-PROGRAM-MESSAGE-10          PIC X(78)    VALUE           CL**2
00144      'ERROR TRYING TO WRITE TO TEMP STORAGE QUEUE - RESP '.          CL**2
00145      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-10.                     CL**2
00146          10  FILLER                     PIC X(51).                   CL**2
00147          10  PM-RESP-10                 PIC Z(03)9-.                 CL**2
00148          10  FILLER                     PIC X(22).                   CL**2
00149      05  PM-PROGRAM-MESSAGE-11          PIC X(78)    VALUE           CL**2
00150      'LOGIC ERROR IN TRYING TO WRITE TO TEMP STORAGE QUEUE - BLOCK   CL**2
00151 -    '     '.                                                        CL**2
00152      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-11.                     CL**2
00153          10  FILLER                     PIC X(61).                   CL**2
00154          10  PM-BLOCK-NUMBER            PIC Z(03)9-.                 CL**2
00155          10  FILLER                     PIC X(12).                   CL**2
00156      05  PM-PROGRAM-MESSAGE-12          PIC X(78)    VALUE           CL**2
00157      'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.                   CL**2
00158      05  PM-PROGRAM-MESSAGE-23          PIC X(78)    VALUE           CL**2
00159      'ERROR TRYING TO DELETE TEMP STORAGE QUEUE - RESP '.            CL**2
00160      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-23.                     CL**2
00161          10  FILLER                     PIC X(49).                   CL**2
00162          10  PM-RESP-23                 PIC Z(03)9-.                 CL**2
00163          10  FILLER                     PIC X(24).                   CL**2
00164      05  PM-PROGRAM-MESSAGE-24          PIC X(78)    VALUE           CL**2
00165      'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE - RESP '.         CL**2
00166      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-24.                     CL**2
00167          10  FILLER                     PIC X(52).                   CL**2
00168          10  PM-RESP-24                 PIC Z(03)9-.                 CL**2
00169          10  FILLER                     PIC X(21).                   CL**2
00170      05  PM-PROGRAM-MESSAGE-28          PIC X(78)    VALUE           CL**2
00171      'ERROR OCCURRED DURING TS QUEUE PROCESSING'.                    CL**2
00172 *                                                                    CL**2
00173      EJECT                                                           CL**2
00174                                                                      CL**2
00175  01  PS-PROGRAM-SUBSCRIPTS.                                          CL**2
00176      05  PS-SUB                         PIC S9(04)   VALUE +0        CL**2
00177                                                      COMP SYNC.      CL**2
00178      05  PS-ITEMS-SUB                   PIC S9(09)   VALUE +0        CL**2
00179                                                      COMP-3.         CL**2
00180                                                                      CL**2
00181  01  PS-PROGRAM-SWITCHES.                                            CL**2
00182      05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.      CL**2
00183          88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.      CL**2
00184          88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.      CL**2
00185          88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.      CL**2
00186          88  PS-SEND-DATA-ONLY                       VALUE '4'.      CL**2
00187          88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.      CL**2
00188          88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.      CL**2
00189      05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.      CL**2
00190          88  PS-ERROR                                VALUE 'Y'.      CL**2
00191          88  PS-NO-ERROR                             VALUE 'N'.      CL**2
00192      05  PS-TOP-ITEM-IN-ARRAY-SW        PIC X(01)    VALUE 'N'.      CL**2
00193          88  PS-TOP-ITEM-IN-ARRAY                    VALUE 'Y'.      CL**2
00194          88  PS-TOP-ITEM-NOT-IN-ARRAY                VALUE 'N'.      CL**2
00195      05  PS-BOTTOM-ITEM-IN-ARRAY-SW     PIC X(01)    VALUE 'N'.      CL**2
00196          88  PS-BOTTOM-ITEM-IN-ARRAY                 VALUE 'Y'.      CL**2
00197          88  PS-BOTTOM-ITEM-NOT-IN-ARRAY             VALUE 'N'.      CL**2
00198      05  PS-TOP-ITEM-IN-TEMP-SW         PIC X(01)    VALUE 'N'.      CL**2
00199          88  PS-TOP-ITEM-IN-TEMP                     VALUE 'Y'.      CL**2
00200          88  PS-TOP-ITEM-NOT-IN-TEMP                 VALUE 'N'.      CL**2
00201      05  PS-BOTTOM-ITEM-IN-TEMP-SW      PIC X(01)    VALUE 'N'.      CL**2
00202          88  PS-BOTTOM-ITEM-IN-TEMP                  VALUE 'Y'.      CL**2
00203          88  PS-BOTTOM-ITEM-NOT-IN-TEMP              VALUE 'N'.      CL**2
00204      05  PS-LAST-BLOCK-IN-ARRAY-SW      PIC X(01)    VALUE 'N'.      CL**2
00205          88  PS-LAST-BLOCK-IN-ARRAY                  VALUE 'Y'.      CL**2
00206          88  PS-LAST-BLOCK-NOT-IN-ARRAY              VALUE 'N'.      CL**2
00207      05  PS-VALID-SELECTIONS-SW         PIC X(01)    VALUE 'Y'.      CL**2
00208          88  PS-VALID-SELECTIONS                     VALUE 'Y'.      CL**2
00209          88  PS-INVALID-SELECTIONS                   VALUE 'N'.      CL**2
00210      05  PS-VALID-BEG-ITEM-SW           PIC X(01)    VALUE 'N'.      CL**2
00211          88  PS-VALID-BEG-ITEM                       VALUE 'Y'.      CL**2
00212          88  PS-INVALID-BEG-ITEM                     VALUE 'N'.      CL**2
00213                                                                      CL**2
00214      05  PS-SELECTION-FOUND-SW          PIC X(01)    VALUE 'N'.      CL**2
00215          88  PS-SELECTION-FOUND                      VALUE 'Y'.      CL**2
00216          88  PS-NO-SELECTION-FOUND                   VALUE 'N'.      CL**2
00217      05  PS-WARNING-SW                  PIC X(01)    VALUE 'N'.      CL**2
00218          88  PS-WARNING                              VALUE 'Y'.      CL**2
00219          88  PS-NO-WARNING                           VALUE 'N'.      CL**2
00220      05  PS-INFORMATIONAL-SW            PIC X(01)    VALUE 'N'.      CL**2
00221          88  PS-INFORMATIONAL                        VALUE 'Y'.      CL**2
00222          88  PS-NOT-INFORMATIONAL                    VALUE 'N'.      CL**2
00223      05  PS-PROCESS-ITEM-SW             PIC X(01)    VALUE 'N'.      CL**2
00224          88  PS-END-OF-ITEMS                         VALUE 'Y'.      CL**2
00225          88  PS-NOT-END                              VALUE 'N'.      CL**2
00226      05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.      CL**2
00227          88  PS-COMMAREA-VALID                       VALUE 'Y'.      CL**2
00228          88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.      CL**2
00229      05  PS-NEW-ROW-FETCHED-SW          PIC X(01)    VALUE 'N'.      CL**2
00230          88  PS-NEW-ROW-FETCHED                      VALUE 'Y'.      CL**2
00231          88  PS-PREV-ROW-FETCHED                     VALUE 'N'.      CL**2
00232      05  PS-INTER-APPL-VALID-SW         PIC X(01)    VALUE 'N'.      CL**2
00233          88  PS-INTER-APPL-VALID                     VALUE 'Y'.      CL**2
00234          88  PS-INTER-APPL-NOT-VALID                 VALUE 'N'.      CL**2
00235      05  PS-SAME-ITEMS-DISPLAYED-SW     PIC X(01)    VALUE 'N'.      CL**2
00236          88  PS-SAME-ITEMS-DISPLAYED                 VALUE 'Y'.      CL**2
00237          88  PS-DIFFERENT-ITEMS-DISPLAYED            VALUE 'N'.      CL**2
00238      05  PS-CURSOR-POSITIONED-SW        PIC X(01)    VALUE 'N'.      CL**2
00239          88  PS-CURSOR-POSITIONED                    VALUE 'Y'.      CL**2
00240          88  PS-CURSOR-NOT-POSITIONED                VALUE 'N'.      CL**2
00241      05  PS-RETURNED-FROM-MAINT         PIC X(01)    VALUE 'N'.      CL**2
00242          88  PS-RETURNING-FROM-MAINT                 VALUE 'Y'.      CL**2
00243          88  PS-NO-RETURN-FROM-MAINT                 VALUE 'N'.      CL**2
00244                                                                      CL**2
00245      EJECT                                                           CL**2
00246                                                                      CL**2
00247  01  PV-PROGRAM-VARIABLES.                                           CL**2
00248      05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0        CL**2
00249                                                      COMP SYNC.      CL**2
00250      05  PV-HIGHEST-ITEM-TO-BE-READ     PIC S9(09)   VALUE +0        CL**2
00251                                                      COMP-3.         CL**2
00252      05  PV-ENDING-ITEM-ON-PANEL        PIC S9(09)   VALUE +0        CL**2
00253                                                      COMP-3.         CL**2
00254      05  PV-ITEM-IN-USE                 PIC S9(09)   VALUE +0        CL**2
00255                                                      COMP-3.         CL**2
00256      05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0        CL**2
00257                                                      COMP-3.         CL**2
00258      05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0        CL**2
00259                                                      COMP-3.         CL**2
00260      05  PV-MAX-ITEMS-TO-BE-READ        PIC S9(09)   VALUE +0        CL**2
00261                                                      COMP-3.         CL**2
00262      05  PV-FIRST-ITEM-IN-ARRAY         PIC S9(09)   VALUE +0        CL**2
00263                                                      COMP-3.         CL**2
00264      05  PV-LAST-ITEM-IN-ARRAY          PIC S9(09)   VALUE +0        CL**2
00265                                                      COMP-3.         CL**2
00266      05  PV-LAST-ITEM-IN-TEMP           PIC S9(09)   VALUE +0        CL**2
00267                                                      COMP-3.         CL**2
00268      05  PV-BEGINNING-ITEM              PIC S9(09)   VALUE +0        CL**2
00269                                                      COMP-3.         CL**2
00270      05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)   VALUE +0        CL**2
00271                                                      COMP-3.         CL**2
00272      05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0        CL**2
00273                                                      COMP SYNC.      CL**2
00274      05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0        CL**2
00275                                                      COMP SYNC.      CL**2
00276      05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0        CL**2
00277                                                      COMP SYNC.      CL**2
00278      05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)   VALUE +0        CL**2
00279                                                      COMP SYNC.      CL**2
00280      05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)   VALUE +0        CL**2
00281                                                      COMP SYNC.      CL**2
00282      05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)   VALUE +0        CL**2
00283                                                      COMP SYNC.      CL**2
00284      05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)   VALUE +0        CL**2
00285                                                      COMP SYNC.      CL**2
00286      05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)   VALUE +0        CL**2
00287                                                      COMP SYNC.      CL**2
00288      05  PV-START-OF-SELECTED-RANGE     PIC S9(04)   VALUE +0        CL**2
00289                                                      COMP SYNC.      CL**2
00290      05  PV-END-OF-SELECTED-RANGE       PIC S9(04)   VALUE +0        CL**2
00291                                                      COMP SYNC.      CL**2
00292                                                                      CL**2
00293      05  PV-ITEM                        PIC S9(04)   VALUE +0        CL**2
00294                                                      COMP SYNC.      CL**2
00295      05  PV-LIST-ITEM                   PIC S9(04)   VALUE +0        CL**2
00296                                                      COMP SYNC.      CL**2
00297      05  PV-SAVE-ITEM                   PIC S9(04)   VALUE +0        CL**2
00298                                                      COMP SYNC.      CL**2
00299      05  PV-ITEMS-READ                  PIC S9(04)   VALUE +0        CL**2
00300                                                      COMP SYNC.      CL**2
00301                                                                      CL**2
00302      05  PV-MESSAGE                     PIC X(78)    VALUE SPACES.   CL**2
00303      05  PV-SQL-WKR-SUB                 PIC S9(4)    COMP.           CL**2
00304      05  PV-BEGITMI.                                                 CL**2
00305          10  PV-BEGITMI-N               PIC 9(5).                    CL**2
00306      05  PV-DISPLAY5                    PIC ZZZZ9.                   CL**2
00307                                                                      CL**2
00308      05  PV-BG-QUEUE-NAME.                                           CL**2
00309          10  PV-BG-TERM-ID              PIC X(4).                    CL**2
00310          10  PV-BG-TASK-NUMBER          PIC S9(7)    COMP-3.         CL**2
00311 *                                                                    CL**2
00312  EJECT                                                               CL**2
00313 *****************************************************************    CL**2
00314 *    STANDARD COMMAREA.                                              CL**2
00315 *****************************************************************    CL**2
00316                                                                      CL**2
00317      COPY DPWS020.                                                   CL**3
00318      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                   CL**2
00319                                                                      CL**2
00320      EJECT                                                           CL**2
00321 *****************************************************************    CL**2
00322 *    INTER-APPLICATION COMMAREA.                                     CL**2
00323 *****************************************************************    CL**2
00324                                                                      CL**2
00325          10  INTER-APPL-COMM-AREA       PIC X(200).                  CL**2
00326      COPY MBWS007.                                                   CL**3
00327                                                                      CL**2
00328      EJECT                                                           CL**2
00329 *****************************************************************    CL**2
00330 *    SPECIFIC COMMMAREA FOR MBKCS137.                                CL**2
00331 *    MAX LENGTH = 2865                                               CL**2
00332 *****************************************************************    CL**2
00333                                                                      CL**2
00334          10  MB137-SPECIFIC-COMMAREA.                                CL**2
00335                                                                      CL**2
00336              15  MB137-APPL-CURSOR-POSITION          PIC S9(04)      CL**2
00337                                                      COMP.           CL**2
00338              15  MB137-BLOCK-ENTRIES OCCURS 2 TIMES.                 CL**2
00339                                                                      CL**2
00340 ******************************************************************   CL**2
00341 *                                                                *   CL**2
00342 *   THIS IS LSIT TS QUEUE RECORD LAYOUT USED IN MBKCS137 AND     *   CL**2
00343 *   PASSED TO MBKCS138, THE WORKER MAINTENANCE MODULE.           *   CL**2
00344 *                                                                *   CL**2
00345 *   NOTE!  THERE IS NO 01 LEVEL DEFINED HERE.                    *   CL**2
00346 *                                                                *   CL**2
00347 *   SIZE: 661  BYTES = 55 X 12 ITEMS + 1   (1322)                *   CL**2
00348 ******************************************************************   CL**2
00349                18  MB007Q-TSQ-LIST.                                  CL**2
00350                                                                      CL**2
00351                  20  MB007Q-BLOCK-MODIFIED-SW        PIC X(01).      CL**2
00352                      88  MB007Q-BLOCK-NOT-MODIFIED   VALUE 'N'.      CL**2
00353                      88  MB007Q-BLOCK-MODIFIED       VALUE 'Y'.      CL**2
00354                  20  MB007Q-ITEM-ARRAY.                              CL**2
00355                      25  MB007Q-ITEM-ENTRIES OCCURS 12 TIMES         CL**2
00356                                            INDEXED BY MB007Q-IDX.    CL**2
00357                          30  MB007Q-LIST-ITEM-NBR    PIC S9(09)      CL**2
00358                                                          COMP-3.     CL**2
00359                          30  MB007Q-SELECTED-SW      PIC X(01).      CL**2
00360                              88  MB007Q-NO-SELECT    VALUE ' '.      CL**2
00361                              88  MB007Q-SELECT       VALUE 'S'.      CL**2
00362                              88  MB007Q-BEGIN        VALUE 'B'.      CL**2
00363                              88  MB007Q-END          VALUE 'E'.      CL**2
00364                              88  MB007Q-MAINTAINED                   CL**2
00365                                    VALUES 'D' 'I' 'U'.               CL**2
00366                          30  MB007Q-REC-ACTION       PIC X(03).      CL**2
00367                          30  MB007Q-WKR-OPERCO       PIC X(02).      CL**2
00368                          30  MB007Q-WKR-NBR          PIC X(06).      CL**2
00369                          30  MB007Q-WKR-UID-NBR      PIC X(08).      CL**2
00370                          30  MB007Q-WKR-LNAME        PIC X(18).      CL**2
00371                          30  MB007Q-WKR-FNAME        PIC X(12).      CL**2
00372 *                                                                    CL**2
00373              15  MB137-BLK-SUB                       PIC S9(04)      CL**2
00374                                                          COMP        CL**2
00375                                                          SYNC.       CL**2
00376              15  MB137-ITEM-SUB                      PIC S9(04)      CL**2
00377                                                          COMP        CL**2
00378                                                          SYNC.       CL**2
00379              15  MB137-MAX-DB-ITEMS                  PIC S9(09)      CL**2
00380                                                          COMP-3.     CL**2
00381              15  MB137-NUMBER-OF-ITEMS-READ          PIC S9(09)      CL**2
00382                                                          COMP-3.     CL**2
00383              15  MB137-ITEM-AT-TOP-OF-PANEL          PIC S9(09)      CL**2
00384                                                          COMP-3.     CL**2
00385              15  MB137-ITEM-AT-BOT-OF-PANEL          PIC S9(09)      CL**2
00386                                                          COMP-3.     CL**2
00387              15  MB137-HIGHEST-BLOCK-WRITTEN         PIC S9(04)      CL**2
00388                                                          COMP        CL**2
00389                                                          SYNC.       CL**2
00390              15  MB137-START-OF-SELECTED-RANGE       PIC S9(09)      CL**2
00391                                                          COMP-3.     CL**2
00392              15  MB137-END-OF-SELECTED-RANGE         PIC S9(09)      CL**2
00393                                                          COMP-3.     CL**2
00394              15  MB137-ITEMS-LEFT-INDICATOR          PIC X.          CL**2
00395                  88  MB137-ITEMS-LEFT-ON-DB            VALUE 'Y'.    CL**2
00396                  88  MB137-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.    CL**2
00397 *                                                                    CL**2
00398              15  MB137-1ST-TIME-IN-SW                PIC X(001).     CL**2
00399                  88  MB137-1ST-TIME-IN               VALUE 'Y'.      CL**2
00400                  88  MB137-NOT-1ST-TIME-IN           VALUE 'N'.      CL**2
00401 *                                                                    CL**2
00402              15  MB137-BEGIN-LNAME                   PIC X(018).     CL**2
00403              15  MB137-END-LNAME                     PIC X(018).     CL**2
00404 *                                                                    CL**2
00405              15  MB137-LAST-FNAME-FETCHED            PIC X(012).     CL**2
00406 *                                                                    CL**2
00407              15  MB137-USERID                        PIC X(008).     CL**2
00408 *                                                                    CL**2
00409              15  MB137-WORKER-NBR                    PIC S9(6)V      CL**2
00410                                                          COMP-3.     CL**2
00411 *                                                                    CL**2
00412              15  MB137-SAVE-INTER-APPL-COMMAREA.                     CL**2
00413                  20  FILLER                          PIC X(008).     CL**2
00414                  20  MB137-SAVE-QUEUE-NAME           PIC X(008).     CL**2
00415                  20  MB137-SAVE-QUEUE-LENGTH         PIC S9(04)      CL**2
00416                                                      COMP.           CL**2
00417                  20  MB137-SAVE-NBR-SEL-ITEMS        PIC S9(09)      CL**2
00418                                                      COMP-3.         CL**2
00419                  20  MB137-SAVE-NBR-PRC-ITEMS        PIC S9(09)      CL**2
00420                                                      COMP-3.         CL**2
00421                  20  FILLER                          PIC X(172).     CL**2
00422 *                                                                    CL**2
00423      EJECT                                                           CL**2
00424 *****************************************************************    CL**2
00425 *    ABEND PROCESSING COPYBOOK.                                      CL**2
00426 *****************************************************************    CL**2
00427                                                                      CL**2
00428      COPY DPWS013.                                                   CL**2
00429                                                                      CL**2
00430      EJECT                                                           CL**2
00431 *****************************************************************    CL**2
00432 *    ATTRIBUTE SETTINGS COPYBOOK.                                    CL**2
00433 *****************************************************************    CL**2
00434                                                                      CL**2
00435      COPY DPWS015.                                                   CL**2
00436                                                                      CL**2
00437 *****************************************************************    CL**2
00438 *    CURRENT DATE AND TIME COPYBOOK.                                 CL**2
00439 *****************************************************************    CL**2
00440                                                                      CL**2
00441      COPY DPWS017.                                                   CL**2
00442                                                                      CL**2
00443 *****************************************************************    CL**2
00444 *    TOGGLE FUNCTION KEY LINES COPYBOOK.                             CL**2
00445 *****************************************************************    CL**2
00446                                                                      CL**2
00447      COPY DPWS009.                                                   CL**2
                                                                        MBKCS101
      *****************************************************************         
      *    SYSTEM MESSAGE FIELDS                                                
      *****************************************************************         
                                                                                
           COPY DPWS006.                                                        
                                                                                
00449 *****************************************************************    CL**2
00450 *    FUNCTION KEYS COPYBOOK.                                         CL**2
00451 *****************************************************************    CL**2
00452                                                                      CL**2
00453      COPY DPWS016.                                                   CL**2
00454                                                                      CL**2
00455 *****************************************************************    CL**2
00456 *    DPKUT045 COPYBOOK.                                              CL**2
00457 *****************************************************************    CL**2
00458                                                                      CL**2
00459      COPY DPWS045.                                                   CL**2
00460                                                                      CL**2
00461 *****************************************************************    CL**2
00462 *    NUMERIC EDIT LAYOUT.                                            CL**2
00463 *****************************************************************    CL**2
00464                                                                      CL**2
00465      COPY DPWS010I.                                                  CL**2
00466                                                                      CL**2
00467 *****************************************************************    CL**2
00468 *    MESSAGE RECORD LAYOUT                                           CL**2
00469 *****************************************************************    CL**2
00470                                                                      CL**2
00471      COPY DPRD507I.                                                  CL**2
00472                                                                      CL**2
00473 *****************************************************************    CL**2
00474 *    STANDARD ATTENTION IDENTIFIER LIST                              CL**2
00475 *****************************************************************    CL**2
00476                                                                      CL**2
00477      COPY DFHAID.                                                    CL**2
00478                                                                      CL**2
00479 *****************************************************************    CL**2
00480 *    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST           CL**2
00481 *****************************************************************    CL**2
00482                                                                      CL**2
00483      COPY DFHBMSCA.                                                  CL**2
00484                                                                      CL**2
00485 *****************************************************************    CL**2
00486 *    MAP LAYOUT                                                      CL**2
00487 *****************************************************************    CL**2
00488                                                                      CL**2
00489      COPY MBKM137.                                                   CL**2
00490  01  MD-MAP-DATA-AREA  REDEFINES MB137AO PIC X(1248).                CL**2
00491 *                                      (TOTAL COPYBOOK LENGTH)       CL**2
00492 *                                                                    CL**2
00493  01  MBKM137-OCCURS-LAYOUT  REDEFINES  MD-MAP-DATA-AREA.             CL**2
00494 *                                                                    CL**2
00495      05  FILLER                     PIC X(140).                      CL**2
00496 *                                                                    CL**2
00497      05  MBKM137-SCROLL-AREA OCCURS 12 TIMES.                        CL**2
00498 *           ( FULL AREA PIC X(804) OR (12 X 67) )                    CL**2
00499 *                                                                    CL**2
00500          10  MBKM137-SELECTL        PIC S9(4) COMP.                  CL**2
00501          10  MBKM137-SELECTA        PIC X.                           CL**2
00502 *                                                                    CL**2
00503          10  MBKM137-SELECTC        PIC X.                           CL**2
00504          10  MBKM137-SELECTH        PIC X.                           CL**2
00505 *                                                                    CL**2
00506          10  MBKM137-SELECT         PIC X.                           CL**2
00507 *                                                                    CL**2
00508          10  MBKM137-ACTIONL        PIC S9(4) COMP.                  CL**2
00509          10  MBKM137-ACTIONA        PIC X.                           CL**2
00510 *                                                                    CL**2
00511          10  MBKM137-ACTIONC        PIC X.                           CL**2
00512          10  MBKM137-ACTIONH        PIC X.                           CL**2
00513 *                                                                    CL**2
00514          10  MBKM137-ACTION         PIC X(3).                        CL**2
00515 *                                                                    CL**2
00516          10  FILLER                 PIC X(3).                        CL**2
00517          10  MBKM137-WKR-LNAMEC     PIC X.                           CL**2
00518          10  MBKM137-WKR-LNAMEH     PIC X.                           CL**2
00519          10  MBKM137-WKR-LNAME      PIC X(18).                       CL**2
00520 *                                                                    CL**2
00521          10  FILLER                 PIC X(3).                        CL**2
00522          10  MBKM137-WKR-FNAMEC     PIC X.                           CL**2
00523          10  MBKM137-WKR-FNAMEH     PIC X.                           CL**2
00524          10  MBKM137-WKR-FNAME      PIC X(12).                       CL**2
00525 *                                                                    CL**2
00526          10  FILLER                 PIC X(3).                        CL**2
00527          10  MBKM137-WKR-UID-NBRC   PIC X.                           CL**2
00528          10  MBKM137-WKR-UID-NBRH   PIC X.                           CL**2
00529          10  MBKM137-WKR-UID-NBR    PIC X(8).                        CL**2
00530 *                                                                    CL**2
00531      05  FILLER                     PIC X(304).                      CL**2
00532 *                                                                    CL**2
00533                                                                      CL**2
00534  EJECT                                                               CL**2
00535 *****************************************************************    CL**2
00536 *    DB2 COMMUNICATIONS AREA                                         CL**2
00537 *****************************************************************    CL**2
00538                                                                      CL**2
00539      EXEC SQL                                                        CL**2
00540          INCLUDE SQLCA                                               CL**2
00541      END-EXEC.                                                       CL**2
00542                                                                      CL**2
00543  EJECT                                                               CL**2
00544 *****************************************************************    CL**2
00545 *    DB2 WORKER TABLE                                                CL**2
00546 *****************************************************************    CL**2
00547                                                                      CL**2
00548      EXEC SQL                                                        CL**2
00549          INCLUDE TWORKER                                             CL**2
00550      END-EXEC.                                                       CL**2
00551                                                                      CL**2
00552  EJECT                                                               CL**2
00553 *****************************************************************    CL**2
00554 *    DB2 CURSOR DECLARATIONS                                         CL**2
00555 *****************************************************************    CL**2
00556                                                                      CL**2
00557      EXEC SQL                                                        CL**2
00558          DECLARE WORKER-RECS CURSOR                                  CL**2
00559          FOR SELECT                                                  CL**2
00560                     OPERCO_NBR                                       CL**2
00561                   , WORKER_NBR                                       CL**2
00562                   , UID_NBR                                          CL**2
00563                   , LAST_NAME                                        CL**2
00564                   , FIR_NAME                                         CL**2
00565          FROM                                                        CL**2
00566                   TWORKER                                            CL**2
00567          WHERE                                                       CL**2
00568                 ( ( LAST_NAME BETWEEN :MB137-BEGIN-LNAME             CL**2
00569                                   AND :MB137-END-LNAME   )           CL**2
00570                   AND    UID_NBR LIKE :MB137-USERID        )         CL**2
00571          ORDER BY                                                    CL**2
00572                   LAST_NAME                                          CL**2
00573                 , FIR_NAME                                           CL**2
00574                 , WORKER_NBR                                         CL**2
00575      END-EXEC.                                                       CL**2
00576                                                                      CL**2
00577  EJECT                                                               CL**2
00578                                                                      CL**2
00579 *****************************************************************    CL**2
00580                                                                      CL**2
00581  LINKAGE SECTION.                                                    CL**2
00582                                                                      CL**2
00583 *****************************************************************    CL**2
00584                                                                      CL**2
00585  01  DFHCOMMAREA.                                                    CL**2
00586      05  FILLER                         OCCURS  1 TO 4072 TIMES      CL**2
00587                                         DEPENDING ON EIBCALEN.       CL**2
00588          10  FILLER                     PIC X.                       CL**2
00589 *                                                                    CL**2
00590  EJECT                                                               CL**2
00591                                                                      CL**2
00592  PROCEDURE DIVISION.                                                 CL**2
00593                                                                      CL**2
00594                                                                      CL**2
00595  A100-MAIN-MODULE.                                                   CL**2
00596 ******************************************************************   CL**2
00597 *    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.              CL**2
00598 ******************************************************************   CL**2
00599 *                                                                    CL**2
00600      PERFORM DP015-0000-CHECK-COMMAREA.                              CL**2
00601                                                                      CL**2
00602      IF DP020-SRC-RETURN-W-TRAN-ID                                   CL**2
00603          PERFORM B100-CONTROL-PROCESSING                             CL**2
00604      END-IF.                                                         CL**2
00605                                                                      CL**2
00606      PERFORM DP003-0000-RETURN-TO-CICS.                              CL**2
00607                                                                      CL**2
00608  EJECT                                                               CL**2
00609                                                                      CL**2
00610  B100-CONTROL-PROCESSING.                                            CL**2
00611 ******************************************************************   CL**2
00612 *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       CL**2
00613 *    COURSE OF ACTION IS FOR THIS TRANSACTION.                       CL**2
00614 ******************************************************************   CL**2
00615 *                                                                    CL**2
00616      EVALUATE TRUE                                                   CL**2
00617                                                                      CL**2
00618          WHEN DP020-NEXT-ACT-INITIAL                                 CL**2
00619                                                                      CL**2
00620              PERFORM C100-VALIDATE-COMMAREA                          CL**2
00621                                                                      CL**2
00622              IF  PS-COMMAREA-VALID                                   CL**2
00623                  SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                CL**2
00624                                                                      CL**2
00625                  INITIALIZE MB137-SPECIFIC-COMMAREA                  CL**2
00626                                                                      CL**2
00627 *                **  SAVE THE INITIAL INTER APPL COMMAREA **         CL**2
00628                  MOVE MB007-INTER-APPL-COMMAREA                      CL**2
00629                    TO MB137-SAVE-INTER-APPL-COMMAREA                 CL**2
00630                                                                      CL**2
00631                  PERFORM D100-SETUP-INIT-PANEL                       CL**2
00632                                                                      CL**2
00633              ELSE                                                    CL**2
00634                  MOVE PC-TSYMSG-99901 TO DP020-MSG-NUMBER            CL**2
00635                  SET DP020-MSG-FATAL  TO TRUE                        CL**2
00636                  MOVE DP016-PF3       TO DP020-SRC-AID               CL**2
00637                  PERFORM DP015-1000-START-NAVIGATOR                  CL**2
00638              END-IF                                                  CL**2
00639 *                                                                    CL**2
00640          WHEN DP020-NEXT-ACT-READ-MAP                                CL**2
00641              SET PS-SEND-DATA-ONLY-FRSET TO TRUE                     CL**2
00642              SET PS-NO-RETURN-FROM-MAINT TO TRUE                     CL**2
00643              PERFORM C300-PROCESS-PANEL                              CL**2
00644 *                                                                    CL**2
00645          WHEN DP020-NEXT-ACT-RETURN                                  CL**2
00646 *        **-----------------------------------------------**         CL**2
00647 *        **  EITHER THE MAINTENANCE WORK IS COMPLETE,     **         CL**2
00648 *        **  OR THE USER HIT PF3 TO END A SESSION.        **         CL**2
00649 *        **-----------------------------------------------**         CL**2
00650                                                                      CL**2
00651              SET PS-SEND-MAP-N-DATA-FRSET  TO  TRUE                  CL**2
00652                                                                      CL**2
00653              IF DP020-INTER-APPL-ACKNLG-CODE = 'R138'                CL**2
00654                  SET PS-RETURNING-FROM-MAINT TO TRUE                 CL**2
00655              ELSE                                                    CL**2
00656                  SET PS-NO-RETURN-FROM-MAINT TO TRUE                 CL**2
00657                  MOVE MB137-SAVE-INTER-APPL-COMMAREA                 CL**2
00658                    TO MB007-INTER-APPL-COMMAREA                      CL**2
00659              END-IF                                                  CL**2
00660                                                                      CL**2
00661                                                                      CL**2
00662              PERFORM C500-REFRESH-PANEL-FROM-TEMP                    CL**2
00663 *                                                                    CL**2
00664          WHEN DP020-NEXT-ACT-ERROR                                   CL**2
00665 *        **-----------------------------------------------**         CL**2
00666 *        **  THIS CODE WILL PRESERVE THE ERROR MESSAGE    **         CL**2
00667 *        **  RETURNED FROM THE NAVIGATOR, IF ANY.         **         CL**2
00668 *        **-----------------------------------------------**         CL**2
00669                                                                      CL**2
00670              MOVE DP020-MSG-MESSAGE TO PV-MESSAGE                    CL**2
00671                                                                      CL**2
00672              IF DP020-NAV-MNEMONIC = SPACES                          CL**2
00673                  MOVE SPACES               TO  ANAVCMDO              CL**2
00674                  MOVE DP015-UNDERLINE      TO  ANAVCMDH              CL**2
00675                  MOVE DP015-GREEN          TO  ANAVCMDC              CL**2
00676                  MOVE SPACES               TO  ANAVKEYO              CL**2
00677                  MOVE DP015-UNDERLINE      TO  ANAVKEYH              CL**2
00678                  MOVE DP015-GREEN          TO  ANAVKEYC              CL**2
00679              ELSE                                                    CL**2
00680                  MOVE DP015-REVERSE        TO  ANAVCMDH              CL**2
00681                  MOVE DP015-RED            TO  ANAVCMDC              CL**2
00682              END-IF                                                  CL**2
00683                                                                      CL**2
00684              PERFORM E100-EDIT-SELECTIONS                            CL**2
00685              MOVE -1           TO  ANAVCMDL                          CL**2
00686                                                                      CL**2
00687              SET DP020-MSG-FATAL           TO  TRUE                  CL**2
00688              SET PS-SEND-DATA-ONLY-FRSET   TO  TRUE                  CL**2
00689                                                                      CL**2
00690              SET PS-SAME-ITEMS-DISPLAYED   TO  TRUE                  CL**2
00691              SET PS-CURSOR-POSITIONED      TO  TRUE                  CL**2
00692                                                                      CL**2
00693              PERFORM G100-DISPLAY-PANEL                              CL**2
00694 *                                                                    CL**2
00695          WHEN OTHER                                                  CL**2
00696              SET DP013-LOGIC-ABEND TO TRUE                           CL**2
00697              SET DP013-NO-ROLLBACK TO TRUE                           CL**2
00698                                                                      CL**2
00699              MOVE 'B100-CONTROL-PROCESSING'                          CL**2
00700                                TO  DP013-PARAGRAPH                   CL**2
00701              MOVE PM-PROGRAM-MESSAGE-12                              CL**2
00702                                TO  DP013-MESSAGE-TEXT(1)             CL**2
00703                                                                      CL**2
00704              PERFORM DP013-0000-PROCESS-ABEND                        CL**2
00705 *                                                                    CL**2
00706      END-EVALUATE.                                                   CL**2
00707 *                                                                    CL**2
00708  EJECT                                                               CL**2
00709                                                                      CL**2
00710  C100-VALIDATE-COMMAREA.                                             CL**2
00711 ******************************************************************   CL**2
00712 *    ENSURE THAT THIS PROGRAM WAS ACCESSED FROM A VALID SOURCE.      CL**2
00713 ******************************************************************   CL**2
00714 *                                                                    CL**2
00715      IF  DP020-MB-WORKER-SELECT                                      CL**2
00716          SET PS-COMMAREA-VALID TO  TRUE                              CL**2
00717      ELSE                                                            CL**2
00718          SET PS-COMMAREA-NOT-VALID                                   CL**2
00719                                TO  TRUE                              CL**2
00720      END-IF.                                                         CL**2
00721 *                                                                    CL**2
00722  EJECT                                                               CL**2
00723                                                                      CL**2
00724  C300-PROCESS-PANEL.                                                 CL**2
00725 ******************************************************************   CL**2
00726 *    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED     CL**2
00727 *    ON WHAT FUNCTION KEY WAS SELECTED.                              CL**2
00728 ******************************************************************   CL**2
00729 *                                                                    CL**2
00730      PERFORM DP007-0000-GET-PANEL.                                   CL**2
00731 *                                                                    CL**2
00732      EVALUATE TRUE                                                   CL**2
00733 *                                                                    CL**2
00734          WHEN DP020-SRC-AID = DP016-CLEAR                            CL**2
00735              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                    CL**2
00736              SET PS-SAME-ITEMS-DISPLAYED  TO TRUE                    CL**2
00737              PERFORM E100-EDIT-SELECTIONS                            CL**2
00738              PERFORM G100-DISPLAY-PANEL                              CL**2
00739 *                                                                    CL**2
00740          WHEN (DP020-SRC-AID = DP016-PF1) OR                         CL**2
00741               (DP020-SRC-AID = DP016-PF4) OR                         CL**2
00742               (DP020-SRC-AID = DP016-PF12)                           CL**2
00743                PERFORM E300-NAVIGATE                                 CL**2
00744 *                                                                    CL**2
00745          WHEN DP020-SRC-AID = DP016-PF5                              CL**2
00746              MOVE SPACES       TO  ANAVCMDO                          CL**2
00747                                    ANAVKEYO                          CL**2
00748              PERFORM Z050-DELETE-TEMP-STORAGE                        CL**2
00749              PERFORM D100-SETUP-INIT-PANEL                           CL**2
00750 *                                                                    CL**2
00751          WHEN DP020-SRC-AID = DP016-PA2                              CL**2
00752              PERFORM DP009-0000-LOAD-FK-LINES                        CL**2
00753              PERFORM DP017-0000-GET-CURR-DATE-TIME                   CL**2
00754                                                                      CL**2
00755              SET PS-SEND-DATA-ONLY  TO TRUE                          CL**2
00756              MOVE -1 TO ANAVCMDL                                     CL**2
00757              PERFORM DP008-0000-WRITE-PANEL                          CL**2
00758 *                                                                    CL**2
00759          WHEN OTHER                                                  CL**2
00760              PERFORM D200-RECORD-SELECTIONS                          CL**2
00761                                                                      CL**2
00762              IF PS-VALID-SELECTIONS                                  CL**2
00763                 IF (DP020-SRC-AID = DP016-PF15) OR                   CL**2
00764                    (DP020-SRC-AID = DP016-PF16)                      CL**2
00765                     IF MB007-NUMBER-OF-SELECTED-ITEMS > +0           CL**2
00766                         PERFORM D300-CHECK-FUNCTION-KEY              CL**2
00767                     ELSE                                             CL**2
00768 *                      ** AN ITEM MUST BE SELECTED FOR  **           CL**2
00769 *                      **  PF15(UPDT) OR PF16(DEL)      **           CL**2
00770                         MOVE PC-TSYMSG-00057                         CL**2
00771                                 TO  DP020-MSG-NUMBER                 CL**2
00772                         SET DP020-MSG-INFORMATIONAL TO TRUE          CL**2
00773                         SET PS-INFORMATIONAL        TO TRUE          CL**2
00774                         MOVE -1                     TO ANAVCMDL      CL**2
00775                         SET PS-CURSOR-POSITIONED    TO TRUE          CL**2
00776                         SET PS-SAME-ITEMS-DISPLAYED TO TRUE          CL**2
00777                         PERFORM G100-DISPLAY-PANEL                   CL**2
00778                     END-IF                                           CL**2
00779                 ELSE                                                 CL**2
00780                     PERFORM D300-CHECK-FUNCTION-KEY                  CL**2
00781                 END-IF                                               CL**2
00782 *                                                                    CL**2
00783              ELSE                                                    CL**2
00784                 IF DP020-MSG-NUMBER = ( 00005 OR 00051 OR            CL**2
00785                             00052 OR 00053 OR 00054 OR 00055)        CL**2
00786 *                  ** INVALID RANGE/CHARACTER DETERMINED **          CL**2
00787                     CONTINUE                                         CL**2
00788                 ELSE                                                 CL**2
00789                     MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER         CL**2
00790                 END-IF                                               CL**2
00791 *                                                                    CL**2
00792                  SET DP020-MSG-FATAL TO TRUE                         CL**2
00793                  SET PS-SAME-ITEMS-DISPLAYED TO TRUE                 CL**2
00794                  PERFORM G100-DISPLAY-PANEL                          CL**2
00795              END-IF                                                  CL**2
00796 *                                                                    CL**2
00797      END-EVALUATE.                                                   CL**2
00798 *                                                                    CL**2
00799  EJECT                                                               CL**2
00800                                                                      CL**2
00801  C500-REFRESH-PANEL-FROM-TEMP.                                       CL**2
00802 ******************************************************************   CL**2
00803 *    WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,    CL**2
00804 *    SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.          CL**2
00805 *    EDIT THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL     CL**2
00806 *    TO THE USER.                                                    CL**2
00807 ******************************************************************   CL**2
00808 *                                                                    CL**2
00809      PERFORM D400-REFRESH-BLOCK-ARRAY.                               CL**2
00810      PERFORM E100-EDIT-SELECTIONS.                                   CL**2
00811                                                                      CL**2
00812      SET PS-DIFFERENT-ITEMS-DISPLAYED TO TRUE.                       CL**2
00813                                                                      CL**2
00814      PERFORM G100-DISPLAY-PANEL.                                     CL**2
00815 *                                                                    CL**2
00816  EJECT                                                               CL**2
00817                                                                      CL**2
00818  D100-SETUP-INIT-PANEL.                                              CL**2
00819 ******************************************************************   CL**2
00820 *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                            CL**2
00821 *    INITIALIZE ALL COUNTERS AND FLAGS.                              CL**2
00822 *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.      CL**2
00823 *    DISPLAY THE PANEL TO USER.                                      CL**2
00824 ******************************************************************   CL**2
00825 *                                                                    CL**2
00826 *    **  RESTORE THE SAVED INTER APPL COMMAREA **                    CL**2
00827      MOVE MB137-SAVE-INTER-APPL-COMMAREA                             CL**2
00828                      TO MB007-INTER-APPL-COMMAREA.                   CL**2
00829 *                                                                    CL**2
00830      INITIALIZE                  MB137-BLOCK-ENTRIES (1).            CL**2
00831      INITIALIZE                  MB137-BLOCK-ENTRIES (2).            CL**2
00832 *                                                                    CL**2
00833      MOVE +1                 TO  MB137-BLK-SUB.                      CL**2
00834 *                                                                    CL**2
00835      MOVE PC-ITEMS-PER-PANEL TO  PV-HIGHEST-ITEM-TO-BE-READ.         CL**2
00836 *                                                                    CL**2
00837      MOVE +0                 TO  MB007-NUMBER-OF-SELECTED-ITEMS      CL**2
00838                                  MB137-ITEM-SUB                      CL**2
00839                                  MB137-NUMBER-OF-ITEMS-READ          CL**2
00840                                  MB137-HIGHEST-BLOCK-WRITTEN         CL**2
00841                                  MB137-START-OF-SELECTED-RANGE       CL**2
00842                                  MB137-END-OF-SELECTED-RANGE.        CL**2
00843 *                                                                    CL**2
00844      SET MB137-1ST-TIME-IN TO TRUE.                                  CL**2
00845      PERFORM L100-FORMAT-WORKER-RECORD.                              CL**2
00846      PERFORM L200-OPEN-WKR-CURSOR.                                   CL**2
00847 *                                                                    CL**2
00848      SET MB137-ITEMS-LEFT-ON-DB TO TRUE.                             CL**2
00849      PERFORM H100-READ-ITEMS-FROM-DB.                                CL**2
00850 *                                                                    CL**2
00851      SET MB137-NOT-1ST-TIME-IN TO TRUE.                              CL**2
00852 *                                                                    CL**2
00853      PERFORM L400-CLOSE-WKR-CURSOR.                                  CL**2
00854 *                                                                    CL**2
00855      MOVE +1 TO  MB137-ITEM-AT-TOP-OF-PANEL.                         CL**2
00856      SET PS-DIFFERENT-ITEMS-DISPLAYED  TO  TRUE.                     CL**2
00857 *                                                                    CL**2
00858      PERFORM G100-DISPLAY-PANEL.                                     CL**2
00859 *                                                                    CL**2
00860  EJECT                                                               CL**2
00861                                                                      CL**2
00862  D200-RECORD-SELECTIONS.                                             CL**2
00863 ******************************************************************   CL**2
00864 *    IF THE USER HIT THE DESELECT KEY, OR A KEY WHICH INVOLVES       CL**2
00865 *    LEAVING THIS TRANSACTION AND GOING TO ANOTHER, SET A FLAG       CL**2
00866 *    INDICATING THAT ALL SELECTIONS ARE VALID.  IF ANY OTHER KEY     CL**2
00867 *    IS HIT, MOVE THE SELECTIONS MADE TO THE COMMAREA, AND EDIT      CL**2
00868 *    THOSE SELECTIONS.                                               CL**2
00869 *                                                                    CL**2
00870 *    IF THE USER ENTERED SOMETHING IN THE COMMAND LINE OR HIT        CL**2
00871 *    AN INVALID FUNCTION KEY, DO NOT EDIT THE SELECTIONS.            CL**2
00872 ******************************************************************   CL**2
00873 *                                                                    CL**2
00874      SET PS-INVALID-SELECTIONS TO TRUE.                              CL**2
00875 *                                                                    CL**2
00876 *    (PF9, PF21, PF15 & PF16, PF3)                                   CL**2
00877      IF (DP020-FK-DESELECT(DP020-SRC-AID))   OR                      CL**2
00878         (DP020-FK-SELECT-ALL(DP020-SRC-AID)) OR                      CL**2
00879         (DP020-FK-RETURN(DP020-SRC-AID))                             CL**2
00880          SET PS-VALID-SELECTIONS TO TRUE                             CL**2
00881 *                                                                    CL**2
00882      ELSE                                                            CL**2
00883 *                                                                    CL**2
00884          PERFORM E200-MOVE-SELECTS-TO-COMMAREA                       CL**2
00885 *                                                                    CL**2
00886          IF (DP020-SRC-AID          = DP016-ENTER) AND               CL**2
00887             (DP020-NAV-MNEMONIC NOT = SPACES)      AND               CL**2
00888             (DP020-NAV-MNEMONIC NOT = LOW-VALUES)                    CL**2
00889              SET PS-VALID-SELECTIONS TO TRUE                         CL**2
00890          ELSE                                                        CL**2
00891 *                                                                    CL**2
00892 *            (PF6, PF7, PF8, ENTER)                                  CL**2
00893              IF (DP020-FK-FIRST-PAGE(DP020-SRC-AID)) OR              CL**2
00894                 (DP020-FK-PREV-PAGE(DP020-SRC-AID))  OR              CL**2
00895                 (DP020-FK-NEXT-PAGE(DP020-SRC-AID))  OR              CL**2
00896                 (DP020-FK-GO-TO-TRAN(DP020-SRC-AID)) OR              CL**2
00897                 (DP020-SRC-AID = DP016-ENTER)                        CL**2
00898                  PERFORM E100-EDIT-SELECTIONS                        CL**2
00899              ELSE                                                    CL**2
00900                  SET PS-INVALID-SELECTIONS TO TRUE                   CL**2
00901 *                                                                    CL**2
00902              END-IF                                                  CL**2
00903 *                                                                    CL**2
00904          END-IF                                                      CL**2
00905 *                                                                    CL**2
00906      END-IF.                                                         CL**2
00907 *                                                                    CL**2
00908  EJECT                                                               CL**2
00909                                                                      CL**2
00910  D300-CHECK-FUNCTION-KEY.                                            CL**2
00911 ******************************************************************   CL**2
00912 *    PERFORM THE APPROPRIATE PARAGRAPH BASED ON WHICH FUNCTION       CL**2
00913 *    KEY HAD BEEN SELECTED BY THE USER.                              CL**2
00914 ******************************************************************   CL**2
00915 *                                                                    CL**2
00916      EVALUATE TRUE                                                   CL**2
00917 *                                                                    CL**2
00918          WHEN (DP020-FK-GO-TO-TRAN(DP020-SRC-AID))                   CL**2
00919               PERFORM E300-NAVIGATE                                  CL**2
00920 *                                                                    CL**2
00921          WHEN DP020-FK-RETURN(DP020-SRC-AID)                         CL**2
00922               PERFORM Z050-DELETE-TEMP-STORAGE                       CL**2
00923               PERFORM E300-NAVIGATE                                  CL**2
00924 *                                                                    CL**2
00925          WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                     CL**2
00926               PERFORM E400-DISPLAY-TOP-OF-LIST                       CL**2
00927 *                                                                    CL**2
00928          WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                      CL**2
00929               PERFORM E500-BROWSE-BACKWARD                           CL**2
00930 *                                                                    CL**2
00931          WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                      CL**2
00932               PERFORM E600-BROWSE-FORWARD                            CL**2
00933 *                                                                    CL**2
00934          WHEN DP020-FK-DESELECT(DP020-SRC-AID)                       CL**2
00935               PERFORM E700-DESELECT-ALL-ITEMS                        CL**2
00936 *                                                                    CL**2
00937          WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                     CL**2
00938               PERFORM E900-SELECT-ALL-ITEMS                          CL**2
00939 *                                                                    CL**2
00940          WHEN DP020-SRC-AID = DP016-ENTER                            CL**2
00941              IF (DP020-NAV-MNEMONIC = LOW-VALUES) OR                 CL**2
00942                 (DP020-NAV-MNEMONIC = SPACES)                        CL**2
00943                  PERFORM E800-CHECK-FOR-JUMP-BROWSE                  CL**2
00944              ELSE                                                    CL**2
00945                  PERFORM E300-NAVIGATE                               CL**2
00946              END-IF                                                  CL**2
00947 *                                                                    CL**2
00948          WHEN OTHER                                                  CL**2
00949              MOVE PC-TSYMSG-00045                                    CL**2
00950                                TO  DP020-MSG-NUMBER                  CL**2
00951              SET DP020-MSG-FATAL                                     CL**2
00952                                TO  TRUE                              CL**2
00953              PERFORM G100-DISPLAY-PANEL                              CL**2
00954 *                                                                    CL**2
00955      END-EVALUATE.                                                   CL**2
00956 *                                                                    CL**2
00957  EJECT                                                               CL**2
00958                                                                      CL**2
00959  D400-REFRESH-BLOCK-ARRAY.                                           CL**2
00960 ******************************************************************   CL**2
00961 *    WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,    CL**2
00962 *    READ TEMPORARY STORAGE, FILLING IN BOTH BLOCKS IN THE ARRAY     CL**2
00963 *    WITH THE ITEMS THAT WERE AT THE TOP OF THE LIST WHEN WE         CL**2
00964 *    HAD LEFT PREVIOUSLY.                                            CL**2
00965 ******************************************************************   CL**2
00966 *                                                                    CL**2
00967      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**2
00968          1 + ((MB007Q-LIST-ITEM-NBR(1 1) - 1) /                      CL**2
00969                PC-ITEMS-PER-BLOCK).                                  CL**2
00970                                                                      CL**2
00971      MOVE PV-TEMP-BLOCK-NUMBER TO PV-BLOCK-NUMBER.                   CL**2
00972      MOVE +1                   TO MB137-BLK-SUB.                     CL**2
00973                                                                      CL**2
00974      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**2
00975                                                                      CL**2
00976      ADD +1 TO PV-BLOCK-NUMBER.                                      CL**2
00977                                                                      CL**2
00978      IF (PV-BLOCK-NUMBER < MB137-HIGHEST-BLOCK-WRITTEN) OR           CL**2
00979         (PV-BLOCK-NUMBER = MB137-HIGHEST-BLOCK-WRITTEN)              CL**2
00980          ADD +1 TO MB137-BLK-SUB                                     CL**2
00981                                                                      CL**2
00982          PERFORM Z100-READ-TEMP-STORAGE                              CL**2
00983                                                                      CL**2
00984      END-IF.                                                         CL**2
00985 *                                                                    CL**2
00986  EJECT                                                               CL**2
00987                                                                      CL**2
00988  E100-EDIT-SELECTIONS.                                               CL**2
00989 ******************************************************************   CL**2
00990 *    EDIT EACH SELECTION ENTRY.  IF EACH ENTRY IS CONSIDERED         CL**2
00991 *    VALID, CHECK IF A BEGINNING AND ENDING ENTRY WAS ENTERED,       CL**2
00992 *    AND CHECK THE FOLLOWING.                                        CL**2
00993 *                                                                    CL**2
00994 *    1) IF THERE IS A BEGINNING RANGE, THERE MUST BE AN ENDING.      CL**2
00995 *    2) IF THERE IS A ENDING RANGE, THERE MUST BE AN BEGINNING.      CL**2
00996 *    3) BEGINNING RANGE MUST PRECEDE ENDING RANGE.                   CL**2
00997 *                                                                    CL**2
00998 *    IF A VALID BEGINNING AND ENDING RANGE HAVE BEEN SELECTED,       CL**2
00999 *    MARK ALL ITEMS IN THAT RANGE AS BEING SELECTED.                 CL**2
01000 ******************************************************************   CL**2
01001 *                                                                    CL**2
01002      SET PS-VALID-SELECTIONS TO TRUE.                                CL**2
01003                                                                      CL**2
01004      COMPUTE PV-ENDING-ITEM-ON-PANEL =                               CL**2
01005          (MB137-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.      CL**2
01006                                                                      CL**2
01007      MOVE MB137-ITEM-AT-TOP-OF-PANEL TO PV-ITEM-IN-USE.              CL**2
01008      MOVE +1                         TO PS-SUB.                      CL**2
01009 *                                                                    CL**2
01010      PERFORM F100-EDIT                                               CL**2
01011          UNTIL (PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL)            CL**2
01012             OR (PV-ITEM-IN-USE > MB137-NUMBER-OF-ITEMS-READ).        CL**2
01013 *                                                                    CL**2
01014      IF  PS-VALID-SELECTIONS                                         CL**2
01015 *                                                                    CL**2
01016          IF  MB137-START-OF-SELECTED-RANGE > +0                      CL**2
01017 *                                                                    CL**2
01018              IF  MB137-END-OF-SELECTED-RANGE   >                     CL**2
01019                  MB137-START-OF-SELECTED-RANGE                       CL**2
01020                  PERFORM F200-MARK-RANGE-AS-SELECTED                 CL**2
01021              ELSE                                                    CL**2
01022 *                                                                    CL**2
01023                  IF  MB137-END-OF-SELECTED-RANGE = +0                CL**2
01024 *                   ** NO ENDING RANGE HAS BEEN FOUND **             CL**2
01025                      SET PS-CURSOR-POSITIONED  TO TRUE               CL**2
01026                      SET PS-WARNING            TO TRUE               CL**2
01027                      MOVE PC-TSYMSG-00051                            CL**2
01028                                     TO  DP020-MSG-NUMBER             CL**2
01029 *                                                                    CL**2
01030                      IF  NOT DP020-NEXT-ACT-ERROR                    CL**2
01031                          SET DP020-MSG-WARNING TO TRUE               CL**2
01032                      END-IF                                          CL**2
01033 *                                                                    CL**2
01034                  ELSE                                                CL**2
01035 *                   ** ENDING RANGE PRECEEDS STARTING RANGE **       CL**2
01036                      SET PS-CURSOR-POSITIONED  TO TRUE               CL**2
01037                      SET PS-INVALID-SELECTIONS TO TRUE               CL**2
01038                      SET DP020-MSG-FATAL       TO TRUE               CL**2
01039                      MOVE PC-TSYMSG-00052                            CL**2
01040                                     TO  DP020-MSG-NUMBER             CL**2
01041                                                                      CL**2
01042                      IF  NOT DP020-NEXT-ACT-ERROR                    CL**2
01043                          MOVE MB137-ITEM-AT-TOP-OF-PANEL             CL**2
01044                                TO  PV-ITEM-IN-USE                    CL**2
01045                          MOVE +1    TO  PS-SUB                       CL**2
01046 *                                                                    CL**2
01047                          PERFORM                                     CL**2
01048                              UNTIL (PV-ITEM-IN-USE >                 CL**2
01049                                     PV-ENDING-ITEM-ON-PANEL)         CL**2
01050                                 OR (PV-ITEM-IN-USE >                 CL**2
01051                                     MB137-NUMBER-OF-ITEMS-READ)      CL**2
01052 *                                                                    CL**2
01053                              PERFORM K100-SET-SUBSCRIPTS             CL**2
01054                              IF (MB007Q-BEGIN(MB137-BLK-SUB          CL**2
01055                                              MB137-ITEM-SUB))        CL**2
01056                              OR (MB007Q-END(MB137-BLK-SUB            CL**2
01057                                            MB137-ITEM-SUB))          CL**2
01058                                  MOVE -1                             CL**2
01059                                     TO  MBKM137-SELECTL(PS-SUB)      CL**2
01060                                  MOVE PV-ENDING-ITEM-ON-PANEL        CL**2
01061                                     TO  PV-ITEM-IN-USE               CL**2
01062                              END-IF                                  CL**2
01063                              ADD +1 TO  PS-SUB                       CL**2
01064                              ADD +1 TO  PV-ITEM-IN-USE               CL**2
01065                          END-PERFORM                                 CL**2
01066 *                                                                    CL**2
01067                      END-IF                                          CL**2
01068                  END-IF                                              CL**2
01069              END-IF                                                  CL**2
01070 *                                                                    CL**2
01071          ELSE                                                        CL**2
01072 *                                                                    CL**2
01073              IF MB137-END-OF-SELECTED-RANGE > +0                     CL**2
01074 *              ** NO STARTING RANGE HAS BEEN FOUND **                CL**2
01075                  SET PS-CURSOR-POSITIONED      TO TRUE               CL**2
01076                  SET PS-WARNING                TO TRUE               CL**2
01077                  MOVE PC-TSYMSG-00053                                CL**2
01078                                 TO  DP020-MSG-NUMBER                 CL**2
01079                  IF NOT DP020-NEXT-ACT-ERROR                         CL**2
01080                      SET DP020-MSG-WARNING TO TRUE                   CL**2
01081                  END-IF                                              CL**2
01082              END-IF                                                  CL**2
01083 *                                                                    CL**2
01084          END-IF                                                      CL**2
01085 *                                                                    CL**2
01086      END-IF.                                                         CL**2
01087 *                                                                    CL**2
01088  EJECT                                                               CL**2
01089                                                                      CL**2
01090  E200-MOVE-SELECTS-TO-COMMAREA.                                      CL**2
01091 ******************************************************************   CL**2
01092 *    MOVE THE SELECTIONS MADE FROM THE CURRENT PAGE INTO             CL**2
01093 *    THE COMMAREA.                                                   CL**2
01094 ******************************************************************   CL**2
01095 *                                                                    CL**2
01096      COMPUTE PV-ENDING-ITEM-ON-PANEL =                               CL**2
01097          (MB137-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.      CL**2
01098                                                                      CL**2
01099      MOVE +1                         TO PS-SUB.                      CL**2
01100      MOVE MB137-ITEM-AT-TOP-OF-PANEL TO PV-ITEM-IN-USE.              CL**2
01101                                                                      CL**2
01102      PERFORM F300-CHECK-SELECTIONS                                   CL**2
01103          UNTIL PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL.             CL**2
01104 *                                                                    CL**2
01105  EJECT                                                               CL**2
01106                                                                      CL**2
01107  E300-NAVIGATE.                                                      CL**2
01108 ******************************************************************   CL**2
01109 *    IF GOING TO ANOTHER TRANSACTION (MAINTENANCE), BUT ARE          CL**2
01110 *    PLANNING TO COME BACK, WRITE OUT THE LAST 2 BLOCKS FROM         CL**2
01111 *    THE ARRAY TO TEMPORARY STORAGE. IN EITHER EVENT, SET UP         CL**2
01112 *    THE INTER APPLICATION COMMAREA, AND START THE NAVIGATOR.        CL**2
01113 *                                                                    CL**2
01114 *    INDICATE THAT THIS IS THE SOURCE MODULE AND THAT THE            CL**2
01115 *    INTER APPL COMMAREA HAS BEEN SETUP FOR USE.                     CL**2
01116 *                                                                    CL**2
01117 *    THE TS QUEUE NAME IS STORED IN THE INTER APPL COMMAREA          CL**2
01118 *    TO ALLOW THE MAINTENANCE PROGRAM TO READ AND PROCESS            CL**2
01119 *    THE SELECTED ITEMS IN THE TS QUEUE.                             CL**2
01120 ******************************************************************   CL**2
01121 *                                                                    CL**2
01122      IF MB137-NUMBER-OF-ITEMS-READ > +0                              CL**2
01123          MOVE +1 TO MB137-BLK-SUB                                    CL**2
01124          PERFORM Z150-WRITE-TEMP-STORAGE                             CL**2
01125          ADD +1 TO MB137-BLK-SUB                                     CL**2
01126          PERFORM Z150-WRITE-TEMP-STORAGE                             CL**2
01127      END-IF.                                                         CL**2
01128 *                                                                    CL**2
01129      IF DP020-FK-GO-TO-TRAN (DP020-SRC-AID)                          CL**2
01130 *       ** RESET INTER APPL AREA BEFORE GOING TO MAINT **            CL**2
01131 *       **    (ALREADY CONTAINS THE LIST QUE NAME)     **            CL**2
01132                                                                      CL**2
01133          MOVE SPACES TO MB007-FIR-NAME                               CL**2
01134                         MB007-LAST-NAME                              CL**2
01135                         MB007-USERID                                 CL**2
01136                         MB007-INITIAL-USERID                         CL**2
01137          INITIALIZE     MB007-REQUEST-RESULTS                        CL**2
01138 *                                                                    CL**2
01139      ELSE                                                            CL**2
01140 *       ** IF THE NAVIGATION COMMAND LINE IS USED,     **            CL**2
01141 *       ** DO NOT RESTORE THE INTER APPL COMMAREA      **            CL**2
01142          IF (DP020-SRC-AID          = DP016-ENTER) AND               CL**2
01143             (DP020-NAV-MNEMONIC NOT = SPACES)      AND               CL**2
01144             (DP020-NAV-MNEMONIC NOT = LOW-VALUES)                    CL**2
01145                                                                      CL**2
01146              MOVE MB007-INTER-APPL-COMMAREA                          CL**2
01147                TO MB137-SAVE-INTER-APPL-COMMAREA                     CL**2
01148                                                                      CL**2
01149          ELSE                                                        CL**2
01150                                                                      CL**2
01151 *           ** RESTORE THE INTER APPL COMMAREA RECEIVED    **        CL**2
01152 *           ** FROM THE SELECTION CRITERIA MODULE          **        CL**2
01153              MOVE MB137-SAVE-INTER-APPL-COMMAREA                     CL**2
01154                      TO MB007-INTER-APPL-COMMAREA                    CL**2
01155                                                                      CL**2
01156              IF MB007-USERID-1ST = '*'                               CL**2
01157                  MOVE SPACES TO MB007-USERID                         CL**2
01158              END-IF                                                  CL**2
01159              IF MB007-LNAME-1ST = '*'                                CL**2
01160                  MOVE SPACES TO MB007-LAST-NAME                      CL**2
01161              END-IF                                                  CL**2
01162                                                                      CL**2
01163          END-IF                                                      CL**2
01164      END-IF.                                                         CL**2
01165 *                                                                    CL**2
01166      SET MB007-LIST TO TRUE.                                         CL**2
01167 *                                                                    CL**2
01168      SET DP020-MB-WORKER-LIST TO TRUE.                               CL**2
01169 *                                                                    CL**2
01170      MOVE DP020-INTER-APPL-FORMAT-CODE                               CL**2
01171        TO DP020-INTER-APPL-ACKNLG-CODE.                              CL**2
01172 *                                                                    CL**2
01173      PERFORM DP015-1000-START-NAVIGATOR.                             CL**2
01174 *                                                                    CL**2
01175  EJECT                                                               CL**2
01176                                                                      CL**2
01177  E400-DISPLAY-TOP-OF-LIST.                                           CL**2
01178 ******************************************************************   CL**2
01179 *    IF THE USER HITS THE 1ST PAGE KEY, COMPUTE THE TOP ITEM         CL**2
01180 *    NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM              CL**2
01181 *    IS CURRENTLY IN THE ARRAY, IN TEMPORARY STORAGE, OR             CL**2
01182 *    IF IT NEEDS TO BE READ.                                         CL**2
01183 ******************************************************************   CL**2
01184 *                                                                    CL**2
01185      IF  MB137-NUMBER-OF-ITEMS-READ > +0                             CL**2
01186          MOVE +1 TO PV-TOP-ITEM                                      CL**2
01187          PERFORM F500-BROWSE                                         CL**2
01188      ELSE                                                            CL**2
01189          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**2
01190          PERFORM G100-DISPLAY-PANEL                                  CL**2
01191      END-IF.                                                         CL**2
01192 *                                                                    CL**2
01193  EJECT                                                               CL**2
01194                                                                      CL**2
01195  E500-BROWSE-BACKWARD.                                               CL**2
01196 ******************************************************************   CL**2
01197 *    IF THE USER HITS THE PAGE BACKARD KEY, COMPUTE THE TOP          CL**2
01198 *    ITEM NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM         CL**2
01199 *    IS CURRENTLY IN THE ARRAY, IN TEMPORARY STORAGE, OR             CL**2
01200 *    IF IT NEEDS TO BE READ.                                         CL**2
01201 ******************************************************************   CL**2
01202 *                                                                    CL**2
01203      IF  MB137-NUMBER-OF-ITEMS-READ > +0                             CL**2
01204          COMPUTE PV-TOP-ITEM =                                       CL**2
01205              MB137-ITEM-AT-TOP-OF-PANEL - PC-ITEMS-PER-PANEL         CL**2
01206          PERFORM F500-BROWSE                                         CL**2
01207      ELSE                                                            CL**2
01208          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**2
01209          PERFORM G100-DISPLAY-PANEL                                  CL**2
01210      END-IF.                                                         CL**2
01211 *                                                                    CL**2
01212  EJECT                                                               CL**2
01213                                                                      CL**2
01214  E600-BROWSE-FORWARD.                                                CL**2
01215 ******************************************************************   CL**2
01216 *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP          CL**2
01217 *    ITEM NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM         CL**2
01218 *    IS CURRENTLY IN THE ARRAY, IN TEMPORARY STORAGE, OR             CL**2
01219 *    IF IT NEEDS TO BE READ.                                         CL**2
01220 ******************************************************************   CL**2
01221 *                                                                    CL**2
01222      IF  MB137-NUMBER-OF-ITEMS-READ > +0                             CL**2
01223          COMPUTE PV-TOP-ITEM =                                       CL**2
01224              MB137-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL         CL**2
01225          PERFORM F500-BROWSE                                         CL**2
01226      ELSE                                                            CL**2
01227          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**2
01228          PERFORM G100-DISPLAY-PANEL                                  CL**2
01229      END-IF.                                                         CL**2
01230 *                                                                    CL**2
01231  EJECT                                                               CL**2
01232                                                                      CL**2
01233  E700-DESELECT-ALL-ITEMS.                                            CL**2
01234 ******************************************************************   CL**2
01235 *    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION          CL**2
01236 *    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.             CL**2
01237 ******************************************************************   CL**2
01238 *                                                                    CL**2
01239      IF  MB137-NUMBER-OF-ITEMS-READ > +0                             CL**2
01240          MOVE +1               TO  MB137-BLK-SUB                     CL**2
01241                                                                      CL**2
01242          PERFORM F600-CLEAR-SELECTED-INDS                            CL**2
01243              VARYING MB137-ITEM-SUB FROM 1 BY 1                      CL**2
01244              UNTIL MB137-ITEM-SUB > PC-ITEMS-PER-BLOCK               CL**2
01245                                                                      CL**2
01246          ADD +1                TO  MB137-BLK-SUB                     CL**2
01247                                                                      CL**2
01248          PERFORM F600-CLEAR-SELECTED-INDS                            CL**2
01249              VARYING MB137-ITEM-SUB FROM 1 BY 1                      CL**2
01250              UNTIL MB137-ITEM-SUB > PC-ITEMS-PER-BLOCK               CL**2
01251                                                                      CL**2
01252          MOVE MB007Q-LIST-ITEM-NBR(1 1) TO PV-LIST-ITEM-NUMBER       CL**2
01253                                                                      CL**2
01254 *        **-----------------------------------------------**         CL**2
01255 *        **  DETERMINE THE BLOCK NUMBER OF THE 1ST BLOCK  **         CL**2
01256 *        **  CURRENTLY IN WORKING STORAGE.                **         CL**2
01257 *        **                                               **         CL**2
01258 *        **     IF THIS IS NOT THE FIRST BLOCK ( = 1 ),   **         CL**2
01259 *        **     THEN THERE ARE PREVIOUS BLOCKS OF RECORDS **         CL**2
01260 *        **     IN TS WHICH NEED TO BE RETRIEVED.         **         CL**2
01261 *        **                                               **         CL**2
01262 *        **     IF THIS IS THE FIRST BLOCK, BUT THE       **         CL**2
01263 *        **     HIGHEST BLOCK NUMBER WRITTEN TO TS IS > 2 **         CL**2
01264 *        **     THEN THERE ARE ADDITIONAL BLOCKS OF RECS  **         CL**2
01265 *        **     IN TS WHICH NEED TO BE RETRIEVED.         **         CL**2
01266 *        **-----------------------------------------------**         CL**2
01267                                                                      CL**2
01268          COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                           CL**2
01269              1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK)    CL**2
01270                                                                      CL**2
01271          IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                    CL**2
01272             (MB137-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)   CL**2
01273              MOVE +1 TO MB137-BLK-SUB                                CL**2
01274                                                                      CL**2
01275              PERFORM Z150-WRITE-TEMP-STORAGE                         CL**2
01276                                                                      CL**2
01277              MOVE +1 TO PV-BLOCK-NUMBER                              CL**2
01278                                                                      CL**2
01279              COMPUTE PV-PREV-BLOCK-IN-ARRAY =                        CL**2
01280                  PV-FIRST-BLOCK-IN-ARRAY - 1                         CL**2
01281                                                                      CL**2
01282              PERFORM                                                 CL**2
01283                  UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY      CL**2
01284                                                                      CL**2
01285                  PERFORM Z100-READ-TEMP-STORAGE                      CL**2
01286                                                                      CL**2
01287                  PERFORM F600-CLEAR-SELECTED-INDS                    CL**2
01288                      VARYING MB137-ITEM-SUB FROM 1 BY 1              CL**2
01289                      UNTIL MB137-ITEM-SUB > PC-ITEMS-PER-BLOCK       CL**2
01290                                                                      CL**2
01291                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**2
01292                                                                      CL**2
01293                  ADD +1 TO PV-BLOCK-NUMBER                           CL**2
01294                                                                      CL**2
01295              END-PERFORM                                             CL**2
01296                                                                      CL**2
01297              COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                        CL**2
01298                  PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY    CL**2
01299                                                                      CL**2
01300              PERFORM                                                 CL**2
01301                  UNTIL PV-NEXT-BLOCK-IN-ARRAY >                      CL**2
01302                        MB137-HIGHEST-BLOCK-WRITTEN                   CL**2
01303                                                                      CL**2
01304                  MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER      CL**2
01305                                                                      CL**2
01306                  PERFORM Z100-READ-TEMP-STORAGE                      CL**2
01307                                                                      CL**2
01308                  PERFORM F600-CLEAR-SELECTED-INDS                    CL**2
01309                      VARYING MB137-ITEM-SUB FROM 1 BY 1              CL**2
01310                      UNTIL MB137-ITEM-SUB > PC-ITEMS-PER-BLOCK       CL**2
01311                                                                      CL**2
01312                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**2
01313                                                                      CL**2
01314                  ADD +1 TO PV-NEXT-BLOCK-IN-ARRAY                    CL**2
01315                                                                      CL**2
01316              END-PERFORM                                             CL**2
01317                                                                      CL**2
01318              MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER         CL**2
01319                                                                      CL**2
01320              PERFORM Z100-READ-TEMP-STORAGE                          CL**2
01321          END-IF                                                      CL**2
01322                                                                      CL**2
01323      END-IF.                                                         CL**2
01324                                                                      CL**2
01325      MOVE +0 TO MB007-NUMBER-OF-SELECTED-ITEMS.                      CL**2
01326      MOVE +0 TO MB137-START-OF-SELECTED-RANGE.                       CL**2
01327      MOVE +0 TO MB137-END-OF-SELECTED-RANGE.                         CL**2
01328                                                                      CL**2
01329      SET PS-DIFFERENT-ITEMS-DISPLAYED TO TRUE.                       CL**2
01330                                                                      CL**2
01331      PERFORM G100-DISPLAY-PANEL.                                     CL**2
01332 *                                                                    CL**2
01333  EJECT                                                               CL**2
01334                                                                      CL**2
01335  E800-CHECK-FOR-JUMP-BROWSE.                                         CL**2
01336 ******************************************************************   CL**2
01337 *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO        CL**2
01338 *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.       CL**2
01339 *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST      CL**2
01340 *    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.          CL**2
01341 *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT         CL**2
01342 *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.              CL**2
01343 ******************************************************************   CL**2
01344 *                                                                    CL**2
01345      SET PS-VALID-BEG-ITEM TO TRUE.                                  CL**2
01346                                                                      CL**2
01347      IF (ABEGITMA                   = PC-ERASE-EOF) OR               CL**2
01348         (MB137-NUMBER-OF-ITEMS-READ = +0)                            CL**2
01349          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**2
01350          PERFORM G100-DISPLAY-PANEL                                  CL**2
01351      ELSE                                                            CL**2
01352                                                                      CL**2
01353          MOVE ABEGITMI         TO  DP010I-UNEDITED-FIELD             CL**2
01354          MOVE PC-FIELD-LENGTH  TO  DP010I-MAXIMUM-DIGITS             CL**2
01355          MOVE +0               TO  DP010I-MAXIMUM-DECIMALS           CL**2
01356                                                                      CL**2
01357          SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                     CL**2
01358                                                                      CL**2
262978         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
262978              USING DP010I-NUMERIC-EDIT-AREA                              
01360 *                                                                    CL**2
01361 *        **-----------------------------------------------**         CL**2
01362 *        ** ENSURE THAT THE BEGITM DOES NOT REQUIRE       **         CL**2
01363 *        ** EXCESSIVE DATABASE READS. CALCULATE THE MAX.  **         CL**2
01364 *        ** ITEM NBR FOR THE TOP OF THE LIST, WITHOUT     **         CL**2
01365 *        ** EXCEEDING THE MAX. NBR OF READS SET. IF THE   **         CL**2
01366 *        ** DESIRED BEGITM IS GREATER THAN THE MAX. TOP   **         CL**2
01367 *        ** OF LIST ITEM NBR, DISPLAY MESSAGE AND START   **         CL**2
01368 *        ** THE LIST USING THE MAXIMUM ITEM NUMBER.       **         CL**2
01369 *        **-----------------------------------------------**         CL**2
01370 *                                                                    CL**2
01371          IF  NOT DP010I-ERROR-DETECTED                               CL**2
01372              MOVE DP010I-NUMERIC-FIELD  TO  PV-BEGITMI-N             CL**2
01373              MOVE PV-BEGITMI-N          TO  PV-BEGINNING-ITEM        CL**2
01374 *                                                                    CL**2
01375              IF (PV-BEGINNING-ITEM >  0)          AND                CL**2
01376                 (PV-BEGINNING-ITEM <  PC-MAX-ITEMS)                  CL**2
01377                  MOVE PV-BEGINNING-ITEM TO PV-TOP-ITEM               CL**2
01378                                                                      CL**2
01379                  COMPUTE PV-MAX-ITEMS-TO-BE-READ =                   CL**2
01380                      ((MB137-NUMBER-OF-ITEMS-READ +                  CL**2
01381                        PC-MAX-ITEMS-TO-BE-READ)   -                  CL**2
01382                        PC-ITEMS-PER-PANEL)        + 1                CL**2
01383 *                                                                    CL**2
01384                  IF PV-TOP-ITEM > PV-MAX-ITEMS-TO-BE-READ            CL**2
01385                      MOVE PV-MAX-ITEMS-TO-BE-READ                    CL**2
01386                                TO  PV-TOP-ITEM                       CL**2
01387 *                   ** SET CURSOR POSITION ? **                      CL**2
01388                      MOVE -1   TO  ABEGITML                          CL**2
01389                                                                      CL**2
01390                      IF MB137-NO-ITEMS-LEFT-ON-DB                    CL**2
01391 *                      ** MSG REQUESTED ITEM NOT ON LIST **          CL**2
01392                          MOVE PC-TSYMSG-00070                        CL**2
01393                                TO  DP020-MSG-NUMBER                  CL**2
01394                      ELSE                                            CL**2
01395 *                      ** MSG REQUESTED ITEM > MAXIMUM **            CL**2
01396                          MOVE PC-TSYMSG-00207                        CL**2
01397                                TO  DP020-MSG-NUMBER                  CL**2
01398                      END-IF                                          CL**2
01399                                                                      CL**2
01400                      SET PS-CURSOR-POSITIONED    TO TRUE             CL**2
01401                      SET DP020-MSG-INFORMATIONAL TO TRUE             CL**2
01402 *                                                                    CL**2
01403                  END-IF                                              CL**2
01404 *                                                                    CL**2
01405                  PERFORM F500-BROWSE                                 CL**2
01406 *                                                                    CL**2
01407              ELSE                                                    CL**2
01408                  SET PS-INVALID-BEG-ITEM    TO  TRUE                 CL**2
01409                  MOVE DP015-REVERSE         TO  ABEGITMH             CL**2
01410                  MOVE DP015-RED             TO  ABEGITMC             CL**2
01411                  MOVE DP015-UNP-NUM-BRT-MDT TO  ABEGITMA             CL**2
01412                  MOVE -1                    TO  ABEGITML             CL**2
01413                  SET PS-CURSOR-POSITIONED   TO  TRUE                 CL**2
01414 *               ** BEGITM VALUE MUST BE > 0, AND < 1,000,000 **      CL**2
01415                  MOVE PC-TSYMSG-00101       TO  DP020-MSG-NUMBER     CL**2
01416                  SET DP020-MSG-FATAL        TO  TRUE                 CL**2
01417              END-IF                                                  CL**2
01418 *                                                                    CL**2
01419          ELSE                                                        CL**2
01420              SET PS-INVALID-BEG-ITEM        TO  TRUE                 CL**2
01421              MOVE DP015-REVERSE             TO  ABEGITMH             CL**2
01422              MOVE DP015-RED                 TO  ABEGITMC             CL**2
01423              MOVE DP015-UNP-NUM-BRT-MDT     TO  ABEGITMA             CL**2
01424              MOVE -1                        TO  ABEGITML             CL**2
01425              SET PS-CURSOR-POSITIONED       TO  TRUE                 CL**2
01426 *           ** BEGITM VALUE MUST BE NUMERIC **                       CL**2
01427              MOVE PC-TSYMSG-00008           TO  DP020-MSG-NUMBER     CL**2
01428              SET DP020-MSG-FATAL            TO  TRUE                 CL**2
01429          END-IF                                                      CL**2
01430 *                                                                    CL**2
01431      END-IF.                                                         CL**2
01432 *                                                                    CL**2
01433      IF  PS-INVALID-BEG-ITEM                                         CL**2
01434          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**2
01435          PERFORM DP017-0000-GET-CURR-DATE-TIME                       CL**2
01436          PERFORM I200-FORMAT-LIST-LINES                              CL**2
01437          PERFORM I300-FORMAT-NR-SELECTED                             CL**2
01438          PERFORM DP005-0000-FORMAT-MSG-LINES                         CL**2
01439          PERFORM DP008-0000-WRITE-PANEL                              CL**2
01440      END-IF.                                                         CL**2
01441 *                                                                    CL**2
01442  EJECT                                                               CL**2
01443                                                                      CL**2
01444  E900-SELECT-ALL-ITEMS.                                              CL**2
01445 ******************************************************************   CL**2
01446 *    IF THE USER HITS THE SELECT KEY, SET THE SELECTION SWITCH       CL**2
01447 *    FOR ALL ITEMS.                                                  CL**2
01448 ******************************************************************   CL**2
01449 *                                                                    CL**2
01450      IF  MB137-NUMBER-OF-ITEMS-READ > +0                             CL**2
01451          MOVE +1 TO MB137-BLK-SUB                                    CL**2
01452                                                                      CL**2
01453          PERFORM F700-SET-SELECTED-INDS                              CL**2
01454              VARYING MB137-ITEM-SUB FROM 1 BY 1                      CL**2
01455              UNTIL MB137-ITEM-SUB > PC-ITEMS-PER-BLOCK               CL**2
01456                                                                      CL**2
01457          ADD +1 TO MB137-BLK-SUB                                     CL**2
01458                                                                      CL**2
01459          PERFORM F700-SET-SELECTED-INDS                              CL**2
01460              VARYING MB137-ITEM-SUB FROM 1 BY 1                      CL**2
01461              UNTIL MB137-ITEM-SUB > PC-ITEMS-PER-BLOCK               CL**2
01462                                                                      CL**2
01463          MOVE MB007Q-LIST-ITEM-NBR(1 1) TO PV-LIST-ITEM-NUMBER       CL**2
01464                                                                      CL**2
01465 *        **-----------------------------------------------**         CL**2
01466 *        **  DETERMINE THE BLOCK NUMBER OF THE 1ST BLOCK  **         CL**2
01467 *        **  CURRENTLY IN WORKING STORAGE.                **         CL**2
01468 *        **                                               **         CL**2
01469 *        **     IF THIS IS NOT THE FIRST BLOCK ( = 1 ),   **         CL**2
01470 *        **     THEN THERE ARE PREVIOUS BLOCKS OF RECORDS **         CL**2
01471 *        **     IN TS WHICH NEED TO BE RETRIEVED.         **         CL**2
01472 *        **                                               **         CL**2
01473 *        **     IF THIS IS THE FIRST BLOCK, BUT THE       **         CL**2
01474 *        **     HIGHEST BLOCK NUMBER WRITTEN TO TS IS > 2 **         CL**2
01475 *        **     THEN THERE ARE ADDITIONAL BLOCKS OF RECS  **         CL**2
01476 *        **     IN TS WHICH NEED TO BE RETRIEVED.         **         CL**2
01477 *        **-----------------------------------------------**         CL**2
01478                                                                      CL**2
01479          COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                           CL**2
01480              1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK)    CL**2
01481                                                                      CL**2
01482          IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                    CL**2
01483             (MB137-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)   CL**2
01484              MOVE +1 TO MB137-BLK-SUB                                CL**2
01485                                                                      CL**2
01486              PERFORM Z150-WRITE-TEMP-STORAGE                         CL**2
01487                                                                      CL**2
01488              MOVE +1 TO PV-BLOCK-NUMBER                              CL**2
01489                                                                      CL**2
01490              COMPUTE PV-PREV-BLOCK-IN-ARRAY =                        CL**2
01491                  PV-FIRST-BLOCK-IN-ARRAY - 1                         CL**2
01492                                                                      CL**2
01493              PERFORM                                                 CL**2
01494                  UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY      CL**2
01495                                                                      CL**2
01496                  PERFORM Z100-READ-TEMP-STORAGE                      CL**2
01497                                                                      CL**2
01498                  PERFORM F700-SET-SELECTED-INDS                      CL**2
01499                      VARYING MB137-ITEM-SUB FROM 1 BY 1              CL**2
01500                      UNTIL MB137-ITEM-SUB > PC-ITEMS-PER-BLOCK       CL**2
01501                                                                      CL**2
01502                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**2
01503                                                                      CL**2
01504                  ADD +1 TO PV-BLOCK-NUMBER                           CL**2
01505                                                                      CL**2
01506              END-PERFORM                                             CL**2
01507                                                                      CL**2
01508              COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                        CL**2
01509                  PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY    CL**2
01510                                                                      CL**2
01511              PERFORM                                                 CL**2
01512                  UNTIL PV-NEXT-BLOCK-IN-ARRAY >                      CL**2
01513                        MB137-HIGHEST-BLOCK-WRITTEN                   CL**2
01514                                                                      CL**2
01515                  MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER      CL**2
01516                                                                      CL**2
01517                  PERFORM Z100-READ-TEMP-STORAGE                      CL**2
01518                                                                      CL**2
01519                  PERFORM F700-SET-SELECTED-INDS                      CL**2
01520                      VARYING MB137-ITEM-SUB FROM 1 BY 1              CL**2
01521                      UNTIL MB137-ITEM-SUB > PC-ITEMS-PER-BLOCK       CL**2
01522                                                                      CL**2
01523                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**2
01524                                                                      CL**2
01525                  ADD +1 TO PV-NEXT-BLOCK-IN-ARRAY                    CL**2
01526                                                                      CL**2
01527              END-PERFORM                                             CL**2
01528                                                                      CL**2
01529              MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER         CL**2
01530                                                                      CL**2
01531              PERFORM Z100-READ-TEMP-STORAGE                          CL**2
01532          END-IF                                                      CL**2
01533                                                                      CL**2
01534      END-IF.                                                         CL**2
01535                                                                      CL**2
01536      MOVE MB137-NUMBER-OF-ITEMS-READ TO                              CL**2
01537                        MB007-NUMBER-OF-SELECTED-ITEMS.               CL**2
01538                                                                      CL**2
01539      SET PS-DIFFERENT-ITEMS-DISPLAYED TO TRUE.                       CL**2
01540 *                                                                    CL**2
01541      PERFORM G100-DISPLAY-PANEL.                                     CL**2
01542 *                                                                    CL**2
01543  EJECT                                                               CL**2
01544                                                                      CL**2
01545  F100-EDIT.                                                          CL**2
01546 ******************************************************************   CL**2
01547 *    EDIT THE SELECTION ENTRIES.                                     CL**2
01548 *                                                                    CL**2
01549 *    1) VALID ENTRIES ARE 'S' 'B' OR 'E'.                            CL**2
01550 *    2) THERE CAN ONLY BE 1 BEGINNING AND 1 ENDING RANGE.            CL**2
01551 ******************************************************************   CL**2
01552 *                                                                    CL**2
01553      PERFORM K100-SET-SUBSCRIPTS.                                    CL**2
01554                                                                      CL**2
01555      IF MB007Q-SELECTED-SW                                           CL**2
01556               (MB137-BLK-SUB MB137-ITEM-SUB) = 'D'                   CL**2
01557          MOVE 'DEL' TO MB007Q-REC-ACTION                             CL**2
01558                              (MB137-BLK-SUB MB137-ITEM-SUB)          CL**2
01559      END-IF.                                                         CL**2
01560                                                                      CL**2
01561      IF MB007Q-SELECTED-SW                                           CL**2
01562               (MB137-BLK-SUB MB137-ITEM-SUB) = 'I'                   CL**2
01563          MOVE 'INQ' TO MB007Q-REC-ACTION                             CL**2
01564                              (MB137-BLK-SUB MB137-ITEM-SUB)          CL**2
01565      END-IF.                                                         CL**2
01566                                                                      CL**2
01567      IF MB007Q-SELECTED-SW                                           CL**2
01568               (MB137-BLK-SUB MB137-ITEM-SUB) = 'U'                   CL**2
01569          MOVE 'UPD' TO MB007Q-REC-ACTION                             CL**2
01570                              (MB137-BLK-SUB MB137-ITEM-SUB)          CL**2
01571      END-IF.                                                         CL**2
01572                                                                      CL**2
01573      IF MB007Q-MAINTAINED (MB137-BLK-SUB MB137-ITEM-SUB)             CL**2
01574          MOVE SPACE TO MB007Q-SELECTED-SW                            CL**2
01575                            (MB137-BLK-SUB MB137-ITEM-SUB)            CL**2
01576          SET MB007Q-BLOCK-MODIFIED(MB137-BLK-SUB) TO TRUE            CL**2
01577          SUBTRACT +1 FROM MB007-NUMBER-OF-SELECTED-ITEMS             CL**2
01578      END-IF.                                                         CL**2
01579 *                                                                    CL**2
01580      IF NOT (MB007Q-NO-SELECT(MB137-BLK-SUB MB137-ITEM-SUB)) AND     CL**2
01581         NOT (MB007Q-SELECT(MB137-BLK-SUB MB137-ITEM-SUB))            CL**2
01582 *                                                                    CL**2
01583          IF  MB007Q-BEGIN(MB137-BLK-SUB MB137-ITEM-SUB)              CL**2
01584              IF  MB137-START-OF-SELECTED-RANGE                       CL**2
01585                  NOT EQUAL PV-ITEM-IN-USE                            CL**2
01586 *                                                                    CL**2
01587                  IF  MB137-START-OF-SELECTED-RANGE = +0              CL**2
01588                      MOVE PV-ITEM-IN-USE                             CL**2
01589                                TO  MB137-START-OF-SELECTED-RANGE     CL**2
01590                  ELSE                                                CL**2
01591                      IF PS-VALID-SELECTIONS                          CL**2
01592 *                      ** MULTI START OF RANGE INDICATORS **         CL**2
01593                          MOVE PC-TSYMSG-00054                        CL**2
01594                                TO  DP020-MSG-NUMBER                  CL**2
01595                          IF  NOT DP020-NEXT-ACT-ERROR                CL**2
01596                              MOVE -1 TO  MBKM137-SELECTL(PS-SUB)     CL**2
01597                          END-IF                                      CL**2
01598                      END-IF                                          CL**2
01599 *                                                                    CL**2
01600                      SET DP020-MSG-FATAL        TO  TRUE             CL**2
01601                      SET PS-INVALID-SELECTIONS  TO  TRUE             CL**2
01602                      SET PS-CURSOR-POSITIONED   TO  TRUE             CL**2
01603                  END-IF                                              CL**2
01604              END-IF                                                  CL**2
01605          ELSE                                                        CL**2
01606 *                                                                    CL**2
01607              IF  MB007Q-END(MB137-BLK-SUB MB137-ITEM-SUB)            CL**2
01608                  IF  MB137-END-OF-SELECTED-RANGE                     CL**2
01609                      NOT EQUAL PV-ITEM-IN-USE                        CL**2
01610 *                                                                    CL**2
01611                      IF MB137-END-OF-SELECTED-RANGE = +0             CL**2
01612                          MOVE PV-ITEM-IN-USE                         CL**2
01613                                TO  MB137-END-OF-SELECTED-RANGE       CL**2
01614                      ELSE                                            CL**2
01615 *                                                                    CL**2
01616                          IF  PS-VALID-SELECTIONS                     CL**2
01617 *                      ** MULTI END OF RANGE INDICATORS **           CL**2
01618                              MOVE PC-TSYMSG-00055                    CL**2
01619                                     TO  DP020-MSG-NUMBER             CL**2
01620                                                                      CL**2
01621                              IF  NOT DP020-NEXT-ACT-ERROR            CL**2
01622                                  MOVE -1                             CL**2
01623                                     TO  MBKM137-SELECTL(PS-SUB)      CL**2
01624                              END-IF                                  CL**2
01625                          END-IF                                      CL**2
01626                          SET PS-INVALID-SELECTIONS TO  TRUE          CL**2
01627                          SET PS-CURSOR-POSITIONED  TO  TRUE          CL**2
01628                          SET DP020-MSG-FATAL       TO  TRUE          CL**2
01629                      END-IF                                          CL**2
01630                  END-IF                                              CL**2
01631              ELSE                                                    CL**2
01632 *                                                                    CL**2
01633                  IF  PS-VALID-SELECTIONS                             CL**2
01634 *                  ** INVALID SELECTION CHARACTER **                 CL**2
01635                      MOVE PC-TSYMSG-00005                            CL**2
01636                                TO  DP020-MSG-NUMBER                  CL**2
01637                      IF  NOT DP020-NEXT-ACT-ERROR                    CL**2
01638                          MOVE -1                                     CL**2
01639                                TO  MBKM137-SELECTL(PS-SUB)           CL**2
01640                      END-IF                                          CL**2
01641                  END-IF                                              CL**2
01642                  SET PS-INVALID-SELECTIONS  TO  TRUE                 CL**2
01643                  SET PS-CURSOR-POSITIONED   TO  TRUE                 CL**2
01644                  SET DP020-MSG-FATAL        TO  TRUE                 CL**2
01645                                                                      CL**2
01646                  MOVE DP015-RED     TO  MBKM137-SELECTC(PS-SUB)      CL**2
01647                  MOVE DP015-REVERSE TO  MBKM137-SELECTH(PS-SUB)      CL**2
01648              END-IF                                                  CL**2
01649          END-IF                                                      CL**2
01650      END-IF.                                                         CL**2
01651                                                                      CL**2
01652      ADD +1                    TO  PV-ITEM-IN-USE.                   CL**2
01653      ADD +1                    TO  PS-SUB.                           CL**2
01654 *                                                                    CL**2
01655  EJECT                                                               CL**2
01656                                                                      CL**2
01657  F200-MARK-RANGE-AS-SELECTED.                                        CL**2
01658 ******************************************************************   CL**2
01659 *    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE        CL**2
01660 *    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS        CL**2
01661 *    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.                 CL**2
01662 ******************************************************************   CL**2
01663 *                                                                    CL**2
01664      MOVE +1                   TO  MB137-BLK-SUB.                    CL**2
01665      PERFORM G200-MARK-SELECTED-INDS                                 CL**2
01666          VARYING MB137-ITEM-SUB FROM 1 BY 1                          CL**2
01667          UNTIL MB137-ITEM-SUB > PC-ITEMS-PER-BLOCK.                  CL**2
01668 *                                                                    CL**2
01669      ADD +1 TO MB137-BLK-SUB.                                        CL**2
01670      PERFORM G200-MARK-SELECTED-INDS                                 CL**2
01671          VARYING MB137-ITEM-SUB FROM 1 BY 1                          CL**2
01672          UNTIL MB137-ITEM-SUB > PC-ITEMS-PER-BLOCK.                  CL**2
01673 *                                                                    CL**2
01674 *    **-----------------------------------------------**             CL**2
01675 *    **  AFTER MARKING THE WORKING STORAGE ENTRIES,   **             CL**2
01676 *    **  ENTRIES IN TEMP STORAGE NEEDED TO BE MARKED  **             CL**2
01677 *    **  IF THEY HAVE BEEN WRITTEN OUT ALREADY.       **             CL**2
01678 *    **-----------------------------------------------**             CL**2
01679 *                                                                    CL**2
01680      MOVE MB007Q-LIST-ITEM-NBR(1 1)                                  CL**2
01681                                TO  PV-LIST-ITEM-NUMBER.              CL**2
01682      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                               CL**2
01683          1 + ((PV-LIST-ITEM-NUMBER - 1) /                            CL**2
01684                PC-ITEMS-PER-BLOCK).                                  CL**2
01685 *                                                                    CL**2
01686      MOVE MB137-START-OF-SELECTED-RANGE                              CL**2
01687                                TO  PV-START-OF-SELECTED-RANGE.       CL**2
01688      COMPUTE PV-FIRST-BLOCK-IN-RANGE =                               CL**2
01689          1 + ((PV-START-OF-SELECTED-RANGE - 1) /                     CL**2
01690                PC-ITEMS-PER-BLOCK).                                  CL**2
01691 *                                                                    CL**2
01692      MOVE MB137-END-OF-SELECTED-RANGE                                CL**2
01693                                TO  PV-END-OF-SELECTED-RANGE.         CL**2
01694      COMPUTE PV-LAST-BLOCK-IN-RANGE =                                CL**2
01695          1 + ((PV-END-OF-SELECTED-RANGE - 1) /                       CL**2
01696                PC-ITEMS-PER-BLOCK).                                  CL**2
01697 *                                                                    CL**2
01698      COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                CL**2
01699          PV-FIRST-BLOCK-IN-ARRAY + 1.                                CL**2
01700 *                                                                    CL**2
01701      IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR       CL**2
01702         (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)           CL**2
01703          MOVE +1               TO  MB137-BLK-SUB                     CL**2
01704          PERFORM Z150-WRITE-TEMP-STORAGE                             CL**2
01705          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                            CL**2
01706              PV-FIRST-BLOCK-IN-ARRAY - 1                             CL**2
01707 *                                                                    CL**2
01708          PERFORM                                                     CL**2
01709              UNTIL PV-FIRST-BLOCK-IN-RANGE >                         CL**2
01710                    PV-PREV-BLOCK-IN-ARRAY                            CL**2
01711              MOVE PV-FIRST-BLOCK-IN-RANGE                            CL**2
01712                                TO  PV-BLOCK-NUMBER                   CL**2
01713              PERFORM Z100-READ-TEMP-STORAGE                          CL**2
01714              PERFORM G200-MARK-SELECTED-INDS                         CL**2
01715                  VARYING MB137-ITEM-SUB FROM 1 BY 1                  CL**2
01716                  UNTIL MB137-ITEM-SUB > PC-ITEMS-PER-BLOCK           CL**2
01717              PERFORM Z150-WRITE-TEMP-STORAGE                         CL**2
01718              ADD +1            TO PV-FIRST-BLOCK-IN-RANGE            CL**2
01719          END-PERFORM                                                 CL**2
01720 *                                                                    CL**2
01721          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                            CL**2
01722              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY        CL**2
01723          PERFORM                                                     CL**2
01724              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                          CL**2
01725                    PV-LAST-BLOCK-IN-RANGE                            CL**2
01726              MOVE PV-NEXT-BLOCK-IN-ARRAY                             CL**2
01727                                TO  PV-BLOCK-NUMBER                   CL**2
01728              PERFORM Z100-READ-TEMP-STORAGE                          CL**2
01729              PERFORM G200-MARK-SELECTED-INDS                         CL**2
01730                  VARYING MB137-ITEM-SUB FROM 1 BY 1                  CL**2
01731                  UNTIL MB137-ITEM-SUB > PC-ITEMS-PER-BLOCK           CL**2
01732              PERFORM Z150-WRITE-TEMP-STORAGE                         CL**2
01733              ADD +1            TO  PV-NEXT-BLOCK-IN-ARRAY            CL**2
01734          END-PERFORM                                                 CL**2
01735 *                                                                    CL**2
01736          MOVE PV-FIRST-BLOCK-IN-ARRAY                                CL**2
01737                                TO  PV-BLOCK-NUMBER                   CL**2
01738 *                                                                    CL**2
01739          PERFORM Z100-READ-TEMP-STORAGE                              CL**2
01740 *                                                                    CL**2
01741      END-IF.                                                         CL**2
01742                                                                      CL**2
01743      MOVE +0                   TO  MB137-START-OF-SELECTED-RANGE     CL**2
01744                                    MB137-END-OF-SELECTED-RANGE.      CL**2
01745 *                                                                    CL**2
01746  EJECT                                                               CL**2
01747                                                                      CL**2
01748  F300-CHECK-SELECTIONS.                                              CL**2
01749 ******************************************************************   CL**2
01750 *    CHECK EACH ENTRY TO DETERMINE IF THE SELECTION CRITERIA IN      CL**2
01751 *    THE MAP DIFFERS FROM THAT IN THE ARRAY.  IF THEY DO DIFFER,     CL**2
01752 *    AND THE ARRAY ENTRY SHOWS THAT THE ITEM WAS PREVIOUSLY          CL**2
01753 *    SELECTED, SUBTRACT 1 FROM THE SELECTED COUNTER.  IF THEY DO     CL**2
01754 *    DIFFER, AND THE ARRAY ENTRY SHOWS THAT THIS ITEM WAS MARKED     CL**2
01755 *    AS EITHER THE BEGINNING OR ENDING SELECTION POINT, ZERO OUT     CL**2
01756 *    THE STARTING RANGE AND/OR ENDING RANGE.  IF THE ENTRY ON        CL**2
01757 *    THE MAP SHOWS THAT THIS ITEM WAS SELECTED, ADD 1 TO THE         CL**2
01758 *    SELECTED COUNTER.                                               CL**2
01759 ******************************************************************   CL**2
01760 *                                                                    CL**2
01761      IF (PV-ITEM-IN-USE < MB137-NUMBER-OF-ITEMS-READ) OR             CL**2
01762         (PV-ITEM-IN-USE = MB137-NUMBER-OF-ITEMS-READ)                CL**2
01763 *                                                                    CL**2
01764          PERFORM K100-SET-SUBSCRIPTS                                 CL**2
01765 *                                                                    CL**2
01766          IF  MB007Q-SELECTED-SW(MB137-BLK-SUB MB137-ITEM-SUB)        CL**2
01767              NOT EQUAL MBKM137-SELECT(PS-SUB)                        CL**2
01768              SET MB007Q-BLOCK-MODIFIED(MB137-BLK-SUB)                CL**2
01769                                TO  TRUE                              CL**2
01770              IF  MB007Q-SELECT(MB137-BLK-SUB MB137-ITEM-SUB)         CL**2
01771                  SUBTRACT +1 FROM MB007-NUMBER-OF-SELECTED-ITEMS     CL**2
01772              ELSE                                                    CL**2
01773 *                                                                    CL**2
01774                  IF  MB007Q-BEGIN(MB137-BLK-SUB MB137-ITEM-SUB)      CL**2
01775                      IF  MB007Q-LIST-ITEM-NBR(MB137-BLK-SUB          CL**2
01776                                                MB137-ITEM-SUB) =     CL**2
01777                          MB137-START-OF-SELECTED-RANGE               CL**2
01778                          MOVE +0                                     CL**2
01779                                TO  MB137-START-OF-SELECTED-RANGE     CL**2
01780                      END-IF                                          CL**2
01781                  ELSE                                                CL**2
01782 *                                                                    CL**2
01783                      IF  MB007Q-END(MB137-BLK-SUB MB137-ITEM-SUB)    CL**2
01784                          IF  MB007Q-LIST-ITEM-NBR                    CL**2
01785                                  (MB137-BLK-SUB MB137-ITEM-SUB)      CL**2
01786                          =  MB137-END-OF-SELECTED-RANGE              CL**2
01787                              MOVE +0                                 CL**2
01788                                TO MB137-END-OF-SELECTED-RANGE        CL**2
01789                          END-IF                                      CL**2
01790                      END-IF                                          CL**2
01791                  END-IF                                              CL**2
01792              END-IF                                                  CL**2
01793 *                                                                    CL**2
01794              IF MBKM137-SELECT(PS-SUB) = PC-SELECTED                 CL**2
01795                  ADD +1        TO MB007-NUMBER-OF-SELECTED-ITEMS     CL**2
01796              END-IF                                                  CL**2
01797 *                                                                    CL**2
01798              IF (MBKM137-SELECTA(PS-SUB) = PC-ERASE-EOF) OR          CL**2
01799                 (MBKM137-SELECT(PS-SUB) = SPACES)                    CL**2
01800                  MOVE SPACES   TO                                    CL**2
01801                       MB007Q-SELECTED-SW(MB137-BLK-SUB               CL**2
01802                                         MB137-ITEM-SUB)              CL**2
01803              ELSE                                                    CL**2
01804                  MOVE MBKM137-SELECT(PS-SUB) TO                      CL**2
01805                       MB007Q-SELECTED-SW(MB137-BLK-SUB               CL**2
01806                                         MB137-ITEM-SUB)              CL**2
01807              END-IF                                                  CL**2
01808          END-IF                                                      CL**2
01809      END-IF.                                                         CL**2
01810 *                                                                    CL**2
01811      ADD +1                    TO  PV-ITEM-IN-USE.                   CL**2
01812      ADD +1                    TO  PS-SUB.                           CL**2
01813 *                                                                    CL**2
01814  EJECT                                                               CL**2
01815                                                                      CL**2
01816  F500-BROWSE.                                                        CL**2
01817 ******************************************************************   CL**2
01818 *    CALCULATE THE NEW TOP AND BOTTOM ITEM NUMBERS BASED ON WHERE    CL**2
01819 *    THE USER SPECIFIED TO GO ON THE LIST AND DETERMINE WHERE        CL**2
01820 *    THESE ITEMS CAN BE FOUND (I.E. ARRAY, TEMPORARY STORAGE).       CL**2
01821 ******************************************************************   CL**2
01822 *                                                                    CL**2
01823      IF  PV-TOP-ITEM < +1                                            CL**2
01824 *      ** IF USER HIT PAGE BKWD, BUT IS ALREADY AT TOP OF LIST **    CL**2
01825          MOVE +1               TO  PV-TOP-ITEM                       CL**2
01826          IF  PS-CURSOR-NOT-POSITIONED                                CL**2
01827              MOVE PC-TSYMSG-00069  TO  DP020-MSG-NUMBER              CL**2
01828              SET DP020-MSG-INFORMATIONAL                             CL**2
01829                                    TO  TRUE                          CL**2
01830              SET PS-INFORMATIONAL  TO  TRUE                          CL**2
01831              SET PS-CURSOR-POSITIONED                                CL**2
01832                                    TO  TRUE                          CL**2
01833          END-IF                                                      CL**2
01834      END-IF.                                                         CL**2
01835 *                                                                    CL**2
01836      IF  MB137-NO-ITEMS-LEFT-ON-DB                                   CL**2
01837 *      ** IF USER HIT PAGE FWD, BUT IS ALREADY AT LIST END **        CL**2
01838                                                                      CL**2
01839          IF  PV-TOP-ITEM > MB137-NUMBER-OF-ITEMS-READ                CL**2
01840                                                                      CL**2
01841              IF  DP020-SRC-AID EQUAL DP016-ENTER                     CL**2
01842                  MOVE MB137-NUMBER-OF-ITEMS-READ                     CL**2
01843                                TO  PV-TOP-ITEM                       CL**2
01844              ELSE                                                    CL**2
01845                  MOVE MB137-ITEM-AT-TOP-OF-PANEL                     CL**2
01846                                TO  PV-TOP-ITEM                       CL**2
01847              END-IF                                                  CL**2
01848                                                                      CL**2
01849              IF  PS-CURSOR-NOT-POSITIONED                            CL**2
01850                  MOVE -1       TO  ANAVCMDL                          CL**2
01851                  SET DP020-MSG-INFORMATIONAL                         CL**2
01852                                TO  TRUE                              CL**2
01853                  SET PS-CURSOR-POSITIONED                            CL**2
01854                                TO  TRUE                              CL**2
01855                  IF  DP020-FK-NEXT-PAGE(DP020-SRC-AID)               CL**2
01856                      MOVE PC-TSYMSG-00070                            CL**2
01857                                TO  DP020-MSG-NUMBER                  CL**2
01858                      SET PS-INFORMATIONAL                            CL**2
01859                                TO  TRUE                              CL**2
01860                  ELSE                                                CL**2
01861                      MOVE PC-TSYMSG-00061                            CL**2
01862                                TO  DP020-MSG-NUMBER                  CL**2
01863                  END-IF                                              CL**2
01864 *                                                                    CL**2
01865              END-IF                                                  CL**2
01866 *                                                                    CL**2
01867          END-IF                                                      CL**2
01868 *                                                                    CL**2
01869      END-IF.                                                         CL**2
01870 *                                                                    CL**2
01871      COMPUTE PV-BOTTOM-ITEM =                                        CL**2
01872          (PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1.                     CL**2
01873                                                                      CL**2
01874      IF MB137-NO-ITEMS-LEFT-ON-DB                                    CL**2
01875 *      ** USER HIT PAGE FWD, AND NEXT PAGE IS LIST END **            CL**2
01876          IF PV-BOTTOM-ITEM > MB137-NUMBER-OF-ITEMS-READ              CL**2
01877              MOVE MB137-NUMBER-OF-ITEMS-READ                         CL**2
01878                                TO  PV-BOTTOM-ITEM                    CL**2
01879              IF PS-CURSOR-NOT-POSITIONED                             CL**2
01880                  IF PV-TOP-ITEM NOT = +1                             CL**2
01881                      IF DP020-FK-NEXT-PAGE(DP020-SRC-AID)            CL**2
01882                          MOVE PC-TSYMSG-00070                        CL**2
01883                                TO  DP020-MSG-NUMBER                  CL**2
01884                          SET PS-INFORMATIONAL                        CL**2
01885                                TO  TRUE                              CL**2
01886                          SET DP020-MSG-INFORMATIONAL                 CL**2
01887                                TO  TRUE                              CL**2
01888                          SET PS-CURSOR-POSITIONED                    CL**2
01889                                TO  TRUE                              CL**2
01890                      END-IF                                          CL**2
01891                  END-IF                                              CL**2
01892              END-IF                                                  CL**2
01893 *                                                                    CL**2
01894          END-IF                                                      CL**2
01895      END-IF.                                                         CL**2
01896 *                                                                    CL**2
01897 *    ** TIME TO DETERMINE WHETHER THE ITEMS NEEDED ARE IN            CL**2
01898 *    ** WORKING STORAGE, TEMP STORAGE, OR NEITHER.                   CL**2
01899 *                                                                    CL**2
01900      PERFORM G300-DETERMINE-WHAT-IS-WHERE.                           CL**2
01901                                                                      CL**2
01902      IF  PS-TOP-ITEM-IN-ARRAY                                        CL**2
01903          IF  PS-BOTTOM-ITEM-NOT-IN-ARRAY                             CL**2
01904 *          **-------------------------------------------**           CL**2
01905 *          ** TOP ITEM IS IN WORKING STORAGE AND BOTTOM **           CL**2
01906 *          **   ITEM IS IN TEMPORARY STORAGE.           **           CL**2
01907 *          **-------------------------------------------**           CL**2
01908              IF  PS-BOTTOM-ITEM-IN-TEMP                              CL**2
01909                  PERFORM G500-SCROLL-FORWARD                         CL**2
01910              ELSE                                                    CL**2
01911 *               **-------------------------------------**            CL**2
01912 *               ** TOP ITEM IS IN WORKING STORAGE BUT  **            CL**2
01913 *               **  BOTTOM ITEM HAS NOT BEEN READ YET. **            CL**2
01914 *               **-------------------------------------**            CL**2
01915                  IF  PS-LAST-BLOCK-NOT-IN-ARRAY                      CL**2
01916 *                   ** MAKE SURE LAST LOGICAL BLOCK IS **            CL**2
01917 *                   ** IN WORKING STORAGE TO ADD ROWS  **            CL**2
01918                      PERFORM G500-SCROLL-FORWARD                     CL**2
01919                  END-IF                                              CL**2
01920                  PERFORM G400-READ-ITEMS-INTO-ARRAY                  CL**2
01921              END-IF                                                  CL**2
01922          END-IF                                                      CL**2
01923      ELSE                                                            CL**2
01924 *                                                                    CL**2
01925          IF  PS-BOTTOM-ITEM-IN-ARRAY                                 CL**2
01926 *          **-------------------------------------------**           CL**2
01927 *          ** BOTTOM ITEM IS IN WORKING STORAGE AND TOP **           CL**2
01928 *          **   ITEM IS IN TEMPORARY STORAGE.           **           CL**2
01929 *          **-------------------------------------------**           CL**2
01930              PERFORM G600-SCROLL-BACKWARD                            CL**2
01931          ELSE                                                        CL**2
01932              IF  PS-TOP-ITEM-IN-TEMP                                 CL**2
01933 *               **-------------------------------------**            CL**2
01934 *               ** TOP & BOTTOM ITEMS ARE NOT IN  W.S. **            CL**2
01935 *               **-------------------------------------**            CL**2
01936                  PERFORM G700-GET-TOP-ITEMS-BLOCK                    CL**2
01937                  PERFORM G300-DETERMINE-WHAT-IS-WHERE                CL**2
01938                  IF  PS-BOTTOM-ITEM-NOT-IN-ARRAY                     CL**2
01939 *                   **-------------------------------------**        CL**2
01940 *                   ** TOP ITEM IS IN TEMP STORAGE, BUT    **        CL**2
01941 *                   ** BOTTOM ITEM HAS NOT BEEN READ YET.  **        CL**2
01942 *                   **-------------------------------------**        CL**2
01943                      PERFORM G400-READ-ITEMS-INTO-ARRAY              CL**2
01944                  END-IF                                              CL**2
01945              ELSE                                                    CL**2
01946 *               **---------------------------------------**          CL**2
01947 *               ** TOP & BOTTOM ITEMS HAVE NOT BEEN READ.**          CL**2
01948 *               ** READ LAST LOGICAL BLOCK INTO WORKING  **          CL**2
01949 *               ** STORAGE TO ADD MORE ROWS TO IT.       **          CL**2
01950 *               **---------------------------------------**          CL**2
01951                  IF  PS-LAST-BLOCK-NOT-IN-ARRAY                      CL**2
01952                      PERFORM G800-GET-LAST-BLOCK-IN-TEMP             CL**2
01953                  END-IF                                              CL**2
01954                  PERFORM G400-READ-ITEMS-INTO-ARRAY                  CL**2
01955              END-IF                                                  CL**2
01956          END-IF                                                      CL**2
01957      END-IF.                                                         CL**2
01958 *                                                                    CL**2
01959      IF  PV-TOP-ITEM = MB137-ITEM-AT-TOP-OF-PANEL                    CL**2
01960          SET PS-SAME-ITEMS-DISPLAYED                                 CL**2
01961                                TO  TRUE                              CL**2
01962      ELSE                                                            CL**2
01963          SET PS-DIFFERENT-ITEMS-DISPLAYED                            CL**2
01964                                TO  TRUE                              CL**2
01965          MOVE PV-TOP-ITEM      TO  MB137-ITEM-AT-TOP-OF-PANEL        CL**2
01966      END-IF.                                                         CL**2
01967 *                                                                    CL**2
01968      PERFORM G100-DISPLAY-PANEL.                                     CL**2
01969 *                                                                    CL**2
01970  EJECT                                                               CL**2
01971                                                                      CL**2
01972  F600-CLEAR-SELECTED-INDS.                                           CL**2
01973 ******************************************************************   CL**2
01974 *    MARK EACH ITEM AS BEING NOT SELECTED.                           CL**2
01975 ******************************************************************   CL**2
01976 *                                                                    CL**2
01977      IF  MB007Q-LIST-ITEM-NBR(MB137-BLK-SUB MB137-ITEM-SUB)          CL**2
01978              NOT EQUAL ZERO                                          CL**2
01979          IF  NOT MB007Q-NO-SELECT(MB137-BLK-SUB MB137-ITEM-SUB)      CL**2
01980              SET MB007Q-NO-SELECT(MB137-BLK-SUB MB137-ITEM-SUB)      CL**2
01981                                TO  TRUE                              CL**2
01982              SET MB007Q-BLOCK-MODIFIED(MB137-BLK-SUB)                CL**2
01983                                TO  TRUE                              CL**2
01984          END-IF                                                      CL**2
01985      END-IF.                                                         CL**2
01986 *                                                                    CL**2
01987  EJECT                                                               CL**2
01988                                                                      CL**2
01989  F700-SET-SELECTED-INDS.                                             CL**2
01990 ******************************************************************   CL**2
01991 *    MARK EACH ITEM AS BEING SELECTED.                               CL**2
01992 ******************************************************************   CL**2
01993 *                                                                    CL**2
01994      IF  MB007Q-LIST-ITEM-NBR(MB137-BLK-SUB MB137-ITEM-SUB)          CL**2
01995              NOT EQUAL ZERO                                          CL**2
01996          IF  NOT MB007Q-SELECT(MB137-BLK-SUB MB137-ITEM-SUB)         CL**2
01997              SET MB007Q-SELECT(MB137-BLK-SUB MB137-ITEM-SUB)         CL**2
01998                                TO  TRUE                              CL**2
01999              SET MB007Q-BLOCK-MODIFIED(MB137-BLK-SUB)                CL**2
02000                                TO  TRUE                              CL**2
02001          END-IF                                                      CL**2
02002      END-IF.                                                         CL**2
02003 *                                                                    CL**2
02004  EJECT                                                               CL**2
02005                                                                      CL**2
02006  G100-DISPLAY-PANEL.                                                 CL**2
02007 ******************************************************************   CL**2
02008 *    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.          CL**2
02009 ******************************************************************   CL**2
02010 *                                                                    CL**2
02011      MOVE PC-COMPANY           TO  AOPERCOO.                         CL**2
02012      MOVE DP015-BLUE           TO  AOPERCOC.                         CL**2
02013 *                                                                    CL**2
02014      PERFORM DP017-0000-GET-CURR-DATE-TIME.                          CL**2
02015      MOVE DP017-EDITED-TIME-HMS                                      CL**2
02016                                TO  ATIMEO.                           CL**2
02017 *                                                                    CL**2
02018      IF PS-SEND-MAP-N-DATA-FRSET                                     CL**2
02019          PERFORM DP002-0000-FORMAT-TITLE-LINES                       CL**2
02020          PERFORM DP009-0000-LOAD-FK-LINES                            CL**2
02021      END-IF.                                                         CL**2
02022 *                                                                    CL**2
02023      PERFORM H200-FORMAT-PANEL-BODY.                                 CL**2
02024 *                                                                    CL**2
02025      IF NOT DP020-NEXT-ACT-ERROR                                     CL**2
02026         SET PS-NO-ERROR TO TRUE                                      CL**2
02027         MOVE DP015-GREEN     TO ANAVCMDC                             CL**2
02028                                 ANAVKEYC                             CL**2
02029         MOVE DP015-UNDERLINE TO ANAVCMDH                             CL**2
02030                                 ANAVKEYH                             CL**2
02031      END-IF.                                                         CL**2
02032 *                                                                    CL**2
02033      PERFORM DP005-0000-FORMAT-MSG-LINES.                            CL**2
02034 *                                                                    CL**2
02035      IF DP020-SRC-AID = DP016-PF3                                    CL**2
02036          CONTINUE                                                    CL**2
02037      ELSE                                                            CL**2
02038          PERFORM DP008-0000-WRITE-PANEL                              CL**2
02039      END-IF.                                                         CL**2
02040 *                                                                    CL**2
02041  EJECT                                                               CL**2
02042                                                                      CL**2
02043  G200-MARK-SELECTED-INDS.                                            CL**2
02044 ******************************************************************   CL**2
02045 *    MARK EACH ITEM THAT FALLS WITHIN THE BEGINNING AND ENDING       CL**2
02046 *    RANGE AS BEING SELECTED.                                        CL**2
02047 ******************************************************************   CL**2
02048 *                                                                    CL**2
02049      IF (MB007Q-LIST-ITEM-NBR(MB137-BLK-SUB                          CL**2
02050                                 MB137-ITEM-SUB) >                    CL**2
02051          MB137-START-OF-SELECTED-RANGE)                              CL**2
02052      OR (MB007Q-LIST-ITEM-NBR(MB137-BLK-SUB                          CL**2
02053                                 MB137-ITEM-SUB) =                    CL**2
02054          MB137-START-OF-SELECTED-RANGE)                              CL**2
02055 *                                                                    CL**2
02056          IF (MB007Q-LIST-ITEM-NBR(MB137-BLK-SUB                      CL**2
02057                                     MB137-ITEM-SUB) <                CL**2
02058              MB137-END-OF-SELECTED-RANGE)                            CL**2
02059          OR (MB007Q-LIST-ITEM-NBR(MB137-BLK-SUB                      CL**2
02060                                     MB137-ITEM-SUB) =                CL**2
02061              MB137-END-OF-SELECTED-RANGE)                            CL**2
02062 *                                                                    CL**2
02063              IF NOT MB007Q-SELECT(MB137-BLK-SUB MB137-ITEM-SUB)      CL**2
02064                  SET MB007Q-SELECT(MB137-BLK-SUB                     CL**2
02065                                   MB137-ITEM-SUB)                    CL**2
02066                                TO  TRUE                              CL**2
02067                  SET MB007Q-BLOCK-MODIFIED(MB137-BLK-SUB)            CL**2
02068                                TO  TRUE                              CL**2
02069                  ADD +1        TO MB007-NUMBER-OF-SELECTED-ITEMS     CL**2
02070              END-IF                                                  CL**2
02071          END-IF                                                      CL**2
02072      END-IF.                                                         CL**2
02073 *                                                                    CL**2
02074  EJECT                                                               CL**2
02075                                                                      CL**2
02076  G300-DETERMINE-WHAT-IS-WHERE.                                       CL**2
02077 ******************************************************************   CL**2
02078 *    DETERMINE WHETHER THE TOP ITEM AND BOTTOM ITEM CAN BE FOUND     CL**2
02079 *    IN THE ARRAY, IN TEMPORARY STORAGE, OR NEITHER.                 CL**2
02080 ******************************************************************   CL**2
02081 *                                                                    CL**2
02082      MOVE MB007Q-LIST-ITEM-NBR(1 1)                                  CL**2
02083                                TO  PV-FIRST-ITEM-IN-ARRAY.           CL**2
02084      COMPUTE PV-LAST-ITEM-IN-ARRAY =                                 CL**2
02085          (PV-FIRST-ITEM-IN-ARRAY +                                   CL**2
02086          (PC-MAX-BLOCKS-IN-ARRAY * PC-ITEMS-PER-BLOCK)) - 1.         CL**2
02087      IF  PV-LAST-ITEM-IN-ARRAY > MB137-NUMBER-OF-ITEMS-READ          CL**2
02088          MOVE MB137-NUMBER-OF-ITEMS-READ                             CL**2
02089                                TO  PV-LAST-ITEM-IN-ARRAY             CL**2
02090      END-IF.                                                         CL**2
02091 *                                                                    CL**2
02092      COMPUTE PV-LAST-ITEM-IN-TEMP =                                  CL**2
02093          MB137-HIGHEST-BLOCK-WRITTEN * PC-ITEMS-PER-BLOCK.           CL**2
02094      IF  PV-LAST-ITEM-IN-TEMP > MB137-NUMBER-OF-ITEMS-READ           CL**2
02095          MOVE MB137-NUMBER-OF-ITEMS-READ                             CL**2
02096                                TO  PV-LAST-ITEM-IN-TEMP              CL**2
02097      END-IF.                                                         CL**2
02098 *                                                                    CL**2
02099      IF (PV-TOP-ITEM > PV-FIRST-ITEM-IN-ARRAY)                       CL**2
02100      OR (PV-TOP-ITEM = PV-FIRST-ITEM-IN-ARRAY)                       CL**2
02101          IF (PV-TOP-ITEM < PV-LAST-ITEM-IN-ARRAY)                    CL**2
02102          OR (PV-TOP-ITEM = PV-LAST-ITEM-IN-ARRAY)                    CL**2
02103              SET PS-TOP-ITEM-IN-ARRAY                                CL**2
02104                                TO  TRUE                              CL**2
02105          ELSE                                                        CL**2
02106              SET PS-TOP-ITEM-NOT-IN-ARRAY                            CL**2
02107                                TO  TRUE                              CL**2
02108          END-IF                                                      CL**2
02109      ELSE                                                            CL**2
02110          SET PS-TOP-ITEM-NOT-IN-ARRAY                                CL**2
02111                                TO  TRUE                              CL**2
02112      END-IF.                                                         CL**2
02113 *                                                                    CL**2
02114      IF (PV-BOTTOM-ITEM > PV-FIRST-ITEM-IN-ARRAY)                    CL**2
02115      OR (PV-BOTTOM-ITEM = PV-FIRST-ITEM-IN-ARRAY)                    CL**2
02116          IF (PV-BOTTOM-ITEM < PV-LAST-ITEM-IN-ARRAY)                 CL**2
02117          OR (PV-BOTTOM-ITEM = PV-LAST-ITEM-IN-ARRAY)                 CL**2
02118              SET PS-BOTTOM-ITEM-IN-ARRAY                             CL**2
02119                                TO  TRUE                              CL**2
02120          ELSE                                                        CL**2
02121              SET PS-BOTTOM-ITEM-NOT-IN-ARRAY                         CL**2
02122                                TO  TRUE                              CL**2
02123          END-IF                                                      CL**2
02124      ELSE                                                            CL**2
02125          SET PS-BOTTOM-ITEM-NOT-IN-ARRAY                             CL**2
02126                                TO  TRUE                              CL**2
02127      END-IF.                                                         CL**2
02128 *                                                                    CL**2
02129      IF (PV-TOP-ITEM < PV-LAST-ITEM-IN-TEMP)                         CL**2
02130      OR (PV-TOP-ITEM = PV-LAST-ITEM-IN-TEMP)                         CL**2
02131          SET PS-TOP-ITEM-IN-TEMP                                     CL**2
02132                                TO  TRUE                              CL**2
02133      ELSE                                                            CL**2
02134          SET PS-TOP-ITEM-NOT-IN-TEMP                                 CL**2
02135                                TO  TRUE                              CL**2
02136      END-IF.                                                         CL**2
02137 *                                                                    CL**2
02138      IF (PV-BOTTOM-ITEM < PV-LAST-ITEM-IN-TEMP)                      CL**2
02139      OR (PV-BOTTOM-ITEM = PV-LAST-ITEM-IN-TEMP)                      CL**2
02140          SET PS-BOTTOM-ITEM-IN-TEMP                                  CL**2
02141                                TO  TRUE                              CL**2
02142      ELSE                                                            CL**2
02143          SET PS-BOTTOM-ITEM-NOT-IN-TEMP                              CL**2
02144                                TO  TRUE                              CL**2
02145      END-IF.                                                         CL**2
02146 *                                                                    CL**2
02147      IF PV-LAST-ITEM-IN-TEMP > PV-LAST-ITEM-IN-ARRAY                 CL**2
02148          SET PS-LAST-BLOCK-NOT-IN-ARRAY                              CL**2
02149                                TO  TRUE                              CL**2
02150      ELSE                                                            CL**2
02151          SET PS-LAST-BLOCK-IN-ARRAY                                  CL**2
02152                                TO  TRUE                              CL**2
02153      END-IF.                                                         CL**2
02154 *                                                                    CL**2
02155  EJECT                                                               CL**2
02156                                                                      CL**2
02157  G400-READ-ITEMS-INTO-ARRAY.                                         CL**2
02158 ******************************************************************   CL**2
02159 *    DETERMINE THE SPOT IN THE ARRAY WHERE THE LAST ITEM FROM        CL**2
02160 *    THE DATA BASE WAS ADDED SO WE KNOW WHERE TO ADD THE NEW         CL**2
02161 *    ITEMS.  USE THE SAVED UPC KEY TO START THE BROWSE.  H600        CL**2
02162 *    MUST BE PERFORMED TO POSITION TO THE FIRST UPC TO PROCESS.      CL**2
02163 ******************************************************************   CL**2
02164 *                                                                    CL**2
02165      COMPUTE PS-ITEMS-SUB =                                          CL**2
02166          (MB137-NUMBER-OF-ITEMS-READ -                               CL**2
02167           MB007Q-LIST-ITEM-NBR(1 1)) + 1.                            CL**2
02168                                                                      CL**2
02169      MOVE PS-ITEMS-SUB TO MB137-ITEM-SUB.                            CL**2
02170                                                                      CL**2
02171      IF  MB137-ITEM-SUB > PC-ITEMS-PER-BLOCK                         CL**2
02172          SUBTRACT PC-ITEMS-PER-BLOCK                                 CL**2
02173                              FROM  MB137-ITEM-SUB                    CL**2
02174          MOVE PC-MAX-BLOCKS-IN-ARRAY                                 CL**2
02175                                TO  MB137-BLK-SUB                     CL**2
02176      ELSE                                                            CL**2
02177          MOVE +1               TO  MB137-BLK-SUB                     CL**2
02178      END-IF.                                                         CL**2
02179 *                                                                    CL**2
02180 *    ** COMPUTED IN PARA: F500-BROUSE **                             CL**2
02181      MOVE PV-BOTTOM-ITEM       TO  PV-HIGHEST-ITEM-TO-BE-READ.       CL**2
02182 *                                                                    CL**2
02183      PERFORM L200-OPEN-WKR-CURSOR.                                   CL**2
02184 *                                                                    CL**2
02185      PERFORM H100-READ-ITEMS-FROM-DB.                                CL**2
02186 *                                                                    CL**2
02187      PERFORM L400-CLOSE-WKR-CURSOR.                                  CL**2
02188 *                                                                    CL**2
02189      IF  PV-ITEMS-READ EQUAL ZERO                                    CL**2
02190          MOVE MB137-ITEM-AT-TOP-OF-PANEL                             CL**2
02191                                TO  PV-TOP-ITEM                       CL**2
02192      END-IF.                                                         CL**2
02193 *                                                                    CL**2
02194      IF  MB137-NO-ITEMS-LEFT-ON-DB                                   CL**2
02195          IF  PV-TOP-ITEM > MB137-NUMBER-OF-ITEMS-READ                CL**2
02196              MOVE MB137-NUMBER-OF-ITEMS-READ                         CL**2
02197                                TO  PV-TOP-ITEM                       CL**2
02198          END-IF                                                      CL**2
02199 *        IF  DP020-FK-NEXT-PAGE(DP020-SRC-AID)                       CL**2
02200              MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER              CL**2
02201              SET DP020-MSG-INFORMATIONAL                             CL**2
02202                                TO  TRUE                              CL**2
02203              SET PS-INFORMATIONAL                                    CL**2
02204                                TO  TRUE                              CL**2
02205 *        END-IF                                                      CL**2
02206      END-IF.                                                         CL**2
02207 *                                                                    CL**2
02208  EJECT                                                               CL**2
02209                                                                      CL**2
02210  G500-SCROLL-FORWARD.                                                CL**2
02211 ******************************************************************   CL**2
02212 *    IF THE TOP ITEM WE NEED IS IN THE ARRAY, BUT THE BOTTOM         CL**2
02213 *    ITEM WE NEED IS IN TEMPORARY STORAGE OR HAS NOT BEEN READ       CL**2
02214 *    YET, WRITE OUT THE 1ST BLOCK IN THE ARRAY TO TEMPORARY          CL**2
02215 *    STORAGE.  MOVE THE 2ND BLOCK IN THE ARRAY TO THE 1ST BLOCK      CL**2
02216 *    AND READ THE BLOCK NEEDED INTO THE 2ND BLOCK OF THE ARRAY.      CL**2
02217 *    THE TOP ITEM WILL BE LOCATED IN THE 1ST BLOCK, AND THE          CL**2
02218 *    BOTTOM ITEM WILL EITHER BE LOCATED IN THE 2ND BLOCK OR          CL**2
02219 *    WILL BE PLACED IN THE 2ND BLOCK.                                CL**2
02220 ******************************************************************   CL**2
02221 *                                                                    CL**2
02222      MOVE +1                   TO  MB137-BLK-SUB.                    CL**2
02223      SET MB007Q-BLOCK-MODIFIED (1)                                   CL**2
02224                                TO  TRUE.                             CL**2
02225      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**2
02226 *                                                                    CL**2
02227      MOVE MB137-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY) TO             CL**2
02228           MB137-BLOCK-ENTRIES(MB137-BLK-SUB).                        CL**2
02229 *                                                                    CL**2
02230      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**2
02231          1 + ((PV-BOTTOM-ITEM - 1) / PC-ITEMS-PER-BLOCK).            CL**2
02232 *                                                                    CL**2
02233      MOVE PV-TEMP-BLOCK-NUMBER TO  PV-BLOCK-NUMBER.                  CL**2
02234      ADD +1                    TO  MB137-BLK-SUB.                    CL**2
02235      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**2
02236 *                                                                    CL**2
02237  EJECT                                                               CL**2
02238                                                                      CL**2
02239  G600-SCROLL-BACKWARD.                                               CL**2
02240 ******************************************************************   CL**2
02241 *    IF TOP ITEM WE NEED IS NOT IN THE ARRAY, BUT THE BOTTOM         CL**2
02242 *    ITEM IS, WRITE BOTH BLOCKS TO TEMPORARY STORAGE.  MOVE          CL**2
02243 *    THE 1ST BLOCK IN THE ARRAY TO THE 2ND BLOCK OF THE ARRAY.       CL**2
02244 *    READ THE BLOCK THAT CONTAINS THE TOP ITEM INTO THE 1ST BLOCK    CL**2
02245 *    OF THE ARRAY.                                                   CL**2
02246 ******************************************************************   CL**2
02247 *                                                                    CL**2
02248      MOVE +1                   TO  MB137-BLK-SUB.                    CL**2
02249      SET MB007Q-BLOCK-MODIFIED (1)                                   CL**2
02250                                TO  TRUE.                             CL**2
02251      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**2
02252 *                                                                    CL**2
02253      ADD +1 TO MB137-BLK-SUB.                                        CL**2
02254      SET MB007Q-BLOCK-MODIFIED (2)                                   CL**2
02255                                TO  TRUE.                             CL**2
02256      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**2
02257                                                                      CL**2
02258      MOVE +1                   TO  MB137-BLK-SUB.                    CL**2
02259      MOVE MB137-BLOCK-ENTRIES(MB137-BLK-SUB) TO                      CL**2
02260           MB137-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY).               CL**2
02261 *                                                                    CL**2
02262      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**2
02263          1 + ((PV-TOP-ITEM - 1) / PC-ITEMS-PER-BLOCK).               CL**2
02264 *                                                                    CL**2
02265      MOVE PV-TEMP-BLOCK-NUMBER TO PV-BLOCK-NUMBER.                   CL**2
02266      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**2
02267 *                                                                    CL**2
02268  EJECT                                                               CL**2
02269                                                                      CL**2
02270  G700-GET-TOP-ITEMS-BLOCK.                                           CL**2
02271 ******************************************************************   CL**2
02272 *    IF BOTH THE TOP AND BOTTOM ITEMS WE NEED ARE NOT IN THE         CL**2
02273 *    ARRAY, BUT THE TOP ITEM IS IN TEMPORARY STORAGE, WRITE BOTH     CL**2
02274 *    BLOCKS IN THE ARRAY TO TEMPORARY STORAGE.  READ THE BLOCK       CL**2
02275 *    THAT CONTAINS THE TOP ITEM INTO THE 1ST BLOCK OF THE ARRAY.     CL**2
02276 *    IF THERE IS ANOTHER BLOCK IN TEMPORARY STORAGE FOLLOWING        CL**2
02277 *    THE ONE JUST READ, READ THAT ONE INTO THE 2ND BLOCK OF THE      CL**2
02278 *    ARRAY, OTHERWISE INITIALIZE THE 2ND BLOCK OF THE ARRAY.         CL**2
02279 ******************************************************************   CL**2
02280 *                                                                    CL**2
02281      MOVE +1                   TO  MB137-BLK-SUB.                    CL**2
02282      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**2
02283 *                                                                    CL**2
02284      ADD +1                    TO  MB137-BLK-SUB.                    CL**2
02285      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**2
02286 *                                                                    CL**2
02287      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**2
02288          1 + ((PV-TOP-ITEM - 1) / PC-ITEMS-PER-BLOCK).               CL**2
02289 *                                                                    CL**2
02290      MOVE PV-TEMP-BLOCK-NUMBER TO  PV-BLOCK-NUMBER.                  CL**2
02291      MOVE +1                   TO  MB137-BLK-SUB.                    CL**2
02292 *                                                                    CL**2
02293      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**2
02294                                                                      CL**2
02295      ADD +1                    TO  PV-BLOCK-NUMBER.                  CL**2
02296      ADD +1                    TO  MB137-BLK-SUB.                    CL**2
02297 *                                                                    CL**2
02298      IF (PV-BLOCK-NUMBER < MB137-HIGHEST-BLOCK-WRITTEN) OR           CL**2
02299         (PV-BLOCK-NUMBER = MB137-HIGHEST-BLOCK-WRITTEN)              CL**2
02300          PERFORM Z100-READ-TEMP-STORAGE                              CL**2
02301      ELSE                                                            CL**2
02302          PERFORM I100-INITIALIZE-BLOCK                               CL**2
02303      END-IF.                                                         CL**2
02304 *                                                                    CL**2
02305  EJECT                                                               CL**2
02306                                                                      CL**2
02307  G800-GET-LAST-BLOCK-IN-TEMP.                                        CL**2
02308 ******************************************************************   CL**2
02309 *    IF BOTH THE TOP AND BOTTOM ITEMS WE NEED ARE NOT IN THE         CL**2
02310 *    ARRAY AND BOTH ITEMS ARE NOT IN TEMPORARY STORAGE (THE          CL**2
02311 *    ITEMS HAVE NOT BEEN READ FROM THE DATA BASE YET), AND THE       CL**2
02312 *    LAST ITEM READ FROM THE DATA BASE IS IN TEMPORARY STORAGE,      CL**2
02313 *    WRITE BOTH BLOCKS IN THE ARRAY TO TEMPORARY STORAGE.  READ      CL**2
02314 *    THE HIGHEST BLOCK IN TEMPORARY STORAGE INTO THE 1ST BLOCK       CL**2
02315 *    OF THE ARRAY, AND INITIALIZE THE 2ND BLOCK IN THE ARRAY.        CL**2
02316 *    THE 2ND BLOCK WILL BE USED FOR THE NEW ITEMS TO BE READ.        CL**2
02317 *    THE 1ST BLOCK WILL NOW CONTAIN THE ITEMS THAT WERE LAST         CL**2
02318 *    READ FROM THE DATA BASE.                                        CL**2
02319 ******************************************************************   CL**2
02320 *                                                                    CL**2
02321      MOVE +1                   TO  MB137-BLK-SUB.                    CL**2
02322      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**2
02323 *                                                                    CL**2
02324      ADD +1                    TO  MB137-BLK-SUB.                    CL**2
02325      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**2
02326 *                                                                    CL**2
02327      MOVE MB137-HIGHEST-BLOCK-WRITTEN                                CL**2
02328                                TO  PV-BLOCK-NUMBER.                  CL**2
02329      MOVE +1                   TO  MB137-BLK-SUB.                    CL**2
02330      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**2
02331 *                                                                    CL**2
02332      ADD +1                    TO  MB137-BLK-SUB.                    CL**2
02333      PERFORM I100-INITIALIZE-BLOCK.                                  CL**2
02334 *                                                                    CL**2
02335  EJECT                                                               CL**2
02336                                                                      CL**2
02337  H100-READ-ITEMS-FROM-DB.                                            CL**2
02338 ******************************************************************   CL**2
02339 *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE        CL**2
02340 *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,         CL**2
02341 *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND      CL**2
02342 *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE         CL**2
02343 *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                       CL**2
02344 ******************************************************************   CL**2
02345 *                                                                    CL**2
02346      PERFORM                                                         CL**2
02347          UNTIL (MB137-NO-ITEMS-LEFT-ON-DB)                           CL**2
02348           OR   (MB137-NUMBER-OF-ITEMS-READ =                         CL**2
02349                 PV-HIGHEST-ITEM-TO-BE-READ)                          CL**2
02350 *                                                                    CL**2
02351 **           WHERE 'PV-HIGHEST-ITEM-TO-BE-READ' IS EITHER:           CL**2
02352 **           INITIALLY 'PC-ITEMS-PER-PANEL' (= +12)                  CL**2
02353 **           OR THE CURRENT VALUE OF 'PV-BOTTOM-ITEM'                CL**2
02354 *                                                                    CL**2
02355          IF MB137-ITEM-SUB < PC-ITEMS-PER-BLOCK                      CL**2
02356              ADD +1            TO  MB137-ITEM-SUB                    CL**2
02357          ELSE                                                        CL**2
02358              ADD +1            TO  MB137-BLK-SUB                     CL**2
02359              MOVE +1           TO  MB137-ITEM-SUB                    CL**2
02360 *                                                                    CL**2
02361              IF MB137-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY               CL**2
02362                  MOVE +1       TO  MB137-BLK-SUB                     CL**2
02363                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**2
02364                  MOVE MB137-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY)    CL**2
02365                  TO   MB137-BLOCK-ENTRIES(MB137-BLK-SUB)             CL**2
02366                  ADD +1        TO  MB137-BLK-SUB                     CL**2
02367                  PERFORM I100-INITIALIZE-BLOCK                       CL**2
02368              END-IF                                                  CL**2
02369          END-IF                                                      CL**2
02370 *                                                                    CL**2
02371          SET PS-PREV-ROW-FETCHED TO TRUE                             CL**2
02372 *                                                                    CL**2
02373          PERFORM                                                     CL**2
02374              UNTIL (MB137-NO-ITEMS-LEFT-ON-DB)                       CL**2
02375                 OR (PS-NEW-ROW-FETCHED)                              CL**2
02376 *                                                                    CL**2
02377              PERFORM L300-FETCH-WORKER-DATA                          CL**2
02378 *                                                                    CL**2
02379              IF MB137-NO-ITEMS-LEFT-ON-DB                            CL**2
02380                  CONTINUE                                            CL**2
02381              ELSE                                                    CL**2
02382                  PERFORM L350-INSURE-NEW-ROW-FETCHED                 CL**2
02383              END-IF                                                  CL**2
02384 *                                                                    CL**2
02385          END-PERFORM                                                 CL**2
02386 *                                                                    CL**2
02387          IF  MB137-ITEMS-LEFT-ON-DB                                  CL**2
02388              ADD 1             TO  MB137-NUMBER-OF-ITEMS-READ        CL**2
02389                                    PV-ITEMS-READ                     CL**2
02390 *                                                                    CL**2
02391              MOVE MB137-NUMBER-OF-ITEMS-READ                         CL**2
02392                                TO  MB007-NUMBER-PROCESSED-ITEMS      CL**2
02393                                    MB007Q-LIST-ITEM-NBR              CL**2
02394                                        (MB137-BLK-SUB                CL**2
02395                                         MB137-ITEM-SUB)              CL**2
02396 *                                                                    CL**2
02397 *        ** MOVE DB2 TABLE DATA TO STORAGE BLOCK **                  CL**2
02398 *                                                                    CL**2
02399              MOVE SPACES             TO  MB007Q-REC-ACTION           CL**2
02400                                        (MB137-BLK-SUB                CL**2
02401                                         MB137-ITEM-SUB)              CL**2
02402 *                                                                    CL**2
02403              MOVE WORKER-OPERCO-NBR  TO  MB007Q-WKR-OPERCO           CL**2
02404                                        (MB137-BLK-SUB                CL**2
02405                                         MB137-ITEM-SUB)              CL**2
02406              MOVE WORKER-NBR         TO  MB007Q-WKR-NBR              CL**2
02407                                        (MB137-BLK-SUB                CL**2
02408                                         MB137-ITEM-SUB)              CL**2
02409              MOVE WORKER-UID-NBR     TO  MB007Q-WKR-UID-NBR          CL**2
02410                                        (MB137-BLK-SUB                CL**2
02411                                         MB137-ITEM-SUB)              CL**2
02412              MOVE WORKER-LAST-NAME   TO  MB007Q-WKR-LNAME            CL**2
02413                                        (MB137-BLK-SUB                CL**2
02414                                         MB137-ITEM-SUB)              CL**2
02415              MOVE WORKER-FIR-NAME    TO  MB007Q-WKR-FNAME            CL**2
02416                                        (MB137-BLK-SUB                CL**2
02417                                         MB137-ITEM-SUB)              CL**2
02418 *                                                                    CL**2
02419              SET MB007Q-NO-SELECT      (MB137-BLK-SUB                CL**2
02420                                         MB137-ITEM-SUB)              CL**2
02421                                      TO  TRUE                        CL**2
02422                                                                      CL**2
02423              SET MB007Q-BLOCK-MODIFIED (MB137-BLK-SUB)               CL**2
02424                                      TO  TRUE                        CL**2
02425 *                                                                    CL**2
02426          END-IF                                                      CL**2
02427 *                                                                    CL**2
02428      END-PERFORM.                                                    CL**2
02429 *                                                                    CL**2
02430 *    **  DETERMINE THE LAST, LAST NAME READ, AND STORE  **           CL**2
02431 *    **  IT IN THE SPECIFIC COMMAREA FOR CURSOR RESTART **           CL**2
02432 *                                                                    CL**2
02433      IF  MB137-NO-ITEMS-LEFT-ON-DB                                   CL**2
02434           MOVE HIGH-VALUES      TO MB137-BEGIN-LNAME                 CL**2
02435           MOVE HIGH-VALUES      TO MB137-END-LNAME                   CL**2
02436           MOVE SPACES           TO MB137-LAST-FNAME-FETCHED          CL**2
02437           MOVE ZEROS            TO MB137-WORKER-NBR                  CL**2
02438      ELSE                                                            CL**2
02439           MOVE WORKER-LAST-NAME TO MB137-BEGIN-LNAME                 CL**2
02440           MOVE WORKER-FIR-NAME  TO MB137-LAST-FNAME-FETCHED          CL**2
02441           MOVE WORKER-NBR       TO MB137-WORKER-NBR                  CL**2
02442      END-IF.                                                         CL**2
02443 *                                                                    CL**2
02444  EJECT                                                               CL**2
02445                                                                      CL**2
02446  H200-FORMAT-PANEL-BODY.                                             CL**2
02447 ******************************************************************   CL**2
02448 *    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.               CL**2
02449 ******************************************************************   CL**2
02450 *                                                                    CL**2
02451      PERFORM I700-FORMAT-FROM-TO-LINE.                               CL**2
02452      PERFORM I200-FORMAT-LIST-LINES.                                 CL**2
02453      PERFORM I300-FORMAT-NR-SELECTED.                                CL**2
02454                                                                      CL**2
02455      IF NOT DP020-NEXT-ACT-ERROR                                     CL**2
02456          PERFORM I800-SET-CURSOR-POSITION                            CL**2
02457      END-IF.                                                         CL**2
02458 *                                                                    CL**2
02459  EJECT                                                               CL**2
02460                                                                      CL**2
02461  I100-INITIALIZE-BLOCK.                                              CL**2
02462 ******************************************************************   CL**2
02463 *    INITIALIZE A GIVEN BLOCK IN THE ARRAY.                          CL**2
02464 ******************************************************************   CL**2
02465 *                                                                    CL**2
02466      INITIALIZE  MB137-BLOCK-ENTRIES (MB137-BLK-SUB).                CL**2
02467                                                                      CL**2
02468      SET MB007Q-BLOCK-NOT-MODIFIED(MB137-BLK-SUB) TO TRUE.           CL**2
02469 *                                                                    CL**2
02470  EJECT                                                               CL**2
02471                                                                      CL**2
02472  I200-FORMAT-LIST-LINES.                                             CL**2
02473 ******************************************************************   CL**2
02474 *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.        CL**2
02475 ******************************************************************   CL**2
02476 *                                                                    CL**2
02477      COMPUTE PV-ENDING-ITEM-ON-PANEL =                               CL**2
02478          (MB137-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.      CL**2
02479 *                                                                    CL**2
02480      MOVE MB137-ITEM-AT-TOP-OF-PANEL                                 CL**2
02481                                TO  PV-ITEM-IN-USE.                   CL**2
02482      MOVE +1                   TO  PS-SUB.                           CL**2
02483 *                                                                    CL**2
02484      PERFORM J100-PROCESS-ITEMS                                      CL**2
02485          UNTIL PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL.             CL**2
02486 *                                                                    CL**2
02487  EJECT                                                               CL**2
02488                                                                      CL**2
02489  I300-FORMAT-NR-SELECTED.                                            CL**2
02490 ******************************************************************   CL**2
02491 *    FORMAT THE FIELD WHICH WILL SHOW THE NUMBER OF ITEMS THAT       CL**2
02492 *    WERE SELECTED BY THE USER.                                      CL**2
02493 ******************************************************************   CL**2
02494 *                                                                    CL**2
02495      MOVE MB007-NUMBER-OF-SELECTED-ITEMS                             CL**2
02496                                TO  PV-DISPLAY5.                      CL**2
02497      MOVE PV-DISPLAY5          TO  ATOTSELO.                         CL**2
02498 *                                                                    CL**2
02499  EJECT                                                               CL**2
02500                                                                      CL**2
02501  I700-FORMAT-FROM-TO-LINE.                                           CL**2
02502 ******************************************************************   CL**2
02503 *    FORMAT THE LINE THAT WILL SHOW THE TOTAL NUMBER OF ITEMS WE     CL**2
02504 *    HAVE ON OUR LIST AND SHOW THE NUMBERS ASSOCIATED WITH THE       CL**2
02505 *    FIRST AND LAST ITEMS ON CURRENT PAGE.  THIS WILL HELP THE       CL**2
02506 *    USER DETERMINE HOW FAR THEY ARE INTO THE LIST.                  CL**2
02507 ******************************************************************   CL**2
02508 *                                                                    CL**2
02509      IF MB137-NUMBER-OF-ITEMS-READ > +0                              CL**2
02510          MOVE MB137-ITEM-AT-TOP-OF-PANEL                             CL**2
02511                              TO  PV-DISPLAY5                         CL**2
02512      ELSE                                                            CL**2
02513          MOVE ZERO           TO  PV-DISPLAY5                         CL**2
02514      END-IF.                                                         CL**2
02515      MOVE PV-DISPLAY5        TO  ABEGITMO.                           CL**2
02516 *                                                                    CL**2
02517      MOVE DP015-GREEN        TO  ABEGITMC.                           CL**2
02518      MOVE DP015-UNDERLINE    TO  ABEGITMH.                           CL**2
02519      MOVE DP015-UNP-NUM-BRT-MDT                                      CL**2
02520                              TO  ABEGITMA.                           CL**2
02521 *                                                                    CL**2
02522      COMPUTE PV-ENDING-ITEM-ON-PANEL =                               CL**2
02523          (MB137-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.      CL**2
02524 *                                                                    CL**2
02525      IF PV-ENDING-ITEM-ON-PANEL < MB137-MAX-DB-ITEMS                 CL**2
02526          MOVE PV-ENDING-ITEM-ON-PANEL  TO  PV-DISPLAY5               CL**2
02527      ELSE                                                            CL**2
02528          MOVE MB137-MAX-DB-ITEMS       TO  PV-DISPLAY5               CL**2
02529      END-IF.                                                         CL**2
02530      MOVE PV-DISPLAY5        TO  AENDITMO.                           CL**2
02531 *                                                                    CL**2
02532      MOVE MB137-MAX-DB-ITEMS                                         CL**2
02533                              TO  PV-DISPLAY5.                        CL**2
02534      MOVE PV-DISPLAY5        TO  ATOTITMO.                           CL**2
02535 *                                                                    CL**2
02536  EJECT                                                               CL**2
02537                                                                      CL**2
02538  I800-SET-CURSOR-POSITION.                                           CL**2
02539 ******************************************************************   CL**2
02540 *    IF NO ITEMS WERE READ FROM THE DATA BASE, POINT THE CURSOR      CL**2
02541 *    TO THE COMMAND LINE, OTHERWISE POINT THE CURSOR TO ONE OF       CL**2
02542 *    THE SELECTION ENTRIES.                                          CL**2
02543 ******************************************************************   CL**2
02544 *                                                                    CL**2
02545      IF MB137-NUMBER-OF-ITEMS-READ = +0                              CL**2
02546      AND DP020-MSG-NUMBER NOT NUMERIC                                CL**2
02547          MOVE -1               TO  ANAVCMDL                          CL**2
02548          MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                  CL**2
02549          SET DP020-MSG-WARNING TO  TRUE                              CL**2
02550      ELSE                                                            CL**2
02551 *                                                                    CL**2
02552          IF (PS-CURSOR-NOT-POSITIONED) OR                            CL**2
02553             (PS-WARNING)               OR                            CL**2
02554             (PS-INFORMATIONAL)                                       CL**2
02555              PERFORM J200-FIND-LAST-SELECTION                        CL**2
02556          END-IF                                                      CL**2
02557      END-IF.                                                         CL**2
02558 *                                                                    CL**2
02559  EJECT                                                               CL**2
02560                                                                      CL**2
02561  J100-PROCESS-ITEMS.                                                 CL**2
02562 ******************************************************************   CL**2
02563 *    PROCESS EACH ITEM IN THE ARRAY AND MOVE IT TO THE MAP.          CL**2
02564 *    FILL THE MAP UNTIL WE HAVE REACHED THE MAXIMUM NUMBER OF        CL**2
02565 *    MAP ENTRIES.                                                    CL**2
02566 ******************************************************************   CL**2
02567 *                                                                    CL**2
02568      IF (PV-ITEM-IN-USE < MB137-NUMBER-OF-ITEMS-READ) OR             CL**2
02569         (PV-ITEM-IN-USE = MB137-NUMBER-OF-ITEMS-READ)                CL**2
02570                                                                      CL**2
02571           PERFORM K100-SET-SUBSCRIPTS                                CL**2
02572           MOVE DP015-UNP-ALP-BRT-MDT                                 CL**2
02573                        TO  MBKM137-SELECTA(PS-SUB)                   CL**2
02574                                                                      CL**2
02575           PERFORM K150-VALIDATE-SELECTIONS                           CL**2
02576 *                                                                    CL**2
02577           MOVE MB007Q-REC-ACTION (MB137-BLK-SUB MB137-ITEM-SUB)      CL**2
02578                                TO  MBKM137-ACTION        (PS-SUB)    CL**2
02579 *                                                                    CL**2
02580           MOVE MB007Q-SELECTED-SW (MB137-BLK-SUB MB137-ITEM-SUB)     CL**2
02581                                TO  MBKM137-SELECT        (PS-SUB)    CL**2
02582 *                                                                    CL**2
02583           MOVE MB007Q-WKR-LNAME  (MB137-BLK-SUB MB137-ITEM-SUB)      CL**2
02584                                TO  MBKM137-WKR-LNAME     (PS-SUB)    CL**2
02585 *                                                                    CL**2
02586           MOVE MB007Q-WKR-FNAME  (MB137-BLK-SUB MB137-ITEM-SUB)      CL**2
02587                                TO  MBKM137-WKR-FNAME     (PS-SUB)    CL**2
02588 *                                                                    CL**2
02589           MOVE MB007Q-WKR-UID-NBR (MB137-BLK-SUB MB137-ITEM-SUB)     CL**2
02590                                TO  MBKM137-WKR-UID-NBR   (PS-SUB)    CL**2
02591 *                                                                    CL**2
02592           MOVE DP015-RED       TO  MBKM137-ACTIONC       (PS-SUB)    CL**2
02593           MOVE DP015-BLUE      TO  MBKM137-WKR-LNAMEC    (PS-SUB)    CL**2
02594                                    MBKM137-WKR-FNAMEC    (PS-SUB)    CL**2
02595                                    MBKM137-WKR-UID-NBRC  (PS-SUB)    CL**2
02596                                                                      CL**2
02597      ELSE                                                            CL**2
02598 *      (REMAINING LIST ENTRIES SHOULD BE SET TO EMPTY)               CL**2
02599                                                                      CL**2
02600           MOVE DP015-ASK-DRK-OFF                                     CL**2
02601                                TO  MBKM137-SELECTA       (PS-SUB)    CL**2
02602           MOVE SPACES          TO  MBKM137-SELECT        (PS-SUB)    CL**2
02603                                    MBKM137-ACTION        (PS-SUB)    CL**2
02604                                    MBKM137-WKR-LNAME     (PS-SUB)    CL**2
02605                                    MBKM137-WKR-FNAME     (PS-SUB)    CL**2
02606                                    MBKM137-WKR-UID-NBR   (PS-SUB)    CL**2
02607      END-IF.                                                         CL**2
02608                                                                      CL**2
02609      ADD +1 TO PV-ITEM-IN-USE.                                       CL**2
02610      ADD +1 TO PS-SUB.                                               CL**2
02611 *                                                                    CL**2
02612  EJECT                                                               CL**2
02613                                                                      CL**2
02614  J200-FIND-LAST-SELECTION.                                           CL**2
02615 ******************************************************************   CL**2
02616 *    FIND THE LAST SELECTION ENTRY IN THE MAP THAT IS NOT            CL**2
02617 *    SPACES OR LOW VALUES AND POINT THE CURSOR TO THIS ENTRY.        CL**2
02618 *    IF ALL ENTRIES ARE SPACES OR LOW VALUES, POINT THE CURSOR       CL**2
02619 *    TO THE 1ST SELECTION ENTRY IN THE MAP.                          CL**2
02620 ******************************************************************   CL**2
02621 *                                                                    CL**2
02622      MOVE PC-ITEMS-PER-PANEL TO PS-SUB.                              CL**2
02623                                                                      CL**2
02624      SET PS-NO-SELECTION-FOUND TO TRUE.                              CL**2
02625                                                                      CL**2
02626      PERFORM                                                         CL**2
02627          UNTIL (PS-SUB = +1)                                         CL**2
02628             OR (PS-SELECTION-FOUND)                                  CL**2
02629 *                                                                    CL**2
02630          IF (MBKM137-SELECT(PS-SUB) NOT EQUAL SPACES                 CL**2
02631          AND MBKM137-SELECT(PS-SUB) NOT EQUAL LOW-VALUE)             CL**2
02632              SET PS-SELECTION-FOUND                                  CL**2
02633                                TO  TRUE                              CL**2
02634          ELSE                                                        CL**2
02635              SUBTRACT +1     FROM  PS-SUB                            CL**2
02636          END-IF                                                      CL**2
02637      END-PERFORM.                                                    CL**2
02638                                                                      CL**2
02639      MOVE -1                 TO  MBKM137-SELECTL(PS-SUB).            CL**2
02640 *                                                                    CL**2
02641  EJECT                                                               CL**2
02642                                                                      CL**2
02643  K100-SET-SUBSCRIPTS.                                                CL**2
02644 ******************************************************************   CL**2
02645 *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM     CL**2
02646 *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL    CL**2
02647 *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                      CL**2
02648 *                                                                    CL**2
02649 *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS       CL**2
02650 *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT        CL**2
02651 *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION      CL**2
02652 *    US IN THE 2ND BLOCK OF THE ARRAY.                               CL**2
02653 ******************************************************************   CL**2
02654 *                                                                    CL**2
02655      COMPUTE PS-ITEMS-SUB =                                          CL**2
02656          (PV-ITEM-IN-USE - MB007Q-LIST-ITEM-NBR(1 1)) + 1.           CL**2
02657                                                                      CL**2
02658      MOVE PS-ITEMS-SUB TO MB137-ITEM-SUB.                            CL**2
02659                                                                      CL**2
02660      IF MB137-ITEM-SUB > PC-ITEMS-PER-BLOCK                          CL**2
02661          SUBTRACT PC-ITEMS-PER-BLOCK FROM MB137-ITEM-SUB             CL**2
02662                                                                      CL**2
02663          MOVE PC-MAX-BLOCKS-IN-ARRAY TO MB137-BLK-SUB                CL**2
02664      ELSE                                                            CL**2
02665          MOVE +1                     TO MB137-BLK-SUB                CL**2
02666      END-IF.                                                         CL**2
02667 *                                                                    CL**2
02668  EJECT                                                               CL**2
02669                                                                      CL**2
02670  K150-VALIDATE-SELECTIONS.                                           CL**2
02671 ******************************************************************   CL**2
02672 *   VALIDATE SELECTION ENTRIES                                       CL**2
02673 ******************************************************************   CL**2
02674 *                                                                    CL**2
02675      IF (MB007Q-SELECT(MB137-BLK-SUB MB137-ITEM-SUB))                CL**2
02676         OR (MB007Q-NO-SELECT(MB137-BLK-SUB MB137-ITEM-SUB))          CL**2
02677           MOVE DP015-UNDERLINE TO MBKM137-SELECTH(PS-SUB)            CL**2
02678           MOVE DP015-GREEN     TO MBKM137-SELECTC(PS-SUB)            CL**2
02679      ELSE                                                            CL**2
02680 *                                                                    CL**2
02681          IF (MB007Q-BEGIN(MB137-BLK-SUB MB137-ITEM-SUB))             CL**2
02682             OR (MB007Q-END(MB137-BLK-SUB MB137-ITEM-SUB))            CL**2
02683               MOVE DP015-UNDERLINE   TO MBKM137-SELECTH(PS-SUB)      CL**2
02684               MOVE DP015-GREEN       TO MBKM137-SELECTC(PS-SUB)      CL**2
02685               IF (DP020-MSG-NUMBER  =  PC-TSYMSG-00051               CL**2
02686                                         OR PC-TSYMSG-00053 )         CL**2
02687 *                                                                    CL**2
02688 *                * UNPAIRED RANGE CHARACTER, SET WARNING             CL**2
02689 *                * ATTRIBUTES FOR RANGE CHARACTER:                   CL**2
02690                   MOVE DP015-REVERSE TO MBKM137-SELECTH(PS-SUB)      CL**2
02691                   MOVE DP015-YELLOW  TO MBKM137-SELECTC(PS-SUB)      CL**2
02692               END-IF                                                 CL**2
02693 *                                                                    CL**2
02694               IF (DP020-MSG-NUMBER  =  PC-TSYMSG-00054               CL**2
02695                      AND MB007Q-BEGIN ( MB137-BLK-SUB                CL**2
02696                                         MB137-ITEM-SUB ) )           CL**2
02697 *                                                                    CL**2
02698 *                * TWO OR MORE START-OF-RANGE CHARACTERS, SET        CL**2
02699 *                * ATTRIBUTES FOR START-OF-RANGE CHARACTERS:         CL**2
02700                   MOVE DP015-REVERSE TO MBKM137-SELECTH(PS-SUB)      CL**2
02701                   MOVE DP015-RED     TO MBKM137-SELECTC(PS-SUB)      CL**2
02702               END-IF                                                 CL**2
02703 *                                                                    CL**2
02704               IF (DP020-MSG-NUMBER  =  PC-TSYMSG-00055               CL**2
02705                      AND MB007Q-END ( MB137-BLK-SUB                  CL**2
02706                                       MB137-ITEM-SUB ) )             CL**2
02707 *                                                                    CL**2
02708 *                * TWO OR MORE END-OF-RANGE CHARACTERS, SET          CL**2
02709 *                * ATTRIBUTES FOR END-OF-RANGE CHARACTERS:           CL**2
02710                   MOVE DP015-REVERSE TO MBKM137-SELECTH(PS-SUB)      CL**2
02711                   MOVE DP015-RED     TO MBKM137-SELECTC(PS-SUB)      CL**2
02712               END-IF                                                 CL**2
02713 *                                                                    CL**2
02714               IF  DP020-MSG-NUMBER  =  PC-TSYMSG-00052               CL**2
02715 *                * END-OF-RANGE PRECEDES START OF RANGE, SET         CL**2
02716 *                * ATTRIBUTES OF RANGE CHARACTERS:                   CL**2
02717                   MOVE DP015-REVERSE TO MBKM137-SELECTH(PS-SUB)      CL**2
02718                   MOVE DP015-RED     TO MBKM137-SELECTC(PS-SUB)      CL**2
02719               END-IF                                                 CL**2
02720 *                                                                    CL**2
02721          ELSE                                                        CL**2
02722               IF MB007Q-MAINTAINED                                   CL**2
02723                       (MB137-BLK-SUB MB137-ITEM-SUB)                 CL**2
02724               MOVE DP015-UNDERLINE   TO MBKM137-SELECTH(PS-SUB)      CL**2
02725               MOVE DP015-GREEN       TO MBKM137-SELECTC(PS-SUB)      CL**2
02726                                                                      CL**2
02727               IF MB007Q-SELECTED-SW                                  CL**2
02728                        (MB137-BLK-SUB MB137-ITEM-SUB) = 'D'          CL**2
02729                   MOVE 'DEL' TO MB007Q-REC-ACTION                    CL**2
02730                                 (MB137-BLK-SUB MB137-ITEM-SUB)       CL**2
02731               END-IF                                                 CL**2
02732                                                                      CL**2
02733               IF MB007Q-SELECTED-SW                                  CL**2
02734                        (MB137-BLK-SUB MB137-ITEM-SUB) = 'I'          CL**2
02735                   MOVE 'INQ' TO MB007Q-REC-ACTION                    CL**2
02736                                 (MB137-BLK-SUB MB137-ITEM-SUB)       CL**2
02737               END-IF                                                 CL**2
02738                                                                      CL**2
02739               IF MB007Q-SELECTED-SW                                  CL**2
02740                        (MB137-BLK-SUB MB137-ITEM-SUB) = 'U'          CL**2
02741                   MOVE 'UPD' TO MB007Q-REC-ACTION                    CL**2
02742                                 (MB137-BLK-SUB MB137-ITEM-SUB)       CL**2
02743               END-IF                                                 CL**2
02744                                                                      CL**2
02745               IF MB007Q-MAINTAINED (MB137-BLK-SUB MB137-ITEM-SUB)    CL**2
02746                   MOVE SPACE TO MB007Q-SELECTED-SW                   CL**2
02747                                 (MB137-BLK-SUB MB137-ITEM-SUB)       CL**2
02748                   SET MB007Q-BLOCK-MODIFIED(MB137-BLK-SUB) TO TRUE   CL**2
02749                   SUBTRACT +1 FROM MB007-NUMBER-OF-SELECTED-ITEMS    CL**2
02750               END-IF                                                 CL**2
02751 *                                                                    CL**2
02752          END-IF                                                      CL**2
02753 *                                                                    CL**2
02754      END-IF.                                                         CL**2
02755 *                                                                    CL**2
02756  EJECT                                                               CL**2
02757                                                                      CL**2
02758  L100-FORMAT-WORKER-RECORD.                                          CL**2
02759 ******************************************************************   CL**2
02760 *    FORMAT THE COBOL DCLGEN FIELDS FOR THE TWORKER TABLE            CL**2
02761 ******************************************************************   CL**2
02762                                                                      CL**2
02763      MOVE ZEROS               TO MB137-MAX-DB-ITEMS.                 CL**2
02764                                                                      CL**2
02765                                                                      CL**2
02766      MOVE PC-COMPANY          TO WORKER-OPERCO-NBR.                  CL**2
02767                                                                      CL**2
02768                                                                      CL**2
02769      IF MB007-USERID = SPACES OR                                     CL**2
02770         MB007-USERID-1ST = '*'                                       CL**2
02771          MOVE '%%%%%%%%'      TO MB137-USERID                        CL**2
02772      ELSE                                                            CL**2
02773          MOVE MB007-USERID    TO MB137-USERID                        CL**2
02774      END-IF.                                                         CL**2
02775                                                                      CL**2
02776 *    ** REPLACE OTHER WILD CARD CHARACTERS WITH % **                 CL**2
02777                                                                      CL**2
02778      INSPECT MB137-USERID                                            CL**2
02779         REPLACING ALL ' ' BY '%'                                     CL**2
02780         AFTER INITIAL '*'.                                           CL**2
02781                                                                      CL**2
02782      INSPECT MB137-USERID                                            CL**2
02783         REPLACING ALL '*' BY '%'.                                    CL**2
02784                                                                      CL**2
02785                                                                      CL**2
02786      IF  MB137-1ST-TIME-IN                                           CL**2
02787                                                                      CL**2
02788          IF  MB007-LAST-NAME = SPACES OR                             CL**2
02789              MB007-LNAME-1ST = '*'                                   CL**2
02790               MOVE LOW-VALUES  TO MB137-BEGIN-LNAME                  CL**2
02791               MOVE HIGH-VALUES TO MB137-END-LNAME                    CL**2
02792          ELSE                                                        CL**2
02793              MOVE MB007-LAST-NAME TO MB137-BEGIN-LNAME               CL**2
02794                                      MB137-END-LNAME                 CL**2
02795              INSPECT MB137-BEGIN-LNAME                               CL**2
02796                 REPLACING ALL ' ' BY LOW-VALUES                      CL**2
02797                 AFTER INITIAL '*'                                    CL**2
02798              INSPECT MB137-BEGIN-LNAME                               CL**2
02799                 REPLACING ALL '*' BY LOW-VALUES                      CL**2
02800                                                                      CL**2
02801              INSPECT MB137-END-LNAME                                 CL**2
02802                 REPLACING ALL ' ' BY HIGH-VALUES                     CL**2
02803                 AFTER INITIAL '*'                                    CL**2
02804              INSPECT MB137-END-LNAME                                 CL**2
02805                 REPLACING ALL '*' BY HIGH-VALUES                     CL**2
02806                                                                      CL**2
02807 *    ELSE                                                            CL**2
02808 *       ** ATLEAST 1 DATABASE RECORD HAS BEEN READ    **             CL**2
02809 *       ** BECAUSE THE LAST, LAST NAME READ, IS SAVED **             CL**2
02810 *       CONTINUE                                                     CL**2
02811                                                                      CL**2
02812      END-IF.                                                         CL**2
02813                                                                      CL**2
02814                                                                      CL**2
02815      MOVE -1                  TO MB137-WORKER-NBR.                   CL**2
02816      MOVE LOW-VALUES          TO MB137-LAST-FNAME-FETCHED.           CL**2
02817                                                                      CL**2
02818                                                                      CL**2
02819 *    ** DETERMINE THE TOTAL NUMBER OF RECORDS IN   **                CL**2
02820 *    ** THE CURSOR, FOR THE LIST                   **                CL**2
02821                                                                      CL**2
02822      EXEC SQL                                                        CL**2
02823           SELECT COUNT(*)                                            CL**2
02824           INTO  :MB137-MAX-DB-ITEMS                                  CL**2
02825           FROM   TWORKER                                             CL**2
02826           WHERE                                                      CL**2
02827              ( ( LAST_NAME BETWEEN :MB137-BEGIN-LNAME                CL**2
02828                                AND :MB137-END-LNAME   )              CL**2
02829                AND  UID_NBR  LIKE  :MB137-USERID        )            CL**2
02830      END-EXEC.                                                       CL**2
02831                                                                      CL**2
02832                                                                      CL**2
02833      EJECT                                                           CL**2
02834                                                                      CL**2
02835  L200-OPEN-WKR-CURSOR.                                               CL**2
02836 ******************************************************************   CL**2
02837 *   OPEN THE WORKER TABLE CURSOR TO PRODUCE THE LIST.                CL**2
02838 ******************************************************************   CL**2
02839 *                                                                    CL**2
02840      PERFORM                                                         CL**2
02841          WITH TEST AFTER                                             CL**2
02842          VARYING PV-SQL-WKR-SUB                                      CL**2
02843          FROM 1 BY 1                                                 CL**2
02844          UNTIL ( PV-SQL-WKR-SUB > PC-MAX-RETRIES                     CL**2
02845                  OR SQLCODE = 0 )                                    CL**2
02846                                                                      CL**2
02847          EXEC SQL                                                    CL**2
02848              OPEN WORKER-RECS                                        CL**2
02849          END-EXEC                                                    CL**2
02850                                                                      CL**2
02851          EVALUATE TRUE                                               CL**2
02852                                                                      CL**2
02853              WHEN SQLCODE = 0                                        CL**2
02854 *              ** SUCCESSFULLY OPENED **                             CL**2
02855              WHEN SQLCODE = -904                                     CL**2
02856 *              ** UNAVAILABLE RESOURCE **                            CL**2
02857              WHEN SQLCODE = -911                                     CL**2
02858 *              ** ROLLBACK HAS OCCURED DUE TO DEADLOCK OR TIME **    CL**2
02859                                                                      CL**2
02860                    CONTINUE                                          CL**2
02861                                                                      CL**2
02862              WHEN SQLWARN NOT = SPACES                               CL**2
02863              WHEN SQLCODE NOT = ZERO                                 CL**2
02864                                                                      CL**2
02865 *              ** PERFORM ABEND **                                   CL**2
02866                  SET DP013-LOGIC-ABEND TO TRUE                       CL**2
02867                  SET DP013-NO-ROLLBACK TO TRUE                       CL**2
02868                  MOVE 'L200-OPEN-WKR-CURSOR' TO                      CL**2
02869                       DP013-PARAGRAPH                                CL**2
02870                  MOVE SQLCODE TO PM-SQLCODE-2                        CL**2
02871                  MOVE PM-PROGRAM-MESSAGE-2 TO                        CL**2
02872                       DP013-MESSAGE-TEXT(1)                          CL**2
02873                  PERFORM DP013-0000-PROCESS-ABEND                    CL**2
02874                                                                      CL**2
02875          END-EVALUATE                                                CL**2
02876                                                                      CL**2
02877      END-PERFORM.                                                    CL**2
02878                                                                      CL**2
02879      IF PV-SQL-WKR-SUB > PC-MAX-RETRIES                              CL**2
02880 *       ** MAX RETRIES EXCEEDED, PERFORM ABEND **                    CL**2
02881           SET DP013-LOGIC-ABEND TO TRUE                              CL**2
02882           SET DP013-NO-ROLLBACK TO TRUE                              CL**2
02883           MOVE 'L200-OPEN-WKR-CURSOR' TO                             CL**2
02884                 DP013-PARAGRAPH                                      CL**2
02885           MOVE SQLCODE TO PM-SQLCODE-2                               CL**2
02886           MOVE PM-PROGRAM-MESSAGE-2 TO                               CL**2
02887                 DP013-MESSAGE-TEXT(1)                                CL**2
02888           PERFORM DP013-0000-PROCESS-ABEND                           CL**2
02889      END-IF.                                                         CL**2
02890 *                                                                    CL**2
02891  EJECT                                                               CL**2
02892                                                                      CL**2
02893  L300-FETCH-WORKER-DATA.                                             CL**2
02894 ******************************************************************   CL**2
02895 *    EXECUTE THE WORKER TABLE SELECTION CURSOR                   *   CL**2
02896 *    (ONCE FOR EACH RECORD TO BE RETRIEVED)                      *   CL**2
02897 *    USING THE VALUES IN THE PV-WORKER-... FIELDS                *   CL**2
02898 ******************************************************************   CL**2
02899 *                                                                    CL**2
02900      PERFORM                                                         CL**2
02901          WITH TEST AFTER                                             CL**2
02902          VARYING PV-SQL-WKR-SUB                                      CL**2
02903          FROM 1 BY 1                                                 CL**2
02904          UNTIL ( PV-SQL-WKR-SUB > PC-MAX-RETRIES                     CL**2
02905                  OR SQLCODE = 0                                      CL**2
02906                  OR SQLCODE = +100 )                                 CL**2
02907                                                                      CL**2
02908          EXEC SQL                                                    CL**2
02909              FETCH   WORKER-RECS                                     CL**2
02910               INTO                                                   CL**2
02911                      :WORKER-OPERCO-NBR                              CL**2
02912                    , :WORKER-NBR                                     CL**2
02913                    , :WORKER-UID-NBR                                 CL**2
02914                    , :WORKER-LAST-NAME                               CL**2
02915                    , :WORKER-FIR-NAME                                CL**2
02916          END-EXEC                                                    CL**2
02917                                                                      CL**2
02918          EVALUATE TRUE                                               CL**2
02919                                                                      CL**2
02920              WHEN SQLCODE = +100                                     CL**2
02921 *              ** ROW NOT FOUND FOR FETCH **                         CL**2
02922                SET MB137-NO-ITEMS-LEFT-ON-DB TO TRUE                 CL**2
02923                                                                      CL**2
02924                IF MB137-NUMBER-OF-ITEMS-READ = +0                    CL**2
02925 *                ** WHEN NO ITEMS ARE FOUND FOR CRITERIA ***         CL**2
02926                    MOVE PC-TSYMSG-00050 TO DP020-MSG-NUMBER          CL**2
02927                    SET DP020-MSG-FATAL  TO TRUE                      CL**2
02928                    MOVE DP016-PF3       TO DP020-SRC-AID             CL**2
02929                    PERFORM E300-NAVIGATE                             CL**2
02930                END-IF                                                CL**2
02931                                                                      CL**2
02932              WHEN SQLCODE = -904                                     CL**2
02933 *              ** UNAVAILABLE RESOURCE **                            CL**2
02934              WHEN SQLCODE = -911                                     CL**2
02935 *              ** ROLLBACK HAS OCCURED DUE TO DEADLOCK OR TIME **    CL**2
02936              WHEN SQLCODE = -913                                     CL**2
02937 *              ** UNSUCCESSFUL WORK DUE TO DEADLOCK OR TIMEOUT **    CL**2
02938                                                                      CL**2
02939              WHEN SQLCODE = 0                                        CL**2
02940                CONTINUE                                              CL**2
02941                                                                      CL**2
02942              WHEN SQLWARN NOT = SPACES                               CL**2
02943              WHEN SQLCODE NOT = ZERO                                 CL**2
02944 *              ** PERFORM ABEND **                                   CL**2
02945                  SET DP013-LOGIC-ABEND TO TRUE                       CL**2
02946                  SET DP013-NO-ROLLBACK TO TRUE                       CL**2
02947                  MOVE 'L300-FETCH-WORKER-DATA' TO                    CL**2
02948                       DP013-PARAGRAPH                                CL**2
02949                  MOVE SQLCODE TO PM-SQLCODE-2                        CL**2
02950                  MOVE PM-PROGRAM-MESSAGE-2 TO                        CL**2
02951                       DP013-MESSAGE-TEXT(1)                          CL**2
02952                  PERFORM DP013-0000-PROCESS-ABEND                    CL**2
02953                                                                      CL**2
02954          END-EVALUATE                                                CL**2
02955                                                                      CL**2
02956      END-PERFORM.                                                    CL**2
02957                                                                      CL**2
02958      IF DP020-MSG-FATAL                                              CL**2
02959         SET PS-ERROR     TO TRUE                                     CL**2
02960         MOVE -1          TO ANAVCMDL                                 CL**2
02961      END-IF.                                                         CL**2
02962                                                                      CL**2
02963      IF PV-SQL-WKR-SUB > PC-MAX-RETRIES                              CL**2
02964 *       ** MAX RETRIES EXCEEDED, PERFORM ABEND **                    CL**2
02965           SET DP013-LOGIC-ABEND TO TRUE                              CL**2
02966           SET DP013-NO-ROLLBACK TO TRUE                              CL**2
02967           MOVE 'L300-FETCH-WORKER-DATA' TO                           CL**2
02968                 DP013-PARAGRAPH                                      CL**2
02969           MOVE SQLCODE TO PM-SQLCODE-2                               CL**2
02970           MOVE PM-PROGRAM-MESSAGE-2 TO                               CL**2
02971                 DP013-MESSAGE-TEXT(1)                                CL**2
02972           PERFORM DP013-0000-PROCESS-ABEND                           CL**2
02973      END-IF.                                                         CL**2
02974 *                                                                    CL**2
02975  EJECT                                                               CL**2
02976                                                                      CL**2
02977  L350-INSURE-NEW-ROW-FETCHED.                                        CL**2
02978 ******************************************************************   CL**2
02979 *   PROCESS FETCHED ROW, INSURE IT WAS NOT PREVIOUSLY FETCHED        CL**2
02980 ******************************************************************   CL**2
02981 *                                                                    CL**2
02982      SET PS-PREV-ROW-FETCHED TO TRUE.                                CL**2
02983                                                                      CL**2
02984      IF WORKER-LAST-NAME > MB137-BEGIN-LNAME                         CL**2
02985          SET PS-NEW-ROW-FETCHED TO TRUE                              CL**2
02986      ELSE                                                            CL**2
02987 *       ** LAST NAME IS THE SAME AS THE LAST FETCHED ROW **          CL**2
02988                                                                      CL**2
02989         IF WORKER-FIR-NAME > MB137-LAST-FNAME-FETCHED                CL**2
02990             SET PS-NEW-ROW-FETCHED TO TRUE                           CL**2
02991         ELSE                                                         CL**2
02992             IF WORKER-FIR-NAME = MB137-LAST-FNAME-FETCHED            CL**2
02993 *           ** FIRST NAME THE SAME AS THE LAST FETCHED ROW **        CL**2
02994                                                                      CL**2
02995                 IF WORKER-NBR > MB137-WORKER-NBR                     CL**2
02996                     SET PS-NEW-ROW-FETCHED TO TRUE                   CL**2
02997                 ELSE                                                 CL**2
02998 *                 ** COMPLETE ROW THE SAME AS LAST FETCHED ROW **    CL**2
02999                     SET PS-PREV-ROW-FETCHED TO TRUE                  CL**2
03000                 END-IF                                               CL**2
03001                                                                      CL**2
03002             ELSE                                                     CL**2
03003 *            ** FIRST NAME < LAST WORKER FETCHED, ALREADY USED **    CL**2
03004                SET PS-PREV-ROW-FETCHED TO TRUE                       CL**2
03005             END-IF                                                   CL**2
03006                                                                      CL**2
03007          END-IF                                                      CL**2
03008      END-IF.                                                         CL**2
03009 *                                                                    CL**2
03010  EJECT                                                               CL**2
03011                                                                      CL**2
03012  L400-CLOSE-WKR-CURSOR.                                              CL**2
03013 ******************************************************************   CL**2
03014 *   CLOSE THE WORKER TABLE CURSOR                                    CL**2
03015 ******************************************************************   CL**2
03016 *                                                                    CL**2
03017      PERFORM                                                         CL**2
03018          WITH TEST AFTER                                             CL**2
03019          VARYING PV-SQL-WKR-SUB                                      CL**2
03020          FROM 1 BY 1                                                 CL**2
03021          UNTIL ( PV-SQL-WKR-SUB > PC-MAX-RETRIES                     CL**2
03022                  OR SQLCODE = 0 )                                    CL**2
03023                                                                      CL**2
03024          EXEC SQL                                                    CL**2
03025              CLOSE WORKER-RECS                                       CL**2
03026          END-EXEC                                                    CL**2
03027                                                                      CL**2
03028          EVALUATE TRUE                                               CL**2
03029                                                                      CL**2
03030              WHEN SQLCODE = 0                                        CL**2
03031 *              ** SUCCESSFULLY CLOSED **                             CL**2
03032              WHEN SQLCODE = -904                                     CL**2
03033 *              ** UNAVAILABLE RESOURCE **                            CL**2
03034              WHEN SQLCODE = -911                                     CL**2
03035 *              ** ROLLBACK HAS OCCURED DUE TO DEADLOCK OR TIME **    CL**2
03036                                                                      CL**2
03037                    CONTINUE                                          CL**2
03038                                                                      CL**2
03039              WHEN SQLWARN NOT = SPACES                               CL**2
03040              WHEN SQLCODE NOT = ZERO                                 CL**2
03041                                                                      CL**2
03042 *              ** PERFORM ABEND **                                   CL**2
03043                  SET DP013-LOGIC-ABEND TO TRUE                       CL**2
03044                  SET DP013-NO-ROLLBACK TO TRUE                       CL**2
03045                  MOVE 'L400-CLOSE-WKR-CURSOR' TO                     CL**2
03046                       DP013-PARAGRAPH                                CL**2
03047                  MOVE SQLCODE TO PM-SQLCODE-2                        CL**2
03048                  MOVE PM-PROGRAM-MESSAGE-2 TO                        CL**2
03049                       DP013-MESSAGE-TEXT(1)                          CL**2
03050                  PERFORM DP013-0000-PROCESS-ABEND                    CL**2
03051                                                                      CL**2
03052          END-EVALUATE                                                CL**2
03053                                                                      CL**2
03054      END-PERFORM.                                                    CL**2
03055                                                                      CL**2
03056      IF PV-SQL-WKR-SUB > PC-MAX-RETRIES                              CL**2
03057 *       ** MAX RETRIES EXCEEDED, PERFORM ABEND **                    CL**2
03058           SET DP013-LOGIC-ABEND TO TRUE                              CL**2
03059           SET DP013-NO-ROLLBACK TO TRUE                              CL**2
03060           MOVE 'L400-CLOSE-WKR-CURSOR' TO                            CL**2
03061                 DP013-PARAGRAPH                                      CL**2
03062           MOVE SQLCODE TO PM-SQLCODE-2                               CL**2
03063           MOVE PM-PROGRAM-MESSAGE-2 TO                               CL**2
03064                 DP013-MESSAGE-TEXT(1)                                CL**2
03065           PERFORM DP013-0000-PROCESS-ABEND                           CL**2
03066      END-IF.                                                         CL**2
03067 *                                                                    CL**2
03068  EJECT                                                               CL**2
03069                                                                      CL**2
03070  Z050-DELETE-TEMP-STORAGE.                                           CL**2
03071 ******************************************************************   CL**2
03072 *    DELETE THE TEMPORARY STORAGE QUEUE.                             CL**2
03073 ******************************************************************   CL**2
03074 *                                                                    CL**2
03075      EXEC CICS                                                       CL**2
03076          DELETEQ TS                                                  CL**2
03077          QUEUE(MB007-LIST-QUEUE-NAME)                                CL**2
03078          RESP(PV-CICS-RESPONSE)                                      CL**2
03079      END-EXEC.                                                       CL**2
03080                                                                      CL**2
03081      IF (PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)) AND                 CL**2
03082         (PV-CICS-RESPONSE NOT = DFHRESP(QIDERR))                     CL**2
03083          MOVE PV-CICS-RESPONSE TO PM-RESP-23                         CL**2
03084                                                                      CL**2
03085          SET DP013-LOGIC-ABEND TO TRUE                               CL**2
03086          SET DP013-NO-ROLLBACK TO TRUE                               CL**2
03087                                                                      CL**2
03088          MOVE 'Z050-DELETE-TEMP-STORAGE' TO DP013-PARAGRAPH          CL**2
03089          MOVE PM-PROGRAM-MESSAGE-23      TO DP013-MESSAGE-TEXT(1)    CL**2
03090                                                                      CL**2
03091          PERFORM DP013-0000-PROCESS-ABEND                            CL**2
03092      END-IF.                                                         CL**2
03093                                                                      CL**2
03094      MOVE +0 TO MB137-HIGHEST-BLOCK-WRITTEN.                         CL**2
03095      MOVE +0 TO MB137-NUMBER-OF-ITEMS-READ.                          CL**2
03096 *                                                                    CL**2
03097      MOVE SPACES TO MB007-LIST-QUEUE-NAME.                           CL**2
03098 *                                                                    CL**2
03099  EJECT                                                               CL**2
03100                                                                      CL**2
03101  Z100-READ-TEMP-STORAGE.                                             CL**2
03102 ******************************************************************   CL**2
03103 *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.             CL**2
03104 ******************************************************************   CL**2
03105 *                                                                    CL**2
03106      EXEC CICS                                                       CL**2
03107          READQ TS                                                    CL**2
03108          QUEUE(MB007-LIST-QUEUE-NAME)                                CL**2
03109          INTO(MB137-BLOCK-ENTRIES(MB137-BLK-SUB))                    CL**2
03110          LENGTH(MB007-LIST-QUEUE-LENGTH)                             CL**2
03111          ITEM(PV-BLOCK-NUMBER)                                       CL**2
03112          RESP(PV-CICS-RESPONSE)                                      CL**2
03113      END-EXEC.                                                       CL**2
03114 *                                                                    CL**2
03115      IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                       CL**2
03116          MOVE PV-CICS-RESPONSE TO  PM-RESP-24                        CL**2
03117          EXEC CICS                                                   CL**2
03118               DELETEQ TS                                             CL**2
03119               QUEUE(MB007-LIST-QUEUE-NAME)                           CL**2
03120               RESP(PV-CICS-RESPONSE)                                 CL**2
03121          END-EXEC                                                    CL**2
03122          SET DP013-LOGIC-ABEND TO  TRUE                              CL**2
03123          SET DP013-NO-ROLLBACK TO  TRUE                              CL**2
03124          MOVE 'Z100-READ-TEMP-STORAGE'                               CL**2
03125                                TO  DP013-PARAGRAPH                   CL**2
03126          MOVE PM-PROGRAM-MESSAGE-24                                  CL**2
03127                                TO  DP013-MESSAGE-TEXT(1)             CL**2
03128          PERFORM DP013-0000-PROCESS-ABEND                            CL**2
03129      END-IF.                                                         CL**2
03130                                                                      CL**2
03131      SET MB007Q-BLOCK-NOT-MODIFIED(MB137-BLK-SUB) TO TRUE.           CL**2
03132 *                                                                    CL**2
03133  EJECT                                                               CL**2
03134                                                                      CL**2
03135  Z150-WRITE-TEMP-STORAGE.                                            CL**2
03136 ******************************************************************   CL**2
03137 *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.          CL**2
03138 *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.        CL**2
03139 ******************************************************************   CL**2
03140 *                                                                    CL**2
03141      IF MB137-HIGHEST-BLOCK-WRITTEN = +0                             CL**2
03142          MOVE EIBTASKN         TO  DP020-SRC-TASK-NUMBER             CL**2
03143          MOVE EIBTASKN         TO  MB007-TASK-NUMBER                 CL**2
03144          MOVE EIBTRMID         TO  MB007-TERM-ID                     CL**2
03145 *                                                                    CL**2
03146 *        **  ENSURE THAT THE BLOCK WILL FUNCTION CORRECTLY   **      CL**2
03147 *        * FOR ACCESSING THE TS QUEUE 'MB007-LIST-QUEUE-NAME' *      CL**2
03148 *        * INTO AND FROM  'MB137-BLOCK-ENTRIES(MB137-BLK-SUB)'*      CL**2
03149 *                                                                    CL**2
03150          MOVE LENGTH OF MB137-BLOCK-ENTRIES (1)                      CL**2
03151                                TO  MB007-LIST-QUEUE-LENGTH           CL**2
03152      END-IF.                                                         CL**2
03153 *                                                                    CL**2
03154      MOVE MB007Q-LIST-ITEM-NBR(MB137-BLK-SUB 1)                      CL**2
03155                                TO  PV-LIST-ITEM-NUMBER.              CL**2
03156      COMPUTE PV-BLOCK-NUMBER =                                       CL**2
03157          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK).       CL**2
03158 *                                                                    CL**2
03159      IF (PV-BLOCK-NUMBER < MB137-HIGHEST-BLOCK-WRITTEN)              CL**2
03160      OR (PV-BLOCK-NUMBER = MB137-HIGHEST-BLOCK-WRITTEN)              CL**2
03161          IF  MB007Q-BLOCK-MODIFIED(MB137-BLK-SUB)                    CL**2
03162              EXEC CICS                                               CL**2
03163                  WRITEQ TS                                           CL**2
03164                  QUEUE(MB007-LIST-QUEUE-NAME)                        CL**2
03165                  FROM(MB137-BLOCK-ENTRIES(MB137-BLK-SUB))            CL**2
03166                  LENGTH(MB007-LIST-QUEUE-LENGTH)                     CL**2
03167                  ITEM(PV-BLOCK-NUMBER)                               CL**2
03168                  REWRITE                                             CL**2
03169                  RESP(PV-CICS-RESPONSE)                              CL**2
03170              END-EXEC                                                CL**2
03171 *                                                                    CL**2
03172              IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)              CL**2
03173                  MOVE PV-CICS-RESPONSE TO PM-RESP-9                  CL**2
03174                  EXEC CICS                                           CL**2
03175                      DELETEQ TS                                      CL**2
03176                      QUEUE(MB007-LIST-QUEUE-NAME)                    CL**2
03177                      RESP(PV-CICS-RESPONSE)                          CL**2
03178                  END-EXEC                                            CL**2
03179 *                                                                    CL**2
03180                  SET DP013-LOGIC-ABEND                               CL**2
03181                                TO  TRUE                              CL**2
03182                  SET DP013-NO-ROLLBACK                               CL**2
03183                                TO  TRUE                              CL**2
03184                  MOVE 'Z150-WRITE-TEMP-STORAGE'                      CL**2
03185                                TO  DP013-PARAGRAPH                   CL**2
03186                  MOVE PM-PROGRAM-MESSAGE-9                           CL**2
03187                                TO  DP013-MESSAGE-TEXT(1)             CL**2
03188                  PERFORM DP013-0000-PROCESS-ABEND                    CL**2
03189              END-IF                                                  CL**2
03190          END-IF                                                      CL**2
03191      ELSE                                                            CL**2
03192 *                                                                    CL**2
03193          COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                          CL**2
03194              MB137-HIGHEST-BLOCK-WRITTEN + 1                         CL**2
03195          IF  PV-BLOCK-NUMBER = PV-HIGHEST-BLOCK-WRITTEN              CL**2
03196              EXEC CICS                                               CL**2
03197                  WRITEQ TS                                           CL**2
03198                  QUEUE(MB007-LIST-QUEUE-NAME)                        CL**2
03199                  FROM(MB137-BLOCK-ENTRIES(MB137-BLK-SUB))            CL**2
03200                  LENGTH(MB007-LIST-QUEUE-LENGTH)                     CL**2
03201                  ITEM(PV-BLOCK-NUMBER)                               CL**2
03202                  RESP(PV-CICS-RESPONSE)                              CL**2
03203              END-EXEC                                                CL**2
03204 *                                                                    CL**2
03205              IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)              CL**2
03206                  MOVE PV-CICS-RESPONSE TO PM-RESP-10                 CL**2
03207                  EXEC CICS                                           CL**2
03208                      DELETEQ TS                                      CL**2
03209                      QUEUE(MB007-LIST-QUEUE-NAME)                    CL**2
03210                      RESP(PV-CICS-RESPONSE)                          CL**2
03211                  END-EXEC                                            CL**2
03212 *                                                                    CL**2
03213                  SET DP013-LOGIC-ABEND                               CL**2
03214                                TO  TRUE                              CL**2
03215                  SET DP013-NO-ROLLBACK                               CL**2
03216                                TO  TRUE                              CL**2
03217                  MOVE 'Z150-WRITE-TEMP-STORAGE'                      CL**2
03218                                TO  DP013-PARAGRAPH                   CL**2
03219                  MOVE PM-PROGRAM-MESSAGE-10                          CL**2
03220                                TO  DP013-MESSAGE-TEXT(1)             CL**2
03221                  PERFORM DP013-0000-PROCESS-ABEND                    CL**2
03222              END-IF                                                  CL**2
03223              ADD +1            TO  MB137-HIGHEST-BLOCK-WRITTEN       CL**2
03224          ELSE                                                        CL**2
03225              SET DP013-LOGIC-ABEND                                   CL**2
03226                                TO  TRUE                              CL**2
03227              SET DP013-NO-ROLLBACK                                   CL**2
03228                                TO  TRUE                              CL**2
03229              MOVE 'Z150-WRITE-TEMP-STORAGE'                          CL**2
03230                                TO  DP013-PARAGRAPH                   CL**2
03231              MOVE PV-BLOCK-NUMBER                                    CL**2
03232                                TO  PM-BLOCK-NUMBER                   CL**2
03233              MOVE PM-PROGRAM-MESSAGE-11                              CL**2
03234                                TO  DP013-MESSAGE-TEXT(1)             CL**2
03235              PERFORM DP013-0000-PROCESS-ABEND                        CL**2
03236          END-IF                                                      CL**2
03237      END-IF.                                                         CL**2
03238                                                                      CL**2
03239      SET MB007Q-BLOCK-NOT-MODIFIED(MB137-BLK-SUB) TO TRUE.           CL**2
03240 *                                                                    CL**2
03241  EJECT                                                               CL**2
03242                                                                      CL**2
03243 ******************************************************************   CL**2
03244 *    FILL IN SCREEN HEADER MODULE                                    CL**2
03245 ******************************************************************   CL**2
03246                                                                      CL**2
03247      COPY DPPD002.                                                   CL**2
03248  EJECT                                                               CL**2
03249 ******************************************************************   CL**2
03250 *    RETURN TO CICS MODULE                                           CL**2
03251 ******************************************************************   CL**2
03252                                                                      CL**2
03253      COPY DPPD003.                                                   CL**2
03254  EJECT                                                               CL**2
03255 ******************************************************************   CL**2
03256 *    FORMAT MESSAGE LINES MODULE                                     CL**2
03257 ******************************************************************   CL**2
03258                                                                      CL**2
03259      COPY DPPD005.                                                   CL**2
03260  EJECT                                                               CL**2
03261 ******************************************************************   CL**2
03262 *    GET PANEL MODULE                                                CL**2
03263 ******************************************************************   CL**2
03264                                                                      CL**2
03265      COPY DPPD007.                                                   CL**2
03266  EJECT                                                               CL**2
03267 ******************************************************************   CL**2
03268 *    WRITE PANEL MODULE                                              CL**2
03269 ******************************************************************   CL**2
03270                                                                      CL**2
03271      COPY DPPD008.                                                   CL**2
03272  EJECT                                                               CL**2
03273 ******************************************************************   CL**2
03274 *    TOGGLE THE FUNCTION KEY LINE MODULE                             CL**2
03275 ******************************************************************   CL**2
03276                                                                      CL**2
03277      COPY DPPD009.                                                   CL**2
03278  EJECT                                                               CL**2
03279 ******************************************************************   CL**2
03280 *    ABEND PROCESSOR MODULE                                          CL**2
03281 ******************************************************************   CL**2
03282                                                                      CL**2
03283      COPY DPPD013.                                                   CL**2
03284  EJECT                                                               CL**2
03285 ******************************************************************   CL**2
03286 *    CHECK COMMUNICATION AREA MODULE                                 CL**2
03287 ******************************************************************   CL**2
03288                                                                      CL**2
03289      COPY DPPD015.                                                   CL**2
03290  EJECT                                                               CL**2
03291 ******************************************************************   CL**2
03292 *    UPDATE TIME AND DATE MODULE                                     CL**2
03293 ******************************************************************   CL**2
03294                                                                      CL**2
03295      COPY DPPD017.                                                   CL**2
03296  EJECT                                                               CL**2
03297                                                                      CL**2
