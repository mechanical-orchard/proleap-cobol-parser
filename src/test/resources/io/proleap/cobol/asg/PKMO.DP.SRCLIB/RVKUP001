000100 IDENTIFICATION DIVISION.                                         00010011
000200                                                                  00020011
000300 PROGRAM-ID.             RVKUP001.                                00030011
000400 AUTHOR.                 DAN HINTZ.                               00040011
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050011
000600 DATE-WRITTEN.           NOVEMBER 2003.                           00060017
000700 DATE-COMPILED.                                                   00070011
000800                                                                  00080011
000900*********************************************************         00090011
001000* CHANGE THE STATUS OF PENDING MARKOUTS TO APPROVED.    *         00100011
001100* THIS WILL INVOLVE UPDATING DFCT_ORD_STAT_CDE TO AN    *         00110011
001200* 'A' ON TDFCTOR FOR MARKOUTS (DFCT_ORD_ID_CDE = 'M').  *         00120011
001300* THE CORRESPONDING ROW(S) ON TDFMEIT WILL ALSO NEED    *         00130011
001400* TO BE UPDATED, CHANGING MKOUT_ORD_STAT_CDE TO AN 'A'. *         00140011
001500* A REPORT FILE WILL BE CREATED WRITING THE LISTINGS    *         00150024
001600* THAT WERE UPDATED AS PART OF THIS PROCESS.            *         00160011
001700*********************************************************         00170011
001800*  CHANGE LOG.                                                    00180024
001900*  DATE         CHANGED BY      DESC                              00190024
002000*  -----------  --------------  ----------------------------------00200024
002100*  10/30/2011   C. STRODTHOFF - GENCO / RTV UPGRADE. ADD LOC LOGIC00210024
002200*                               CREATE NEW RPT FILE. REMOVE REPORT00220024
002300*                               PRJ ID 3219 - WR40134.            00230024
002301******************************************************************00230124
002302                                                                  00230211
002303******************************************************************00230324
002304 ENVIRONMENT DIVISION.                                            00230411
002305******************************************************************00230524
002306 CONFIGURATION SECTION.                                           00230611
002307                                                                  00230724
002308 SOURCE-COMPUTER.                        IBM-3090.                00230811
002309 OBJECT-COMPUTER.                        IBM-3090.                00230911
002310                                                                  00231024
002311 INPUT-OUTPUT SECTION.                                            00231111
002312                                                                  00231224
002320 FILE-CONTROL.                                                    00232024
002330                                                                  00233024
002400     SELECT LA-LISTING-APPROVAL-RPT-FILE                          00240011
002500         ASSIGN TO OUT01.                                         00250024
002600                                                                  00260011
002700******************************************************************00270024
002800 DATA DIVISION.                                                   00280011
002810******************************************************************00281024
002900                                                                  00290011
002910 FILE SECTION.                                                    00291024
002920                                                                  00292024
003000 FD  LA-LISTING-APPROVAL-RPT-FILE                                 00300011
003100     RECORDING MODE IS F                                          00310011
003200     LABEL RECORDS ARE STANDARD                                   00320011
003300     BLOCK CONTAINS 0 RECORDS.                                    00330011
003400                                                                  00340011
003500 01  LA-LISTING-APPROVAL-RECORD       PIC  X(125).                00350024
003600                                                                  00360011
003601                                                                  00360124
003602******************************************************************00360224
003603 WORKING-STORAGE SECTION.                                         00360324
003604******************************************************************00360424
003800                                                                  00380011
003900***  LISTING STATUS UPDATE FILE LAYOUT                            00390024
004000     COPY RVRD062.                                                00400024
004100                                                                  00410024
010100 01  PS-SWITCHES.                                                 01010011
010200     05  PS-EOF-TDFCTOR-CSR-SW        PIC  X(01) VALUE 'N'.       01020024
010300         88  PS-EOF-TDFCTOR-CSR                  VALUE 'Y'.       01030024
010301     05  PS-TDFCTOR-UPD-SW            PIC  X(01) VALUE 'N'.       01030124
010302         88  PS-TDFCTOR-UPD-YES                  VALUE 'Y'.       01030224
010303         88  PS-TDFCTOR-UPD-NO                   VALUE 'N'.       01030324
010400*                                                                 01040011
010900 01  PV-PROGRAM-VARIABLES.                                        01090024
011320     05  PV-MARKOUT-COUNT             PIC S9(04) VALUE ZERO       01132024
011330                                                 COMP SYNC.       01133022
011333     05  PV-TDFCTOR-UPDATE-DETAIL     PIC S9(07) COMP-3           01133324
011334                                                 VALUE ZERO.      01133424
011335     05  PV-TDFCTOR-UPDATE-COUNT      PIC S9(07) COMP-3           01133524
011336                                                 VALUE ZERO.      01133624
011337     05  PV-TDFMEIT-UPDATE-COUNT      PIC S9(07) COMP-3           01133724
011338                                                 VALUE ZERO.      01133824
011339     05  PV-RVT-INSERT-COUNT          PIC S9(07) COMP-3           01133924
011340                                                 VALUE ZERO.      01134024
011341     05  PV-RPT-RECS-WRITTEN          PIC  9(09) VALUE ZERO.      01134124
011342     05  PV-PARAGRAPH                 PIC  X(30) VALUE SPACES.    01134224
011350     05  PV-DFCT-ORD-ID-DISP          PIC  X(12) VALUE SPACES.    01135025
011400     05  PV-DB2-FUNCTION              PIC  X(30) VALUE SPACES.    01140024
011500     05  PV-DB2-TABLE-NAME            PIC  X(30) VALUE SPACES.    01150024
011601     05  PV-DB2-MESSAGE               PIC  X(79) VALUE SPACES.    01160124
011620     05  PV-SYSTEM-DATE.                                          01162024
011630         10  PV-SYSTEM-DATE-CCYY      PIC  9(04) VALUE ZERO.      01163024
011640         10  PV-SYSTEM-DATE-MM        PIC  9(02) VALUE ZERO.      01164024
011650         10  PV-SYSTEM-DATE-DD        PIC  9(02) VALUE ZERO.      01165024
011680*                                                                 01168024
011700     05  PV-CURRENT-DATE.                                         01170022
011710         10  PV-CURRENT-DATE-MM       PIC  X(02) VALUE SPACES.    01171024
011720         10  FILLER                   PIC  X(01) VALUE '/'.       01172024
011730         10  PV-CURRENT-DATE-DD       PIC  X(02) VALUE SPACES.    01173024
011740         10  FILLER                   PIC  X(01) VALUE '/'.       01174024
011750         10  PV-CURRENT-DATE-CCYY     PIC  X(04) VALUE SPACES.    01175024
011760     05  PV-DISP-NBR                  PIC Z,ZZZ,ZZ9.              01176024
011770     05  PV-SUM-UNT-CST-AMT     PIC S9(09)V99 COMP-3 VALUE +0.    01177024
011780*    05  PV-SUM-UNT-CST-AMT     PIC S9(5)V9(2) COMP-3 VALUE +0.   01178024
011790     05  PV-TOT-UNT-CST-AMT     PIC S9(11)V99 COMP-3 VALUE +0.    01179024
011800     05  PV-SUM-RTL-CST-AMT     PIC S9(09)V99 COMP-3 VALUE +0.    01180024
011900*    05  PV-SUM-RTL-CST-AMT     PIC S9(5)V9(2) COMP-3 VALUE +0.   01190024
012000     05  PV-TOT-RTL-CST-AMT     PIC S9(11)V99 COMP-3 VALUE +0.    01200024
022400     05  PV-RETRY-CNT                 PIC S9(01)  VALUE +0.       02240001
060300                                                                  06030001
060301*                                                                 06030124
060302 01  PC-CONSTANTS.                                                06030211
060303     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08)    VALUE         06030324
060304                                                    'RVKUP001'.   06030422
060305     05  PC-MARKOUT                   PIC  X(07)    VALUE         06030524
060306                                                    'MARKOUT'.    06030622
060307     05  PC-APPROVED                  PIC  X(08)    VALUE         06030724
060308                                                    'APPROVED'.   06030822
060309     05  PC-PENDING                   PIC  X(07)    VALUE         06030924
060310                                                    'PENDING'.    06031024
060311     05  PC-APPROVED-STATUS           PIC  X(01)    VALUE 'A'.    06031124
060312     05  PC-MAX-RETRIES               PIC S9(04)    VALUE +3      06031201
060313                                                     COMP SYNC.   06031301
060314*                                                                 06031411
060315*                                                                 06031522
060316 01  ABEND-CODE                       PIC S9(04)    VALUE ZERO    06031622
060317                                                    COMP SYNC.    06031722
060318     88  ABEND-4013-DB2-ERROR                       VALUE +4013.  06031822
060319/                                                                 06031911
060320     EXEC SQL                                                     06032011
060321         INCLUDE SQLCA                                            06032111
060322     END-EXEC.                                                    06032211
060323                                                                  06032311
060324     COPY SQLCA2.                                                 06032411
060325                                                                  06032511
060326******************************************************************06032611
060327*  DCLGEN FOR TDFCTOR - RTV DEFECT ORDER HEADER TABLE             06032711
060328******************************************************************06032811
060329     EXEC SQL                                                     06032911
060330         INCLUDE TDFCTOR                                          06033011
060331     END-EXEC.                                                    06033111
060332                                                                  06033211
060333******************************************************************06033311
060334*  DCLGEN FOR TDFMEIT - RTV DEFECT ORDER ITEM TABLE               06033411
060335******************************************************************06033511
060336     EXEC SQL                                                     06033611
060337         INCLUDE TDFMEIT                                          06033711
060338     END-EXEC.                                                    06033811
060339*                                                                 06033911
060340******************************************************************06034012
060341*  DCLGEN FOR RVT_DFCT_STAT -- DEFECT ORDER HEADER STATUS TABLE   06034112
060342******************************************************************06034212
060343     EXEC SQL                                                     06034312
060344         INCLUDE RVT00003                                         06034412
060345     END-EXEC.                                                    06034512
060346*                                                                 06034612
060347 EJECT                                                            06034711
060348/                                                                 06034811
060349*                                                                 06034911
060350******************************************************************06035011
060351*  DB2 FORMATTED MESSAGE AREA                                     06035111
060352******************************************************************06035211
060353     COPY DPWS004.                                                06035311
060354*                                                                 06035411
060355******************************************************************06035511
060356*  CURSOR FOR RETRIEVING MARKOUT ORDERS THAT ARE IN A PENDING     06035611
060357*  APPROVAL STATUS.                                               06035711
060358******************************************************************06035811
060359     EXEC SQL                                                     06035911
060360         DECLARE TDFCTOR-CSR CURSOR WITH HOLD FOR                 06036011
060361          SELECT DFCT_ORD_ID                                      06036111
060362                ,VEND_NAME                                        06036222
060363                ,OPER_UNT_ID                                      06036322
060364            FROM TDFCTOR                                          06036424
060365           WHERE OPER_UNT_ID        > 0                           06036524
060366             AND LOC_ID            <> '               '           06036624
060367             AND DFCT_ORD_ID        > 0                           06036724
060368             AND DFCT_ORD_ID_CDE    = 'M'                         06036824
060369             AND DFCT_ORD_STAT_CDE IN ('P','S','D')               06036924
060370        ORDER BY OPER_UNT_ID                                      06037024
060371                ,LOC_ID                                           06037124
060372                ,DFCT_ORD_ID                                      06037224
060373     END-EXEC.                                                    06037311
060374                                                                  06037411
060375                                                                  06037524
060376******************************************************************06037622
060377 PROCEDURE DIVISION.                                              06037711
060378******************************************************************06037822
060379                                                                  06037911
060380 0000-MAINLINE.                                                   06038011
060381                                                                  06038111
060382     PERFORM 1000-INITIALIZE.                                     06038211
060383                                                                  06038311
060384     PERFORM 2000-PROCESS-TDFCTOR UNTIL PS-EOF-TDFCTOR-CSR.       06038413
060385                                                                  06038511
060386     PERFORM 9000-EOJ.                                            06038622
060387                                                                  06038711
060388     GOBACK.                                                      06038811
060389                                                                  06038911
060390******************************************************************06039011
060391* 1000-INITIALIZE                                                 06039111
060392******************************************************************06039211
060393 1000-INITIALIZE.                                                 06039311
060394                                                                  06039411
060395     MOVE FUNCTION CURRENT-DATE  TO PV-SYSTEM-DATE.               06039524
060396     MOVE PV-SYSTEM-DATE-CCYY    TO PV-CURRENT-DATE-CCYY.         06039624
060397     MOVE PV-SYSTEM-DATE-MM      TO PV-CURRENT-DATE-MM.           06039724
060398     MOVE PV-SYSTEM-DATE-DD      TO PV-CURRENT-DATE-DD.           06039822
060399                                                                  06039922
060400     OPEN OUTPUT LA-LISTING-APPROVAL-RPT-FILE.                    06040024
060401                                                                  06040124
060402     PERFORM 7000-OPEN-TDFCTOR-CSR.                               06040222
060403     PERFORM 7010-FETCH-TDFCTOR-CSR.                              06040311
060404                                                                  06040411
060405                                                                  06040522
060406******************************************************************06040611
060407* 2000-PROCESS-TDFCTOR                                            06040713
060408* PROCESS:  THIS PARAGRAPH WILL UPDATE ALL ROWS RETURNED FROM THE 06040811
060409* TDFCTOR CURSOR AND THEIR CORRESPONDING ROWS ON TDFMEIT.         06040911
060410******************************************************************06041011
060411 2000-PROCESS-TDFCTOR.                                            06041113
060412                                                                  06041211
060413     PERFORM 2100-UPDATE-TDFMEIT.                                 06041324
060414                                                                  06041413
060415* CHECK IF THERE ARE ANY ITEMS ON THE LISTING WITH A MARKOUT ID   06041524
060416* OF 0.  ITEMS WITH A MARKOUT ID OF ZERO WERE NOT APPROVED IN THE 06041624
060417* ABOVE PROCESS.  WE DO NOT WANT TO APPROVE THESE LISTINGS BECAUSE06041724
060418* NOT ALL OF THE LINES HAVE BEEN APPROVED.  IN THIS CASE, COMMIT  06041824
060419* THE STATUS CHANGES TO THE OTHER LINES AND WRITE AN INFORMATIONAL06041924
060420* LINE TO THE REPORT.                                             06042024
060421                                                                  06042124
060422     PERFORM 2200-COUNT-ZERO-MARKOUT-ID.                          06042224
060423                                                                  06042324
060424     INITIALIZE RV062-LISTING-REPORT-RECORD.                      06042424
060425     MOVE DFCTOR-OPER-UNT-ID     TO RV062-RTV-LOCATION.           06042524
060426     IF  PV-MARKOUT-COUNT > 0                                     06042624
060427         PERFORM 2500-COMMIT                                      06042724
060428         MOVE DFCTOR-DFCT-ORD-ID TO RV062-LISTING-NBR             06042824
060429         MOVE '** MARKOUT ID OF ZERO FOUND'                       06042924
060430                                 TO RV062-VENDOR-NAME             06043024
060431         MOVE PC-MARKOUT         TO RV062-LISTING-TYPE            06043124
060432         MOVE PC-PENDING         TO RV062-CURRENT-STATUS          06043224
060433         MOVE '** NO UPDATE'     TO RV062-STATUS-CHG-DATE         06043324
060434         MOVE 0                  TO RV062-TDFCTOR-UPDATE-COUNT    06043424
060435         PERFORM 8100-WRITE-UPDATE-SUMMARY-DTL                    06043524
060436     ELSE                                                         06043624
060437         PERFORM 2300-INSERT-RVT-DFCT-STAT                        06043724
060438         SET PS-TDFCTOR-UPD-NO TO TRUE                            06043824
060439         MOVE 0                TO PV-TDFCTOR-UPDATE-DETAIL        06043924
060440         PERFORM 2400-UPDATE-TDFCTOR                              06044024
060450         PERFORM 2500-COMMIT                                      06045024
060460         IF PS-TDFCTOR-UPD-YES                                    06046024
060470           INITIALIZE PV-SUM-RTL-CST-AMT                          06047024
060480           INITIALIZE PV-SUM-UNT-CST-AMT                          06048024
060490           PERFORM 2450-ADD-UNIT-RTL-TO-SUM                       06049024
060491         END-IF                                                   06049124
060492         MOVE DFCTOR-DFCT-ORD-ID TO RV062-LISTING-NBR             06049224
060493         MOVE DFCTOR-VEND-NAME   TO RV062-VENDOR-NAME             06049324
060494         MOVE PC-MARKOUT         TO RV062-LISTING-TYPE            06049424
060495         MOVE PC-APPROVED        TO RV062-CURRENT-STATUS          06049524
060496         MOVE PV-CURRENT-DATE    TO RV062-STATUS-CHG-DATE         06049624
060497         MOVE PV-SUM-RTL-CST-AMT TO RV062-TOT-RTL-CST-AMT         06049724
060498         MOVE PV-SUM-UNT-CST-AMT TO RV062-TOT-UNT-CST-AMT         06049824
060499         MOVE PV-TDFCTOR-UPDATE-DETAIL                            06049924
060500                                 TO RV062-TDFCTOR-UPDATE-COUNT    06050024
060501         PERFORM 8100-WRITE-UPDATE-SUMMARY-DTL                    06050124
060502     END-IF.                                                      06050224
060503                                                                  06050313
060504     PERFORM 7010-FETCH-TDFCTOR-CSR.                              06050411
060505                                                                  06050511
060506                                                                  06050620
060507******************************************************************06050724
060508* 2100-UPDATE-TDFMEIT                                             06050824
060509* PROCESS:  THIS PARAGRAPH WILL UPDATE THE MKOUT_ORD_STAT_CDE TO  06050924
060510*           APPROVED ('A') FOR THE LINES ASSOCIATED WITH THE      06051024
060511*           SPECIFIED MARKOUT LISTING.                            06051124
060512******************************************************************06051224
060513 2100-UPDATE-TDFMEIT.                                             06051324
060514     EXEC SQL                                                     06051424
060515         UPDATE TDFMEIT                                           06051524
060516            SET MKOUT_ORD_STAT_CDE = :PC-APPROVED-STATUS          06051624
060517          WHERE DFCT_ORD_ID        = :DFCTOR-DFCT-ORD-ID          06051724
060518            AND MKOUT_ORD_ID      <> 0                            06051824
060519            AND MKOUT_ORD_STAT_CDE  IN ('P','S','D')              06051924
060520     END-EXEC.                                                    06052024
060521     EVALUATE TRUE                                                06052124
060522         WHEN SQLCODE = ZERO                                      06052224
060523             ADD SQLERRD(3)           TO PV-TDFMEIT-UPDATE-COUNT  06052324
060524         WHEN SQLCODE = +100                                      06052424
060525             CONTINUE                                             06052524
060526         WHEN SQLCODE < ZERO                                      06052624
060527             MOVE '2100-UPDATE-TDFMEIT' TO PV-PARAGRAPH           06052724
060528             MOVE 'UPDATE'              TO PV-DB2-FUNCTION        06052824
060529             MOVE DFCTOR-DFCT-ORD-ID    TO PV-DFCT-ORD-ID-DISP    06052924
060530             STRING 'DFCT-ORD-ID: '        DELIMITED BY SIZE      06053024
060531                   PV-DFCT-ORD-ID-DISP     DELIMITED BY SIZE      06053124
060532                                      INTO PV-DB2-MESSAGE         06053224
060533             MOVE 'TDFMEIT'             TO PV-DB2-TABLE-NAME      06053324
060534             PERFORM 9100-SQL-ERROR                               06053424
060535         WHEN SQLCODE > ZERO                                      06053524
060536         WHEN SQLWARN0 NOT = SPACES                               06053624
060537             MOVE '2100-UPDATE-TDFMEIT' TO PV-PARAGRAPH           06053724
060538             MOVE 'UPDATE'              TO PV-DB2-FUNCTION        06053824
060539             MOVE DFCTOR-DFCT-ORD-ID    TO PV-DFCT-ORD-ID-DISP    06053924
060540             STRING 'DFCT-ORD-ID: '        DELIMITED BY SIZE      06054024
060541                   PV-DFCT-ORD-ID-DISP     DELIMITED BY SIZE      06054124
060542                                      INTO PV-DB2-MESSAGE         06054224
060543             MOVE 'TDFMEIT'             TO PV-DB2-TABLE-NAME      06054324
060544             PERFORM 9200-SQL-WARNING                             06054424
060545     END-EVALUATE.                                                06054524
060546                                                                  06054624
060547                                                                  06054724
060548******************************************************************06054824
060549* 2200-COUNT-ZERO-MARKOUT-ID.                                     06054924
060550* PROCESS:  THIS PARAGRAPH WILL FETCH A ROW FROM THE TDFCTOR      06055024
060551*           CURSOR.                                               06055124
060552******************************************************************06055224
060553 2200-COUNT-ZERO-MARKOUT-ID.                                      06055324
060554     INITIALIZE PV-MARKOUT-COUNT.                                 06055424
060555                                                                  06055524
060556     EXEC SQL                                                     06055624
060557        SELECT COUNT(*)                                           06055724
060558          INTO :PV-MARKOUT-COUNT                                  06055824
060559          FROM TDFMEIT                                            06055924
060560         WHERE DFCT_ORD_ID  = :DFCTOR-DFCT-ORD-ID                 06056024
060561           AND MKOUT_ORD_ID = 0                                   06056124
060562     END-EXEC.                                                    06056224
060563                                                                  06056324
060564     EVALUATE TRUE                                                06056424
060565         WHEN SQLCODE = ZERO                                      06056524
060566         WHEN SQLCODE = +100                                      06056624
060567             CONTINUE                                             06056724
060568         WHEN SQLCODE < ZERO                                      06056824
060569             MOVE '2200-COUNT-ZERO-MARKOUT-ID'                    06056924
060570                                      TO PV-PARAGRAPH             06057024
060571             MOVE 'COUNT'             TO PV-DB2-FUNCTION          06057124
060572             MOVE DFCTOR-DFCT-ORD-ID  TO PV-DFCT-ORD-ID-DISP      06057224
060573             STRING 'DFCT-ORD-ID: '      DELIMITED BY SIZE        06057324
060574                   PV-DFCT-ORD-ID-DISP   DELIMITED BY SIZE        06057424
060575                                    INTO PV-DB2-MESSAGE           06057524
060576             MOVE 'TDFMEIT'           TO PV-DB2-TABLE-NAME        06057624
060577             PERFORM 9100-SQL-ERROR                               06057724
060578         WHEN SQLCODE > ZERO                                      06057824
060579         WHEN SQLWARN0 NOT = SPACES                               06057924
060580             MOVE '2200-COUNT-ZERO-MARKOUT-ID'                    06058024
060581                                      TO PV-PARAGRAPH             06058124
060582             MOVE 'COUNT'             TO PV-DB2-FUNCTION          06058224
060583             MOVE DFCTOR-DFCT-ORD-ID  TO PV-DFCT-ORD-ID-DISP      06058324
060584             STRING 'DFCT-ORD-ID: '      DELIMITED BY SIZE        06058424
060585                   PV-DFCT-ORD-ID-DISP   DELIMITED BY SIZE        06058524
060586                                    INTO PV-DB2-MESSAGE           06058624
060587             MOVE 'TDFMEIT'           TO PV-DB2-TABLE-NAME        06058724
060588             PERFORM 9200-SQL-WARNING                             06058824
060589     END-EVALUATE.                                                06058924
060590                                                                  06059024
060591                                                                  06059124
060592******************************************************************06059224
060593* 2300-INSERT-RVT-DFCT-STAT                                       06059324
060594* PROCESS:  THIS PARAGRAPH WILL INSERT A ROW INTO THE             06059424
060595*           RVT_DFCT_STAT TABLE TO SHOW THE UPDATE TO             06059524
060596*           THE STATUS THAT IS BEING MADE TO THE TDFCTOR          06059624
060597*           TABLE.                                                06059724
060598******************************************************************06059824
060599 2300-INSERT-RVT-DFCT-STAT.                                       06059924
060600     EXEC SQL                                                     06060024
060601         INSERT INTO RVT_DFCT_STAT                                06060124
060602                    (DFCT_ORD_ID                                  06060224
060603                    ,CHGD_TMST                                    06060324
060604                    ,DFCT_ORD_STAT_CDE                            06060424
060605                    ,USR_ID)                                      06060524
060606             VALUES (:DFCTOR-DFCT-ORD-ID                          06060624
060607                    , CURRENT TIMESTAMP                           06060724
060608                    ,:PC-APPROVED-STATUS                          06060824
060609                    ,:PC-CURRENT-PROGRAM-NAME)                    06060924
060610     END-EXEC.                                                    06061024
060611                                                                  06061124
060612     EVALUATE TRUE                                                06061224
060613         WHEN SQLCODE = ZERO                                      06061324
060614             ADD 1                    TO PV-RVT-INSERT-COUNT      06061424
060615         WHEN SQLCODE < ZERO                                      06061524
060616             MOVE '2300-INSERT-RVT-DFCT-STAT'                     06061624
060617                                      TO PV-PARAGRAPH             06061724
060618             MOVE 'INSERT'            TO PV-DB2-FUNCTION          06061824
060619             MOVE DFCTOR-DFCT-ORD-ID  TO PV-DFCT-ORD-ID-DISP      06061924
060620             STRING 'DFCT-ORD-ID: '      DELIMITED BY SIZE        06062024
060621                   PV-DFCT-ORD-ID-DISP   DELIMITED BY SIZE        06062124
060622                                    INTO PV-DB2-MESSAGE           06062224
060623             MOVE 'RVT_DFCT_STAT'     TO PV-DB2-TABLE-NAME        06062324
060624             PERFORM 9100-SQL-ERROR                               06062424
060625         WHEN SQLCODE > ZERO                                      06062524
060626         WHEN SQLWARN0 NOT = SPACES                               06062624
060627             MOVE '2300-INSERT-RVT-DFCT-STAT'                     06062724
060628                                      TO PV-PARAGRAPH             06062824
060629             MOVE 'INSERT'            TO PV-DB2-FUNCTION          06062924
060630             MOVE DFCTOR-DFCT-ORD-ID  TO PV-DFCT-ORD-ID-DISP      06063024
060631             STRING 'DFCT-ORD-ID: '      DELIMITED BY SIZE        06063124
060632                   PV-DFCT-ORD-ID-DISP   DELIMITED BY SIZE        06063224
060633                                    INTO PV-DB2-MESSAGE           06063324
060634             MOVE 'RVT_DFCT_STAT'     TO PV-DB2-TABLE-NAME        06063424
060635             PERFORM 9200-SQL-WARNING                             06063524
060636     END-EVALUATE.                                                06063624
060637                                                                  06063724
060638                                                                  06063824
060639******************************************************************06063924
060640* 2400-UPDATE-TDFCTOR                                             06064024
060641* PROCESS:  THIS PARAGRAPH WILL UPDATE THE DFCT_ORD_STAT_CDE TO   06064124
060642*           APPROVED ('A') FOR MARKOUT LISTINGS.                  06064224
060643******************************************************************06064324
060644 2400-UPDATE-TDFCTOR.                                             06064424
060645     EXEC SQL                                                     06064524
060646         UPDATE TDFCTOR                                           06064624
060647            SET STATUS_CHG_DTE    = CURRENT_DATE                  06064724
060648              , DFCT_ORD_STAT_CDE = :PC-APPROVED-STATUS           06064824
060649          WHERE DFCT_ORD_ID = :DFCTOR-DFCT-ORD-ID                 06064924
060650     END-EXEC.                                                    06065024
060651                                                                  06065124
060652     EVALUATE TRUE                                                06065224
060653         WHEN SQLCODE = ZERO                                      06065324
060654             ADD +1 TO PV-TDFCTOR-UPDATE-COUNT                    06065424
060655                       PV-TDFCTOR-UPDATE-DETAIL                   06065524
060656             SET PS-TDFCTOR-UPD-YES TO TRUE                       06065624
060657         WHEN SQLCODE < ZERO                                      06065724
060658         WHEN SQLCODE = +100                                      06065824
060659             MOVE '2400-UPDATE-TDFCTOR' TO PV-PARAGRAPH           06065924
060660             MOVE 'UPDATE'              TO PV-DB2-FUNCTION        06066024
060661             MOVE DFCTOR-DFCT-ORD-ID    TO PV-DFCT-ORD-ID-DISP    06066124
060662             STRING 'DFCT-ORD-ID: '        DELIMITED BY SIZE      06066224
060663                   PV-DFCT-ORD-ID-DISP     DELIMITED BY SIZE      06066324
060664                                      INTO PV-DB2-MESSAGE         06066424
060665             MOVE 'TDFCTOR'             TO PV-DB2-TABLE-NAME      06066524
060666             PERFORM 9100-SQL-ERROR                               06066624
060667         WHEN SQLCODE > ZERO                                      06066724
060668         WHEN SQLWARN0 NOT = SPACES                               06066824
060669             MOVE '2400-UPDATE-TDFCTOR' TO PV-PARAGRAPH           06066924
060670             MOVE 'UPDATE'              TO PV-DB2-FUNCTION        06067024
060671             MOVE DFCTOR-DFCT-ORD-ID    TO PV-DFCT-ORD-ID-DISP    06067124
060672             STRING 'DFCT-ORD-ID: '        DELIMITED BY SIZE      06067224
060673                   PV-DFCT-ORD-ID-DISP     DELIMITED BY SIZE      06067324
060674                                      INTO PV-DB2-MESSAGE         06067424
060675             MOVE 'TDFCTOR'             TO PV-DB2-TABLE-NAME      06067524
060676             PERFORM 9200-SQL-WARNING                             06067624
060677     END-EVALUATE.                                                06067724
060678                                                                  06067824
060679                                                                  06067924
060680******************************************************************06068024
060681* 2450-ADD-UNIT-RTL-TO-SUM                                        06068124
060682* PROCESS:  ADD THE UNIT AND RETAIL COSTS FOR THIS LISTING TO     06068224
060683*           RUNNING TOTALS FOR ALL UPDATED LISTINGS.              06068324
060684******************************************************************06068424
060685 2450-ADD-UNIT-RTL-TO-SUM.                                        06068524
060686                                                                  06068624
060687     PERFORM                                                      06068701
060688         WITH TEST AFTER                                          06068801
060689         VARYING PV-RETRY-CNT                                     06068901
060690         FROM 1 BY 1                                              06069001
060691         UNTIL (PV-RETRY-CNT > PC-MAX-RETRIES                     06069101
060692                OR SQLCODE = 0)                                   06069201
060693                                                                  06069301
060694     EXEC SQL                                                     06069424
060695         SELECT                                                   06069524
060696            SUM(A.RTL_COST_AMT)                                   06069624
060697          , SUM(A.UNIT_COST_AMT)                                  06069724
060698           INTO :PV-SUM-RTL-CST-AMT                               06069824
060699              , :PV-SUM-UNT-CST-AMT                               06069924
060700           FROM TDFMEIT A                                         06070024
060701          WHERE A.DFCT_ORD_ID = :DFCTOR-DFCT-ORD-ID               06070124
060702     END-EXEC                                                     06070224
060703                                                                  06070324
060704     EVALUATE TRUE                                                06070424
060705         WHEN SQLCODE = +0                                        06070524
060706           COMPUTE PV-TOT-RTL-CST-AMT =                           06070624
060707                 PV-SUM-RTL-CST-AMT  + PV-TOT-RTL-CST-AMT         06070724
060708           COMPUTE PV-TOT-UNT-CST-AMT =                           06070824
060709                 PV-SUM-UNT-CST-AMT + PV-TOT-UNT-CST-AMT          06070924
060710         WHEN SQLCODE = +100                                      06071024
061900         WHEN SQLCODE = -904                                      06190001
062000         WHEN SQLCODE = -911                                      06200001
062001              CONTINUE                                            06200124
062002         WHEN SQLCODE < +0                                        06200224
062003         WHEN SQLCODE > +0                                        06200324
062004         WHEN SQLWARN0 NOT = SPACES                               06200424
062005             MOVE '2450-ADD-UNIT-RTL-TO-SUM' TO PV-PARAGRAPH      06200524
062006             MOVE 'SELECT'              TO PV-DB2-FUNCTION        06200624
062007             MOVE DFCTOR-DFCT-ORD-ID    TO PV-DFCT-ORD-ID-DISP    06200724
062008             STRING 'DFCT-ORD-ID: '        DELIMITED BY SIZE      06200824
062009                   PV-DFCT-ORD-ID-DISP     DELIMITED BY SIZE      06200924
062010                                      INTO PV-DB2-MESSAGE         06201024
062011             MOVE 'TDFMEIT'             TO PV-DB2-TABLE-NAME      06201124
062012             PERFORM 9100-SQL-ERROR                               06201224
063500         END-EVALUATE                                             06350001
063600     END-PERFORM.                                                 06360001
063700                                                                  06370001
063800     IF PV-RETRY-CNT > PC-MAX-RETRIES                             06380001
063801        MOVE '2450-ADD-UNIT-RTL-TO-SUM' TO PV-PARAGRAPH           06380124
063802        MOVE 'SELECT'              TO PV-DB2-FUNCTION             06380224
063803        MOVE DFCTOR-DFCT-ORD-ID    TO PV-DFCT-ORD-ID-DISP         06380324
063804        STRING 'DFCT-ORD-ID: '        DELIMITED BY SIZE           06380424
063805              PV-DFCT-ORD-ID-DISP     DELIMITED BY SIZE           06380524
063806                                 INTO PV-DB2-MESSAGE              06380624
063807         MOVE 'TDFMEIT'             TO PV-DB2-TABLE-NAME          06380724
063808         PERFORM 9100-SQL-ERROR                                   06380824
064500     END-IF.                                                      06450001
064501                                                                  06450124
064502******************************************************************06450224
064503* 2500-COMMIT                                                     06450324
064504* PROCESS:  THIS PARAGRAPH WILL GET THE CURRENT TIMESTAMP NEEDED  06450411
064505* TO DETERMINE IF A COMMIT IS NEEDED.                             06450511
064506******************************************************************06450611
064507 2500-COMMIT.                                                     06450724
064508                                                                  06450811
064509     EXEC SQL                                                     06450911
064510         COMMIT                                                   06451011
064511     END-EXEC.                                                    06451111
064512                                                                  06451211
064513                                                                  06451324
064514******************************************************************06451415
064515* 7000-OPEN-TDFCTOR-CSR                                           06451511
064516* PROCESS:  THIS PARAGRAPH WILL OPEN THE TDFCTOR CURSOR.          06451611
064517******************************************************************06451711
064518 7000-OPEN-TDFCTOR-CSR.                                           06451811
064519     EXEC SQL                                                     06451911
064520         OPEN TDFCTOR-CSR                                         06452011
064521     END-EXEC.                                                    06452111
064522                                                                  06452211
064523     EVALUATE TRUE                                                06452311
064524         WHEN SQLCODE = ZERO                                      06452411
064525             CONTINUE                                             06452511
064526         WHEN SQLCODE < ZERO                                      06452611
064527             MOVE '7000-OPEN-TDFCTOR-CSR'                         06452711
064528                                      TO PV-PARAGRAPH             06452811
064529             MOVE 'OPEN'              TO PV-DB2-FUNCTION          06452911
064530             MOVE 'TDFCTOR'           TO PV-DB2-TABLE-NAME        06453024
064531             PERFORM 9100-SQL-ERROR                               06453124
064532         WHEN SQLCODE > ZERO                                      06453211
064533         WHEN SQLWARN0 NOT = SPACES                               06453311
064534             MOVE '7000-OPEN-TDFCTOR-CSR'                         06453411
064535                                      TO PV-PARAGRAPH             06453511
064536             MOVE 'OPEN'              TO PV-DB2-FUNCTION          06453611
064537             MOVE 'TDFCTOR'           TO PV-DB2-TABLE-NAME        06453724
064538             PERFORM 9200-SQL-WARNING                             06453824
064539     END-EVALUATE.                                                06453911
064540                                                                  06454011
064541                                                                  06454120
064542******************************************************************06454211
064543* 7010-FETCH-TDFCTOR-CSR                                          06454311
064544* PROCESS:  THIS PARAGRAPH WILL FETCH A ROW FROM THE TDFCTOR      06454411
064545*           CURSOR.                                               06454511
064546******************************************************************06454611
064547 7010-FETCH-TDFCTOR-CSR.                                          06454711
064548     INITIALIZE DCLTDFCTOR.                                       06454811
064549                                                                  06454911
064550     EXEC SQL                                                     06455011
064551         FETCH TDFCTOR-CSR                                        06455111
064552          INTO :DFCTOR-DFCT-ORD-ID                                06455211
064553             , :DFCTOR-VEND-NAME                                  06455322
064554             , :DFCTOR-OPER-UNT-ID                                06455422
064555     END-EXEC.                                                    06455511
064556                                                                  06455611
064557     EVALUATE TRUE                                                06455711
064558         WHEN SQLCODE = ZERO                                      06455811
064559             CONTINUE                                             06455924
064560         WHEN SQLCODE = +100                                      06456011
064561             SET PS-EOF-TDFCTOR-CSR   TO TRUE                     06456111
064562         WHEN SQLCODE < ZERO                                      06456211
064563             MOVE '7010-FETCH-TDFCTOR-CSR'                        06456311
064564                                      TO PV-PARAGRAPH             06456411
064565             MOVE 'FETCH'             TO PV-DB2-FUNCTION          06456511
064566             MOVE 'TDFCTOR'           TO PV-DB2-TABLE-NAME        06456624
064567             PERFORM 9100-SQL-ERROR                               06456724
064568         WHEN SQLCODE > ZERO                                      06456811
064569         WHEN SQLWARN0 NOT = SPACES                               06456911
064570             MOVE '7010-FETCH-TDFCTOR-CSR'                        06457011
064571                                      TO PV-PARAGRAPH             06457111
064572             MOVE 'FETCH'             TO PV-DB2-FUNCTION          06457211
064573             MOVE 'TDFCTOR'           TO PV-DB2-TABLE-NAME        06457324
064574             PERFORM 9200-SQL-WARNING                             06457424
064575     END-EVALUATE.                                                06457511
064576                                                                  06457611
064577                                                                  06457720
064578******************************************************************06457811
064579* 7020-CLOSE-TDFCTOR-CSR                                          06457911
064580* PROCESS:  THIS PARAGRAPH WILL CLOSE THE TDFCTOR CURSOR.         06458011
064581******************************************************************06458111
064582 7020-CLOSE-TDFCTOR-CSR.                                          06458211
064583     EXEC SQL                                                     06458311
064584         CLOSE TDFCTOR-CSR                                        06458411
064585     END-EXEC.                                                    06458511
064586                                                                  06458611
064587     EVALUATE TRUE                                                06458711
064588         WHEN SQLCODE = ZERO                                      06458811
064589             CONTINUE                                             06458911
064590         WHEN SQLCODE < ZERO                                      06459011
064591             MOVE '7020-CLOSE-TDFCTOR-CSR'                        06459111
064592                                      TO PV-PARAGRAPH             06459211
064593             MOVE 'CLOSE'             TO PV-DB2-FUNCTION          06459311
064594             MOVE 'TDFCTOR'           TO PV-DB2-TABLE-NAME        06459424
064595             PERFORM 9100-SQL-ERROR                               06459524
064596         WHEN SQLCODE > ZERO                                      06459611
064597         WHEN SQLWARN0 NOT = SPACES                               06459711
064598             MOVE '7020-CLOSE-TDFCTOR-CSR'                        06459811
064599                                      TO PV-PARAGRAPH             06459911
064600             MOVE 'CLOSE'             TO PV-DB2-FUNCTION          06460011
064601             MOVE 'TDFCTOR'           TO PV-DB2-TABLE-NAME        06460124
064602             PERFORM 9200-SQL-WARNING                             06460224
064603     END-EVALUATE.                                                06460311
064604                                                                  06460420
064605                                                                  06460520
064606                                                                  06460622
064607 8100-WRITE-UPDATE-SUMMARY-DTL.                                   06460724
064608******************************************************************06460822
064609*  WRITE THE STYLE SUMMARY DETAIL RECORD.                         06460922
064610******************************************************************06461022
064611                                                                  06461124
064612     WRITE LA-LISTING-APPROVAL-RECORD                             06461224
064613         FROM RV062-LISTING-REPORT-RECORD                         06461322
064614         ADD 1                    TO PV-RPT-RECS-WRITTEN.         06461424
064615                                                                  06461522
064616                                                                  06461624
064617******************************************************************06461716
064618* 9000-EOJ - DISPLAYS ALL OF THE COUNTS AT THE END OF THE PROGRAM.06461820
064619******************************************************************06461911
064620 9000-EOJ.                                                        06462011
064621     PERFORM 7020-CLOSE-TDFCTOR-CSR.                              06462111
064622                                                                  06462222
064623                                                                  06462324
064624     CLOSE LA-LISTING-APPROVAL-RPT-FILE.                          06462424
064625                                                                  06462524
064626     MOVE PV-TDFMEIT-UPDATE-COUNT     TO PV-DISP-NBR              06462624
064627     DISPLAY 'TDFMEIT UPDATES         = ' PV-DISP-NBR.            06462724
064628                                                                  06462824
064629     MOVE PV-TDFCTOR-UPDATE-COUNT     TO PV-DISP-NBR              06462924
064630     DISPLAY 'TDFCTOR UPDATES         = ' PV-DISP-NBR.            06463024
064631                                                                  06463124
064632     MOVE PV-RVT-INSERT-COUNT         TO PV-DISP-NBR              06463224
064633     DISPLAY 'RVT_DFCT_STAT INSERTS   = ' PV-DISP-NBR.            06463324
064634                                                                  06463424
064635******************************************************************06463511
064636* 9100-SQL-ERROR - PERFORMS THE ABEND FOR THE PROGRAM IN THE      06463624
064637* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 06463711
064638******************************************************************06463811
064639 9100-SQL-ERROR.                                                  06463924
064640     MOVE SQLCODE                     TO SQLCODE2.                06464024
064641     MOVE SQLERRD(3)                  TO SQLERRD3.                06464124
064642                                                                  06464224
064643     EXEC SQL                                                     06464324
064644          ROLLBACK                                                06464424
064645     END-EXEC.                                                    06464524
064646                                                                  06464624
064647     DISPLAY '9100-SQL-ERROR'.                                    06464724
064648     DISPLAY '** ABEND     **'.                                   06464824
064649     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        06464911
064650     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   06465011
064651     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME.              06465124
064652     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                06465211
064653     DISPLAY '**           ** = ' PV-DB2-MESSAGE.                 06465324
064654     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                06465411
064655     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                06465511
064656     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 06465611
064657     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                06465711
064658                                                                  06465811
064659******************************************************************06465924
064660* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    06466024
064661* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         06466124
064662* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     06466224
064663* FORMAT.                                                         06466324
064664******************************************************************06466424
064665     COPY DPPD004.                                                06466524
064666                                                                  06466624
064667     MOVE +4013                       TO ABEND-CODE.              06466711
064668     CALL 'ILBOABN0' USING ABEND-CODE.                            06466811
064669                                                                  06466911
064670 9200-SQL-WARNING.                                                06467024
064671     MOVE SQLCODE                     TO SQLCODE2.                06467124
064672     MOVE SQLERRD(3)                  TO SQLERRD3.                06467224
064673                                                                  06467324
064674     EXEC SQL                                                     06467424
064675          ROLLBACK                                                06467524
064676     END-EXEC.                                                    06467624
064677                                                                  06467724
064678     DISPLAY '9200-SQL-WARNING'.                                  06467824
064679     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        06467911
064680     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   06468011
064681     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME.              06468124
064682     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                06468211
064683     DISPLAY '**           ** = ' PV-DB2-MESSAGE.                 06468324
064684     DISPLAY '** ABEND **       ** = SQLWARNING'.                 06468411
064685     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  06468511
064686     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  06468611
064687     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  06468711
064688     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  06468811
064689     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  06468911
064690     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  06469011
064691     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  06469111
064692     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  06469211
064693     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  06469311
064694     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  06469411
064695                                                                  06469511
064696******************************************************************06469624
064697* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    06469724
064698* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         06469824
064699* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     06469924
064700* FORMAT.                                                         06470024
064701******************************************************************06470124
064702     COPY DPPD004.                                                06470224
064703                                                                  06470324
064704     MOVE +4013                       TO ABEND-CODE.              06470411
064705     CALL 'ILBOABN0' USING ABEND-CODE.                            06470511
064706                                                                  06470611
