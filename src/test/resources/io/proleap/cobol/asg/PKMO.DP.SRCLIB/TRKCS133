000100*-----------------------*                                         07/27/95
000200 IDENTIFICATION DIVISION.                                         TRKCS133
000300*-----------------------*                                            LV007
000400 PROGRAM-ID.    TRKCS133.                                         TRKCS133
000500 AUTHOR.        MICHAEL WALTERS                                   TRKCS133
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          TRKCS133
000700 DATE-WRITTEN.  05-02-95.                                         TRKCS133
000800 DATE-COMPILED.                                                   TRKCS133
000900*----------------------------------------------------------------*TRKCS133
001000*    Y133 - FORECAST PO DELETE                                   *TRKCS133
001100*                                                                *TRKCS133
001200*    THIS PROGRAM ALLOWS THE USER TO DELETE A FORCAST PO.        *TRKCS133
001300*----------------------------------------------------------------*TRKCS133
001400* CHANGED 10-30-2014 CHERI PARMLEY           CHG0094517                   
001500*         EXPANDED PO# FROM 7 TO 8 DIGITS                                 
001600*----------------------------------------------------------------*        
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001400                                                                  TRKCS133
001500 ENVIRONMENT DIVISION.                                            TRKCS133
001600                                                                  TRKCS133
001700 DATA DIVISION.                                                   TRKCS133
001800                                                                  TRKCS133
001900                                                                  TRKCS133
002000 WORKING-STORAGE SECTION.                                         TRKCS133
002100                                                                  TRKCS133
002200 01  DK-DB2-KEYS.                                                 TRKCS133
002300     05  DK-PO-NBR                      PIC S9(09)  COMP.         TRKCS133
002400     05  DK-SHIPT-ID                    PIC S9(09)  COMP.         TRKCS133
002500     05  DK-EXPTED-CART-CNT             PIC S9(04)  COMP.         TRKCS133
002600*                                                                 TRKCS133
002700 01  DN-NULL-INDICATORS.                                          TRKCS133
002800     05  DN-TRIP-ID                   PIC S9(4) COMP VALUE +0.    TRKCS133
002900     05  DN-SHIP-EST-AR-TMST          PIC S9(4) COMP VALUE +0.    TRKCS133
003000*                                                                 TRKCS133
003100 01  PC-PROGRAM-CONSTANTS.                                        TRKCS133
003200     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'TR133A  '.  TRKCS133
003300     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'TRKM133 '.  TRKCS133
003400     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'TRKCS133'.  TRKCS133
003500     05  PC-FORCAST-PO-LIST       PIC  X(01)  VALUE  ' '.         TRKCS133
003600     05  PC-SHIPMT-PO-LIST        PIC  X(01)  VALUE  '1'.         TRKCS133
003700     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           TRKCS133
003800                                              COMP.               TRKCS133
003900     05  PC-MAX-LOCK-RETRIES      PIC S9(04)  VALUE  +3           TRKCS133
004000                                              COMP.               TRKCS133
004100     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE +1            TRKCS133
004200                                              COMP.               TRKCS133
004300     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       TRKCS133
004400     05  PC-LIST-FORMAT           PIC  X(01)  VALUE '1'.          TRKCS133
004500     05  PC-D                     PIC  X(01)  VALUE 'D'.          TRKCS133
004600     05  PC-ACTIVE                PIC  X(01)  VALUE 'A'.          TRKCS133
004700     05  PC-PO-ACTIVE             PIC  X(02)  VALUE 'AC'.         TRKCS133
004800     05  PC-APPROVED              PIC X(02)   VALUE 'AP'.         TRKCS133
004900     05  PC-CANCELLED             PIC X(02)   VALUE 'CA'.         TRKCS133
005000     05  PC-CANBALENCE            PIC X(02)   VALUE 'CB'.         TRKCS133
005100     05  PC-COMPLETE              PIC X(02)   VALUE 'CM'.         TRKCS133
005200     05  PC-DEFAULT-DATE          PIC X(10)   VALUE               TRKCS133
005300                                  '0001-01-01'.                   TRKCS133
005400     05  PC-DEFAULT-TIME          PIC X(08)   VALUE               TRKCS133
005500                                  '00.00.00'.                     TRKCS133
005600     05  PC-TSYMSG-NUMBERS.                                       TRKCS133
005700         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       TRKCS133
005800         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       TRKCS133
005900         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       TRKCS133
006000         10  PC-TSYMSG-00047      PIC  9(05)  VALUE  00047.       TRKCS133
006100         10  PC-TSYMSG-00057      PIC  9(05)  VALUE  00057.       TRKCS133
006200         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       TRKCS133
006300         10  PC-TSYMSG-00068      PIC  9(05)  VALUE  00068.       TRKCS133
006400         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       TRKCS133
006500         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       TRKCS133
006600         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       TRKCS133
006700         10  PC-TSYMSG-00115      PIC  9(05)  VALUE  00115.       TRKCS133
006800         10  PC-TSYMSG-00116      PIC  9(05)  VALUE  00116.       TRKCS133
006900         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       TRKCS133
007000         10  PC-TSYMSG-00223      PIC  9(05)  VALUE  00223.       TRKCS133
007100         10  PC-TSYMSG-00224      PIC  9(05)  VALUE  00224.       TRKCS133
007200         10  PC-TSYMSG-00354      PIC  9(05)  VALUE  00354.       TRKCS133
007300         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       TRKCS133
007400         10  PC-TSYMSG-01007      PIC  9(05)  VALUE  01007.       TRKCS133
007500*                                                                 TRKCS133
007600 01  PS-PROGRAM-SWITCHES.                                         TRKCS133
007700     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         TRKCS133
007800         88  PS-ERROR                         VALUE  'Y'.         TRKCS133
007900         88  PS-NO-ERROR                      VALUE  'N'.         TRKCS133
008000     05  PS-COMMAREA-SW           PIC  X(01)  VALUE  'N'.         TRKCS133
008100         88  PS-COMMAREA-VALID                VALUE  'Y'.         TRKCS133
008200         88  PS-COMMAREA-NOT-VALID            VALUE  'N'.         TRKCS133
008300     05  PS-FOUND-SW              PIC  X(01)  VALUE ' '.          TRKCS133
008400         88  PS-FOUND                         VALUE 'Y'.          TRKCS133
008500         88  PS-NOT-FOUND                     VALUE 'N'.          TRKCS133
008600     05  PS-DPT-NOT-FOUND-SW      PIC  X(01)  VALUE 'N'.          TRKCS133
008700         88  PS-DPT-NOT-FOUND                 VALUE 'Y'.          TRKCS133
008800         88  PS-DPT-FOUND                     VALUE 'N'.          TRKCS133
008900     05  PS-NO-DISTRO-SW          PIC  X(01)  VALUE 'N'.          TRKCS133
009000         88  PS-DISTRO                        VALUE 'Y'.          TRKCS133
009100         88  PS-NO-DISTRO                     VALUE 'N'.          TRKCS133
009200     05  PS-DISPLAY-DISTRO-SW     PIC  X(01)  VALUE 'N'.          TRKCS133
009300         88  PS-DISPLAY-DISTRO-MSG            VALUE 'Y'.          TRKCS133
009400         88  PS-DONT-DISPLAY-DISTRO-MSG       VALUE 'N'.          TRKCS133
009500     05  PS-DONE-SW               PIC  X(01)  VALUE 'N'.          TRKCS133
009600         88  PS-DONE                          VALUE 'Y'.          TRKCS133
009700         88  PS-NOT-DONE                      VALUE 'N'.          TRKCS133
009800     05  PS-LIST-SW               PIC  X(01)  VALUE 'N'.          TRKCS133
009900         88  PS-LIST-END                      VALUE 'Y'.          TRKCS133
010000         88  PS-NO-LIST-END                   VALUE 'N'.          TRKCS133
010100     05  PS-SHIPMENT-EXIST-SW     PIC  X(01)  VALUE 'N'.          TRKCS133
010200         88  PS-SHIPMENT-EXIST                VALUE 'Y'.          TRKCS133
010300         88  PS-SHIPMENT-DOESNT-EXIST         VALUE 'N'.          TRKCS133
010400*                                                                 TRKCS133
010500 01  PV-PROGRAM-VARIABLES.                                        TRKCS133
010600     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            TRKCS133
010700                                              COMP SYNC.          TRKCS133
010800     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            TRKCS133
010900                                              COMP SYNC.          TRKCS133
011000     05  PV-LOCK-RETRY-COUNTER    PIC S9(04)  VALUE +0            TRKCS133
011100                                              COMP SYNC.          TRKCS133
011200     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0            TRKCS133
011300                                              COMP SYNC.          TRKCS133
011400     05  PV-OPER-UNT-ID           PIC S9(4)   VALUE +0            TRKCS133
011500                                              COMP.               TRKCS133
011600     05  PV-W-FIRST-NAME.                                         TRKCS133
011700         10  PV-WORKER-FIR-NAME   PIC X(10).                      TRKCS133
011800         10  FILLER               PIC X(02).                      TRKCS133
011900     05  PV-W-LAST-NAME.                                          TRKCS133
012000         10  PV-WORKER-LAST-NAME  PIC X(10).                      TRKCS133
012100         10  FILLER               PIC X(08).                      TRKCS133
012200     05  PV-WORKER-NAME.                                          TRKCS133
012300         10  PV-WORKER-FIRST      PIC X(10).                      TRKCS133
012400         10  PV-WORKER-LAST       PIC X(10).                      TRKCS133
012500     05  PV-DATE                  PIC X(10).                      TRKCS133
012600     05  PV-TEMP-DATE.                                            TRKCS133
012700         10  PV-DATE-CCYY         PIC X(04).                      TRKCS133
012800         10  FILLER               PIC X(01).                      TRKCS133
012900         10  PV-DATE-MM           PIC X(02).                      TRKCS133
013000         10  FILLER               PIC X(01).                      TRKCS133
013100         10  PV-DATE-DD           PIC X(02).                      TRKCS133
013200     05  PV-WORK-DATE.                                            TRKCS133
013300         10  PV-WK-DTE-MM         PIC X(02).                      TRKCS133
013400         10  FILLER               PIC X(01) VALUE '/'.            TRKCS133
013500         10  PV-WK-DTE-DD         PIC X(02).                      TRKCS133
013600         10  FILLER               PIC X(01) VALUE '/'.            TRKCS133
013700         10  PV-WK-DTE-CCYY       PIC X(04).                      TRKCS133
013800     05  PV-WORK-DATE2.                                           TRKCS133
013900         10  PV-WK2-DTE-MM        PIC X(02).                      TRKCS133
014000         10  PV-WK2-DTE-DD        PIC X(02).                      TRKCS133
014100         10  PV-WK2-DTE-YY        PIC X(04).                      TRKCS133
014200     05  PV-TEMP-YYMM.                                            TRKCS133
014300         10  PV-TEMP-YY           PIC X(02).                      TRKCS133
014400         10  PV-TEMP-MM           PIC X(02).                      TRKCS133
014500                                                                  TRKCS133
014600                                                                  TRKCS133
014700 EJECT                                                            TRKCS133
014800*----------------------------------------------------------------*TRKCS133
014900*    CALLING PARAMETERS FOR LOCKING MODULE DPKCS044              *TRKCS133
015000*----------------------------------------------------------------*TRKCS133
015100                                                                  TRKCS133
015200     COPY DPWS044.                                                TRKCS133
015300 EJECT                                                            TRKCS133
015400*----------------------------------------------------------------*TRKCS133
015500*    MAP LAYOUT                                                  *TRKCS133
015600*----------------------------------------------------------------*TRKCS133
015700                                                                  TRKCS133
015800     COPY TRKM133.                                                TRKCS133
015900                                                                  TRKCS133
016000                                                                  TRKCS133
016100     EJECT                                                        TRKCS133
016200*----------------------------------------------------------------*TRKCS133
016300*    ATTRIBUTE SETTINGS COPYBOOK.                                *TRKCS133
016400*----------------------------------------------------------------*TRKCS133
016500                                                                  TRKCS133
016600     COPY DPWS015.                                                TRKCS133
016700                                                                  TRKCS133
016800*----------------------------------------------------------------*TRKCS133
016900*    FUNCTION KEYS COPYBOOK                                      *TRKCS133
017000*----------------------------------------------------------------*TRKCS133
017100                                                                  TRKCS133
017200     COPY DPWS016.                                                TRKCS133
017300******************************************************************TRKCS133
017400** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **TRKCS133
017500** SUB-ROUTINE (DPKUT100).                                      **TRKCS133
017600******************************************************************TRKCS133
017700     COPY DPWS010I.                                               TRKCS133
017800 EJECT                                                            TRKCS133
017900***************************************************************** TRKCS133
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.            TRKCS133
018100***************************************************************** TRKCS133
018200     COPY DPWS030.                                                TRKCS133
CICS       COPY DPWS930.                                                TRKCS133
018300 EJECT                                                            TRKCS133
018400***************************************************************** TRKCS133
018500*    STANDARD COMMAREA.                                           TRKCS133
018600***************************************************************** TRKCS133
018700                                                                  TRKCS133
018800     COPY DPWS020.                                                TRKCS133
018900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                TRKCS133
019000                                                                  TRKCS133
019100***************************************************************** TRKCS133
019200*    INTER-APPLICATION COMMAREA.                                  TRKCS133
019300***************************************************************** TRKCS133
019400                                                                  TRKCS133
019500         10  INTER-APPL-COMM-AREA PIC X(200).                     TRKCS133
019600*---------------------------------------------------------------* TRKCS133
019700*   TRWS017 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED TO THIS  * TRKCS133
019800*             PROGRAM FROM THE LIST PROGRAM.                    * TRKCS133
019900*---------------------------------------------------------------* TRKCS133
020000     COPY TRWS017.                                                TRKCS133
020100     COPY RCWS015.                                                TRKCS133
020200***************************************************************** TRKCS133
020300*    SPECIFIC COMMMAREA FOR TRKCS133.                             TRKCS133
020400***************************************************************** TRKCS133
020500         10  ASC-SPECIFIC-COMMAREA.                               TRKCS133
020600             15  ASC-KEY-FIELDS.                                  TRKCS133
      *CLP 10/30/14                                                             
020700                 20  ASC-KEY-PO-NBR          PIC  9(08).          TRKCS133
020800                 20  ASC-KEY-OPER-UNT-ID     PIC  9(04).          TRKCS133
020900                 20  ASC-KEY-FCLTY-ID        PIC  9(04).          TRKCS133
021000                 20  ASC-KEY-FCLTY-NME       PIC  X(25).          TRKCS133
021100                 20  ASC-KEY-SHIPT-ID        PIC S9(09) COMP-3.   TRKCS133
021200                 20  ASC-SHIPMT-PO-LIST-IND  PIC  X(01).          TRKCS133
021300                     88  ASC-SHIPMT-PO-LIST  VALUE '1'.           TRKCS133
021400                     88  ASC-FORCAST-PO-LIST VALUE '2'.           TRKCS133
021500             15  ASC-SCREEN-FIELDS.                               TRKCS133
021600                 20  ASC-PRO-NBR             PIC  X(20).          TRKCS133
021700                 20  ASC-BOL-NBR             PIC  X(30).          TRKCS133
021800                 20  ASC-PACKSLIP-IND        PIC  X(01).          TRKCS133
021900                 20  ASC-EXPTED-CART-CNT     PIC  X(05).          TRKCS133
022000                 20  ASC-EXPTED-CART-CNT-N   REDEFINES            TRKCS133
022100                     ASC-EXPTED-CART-CNT     PIC  9(05).          TRKCS133
022200                 20  ASC-REC-SEQ-NBR         PIC  9(03).          TRKCS133
022300                 20  ASC-DEPT-NBR            PIC  X(04).          TRKCS133
022400                 20  ASC-DEPT-NBR-N REDEFINES                     TRKCS133
022500                     ASC-DEPT-NBR            PIC  9(04).          TRKCS133
022600                 20  ASC-BUYER-NME           PIC  X(25).          TRKCS133
022700                 20  ASC-VENDOR-NME          PIC  X(25).          TRKCS133
022800                 20  ASC-ENT-ID              PIC S9(09) COMP-3.   TRKCS133
022900                 20  ASC-NO-DISTRO-MSG       PIC  X(09).          TRKCS133
023000                 20  ASC-PO-STATUS           PIC  X(02).          TRKCS133
023100                 20  ASC-PO-STATUS-DESC      PIC  X(10).          TRKCS133
023200                 20  ASC-DONT-SHIP-BEF-DTE   PIC  X(10).          TRKCS133
023300                 20  ASC-CANCEL-DTE          PIC  X(10).          TRKCS133
023400                 20  ASC-EXT-CAN-DTE         PIC  X(10).          TRKCS133
023500                 20  ASC-ASN-CART-CNT        PIC  9(06).          TRKCS133
023600                 20  ASC-FOR-CART-CNT        PIC  9(06).          TRKCS133
023700             15  ASC-USE-SELECTION-QUEUE-IND                      TRKCS133
023800                                             PIC  X(01).          TRKCS133
023900                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    TRKCS133
024000             15  ASC-SEL-QUEUE-NAME          PIC  X(08).          TRKCS133
024100             15  ASC-NUMBER-OF-TS-ITEMS      PIC S9(05)  COMP-3.  TRKCS133
024200             15  ASC-NUMBER-OF-SELECTED-ITEMS                     TRKCS133
024300                                             PIC S9(09)  COMP-3.  TRKCS133
024400             15  ASC-SEL-SUB                 PIC S9(04)  COMP.    TRKCS133
024500             15  ASC-SEL-ITEM                PIC S9(04)  COMP.    TRKCS133
024600             15  ASC-DELETED-SW              PIC X(01).           TRKCS133
024700                 88  ASC-DELETED             VALUE 'D'.           TRKCS133
024800                 88  ASC-NOT-DELETED         VALUE 'N'.           TRKCS133
024900             15  ASC-EXPTED-PKG-QTY          PIC S9(09) COMP-3.   TRKCS133
025000     EJECT                                                        TRKCS133
025100/                                                                 TRKCS133
025200*---------------------------------------------------------------* TRKCS133
025300*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * TRKCS133
025400*---------------------------------------------------------------* TRKCS133
025500     COPY TRWS018.                                                TRKCS133
025600     COPY RCWS013.                                                TRKCS133
025700*----------------------------------------------------------------*TRKCS133
025800*    ABEND PROCESSING COPYBOOK.                                  *TRKCS133
025900*----------------------------------------------------------------*TRKCS133
026000                                                                  TRKCS133
026100     COPY DPWS013.                                                TRKCS133
026200                                                                  TRKCS133
026300*    DB2 AREA FOR TSHIPMT (SHIPMENT TABLE)                        TRKCS133
026400                                                                  TRKCS133
026500     EXEC SQL                                                     TRKCS133
026600          INCLUDE TSHIPMT                                         TRKCS133
026700     END-EXEC.                                                    TRKCS133
026800                                                                  TRKCS133
026900*    DB2 AREA FOR TSHPTPO (SHIPMENT/PO ASSOCIATION TABLE)         TRKCS133
027000                                                                  TRKCS133
027100     EXEC SQL                                                     TRKCS133
027200          INCLUDE TSHPTPO                                         TRKCS133
027300     END-EXEC.                                                    TRKCS133
027400                                                                  TRKCS133
027500*    DB2 AREA FOR TSHIPST (SHIPMENT STATUS TABLE)                 TRKCS133
027600                                                                  TRKCS133
027700     EXEC SQL                                                     TRKCS133
027800          INCLUDE TSHIPST                                         TRKCS133
027900     END-EXEC.                                                    TRKCS133
028000                                                                  TRKCS133
028100*    DB2 AREA FOR TSHSTYP (SHIPMENT STATUS TYPE TABLE)            TRKCS133
028200                                                                  TRKCS133
028300     EXEC SQL                                                     TRKCS133
028400          INCLUDE TSHSTYP                                         TRKCS133
028500     END-EXEC.                                                    TRKCS133
028600                                                                  TRKCS133
028700*    DB2 AREA FOR TPLNSHP (PLANNED SHIPMENT TABLE)                TRKCS133
028800                                                                  TRKCS133
028900     EXEC SQL                                                     TRKCS133
029000          INCLUDE TPLNSHP                                         TRKCS133
029100     END-EXEC.                                                    TRKCS133
029200                                                                  TRKCS133
029300*    DB2 AREA FOR TPURCHS (PO-PURCHASE TABLE)                     TRKCS133
029400                                                                  TRKCS133
029500     EXEC SQL                                                     TRKCS133
029600          INCLUDE TPURCHS                                         TRKCS133
029700     END-EXEC.                                                    TRKCS133
029800                                                                  TRKCS133
029900*    DB2 AREA FOR TAUSHIP (SHIPMENT AUDIT TABLE)                  TRKCS133
030000                                                                  TRKCS133
030100     EXEC SQL                                                     TRKCS133
030200          INCLUDE TAUSHIP                                         TRKCS133
030300     END-EXEC.                                                    TRKCS133
030400                                                                  TRKCS133
030500*    DB2 AREA FOR TAUSHPO (PO ASSOCIATE SHIP PO AUDIT TABLE)      TRKCS133
030600                                                                  TRKCS133
030700     EXEC SQL                                                     TRKCS133
030800          INCLUDE TAUSHPO                                         TRKCS133
030900     END-EXEC.                                                    TRKCS133
031000                                                                  TRKCS133
031100*    DB2 AREA FOR TSTATCD (PO STATUS CODE TABLE)                  TRKCS133
031200                                                                  TRKCS133
031300     EXEC SQL                                                     TRKCS133
031400          INCLUDE TSTATCD                                         TRKCS133
031500     END-EXEC.                                                    TRKCS133
031600                                                                  TRKCS133
031700*    DB2 AREA FOR TENTNME (EXTERNAL ENTERPRISE NAME TABLE)        TRKCS133
031800                                                                  TRKCS133
031900     EXEC SQL                                                     TRKCS133
032000          INCLUDE TENTNME                                         TRKCS133
032100     END-EXEC.                                                    TRKCS133
032200                                                                  TRKCS133
032300*    DB2 AREA FOR TPURITM (PO LINE TABLE)                         TRKCS133
032400                                                                  TRKCS133
032500     EXEC SQL                                                     TRKCS133
032600          INCLUDE TPURITM                                         TRKCS133
032700     END-EXEC.                                                    TRKCS133
032800                                                                  TRKCS133
032900*    DB2 AREA FOR TALLPLN (DC ALLOC SPLIT TABLE)                  TRKCS133
033000                                                                  TRKCS133
033100     EXEC SQL                                                     TRKCS133
033200          INCLUDE TALLPLN                                         TRKCS133
033300     END-EXEC.                                                    TRKCS133
033400                                                                  TRKCS133
033500*    DB2 AREA FOR TMESTDS (STORE ALLOC PLAN TABLE)                TRKCS133
033600                                                                  TRKCS133
033700     EXEC SQL                                                     TRKCS133
033800          INCLUDE TMESTDS                                         TRKCS133
033900     END-EXEC.                                                    TRKCS133
034000                                                                  TRKCS133
034100*    DB2 AREA FOR TMDSEAR (MERCHANDISE AREA TABLE)                TRKCS133
034200                                                                  TRKCS133
034300     EXEC SQL                                                     TRKCS133
034400          INCLUDE TMDSEAR                                         TRKCS133
034500     END-EXEC.                                                    TRKCS133
034600                                                                  TRKCS133
034700*    DB2 AREA FOR TRSPBAR (RESPONSIBILITY AREA TABLE)             TRKCS133
034800                                                                  TRKCS133
034900     EXEC SQL                                                     TRKCS133
035000          INCLUDE TRSPBAR                                         TRKCS133
035100     END-EXEC.                                                    TRKCS133
035200                                                                  TRKCS133
035300*    DB2 AREA FOR COMMUNICATIONS                                  TRKCS133
035400                                                                  TRKCS133
035500     EXEC SQL                                                     TRKCS133
035600          INCLUDE SQLCA                                           TRKCS133
035700     END-EXEC.                                                    TRKCS133
035800                                                                  TRKCS133
035900*    CURSOR USED TO DETERMINE IF THE 'NO DISTRO' MESSAGE SHOULD BETRKCS133
036000*    DISPLAYED.                                                   TRKCS133
036100                                                                  TRKCS133
036200     EXEC SQL                                                     TRKCS133
036300          DECLARE PO_CSR CURSOR FOR                               TRKCS133
036400            SELECT DISTINCT(B.PO_LNE_NBR)                         TRKCS133
036500            FROM   TPURCHS A                                      TRKCS133
036600                  ,TPURITM B                                      TRKCS133
036700            WHERE  A.PO_NBR = B.PO_NBR                            TRKCS133
036800            AND    A.PO_NBR = :DK-PO-NBR                          TRKCS133
036900            AND    A.VER_STATUS_CDE = B.VER_STATUS_CDE            TRKCS133
037000            AND    A.VER_STATUS_CDE = :PC-ACTIVE                  TRKCS133
037100     END-EXEC.                                                    TRKCS133
037200 EJECT                                                            TRKCS133
037300 LINKAGE SECTION.                                                 TRKCS133
037400                                                                  TRKCS133
037500 01  DFHCOMMAREA.                                                 TRKCS133
037600     05  FILLER                         OCCURS  1 TO 4072 TIMES   TRKCS133
037700                                        DEPENDING ON EIBCALEN.    TRKCS133
037800         10  FILLER                     PIC  X(01).               TRKCS133
037900                                                                  TRKCS133
038000                                                                  TRKCS133
038100 PROCEDURE DIVISION.                                              TRKCS133
038200***************************************************************** TRKCS133
038300** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** TRKCS133
038400** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** TRKCS133
038500** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** TRKCS133
038600**                                                             ** TRKCS133
038700** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** TRKCS133
038800** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** TRKCS133
038900***************************************************************** TRKCS133
039000 0000-MAIN-MODULE.                                                TRKCS133
039100     INITIALIZE DP030-CICS-API-FIELDS.                            TRKCS133
039200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       TRKCS133
039300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          TRKCS133
039400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         TRKCS133
039500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       TRKCS133
039600     MOVE LENGTH OF TR133AI        TO DP030-MAP-LENGTH (1).       TRKCS133
039700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     TRKCS133
039800     PERFORM 0001-CALL-CICS-ARCH-API.                             TRKCS133
039900*                                                                 TRKCS133
040000     PERFORM 1000-CONTROL-PROCESSING                              TRKCS133
040100*                                                                 TRKCS133
040200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     TRKCS133
040300     PERFORM 0001-CALL-CICS-ARCH-API.                             TRKCS133
040400                                                                  TRKCS133
040500 0001-CALL-CICS-ARCH-API.                                         TRKCS133
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
040700                                    DFHCOMMAREA                           
040800                                    DP030-CICS-API-FIELDS                 
040900                                    DP020-STANDARD-COMMAREA               
041000                                    TR133AI.                              
041100*                                                                 TRKCS133
041200     IF  DP030-RC-CALL-SUCCESSFUL                                 TRKCS133
041300         CONTINUE                                                 TRKCS133
041400     ELSE                                                         TRKCS133
041500         SET DP013-NO-ROLLBACK                                    TRKCS133
041600             DP013-XCTL-DISPLAY-RESTART                           TRKCS133
041700             DP013-CICS-ABEND      TO TRUE                        TRKCS133
041800         MOVE 'BEFORE 0000-MAIN-MODULE'                           TRKCS133
041900                                   TO DP013-PARAGRAPH             TRKCS133
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE OTRKCS133
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      TRKCS133
042200         MOVE DP030-RETURN-CODE                                   TRKCS133
042300                                   TO DP013-MESSAGE-TEXT (3)      TRKCS133
042400         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
042500     END-IF.                                                      TRKCS133
042600 EJECT                                                            TRKCS133
042700*----------------------------------------------------------------*TRKCS133
042800*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *TRKCS133
042900*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *TRKCS133
043000*----------------------------------------------------------------*TRKCS133
043100                                                                  TRKCS133
043200 1000-CONTROL-PROCESSING.                                         TRKCS133
043300                                                                  TRKCS133
043400     EVALUATE TRUE                                                TRKCS133
043500         WHEN DP020-NEXT-ACT-INITIAL                              TRKCS133
043600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 TRKCS133
043700                                                                  TRKCS133
043800***-----$TEMPLATE NOTE$-------------------------------------------TRKCS133
043900*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,TRKCS133
044000*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  TRKCS133
044100*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.TRKCS133
044200***---------------------------------------------------------------TRKCS133
044300             IF  PS-COMMAREA-NOT-VALID                            TRKCS133
044400                 SET DP020-NEXT-ACT-APPL-ERROR                    TRKCS133
044500                                   TO TRUE                        TRKCS133
044600             ELSE                                                 TRKCS133
044700                 PERFORM 4000-BUILD-INITIAL-PANEL                 TRKCS133
044800             END-IF                                               TRKCS133
044900                                                                  TRKCS133
045000         WHEN DP020-NEXT-ACT-READ-MAP                             TRKCS133
045100             MOVE ASC-KEY-PO-NBR  TO DK-PO-NBR                    TRKCS133
045200             MOVE ASC-KEY-SHIPT-ID TO DK-SHIPT-ID                 TRKCS133
045300             PERFORM 4010-SELECT-STAT-CD-INFO                     TRKCS133
045400             PERFORM 4060-GET-ENT-NAME                            TRKCS133
045500             PERFORM 2000-PROCESS-PANEL                           TRKCS133
045600                                                                  TRKCS133
045700         WHEN DP020-NEXT-ACT-RETURN                               TRKCS133
045800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 TRKCS133
045900                                                                  TRKCS133
046000         WHEN OTHER                                               TRKCS133
046100             SET DP013-LOGIC-ABEND                                TRKCS133
046200                 DP013-NO-ROLLBACK TO TRUE                        TRKCS133
046300             MOVE '1000-CONTROL-PROCESSING'                       TRKCS133
046400                                   TO DP013-PARAGRAPH             TRKCS133
046500             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   TRKCS133
046600                                   TO DP013-MESSAGE-TEXT(1)       TRKCS133
046700             MOVE DP020-NEXT-APPL-ACTIVITY                        TRKCS133
046800                                   TO DP013-MESSAGE-TEXT(2)       TRKCS133
046900             PERFORM DP013-0000-PROCESS-ABEND                     TRKCS133
047000     END-EVALUATE.                                                TRKCS133
047100/                                                                 TRKCS133
047200*----------------------------------------------------------------*TRKCS133
047300* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *TRKCS133
047400*----------------------------------------------------------------*TRKCS133
047500                                                                  TRKCS133
047600 1100-PROCESS-INTER-APPL-COMM.                                    TRKCS133
047700                                                                  TRKCS133
047800     SET PS-COMMAREA-VALID     TO TRUE.                           TRKCS133
047900     INITIALIZE ASC-SPECIFIC-COMMAREA.                            TRKCS133
048000     EVALUATE DP020-INT-APPL-FORMAT-IND                           TRKCS133
048100                                                                  TRKCS133
048200         WHEN PC-FORCAST-PO-LIST                                  TRKCS133
048300             SET ASC-FORCAST-PO-LIST       TO TRUE                TRKCS133
048400             IF TR017-NUMBER-OF-TS-ITEMS   >  0                   TRKCS133
048500                                                                  TRKCS133
048600                 MOVE TR017-OPER-UNIT      TO ASC-KEY-OPER-UNT-ID TRKCS133
048700                 MOVE TR017-FCLTY-ID       TO ASC-KEY-FCLTY-ID    TRKCS133
048800                 MOVE TR017-FCLTY-NME      TO ASC-KEY-FCLTY-NME   TRKCS133
048900                 MOVE TR017-SHIPT-ID       TO ASC-KEY-SHIPT-ID    TRKCS133
049000                                              DK-SHIPT-ID         TRKCS133
049100                 MOVE TR017-PRO-NBR        TO ASC-PRO-NBR         TRKCS133
049200                 MOVE TR017-BOL-NBR        TO ASC-BOL-NBR         TRKCS133
049300                                                                  TRKCS133
049400                 SET ASC-USE-SELECTION-QUEUE   TO TRUE            TRKCS133
049500                 MOVE TR017-NUMBER-OF-TS-ITEMS                    TRKCS133
049600                                        TO ASC-NUMBER-OF-TS-ITEMS TRKCS133
049700                 MOVE TR017-SEL-QUEUE-NAME                        TRKCS133
049800                                        TO ASC-SEL-QUEUE-NAME     TRKCS133
049900                 PERFORM 1120-PREPARE-LIST-ENTRY                  TRKCS133
050000             ELSE                                                 TRKCS133
050100                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         TRKCS133
050200                 SET PS-COMMAREA-NOT-VALID     TO TRUE            TRKCS133
050300             END-IF                                               TRKCS133
050400                                                                  TRKCS133
050500         WHEN PC-SHIPMT-PO-LIST                                   TRKCS133
050600             SET ASC-SHIPMT-PO-LIST TO TRUE                       TRKCS133
050700             IF RC015-NUMBER-OF-TS-ITEMS   >  0                   TRKCS133
050800                 SET ASC-USE-SELECTION-QUEUE TO TRUE              TRKCS133
050900                 MOVE RC015-OPER-UNT-ID    TO ASC-KEY-OPER-UNT-ID    CL**4
051000                 MOVE RC015-FCLTY-ID       TO ASC-KEY-FCLTY-ID       CL**2
051100                 MOVE RC015-SHIPT-ID       TO ASC-KEY-SHIPT-ID       CL**2
051200                                              DK-SHIPT-ID            CL**2
051300                 MOVE RC015-PRO-NBR        TO ASC-PRO-NBR            CL**2
051400                 MOVE RC015-BOL-NBR        TO ASC-BOL-NBR            CL**2
051500                                                                     CL**2
051600                 MOVE RC015-NUMBER-OF-TS-ITEMS                    TRKCS133
051700                                   TO ASC-NUMBER-OF-TS-ITEMS      TRKCS133
051800                 MOVE RC015-SEL-QUEUE-NAME                        TRKCS133
051900                                   TO ASC-SEL-QUEUE-NAME          TRKCS133
052000                 PERFORM 1125-PREPARE-LIST-ENTRY                  TRKCS133
052100             ELSE                                                 TRKCS133
052200                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         TRKCS133
052300                 SET PS-COMMAREA-NOT-VALID     TO TRUE            TRKCS133
052400             END-IF                                               TRKCS133
052500                                                                  TRKCS133
052600         WHEN OTHER                                               TRKCS133
052700             SET PS-COMMAREA-NOT-VALID                            TRKCS133
052800                 DP020-MSG-FATAL TO TRUE                          TRKCS133
052900     END-EVALUATE.                                                TRKCS133
053000/                                                                 TRKCS133
053100*----------------------------------------------------------------*TRKCS133
053200*    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *TRKCS133
053300*----------------------------------------------------------------*TRKCS133
053400                                                                  TRKCS133
053500 1120-PREPARE-LIST-ENTRY.                                         TRKCS133
053600                                                                  TRKCS133
053700     MOVE TR018-MAX-ITEMS          TO ASC-SEL-SUB.                TRKCS133
053800     MOVE ZERO                     TO ASC-SEL-ITEM.               TRKCS133
053900     PERFORM 2140-GET-NEXT-RECORD.                                TRKCS133
054000                                                                  TRKCS133
054100                                                                  TRKCS133
054200 1125-PREPARE-LIST-ENTRY.                                         TRKCS133
054300                                                                  TRKCS133
054400     MOVE RC013-MAX-ITEMS          TO ASC-SEL-SUB.                TRKCS133
054500     MOVE ZERO                     TO ASC-SEL-ITEM.               TRKCS133
054600     PERFORM 2145-GET-NEXT-RECORD.                                TRKCS133
054700                                                                  TRKCS133
054800*----------------------------------------------------------------*TRKCS133
054900* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*TRKCS133
055000* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*TRKCS133
055100* EDITS.                                                         *TRKCS133
055200*----------------------------------------------------------------*TRKCS133
055300 2000-PROCESS-PANEL.                                              TRKCS133
055400                                                                  TRKCS133
055500     EVALUATE TRUE                                                TRKCS133
055600                                                                  TRKCS133
055700         WHEN DP020-SRC-AID = DP016-CLEAR                         TRKCS133
055800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 TRKCS133
055900                                                                  TRKCS133
056000         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     TRKCS133
056100             INITIALIZE ASC-SPECIFIC-COMMAREA                     TRKCS133
056200             PERFORM 4000-BUILD-INITIAL-PANEL                     TRKCS133
056300                                                                  TRKCS133
056400         WHEN DP020-FK-CONFIRM(DP020-SRC-AID)                     TRKCS133
056500             IF  ASC-DELETED                                      TRKCS133
056600                 MOVE PC-TSYMSG-00116                             TRKCS133
056700                                  TO  DP020-MSG-NUMBER            TRKCS133
056800                 SET DP020-MSG-FATAL                              TRKCS133
056900                     PS-ERROR     TO  TRUE                        TRKCS133
057000             ELSE                                                 TRKCS133
057100                 IF ASC-REC-SEQ-NBR = 0                           TRKCS133
057200                     PERFORM 5000-DELETE-PROCESS                  TRKCS133
057300                     IF SQLCODE = +100                            TRKCS133
057400                         MOVE PC-TSYMSG-00116                     TRKCS133
057500                                          TO  DP020-MSG-NUMBER    TRKCS133
057600                         SET DP020-MSG-FATAL                      TRKCS133
057700                         PS-ERROR     TO  TRUE                    TRKCS133
057800                     ELSE                                         TRKCS133
057900                         MOVE PC-TSYMSG-00115                     TRKCS133
058000                                          TO  DP020-MSG-NUMBER    TRKCS133
058100                         SET DP020-MSG-INFORMATIONAL              TRKCS133
058200                         PS-ERROR     TO  TRUE                    TRKCS133
058300                     END-IF                                       TRKCS133
058400                 ELSE                                             TRKCS133
058500                     MOVE PC-TSYMSG-01007                         TRKCS133
058600                                  TO DP020-MSG-NUMBER             TRKCS133
058700                     SET DP020-MSG-INFORMATIONAL                  TRKCS133
058800                                  TO TRUE                         TRKCS133
058900                 END-IF                                           TRKCS133
059000             END-IF                                               TRKCS133
059100                                                                  TRKCS133
059200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             TRKCS133
059300             IF  ASC-USE-SELECTION-QUEUE                             CL**3
059400                 IF ASC-FORCAST-PO-LIST                              CL**3
059500                     PERFORM 2140-GET-NEXT-RECORD                    CL**3
059600                 ELSE                                                CL**3
059700                     PERFORM 2145-GET-NEXT-RECORD                    CL**3
059800                 END-IF                                              CL**3
059900                 IF PS-LIST-END                                   TRKCS133
060000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         TRKCS133
060100                     SET PS-NO-LIST-END                           TRKCS133
060200                                   TO TRUE                        TRKCS133
060300                 ELSE                                             TRKCS133
060400                     PERFORM 4000-BUILD-INITIAL-PANEL             TRKCS133
060500                 END-IF                                           TRKCS133
060600             ELSE                                                 TRKCS133
060700                 MOVE PC-TSYMSG-00070                             TRKCS133
060800                                   TO DP020-MSG-NUMBER            TRKCS133
060900                 SET DP020-MSG-INFORMATIONAL                      TRKCS133
061000                                   TO TRUE                        TRKCS133
061100             END-IF                                               TRKCS133
061200                                                                  TRKCS133
061300         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             TRKCS133
061400             IF  ASC-USE-SELECTION-QUEUE                             CL**3
061500                 IF ASC-FORCAST-PO-LIST                              CL**3
061600                     PERFORM 2150-GET-PREV-RECORD                    CL**3
061700                 ELSE                                                CL**3
061800                     PERFORM 2155-GET-PREV-RECORD                    CL**3
061900                 END-IF                                              CL**3
062000                 IF PS-LIST-END                                   TRKCS133
062100                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         TRKCS133
062200                     SET PS-NO-LIST-END                           TRKCS133
062300                                   TO TRUE                        TRKCS133
062400                 ELSE                                             TRKCS133
062500                     PERFORM 4000-BUILD-INITIAL-PANEL             TRKCS133
062600                 END-IF                                           TRKCS133
062700             ELSE                                                 TRKCS133
062800                 MOVE PC-TSYMSG-00069                             TRKCS133
062900                                   TO DP020-MSG-NUMBER            TRKCS133
063000                 SET DP020-MSG-INFORMATIONAL                      TRKCS133
063100                                   TO TRUE                        TRKCS133
063200             END-IF                                               TRKCS133
063300                                                                  TRKCS133
063400         WHEN DP020-SRC-AID = DP016-ENTER                         TRKCS133
063500             CONTINUE                                             TRKCS133
063600                                                                  TRKCS133
063700         WHEN OTHER                                               TRKCS133
063800             SET DP013-NO-ROLLBACK                                TRKCS133
063900                 DP013-XCTL-DISPLAY-RESTART                       TRKCS133
064000                 DP013-CICS-ABEND  TO TRUE                        TRKCS133
064100             MOVE '2100-CHECK-FUNCTION-KEY'                       TRKCS133
064200                                   TO DP013-PARAGRAPH             TRKCS133
064300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      TRKCS133
064400                                   TO DP013-MESSAGE-TEXT (1)      TRKCS133
064500             PERFORM DP013-0000-PROCESS-ABEND                     TRKCS133
064600     END-EVALUATE.                                                TRKCS133
064700 EJECT                                                            TRKCS133
064800******************************************************************TRKCS133
064900** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **TRKCS133
065000** INTER-APPLICATION COMMAREA.                                  **TRKCS133
065100******************************************************************TRKCS133
065200 2110-PREPARE-INTER-APPL-COMM.                                    TRKCS133
065300*    MOVE ASC-MSG-NUMBER-N         TO DP058-MESSAGE-NUMBER.       TRKCS133
065400                                                                  TRKCS133
065500*----------------------------------------------------------------*TRKCS133
065600*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*TRKCS133
065700*----------------------------------------------------------------*TRKCS133
065800                                                                  TRKCS133
065900 2140-GET-NEXT-RECORD.                                            TRKCS133
066000                                                                  TRKCS133
066100     ADD +1                       TO ASC-SEL-SUB.                 TRKCS133
066200                                                                  TRKCS133
066300     IF  ASC-SEL-SUB > TR018-MAX-ITEMS                            TRKCS133
066400         ADD +1                   TO ASC-SEL-ITEM                 TRKCS133
066500         MOVE +1                  TO ASC-SEL-SUB                  TRKCS133
066600     END-IF.                                                      TRKCS133
066700                                                                  TRKCS133
066800     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                TRKCS133
066900         PERFORM 9100-READ-SEL-QUEUE                              TRKCS133
067000         IF  TR018-ITEM (ASC-SEL-SUB) > ZERO                      TRKCS133
067100             MOVE TR018-PO-NBR  (ASC-SEL-SUB)                     TRKCS133
067200                                  TO ASC-KEY-PO-NBR               TRKCS133
067300             MOVE ASC-KEY-PO-NBR      TO DK-PO-NBR                        
067400             MOVE ASC-KEY-SHIPT-ID    TO DK-SHIPT-ID                      
067500             MOVE TR018-EXPTED-CART-CNT (ASC-SEL-SUB)             TRKCS133
067600                                  TO ASC-EXPTED-CART-CNT-N        TRKCS133
067700             MOVE TR018-REC-SEQ-NBR (ASC-SEL-SUB)                 TRKCS133
067800                                  TO ASC-REC-SEQ-NBR              TRKCS133
067900             SET TR018-INQ (ASC-SEL-SUB)                          TRKCS133
068000                 ASC-NOT-DELETED  TO TRUE                         TRKCS133
068100             PERFORM 9200-REWRITE-SEL-QUEUE                       TRKCS133
068200         ELSE                                                     TRKCS133
068300             SUBTRACT +1 FROM ASC-SEL-SUB                         TRKCS133
068400             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             TRKCS133
068500             SET DP020-MSG-INFORMATIONAL                          TRKCS133
068600                 PS-LIST-END             TO TRUE                  TRKCS133
068700         END-IF                                                   TRKCS133
068800     ELSE                                                         TRKCS133
068900         SUBTRACT +1 FROM ASC-SEL-ITEM                            TRKCS133
069000         MOVE TR018-MAX-ITEMS     TO ASC-SEL-SUB                  TRKCS133
069100         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             TRKCS133
069200         SET DP020-MSG-INFORMATIONAL                              TRKCS133
069300             PS-LIST-END             TO TRUE                      TRKCS133
069400     END-IF.                                                      TRKCS133
069500                                                                  TRKCS133
069600                                                                  TRKCS133
069700 2145-GET-NEXT-RECORD.                                            TRKCS133
069800                                                                  TRKCS133
069900     ADD +1                       TO ASC-SEL-SUB.                 TRKCS133
070000     IF  ASC-SEL-SUB > RC013-MAX-ITEMS                            TRKCS133
070100         ADD +1                   TO ASC-SEL-ITEM                 TRKCS133
070200         MOVE +1                  TO ASC-SEL-SUB                  TRKCS133
070300     END-IF.                                                      TRKCS133
070400     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                TRKCS133
070500         PERFORM 9100-READ-SEL-QUEUE                              TRKCS133
070600         IF  RC013-ITEM (ASC-SEL-SUB) > ZERO                      TRKCS133
070700             MOVE RC013-OPER-UNT-ID (ASC-SEL-SUB)                 TRKCS133
070800                                       TO ASC-KEY-OPER-UNT-ID     TRKCS133
070900             MOVE RC013-FCLTY-ID (ASC-SEL-SUB)                    TRKCS133
071000                                  TO ASC-KEY-FCLTY-ID             TRKCS133
071100             MOVE RC013-PRO-NBR  (ASC-SEL-SUB)                    TRKCS133
071200                                   TO ASC-PRO-NBR                 TRKCS133
071300             MOVE RC013-BOL-NBR (ASC-SEL-SUB)                     TRKCS133
071400                                   TO ASC-BOL-NBR                 TRKCS133
071500             MOVE RC013-SHIPT-ID (ASC-SEL-SUB)                    TRKCS133
071600                                  TO ASC-KEY-SHIPT-ID             TRKCS133
071700                                     DK-SHIPT-ID                  TRKCS133
071800             MOVE RC013-PO-NBR   (ASC-SEL-SUB)                    TRKCS133
071900                                  TO ASC-KEY-PO-NBR               TRKCS133
072000             MOVE ASC-KEY-PO-NBR  TO DK-PO-NBR                    TRKCS133
072100             MOVE RC013-REC-SEQ-NBR (ASC-SEL-SUB)                 TRKCS133
072200                                  TO ASC-REC-SEQ-NBR              TRKCS133
072300             MOVE ZERO            TO ASC-EXPTED-CART-CNT-N        TRKCS133
072400             SET RC013-INQ (ASC-SEL-SUB)                                  
072500                 ASC-NOT-DELETED  TO TRUE                         TRKCS133
072600             PERFORM 9205-REWRITE-SEL-QUEUE                       TRKCS133
072700         ELSE                                                     TRKCS133
072800             SUBTRACT +1 FROM ASC-SEL-SUB                         TRKCS133
072900             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             TRKCS133
073000             SET DP020-MSG-INFORMATIONAL TO TRUE                  TRKCS133
073100             SET PS-LIST-END             TO TRUE                  TRKCS133
073200         END-IF                                                   TRKCS133
073300     ELSE                                                         TRKCS133
073400         SUBTRACT +1 FROM ASC-SEL-ITEM                            TRKCS133
073500         MOVE RC013-MAX-ITEMS     TO ASC-SEL-SUB                  TRKCS133
073600         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             TRKCS133
073700         SET DP020-MSG-INFORMATIONAL TO TRUE                      TRKCS133
073800         SET PS-LIST-END             TO TRUE                      TRKCS133
073900     END-IF.                                                      TRKCS133
074000                                                                  TRKCS133
074100/                                                                 TRKCS133
074200*----------------------------------------------------------------*TRKCS133
074300*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *TRKCS133
074400*    PROCESSED.                                                  *TRKCS133
074500*----------------------------------------------------------------*TRKCS133
074600                                                                  TRKCS133
074700 2150-GET-PREV-RECORD.                                            TRKCS133
074800                                                                  TRKCS133
074900     SUBTRACT +1 FROM ASC-SEL-SUB.                                TRKCS133
075000                                                                  TRKCS133
075100     IF  ASC-SEL-SUB < +1                                         TRKCS133
075200         SUBTRACT +1 FROM ASC-SEL-ITEM                            TRKCS133
075300         MOVE TR018-MAX-ITEMS     TO ASC-SEL-SUB                  TRKCS133
075400     END-IF.                                                      TRKCS133
075500                                                                  TRKCS133
075600     IF  ASC-SEL-ITEM > ZERO                                      TRKCS133
075700         PERFORM 9100-READ-SEL-QUEUE                              TRKCS133
075800         MOVE TR018-PO-NBR  (ASC-SEL-SUB)                         TRKCS133
075900                                  TO ASC-KEY-PO-NBR               TRKCS133
076000         MOVE ASC-KEY-PO-NBR      TO DK-PO-NBR                    TRKCS133
076100         MOVE ASC-KEY-SHIPT-ID    TO DK-SHIPT-ID                          
076200         MOVE TR018-EXPTED-CART-CNT (ASC-SEL-SUB)                 TRKCS133
076300                                  TO ASC-EXPTED-CART-CNT          TRKCS133
076400         MOVE TR018-REC-SEQ-NBR (ASC-SEL-SUB)                     TRKCS133
076500                                  TO ASC-REC-SEQ-NBR              TRKCS133
076600         SET TR018-INQ (ASC-SEL-SUB)                              TRKCS133
076700                 ASC-NOT-DELETED  TO TRUE                         TRKCS133
076800         PERFORM 9200-REWRITE-SEL-QUEUE                           TRKCS133
076900     ELSE                                                         TRKCS133
077000         MOVE +1                  TO ASC-SEL-ITEM                 TRKCS133
077100                                     ASC-SEL-SUB                  TRKCS133
077200         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             TRKCS133
077300         SET DP020-MSG-INFORMATIONAL                              TRKCS133
077400             PS-LIST-END             TO TRUE                      TRKCS133
077500     END-IF.                                                      TRKCS133
077600                                                                  TRKCS133
077700                                                                     CL**3
077800 2155-GET-PREV-RECORD.                                               CL**4
077900                                                                     CL**3
078000     SUBTRACT +1 FROM ASC-SEL-SUB.                                   CL**3
078100                                                                     CL**3
078200     IF  ASC-SEL-SUB < +1                                            CL**3
078300         SUBTRACT +1 FROM ASC-SEL-ITEM                               CL**3
078400         MOVE RC013-MAX-ITEMS     TO ASC-SEL-SUB                     CL**3
078500     END-IF.                                                         CL**3
078600                                                                     CL**3
078700     IF  ASC-SEL-ITEM > ZERO                                         CL**3
078800         PERFORM 9100-READ-SEL-QUEUE                                 CL**3
078900         MOVE RC013-OPER-UNT-ID (ASC-SEL-SUB)                        CL**3
079000                                   TO ASC-KEY-OPER-UNT-ID            CL**3
079100         MOVE RC013-FCLTY-ID (ASC-SEL-SUB)                           CL**3
079200                              TO ASC-KEY-FCLTY-ID                    CL**3
079300         MOVE RC013-PRO-NBR  (ASC-SEL-SUB)                           CL**3
079400                               TO ASC-PRO-NBR                        CL**3
079500         MOVE RC013-BOL-NBR (ASC-SEL-SUB)                            CL**3
079600                               TO ASC-BOL-NBR                        CL**3
079700         MOVE RC013-SHIPT-ID (ASC-SEL-SUB)                           CL**3
079800                              TO ASC-KEY-SHIPT-ID                    CL**3
079900                                 DK-SHIPT-ID                         CL**3
080000         MOVE RC013-PO-NBR   (ASC-SEL-SUB)                           CL**3
080100                              TO ASC-KEY-PO-NBR                      CL**3
080200         MOVE ASC-KEY-PO-NBR  TO DK-PO-NBR                           CL**3
080300         MOVE RC013-REC-SEQ-NBR (ASC-SEL-SUB)                        CL**3
080400                              TO ASC-REC-SEQ-NBR                     CL**3
080500         MOVE ZERO            TO ASC-EXPTED-CART-CNT-N               CL**3
080600         SET RC013-INQ (ASC-SEL-SUB)                                      
080700                 ASC-NOT-DELETED  TO TRUE                                 
080800         PERFORM 9205-REWRITE-SEL-QUEUE                              CL**3
080900     ELSE                                                            CL**3
081000         MOVE +1                  TO ASC-SEL-ITEM                    CL**3
081100                                     ASC-SEL-SUB                     CL**3
081200         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER                CL**3
081300         SET DP020-MSG-INFORMATIONAL                                 CL**3
081400             PS-LIST-END             TO TRUE                         CL**3
081500     END-IF.                                                         CL**3
081600                                                                     CL**3
081700                                                                  TRKCS133
081800*                                                                 TRKCS133
081900*----------------------------------------------------------------*TRKCS133
082000* SET UP THE INFORMATION FOR THE CURRENT PO                      *TRKCS133
082100*----------------------------------------------------------------*TRKCS133
082200                                                                  TRKCS133
082300 4000-BUILD-INITIAL-PANEL.                                        TRKCS133
082400                                                                  TRKCS133
082500     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       TRKCS133
082600     MOVE -1                       TO AEXPCNTL.                   TRKCS133
082700                                                                  TRKCS133
082800     PERFORM 4010-SELECT-STAT-CD-INFO.                            TRKCS133
082900                                                                  TRKCS133
083000     IF PS-FOUND                                                     CL**7
083100         PERFORM 4030-SELECT-DPT-BYR                                 CL**7
083200     END-IF.                                                         CL**7
083300     PERFORM 4040-DETERMINE-NO-DISTRO.                               CL**6
083400     PERFORM 4050-SELECT-TSHPTPO.                                    CL**6
083500     PERFORM 4060-GET-ENT-NAME.                                      CL**6
083600     PERFORM 4070-SELECT-TSHIPMT.                                    CL**6
083700     PERFORM 4020-SELECT-TPLNSHP.                                    CL**6
083800                                                                     CL**6
083900     MOVE ASC-KEY-OPER-UNT-ID      TO AOPERIDO.                      CL**6
084000     MOVE ASC-KEY-FCLTY-ID         TO AFCLTYO.                       CL**6
084100     MOVE ASC-KEY-FCLTY-NME        TO AOPRDESO.                      CL**6
084200     MOVE ASC-PRO-NBR              TO AFBILLO.                       CL**6
084300     MOVE ASC-BOL-NBR              TO ABOLO.                         CL**6
084400     MOVE ASC-NO-DISTRO-MSG        TO ANODISTO.                      CL**6
084500     MOVE ASC-KEY-PO-NBR           TO APONBRO.                       CL**6
084600     MOVE ASC-PO-STATUS-DESC       TO APOSTATO.                      CL**6
084700                                                                     CL**6
084800     IF ASC-DONT-SHIP-BEF-DTE = '01/01/0001'                         CL**6
084900         MOVE SPACES               TO ADNSDTEO                       CL**6
085000     ELSE                                                            CL**6
085100         MOVE ASC-DONT-SHIP-BEF-DTE                                  CL**6
085200                                   TO ADNSDTEO                       CL**6
085300     END-IF.                                                         CL**6
085400                                                                     CL**6
085500     IF ASC-CANCEL-DTE = '01/01/0001'                                CL**6
085600         MOVE SPACES               TO ACANDTEO                       CL**6
085700     ELSE                                                            CL**6
085800         MOVE ASC-CANCEL-DTE       TO ACANDTEO                       CL**6
085900     END-IF.                                                         CL**6
086000                                                                     CL**6
086100     IF ASC-EXT-CAN-DTE = '01/01/0001'                               CL**6
086200         MOVE SPACES               TO AEXCDTEO                       CL**6
086300     ELSE                                                            CL**6
086400         MOVE ASC-EXT-CAN-DTE      TO AEXCDTEO                       CL**6
086500     END-IF.                                                         CL**6
086600                                                                     CL**6
086700     MOVE ASC-PACKSLIP-IND         TO APCKSLPO.                      CL**6
086800     MOVE ASC-EXPTED-CART-CNT-N    TO AEXPCNTO.                      CL**6
086900     MOVE ASC-DEPT-NBR-N           TO ADPTNBRO.                      CL**6
087000     MOVE ASC-BUYER-NME            TO ABYRNMEO.                      CL**6
087100     MOVE ASC-VENDOR-NME           TO AVNDNMEO.                      CL**6
087200     MOVE ASC-ASN-CART-CNT         TO AASNCNTO.                      CL**6
087300     MOVE ASC-FOR-CART-CNT         TO AFORCNTO.                      CL**6
087400                                                                     CL**6
087500     IF ASC-REC-SEQ-NBR = 0                                          CL**6
087600         IF PS-SHIPMENT-EXIST                                        CL**6
087700*            CONFIRMATION MESSAGE                                    CL**6
087800             MOVE PC-TSYMSG-00354  TO DP020-MSG-NUMBER               CL**6
087900         ELSE                                                        CL**6
088000*            ALREADY DELETED MESSAGE                                 CL**6
088100             MOVE PC-TSYMSG-00115  TO DP020-MSG-NUMBER               CL**6
088200         END-IF                                                      CL**6
088300     ELSE                                                            CL**6
088400*         RECEIVER EXISTS MESSAGE                                    CL**6
088500          MOVE PC-TSYMSG-01007     TO DP020-MSG-NUMBER               CL**6
088600     END-IF.                                                         CL**6
088700                                                                     CL**6
088800     SET DP020-MSG-INFORMATIONAL   TO TRUE.                          CL**6
088900                                                                  TRKCS133
089000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        TRKCS133
089100                                                                  TRKCS133
089200 4010-SELECT-STAT-CD-INFO.                                        TRKCS133
089300*----------------------------------------------------------------*TRKCS133
089400****   SELECT THE TPURCHS INFORMATION   *****                     TRKCS133
089500*----------------------------------------------------------------*TRKCS133
089600     PERFORM WITH TEST AFTER                                      TRKCS133
089700         VARYING PV-RETRY-COUNTER                                 TRKCS133
089800         FROM 1 BY 1                                              TRKCS133
089900         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 TRKCS133
090000                 OR SQLCODE = 0                                   TRKCS133
090100                 OR SQLCODE = +100)                               TRKCS133
090200                                                                  TRKCS133
090300         EXEC SQL                                                 TRKCS133
090400             SELECT STATUS_CDE                                    TRKCS133
090500                   ,DEPT_NBR                                      TRKCS133
090600                   ,ENT_ID                                        TRKCS133
090700             INTO   :PURCHS-STATUS-CDE                            TRKCS133
090800                   ,:PURCHS-DEPT-NBR                              TRKCS133
090900                   ,:PURCHS-ENT-ID                                TRKCS133
091000             FROM   TPURCHS                                       TRKCS133
091100             WHERE  PO_NBR         = :DK-PO-NBR                   TRKCS133
091200             AND    VER_STATUS_CDE = :PC-ACTIVE                   TRKCS133
091300         END-EXEC                                                 TRKCS133
091400                                                                  TRKCS133
091500         EVALUATE TRUE                                            TRKCS133
091600             WHEN SQLCODE = +0                                    TRKCS133
091700                  SET PS-FOUND TO TRUE                            TRKCS133
091800                  MOVE PURCHS-DEPT-NBR TO ASC-DEPT-NBR-N          TRKCS133
091900                  MOVE PURCHS-ENT-ID   TO ASC-ENT-ID              TRKCS133
092000                                                                  TRKCS133
092100             WHEN SQLCODE = +100                                  TRKCS133
092200                  SET PS-NOT-FOUND TO TRUE                        TRKCS133
092300                  MOVE SPACES  TO ASC-NO-DISTRO-MSG               TRKCS133
092400                                  ASC-PO-STATUS-DESC              TRKCS133
092500                                  ASC-DONT-SHIP-BEF-DTE           TRKCS133
092600                                  ASC-CANCEL-DTE                  TRKCS133
092700                                  ASC-EXT-CAN-DTE                 TRKCS133
092800                                  ASC-DEPT-NBR                    TRKCS133
092900                                  ASC-BUYER-NME                   TRKCS133
093000             WHEN SQLCODE = -904                                  TRKCS133
093100             WHEN SQLCODE = -911                                  TRKCS133
093200             WHEN SQLCODE = -913                                  TRKCS133
093300                  CONTINUE                                        TRKCS133
093400                                                                  TRKCS133
093500             WHEN OTHER                                           TRKCS133
093600                  MOVE '4010-SELECT-STAT-CD-INFO'                 TRKCS133
093700                                  TO DP013-PARAGRAPH              TRKCS133
093800                  MOVE 'UNSUCCESSFUL SELECT ON TPURCHS  '         TRKCS133
093900                                  TO DP013-MESSAGE-TEXT (1)       TRKCS133
094000                  MOVE SQLCA      TO DP013-SQLCA                  TRKCS133
094100                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     TRKCS133
094200                  SET DP013-DB2-ABEND                             TRKCS133
094300                      DP013-XCTL-DISPLAY-RESTART                  TRKCS133
094400                                  TO TRUE                         TRKCS133
094500                  PERFORM DP013-0000-PROCESS-ABEND                TRKCS133
094600         END-EVALUATE                                             TRKCS133
094700     END-PERFORM.                                                 TRKCS133
094800                                                                  TRKCS133
094900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         TRKCS133
095000         MOVE '4010-SELECT-STAT-CD-INFO'                          TRKCS133
095100                         TO DP013-PARAGRAPH                       TRKCS133
095200         MOVE 'UNSUCCESSFUL SELECT ON TPURCHS  '                  TRKCS133
095300                         TO DP013-MESSAGE-TEXT (1)                TRKCS133
095400         MOVE SQLCA      TO DP013-SQLCA                           TRKCS133
095500         MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)              TRKCS133
095600         SET DP013-DB2-ABEND                                      TRKCS133
095700             DP013-XCTL-DISPLAY-RESTART                           TRKCS133
095800                         TO TRUE                                  TRKCS133
095900         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
096000     END-IF.                                                      TRKCS133
096100                                                                  TRKCS133
096200*                                                                 TRKCS133
096300****   GET THE STATUS DESCRIPTION       *****                     TRKCS133
096400*                                                                 TRKCS133
096500     IF PS-FOUND                                                  TRKCS133
096600        PERFORM WITH TEST AFTER                                   TRKCS133
096700            VARYING PV-RETRY-COUNTER                              TRKCS133
096800            FROM 1 BY 1                                           TRKCS133
096900            UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES              TRKCS133
097000                    OR SQLCODE = 0                                TRKCS133
097100                    OR SQLCODE = +100)                            TRKCS133
097200                                                                  TRKCS133
097300            EXEC SQL                                              TRKCS133
097400                SELECT STATUS_DESC                                TRKCS133
097500                INTO   :STATCD-STATUS-DESC                        TRKCS133
097600                FROM   TSTATCD                                    TRKCS133
097700                WHERE  STATUS_CDE     = :PURCHS-STATUS-CDE        TRKCS133
097800                AND    STATUS_TYP_CDE = 'P'                       TRKCS133
097900            END-EXEC                                              TRKCS133
098000                                                                  TRKCS133
098100            EVALUATE TRUE                                         TRKCS133
098200                WHEN SQLCODE = +0                                 TRKCS133
098300                     MOVE PURCHS-STATUS-CDE  TO ASC-PO-STATUS     TRKCS133
098400                     MOVE STATCD-STATUS-DESC TO ASC-PO-STATUS-DESCTRKCS133
098500                                                                  TRKCS133
098600                     EVALUATE PURCHS-STATUS-CDE                   TRKCS133
098700                        WHEN PC-PO-ACTIVE                         TRKCS133
098800                        WHEN PC-APPROVED                          TRKCS133
098900                             MOVE DP015-BLUE         TO APOSTATC  TRKCS133
099000                             MOVE DP015-HL-OFF       TO APOSTATH  TRKCS133
099100                        WHEN OTHER                                TRKCS133
099200                             MOVE DP015-YELLOW       TO APOSTATC  TRKCS133
099300                             MOVE DP015-REVERSE      TO APOSTATH  TRKCS133
099400                     END-EVALUATE                                 TRKCS133
099500                                                                  TRKCS133
099600                WHEN SQLCODE = +100                               TRKCS133
099700                     SET PS-NOT-FOUND TO TRUE                     TRKCS133
099800                WHEN SQLCODE = -904                               TRKCS133
099900                WHEN SQLCODE = -911                               TRKCS133
100000                WHEN SQLCODE = -913                               TRKCS133
100100                     CONTINUE                                     TRKCS133
100200                                                                  TRKCS133
100300                WHEN OTHER                                        TRKCS133
100400                     MOVE '4010-SELECT-STAT-CD-INFO'              TRKCS133
100500                                     TO DP013-PARAGRAPH           TRKCS133
100600                     MOVE 'UNSUCCESSFUL SELECT ON TSTATCD  '      TRKCS133
100700                                     TO DP013-MESSAGE-TEXT (1)    TRKCS133
100800                     MOVE SQLCA      TO DP013-SQLCA               TRKCS133
100900                     MOVE 'TSTATCD ' TO DP013-DB2-TABLE-NAME (1)  TRKCS133
101000                     SET DP013-DB2-ABEND                          TRKCS133
101100                         DP013-XCTL-DISPLAY-RESTART               TRKCS133
101200                                     TO TRUE                      TRKCS133
101300                     PERFORM DP013-0000-PROCESS-ABEND             TRKCS133
101400            END-EVALUATE                                          TRKCS133
101500        END-PERFORM                                               TRKCS133
101600     END-IF.                                                      TRKCS133
101700                                                                  TRKCS133
101800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         TRKCS133
101900         MOVE '4010-SELECT-STAT-CD-INFO'                          TRKCS133
102000                         TO DP013-PARAGRAPH                       TRKCS133
102100         MOVE 'UNSUCCESSFUL SELECT ON TSTATCD  '                  TRKCS133
102200                         TO DP013-MESSAGE-TEXT (1)                TRKCS133
102300         MOVE SQLCA      TO DP013-SQLCA                           TRKCS133
102400         MOVE 'TSTATCD ' TO DP013-DB2-TABLE-NAME (1)              TRKCS133
102500         SET DP013-DB2-ABEND                                      TRKCS133
102600             DP013-XCTL-DISPLAY-RESTART                           TRKCS133
102700                         TO TRUE                                  TRKCS133
102800         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
102900     END-IF.                                                      TRKCS133
103000                                                                  TRKCS133
103100 4020-SELECT-TPLNSHP.                                             TRKCS133
103200*----------------------------------------------------------------*TRKCS133
103300*  SELECT THE NEEDED INFORMATION FROM THE TPLNSHP TABLE           TRKCS133
103400*----------------------------------------------------------------*TRKCS133
103500                                                                  TRKCS133
103600     PERFORM WITH TEST AFTER                                      TRKCS133
103700         VARYING PV-RETRY-COUNTER                                 TRKCS133
103800         FROM 1 BY 1                                              TRKCS133
103900         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 TRKCS133
104000                 OR SQLCODE = +100                                TRKCS133
104100                 OR SQLCODE = 0 )                                 TRKCS133
104200                                                                  TRKCS133
104300         EXEC SQL                                                 TRKCS133
104400             SELECT DONT_SHIP_BEF_DTE                             TRKCS133
104500                   ,CAN_IFNOT_SHIP_DTE                            TRKCS133
104600                   ,EXT_CAN_DTE                                   TRKCS133
104700             INTO   :PLNSHP-DONT-SHIP-BEF-DTE                     TRKCS133
104800                   ,:PLNSHP-CAN-IFNOT-SHIP-DTE                    TRKCS133
104900                   ,:PLNSHP-EXT-CAN-DTE                           TRKCS133
105000             FROM   TPLNSHP                                       TRKCS133
105100             WHERE  PO_NBR         = :DK-PO-NBR                   TRKCS133
105200             AND    VER_STATUS_CDE = :PC-ACTIVE                   TRKCS133
105300         END-EXEC                                                 TRKCS133
105400                                                                  TRKCS133
105500         EVALUATE TRUE                                            TRKCS133
105600             WHEN SQLCODE = +0                                    TRKCS133
105700                MOVE PLNSHP-DONT-SHIP-BEF-DTE TO PV-TEMP-DATE     TRKCS133
105800                MOVE PV-DATE-CCYY  TO PV-WK-DTE-CCYY              TRKCS133
105900                MOVE PV-DATE-MM    TO PV-WK-DTE-MM                TRKCS133
106000                MOVE PV-DATE-DD    TO PV-WK-DTE-DD                TRKCS133
106100                MOVE PV-WORK-DATE  TO ASC-DONT-SHIP-BEF-DTE       TRKCS133
106200                                                                  TRKCS133
106300                MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO PV-TEMP-DATE    TRKCS133
106400                MOVE PV-DATE-CCYY  TO PV-WK-DTE-CCYY              TRKCS133
106500                MOVE PV-DATE-MM    TO PV-WK-DTE-MM                TRKCS133
106600                MOVE PV-DATE-DD    TO PV-WK-DTE-DD                TRKCS133
106700                MOVE PV-WORK-DATE  TO ASC-CANCEL-DTE              TRKCS133
106800                                                                  TRKCS133
106900                MOVE PLNSHP-EXT-CAN-DTE TO PV-TEMP-DATE           TRKCS133
107000                MOVE PV-DATE-CCYY  TO PV-WK-DTE-CCYY              TRKCS133
107100                MOVE PV-DATE-MM    TO PV-WK-DTE-MM                TRKCS133
107200                MOVE PV-DATE-DD    TO PV-WK-DTE-DD                TRKCS133
107300                MOVE PV-WORK-DATE  TO ASC-EXT-CAN-DTE             TRKCS133
107400                                                                  TRKCS133
107500             WHEN SQLCODE = +100                                  TRKCS133
107600                MOVE SPACES        TO ASC-DONT-SHIP-BEF-DTE       TRKCS133
107700                                      ASC-CANCEL-DTE              TRKCS133
107800                                      ASC-EXT-CAN-DTE             TRKCS133
107900                                                                  TRKCS133
108000             WHEN SQLCODE = -904                                  TRKCS133
108100             WHEN SQLCODE = -911                                  TRKCS133
108200             WHEN SQLCODE = -913                                  TRKCS133
108300                  CONTINUE                                        TRKCS133
108400                                                                  TRKCS133
108500             WHEN OTHER                                           TRKCS133
108600                  MOVE '4020-SELECT-TPLNSHP'                      TRKCS133
108700                                  TO DP013-PARAGRAPH              TRKCS133
108800                  MOVE 'UNSUCCESSFUL SELECT ON TPLNSHP  '         TRKCS133
108900                                  TO DP013-MESSAGE-TEXT (1)       TRKCS133
109000                  MOVE SQLCA      TO DP013-SQLCA                  TRKCS133
109100                  MOVE 'TPLNSHP ' TO DP013-DB2-TABLE-NAME (1)     TRKCS133
109200                  SET DP013-DB2-ABEND                             TRKCS133
109300                      DP013-XCTL-DISPLAY-RESTART                  TRKCS133
109400                                  TO TRUE                         TRKCS133
109500                  PERFORM DP013-0000-PROCESS-ABEND                TRKCS133
109600         END-EVALUATE                                             TRKCS133
109700     END-PERFORM.                                                 TRKCS133
109800                                                                  TRKCS133
109900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         TRKCS133
110000         MOVE '4020-SELECT-TPLNSHP'                               TRKCS133
110100                         TO DP013-PARAGRAPH                       TRKCS133
110200         MOVE 'UNSUCCESSFUL SELECT ON TPLNSHP  '                  TRKCS133
110300                         TO DP013-MESSAGE-TEXT (1)                TRKCS133
110400         MOVE SQLCA      TO DP013-SQLCA                           TRKCS133
110500         MOVE 'TPLNSHP ' TO DP013-DB2-TABLE-NAME (1)              TRKCS133
110600         SET DP013-DB2-ABEND                                      TRKCS133
110700             DP013-XCTL-DISPLAY-RESTART                           TRKCS133
110800                         TO TRUE                                  TRKCS133
110900         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
111000     END-IF.                                                      TRKCS133
111100                                                                  TRKCS133
111200     IF PLNSHP-EXT-CAN-DTE = '0001-01-01'                         TRKCS133
111300                                                                  TRKCS133
111400         EVALUATE TRUE                                            TRKCS133
111500             WHEN ((SHIPMT-VEND-SHIP-DTE >=                       TRKCS133
111600                               PLNSHP-DONT-SHIP-BEF-DTE)          TRKCS133
111700              AND  (SHIPMT-VEND-SHIP-DTE <=                       TRKCS133
111800                               PLNSHP-CAN-IFNOT-SHIP-DTE))        TRKCS133
111900                  MOVE DP015-HL-OFF  TO ADNSDTEH                  TRKCS133
112000                  MOVE DP015-HL-OFF  TO ACANDTEH                  TRKCS133
112100                  MOVE DP015-HL-OFF  TO AEXCDTEH                  TRKCS133
112200                                                                  TRKCS133
112300             WHEN (SHIPMT-VEND-SHIP-DTE <                         TRKCS133
112400                               PLNSHP-DONT-SHIP-BEF-DTE)          TRKCS133
112500             WHEN (SHIPMT-VEND-SHIP-DTE >                         TRKCS133
112600                               PLNSHP-CAN-IFNOT-SHIP-DTE)         TRKCS133
112700                  MOVE DP015-REVERSE TO ADNSDTEH                  TRKCS133
112800                  MOVE DP015-REVERSE TO ACANDTEH                  TRKCS133
112900                  MOVE DP015-HL-OFF  TO AEXCDTEH                  TRKCS133
113000         END-EVALUATE                                             TRKCS133
113100                                                                  TRKCS133
113200     ELSE                                                         TRKCS133
113300         EVALUATE TRUE                                            TRKCS133
113400             WHEN ((SHIPMT-VEND-SHIP-DTE >=                       TRKCS133
113500                               PLNSHP-DONT-SHIP-BEF-DTE)          TRKCS133
113600              AND  (SHIPMT-VEND-SHIP-DTE <=                       TRKCS133
113700                               PLNSHP-EXT-CAN-DTE ))              TRKCS133
113800                  MOVE DP015-HL-OFF  TO ADNSDTEH                  TRKCS133
113900                  MOVE DP015-HL-OFF  TO AEXCDTEH                  TRKCS133
114000                  MOVE DP015-HL-OFF  TO ACANDTEH                  TRKCS133
114100                                                                  TRKCS133
114200             WHEN (SHIPMT-VEND-SHIP-DTE <                         TRKCS133
114300                               PLNSHP-DONT-SHIP-BEF-DTE)          TRKCS133
114400             WHEN (SHIPMT-VEND-SHIP-DTE >                         TRKCS133
114500                               PLNSHP-EXT-CAN-DTE )               TRKCS133
114600                  MOVE DP015-REVERSE TO ADNSDTEH                  TRKCS133
114700                  MOVE DP015-HL-OFF  TO ACANDTEH                  TRKCS133
114800                  MOVE DP015-REVERSE TO AEXCDTEH                  TRKCS133
114900         END-EVALUATE                                             TRKCS133
115000     END-IF.                                                      TRKCS133
115100                                                                  TRKCS133
115200                                                                  TRKCS133
115300 4030-SELECT-DPT-BYR.                                             TRKCS133
115400*----------------------------------------------------------------*TRKCS133
115500*  SELECT THE NEEDED INFORMATION FROM THE TMDSEAR AND TRSPBAR     TRKCS133
115600*  TABLES                                                         TRKCS133
115700*----------------------------------------------------------------*TRKCS133
115800                                                                  TRKCS133
115900     PERFORM WITH TEST AFTER                                      TRKCS133
116000         VARYING PV-RETRY-COUNTER                                 TRKCS133
116100         FROM 1 BY 1                                              TRKCS133
116200         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 TRKCS133
116300                 OR SQLCODE = 0                                   TRKCS133
116400                 OR SQLCODE = +100)                               TRKCS133
116500                                                                  TRKCS133
116600         EXEC SQL                                                 TRKCS133
116700             SELECT MDSEAR_DKEY                                   TRKCS133
116800                   ,BYR_NBR                                       TRKCS133
116900                   ,MDSEAR_DESC                                   TRKCS133
117000             INTO   :MDSEAR-DKEY                                  TRKCS133
117100                   ,:MDSEAR-BYR-NBR                               TRKCS133
117200                   ,:MDSEAR-DESC                                  TRKCS133
117300             FROM   TMDSEAR                                       TRKCS133
117400             WHERE  DEPT_NBR       = :PURCHS-DEPT-NBR                CL**7
117500             AND    MDSELV_CDE     = 'DPT'                        TRKCS133
117600             AND    CURRENT DATE BETWEEN STRT_DTE AND END_DTE     TRKCS133
117700         END-EXEC                                                 TRKCS133
117800                                                                  TRKCS133
117900         EVALUATE TRUE                                            TRKCS133
118000             WHEN SQLCODE = +0                                    TRKCS133
118100                  CONTINUE                                        TRKCS133
118200                                                                  TRKCS133
118300             WHEN SQLCODE = +100                                  TRKCS133
118400                  SET PS-DPT-NOT-FOUND TO TRUE                    TRKCS133
118500             WHEN SQLCODE = -904                                  TRKCS133
118600             WHEN SQLCODE = -911                                  TRKCS133
118700             WHEN SQLCODE = -913                                  TRKCS133
118800                  CONTINUE                                        TRKCS133
118900                                                                  TRKCS133
119000             WHEN OTHER                                           TRKCS133
119100                  MOVE '4030-SELECT-DPT-BYR'                      TRKCS133
119200                                  TO DP013-PARAGRAPH              TRKCS133
119300                  MOVE 'UNSUCCESSFUL SELECT ON TMDSEAR  '         TRKCS133
119400                                  TO DP013-MESSAGE-TEXT (1)       TRKCS133
119500                  MOVE SQLCA      TO DP013-SQLCA                  TRKCS133
119600                  MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     TRKCS133
119700                  SET DP013-DB2-ABEND                             TRKCS133
119800                      DP013-XCTL-DISPLAY-RESTART                  TRKCS133
119900                                  TO TRUE                         TRKCS133
120000                  PERFORM DP013-0000-PROCESS-ABEND                TRKCS133
120100         END-EVALUATE                                             TRKCS133
120200     END-PERFORM.                                                 TRKCS133
120300                                                                  TRKCS133
120400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         TRKCS133
120500         MOVE '4030-SELECT-DPT-BYR'                               TRKCS133
120600                         TO DP013-PARAGRAPH                       TRKCS133
120700         MOVE 'UNSUCCESSFUL SELECT ON TMDSEAR  '                  TRKCS133
120800                         TO DP013-MESSAGE-TEXT (1)                TRKCS133
120900         MOVE SQLCA      TO DP013-SQLCA                           TRKCS133
121000         MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)              TRKCS133
121100         SET DP013-DB2-ABEND                                      TRKCS133
121200             DP013-XCTL-DISPLAY-RESTART                           TRKCS133
121300                         TO TRUE                                  TRKCS133
121400         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
121500     END-IF.                                                      TRKCS133
121600                                                                  TRKCS133
121700*                                                                 TRKCS133
121800****   SELECT THE TRSPBAR INFORMATION   *****                     TRKCS133
121900*                                                                 TRKCS133
122000     IF PS-DPT-NOT-FOUND                                          TRKCS133
122100        CONTINUE                                                  TRKCS133
122200     ELSE                                                         TRKCS133
122300        PERFORM WITH TEST AFTER                                   TRKCS133
122400            VARYING PV-RETRY-COUNTER                              TRKCS133
122500            FROM 1 BY 1                                           TRKCS133
122600            UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES              TRKCS133
122700                    OR SQLCODE = 0)                               TRKCS133
122800                                                                  TRKCS133
122900            EXEC SQL                                              TRKCS133
123000                SELECT WORKER_NBR                                 TRKCS133
123100                      ,WORKER_FIR_NAME                            TRKCS133
123200                      ,WORKER_LAST_NAME                           TRKCS133
123300                INTO   :RSPBAR-WORKER-NBR                         TRKCS133
123400                      ,:RSPBAR-WORKER-FIR-NAME                    TRKCS133
123500                      ,:RSPBAR-WORKER-LAST-NAME                   TRKCS133
123600                FROM   TRSPBAR                                    TRKCS133
123700                WHERE  MDSEAR_DKEY    = :MDSEAR-DKEY              TRKCS133
123800                AND    RSPLVL_CDE    = 'BYR'                      TRKCS133
123900                AND    CURRENT DATE BETWEEN WORKER_STRT_DTE AND   TRKCS133
124000                                            WORKER_END_DTE        TRKCS133
124100            END-EXEC                                              TRKCS133
124200                                                                  TRKCS133
124300            EVALUATE TRUE                                         TRKCS133
124400                WHEN SQLCODE = +0                                 TRKCS133
124500                  MOVE RSPBAR-WORKER-FIR-NAME TO PV-W-FIRST-NAME  TRKCS133
124600                  MOVE RSPBAR-WORKER-LAST-NAME TO PV-W-LAST-NAME  TRKCS133
124700                  MOVE PV-W-FIRST-NAME TO PV-WORKER-FIRST         TRKCS133
124800                  MOVE PV-W-LAST-NAME  TO PV-WORKER-LAST          TRKCS133
124900                  MOVE PV-WORKER-NAME  TO ASC-BUYER-NME           TRKCS133
125000                                                                  TRKCS133
125100                WHEN SQLCODE = -904                               TRKCS133
125200                WHEN SQLCODE = -911                               TRKCS133
125300                WHEN SQLCODE = -913                               TRKCS133
125400                     CONTINUE                                     TRKCS133
125500                                                                  TRKCS133
125600                WHEN OTHER                                        TRKCS133
125700                     MOVE '4030-SELECT-DPT-BYR'                   TRKCS133
125800                                     TO DP013-PARAGRAPH           TRKCS133
125900                     MOVE 'UNSUCCESSFUL SELECT ON TRSPBAR  '      TRKCS133
126000                                     TO DP013-MESSAGE-TEXT (1)    TRKCS133
126100                     MOVE SQLCA      TO DP013-SQLCA               TRKCS133
126200                     MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (1)  TRKCS133
126300                     SET DP013-DB2-ABEND                          TRKCS133
126400                         DP013-XCTL-DISPLAY-RESTART               TRKCS133
126500                                     TO TRUE                      TRKCS133
126600                     PERFORM DP013-0000-PROCESS-ABEND             TRKCS133
126700            END-EVALUATE                                          TRKCS133
126800        END-PERFORM                                               TRKCS133
126900     END-IF.                                                      TRKCS133
127000                                                                  TRKCS133
127100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         TRKCS133
127200         MOVE '4030-SELECT-DPT-BYR'                               TRKCS133
127300                         TO DP013-PARAGRAPH                       TRKCS133
127400         MOVE 'UNSUCCESSFUL SELECT ON TRSPBAR  '                  TRKCS133
127500                         TO DP013-MESSAGE-TEXT (1)                TRKCS133
127600         MOVE SQLCA      TO DP013-SQLCA                           TRKCS133
127700         MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (1)              TRKCS133
127800         SET DP013-DB2-ABEND                                      TRKCS133
127900             DP013-XCTL-DISPLAY-RESTART                           TRKCS133
128000                         TO TRUE                                  TRKCS133
128100         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
128200     END-IF.                                                      TRKCS133
128300                                                                  TRKCS133
128400                                                                  TRKCS133
128500 4040-DETERMINE-NO-DISTRO.                                        TRKCS133
128600******************************************************************TRKCS133
128700*    THIS PARAGRAPH DETERMINES IF THE 'NO DISTRO' SHOULD BE       TRKCS133
128800*    DISPLAYED FOR THE PO.                                        TRKCS133
128900******************************************************************TRKCS133
129000                                                                  TRKCS133
129100                                                                  TRKCS133
129200     PERFORM 4100-OPEN-PO-CSR.                                    TRKCS133
129300     PERFORM 4110-FETCH-PO-CSR.                                   TRKCS133
129400     SET PS-NOT-DONE TO TRUE.                                     TRKCS133
129500     MOVE ASC-KEY-OPER-UNT-ID TO PV-OPER-UNT-ID.                  TRKCS133
129600     PERFORM 4120-PROCESS-PO-CSR UNTIL PS-DONE.                   TRKCS133
129700                                                                  TRKCS133
129800     IF PS-DISPLAY-DISTRO-MSG                                     TRKCS133
129900        MOVE 'NO DISTRO'      TO ASC-NO-DISTRO-MSG                TRKCS133
130000     ELSE                                                         TRKCS133
130100        MOVE SPACES           TO ASC-NO-DISTRO-MSG                TRKCS133
130200     END-IF.                                                      TRKCS133
130300                                                                  TRKCS133
130400 4050-SELECT-TSHPTPO.                                             TRKCS133
130500*----------------------------------------------------------------*TRKCS133
130600*  SELECT THE NEEDED INFORMATION FROM THE TSHPTPO TABLE           TRKCS133
130700*----------------------------------------------------------------*TRKCS133
130800                                                                  TRKCS133
130900     PERFORM WITH TEST AFTER                                      TRKCS133
131000         VARYING PV-RETRY-COUNTER                                 TRKCS133
131100         FROM 1 BY 1                                              TRKCS133
131200         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 TRKCS133
131300                 OR SQLCODE = +100                                TRKCS133
131400                 OR SQLCODE = 0)                                  TRKCS133
131500                                                                  TRKCS133
131600         EXEC SQL                                                 TRKCS133
131700             SELECT PKSL_IND                                      TRKCS133
131800                  , EXPTED_CART_CNT                               TRKCS133
131900             INTO   :SHPTPO-PKSL-IND                              TRKCS133
132000                  , :SHPTPO-EXPTED-CART-CNT                       TRKCS133
132100             FROM   TSHPTPO                                       TRKCS133
132200             WHERE  PO_NBR         = :DK-PO-NBR                   TRKCS133
132300             AND    SHIPT_ID       = :DK-SHIPT-ID                 TRKCS133
132400         END-EXEC                                                 TRKCS133
132500                                                                  TRKCS133
132600         EVALUATE TRUE                                            TRKCS133
132700             WHEN SQLCODE = +0                                    TRKCS133
132800                  MOVE SHPTPO-PKSL-IND   TO ASC-PACKSLIP-IND      TRKCS133
132900                  MOVE SHPTPO-EXPTED-CART-CNT                     TRKCS133
133000                                         TO ASC-EXPTED-CART-CNT-N TRKCS133
133100                  SET PS-SHIPMENT-EXIST  TO TRUE                  TRKCS133
133200                                                                  TRKCS133
133300             WHEN SQLCODE = +100                                  TRKCS133
133400                  MOVE SPACES            TO ASC-PACKSLIP-IND      TRKCS133
133500                  MOVE ZERO              TO ASC-EXPTED-CART-CNT-N TRKCS133
133600                  SET PS-SHIPMENT-DOESNT-EXIST                    TRKCS133
133700                                         TO TRUE                  TRKCS133
133800                                                                  TRKCS133
133900             WHEN SQLCODE = -904                                  TRKCS133
134000             WHEN SQLCODE = -911                                  TRKCS133
134100             WHEN SQLCODE = -913                                  TRKCS133
134200                  CONTINUE                                        TRKCS133
134300                                                                  TRKCS133
134400             WHEN OTHER                                           TRKCS133
134500                  MOVE '4050-SELECT-TSHPTPO'                      TRKCS133
134600                                  TO DP013-PARAGRAPH              TRKCS133
134700                  MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '         TRKCS133
134800                                  TO DP013-MESSAGE-TEXT (1)       TRKCS133
134900                  MOVE DK-PO-NBR  TO DP013-MESSAGE-TEXT (2)       TRKCS133
135000                  MOVE DK-SHIPT-ID                                TRKCS133
135100                                  TO DP013-MESSAGE-TEXT (3)       TRKCS133
135200                  MOVE SQLCA      TO DP013-SQLCA                  TRKCS133
135300                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     TRKCS133
135400                  SET DP013-DB2-ABEND                             TRKCS133
135500                      DP013-XCTL-DISPLAY-RESTART                  TRKCS133
135600                                  TO TRUE                         TRKCS133
135700                  PERFORM DP013-0000-PROCESS-ABEND                TRKCS133
135800         END-EVALUATE                                             TRKCS133
135900     END-PERFORM.                                                 TRKCS133
136000                                                                  TRKCS133
136100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         TRKCS133
136200         MOVE '4050-SELECT-TSHPTPO'  TO DP013-PARAGRAPH           TRKCS133
136300         MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '                  TRKCS133
136400                                     TO DP013-MESSAGE-TEXT (1)    TRKCS133
136500         MOVE DK-PO-NBR              TO DP013-MESSAGE-TEXT (2)    TRKCS133
136600         MOVE DK-SHIPT-ID            TO DP013-MESSAGE-TEXT (3)    TRKCS133
136700         MOVE SQLCA                  TO DP013-SQLCA               TRKCS133
136800         MOVE 'TSHPTPO '             TO DP013-DB2-TABLE-NAME (1)  TRKCS133
136900         SET DP013-DB2-ABEND                                      TRKCS133
137000             DP013-XCTL-DISPLAY-RESTART                           TRKCS133
137100                                     TO TRUE                      TRKCS133
137200         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
137300     END-IF.                                                      TRKCS133
137400                                                                  TRKCS133
137500*----------------------------------------------------------------*TRKCS133
137600*    GET THE VENDOR NAME                                         *TRKCS133
137700*----------------------------------------------------------------*TRKCS133
137800 4060-GET-ENT-NAME.                                               TRKCS133
137900                                                                  TRKCS133
138000     PERFORM                                                      TRKCS133
138100         WITH TEST AFTER                                          TRKCS133
138200         VARYING PV-RETRY-COUNTER                                 TRKCS133
138300         FROM 1 BY 1                                              TRKCS133
138400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               TRKCS133
138500             OR (SQLCODE = +0)                                    TRKCS133
138600             OR (SQLCODE = +100))                                 TRKCS133
138700                                                                  TRKCS133
138800         EXEC SQL                                                 TRKCS133
138900              SELECT                                              TRKCS133
139000                     ENT_NAME_DESC                                TRKCS133
139100                   , STATUS_CDE                                   TRKCS133
139200                   , NEW_STR_PO_IND                               TRKCS133
139300                INTO                                              TRKCS133
139400                     :ENTNME-ENT-NAME-DESC                        TRKCS133
139500                   , :PURCHS-STATUS-CDE                           TRKCS133
139600                   , :PURCHS-NEW-STR-PO-IND                       TRKCS133
139700                FROM TPURCHS A                                    TRKCS133
139800                    ,TENTNME B                                    TRKCS133
139900               WHERE A.PO_NBR         = :DK-PO-NBR                TRKCS133
140000                 AND A.VER_STATUS_CDE = 'A'                       TRKCS133
140100                 AND B.TYPE_CDE       = '01'                      TRKCS133
140200                 AND A.ENT_ID = B.ENT_ID                          TRKCS133
140300         END-EXEC                                                 TRKCS133
140400                                                                  TRKCS133
140500         EVALUATE TRUE                                            TRKCS133
140600             WHEN SQLCODE = +0                                    TRKCS133
140700             WHEN SQLCODE = -904                                  TRKCS133
140800             WHEN SQLCODE = -913                                  TRKCS133
140900                  MOVE ENTNME-ENT-NAME-DESC                       TRKCS133
141000                                  TO ASC-VENDOR-NME               TRKCS133
141100             WHEN SQLCODE = +100                                  TRKCS133
141200                  MOVE SPACES     TO ASC-VENDOR-NME               TRKCS133
141300             WHEN SQLWARN0 NOT = SPACES                           TRKCS133
141400             WHEN SQLCODE < +0                                    TRKCS133
141500             WHEN SQLCODE > +0                                    TRKCS133
141600                  MOVE '4060-GET-ENT-NAME'                        TRKCS133
141700                                  TO DP013-PARAGRAPH              TRKCS133
141800                  MOVE 'UNSUCCESSFUL SELECT ON TENTNME TABLE'     TRKCS133
141900                                  TO DP013-MESSAGE-TEXT (1)       TRKCS133
142000                  MOVE DK-SHIPT-ID TO DP013-MESSAGE-TEXT (2)      TRKCS133
142100                  MOVE SQLCA      TO DP013-SQLCA                  TRKCS133
142200                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     TRKCS133
142300                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)     TRKCS133
142400                  SET DP013-DB2-ABEND                             TRKCS133
142500                      DP013-XCTL-DISPLAY-RESTART                  TRKCS133
142600                                  TO TRUE                         TRKCS133
142700                  PERFORM DP013-0000-PROCESS-ABEND                TRKCS133
142800         END-EVALUATE                                             TRKCS133
142900     END-PERFORM.                                                 TRKCS133
143000                                                                  TRKCS133
143100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        TRKCS133
143200         MOVE '4060-GET-ENT-NAME  '                               TRKCS133
143300                                  TO DP013-PARAGRAPH              TRKCS133
143400         MOVE 'MAX RETRIES EXCEEDED ON SELECT TENTNME TABLE'      TRKCS133
143500                                  TO DP013-MESSAGE-TEXT (1)       TRKCS133
143600         MOVE SQLCA               TO DP013-SQLCA                  TRKCS133
143700         MOVE 'TPURCHS'           TO DP013-DB2-TABLE-NAME (1)     TRKCS133
143800         MOVE 'TENTNME'           TO DP013-DB2-TABLE-NAME (2)     TRKCS133
143900         SET DP013-DB2-ABEND                                      TRKCS133
144000             DP013-XCTL-DISPLAY-RESTART                           TRKCS133
144100                                  TO TRUE                         TRKCS133
144200         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
144300     END-IF.                                                      TRKCS133
144400                                                                  TRKCS133
144500*----------------------------------------------------------------*TRKCS133
144600* SELECT THE VENDOR SHIP DATE.                                   *TRKCS133
144700*----------------------------------------------------------------*TRKCS133
144800                                                                  TRKCS133
144900 4070-SELECT-TSHIPMT.                                             TRKCS133
145000     PERFORM                                                      TRKCS133
145100         WITH TEST AFTER                                          TRKCS133
145200         VARYING PV-RETRY-COUNTER                                 TRKCS133
145300         FROM 1 BY 1                                              TRKCS133
145400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               TRKCS133
145500                   OR (SQLCODE = ZERO))                           TRKCS133
145600                                                                  TRKCS133
145700                                                                  TRKCS133
145800         EXEC SQL                                                 TRKCS133
145900              SELECT                                              TRKCS133
146000                       VEND_SHIP_DTE                              TRKCS133
146100                   ,   EXPTED_PKG_QTY                             TRKCS133
146200              INTO                                                TRKCS133
146300                      :SHIPMT-VEND-SHIP-DTE                       TRKCS133
146400                   ,  :SHIPMT-EXPTED-PKG-QTY                      TRKCS133
146500              FROM                                                TRKCS133
146600                       TSHIPMT                                    TRKCS133
146700              WHERE                                               TRKCS133
146800                       SHIPT_ID = :DK-SHIPT-ID                    TRKCS133
146900         END-EXEC                                                 TRKCS133
147000                                                                  TRKCS133
147100         EVALUATE TRUE                                            TRKCS133
147200             WHEN SQLCODE = ZERO                                  TRKCS133
147300                 MOVE SHIPMT-EXPTED-PKG-QTY                       TRKCS133
147400                                 TO ASC-EXPTED-PKG-QTY            TRKCS133
147500             WHEN SQLCODE = -904                                  TRKCS133
147600             WHEN SQLCODE = -913                                  TRKCS133
147700                 CONTINUE                                         TRKCS133
147800             WHEN SQLWARN0 NOT = SPACES                           TRKCS133
147900             WHEN SQLCODE < ZERO                                  TRKCS133
148000             WHEN SQLCODE > ZERO                                  TRKCS133
148100                 MOVE '4070-SELECT-TSHIPMT'                       TRKCS133
148200                                   TO DP013-PARAGRAPH             TRKCS133
148300                 MOVE 'OPEN SYSTEM MESSAGE CURSOR - '             TRKCS133
148400                                   TO DP013-MESSAGE-TEXT (1)      TRKCS133
148500                 MOVE SQLCA        TO DP013-SQLCA                 TRKCS133
148600                 MOVE 'TSHPTMT '   TO DP013-DB2-TABLE-NAME (1)    TRKCS133
148700                 SET DP013-DB2-ABEND                              TRKCS133
148800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           TRKCS133
148900                 PERFORM DP013-0000-PROCESS-ABEND                 TRKCS133
149000         END-EVALUATE                                             TRKCS133
149100     END-PERFORM.                                                 TRKCS133
149200*                                                                 TRKCS133
149300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        TRKCS133
149400         MOVE '4070-SELECT-TSHIPMT'                               TRKCS133
149500                                   TO DP013-PARAGRAPH             TRKCS133
149600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING SELECT     '   TRKCS133
149700                                   TO DP013-MESSAGE-TEXT (1)      TRKCS133
149800         MOVE SQLCA                TO DP013-SQLCA                 TRKCS133
149900         MOVE 'TSHIPMT '           TO DP013-DB2-TABLE-NAME (1)    TRKCS133
150000         SET DP013-DB2-ABEND                                      TRKCS133
150100             DP013-XCTL-DISPLAY-RESTART                           TRKCS133
150200                                   TO TRUE                        TRKCS133
150300         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
150400     END-IF.                                                      TRKCS133
150500                                                                  TRKCS133
150600 EJECT                                                            TRKCS133
150700                                                                  TRKCS133
150800*----------------------------------------------------------------*TRKCS133
150900* OPEN THE PO-CSR                                                *TRKCS133
151000*----------------------------------------------------------------*TRKCS133
151100 4100-OPEN-PO-CSR.                                                TRKCS133
151200                                                                  TRKCS133
151300     PERFORM                                                      TRKCS133
151400         WITH TEST AFTER                                          TRKCS133
151500         VARYING PV-RETRY-COUNTER                                 TRKCS133
151600         FROM 1 BY 1                                              TRKCS133
151700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               TRKCS133
151800            OR (SQLCODE = +0))                                    TRKCS133
151900*                                                                 TRKCS133
152000         EXEC SQL                                                 TRKCS133
152100              OPEN PO_CSR                                         TRKCS133
152200         END-EXEC                                                 TRKCS133
152300                                                                  TRKCS133
152400         EVALUATE TRUE                                            TRKCS133
152500             WHEN SQLCODE = +0                                    TRKCS133
152600                  CONTINUE                                        TRKCS133
152700             WHEN SQLCODE = -904                                  TRKCS133
152800             WHEN SQLCODE = -913                                  TRKCS133
152900                  CONTINUE                                        TRKCS133
153000             WHEN SQLWARN0 NOT = SPACE                            TRKCS133
153100             WHEN SQLCODE  NOT = +0                               TRKCS133
153200                  MOVE '4100-OPEN-PO-CSR'                         TRKCS133
153300                                   TO DP013-PARAGRAPH             TRKCS133
153400                  MOVE 'OPEN PO CURSOR'                           TRKCS133
153500                                   TO DP013-MESSAGE-TEXT (1)      TRKCS133
153600                  MOVE SQLCA       TO DP013-SQLCA                 TRKCS133
153700                  MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1)    TRKCS133
153800                  SET DP013-DB2-ABEND                             TRKCS133
153900                                   TO TRUE                        TRKCS133
154000                  PERFORM DP013-0000-PROCESS-ABEND                TRKCS133
154100         END-EVALUATE                                             TRKCS133
154200     END-PERFORM.                                                 TRKCS133
154300                                                                  TRKCS133
154400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        TRKCS133
154500         MOVE '4100-OPEN-PO-CSR' TO DP013-PARAGRAPH               TRKCS133
154600         MOVE 'MAX RETRIES EXCEEDED FOR OPEN PO CURSOR'           TRKCS133
154700                                   TO DP013-MESSAGE-TEXT (1)      TRKCS133
154800         MOVE SQLCA                TO DP013-SQLCA                 TRKCS133
154900         SET DP013-DB2-ABEND       TO TRUE                        TRKCS133
155000         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
155100     END-IF.                                                      TRKCS133
155200                                                                  TRKCS133
155300 4110-FETCH-PO-CSR.                                               TRKCS133
155400                                                                  TRKCS133
155500     EXEC SQL                                                     TRKCS133
155600          FETCH PO_CSR                                            TRKCS133
155700          INTO :PURITM-PO-LNE-NBR                                 TRKCS133
155800     END-EXEC                                                     TRKCS133
155900                                                                  TRKCS133
156000     EVALUATE TRUE                                                TRKCS133
156100         WHEN SQLCODE = +0                                        TRKCS133
156200              CONTINUE                                            TRKCS133
156300                                                                  TRKCS133
156400         WHEN SQLCODE = +100                                      TRKCS133
156500              SET PS-DONE TO TRUE                                 TRKCS133
156600                                                                  TRKCS133
156700         WHEN SQLWARN0 NOT = SPACE                                TRKCS133
156800         WHEN SQLCODE < +0                                        TRKCS133
156900         WHEN SQLCODE > +0                                        TRKCS133
157000              MOVE '4110-FETCH-PO-CSR'                            TRKCS133
157100                                   TO DP013-PARAGRAPH             TRKCS133
157200              MOVE 'FETCH PO CURSOR'                              TRKCS133
157300                                   TO DP013-MESSAGE-TEXT (1)      TRKCS133
157400              MOVE SQLCA           TO DP013-SQLCA                 TRKCS133
157500              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    TRKCS133
157600              SET DP013-DB2-ABEND  TO TRUE                        TRKCS133
157700              PERFORM DP013-0000-PROCESS-ABEND                    TRKCS133
157800     END-EVALUATE.                                                TRKCS133
157900                                                                  TRKCS133
158000                                                                  TRKCS133
158100 4120-PROCESS-PO-CSR.                                             TRKCS133
158200                                                                  TRKCS133
158300     PERFORM                                                      TRKCS133
158400         WITH TEST AFTER                                          TRKCS133
158500         VARYING PV-RETRY-COUNTER                                 TRKCS133
158600         FROM 1 BY 1                                              TRKCS133
158700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               TRKCS133
158800            OR  (SQLCODE = +100)                                  TRKCS133
158900            OR  (SQLCODE = +0))                                   TRKCS133
159000                                                                  TRKCS133
159100         EXEC SQL                                                 TRKCS133
159200            SELECT  PLAN_NBR                                      TRKCS133
159300            INTO   :ALLPLN-PLAN-NBR                               TRKCS133
159400            FROM    TALLPLN                                       TRKCS133
159500            WHERE   PO_NBR     = :DK-PO-NBR                       TRKCS133
159600            AND     PO_LNE_NBR = :PURITM-PO-LNE-NBR               TRKCS133
159700            AND     DEST_NBR   = :PV-OPER-UNT-ID                  TRKCS133
159800            AND     STATUS_CDE = :PC-PO-ACTIVE                    TRKCS133
159900         END-EXEC                                                 TRKCS133
160000                                                                  TRKCS133
160100         EVALUATE TRUE                                            TRKCS133
160200             WHEN SQLCODE = -904                                  TRKCS133
160300             WHEN SQLCODE = -913                                  TRKCS133
160400                  CONTINUE                                        TRKCS133
160500                                                                  TRKCS133
160600             WHEN SQLCODE = +0                                    TRKCS133
160700                  SET PS-DISTRO         TO TRUE                   TRKCS133
160800                                                                  TRKCS133
160900             WHEN SQLCODE = +100                                  TRKCS133
161000                  SET PS-NO-DISTRO      TO TRUE                   TRKCS133
161100                                                                  TRKCS133
161200             WHEN SQLWARN0 NOT = SPACE                            TRKCS133
161300             WHEN SQLCODE < +0                                    TRKCS133
161400             WHEN SQLCODE > +0                                    TRKCS133
161500                  MOVE '4120-PROCESS-PO-CSR '                     TRKCS133
161600                                   TO DP013-PARAGRAPH             TRKCS133
161700                  MOVE 'SELECT ON TALLPLN'                        TRKCS133
161800                                   TO DP013-MESSAGE-TEXT (1)      TRKCS133
161900                  MOVE SQLCA       TO DP013-SQLCA                 TRKCS133
162000                  MOVE 'TALLPLN'   TO DP013-DB2-TABLE-NAME (1)    TRKCS133
162100                  SET DP013-DB2-ABEND                             TRKCS133
162200                      DP013-XCTL-DISPLAY-RESTART                  TRKCS133
162300                                   TO TRUE                        TRKCS133
162400                  PERFORM DP013-0000-PROCESS-ABEND                TRKCS133
162500         END-EVALUATE                                             TRKCS133
162600     END-PERFORM.                                                 TRKCS133
162700                                                                  TRKCS133
162800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        TRKCS133
162900         MOVE '4120-PROCESS-PO-CSR '                              TRKCS133
163000                                   TO DP013-PARAGRAPH             TRKCS133
163100         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   TRKCS133
163200                                   TO DP013-MESSAGE-TEXT (1)      TRKCS133
163300         MOVE 'ON TABLE TALLPLN '  TO DP013-MESSAGE-TEXT (2)      TRKCS133
163400         MOVE SQLCA                TO DP013-SQLCA                 TRKCS133
163500         SET DP013-DB2-ABEND                                      TRKCS133
163600             DP013-XCTL-DISPLAY-RESTART                           TRKCS133
163700                                   TO TRUE                        TRKCS133
163800         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
163900     END-IF.                                                      TRKCS133
164000                                                                  TRKCS133
164100                                                                  TRKCS133
164200     IF PS-DISTRO                                                 TRKCS133
164300        PERFORM                                                   TRKCS133
164400            WITH TEST AFTER                                       TRKCS133
164500            VARYING PV-RETRY-COUNTER                              TRKCS133
164600            FROM 1 BY 1                                           TRKCS133
164700            UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)            TRKCS133
164800               OR  (SQLCODE = +100)                               TRKCS133
164900               OR  (SQLCODE = -811)                               TRKCS133
165000               OR  (SQLCODE = +0))                                TRKCS133
165100                                                                  TRKCS133
165200            EXEC SQL                                              TRKCS133
165300               SELECT  PO_NBR                                     TRKCS133
165400               INTO   :MESTDS-PO-NBR                              TRKCS133
165500               FROM    TMESTDS                                    TRKCS133
165600               WHERE   PO_NBR     = :DK-PO-NBR                    TRKCS133
165700               AND     PO_LNE_NBR = :PURITM-PO-LNE-NBR            TRKCS133
165800               AND     PLAN_NBR   = :ALLPLN-PLAN-NBR              TRKCS133
165900            END-EXEC                                              TRKCS133
166000                                                                  TRKCS133
166100            EVALUATE TRUE                                         TRKCS133
166200                WHEN SQLCODE = -904                               TRKCS133
166300                WHEN SQLCODE = -913                               TRKCS133
166400                     CONTINUE                                     TRKCS133
166500                                                                  TRKCS133
166600                WHEN SQLCODE = +0                                 TRKCS133
166700                WHEN SQLCODE = -811                               TRKCS133
166800                     SET PS-DISTRO         TO TRUE                TRKCS133
166900                                                                  TRKCS133
167000                WHEN SQLCODE = +100                               TRKCS133
167100                     SET PS-NO-DISTRO      TO TRUE                TRKCS133
167200                                                                  TRKCS133
167300                WHEN SQLWARN0 NOT = SPACE                         TRKCS133
167400                WHEN SQLCODE < +0                                 TRKCS133
167500                WHEN SQLCODE > +0                                 TRKCS133
167600                     MOVE '4120-PROCESS-PO-CSR '                  TRKCS133
167700                                      TO DP013-PARAGRAPH          TRKCS133
167800                     MOVE 'SELECT ON TMESTDS'                     TRKCS133
167900                                      TO DP013-MESSAGE-TEXT (1)   TRKCS133
168000                     MOVE SQLCA       TO DP013-SQLCA              TRKCS133
168100                     MOVE 'TMESTDS'   TO DP013-DB2-TABLE-NAME (1) TRKCS133
168200                     SET DP013-DB2-ABEND                          TRKCS133
168300                         DP013-XCTL-DISPLAY-RESTART               TRKCS133
168400                                      TO TRUE                     TRKCS133
168500                     PERFORM DP013-0000-PROCESS-ABEND             TRKCS133
168600            END-EVALUATE                                          TRKCS133
168700        END-PERFORM                                               TRKCS133
168800                                                                  TRKCS133
168900        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     TRKCS133
169000            MOVE '4120-PROCESS-PO-CSR '                           TRKCS133
169100                                      TO DP013-PARAGRAPH          TRKCS133
169200            MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                TRKCS133
169300                                      TO DP013-MESSAGE-TEXT (1)   TRKCS133
169400            MOVE 'ON TABLE TMESTDS '  TO DP013-MESSAGE-TEXT (2)   TRKCS133
169500            MOVE SQLCA                TO DP013-SQLCA              TRKCS133
169600            SET DP013-DB2-ABEND                                   TRKCS133
169700                DP013-XCTL-DISPLAY-RESTART                        TRKCS133
169800                                      TO TRUE                     TRKCS133
169900            PERFORM DP013-0000-PROCESS-ABEND                      TRKCS133
170000        END-IF                                                    TRKCS133
170100     END-IF.                                                      TRKCS133
170200                                                                  TRKCS133
170300     IF PS-NO-DISTRO                                              TRKCS133
170400        SET PS-DISPLAY-DISTRO-MSG TO TRUE                         TRKCS133
170500        SET PS-DONE TO TRUE                                       TRKCS133
170600     ELSE                                                         TRKCS133
170700        PERFORM 4110-FETCH-PO-CSR                                 TRKCS133
170800     END-IF.                                                      TRKCS133
170900                                                                  TRKCS133
171000                                                                  TRKCS133
171100*                                                                 TRKCS133
171200 EJECT                                                            TRKCS133
171300*----------------------------------------------------------------*TRKCS133
171400*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *TRKCS133
171500*----------------------------------------------------------------*TRKCS133
171600                                                                  TRKCS133
171700 4400-MOVE-COMMAREA-TO-SCREEN.                                    TRKCS133
171800                                                                  TRKCS133
171900     MOVE ASC-KEY-PO-NBR         TO APONBRO.                      TRKCS133
172000     MOVE ASC-KEY-OPER-UNT-ID    TO AOPERIDO.                     TRKCS133
172100     MOVE ASC-KEY-FCLTY-ID       TO AFCLTYO.                      TRKCS133
172200     MOVE ASC-KEY-FCLTY-NME      TO AOPRDESO.                     TRKCS133
172300     MOVE ASC-PRO-NBR            TO AFBILLO.                      TRKCS133
172400     MOVE ASC-BOL-NBR            TO ABOLO.                        TRKCS133
172500     MOVE ASC-EXPTED-CART-CNT-N  TO AEXPCNTO.                     TRKCS133
172600     MOVE ASC-DEPT-NBR-N         TO ADPTNBRO.                     TRKCS133
172700     MOVE ASC-NO-DISTRO-MSG      TO ANODISTO.                     TRKCS133
172800     MOVE ASC-PO-STATUS-DESC     TO APOSTATO.                     TRKCS133
172900                                                                  TRKCS133
173000     IF ASC-DONT-SHIP-BEF-DTE = '01/01/0001'                      TRKCS133
173100         MOVE SPACES             TO ADNSDTEO                      TRKCS133
173200     ELSE                                                         TRKCS133
173300         MOVE ASC-DONT-SHIP-BEF-DTE                               TRKCS133
173400                                 TO ADNSDTEO                      TRKCS133
173500     END-IF                                                       TRKCS133
173600                                                                  TRKCS133
173700     IF ASC-CANCEL-DTE = '01/01/0001'                             TRKCS133
173800         MOVE SPACES             TO ACANDTEO                      TRKCS133
173900     ELSE                                                         TRKCS133
174000         MOVE ASC-CANCEL-DTE     TO ACANDTEO                      TRKCS133
174100     END-IF                                                       TRKCS133
174200                                                                  TRKCS133
174300     IF ASC-EXT-CAN-DTE = '01/01/0001'                            TRKCS133
174400         MOVE SPACES             TO AEXCDTEO                      TRKCS133
174500     ELSE                                                         TRKCS133
174600         MOVE ASC-EXT-CAN-DTE    TO AEXCDTEO                      TRKCS133
174700     END-IF                                                       TRKCS133
174800                                                                  TRKCS133
174900     MOVE ASC-BUYER-NME          TO ABYRNMEO.                     TRKCS133
175000     MOVE ASC-ASN-CART-CNT       TO AASNCNTO.                     TRKCS133
175100     MOVE ASC-FOR-CART-CNT       TO AFORCNTO.                     TRKCS133
175200     MOVE ASC-PACKSLIP-IND       TO APCKSLPO.                     TRKCS133
175300     MOVE ASC-VENDOR-NME         TO AVNDNMEO.                     TRKCS133
175400                                                                  TRKCS133
175500 EJECT                                                            TRKCS133
175600*----------------------------------------------------------------*TRKCS133
175700* UPDATE THE ROW ON TSHTPO                                       *TRKCS133
175800*----------------------------------------------------------------*TRKCS133
175900 5000-DELETE-PROCESS.                                             TRKCS133
176000                                                                  TRKCS133
183900     PERFORM 5100-AUDIT-TSHPTPO.                                          
184000                                                                          
184100     PERFORM WITH TEST AFTER                                      TRKCS133
184200         VARYING PV-RETRY-COUNTER                                 TRKCS133
184300         FROM 1 BY 1                                              TRKCS133
184400         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 TRKCS133
184500                 OR SQLCODE = 0                                   TRKCS133
184600                 OR SQLCODE = +100)                               TRKCS133
184700                                                                  TRKCS133
184800         EXEC SQL                                                 TRKCS133
184900             DELETE                                               TRKCS133
185000             FROM   TSHPTPO                                       TRKCS133
185100             WHERE  PO_NBR           = :DK-PO-NBR                 TRKCS133
185200             AND    SHIPT_ID         = :DK-SHIPT-ID               TRKCS133
185300         END-EXEC                                                 TRKCS133
185400                                                                  TRKCS133
185500         EVALUATE TRUE                                            TRKCS133
185600             WHEN SQLCODE = +0                                    TRKCS133
185700                  SET ASC-DELETED TO TRUE                                 
185800             WHEN SQLCODE = +100                                  TRKCS133
185900                   CONTINUE                                       TRKCS133
186000                                                                  TRKCS133
186100             WHEN SQLCODE = -904                                  TRKCS133
186200             WHEN SQLCODE = -911                                  TRKCS133
186300             WHEN SQLCODE = -913                                  TRKCS133
186400                  CONTINUE                                        TRKCS133
186500                                                                  TRKCS133
186600             WHEN OTHER                                           TRKCS133
186700                  MOVE '5000-PROCESS-DELETE'                      TRKCS133
186800                                  TO DP013-PARAGRAPH              TRKCS133
186900                  MOVE 'UNSUCCESSFUL DELETE OF TSHPTPO  '         TRKCS133
187000                                  TO DP013-MESSAGE-TEXT (1)       TRKCS133
187100                  MOVE DK-PO-NBR  TO DP013-MESSAGE-TEXT (2)       TRKCS133
187200                  MOVE DK-SHIPT-ID                                TRKCS133
187300                                  TO DP013-MESSAGE-TEXT (3)       TRKCS133
187400                  MOVE SQLCA      TO DP013-SQLCA                  TRKCS133
187500                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     TRKCS133
187600                  SET DP013-DB2-ABEND                             TRKCS133
187700                      DP013-XCTL-DISPLAY-RESTART                  TRKCS133
187800                                  TO TRUE                         TRKCS133
187900                  PERFORM DP013-0000-PROCESS-ABEND                TRKCS133
188000         END-EVALUATE                                             TRKCS133
188100     END-PERFORM.                                                 TRKCS133
188200                                                                  TRKCS133
188300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         TRKCS133
188400         MOVE '5000-PROCESS-DELETE'  TO DP013-PARAGRAPH           TRKCS133
188500         MOVE 'UNSUCCESSFUL DELETE OF TSHPTPO  '                  TRKCS133
188600                                     TO DP013-MESSAGE-TEXT (1)    TRKCS133
188700         MOVE DK-PO-NBR              TO DP013-MESSAGE-TEXT (2)    TRKCS133
188800         MOVE DK-SHIPT-ID            TO DP013-MESSAGE-TEXT (3)    TRKCS133
188900         MOVE SQLCA                  TO DP013-SQLCA               TRKCS133
189000         MOVE 'TSHPTPO '             TO DP013-DB2-TABLE-NAME (1)  TRKCS133
189100         SET DP013-DB2-ABEND                                      TRKCS133
189200             DP013-XCTL-DISPLAY-RESTART                           TRKCS133
189300                                     TO TRUE                      TRKCS133
189400         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
189500     END-IF.                                                      TRKCS133
189501                                                                  TRKCS133
189502*****************************************************************         
189503*     INSERT A COPY OF THE SHPTPO ROW TO THE AUDIT TRAIL TABLE  *         
189504*     BEFORE DELETING THE SHPTPO TABLE.                         *         
189505*****************************************************************         
189506                                                                          
189507 5100-AUDIT-TSHPTPO.                                                      
189508                                                                          
189509     PERFORM                                                              
189510         WITH TEST AFTER                                                  
189511         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
189512         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
189513                (SQLCODE = ZERO)   OR                                     
189514                (SQLCODE = +100)                                          
189515                                                                          
189516         EXEC SQL                                                         
189517             SELECT SHIPT_ID,                                             
189518                    PO_NBR,                                               
189519                    REC_SEQ_NBR,                                          
189520                    EXPTED_CART_CNT,                                      
189521                    ACTL_CART_CNT,                                        
189522                    DMG_CART_CNT,                                         
189523                    PKSL_IND,                                             
189524                    VEND_NAME,                                            
189525                    FRGT_CHG_AMT,                                         
189526                    LAST_UPD_PGM_ID,                                      
189527                    CRE_USER_ID,                                          
189528                    CARR_CART_CT,                                         
189529                    CARR_LAST_UPD_DTE,                                    
189530                    CARR_LAST_UPD_TIME,                                   
189531                    VEND_CART_CT,                                         
189532                    VEND_LAST_UPD_DTE,                                    
189533                    VEND_LAST_UPD_TIME,                                   
189534                    CRE_TMST,                                             
189535                    LAST_UPD_DTE,                                         
189536                    LAST_UPD_TIME,                                        
189537                    LAST_UPD_USER_ID,                                     
189538                    PRIM_SHIPT_IND                                        
189539                  , SPLT_XMIT_IND                                         
189540                  , SPLT_XMIT_DTE                                         
189541                  , SPLT_XMIT_TM                                          
189542               INTO :SHPTPO-SHIPT-ID,                                     
189543                    :SHPTPO-PO-NBR,                                       
189544                    :SHPTPO-REC-SEQ-NBR,                                  
189545                    :SHPTPO-EXPTED-CART-CNT,                              
189546                    :SHPTPO-ACTL-CART-CNT,                                
189547                    :SHPTPO-DMG-CART-CNT,                                 
189548                    :SHPTPO-PKSL-IND,                                     
189549                    :SHPTPO-VEND-NAME,                                    
189550                    :SHPTPO-FRGT-CHG-AMT,                                 
189551                    :SHPTPO-LAST-UPD-PGM-ID,                              
189552                    :SHPTPO-CRE-USER-ID,                                  
189553                    :SHPTPO-CARR-CART-CT,                                 
189554                    :SHPTPO-CARR-LAST-UPD-DTE,                            
189555                    :SHPTPO-CARR-LAST-UPD-TIME,                           
189556                    :SHPTPO-VEND-CART-CT,                                 
189557                    :SHPTPO-VEND-LAST-UPD-DTE,                            
189600                    :SHPTPO-VEND-LAST-UPD-TIME,                           
189700                    :SHPTPO-CRE-TMST,                                     
189800                    :SHPTPO-LAST-UPD-DTE,                                 
189900                    :SHPTPO-LAST-UPD-TIME,                                
190000                    :SHPTPO-LAST-UPD-USER-ID,                             
190100                    :SHPTPO-PRIM-SHIPT-IND                                
190110                  , :SHPTPO-SPLT-XMIT-IND                                 
190120                  , :SHPTPO-SPLT-XMIT-DTE                                 
190130                  , :SHPTPO-SPLT-XMIT-TM                                  
190200               FROM TSHPTPO                                               
190300              WHERE  PO_NBR           = :DK-PO-NBR                        
190400                AND  SHIPT_ID         = :DK-SHIPT-ID                      
190500         END-EXEC                                                         
190600                                                                          
190700         EVALUATE TRUE                                                    
190800             WHEN SQLCODE = ZERO                                          
190900             WHEN SQLCODE = +100                                          
191000             WHEN SQLCODE = -904                                          
191100             WHEN SQLCODE = -913                                          
191200                 CONTINUE                                                 
191300                                                                          
191400             WHEN SQLWARN0 NOT = SPACE                                    
191500             WHEN SQLCODE  NOT = +0                                       
191600                  MOVE '5100-AUDIT-SHPTPO'                                
191700                                   TO DP013-PARAGRAPH                     
191800                  MOVE 'SELECT SHPPTPO DATA'                              
191900                                   TO DP013-MESSAGE-TEXT (1)              
192000                  MOVE DK-PO-NBR   TO DP013-MESSAGE-TEXT (2)              
192100                  MOVE DK-SHIPT-ID TO DP013-MESSAGE-TEXT (3)              
192200                  MOVE SQLCA       TO DP013-SQLCA                         
192300                  MOVE 'TSHPTPO'   TO DP013-DB2-TABLE-NAME (1)            
192400                  SET DP013-DB2-ABEND                                     
192500                                   TO TRUE                                
192600                  PERFORM DP013-0000-PROCESS-ABEND                        
192700         END-EVALUATE                                                     
192900     END-PERFORM.                                                         
193000                                                                          
193100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
193200         SQLCODE NOT = +0                                                 
193300         MOVE '5100-AUDIT-SHPTPO'                                         
193400                                   TO DP013-PARAGRAPH                     
193500         MOVE 'MAX RETRIES EXCEEDED FOR SELECT TSHPTPO'                   
193600                                   TO DP013-MESSAGE-TEXT (1)              
193700         MOVE DK-PO-NBR            TO DP013-MESSAGE-TEXT (2)              
193800         MOVE DK-SHIPT-ID          TO DP013-MESSAGE-TEXT (3)              
193900         MOVE SQLCA                TO DP013-SQLCA                         
194000         SET DP013-DB2-ABEND       TO TRUE                                
194100         PERFORM DP013-0000-PROCESS-ABEND                                 
194200     END-IF.                                                              
194201                                                                          
194202     IF  SQLCODE = ZERO                                                   
194400         PERFORM 5100-INSERT-TAUSHPO                                      
194401     END-IF.                                                              
194402                                                                          
203200 EJECT                                                                    
203201*****************************************************************         
203202*     INSERT A COPY OF THE SHPTPO ROW TO THE AUDIT TRAIL TABLE  *         
203203*     BEFORE DELETING THE SHPTPO TABLE.                         *         
203204*****************************************************************         
203205                                                                          
203206 5100-INSERT-TAUSHPO.                                                     
203207     PERFORM                                                              
203208         WITH TEST AFTER                                                  
203209         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
203210         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
203211                 SQLCODE = ZERO                                           
203212                                                                          
203213         EXEC SQL                                                         
203214             INSERT INTO TAUSHPO                                          
203215                   (SHIPT_ID,                                             
203216                    PO_NBR,                                               
203218                    REC_SEQ_NBR,                                          
203219                    EXPTED_CART_CNT,                                      
203220                    ACTL_CART_CNT,                                        
203221                    DMG_CART_CNT,                                         
203222                    PKSL_IND,                                             
203223                    VEND_NAME,                                            
203224                    FRGT_CHG_AMT,                                         
203225                    LAST_UPD_PGM_ID,                                      
203226                    CRE_USER_ID,                                          
203227                    CARR_CART_CT,                                         
203228                    CARR_LAST_UPD_DTE,                                    
203229                    CARR_LAST_UPD_TIME,                                   
203230                    VEND_CART_CT,                                         
203231                    VEND_LAST_UPD_DTE,                                    
203232                    VEND_LAST_UPD_TIME,                                   
203233                    CRE_TMST,                                             
203234                    LAST_UPD_DTE,                                         
203235                    LAST_UPD_TIME,                                        
203236                    LAST_UPD_USER_ID,                                     
203237                    PRIM_SHIPT_IND                                        
203238                  , SPLT_XMIT_IND                                         
203239                  , SPLT_XMIT_DTE                                         
203240                  , SPLT_XMIT_TM                                          
203241                  , TRN_CDE )                                             
203242             VALUES                                                       
203243                  (:SHPTPO-SHIPT-ID,                                      
203244                   :SHPTPO-PO-NBR,                                        
203246                   :SHPTPO-REC-SEQ-NBR,                                   
203247                   :SHPTPO-EXPTED-CART-CNT,                               
203248                   :SHPTPO-ACTL-CART-CNT,                                 
203249                   :SHPTPO-DMG-CART-CNT,                                  
203250                   :SHPTPO-PKSL-IND,                                      
203251                   :SHPTPO-VEND-NAME,                                     
203252                   :SHPTPO-FRGT-CHG-AMT,                                  
203253                   :PC-CURRENT-PROGRAM-NAME,                              
203254                   :SHPTPO-CRE-USER-ID,                                   
203255                   :SHPTPO-CARR-CART-CT,                                  
203256                   :SHPTPO-CARR-LAST-UPD-DTE,                             
203257                   :SHPTPO-CARR-LAST-UPD-TIME,                            
203258                   :SHPTPO-VEND-CART-CT,                                  
203259                   :SHPTPO-VEND-LAST-UPD-DTE,                             
203260                   :SHPTPO-VEND-LAST-UPD-TIME,                            
203261                   :SHPTPO-CRE-TMST,                                      
203262                    CURRENT DATE,                                         
203263                    CURRENT TIME,                                         
203264                   :DP020-USERID,                                         
203265                   :SHPTPO-PRIM-SHIPT-IND                                 
203266                 , :SHPTPO-SPLT-XMIT-IND                                  
203267                 , :SHPTPO-SPLT-XMIT-DTE                                  
203268                 , :SHPTPO-SPLT-XMIT-TM                                   
203269                 , :PC-D )                                                
203270         END-EXEC                                                         
203271                                                                          
203272         EVALUATE TRUE                                                    
203273             WHEN SQLCODE = ZERO                                          
203274             WHEN SQLCODE = -904                                          
203275             WHEN SQLCODE = -913                                          
203276                 CONTINUE                                                 
203277                                                                          
203278             WHEN SQLWARN0 NOT = SPACE                                    
203279             WHEN SQLCODE  NOT = +0                                       
203280                  MOVE '5100-INSERT-AUSHPO'                               
203281                                   TO DP013-PARAGRAPH                     
203282                  MOVE 'INSERT TAUSHPO DATA'                              
203283                                   TO DP013-MESSAGE-TEXT (1)              
203284                  MOVE SQLCA       TO DP013-SQLCA                         
203285                  MOVE 'TAUSHPO'   TO DP013-DB2-TABLE-NAME (1)            
203286                  SET DP013-DB2-ABEND                                     
203287                                   TO TRUE                                
203288                  PERFORM DP013-0000-PROCESS-ABEND                        
203289         END-EVALUATE                                                     
203290     END-PERFORM.                                                         
203291                                                                          
203292     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
203293         SQLCODE NOT = +0                                                 
203294         MOVE '5100-INSERT-AUSHPO'                                        
203295                                   TO DP013-PARAGRAPH                     
203296         MOVE 'MAX RETRIES EXCEEDED FOR INSERT TAUSHPO'                   
203297                                   TO DP013-MESSAGE-TEXT (1)              
203298         MOVE SQLCA                TO DP013-SQLCA                         
203299         SET DP013-DB2-ABEND       TO TRUE                                
203300         PERFORM DP013-0000-PROCESS-ABEND                                 
203301     END-IF.                                                              
203302                                                                          
203303 EJECT                                                                    
203400/                                                                         
203500*----------------------------------------------------------------*TRKCS133
203600* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *TRKCS133
203700*----------------------------------------------------------------*TRKCS133
203800 9100-READ-SEL-QUEUE.                                             TRKCS133
203900     IF ASC-FORCAST-PO-LIST                                       TRKCS133
204000         EXEC CICS                                                TRKCS133
204100             READQ TS                                             TRKCS133
204200                 QUEUE (ASC-SEL-QUEUE-NAME)                       TRKCS133
204300                 INTO  (TR018-SHIPMENT-SELECT-RECORD)             TRKCS133
204400                 ITEM  (ASC-SEL-ITEM)                             TRKCS133
204500                 RESP  (PV-CICS-RESPONSE)                         TRKCS133
204600         END-EXEC                                                 TRKCS133
204700     ELSE                                                         TRKCS133
204800         EXEC CICS                                                TRKCS133
204900             READQ TS                                             TRKCS133
205000                 QUEUE (ASC-SEL-QUEUE-NAME)                       TRKCS133
205100                 INTO  (RC013-DC-SELECT-RECORD)                   TRKCS133
205200                 ITEM  (ASC-SEL-ITEM)                             TRKCS133
205300                 RESP  (PV-CICS-RESPONSE)                         TRKCS133
205400         END-EXEC                                                 TRKCS133
205500     END-IF.                                                      TRKCS133
205600                                                                  TRKCS133
205700     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   TRKCS133
205800         CONTINUE                                                 TRKCS133
205900     ELSE                                                         TRKCS133
206000         SET DP013-LOGIC-ABEND                                    TRKCS133
206100             DP013-NO-ROLLBACK     TO TRUE                        TRKCS133
206200         MOVE '9100-READ-SEL-QUEUE'                               TRKCS133
206300                                   TO DP013-PARAGRAPH             TRKCS133
206400         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   TRKCS133
206500                                   TO DP013-MESSAGE-TEXT (1)      TRKCS133
206600         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
206700     END-IF.                                                      TRKCS133
206800                                                                  TRKCS133
206900/                                                                 TRKCS133
207000*----------------------------------------------------------------*TRKCS133
207100* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *TRKCS133
207200*----------------------------------------------------------------*TRKCS133
207300 9200-REWRITE-SEL-QUEUE.                                          TRKCS133
207400     EXEC CICS                                                    TRKCS133
207500          WRITEQ TS                                               TRKCS133
207600              QUEUE  (ASC-SEL-QUEUE-NAME)                         TRKCS133
207700              FROM   (TR018-SHIPMENT-SELECT-RECORD)               TRKCS133
207800              ITEM   (ASC-SEL-ITEM)                               TRKCS133
207900              RESP   (PV-CICS-RESPONSE)                           TRKCS133
208000              REWRITE                                             TRKCS133
208100     END-EXEC.                                                    TRKCS133
208200                                                                  TRKCS133
208300     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               TRKCS133
208400         SET DP013-CICS-ABEND                                     TRKCS133
208500             DP013-NO-ROLLBACK     TO TRUE                        TRKCS133
208600         MOVE '9200-REWRITE-SEL-QUEUE'                            TRKCS133
208700                                   TO DP013-PARAGRAPH             TRKCS133
208800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   TRKCS133
208900                                   TO DP013-MESSAGE-TEXT (1)      TRKCS133
209000         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
209100     END-IF.                                                      TRKCS133
209200                                                                  TRKCS133
209300 9205-REWRITE-SEL-QUEUE.                                          TRKCS133
209400     EXEC CICS                                                    TRKCS133
209500          WRITEQ TS                                               TRKCS133
209600              QUEUE  (ASC-SEL-QUEUE-NAME)                         TRKCS133
209700              FROM   (RC013-DC-SELECT-RECORD)                     TRKCS133
209800              ITEM   (ASC-SEL-ITEM)                               TRKCS133
209900              RESP   (PV-CICS-RESPONSE)                           TRKCS133
210000              REWRITE                                             TRKCS133
210100     END-EXEC.                                                    TRKCS133
210200                                                                  TRKCS133
210300     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               TRKCS133
210400         SET DP013-CICS-ABEND                                     TRKCS133
210500             DP013-NO-ROLLBACK     TO TRUE                        TRKCS133
210600         MOVE '9205-REWRITE-SEL-QUEUE'                            TRKCS133
210700                                   TO DP013-PARAGRAPH             TRKCS133
210800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   TRKCS133
210900                                   TO DP013-MESSAGE-TEXT (1)      TRKCS133
211000         PERFORM DP013-0000-PROCESS-ABEND                         TRKCS133
211100     END-IF.                                                      TRKCS133
211200                                                                  TRKCS133
211300 EJECT                                                            TRKCS133
211400*----------------------------------------------------------------*TRKCS133
211500*    ABEND PROCESSOR MODULE                                      *TRKCS133
211600*----------------------------------------------------------------*TRKCS133
211700                                                                  TRKCS133
211800     COPY DPPD013.                                                TRKCS133
