000100******************************************************************11/20/95
000200 IDENTIFICATION DIVISION.                                         MPKRP025
000300******************************************************************   LV031
000400                                                                  MPKRP025
000500 PROGRAM-ID.             MPKRP025.                                MPKRP025
000600 AUTHOR.                 WILLIAM B. BURT.                         MPKRP025
000700 INSTALLATION.           KOHLS.                                   MPKRP025
000800 DATE-WRITTEN            MAY, 1991.                               MPKRP025
000900 DATE-COMPILED.                                                   MPKRP025
001000                                                                  MPKRP025
001100******************************************************************MPKRP025
001200*  THIS PROGRAM CREATES THE UPC CERTIFICATION EXCEPTION REPORT    MPKRP025
001300******************************************************************MPKRP025
001400                                                                  MPKRP025
001500******************************************************************MPKRP025
001600 ENVIRONMENT DIVISION.                                            MPKRP025
001700******************************************************************MPKRP025
001800                                                                  MPKRP025
001900 CONFIGURATION SECTION.                                           MPKRP025
002000                                                                  MPKRP025
002100 SOURCE-COMPUTER.        IBM-3090.                                MPKRP025
002200 OBJECT-COMPUTER.        IBM-3090.                                MPKRP025
002300                                                                  MPKRP025
002400 INPUT-OUTPUT SECTION.                                            MPKRP025
002500                                                                  MPKRP025
002600 FILE-CONTROL.                                                    MPKRP025
002700                                                                  MPKRP025
002800     SELECT SORT-WORK-FILE                                        MPKRP025
002900         ASSIGN TO SORTWK01                                       MPKRP025
003000                   SORTWK02                                       MPKRP025
003100                   SORTWK03.                                      MPKRP025
003200                                                                  MPKRP025
003300     SELECT UPC-EXCEPTION-REPORT                                  MPKRP025
003400         ASSIGN TO RPT01.                                         MPKRP025
003500                                                                  MPKRP025
003600******************************************************************MPKRP025
003700 DATA DIVISION.                                                   MPKRP025
003800******************************************************************MPKRP025
003900                                                                  MPKRP025
004000 FILE SECTION.                                                    MPKRP025
004100                                                                  MPKRP025
004200 FD  UPC-EXCEPTION-REPORT                                         MPKRP025
004300     RECORDING MODE IS F                                          MPKRP025
004400     LABEL RECORDS ARE STANDARD                                   MPKRP025
004500     BLOCK CONTAINS 0 RECORDS.                                    MPKRP025
004600                                                                  MPKRP025
004700 01  UPC-EXCEPTION-LINE              PIC  X(132).                 MPKRP025
004800                                                                  MPKRP025
004900 SD  SORT-WORK-FILE                                               MPKRP025
005000     RECORD CONTAINS 230 CHARACTERS                                  CL*30
005100     DATA RECORD IS SORT-WORK-RECORD.                             MPKRP025
005200                                                                  MPKRP025
005300 01  SORT-WORK-RECORD.                                            MPKRP025
005400     05  SW-UPC-EXCEPTION-RECORD.                                 MPKRP025
005500         10  SW-DMM-NBR              PIC  X(02).                  MPKRP025
005600         10  SW-DMM-NAME             PIC  X(30).                  MPKRP025
005700         10  SW-BUYER-NBR            PIC  X(03).                  MPKRP025
005800         10  SW-BUYER-NAME           PIC  X(30).                  MPKRP025
005900         10  SW-OPER-UNT-ID          PIC  9(04).                     CL*29
006000         10  SW-PO-NBR               PIC  9(08).                     CL*29
006100         10  SW-REC-SEQ              PIC  9(04).                     CL*27
006200         10  SW-PO-LINE-ITEM-NBR     PIC  9(03).                     CL*29
006300         10  SW-MERCH-DEPT-NBR       PIC  X(03).                  MPKRP025
006400         10  SW-MERCH-CLASS-NBR      PIC  X(02).                  MPKRP025
006500         10  SW-SKU-NBR              PIC  X(08).                  MPKRP025
006600         10  SW-SKU-DESC             PIC  X(25).                  MPKRP025
006700         10  SW-UPC-CODE             PIC  X(13).                  MPKRP025
006800         10  SW-IN-HSE-VNDR-NBR      PIC  X(03).                  MPKRP025
006900         10  SW-IN-HSE-VNDR-NAME     PIC  X(25).                  MPKRP025
007000         10  SW-EXCEPTION-CODE       PIC  X(02).                  MPKRP025
007100         10  SW-EXCEPTION-REASON     PIC  X(65).                  MPKRP025
007200                                                                  MPKRP025
007300******************************************************************MPKRP025
007400 WORKING-STORAGE SECTION.                                         MPKRP025
007500******************************************************************MPKRP025
007600 01  ABEND-CODE                      PIC S9(04)      VALUE ZERO   MPKRP025
007700                                                     COMP SYNC.   MPKRP025
007800                                                                  MPKRP025
007900 01  CC-CONTROL-CARD.                                             MPKRP025
008000     05  CC-CONSTANT                 PIC  X(07)      VALUE SPACE. MPKRP025
008100     05  FILLER                      PIC  X(01)      VALUE SPACE. MPKRP025
008200     05  CC-START-DATE               PIC  X(08)      VALUE SPACE. MPKRP025
008300     05  FILLER  REDEFINES  CC-START-DATE.                        MPKRP025
008400         10  CC-START-MONTH          PIC  9(02).                  MPKRP025
008500             88  CC-VALID-START-MONTH                VALUE 01     MPKRP025
008600                                                      THRU 12.    MPKRP025
008700         10  CC-START-DAY            PIC  9(02).                  MPKRP025
008800             88  CC-VALID-START-DAY                  VALUE 01     MPKRP025
008900                                                      THRU 31.    MPKRP025
009000         10  CC-START-CENTURY-YEAR   PIC  9(04).                  MPKRP025
009100         10  FILLER  REDEFINES  CC-START-CENTURY-YEAR.            MPKRP025
009200             15  CC-START-CENTURY    PIC  9(02).                  MPKRP025
009300             15  CC-START-YEAR       PIC  9(02).                  MPKRP025
009400     05  FILLER                      PIC  X(01)      VALUE SPACE. MPKRP025
009500     05  CC-END-DATE                 PIC  X(08)      VALUE SPACE. MPKRP025
009600     05  FILLER  REDEFINES  CC-END-DATE.                          MPKRP025
009700         10  CC-END-MONTH            PIC  9(02).                  MPKRP025
009800             88  CC-VALID-END-MONTH                  VALUE 01     MPKRP025
009900                                                      THRU 12.    MPKRP025
010000         10  CC-END-DAY              PIC  9(02).                  MPKRP025
010100             88  CC-VALID-END-DAY                    VALUE 01     MPKRP025
010200                                                      THRU 31.    MPKRP025
010300         10  CC-END-CENTURY-YEAR     PIC  9(04).                  MPKRP025
010400         10  FILLER  REDEFINES  CC-END-CENTURY-YEAR.              MPKRP025
010500             15  CC-END-CENTURY      PIC  9(02).                  MPKRP025
010600             15  CC-END-YEAR         PIC  9(02).                  MPKRP025
010700     05  FILLER                      PIC  X(56)      VALUE SPACE. MPKRP025
010800                                                                  MPKRP025
010900 01  CK-CURRENT-KEY-AREA.                                         MPKRP025
011000     05  CK-DMM-NBR                  PIC  9(02)      VALUE ZERO.  MPKRP025
011100     05  CK-BUYER-NBR                PIC  9(03)      VALUE ZERO.  MPKRP025
011200     05  CK-EXCEPTION-CODE           PIC  X(02)      VALUE SPACE. MPKRP025
011300                                                                  MPKRP025
011400 01  DA-DISPLAY-AREAS.                                            MPKRP025
011500     05  DA-SORT-RECORD-COUNT        PIC  ZZZ,ZZZ,ZZZ             MPKRP025
011600                                                     VALUE ZERO.  MPKRP025
011700                                                                  MPKRP025
011800 01  DH1-DETAIL-HEADING-LINE-1.                                   MPKRP025
011900     05  FILLER                      PIC  X(02)      VALUE SPACE. MPKRP025
012000     05  FILLER                      PIC  X(05)      VALUE           CL**2
012100         'DMM: '.                                                    CL**2
012200     05  DH1-DMM-NBR                 PIC  X(02)      VALUE SPACE. MPKRP025
012300     05  FILLER                      PIC  X(01)      VALUE '-'.   MPKRP025
012400     05  DH1-DMM-NAME                PIC  X(30)      VALUE SPACE. MPKRP025
012500     05  FILLER                      PIC  X(92)      VALUE SPACE.    CL**2
012600                                                                  MPKRP025
012700 01  DH2-DETAIL-HEADING-LINE-2.                                   MPKRP025
012800     05  FILLER                      PIC  X(02)      VALUE SPACE. MPKRP025
012900     05  FILLER                      PIC  X(05)      VALUE           CL**2
013000         'BYR: '.                                                    CL**2
013100     05  DH2-BUYER-NBR               PIC  X(03)      VALUE SPACE. MPKRP025
013200     05  FILLER                      PIC  X(01)      VALUE '-'.   MPKRP025
013300     05  DH2-BUYER-NAME              PIC  X(30)      VALUE SPACE. MPKRP025
013400     05  FILLER                      PIC  X(92)      VALUE SPACE.    CL**2
013500                                                                  MPKRP025
013600 01  DH3-DETAIL-HEADING-LINE-3.                                   MPKRP025
013700     05  FILLER                      PIC  X(41)      VALUE           CL*25
013800         '   PO/RECEIVER    OP  LNE           SKU  '.                CL**3
013900     05  FILLER                      PIC  X(69)      VALUE SPACE.    CL*23
014000     05  DH3-PART4                   PIC  X(07)      VALUE SPACE.    CL*23
014100     05  FILLER                      PIC  X(10)      VALUE SPACE.    CL**3
014200                                                                  MPKRP025
014300 01  DH4-DETAIL-HEADING-LINE-4.                                   MPKRP025
014400     05  FILLER                      PIC  X(46)      VALUE           CL**6
014500     '     SEQ NBR     UNIT NBR  DPT  CL  NUMBER'.                   CL*19
014600     05  FILLER                      PIC  X(15)      VALUE           CL*23
014700     'SKU DESCRIPTION'.                                              CL*23
014800     05  FILLER                      PIC  X(12)      VALUE SPACE.    CL**6
014900     05  FILLER                      PIC  X(26)      VALUE           CL**6
015000         'UPC CODE       VENDOR NAME'.                               CL**6
015100     05  FILLER                      PIC  X(09)      VALUE SPACE.    CL*23
015200     05  DH4-PART4                   PIC  X(10)      VALUE SPACE.    CL*23
015300     05  FILLER                      PIC  X(04)      VALUE SPACE.    CL*23
015400     05  DH4-PART5                   PIC  X(09)      VALUE SPACE.    CL*23
015500                                                                  MPKRP025
015600 01  DL-DETAIL-LINE.                                              MPKRP025
015700     05  FILLER                      PIC  X(03)      VALUE SPACE.    CL**9
015800     05  DL-PO-NBR                   PIC  X(08)      VALUE SPACE.    CL*23
015900     05  FILLER                      PIC  X(01)      VALUE '-'.      CL*23
016000     05  DL-REC-SEQ                  PIC  X(04)      VALUE SPACE.    CL*23
016100     05  FILLER                      PIC  X(01)      VALUE SPACE. MPKRP025
016200     05  DL-OPER-UNT-ID              PIC  X(04)      VALUE SPACE.    CL*29
016300     05  FILLER                      PIC  X(01)      VALUE SPACE.    CL*29
016400     05  DL-PO-LINE-ITEM-NBR         PIC  X(03)      VALUE SPACE.    CL*29
016500     05  FILLER                      PIC  X(02)      VALUE SPACE. MPKRP025
016600     05  DL-DEPT                     PIC  X(03)      VALUE SPACE.    CL*23
016700     05  FILLER                      PIC  X(02)      VALUE SPACE. MPKRP025
016800     05  DL-CLASS                    PIC  X(02)      VALUE SPACE.    CL*23
016900     05  FILLER                      PIC  X(02)      VALUE SPACE. MPKRP025
017000     05  DL-SKU-NBR                  PIC  X(08)      VALUE SPACE.    CL*23
017100     05  FILLER                      PIC  X(02)      VALUE SPACE. MPKRP025
017200     05  DL-SKU-DESC                 PIC  X(20)      VALUE SPACE. MPKRP025
017300     05  FILLER                      PIC  X(02)      VALUE SPACE. MPKRP025
017400     05  DL-UPC-CODE.                                             MPKRP025
017500         10  DL-UPC-COUNTRY-CODE     PIC  X(02)      VALUE SPACE. MPKRP025
017600         10  FILLER                  PIC  X(01)      VALUE '-'.   MPKRP025
017700         10  DL-UPC-VNDR-NBR         PIC  X(05)      VALUE SPACE. MPKRP025
017800         10  FILLER                  PIC  X(01)      VALUE '-'.   MPKRP025
017900         10  DL-UPC-ITEM-NBR         PIC  X(05)      VALUE SPACE. MPKRP025
018000         10  FILLER                  PIC  X(01)      VALUE '-'.   MPKRP025
018100         10  DL-UPC-CHECK-DIGIT      PIC  X(01)      VALUE SPACE. MPKRP025
018200     05  FILLER                      PIC  X(01)      VALUE SPACE.    CL*29
018300     05  DL-IN-HSE-VNDR-NAME         PIC  X(20)      VALUE SPACE. MPKRP025
018400     05  FILLER                      PIC  X(02)      VALUE SPACE.    CL**9
018500     05  DL-CURRENT-UPC-TO-SKU.                                      CL*23
018600         10 DL-CUR-UPC-DEPT          PIC  X(03).                     CL*23
018700         10 FILLER                   PIC  X(01)      VALUE SPACE.    CL*29
018800         10 DL-CUR-UPC-CLASS         PIC  X(02).                     CL*23
018900         10 FILLER                   PIC  X(01)      VALUE SPACE.    CL*29
019000         10 DL-CUR-UPC-SKU           PIC  X(08).                     CL*23
019100     05  FILLER                      PIC  X(02)      VALUE SPACE.    CL*29
019200     05  DL-USER-ID                  PIC  X(08)      VALUE SPACE.    CL*23
019300                                                                  MPKRP025
019400 01  EM-EXCEPTION-MESSAGE-DATA.                                   MPKRP025
019500     05  EM-EXCEPTION-MSG-1          PIC  X(65)      VALUE        MPKRP025
019600         'UNABLE TO SCAN UPC - CONTACT VENDOR'.                   MPKRP025
019700     05  EM-EXCEPTION-MSG-2          PIC  X(65)      VALUE        MPKRP025
019800         'UPC MISMATCH - UPC DE-CERTIFIED'.                       MPKRP025
019900     05  EM-EXCEPTION-MSG-3          PIC  X(65)      VALUE        MPKRP025
020000         'NEW VENDOR UPC ADDED TO SKU - UPC CERTIFIED'.           MPKRP025
020100     05  EM-EXCEPTION-MSG-4          PIC  X(65)      VALUE        MPKRP025
020200         'UPC NOT ATTACHED TO SKU - ASSOCIATION CORRECTED, UPC CERMPKRP025
020300-        'TIFIED'.                                                MPKRP025
020400     05  EM-EXCEPTION-MSG-5          PIC  X(65)      VALUE        MPKRP025
020500         'NO VENDOR UPC ON MERCHANDISE'.                          MPKRP025
020600                                                                  MPKRP025
020700 01  ER-EXCEPTION-REASON-LINE.                                    MPKRP025
020800     05  ER-EXCEPTION-REASON         PIC  X(65)      VALUE SPACE. MPKRP025
020900     05  FILLER                      PIC  X(67)      VALUE SPACE. MPKRP025
021000                                                                  MPKRP025
021100 01  END-OF-REPORT-LINE.                                          MPKRP025
021200     05  FILLER                      PIC  X(54)      VALUE SPACE. MPKRP025
021300     05  FILLER                      PIC  X(25)      VALUE        MPKRP025
021400         '***** END OF REPORT *****'.                             MPKRP025
021500     05  FILLER                      PIC  X(53)      VALUE SPACE. MPKRP025
021600                                                                  MPKRP025
021700 01  HL1-HEADING-LINE-1.                                          MPKRP025
021800     05  FILLER                      PIC  X(49)      VALUE SPACE. MPKRP025
021900     05  FILLER                      PIC  X(34)      VALUE        MPKRP025
022000         'UPC CERTIFICATION EXCEPTION REPORT'.                    MPKRP025
022100     05  FILLER                      PIC  X(49)      VALUE SPACE. MPKRP025
022200                                                                  MPKRP025
022300 01  HL2-HEADING-LINE-2.                                          MPKRP025
022400     05  FILLER                      PIC  X(53)      VALUE SPACE. MPKRP025
022500     05  FILLER                      PIC  X(04)      VALUE 'FOR '.MPKRP025
022600     05  HL2-START-DATE.                                          MPKRP025
022700         10  HL2-START-MONTH         PIC  X(02)      VALUE SPACE. MPKRP025
022800         10  FILLER                  PIC  X(01)      VALUE '/'.   MPKRP025
022900         10  HL2-START-DAY           PIC  X(02)      VALUE SPACE. MPKRP025
023000         10  FILLER                  PIC  X(01)      VALUE '/'.   MPKRP025
023100         10  HL2-START-YEAR          PIC  X(02)      VALUE SPACE. MPKRP025
023200     05  FILLER                      PIC  X(06)      VALUE        MPKRP025
023300         ' THRU '.                                                MPKRP025
023400     05  HL2-END-DATE.                                            MPKRP025
023500         10  HL2-END-MONTH           PIC  X(02)      VALUE SPACE. MPKRP025
023600         10  FILLER                  PIC  X(01)      VALUE '/'.   MPKRP025
023700         10  HL2-END-DAY             PIC  X(02)      VALUE SPACE. MPKRP025
023800         10  FILLER                  PIC  X(01)      VALUE '/'.   MPKRP025
023900         10  HL2-END-YEAR            PIC  X(02)      VALUE SPACE. MPKRP025
024000     05  FILLER                      PIC  X(53)      VALUE SPACE. MPKRP025
024100                                                                  MPKRP025
024200 01  PC-PROGRAM-CONSTANTS.                                        MPKRP025
024300     05  PC-PAGE-SIZE                PIC S9(04)      VALUE +60    MPKRP025
024400                                                     COMP SYNC.   MPKRP025
024500     05  PC-ROW-NOT-FOUND            PIC S9(04)      VALUE +100   MPKRP025
024600                                                     COMP SYNC.   MPKRP025
024700     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)      VALUE        MPKRP025
024800         'MPKRP025'.                                              MPKRP025
024900     05  PC-CONTROL-CONSTANT         PIC  X(07)      VALUE        MPKRP025
025000         'CONTROL'.                                               MPKRP025
025100     05  PC-MERCHANDISE-PROCESSING   PIC  X(02)      VALUE 'MP'.  MPKRP025
025200     05  PC-CURRENT-OPERATING-COMPANY                             MPKRP025
025300                                     PIC  X(02)      VALUE '03'.  MPKRP025
025400     05  PC-NO-VNDR-NAME-FOUND       PIC  X(20)      VALUE        MPKRP025
025500         'NO VENDOR NAME FOUND'.                                  MPKRP025
025600     05  PC-DPT-MDSE-LEVEL           PIC  X(03)      VALUE 'DPT'. MPKRP025
025700     05  PC-DMA-MDSE-LEVEL           PIC  X(03)      VALUE 'DMA'. MPKRP025
025800     05  PC-BUYER-RSP-LEVEL          PIC  X(03)      VALUE 'BYR'. MPKRP025
025900     05  PC-DMM-RSP-LEVEL            PIC  X(03)      VALUE 'DMM'. MPKRP025
026000     05  PC-NO-SCAN                  PIC  X(02)      VALUE '20'.  MPKRP025
026100     05  PC-UPC-MISMATCH             PIC  X(02)      VALUE '30'.  MPKRP025
026200     05  PC-NEW-VENDOR-UPC-LOADED    PIC  X(02)      VALUE '40'.  MPKRP025
026300     05  PC-DANGLING-UPC             PIC  X(02)      VALUE '50'.  MPKRP025
026400     05  PC-NO-UPC-ON-MERCHANDISE    PIC  X(02)      VALUE '60'.  MPKRP025
026500     05  PC-OTHER-DH3-PART4          PIC  X(07)      VALUE SPACE.    CL*23
026600     05  PC-OTHER-DH4-PART4          PIC  X(33)      VALUE           CL*23
026700                           'ADDED BY'.                                    
026800     05  PC-MISMATCH-DH3-PART4       PIC  X(07)      VALUE           CL**4
026900         'CURRENT'.                                                  CL**4
027000     05  PC-MISMATCH-DH4-PART4       PIC  X(10)      VALUE           CL**7
027100         'UPC TO SKU'.                                               CL**7
027200     05  PC-DECERT-BY-DH4-PART5      PIC  X(09)     VALUE            CL**7
027300         'DECERT BY'.                                                CL**7
027400     05  PC-MAX-RETRIES              PIC S9(04) VALUE +3 COMP.       CL**7
027500                                                                  MPKRP025
027600 01  PS-PROGRAM-SWITCHES.                                         MPKRP025
027700     05  PS-END-OF-SORT-WORK-FILE-IND                             MPKRP025
027800                                     PIC  X(01)      VALUE 'N'.   MPKRP025
027900         88  PS-END-OF-SORT-WORK-FILE                VALUE 'Y'.   MPKRP025
028000     05  PS-CURSOR-IND               PIC  X(01)      VALUE ' '.   MPKRP025
028100         88  PS-END-OF-CURSOR                        VALUE 'Y'.   MPKRP025
028200     05  PS-UPC-MISMATCH-SW          PIC  X(01)      VALUE ' '.   MPKRP025
028300         88  PS-BYPASS-UPC-MISMATCH                  VALUE 'Y'.   MPKRP025
028400         88  PS-DONT-BYPASS-UPC-MISMATCH             VALUE 'N'.   MPKRP025
028500                                                                  MPKRP025
028600 01  PV-PROGRAM-VARIABLES.                                        MPKRP025
028700     05  PV-PAGE-COUNT               PIC S9(04)      VALUE ZERO   MPKRP025
028800                                                     COMP.        MPKRP025
028900     05  PV-LINE-COUNT               PIC S9(04)      VALUE ZERO   MPKRP025
029000                                                     COMP.        MPKRP025
029100     05  PV-VALID-UPC-MISMATCH       PIC S9(04)      VALUE ZERO   MPKRP025
029200                                                     COMP.        MPKRP025
029300     05  PV-RETRY-COUNTER           PIC S9(04) VALUE +0 COMP SYNC.MPKRP025
029400     05  PV-SORT-RETURN              PIC  9(02)      VALUE ZERO.  MPKRP025
029500     05  PV-VENDOR-NAME              PIC  X(30)      VALUE SPACE.    CL*18
029600     05  PV-UPC-NBR                  PIC  9(13)      VALUE ZERO.  MPKRP025
029700     05  PV-START-DATE.                                           MPKRP025
029800         10  PV-START-YEAR           PIC  X(04)      VALUE SPACE.    CL*23
029900         10  FILLER                  PIC  X(01)      VALUE '-'.   MPKRP025
030000         10  PV-START-MONTH          PIC  X(02)      VALUE SPACE.    CL*23
030100         10  FILLER                  PIC  X(01)      VALUE '-'.   MPKRP025
030200         10  PV-START-DAY            PIC  X(02)      VALUE SPACE.    CL*23
030300     05  PV-START-DATE-RDF  REDEFINES  PV-START-DATE              MPKRP025
030400                                     PIC  X(10).                  MPKRP025
030500     05  PV-END-DATE.                                             MPKRP025
030600         10  PV-END-YEAR             PIC  X(04)      VALUE SPACE.    CL*23
030700         10  FILLER                  PIC  X(01)      VALUE '-'.   MPKRP025
030800         10  PV-END-MONTH            PIC  X(02)      VALUE SPACE.    CL*23
030900         10  FILLER                  PIC  X(01)      VALUE '-'.   MPKRP025
031000         10  PV-END-DAY              PIC  X(02)      VALUE SPACE.    CL*23
031100     05  PV-END-DATE-RDF  REDEFINES  PV-END-DATE                  MPKRP025
031200                                     PIC  X(10).                  MPKRP025
031300     05  PV-PARAGRAPH-NAME           PIC  X(30)      VALUE SPACE. MPKRP025
031400     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)      VALUE SPACE. MPKRP025
031500     05  PV-SKU-NBR                  PIC  9(08).                  MPKRP025
031600                                                                  MPKRP025
031700 01  SD-SYSTEM-DATE.                                              MPKRP025
031800     05  SD-SYSTEM-YEAR              PIC  9(02)      VALUE ZERO.  MPKRP025
031900     05  SD-SYSTEM-MONTH             PIC  9(02)      VALUE ZERO.  MPKRP025
032000     05  SD-SYSTEM-DAY               PIC  9(02)      VALUE ZERO.  MPKRP025
032100                                                                  MPKRP025
032200 01  ST-SYSTEM-TIME.                                              MPKRP025
032300     05  ST-SYSTEM-HOUR              PIC  9(02)      VALUE ZERO.  MPKRP025
032400     05  ST-SYSTEM-MINUTE            PIC  9(02)      VALUE ZERO.  MPKRP025
032500     05  FILLER                      PIC  9(04)      VALUE ZERO.  MPKRP025
032600                                                                  MPKRP025
032700*                                                                 MPKRP025
032800*  RECORD LAYOUT FOR UPC EXCEPTIONS ENCOUNTERED DURING THE        MPKRP025
032900*  DISTRIBUTION CENTER'S CERTIFICATION AND QUALITY CONTROL        MPKRP025
033000*  VERIFICATION PROCESS                                           MPKRP025
033100*                                                                 MPKRP025
033200     COPY MPRD018O.                                                  CL*31
033300                                                                  MPKRP025
033400*                                                                 MPKRP025
033500*  STANDARD REPORT HEADER FOR 132 COLUMN REPORT                   MPKRP025
033600*                                                                 MPKRP025
033700     COPY DPWS132O.                                               MPKRP025
033800                                                                  MPKRP025
033900*                                                                 MPKRP025
034000*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       MPKRP025
034100*                                                                 MPKRP025
034200     COPY DPWS004.                                                MPKRP025
034300******************************************************************   CL*33
034400*  ADDED XLWS001 COPYBOOK FOR XLKUT001               WR # 21361  *   CL*33
034500******************************************************************   CL*33
034600     COPY XLWS001.                                                MPKRP025
034700                                                                  MPKRP025
034800*                                                                 MPKRP025
034900*  COMMUNICATIONS AREA FOR DB2                                    MPKRP025
035000*                                                                 MPKRP025
035100     EXEC SQL                                                     MPKRP025
035200          INCLUDE SQLCA                                           MPKRP025
035300     END-EXEC.                                                    MPKRP025
035400                                                                  MPKRP025
035500******************************************************************MPKRP025
035600*  TUPCCER DCLGEN  (UPC CERTIFICATION TABLE)                      MPKRP025
035700******************************************************************MPKRP025
035800     EXEC SQL                                                     MPKRP025
035900          INCLUDE TUPCCER                                         MPKRP025
036000     END-EXEC.                                                    MPKRP025
036100                                                                  MPKRP025
036200******************************************************************   CL*14
036300*  TPURCHS DCLGEN                                                    CL*14
036400******************************************************************   CL*14
036500     EXEC SQL                                                        CL*14
036600          INCLUDE TPURCHS                                            CL*14
036700     END-EXEC.                                                       CL*14
036800                                                                     CL*14
036900******************************************************************   CL*14
037000*  TENTNME DCLGEN                                                    CL*14
037100******************************************************************   CL*14
037200     EXEC SQL                                                        CL*14
037300          INCLUDE TENTNME                                            CL*14
037400     END-EXEC.                                                       CL*14
037500                                                                     CL*14
037600******************************************************************MPKRP025
037700*  TMDSEAR DCLGEN  (MBS MERCHANDISE AREA TABLE)                   MPKRP025
037800******************************************************************MPKRP025
037900     EXEC SQL                                                     MPKRP025
038000          INCLUDE TMDSEAR                                         MPKRP025
038100     END-EXEC.                                                    MPKRP025
038200                                                                  MPKRP025
038300******************************************************************MPKRP025
038400*  TAPLAVL DCLGEN  (MBS APPLICATION AVAILIBILITY TABLE)           MPKRP025
038500******************************************************************MPKRP025
038600     EXEC SQL                                                     MPKRP025
038700          INCLUDE TAPLAVL                                         MPKRP025
038800     END-EXEC.                                                    MPKRP025
038900                                                                  MPKRP025
039000******************************************************************MPKRP025
039100*  TRSPBAR DCLGEN  (MBS RESPONSIBILITY AREA TABLE)                MPKRP025
039200******************************************************************MPKRP025
039300     EXEC SQL                                                     MPKRP025
039400          INCLUDE TRSPBAR                                         MPKRP025
039500     END-EXEC.                                                    MPKRP025
039600                                                                  MPKRP025
039700******************************************************************MPKRP025
039800*  CURSOR DECLARATION FOR ALL EXCEPTION ACTIVITY ON THE           MPKRP025
039900*  UPC CERTIFICATION ACTIVITY LOG TABLE                           MPKRP025
040000******************************************************************MPKRP025
040100     EXEC SQL                                                     MPKRP025
040200          DECLARE EXCEPTION_CURSOR CURSOR FOR                     MPKRP025
040300           SELECT MDSE_LNE_ITM_NBR,                               MPKRP025
040400                  ACT_CDE,                                        MPKRP025
040500                  OPER_UNT_ID,                                       CL*29
040600                  PO_NBR,                                            CL*29
040700                  REC_SEQ_NBR,                                       CL*12
040800                  PO_LNE_NBR,                                     MPKRP025
040900                  UPC_NBR,                                        MPKRP025
041000                  SCAN_ITM_NBR                                    MPKRP025
041100             FROM TUPCCER                                         MPKRP025
041200            WHERE (                                               MPKRP025
041300                  (ACT_CDE = :PC-NO-SCAN                          MPKRP025
041400                   OR                                             MPKRP025
041500                   ACT_CDE = :PC-UPC-MISMATCH                     MPKRP025
041600                   OR                                             MPKRP025
041700                   ACT_CDE = :PC-NEW-VENDOR-UPC-LOADED            MPKRP025
041800                   OR                                             MPKRP025
041900                   ACT_CDE = :PC-DANGLING-UPC                     MPKRP025
042000                   OR                                             MPKRP025
042100                   ACT_CDE = :PC-NO-UPC-ON-MERCHANDISE)           MPKRP025
042200              AND CHAR(DATE(CRE_TMST),ISO)                        MPKRP025
042300                  BETWEEN :PV-START-DATE-RDF                      MPKRP025
042400                      AND :PV-END-DATE-RDF                        MPKRP025
042500                  )                                               MPKRP025
042600     END-EXEC.                                                    MPKRP025
042700                                                                  MPKRP025
042800******************************************************************MPKRP025
042900 PROCEDURE DIVISION.                                              MPKRP025
043000******************************************************************MPKRP025
043100*                                                                 MPKRP025
043200 0000-PROGRAM-MAINLINE.                                           MPKRP025
043300******************************************************************MPKRP025
043400*  CONTROLS THE MAIN PROCESSING OF THE PROGRAM.                   MPKRP025
043500******************************************************************MPKRP025
043600                                                                  MPKRP025
043700     PERFORM 1000-INITIALIZE.                                     MPKRP025
043800                                                                  MPKRP025
043900     SORT SORT-WORK-FILE                                          MPKRP025
044000         ON ASCENDING KEY SW-DMM-NBR                              MPKRP025
044100                          SW-BUYER-NBR                            MPKRP025
044200                          SW-EXCEPTION-CODE                       MPKRP025
044300                          SW-PO-NBR                               MPKRP025
044400                          SW-REC-SEQ                                 CL*13
044500                          SW-PO-LINE-ITEM-NBR                     MPKRP025
044600                          SW-SKU-NBR                              MPKRP025
044700          INPUT PROCEDURE IS 2000-RELEASE-RECORDS-TO-SORT         MPKRP025
044800         OUTPUT PROCEDURE IS 3000-RETURN-SORT-WORK-FILE.          MPKRP025
044900                                                                  MPKRP025
045000     MOVE SORT-RETURN            TO PV-SORT-RETURN.               MPKRP025
045100     IF  PV-SORT-RETURN NOT = ZERO                                MPKRP025
045200         DISPLAY '** ABEND **'                                    MPKRP025
045300         DISPLAY '** PROGRAM **  = MPKRP025'                      MPKRP025
045400         DISPLAY '** INTERNAL SORT ERROR'                         MPKRP025
045500         DISPLAY '** SORT RETURN CODE = ' PV-SORT-RETURN          MPKRP025
045600         MOVE +4012              TO ABEND-CODE                    MPKRP025
045700         CALL 'ILBOABN0' USING ABEND-CODE                         MPKRP025
045800     END-IF.                                                      MPKRP025
045900                                                                  MPKRP025
046000     PERFORM 9000-EOJ-ROUTINE.                                    MPKRP025
046100     STOP RUN.                                                    MPKRP025
046200*0000-EXIT.                                                       MPKRP025
046300*                                                                 MPKRP025
046400*                                                                 MPKRP025
046500 1000-INITIALIZE.                                                 MPKRP025
046600******************************************************************MPKRP025
046700*   ACCEPTS THE CPU DATE AND TIME. OPENS ALL FILES ASSOCIATED     MPKRP025
046800*   WITH THE PROGRAM.  FILLS APPROPRIATE HEADING INFORMATION.     MPKRP025
046900*   INITIALIZES THE TOTAL, FINANCIAL AND DEPARTMENT RELATIONSHIP  MPKRP025
047000*   TABLES.  ALL NUMERIC DATA ON THE DEPARTMENT RELATIONSHIP      MPKRP025
047100*   TABLE IS REPLACED BY 999.  THIS IS BECAUSE A BINARY SEARCH    MPKRP025
047200*   WILL BE DONE ON THE DEPARTMENT NUMBER FIELD OF THAT TABLE.    MPKRP025
047300******************************************************************MPKRP025
047400     OPEN OUTPUT UPC-EXCEPTION-REPORT.                            MPKRP025
047500                                                                  MPKRP025
047600     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           MPKRP025
047700     PERFORM 1100-VALIDATE-CONTROL-CARD.                          MPKRP025
047800*                                                                 MPKRP025
047900     MOVE CC-START-MONTH         TO  PV-START-MONTH               MPKRP025
048000                                     HL2-START-MONTH.             MPKRP025
048100     MOVE CC-START-DAY           TO  PV-START-DAY                 MPKRP025
048200                                     HL2-START-DAY.               MPKRP025
048300     MOVE CC-START-CENTURY-YEAR  TO  PV-START-YEAR.               MPKRP025
048400     MOVE CC-START-YEAR          TO  HL2-START-YEAR.              MPKRP025
048500*                                                                 MPKRP025
048600     MOVE CC-END-MONTH           TO  PV-END-MONTH                 MPKRP025
048700                                     HL2-END-MONTH.               MPKRP025
048800     MOVE CC-END-DAY             TO  PV-END-DAY                   MPKRP025
048900                                     HL2-END-DAY.                 MPKRP025
049000     MOVE CC-END-CENTURY-YEAR    TO  PV-END-YEAR                  MPKRP025
049100     MOVE CC-END-YEAR            TO  HL2-END-YEAR.                MPKRP025
049200*                                                                 MPKRP025
049300     ACCEPT SD-SYSTEM-DATE  FROM DATE.                            MPKRP025
049400     ACCEPT ST-SYSTEM-TIME  FROM TIME.                            MPKRP025
049500*                                                                 MPKRP025
049600     MOVE SD-SYSTEM-YEAR         TO  DP132O-RUN-YEAR.             MPKRP025
049700     MOVE SD-SYSTEM-MONTH        TO  DP132O-RUN-MONTH.            MPKRP025
049800     MOVE SD-SYSTEM-DAY          TO  DP132O-RUN-DAY.              MPKRP025
049900     MOVE ST-SYSTEM-HOUR         TO  DP132O-RUN-HOUR.             MPKRP025
050000     MOVE ST-SYSTEM-MINUTE       TO  DP132O-RUN-MINUTE.           MPKRP025
050100     MOVE PC-CURRENT-PROGRAM-NAME                                 MPKRP025
050200                                 TO  DP132O-PROGRAM-NAME.         MPKRP025
050300     MOVE 1                      TO  DP132O-REPORT-NUMBER.        MPKRP025
050400*1000-EXIT.                                                       MPKRP025
050500*                                                                 MPKRP025
050600*                                                                 MPKRP025
050700 1100-VALIDATE-CONTROL-CARD.                                      MPKRP025
050800******************************************************************MPKRP025
050900*  VALIDATE THE CONTROL CARD.                                     MPKRP025
051000******************************************************************MPKRP025
051100     IF  CC-CONSTANT = PC-CONTROL-CONSTANT                        MPKRP025
051200         CONTINUE                                                 MPKRP025
051300     ELSE                                                         MPKRP025
051400         DISPLAY '** ABEND **'                                    MPKRP025
051500         DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME     MPKRP025
051600         DISPLAY '** PARAGRAPH ** = 1100-VALIDATE-CONTROL-CARD'   MPKRP025
051700         DISPLAY '** CONTROL CONSTANT INVALID'                    MPKRP025
051800         DISPLAY '** CONTROL CONSTANT = ' CC-CONSTANT             MPKRP025
051900         DISPLAY '** CHANGE TO CONTROL'                           MPKRP025
052000         MOVE +4003              TO ABEND-CODE                    MPKRP025
052100         CALL 'ILBOABN0' USING ABEND-CODE                         MPKRP025
052200     END-IF.                                                      MPKRP025
052300                                                                  MPKRP025
052400     IF  CC-START-MONTH NUMERIC                                   MPKRP025
052500         IF  CC-VALID-START-MONTH                                 MPKRP025
052600             CONTINUE                                             MPKRP025
052700         ELSE                                                     MPKRP025
052800             DISPLAY '** ABEND **'                                MPKRP025
052900             DISPLAY '** PROGRAM   = ' PC-CURRENT-PROGRAM-NAME    MPKRP025
053000             DISPLAY '** PARAGRAPH = 1100-VALIDATE-CONTROL-CARD'  MPKRP025
053100             DISPLAY '** INVALID START MONTH ENTERED'             MPKRP025
053200             DISPLAY '** START MONTH ENTERED = ' CC-START-MONTH   MPKRP025
053300             DISPLAY '** VALID MONTH VALUES ARE 01 THRU 12'       MPKRP025
053400             MOVE +4003          TO ABEND-CODE                    MPKRP025
053500             CALL 'ILBOABN0' USING ABEND-CODE                     MPKRP025
053600         END-IF                                                   MPKRP025
053700     ELSE                                                         MPKRP025
053800         DISPLAY '** ABEND **'                                    MPKRP025
053900         DISPLAY '** PROGRAM   = ' PC-CURRENT-PROGRAM-NAME        MPKRP025
054000         DISPLAY '** PARAGRAPH = 1100-VALIDATE-CONTROL-CARD'      MPKRP025
054100         DISPLAY '** START MONTH ENTERED IS NOT NUMERIC'          MPKRP025
054200         DISPLAY '** START MONTH ENTERED = ' CC-START-MONTH       MPKRP025
054300         DISPLAY '** VALID MONTH VALUES ARE 01 THRU 12'           MPKRP025
054400         MOVE +4003              TO ABEND-CODE                    MPKRP025
054500         CALL 'ILBOABN0' USING ABEND-CODE                         MPKRP025
054600     END-IF.                                                      MPKRP025
054700                                                                  MPKRP025
054800     IF  CC-START-DAY NUMERIC                                     MPKRP025
054900         IF  CC-VALID-START-DAY                                   MPKRP025
055000             CONTINUE                                             MPKRP025
055100         ELSE                                                     MPKRP025
055200             DISPLAY '** ABEND **'                                MPKRP025
055300             DISPLAY '** PROGRAM   = ' PC-CURRENT-PROGRAM-NAME    MPKRP025
055400             DISPLAY '** PARAGRAPH = 1100-VALIDATE-CONTROL-CARD'  MPKRP025
055500             DISPLAY '** INVALID START DAY ENTERED'               MPKRP025
055600             DISPLAY '** START DAY ENTERED = ' CC-START-DAY       MPKRP025
055700             DISPLAY '** VALID DAY VALUES ARE 01 THRU 31'         MPKRP025
055800             MOVE +4003          TO ABEND-CODE                    MPKRP025
055900             CALL 'ILBOABN0' USING ABEND-CODE                     MPKRP025
056000         END-IF                                                   MPKRP025
056100     ELSE                                                         MPKRP025
056200         DISPLAY '** ABEND **'                                    MPKRP025
056300         DISPLAY '** PROGRAM   = ' PC-CURRENT-PROGRAM-NAME        MPKRP025
056400         DISPLAY '** PARAGRAPH = 1100-VALIDATE-CONTROL-CARD'      MPKRP025
056500         DISPLAY '** START DAY ENTERED IS NOT NUMERIC'            MPKRP025
056600         DISPLAY '** START DAY ENTERED = ' CC-START-DAY           MPKRP025
056700         DISPLAY '** VALID DAY VALUES ARE 01 THRU 31'             MPKRP025
056800         MOVE +4003              TO ABEND-CODE                    MPKRP025
056900         CALL 'ILBOABN0' USING ABEND-CODE                         MPKRP025
057000     END-IF.                                                      MPKRP025
057100                                                                  MPKRP025
057200     IF  CC-START-YEAR NUMERIC                                    MPKRP025
057300         CONTINUE                                                 MPKRP025
057400     ELSE                                                         MPKRP025
057500         DISPLAY '** ABEND **'                                    MPKRP025
057600         DISPLAY '** PROGRAM   = ' PC-CURRENT-PROGRAM-NAME        MPKRP025
057700         DISPLAY '** PARAGRAPH = 1100-VALIDATE-CONTROL-CARD'      MPKRP025
057800         DISPLAY '** START YEAR ENTERED IS NOT NUMERIC'           MPKRP025
057900         DISPLAY '** START YEAR ENTERED = ' CC-START-YEAR         MPKRP025
058000         DISPLAY '** CHANGE TO A VALID YEAR VALUE'                MPKRP025
058100         MOVE +4003              TO ABEND-CODE                    MPKRP025
058200         CALL 'ILBOABN0' USING ABEND-CODE                         MPKRP025
058300     END-IF.                                                      MPKRP025
058400                                                                  MPKRP025
058500     IF  CC-END-MONTH NUMERIC                                     MPKRP025
058600         IF  CC-VALID-END-MONTH                                   MPKRP025
058700             CONTINUE                                             MPKRP025
058800         ELSE                                                     MPKRP025
058900             DISPLAY '** ABEND **'                                MPKRP025
059000             DISPLAY '** PROGRAM   = ' PC-CURRENT-PROGRAM-NAME    MPKRP025
059100             DISPLAY '** PARAGRAPH = 1100-VALIDATE-CONTROL-CARD'  MPKRP025
059200             DISPLAY '** INVALID END MONTH ENTERED'               MPKRP025
059300             DISPLAY '** END MONTH ENTERED = ' CC-END-MONTH       MPKRP025
059400             DISPLAY '** VALID MONTH VALUES ARE 01 THRU 12'       MPKRP025
059500             MOVE +4003          TO ABEND-CODE                    MPKRP025
059600             CALL 'ILBOABN0' USING ABEND-CODE                     MPKRP025
059700         END-IF                                                   MPKRP025
059800     ELSE                                                         MPKRP025
059900         DISPLAY '** ABEND **'                                    MPKRP025
060000         DISPLAY '** PROGRAM   = ' PC-CURRENT-PROGRAM-NAME        MPKRP025
060100         DISPLAY '** PARAGRAPH = 1100-VALIDATE-CONTROL-CARD'      MPKRP025
060200         DISPLAY '** END MONTH ENTERED IS NOT NUMERIC'            MPKRP025
060300         DISPLAY '** END MONTH ENTERED = ' CC-END-MONTH           MPKRP025
060400         DISPLAY '** VALID MONTH VALUES ARE 01 THRU 12'           MPKRP025
060500         MOVE +4003              TO ABEND-CODE                    MPKRP025
060600         CALL 'ILBOABN0' USING ABEND-CODE                         MPKRP025
060700     END-IF.                                                      MPKRP025
060800                                                                  MPKRP025
060900     IF  CC-END-DAY NUMERIC                                       MPKRP025
061000         IF  CC-VALID-END-DAY                                     MPKRP025
061100             CONTINUE                                             MPKRP025
061200         ELSE                                                     MPKRP025
061300             DISPLAY '** ABEND **'                                MPKRP025
061400             DISPLAY '** PROGRAM   = ' PC-CURRENT-PROGRAM-NAME    MPKRP025
061500             DISPLAY '** PARAGRAPH = 1100-VALIDATE-CONTROL-CARD'  MPKRP025
061600             DISPLAY '** INVALID END DAY ENTERED'                 MPKRP025
061700             DISPLAY '** END DAY ENTERED = ' CC-END-DAY           MPKRP025
061800             DISPLAY '** VALID DAY VALUES ARE 01 THRU 31'         MPKRP025
061900             MOVE +4003          TO ABEND-CODE                    MPKRP025
062000             CALL 'ILBOABN0' USING ABEND-CODE                     MPKRP025
062100         END-IF                                                   MPKRP025
062200     ELSE                                                         MPKRP025
062300         DISPLAY '** ABEND **'                                    MPKRP025
062400         DISPLAY '** PROGRAM   = ' PC-CURRENT-PROGRAM-NAME        MPKRP025
062500         DISPLAY '** PARAGRAPH = 1100-VALIDATE-CONTROL-CARD'      MPKRP025
062600         DISPLAY '** END DAY ENTERED IS NOT NUMERIC'              MPKRP025
062700         DISPLAY '** END DAY ENTERED = ' CC-END-DAY               MPKRP025
062800         DISPLAY '** VALID DAY VALUES ARE 01 THRU 31'             MPKRP025
062900         MOVE +4003              TO ABEND-CODE                    MPKRP025
063000         CALL 'ILBOABN0' USING ABEND-CODE                         MPKRP025
063100     END-IF.                                                      MPKRP025
063200                                                                  MPKRP025
063300     IF  CC-END-YEAR NUMERIC                                      MPKRP025
063400         CONTINUE                                                 MPKRP025
063500     ELSE                                                         MPKRP025
063600         DISPLAY '** ABEND **'                                    MPKRP025
063700         DISPLAY '** PROGRAM   = ' PC-CURRENT-PROGRAM-NAME        MPKRP025
063800         DISPLAY '** PARAGRAPH = 1100-VALIDATE-CONTROL-CARD'      MPKRP025
063900         DISPLAY '** END YEAR ENTERED IS NOT NUMERIC'             MPKRP025
064000         DISPLAY '** END YEAR ENTERED = ' CC-END-YEAR             MPKRP025
064100         DISPLAY '** CHANGE TO A VALID YEAR VALUE'                MPKRP025
064200         MOVE +4003              TO ABEND-CODE                    MPKRP025
064300         CALL 'ILBOABN0' USING ABEND-CODE                         MPKRP025
064400     END-IF.                                                      MPKRP025
064500*1100-EXIT.                                                       MPKRP025
064600*                                                                 MPKRP025
064700*                                                                 MPKRP025
064800 2000-RELEASE-RECORDS-TO-SORT  SECTION.                           MPKRP025
064900******************************************************************MPKRP025
065000*  CONTROLS THE PROCESSING FOR RELEASING THE RECORDS INTO THE     MPKRP025
065100*  SORT.                                                          MPKRP025
065200*                                                                 MPKRP025
065300*  NOTE !!! THE 2000-EXIT SECTION DENOTES THE END OF THE INPUT    MPKRP025
065400*           SECTION.                                              MPKRP025
065500******************************************************************MPKRP025
065600     PERFORM 2100-OPEN-EXCEPTION-CURSOR.                          MPKRP025
065700                                                                          
065800     MOVE SPACES TO PS-CURSOR-IND                                         
065900                                                                          
066000     PERFORM 7000-FETCH-EXCEPTION-CURSOR.                         MPKRP025
066100                                                                          
066200     PERFORM 2200-PROCESS-EXCEPTIONS                              MPKRP025
066300       UNTIL  PS-END-OF-CURSOR                                            
066400*****  UNTIL SQLCODE = PC-ROW-NOT-FOUND.                          MPKRP025
066500     PERFORM 2500-CLOSE-EXCEPTION-CURSOR.                         MPKRP025
066600 2000-EXIT SECTION.                                               MPKRP025
066700*                                                                 MPKRP025
066800*                                                                 MPKRP025
066900 2100-OPEN-EXCEPTION-CURSOR.                                      MPKRP025
067000******************************************************************MPKRP025
067100*  OPEN THE EXCEPTION CURSOR.                                     MPKRP025
067200******************************************************************MPKRP025
067300     EXEC SQL                                                     MPKRP025
067400          OPEN  EXCEPTION_CURSOR                                  MPKRP025
067500     END-EXEC.                                                    MPKRP025
067600                                                                  MPKRP025
067700     EVALUATE TRUE                                                MPKRP025
067800         WHEN SQLCODE = ZERO                                      MPKRP025
067900              CONTINUE                                            MPKRP025
068000         WHEN SQLWARN0 NOT = SPACE                                   CL*23
068100         WHEN SQLCODE < ZERO                                      MPKRP025
068200         WHEN SQLCODE > ZERO                                      MPKRP025
068300              MOVE '2100-OPEN-EXCEPTION-CURSOR    '               MPKRP025
068400                                 TO PV-PARAGRAPH-NAME             MPKRP025
068500              MOVE 'OPEN THE EXCEPTION_CURSOR     '               MPKRP025
068600                                 TO PV-DB2-OPERATION-ATTEMPTED    MPKRP025
068700              PERFORM 9100-SQL-ABEND                              MPKRP025
068800     END-EVALUATE.                                                MPKRP025
068900*2100-EXIT.                                                       MPKRP025
069000*                                                                 MPKRP025
069100*                                                                 MPKRP025
069200 2200-PROCESS-EXCEPTIONS.                                         MPKRP025
069300******************************************************************MPKRP025
069400*  2200-PROCESS-EXCEPTIONS -                                      MPKRP025
069500******************************************************************MPKRP025
069600*    PERFORM 7300-GET-SKU-FOR-ITEM-NBR.                           MPKRP025
069700     PERFORM 7300-CALL-XLKUT-DOMAIN-PGM.                          MPKRP025
069800                                                                  MPKRP025
069900     PERFORM 7100-FIND-BUYER-FOR-DEPT.                            MPKRP025
070000     MOVE MDSEAR-BYR-NBR         TO SW-BUYER-NBR.                 MPKRP025
070100                                                                  MPKRP025
070200     STRING RSPBAR-WORKER-FIR-NAME DELIMITED BY '  '              MPKRP025
070300            SPACE DELIMITED BY SIZE                               MPKRP025
070400            RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE             MPKRP025
070500         INTO SW-BUYER-NAME                                       MPKRP025
070600     END-STRING.                                                  MPKRP025
070700                                                                  MPKRP025
070800     PERFORM 7200-FIND-DMM-FOR-BUYER.                             MPKRP025
070900     MOVE MDSEAR-DMA-NBR         TO SW-DMM-NBR.                   MPKRP025
071000                                                                  MPKRP025
071100     STRING RSPBAR-WORKER-FIR-NAME DELIMITED BY '  '              MPKRP025
071200            SPACE DELIMITED BY SIZE                               MPKRP025
071300            RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE             MPKRP025
071400         INTO SW-DMM-NAME                                         MPKRP025
071500     END-STRING.                                                  MPKRP025
071600                                                                  MPKRP025
071700     PERFORM 2300-FIND-IN-HSE-VNDR-NAME.                          MPKRP025
071800******************************************************************MPKRP025
071900* REPLACED TSK VARIABLES WITH XL001 VARIABLES.       WR # 21361  *MPKRP025
072000******************************************************************MPKRP025
072100                                                                  MPKRP025
072200     MOVE UPCCER-OPER-UNT-ID     TO SW-OPER-UNT-ID.                  CL*29
072300     MOVE UPCCER-PO-NBR          TO SW-PO-NBR.                       CL*29
072400     MOVE UPCCER-REC-SEQ-NBR     TO SW-REC-SEQ.                      CL*14
072500     MOVE UPCCER-PO-LNE-NBR      TO SW-PO-LINE-ITEM-NBR.          MPKRP025
072600     MOVE XL001-DEPT-NBR-3CH     TO SW-MERCH-DEPT-NBR.            MPKRP025
072700     MOVE XL001-SUB-CL-NBR-2CH   TO SW-MERCH-CLASS-NBR.           MPKRP025
072800     IF XL001-SKU-NBR NOT = ZEROES                                        
072900        MOVE XL001-SKU-NBR       TO PV-SKU-NBR                    MPKRP025
073000        MOVE PV-SKU-NBR          TO SW-SKU-NBR                    MPKRP025
073100     ELSE                                                                 
073200        MOVE SPACES              TO SW-SKU-NBR                            
073300     END-IF                                                               
073400     MOVE XL001-SKU-DESC         TO SW-SKU-DESC.                  MPKRP025
073500     MOVE UPCCER-UPC-NBR         TO PV-UPC-NBR.                   MPKRP025
073600     MOVE PV-UPC-NBR             TO SW-UPC-CODE.                  MPKRP025
073700     MOVE UPCCER-ACT-CDE         TO SW-EXCEPTION-CODE.            MPKRP025
073800     PERFORM 2400-DETERMINE-EXCEPTN-REASON.                       MPKRP025
073900                                                                  MPKRP025
074000*** THIS IS A VALID UPC MISMATCH AND SHOULD BE ON REPORT          MPKRP025
074100*** SO RELEASE IT TO THE SORT                                     MPKRP025
074200             RELEASE SORT-WORK-RECORD                             MPKRP025
074300     PERFORM 7000-FETCH-EXCEPTION-CURSOR.                         MPKRP025
074400*2200-EXIT.                                                       MPKRP025
074500*                                                                 MPKRP025
074600*                                                                 MPKRP025
074700 2300-FIND-IN-HSE-VNDR-NAME.                                      MPKRP025
074800******************************************************************MPKRP025
074900*  READ THE ONLINE DEPARTMENT DATABASE TO RETRIEVE THE IN-HOUSE   MPKRP025
075000*  VENDOR NAME FOR THE CORRESPONDING DEPARTMENT AND IN-HOUSE      MPKRP025
075100*  VENDOR NUMBERS.                                                MPKRP025
075200******************************************************************MPKRP025
075300     EXEC SQL                                                        CL*17
075400         SELECT B.ENT_NAME_DESC                                      CL*17
075500           INTO :PV-VENDOR-NAME                                      CL*18
075600         FROM TPURCHS A,                                             CL*15
075700              TENTNME B                                              CL*15
075800         WHERE A.VER_STATUS_CDE = 'A'                                CL*15
075900           AND A.PO_NBR         = :UPCCER-PO-NBR                     CL*15
076000           AND A.ENT_ID         = B.ENT_ID                           CL*15
076100           AND B.TYPE_CDE       = '01'                               CL*15
076200     END-EXEC.                                                       CL*15
076300     EVALUATE TRUE                                                MPKRP025
076310         WHEN SQLCODE = +0                                           CL*14
076320               MOVE PV-VENDOR-NAME                                   CL*18
076330                                 TO SW-IN-HSE-VNDR-NAME              CL*18
076400         WHEN SQLCODE = +100                                         CL*14
076500              MOVE PC-NO-VNDR-NAME-FOUND                          MPKRP025
076600                                 TO SW-IN-HSE-VNDR-NAME           MPKRP025
077000         WHEN OTHER                                               MPKRP025
077100              MOVE '2300-FIND-IN-HSE-VNDR-NAME'                      CL*15
077200                                 TO PV-PARAGRAPH-NAME                CL*15
077300              MOVE 'SELECT TPURCHS/TENTNME TABLES '                  CL*15
077400                                 TO PV-DB2-OPERATION-ATTEMPTED       CL*15
077500              PERFORM 9100-SQL-ABEND                                 CL*15
077600     END-EVALUATE.                                                MPKRP025
077700*2300-EXIT.                                                       MPKRP025
077800*                                                                 MPKRP025
077900*                                                                 MPKRP025
078000 2400-DETERMINE-EXCEPTN-REASON.                                   MPKRP025
078100******************************************************************MPKRP025
078200*  DETERMINE THE EXCEPTION REASON.                                MPKRP025
078300******************************************************************MPKRP025
078400     EVALUATE TRUE                                                MPKRP025
078500         WHEN UPCCER-ACT-CDE = PC-NO-SCAN                         MPKRP025
078600              MOVE EM-EXCEPTION-MSG-1                             MPKRP025
078700                                 TO SW-EXCEPTION-REASON           MPKRP025
078800         WHEN UPCCER-ACT-CDE = PC-UPC-MISMATCH                    MPKRP025
078900              MOVE EM-EXCEPTION-MSG-2                             MPKRP025
079000                                 TO SW-EXCEPTION-REASON           MPKRP025
079100         WHEN UPCCER-ACT-CDE = PC-NEW-VENDOR-UPC-LOADED           MPKRP025
079200              MOVE EM-EXCEPTION-MSG-3                             MPKRP025
079300                                 TO SW-EXCEPTION-REASON           MPKRP025
079400         WHEN UPCCER-ACT-CDE = PC-DANGLING-UPC                    MPKRP025
079500              MOVE EM-EXCEPTION-MSG-4                             MPKRP025
079600                                 TO SW-EXCEPTION-REASON           MPKRP025
079700         WHEN UPCCER-ACT-CDE = PC-NO-UPC-ON-MERCHANDISE           MPKRP025
079800              MOVE EM-EXCEPTION-MSG-5                             MPKRP025
079900                                 TO SW-EXCEPTION-REASON           MPKRP025
080000     END-EVALUATE.                                                MPKRP025
080100*2400-EXIT                                                        MPKRP025
080200*                                                                 MPKRP025
080300*                                                                 MPKRP025
080400 2500-CLOSE-EXCEPTION-CURSOR.                                     MPKRP025
080500******************************************************************MPKRP025
080600*  CLOSE THE EXCEPTION CURSOR.                                    MPKRP025
080700******************************************************************MPKRP025
080800     EXEC SQL                                                     MPKRP025
080900          CLOSE  EXCEPTION_CURSOR                                 MPKRP025
081000     END-EXEC.                                                    MPKRP025
081100                                                                  MPKRP025
081200     EVALUATE TRUE                                                MPKRP025
081300         WHEN SQLCODE = ZERO                                      MPKRP025
081400              CONTINUE                                            MPKRP025
081500         WHEN SQLWARN0 NOT = SPACE                                   CL*23
081600         WHEN SQLCODE < ZERO                                      MPKRP025
081700         WHEN SQLCODE > ZERO                                      MPKRP025
081800              MOVE '2500-CLOSE-EXCEPTION-CURSOR   '               MPKRP025
081900                                 TO PV-PARAGRAPH-NAME             MPKRP025
082000              MOVE 'CLOSE THE EXCEPTION_CURSOR    '               MPKRP025
082100                                 TO PV-DB2-OPERATION-ATTEMPTED    MPKRP025
082200              PERFORM 9100-SQL-ABEND                              MPKRP025
082300     END-EVALUATE.                                                MPKRP025
082400*2500-EXIT.                                                       MPKRP025
082500*                                                                 MPKRP025
082600*                                                                 MPKRP025
082700 3000-RETURN-SORT-WORK-FILE SECTION.                              MPKRP025
082800******************************************************************MPKRP025
082900*  CONTROLS THE PROCESSING FOR RETURNING THE RECORDS FROM THE     MPKRP025
083000*  SORT.                                                          MPKRP025
083100*                                                                 MPKRP025
083200*  NOTE !!! THE 3000-EXIT SECTION DENOTES THE END OF THE OUTPUT   MPKRP025
083300*           SECTION.                                              MPKRP025
083400******************************************************************MPKRP025
083500     PERFORM 7400-RETURN-SORT-WORK-FILE.                          MPKRP025
083600     PERFORM 3100-PROCESS-SORT-WORK-FILE                          MPKRP025
083700       UNTIL PS-END-OF-SORT-WORK-FILE.                            MPKRP025
083800 3000-EXIT SECTION.                                               MPKRP025
083900*                                                                 MPKRP025
084000*                                                                 MPKRP025
084100 3100-PROCESS-SORT-WORK-FILE.                                     MPKRP025
084200******************************************************************MPKRP025
084300*  100-PROCESS-SORT-WORK-FILE -                                   MPKRP025
084400******************************************************************MPKRP025
084500     MOVE MP018O-DMM-NBR         TO CK-DMM-NBR.                   MPKRP025
084600                                                                  MPKRP025
084700     PERFORM 3200-PROCESS-BUYER                                   MPKRP025
084800       UNTIL (PS-END-OF-SORT-WORK-FILE                            MPKRP025
084900              OR                                                  MPKRP025
085000              MP018O-DMM-NBR NOT = CK-DMM-NBR).                   MPKRP025
085100*3100-EXIT.                                                       MPKRP025
085200*                                                                 MPKRP025
085300*                                                                 MPKRP025
085400 3200-PROCESS-BUYER.                                              MPKRP025
085500******************************************************************MPKRP025
085600*  BUYER BREAK PROCESSING.  SET UP THE BUYER HEADING LINES.       MPKRP025
085700*  PRINT THE REPORT HEADING LINES AND THE BUYER HEADING LINES.    MPKRP025
085800*  PERFORM LOOP SO ALL EXCEPTION CODES ARE PROCESSED FOR THE      MPKRP025
085900*  BUYER.                                                         MPKRP025
086000******************************************************************MPKRP025
086100     MOVE MP018O-DMM-NBR         TO DH1-DMM-NBR.                  MPKRP025
086200     MOVE MP018O-DMM-NAME        TO DH1-DMM-NAME.                 MPKRP025
086300     MOVE MP018O-BUYER-NBR       TO CK-BUYER-NBR                  MPKRP025
086400                                    DH2-BUYER-NBR.                MPKRP025
086500     MOVE MP018O-BUYER-NAME      TO DH2-BUYER-NAME.               MPKRP025
086600*                                                                 MPKRP025
086700     PERFORM 8100-WRITE-HEADING-LINES.                            MPKRP025
086800*                                                                 MPKRP025
086900     PERFORM 3300-PROCESS-EXCEPTION-CODE                          MPKRP025
087000       UNTIL (PS-END-OF-SORT-WORK-FILE                            MPKRP025
087100              OR                                                  MPKRP025
087200              (MP018O-DMM-NBR NOT = CK-DMM-NBR)                   MPKRP025
087300              OR                                                  MPKRP025
087400              (MP018O-BUYER-NBR NOT = CK-BUYER-NBR)).             MPKRP025
087500*3200-EXIT.                                                       MPKRP025
087600*                                                                 MPKRP025
087700*                                                                 MPKRP025
087800 3300-PROCESS-EXCEPTION-CODE.                                     MPKRP025
087900******************************************************************MPKRP025
088000*  PRINT THE EXCEPTION CODE REASON AND DETAIL HEADING LINES.      MPKRP025
088100*  PROCESS (LOOP THROUGH) ALL RECORDS FOR THE BUYER/EXCEPTION     MPKRP025
088200*  CODE.                                                          MPKRP025
088300******************************************************************MPKRP025
088400     PERFORM 4000-SETUP-HEADINGS.                                 MPKRP025
088500*                                                                 MPKRP025
088600     PERFORM                                                      MPKRP025
088700       UNTIL (PS-END-OF-SORT-WORK-FILE                            MPKRP025
088800              OR                                                  MPKRP025
088900              (MP018O-DMM-NBR NOT = CK-DMM-NBR)                   MPKRP025
089000              OR                                                  MPKRP025
089100              (MP018O-BUYER-NBR NOT = CK-BUYER-NBR)               MPKRP025
089200              OR                                                  MPKRP025
089300              (MP018O-EXCEPTION-CODE NOT = CK-EXCEPTION-CODE))    MPKRP025
089400         IF  MP018O-PO-NBR           = DL-PO-NBR                     CL*20
089500         AND MP018O-OPER-UNT-ID      = DL-OPER-UNT-ID                CL*29
089600         AND MP018O-REC-SEQ          = DL-REC-SEQ                    CL*26
089700         AND MP018O-PO-LINE-ITEM-NBR = DL-PO-LINE-ITEM-NBR           CL*28
089800         AND MP018O-MERCH-DEPT-NBR   = DL-DEPT                    MPKRP025
089900         AND MP018O-MERCH-CLASS-NBR  = DL-CLASS                   MPKRP025
090000         AND MP018O-SKU-NBR          = DL-SKU-NBR                 MPKRP025
090100         AND MP018O-UPC-COUNTRY-CODE = DL-UPC-COUNTRY-CODE        MPKRP025
090200         AND MP018O-UPC-VNDR-NBR     = DL-UPC-VNDR-NBR            MPKRP025
090300         AND MP018O-UPC-ITEM-NBR     = DL-UPC-ITEM-NBR            MPKRP025
090400             CONTINUE                                             MPKRP025
090500         ELSE                                                     MPKRP025
090600             MOVE MP018O-OPER-UNT-ID TO DL-OPER-UNT-ID               CL*29
090700             MOVE MP018O-PO-NBR      TO DL-PO-NBR                 MPKRP025
090800             MOVE MP018O-REC-SEQ     TO DL-REC-SEQ                   CL*28
090900             MOVE MP018O-PO-LINE-ITEM-NBR                         MPKRP025
091000                                     TO DL-PO-LINE-ITEM-NBR       MPKRP025
091100             MOVE MP018O-MERCH-DEPT-NBR                           MPKRP025
091200                                     TO DL-DEPT                   MPKRP025
091300             MOVE MP018O-MERCH-CLASS-NBR                          MPKRP025
091400                                     TO DL-CLASS                  MPKRP025
091500             MOVE MP018O-SKU-NBR     TO DL-SKU-NBR                MPKRP025
091600*            MOVE PV-SKU-NBR         TO DL-SKU-NBR                MPKRP025
091700             MOVE MP018O-SKU-DESC    TO DL-SKU-DESC               MPKRP025
091800             MOVE MP018O-UPC-COUNTRY-CODE                         MPKRP025
091900                                     TO DL-UPC-COUNTRY-CODE       MPKRP025
092000             MOVE MP018O-UPC-VNDR-NBR                             MPKRP025
092100                                     TO DL-UPC-VNDR-NBR           MPKRP025
092200             MOVE MP018O-UPC-ITEM-NBR                             MPKRP025
092300                                     TO DL-UPC-ITEM-NBR           MPKRP025
092400             MOVE MP018O-UPC-CHECK-DIGIT                          MPKRP025
092500                                     TO DL-UPC-CHECK-DIGIT        MPKRP025
092600             MOVE MP018O-IN-HSE-VNDR-NAME                         MPKRP025
092700                                     TO DL-IN-HSE-VNDR-NAME       MPKRP025
092800             DISPLAY 'VENDOR NAME' DL-IN-HSE-VNDR-NAME            MPKRP025
092900******************************************************************MPKRP025
093000* REPLACED TSK VARIABLES WITH XL001 VARIABLES.       WR # 21361  *MPKRP025
093100******************************************************************MPKRP025
093200*                                                                 MPKRP025
093300             IF  CK-EXCEPTION-CODE = PC-UPC-MISMATCH              MPKRP025
093400                 MOVE MP018O-UPC-CODE TO PV-UPC-NBR               MPKRP025
093500                 PERFORM 3310-CALL-XLKUT-DOMAIN-PGM               MPKRP025
093600                 MOVE XL001-DEPT-NBR-3CH   TO DL-CUR-UPC-DEPT     MPKRP025
093700                 MOVE XL001-SUB-CL-NBR-2CH TO DL-CUR-UPC-CLASS    MPKRP025
093800                 MOVE XL001-SKU-NBR  TO PV-SKU-NBR                MPKRP025
093900                 MOVE PV-SKU-NBR     TO DL-CUR-UPC-SKU            MPKRP025
094000                 MOVE MP018O-PO-NBR  TO UPCCER-PO-NBR             MPKRP025
094100                 MOVE MP018O-REC-SEQ TO UPCCER-REC-SEQ-NBR           CL*28
094200                 MOVE MP018O-PO-LINE-ITEM-NBR                     MPKRP025
094300                                     TO UPCCER-PO-LNE-NBR         MPKRP025
094400                 PERFORM 3330-SELECT-TUPCCER                      MPKRP025
094500             ELSE                                                 MPKRP025
094600                 MOVE MP018O-PO-NBR  TO UPCCER-PO-NBR             MPKRP025
094700                 MOVE MP018O-REC-SEQ TO UPCCER-REC-SEQ-NBR           CL*28
094800                 MOVE MP018O-PO-LINE-ITEM-NBR                     MPKRP025
094900                                     TO UPCCER-PO-LNE-NBR         MPKRP025
095000                 PERFORM 3330-SELECT-TUPCCER                      MPKRP025
095100                 MOVE SPACE          TO DL-CURRENT-UPC-TO-SKU        CL*23
095200*                MOVE SPACE          TO DL-USER-ID                   CL*23
095300             END-IF                                               MPKRP025
095400                                                                  MPKRP025
095500             PERFORM 8000-WRITE-DETAIL-LINE                       MPKRP025
095600         END-IF                                                   MPKRP025
095700                                                                  MPKRP025
095800         PERFORM 7400-RETURN-SORT-WORK-FILE                       MPKRP025
095900     END-PERFORM.                                                 MPKRP025
096000*3300-EXIT.                                                       MPKRP025
096100*                                                                 MPKRP025
096200*                                                                 MPKRP025
096300 3310-CALL-XLKUT-DOMAIN-PGM.                                      MPKRP025
096400******************************************************************MPKRP025
096500*  REPLACED 3310-JOIN-TSK-TUPCSKU WITH               WR # 21361  *MPKRP025
096600*  3310-CALL-XLKUT-DOMAIN-PGM.                                    MPKRP025
096700*  ADDED LOGIC TO CALL XLKUT001 PROGRAM.                          MPKRP025
096800******************************************************************MPKRP025
096900         INITIALIZE XL001-ITEM-COMMAREA.                                  
097000                                                                          
097100         MOVE PV-UPC-NBR      TO XL001-KEY-UPC-NBR.                       
097200                                                                          
097300         SET XL001-BY-UPC-NBR                                             
097400             XL001-SELECT-UPC                                             
097500             XL001-SELECT-SKU                                             
097600             XL001-SELECT-VND-STYL TO TRUE.                               
097700                                                                          
097800         CALL XL001-VSM-PGM USING                                         
097900                                XL001-ITEM-COMMAREA.                      
098000                                                                  MPKRP025
098100     EVALUATE TRUE                                                MPKRP025
098200         WHEN XL001-UPC-SQLCODE = ZERO                            MPKRP025
098300              PERFORM 3315-SELECT-SKU                             MPKRP025
098400         WHEN XL001-UPC-SQLCODE = +100                            MPKRP025
098500              MOVE 'XXX'         TO XL001-DEPT-NBR-3CH            MPKRP025
098600              MOVE 'XX'          TO XL001-SUB-CL-NBR-2CH          MPKRP025
098700              MOVE ZEROES        TO XL001-SKU-NBR                 MPKRP025
098800         WHEN XL001-UPC-CONTENTION                                   CL*23
098900         WHEN XL001-UPC-SQLCODE < ZERO                            MPKRP025
099000         WHEN XL001-UPC-SQLCODE > ZERO                            MPKRP025
099100              MOVE '3310-CALL-XLKUT-DOMAIN-PGM'                   MPKRP025
099200                                 TO PV-PARAGRAPH-NAME             MPKRP025
099300              MOVE 'SELECT UPC FROM XLV_UPC VIEW '                MPKRP025
099400                                 TO PV-DB2-OPERATION-ATTEMPTED    MPKRP025
099500              PERFORM 9100-SQL-ABEND                              MPKRP025
099600     END-EVALUATE.                                                MPKRP025
099700                                                                  MPKRP025
099800 3315-SELECT-SKU.                                                 MPKRP025
099900     EVALUATE TRUE                                                MPKRP025
100000         WHEN XL001-SKU-SQLCODE = ZERO                            MPKRP025
100100              PERFORM 3320-SELECT-VND-STYL                        MPKRP025
100200         WHEN XL001-SKU-SQLCODE = +100                            MPKRP025
100300              MOVE ZEROES        TO XL001-SKU-NBR                 MPKRP025
100400         WHEN XL001-SKU-CONTENTION                                   CL*23
100500         WHEN XL001-SKU-SQLCODE < ZERO                            MPKRP025
100600         WHEN XL001-SKU-SQLCODE > ZERO                            MPKRP025
100700              MOVE '3315-SELECT-SKU'                              MPKRP025
100800                                 TO PV-PARAGRAPH-NAME             MPKRP025
100900              MOVE 'SELECT SKU FROM XLV_SKU VIEW '                MPKRP025
101000                                 TO PV-DB2-OPERATION-ATTEMPTED    MPKRP025
101100              PERFORM 9100-SQL-ABEND                              MPKRP025
101200     END-EVALUATE.                                                MPKRP025
101300                                                                  MPKRP025
101400 3320-SELECT-VND-STYL.                                            MPKRP025
101500     EVALUATE TRUE                                                MPKRP025
101600         WHEN XL001-VND-STYL-SQLCODE = ZERO                       MPKRP025
101700              CONTINUE                                            MPKRP025
101800         WHEN XL001-VND-STYL-SQLCODE = +100                       MPKRP025
101900              MOVE 'XXX'         TO XL001-DEPT-NBR-3CH            MPKRP025
102000              MOVE 'XX'          TO XL001-SUB-CL-NBR-2CH          MPKRP025
102100         WHEN XL001-VND-STYL-CONTENTION                              CL*23
102200         WHEN XL001-VND-STYL-SQLCODE < ZERO                       MPKRP025
102300         WHEN XL001-VND-STYL-SQLCODE > ZERO                       MPKRP025
102400              MOVE '3315-SELECT-VND-STYL'                         MPKRP025
102500                                 TO PV-PARAGRAPH-NAME             MPKRP025
102600              MOVE 'SELECT DP/CL FROM XLV_VND_STYL'               MPKRP025
102700                                 TO PV-DB2-OPERATION-ATTEMPTED    MPKRP025
102800              PERFORM 9100-SQL-ABEND                              MPKRP025
102900     END-EVALUATE.                                                MPKRP025
103000                                                                  MPKRP025
103100 3330-SELECT-TUPCCER.                                             MPKRP025
103200******************************************************************MPKRP025
103300*  SELECT THE USER ID WHEN OF PERSON WHO DID THE DE-CERTIFY FOR   MPKRP025
103400*  DISPLAY ON THE REPORT                                          MPKRP025
103500******************************************************************MPKRP025
103600     PERFORM                                                      MPKRP025
103700         WITH TEST AFTER                                          MPKRP025
103800         VARYING PV-RETRY-COUNTER                                 MPKRP025
103900         FROM 1 BY 1                                              MPKRP025
104000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               MPKRP025
104100            OR (SQLCODE = +100)                                   MPKRP025
104200            OR (SQLCODE = -811)                                   MPKRP025
104300            OR (SQLCODE = +0))                                    MPKRP025
104400                                                                  MPKRP025
104500         EXEC SQL                                                 MPKRP025
104600             SELECT UID_NBR                                       MPKRP025
104700               INTO :UPCCER-UID-NBR                                  CL*16
104800               FROM TUPCCER                                       MPKRP025
104900              WHERE  PO_NBR  = :UPCCER-PO-NBR                     MPKRP025
105000                AND  REC_SEQ_NBR = :UPCCER-REC-SEQ-NBR            MPKRP025
105100                AND  PO_LNE_NBR  = :UPCCER-PO-LNE-NBR             MPKRP025
105200*               AND  ACT_CDE     = :PC-UPC-MISMATCH               MPKRP025
105300         END-EXEC                                                 MPKRP025
105400                                                                  MPKRP025
105500         EVALUATE TRUE                                            MPKRP025
105600             WHEN SQLCODE = +0                                    MPKRP025
105700             WHEN SQLCODE = -811                                  MPKRP025
105800                 MOVE UPCCER-UID-NBR TO DL-USER-ID                MPKRP025
105900             WHEN SQLCODE = +100                                  MPKRP025
106000                 MOVE SPACES         TO DL-USER-ID                MPKRP025
106100             WHEN SQLCODE = -911                                     CL*23
106200                 CONTINUE                                         MPKRP025
106300             WHEN SQLWARN0 NOT = SPACE                               CL*23
106400             WHEN SQLCODE < ZERO                                  MPKRP025
106500             WHEN SQLCODE > ZERO                                  MPKRP025
106600                 MOVE '3330-SELECT-TUPCCER' TO PV-PARAGRAPH-NAME  MPKRP025
106700                 MOVE 'SELECT ON TUPCCER '                        MPKRP025
106800                                    TO PV-DB2-OPERATION-ATTEMPTED MPKRP025
106900                 PERFORM 9100-SQL-ABEND                           MPKRP025
107000         END-EVALUATE                                             MPKRP025
107100     END-PERFORM.                                                 MPKRP025
107200                                                                  MPKRP025
107300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     MPKRP025
107400          (SQLCODE NOT = +0 OR SQLCODE NOT = +100 OR              MPKRP025
107500           SQLCODE NOT = -811)                                    MPKRP025
107600         MOVE '3330-SELECT-TUPCCER' TO PV-PARAGRAPH-NAME          MPKRP025
107700         MOVE 'MAX RETRIES  EXCEEDED ATTEMPTING TO SELECT TUPCCER'MPKRP025
107800                                    TO PV-DB2-OPERATION-ATTEMPTED MPKRP025
107900        PERFORM 9100-SQL-ABEND                                    MPKRP025
108000     END-IF.                                                      MPKRP025
108100*                                                                 MPKRP025
108200 4000-SETUP-HEADINGS.                                             MPKRP025
108300     MOVE MP018O-EXCEPTION-CODE  TO CK-EXCEPTION-CODE.            MPKRP025
108400     MOVE MP018O-EXCEPTION-REASON                                 MPKRP025
108500                                 TO ER-EXCEPTION-REASON.          MPKRP025
108600                                                                  MPKRP025
108700     IF  CK-EXCEPTION-CODE = PC-UPC-MISMATCH                      MPKRP025
108800*** THIS IS A VALID UPC MISMATCH AND SHOULD BE ON REPORT          MPKRP025
108900         MOVE 'CURRENT'             TO DH3-PART4                  MPKRP025
109000         MOVE 'UPC TO SKU'          TO DH4-PART4                  MPKRP025
109100         MOVE 'DECERT BY'            TO DH4-PART5                 MPKRP025
109200     ELSE                                                         MPKRP025
109300         MOVE SPACES             TO DH3-PART4                     MPKRP025
109400         MOVE SPACES             TO DH4-PART4                     MPKRP025
109500         MOVE 'ADDED BY'         TO DH4-PART5                     MPKRP025
109600     END-IF                                                       MPKRP025
109700                                                                  MPKRP025
109800     PERFORM 4500-WRITE-HEADINGS.                                 MPKRP025
109900*                                                                 MPKRP025
110000 4500-WRITE-HEADINGS.                                             MPKRP025
110100***                                                               MPKRP025
110200***  8 IS ADDED TO THE LINE COUNT TO ENSURE THAT SPACE EXISTS     MPKRP025
110300***  FOR THE EXCEPTION REASON LINE AND THE DETAIL HEADING LINES   MPKRP025
110400***  AND AT LEAST ONE DETAIL LINE.                                MPKRP025
110500***                                                               MPKRP025
110600     IF  (PV-LINE-COUNT + 8) > PC-PAGE-SIZE                       MPKRP025
110700         PERFORM 8100-WRITE-HEADING-LINES                         MPKRP025
110800     END-IF.                                                      MPKRP025
110900*                                                                 MPKRP025
111000     WRITE UPC-EXCEPTION-LINE                                     MPKRP025
111100       FROM ER-EXCEPTION-REASON-LINE                              MPKRP025
111200         AFTER ADVANCING 3 LINES.                                 MPKRP025
111300*                                                                 MPKRP025
111400     WRITE UPC-EXCEPTION-LINE                                     MPKRP025
111500       FROM DH3-DETAIL-HEADING-LINE-3                             MPKRP025
111600         AFTER ADVANCING 2 LINES.                                 MPKRP025
111700*                                                                 MPKRP025
111800     WRITE UPC-EXCEPTION-LINE                                     MPKRP025
111900       FROM DH4-DETAIL-HEADING-LINE-4                             MPKRP025
112000         AFTER ADVANCING 1 LINE.                                  MPKRP025
112100*                                                                 MPKRP025
112200     ADD 6                       TO PV-LINE-COUNT.                MPKRP025
112300*                                                                 MPKRP025
112400*                                                                 MPKRP025
112500 7000-FETCH-EXCEPTION-CURSOR.                                     MPKRP025
112600******************************************************************MPKRP025
112700*  FETCH THE EXCEPTION CURSOR.                                    MPKRP025
112800******************************************************************MPKRP025
112900     EXEC SQL                                                     MPKRP025
113000          FETCH EXCEPTION_CURSOR                                  MPKRP025
113100           INTO :UPCCER-MDSE-LNE-ITM-NBR,                         MPKRP025
113200                :UPCCER-ACT-CDE,                                  MPKRP025
113300                :UPCCER-OPER-UNT-ID,                                 CL*29
113400                :UPCCER-PO-NBR,                                      CL*16
113500                :UPCCER-REC-SEQ-NBR,                                 CL*16
113600                :UPCCER-PO-LNE-NBR,                               MPKRP025
113700                :UPCCER-UPC-NBR,                                  MPKRP025
113800                :UPCCER-SCAN-ITM-NBR                              MPKRP025
113900     END-EXEC.                                                    MPKRP025
114000                                                                  MPKRP025
114100     EVALUATE TRUE                                                MPKRP025
114200         WHEN SQLCODE = ZERO                                      MPKRP025
114300              CONTINUE                                                    
114400         WHEN SQLCODE = +100                                      MPKRP025
114500              SET PS-END-OF-CURSOR TO TRUE                                
114600         WHEN SQLWARN0 NOT = SPACE                                   CL*23
114700         WHEN SQLCODE < ZERO                                      MPKRP025
114800         WHEN SQLCODE > ZERO                                      MPKRP025
114900              MOVE '7000-FETCH-EXCEPTION-CURSOR   '               MPKRP025
115000                                 TO PV-PARAGRAPH-NAME             MPKRP025
115100              MOVE 'FETCH THE EXCEPTION_CURSOR    '               MPKRP025
115200                                 TO PV-DB2-OPERATION-ATTEMPTED    MPKRP025
115300              PERFORM 9100-SQL-ABEND                              MPKRP025
115400     END-EVALUATE.                                                MPKRP025
115500*7000-EXIT.                                                       MPKRP025
115600*                                                                 MPKRP025
115700*                                                                 MPKRP025
115800 7100-FIND-BUYER-FOR-DEPT.                                        MPKRP025
115900******************************************************************MPKRP025
116000*  FIND THE BUYER NUMBER FOR THE DEPARTMENT.                      MPKRP025
116100******************************************************************MPKRP025
116200     EXEC SQL                                                     MPKRP025
116300          SELECT A.DMA_NBR,                                       MPKRP025
116400                 A.BYR_NBR,                                       MPKRP025
116500                 C.WORKER_FIR_NAME,                               MPKRP025
116600                 C.WORKER_LAST_NAME                               MPKRP025
116700            INTO :MDSEAR-DMA-NBR,                                 MPKRP025
116800                 :MDSEAR-BYR-NBR,                                 MPKRP025
116900                 :RSPBAR-WORKER-FIR-NAME,                         MPKRP025
117000                 :RSPBAR-WORKER-LAST-NAME                         MPKRP025
117100            FROM TMDSEAR A,                                       MPKRP025
117200                 TAPLAVL B,                                       MPKRP025
117300                 TRSPBAR C                                        MPKRP025
117400           WHERE (A.OPERCO_NBR   = :PC-CURRENT-OPERATING-COMPANY  MPKRP025
117500                  AND                                             MPKRP025
117600                  A.MDSEAR_DKEY  = B.MDSEAR_DKEY                  MPKRP025
117700                  AND                                             MPKRP025
117800                  B.APLSYS_CDE   = :PC-MERCHANDISE-PROCESSING     MPKRP025
117900                  AND                                             MPKRP025
118000                  (CURRENT DATE                                   MPKRP025
118100                           BETWEEN CHAR(A.STRT_DTE,ISO)           MPKRP025
118200                               AND CHAR(A.END_DTE,ISO))           MPKRP025
118300                  AND                                             MPKRP025
118400                  (CURRENT DATE                                   MPKRP025
118500                           BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)    MPKRP025
118600                               AND CHAR(B.MDSEAR_END_DTE,ISO))    MPKRP025
118700                  AND                                             MPKRP025
118800                  A.MDSELV_CDE   = :PC-DPT-MDSE-LEVEL             MPKRP025
118900                  AND                                             MPKRP025
119000                  (CURRENT DATE                                   MPKRP025
119100                           BETWEEN CHAR(C.WORKER_STRT_DTE,ISO)    MPKRP025
119200                               AND CHAR(C.WORKER_END_DTE,ISO))    MPKRP025
119300                  AND                                             MPKRP025
119400                  A.MDSEAR_DKEY  = C.MDSEAR_DKEY                  MPKRP025
119500                  AND                                             MPKRP025
119600                  A.DEPT_NBR     = :XL001-DEPT-NBR-3CH            MPKRP025
119700                  AND                                             MPKRP025
119800                  C.RSPLVL_CDE   = :PC-BUYER-RSP-LEVEL)           MPKRP025
119900     END-EXEC.                                                    MPKRP025
120000                                                                  MPKRP025
120100     EVALUATE TRUE                                                MPKRP025
120200         WHEN SQLCODE = ZERO                                      MPKRP025
120300              CONTINUE                                            MPKRP025
120400         WHEN SQLCODE = +100                                      MPKRP025
120500              MOVE ZEROES TO MDSEAR-DMA-NBR                               
120600              MOVE ZEROES TO MDSEAR-BYR-NBR                               
120700              MOVE SPACES TO RSPBAR-WORKER-FIR-NAME                       
120800              MOVE SPACES TO RSPBAR-WORKER-LAST-NAME                      
120900         WHEN SQLWARN0 NOT = SPACE                                   CL*23
121000         WHEN SQLCODE < ZERO                                      MPKRP025
121100         WHEN SQLCODE > ZERO                                      MPKRP025
121200              MOVE '7100-FIND-BUYER-FOR-DEPT      '               MPKRP025
121300                                 TO PV-PARAGRAPH-NAME             MPKRP025
121400              MOVE 'SELECT OF MDSEAR APLAVL RSPBAR'               MPKRP025
121500                                 TO PV-DB2-OPERATION-ATTEMPTED    MPKRP025
121600              PERFORM 9100-SQL-ABEND                              MPKRP025
121700     END-EVALUATE.                                                MPKRP025
121800*7100-EXIT.                                                       MPKRP025
121900*                                                                 MPKRP025
122000*                                                                 MPKRP025
122100 7200-FIND-DMM-FOR-BUYER.                                         MPKRP025
122200******************************************************************MPKRP025
122300*  FIND THE DMM FOR THE BUYER.                                    MPKRP025
122400******************************************************************MPKRP025
122500     EXEC SQL                                                     MPKRP025
122600          SELECT A.DMA_NBR,                                       MPKRP025
122700                 C.WORKER_FIR_NAME,                               MPKRP025
122800                 C.WORKER_LAST_NAME                               MPKRP025
122900            INTO :MDSEAR-DMA-NBR,                                 MPKRP025
123000                 :RSPBAR-WORKER-FIR-NAME,                         MPKRP025
123100                 :RSPBAR-WORKER-LAST-NAME                         MPKRP025
123200            FROM TMDSEAR A,                                       MPKRP025
123300                 TAPLAVL B,                                       MPKRP025
123400                 TRSPBAR C                                        MPKRP025
123500           WHERE (A.OPERCO_NBR    = :PC-CURRENT-OPERATING-COMPANY MPKRP025
123600                  AND                                             MPKRP025
123700                  A.MDSEAR_DKEY   = B.MDSEAR_DKEY                 MPKRP025
123800                  AND                                             MPKRP025
123900                  B.APLSYS_CDE    = :PC-MERCHANDISE-PROCESSING    MPKRP025
124000                  AND                                             MPKRP025
124100                  (CURRENT DATE                                   MPKRP025
124200                           BETWEEN CHAR(A.STRT_DTE,ISO)           MPKRP025
124300                               AND CHAR(A.END_DTE,ISO))           MPKRP025
124400                  AND                                             MPKRP025
124500                  (CURRENT DATE                                   MPKRP025
124600                           BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)    MPKRP025
124700                               AND CHAR(B.MDSEAR_END_DTE,ISO))    MPKRP025
124800                  AND                                             MPKRP025
124900                  A.MDSELV_CDE    = :PC-DMA-MDSE-LEVEL            MPKRP025
125000                  AND                                             MPKRP025
125100                  (CURRENT DATE                                   MPKRP025
125200                           BETWEEN CHAR(C.WORKER_STRT_DTE,ISO)    MPKRP025
125300                               AND CHAR(C.WORKER_END_DTE,ISO))    MPKRP025
125400                  AND                                             MPKRP025
125500                  A.MDSEAR_DKEY   = C.MDSEAR_DKEY                 MPKRP025
125600                  AND                                             MPKRP025
125700                  A.DMA_NBR       = :MDSEAR-DMA-NBR               MPKRP025
125800                  AND                                             MPKRP025
125900                  C.RSPLVL_CDE    = :PC-DMM-RSP-LEVEL)            MPKRP025
126000     END-EXEC.                                                    MPKRP025
126100                                                                  MPKRP025
126200     EVALUATE TRUE                                                MPKRP025
126300         WHEN SQLCODE = ZERO                                      MPKRP025
126400              CONTINUE                                            MPKRP025
126500         WHEN SQLCODE = +100                                              
126600              MOVE ZEROES TO MDSEAR-DMA-NBR                               
126700              MOVE SPACES TO RSPBAR-WORKER-FIR-NAME                       
126800              MOVE SPACES TO RSPBAR-WORKER-LAST-NAME                      
126900         WHEN SQLWARN0 NOT = SPACE                                   CL*23
127000         WHEN SQLCODE < ZERO                                      MPKRP025
127100         WHEN SQLCODE > ZERO                                      MPKRP025
127200              MOVE '7200-FIND-DMM-FOR-BUYER       '               MPKRP025
127300                                 TO PV-PARAGRAPH-NAME             MPKRP025
127400              MOVE 'SELECT OF MDSEAR APLAVL RSPBAR'               MPKRP025
127500                                 TO PV-DB2-OPERATION-ATTEMPTED    MPKRP025
127600              PERFORM 9100-SQL-ABEND                              MPKRP025
127700     END-EVALUATE.                                                MPKRP025
127800*7200-EXIT.                                                       MPKRP025
127900*                                                                 MPKRP025
128000*                                                                 MPKRP025
128100 7300-CALL-XLKUT-DOMAIN-PGM.                                      MPKRP025
128200******************************************************************MPKRP025
128300*  REPLACED 7300-GET-SKU-FOR-ITM-NBR WITH            WR # 21361  *MPKRP025
128400*  7300-CALL-XLKUT-DOMAIN-PGM.                                    MPKRP025
128500*  ADDED LOGIC TO CALL XLKUT001 PROGRAM.                          MPKRP025
128600******************************************************************MPKRP025
128700         INITIALIZE XL001-ITEM-COMMAREA.                                  
128800                                                                          
128900         MOVE UPCCER-MDSE-LNE-ITM-NBR TO XL001-KEY-ITM-NBR.               
129000                                                                          
129100         SET XL001-BY-ITEM                                                
129200             XL001-SELECT-SKU                                             
129300             XL001-SELECT-VND-STYL TO TRUE.                               
129400                                                                          
129500         CALL XL001-VSM-PGM USING                                         
129600                                XL001-ITEM-COMMAREA.                      
129700                                                                  MPKRP025
129800     EVALUATE TRUE                                                MPKRP025
129900         WHEN XL001-SKU-SQLCODE = ZERO                            MPKRP025
130000              PERFORM 7310-SELECT-VND-STYL                        MPKRP025
130100         WHEN XL001-SKU-SQLCODE = +100                            MPKRP025
130200             MOVE SPACES TO XL001-DEPT-NBR-3CH                    MPKRP025
130300                            XL001-SUB-CL-NBR-2CH                  MPKRP025
130400                            XL001-SKU-DESC                        MPKRP025
130500             MOVE ZEROS  TO XL001-SKU-NBR                         MPKRP025
130600                            XL001-ENT-ID                          MPKRP025
130700             DISPLAY '************************************'       MPKRP025
130800             DISPLAY '** SKU NUMBER NOT FOUND ON XLV_SKU'         MPKRP025
130900             DISPLAY '** ITEM NBR = ' UPCCER-MDSE-LNE-ITM-NBR     MPKRP025
131000             DISPLAY '**   PO NBR = ' UPCCER-PO-NBR               MPKRP025
131100             DISPLAY '** REC SEQ# = ' UPCCER-REC-SEQ-NBR          MPKRP025
131200             DISPLAY '** PO LINE# = ' UPCCER-PO-LNE-NBR           MPKRP025
131300             DISPLAY '** ACT.CODE = ' UPCCER-ACT-CDE              MPKRP025
131400             DISPLAY '**  UPC NBR = ' UPCCER-UPC-NBR              MPKRP025
131500             DISPLAY '************************************'       MPKRP025
131600*        WHEN SQLWARN0 NOT = SPACE                                   CL*23
131700         WHEN XL001-SKU-CONTENTION                                   CL*23
131800         WHEN XL001-SKU-SQLCODE < ZERO                            MPKRP025
131900         WHEN XL001-SKU-SQLCODE > ZERO                            MPKRP025
132000              MOVE '7300-CALL-XLKUT-DOMAIN-PGM    '               MPKRP025
132100                                 TO PV-PARAGRAPH-NAME             MPKRP025
132200              MOVE 'SELECT FROM THE XLV_SKU VIEW '                MPKRP025
132300                                 TO PV-DB2-OPERATION-ATTEMPTED    MPKRP025
132400              DISPLAY '** ITEM NBR = ' UPCCER-MDSE-LNE-ITM-NBR    MPKRP025
132500              PERFORM 9100-SQL-ABEND                              MPKRP025
132600     END-EVALUATE.                                                MPKRP025
132700*                                                                 MPKRP025
132800 7310-SELECT-VND-STYL.                                            MPKRP025
132900     EVALUATE TRUE                                                MPKRP025
133000         WHEN XL001-VND-STYL-SQLCODE = ZERO                       MPKRP025
133100              CONTINUE                                            MPKRP025
133200         WHEN XL001-VND-STYL-SQLCODE = +100                       MPKRP025
133300             MOVE SPACES TO XL001-DEPT-NBR-3CH                    MPKRP025
133400                            XL001-SUB-CL-NBR-2CH                  MPKRP025
133500             MOVE ZEROS  TO XL001-ENT-ID                          MPKRP025
133600             DISPLAY '************************************'       MPKRP025
133700             DISPLAY '** ITEM NUMBER NOT FOUND ON XLV_SKU'        MPKRP025
133800             DISPLAY '** ITEM NBR = ' UPCCER-MDSE-LNE-ITM-NBR     MPKRP025
133900             DISPLAY '**   PO NBR = ' UPCCER-PO-NBR               MPKRP025
134000             DISPLAY '** REC SEQ# = ' UPCCER-REC-SEQ-NBR          MPKRP025
134100             DISPLAY '** PO LINE# = ' UPCCER-PO-LNE-NBR           MPKRP025
134200             DISPLAY '** ACT.CODE = ' UPCCER-ACT-CDE              MPKRP025
134300             DISPLAY '**  UPC NBR = ' UPCCER-UPC-NBR              MPKRP025
134400             DISPLAY '************************************'       MPKRP025
134500*        WHEN SQLWARN0 NOT = SPACE                                   CL*23
134600         WHEN XL001-VND-STYL-CONTENTION                              CL*23
134700         WHEN XL001-VND-STYL-SQLCODE < ZERO                       MPKRP025
134800         WHEN XL001-VND-STYL-SQLCODE > ZERO                       MPKRP025
134900              MOVE '7310-SELECT-VND-STYL          '               MPKRP025
135000                                 TO PV-PARAGRAPH-NAME             MPKRP025
135100              MOVE 'SELECT FROM THE XLV_VND_STYL  '               MPKRP025
135200                                 TO PV-DB2-OPERATION-ATTEMPTED    MPKRP025
135300              DISPLAY '** ITEM NBR = ' UPCCER-MDSE-LNE-ITM-NBR    MPKRP025
135400              PERFORM 9100-SQL-ABEND                              MPKRP025
135500     END-EVALUATE.                                                MPKRP025
135600*                                                                 MPKRP025
135700 7400-RETURN-SORT-WORK-FILE.                                      MPKRP025
135800******************************************************************MPKRP025
135900*  RETURNS THE SORT WORK FILE INTO THE EXCEPTION RECORD LAYOUT.   MPKRP025
136000******************************************************************MPKRP025
136100     RETURN SORT-WORK-FILE                                        MPKRP025
136200         INTO MP018O-UPC-EXCEPTION-RECORD                         MPKRP025
136300             AT END                                               MPKRP025
136400                 SET PS-END-OF-SORT-WORK-FILE TO TRUE.            MPKRP025
136500*7400-EXIT.                                                       MPKRP025
136600*                                                                 MPKRP025
136700*                                                                 MPKRP025
136800 8000-WRITE-DETAIL-LINE.                                          MPKRP025
136900******************************************************************MPKRP025
137000*  PERFORMS A CHECK VERIFYING THE PAGE SIZE WILL NOT BE EXCEEDED. MPKRP025
137100*  IF SO, HEADING LINES ARE PRODUCED.  WRITE A DETAIL LINE AND    MPKRP025
137200*  INCREMENT THE LINE COUNTER.                                    MPKRP025
137300******************************************************************MPKRP025
137400     IF  (PV-LINE-COUNT + 2) > PC-PAGE-SIZE                       MPKRP025
137500         PERFORM 8100-WRITE-HEADING-LINES                         MPKRP025
137600         WRITE UPC-EXCEPTION-LINE                                 MPKRP025
137700           FROM ER-EXCEPTION-REASON-LINE                          MPKRP025
137800             AFTER ADVANCING 3 LINES                              MPKRP025
137900         WRITE UPC-EXCEPTION-LINE                                 MPKRP025
138000           FROM DH3-DETAIL-HEADING-LINE-3                         MPKRP025
138100             AFTER ADVANCING 2 LINES                              MPKRP025
138200         WRITE UPC-EXCEPTION-LINE                                 MPKRP025
138300           FROM DH4-DETAIL-HEADING-LINE-4                         MPKRP025
138400             AFTER ADVANCING 1 LINE                               MPKRP025
138500         ADD 6                   TO PV-LINE-COUNT                 MPKRP025
138600     END-IF.                                                      MPKRP025
138700*                                                                 MPKRP025
138800     WRITE UPC-EXCEPTION-LINE                                     MPKRP025
138900       FROM DL-DETAIL-LINE                                        MPKRP025
139000         AFTER ADVANCING 2 LINES.                                 MPKRP025
139100*                                                                 MPKRP025
139200     ADD 2                       TO PV-LINE-COUNT.                MPKRP025
139300*8000-EXIT.                                                       MPKRP025
139400*                                                                 MPKRP025
139500*                                                                 MPKRP025
139600 8100-WRITE-HEADING-LINES.                                        MPKRP025
139700******************************************************************MPKRP025
139800*  PRINT THE REPORT HEADING LINES AND THE BUYER HEADING LINES.    MPKRP025
139900******************************************************************MPKRP025
140000     ADD 1                       TO PV-PAGE-COUNT.                MPKRP025
140100     MOVE PV-PAGE-COUNT          TO DP132O-PAGE-NUMBER.           MPKRP025
140200*                                                                 MPKRP025
140300     WRITE UPC-EXCEPTION-LINE                                     MPKRP025
140400       FROM DP132O-STANDRD-HEADER-132-COLS                        MPKRP025
140500         AFTER ADVANCING PAGE.                                    MPKRP025
140600*                                                                 MPKRP025
140700     MOVE SPACE                                                      CL*23
140800       TO DP132O-LASER-NEW-PAGE-INDICATR.                         MPKRP025
140900*                                                                 MPKRP025
141000     WRITE UPC-EXCEPTION-LINE                                     MPKRP025
141100       FROM HL1-HEADING-LINE-1                                    MPKRP025
141200         AFTER ADVANCING 1 LINE.                                  MPKRP025
141300*                                                                 MPKRP025
141400     WRITE UPC-EXCEPTION-LINE                                     MPKRP025
141500       FROM HL2-HEADING-LINE-2                                    MPKRP025
141600         AFTER ADVANCING 1 LINE.                                  MPKRP025
141700*                                                                 MPKRP025
141800     WRITE UPC-EXCEPTION-LINE                                     MPKRP025
141900       FROM DH1-DETAIL-HEADING-LINE-1                             MPKRP025
142000         AFTER ADVANCING 1 LINE.                                  MPKRP025
142100*                                                                 MPKRP025
142200     WRITE UPC-EXCEPTION-LINE                                     MPKRP025
142300        FROM DH2-DETAIL-HEADING-LINE-2                            MPKRP025
142400         AFTER ADVANCING 1 LINE.                                  MPKRP025
142500*                                                                 MPKRP025
142600     MOVE 5                      TO PV-LINE-COUNT.                MPKRP025
142700*8100-EXIT.                                                       MPKRP025
142800*                                                                 MPKRP025
142900*                                                                 MPKRP025
143000 9000-EOJ-ROUTINE.                                                MPKRP025
143100******************************************************************MPKRP025
143200*  WRITE END OF REPORT LINE AND CLOSE FILE.                       MPKRP025
143300******************************************************************MPKRP025
143400     WRITE UPC-EXCEPTION-LINE                                     MPKRP025
143500       FROM END-OF-REPORT-LINE                                    MPKRP025
143600         AFTER ADVANCING 2 LINES.                                 MPKRP025
143700                                                                  MPKRP025
143800     CLOSE UPC-EXCEPTION-REPORT.                                  MPKRP025
143900*9000-EXIT.                                                       MPKRP025
144000*                                                                 MPKRP025
144100*                                                                 MPKRP025
144200 9100-SQL-ABEND.                                                  MPKRP025
144300******************************************************************MPKRP025
144400*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    MPKRP025
144500*  ERROR OR WARNING CODE OCCURS.                                  MPKRP025
144600******************************************************************MPKRP025
144700     DISPLAY '9100-SQL-ABEND'.                                    MPKRP025
144800     DISPLAY '** ABEND     **'.                                   MPKRP025
144900     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        MPKRP025
145000     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              MPKRP025
145100     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     MPKRP025
145200*                                                                 MPKRP025
145300*                                                                 MPKRP025
145400******************************************************************MPKRP025
145500* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    MPKRP025
145600* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         MPKRP025
145700* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     MPKRP025
145800* FORMAT.                                                         MPKRP025
145900******************************************************************MPKRP025
146000     COPY DPPD004.                                                MPKRP025
146100                                                                  MPKRP025
146200     MOVE +4013                  TO ABEND-CODE.                   MPKRP025
146300     CALL 'ILBOABN0' USING ABEND-CODE.                            MPKRP025
146400*9100-EXIT.                                                       MPKRP025
