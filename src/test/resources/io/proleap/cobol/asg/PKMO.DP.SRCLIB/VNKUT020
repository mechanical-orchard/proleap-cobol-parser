000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    VNKUT020.                                         00020000
000300 AUTHOR.        ANIL BEDEKAR.                                     00030011
000400 DATE-WRITTEN.  JULY 2011.                                        00040000
000500***************************************************************** 00050000
000600*               COBOL WITH ORACLE                               * 00060000
000700***************************************************************** 00070000
000800*     DETERMINE ACTIVE EXPENSE VENDORS USING PS_VOUCHER         * 00080000
000900***************************************************************** 00090000
001000*  PURPOSE: THIS PROGRAM WILL READ AN INPUT FILE OF SKELETON    * 00100000
001100*           VENDOR DATA OF EXPENSE AND MERCHANDISE VENDORS.     * 00110000
001200*           IF THE INPUT RECORD IS MERCHANSIDE THE INPUT RECORD * 00120000
001300*           WILL BE WRITTEN TO THIS PROGRAMS OUTPUT FILE.       * 00130000
001400***************************************************************** 00140044
001500*           THE DATE CHECK IS FOR 3 YEARS FROM THE CURRENT DATE * 00150044
001600*           SINCE THE UPGRADE TO PEOPLESOFT 9.1 THERE MAY NOT BE* 00160044
001700*           3 YEARS OF DATA ON THE TABLE, DUE TO ARCHIVING.     * 00170044
001800*           THIS HAS BEEN REVIEWED AND OK'D BY THE BC GROUP.    * 00180044
001900*           WE WILL LEAVE THE 3 YEAR DATE CHECK BUT MAY ONLY    * 00190044
002000*           HAVE 2+ YEARS ON THE DATABASE.                      * 00200044
002100***************************************************************** 00210044
002200*           IF THE INPUT RECORD IS EXPENSE THE VENDOR NUMBER    * 00220000
002300*           WILL BE USED TO QUERY THE PS_VOUCHER OPERATIONAL    * 00230044
002400*           TABLE IN ORACLE TO DETERMINE IF THERE HAVE BEEN ANY * 00240044
002500*           VOUCHERS ENTERED FOR THIS VENDOR UP TO 3 YEARS PAST.* 00250044
002600*           IF THERE HAVE BEEN VOUCHERS ENTERED LESS THAN       * 00260044
002700*           THREE YEARS THE EXPENSE VENDOR RECORD WILL BE       * 00270000
002800*           WRITTEN TO THE OUTPUT FILE WITH A FLAG INDICATING   * 00280000
002900*           IT IS AN ACTIVE EXPENSE VENDOR.  IF THERE HAVE NOT  * 00290000
003000*           BEEN ANY VOUCHERS ENTERED IN THE PAST THREE YEARS   * 00300000
003100*           FOR THE EXPENSE VENDOR THE INPUT RECORD WILL BE     * 00310000
003200*           WRITTEN TO THE OUTPUT FILE WITH A FLAG INDICATING   * 00320000
003300*           THE VENDOR IS NOT ACTIVE.                           * 00330000
003400***************************************************************** 00340044
003500*        ORACLE DCLGEN                                          * 00350012
003600*        ------------                                           * 00360012
003700*      1. FIT00260                                              * 00370012
003800***************************************************************** 00380000
003900*                                                               * 00390000
004000*  ORACLE TABLE: PS_VOUCHER                                     * 00400001
004100*                                                               * 00410000
004200*   INPUT: 1) SKELETON VENDOR DATA FILE           (VNRD010)     * 00420001
004300*          2) PS_VOUCHER FOR RECENT VOUCHERS      (SEE ABOVE)   * 00430001
004400*  OUTPUT: 1) VENDOR FILE W/ ACTIVE/INACTIVE      (VNRD010)     * 00440001
004500*                                                               * 00450000
004600***************************************************************** 00460000
004700* MAINTENANCE LOG:                                              * 00470000
004800*                                                               * 00480000
004900* 08/11/2011                                                    * 00490012
005000*   CHANGE  MADE: INITIAL VERSION.                              * 00500000
005100* MADE BY: ANIL BEDEKAR                 WR/PITS: WR37038        * 00510012
005200*                                                               * 00520000
004900* 02/09/2017                                                    * 00490012
005000*   CHANGE  MADE: CHANGED THE LOGIC CALCULATING THE 3 YEARS AGO * 00500000
005000*   DATE TO CALCULATE THE 18 MONTHS AGO DATE. CHANGED THE NAME  * 00500000
005000*   OF THE WORK FIELD PV-CURR-DT-MINUS-3-YRS TO                 * 00500000
005000*   TO ACTIVITY-CUTOFF-DT SO IT'S NOT SPECIFIC TO THE CRITERIA. * 00500000
005100* MADE BY: SRINATH(COGNIZANT)           WR/PITS: CHG0162036     * 00510012
005200*                                                               * 00520000
005300***************************************************************** 00530000
005400 ENVIRONMENT DIVISION.                                            00540000
005500 CONFIGURATION SECTION.                                           00550000
005600 SOURCE-COMPUTER.        IBM-370.                                 00560000
005700 OBJECT-COMPUTER.        IBM-370.                                 00570000
005800                                                                  00580000
005900 INPUT-OUTPUT SECTION.                                            00590000
006000                                                                  00600000
006100 FILE-CONTROL.                                                    00610000
006200     SELECT VENDOR-INPUT-FILE        ASSIGN TO INP01.             00620001
006300     SELECT ORACLE-LOGIN-FILE        ASSIGN TO ORALOGON.          00630044
006400     SELECT VENDOR-EXTRACT-FILE      ASSIGN TO OUT01.             00640001
006500                                                                  00650000
006600 DATA DIVISION.                                                   00660000
006700 FILE SECTION.                                                    00670000
006800                                                                  00680000
006900 FD  VENDOR-INPUT-FILE                                            00690001
007000     RECORDING MODE IS F                                          00700000
007100     LABEL RECORDS ARE STANDARD                                   00710000
007200     BLOCK CONTAINS 0 RECORDS                                     00720000
007300     RECORD CONTAINS 100 CHARACTERS                               00730044
007400     DATA RECORD IS VENDOR-INPUT-RECORD.                          00740001
007500                                                                  00750000
007600 01  VENDOR-INPUT-RECORD            PIC X(100).                   00760044
007700                                                                  00770003
007800 FD  ORACLE-LOGIN-FILE                                            00780003
007900     RECORDING MODE IS F                                          00790003
008000     LABEL RECORDS ARE STANDARD                                   00800003
008100     BLOCK CONTAINS 0 RECORDS                                     00810003
008200     RECORD CONTAINS 80 CHARACTERS                                00820003
008300     DATA RECORD IS ORACLE-LOGIN-REC.                             00830003
008400                                                                  00840003
008500 01  ORACLE-LOGIN-REC               PIC X(080).                   00850003
008600                                                                  00860003
008700 FD  VENDOR-EXTRACT-FILE                                          00870003
008800     RECORDING MODE IS F                                          00880001
008900     LABEL RECORDS ARE STANDARD                                   00890001
009000     BLOCK CONTAINS 0 RECORDS                                     00900001
009100     RECORD CONTAINS 100 CHARACTERS                               00910044
009200     DATA RECORD IS VENDOR-EXTRACT-RECORD.                        00920001
009300                                                                  00930001
009400 01  VENDOR-EXTRACT-RECORD          PIC X(100).                   00940044
009500                                                                  00950000
009600                                                                  00960000
009700 WORKING-STORAGE SECTION.                                         00970000
009800                                                                  00980000
009900 01  PROGRAM-SWITCHES.                                            00990000
010000     05  PS-VNDR-INPUT-EOF-SW        PIC X(01)  VALUE 'N'.        01000003
010100         88  VNDR-INPUT-EOF                     VALUE 'Y'.        01010003
010200     05  PS-RECENT-ACTIVITY-SW       PIC X(01)  VALUE 'N'.        01020003
010300         88  PS-RECENT-ACTIVITY                 VALUE 'Y'.        01030003
010400         88  PS-NO-RECENT-ACTIVITY              VALUE 'N'.        01040003
010500     05  PS-ORACLE-LOGIN-FILE-EOF-SW PIC X(01)  VALUE 'N'.        01050005
010600         88  ORACLE-LOGIN-EOF                   VALUE 'Y'.        01060003
010700                                                                  01070000
010800 01  PROGRAM-VARIABLES.                                           01080000
010900     05  PV-COUNT                    PIC S9(9) COMP-3 VALUE +0.   01090000
010910*PRB0059571 START                                                 01091051
011000     05  ACTIVITY-CUTOFF-DT          PIC X(10)  VALUE ZERO.       01100049
011100     05  FILLER REDEFINES ACTIVITY-CUTOFF-DT.                     01110049
011110*PRB0059571 END                                                   01111051
011200         10  PV-SYSTEM-DAY           PIC 9(02).                   01120033
011300         10  FILLER                  PIC X(01).                   01130033
011400         10  PV-SYSTEM-MONTH         PIC X(03).                   01140033
011500         10  FILLER                  PIC X(01).                   01150033
011600         10  PV-SYSTEM-YEAR          PIC 9(02).                   01160033
011700         10  PV-SYSTEM-CCYY.                                      01170047
011800            15 PV-SYSTEM-CC          PIC 9(02).                   01180047
011900            15 PV-SYSTEM-YY          PIC 9(02).                   01190047
011910     05  PV-DATE-CCYYMMDD            PIC X(08)  VALUE ZERO.       01191050
011920     05  FILLER REDEFINES PV-DATE-CCYYMMDD.                       01192048
012100         10 PV-DATE-CC               PIC 9(02).                   01210033
012200         10 PV-DATE-YY               PIC 9(02).                   01220033
012300         10 PV-DATE-MM               PIC 9(02).                   01230033
012400         10 PV-DATE-DD               PIC 9(02).                   01240033
012500     05  PV-SYSTEM-MONTH-NN          PIC 9(2).                    01250047
012600     05  PV-ORACLE-USERID-LEN        PIC S9(04) VALUE ZEROS.      01260003
012700     05  PV-ORACLE-PASSWORD-LEN      PIC S9(04) VALUE ZEROS.      01270003
012800                                                                  01280012
012900 01  PV-VENDOR-EXTRACT-REC.                                       01290012
013000     05  PV-ENT-ID                       PIC 9(09).               01300012
013100     05  PV-DUN-NBR                      PIC X(09).               01310012
013200     05  PV-ENT-NAME-DESC                PIC X(30).               01320012
013300     05  PV-PRIM-TYP-CDE                 PIC X(01).               01330012
013400         88  PV-MDSE-VENDOR              VALUE 'M'.               01340012
013500         88  PV-EXP-VENDOR               VALUE 'E'.               01350012
013600     05  PV-CFY-SLSRNK-NBR               PIC 9(04).               01360012
013700     05  PV-PFY-SLSRNK-NBR               PIC 9(04).               01370012
013800     05  PV-PRTNR-TYP-CDE                PIC X(02).               01380012
013900         88  PV-CARRIER                  VALUE 'CR'.              01390012
014000         88  PV-BROKER                   VALUE 'BR'.              01400012
014100     05  PV-CAP-EXP-CDE                  PIC X(01).               01410012
014200         88  PV-VENDOOR-IS-CAPEXP        VALUES 'Y' 'B'.          01420012
014300     05  PV-VENDOR-ACTIVE-FLG            PIC X(01).               01430012
014400         88  PV-EXPEN-ACTIVE             VALUE 'A'.               01440012
014500         88  PV-EXPEN-INACTIVE           VALUE 'I'.               01450012
014600         88  PV-MERCH-ACTIVE             VALUE 'M'.               01460012
014700     05  FILLER                          PIC X(39).               01470044
014800                                                                  01480000
014900 01  PROGRAM-CONSTANTS.                                           01490007
015000     05  PC-PROGRAM-NAME             PIC X(08)  VALUE 'VNKUT020'. 01500007
015100                                                                  01510007
015200 01  PROGRAM-COUNTERS.                                            01520003
015300     05  PV-COUNT-VENDOR-READ        PIC 9(09)  VALUE 0.          01530000
015400     05  PV-COUNT-VENDOR-WRITE       PIC 9(09)  VALUE 0.          01540041
015500     05  PV-COUNT-EXPVND-ACT         PIC 9(09)  VALUE 0.          01550012
015600     05  PV-COUNT-EXPVND-NO-ACT      PIC 9(09)  VALUE 0.          01560012
015700     05  PV-COUNT-MERCH-RECORD       PIC 9(09)  VALUE 0.          01570013
015800                                                                  01580000
015900 01  ABEND-CODE                      PIC S9(04) VALUE 0 COMP SYNC.01590000
016000     88  AC-BAD-WRITE                           VALUE  +4001.     01600000
016100     88  AC-CONTROL-CARD-ERROR                  VALUE  +4003.     01610000
016200     88  AC-OPEN-ERROR                          VALUE  +4005.     01620000
016300     88  AC-CLOSE-ERROR                         VALUE  +4006.     01630000
016400     88  AC-BAD-DATA                            VALUE  +4008.     01640000
016500     88  AC-ORA-ERROR                           VALUE  +4013.     01650004
016600     88  AC-UNSUCCESSFUL-SELECT                 VALUE  +4015.     01660000
016700     88  AC-MAX-RETRIES-EXCEEDED                VALUE  +4016.     01670000
016800     88  AC-DATE-ERROR                          VALUE  +4019.     01680000
016900                                                                  01690000
017000 01  ABEND-AREAS.                                                 01700000
017100     05  AA-ABEND-LIT                PIC X(40)  VALUE             01710000
017200             '*****       ABEND'.                                 01720000
017300     05  AA-PROGRAM-LIT              PIC X(40)  VALUE             01730000
017400             '*****   PROGRAM: VNKUT020'.                         01740000
017500     05  AA-PARAGRAPH-LIT.                                        01750000
017600         10  FILLER                  PIC X(17)  VALUE             01760000
017700             '***** PARAGRAPH: '.                                 01770000
017800         10  AA-PARAGRAPH-NAME       PIC X(35)  VALUE SPACES.     01780000
017900     05  AA-MESSAGE-LINE.                                         01790000
018000         10  FILLER                  PIC X(06)  VALUE '*****'.    01800000
018100         10  AA-MESSAGE              PIC X(127) VALUE SPACES.     01810000
018200         10  FILLER REDEFINES AA-MESSAGE.                         01820000
018300             15 AA-MESSAGE-1         PIC X(45).                   01830000
018400             15 AA-MESSAGE-2         PIC X(45).                   01840000
018500             15 AA-MESSAGE-3         PIC X(37).                   01850000
018600     05  AA-ORA-ERROR-LIT            PIC X(40)  VALUE             01860003
018700             '*****    ORA ERROR'.                                01870003
018800     05  AA-ORA-OPERATION-LIT.                                    01880003
018900         10  FILLER                  PIC X(17)  VALUE             01890000
019000             '***** OPERATION: '.                                 01900000
019100         10  AA-ORA-OPERATION.                                    01910003
019200             15  AA-ORA-OP-1         PIC X(25)  VALUE SPACES.     01920003
019300             15  AA-ORA-OP-2         PIC X(25)  VALUE SPACES.     01930003
019400     05  AA-ORA-TABLE-1              PIC X(18)  VALUE SPACES.     01940003
019500     05  AA-ORA-TABLE-2              PIC X(18)  VALUE SPACES.     01950003
019600     05  AA-ORA-TABLE-3              PIC X(18)  VALUE SPACES.     01960003
019700                                                                  01970000
019800*--------------------------------------------------------------*  01980000
019900*   THIS IS THE RECORD LAYOUT FOR THE SKELETON VENDOR EXTRACT. *  01990004
020000*--------------------------------------------------------------*  02000000
020100     COPY VNRD010.                                                02010004
020200                                                                  02020000
020300*--------------------------------------------------------------*  02030000
020400*  DPWS004 CONTAINS THE FIELDS NECESSARY TO CALL THE SQLCA     *  02040000
020500*  MESSAGE MODULE 'DSNTIAR' AND DISPLAY THE FORMATTED RESULTS. *  02050000
020600*--------------------------------------------------------------*  02060000
020700     COPY DPWS004.                                                02070000
020800                                                                  02080000
020900 01 CC-ORACLE-CONNECTION.                                         02090003
021000     05  CC-ORACLE-USERID        PIC X(40).                       02100003
021100         88 CC-AUTO-SIGNON-IND                VALUE '/'.          02110003
021200     05  CC-ORACLE-PASSWORD      PIC X(40).                       02120003
021300***************************************************************** 02130003
021400*                      O  R  A  C  L  E                           02140003
021500*================================================================ 02150003
021600* ORACLE DECLARE SECTION                                          02160003
021700* ORACLE USED AND RETURNED VARIABLES                              02170003
021800***************************************************************** 02180003
021900     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     02190003
022000                                                                  02200003
022100*---------------------------------------------------------------- 02210003
022200* ORACLE LOGON WORKING STORAGE COPYBOOK                          *02220003
022300*----------------------------------------------------------------*02230003
022400 01      PC-ENT01-TYPE-CDE            PIC  X(02)  VALUE '01'.     02240003
022500 01      PV-ORACLE-ID                 PIC  X(01)  VALUE '/'.      02250003
022600                                                                  02260003
022700 01      USERNAME                     PIC  X(10)  VARYING.        02270003
022800 01      PASSWD                       PIC  X(10)  VARYING.        02280003
022900                                                                  02290003
023000 01      ORACLE-RETURN                PIC  X(200) VALUE SPACES.   02300003
023100                                                                  02310003
023200*--------------------------------------------------------------*  02320000
023300*  PEOPLESOFT VOUCHER TABLE                                    *  02330000
023400*--------------------------------------------------------------*  02340000
023500     EXEC SQL                                                     02350000
023600          INCLUDE FIT00260                                        02360002
023700     END-EXEC.                                                    02370000
023800                                                                  02380000
023900     EXEC SQL END DECLARE SECTION END-EXEC.                       02390003
024000     EXEC SQL INCLUDE SQLCACOB    END-EXEC.                       02400003
024100 EJECT                                                            02410021
024200 LINKAGE SECTION.                                                 02420000
024300************************                                          02430000
024400 PROCEDURE DIVISION.                                              02440000
024500************************                                          02450000
024600 A100-MAINLINE-ROUTINE.                                           02460000
024700                                                                  02470000
024800     PERFORM B100-INITIALIZATION.                                 02480000
024900                                                                  02490000
025000     PERFORM B200-PROCESS-VENDOR-FILE                             02500003
025100       UNTIL VNDR-INPUT-EOF.                                      02510003
025200                                                                  02520000
025300     PERFORM B300-TERMINATION.                                    02530000
025400     GOBACK.                                                      02540000
025500                                                                  02550000
025600*--------------------------------------------------------------*  02560000
025700*  INITIALIZATION PROCESSING                                   *  02570000
025800*--------------------------------------------------------------*  02580000
025900 B100-INITIALIZATION.                                             02590000
026000                                                                  02600000
026100     DISPLAY ' '.                                                 02610000
026200     DISPLAY '**--------------- VNKUT020 --------------------**'. 02620000
026300     DISPLAY 'DATE ' FUNCTION CURRENT-DATE(1:8)                   02630000
026400           '  TIME ' FUNCTION CURRENT-DATE(9:6)                   02640000
026500                                                                  02650000
026600     OPEN INPUT  VENDOR-INPUT-FILE                                02660002
026700                 ORACLE-LOGIN-FILE.                               02670002
026800     OPEN OUTPUT VENDOR-EXTRACT-FILE.                             02680003
026900                                                                  02690000
027000     INITIALIZE FIT00260                                          02700003
027100                AA-ORA-TABLE-1                                    02710003
027200                AA-ORA-TABLE-2                                    02720003
027300                AA-ORA-TABLE-3.                                   02730003
027400                                                                  02740000
027500     PERFORM R100-READ-VENDOR-FILE.                               02750003
027600                                                                  02760000
027700     IF VNDR-INPUT-EOF                                            02770006
027800         DISPLAY '***  VNKUT020  ***'                             02780000
027900         DISPLAY 'FIRST FETCH OF VENDOR CURSOR     '              02790000
028000         DISPLAY 'NO VENDOR DATA TO PROCESS  '                    02800000
028100         DISPLAY ' '                                              02810000
028200     ELSE                                                         02820003
028300         PERFORM C050-CONNECT-TO-ORACLE                           02830003
028310*---------------------------------------------------------------  02831048
028320* FECHES ORACLE DATE TO DB2 FORMAT CCYYMMDD.                      02832048
028330*---------------------------------------------------------------  02833048
028400         EXEC SQL                                                 02840048
028500            SELECT TO_CHAR(CURRENT_DATE                           02850048
028501*PRB0059571 START                                                 02850151
028510                   - NUMTOYMINTERVAL(18,'MONTH'),'YYYYMMDD')      02851049
028520*PRB0059571 END                                                   02852051
028600            INTO :PV-DATE-CCYYMMDD                                02860048
028700            FROM DUAL                                             02870048
028800         END-EXEC                                                 02880048
028801         DISPLAY "PREVIOUS 18 MONTHS DATE-->" PV-DATE-CCYYMMDD    02880150
028802                                                                  02880245
028810         EXEC SQL                                                 02881045
028820            SELECT CURRENT_DATE - NUMTOYMINTERVAL(18,'MONTH')     02882049
028821*PRB0059571 START                                                 02882151
028830            INTO :ACTIVITY-CUTOFF-DT                              02883049
028831*PRB0059571 END                                                   02883151
028840            FROM DUAL                                             02884045
028850         END-EXEC                                                 02885045
028900                                                                  02890048
029000*PRB0059571 START                                                 02900051
029010         DISPLAY "PREVIOUS 18 MONTHS DATE IN ORACLE FORMAT -->"   02901049
029020                              ACTIVITY-CUTOFF-DT                  02902049
029030*PRB0059571 END                                                   02903051
029100     END-IF.                                                      02910000
029200                                                                  02920000
029300*--------------------------------------------------------------*  02930000
029400* PROCESS THE VENDOR INPUT FILE.                               *  02940005
029500*--------------------------------------------------------------*  02950000
029600 B200-PROCESS-VENDOR-FILE.                                        02960005
029700                                                                  02970000
029800     IF PV-MDSE-VENDOR                                            02980012
029900        ADD +1 TO PV-COUNT-MERCH-RECORD                           02990003
030000     ELSE                                                         03000003
030100        MOVE PV-DUN-NBR        TO VENDOR-ID                       03010012
030200        PERFORM S100-CHECK-FOR-EXPEN-VEND-ACT                     03020003
030300     END-IF.                                                      03030003
030400                                                                  03040003
030500     PERFORM W100-WRITE-VENDOR-EXTRACT.                           03050044
030600     PERFORM R100-READ-VENDOR-FILE.                               03060003
030700                                                                  03070000
030800*--------------------------------------------------------------*  03080000
030900*  END OF PROGRAM PROCESSING                                   *  03090000
031000*--------------------------------------------------------------*  03100000
031100 B300-TERMINATION.                                                03110000
031200                                                                  03120000
031300     DISPLAY '**********************************************'.    03130000
031400     DISPLAY '**         VNKUT020 RECORD COUNTS           **'.    03140000
031500     DISPLAY '**********************************************'.    03150000
031600     DISPLAY ' VENDOR RECS READ   :' PV-COUNT-VENDOR-READ.        03160012
031700     DISPLAY ' EXP VENDOR WITH NO/ACT:' PV-COUNT-EXPVND-NO-ACT.   03170041
031800     DISPLAY ' EXP VENDOR WITH ACTIVITY:' PV-COUNT-EXPVND-ACT.    03180041
031900     DISPLAY ' VENDOR MERCHANT         :' PV-COUNT-MERCH-RECORD.  03190041
032000     DISPLAY ' VENDOR RECS WRITTEN     :' PV-COUNT-VENDOR-WRITE.  03200042
032100     DISPLAY '**********************************************'.    03210000
032200                                                                  03220000
032300     CLOSE VENDOR-INPUT-FILE                                      03230004
032400           ORACLE-LOGIN-FILE                                      03240004
032500           VENDOR-EXTRACT-FILE.                                   03250004
032600                                                                  03260000
032700*--------------------------------------------------------------*  03270005
032800*  CONNECT TO ORACLE                                           *  03280005
032900*--------------------------------------------------------------*  03290005
033000 C050-CONNECT-TO-ORACLE.                                          03300005
033100                                                                  03310009
033200     READ ORACLE-LOGIN-FILE INTO CC-ORACLE-CONNECTION             03320009
033300        AT END                                                    03330009
033400           SET ORACLE-LOGIN-EOF TO TRUE                           03340009
033500        NOT AT END                                                03350009
033600           INITIALIZE PV-ORACLE-USERID-LEN                        03360009
033700                    PV-ORACLE-PASSWORD-LEN                        03370009
033800                                                                  03380009
033900           INSPECT CC-ORACLE-USERID                               03390009
034000             TALLYING PV-ORACLE-USERID-LEN                        03400009
034100             FOR CHARACTERS BEFORE INITIAL SPACE                  03410009
034200                                                                  03420009
034300           INSPECT CC-ORACLE-PASSWORD                             03430009
034400             TALLYING PV-ORACLE-PASSWORD-LEN                      03440009
034500             FOR CHARACTERS BEFORE INITIAL SPACE                  03450009
034600                                                                  03460009
034700           MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN)         03470009
034800                TO USERNAME-ARR                                   03480009
034900           MOVE PV-ORACLE-USERID-LEN                              03490009
035000                TO USERNAME-LEN                                   03500009
035100           MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN)     03510009
035200                TO PASSWD-ARR                                     03520009
035300           MOVE PV-ORACLE-PASSWORD-LEN                            03530009
035400                TO PASSWD-LEN                                     03540009
035500           IF CC-AUTO-SIGNON-IND                                  03550009
035600              DISPLAY PC-PROGRAM-NAME ' - AUTO SIGN-ON TO ORACLE' 03560009
035700              EXEC SQL                                            03570009
035800                CONNECT :USERNAME                                 03580009
035900              END-EXEC                                            03590009
036000           ELSE                                                   03600009
036100              DISPLAY PC-PROGRAM-NAME                             03610009
036200              ' - SIGN-ON TO ORACLE AS USER ' USERNAME-ARR        03620009
036300              EXEC SQL                                            03630009
036400                CONNECT :USERNAME IDENTIFIED BY :PASSWD           03640009
036500              END-EXEC                                            03650009
036600           END-IF                                                 03660009
036700                                                                  03670009
036800           INITIALIZE CC-ORACLE-PASSWORD                          03680009
036900                PASSWD                                            03690009
037000                PV-ORACLE-PASSWORD-LEN                            03700009
037100                PASSWD-LEN                                        03710009
037200                                                                  03720009
037300           IF (SQLCODE NOT = 0)                                   03730009
037400              MOVE 'C050-CONNECT-TO-ORACLE' TO AA-PARAGRAPH-NAME  03740009
037500              DISPLAY PC-PROGRAM-NAME                             03750009
037600                      ' - ERROR SIGNING ON TO ORACLE'             03760009
037700              PERFORM Z999-ABEND                                  03770009
037800           END-IF                                                 03780009
037900        END-READ.                                                 03790009
041600*--------------------------------------------------------------*  04160003
041700*  READ THE SKELETON VENDOR DATA INPUT FILE                    *  04170003
041800*--------------------------------------------------------------*  04180003
041900 R100-READ-VENDOR-FILE.                                           04190003
042000                                                                  04200012
042100     INITIALIZE PV-VENDOR-EXTRACT-REC.                            04210012
042200                                                                  04220003
042300     READ VENDOR-INPUT-FILE INTO PV-VENDOR-EXTRACT-REC            04230012
042400         AT END                                                   04240003
042500            SET VNDR-INPUT-EOF TO TRUE.                           04250003
042600                                                                  04260003
042700     IF NOT VNDR-INPUT-EOF                                        04270003
042800        ADD 1 TO PV-COUNT-VENDOR-READ                             04280003
042900     END-IF.                                                      04290003
043000                                                                  04300003
043100*--------------------------------------------------------------*  04310000
043200*  CHECK IF THE EXPENSE VENDOR HAS ANY VOUCHERS CREATED        *  04320004
043300*  LESS THAN THREE YEARS AGO.                                  *  04330004
043400*--------------------------------------------------------------*  04340000
043500 S100-CHECK-FOR-EXPEN-VEND-ACT.                                   04350004
043600                                                                  04360004
043700     SET PS-NO-RECENT-ACTIVITY TO TRUE.                           04370004
043800     MOVE ZERO TO PV-COUNT.                                       04380004
043900                                                                  04390000
044000     EXEC SQL                                                     04400000
044100                                                                  04410004
044200         SELECT COUNT(*)                                          04420029
044300                INTO  :PV-COUNT                                   04430029
044400                FROM  PS_VOUCHER PV                               04440022
044500                WHERE BUSINESS_UNIT = 'KDS'                       04450012
044600                AND VENDOR_ID     = :VENDOR-ID                    04460012
044700                AND ENTERED_DT    > :ACTIVITY-CUTOFF-DT           04470049
044800     END-EXEC.                                                    04480004
044900                                                                  04490004
045000     EVALUATE TRUE                                                04500000
045100         WHEN SQLCODE = ZERO                                      04510000
045200             IF PV-COUNT > ZERO                                   04520028
045300                SET PV-EXPEN-ACTIVE TO TRUE                       04530028
045400                ADD 1 TO PV-COUNT-EXPVND-ACT                      04540028
045500             ELSE                                                 04550036
045600                SET PS-NO-RECENT-ACTIVITY TO TRUE                 04560037
045700                ADD 1 TO PV-COUNT-EXPVND-NO-ACT                   04570036
045800             END-IF                                               04580028
045900         WHEN SQLCODE = +1403                                     04590004
046000             SET PS-NO-RECENT-ACTIVITY TO TRUE                    04600037
046100             ADD 1 TO PV-COUNT-EXPVND-NO-ACT                      04610004
046200         WHEN SQLWARN0 NOT = SPACES                               04620004
046300         WHEN SQLCODE NOT = ZERO                                  04630004
046400         MOVE 'S100-CHECK-FOR-EXPEN-VEND-ACT'                     04640004
046500                                TO AA-PARAGRAPH-NAME              04650004
046600         MOVE 'UNSUCCESSFUL EXISTENCE CHECK'                      04660004
046700                                TO AA-ORA-OPERATION               04670004
046800         MOVE 'FIT00260'        TO AA-ORA-TABLE-1                 04680004
046900         MOVE SPACES            TO AA-ORA-TABLE-2                 04690004
047000         MOVE SPACES            TO AA-ORA-TABLE-3                 04700004
047100         PERFORM Z998-ORA-ABEND                                   04710004
047200     END-EVALUATE.                                                04720000
047300                                                                  04730000
047400*--------------------------------------------------------------*  04740000
047500*  WRITE OUT A RECORD TO THE VENDOR EXTRACT FILE               *  04750000
047600*--------------------------------------------------------------*  04760000
047700 W100-WRITE-VENDOR-EXTRACT.                                       04770000
047800                                                                  04780000
047900     INITIALIZE VN010-VENDOR-EXTRACT-REC.                         04790012
048000                                                                  04800012
048100     MOVE PV-VENDOR-EXTRACT-REC TO VN010-VENDOR-EXTRACT-REC.      04810012
048200     WRITE VENDOR-EXTRACT-RECORD FROM VN010-VENDOR-EXTRACT-REC.   04820003
048300     ADD +1      TO PV-COUNT-VENDOR-WRITE.                        04830041
048400                                                                  04840000
048500*--------------------------------------------------------------*  04850000
048600*  ORA ABEND ROUTINE                                           *  04860012
048700*--------------------------------------------------------------*  04870000
048800 Z998-ORA-ABEND.                                                  04880003
048900                                                                  04890000
049000     DISPLAY '**********************************************'.    04900000
049100     DISPLAY '**        VNKUT020 ABENDING !!!!!!!         **'.    04910000
049200     DISPLAY '**********************************************'.    04920000
049300                                                                  04930000
049400     DISPLAY AA-ABEND-LIT.                                        04940000
049500     DISPLAY AA-ORA-ERROR-LIT.                                    04950004
049600     DISPLAY AA-PROGRAM-LIT.                                      04960000
049700     DISPLAY AA-PARAGRAPH-LIT.                                    04970000
049800     DISPLAY AA-ORA-OPERATION-LIT.                                04980004
049900     DISPLAY AA-ORA-TABLE-1.                                      04990004
050000     DISPLAY AA-ORA-TABLE-2.                                      05000004
050100     DISPLAY AA-ORA-TABLE-3.                                      05010004
050200     SET AC-ORA-ERROR TO TRUE.                                    05020004
050300                                                                  05030039
050400     CLOSE VENDOR-INPUT-FILE                                      05040039
050500           ORACLE-LOGIN-FILE                                      05050039
050600           VENDOR-EXTRACT-FILE.                                   05060039
050700                                                                  05070000
050800     COPY DPPD004.                                                05080000
050900                                                                  05090000
051000     CALL 'ILBOABN0' USING ABEND-CODE.                            05100000
051100                                                                  05110000
051200***************************************************************** 05120000
051300*  ABEND ROUTINE FOR ERRORS                                       05130000
051400***************************************************************** 05140000
051500 Z999-ABEND.                                                      05150000
051600                                                                  05160000
051700     DISPLAY '**********************************************'.    05170000
051800     DISPLAY '**        VNKUT020 ABENDING !!!!!!!         **'.    05180000
051900     DISPLAY '**********************************************'.    05190000
052000                                                                  05200000
052100     DISPLAY AA-ABEND-LIT.                                        05210000
052200     DISPLAY AA-PROGRAM-LIT.                                      05220000
052300     DISPLAY AA-PARAGRAPH-LIT.                                    05230000
052400     DISPLAY AA-MESSAGE-LINE.                                     05240000
052500                                                                  05250039
052600     CLOSE VENDOR-INPUT-FILE                                      05260039
052700           ORACLE-LOGIN-FILE                                      05270039
052800           VENDOR-EXTRACT-FILE.                                   05280039
052900     CALL 'ILBOABN0' USING ABEND-CODE.                            05290000
