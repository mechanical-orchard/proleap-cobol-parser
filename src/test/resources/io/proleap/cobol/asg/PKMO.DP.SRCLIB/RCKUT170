000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             RCKUT170.                                00050000
000600 AUTHOR.                 RON KRIER.                               00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            APRIL 2021.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*  THIS PROGRAM WILL BE USED TO TAKE IN A COMMA DELIMTED FILE   * 00120000
001210*  OF SHIPPED MERCHANDISE AND WILL REFORMAT THE FILE INTO A     * 00121000
001220*  FIXED LENGTH FILE (COPYBOOK RCRD101) SO THAT THE DATA CAN    * 00122000
001230*  THEN BE FUTHER PROCESSED.                                    * 00123000
001240*  THE DATA IN THE FILE REPRESENTS MERCHANDISE BEING AVAILABLE  * 00124000
001250*  TO BE PROCESSED FROM A RECEIVING STANDPOINT AT A KOHLS DC    * 00125000
001260*  LOCATION.  THIS DATA IS BEING PROCESSED VIA THIS METHOD      * 00126000
001270*  SINCE THE DATA WAS NOT ABLE TO BE PUSHED THRU THE NORMAL ASN * 00127000
001280*  PROCESS.  THIS PROGRAM IS PART OF A MULTI PROGRAM PROCESS TO * 00128000
001290*  CREATE DATA IN THE RCRD001 FORMAT TO FEED INTO RCK010 TO     * 00129000
001300*  LOAD UP PACKSLIP AND INBOUND CARTON DATABASES.               * 00130000
001400*                                                               * 00140000
001500*  AT THIS TIME, THIS PROGRAM WAS WRITTEN TO PROCESS DATA FROM  * 00150000
001600*  SEPHORA - THEY WILL GENERATE A COMMA DELIMITED FILE OF       * 00160000
001700*  MERCHANDISE BEING SENT FROM THEM TO KOHLS FOR RECEIPT        * 00170000
001800*  PROCESSING.  THIS IS DATA THAT SEPHORA WAS NOT ABLE TO SEND  * 00180000
001900*  VIA NORMAL ASN PROCESSING.                                   * 00190000
002000***************************************************************** 00200000
263784* CHANGED 11/11/2021    BY JIM HUNTER      WR: CHG0263784         00202026
263784* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00203026
263784* MAKING THE CALL DYNAMIC VS STATIC.                              00204026
263784*---------------------------------------------------------------* 00205026
002100                                                                  00210000
002200 ENVIRONMENT DIVISION.                                            00220000
002300                                                                  00230000
002400 CONFIGURATION SECTION.                                           00240000
002500                                                                  00250000
002600 SOURCE-COMPUTER.        IBM-3090.                                00260000
002700 OBJECT-COMPUTER.        IBM-3090.                                00270000
002800                                                                  00280000
002900 INPUT-OUTPUT SECTION.                                            00290000
003000                                                                  00300000
003100 FILE-CONTROL.                                                    00310000
003200                                                                  00320000
003300     SELECT SHIPPED-MDSE-CSV-FILE                                 00330000
003400         ASSIGN TO INP01.                                         00340000
003500                                                                  00350000
003600     SELECT SHIPPED-MDSE-OUTPUT-FILE                              00360000
003700         ASSIGN TO OUT01.                                         00370000
003800                                                                  00380000
003900     SELECT CSV-ERROR-FILE                                        00390000
004000         ASSIGN TO OUT02.                                         00400000
004100                                                                  00410000
004200     SELECT ERROR-REPORT-FILE                                     00420000
004300         ASSIGN TO RPT01.                                         00430000
004400                                                                  00440000
004500******************************************************************00450000
004600 DATA DIVISION.                                                   00460000
004700******************************************************************00470000
004800                                                                  00480000
004900 FILE SECTION.                                                    00490000
005000                                                                  00500000
005100 FD  SHIPPED-MDSE-CSV-FILE                                        00510000
005200     RECORDING MODE IS F                                          00520000
005300     LABEL RECORDS ARE STANDARD                                   00530000
005400     BLOCK CONTAINS 0 RECORDS.                                    00540000
005500 01  SHIPPED-MDSE-CSV-RECORD          PIC  X(121).                00550000
005600                                                                  00560000
005700 FD  SHIPPED-MDSE-OUTPUT-FILE                                     00570000
005800     RECORDING MODE IS F                                          00580000
005900     BLOCK CONTAINS 0  RECORDS.                                   00590000
006000 01  SHIPPED-MDSE-OUTPUT-RECORD       PIC  X(150).                00600000
006100                                                                  00610000
006200 FD  CSV-ERROR-FILE                                               00620000
006300     RECORDING MODE IS F                                          00630000
006400     BLOCK CONTAINS 0  RECORDS.                                   00640000
006500 01  CSV-ERROR-RECORD                 PIC  X(121).                00650003
006600                                                                  00660000
006700 FD  ERROR-REPORT-FILE                                            00670000
006800     RECORDING MODE IS F                                          00680000
006900     BLOCK CONTAINS 0  RECORDS.                                   00690000
007000 01  ERROR-REPORT-RECORD              PIC  X(200).                00700000
007100                                                                  00710000
007200 WORKING-STORAGE SECTION.                                         00720000
007300                                                                  00730000
007400 01  FILLER                      PIC  X(46)    VALUE              00740000
007500     '** WORKING STORAGE FOR RCKUT170 STARTS HERE **'.            00750000
007600                                                                  00760000
007610 01  DATABASE-KEY-FIELDS.                                         00761000
007620     05  DK-PO-NUMBER                PIC  S9(9)  COMP.            00762000
007630     05  DK-DC-NUMBER                PIC  S9(4)  COMP.            00763000
007640     05  DK-UPC-NUMBER               PIC  S9(15) COMP-3.          00764000
007650     05  DK-SKU-NUMBER               PIC  S9(8)  COMP-3.          00765000
007660     05  DK-SSCC-NUMBER              PIC  S9(18) COMP-3.          00766000
007670     05  DK-MDSE-SOURCE              PIC   X(03).                 00767000
007680                                                                  00768000
007690 01  PV-CSV-RECORD.                                               00769000
007700     05  PV-CSV-FIELDS               PIC  X(100)   VALUE SPACES.  00770000
007800                                                                  00780000
007900 01  PROGRAM-SWITCHES.                                            00790000
008000     05  END-OF-FILE-SW              PIC  X(01)    VALUE 'Y'.     00800000
008100         88  END-OF-FILE                           VALUE 'N'.     00810000
008200     05  PS-WRITE-ERROR-CSV-SW       PIC X(01)     VALUE 'N'.     00820000
008300         88  PS-WRITE-ERROR-CSV-NO                 VALUE 'N'.     00830000
008400         88  PS-WRITE-ERROR-CSV-YES                VALUE 'Y'.     00840000
008500     05  PS-ERROR-SW                 PIC X(01)     VALUE 'N'.     00850000
008600         88  PS-ERROR-NO                           VALUE 'N'.     00860000
008700         88  PS-ERROR-YES                          VALUE 'Y'.     00870000
008800     05  PS-NUMERIC-ERROR-SW         PIC X(01)     VALUE 'N'.     00880000
008900         88  PS-NUMERIC-ERROR-NO                   VALUE 'N'.     00890000
009000         88  PS-NUMERIC-ERROR-YES                  VALUE 'Y'.     00900000
009100     05  PS-PO-FOUND-SW              PIC X(01)     VALUE 'N'.     00910000
009200         88  PS-PO-NOT-FOUND                       VALUE 'N'.     00920000
009300         88  PS-SINGLE-PO-FOUND                    VALUE 'Y'.     00930000
009400         88  PS-MULT-PO-FOUND                      VALUE 'M'.     00940000
009500     05  PS-PREV-PO-FOUND-SW         PIC X(01)     VALUE 'N'.     00950000
009600         88  PS-PREV-PO-NOT-FOUND                  VALUE 'N'.     00960000
009700         88  PS-PREV-SINGLE-PO-FOUND               VALUE 'Y'.     00970000
009800         88  PS-PREV-MULT-PO-FOUND                 VALUE 'M'.     00980000
009900     05  PS-UPC-FOUND-SW             PIC X(01)     VALUE 'N'.     00990000
010000         88  PS-UPC-NOT-FOUND                      VALUE 'N'.     01000000
010100         88  PS-UPC-FOUND                          VALUE 'Y'.     01010000
010200     05  PS-PO-LINE-FOUND-SW         PIC X(01)     VALUE 'N'.     01020000
010300         88  PS-PO-LINE-NOT-FOUND                  VALUE 'N'.     01030000
010400         88  PS-PO-LINE-FOUND                      VALUE 'Y'.     01040000
010500     05  PS-SSCC-FOUND-SW            PIC X(01)     VALUE 'N'.     01050000
010600         88  PS-SSCC-NOT-FOUND                     VALUE 'N'.     01060000
010700         88  PS-SSCC-FOUND                         VALUE 'Y'.     01070000
010800     05  PS-DC-FOUND-SW              PIC X(01)     VALUE 'N'.     01080000
010900         88  PS-DC-NOT-FOUND                       VALUE 'N'.     01090000
011000         88  PS-DC-FOUND                           VALUE 'Y'.     01100000
011100     05  PS-SSCC-F10-NUMERIC-SW      PIC X(01)     VALUE 'N'.     01110000
011110         88  PS-SSCC-F10-NOT-NUMERIC               VALUE 'N'.     01111000
011120         88  PS-SSCC-F10-NUMERIC                   VALUE 'Y'.     01112000
011130     05  PS-SSCC-L10-NUMERIC-SW      PIC X(01)     VALUE 'N'.     01113000
011140         88  PS-SSCC-L10-NOT-NUMERIC               VALUE 'N'.     01114000
011150         88  PS-SSCC-L10-NUMERIC                   VALUE 'Y'.     01115000
011160     05  PS-COMMENT-TYPE-SW          PIC X(01)     VALUE 'N'.     01116000
011170         88  PS-COMMENT-TYPE-ERROR                 VALUE 'E'.     01117000
011180         88  PS-COMMENT-TYPE-WARNING               VALUE 'W'.     01118000
011181         88  PS-COMMENT-TYPE-INFO                  VALUE 'I'.     01118100
011182     05  PS-REPORT-WRITE-SW          PIC X(01)     VALUE 'N'.     01118200
011183         88  PS-REPORT-WRITE-YES                   VALUE 'Y'.     01118300
011184         88  PS-REPORT-WRITE-NO                    VALUE 'N'.     01118400
011185     05  PS-DC-MATCH-SW              PIC X(01)     VALUE 'N'.     01118500
011186         88  PS-DC-MATCH                           VALUE 'Y'.     01118600
011187         88  PS-DC-MATCH-NO                        VALUE 'N'.     01118700
011188                                                                  01118800
011189 01  PC-CONSTANTS.                                                01118900
011190     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       01119000
011200                                                   COMP SYNC.     01120000
011210     05  PC-LINE-LIMIT               PIC S9(04)    VALUE +65.     01121000
011220     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01122000
011230                                                   'RCKUT170'.    01123000
011240     05  PC-REPORT-NBR-1             PIC  9(01)    VALUE 1.       01124000
011250                                                                  01125000
011260     05  PC-COMMA                    PIC X(01)     VALUE ','.     01126000
011270     05  PC-PERIOD                   PIC X(01)     VALUE '.'.     01127000
011280     05  PC-D                        PIC X(01)     VALUE 'D'.     01128000
011290     05  PC-T                        PIC X(01)     VALUE 'T'.     01129000
011300     05  PC-PROGRESSIVE-READ-LIMIT   PIC S9(9)     VALUE 1000     01130000
011400                                                    COMP-3.       01140000
011500                                                                  01150000
011600 01  PV-ACCUMULATOR-FIELDS.                                       01160000
011700     05  PV-RETRY-COUNT              PIC S9(04)  VALUE +0         01170000
011800                                                   COMP SYNC.     01180000
011900     05  PV-COMMA-COUNT              PIC S9(04)  VALUE +0         01190000
012000                                                   COMP SYNC.     01200000
012100     05  PV-PAGE-CNT                 PIC S9(04)    VALUE ZERO     01210000
012200                                                   COMP-3.        01220000
012300     05  PV-LINE-CNT                 PIC S9(04)    VALUE ZERO     01230000
012400                                                   COMP SYNC.     01240000
012500                                                                  01250000
012600     05  PV-PO-SPEC-INSTRUCTION.                                  01260000
012700         10  PV-PO-SPEC-INST-FIXED   PIC X(12)     VALUE          01270000
012800             'SEPHORA PO #'.                                      01280000
012900         10  PV-PO-SPEC-INST-PO-NBR  PIC 9(10)     VALUE ZERO.    01290000
013000     05  PV-PO-SPEC-INSTR-DESC       PIC X(150)    VALUE SPACES.  01300000
013100                                                                  01310000
013200 01  PV-ABEND-FIELDS.                                             01320000
013300     05  PV-ABEND-CODE               PIC S9(04)  VALUE ZERO       01330000
013400                                                   COMP SYNC.     01340000
013500     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)  VALUE SPACES.    01350000
013600     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'RCKUT170'.01360000
013700     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    01370000
013800     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    01380000
013900     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    01390000
014000     05  PV-ABEND-STRUCTURE-2         PIC X(8)   VALUE SPACES.    01400000
014100     05  PV-ABEND-STRUCTURE-3         PIC X(8)   VALUE SPACES.    01410000
014200     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01420000
014300     05  PV-SQLCODE                   PIC 9(9)   VALUE ZERO.      01430000
014400                                                                  01440000
014500 01  PV-UNSTRING-FIELDS.                                          01450000
014600     05  PV-FILE-NAME                PIC   X(20)    VALUE SPACES. 01460000
014700     05  PV-RECORD-TYPE              PIC   X(01)    VALUE SPACES. 01470000
014800     05  PV-ORD-NBR                  PIC   X(10)    VALUE SPACES. 01480000
014900     05  PV-MDSE-SOURCE              PIC   X(03)    VALUE SPACES. 01490000
015000     05  PV-DC-NBR                   PIC   X(04)    VALUE SPACES. 01500000
015100     05  PV-SSCC-NBR                 PIC   X(20)    VALUE SPACES. 01510000
015200     05  PV-UPC-NBR                  PIC   X(15)    VALUE SPACES. 01520000
015300     05  PV-SHIP-QTY                 PIC   X(05)    VALUE SPACES. 01530000
015400     05  PV-RECORD-FILLER            PIC   X(05)    VALUE SPACES. 01540000
015500     05  PV-RECORD-QTY               PIC   X(07)    VALUE SPACES. 01550000
015600                                                                  01560000
015700 01  PV-MISC-FIELDS.                                              01570000
015800     05  PV-READ-COUNT               PIC  S9(9)     VALUE ZERO    01580000
015900                                                    COMP-3.       01590000
016000     05  PV-PROGRESSIVE-READ-COUNT   PIC  S9(9)     VALUE ZERO    01600000
016100                                                    COMP-3.       01610000
016200     05  PV-READ-TRLR-COUNT          PIC  S9(9)     VALUE ZERO    01620000
016300                                                    COMP-3.       01630000
016400     05  PV-READ-DETL-COUNT          PIC  S9(9)     VALUE ZERO    01640000
016500                                                    COMP-3.       01650000
016600     05  PV-READ-OTHR-COUNT          PIC  S9(9)     VALUE ZERO    01660000
016700                                                    COMP-3.       01670000
016800     05  PV-GOOD-WRITE-COUNT         PIC  S9(9)     VALUE ZERO    01680000
016900                                                    COMP-3.       01690000
017000     05  PV-ERROR-WRITE-COUNT        PIC  S9(9)     VALUE ZERO    01700000
017100                                                    COMP-3.       01710000
017200     05  PV-TOTAL-RECORD-QTY         PIC  S9(9)     VALUE ZERO    01720000
017300                                                    COMP-3.       01730000
017400     05  PV-PO-SELECT-QTY            PIC  S9(9)     VALUE ZERO    01740000
017500                                                    COMP-3.       01750000
017600     05  PV-PO-MULT-SELECT-QTY       PIC  S9(9)     VALUE ZERO    01760000
017700                                                    COMP-3.       01770000
017800     05  PV-ERR-INVALID-COMMA-CNT    PIC S9(9)  VALUE ZERO COMP-3.01780000
017900     05  PV-ERR-BAD-REC-TYPE-CNT     PIC S9(9)  VALUE ZERO COMP-3.01790000
018000     05  PV-ERR-NON-NUMERIC-CNT      PIC S9(9)  VALUE ZERO COMP-3.01800000
018100     05  PV-ERR-PO-NOT-FOUND-CNT     PIC S9(9)  VALUE ZERO COMP-3.01810000
018200     05  PV-ERR-NO-POSKU-MULT-CNT    PIC S9(9)  VALUE ZERO COMP-3.01820000
018300     05  PV-ERR-UPC-NOT-FOUND-CNT    PIC S9(9)  VALUE ZERO COMP-3.01830000
018400     05  PV-ERR-SKU-NOT-ON-PO-CNT    PIC S9(9)  VALUE ZERO COMP-3.01840000
018500     05  PV-WRN-SSCC-SAME-PO-CNT     PIC S9(9)  VALUE ZERO COMP-3.01850013
018600     05  PV-WRN-SSCC-DIFF-PO-CNT     PIC S9(9)  VALUE ZERO COMP-3.01860013
018700     05  PV-ERR-LOC-NOT-A-KDC-CNT    PIC S9(9)  VALUE ZERO COMP-3.01870000
018800     05  PV-ERR-NOT-ON-LOCMST-CNT    PIC S9(9)  VALUE ZERO COMP-3.01880000
018900     05  PV-ERR-QTY-EQ-ZERO-CNT      PIC S9(9)  VALUE ZERO COMP-3.01890000
018930     05  PV-ERR-SSCC-SAME-PO-LNE-CNT                              01893013
018940                                     PIC S9(9)  VALUE ZERO COMP-3.01894012
019000     05  PV-INFO-DIFF-DC-CNT         PIC S9(9)  VALUE ZERO COMP-3.01900000
019001     05  PV-INFO-NO-DC-INSTR-CNT     PIC S9(9)  VALUE ZERO COMP-3.01900100
019002     05  PV-INFO-MULT-DC-INSTR-CNT   PIC S9(9)  VALUE ZERO COMP-3.01900200
019100     05  PV-DSP-NO-SRCE-KDC-CNT      PIC S9(9)  VALUE ZERO COMP-3.01910000
019200     05  PV-DSP-MULT-PO-FOUND-CNT    PIC S9(9)  VALUE ZERO COMP-3.01920000
019300     05  PV-PREV-RECORD-TYPE         PIC   X(1)     VALUE SPACE.  01930000
019400     05  PV-PREV-SENT-ORD-NBR        PIC 9(10)     VALUE ZERO.    01940000
019500     05  PV-PRINT-RECORD             PIC X(200)    VALUE SPACES.  01950000
019600     05  PV-LINE-SPACING             PIC S9(04)    VALUE ZERO     01960000
019700                                                   COMP SYNC.     01970000
019800     05  PV-CURRENT-TMST-DB2         PIC X(26)     VALUE SPACE.   01980000
019900     05  PV-CURRENT-TMST.                                         01990000
020000         10  PV-CURR-DATE.                                        02000000
020100             15  PV-CURR-DATE-CC     PIC  9(02)    VALUE ZERO.    02010000
020200             15  PV-CURR-DATE-YY     PIC  9(02)    VALUE ZERO.    02020000
020300             15  PV-CURR-DASH1       PIC  X        VALUE SPACE.   02030000
020400             15  PV-CURR-DATE-MM     PIC  9(02)    VALUE ZERO.    02040000
020500             15  PV-CURR-DASH2       PIC  X        VALUE SPACE.   02050000
020600             15  PV-CURR-DATE-DD     PIC  9(02)    VALUE ZERO.    02060000
020700             15  PV-CURR-DASH3       PIC  X        VALUE SPACE.   02070000
020800         10  PV-CURR-TIME.                                        02080000
020900             15  PV-CURR-TIME-HH     PIC  9(02)    VALUE ZERO.    02090000
021000             15  PV-CURR-TIME-P1     PIC  X        VALUE SPACE.   02100000
021100             15  PV-CURR-TIME-MM     PIC  9(02)    VALUE ZERO.    02110000
021200             15  PV-CURR-TIME-P2     PIC  X        VALUE SPACE.   02120000
021300             15  PV-CURR-TIME-SS     PIC  9(02)    VALUE ZERO.    02130000
021400             15  FILL                PIC  X(07)    VALUE SPACE.   02140000
021500                                                                  02150000
021600     05  PV-NULL-IND                 PIC  S9(4)    VALUE ZERO     02160000
021700                                                   COMP SYNC.     02170000
021800     05  PV-DB2-COUNT                PIC  S9(9)    VALUE ZERO     02180000
021900                                                   COMP-3.        02190000
022000     05  PV-DISP-NBR-C               PIC  ZZ,ZZZ,ZZ9.             02200000
022100     05  PV-DISP-NBR-C2              PIC  ZZ,ZZZ,ZZ9.             02210000
022200     05  PV-DISP-NBR                 PIC  ZZZZZZZ9.               02220000
022300     05  PV-DISP-NBR-15              PIC  999999999999999.        02230000
022400     05  PV-DISP-NBR-10              PIC  9999999999.             02240000
022500     05  PV-DISP-NBR-8               PIC  99999999.               02250000
022600     05  PV-DISP-NBR-18              PIC  999999999999999999.     02260000
022700     05  PV-DISP-NBR-4               PIC  9999.                   02270000
022710     05  PV-DISP-LINE                PIC  9(9)-.                  02271018
022800                                                                  02280000
022900     05  PV-DISP-OPER-IN-REC         PIC  9999.                   02290000
023000     05  PV-DISP-OPER-ON-PO          PIC  9999.                   02300000
023100                                                                  02310000
023200     05  PV-CURR-CCYY.                                            02320000
023300         10  PV-CURR-CC              PIC  X(02)    VALUE SPACE.   02330000
023400         10  PV-CURR-YY              PIC  X(02)    VALUE SPACE.   02340000
023500                                                                  02350000
023600     05  PV-SPLIT-SSCC-NBR.                                       02360000
023700         10  PV-SPLIT-SSCC-NBR-F10   PIC  X(10)    VALUE SPACE.   02370000
023800         10  PV-SPLIT-SSCC-NBR-L10   PIC  X(10)    VALUE SPACE.   02380000
023900                                                                  02390000
024000     05  PV-SSCC-NBR-FINAL.                                       02400000
024100         10  PV-SSCC-NBR-FINAL-F2    PIC  9(02)    VALUE ZERO.    02410000
024200         10  PV-SSCC-NBR-FINAL-L18   PIC  9(18)    VALUE ZERO.    02420000
024300                                                                  02430000
024400     05  PV-DELIVERY-SCAC            PIC  X(04)    VALUE SPACE.   02440000
024500     05  PV-LOC-NBR                  PIC  S9(4) COMP.             02450000
024510     05  PV-SSCC-PO-LINE             PIC  S9(9) COMP.             02451014
024600                                                                  02460000
024700******************************************************************02470000
024800*  WORK FIELDS FOR PRINTING A 200 CHARACTER REPORT.               02480000
024900******************************************************************02490000
025000     COPY DPWS200O.                                               02500000
025100                                                                  02510000
025200******************************************************************02520000
025300*  REPORT HEADINGS.                                               02530000
025400******************************************************************02540000
025500 01  HL1-HEADING-LINE-1.                                          02550000
025600     05  FILLER                  PIC  X(84)    VALUE SPACES.      02560000
025700     05  FILLER                  PIC  X(37)    VALUE              02570000
025800         'INBOUND MERCHANDISE FILE ERROR REPORT'.                 02580000
025900     05  FILLER                  PIC  X(79)    VALUE SPACES.      02590000
026000                                                                  02600000
026100 01  HL2-HEADING-LINE-2.                                          02610000
026200     05  FILLER                  PIC  X(85)    VALUE SPACES.      02620000
026300     05  FILLER                  PIC  X(35)    VALUE              02630000
026400         'RECORDS NOT PROCESSED DUE TO ERRORS'.                   02640000
026500     05  FILLER                  PIC  X(80)    VALUE SPACES.      02650000
027300                                                                  02730000
027310 01  HL3-HEADING-LINE-3.                                          02731000
027320     05  FILLER                  PIC X(22)     VALUE SPACE.       02732000
027330     05  FILLER                  PIC X(44)     VALUE              02733000
027340         'REC  SEPHORA       KOHLS  MDSE INPUT ACTUAL '.          02734011
027341     05  FILLER                  PIC X(38)     VALUE SPACE.       02734100
027342     05  FILLER                  PIC X(04)     VALUE              02734200
027343         'SHIP'.                                                  02734300
027344     05  FILLER                  PIC X(94)     VALUE SPACE.       02734400
027346                                                                  02734600
027347 01  HL4-HEADING-LINE-4.                                          02734700
027348     05  FILLER                  PIC X(22)     VALUE              02734800
027349         '  FILE NUMBER         '.                                02734900
027350     05  FILLER                  PIC X(44)     VALUE              02735000
027360         'TYP   ORDER         PO    SRC   DC     DC   '.          02736000
027370     05  FILLER                  PIC X(42)     VALUE              02737000
027380         '       SSCC              UPC          QTY'.             02738000
027390     05  FILLER                  PIC X(26)     VALUE              02739000
027391         '   ERROR DESCRIPTION'.                                  02739100
027392     05  FILLER                  PIC X(66)     VALUE SPACE.       02739200
027393                                                                  02739300
027394                                                                  02739400
027395******************************************************************02739500
027396*  REPORT DETAIL LINE.                                            02739600
027397******************************************************************02739700
027700 01  DL1-DETAIL-LINE-1.                                           02770000
027800     05  FILLER                  PIC  X(01)    VALUE SPACES.      02780000
027900     05  DL1-FILE-NAME           PIC  X(20)    VALUE SPACES.      02790000
028000     05  FILLER                  PIC  X(02)    VALUE SPACES.      02800000
028010     05  DL1-RECORD-TYPE         PIC  X(01)    VALUE SPACES.      02801000
028020     05  FILLER                  PIC  X(02)    VALUE SPACES.      02802000
028030     05  DL1-ORD-NBR             PIC  X(10)    VALUE SPACES.      02803000
028040     05  FILLER                  PIC  X(01)    VALUE SPACES.      02804000
028050     05  DL1-KOHLS-PO            PIC  Z(10)    VALUE SPACES.      02805000
028060     05  FILLER                  PIC  X(01)    VALUE SPACES.      02806000
028070     05  DL1-MDSE-SOURCE         PIC  X(03)    VALUE SPACES.      02807000
028080     05  FILLER                  PIC  X(02)    VALUE SPACES.      02808000
028090     05  DL1-DC-NBR              PIC  X(04)    VALUE SPACES.      02809000
028091     05  FILLER                  PIC  X(03)    VALUE SPACES.      02809100
028092     05  DL1-ACTUAL-DC           PIC  Z(04)    VALUE SPACES.      02809200
028093     05  FILLER                  PIC  X(01)    VALUE SPACES.      02809300
028094     05  DL1-SSCC-NBR            PIC  X(20)    VALUE SPACES.      02809400
028095     05  FILLER                  PIC  X(01)    VALUE SPACES.      02809500
028096     05  DL1-UPC-NBR             PIC  X(15)    VALUE SPACES.      02809600
028097     05  FILLER                  PIC  X(03)    VALUE SPACES.      02809700
028098     05  DL1-SHIP-QTY            PIC  X(05)    VALUE SPACES.      02809800
028099     05  FILLER                  PIC  X(02)    VALUE SPACES.      02809900
028100     05  DL1-ERROR-DESC          PIC  X(85)    VALUE SPACES.      02810000
028110                                                                  02811000
028120******************************************************************02812000
028130*  REPORT DETAIL COMMENT LINE.                                    02813000
028140******************************************************************02814000
028150 01  DL2-DETAIL-COMMENT-LINE.                                     02815000
028160     05  FILLER                  PIC X(05)     VALUE SPACES.      02816000
028170     05  DL2-COMMENT-TYPE        PIC X(09)     VALUE SPACES.      02817000
028180     05  DL2-COMMENT             PIC X(186)    VALUE SPACES.      02818000
028190                                                                  02819000
028200 01  MISCELLANEOUS-LINES.                                         02820000
028300     05  END-OF-REPORT-LINE.                                      02830000
028400         10  FILLER                  PIC  X(90)    VALUE SPACES.  02840000
028500         10  FILLER                  PIC  X(45)    VALUE          02850000
028600             '*******   E N D   O F   R E P O R T   *******'.     02860000
028700         10  FILLER                  PIC  X(65)    VALUE SPACES.  02870000
028800                                                                  02880000
028900     05  NO-ERROR-LINE.                                           02890000
029000         10  FILLER                  PIC  X(45)    VALUE          02900000
029100             '  NO ERRORS IN THIS RUN OF THE PROCESS       '.     02910000
029200         10  FILLER                  PIC  X(90)    VALUE SPACES.  02920000
029300         10  FILLER                  PIC  X(65)    VALUE SPACES.  02930000
029400                                                                  02940000
029500     05  EMPTY-FILE-LINE.                                         02950000
029600         10  FILLER                  PIC  X(45)    VALUE          02960000
029700             '  INPUT FILE EMPTY IN THIS RUN OF THE PROCESS'.     02970000
029800         10  FILLER                  PIC  X(90)    VALUE SPACES.  02980000
029900         10  FILLER                  PIC  X(65)    VALUE SPACES.  02990000
030000                                                                  03000000
030100******************************************************************03010000
030200*  COPYBOOKS.                                                     03020000
030300******************************************************************03030000
030400                                                                  03040000
030500*----------------------------------------------------------------*03050000
030600*    NUMERIC EDIT ROUTINE LAYOUT                                  03060000
030700*----------------------------------------------------------------*03070000
030800     COPY DPWS010I.                                               03080000
030900                                                                  03090000
031000*----------------------------------------------------------------*03100000
031100*    SHIPPED MERCHANDISE INPUT FILE LAYOUT                        03110000
031200*----------------------------------------------------------------*03120000
031300     COPY RCRD107.                                                03130000
031400                                                                  03140000
031500*----------------------------------------------------------------*03150000
031600*    SHIPPED MERCHANDISE OUPTPUT FILE LAYOUT                      03160000
031700*----------------------------------------------------------------*03170000
031800     COPY RCRD101.                                                03180000
031900                                                                  03190000
032000***************************************************************** 03200000
032100*  *** DB2 MESSAGE AREAS ****                                   * 03210000
032200***************************************************************** 03220000
032300     COPY DPWS004.                                                03230000
032400                                                                  03240000
032500*---------------------------------------------------------------* 03250000
032600*    DB2 AREA FOR TPURCHS - PURCHASE ORDER HEADER TABLE         * 03260000
032700*---------------------------------------------------------------* 03270000
032800     EXEC SQL                                                     03280000
032900          INCLUDE TPURCHS                                         03290000
033000     END-EXEC.                                                    03300000
033100                                                                  03310000
033200*---------------------------------------------------------------* 03320000
033300*    DB2 AREA FOR TPOINST - PURCHASE ORDER INSTRUCTIONS TABLE   * 03330000
033400*---------------------------------------------------------------* 03340000
033500     EXEC SQL                                                     03350000
033600          INCLUDE TPOINST                                         03360000
033700     END-EXEC.                                                    03370000
033800                                                                  03380000
033900*---------------------------------------------------------------* 03390000
034000*    DB2 AREA FOR TINSTCD - INSTRUCTIONS CODE TABLE             * 03400000
034100*---------------------------------------------------------------* 03410000
034200     EXEC SQL                                                     03420000
034300          INCLUDE TINSTCD                                         03430000
034400     END-EXEC.                                                    03440000
034500                                                                  03450000
034600*---------------------------------------------------------------* 03460000
034700*    DB2 AREA FOR TPLNSHP - PO PLAN SHIP TABLE                  * 03470000
034800*---------------------------------------------------------------* 03480000
034900     EXEC SQL                                                     03490000
035000          INCLUDE TPLNSHP                                         03500000
035100     END-EXEC.                                                    03510000
035200                                                                  03520000
035300*---------------------------------------------------------------* 03530000
035400*    DB2 AREA FOR TPURITM - PURCHASE ORDER ITEM TABLE           * 03540000
035500*---------------------------------------------------------------* 03550000
035600     EXEC SQL                                                     03560000
035700          INCLUDE TPURITM                                         03570000
035800     END-EXEC.                                                    03580000
035900                                                                  03590000
036000*---------------------------------------------------------------* 03600000
036100*    DB2 AREA FOR XLT_LOC - DC LOCATION TABLE                   * 03610000
036200*---------------------------------------------------------------* 03620000
036300     EXEC SQL                                                     03630000
036400          INCLUDE XLT00010                                        03640000
036500     END-EXEC.                                                    03650000
036600                                                                  03660000
036700*---------------------------------------------------------------* 03670000
036800*    DB2 AREA FOR XLT_UPC - LOGISTICS DOMAIN UPC TABLE          * 03680000
036900*---------------------------------------------------------------* 03690000
037000     EXEC SQL                                                     03700000
037100          INCLUDE XLT00006                                        03710000
037200     END-EXEC.                                                    03720000
037300                                                                  03730000
037400*---------------------------------------------------------------* 03740000
037500*    DB2 AREA FOR XLT_SKU - LOGISTICS DOMAIN SKU TABLE          * 03750000
037600*---------------------------------------------------------------* 03760000
037700     EXEC SQL                                                     03770000
037800          INCLUDE XLT00003                                        03780000
037900     END-EXEC.                                                    03790000
038000                                                                  03800000
038100*---------------------------------------------------------------* 03810000
038200*    DB2 AREA FOR XLT_VND_STYL - LOGISTICS DOMAIN STYLE TABLE   * 03820000
038300*---------------------------------------------------------------* 03830000
038400     EXEC SQL                                                     03840000
038500          INCLUDE XLT00004                                        03850000
038600     END-EXEC.                                                    03860000
038700                                                                  03870000
038800*---------------------------------------------------------------* 03880000
038900*    DB2 AREA FOR TSHPUNT - INBOUND CARTON HEADER TABLE         * 03890000
039000*---------------------------------------------------------------* 03900000
039100     EXEC SQL                                                     03910000
039200          INCLUDE TSHPUNT                                         03920000
039300     END-EXEC.                                                    03930000
039400                                                                  03940000
039500*---------------------------------------------------------------* 03950000
039600*    DB2 AREA FOR TSHUUPC - INBOUND CARTON UPC TABLE            * 03960000
039700*---------------------------------------------------------------* 03970000
039800     EXEC SQL                                                     03980000
039900          INCLUDE TSHUUPC                                         03990000
040000     END-EXEC.                                                    04000000
040100                                                                  04010000
040200*-----------------------------------------------------------------04020000
040300*    DB2 AREA FOR WST_INTGRTN_TYP - WST INTEGRATION TYPE TABLE    04030000
040400*-----------------------------------------------------------------04040000
040500     EXEC SQL                                                     04050000
040600         INCLUDE WST00008                                         04060000
040700     END-EXEC.                                                    04070000
040800                                                                  04080000
040900*-----------------------------------------------------------------04090000
041000*    DB2 AREA FOR WST_ATTR_DEFN - WST ATTRIBUTE DEFINITION TABLE  04100000
041100*-----------------------------------------------------------------04110000
041200     EXEC SQL                                                     04120000
041300         INCLUDE WST00009                                         04130000
041400     END-EXEC.                                                    04140000
041500                                                                  04150000
041600*-----------------------------------------------------------------04160000
041700*    DB2 AREA FOR WST_ATTR_ELEM - WST ATTRIBUTE ELEMENT TABLE     04170000
041800*-----------------------------------------------------------------04180000
041900     EXEC SQL                                                     04190000
042000         INCLUDE WST00010                                         04200000
042100     END-EXEC.                                                    04210000
042200                                                                  04220000
042300*---------------------------------------------------------------* 04230000
042400*    DB2 AREA FOR COMMUNICATIONS                                * 04240000
042500*---------------------------------------------------------------* 04250000
042600     EXEC SQL                                                     04260000
042700          INCLUDE SQLCA                                           04270000
042800     END-EXEC.                                                    04280000
042900                                                                  04290000
043000***************************************************************** 04300000
043100                                                                  04310000
043200 LINKAGE SECTION.                                                 04320000
043300                                                                  04330000
043400***************************************************************** 04340000
043500 PROCEDURE DIVISION.                                              04350000
043600***************************************************************** 04360000
043700                                                                  04370000
043800 0000-MAINLINE-PROCESSING.                                        04380000
043900                                                                  04390000
044000     DISPLAY 'START OF PROGRAM RCKUT170'.                         04400000
044100                                                                  04410000
044200     MOVE PC-PROGRESSIVE-READ-LIMIT TO PV-DISP-NBR.               04420000
044300     DISPLAY 'PROGRESSIVE READ DISPLAY TRIGGER IS:  '             04430000
044400             PV-DISP-NBR.                                         04440000
044500     DISPLAY ' '.                                                 04450000
044600                                                                  04460000
044700     PERFORM 1000-INITIALIZATION.                                 04470000
044800                                                                  04480000
044900     PERFORM 2000-PROCESS-EXTRACT-RECS                            04490000
045000       UNTIL END-OF-FILE.                                         04500000
045100                                                                  04510000
045200     IF  PV-READ-COUNT = 0                                        04520000
045300         DISPLAY '*** EMPTY INPUT FILE ***'                       04530000
045400         DISPLAY ' '                                              04540000
045500     END-IF.                                                      04550000
045600                                                                  04560000
045700     PERFORM 8050-PRINT-END-OF-RPT-LINE.                          04570000
045800                                                                  04580000
045900     PERFORM 8500-SHOW-COUNTERS.                                  04590000
046000                                                                  04600000
046100     CLOSE SHIPPED-MDSE-CSV-FILE                                  04610000
046200           SHIPPED-MDSE-OUTPUT-FILE                               04620000
046300           CSV-ERROR-FILE                                         04630000
046400           ERROR-REPORT-FILE.                                     04640000
046500                                                                  04650000
046600     IF  PS-REPORT-WRITE-YES                                      04660000
046700         MOVE 4050 TO RETURN-CODE                                 04670000
046800     END-IF.                                                      04680000
046900                                                                  04690000
047000     STOP RUN.                                                    04700000
047100                                                                  04710000
047200                                                                  04720000
047300******************************************************************04730000
047400*  OPEN FILES, READ THE FIRST INPUT RECORD AND PRINT THE REPORT  *04740000
047500*  HEADINGS.                                                     *04750000
047600******************************************************************04760000
047700 1000-INITIALIZATION.                                             04770000
047800                                                                  04780000
047900     OPEN INPUT  SHIPPED-MDSE-CSV-FILE.                           04790000
048000     OPEN OUTPUT SHIPPED-MDSE-OUTPUT-FILE                         04800000
048100                 CSV-ERROR-FILE                                   04810000
048200                 ERROR-REPORT-FILE.                               04820000
048300                                                                  04830000
048400** GET CURRENT TIMESTAMP                                          04840000
048500                                                                  04850000
048600     EXEC SQL                                                     04860000
048700         SET :PV-CURRENT-TMST-DB2 = CURRENT TIMESTAMP             04870000
048800     END-EXEC.                                                    04880000
048900                                                                  04890000
049000     EVALUATE TRUE                                                04900000
049100         WHEN SQLCODE = ZERO                                      04910000
049200             MOVE PV-CURRENT-TMST-DB2    TO PV-CURRENT-TMST       04920000
049300                                                                  04930000
049400             MOVE PV-CURR-DATE-MM        TO DP200O-RUN-MONTH      04940000
049500             MOVE PV-CURR-DATE-DD        TO DP200O-RUN-DAY        04950000
049600             MOVE PV-CURR-DATE-YY        TO DP200O-RUN-YEAR       04960000
049700                                                                  04970000
049800             MOVE PV-CURR-TIME-HH        TO DP200O-RUN-HOUR       04980000
049900             MOVE PV-CURR-TIME-MM        TO DP200O-RUN-MINUTE     04990000
050000         WHEN OTHER                                               05000000
050100             MOVE '1000-INITIALIZATION'  TO PV-ABEND-PARAGRAPH    05010000
050200             MOVE 'SET CURRENT TIMESTAMP'                         05020000
050300                                         TO PV-ABEND-OPERATION    05030000
050400             PERFORM 9900-DB2-ABEND                               05040000
050500         END-EVALUATE.                                            05050000
050600                                                                  05060000
050700     MOVE PC-CURRENT-PROGRAM-NAME                                 05070000
050800                                 TO DP200O-PROGRAM-NAME.          05080000
050900                                                                  05090000
051000     PERFORM 8000-PRINT-HEADINGS                                  05100000
051100                                                                  05110000
051200     PERFORM 7000-READ-INPUT.                                     05120000
051300                                                                  05130000
051400                                                                  05140000
051500******************************************************************05150000
051600*  THIS IS THE CONTROL PARAGRAPH FOR THE PROCESSING OF THE DATA  *05160000
051700*  FROM THE INPUT FILE.  IT WILL DO SOME INTIAL DATA CHECKS AND  *05170000
051800*  THEN PERFORM OTHER PARAGRAPHS TO FURTHER EDIT THE DATA BEFORE *05180000
051900*  THE DATA IS EITHER WRITTEN TO THE FURTHER PROCESSING OUTPUT   *05190000
052000*  FILE OR THE ERROR FILE IF ERRORS ARE FOUND.                   *05200000
052100******************************************************************05210000
052200 2000-PROCESS-EXTRACT-RECS.                                       05220000
052300                                                                  05230000
052400     IF  RC107-DETAIL-RECORD                                      05240000
052500         INSPECT RC107-SHIPPED-MDSE-CSV-REC                       05250000
052600             TALLYING PV-COMMA-COUNT                              05260000
052700             FOR ALL ','                                          05270000
052800         IF  PV-COMMA-COUNT < 7                                   05280000
052900         OR  PV-COMMA-COUNT > 8                                   05290000
053000             MOVE PV-READ-COUNT       TO PV-DISP-NBR              05300000
053100             DISPLAY 'DETAIL INPUT RECORD ' PV-DISP-NBR           05310000
053200                     ' COMMA COUNT NOT EQUAL TO 7 OR 8'           05320000
053300             DISPLAY ' SKIPPING TO NEXT RECORD'                   05330000
053400             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   05340000
053500             DISPLAY '------------------------'                   05350000
053600             MOVE SPACES TO DL2-COMMENT                           05360000
053700             STRING 'DETAIL RECORD DOES NOT HAVE THE PROPER NBR ' 05370000
053800                    'OF COMMAS IN THE REC - SHOULD HAVE 7 OR 8'   05380012
053900                                             DELIMITED BY SIZE    05390012
054000               INTO DL2-COMMENT                                   05400000
054100             SET PS-WRITE-ERROR-CSV-YES TO TRUE                   05410000
054200             SET PS-COMMENT-TYPE-ERROR TO TRUE                    05420000
054300             ADD +1 TO PV-ERR-INVALID-COMMA-CNT                   05430000
054400             PERFORM 8300-INVALID-RECORD                          05440000
054500         ELSE                                                     05450000
054600             PERFORM 3000-PROCESS-DETAIL-RECORD                   05460000
054700         END-IF                                                   05470000
054800     ELSE                                                         05480000
054900         MOVE PV-READ-COUNT       TO PV-DISP-NBR                  05490000
055000         DISPLAY 'INPUT RECORD ' PV-DISP-NBR                      05500000
055100                 ' RC107-RECORD-TYPE IS NOT EQUAL TO LETTER D'    05510000
055200         DISPLAY ' SKIPPING TO NEXT RECORD'                       05520000
055300         DISPLAY RC107-SHIPPED-MDSE-CSV-REC                       05530000
055400         DISPLAY '------------------------'                       05540000
055500         DISPLAY ' '                                              05550000
055600         MOVE SPACES TO DL2-COMMENT                               05560000
055700         STRING 'DATA RECORD DOES NOT HAVE THE PROPER RECORD '    05570000
055800                'TYPE - SHOULD BE THE LETTER D'                   05580000
055900                                 DELIMITED BY SIZE                05590000
056000           INTO DL2-COMMENT                                       05600000
056100         SET PS-WRITE-ERROR-CSV-YES TO TRUE                       05610000
056200         SET PS-COMMENT-TYPE-ERROR TO TRUE                        05620000
056300         ADD +1 TO PV-ERR-BAD-REC-TYPE-CNT                        05630000
056400         PERFORM 8300-INVALID-RECORD                              05640000
056500     END-IF.                                                      05650000
056600                                                                  05660000
056700     MOVE ZERO TO PV-COMMA-COUNT.                                 05670000
056800                                                                  05680000
056900     PERFORM 7000-READ-INPUT.                                     05690000
057000                                                                  05700000
057100******************************************************************05710000
057200*  THIS WILL CONTROL THE PROCESSING OF THE INDIVDIDUAL DETAIL    *05720000
057300*  RECORDS FROM THE INPUT FILE.  THIS WILL CALL PARAGRAPHS TO    *05730000
057400*  UNSTRING THE COMMA DELIMITED RECORD AND THEN IF NO ERRORS     *05740000
057500*  FOUND WILL THEN CALL PARAGRAPHS TO EDIT THE INDIVIDUAL        *05750000
057600*  FIELDS AND IF THE DATA IS GOOD, WILL WRITE THE RECORD TO THE  *05760000
057700*  GOOD DATA OUTPUT FILE FOR FURTHER PROCESSING.                 *05770000
057800******************************************************************05780000
057900 3000-PROCESS-DETAIL-RECORD.                                      05790000
058000                                                                  05800000
058100     IF  RC107-SHIPPED-MDSE-CSV-REC = LOW-VALUES OR SPACE         05810000
058200         MOVE PV-READ-COUNT           TO PV-DISP-NBR              05820000
058300         DISPLAY 'INPUT DETAIL RECORD ' PV-DISP-NBR               05830000
058400                 ' IS ALL LOW-VALUES OR SPACES'                   05840000
058500         DISPLAY 'SKIPPING TO NEXT RECORD'                        05850000
058600         DISPLAY '-----------------------'                        05860000
058700         SET PS-ERROR-YES         TO TRUE                         05870000
058800     ELSE                                                         05880000
058900         PERFORM 3100-UNSTRING-DETAIL-RECORD                      05890000
059000     END-IF.                                                      05900000
059100                                                                  05910000
059200     IF  PS-ERROR-NO                                              05920000
059300         PERFORM 3200-CHECK-NUMERIC-FIELDS                        05930000
059400     END-IF.                                                      05940000
059500                                                                  05950000
059600     IF  PS-ERROR-NO                                              05960000
059700         PERFORM 3300-VALIDATE-PO-NUMBER                          05970000
059800     END-IF.                                                      05980000
059900                                                                  05990000
060000     IF  PS-ERROR-NO                                              06000000
060100         PERFORM 3400-VALIDATE-UPC-NUMBER                         06010000
060200     END-IF.                                                      06020000
060300                                                                  06030000
060400     IF  PS-ERROR-NO                                              06040000
060500         PERFORM 3500-VALIDATE-SSCC-NUMBER                        06050000
060600     END-IF.                                                      06060000
060700                                                                  06070000
060800     IF  PS-ERROR-NO                                              06080000
060900         PERFORM 3600-VALIDATE-DC-NUMBER                          06090000
061000     END-IF.                                                      06100000
061100                                                                  06110000
061200     IF  PS-ERROR-NO                                              06120000
061300         IF  PV-MDSE-SOURCE = SPACES                              06130000
061400             MOVE SPACES TO RC101-MDSE-SOURCE                     06140000
061500             MOVE SPACES TO RC101-DELIVERY-SCAC                   06150000
061600         ELSE                                                     06160000
061700             MOVE PV-MDSE-SOURCE TO RC101-MDSE-SOURCE             06170000
061800             PERFORM 3700-VALIDATE-MDSE-SOURCE                    06180000
061900         END-IF                                                   06190000
062000     END-IF.                                                      06200000
062100                                                                  06210000
062200     IF  PS-ERROR-NO                                              06220000
062300         PERFORM 3800-VALIDATE-UNIT-QUANTITY                      06230000
062400     END-IF.                                                      06240000
062500                                                                  06250000
062600     SET  RC101-FILE-SOURCE-SEPHORA TO TRUE.                      06260000
062700     MOVE PV-FILE-NAME TO RC101-FILE-NAME.                        06270000
062800                                                                  06280000
062900     IF  PS-ERROR-NO                                              06290000
063000         WRITE SHIPPED-MDSE-OUTPUT-RECORD                         06300000
063100          FROM RC101-SHIPPED-MDSE-REC                             06310000
063200         ADD +1 TO PV-GOOD-WRITE-COUNT                            06320000
063300     END-IF.                                                      06330000
063310                                                                  06331000
063320                                                                  06332000
063330******************************************************************06333000
063340* UNSTRING THE DATA ON THE DETAIL RECORD.  IT IS COMMA DELIMITED  06334000
063350* AND FIELDS NEED TO BE SEPARATED INTO THE INDIVIDUAL DATA FIELDS 06335000
063360* FOR FURTHER PROCESSING.                                         06336000
063370******************************************************************06337000
063380 3100-UNSTRING-DETAIL-RECORD.                                     06338000
063390                                                                  06339000
063400     SET PS-ERROR-NO              TO TRUE.                        06340000
063500     UNSTRING RC107-SHIPPED-MDSE-CSV-REC DELIMITED BY ','         06350000
063600         INTO PV-FILE-NAME                                        06360000
063700              PV-RECORD-TYPE                                      06370000
063800              PV-ORD-NBR                                          06380000
063900              PV-MDSE-SOURCE                                      06390000
064000              PV-DC-NBR                                           06400000
064100              PV-SSCC-NBR                                         06410000
064200              PV-UPC-NBR                                          06420000
064300              PV-SHIP-QTY                                         06430000
064400              PV-RECORD-FILLER                                    06440000
064500      ON OVERFLOW                                                 06450000
064600         MOVE PV-READ-COUNT           TO PV-DISP-NBR              06460000
064700         DISPLAY 'INPUT DETAIL RECORD ' PV-DISP-NBR               06470000
064800                  ' HAS OVERFLOWED'                               06480000
064900         DISPLAY 'SKIPPING TO NEXT RECORD'                        06490000
065000         DISPLAY RC107-SHIPPED-MDSE-CSV-REC                       06500000
065100         DISPLAY '-----------------------'                        06510000
065200         SET PS-ERROR-YES             TO TRUE                     06520000
065300     END-UNSTRING.                                                06530000
065400                                                                  06540000
065500******************************************************************06550000
065600*  THIS PARAGRAPH WILL TAKE THE INDIVIDUAL FIELDS THAT SHOULD    *06560000
065700*  CONTAIN ONLY NUMERIC DATA AND PERFORM A CHECK TO CONFIRM THAT *06570000
065800*  THEY CONTAIN ONLY NUMERIC VALUES.  ANYTHING OTHER THAN A      *06580000
065900*  NUMBER VALUE IN THE CHECKED FIELDS WILL INDICATE AN ERROR AND *06590000
066000*  DATA WILL BE WRITTEN TO THE ERROR REPORT AND REJECTED FROM    *06600000
066100*  FURTHER PROCESSING.                                           *06610000
066200******************************************************************06620000
066300 3200-CHECK-NUMERIC-FIELDS.                                       06630000
066400                                                                  06640000
066500     SET PS-NUMERIC-ERROR-NO TO TRUE.                             06650000
066600                                                                  06660000
066700* NUMERIC CHECK THE PO NUMBER                                     06670000
066800     MOVE PV-ORD-NBR         TO DP010I-UNEDITED-FIELD.            06680000
066900     MOVE 10                 TO DP010I-MAXIMUM-DIGITS.            06690000
067000     MOVE 0                  TO DP010I-MAXIMUM-DECIMALS.          06700000
067100     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     06710000
263784     CALL DP010I-NUMERIC-EDIT-ROUTINE                             06721026
263784          USING DP010I-NUMERIC-EDIT-AREA.                         06722026
067300     IF  DP010I-ERROR-DETECTED                                    06730000
067400         SET PS-NUMERIC-ERROR-YES TO TRUE                         06740000
067500         DISPLAY 'PO NUMBER NUMERIC CHECK: ' PV-ORD-NBR           06750000
067600         DISPLAY '** DP010I-ERROR-IND = ' DP010I-ERROR-IND        06760000
067700         DISPLAY RC107-SHIPPED-MDSE-CSV-REC                       06770000
067800         DISPLAY '-----------------------'                        06780000
067900     ELSE                                                         06790000
068000         MOVE DP010I-NUMERIC-FIELD TO RC101-SENT-ORD-NBR          06800000
068100     END-IF.                                                      06810000
068200                                                                  06820000
068300* NUMERIC CHECK THE DC NUMBER                                     06830000
068400     MOVE PV-DC-NBR          TO DP010I-UNEDITED-FIELD.            06840000
068500     MOVE 4                  TO DP010I-MAXIMUM-DIGITS.            06850000
068600     MOVE 0                  TO DP010I-MAXIMUM-DECIMALS.          06860000
068700     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     06870000
263784     CALL DP010I-NUMERIC-EDIT-ROUTINE                             06881026
263784          USING DP010I-NUMERIC-EDIT-AREA.                         06882026
068900     IF  DP010I-ERROR-DETECTED                                    06890000
069000         SET PS-NUMERIC-ERROR-YES TO TRUE                         06900000
069100         DISPLAY 'DC NUMBER NUMERIC CHECK: ' PV-DC-NBR            06910000
069200         DISPLAY '** DP010I-ERROR-IND = ' DP010I-ERROR-IND        06920000
069300         DISPLAY RC107-SHIPPED-MDSE-CSV-REC                       06930000
069400         DISPLAY '-----------------------'                        06940000
069500     ELSE                                                         06950000
069600         MOVE DP010I-NUMERIC-FIELD TO RC101-DC-NBR                06960000
069700     END-IF.                                                      06970000
069800                                                                  06980000
069900* NUMERIC CHECK THE FIRST 10 DIGITS OF THE SSCC NUMBER            06990000
070000     MOVE PV-SSCC-NBR        TO PV-SPLIT-SSCC-NBR.                07000000
070100     SET PS-SSCC-F10-NOT-NUMERIC TO TRUE.                         07010000
070200                                                                  07020000
070300     MOVE PV-SPLIT-SSCC-NBR-F10 TO DP010I-UNEDITED-FIELD.         07030000
070400     MOVE 10                 TO DP010I-MAXIMUM-DIGITS.            07040000
070500     MOVE 0                  TO DP010I-MAXIMUM-DECIMALS.          07050000
070510     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     07051000
263784     CALL DP010I-NUMERIC-EDIT-ROUTINE                             07051226
263784          USING DP010I-NUMERIC-EDIT-AREA.                         07051326
070512     IF  DP010I-ERROR-DETECTED                                    07051400
070513         SET PS-NUMERIC-ERROR-YES TO TRUE                         07051500
070514         SET PS-SSCC-F10-NOT-NUMERIC TO TRUE                      07051600
070515         DISPLAY 'SSCC FIRST 10 DIGIT NUMERIC CHECK: '            07051700
070516                 PV-SPLIT-SSCC-NBR-F10                            07051800
070517         DISPLAY '** DP010I-ERROR-IND = ' DP010I-ERROR-IND        07051900
070518         DISPLAY RC107-SHIPPED-MDSE-CSV-REC                       07052000
070519         DISPLAY '-----------------------'                        07052100
070520     ELSE                                                         07052200
070530         SET PS-SSCC-F10-NUMERIC TO TRUE                          07053000
070540     END-IF.                                                      07054000
070550                                                                  07055000
070560* NUMERIC CHECK THE SECOND 10 DIGITS OF THE SSCC NUMBER           07056000
070570     MOVE PV-SSCC-NBR        TO PV-SPLIT-SSCC-NBR.                07057000
070580     SET PS-SSCC-L10-NOT-NUMERIC TO TRUE.                         07058000
070590                                                                  07059000
070600     MOVE PV-SPLIT-SSCC-NBR-L10 TO DP010I-UNEDITED-FIELD.         07060000
070700     MOVE 10                 TO DP010I-MAXIMUM-DIGITS.            07070000
070800     MOVE 0                  TO DP010I-MAXIMUM-DECIMALS.          07080000
070900     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     07090000
263784     CALL DP010I-NUMERIC-EDIT-ROUTINE                             07101026
263784          USING DP010I-NUMERIC-EDIT-AREA.                         07102026
071100     IF  DP010I-ERROR-DETECTED                                    07110000
071200         SET PS-NUMERIC-ERROR-YES TO TRUE                         07120000
071300         SET PS-SSCC-L10-NOT-NUMERIC TO TRUE                      07130000
071400         DISPLAY 'SSCC SECOND 10 DIGIT NUMERIC CHECK: '           07140000
071500                 PV-SPLIT-SSCC-NBR-L10                            07150000
071600         DISPLAY '** DP010I-ERROR-IND = ' DP010I-ERROR-IND        07160000
071700         DISPLAY RC107-SHIPPED-MDSE-CSV-REC                       07170000
071800         DISPLAY '-----------------------'                        07180000
071900     ELSE                                                         07190000
072000         SET PS-SSCC-L10-NUMERIC TO TRUE                          07200000
072010         IF  PS-SSCC-F10-NUMERIC                                  07201000
072020             MOVE PV-SSCC-NBR  TO PV-SSCC-NBR-FINAL               07202000
072030             MOVE PV-SSCC-NBR-FINAL-L18                           07203000
072040                               TO RC101-SENT-SSCC-NBR             07204000
072050         ELSE                                                     07205000
072060             MOVE ZEROS        TO RC101-SENT-SSCC-NBR             07206000
072070         END-IF                                                   07207000
072080     END-IF.                                                      07208000
072090                                                                  07209000
072100* NUMERIC CHECK THE UPC NUMBER                                    07210000
072101     MOVE PV-UPC-NBR         TO DP010I-UNEDITED-FIELD.            07210100
072102     MOVE 15                 TO DP010I-MAXIMUM-DIGITS.            07210200
072103     MOVE 0                  TO DP010I-MAXIMUM-DECIMALS.          07210300
072104     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     07210400
263784     CALL DP010I-NUMERIC-EDIT-ROUTINE                             07210626
263784          USING DP010I-NUMERIC-EDIT-AREA.                         07210726
072106     IF  DP010I-ERROR-DETECTED                                    07210800
072107         SET PS-NUMERIC-ERROR-YES TO TRUE                         07210900
072108         DISPLAY 'UPC NUMBER NUMERIC CHECK: ' PV-UPC-NBR          07211000
072109         DISPLAY '** DP010I-ERROR-IND = ' DP010I-ERROR-IND        07211100
072110         DISPLAY RC107-SHIPPED-MDSE-CSV-REC                       07211200
072120         DISPLAY '-----------------------'                        07212000
072130     ELSE                                                         07213000
072140*        MOVE DP010I-NUM-FIELD-13-DIG-4-DEC TO RC101-UPC-NBR      07214000
072150         MOVE DP010I-NUM-FIELD-15-DIG-2-DEC TO RC101-UPC-NBR      07215000
072160     END-IF.                                                      07216000
072170                                                                  07217000
072180* NUMERIC CHECK THE SHIPPED QUANTITY                              07218000
072190     MOVE PV-SHIP-QTY        TO DP010I-UNEDITED-FIELD.            07219000
072200     MOVE 5                  TO DP010I-MAXIMUM-DIGITS.            07220000
072300     MOVE 0                  TO DP010I-MAXIMUM-DECIMALS.          07230000
072400     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     07240000
263784     CALL DP010I-NUMERIC-EDIT-ROUTINE                             07251026
263784          USING DP010I-NUMERIC-EDIT-AREA.                         07252026
072600     IF  DP010I-ERROR-DETECTED                                    07260000
072700         SET PS-NUMERIC-ERROR-YES TO TRUE                         07270000
072800         DISPLAY 'SHIP QTY NUMERIC CHECK: ' PV-SHIP-QTY           07280000
072900         DISPLAY '** DP010I-ERROR-IND = ' DP010I-ERROR-IND        07290000
073000         DISPLAY RC107-SHIPPED-MDSE-CSV-REC                       07300000
073100         DISPLAY '-----------------------'                        07310000
073200     ELSE                                                         07320000
073300         MOVE DP010I-NUMERIC-FIELD TO RC101-SHIP-QTY              07330000
073400     END-IF.                                                      07340000
073500                                                                  07350000
073600     IF  PS-NUMERIC-ERROR-YES                                     07360000
073700         SET PS-ERROR-YES TO TRUE                                 07370000
073800         MOVE PV-READ-COUNT       TO PV-DISP-NBR                  07380000
073900         MOVE SPACES TO DL2-COMMENT                               07390000
074000         STRING 'DATA WITHIN THE INDIVIDUAL FIELDS OF THIS DE'    07400000
074100                'TAIL RECORD ARE NOT NUMERIC'                     07410000
074200                                         DELIMITED BY SIZE        07420000
074300           INTO DL2-COMMENT                                       07430000
074400         SET PS-WRITE-ERROR-CSV-YES TO TRUE                       07440000
074500         SET PS-COMMENT-TYPE-ERROR TO TRUE                        07450000
074600         ADD +1 TO PV-ERR-NON-NUMERIC-CNT                         07460000
074700         PERFORM 8300-INVALID-RECORD                              07470000
074800     END-IF.                                                      07480000
074900                                                                  07490000
075000                                                                  07500000
075100******************************************************************07510000
075200* THIS PARAGRAPH WILL TAKE THE PO NUMBER AND TRY TO GET THE      *07520000
075300* KOHLS PO NUMBER.  THE DATA COMING FROM SEPHORA WILL CONTAIN    *07530000
075400* THERE ORDER NUMBER AND THIS PARAGRAPH WILL TAKE THEIR ORDER    *07540000
075500* NUMBER IN THE INPUT FILE AND ATTEMPT TO FIND THE RELATED KOHLS *07550000
075600* PO NUMBER THRU A LOOKUP FOR A SPECIFICALLY FORMATTED MESSAGE   *07560000
075700* IN THE PO INSTRUCTION TABLE.  SHOULD BE NOTED THAT IT IS       *07570000
075800* POSSIBLE THAT THE ONE SEPHORA PO COULD BE SPLIT OVER MULTIPLE  *07580000
075900* KOHLS PO NUMBERS DUE TO CROSSING MULTIPLE DEPARTMENTS - THERE  *07590000
076000* IS LOGIC IN THIS PROCESS TO HANDLE THAT POSSIBLITY.            *07600000
076100*                                                                *07610000
076200* IN THE FIRST IF STATEMENT, WE ARE CHECKING TO SEE IF THE SENT  *07620000
076300* ORDER NUMBER FROM THE CURRENT RECORD IS THE SAME AS THE SENT   *07630000
076400* ORDER NUMBER FROM THE PREVIOUS RECORD AND IF IT IS, THEN       *07640000
076500* SETTING THE PV-PO-FOUND-SW TO THE PV-PREV-PO-FOUND-SW VALUE TO *07650000
076600* DRIVE PROCESSING VIA THE SECOND SET OF IF STATEMENTS.  IF THE  *07660000
076700* SENT ORDER NUMBER RELATES TO MULTIPLE KOHLS PO NUMBER, THEN WE *07670000
076800* WANT TO MAKE SURE THAT THE LOGIC GOES THRU THE                 *07680000
076900* 3320-FIND-PO-NBR-MULT PARAGRAPH USING BOTH THE SENT PO NUMBER  *07690000
076910* AND THE UPC NUMBER TO MATCH TO THE RIGHT KOHLS PO SINCE THE    *07691000
076920* SENT PO NUMBER LANDED UP CREATING MULTIPLE KOHLS PO NUMBERS    *07692000
076930* DUE TO THE ITEMS CROSSING MULTIPLE KOHLS DEPARTMENTS.          *07693000
076940******************************************************************07694000
076950 3300-VALIDATE-PO-NUMBER.                                         07695000
076960                                                                  07696000
076970     IF  RC101-SENT-ORD-NBR = PV-PREV-SENT-ORD-NBR                07697000
076980         MOVE PS-PREV-PO-FOUND-SW TO PS-PO-FOUND-SW               07698000
076990     ELSE                                                         07699000
076991         MOVE RC101-SENT-ORD-NBR TO PV-PO-SPEC-INST-PO-NBR        07699100
076992         MOVE PV-PO-SPEC-INSTRUCTION TO PV-PO-SPEC-INSTR-DESC     07699200
076993         SET PS-PO-NOT-FOUND TO TRUE                              07699300
076994         PERFORM 3310-FIND-PO-NUMBER                              07699400
076995         MOVE RC101-SENT-ORD-NBR TO PV-PREV-SENT-ORD-NBR          07699500
076996     END-IF.                                                      07699600
076997                                                                  07699700
076998     IF  PS-SINGLE-PO-FOUND                                       07699800
076999         MOVE PURCHS-PO-NBR TO RC101-KOHLS-ORD-NBR                07699900
077000         SET PS-PREV-SINGLE-PO-FOUND TO TRUE                      07700000
077100     ELSE                                                         07710000
077200         IF  PS-PO-NOT-FOUND                                      07720000
077300             SET PS-PREV-PO-NOT-FOUND TO TRUE                     07730000
077400             SET PS-ERROR-YES TO TRUE                             07740000
077500             MOVE PV-READ-COUNT       TO PV-DISP-NBR              07750000
077600             DISPLAY 'INPUT RECORD ' PV-DISP-NBR                  07760000
077700                     ' COULD NOT FIND KOHLS PO NUMBER'            07770000
077800             DISPLAY ' SKIPPING TO NEXT RECORD'                   07780000
077900             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   07790000
078000             DISPLAY '-----------------------'                    07800000
078100             MOVE SPACES TO DL2-COMMENT                           07810000
078200             STRING 'COULD NOT FIND A KOHLS PO NBR FOR THE PO '   07820000
078300                    'NBR IN THE INPUT RECORD'                     07830000
078400                                             DELIMITED BY SIZE    07840000
078500               INTO DL2-COMMENT                                   07850000
078600             SET PS-WRITE-ERROR-CSV-YES TO TRUE                   07860000
078700             SET PS-COMMENT-TYPE-ERROR TO TRUE                    07870000
078800             ADD +1 TO PV-ERR-PO-NOT-FOUND-CNT                    07880000
078900             PERFORM 8300-INVALID-RECORD                          07890000
079000         ELSE                                                     07900000
079100             SET PS-PREV-MULT-PO-FOUND TO TRUE                    07910000
079200             MOVE PV-READ-COUNT       TO PV-DISP-NBR              07920000
079300             DISPLAY 'INPUT RECORD ' PV-DISP-NBR                  07930000
079400                     ' FOUND MULTIPLE KOHLS PO NBR'               07940000
079500                     ' DOING CURSOR TO FIND KOHLS PO WITH THE'    07950000
079600                     ' UPC NUMBER ON IT'                          07960000
079601             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   07960100
079602             DISPLAY '-----------------------'                    07960200
079603             MOVE RC101-UPC-NBR TO DK-UPC-NUMBER                  07960300
079604             SET PS-PO-NOT-FOUND TO TRUE                          07960400
079605             ADD +1 TO PV-DSP-MULT-PO-FOUND-CNT                   07960500
079606             PERFORM 3320-FIND-PO-NBR-MULT                        07960600
079607             IF  PS-SINGLE-PO-FOUND                               07960700
079608                 MOVE PURCHS-PO-NBR TO RC101-KOHLS-ORD-NBR        07960800
079609             ELSE                                                 07960900
079610                 SET PS-ERROR-YES TO TRUE                         07961000
079620                 MOVE PV-READ-COUNT       TO PV-DISP-NBR          07962000
079630                 DISPLAY 'INPUT RECORD ' PV-DISP-NBR              07963000
079640                         ' COULD NOT FIND KOHLS PO NUMBER'        07964000
079650                 DISPLAY '** COULD BE THAT THERE ARE MULTIPLE'    07965000
079660                         ' KOHLS PO NUMBERS FOR THE VENDOR'       07966000
079670                 DISPLAY '** PO BUT NONE OF THEM HAVE THE SKU'    07967000
079680                         ' ASSOCIATED TO THE UPC ON THE INPUT'    07968000
079690                 DISPLAY ' SKIPPING TO NEXT RECORD'               07969000
079700                 DISPLAY RC107-SHIPPED-MDSE-CSV-REC               07970000
079800                 DISPLAY '-----------------------'                07980000
079900                 MOVE SPACES TO DL2-COMMENT                       07990000
080000                 STRING 'COULD NOT FIND SPECIFIC KOHLS PO - MULT' 08000025
080100                        'IPLE KOHLS PO BUT NONE WITH SKU/UPC'     08010025
080200                                              DELIMITED BY SIZE   08020025
080500                   INTO DL2-COMMENT                               08050000
080600                 SET PS-WRITE-ERROR-CSV-YES TO TRUE               08060000
080700                 SET PS-COMMENT-TYPE-ERROR TO TRUE                08070000
080800                 ADD +1 TO PV-ERR-NO-POSKU-MULT-CNT               08080000
080900                 PERFORM 8300-INVALID-RECORD                      08090000
081000             END-IF                                               08100000
081100         END-IF                                                   08110000
081200     END-IF.                                                      08120000
081300                                                                  08130000
081400                                                                  08140000
081500******************************************************************08150000
081600* THIS PARAGRAPH WILL PERFORM A JOIN TO SEE IF WE CAN FIND THE   *08160000
081700* KOHLS PO NUMBER IN THE SPECIAL INSTRUCTIONS.  THE SPECIAL      *08170000
081800* INSTRUCTIONS MESSAGE WOULD HAVE A RECIPIENT CODE OF VN AND THE *08180000
081900* ACTUAL MESSAGE WOULD BE FORMATTED LIKE THE FOLLOWING:          *08190000
082000*     SEPHORA PO #0007657425                                     *08200000
082100* THE 10 DIGIT NUMBER FOLLIWNG THE # SIGN IS THE SEPHORA PO      *08210000
082200* NUMBER.                                                        *08220000
082300* FYI - IF THE FOLLOWING SQL COMES BACK WITH MULTIPLE ROWS, THEN *08230000
082400*       3320-FIND-PO-NBR-MULT PARAGRAPH WILL BE EXECUTED TO GET  *08240000
082500*       TO ONE PO TO BE USED.                                    *08250000
082600******************************************************************08260000
082700 3310-FIND-PO-NUMBER.                                             08270000
082800                                                                  08280000
082900     ADD +1 TO PV-PO-SELECT-QTY.                                  08290000
083000                                                                  08300000
083100     EXEC SQL                                                     08310000
083200          SELECT C.PO_NBR                                         08320000
083300               , A.RECIP_CDE                                      08330000
083400               , A.INSTR_NBR                                      08340000
083500               , B.INSTR_DESC                                     08350000
083600               , B.CRE_DTE                                        08360000
083700            INTO :PURCHS-PO-NBR                                   08370000
083800               , :POINST-RECIP-CDE                                08380000
083900               , :POINST-INSTR-NBR                                08390000
084000               , :INSTCD-INSTR-DESC                               08400000
084100               , :INSTCD-CRE-DTE                                  08410000
084200            FROM TPOINST A                                        08420000
084300               , TINSTCD B                                        08430000
084400               , TPURCHS C                                        08440000
084500          WHERE UPPER(B.INSTR_DESC) = :PV-PO-SPEC-INSTR-DESC      08450000
084600            AND A.INSTR_NBR         = B.INSTR_NBR                 08460000
084700            AND A.RECIP_CDE         = 'VN'                        08470000
084800            AND C.PO_NBR            = A.PO_NBR                    08480000
084900            AND C.VER_STATUS_CDE    = 'A'                         08490000
085000          WITH UR                                                 08500000
085100     END-EXEC                                                     08510000
085200                                                                  08520000
085300     EVALUATE TRUE                                                08530000
085400         WHEN SQLCODE  = +0                                       08540000
085500             SET PS-SINGLE-PO-FOUND TO TRUE                       08550000
085600         WHEN SQLCODE  = +100                                     08560000
085700             SET PS-PO-NOT-FOUND TO TRUE                          08570000
085800         WHEN SQLCODE  = -811                                     08580000
085900             SET PS-MULT-PO-FOUND TO TRUE                         08590000
086000         WHEN OTHER                                               08600000
086100             DISPLAY '3310-FIND-PO-NUMBER DB2 ERROR'              08610000
086200             DISPLAY PV-PO-SPEC-INSTRUCTION                       08620000
086300             DISPLAY 'INPUT RECORD IS: '                          08630000
086400             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   08640000
086500             DISPLAY '-----------------------'                    08650000
086600             MOVE '3310-FIND-PO-NUMBER' TO PV-ABEND-PARAGRAPH     08660000
086700             MOVE 'GET KOHLS PO FROM TPOINST'                     08670000
086800                                            TO PV-ABEND-OPERATION 08680000
086900             PERFORM 9900-DB2-ABEND                               08690000
087000     END-EVALUATE.                                                08700000
087100                                                                  08710000
087200                                                                  08720000
087300******************************************************************08730000
087400* THIS PARAGRAPH WILL BE USED TO GET THE MOST RECENT PO NUMBER   *08740000
087500* BASED ON MULTIPLE PO'S COMING BACK FOR THE SEPHORA PO NUMBER.  *08750000
087600* THE RESULTS WILL BE RETURNED WITH THE MOST RECENT SHIP DATE    *08760000
087700* COMING FIRST AND WE WOULD USE THE FIRST ROW RETURNED.          *08770000
087800* THIS JOINS IN THE PO ITEM TABLE SO IT TAKES NOT ONLY THE       *08780000
087810* PO BUT ALSO THE UPC NUMBER TO MATCH AT THE PO/ITEM LEVEL TO    *08781000
087820* GET THE KOHLS PO NUMBER TO BE USED.                            *08782000
087830******************************************************************08783000
087840 3320-FIND-PO-NBR-MULT.                                           08784000
087850                                                                  08785000
087860     ADD +1 TO PV-PO-MULT-SELECT-QTY.                             08786000
087870                                                                  08787000
087880     EXEC SQL                                                     08788000
087890          SELECT C.PO_NBR                                         08789000
087900               , A.RECIP_CDE                                      08790000
088000               , A.INSTR_NBR                                      08800000
088100               , B.INSTR_DESC                                     08810000
088200               , B.CRE_DTE                                        08820000
088300               , D.DONT_SHIP_BEF_DTE                              08830000
088400               , D.CAN_IFNOT_SHIP_DTE                             08840000
088500               , D.EXT_CAN_DTE                                    08850000
088600            INTO :PURCHS-PO-NBR                                   08860000
088700               , :POINST-RECIP-CDE                                08870000
088800               , :POINST-INSTR-NBR                                08880000
088900               , :INSTCD-INSTR-DESC                               08890000
089000               , :INSTCD-CRE-DTE                                  08900000
089100               , :PLNSHP-DONT-SHIP-BEF-DTE                        08910000
089200               , :PLNSHP-CAN-IFNOT-SHIP-DTE                       08920000
089300               , :PLNSHP-EXT-CAN-DTE                              08930000
089400            FROM TPOINST A                                        08940000
089500               , TINSTCD B                                        08950000
089600               , TPURCHS C                                        08960000
089700               , TPLNSHP D                                        08970000
089800               , XLT_UPC E                                        08980000
089810               , XLT_SKU F                                        08981000
089820               , TPURITM G                                        08982000
089830          WHERE UPPER(B.INSTR_DESC) = :PV-PO-SPEC-INSTR-DESC      08983000
089840            AND A.INSTR_NBR         = B.INSTR_NBR                 08984000
089850            AND A.RECIP_CDE         = 'VN'                        08985000
089860            AND C.PO_NBR            = A.PO_NBR                    08986000
089870            AND C.VER_STATUS_CDE    = 'A'                         08987000
089880            AND D.PO_NBR            = C.PO_NBR                    08988000
089890            AND D.VER_STATUS_CDE    = 'A'                         08989000
089900            AND E.UPC_NBR           = :DK-UPC-NUMBER              08990000
090000            AND F.INTR_UPC_ID       = E.INTR_UPC_ID               09000000
090100            AND G.PO_NBR            = C.PO_NBR                    09010000
090200            AND G.RMS_PO_SKU_NBR    = F.SKU_NBR                   09020000
090300          ORDER BY D.DONT_SHIP_BEF_DTE DESC                       09030000
090400                 , C.PO_NBR                                       09040000
090500          WITH UR                                                 09050000
090600     END-EXEC                                                     09060000
090700                                                                  09070000
090800     EVALUATE TRUE                                                09080000
090900         WHEN SQLCODE  = +0                                       09090000
091000         WHEN SQLCODE  = -811                                     09100000
091100             SET PS-SINGLE-PO-FOUND TO TRUE                       09110000
091200         WHEN SQLCODE  = +100                                     09120000
091300             SET PS-PO-NOT-FOUND TO TRUE                          09130000
091400         WHEN OTHER                                               09140000
091500             DISPLAY '3320-FIND-PO-NBR-MULT DB2 ERROR'            09150000
091510             DISPLAY PV-PO-SPEC-INSTRUCTION                       09151000
091520             DISPLAY 'INPUT RECORD IS: '                          09152000
091530             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   09153000
091540             DISPLAY '-----------------------'                    09154000
091550             MOVE '3310-FIND-PO-NBR-MULT' TO PV-ABEND-PARAGRAPH   09155000
091560             MOVE 'GET KOHLS PO FROM TPOINST'                     09156000
091570                                            TO PV-ABEND-OPERATION 09157000
091580             PERFORM 9900-DB2-ABEND                               09158000
091590     END-EVALUATE.                                                09159000
091600                                                                  09160000
091700                                                                  09170000
091800******************************************************************09180000
091900* THIS PARAGRAPH WILL BE USED TO VALIDATE THE UPC NUMBER PASSED  *09190000
092000* IN THE INPUT FILE AND TIE THAT UPC NUMBER TO A SKU NUMBER AND  *09200000
092100* THEN TRY TO MATCH THE SKU TO THE KOHLS PO NUMBER TO GET THE    *09210000
092200* LINE NUMBER FOR THE PO.                                        *09220000
092300******************************************************************09230000
092400 3400-VALIDATE-UPC-NUMBER.                                        09240000
092500                                                                  09250000
092600     MOVE RC101-UPC-NBR TO DK-UPC-NUMBER.                         09260000
092700     SET PS-UPC-NOT-FOUND TO TRUE.                                09270000
092800                                                                  09280000
092900     PERFORM 3410-FIND-UPC-NBR.                                   09290000
093000                                                                  09300000
093100     IF  PS-UPC-NOT-FOUND                                         09310000
093200         SET PS-ERROR-YES TO TRUE                                 09320000
093300         MOVE PV-READ-COUNT       TO PV-DISP-NBR                  09330000
093400         MOVE DK-UPC-NUMBER       TO PV-DISP-NBR-15               09340000
093500         DISPLAY 'INPUT RECORD ' PV-DISP-NBR                      09350000
093510                 ' COULD NOT FIND UPC NBR ' PV-DISP-NBR-15        09351000
093520                 ' FOR SEPHORA PO ' RC101-SENT-ORD-NBR            09352000
093521         DISPLAY ' SKIPPING TO NEXT RECORD'                       09352100
093522         DISPLAY RC107-SHIPPED-MDSE-CSV-REC                       09352200
093523         DISPLAY '-----------------------'                        09352300
093524         MOVE SPACES TO DL2-COMMENT                               09352400
093525         STRING 'COULD NOT FIND THE UPC NBR FROM THE INPUT'       09352500
093526                ' RECORD'                DELIMITED BY SIZE        09352600
093527           INTO DL2-COMMENT                                       09352700
093528         SET PS-WRITE-ERROR-CSV-YES TO TRUE                       09352800
093529         SET PS-COMMENT-TYPE-ERROR TO TRUE                        09352900
093530         ADD +1 TO PV-ERR-UPC-NOT-FOUND-CNT                       09353000
093531         PERFORM 8300-INVALID-RECORD                              09353100
093532     ELSE                                                         09353200
093533         SET PS-PO-LINE-NOT-FOUND TO TRUE                         09353300
093534         MOVE RC101-KOHLS-ORD-NBR TO DK-PO-NUMBER                 09353400
093535         MOVE RC101-SKU-NBR       TO DK-SKU-NUMBER                09353500
093536         PERFORM 3420-FIND-PO-LINE-NBR                            09353600
093537         IF  PS-PO-LINE-NOT-FOUND                                 09353700
093538             SET PS-ERROR-YES TO TRUE                             09353800
093539             MOVE PV-READ-COUNT       TO PV-DISP-NBR              09353900
093540             DISPLAY 'INPUT RECORD ' PV-DISP-NBR                  09354000
093541                     ' COULD NOT FIND PO LINE NBR'                09354100
093542             MOVE DK-PO-NUMBER TO PV-DISP-NBR-10                  09354200
093543             MOVE DK-SKU-NUMBER TO PV-DISP-NBR-8                  09354300
093544             DISPLAY 'KOHLS PO NBR IS: ' PV-DISP-NBR-10           09354400
093545                     '     SKU NBR IS: ' PV-DISP-NBR-8            09354500
093546             DISPLAY ' SKIPPING TO NEXT RECORD'                   09354600
093547             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   09354700
093548             DISPLAY '-----------------------'                    09354800
093549             MOVE SPACES TO DL2-COMMENT                           09354900
093550             STRING 'COULD NOT FIND THE LINE NBR FOR KOHLS PO '   09355000
093551                    PV-DISP-NBR-10                                09355100
093552                    ' FOR SKU NBR ' PV-DISP-NBR-8                 09355200
093553                                DELIMITED BY SIZE                 09355300
093554               INTO DL2-COMMENT                                   09355400
093555             SET PS-WRITE-ERROR-CSV-YES TO TRUE                   09355500
093556             SET PS-COMMENT-TYPE-ERROR TO TRUE                    09355600
093557             ADD +1 TO PV-ERR-SKU-NOT-ON-PO-CNT                   09355700
093558             PERFORM 8300-INVALID-RECORD                          09355800
093559         END-IF                                                   09355900
093560     END-IF.                                                      09356000
093561                                                                  09356100
093562                                                                  09356200
093563******************************************************************09356300
093564* THIS PARAGRAPH WILL BE USED TO CHECK IF THE UPC NUMBER IS ON   *09356400
093565* THE UPC MASTER TABLE.                                          *09356500
093566******************************************************************09356600
093567 3410-FIND-UPC-NBR.                                               09356700
093568                                                                  09356800
093569     EXEC SQL                                                     09356900
093570          SELECT A.UPC_NBR                                        09357000
093571               , B.SKU_NBR                                        09357100
093572               , C.DEPT_NBR                                       09357200
093573            INTO :XLT00006-UPC-NBR                                09357300
093574               , :XLT00003-SKU-NBR                                09357400
093575               , :XLT00004-DEPT-NBR                               09357500
093576            FROM XLT_UPC A                                        09357600
093577               , XLT_SKU B                                        09357700
093578               , XLT_VND_STYL C                                   09357800
093579          WHERE A.UPC_NBR     = :DK-UPC-NUMBER                    09357900
093580            AND B.INTR_UPC_ID = A.INTR_UPC_ID                     09358000
093581            AND C.STYL_ID     = B.STYL_ID                         09358100
093582          WITH UR                                                 09358200
093583     END-EXEC                                                     09358300
093584                                                                  09358400
093585     EVALUATE TRUE                                                09358500
093586         WHEN SQLCODE  = +0                                       09358600
093587             SET PS-UPC-FOUND TO TRUE                             09358700
093588             MOVE XLT00003-SKU-NBR TO RC101-SKU-NBR               09358800
093589             MOVE XLT00004-DEPT-NBR TO RC101-DEPT-NBR             09358900
093590         WHEN SQLCODE  = +100                                     09359000
093600             SET PS-UPC-NOT-FOUND TO TRUE                         09360000
093700         WHEN OTHER                                               09370000
093800             DISPLAY '3410-FIND-UPC-NBR DB2 ERROR'                09380000
093801             MOVE DK-UPC-NUMBER TO PV-DISP-NBR-15                 09380100
093802             DISPLAY 'UPC NUMBER IS:  ' PV-DISP-NBR-15            09380200
093803             DISPLAY 'INPUT RECORD IS: '                          09380300
093804             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   09380400
093805             DISPLAY '-----------------------'                    09380500
093806             MOVE '3410-FIND-UPC-NBR' TO PV-ABEND-PARAGRAPH       09380600
093807             MOVE 'VALIDATE UPC NUMBER TO GET SKU'                09380700
093808                                            TO PV-ABEND-OPERATION 09380800
093809             PERFORM 9900-DB2-ABEND                               09380900
093810     END-EVALUATE.                                                09381000
093820                                                                  09382000
093830                                                                  09383000
093840******************************************************************09384000
093850* THIS PARAGRAPH WILL BE USED TO TAKE THE KOHLS PO NUMBER        *09385000
093860* RETRIEVED EARLIER AND THE SKU NUMBER RETRIEVED EARLIER         *09386000
093870* AND FIND THE PO LINE NUMBER THAT THE SKU IS ON.                *09387000
093880******************************************************************09388000
093890 3420-FIND-PO-LINE-NBR.                                           09389000
093900                                                                  09390000
094000     EXEC SQL                                                     09400000
094100          SELECT PO_NBR                                           09410000
094200               , PO_LNE_NBR                                       09420000
094300               , RMS_PO_SKU_NBR                                   09430000
094400            INTO :PURITM-PO-NBR                                   09440000
094500               , :PURITM-PO-LNE-NBR                               09450000
094600               , :PURITM-RMS-PO-SKU-NBR                           09460000
094700            FROM TPURITM                                          09470000
094800          WHERE PO_NBR         = :DK-PO-NUMBER                    09480000
094900            AND RMS_PO_SKU_NBR = :DK-SKU-NUMBER                   09490000
095000            AND VER_STATUS_CDE = 'A'                              09500000
095100          WITH UR                                                 09510000
095200     END-EXEC                                                     09520000
095300                                                                  09530000
095400     EVALUATE TRUE                                                09540000
095500         WHEN SQLCODE  = +0                                       09550000
095600             SET PS-PO-LINE-FOUND TO TRUE                         09560000
095700             MOVE PURITM-PO-LNE-NBR TO RC101-ORD-LNE-NBR          09570000
095800         WHEN SQLCODE  = +100                                     09580000
095900             SET PS-PO-LINE-NOT-FOUND TO TRUE                     09590000
096000         WHEN OTHER                                               09600000
096100             DISPLAY '3420-FIND-PO-LINE-NBR DB2 ERROR'            09610000
096200             MOVE DK-PO-NUMBER TO PV-DISP-NBR-10                  09620000
096300             MOVE DK-SKU-NUMBER TO PV-DISP-NBR-8                  09630000
096400             DISPLAY 'KOHLS PO NBR IS: ' PV-DISP-NBR-10           09640000
096500                     '     SKU NBR IS: ' PV-DISP-NBR-8            09650000
096510             DISPLAY 'INPUT RECORD IS: '                          09651000
096520             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   09652000
096521             DISPLAY '-----------------------'                    09652100
096522             MOVE '3420-FIND-PO-LINE-NBR' TO PV-ABEND-PARAGRAPH   09652200
096523             MOVE 'GET PO LINE NBR'                               09652300
096524                                            TO PV-ABEND-OPERATION 09652400
096525             PERFORM 9900-DB2-ABEND                               09652500
096526     END-EVALUATE.                                                09652600
096527                                                                  09652700
096528                                                                  09652800
096529******************************************************************09652900
096530*  THIS PARAGRAPH WILL MANAGE THE CHECKING OF THE SSCC NUMBER    *09653000
096540*  FROM THE INPUT FILE.  BASICALLY, WE WILL BE DOING A CHECK TO  *09654000
096550*  SEE IF THAT NUMBER IS ALREADY IN USE ON THE INBOUND CARTON    *09655000
096551*  TABLES.                                                       *09655100
096552*  NOTE:                                                         *09655213
096553*       IF SSCC-PO-LINE EXISTS THIS IS AN ERROR                  *09655313
096554*       IF SSCC-PO      EXISTS THIS IS A  WARNING                *09655413
096555*       IF SSCC-DIFF PO EXISTS THIS IS A  WARNING                *09655513
096556******************************************************************09655613
096557 3500-VALIDATE-SSCC-NUMBER.                                       09655713
096558                                                                  09655813
096559     MOVE RC101-SENT-SSCC-NBR TO DK-SSCC-NUMBER.                  09655913
096560     SET PS-SSCC-NOT-FOUND TO TRUE.                               09656013
096561                                                                  09656113
096562     PERFORM 3510-FIND-SSCC-NBR.                                  09656213
096563                                                                  09656313
096564     IF  PS-SSCC-FOUND                                            09656413
096580         MOVE PV-READ-COUNT       TO PV-DISP-NBR                  09658000
096590         DISPLAY 'INPUT RECORD ' PV-DISP-NBR                      09659000
096600                 ' SSCC NUMBER ALREADY EXISTS'                    09660000
096601                 ' KEEPING RECORD BUT WILL NOT PROCESS AS SSCC'   09660100
096602         DISPLAY RC107-SHIPPED-MDSE-CSV-REC                       09660200
096603         DISPLAY '-----------------------'                        09660300
096604                                                                  09660412
096605         MOVE SHUUPC-TRN-NBR TO PV-DISP-NBR-8                     09660500
096606         MOVE SPACES TO DL2-COMMENT                               09660600
096607         IF  PV-DISP-NBR-8 = RC101-KOHLS-ORD-NBR                  09660700
096608             PERFORM 3520-CHECK-SSCC-PO-LINE                      09660812
096622             IF  PV-SSCC-PO-LINE  =  RC101-ORD-LNE-NBR            09662218
096623                 STRING 'SSCC EXISTS-INBND CRTN-FOR KOHLS PO '    09662318
096624                        'NBR:'   RC101-KOHLS-ORD-NBR              09662418
096625                        ' LINE:' RC101-ORD-LNE-NBR                09662518
096626                                           DELIMITED BY SIZE      09662618
096627                                      INTO DL2-COMMENT            09662718
096628                 ADD +1 TO PV-ERR-SSCC-SAME-PO-LNE-CNT            09662818
096629                 SET PS-WRITE-ERROR-CSV-YES  TO TRUE              09662918
096630                 SET PS-COMMENT-TYPE-ERROR   TO TRUE              09663018
096631                 SET PS-ERROR-YES            TO TRUE              09663123
096632             ELSE                                                 09663223
096633                 STRING 'SSCC ALREADY EXISTS-INBD CRTN TBL AN'    09663325
096634                        'D IS FOR THE SAME KOHLS PO NBR '         09663425
096635                                    RC101-KOHLS-ORD-NBR           09663525
096636                                           DELIMITED BY SIZE      09663623
096637                                      INTO DL2-COMMENT            09663723
096638                 ADD +1 TO PV-WRN-SSCC-SAME-PO-CNT                09663823
096639                 SET PS-WRITE-ERROR-CSV-NO  TO TRUE               09663923
096640                 SET PS-COMMENT-TYPE-WARNING TO TRUE              09664023
096641             END-IF                                               09664123
096642                                                                  09664223
096643             PERFORM 8300-INVALID-RECORD                          09664323
096644         ELSE                                                     09664423
096645             STRING 'SSCC ALREADY EXISTS-INBND CRTN-DIFF KOHLS PO'09664525
096646                    '-INPUT PO:'       RC101-KOHLS-ORD-NBR        09664625
096647                    ' CURR PO:'        PV-DISP-NBR-8              09664723
096648                                       DELIMITED BY SIZE          09664823
096649               INTO DL2-COMMENT                                   09664923
096650             SET PS-WRITE-ERROR-CSV-NO   TO TRUE                  09665023
096651             SET PS-COMMENT-TYPE-WARNING TO TRUE                  09665123
096652             ADD +1 TO PV-WRN-SSCC-DIFF-PO-CNT                    09665223
096653             PERFORM 8300-INVALID-RECORD                          09665323
096654     END-IF.                                                      09665423
096655                                                                  09665523
096656                                                                  09665623
096657******************************************************************09665723
096658*  THIS PARAGRAPH WILL CHECK TO SEE IF THE SSCC NUMBER IS FOUND  *09665823
096659*  ON THE INBOUND CARTON HEADER TABLE.                           *09665923
096660******************************************************************09666023
096661 3510-FIND-SSCC-NBR.                                              09666123
096662                                                                  09666223
096663     EXEC SQL                                                     09666323
096664          SELECT DISTINCT A.SHIPT_UNT_ID                          09666423
096665               , B.TRN_NBR                                        09666523
096666            INTO :SHPUNT-SHIPT-UNT-ID                             09666623
096667               , :SHUUPC-TRN-NBR                                  09666723
096668            FROM TSHPUNT A                                        09666823
096669               , TSHUUPC B                                        09666923
096670          WHERE A.SHIPT_UNT_ID = :DK-SSCC-NUMBER                  09667023
096671            AND B.SHIPT_UNT_ID = A.SHIPT_UNT_ID                   09667123
096672          WITH UR                                                 09667223
096673     END-EXEC                                                     09667323
096674                                                                  09667423
096675     EVALUATE TRUE                                                09667523
096676         WHEN SQLCODE  = +0                                       09667623
096677             SET PS-SSCC-FOUND TO TRUE                            09667723
096678             MOVE SHUUPC-TRN-NBR TO PV-DISP-NBR-8                 09667823
096679             IF  PV-DISP-NBR-8 = RC101-KOHLS-ORD-NBR              09667923
096680                 SET RC101-SSCC-EXISTS-SAME-PO TO TRUE            09668023
096681             ELSE                                                 09668123
096682                 SET RC101-SSCC-EXISTS-DIFF-PO TO TRUE            09668223
096683             END-IF                                               09668323
096684         WHEN SQLCODE  = +100                                     09668423
096685             SET PS-SSCC-NOT-FOUND TO TRUE                        09668523
096686             SET RC101-SSCC-NOT-EXISTS TO TRUE                    09668623
096687         WHEN OTHER                                               09668723
096688             DISPLAY '3510-FIND-SSCC-NBR DB2 ERROR'               09668823
096689             DISPLAY 'INPUT RECORD IS: '                          09668923
096690             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   09669023
096691             DISPLAY '-----------------------'                    09669123
096692             MOVE '3510-FIND-SSCC-NBR' TO PV-ABEND-PARAGRAPH      09669223
096693             MOVE 'CHECK TO SEE IF SSCC EXISTS'                   09669323
096694                                            TO PV-ABEND-OPERATION 09669423
096695             PERFORM 9900-DB2-ABEND                               09669523
096696     END-EVALUATE.                                                09669623
096697                                                                  09669723
096698                                                                  09669823
096699******************************************************************09669923
096700*  THIS PARAGRAPH WILL CHECK TO SEE IF THE SSCC NUMBER IS FOUND  *09670023
096701*  ON THE INBOUND CARTON TABLE FOR THE PO-LINE                   *09670123
096702******************************************************************09670223
096703 3520-CHECK-SSCC-PO-LINE.                                         09670323
096704                                                                  09670423
096705     MOVE  RC101-KOHLS-ORD-NBR TO SHUUPC-TRN-NBR.                 09670520
096706     MOVE  RC101-ORD-LNE-NBR   TO SHUUPC-TRN-LNE-NBR.             09670621
096707                                                                  09670718
096708     EXEC SQL                                                     09670818
096709          SELECT  TRN_LNE_NBR                                     09670918
096710            INTO :PV-SSCC-PO-LINE                                 09671018
096711            FROM TSHPUNT A                                        09671118
096712               , TSHUUPC B                                        09671218
096713          WHERE A.SHIPT_UNT_ID = :DK-SSCC-NUMBER                  09671318
096714            AND B.SHIPT_UNT_ID = A.SHIPT_UNT_ID                   09671418
096715            AND B.TRN_NBR      = :SHUUPC-TRN-NBR                  09671518
096716            AND B.TRN_LNE_NBR  = :SHUUPC-TRN-LNE-NBR              09671618
096717          WITH UR                                                 09671718
096718     END-EXEC                                                     09671818
096719                                                                  09671918
096720     EVALUATE TRUE                                                09672018
096721         WHEN SQLCODE  = +0                                       09672118
096722              CONTINUE                                            09672218
096723         WHEN SQLCODE  = +100                                     09672318
096724         WHEN SQLCODE  = -305                                     09672418
096725              MOVE  ZEROES TO  PV-SSCC-PO-LINE                    09672518
096726         WHEN OTHER                                               09672618
096727             DISPLAY '3520-CHECK-SSCC-PO-LINE ERROR'              09672718
096728             DISPLAY 'INPUT RECORD IS: '                          09672818
096729             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   09672918
096730             DISPLAY '-----------------------'                    09673018
096731             DISPLAY 'SSCC:'   RC101-SENT-SSCC-NBR                09673118
096732                     '  PO:'   RC101-KOHLS-ORD-NBR                09673218
096733                     '  LINE:' RC101-ORD-LNE-NBR                  09673318
096734             DISPLAY '-----------------------'                    09673418
096735             MOVE '3520-CHECK-SSCC-PO-LINE' TO PV-ABEND-PARAGRAPH 09673518
096736             MOVE 'CHECK TO SEE IF SSCC EXISTS'                   09673618
096737                                            TO PV-ABEND-OPERATION 09673718
096738             PERFORM 9900-DB2-ABEND                               09673818
096739     END-EVALUATE.                                                09673918
096740                                                                  09674018
096741                                                                  09674118
096742******************************************************************09674218
096743*  THIS PARAGRAPH WILL CHECK TO SEE IF THE DC NUMBER ON THE      *09674318
096744*  INPUT RECORD IS A VALID DC NUMBER.                            *09674418
096745******************************************************************09674518
096746 3600-VALIDATE-DC-NUMBER.                                         09674618
096747                                                                  09674718
096748     MOVE RC101-DC-NBR TO DK-DC-NUMBER.                           09674818
096749     SET PS-DC-NOT-FOUND TO TRUE.                                 09674918
096750                                                                  09675018
096751     PERFORM 3610-FIND-DC-NBR.                                    09675118
096752                                                                  09675218
096753     IF  PS-DC-FOUND                                              09675318
096754         IF  XLT00010-LOC-TYP-CDE = 'DC'                          09675418
096755             PERFORM 3620-CHECK-DC-MATCH-PO                       09675518
096756         ELSE                                                     09675618
096757             SET PS-ERROR-YES TO TRUE                             09675718
096758             MOVE PV-READ-COUNT       TO PV-DISP-NBR              09675818
096759             DISPLAY 'INPUT RECORD ' PV-DISP-NBR                  09675918
096760                     ' LOCATION NUMBER NOT A DC'                  09676018
096761             DISPLAY ' SKIPPING TO NEXT RECORD'                   09676118
096762             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   09676218
096763             DISPLAY '-----------------------'                    09676318
096764             MOVE XLT00010-LOC-NBR TO PV-DISP-NBR-4               09676418
096765             MOVE SPACES TO DL2-COMMENT                           09676518
096766             STRING 'LOCATION NBR:' PV-DISP-NBR-4                 09676618
096767                    ' IS NOT A DC LOCATION - TYPE CODE IS '       09676718
096768                    XLT00010-LOC-TYP-CDE     DELIMITED BY SIZE    09676818
096769               INTO DL2-COMMENT                                   09676918
096770             SET PS-WRITE-ERROR-CSV-YES TO TRUE                   09677018
096771             SET PS-COMMENT-TYPE-ERROR TO TRUE                    09677118
096772             ADD +1 TO PV-ERR-LOC-NOT-A-KDC-CNT                   09677218
096773             PERFORM 8300-INVALID-RECORD                          09677318
096774         END-IF                                                   09677418
096775     ELSE                                                         09677518
096776         SET PS-ERROR-YES TO TRUE                                 09677618
096777         MOVE PV-READ-COUNT       TO PV-DISP-NBR                  09677718
096778         DISPLAY 'INPUT RECORD ' PV-DISP-NBR                      09677818
096779                 ' DC NUMBER ENTRY NOT FOUND'                     09677918
096780         DISPLAY ' SKIPPING TO NEXT RECORD'                       09678018
096781         DISPLAY RC107-SHIPPED-MDSE-CSV-REC                       09678118
096782         DISPLAY '-----------------------'                        09678218
096783         MOVE SPACES TO DL2-COMMENT                               09678318
096784         STRING 'DC NBR ON INPUT RECORD IS NOT FOUND IN THE '     09678418
096785                'LOCATION MASTER DATABASE'                        09678518
096786                                         DELIMITED BY SIZE        09678618
096787           INTO DL2-COMMENT                                       09678718
096788         SET PS-WRITE-ERROR-CSV-YES TO TRUE                       09678818
096789         SET PS-COMMENT-TYPE-ERROR TO TRUE                        09678918
096790         ADD +1 TO PV-ERR-NOT-ON-LOCMST-CNT                       09679018
096791         PERFORM 8300-INVALID-RECORD                              09679118
096792     END-IF.                                                      09679218
096793                                                                  09679318
096794                                                                  09679418
096795******************************************************************09679518
096796*  THIS PARAGRAPH WILL DO A SELECT TO THE XLT_LOC TABLE TO SEE   *09679618
096797*  IF THE DC NUMBER IS VALID.                                    *09679718
096798******************************************************************09679818
096799 3610-FIND-DC-NBR.                                                09679918
096800                                                                  09680018
096801     EXEC SQL                                                     09680118
096802          SELECT LOC_NBR                                          09680218
096803               , LOC_TYP_CDE                                      09680318
096804               , LOC_5_ABBR_NM                                    09680418
096805               , OPN_DTE                                          09680518
096806               , CLO_DTE                                          09680618
096807            INTO :XLT00010-LOC-NBR                                09680718
096808               , :XLT00010-LOC-TYP-CDE                            09680818
096809               , :XLT00010-LOC-5-ABBR-NM                          09680918
096810               , :XLT00010-OPN-DTE                                09681018
096811               , :XLT00010-CLO-DTE                                09681118
096812            FROM XLT_LOC                                          09681218
096813          WHERE LOC_NBR = :DK-DC-NUMBER                           09681318
096814          WITH UR                                                 09681418
096815     END-EXEC                                                     09681518
096816                                                                  09681618
096817     EVALUATE TRUE                                                09681718
096818         WHEN SQLCODE  = +0                                       09681818
096819             SET PS-DC-FOUND TO TRUE                              09681918
096820             MOVE XLT00010-LOC-5-ABBR-NM (4:2) TO RC101-DC-ABBR   09682018
096821         WHEN SQLCODE  = +100                                     09682118
096822             SET PS-DC-NOT-FOUND TO TRUE                          09682218
096823             MOVE '  '                         TO RC101-DC-ABBR   09682318
096824         WHEN OTHER                                               09682418
096825             DISPLAY '3610-FIND-DC-NBR DB2 ERROR'                 09682518
096826             DISPLAY 'INPUT RECORD IS: '                          09682618
096827             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   09682718
096828             DISPLAY '-----------------------'                    09682818
096829             MOVE '3610-FIND-DC-NBR' TO PV-ABEND-PARAGRAPH        09682918
096830             MOVE 'CHECK TO SEE IF DC NBR EXISTS'                 09683018
096831                                            TO PV-ABEND-OPERATION 09683118
096832             PERFORM 9900-DB2-ABEND                               09683218
096833     END-EVALUATE.                                                09683318
096834                                                                  09683418
096835                                                                  09683518
096836******************************************************************09683618
096837*  THIS PARAGRAPH WILL DO A SELECT TO THE XLT_LOC TABLE TO MAKE  *09683718
096838*  SURE THE DC NUMBER ON THE INPUT FILE MATCHES THE DC ON THE    *09683818
096839*  PO INSTRUCTIONS                                               *09683918
096840******************************************************************09684018
096841 3620-CHECK-DC-MATCH-PO.                                          09684118
096842                                                                  09684218
096843     MOVE  ZEROES  TO  PV-LOC-NBR.                                09684318
096844                                                                  09684418
096845     EXEC SQL                                                     09684518
096846          SELECT F.LOC_NBR                                        09684618
096847               , F.LOC_5_ABBR_NM                                  09684718
096848            INTO :PV-LOC-NBR                                      09684818
096849               , :XLT00010-LOC-5-ABBR-NM                          09684918
096850            FROM TPOINST D                                        09685018
096851               , TINSTCD E                                        09685118
096852               , XLT_LOC F                                        09685218
096853          WHERE D.PO_NBR                  = :PURCHS-PO-NBR        09685318
096854            AND D.RECIP_CDE               = 'VN'                  09685418
096855            AND E.INSTR_NBR               = D.INSTR_NBR           09685518
096856            AND SUBSTR(E.INSTR_DESC,5,15) = ' '                   09685618
096857            AND INTEGER(SUBSTR(E.INSTR_DESC,1,4)) = F.LOC_NBR     09685718
096858            AND F.LOC_TYP_CDE             = 'DC'                  09685818
096859          ORDER BY 1                                              09685918
096860          WITH UR                                                 09686018
096861     END-EXEC.                                                    09686118
096862                                                                  09686218
096863     EVALUATE TRUE                                                09686318
096864         WHEN SQLCODE  = +0                                       09686418
096865              IF  PV-LOC-NBR  =  DK-DC-NUMBER                     09686518
096866                  SET PS-DC-MATCH TO TRUE                         09686618
096867              ELSE                                                09686718
096868                  MOVE DK-DC-NUMBER        TO PV-DISP-OPER-IN-REC 09686818
096869                  MOVE PV-LOC-NBR          TO PV-DISP-OPER-ON-PO  09686918
096870                  MOVE PV-READ-COUNT       TO PV-DISP-NBR         09687018
096871                  DISPLAY 'INPUT RECORD ' PV-DISP-NBR             09687118
096872                          ' DC ON RECORD ' PV-DISP-OPER-IN-REC    09687218
096873                          ' DC ON PO INSTRUCTIONS '               09687318
096874                                           PV-DISP-OPER-ON-PO     09687418
096875                  DISPLAY ' UPDATED DC NUMBER ON THE RECORD'      09687518
096876                  DISPLAY RC107-SHIPPED-MDSE-CSV-REC              09687618
096877                  DISPLAY '-----------------------'               09687718
096878                  MOVE SPACES TO DL2-COMMENT                      09687818
096879                  STRING 'DC ON RECORD ' PV-DISP-OPER-IN-REC      09687918
096880                         ' DOES NOT MATCH THE DC ON PO '          09688018
096881                                           PV-DISP-OPER-ON-PO     09688118
096882                         ' RECORD UPDATED'       DELIMITED BY SIZE09688218
096883                    INTO DL2-COMMENT                              09688318
096884                  SET PS-WRITE-ERROR-CSV-NO  TO TRUE              09688418
096885                  SET PS-COMMENT-TYPE-INFO   TO TRUE              09688518
096886                  ADD +1 TO PV-INFO-DIFF-DC-CNT                   09688618
096887                  PERFORM 8300-INVALID-RECORD                     09688718
096888                  SET PS-DC-MATCH-NO TO TRUE                      09688818
096889                  MOVE  PV-LOC-NBR  TO  DK-DC-NUMBER              09688918
096890                                        RC101-DC-NBR              09689018
096891                  MOVE XLT00010-LOC-5-ABBR-NM (4:2) TO            09689118
096892                       RC101-DC-ABBR                              09689218
096893              END-IF                                              09689318
096894                                                                  09689418
096895         WHEN SQLCODE  = +100                                     09689518
096896         WHEN SQLCODE  = -305                                     09689618
096897              MOVE DK-DC-NUMBER        TO PV-DISP-OPER-IN-REC     09689718
096898              MOVE PV-LOC-NBR          TO PV-DISP-OPER-ON-PO      09689818
096899              MOVE PV-READ-COUNT       TO PV-DISP-NBR             09689918
096900              DISPLAY 'INPUT RECORD ' PV-DISP-NBR                 09690018
096901                      ' DC NOT FOUND ON SPECIAL INSTRUCTIONS'     09690118
096902              DISPLAY RC107-SHIPPED-MDSE-CSV-REC                  09690218
096903              DISPLAY '-----------------------'                   09690318
096904              MOVE SPACES TO DL2-COMMENT                          09690418
096905              STRING 'DC NOT FOUND ON SPECIAL INSTRUCTIONS'       09690518
096906                     ' - NO UPDATES MADE'                         09690618
096907                                             DELIMITED BY SIZE    09690718
096908                INTO DL2-COMMENT                                  09690818
096909              SET PS-WRITE-ERROR-CSV-NO  TO TRUE                  09690918
096910              SET PS-COMMENT-TYPE-INFO   TO TRUE                  09691018
096911              ADD +1 TO PV-INFO-NO-DC-INSTR-CNT                   09691118
096912              PERFORM 8300-INVALID-RECORD                         09691218
096913              SET PS-DC-MATCH-NO TO TRUE                          09691318
096914                                                                  09691418
096915         WHEN SQLCODE  = -811                                     09691518
096916              MOVE DK-DC-NUMBER        TO PV-DISP-OPER-IN-REC     09691618
096917              MOVE PV-LOC-NBR          TO PV-DISP-OPER-ON-PO      09691718
096918              MOVE PV-READ-COUNT       TO PV-DISP-NBR             09691818
096919              DISPLAY 'INPUT RECORD ' PV-DISP-NBR                 09691918
096920                      ' MULTIPLE DC SPECIAL INSTRUCTIONS'         09692018
096921              DISPLAY RC107-SHIPPED-MDSE-CSV-REC                  09692118
096922              DISPLAY '-----------------------'                   09692218
096923              MOVE SPACES TO DL2-COMMENT                          09692318
096924              STRING 'MULTIPLE DC SPECIAL INSTRUCTIONS'           09692418
096925                     ' - NO UPDATES MADE'                         09692518
096926                                             DELIMITED BY SIZE    09692618
096927                INTO DL2-COMMENT                                  09692718
096928              SET PS-WRITE-ERROR-CSV-NO  TO TRUE                  09692818
096929              SET PS-COMMENT-TYPE-INFO   TO TRUE                  09692918
096930              ADD +1 TO PV-INFO-MULT-DC-INSTR-CNT                 09693018
096931              PERFORM 8300-INVALID-RECORD                         09693118
096932              SET PS-DC-MATCH-NO TO TRUE                          09693218
096933                                                                  09693318
096934         WHEN OTHER                                               09693418
096935             DISPLAY '3620-CHECK-DC-MATCH-PO ERROR'               09693518
096936             DISPLAY 'INPUT RECORD IS: '                          09693618
096937             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   09693718
096938             DISPLAY '-----------------------'                    09693818
096939             MOVE '3620-CHECK-DC-MATCH-PO'                        09693918
096940                                     TO PV-ABEND-PARAGRAPH        09694018
096941             MOVE 'CHECK OPER ON RECORD MATCHES PO INSTUCTION'    09694118
096942                                            TO PV-ABEND-OPERATION 09694218
096943             PERFORM 9900-DB2-ABEND                               09694318
096944     END-EVALUATE.                                                09694418
096945                                                                  09694518
096946                                                                  09694618
096947******************************************************************09694718
096948*  THIS PARAGRAPH WILL TAKE THE MERCHANDISE SOURCE CODE FROM THE *09694818
096949*  INPUT RECORD AND CHECK AGAINST THE WST INTEGRATION TABLE TO   *09694918
096950*  SEE IF THE SOURCE AND KOHLS DC NUMBER CAN BE FOUND TO GET THE *09695018
096951*  DEFAULT SCAC CODE TO WRITE TO THE OUTPUT RECORD.              *09695118
096952*  IF WE GET A +100 FROM THIS SELECT, THIS IS NOT CONSIDERED AN  *09695218
096953*  ERROR, WE JUST WOULD NOT BE ABLE TO POPULATE THE VENDOR       *09695318
096954*  SOURCE DC AND RELATED SCAC CODE WHICH MEANS FURTHER IN THE    *09695418
096955*  RCK010 PROCESS, THE TRANSPORTATION TABLES WOULD NOT BE        *09695518
096956*  POPULATED WITH DATA.                                          *09695618
096957******************************************************************09695718
096958 3700-VALIDATE-MDSE-SOURCE.                                       09695818
096959                                                                  09695918
096960     MOVE RC101-DC-NBR TO DK-DC-NUMBER.                           09696018
096961     MOVE PV-MDSE-SOURCE TO DK-MDSE-SOURCE.                       09696118
096962                                                                  09696218
096963     EXEC SQL                                                     09696318
096964          SELECT E.ATTR_ELEM_TXT                                  09696418
096965            INTO :PV-DELIVERY-SCAC                                09696518
096966            FROM WST_INTGRTN_TYP A                                09696618
096967               , WST_ATTR_DEFN B                                  09696718
096968               , WST_ATTR_ELEM C  -- SEPHORA DC ABBREVIATION      09696818
096969               , WST_ATTR_ELEM D  -- KOHLS DC NUMBER              09696918
096970               , WST_ATTR_ELEM E  -- DEFAULT SCAC                 09697018
096971               , WST_ATTR_ELEM F  -- AC/IN    ACTIVE/INACTIVE     09697118
096972               , WST_ATTR_ELEM G  -- BEGIN TMST                   09697218
096973               , WST_ATTR_ELEM H  -- END TMST                     09697318
096974           WHERE A.INTGRTN_TYP_CDE   = 'SEPHXFRSRC'               09697418
096975             AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE          09697518
096976             AND B.ATTR_DEFN_SEQ_NBR = 1                          09697618
096977             AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE          09697718
096978             AND C.ATTR_DEFN_SEQ_NBR = 1                          09697818
096979             AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE          09697918
096980             AND D.ATTR_DEFN_SEQ_NBR = 2                          09698018
096981             AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE          09698118
096982             AND E.ATTR_DEFN_SEQ_NBR = 3                          09698218
096983             AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE          09698318
096984             AND F.ATTR_DEFN_SEQ_NBR = 4                          09698418
096985             AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE          09698518
096986             AND G.ATTR_DEFN_SEQ_NBR = 5                          09698618
096987             AND B.INTGRTN_TYP_CDE   = H.INTGRTN_TYP_CDE          09698718
096988             AND H.ATTR_DEFN_SEQ_NBR = 6                          09698818
096989             AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR        09698918
096990             AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR        09699018
096991             AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR        09699118
096992             AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR        09699218
096993             AND C.ATTR_ELEM_SEQ_NBR = H.ATTR_ELEM_SEQ_NBR        09699318
096994             AND C.ATTR_ELEM_TXT     = :DK-MDSE-SOURCE            09699418
096995             AND D.ATTR_ELEM_NBR     = :DK-DC-NUMBER              09699518
096996             AND F.ATTR_ELEM_TXT     = 'AC'                       09699618
096997             AND G.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP          09699718
096998             AND H.ATTR_ELEM_TMST   >= CURRENT TIMESTAMP          09699818
096999            WITH UR                                               09699918
097000     END-EXEC.                                                    09700018
097001                                                                  09700118
097002     EVALUATE TRUE                                                09700218
097003         WHEN SQLCODE  = +0                                       09700318
097004             MOVE PV-DELIVERY-SCAC TO RC101-DELIVERY-SCAC         09700418
097005         WHEN SQLCODE  = +100                                     09700518
097006             MOVE SPACES TO RC101-DELIVERY-SCAC                   09700618
097007             MOVE PV-READ-COUNT       TO PV-DISP-NBR              09700718
097008             DISPLAY 'INPUT RECORD ' PV-DISP-NBR                  09700818
097009                     ' MDSE SOURCE-KOHLS DC COMBO NOT FOUND'      09700918
097010             DISPLAY ' PROCESSING RECORD BUT WITH SPACES IN SCAC' 09701018
097011             DISPLAY ' PV-MDSE-SOURCE IS: ' PV-MDSE-SOURCE        09701118
097012                     '   DK-DC-NUMBER IS: ' RC101-DC-NBR          09701218
097013             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   09701318
097014             DISPLAY '-----------------------'                    09701418
097015             ADD +1 TO PV-DSP-NO-SRCE-KDC-CNT                     09701518
097016                                                                  09701618
097017              MOVE SPACES TO DL2-COMMENT                          09701718
097018              STRING 'MERCHANDISE SOURCE/DC NOT FOUND: '          09701818
097019                      PV-MDSE-SOURCE '/'                          09701918
097020                      RC101-DC-NBR                                09702018
097021                     ' NO DELIVERY SCAC DETERMINED'               09702118
097022                                            DELIMITED BY SIZE     09702218
097023                INTO DL2-COMMENT                                  09702318
097024              SET PS-WRITE-ERROR-CSV-NO   TO TRUE                 09702418
097025              SET PS-COMMENT-TYPE-WARNING TO TRUE                 09702518
097026              PERFORM 8300-INVALID-RECORD                         09702618
097027                                                                  09702718
097028         WHEN OTHER                                               09702818
097029             DISPLAY '3700-VALIDATE-MDSE-SOURCE'                  09702918
097030             DISPLAY 'INPUT RECORD IS: '                          09703018
097031             DISPLAY RC107-SHIPPED-MDSE-CSV-REC                   09703118
097032             DISPLAY '-----------------------'                    09703218
097033             MOVE '3700-VALIDATE-MDSE-SOURCE' TO                  09703318
097034                  PV-ABEND-PARAGRAPH                              09703418
097035             MOVE 'CHECK TO SEE IF MDSE SOURCE EXISTS'            09703518
097036                                            TO PV-ABEND-OPERATION 09703618
097037             PERFORM 9900-DB2-ABEND                               09703718
097038     END-EVALUATE.                                                09703818
097039                                                                  09703918
097040                                                                  09704018
097041******************************************************************09704118
097042* THIS PARAGRAPH WILL CHECK TO SEE IF THE UNIT QUANTITY IS       *09704218
097043* GREATER THAN A VALUE OF ZERO.  IF THE QUANTITY IS EQUAL TO     *09704318
097044* ZERO, THEN THE RECORD WILL BE BYPASSED AND WRITTEN TO THE      *09704418
097045* ERROR FILE AND LINE WILL BE WRITTEN TO THE ERROR REPORT.       *09704518
097046******************************************************************09704618
097047 3800-VALIDATE-UNIT-QUANTITY.                                     09704718
097048                                                                  09704818
097049     IF  RC101-SHIP-QTY = 0                                       09704918
097050         SET PS-ERROR-YES TO TRUE                                 09705018
097051         MOVE PV-READ-COUNT       TO PV-DISP-NBR                  09705118
097052         DISPLAY 'INPUT RECORD ' PV-DISP-NBR                      09705218
097053                 ' SHIP QUANTITY IS EQUAL TO ZERO'                09705318
097054         DISPLAY ' SKIPPING TO NEXT RECORD'                       09705418
097055         DISPLAY RC107-SHIPPED-MDSE-CSV-REC                       09705518
097056         DISPLAY '-----------------------'                        09705618
097057         MOVE SPACES TO DL2-COMMENT                               09705718
097058         STRING 'THE UNIT QUANTITY FIELD ON THE INPUT RECORD '    09705818
097059                'IS A VALUE OF ZERO'    DELIMITED BY SIZE         09705918
097060           INTO DL2-COMMENT                                       09706018
097061         SET PS-WRITE-ERROR-CSV-YES TO TRUE                       09706118
097062         SET PS-COMMENT-TYPE-ERROR TO TRUE                        09706218
097063         ADD +1 TO PV-ERR-QTY-EQ-ZERO-CNT                         09706318
097064         PERFORM 8300-INVALID-RECORD                              09706418
097065     END-IF.                                                      09706518
097066                                                                  09706618
097067                                                                  09706718
097068******************************************************************09706818
097069*  READ A SHIPPED MERCHANDISE COMMA DELIMITED INPUT RECORD       *09706918
097070******************************************************************09707018
097071 7000-READ-INPUT.                                                 09707118
097072                                                                  09707218
097073     READ SHIPPED-MDSE-CSV-FILE                                   09707318
097074       INTO RC107-SHIPPED-MDSE-CSV-REC                            09707418
097075         AT END                                                   09707518
097076           SET END-OF-FILE TO TRUE                                09707618
097077         NOT AT END                                               09707718
097078           ADD 1                      TO PV-READ-COUNT            09707818
097079                                         PV-PROGRESSIVE-READ-COUNT09707918
097080           IF  RC107-DETAIL-RECORD                                09708018
097081               ADD 1 TO PV-READ-DETL-COUNT                        09708118
097082           ELSE                                                   09708218
097090               ADD 1 TO PV-READ-OTHR-COUNT                        09709005
097100           END-IF                                                 09710000
097200           IF  PV-PROGRESSIVE-READ-COUNT =                        09720000
097300               PC-PROGRESSIVE-READ-LIMIT                          09730000
097400               MOVE PV-READ-COUNT TO PV-DISP-NBR                  09740000
097500               DISPLAY 'PROGRESSIVE READ COUNT IS: '              09750000
097600                       PV-DISP-NBR                                09760000
097700               MOVE ZEROS TO PV-PROGRESSIVE-READ-COUNT            09770000
097800           END-IF                                                 09780000
097900     END-READ.                                                    09790000
098000                                                                  09800000
098100                                                                  09810000
098200******************************************************************09820000
098300*  PRINT ALL REPORT HEADING LINES.                               *09830000
098400******************************************************************09840000
098500 8000-PRINT-HEADINGS.                                             09850000
098600                                                                  09860000
098700     ADD 1                       TO PV-PAGE-CNT.                  09870000
098800                                                                  09880000
098900     MOVE PV-PAGE-CNT            TO DP200O-PAGE-NUMBER.           09890000
099000     MOVE PC-REPORT-NBR-1        TO DP200O-REPORT-NUMBER.         09900000
099100     MOVE DP200O-STANDRD-HEADER-200-COLS                          09910000
099200                                 TO PV-PRINT-RECORD.              09920000
099300     PERFORM 8100-WRITE-RPT-TOP-OF-PAGE.                          09930000
099400                                                                  09940000
099500     MOVE HL1-HEADING-LINE-1     TO PV-PRINT-RECORD.              09950000
099600     MOVE +1                     TO PV-LINE-SPACING.              09960000
099700     PERFORM 8200-WRITE-ERROR-RPT-LINE.                           09970000
099800                                                                  09980000
099900     MOVE HL2-HEADING-LINE-2     TO PV-PRINT-RECORD.              09990000
100000     MOVE +1                     TO PV-LINE-SPACING.              10000000
100100     PERFORM 8200-WRITE-ERROR-RPT-LINE.                           10010000
100200                                                                  10020000
100300     MOVE HL3-HEADING-LINE-3     TO PV-PRINT-RECORD.              10030000
100400     MOVE +2                     TO PV-LINE-SPACING.              10040000
100500     PERFORM 8200-WRITE-ERROR-RPT-LINE.                           10050000
100600                                                                  10060000
100700     MOVE HL4-HEADING-LINE-4     TO PV-PRINT-RECORD.              10070000
100800     MOVE +1                     TO PV-LINE-SPACING.              10080000
100900     PERFORM 8200-WRITE-ERROR-RPT-LINE.                           10090000
100910                                                                  10091000
100920                                                                  10092000
100930******************************************************************10093000
100940*  THIS PARAGRAPH WILL PRINT THE 'END OF REPORT' LINE.           *10094000
100950******************************************************************10095000
100960 8050-PRINT-END-OF-RPT-LINE.                                      10096000
100970                                                                  10097000
100980     IF  PV-LINE-CNT > PC-LINE-LIMIT                              10098000
100990         PERFORM 8000-PRINT-HEADINGS                              10099000
101000     END-IF.                                                      10100000
101100                                                                  10110000
101200     IF  PV-READ-COUNT = 0                                        10120000
101300         MOVE EMPTY-FILE-LINE  TO PV-PRINT-RECORD                 10130000
101400         MOVE +2               TO PV-LINE-SPACING                 10140000
101500         PERFORM 8200-WRITE-ERROR-RPT-LINE                        10150000
101600     ELSE                                                         10160000
101700         IF  PS-REPORT-WRITE-NO                                   10170000
101800             MOVE NO-ERROR-LINE    TO PV-PRINT-RECORD             10180000
101900             MOVE +2               TO PV-LINE-SPACING             10190000
102000             PERFORM 8200-WRITE-ERROR-RPT-LINE                    10200000
102100         END-IF                                                   10210000
102200     END-IF.                                                      10220000
102300                                                                  10230000
102400     MOVE END-OF-REPORT-LINE   TO PV-PRINT-RECORD.                10240000
102500     MOVE +2                   TO PV-LINE-SPACING.                10250000
102600     PERFORM 8200-WRITE-ERROR-RPT-LINE.                           10260000
102700                                                                  10270000
102800                                                                  10280000
102900******************************************************************10290000
103000*  WRITE FIRST REPORT LINE AFTER PAGE BREAK.                     *10300000
103100******************************************************************10310000
103200 8100-WRITE-RPT-TOP-OF-PAGE.                                      10320000
103300                                                                  10330000
103400     WRITE ERROR-REPORT-RECORD                                    10340000
103500       FROM PV-PRINT-RECORD                                       10350000
103600         AFTER ADVANCING PAGE.                                    10360000
103700     MOVE +1             TO PV-LINE-CNT.                          10370000
103800                                                                  10380000
103900                                                                  10390000
104000******************************************************************10400000
104100*  WRITE ERROR REPORT LINE AFTER ADVANCING LINE SPACING.         *10410000
104200******************************************************************10420000
104300 8200-WRITE-ERROR-RPT-LINE.                                       10430000
104400                                                                  10440000
104500     WRITE ERROR-REPORT-RECORD                                    10450000
104600       FROM PV-PRINT-RECORD                                       10460000
104700         AFTER ADVANCING PV-LINE-SPACING.                         10470000
104800     ADD PV-LINE-SPACING TO PV-LINE-CNT.                          10480000
104900                                                                  10490000
105000                                                                  10500000
105100******************************************************************10510000
105200*  THIS PARAGRAPH WILL BE USED TO WRITE THE INPUT RECORD TO THE  *10520000
105300*  ERROR FILE.  THIS WILL ALSO CONTROL THE WRITING OF DATA FOR   *10530000
105400*  THE ERROR FOUND TO THE REPORT.                                *10540000
105500******************************************************************10550000
105600 8300-INVALID-RECORD.                                             10560000
105700                                                                  10570000
105800     SET PS-REPORT-WRITE-YES TO TRUE.                             10580000
105900                                                                  10590000
106000     IF  PS-WRITE-ERROR-CSV-YES                                   10600000
106100         WRITE CSV-ERROR-RECORD                                   10610000
106200          FROM RC107-SHIPPED-MDSE-CSV-REC                         10620000
106300         ADD +1 TO PV-ERROR-WRITE-COUNT                           10630000
106400     END-IF.                                                      10640000
106500                                                                  10650000
106600     IF  PV-LINE-CNT > PC-LINE-LIMIT                              10660000
106700         PERFORM 8000-PRINT-HEADINGS                              10670000
106800     END-IF.                                                      10680000
106900                                                                  10690000
107000     MOVE PV-FILE-NAME             TO  DL1-FILE-NAME.             10700000
107100     MOVE PV-RECORD-TYPE           TO  DL1-RECORD-TYPE.           10710000
107200     MOVE PV-ORD-NBR               TO  DL1-ORD-NBR.               10720000
107300     MOVE PURCHS-PO-NBR            TO  DL1-KOHLS-PO.              10730000
107400     MOVE PV-MDSE-SOURCE           TO  DL1-MDSE-SOURCE.           10740000
107500     MOVE PV-DC-NBR                TO  DL1-DC-NBR.                10750000
107600     MOVE PV-LOC-NBR               TO  DL1-ACTUAL-DC.             10760011
107700     MOVE PV-SSCC-NBR              TO  DL1-SSCC-NBR.              10770000
107800     MOVE PV-UPC-NBR               TO  DL1-UPC-NBR.               10780000
107801     MOVE PV-SHIP-QTY              TO  DL1-SHIP-QTY.              10780100
107802                                                                  10780200
107803     IF  PS-COMMENT-TYPE-WARNING                                  10780300
107804         STRING 'WARNING: ' DL2-COMMENT                           10780400
107805                                       DELIMITED BY SIZE          10780500
107806                                 INTO  DL1-ERROR-DESC             10780600
107807         MOVE 'WARNING: '          TO DL2-COMMENT-TYPE            10780700
107808     ELSE                                                         10780800
107809     IF  PS-COMMENT-TYPE-INFO                                     10780900
107810         STRING 'INFO: ' DL2-COMMENT                              10781000
107811                                       DELIMITED BY SIZE          10781100
107812                                 INTO  DL1-ERROR-DESC             10781200
107813         MOVE 'INFO: '          TO DL2-COMMENT-TYPE               10781300
107814     ELSE                                                         10781400
107815         STRING 'ERROR: '   DL2-COMMENT                           10781500
107816                                       DELIMITED BY SIZE          10781600
107817                                 INTO  DL1-ERROR-DESC             10781700
107818         MOVE 'ERROR:   '          TO DL2-COMMENT-TYPE            10781800
107819     END-IF                                                       10781900
107820     END-IF.                                                      10782000
107821                                                                  10782100
107822* DISPLAY THE ERROR REASON IN SYSOUT                              10782200
107823*    DISPLAY DL2-DETAIL-COMMENT-LINE.                             10782300
107824* DISPLAY THE INPUT RECORD IN SYSOUT                              10782400
107825*    DISPLAY RC107-SHIPPED-MDSE-CSV-REC.                          10782500
107826                                                                  10782600
107827     MOVE +1                     TO PV-LINE-SPACING.              10782708
107828                                                                  10782800
107829     WRITE ERROR-REPORT-RECORD                                    10782900
107830       FROM DL1-DETAIL-LINE-1                                     10783000
107840         AFTER ADVANCING PV-LINE-SPACING.                         10784000
107850                                                                  10785000
107860     ADD PV-LINE-SPACING TO PV-LINE-CNT.                          10786000
107870                                                                  10787000
107880     DISPLAY ' '.                                                 10788000
107890                                                                  10789000
107900                                                                  10790000
108000******************************************************************10800000
108100*  SHOW RECORD COUNTS AND AMOUNTS IN SYSOUT                       10810000
108200******************************************************************10820000
108300 8500-SHOW-COUNTERS.                                              10830000
108400     DISPLAY ' *********  RCKUT170 STATISTICS *********'          10840000
108500     MOVE PV-READ-COUNT           TO PV-DISP-NBR-C.               10850000
108600     DISPLAY 'RECORDS READ             = ' PV-DISP-NBR-C.         10860000
108700     MOVE PV-READ-DETL-COUNT      TO PV-DISP-NBR-C.               10870000
108800     DISPLAY 'DETAIL RECORDS READ      = ' PV-DISP-NBR-C.         10880000
108900     MOVE PV-READ-TRLR-COUNT      TO PV-DISP-NBR-C.               10890000
109000     DISPLAY 'TOTAL RECORDS READ       = ' PV-DISP-NBR-C.         10900000
109100     MOVE PV-READ-OTHR-COUNT      TO PV-DISP-NBR-C.               10910000
109200     DISPLAY 'OTHER RECORDS READ       = ' PV-DISP-NBR-C.         10920000
109300     MOVE PV-GOOD-WRITE-COUNT     TO PV-DISP-NBR-C.               10930000
109400     DISPLAY 'VALID DETAIL WRITE CNT   = ' PV-DISP-NBR-C.         10940000
109500     MOVE PV-ERROR-WRITE-COUNT    TO PV-DISP-NBR-C.               10950000
109600     DISPLAY 'CSV ERROR FILE WRITE CNT = ' PV-DISP-NBR-C.         10960000
109700     DISPLAY ' '.                                                 10970000
109800     MOVE PV-PO-SELECT-QTY        TO PV-DISP-NBR-C.               10980000
109900     DISPLAY 'PO SELECTS DONE          = ' PV-DISP-NBR-C.         10990000
110000     MOVE PV-PO-MULT-SELECT-QTY   TO PV-DISP-NBR-C.               11000000
110100     DISPLAY 'PO MULT SELECTS DONE     = ' PV-DISP-NBR-C.         11010000
110200     DISPLAY ' '.                                                 11020000
110300     DISPLAY ' **ERROR COUNTS**'                                  11030000
110400     MOVE PV-ERR-INVALID-COMMA-CNT TO PV-DISP-NBR-C.              11040000
110500     DISPLAY 'RECORDS WITH INVALID COMMA COUNT  = ' PV-DISP-NBR-C.11050000
110600     MOVE PV-ERR-BAD-REC-TYPE-CNT  TO PV-DISP-NBR-C.              11060000
110700     DISPLAY 'RECORDS WITH BAD RECORD TYPE      = ' PV-DISP-NBR-C.11070000
110800     MOVE PV-ERR-NON-NUMERIC-CNT   TO PV-DISP-NBR-C.              11080000
110900     DISPLAY 'RECORDS WITH NON NUMERIC DATA     = ' PV-DISP-NBR-C.11090000
111000     MOVE PV-ERR-PO-NOT-FOUND-CNT  TO PV-DISP-NBR-C.              11100000
111100     DISPLAY 'RECORDS WITH PO NOT FOUND         = ' PV-DISP-NBR-C.11110000
111200     MOVE PV-ERR-NO-POSKU-MULT-CNT TO PV-DISP-NBR-C.              11120000
111300     DISPLAY 'RECORDS WITH MULT PO BUT NO SKU   = ' PV-DISP-NBR-C.11130000
111400     MOVE PV-ERR-UPC-NOT-FOUND-CNT TO PV-DISP-NBR-C.              11140000
111500     DISPLAY 'RECORDS WITH UPC NOT FOUND        = ' PV-DISP-NBR-C.11150000
111600     MOVE PV-ERR-SKU-NOT-ON-PO-CNT TO PV-DISP-NBR-C.              11160000
111700     DISPLAY 'RECORDS WITH UPC NOT FOUND ON PO  = ' PV-DISP-NBR-C.11170000
111800     MOVE PV-ERR-LOC-NOT-A-KDC-CNT TO PV-DISP-NBR-C.              11180000
111900     DISPLAY 'RECORDS WITH KOHLS LOC NOT A DC   = ' PV-DISP-NBR-C.11190000
112000     MOVE PV-ERR-NOT-ON-LOCMST-CNT TO PV-DISP-NBR-C.              11200000
112100     DISPLAY 'RECORDS WITH KOHLS LOC NOT FOUND  = ' PV-DISP-NBR-C.11210000
112200     MOVE PV-ERR-QTY-EQ-ZERO-CNT   TO PV-DISP-NBR-C.              11220000
112300     DISPLAY 'RECORDS WITH SHIP QTY EQUAL TO 0  = ' PV-DISP-NBR-C.11230000
112350     MOVE PV-ERR-SSCC-SAME-PO-LNE-CNT TO PV-DISP-NBR-C.           11235015
112360     DISPLAY 'SSCC-PO-LINE EXISTS               = ' PV-DISP-NBR-C.11236013
112400     DISPLAY ' '.                                                 11240000
112500     DISPLAY ' **WARNING COUNTS**'                                11250000
112600     MOVE PV-WRN-SSCC-SAME-PO-CNT  TO PV-DISP-NBR-C.              11260013
112700     DISPLAY 'SSCC EXISTS WITH SAME PO          = ' PV-DISP-NBR-C.11270013
112800     MOVE PV-WRN-SSCC-DIFF-PO-CNT  TO PV-DISP-NBR-C.              11280013
112900     DISPLAY 'SSCC EXISTS BUT DIFFERENT PO      = ' PV-DISP-NBR-C.11290013
113000     DISPLAY ' '.                                                 11300000
113100     DISPLAY ' **INFORMATION COUNTS**'                            11310000
113200     MOVE PV-INFO-DIFF-DC-CNT      TO PV-DISP-NBR-C.              11320000
113300     DISPLAY 'RECORDS WITH DIFFERENT DC NBR     = ' PV-DISP-NBR-C.11330000
113301     MOVE PV-INFO-NO-DC-INSTR-CNT  TO PV-DISP-NBR-C.              11330100
113302     DISPLAY 'NO DC ON SPECIAL INSTRUCTIONS     = ' PV-DISP-NBR-C.11330200
113303     MOVE PV-INFO-MULT-DC-INSTR-CNT TO PV-DISP-NBR-C.             11330302
113304     DISPLAY 'MULTIPLE DC ON SPECIAL INSTRUCTION= ' PV-DISP-NBR-C.11330400
113400     DISPLAY ' '.                                                 11340000
113500     DISPLAY ' **DISPLAY COUNTS**'                                11350000
113600     MOVE PV-DSP-NO-SRCE-KDC-CNT   TO PV-DISP-NBR-C.              11360000
113700     DISPLAY 'WST PARM SOURCE/KOHL DC NOT FOUND = ' PV-DISP-NBR-C.11370000
113800     MOVE PV-DSP-MULT-PO-FOUND-CNT TO PV-DISP-NBR-C.              11380000
113900     DISPLAY 'MULT KOHLS PO FOUND FOR VEND PO   = ' PV-DISP-NBR-C.11390000
114000******************************************************************11400000
114100*  DB2 ABEND ROUTINE                                             *11410000
114200******************************************************************11420000
114300 9900-DB2-ABEND.                                                  11430000
114400*    DISPLAY '9900-DB2-ABEND'.                                    11440000
114500                                                                  11450000
114600     MOVE SQLCODE TO PV-SQLCODE.                                  11460000
114700     DISPLAY '*** DB2 ERROR '.                                    11470000
114800     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       11480000
114900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 11490000
115000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               11500000
115100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               11510000
115200     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       11520000
115300     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             11530000
115400                                                                  11540000
115500     IF PV-ABEND-STRUCTURE-2 > SPACES                             11550000
115600         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2          11560000
115700     END-IF.                                                      11570000
115800                                                                  11580000
115900     COPY DPPD004.                                                11590000
116000                                                                  11600000
116100     MOVE +4013                  TO PV-ABEND-CODE.                11610000
116200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         11620000
116300*                                                                 11630000
116400* ************************ END OF RCKUT170 ********************** 11640000
