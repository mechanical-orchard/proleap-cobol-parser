000100 IDENTIFICATION DIVISION.                                         00010089
000200 PROGRAM-ID.     APKUT022.                                        00020089
000300 AUTHOR.         M WILKINSON.                                     00030089
000400*DATE-WRITTEN.   APRIL 19, 1996.                                  00040089
000500*DATE-COMPILED.                                                   00050089
000600******************************************************************00060089
000700*    COBOL 2  WITH SQL                                           *00070089
000800*                                                                *00080089
000900*    DETERMINE DUE DATE FOR EXACT MATCHES                        *00090089
001000*                                                                *00100089
001100******************************************************************00110089
001200*                                                                *00120089
001300*    TAPCNTL - ACCOUNTS PAYABLE CONTROL TABLE                    *00130089
001310*    TAPVNDS - ACCOUNTS PAYABLE VENDOR SPECIFICATIONS TABLE      *00131089
001320*                                                                *00132089
001330* INPUT:                                                         *00133089
001340* 1.  SELECTED INVOICES FOR BATCH MATCH                          *00134089
001350* 2.  SELECTED RECEIVING FOR BATCH MATCH                         *00135089
001360*                                                                *00136089
001370* OUTPUT                                                         *00137089
001380* 1.  UPDATED INVOICES WITH DUE DATES                            *00138089
001390* 2.  UNUSED INVOICES                                            *00139089
001400* 3.  UNUSED RECEIVING                                           *00140089
001500*                                                                *00150089
001600******************************************************************00160089
001700* CHANGE LOG:                                                    *00170089
001800*                                                                *00180089
001900* 04/19/94    INITIAL VERSION.                                   *00190089
002000* 09/11/96    DUE DATE - CONTROL DAYS BY VENDOR  WR#4074         *00200089
002100*             - WS ADD FIELD PAYT-FLOAT-DAY-QTY                  *00210089
002200*                  FLAG TO INDICATE IF VENDOR CONTROLS ARE       *00220089
002300*                       USED.                                    *00230089
002400*                  ADD DB2 TABLE TAPVNDS                         *00240089
002500*                                                                *00250089
002600* 01/16/98    RECOMPILED DUE TO ADDITIONAL FIELD IN              *00260089
002700*             COPYBOOK APRD060.                                  *00270089
002800*             BY:  MARK BURNSIDE                 WR# 4164        *00280089
002900*                                                                *00290089
003000* 06/11/98                                                       *00300089
003100*             Y2K. EXPAND JULIAN DATES TO INCLUDE CENTURY.       *00310089
003200*             REDEFINE JULIAN DATES INTO CC YY DDD. CHANGE       *00320089
003300*             WINDOWING YEAR TO 80.                              *00330089
003400*   MADE BY:  CAROLYN GIFFORD                    WR# 6041        *00340089
003500*                                                                *00350089
003600* 08/24/99                                                       *00360089
003700*             Y2K. REMOVED ALL JULIAN DATES.  APPD051            *00370089
003800*             CHANGED TO INCLUDE CENTURY.                        *00380089
003900*   MADE BY:  L SCHALLHORN                       WR# 6041        *00390089
004000*                                                                *00400089
004100* 12/08/1999 JILL JUEL                   WR/IR #: WR6041         *00410089
004200*            - MODIFIED THE CHECK ON THE DATE ROUTINE TO         *00420089
004300*              CONFORM WITH Y2K STANDARDS BY ADDING              *00430089
004400*              DPG54-WARNING-ERROR.                              *00440089
004500*                                                                *00450089
004600* DATE  07/03/2003                                               *00460089
004700* CHANGE MADE: ADDED LOGIC IN D100-FINISH-DATE-PROCESS TO MOVE   *00470089
004800*   THE CALCULATED DUE DATE TO PV-DATE SO IT CAN BE USED TO      *00480089
004900*   CALCULATE THE CUTOFF DATE.  CURRENTLY THE CUTOFF DATE IS NOT *00490089
005000*   BEING CALCULATED CORRECTLY BECAUSE PV_DATE IS NOT POPULATED. *00500089
005100*   MADE BY: NANCY EILBES            WR/IR #: WR24481            *00510089
005200*                                                                *00520089
005300* DATE  02/16/2005                                               *00530089
005400* CHANGE MADE: BECAUSE AP021-REC-TOT-COST NOW HAS 3 DIGITS AFTER *00540089
005500* THE DECIMAL POINT, IT CANNOT BE DIRECTLY COMPARED TO FIELD     *00550089
005600* AP060-GROSS-COST-AMT, WHICH STILL HAS ONLY 2 DIGITS AFTER.     *00560089
005700* CHANGED PROGRAM TO MOVE AP021-REC-TOT-COST TO NEW WORK FIELD   *00570089
005800* WITH ONLY DIGITS AFTER THE DECIMAL POINT AND CHANGED ALL       *00580089
005900* COMPARISONS TO USE THIS NEW WORK FIELD.                        *00590089
006000* MADE BY: NANCY EILBES            WR/IR #: WR28327              *00600089
006100*                                                                *00610089
006200* DATE  03/11/2007                                               *00620089
006300*     CHANGE MADE: MATCH BY DC PROJECT                           *00630089
006400*     CHANGED ALL REFERENCES OF AP060-STR-NBR TO AP060-MTCH-LOC- *00640089
006500*     NBR.  THIS WILL INSURE THAT THE FILE BUMP MATCH WILL STAY  *00650089
006600*     IN SYNC WITH THE ADDITION OF THE DC LEVEL MATCH.           *00660089
006700*     MADE BY: MIKE BESKE              WR/IR #: WR21578          *00670089
006800*                                                                *00680089
006900* DATE  10/24/2007                                               *00690089
007000*     CHANGE MADE: MATCH BY DC PROJECT PHASE II                  *00700089
007100*     MODIFIED DUE DATE CALCULATION FOR EXACT MATCH.  THE        *00710089
007200*     RECON CUTOFF DAY QUANTITY WILL NOW BE USED FROM THE        *00720089
007300*     TAPVNDS TABLE IF A RECORD EXISTS AND HAS A VALUE > 0.      *00730089
007400*     IF NOT THEN IT WILL BE USED FROM THE TAPCNTL TABLE.        *00740089
007500*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR32804          *00750089
007510*                                                                *00751089
007520* DATE  11/05/2007                                               *00752099
007530*     CHANGE MADE: MATCH BY DC PROJECT PHASE II                  *00753089
007540*     THE DUE DATE CALCULATION IS MODIFIED TO USE BOTH THE       *00754093
007550*     FLOAT DAY QTY AND RECON CUTOFF DAY QUANTITY FROM TAPVNDS   *00755094
007560*     IF A RECORD EXISTS OTHERWISE BOTH FROM TAPCNTL.            *00756094
007580*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: INC000000143550  *00758099
007510*                                                                *00759099
007520* DATE  05/11/2021                                               *00759199
007530*     CHANGE MADE: ADD LOGIC FOR SEPHORA                         *00759299
007580*     MADE BY: JEAN KURK               CHG0256545                *00759699
007600******************************************************************00760089
007700                                                                  00770089
007800 ENVIRONMENT DIVISION.                                            00780089
007900                                                                  00790089
008000 INPUT-OUTPUT SECTION.                                            00800089
008100                                                                  00810089
008200 FILE-CONTROL.                                                    00820089
008300                                                                  00830089
008400     SELECT INVOICES-FILE ASSIGN         TO UT-S-INP01.           00840089
008500                                                                  00850089
008600     SELECT RECEIPTS-FILE ASSIGN         TO UT-S-INP02.           00860089
008700                                                                  00870089
008800      SELECT UPD-INVOICE-FILE ASSIGN     TO OUT01.                00880089
008900      SELECT UNUSED-INVOICE-FILE ASSIGN  TO OUT02.                00890089
009000      SELECT UNUSED-RECEIPT-FILE ASSIGN  TO OUT03.                00900089
009100                                                                  00910089
009200 DATA DIVISION.                                                   00920089
009300                                                                  00930089
009400 FILE SECTION.                                                    00940089
009500                                                                  00950089
009600 FD  INVOICES-FILE                                                00960089
009700         LABEL RECORDS  ARE STANDARD                              00970089
009800         RECORDING MODE IS  F                                     00980089
009900         DATA RECORD    IS  INVOICE-RECORD.                       00990089
010000                                                                  01000089
010100 01  INVOICE-RECORD                PIC X(175).                    01010089
010200                                                                  01020089
010300 FD  RECEIPTS-FILE                                                01030089
010400         LABEL RECORDS  ARE STANDARD                              01040089
010500         RECORDING MODE IS  F                                     01050089
010600         DATA RECORD    IS  RECEIPT-RECORD.                       01060089
010700                                                                  01070089
010800 01  RECEIPT-RECORD                PIC X(090).                    01080089
010900                                                                  01090089
011000 FD  UPD-INVOICE-FILE                                             01100089
011100     RECORDING MODE IS F                                          01110089
011200     LABEL RECORDS ARE STANDARD                                   01120089
011300     BLOCK CONTAINS 0 RECORDS                                     01130089
011400     DATA RECORD IS UPD-INVOICE-RECORD.                           01140089
011500                                                                  01150089
011600 01  UPD-INVOICE-RECORD          PIC X(175).                      01160089
011700                                                                  01170089
011800 FD  UNUSED-INVOICE-FILE                                          01180089
011900     RECORDING MODE IS F                                          01190089
012000     LABEL RECORDS ARE STANDARD                                   01200089
012100     BLOCK CONTAINS 0 RECORDS                                     01210089
012200     DATA RECORD IS UNUSED-INVOICE-RECORD.                        01220089
012300                                                                  01230089
012400 01  UNUSED-INVOICE-RECORD       PIC X(175).                      01240089
012500                                                                  01250089
012600 FD  UNUSED-RECEIPT-FILE                                          01260089
012700     RECORDING MODE IS F                                          01270089
012800     LABEL RECORDS ARE STANDARD                                   01280089
012900     BLOCK CONTAINS 0 RECORDS                                     01290089
013000     DATA RECORD IS UNUSED-RECEIPT-RECORD.                        01300089
013100                                                                  01310089
013200 01  UNUSED-RECEIPT-RECORD       PIC X(090).                      01320089
013300                                                                  01330089
013400/                                                                 01340089
013500 WORKING-STORAGE SECTION.                                         01350089
013600                                                                  01360089
013700 01  FILLER                        PIC X(25) VALUE                01370089
013800                             'WS FOR APKUT022 BEGINS==>'.         01380089
013900 01  ABEND-CODE                    PIC S9(4) COMP SYNC            01390089
014000                                             VALUE ZEROS.         01400089
014100     88 AP-EMPTY-FILE              VALUE +4005.                   01410089
014200     88 AP-DB2-ERROR               VALUE +4013.                   01420089
014300                                                                  01430089
014400 01  PROGRAM-CONSTANTS.                                           01440089
014500     05  PC-9S                     PIC 9(09) VALUE 999999999.     01450089
014600     05  PC-9S-COMP3               PIC S9(09)V99 COMP-3 VALUE     01460089
014700                                               +999999999.99.     01470089
014800                                                                  01480089
014900                                                                  01490089
015000                                                                  01500089
015100 01  PV-DATE                       PIC X(10) VALUE SPACES.        01510089
015200 01  PV-DATE-CCYY-MM-DD REDEFINES PV-DATE.                        01520089
015300     05 PV-DATE-CC                 PIC 9(02).                     01530089
015400     05 PV-DATE-YY                 PIC 9(02).                     01540089
015500     05 FILLER                     PIC X(01).                     01550089
015600     05 PV-DATE-MM                 PIC 9(02).                     01560089
015700     05 FILLER                     PIC X(01).                     01570089
015800     05 PV-DATE-DD                 PIC 9(02).                     01580089
015900 01  PV-DATE-INVOICE-INCR          PIC X(10) VALUE SPACES.        01590089
016000 01  PV-DT-INV-CCYY-MM-DD REDEFINES PV-DATE-INVOICE-INCR.         01600089
016100     05 PV-DT-INV-CC               PIC 9(02).                     01610089
016200     05 PV-DT-INV-YY               PIC 9(02).                     01620089
016300     05 FILLER                     PIC X(01).                     01630089
016400     05 PV-DT-INV-MM               PIC 9(02).                     01640089
016500     05 FILLER                     PIC X(01).                     01650089
016600     05 PV-DT-INV-DD               PIC 9(02).                     01660089
016700 01  PV-DATE-RECEIPT               PIC X(10) VALUE SPACES.        01670089
016800 01  PV-DT-RECEIPT-CCYY-MM-DD REDEFINES PV-DATE-RECEIPT.          01680089
016900     05 PV-DT-RECEIPT-CC           PIC 9(02).                     01690089
017000     05 PV-DT-RECEIPT-YY           PIC 9(02).                     01700089
017100     05 FILLER                     PIC X(01).                     01710089
017200     05 PV-DT-RECEIPT-MM           PIC 9(02).                     01720089
017300     05 FILLER                     PIC X(01).                     01730089
017400     05 PV-DT-RECEIPT-DD           PIC 9(02).                     01740089
017500                                                                  01750089
017600 01  PV-ABEND-FILEDS.                                             01760089
017700     05  PV-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUT022'. 01770089
017800     05  PV-ABEND-SQLCODE             PIC X(4)  VALUE SPACES.     01780089
017900     05  PV-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     01790089
018000     05  PV-ABEND-OPERATION           PIC X(50) VALUE SPACES.     01800089
018100     05  PV-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     01810089
018200     05  PV-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     01820089
018300     05  PV-ABEND-STATUS              PIC XX    VALUE SPACES.     01830089
018400                                                                  01840089
018500 01  PV-WORK-AREA.                                                01850089
018600     05  PV-PROGRAM-NAME         PIC X(08)     VALUE 'APKUT022'.  01860089
018700                                                                  01870089
018800     05  PV-MAX-RETRIES               PIC S9(4) COMP VALUE +3.    01880089
018900     05  PV-FLOAT-DAY-QTY             PIC 9(5) VALUE ZEROS.       01890089
018910     05  PV-RECN-CTOFF-DAY-QTY        PIC 9(5) VALUE ZEROS.       01891089
018920     05  PV-CALC-NEW-CTOFF-DAY-QTY    PIC 9(4) COMP.              01892089
018930     05  PV-REC-TOT-COST-AMT          PIC S9(10)V999 VALUE ZEROS  01893089
018940                                             COMP-3.              01894089
018950*                                                                 01895089
018960 01  PV-PROGRAM-COUNTERS.                                         01896089
018970     05  PV-INVOICE-IN-REC-CNT   PIC 9(9)  VALUE ZEROS.           01897089
018980     05  PV-RECEIPT-IN-REC-CNT   PIC 9(9)  VALUE ZEROS.           01898089
018990     05  PV-UPD-INVOICE-REC-CNT  PIC 9(9)  VALUE ZEROS.           01899089
019000     05  PV-INVOICE-OUT-REC-CNT  PIC 9(9)  VALUE ZEROS.           01900089
019100     05  PV-RECEIPT-OUT-REC-CNT  PIC 9(9)  VALUE ZEROS.           01910089
019200                                                                  01920089
019300 01  PV-SWITCHES.                                                 01930089
019400     05  END-OF-INVOICE-SW       PIC X(01) VALUE 'N'.             01940089
019500         88  END-OF-INVOICE                VALUE 'Y'.             01950089
019600     05  END-OF-RECEIPT-SW       PIC X(01) VALUE 'N'.             01960089
019700         88  END-OF-RECEIPT                VALUE 'Y'.             01970089
019800     05  VENDOR-CONTROL-SW       PIC X(01) VALUE 'N'.             01980091
019900         88  VENDOR-CONTROLS               VALUE 'Y'.             01990090
020000         88  NO-VENDOR-CONTROLS            VALUE 'N'.             02000090
020400                                                                  02040089
020500 01  FILLER                      PIC X(35)  VALUE                 02050089
020600     'BEGINNING OF AP060 INPUT FILE    **'.                       02060089
020700     COPY APRD060.                                                02070089
020800                                                                  02080089
020900 01  FILLER                      PIC X(35)  VALUE                 02090089
021000     'BEGINNING OF AP021 INPUT FILE    **'.                       02100089
021100     COPY APRD021.                                                02110089
021200                                                                  02120089
021300     COPY DPWS004.                                                02130089
021400                                                                  02140089
021500     COPY APWS051.                                                02150089
021600                                                                  02160089
021700*----------------------------------------------------------------*02170089
021800*  WORKING STORAGE AREA FOR DPKUT500, DATE MANIPULATION ROUTINE  *02180089
021900*----------------------------------------------------------------*02190089
022000     COPY DPWS500.                                                02200089
022100 01  FILLER                      PIC X(35)  VALUE                 02210089
022200     'END OF AP WORK RECORD AREA       **'.                       02220089
022300                                                                  02230089
022400******************************************************************02240089
022500*  COMMUNICATIONS AREA2 FOR DB2                                   02250089
022600******************************************************************02260089
022700     COPY SQLCA2.                                                 02270089
022800                                                                  02280089
022900     EXEC SQL                                                     02290089
023000          INCLUDE SQLCA                                           02300089
023100     END-EXEC.                                                    02310089
023200                                                                  02320089
023300     EXEC SQL                                                     02330089
023400          INCLUDE TAPCNTL                                         02340089
023500     END-EXEC.                                                    02350089
023600                                                                  02360089
023700     EXEC SQL                                                     02370089
023800          INCLUDE TAPVNDS                                         02380089
023900     END-EXEC.                                                    02390089
024000                                                                  02400089
024100 01  FILLER                        PIC X(25) VALUE                02410089
024200          '<====PV FOR APKUT022 ENDS'.                            02420089
024300                                                                  02430089
024400*LINKAGE SECTION.                                                 02440089
024500                                                                  02450089
024600                                                                  02460089
024700 PROCEDURE DIVISION.                                              02470089
024800                                                                  02480089
024900 A100-MAINLINE.                                                   02490089
025000                                                                  02500089
025100     PERFORM B100-INITIALIZATION.                                 02510089
025200                                                                  02520089
025300     PERFORM B200-PROCESSING                                      02530089
025400        UNTIL END-OF-INVOICE AND                                  02540089
025500              END-OF-RECEIPT.                                     02550089
025600                                                                  02560089
025700     PERFORM Z900-END-OF-JOB.                                     02570089
025800                                                                  02580089
025900     GOBACK.                                                      02590089
026000        EJECT                                                     02600089
026100 B100-INITIALIZATION.                                             02610089
026200*                                                                 02620089
026300***************************************************************** 02630089
026400*    OPEN FILES                                                   02640089
026500***************************************************************** 02650089
026600*                                                                 02660089
026700     OPEN  INPUT   INVOICES-FILE                                  02670089
026800                   RECEIPTS-FILE                                  02680089
026900          OUTPUT   UPD-INVOICE-FILE                               02690089
027000                   UNUSED-INVOICE-FILE                            02700089
027100                   UNUSED-RECEIPT-FILE.                           02710089
027200                                                                  02720089
027300     PERFORM R100-READ-AP060.                                     02730089
027400     PERFORM R200-READ-AP021.                                     02740089
027500                                                                  02750089
027600     INITIALIZE DCLTAPCNTL.                                       02760089
027700     INITIALIZE DCLTAPVNDS.                                       02770089
027800                                                                  02780089
027900     MOVE ZEROS                TO APPD051-FLOAT-DAYS.             02790089
028000                                                                  02800089
028100     EXEC SQL                                                     02810089
028200         SELECT                                                   02820089
028300             RECN_CTOFF_DAY_QTY                                   02830089
028400           , PAYT_FLOAT_DAY_QTY                                   02840089
028500           , BTCH_PRC_DTE                                         02850089
028600         INTO                                                     02860089
028700             :APCNTL-RECN-CTOFF-DAY-QTY                           02870089
028800           , :APCNTL-PAYT-FLOAT-DAY-QTY                           02880095
028900           , :APCNTL-BTCH-PRC-DTE                                 02890089
029000         FROM TAPCNTL                                             02900089
029100     END-EXEC.                                                    02910089
029200                                                                  02920089
029300     EVALUATE TRUE                                                02930089
029400         WHEN SQLCODE = ZERO                                      02940089
029500              CONTINUE                                            02950089
029600         WHEN SQLCODE NOT = ZERO                                  02960089
029700           MOVE 'B100- '              TO PV-ABEND-PARAGRAPH       02970089
029800           MOVE 'UNSUCCESSFUL SELECT' TO PV-ABEND-OPERATION       02980089
029900           MOVE 'TAPCNTL'             TO PV-ABEND-STRUCTURE-1     02990089
030000           MOVE SPACES                TO PV-ABEND-STRUCTURE-2     03000089
030100           PERFORM Z999-SQL-ERROR                                 03010089
030200     END-EVALUATE.                                                03020089
030300                                                                  03030089
030400                                                                  03040089
030500                                                                  03050089
030600 B200-PROCESSING.                                                 03060089
030700*                                                                 03070089
030800***************************************************************** 03080089
030900*     PROCESS SELECTED INVOICES AND RECEIVING                     03090089
031000***************************************************************** 03100089
031100*                                                                 03110089
031200*   WHEN THERE IS A MATCH ON PO/STR/GROSS                         03120089
031300*   CALCULATE THE INVOICE DATE + FLOAT DAYS                       03130089
031400*   COMPARE TO RECEIPT DATE TO DETERMINE WHICH TO USE             03140089
031500*                                                                 03150089
031600*   WHEN THERE IS A NOT A MATCH, WRITE TO THE APPROPIATE          03160089
031700*   UNUSED OUTPUT FILE                                            03170089
031800*                                                                 03180089
031900                                                                  03190089
032000     IF  AP060-PO-NBR         = AP021-PO-NBR                      03200089
032100     AND AP060-MTCH-LOC-NBR   = AP021-STR-NBR                     03210089
032200     AND AP060-GROSS-COST-AMT = PV-REC-TOT-COST-AMT               03220089
032300                                                                  03230089
032400         PERFORM R300-CHECK-VENDOR-CONTROLS                       03240090
032500                                                                  03250089
032600         IF VENDOR-CONTROLS                                       03260090
032700*           MOVE APVNDS-PAYT-FLOAT-DAY-QTY TO PV-FLOAT-DAY-QTY    03270099
032710*           MOVE APVNDS-RECN-CTOFF-DAY-QTY                        03271099
032720*                                     TO PV-RECN-CTOFF-DAY-QTY    03272099
032700            IF AP060-SEPHORA-VND-YES                              03273099
032700            AND AP060-SEPHORA-DPT-NO                              03273199
032700               MOVE ZERO              TO PV-FLOAT-DAY-QTY         03273299
032710               MOVE 9                 TO PV-RECN-CTOFF-DAY-QTY    03274099
032710            ELSE                                                  03274199
032700               MOVE APVNDS-PAYT-FLOAT-DAY-QTY                     03274299
032700                                      TO PV-FLOAT-DAY-QTY         03274399
032710               MOVE APVNDS-RECN-CTOFF-DAY-QTY                     03274499
032720                                      TO PV-RECN-CTOFF-DAY-QTY    03275099
032710            END-IF                                                03276099
032800            SET NO-VENDOR-CONTROLS         TO TRUE                03280090
032900         ELSE                                                     03290089
033000            MOVE APCNTL-PAYT-FLOAT-DAY-QTY TO PV-FLOAT-DAY-QTY    03300089
033010            MOVE APCNTL-RECN-CTOFF-DAY-QTY                        03301089
033020                                      TO PV-RECN-CTOFF-DAY-QTY    03302089
033100         END-IF                                                   03310089
033400                                                                  03340089
033670         IF AP021-TYP-NIR                                         03367089
033680            PERFORM C200-PROCESS-INVC-DATE                        03368089
033690         ELSE                                                     03369089
033700            PERFORM C100-PROCESS-DATES                            03370089
033800         END-IF                                                   03380089
033900         PERFORM R100-READ-AP060                                  03390089
034000         PERFORM R200-READ-AP021                                  03400089
034100     ELSE                                                         03410089
034200        IF AP060-PO-NBR          = AP021-PO-NBR                   03420089
034300           IF AP060-MTCH-LOC-NBR = AP021-STR-NBR                  03430089
034400              IF AP060-GROSS-COST-AMT > PV-REC-TOT-COST-AMT       03440089
034500                 PERFORM W300-WRITE-RECEIPT-OUT                   03450089
034600                 PERFORM R200-READ-AP021                          03460089
034700              ELSE                                                03470089
034800                 PERFORM W200-WRITE-INVOICE-OUT                   03480089
034900                 PERFORM R100-READ-AP060                          03490089
035000              END-IF                                              03500089
035100           ELSE                                                   03510089
035200              IF AP060-MTCH-LOC-NBR > AP021-STR-NBR               03520089
035300                 PERFORM W300-WRITE-RECEIPT-OUT                   03530089
035400                 PERFORM R200-READ-AP021                          03540089
035500              ELSE                                                03550089
035600                 PERFORM W200-WRITE-INVOICE-OUT                   03560089
035700                 PERFORM R100-READ-AP060                          03570089
035800              END-IF                                              03580089
035900           END-IF                                                 03590089
036000        ELSE                                                      03600089
036100           IF AP060-PO-NBR > AP021-PO-NBR                         03610089
036200              PERFORM W300-WRITE-RECEIPT-OUT                      03620089
036300              PERFORM R200-READ-AP021                             03630089
036400           ELSE                                                   03640089
036500              PERFORM W200-WRITE-INVOICE-OUT                      03650089
036600              PERFORM R100-READ-AP060                             03660089
036700           END-IF                                                 03670089
036800        END-IF                                                    03680089
036900     END-IF.                                                      03690089
037000                                                                  03700089
037100                                                                  03710089
037200 C100-PROCESS-DATES.                                              03720089
037300                                                                  03730089
037400**** CONVERT RECEIPT DATE TO JULIAN FOR COMPARE                   03740089
037500                                                                  03750089
037600     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         03760089
037700                                                                  03770089
037800     SET DPG51-ACTUAL-CALENDAR-ONLY                               03780089
037900         DPG51-DO-NOT-INCR-DECR-DATE                              03790089
038000         DPG52-LK-DTE-ISO-FMT       TO TRUE.                      03800089
038100     MOVE SPACES                    TO DPG52-LK-DATE-INPUT.       03810089
038200     MOVE AP021-REC-DATE            TO DPG52-LK-DATE-INPUT.       03820089
038300                                                                  03830089
038400     CALL DP500-KOHLS-CALENDAR-ROUTINE                            03840089
038500         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               03850089
038600                                                                  03860089
038700     IF (DPG54-WARNING-ERROR OR                                   03870089
038800         DPG54-SEVERE-ERROR)                                      03880089
038900         CONTINUE                                                 03890089
039000     ELSE                                                         03900089
039100         MOVE DPG55-DB2-ISO-DATE-FMT    TO PV-DATE-RECEIPT        03910089
039200     END-IF.                                                      03920089
039300                                                                  03930089
039400**** CONVERT INVOICE DATE TO JULIAN FOR COMPARE                   03940089
039500**** ADD THE FLOAT DAYS TO THE DATE FOR COMPARISON                03950089
039600                                                                  03960089
039700     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         03970089
039800                                                                  03980089
039900     SET DPG51-ACTUAL-CALENDAR-ONLY                               03990089
040000         DPG51-INCREMENT-DATE                                     04000089
040100         DPG52-LK-DTE-ISO-FMT       TO TRUE.                      04010089
040200     MOVE SPACES                    TO DPG52-LK-DATE-INPUT.       04020089
040300     MOVE AP060-INVOICE-DATE        TO DPG52-LK-DATE-INPUT.       04030089
040400     MOVE PV-FLOAT-DAY-QTY          TO DPG51-INCR-DECR-DAYS-9.    04040089
040500                                                                  04050089
040600     CALL DP500-KOHLS-CALENDAR-ROUTINE                            04060089
040700         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               04070089
040800                                                                  04080089
040900     IF (DPG54-WARNING-ERROR OR                                   04090089
041000         DPG54-SEVERE-ERROR)                                      04100089
041100         CONTINUE                                                 04110089
041200     ELSE                                                         04120089
041300         MOVE DPG55-DB2-ISO-DATE-FMT TO                           04130089
041400                                     PV-DATE-INVOICE-INCR         04140089
041500     END-IF.                                                      04150089
041600                                                                  04160089
041700*  COMPARE THE RECEIPT DATE TO THE INVOICE DATE PLUS FLOAT DAYS   04170089
041800*  WHEN CHOSING THE RECEIPT DATE, BE SURE TO SET UP 0'S IN THE    04180089
041900*  FLOAT DAYS FIELD BEFORE EXECUTING APPD051                      04190089
042000*  WHEN CHOSING THE INVOICE DATE, BE SURE TO SEND THE INVOICE     04200089
042100*  DATE WITHOUT ANY FLOAT DAYS ADDED - THEY WILL BE ADDED         04210089
042200*  WHEN EXECUTING APPD051                                         04220089
042300                                                                  04230089
042400     IF PV-DATE-RECEIPT >         PV-DATE-INVOICE-INCR            04240089
042500        MOVE AP021-REC-DATE           TO APPD051-INVOICE-DATE     04250089
042600        MOVE ZEROS                    TO APPD051-FLOAT-DAYS       04260089
042700        SET AP060-SRC-RECEIVER        TO TRUE                     04270089
042800     ELSE                                                         04280089
042900        MOVE AP060-INVOICE-DATE       TO APPD051-INVOICE-DATE     04290089
043000        MOVE PV-FLOAT-DAY-QTY                                     04300089
043100                                      TO APPD051-FLOAT-DAYS       04310089
043200        SET AP060-SRC-INVOICE         TO TRUE.                    04320089
043300                                                                  04330089
043400        PERFORM D100-FINISH-DATE-PROCESS.                         04340089
043500                                                                  04350089
043600 C200-PROCESS-INVC-DATE.                                          04360089
043730                                                                  04373097
043800     MOVE AP060-INVOICE-DATE          TO APPD051-INVOICE-DATE.    04380089
043900     MOVE PV-FLOAT-DAY-QTY            TO APPD051-FLOAT-DAYS.      04390089
044000     SET AP060-SRC-INVOICE            TO TRUE.                    04400089
044100                                                                  04410089
044200     PERFORM D100-FINISH-DATE-PROCESS.                            04420089
044300                                                                  04430089
044400 D100-FINISH-DATE-PROCESS.                                        04440089
044500                                                                  04450089
044600     MOVE AP060-EOM-INDICATOR         TO APPD051-EOM-IND.         04460089
044700     MOVE AP060-TERMS-DUE-DAY-QTY     TO APPD051-DISCOUNT-DAYS.   04470089
044800     MOVE AP060-TERMS-EXT-DAY-QTY     TO APPD051-EXTENDED-DAYS.   04480089
044900                                                                  04490089
045000*  THIS RETURNS THE CALCULATED DUE DATE                           04500089
045100*  DATE SHOULD BE SAVED AS YYYYMMDD                               04510089
045200     PERFORM E100-CALC-DUE-DATE.                                  04520089
045300                                                                  04530089
045400     MOVE APPD051-RET-DTE-MM          TO AP060-DUE-DATE(5:2).     04540089
045500     MOVE APPD051-RET-DTE-DD          TO AP060-DUE-DATE(7:2).     04550089
045600     MOVE APPD051-RET-DTE-YY          TO AP060-DUE-DATE(3:2).     04560089
045700     MOVE APPD051-RET-DTE-CC          TO AP060-DUE-DATE(1:2)      04570089
045800                                                                  04580089
045900*  THIS RETURNS THE CALCULATED CUTOFF DATE                        04590089
046000*  WHICH IS BASED ON THE CALULATED DUE DATE                       04600089
046100*  DATE SHOULD BE SAVED AS YYYYMMDD                               04610089
046200     MOVE APPD051-RETURN-DATE-CCYY-MM-DD TO PV-DATE.              04620089
046300     PERFORM E200-CALC-CUTOFF-DATE.                               04630089
046400     MOVE APPD051-RET-DTE-MM          TO AP060-CUTOFF-DATE(5:2).  04640089
046500     MOVE APPD051-RET-DTE-DD          TO AP060-CUTOFF-DATE(7:2).  04650089
046600     MOVE APPD051-RET-DTE-YY          TO AP060-CUTOFF-DATE(3:2).  04660089
046700     MOVE APPD051-RET-DTE-CC          TO AP060-CUTOFF-DATE(1:2)   04670089
046800                                                                  04680089
046900     PERFORM W100-WRITE-UPD-INVOICE.                              04690089
047000                                                                  04700089
047100 E100-CALC-DUE-DATE.                                              04710089
047200                                                                  04720089
047300     PERFORM CALC-PAYMENT-DUE-DATE.                               04730089
047400     COPY APPD051.                                                04740089
047500                                                                  04750089
047600 E200-CALC-CUTOFF-DATE.                                           04760089
047700                                                                  04770089
047800     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         04780089
047900                                                                  04790089
048000     SET DPG51-FISCAL-454-CALENDAR                                04800089
048100         DPG51-DECREMENT-DATE                                     04810089
048200         DPG52-LK-DTE-ISO-FMT       TO TRUE.                      04820089
048300                                                                  04830089
048900     COMPUTE PV-CALC-NEW-CTOFF-DAY-QTY =                          04890090
048910               PV-RECN-CTOFF-DAY-QTY + AP060-TERMS-EXT-DAY-QTY.   04891092
048930                                                                  04893089
048940     MOVE PV-CALC-NEW-CTOFF-DAY-QTY  TO DPG51-INCR-DECR-DAYS-9.   04894089
048950     MOVE PV-DATE                   TO DPG52-LK-DATE-INPUT.       04895089
048960                                                                  04896089
048970     CALL DP500-KOHLS-CALENDAR-ROUTINE                            04897089
048980         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               04898089
048990                                                                  04899089
049000     IF (DPG54-WARNING-ERROR OR                                   04900089
049100         DPG54-SEVERE-ERROR)                                      04910089
049200         CONTINUE                                                 04920089
049300     ELSE                                                         04930089
049400         MOVE DPG55-DB2-ISO-DATE-FMT TO                           04940089
049500               APPD051-RETURN-DATE-CCYY-MM-DD                     04950089
049600     END-IF.                                                      04960089
049700                                                                  04970089
049800 R100-READ-AP060.                                                 04980089
049900*                                                                 04990089
050000***************************************************************** 05000089
050100*     READ THE SELECTED INVOICE FILE                              05010089
050200***************************************************************** 05020089
050300*                                                                 05030089
050400     IF NOT END-OF-INVOICE                                        05040089
050500        READ INVOICES-FILE INTO AP060-INVOICE-EXTRACT             05050089
050600          AT END  MOVE PC-9S         TO AP060-PO-NBR              05060089
050700                                        AP060-MTCH-LOC-NBR        05070089
050800                  MOVE PC-9S-COMP3   TO AP060-GROSS-COST-AMT      05080089
050900                  SET END-OF-INVOICE TO TRUE.                     05090089
051000                                                                  05100089
051100     IF NOT END-OF-INVOICE                                        05110089
051200        ADD 1 TO PV-INVOICE-IN-REC-CNT.                           05120089
051300                                                                  05130089
051400 R200-READ-AP021.                                                 05140089
051500*                                                                 05150089
051600***************************************************************** 05160089
051700*     READ THE RECEIVING FILE                                     05170089
051800***************************************************************** 05180089
051900*                                                                 05190089
052000     IF NOT END-OF-RECEIPT                                        05200089
052100        READ RECEIPTS-FILE INTO AP021-RECORD                      05210089
052200          AT END  MOVE PC-9S         TO AP021-PO-NBR              05220089
052300                                        AP021-STR-NBR             05230089
052400                  MOVE PC-9S-COMP3   TO PV-REC-TOT-COST-AMT       05240089
052500                  SET END-OF-RECEIPT TO TRUE                      05250089
052600     END-IF.                                                      05260089
052700                                                                  05270089
052800     IF NOT END-OF-RECEIPT                                        05280089
052900        MOVE AP021-REC-TOT-COST-AMT TO PV-REC-TOT-COST-AMT        05290089
053000        ADD 1 TO PV-RECEIPT-IN-REC-CNT                            05300089
053100     END-IF.                                                      05310089
053200                                                                  05320089
053300 R300-CHECK-VENDOR-CONTROLS.                                      05330090
053400***************************************************************** 05340089
053500*     CHECK IF THIS VENDOR HAS CONTROL FLOAT DAYS DEFINED         05350089
053600***************************************************************** 05360089
053700                                                                  05370089
053800     EXEC SQL                                                     05380089
053900         SELECT                                                   05390089
054000             PAYT_FLOAT_DAY_QTY                                   05400089
054010            ,RECN_CTOFF_DAY_QTY                                   05401089
054100         INTO                                                     05410089
054200             :APVNDS-PAYT-FLOAT-DAY-QTY                           05420089
054210            ,:APVNDS-RECN-CTOFF-DAY-QTY                           05421089
054300         FROM TAPVNDS AV                                          05430089
054400         WHERE AV.ENT_ID          = :AP060-ENT-ID                 05440089
054500           AND AV.VND_FLT_DAY_IND = 'V'                           05450089
054600     END-EXEC.                                                    05460089
054700                                                                  05470089
054800     EVALUATE TRUE                                                05480089
054900         WHEN SQLCODE = ZEROS                                     05490089
055000              SET VENDOR-CONTROLS         TO TRUE                 05500090
055100         WHEN SQLCODE = +100                                      05510089
055200              SET NO-VENDOR-CONTROLS      TO TRUE                 05520090
055300         WHEN OTHER                                               05530089
055400               MOVE 'R300- '              TO PV-ABEND-PARAGRAPH   05540089
055500               MOVE 'UNSUCCESSFUL SELECT' TO PV-ABEND-OPERATION   05550089
055600               MOVE 'TAPVNDS'             TO PV-ABEND-STRUCTURE-1 05560089
055700               MOVE SPACES                TO PV-ABEND-STRUCTURE-2 05570089
055800               PERFORM Z999-SQL-ERROR                             05580089
055900      END-EVALUATE.                                               05590089
056000                                                                  05600089
056807                                                                  05680789
056808 W100-WRITE-UPD-INVOICE.                                          05680889
056809                                                                  05680989
056810*  DETERMINE IF THE PAYMENT DUE SWITCH SHOULD BE Y OR N           05681089
056820*  PROCESS YEAR GREATER THAN CUTOFF YEAR   OR                     05682089
056830                                                                  05683089
056840     IF (APCNTL-BTCH-PRC-DTE(1:4)  > AP060-CUTOFF-DATE(1:4)) OR   05684089
056850                                                                  05685089
056860*  PROCESS YEAR SAME, PROCESS MONTH GREATER THAN CUTOFF MONTH OR  05686089
056870        (APCNTL-BTCH-PRC-DTE(1:4)  = AP060-CUTOFF-DATE(1:4) AND   05687089
056880         APCNTL-BTCH-PRC-DTE(6:2)  > AP060-CUTOFF-DATE(5:2)) OR   05688089
056890                                                                  05689089
056900*  PROCESS YEAR AND MONTH SAME, PROCESS DAY GREATER THAN OR EQUAL 05690089
057000*  TO THE CUTOFF DAY                                              05700089
057100        (APCNTL-BTCH-PRC-DTE(1:4)  = AP060-CUTOFF-DATE(1:4) AND   05710089
057200         APCNTL-BTCH-PRC-DTE(6:2)  = AP060-CUTOFF-DATE(5:2) AND   05720089
057300         APCNTL-BTCH-PRC-DTE(9:2) >= AP060-CUTOFF-DATE(7:2))      05730089
057400         SET AP060-PAYMENT-DUE TO TRUE                            05740089
057500     ELSE                                                         05750089
057600         SET AP060-PAYMENT-NOT-DUE TO TRUE.                       05760089
057700                                                                  05770089
057800     WRITE UPD-INVOICE-RECORD FROM AP060-INVOICE-EXTRACT.         05780089
057900     ADD 1 TO PV-UPD-INVOICE-REC-CNT.                             05790089
058000                                                                  05800089
058100 W200-WRITE-INVOICE-OUT.                                          05810089
058200                                                                  05820089
058300     WRITE UNUSED-INVOICE-RECORD FROM AP060-INVOICE-EXTRACT.      05830089
058400     ADD 1 TO PV-INVOICE-OUT-REC-CNT.                             05840089
058500                                                                  05850089
058600 W300-WRITE-RECEIPT-OUT.                                          05860089
058700                                                                  05870089
058800     WRITE UNUSED-RECEIPT-RECORD FROM AP021-RECORD.               05880089
058900     ADD 1 TO PV-RECEIPT-OUT-REC-CNT.                             05890089
059000                                                                  05900089
059100 Z900-END-OF-JOB.                                                 05910089
059200*                                                                 05920089
059300***************************************************************** 05930089
059400*     CLOSE ALL FILES, REPORT ON NECESSARY TOTALS                 05940089
059500***************************************************************** 05950089
059600*                                                                 05960089
059700     DISPLAY '************************************************'.  05970089
059800     DISPLAY 'TOTAL INVOICES RECORDS READ    = '                  05980089
059900              PV-INVOICE-IN-REC-CNT                               05990089
060000     DISPLAY '************************************************'.  06000089
060100     DISPLAY 'TOTAL RECEIPTS RECORDS READ    = '                  06010089
060200              PV-RECEIPT-IN-REC-CNT                               06020089
060300     DISPLAY '************************************************'.  06030089
060400     DISPLAY 'TOTAL UPDATED INVOICE RECORDS  = '                  06040089
060500              PV-UPD-INVOICE-REC-CNT                              06050089
060600     DISPLAY '************************************************'.  06060089
060700     DISPLAY 'TOTAL UNUSED  INVOICE RECORDS  = '                  06070089
060800              PV-INVOICE-OUT-REC-CNT                              06080089
060900     DISPLAY '************************************************'.  06090089
061000     DISPLAY 'TOTAL UNUSED  RECEIPT RECORDS  = '                  06100089
061100              PV-RECEIPT-OUT-REC-CNT                              06110089
061200     DISPLAY '************************************************'.  06120089
061300                                                                  06130089
061400     CLOSE INVOICES-FILE                                          06140089
061500           RECEIPTS-FILE                                          06150089
061600           UPD-INVOICE-FILE                                       06160089
061700           UNUSED-INVOICE-FILE                                    06170089
061800           UNUSED-RECEIPT-FILE.                                   06180089
061900                                                                  06190089
062000     IF   END-OF-INVOICE                                          06200089
062100          DISPLAY ' PROGRAM APKUT022 ENDS NORMALLY '              06210089
062200     ELSE                                                         06220089
062300          DISPLAY ' PROGRAM APKUT022 ENDS ABNORMALLY '            06230089
062400     END-IF.                                                      06240089
062500                                                                  06250089
062600 Z999-SQL-ERROR.                                                  06260089
062700*                                                                 06270089
062800***************************************************************** 06280089
062900*     PROCESS DB2 ABENDS                                          06290089
063000***************************************************************** 06300089
063100*                                                                 06310089
063200                                                                  06320089
063300     DISPLAY '*** DB2 ERROR '.                                    06330089
063400     DISPLAY '*** SQL CODE = '  PV-ABEND-SQLCODE.                 06340089
063500     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 06350089
063600     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               06360089
063700     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               06370089
063800     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             06380089
063900     IF PV-ABEND-STRUCTURE-2 > SPACES                             06390089
064000         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2.         06400089
064100                                                                  06410089
064200     COPY DPPD004.                                                06420089
064300                                                                  06430089
064400     MOVE +4013                    TO ABEND-CODE.                 06440089
064500                                                                  06450089
064600     CALL 'ILBOABN0' USING ABEND-CODE.                            06460089
