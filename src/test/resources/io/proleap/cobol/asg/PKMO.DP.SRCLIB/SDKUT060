       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    SDKUT060.                                         00020000
       AUTHOR.        JACKIE HELING                                     00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  02-07-01.                                         00050000
       DATE-COMPILED.                                                   00060000
                                                                        00070000
      ******************************************************************00071000
      *    DB2 - LOAD DAILY FLASH SALES TO THE STORE ADMIN DATABASE.    00073032
      *                                                                 00075000
      *   THIS PROGRAM READS THE DAILY FLASH TABLE (DFT_DLY_FLSH_SUM)   00076032
      *   AND SUMS UP TOTAL SALES BY STORE FOR A GIVEN FISCAL WEEK.     00077032
      *   RECORD IS WRITTEN TO TABLE SDT_WKLY_STR_BGT.                  00078032
      ******************************************************************00079200
      **  CHANGE HISTORY                                               *00079355
      ******************************************************************00079455
080905* 08/15/05  J.HELING  WR27349   MODIFY PROGRAM TO USE DAILY FLASH 00079556
080905*                               TABLE INSTEAD OF INPUT FILE       00079656
      ******************************************************************00079755
081505* 08/15/05  J.HELING  P789524   DATE LOGIC ERROR                  00079861
      ******************************************************************00080061
090108* 09/01/08  J.HELING  WR35115   REMOVE REFERENCE TO OBSOLETE FIELD00080167
      ******************************************************************00080264
       ENVIRONMENT DIVISION.                                            00081061
       CONFIGURATION SECTION.                                           00090000
       SOURCE-COMPUTER.  IBM-3090.                                      00100000
       OBJECT-COMPUTER.  IBM-3090.                                      00110000
                                                                        00120000
       INPUT-OUTPUT SECTION.                                            00130000
       FILE-CONTROL.                                                    00140035
                                                                        00150035
080905     SELECT CONTROL-FILE                                          00160056
               ASSIGN TO INP01.                                         00170035
                                                                        00180000
       DATA DIVISION.                                                   00190000
       FILE SECTION.                                                    00200035
                                                                        00210035
080905 FD  CONTROL-FILE                                                 00220056
           RECORDING MODE IS F                                          00230035
           LABEL RECORDS ARE STANDARD                                   00240035
           RECORD CONTAINS 80 CHARACTERS                                00250035
           BLOCK CONTAINS 0 RECORDS                                     00260035
           DATA RECORD IS CONTROL-RECORD.                               00270035
                                                                        00280035
       01  CONTROL-RECORD                  PIC X(80).                   00290035
                                                                        00300000
       WORKING-STORAGE SECTION.                                         00310000
                                                                        00320000
       01  PC-PROGRAM-CONSTANTS.                                        00330001
           05  PC-PROGRAM                  PIC X(08) VALUE 'SDKUT060'.  00331001
                                                                        00332001
       01  PV-PROGRAM-VARIABLES.                                        00333001
           05  PV-PARA-NAME                PIC X(25) VALUE SPACES.      00334001
           05  PV-ABEND-NOTE               PIC X(40) VALUE SPACES.      00335001
           05  PV-NBR-UPDATES              PIC S9(9) COMP-3 VALUE 0.    00335225
           05  PV-NBR-INSERTS              PIC S9(9) COMP-3 VALUE 0.    00335325
           05  PV-DB2-TABLE-NAME           PIC X(12) VALUE SPACES.      00335635
           05  PV-DB2-OPERATION-MSG        PIC X(60) VALUE SPACES.      00335735
080905     05  PV-COUNT                    PIC 9(04) VALUE 0.           00335956
           05  PV-SQLCODE                  PIC +9(4).                   00336045
                                                                        00337001
       01  SW-SWITCHES.                                                 00340000
080905     05  SW-END-OF-CSR-SWITCH        PIC X(01) VALUE 'N'.         00341156
080905         88 SW-END-OF-CSR                      VALUE 'Y'.         00341256
080905         88 SW-NOT-END-OF-CSR                  VALUE 'N'.         00341356
                                                                        00342000
080905 01  CC-CONTROL.                                                  00343056
080905     05  CC-WK-END-DTE               PIC X(10) VALUE SPACES.      00344156
080905     05  FILLER                      PIC X(70) VALUE SPACES.      00344256
                                                                        00344335
       01  WS-WORK-FIELDS.                                              00344435
           05  WS-START-INDEX              PIC 9(03) VALUE ZEROES.      00344535
           05  WS-END-INDEX                PIC 9(03) VALUE ZEROES.      00344635
           05  WS-CURR-STORE               PIC S9(04) COMP.             00344735
           05  WS-LAST-DAY-FISC-WK         PIC 9(03) VALUE ZEROES.      00344835
           05  WS-SLS-AMT                  PIC S9(9)V99 COMP-3 VALUE 0. 00344935
           05  WS-WK-END-DTE               PIC X(10) VALUE SPACES.      00345035
           05  WS-PYRL-AMT                 PIC S9(9)V99 COMP-3 VALUE 0. 00345135
                                                                        00345235
       01  SD-TIME-STAMP                   PIC  X(26)  VALUE SPACES.    00345335
       01  FILLER REDEFINES SD-TIME-STAMP.                              00345435
           05  SD-CURR-DTE                 PIC  X(10).                  00345535
           05  FILLER                      PIC  X(01).                  00345635
           05  SD-HOUR                     PIC  X(02).                  00345735
           05  FILLER                      PIC  X(01).                  00345835
           05  SD-MINUTE                   PIC  X(02).                  00345935
           05  FILLER                      PIC  X(01).                  00346035
           05  SD-SECOND                   PIC  X(02).                  00346135
           05  FILLER                      PIC  X(01).                  00346235
           05  SD-MICROSEC                 PIC  X(06).                  00346335
                                                                        00346435
                                                                        00346535
       01  ABEND-CODE                  PIC S9(04)  VALUE +0 COMP SYNC.  00346635
           88  AC-OPEN-FILE-ERROR                  VALUE +4005.         00346735
           88  AC-CLOSE-FILE-ERROR                 VALUE +4006.         00346835
           88  AC-DB2-ERROR                        VALUE +4013.         00346901
           88  AC-DATE-ROUTINE-ERROR               VALUE +4019.         00347001
                                                                        00370000
      *----------------------------------------------------------------*00370101
      * PARAMETER LIST FOR THE CALENDAR ROUTINE                         00370201
      *----------------------------------------------------------------*00370301
           COPY DPWS500.                                                00370401
                                                                        00370501
      *----------------------------------------------------------------*00371000
      *    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *00372000
      *----------------------------------------------------------------*00373000
           COPY DPWS004.                                                00374025
                                                                        00375000
      *----------------------------------------------------------------*00376000
      * DB2 MESSAGE AREA                                                00377000
      *----------------------------------------------------------------*00378000
           COPY SQLCA2.                                                 00379000
                                                                        00379100
      *----------------------------------------------------------------*00379200
      * STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                 00379300
      *----------------------------------------------------------------*00379400
           EXEC SQL                                                     00379500
               INCLUDE SQLCA                                            00379600
           END-EXEC.                                                    00379700
                                                                        00379800
      *----------------------------------------------------------------*00379900
      * SDT_WKLY_STR_BGT TABLE                                          00380000
      *----------------------------------------------------------------*00380100
           EXEC SQL                                                     00380200
               INCLUDE SDT00000                                         00380310
           END-EXEC.                                                    00380400
                                                                        00380500
      *----------------------------------------------------------------*00380663
      * XST_LOC TABLE                                                   00380763
      *----------------------------------------------------------------*00380863
120306     EXEC SQL                                                     00380963
120306         INCLUDE XST00001                                         00381063
120306     END-EXEC.                                                    00381163
                                                                        00381263
      *----------------------------------------------------------------*00381363
      * DFT_DLY_FLSH_SUM TABLE                                          00381463
      *----------------------------------------------------------------*00381563
080905     EXEC SQL                                                     00381663
080905         INCLUDE DFT00000                                         00381763
080905     END-EXEC.                                                    00381863
                                                                        00381963
      *----------------------------------------------------------------*00382063
      *        SELECT FOR FLASH TABLE (DFT_DLY_FLSH_SUM)                00382163
      *----------------------------------------------------------------*00382263
                                                                        00382363
080905     EXEC SQL                                                     00382463
080905         DECLARE SLS_CSR CURSOR FOR                               00382563
080905          SELECT STR_NBR                                          00382663
080905                ,SUM(WTD_DOL_AMT)                                 00382763
080905          FROM   DFT_DLY_FLSH_SUM A                               00382863
120306                ,XST_LOC B                                        00382963
120306          WHERE  A.STR_NBR = B.LOC_NBR                            00383063
080905          AND    SLS_DTE = :DFT00000-SLS-DTE                      00383163
120306          AND    B.LOC_TYP_CDE = 'DS'                             00383263
120306          AND    B.E_BUS_IND = 'N'                                00383363
080905          GROUP  BY  STR_NBR                                      00383463
080905     END-EXEC.                                                    00383563
                                                                        00383663
                                                                        00383763
       PROCEDURE DIVISION.                                              00383863
                                                                        00383963
      ******************************************************************00384033
       0000-MAIN.                                                       00390032
      ******************************************************************00390133
                                                                        00391000
           PERFORM 1000-INIT-HOUSEKEEPING.                              00400033
                                                                        00400200
           PERFORM UNTIL SW-END-OF-CSR                                  00410033
080905         PERFORM 4000-UPDATE-DB-RECORD                            00440556
080905         PERFORM 2000-FETCH-CSR                                   00441156
           END-PERFORM.                                                 00441233
                                                                        00442000
           PERFORM 9000-FINAL-HOUSEKEEPING.                             00451033
                                                                        00452000
           STOP RUN.                                                    00460000
                                                                        00480000
                                                                        00481033
      ******************************************************************00482033
       1000-INIT-HOUSEKEEPING.                                          00490033
      ******************************************************************00490133
                                                                        00490200
           OPEN INPUT CONTROL-FILE.                                     00490333
           PERFORM 1100-GET-TIMESTAMP.                                  00491404
080905     PERFORM 1200-READ-CONTROL.                                   00491656
                                                                        00491733
080905     IF CC-WK-END-DTE = SPACES                                    00491856
080905        PERFORM 1300-GET-DATES                                    00492056
081505        MOVE WS-WK-END-DTE TO DFT00000-SLS-DTE                    00492161
080905     ELSE                                                         00492256
080905        MOVE CC-WK-END-DTE TO DFT00000-SLS-DTE                    00492356
080905     END-IF.                                                      00492456
                                                                        00492500
080905     PERFORM 1400-OPEN-CSR.                                       00492656
080905     PERFORM 2000-FETCH-CSR.                                      00492856
                                                                        00496000
      ******************************************************************00496133
       1100-GET-TIMESTAMP.                                              00496233
      ******************************************************************00496333
                                                                        00496433
           EXEC SQL                                                     00496533
             SET :SD-TIME-STAMP = CURRENT TIMESTAMP                     00496633
           END-EXEC.                                                    00496733
                                                                        00496833
           IF SQLCODE NOT EQUAL ZERO                                    00496933
               MOVE '1100-GET-TIMESTAMP' TO PV-PARA-NAME                00497033
               MOVE 'UNSUCCESSFUL SET TIMESTAMP' TO PV-ABEND-NOTE       00497133
               PERFORM 8100-DB2-ABEND                                   00497234
           END-IF.                                                      00497333
                                                                        00497433
                                                                        00497633
      ******************************************************************00498033
080905 1200-READ-CONTROL.                                               00500056
      ******************************************************************00500133
                                                                        00500200
080905     READ CONTROL-FILE INTO CC-CONTROL.                           00500356
                                                                        00502000
      ******************************************************************00502133
080905 1300-GET-DATES.                                                  00503056
      ******************************************************************00503133
                                                                        00503533
080905*----------------------------------------------------------------*00503656
080905* GET FIRST DAY IN CURRENT WEEK                                  *00503756
080905*----------------------------------------------------------------*00503856
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              00504049
           SET DPG51-VALID-FISCAL-CALENDAR TO TRUE.                     00504151
           SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     00504251
           MOVE SD-CURR-DTE                TO DPG52-DB2-ISO-DATE-FMT.   00504351
                                                                        00504449
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    00504549
                                                   DPG54 DPG55 DPG56.   00504633
                                                                        00504833
                                                                        00504933
           EVALUATE TRUE                                                00505033
             WHEN DPG54-NO-ERROR                                        00505133
               MOVE DPG55-1ST-WKDY-DB2ISO-FMT TO WS-WK-END-DTE          00505253
             WHEN OTHER                                                 00505433
                SET AC-DATE-ROUTINE-ERROR TO TRUE                       00505533
                MOVE '800-GET-WEEK-END-DATE' TO PV-PARA-NAME            00505633
                MOVE 'DATE ROUTINE ERROR' TO PV-ABEND-NOTE              00505733
                PERFORM 8000-NON-DB2-ABEND                              00505855
           END-EVALUATE.                                                00505933
                                                                        00506238
080905*----------------------------------------------------------------*00506356
080905* SUBTRACT 1 DAY TO GET WEEK END DATE OF PREVIOUS WEEK           *00506456
080905*----------------------------------------------------------------*00506556
                                                                        00506649
080905     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              00506756
080905     SET DPG51-VALID-FISCAL-CALENDAR TO TRUE.                     00506856
080905     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     00506956
080905     SET DPG51-DECREMENT-DATE        TO TRUE.                     00507056
080905     MOVE 1                          TO DPG51-INCR-DECR-DAYS-9.   00507156
080905     MOVE WS-WK-END-DTE              TO DPG52-DB2-ISO-DATE-FMT.   00507256
                                                                        00507349
080905     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    00507456
080905                                             DPG54 DPG55 DPG56.   00507556
                                                                        00507749
080905     EVALUATE TRUE                                                00507856
080905       WHEN DPG54-NO-ERROR                                        00507956
080905         MOVE DPG55-DB2-ISO-DATE-FMT TO WS-WK-END-DTE             00508156
080905       WHEN OTHER                                                 00508356
080905          SET AC-DATE-ROUTINE-ERROR TO TRUE                       00508456
080905          MOVE '800-GET-WEEK-END-DATE' TO PV-PARA-NAME            00508556
080905          MOVE 'DATE ROUTINE ERROR' TO PV-ABEND-NOTE              00508656
080905          PERFORM 8000-NON-DB2-ABEND                              00508756
080905     END-EVALUATE.                                                00508856
                                                                        00508949
                                                                        00509149
      ******************************************************************00509249
       1400-OPEN-CSR.                                                   00509349
      ******************************************************************00509449
                                                                        00509549
080905     EXEC SQL                                                     00509656
080905         OPEN SLS_CSR                                             00509756
080905     END-EXEC.                                                    00509856
                                                                        00509949
080905     IF SQLCODE NOT EQUAL ZERO                                    00510056
080905         MOVE SQLCODE   TO PV-SQLCODE                             00510156
080905         MOVE 'DFT_DLY_FLSH_SUM' TO PV-DB2-TABLE-NAME             00510256
080905         MOVE '1400-OPEN-CSR' TO PV-PARA-NAME                     00510356
                                                                        00510449
080905         STRING 'OPEN THE STORE CURSOR - SQLCODE= '               00510556
080905                 PV-SQLCODE DELIMITED BY SIZE INTO                00510656
080905                 PV-DB2-OPERATION-MSG                             00510756
080905         END-STRING                                               00510856
                                                                        00510949
080905         PERFORM 8100-DB2-ABEND                                   00511056
080905     END-IF.                                                      00511156
                                                                        00511249
      ******************************************************************00511349
080905 2000-FETCH-CSR.                                                  00511456
      ******************************************************************00511549
                                                                        00511649
080905     EXEC SQL                                                     00511756
080905       FETCH SLS_CSR                                              00511856
080905         INTO :DFT00000-STR-NBR                                   00511956
080905             ,:DFT00000-WTD-DOL-AMT                               00512056
080905     END-EXEC                                                     00512156
                                                                        00512249
080905     EVALUATE TRUE                                                00512356
080905        WHEN  SQLCODE = 0                                         00512456
080905           ADD 1 TO PV-COUNT                                      00512556
080905        WHEN SQLCODE = +100                                       00512656
080905           SET SW-END-OF-CSR TO TRUE                              00512756
080905        WHEN OTHER                                                00512856
080905           MOVE '2000-FETCH-CSR' TO PV-PARA-NAME                  00512956
080905           MOVE SQLCODE            TO PV-SQLCODE                  00513056
080905           MOVE 'DFT_DLY_FLSH_SUM' TO PV-DB2-TABLE-NAME           00513156
080905           PERFORM 8100-DB2-ABEND                                 00513256
080905     END-EVALUATE.                                                00513356
                                                                        00513434
      ******************************************************************00513533
       4000-UPDATE-DB-RECORD.                                           00513633
      ******************************************************************00513733
                                                                        00513833
           EXEC SQL                                                     00513933
           UPDATE SDT_WKLY_STR_BGT                                      00514033
080905     SET SLS_AMT = :DFT00000-WTD-DOL-AMT                          00514156
              ,LAST_UPD_TMST = :SD-TIME-STAMP                           00514233
080905     WHERE STR_NBR = :DFT00000-STR-NBR                            00514356
                 AND BGTD_TYP_CDE = 'AC'                                00514433
080905           AND WK_END_DTE = :DFT00000-SLS-DTE                     00514556
           END-EXEC.                                                    00514633
                                                                        00514733
           EVALUATE TRUE                                                00514833
               WHEN SQLCODE = +0                                        00514933
                   ADD 1 TO PV-NBR-UPDATES                              00515033
               WHEN SQLCODE = +100                                      00515133
                   PERFORM 5000-INSERT-DB-RECORD                        00515333
               WHEN SQLCODE = -913                                      00515433
               WHEN SQLCODE = -904                                      00515533
                   MOVE '4000-UPDATE-DB-RECORD' TO PV-PARA-NAME         00515633
                   MOVE 'RESOURCE UNAVAILABLE' TO PV-ABEND-NOTE         00515733
                   PERFORM 8100-DB2-ABEND                               00515834
               WHEN OTHER                                               00515933
                   MOVE '4000-UPDATE-DB-RECORD' TO PV-PARA-NAME         00516033
                   MOVE 'ERROR ON UPDATE' TO PV-ABEND-NOTE              00516133
                   PERFORM 8100-DB2-ABEND                               00516234
           END-EVALUATE.                                                00516333
                                                                        00516433
                                                                        00516533
      ******************************************************************00530065
       5000-INSERT-DB-RECORD.                                           00540065
      ******************************************************************00550065
                                                                        00560065
           EXEC SQL                                                     00560165
           INSERT INTO SDT_WKLY_STR_BGT                                 00560265
              (STR_NBR, BGTD_TYP_CDE, WK_END_DTE, SLS_AMT, PYRL_AMT,    00560365
090108         LAST_UPD_USR_ID, LAST_UPD_TMST)                          00560467
090108*        LAST_UPD_USR_ID, LAST_UPD_TMST, PYRL_ADJ_AMT)            00560567
080905     VALUES(:DFT00000-STR-NBR, 'AC', :DFT00000-SLS-DTE,           00560665
080905            :DFT00000-WTD-DOL-AMT, :WS-PYRL-AMT, 'BATCH',         00560765
090108            :SD-TIME-STAMP)                                       00560967
090108*           :SD-TIME-STAMP, 0)                                    00561067
           END-EXEC.                                                    00561165
                                                                        00561265
           EVALUATE TRUE                                                00561365
               WHEN SQLCODE = +0                                        00561465
                   ADD 1 TO PV-NBR-INSERTS                              00561565
               WHEN SQLCODE = -913                                      00561665
               WHEN SQLCODE = -904                                      00561765
                   MOVE '5000-INSERT-DB-RECORD' TO PV-PARA-NAME         00561865
                   MOVE 'RESOURCE UNAVAILABLE' TO PV-ABEND-NOTE         00561965
                   PERFORM 8100-DB2-ABEND                               00562065
               WHEN OTHER                                               00562165
                   MOVE '5000-INSERT-DB-RECORD' TO PV-PARA-NAME         00562265
                   MOVE ' ERROR ON INSERT' TO PV-ABEND-NOTE             00562365
                   PERFORM 8100-DB2-ABEND                               00562465
           END-EVALUATE.                                                00562565
                                                                        00562665
                                                                        00562765
      ******************************************************************00562865
       8000-NON-DB2-ABEND.                                              00562965
      ******************************************************************00563065
                                                                        00563165
080905     PERFORM 9000-FINAL-HOUSEKEEPING.                             00563265
                                                                        00563365
           DISPLAY '***************************************************'00563465
           DISPLAY '** ABEND IN PROGRAM ' PC-PROGRAM                    00563565
           DISPLAY '** PARAGRAPH        ' PV-PARA-NAME                  00563665
           DISPLAY '**' PV-ABEND-NOTE                                   00563765
           DISPLAY '***************************************************'00563865
                                                                        00563965
           CALL 'ILBOABN0' USING ABEND-CODE.                            00564065
                                                                        00564165
                                                                        00564265
      ******************************************************************00564365
       8100-DB2-ABEND.                                                  00564465
      ******************************************************************00564565
                                                                        00564665
           MOVE SQLCODE TO SQLCODE2.                                    00564765
           MOVE SQLERRD(3) TO SQLERRD3.                                 00564865
                                                                        00564965
           DISPLAY '**************************************************' 00565065
           DISPLAY '** ABEND IN PROGRAM ' PC-PROGRAM                    00565165
           DISPLAY '** PARAGRAPH        ' PV-PARA-NAME                  00565265
           DISPLAY '** SQL ERROR      = ' SQLCODE2.                     00565365
           DISPLAY '** SQLERRM        = ' SQLERRM.                      00565465
           DISPLAY '**************************************************'.00565565
                                                                        00565665
080905     PERFORM 9000-FINAL-HOUSEKEEPING.                             00565765
                                                                        00565865
      *----------------------------------------------------------------*00565965
      *  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   00566065
      *  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        00566165
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     00566265
      *  FORMAT.                                                        00566365
      *----------------------------------------------------------------*00566465
           COPY DPPD004.                                                00566565
                                                                        00566665
           CALL 'DSNTIAR' USING SQLCA                                   00566765
                                DP004-FORMATTED-MESSAGE                 00566865
                                DP004-ERROR-LINE-LENGTH.                00566965
                                                                        00567065
           DISPLAY DP004-ASTERISK-LINE.                                 00567165
                                                                        00567265
           PERFORM                                                      00567365
              VARYING DP004-MSG-IDX                                     00567465
              FROM 1 BY 1                                               00567565
              UNTIL DP004-MSG-IDX > DP004-MAX-MESSAGE-LINES             00567665
                  DISPLAY '**'                                          00567765
                          DP004-MESSAGE-LINE (DP004-MSG-IDX)            00567865
                          ' **'                                         00567965
           END-PERFORM.                                                 00568065
                                                                        00568165
           DISPLAY DP004-ASTERISK-LINE.                                 00568265
                                                                        00568365
           IF SQLCODE NOT = -911                                        00568465
               EXEC SQL                                                 00568565
                   COMMIT                                               00568665
               END-EXEC                                                 00568765
           END-IF.                                                      00568865
                                                                        00568965
           SET AC-DB2-ERROR TO TRUE.                                    00569065
                                                                        00569165
           CALL 'ILBOABN0' USING ABEND-CODE.                            00569265
                                                                        00569365
                                                                        00569465
                                                                        00569565
      ******************************************************************00569665
       9000-FINAL-HOUSEKEEPING.                                         00569765
      ******************************************************************00569865
                                                                        00569965
080905     CLOSE CONTROL-FILE.                                          00570065
080905     PERFORM 9100-CLOSE-CSR.                                      00570165
                                                                        00570265
           DISPLAY ' '                                                  00570365
080905     DISPLAY '************************************************'.  00570465
080905     DISPLAY '           SDKUT060 STATS '                         00570565
080905     DISPLAY 'SALES DATA LOADED FOR WEEK OF ' DFT00000-SLS-DTE.   00570665
           DISPLAY 'TOTAL INSERTS = ' PV-NBR-INSERTS.                   00570765
           DISPLAY 'TOTAL UPDATES = ' PV-NBR-UPDATES.                   00570865
080905     DISPLAY '************************************************'.  00570965
           DISPLAY ' '.                                                 00571065
                                                                        00571165
                                                                        00572065
      ******************************************************************00580042
080905 9100-CLOSE-CSR.                                                  00590056
      ******************************************************************00600042
                                                                        00612042
080905     EXEC SQL                                                     00620056
080905         CLOSE SLS_CSR                                            00630056
080905     END-EXEC.                                                    00640056
                                                                        00650042
080905     IF SQLCODE NOT EQUAL ZERO                                    00660056
080905         MOVE SQLCODE   TO PV-SQLCODE                             00670056
080905         MOVE 'DFT_DLY_FLSH_SUM' TO PV-DB2-TABLE-NAME             00680056
080905         MOVE '9100-CLOSE-CSR' TO PV-PARA-NAME                    00690056
080905         STRING 'CLOSE THE SALES CURSOR - SQLCODE= '              00700056
080905                 PV-SQLCODE DELIMITED BY SIZE INTO                00710056
080905                 PV-DB2-OPERATION-MSG                             00720056
080905         END-STRING                                               00730056
080905                                                                  00740056
080905         PERFORM 8100-DB2-ABEND                                   00750056
080905     END-IF.                                                      00760056
                                                                        00770055
