000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT255.                                        00020000
000300 AUTHOR.         P.THOMPSON, G&R.                                 00030000
000400 DATE-WRITTEN.  06/13/94.                                         00040000
000500 DATE-COMPILED.                                                   00050000
000600******************************************************************00060041
000700*    COBOL 2                                                     *00070041
000800*                                                                *00080041
000900*    OPEN INVOICE EXTRACT                                        *00090041
001000*                                                                *00100041
001100*   PROGRAM OVERVIEW:                                            *00110041
001200*                                                                *00120041
001300*     THIS PROGRAM CREATES EXTRACT FILE OF OPEN INVOICES         *00130041
001400*   WHICH HAVE REACHED THE CUTOFF DATE WITHOUT BEING             *00140041
001500*   MATCHED TO A VERIFIED RECEIPT.                               *00150041
001600*                                                                *00160041
001700*   INPUT:                                                       *00170041
001800*        NONE                                                    *00180041
001900*                                                                *00190041
002000*   OUTPUT:                                                      *00200041
002100*        OPEN-INVOICE-FILE                 (APRD262)             *00210041
002200*                                                                *00220041
002300*   DB2 TABLES:                                                  *00230041
002400*                                                                *00240041
002500*        TRECEIV - RECEIVING HEADER                              *00250041
002600*        TRECDIS - RECEIVING DESTRIBUTION                        *00260041
002700*        TPURCHS - PURCHASE ORDER HEADER                         *00270041
002800*        TEXTENT - EXTERNAL ENTERPRISE                           *00280041
002900*        TENTNME - EXTERNAL ENTERPRISE NAME                      *00290041
003000*        TINVOIC - INVOICE                                       *00300041
003100*        TINVCTM - INVOICE PAYMENT TERMS                         *00310041
003200*        TAPCNTL - A/P PAYMENT CONTROL                           *00320041
003300*        TMDINVC - MERCHANDISE INVOICE                           *00330041
003400*        TPAYTRM - EXTERNAL ENTERPRISE PAYMENT TERM TYPE         *00340041
003500*        TPOAGMT - PURCHASE ORDER AGREEMENT                      *00350041
003600*                                                                *00360041
003700******************************************************************00370041
003800*   CHANGES:                                                     *00380041
003900*                                                                *00390041
004000* 12/07/95    MKK  RECOMPILED DUE TO CHANGE IN COPYBOOK APPD051  *00400041
004100*                                                                *00410041
004200* 08/22/97    JMK  MODIFIED TO USE THE CALCULATED DUE DATE FROM  *00420041
004300*                  THE INVOICE TABLE IF IT EXISTS, OTHERWISE     *00430041
004400*                  THE DUE DATE IS CALCULATED.                   *00440041
004500*                                                                *00450041
004600* 09/18/97    MAB  CORRECTED THE DB2 TABLE NAME DISPLAYS FOR DB2 *00460041
004700*                  ERRORS IN 8600-READ-TINVCTM.  ADDED DISPLAYS  *00470041
004800*                  FOR PURCHS-PO-NBR AND INVOIC-PAYT-REQ-SEQ-NBR *00480041
004900*                  IN 9998-DB2-ABEND.  PITS:113610               *00490041
005000*                                                                *00500041
005100* 10/23/97    MAB  CORRECTED THE CODE THAT CALCUATES THE DAYS    *00510041
005200*                  DELINQUENT.  WHENEVER INVOIC-DUE-DTE-SRC-CDE  *00520041
005300*                  NOT SPACES, COMPARE THE INVOIC-CALC-DUE-DATE  *00530041
005400*                  TO THE CURRENT DATE (IN JULIAN FORMAT) TO     *00540041
005500*                  DETERMINE WHAT THE NUMBER OF DAYS DELINQUENT  *00550041
005600*                  ARE.                PITS:123566               *00560041
005700*                                                                *00570041
005800* 06/11/98    CJG  Y2K CHANGES. INCREASED SIZE OF JULIAN DATES   *00580041
005900*                  TO INCLUDE CENTURY. ADD WINDOW LOGIC TO       *00590041
006000*                  CALCULATE CENTURY.                            *00600041
006100*                                                                *00610041
006200* 08/24/99    LAS  Y2K CHANGES. REMOVED ALL JULIAN DATES.        *00620041
006300*                  APPD051-RETURN-DATE TO INCLUDE CENTURY.       *00630041
006400*                                                                *00640041
006500* 12/08/1999 JILL JUEL                   WR/IR #: WR6041         *00650041
006600*            - MODIFIED THE CHECK ON THE DATE ROUTINE TO         *00660041
006700*              CONFORM WITH Y2K STANDARDS BY ADDING              *00670041
006800*              DPG54-WARNING-ERROR.                              *00680041
006900*                                                                *00690041
007000* 11/10/00 - THIS PROGRAM WAS MODIFIED TO PROCESS THE            *00700041
007100*            ADDITIONAL EXTEDED DAYS IN THE PO TERMS.            *00710041
007200*            THE NEW LOGIC WAS ADDED TO THE END OF               *00720041
007300*            8400-READ-TPOAGMT.                                  *00730041
007400*        BY: JILL JUEL                             WR#: 20224    *00740041
007500*                                                                *00750041
007600* 11/17/00 - CHANGED THE RECORD LENGTH ON THE EXTRACT FILE FROM  *00760041
007700*            77 TO 78.  CHANGED THE APRD262I COPYBOOK TO         *00770041
007800*            APRD262 AND RENAMED ALL FIELDS TO CONFORM TO        *00780041
007900*            CURRENT STANDARDS.  EXPANDED THE DAYS-DELINQUENT    *00790041
008000*            FIELD FROM 3 TO 5 POSITIONS.                        *00800041
008100*        BY: NANCY EILBES                          WR#: 20704    *00810041
008200*                                                                *00820041
008300* 02/27/01 - MODIFIED THE LENGTH OF THE EXTRACT FILE TO 100.     *00830041
008400*            THE APRD262 COPYBOOK WAS MODIFIED TO ADD THE        *00840041
008500*            PAYT-REQ-SEQ-NBR AND TO EXPAND THE DUE-DATE.        *00850041
008600*            LOGIC IN THIS PROGRAM WAS ADDED/UPDATED TO MAKE     *00860041
008700*            SURE THESE FIELDS ARE PROPERLY FILLED IN.           *00870041
008800*        BY: NANCY EILBES                          WR#: 20704    *00880041
008900*                                                                *00890041
009000* 06/17/2002                                                     *00900041
009100*    ARK PO PROJECT PHASE 1.  RECOMPILE FROM PRODUCTION.         *00910041
009200* MADE BY: KEVIN CATLIN                    WR# 23500             *00920041
009300*                                                                *00930041
009400* 06/20/2002                                                     *00940041
009500*    ARK PO PROJECT PHASE 1.  REMOVE ALL REFERENCES TO           *00950041
009600*    TABLE TPAYREQ.                                              *00960041
009700* MADE BY: KEVIN CATLIN                    WR# 23500             *00970041
009800*                                                                *00980041
009900* 07/09/2002                                                     *00990041
010000*    ARK PO PROJECT PHASE 2.  REPLACED ANY REMAINING USAGE OF    *01000041
010100*    PAYMENT REQUEST NUMBER WITH INVOICE ID AND PO NUMBER.       *01010041
010200* MADE BY: BRIAN HASSLINGER                WR# 23500              01020003
010300*                                                                *01030041
010400* 11/04/02 - COLBY DATING PROJECT.                               *01040041
010500*            ADDED VALUE OF 'PJ' TO LIST OF STATUS CODES IN THE  *01050041
010600*            WHERE CONDITION OF THE INVOICE-CURSOR.              *01060041
010700*        BY: MIKE BESKE                            WR#: 23750    *01070041
010800*                                                                *01080041
010900* 02/07/2003                                                     *01090041
011000*    CHANGE MADE: ARKPO PHASE3 PROJECT.                          *01100041
011100*    UPDATED PGM COMMENT BLOCK WITH THE FILENAME.                *01110041
011200*    CHANGED -PURCHASE-ORDER TO -PO-NBR FOR THE MODIFIED         *01120041
011300*    COPYBOOK.                                                   *01130041
011400* MADE BY:  MIKE BESKE                          WR#: 23500       *01140041
011500*                                                                *01150041
011510* 03/11/2007                                                     *01151041
011520*    CHANGE MADE: MATCH BY DC PROJECT.                           *01152041
011530*    MODIFIED CODE TO BRING PROGRAM UP TO STANDARD.              *01153041
011540*    ADDED - DC_NBR AND MTCH_LVL_CDE TO TINVOIC-CURSOR.          *01154041
011550*    ADDED - DC-MTCH-LVL-CURSOR.                                 *01155041
011551*    MODIFIED PARAGRAPH 6000- TO CHECK FOR THE MTCH-LVL-CDE AND  *01155141
011552*    SPLIT OUT PROCESSING ACCORDING TO THE MTCH-LVL-CDE.         *01155241
011553*    ADDED - PARAGRAPH 6300-, 8830-, 8840-, AND 8850- TO HANDLE  *01155341
011554*    THE PROCESSING OF MTCH-LVL-CDE OF 'D'.                      *01155441
011560* MADE BY:  ROLF NOHE                           WR#: 21578       *01156041
011570*                                                                *01157041
011580* 06/12/2008                                                     *01158041
011590*    CHANGE MADE: MATCH BY DC PHASE 2 PROJECT.                   *01159041
011591*    ADDED AN EXCLUSION OF IMPORTS TO THE TINVOIC CURSOR.        *01159141
011592*    REMOVED ALL REFERENCES TO AP262-ENTRY-METHOD,               *01159241
011593*    AP262-PO-STATUS, AND AP262-HOLD-IND SINCE THESE HAVE BEEN   *01159341
011594*    REMOVED FROM THE COPYBOOK APRD262.                          *01159441
011598* MADE BY:  ROLF NOHE                           WR#: 32804       *01159841
011599*                                                                *01159941
011600* 08/12/2021                                                     *01160041
011601*    CHANGE MADE: ADD LOGIC TO DETERMINE IF THE PO IS FOR        *01160141
011602*    SEPHORA AND POPULATE NEW FIELD ON OUTPUT FILE.              *01160241
011606* MADE BY:  JEAN KURK                           CHG0260549       *01160641
011607*                                                                *01160741
011609* DATE  10/12/2023                                               *01160941
011610*  CHANGE MADE: REMOVED CURSORS GETTING THE RECEIVER STATUS FROM *01161041
011611*  TABLES TRECEIV AND TRECDIS.  REPLACED WITH DIRECT SELECTS TO  *01161141
011612*  GET THE COUNT OF INCOMPLETE RECEIVERS FOR BULK, STORE AND DC  *01161241
011613*  SET A NEW FLAG ON THE APRD262 COPYBOOK BASED ON COUNT.  NEW   *01161341
011614*  FLAG TO BE USED ON THE APKRP262 REPORT.                       *01161441
011615*  MADE BY: NANCY EILBES            WR/IR #: CHG0294992          *01161541
011620******************************************************************01162041
011700/                                                                 01170003
011800 ENVIRONMENT DIVISION.                                            01180003
011900 CONFIGURATION SECTION.                                           01190003
012000 INPUT-OUTPUT SECTION.                                            01200003
012100 FILE-CONTROL.                                                    01210003
012200     SELECT OPEN-INVOICE-FILE ASSIGN TO UT-S-OUT01.               01220003
012300/                                                                 01230003
012400 DATA DIVISION.                                                   01240003
012500 FILE SECTION.                                                    01250003
012600                                                                  01260003
012700 FD  OPEN-INVOICE-FILE                                            01270003
012800     LABEL RECORDS  ARE STANDARD                                  01280003
012900     RECORDING  MODE IS F.                                        01290003
013000 01  OPEN-INVOICE-REC                 PIC X(100).                 01300003
013100                                                                  01310003
013200/                                                                 01320003
013300 WORKING-STORAGE SECTION.                                         01330003
013400 01  PROGRAM-WORKAREA.                                            01340003
013500     05  FILLER                      PIC  X(30) VALUE             01350003
013600                                 '** BEGINING OF APKUT255 W/S **'.01360003
013700     05  PW-CURRENT-PARAGRAPH         PIC  X(30)    VALUE SPACES. 01370003
013800     05  PW-INPUT-COUNT               PIC  9(05)    VALUE ZEROES  01380003
013900                                                    COMP-3.       01390003
014000     05  PW-OUTPUT-COUNT              PIC  9(05)    VALUE ZEROES  01400003
014100                                                    COMP-3.       01410003
014200     05  PW-RETRY-COUNT               PIC S9(04)    VALUE ZERO    01420003
014300                                                    COMP SYNC.    01430003
014310     05  PV-RCV-INCOMP-COUNT             PIC S9(9)  COMP-3        01431038
014320                                                    VALUE ZERO.   01432038
014400     05  PW-DISPLAY-COUNT             PIC  9(05)    VALUE 0.      01440003
014500                                                                  01450003
014600     05  PW-CALC-DUE-DATE             PIC  X(10)    VALUE SPACES. 01460003
014700     05  PW-CALC-DUE-DTE.                                         01470003
014800         10  PW-CALC-DUE-CC           PIC 99.                     01480003
014900         10  PW-CALC-DUE-YY           PIC 99.                     01490003
015000         10  FILLER                   PIC X.                      01500003
015100         10  PW-CALC-DUE-MM           PIC 99.                     01510003
015200         10  FILLER                   PIC X.                      01520003
015300         10  PW-CALC-DUE-DD           PIC 99.                     01530003
015400                                                                  01540003
015500     05  ABEND-CODE                   PIC S9(04)    VALUE ZEROES  01550003
015600                                                    COMP SYNC.    01560003
015700         88 WRITE-ERROR                             VALUE +4001.  01570003
015800         88 READ-ERROR                              VALUE +4002.  01580003
015900         88 CC-ERRROR                               VALUE +4003.  01590003
016000         88 TABLE-ERROR                             VALUE +4004.  01600003
016100         88 OPEN-ERROR                              VALUE +4005.  01610003
016200         88 CLOSE-ERROR                             VALUE +4006.  01620003
016300         88 SEQ-ERROR                               VALUE +4007.  01630003
016400         88 DATA-ERROR                              VALUE +4008.  01640003
016500         88 KEYPUNCH-ERROR                          VALUE +4009.  01650003
016800         88 SORT-ERROR                              VALUE +4012.  01680003
016900         88 DB2-ERROR                               VALUE +4013.  01690003
017000         88 DATE-ERROR                              VALUE +4019.  01700003
017100                                                                  01710003
017200 01  WS-ABEND-FIELDS.                                             01720003
017300     05  WS-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUT255'. 01730003
017400     05  WS-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     01740003
017500     05  WS-ABEND-OPERATION           PIC X(50) VALUE SPACES.     01750003
017600     05  WS-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     01760003
017700     05  WS-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     01770003
017800     05  WS-ABEND-STRUCTURE-3         PIC X(8)  VALUE SPACES.     01780003
017900     05  WS-ABEND-STATUS              PIC XX    VALUE SPACES.     01790003
018000                                                                  01800003
018100 01  PROGRAM-SWITCHES.                                            01810003
018200     05  PS-END-PROCESSING-SW         PIC  X(01)    VALUE 'N'.    01820003
018300         88  END-OF-PROCESSING                      VALUE 'Y'.    01830003
018400     05  PS-END-TRECEIV-CSR-SW        PIC  X(01)    VALUE 'N'.    01840003
018500         88  NOT-END-OF-TRECEIV-CSR                 VALUE 'N'.    01850003
018600         88  END-OF-TRECEIV-CSR                     VALUE 'Y'.    01860003
018700     05  PS-END-TRECDIS-CSR-SW        PIC  X(01)    VALUE 'N'.    01870003
018800         88  NOT-END-OF-TRECDIS-CSR                 VALUE 'N'.    01880003
018900         88  END-OF-TRECDIS-CSR                     VALUE 'Y'.    01890003
019000     05  PS-LOOP-PASS-SW              PIC  X(01)    VALUE 'N'.    01900003
019100         88  NOT-FIRST-PASS                         VALUE 'N'.    01910003
019200         88  FIRST-PASS                             VALUE 'Y'.    01920003
019211     05  PS-END-DC-MTCH-LVL-CSR-SW    PIC  X(01)    VALUE 'N'.    01921111
019220         88  NOT-END-OF-DC-MTCH-LVL-CSR             VALUE 'N'.    01922011
019230         88  END-OF-DC-MTCH-LVL-CSR                 VALUE 'Y'.    01923011
019240     05  PS-RCV-INCOMP-IND              PIC  X(01)  VALUE ' '.    01924039
019250         88  PS-RCV-INCOMP                          VALUE 'Y'.    01925038
019260         88  PS-RCV-NOT-INCOMP                      VALUE 'N'.    01926038
019300                                                                  01930003
019400 01  PV-CURRENT-DATE.                                             01940003
019500     05  PV-CUR-CC                    PIC  9(02)    VALUE ZEROES. 01950003
019600     05  PV-CUR-YYMMDD.                                           01960003
019700         10  PV-CUR-YY                PIC  9(02)    VALUE ZEROES. 01970003
019800         10  PV-CUR-MM                PIC  9(02)    VALUE ZEROES. 01980003
019900         10  PV-CUR-DD                PIC  9(02)    VALUE ZEROES. 01990003
020000 01  PW-CURRENT-DATE.                                             02000003
020100     05  PW-CURRENT-CC                PIC  9(02)    VALUE ZEROES. 02010003
020200     05  PW-CURRENT-YYMMDD.                                       02020003
020300         10  PW-CURRENT-YY            PIC  9(02)    VALUE ZEROES. 02030003
020400         10 FILLER                    PIC X(01)     VALUE '-'.    02040003
020500         10  PW-CURRENT-MM            PIC  9(02)    VALUE ZEROES. 02050003
020600         10 FILLER                    PIC X(01)     VALUE '-'.    02060003
020700         10  PW-CURRENT-DD            PIC  9(02)    VALUE ZEROES. 02070003
020800 01  PW-CUTOFF-DATE-CCYYMMDD          PIC  X(10)    VALUE SPACES. 02080003
020900 01  PV-DATE-CCYY-MM-DD               PIC  X(10)    VALUE SPACES. 02090003
021000 01  PV-DT-CYMD     REDEFINES PV-DATE-CCYY-MM-DD.                 02100003
021100     05 PV-DT-CC                      PIC  9(02).                 02110003
021200     05 PV-DT-YYMMDD.                                             02120003
021300        10 PV-DT-YY                      PIC 9(02).               02130003
021400        10 FILLER                        PIC X(01).               02140003
021500        10 PV-DT-MM                      PIC 9(02).               02150003
021600        10 FILLER                        PIC X(01).               02160003
021700        10 PV-DT-DD                      PIC 9(02).               02170003
021800     05  PV-DISC-EXTENDED-DAYS           PIC S9(4)  COMP.         02180003
021900                                                                  02190003
022000 01  PC-PROGRAM-CONSTANTS.                                        02200000
022100     05  PC-VENDOR-NOT-FOUND PIC  X(15)  VALUE 'VENDR NOT FOUND'. 02210000
022200     05  PC-MAX-RETRIES               PIC S9(04)    VALUE 10      02220000
022300                                                    COMP SYNC.    02230000
022400/                                                                 02240000
022500**************************************************************** *02250041
022600*  WORK AREA USED BY DPPD004 ABEND ROUTINE                       *02260000
022700**************************************************************** *02270041
022800     COPY DPWS004.                                                02280009
022900/                                                                 02290000
023000**************************************************************** *02300041
023100*  WORK AREA USED BY APPD051 PAYMENT DUE DATE ROUTINE            *02310000
023200**************************************************************** *02320041
023300     COPY APWS051.                                                02330009
023400/                                                                 02340000
023500**************************************************************** *02350041
023600*  WORK AREA PASSED IN CALL TO DPKUT500                          *02360000
023700**************************************************************** *02370041
023800     COPY DPWS500.                                                02380009
023900/                                                                 02390000
024000**************************************************************** *02400041
024100*  OUTPUT DATA SET LAYOUT                                        *02410000
024200**************************************************************** *02420041
024300     COPY APRD262.                                                02430009
024400/                                                                 02440000
024500     EXEC SQL                                                     02450000
024600         INCLUDE SQLCA                                            02460000
024700     END-EXEC                                                     02470000
024800                                                                  02480000
024900     EXEC SQL                                                     02490000
025000          INCLUDE TRECEIV                                         02500000
025100     END-EXEC.                                                    02510000
025200                                                                  02520000
025300     EXEC SQL                                                     02530000
025400          INCLUDE TRECDIS                                         02540000
025500     END-EXEC.                                                    02550000
025600                                                                  02560000
025700     EXEC SQL                                                     02570000
025800          INCLUDE TPURCHS                                         02580000
025900     END-EXEC.                                                    02590000
026000                                                                  02600000
026100     EXEC SQL                                                     02610000
026200          INCLUDE TEXTENT                                         02620000
026300     END-EXEC.                                                    02630000
026400                                                                  02640000
026500     EXEC SQL                                                     02650000
026600          INCLUDE TENTNME                                         02660000
026700     END-EXEC.                                                    02670000
026800                                                                  02680000
026900     EXEC SQL                                                     02690000
027000          INCLUDE TINVOIC                                         02700000
027100     END-EXEC.                                                    02710000
027200                                                                  02720000
027300     EXEC SQL                                                     02730000
027400          INCLUDE TINVCTM                                         02740000
027500     END-EXEC.                                                    02750000
027600                                                                  02760000
027700     EXEC SQL                                                     02770000
027800          INCLUDE TAPCNTL                                         02780000
027900     END-EXEC.                                                    02790000
028000                                                                  02800000
028100     EXEC SQL                                                     02810003
028200          INCLUDE TMDINVC                                         02820003
028300     END-EXEC.                                                    02830003
028400                                                                  02840003
028500     EXEC SQL                                                     02850003
028600          INCLUDE TPAYTRM                                         02860003
028700     END-EXEC.                                                    02870003
028800                                                                  02880003
028900     EXEC SQL                                                     02890003
029000          INCLUDE TPOAGMT                                         02900003
029100     END-EXEC.                                                    02910003
029110                                                                  02911028
029120     EXEC SQL                                                     02912028
029130          INCLUDE TMDSEAR                                         02913028
029140     END-EXEC.                                                    02914028
029150*                 VNT_VND_CPBL                                    02915028
029160     EXEC SQL                                                     02916028
029170          INCLUDE VNT00001                                        02917028
029180     END-EXEC.                                                    02918028
029200                                                                  02920003
029300     EXEC SQL                                                     02930003
029400         DECLARE TINVOIC-CURSOR  CURSOR FOR                       02940003
029500          SELECT A.PAYT_REQ_SEQ_NBR                               02950003
029600                ,A.INVC_ID                                        02960003
029700                ,A.INVC_TYP_CDE                                   02970003
029800                ,A.STR_NBR                                        02980003
029900                ,A.INVC_DTE                                       02990003
030000                ,A.HOLD_IND                                       03000003
030100                ,A.ENTR_MTHD_CDE                                  03010003
030200                ,A.GRO_COST_AMT                                   03020003
030300                ,A.STATUS_CDE                                     03030003
030400                ,A.CALC_DUE_DTE                                   03040003
030500                ,A.DUE_DTE_SRC_CDE                                03050003
030510                ,A.DC_NBR                                         03051010
030520                ,A.MTCH_LVL_CDE                                   03052010
030600                ,B.PO_NBR                                         03060003
030610                ,B.DEPT_NBR                                       03061027
030700                ,B.ENT_ID                                         03070003
030800                ,B.STATUS_CDE                                     03080003
030900                ,C.TERM_SEL_CDE                                   03090003
031000            FROM TINVOIC A                                        03100003
031100                ,TPURCHS B                                        03110003
031200                ,TMDINVC C                                        03120003
031300           WHERE A.PO_NBR         = C.PO_NBR                      03130003
031400             AND A.INVC_ID        = C.INVC_ID                     03140003
031500             AND A.PO_NBR         = B.PO_NBR                      03150003
031600             AND A.STATUS_CDE     IN ('EN','RC','OB','IB','PJ')   03160005
031700             AND B.VER_STATUS_CDE = 'A'                           03170003
031710             AND B.PO_TYP_CDE NOT IN ('IE', 'IM', 'IF')           03171023
031800     END-EXEC.                                                    03180003
031900                                                                  03190003
033994*--------------------------------------------------------------*  03399429
033995* COPYBOOK FOR SEPHORA LOGIC                                   *  03399529
033996*--------------------------------------------------------------*  03399629
033997     COPY APWS021.                                                03399729
033998                                                                  03399829
034000 01  FILLER                      PIC  X(25)  VALUE                03400003
034100     '** END OF APKUT255 W/S **'.                                 03410003
034200/                                                                 03420003
034300 PROCEDURE DIVISION.                                              03430003
034400*                                                                 03440003
034500 0000-MAINLINE.                                                   03450003
034600                                                                  03460003
034700     DISPLAY '*-------------- PROGRAM:  APKUT255 --------------*' 03470003
034800     MOVE '0000-MAINLINE                ' TO PW-CURRENT-PARAGRAPH.03480003
034900     PERFORM 9000-INIT.                                           03490009
035000     PERFORM 1000-DETAIL-PROCESSING                               03500009
035100         UNTIL END-OF-PROCESSING.                                 03510003
035200     PERFORM 9900-END-OF-INPUT.                                   03520009
035300                                                                  03530003
035400     GOBACK.                                                      03540003
035500/                                                                 03550003
035600 1000-DETAIL-PROCESSING.                                          03560003
035700     MOVE '1000-DETAIL-PROCESSING       ' TO PW-CURRENT-PARAGRAPH.03570003
035800*                                                                 03580003
035900     EVALUATE MDINVC-TERM-SEL-CDE                                 03590003
036000         WHEN 'I'                                                 03600003
036100             PERFORM 3000-INV-TERMS                               03610009
036200         WHEN 'P'                                                 03620003
036300             PERFORM 2000-PO-TERMS                                03630009
036400         WHEN OTHER                                               03640003
036500             PERFORM 2000-PO-TERMS                                03650009
036600     END-EVALUATE.                                                03660003
036700*                                                                 03670003
036710     MOVE PURCHS-ENT-ID        TO PV-ENT-ID.                      03671027
036720     MOVE PURCHS-DEPT-NBR      TO PV-DEPT-NBR.                    03672027
036730     PERFORM S500-CHECK-FOR-SEPHORA.                              03673027
036740*                                                                 03674027
036800     PERFORM 4000-CALC-CUTOFF-DATE.                               03680009
036900     IF PW-CUTOFF-DATE-CCYYMMDD <= PW-CURRENT-DATE                03690003
037000      OR INVOIC-STATUS-CDE = 'RC'                                 03700003
037100         PERFORM 5000-CALC-DAYS-DELINQ                            03710009
037200         PERFORM 6000-RECVR-STATUS                                03720009
037300         PERFORM 7000-BUILD-DETAIL                                03730009
037400     END-IF.                                                      03740003
037500                                                                  03750003
037600     PERFORM 8010-FETCH-INVOICE.                                  03760009
037700                                                                  03770003
038000/                                                                 03800003
038100 2000-PO-TERMS.                                                   03810003
038200     MOVE '2000-PO-TERMS                ' TO PW-CURRENT-PARAGRAPH.03820003
038300*                                                                 03830003
038400     PERFORM 8400-READ-TPOAGMT.                                   03840009
038500     IF PAYTRM-DUE-DAY-FR-DTE-TXT = 'EOM'                         03850003
038600         MOVE 'Y' TO APPD051-EOM-IND                              03860003
038700     ELSE                                                         03870003
038800         MOVE 'N' TO APPD051-EOM-IND                              03880003
038900     END-IF.                                                      03890003
039000     IF PAYTRM-DISCOUNT-PCT = 0                                   03900003
039100         MOVE PAYTRM-DUE-DAY-QTY        TO APPD051-DISCOUNT-DAYS  03910003
039200     ELSE                                                         03920003
039300         MOVE PAYTRM-DISCOUNT-DAYS-QTY  TO APPD051-DISCOUNT-DAYS  03930003
039400     END-IF.                                                      03940003
039500     MOVE POAGMT-DISC-PAY-DAY-QTY   TO APPD051-EXTENDED-DAYS.     03950003
039600     MOVE APCNTL-PAYT-FLOAT-DAY-QTY TO APPD051-FLOAT-DAYS.        03960003
039700     MOVE INVOIC-INVC-DTE           TO APPD051-INVOICE-DATE.      03970003
039800                                                                  03980003
040100/                                                                 04010003
040200 3000-INV-TERMS.                                                  04020003
040300     MOVE '3000-INV-TERMS               ' TO PW-CURRENT-PARAGRAPH.04030003
040400*                                                                 04040003
040500     PERFORM 8600-READ-TINVCTM.                                   04050009
040600     IF INVCTM-TERM-TYP-CDE = '01'                                04060003
040700         MOVE 'N' TO APPD051-EOM-IND                              04070003
040800     ELSE                                                         04080003
040900         MOVE 'Y' TO APPD051-EOM-IND                              04090003
041000     END-IF.                                                      04100003
041100     IF INVCTM-DISC-PCT = 0                                       04110003
041200         MOVE INVCTM-NET-DUE-DAY-QTY    TO APPD051-DISCOUNT-DAYS  04120003
041300     ELSE                                                         04130003
041400         MOVE INVCTM-DISC-DUE-DAY-QTY   TO APPD051-DISCOUNT-DAYS  04140003
041500     END-IF.                                                      04150003
041600     MOVE INVCTM-EXTD-DAYS-QTY      TO APPD051-EXTENDED-DAYS.     04160003
041700     MOVE APCNTL-PAYT-FLOAT-DAY-QTY TO APPD051-FLOAT-DAYS.        04170003
041800     MOVE INVOIC-INVC-DTE           TO APPD051-INVOICE-DATE.      04180003
041900                                                                  04190003
042200/                                                                 04220003
042300 4000-CALC-CUTOFF-DATE.                                           04230003
042400     MOVE '4000-CALC-CUTOFF-DATE        ' TO PW-CURRENT-PARAGRAPH.04240003
042500*                                                                 04250003
042600     IF INVOIC-DUE-DTE-SRC-CDE = SPACES                           04260003
042700         PERFORM CALC-PAYMENT-DUE-DATE                            04270009
042900***************************************************************   04290003
043000           IF (DPG54-WARNING-ERROR OR                             04300003
043100               DPG54-SEVERE-ERROR)                                04310003
043200***************************************************************   04320003
043300             DISPLAY 'PURCHS-PO-NBR   ' PURCHS-PO-NBR             04330003
043400             DISPLAY 'INV PAY REQ SEQ ' INVOIC-PAYT-REQ-SEQ-NBR   04340003
043500             DISPLAY 'LK-DATE         ' DPG52-LK-DATE-INPUT       04350003
043600             DISPLAY 'INCR-DECR-DAYS  ' DPG51-INCR-DECR-DAYS-9    04360003
043700             DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND   04370003
043800             DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND      04380003
043900             DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND 04390003
044000             DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND       04400003
044100             DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND           04410003
044200             DISPLAY                    DPG54-ERROR-MESSAGE       04420003
044300***************************************************************   04430003
044400             MOVE PW-CURRENT-PARAGRAPH                            04440003
044500                 TO WS-ABEND-PARAGRAPH                            04450003
044600             MOVE 'UNSUCCESSFUL DATE CONVERSION WITHIN APPD051'   04460003
044700                 TO WS-ABEND-OPERATION                            04470003
044800             SET DATE-ERROR TO TRUE                               04480003
044900             PERFORM 9999-ABEND                                   04490003
045000           ELSE                                                   04500003
045100*            MOVE APPD051-RET-DTE-MM TO AP262-DUE-DATE(1:2)       04510003
045200*            MOVE APPD051-RET-DTE-DD TO AP262-DUE-DATE(3:2)       04520003
045300*            MOVE APPD051-RET-DTE-YY TO AP262-DUE-DATE(5:2)       04530003
045400             MOVE APPD051-RETURN-DATE-CCYY-MM-DD TO               04540003
045500                                        AP262-DUE-DATE            04550003
045600                                        PV-DATE-CCYY-MM-DD        04560003
045700           END-IF                                                 04570003
045800     ELSE                                                         04580003
045900*        MOVE INVOIC-CALC-DUE-DTE(6:2) TO AP262-DUE-DATE(1:2)     04590003
046000*        MOVE INVOIC-CALC-DUE-DTE(9:2) TO AP262-DUE-DATE(3:2)     04600003
046100*        MOVE INVOIC-CALC-DUE-DTE(3:2) TO AP262-DUE-DATE(5:2)     04610003
046200         MOVE INVOIC-CALC-DUE-DTE TO AP262-DUE-DATE               04620003
046300                                     PV-DATE-CCYY-MM-DD           04630003
046400     END-IF.                                                      04640000
046500     INITIALIZE DPG51                                             04650000
046600                DPG52                                             04660000
046700                DPG53                                             04670000
046800                DPG54                                             04680000
046900                DPG55                                             04690000
047000                DPG56.                                            04700000
047100                                                                  04710000
047200     MOVE 'F2'                 TO DPG51-CALENDAR-TYPE.            04720000
047300     SET DPG52-LK-DTE-ISO-FMT  TO TRUE.                           04730000
047400                                                                  04740000
047500     IF INVOIC-DUE-DTE-SRC-CDE = SPACES                           04750000
047600         MOVE APPD051-RETURN-DATE-CCYY-MM-DD TO                   04760000
047700             DPG52-LK-DATE-INPUT                                  04770000
047800     ELSE                                                         04780000
047900         MOVE INVOIC-CALC-DUE-DTE TO DPG52-LK-DATE-INPUT          04790000
048000     END-IF.                                                      04800000
048100                                                                  04810000
048200     SET DPG51-DECREMENT-DATE TO TRUE.                            04820000
048300     MOVE APCNTL-RECN-CTOFF-DAY-QTY TO DPG51-INCR-DECR-DAYS-9.    04830000
048400                                                                  04840000
048500     CALL DP500-KOHLS-CALENDAR-ROUTINE                            04850000
048600         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               04860000
048700                                                                  04870000
048800     IF (DPG54-WARNING-ERROR OR                                   04880000
048900         DPG54-SEVERE-ERROR)                                      04890000
049000***************************************************************   04900000
049100         DISPLAY 'PURCHS-PO-NBR   ' PURCHS-PO-NBR                 04910000
049200         DISPLAY 'INV PAY REQ SEQ ' INVOIC-PAYT-REQ-SEQ-NBR       04920000
049300         DISPLAY 'INPUT DATE      ' DPG52-LK-DATE-INPUT           04930004
049400         DISPLAY 'CALCULATED DATE ' DPG55-DB2-ISO-DATE-FMT        04940004
049500         DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND       04950003
049600         DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND          04960003
049700         DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND     04970003
049800         DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND           04980003
049900         DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND               04990003
050000***************************************************************   05000003
050100         MOVE PW-CURRENT-PARAGRAPH                                05010003
050200             TO WS-ABEND-PARAGRAPH                                05020003
050300         MOVE 'UNSUCCESSFUL CUTOFF DATE CALCULATION              '05030003
050400             TO WS-ABEND-OPERATION                                05040003
050500         SET DATE-ERROR TO TRUE                                   05050003
050600         PERFORM 9999-ABEND.                                      05060003
050700     MOVE DPG55-DB2-ISO-DATE-FMT TO PW-CUTOFF-DATE-CCYYMMDD.      05070003
050800                                                                  05080003
051100/                                                                 05110003
051200     COPY APPD051.                                                05120009
051300/                                                                 05130003
051400 5000-CALC-DAYS-DELINQ.                                           05140003
051500     MOVE '5000-CALC-DAYS-DELINQ        ' TO PW-CURRENT-PARAGRAPH.05150003
051600*                                                                 05160003
051700     IF PV-DATE-CCYY-MM-DD >= PW-CURRENT-DATE                     05170003
051800         MOVE ZERO TO AP262-DAYS-DELINQUENT                       05180003
051900     ELSE                                                         05190003
052000         PERFORM 5100-COMPARE-DATES                               05200009
052100         MOVE DPG55-DAYS-DIFFERENCE TO AP262-DAYS-DELINQUENT      05210003
052200     END-IF.                                                      05220003
052300                                                                  05230003
052600/                                                                 05260003
052700 5100-COMPARE-DATES.                                              05270003
052800     INITIALIZE DPG51                                             05280003
052900                DPG52                                             05290003
053000                DPG53                                             05300003
053100                DPG54                                             05310003
053200                DPG55                                             05320003
053300                DPG56.                                            05330003
053400                                                                  05340003
053500     MOVE 'F2'                 TO DPG51-CALENDAR-TYPE.            05350003
053600                                                                  05360003
053700     SET DPG51-DO-NOT-INCR-DECR-DATE                              05370003
053800         DPG52-LK-DTE-ISO-FMT                                     05380003
053900         DPG53-LK-CMPR-DTE-ISO-FMT    TO TRUE.                    05390003
054000                                                                  05400003
054100     MOVE PV-DATE-CCYY-MM-DD        TO DPG52-LK-DATE-INPUT.       05410003
054200     MOVE PW-CURRENT-DATE           TO DPG53-LK-CMPR-DATE-INPUT.  05420003
054300                                                                  05430003
054400     CALL DP500-KOHLS-CALENDAR-ROUTINE                            05440003
054500         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               05450003
054600                                                                  05460003
054700     IF (DPG54-WARNING-ERROR OR                                   05470003
054800         DPG54-SEVERE-ERROR)                                      05480003
054900***************************************************************   05490003
055000         DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND       05500003
055100         DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND          05510003
055200         DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND     05520003
055300         DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND           05530003
055400         DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND               05540003
055500***************************************************************   05550003
055600         MOVE PW-CURRENT-PARAGRAPH           TO WS-ABEND-PARAGRAPH05560003
055700         MOVE 'UNSUCCESSFUL DATE COMPARISON' TO WS-ABEND-OPERATION05570003
055800         SET DATE-ERROR TO TRUE                                   05580003
055900         PERFORM 9999-ABEND.                                      05590003
056100                                                                  05610009
056200/                                                                 05620003
056300 6000-RECVR-STATUS.                                               05630003
056400     MOVE '6000-RECVR-STATUS            ' TO PW-CURRENT-PARAGRAPH.05640003
056500*                                                                 05650003
057020     EVALUATE INVOIC-MTCH-LVL-CDE                                 05702010
057030        WHEN 'P'                                                  05703010
057040           PERFORM 6100-BULK-INVOICE                              05704010
057050        WHEN 'S'                                                  05705010
057060           PERFORM 6200-INVOICE-BY-STORE                          05706010
057070        WHEN 'D'                                                  05707010
057080           PERFORM 6300-INVOICE-BY-DC                             05708011
057090     END-EVALUATE.                                                05709010
057100                                                                  05710003
057400/                                                                 05740003
057500 6100-BULK-INVOICE.                                               05750003
057510                                                                  05751035
057600     MOVE '6100-BULK-INVOICE            ' TO PW-CURRENT-PARAGRAPH.05760003
057700                                                                  05770038
057800     INITIALIZE PS-RCV-INCOMP-IND.                                05780040
057900     PERFORM 8700-SELECT-RCV-INCOMP-BULK.                         05790038
057901     MOVE PS-RCV-INCOMP-IND TO AP262-RCV-INCOM-IND.               05790138
057902                                                                  05790235
059700                                                                  05970009
059800/                                                                 05980003
059900 6200-INVOICE-BY-STORE.                                           05990003
059910                                                                  05991034
060000     MOVE '6200-INVOICE-BY-INVOICE      ' TO PW-CURRENT-PARAGRAPH.06000003
060001                                                                  06000134
060002     INITIALIZE PS-RCV-INCOMP-IND.                                06000238
060010     PERFORM 8800-SELECT-RCV-INCOMP-STORE.                        06001038
060011     MOVE PS-RCV-INCOMP-IND TO AP262-RCV-INCOM-IND.               06001138
060020                                                                  06002035
062100                                                                  06210009
062200/                                                                 06220003
062210 6300-INVOICE-BY-DC.                                              06221010
062220                                                                  06222035
062224     MOVE '6300-INVOICE-BY-DC           ' TO PW-CURRENT-PARAGRAPH.06222417
062225                                                                  06222535
062226     INITIALIZE PS-RCV-INCOMP-IND.                                06222638
062250     PERFORM 8830-SELECT-RCV-INCOMP-DC.                           06225038
062251     MOVE PS-RCV-INCOMP-IND TO AP262-RCV-INCOM-IND.               06225138
062252                                                                  06225235
062307                                                                  06230718
062308/                                                                 06230818
062310 7000-BUILD-DETAIL.                                               06231010
062320                                                                  06232035
062400     MOVE '7000-BUILD-DETAIL            ' TO PW-CURRENT-PARAGRAPH.06240003
062500                                                                  06250035
062600     PERFORM 8200-GET-DUNNSNBR-NAME.                              06260009
062700     MOVE INVOIC-PAYT-REQ-SEQ-NBR  TO AP262-PAYT-REQ-SEQ-NBR.     06270003
062900     MOVE INVOIC-GRO-COST-AMT      TO AP262-GROSS-INVOICE-AMT.    06290003
063000     MOVE INVOIC-INVC-TYP-CDE      TO AP262-INVOICE-TYPE.         06300003
063100     MOVE INVOIC-INVC-ID           TO AP262-INVOICE-NUMBER.       06310003
063300     MOVE INVOIC-STATUS-CDE        TO AP262-INVOICE-STATUS.       06330003
063310     MOVE INVOIC-MTCH-LVL-CDE      TO AP262-MTCH-LVL-CDE.         06331024
063400                                                                  06340003
063500     MOVE PURCHS-PO-NBR            TO AP262-PO-NBR.               06350008
064100                                                                  06410003
064200     MOVE EXTENT-DUN-NBR           TO AP262-VENDOR-NUMBER.        06420003
064300     MOVE ENTNME-ENT-NAME-DESC     TO AP262-VENDOR-NAME.          06430003
064310     IF PS-SEPHORA-ALL                                            06431027
064320         SET AP262-IS-SEPHORA      TO TRUE                        06432027
064330     ELSE                                                         06433027
064340         SET AP262-IS-NOT-SEPHORA  TO TRUE                        06434027
064350     END-IF.                                                      06435027
064360                                                                  06436027
064400     PERFORM 9100-WRITE-EXTRACT.                                  06440009
064500                                                                  06450003
064800/                                                                 06480003
064900 8000-OPEN-TINVOIC-CURSOR.                                        06490003
064910                                                                  06491035
065000     MOVE '8000-OPEN-TINVOIC-CURSOR     ' TO PW-CURRENT-PARAGRAPH.06500003
065010                                                                  06501035
065100     EXEC SQL                                                     06510003
065200         OPEN TINVOIC-CURSOR                                      06520003
065300     END-EXEC.                                                    06530003
065400                                                                  06540003
065500     EVALUATE TRUE                                                06550003
065600         WHEN SQLCODE = ZERO                                      06560003
065700             CONTINUE                                             06570003
065900         WHEN OTHER                                               06590003
066000             MOVE PW-CURRENT-PARAGRAPH TO WS-ABEND-PARAGRAPH      06600035
066200             MOVE 'UNSUCCESSFUL OPEN  ' TO WS-ABEND-OPERATION     06620035
066400             MOVE 'TINVOIC'  TO WS-ABEND-STRUCTURE-1              06640003
066500             MOVE 'TPURCHS'  TO WS-ABEND-STRUCTURE-2              06650003
066600             MOVE 'TMDINVC'  TO WS-ABEND-STRUCTURE-3              06660003
066700             PERFORM 9998-DB2-ABEND                               06670003
066800     END-EVALUATE.                                                06680003
066900                                                                  06690009
067100/                                                                 06710003
067200 8010-FETCH-INVOICE.                                              06720003
067210                                                                  06721035
067300     MOVE '8010-FETCH-INVOICE            ' TO PW-CURRENT-PARAGRAPH06730003
067400     INITIALIZE DCLTINVOIC                                        06740003
067500                DCLTPURCHS                                        06750003
067600                DCLTMDINVC.                                       06760003
067700                                                                  06770003
067800     EXEC SQL                                                     06780003
067900         FETCH TINVOIC-CURSOR                                     06790003
068000             INTO  :INVOIC-PAYT-REQ-SEQ-NBR                       06800003
068100                  ,:INVOIC-INVC-ID                                06810003
068200                  ,:INVOIC-INVC-TYP-CDE                           06820003
068300                  ,:INVOIC-STR-NBR                                06830003
068400                  ,:INVOIC-INVC-DTE                               06840003
068500                  ,:INVOIC-HOLD-IND                               06850003
068600                  ,:INVOIC-ENTR-MTHD-CDE                          06860003
068700                  ,:INVOIC-GRO-COST-AMT                           06870003
068800                  ,:INVOIC-STATUS-CDE                             06880003
068900                  ,:INVOIC-CALC-DUE-DTE                           06890003
069000                  ,:INVOIC-DUE-DTE-SRC-CDE                        06900003
069010                  ,:INVOIC-DC-NBR                                 06901010
069020                  ,:INVOIC-MTCH-LVL-CDE                           06902010
069100                  ,:PURCHS-PO-NBR                                 06910003
069110                  ,:PURCHS-DEPT-NBR                               06911027
069200                  ,:PURCHS-ENT-ID                                 06920003
069300                  ,:PURCHS-STATUS-CDE                             06930003
069400                  ,:MDINVC-TERM-SEL-CDE                           06940003
069500     END-EXEC                                                     06950003
069600                                                                  06960003
069700     EVALUATE TRUE                                                06970003
069800         WHEN SQLCODE = ZERO                                      06980003
069900             ADD 1 TO PW-INPUT-COUNT                              06990003
070000         WHEN SQLCODE = +100                                      07000003
070100             SET END-OF-PROCESSING TO TRUE                        07010003
070200                                                                  07020003
070300         WHEN OTHER                                               07030003
070400             MOVE PW-CURRENT-PARAGRAPH  TO WS-ABEND-PARAGRAPH     07040003
070500             MOVE 'UNSUCCESSFUL FETCH'                            07050003
070600                                        TO WS-ABEND-OPERATION     07060003
070700             MOVE 'TINVOIC'             TO WS-ABEND-STRUCTURE-1   07070003
070800             MOVE 'TPURCHS'             TO WS-ABEND-STRUCTURE-2   07080003
070900             MOVE 'TMDINVC'             TO WS-ABEND-STRUCTURE-3   07090003
071000             PERFORM 9998-DB2-ABEND                               07100003
071100                                                                  07110003
071200     END-EVALUATE.                                                07120003
071210                                                                  07121009
071600/                                                                 07160003
071700 8020-CLOSE-TINVOIC-CURSOR.                                       07170003
071710                                                                  07171035
071800     MOVE '8020-CLOSE-TINVOIC-CURSOR    ' TO PW-CURRENT-PARAGRAPH.07180003
071810                                                                  07181035
071900     EXEC SQL                                                     07190003
072000         CLOSE TINVOIC-CURSOR                                     07200003
072100     END-EXEC.                                                    07210003
072200                                                                  07220003
072300     EVALUATE TRUE                                                07230003
072400         WHEN SQLCODE = ZERO                                      07240003
072500             CONTINUE                                             07250003
072600                                                                  07260003
072700         WHEN OTHER                                               07270003
072800             MOVE PW-CURRENT-PARAGRAPH                            07280003
072900                             TO WS-ABEND-PARAGRAPH                07290003
073000             MOVE 'UNSUCCESSFUL CLOSE '                           07300003
073100                             TO WS-ABEND-OPERATION                07310003
073200             MOVE 'TINVOIC'  TO WS-ABEND-STRUCTURE-1              07320003
073300             MOVE 'TPURCHS'  TO WS-ABEND-STRUCTURE-2              07330003
073400             MOVE 'TMDINVC'  TO WS-ABEND-STRUCTURE-3              07340003
073500             PERFORM 9998-DB2-ABEND                               07350003
073600     END-EVALUATE.                                                07360003
073610                                                                  07361009
073900/                                                                 07390003
074000 8100-READ-TAPCNTL.                                               07400003
074100                                                                  07410003
074200     MOVE '8100-READ-TAPCNTL       ' TO PW-CURRENT-PARAGRAPH.     07420003
074300     INITIALIZE DCLTAPCNTL.                                       07430003
074400                                                                  07440003
074500     PERFORM WITH TEST AFTER                                      07450003
074600             VARYING PW-RETRY-COUNT FROM 1 BY 1                   07460003
074700             UNTIL   PW-RETRY-COUNT > PC-MAX-RETRIES OR           07470003
074800                     SQLCODE = ZERO OR                            07480003
074900                     SQLCODE = +100                               07490003
075000                                                                  07500003
075100             EXEC SQL                                             07510003
075200                 SELECT RECN_CTOFF_DAY_QTY                        07520003
075300                       ,PAYT_FLOAT_DAY_QTY                        07530003
075400                 INTO :APCNTL-RECN-CTOFF-DAY-QTY                  07540003
075500                     ,:APCNTL-PAYT-FLOAT-DAY-QTY                  07550003
075600                 FROM TAPCNTL                                     07560003
075700             END-EXEC                                             07570003
075800                                                                  07580003
075900             EVALUATE TRUE                                        07590003
076000                 WHEN SQLCODE = ZERO                              07600003
076100                 WHEN SQLCODE = -904                              07610003
076200                 WHEN SQLCODE = -913                              07620003
076300                      CONTINUE                                    07630003
076500                 WHEN SQLWARN0 NOT = SPACES                       07650003
076600                 WHEN SQLCODE  NOT = ZERO                         07660003
076700                     MOVE PW-CURRENT-PARAGRAPH                    07670003
076800                                         TO WS-ABEND-PARAGRAPH    07680003
076900                     MOVE 'UNSUCCESSFUL SELECT'                   07690003
077000                                         TO WS-ABEND-OPERATION    07700003
077100                     MOVE 'TAPCNTL'      TO WS-ABEND-STRUCTURE-1  07710003
077200                     MOVE SPACES         TO WS-ABEND-STRUCTURE-2  07720003
077300                                            WS-ABEND-STRUCTURE-3  07730003
077400                     PERFORM 9998-DB2-ABEND                       07740003
077500             END-EVALUATE                                         07750003
077600     END-PERFORM.                                                 07760003
077700                                                                  07770003
077800     IF PW-RETRY-COUNT > PC-MAX-RETRIES                           07780003
077900         MOVE PW-CURRENT-PARAGRAPH       TO WS-ABEND-PARAGRAPH    07790003
078000         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    07800003
078100                                         TO WS-ABEND-OPERATION    07810003
078200         MOVE 'TAPCNTL'                  TO WS-ABEND-STRUCTURE-1  07820003
078300         MOVE SPACES                     TO WS-ABEND-STRUCTURE-2  07830003
078400                                            WS-ABEND-STRUCTURE-3  07840003
078500         PERFORM 9998-DB2-ABEND                                   07850003
078600     END-IF.                                                      07860003
078700                                                                  07870003
078800     EVALUATE TRUE                                                07880003
078900         WHEN SQLCODE = ZEROS                                     07890003
079000              CONTINUE                                            07900003
079100         WHEN OTHER                                               07910003
079200             MOVE PW-CURRENT-PARAGRAPH   TO WS-ABEND-PARAGRAPH    07920003
079300             MOVE 'UNSUCCESSFUL SELECT'                           07930003
079400                                         TO WS-ABEND-OPERATION    07940003
079500             MOVE 'TAPCNTL'              TO WS-ABEND-STRUCTURE-1  07950003
079600             MOVE SPACES                 TO WS-ABEND-STRUCTURE-2  07960003
079700                                            WS-ABEND-STRUCTURE-3  07970003
079800             PERFORM 9998-DB2-ABEND                               07980003
079900     END-EVALUATE.                                                07990003
080100                                                                  08010009
080200/                                                                 08020003
080300**************************************************************** *08030041
080400*     CHECK FOR VALID DUNS NUMBER                                 08040003
080500**************************************************************** *08050041
080600 8200-GET-DUNNSNBR-NAME.                                          08060003
080700     MOVE '8200-GET-DUNNSNBR-NAME   ' TO PW-CURRENT-PARAGRAPH.    08070003
080800     INITIALIZE DCLTEXTENT                                        08080003
080900                DCLTENTNME.                                       08090003
081000                                                                  08100003
081100     PERFORM WITH TEST AFTER                                      08110003
081200             VARYING PW-RETRY-COUNT FROM 1 BY 1                   08120003
081300             UNTIL   PW-RETRY-COUNT > PC-MAX-RETRIES OR           08130003
081400                     SQLCODE = ZERO OR                            08140003
081500                     SQLCODE = +100                               08150003
081600                                                                  08160003
081700             EXEC SQL                                             08170003
081800                 SELECT  DUN_NBR                                  08180003
081900                        ,ENT_NAME_DESC                            08190003
082000                 INTO   :EXTENT-DUN-NBR                           08200003
082100                       ,:ENTNME-ENT-NAME-DESC                     08210003
082200                 FROM    TEXTENT A                                08220003
082300                        ,TENTNME B                                08230003
082400                 WHERE A.ENT_ID = :PURCHS-ENT-ID                  08240003
082500                   AND A.ENT_ID = B.ENT_ID                        08250003
082600                   AND B.TYPE_CDE = '01'                          08260003
082700                   AND B.SEQ_NBR  = 1                             08270003
082800             END-EXEC                                             08280003
082900                                                                  08290003
083000             EVALUATE TRUE                                        08300003
083100                 WHEN SQLCODE = ZERO                              08310003
083200                 WHEN SQLCODE = +100                              08320003
083300                 WHEN SQLCODE = -904                              08330003
083400                 WHEN SQLCODE = -913                              08340003
083500                      CONTINUE                                    08350003
083600                                                                  08360003
083700                 WHEN SQLWARN0 NOT = SPACES                       08370003
083800                 WHEN SQLCODE  NOT = ZERO                         08380003
083900                      MOVE PW-CURRENT-PARAGRAPH                   08390003
084000                                      TO WS-ABEND-PARAGRAPH       08400003
084100                      MOVE 'UNSUCCESSFUL SELECT'                  08410003
084200                                      TO WS-ABEND-OPERATION       08420003
084300                      MOVE 'TEXTENT ' TO WS-ABEND-STRUCTURE-1     08430003
084400                      MOVE 'TENTNME ' TO WS-ABEND-STRUCTURE-2     08440003
084500                      MOVE SPACES     TO WS-ABEND-STRUCTURE-3     08450003
084600                      PERFORM 9998-DB2-ABEND                      08460003
084700             END-EVALUATE                                         08470003
084800     END-PERFORM.                                                 08480003
084900                                                                  08490003
085000     IF PW-RETRY-COUNT > PC-MAX-RETRIES OR                        08500003
085100        SQLCODE NOT = ZEROS                                       08510003
085200         MOVE ZERO                 TO EXTENT-DUN-NBR              08520003
085300         MOVE PC-VENDOR-NOT-FOUND  TO ENTNME-ENT-NAME-DESC        08530003
085400     END-IF.                                                      08540003
085500                                                                  08550003
085800/                                                                 08580003
085900**************************************************************** *08590041
086000*     READ PURCHASE AGREEMENT                                     08600003
086100**************************************************************** *08610041
086200 8400-READ-TPOAGMT.                                               08620003
086300     MOVE '8400-READ-TPOAGMT       ' TO PW-CURRENT-PARAGRAPH.     08630003
086400     INITIALIZE DCLTPOAGMT                                        08640003
086500                DCLTPAYTRM.                                       08650003
086600     PERFORM WITH TEST AFTER                                      08660003
086700         VARYING PW-RETRY-COUNT FROM 1 BY 1                       08670003
086800         UNTIL   PW-RETRY-COUNT > PC-MAX-RETRIES OR               08680003
086900                 SQLCODE = ZERO OR                                08690003
087000                 SQLCODE = +100                                   08700003
087100                                                                  08710003
087200             EXEC SQL                                             08720003
087300                     SELECT  A.DISC_PAY_DAY_QTY                   08730003
087400                            ,A.PAYT_TERM_ID                       08740003
087500                            ,B.DISCOUNT_PCT                       08750003
087600                            ,B.DISCOUNT_DAYS_QTY                  08760003
087700                            ,B.DUE_DAY_FR_DTE_TXT                 08770003
087800                            ,B.DUE_DAY_QTY                        08780003
087900                     INTO    :POAGMT-DISC-PAY-DAY-QTY             08790003
088000                            ,:POAGMT-PAYT-TERM-ID                 08800003
088100                            ,:PAYTRM-DISCOUNT-PCT                 08810003
088200                            ,:PAYTRM-DISCOUNT-DAYS-QTY            08820003
088300                            ,:PAYTRM-DUE-DAY-FR-DTE-TXT           08830003
088400                            ,:PAYTRM-DUE-DAY-QTY                  08840003
088500                     FROM    TPOAGMT A                            08850003
088600                            ,TPAYTRM B                            08860003
088700                     WHERE   PO_NBR = :PURCHS-PO-NBR              08870003
088800                       AND   AGRMT_TYP_ID = '2'                   08880003
088900                       AND   VER_STATUS_CDE = 'A'                 08890003
089000                       AND   A.PAYT_TERM_ID = B.PAY_TERM_ID       08900003
089100             END-EXEC                                             08910003
089200                                                                  08920003
089300             EVALUATE TRUE                                        08930003
089400                 WHEN SQLCODE = ZERO                              08940003
089500                 WHEN SQLCODE = +100                              08950003
089600                 WHEN SQLCODE = -904                              08960003
089700                 WHEN SQLCODE = -913                              08970003
089800                      CONTINUE                                    08980003
089900                                                                  08990003
090000                 WHEN SQLWARN0 NOT = SPACES                       09000003
090100                 WHEN SQLCODE  NOT = ZERO                         09010003
090200                     MOVE PW-CURRENT-PARAGRAPH                    09020003
090300                                     TO WS-ABEND-PARAGRAPH        09030003
090400                     MOVE 'UNSUCCESSFUL SELECT'                   09040003
090500                                     TO WS-ABEND-OPERATION        09050003
090600                     MOVE 'TPOAGMT'  TO WS-ABEND-STRUCTURE-1      09060003
090700                     MOVE 'TPAYTRM'  TO WS-ABEND-STRUCTURE-2      09070003
090800                     MOVE SPACES     TO WS-ABEND-STRUCTURE-3      09080003
090900                     PERFORM 9998-DB2-ABEND                       09090000
091000             END-EVALUATE                                         09100000
091100     END-PERFORM.                                                 09110000
091200                                                                  09120000
091300     IF PW-RETRY-COUNT > PC-MAX-RETRIES                           09130000
091400         MOVE PW-CURRENT-PARAGRAPH       TO WS-ABEND-PARAGRAPH    09140000
091500         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    09150000
091600                                         TO WS-ABEND-OPERATION    09160000
091700         MOVE 'TPOAGMT'                  TO WS-ABEND-STRUCTURE-1  09170000
091800         MOVE 'TPAYTRM'                  TO WS-ABEND-STRUCTURE-2  09180000
091900         MOVE SPACES                     TO WS-ABEND-STRUCTURE-3  09190000
092000         PERFORM 9998-DB2-ABEND                                   09200003
092100     END-IF.                                                      09210003
092200                                                                  09220003
092300     EVALUATE TRUE                                                09230003
092400        WHEN SQLCODE = ZEROS                                      09240003
092500             CONTINUE                                             09250003
092600        WHEN OTHER                                                09260003
092700            MOVE PW-CURRENT-PARAGRAPH                             09270003
092800                            TO WS-ABEND-PARAGRAPH                 09280003
092900            MOVE 'UNSUCCESSFUL SELECT '                           09290003
093000                            TO WS-ABEND-OPERATION                 09300003
093100            MOVE 'TPOAGMT'  TO WS-ABEND-STRUCTURE-1               09310003
093200            MOVE 'TPAYTRM'  TO WS-ABEND-STRUCTURE-2               09320003
093300            MOVE SPACES     TO WS-ABEND-STRUCTURE-3               09330003
093400            PERFORM 9998-DB2-ABEND                                09340003
093500     END-EVALUATE.                                                09350003
093600                                                                  09360003
093700     EXEC SQL                                                     09370003
093800         SELECT  PA.DISC_PAY_DAY_QTY                              09380003
093900           INTO :PV-DISC-EXTENDED-DAYS                            09390003
094000           FROM  TPOAGMT PA                                       09400003
094100          WHERE  PA.PO_NBR         = :PURCHS-PO-NBR               09410003
094200            AND  PA.VER_STATUS_CDE = 'A'                          09420003
094300            AND  PA.AGRMT_TYP_ID   = '5'                          09430003
094400            AND  PA.TYP_CDE        =  1                           09440003
094500     END-EXEC.                                                    09450003
094600                                                                  09460003
094700     EVALUATE TRUE                                                09470003
094800         WHEN SQLCODE = ZERO                                      09480003
094900              ADD PV-DISC-EXTENDED-DAYS TO POAGMT-DISC-PAY-DAY-QTY09490003
095000         WHEN SQLCODE = +100                                      09500003
095100              CONTINUE                                            09510003
095200         WHEN SQLWARN0 NOT = SPACES                               09520003
095300         WHEN SQLCODE  NOT = ZERO                                 09530003
095400             MOVE '8400-READ-TPOAGM'     TO WS-ABEND-PARAGRAPH    09540003
095500             MOVE 'UNSUCCESSFUL SELECT'  TO WS-ABEND-OPERATION    09550003
095600             MOVE 'TPOAGMT'              TO WS-ABEND-STRUCTURE-1  09560003
095700             MOVE SPACES                 TO WS-ABEND-STRUCTURE-2  09570003
095800                                            WS-ABEND-STRUCTURE-3  09580003
095900             PERFORM 9998-DB2-ABEND                               09590003
096000     END-EVALUATE.                                                09600003
096100                                                                  09610003
096400/                                                                 09640003
096500**************************************************************** *09650041
096600*     READ INVOICE PAYMENT TERMS                                  09660003
096700**************************************************************** *09670041
096800 8600-READ-TINVCTM.                                               09680003
096900     MOVE '8600-READ-TINVCTM       ' TO PW-CURRENT-PARAGRAPH.     09690003
097000     INITIALIZE DCLTINVCTM.                                       09700003
097100     PERFORM WITH TEST AFTER                                      09710003
097200         VARYING PW-RETRY-COUNT                                   09720003
097300         FROM 1 BY 1                                              09730003
097400         UNTIL ((PW-RETRY-COUNT > PC-MAX-RETRIES)                 09740003
097500            OR (SQLCODE = +0)                                     09750003
097600            OR (SQLCODE = +100))                                  09760003
097700                                                                  09770003
097800             EXEC SQL                                             09780003
097900                 SELECT  TERM_TYP_CDE                             09790003
098000                        ,DISC_DUE_DAY_QTY                         09800003
098100                        ,EXTD_DAYS_QTY                            09810003
098200                        ,DISC_PCT                                 09820003
098300                        ,NET_DUE_DAY_QTY                          09830003
098400                 INTO    :INVCTM-TERM-TYP-CDE                     09840003
098500                        ,:INVCTM-DISC-DUE-DAY-QTY                 09850003
098600                        ,:INVCTM-EXTD-DAYS-QTY                    09860003
098700                        ,:INVCTM-DISC-PCT                         09870003
098800                        ,:INVCTM-NET-DUE-DAY-QTY                  09880003
098900                 FROM    TINVCTM                                  09890003
099000                 WHERE  PO_NBR       = :PURCHS-PO-NBR             09900003
099100                   AND  INVC_ID      = :INVOIC-INVC-ID            09910003
099200                   AND  TERM_SEQ_NBR = 1                          09920003
099300             END-EXEC                                             09930003
099400                                                                  09940003
099500             EVALUATE TRUE                                        09950003
099600                 WHEN SQLCODE = +0                                09960003
099700                 WHEN SQLCODE = +100                              09970003
099800                 WHEN SQLCODE = -904                              09980003
099900                 WHEN SQLCODE = -913                              09990003
100000                     CONTINUE                                     10000003
100100                                                                  10010003
100200                 WHEN SQLWARN0 NOT = SPACES                       10020003
100300                 WHEN SQLCODE  NOT = ZERO                         10030003
100400                     MOVE PW-CURRENT-PARAGRAPH                    10040003
100500                                     TO WS-ABEND-PARAGRAPH        10050003
100600                     MOVE 'UNSUCCESSFUL SELECT'                   10060003
100700                                     TO WS-ABEND-OPERATION        10070003
100800                     MOVE 'TINVCTM ' TO WS-ABEND-STRUCTURE-1      10080003
100900                     MOVE SPACES     TO WS-ABEND-STRUCTURE-2      10090003
101000                                        WS-ABEND-STRUCTURE-3      10100003
101100                     PERFORM 9998-DB2-ABEND                       10110003
101200             END-EVALUATE                                         10120003
101300     END-PERFORM.                                                 10130003
101400                                                                  10140003
101500     IF  PW-RETRY-COUNT > PC-MAX-RETRIES                          10150003
101600         MOVE PW-CURRENT-PARAGRAPH       TO WS-ABEND-PARAGRAPH    10160003
101700         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    10170003
101800                                         TO WS-ABEND-OPERATION    10180003
101900         MOVE 'TINVCTM'                  TO WS-ABEND-STRUCTURE-1  10190003
102000         MOVE SPACES                     TO WS-ABEND-STRUCTURE-2  10200003
102100                                            WS-ABEND-STRUCTURE-3  10210003
102200         PERFORM 9998-DB2-ABEND                                   10220003
102300     END-IF.                                                      10230003
102400                                                                  10240003
102500     EVALUATE TRUE                                                10250003
102600         WHEN SQLCODE = ZEROS                                     10260003
102700             CONTINUE                                             10270003
102800         WHEN OTHER                                               10280003
102900             MOVE PW-CURRENT-PARAGRAPH                            10290003
103000                             TO WS-ABEND-PARAGRAPH                10300003
103100             MOVE 'UNSUCCESSFUL SELECT '                          10310003
103200                             TO WS-ABEND-OPERATION                10320003
103300             MOVE 'TINVCTM ' TO WS-ABEND-STRUCTURE-1              10330003
103400             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              10340003
103500                                WS-ABEND-STRUCTURE-3              10350003
103600             PERFORM 9998-DB2-ABEND                               10360003
103700     END-EVALUATE.                                                10370003
103900                                                                  10390009
104000/                                                                 10400003
104100 8700-SELECT-RCV-INCOMP-BULK.                                     10410038
104110                                                                  10411033
104200     MOVE '8700-SELECT-RCV-INCOMP-BULK' TO PW-CURRENT-PARAGRAPH.  10420038
104202                                                                  10420233
104210     MOVE +0 TO PV-RCV-INCOMP-COUNT.                              10421038
104220                                                                  10422033
104230     EXEC SQL                                                     10423033
104240         SELECT COUNT(*)                                          10424033
104250           INTO :PV-RCV-INCOMP-COUNT                              10425038
104260           FROM TRECEIV                                           10426033
104270          WHERE ORD_NBR        = :PURCHS-PO-NBR                   10427040
104280            AND STATUS_CDE    ^= 'VE'                             10428033
104290            AND VER_STATUS_CDE = 'A'                              10429033
104291     END-EXEC.                                                    10429133
104292                                                                  10429233
104293     EVALUATE TRUE                                                10429333
104294         WHEN PV-RCV-INCOMP-COUNT = +0                            10429438
104295             MOVE 'N'         TO PS-RCV-INCOMP-IND                10429538
104296         WHEN PV-RCV-INCOMP-COUNT > +0                            10429638
104297             MOVE 'Y'         TO PS-RCV-INCOMP-IND                10429738
104298         WHEN SQLCODE NOT EQUAL ZERO                              10429833
104299             MOVE PW-CURRENT-PARAGRAPH TO WS-ABEND-PARAGRAPH      10429938
104302             MOVE 'UNSUCCESSFUL SELECT TRECEIV'                   10430233
104303                           TO WS-ABEND-OPERATION                  10430333
104304             MOVE 'TRECEIV ' TO WS-ABEND-STRUCTURE-1              10430433
104305             MOVE '        ' TO WS-ABEND-STRUCTURE-2              10430533
104306             PERFORM 9998-DB2-ABEND                               10430638
104307     END-EVALUATE.                                                10430733
106200                                                                  10620009
106300/                                                                 10630003
111510 8800-SELECT-RCV-INCOMP-STORE.                                    11151038
111520                                                                  11152034
111600     MOVE '8800-SELECT-RCV-INCOMP-STORE' TO                       11160038
111700                                           PW-CURRENT-PARAGRAPH.  11170034
112001                                                                  11200134
112002     MOVE +0 TO PV-RCV-INCOMP-COUNT.                              11200238
112003                                                                  11200334
112004     EXEC SQL                                                     11200434
112005         SELECT COUNT(*)                                          11200534
112006           INTO :PV-RCV-INCOMP-COUNT                              11200638
112007           FROM TRECEIV B                                         11200734
112008          WHERE B.ORD_NBR        = :PURCHS-PO-NBR                 11200840
112009            AND B.STATUS_CDE    ^= 'VE'                           11200934
112010            AND B.VER_STATUS_CDE = 'A'                            11201034
112011            AND EXISTS                                            11201137
112012                (SELECT 1 FROM TRECDIS A                          11201234
112014                  WHERE A.STR_NBR = :INVOIC-STR-NBR               11201434
112015                    AND A.VER_STATUS_CDE = 'A'                    11201534
112017                    AND A.ORD_NBR = B.ORD_NBR                     11201734
112018                    AND A.VER_STATUS_CDE = B.VER_STATUS_CDE       11201834
112019                    AND A.REC_SEQ_NBR = B.REC_SEQ_NBR)            11201934
112020     END-EXEC.                                                    11202034
112021                                                                  11202134
112022     EVALUATE TRUE                                                11202234
112023         WHEN PV-RCV-INCOMP-COUNT = +0                            11202338
112024             MOVE 'N'         TO PS-RCV-INCOMP-IND                11202438
112025         WHEN PV-RCV-INCOMP-COUNT > +0                            11202538
112026             MOVE 'Y'         TO PS-RCV-INCOMP-IND                11202638
112027         WHEN SQLCODE NOT EQUAL ZERO                              11202734
112028             MOVE PW-CURRENT-PARAGRAPH TO WS-ABEND-PARAGRAPH      11202838
112029             MOVE '8800-SELECT-RCV-INCOMP-STORE'                  11202938
112030                           TO WS-ABEND-PARAGRAPH                  11203034
112031             MOVE 'UNSUCCESSFUL SELECT TRECEIV'                   11203134
112032                           TO WS-ABEND-OPERATION                  11203234
112033             MOVE 'TRECEIV ' TO WS-ABEND-STRUCTURE-1              11203334
112034             MOVE '        ' TO WS-ABEND-STRUCTURE-2              11203434
112035             PERFORM 9998-DB2-ABEND                               11203538
112040     END-EVALUATE.                                                11204034
113600                                                                  11360009
113700/                                                                 11370003
118910 8830-SELECT-RCV-INCOMP-DC.                                       11891038
118920     MOVE '8830-SELECT-RCV-INCOMP-DC' TO     PW-CURRENT-PARAGRAPH.11892038
118921                                                                  11892135
118922     MOVE +0 TO PV-RCV-INCOMP-COUNT.                              11892238
118923                                                                  11892335
118924     EXEC SQL                                                     11892435
118925         SELECT COUNT(*)                                          11892535
118926           INTO :PV-RCV-INCOMP-COUNT                              11892638
118927           FROM TRECEIV B                                         11892735
118928          WHERE B.ORD_NBR        = :PURCHS-PO-NBR                 11892840
118929            AND B.STATUS_CDE    ^= 'VE'                           11892935
118930            AND B.VER_STATUS_CDE = 'A'                            11893035
118931            AND EXISTS                                            11893137
118932                (SELECT 1 FROM TRECDIS A                          11893235
118933                  WHERE A.OPER_UNT_ID = :INVOIC-DC-NBR            11893335
118934                    AND A.VER_STATUS_CDE = 'A'                    11893435
118935                    AND A.ORD_NBR = B.ORD_NBR                     11893535
118936                    AND A.VER_STATUS_CDE = B.VER_STATUS_CDE       11893635
118937                    AND A.REC_SEQ_NBR = B.REC_SEQ_NBR)            11893735
118938     END-EXEC.                                                    11893835
118939                                                                  11893935
118946     EVALUATE TRUE                                                11894635
118947         WHEN PV-RCV-INCOMP-COUNT = +0                            11894738
118948             MOVE 'N'         TO PS-RCV-INCOMP-IND                11894838
118949         WHEN PV-RCV-INCOMP-COUNT > +0                            11894938
118950             MOVE 'Y'         TO PS-RCV-INCOMP-IND                11895038
118951         WHEN SQLCODE NOT EQUAL ZERO                              11895135
118952             MOVE '8800-SELECT-RCV-INCOMP-STORE'                  11895238
118953                           TO WS-ABEND-PARAGRAPH                  11895335
118954             MOVE 'UNSUCCESSFUL SELECT TRECEIV'                   11895435
118955                           TO WS-ABEND-OPERATION                  11895535
118956             MOVE 'TRECEIV ' TO WS-ABEND-STRUCTURE-1              11895635
118957             MOVE '        ' TO WS-ABEND-STRUCTURE-2              11895735
118958             PERFORM 9998-DB2-ABEND                               11895838
118959     END-EVALUATE.                                                11895935
119070 9000-INIT.                                                       11907021
119100     MOVE '9000-INIT                    ' TO PW-CURRENT-PARAGRAPH.11910003
119200*                                                                 11920003
119300     OPEN OUTPUT OPEN-INVOICE-FILE.                               11930003
119400     MOVE FUNCTION CURRENT-DATE TO PV-CURRENT-DATE.               11940003
119500     MOVE PV-CUR-CC TO PW-CURRENT-CC.                             11950003
119600     MOVE PV-CUR-YY TO PW-CURRENT-YY.                             11960003
119700     MOVE PV-CUR-MM TO PW-CURRENT-MM.                             11970003
119800     MOVE PV-CUR-DD TO PW-CURRENT-DD.                             11980003
119900                                                                  11990003
119910*    GET SEPHORA DATA                                             11991027
119920     MOVE WS-ABEND-PROGRAM     TO SA-PROGRAM-NAME.                11992030
119930     PERFORM S100-GET-SEPHORA-DEPT.                               11993027
119940                                                                  11994027
120000     PERFORM 8100-READ-TAPCNTL.                                   12000009
120100     PERFORM 8000-OPEN-TINVOIC-CURSOR.                            12010009
120200     PERFORM 8010-FETCH-INVOICE.                                  12020009
120300                                                                  12030009
120500/                                                                 12050003
120600 9100-WRITE-EXTRACT.                                              12060003
120700     MOVE '9100-WRITE-EXTRACT           ' TO PW-CURRENT-PARAGRAPH.12070003
120800*                                                                 12080003
120900     WRITE OPEN-INVOICE-REC FROM AP262-INPUT-RECORD.              12090003
121000     INITIALIZE AP262-INPUT-RECORD.                               12100003
121100     ADD 1 TO PW-OUTPUT-COUNT.                                    12110003
121300                                                                  12130009
121400/                                                                 12140003
121500 9900-END-OF-INPUT.                                               12150003
121600     MOVE '9900-END-OF-INPUT            ' TO PW-CURRENT-PARAGRAPH.12160003
121700     DISPLAY '** APKUT255 SUMMARY **'.                            12170003
121800     MOVE PW-OUTPUT-COUNT TO PW-DISPLAY-COUNT.                    12180003
121900     DISPLAY 'TOTAL # OPEN INVOICES EXTRACTED = '                 12190003
122000         PW-DISPLAY-COUNT.                                        12200003
122100     PERFORM 8020-CLOSE-TINVOIC-CURSOR.                           12210009
122200     CLOSE OPEN-INVOICE-FILE.                                     12220003
122400                                                                  12240009
122500/                                                                 12250003
122600**************************************************************** *12260041
122700*     PROCESS DB2 ABENDS                                          12270003
122800**************************************************************** *12280041
122900 9998-DB2-ABEND.                                                  12290003
123000                                                                  12300003
123100     MOVE '9998-DB2-ABEND' TO PW-CURRENT-PARAGRAPH.               12310003
123200                                                                  12320003
123300     DISPLAY '*** PAYT-REQ-SEQ-NBR = ' INVOIC-PAYT-REQ-SEQ-NBR.   12330003
123400     DISPLAY '*** PURCHS-PO-NBR    = ' PURCHS-PO-NBR.             12340003
123500     DISPLAY '*** DB2 ERROR '.                                    12350003
123600     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 12360003
123700     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               12370003
123800     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               12380003
123900     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             12390003
124000     IF WS-ABEND-STRUCTURE-2 > SPACES                             12400003
124100         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         12410003
124200     IF WS-ABEND-STRUCTURE-3 > SPACES                             12420003
124300         DISPLAY '*** TABLE 3   = ' WS-ABEND-STRUCTURE-3.         12430003
124400                                                                  12440003
124500     SET DB2-ERROR TO TRUE.                                       12450003
124600                                                                  12460003
124700     COPY DPPD004.                                                12470009
124800     CALL 'ILBOABN0' USING ABEND-CODE.                            12480003
124900                                                                  12490003
125000**************************************************************** *12500041
125100*    ABEND ROUTINE                                               *12510003
125200**************************************************************** *12520041
125300 9999-ABEND.                                                      12530003
125400                                                                  12540003
125500     MOVE '9999-ABEND' TO PW-CURRENT-PARAGRAPH.                   12550003
125600                                                                  12560003
125700     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 12570003
125800     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               12580003
125900     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               12590003
126000     CALL 'ILBOABN0' USING ABEND-CODE.                            12600003
126100                                                                  12610003
126200*--------------------------------------------------------------*  12620027
126300* COPYBOOK FOR SEPHORA PROCESSES                               *  12630027
126400*--------------------------------------------------------------*  12640027
126500     COPY APPD021.                                                12650027
126600                                                                  12660027
