000100*-----------------------*                                         00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000210*-----------------------*                                         00021002
000220 PROGRAM-ID.    SUKCS797.                                         00022002
000230 AUTHOR.        OMAN.                                             00023002
000240 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00024002
000250 DATE-WRITTEN.  OCTOBER 2008.                                     00025002
000260 DATE-COMPILED.                                                   00026002
000270                                                                  00027002
000280*---------------------------------------------------------------* 00028002
000290* 12/23 OMAN  ADDED PERFORM OF 2050-DELETE-LIST-QUEUE TO BOTH   * 00028156
000290*             F20 AND F19 LOGIC.                                * 00028256
000290*                                                               * 00028347
000290* 12/09 OMAN  ADDED MOVE OF SU087-SCAC AND TRAILER TO ASC-      * 00028456
000290*             FIELDS.                                           * 00028556
000290*                                                               * 00028656
263968*---------------------------------------------------------------* 00028767
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00028867
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00028967
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00029067
001130*                                                                 00029168
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00029268
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00029368
263968*---------------------------------------------------------------* 00029467
000290*                                                               * 00029556
000280*---------------------------------------------------------------* 00029656
000290*    S797 - PRINT AND APPLY ASSOCIATE HISTORY LIST              * 00029756
000300*---------------------------------------------------------------* 00030002
000400 ENVIRONMENT DIVISION.                                            00040002
000500 DATA DIVISION.                                                   00050002
000600                                                                  00060002
000700 WORKING-STORAGE SECTION.                                         00070002
000800                                                                  00080002
000900 01  DK-DB2-KEYS.                                                 00090002
001000     05  DK-OPER-UNT-ID            PIC S9(04) COMP VALUE +0.      00100002
001010     05  DK-ACM-LBL-STA-NBR        PIC S9(09) COMP VALUE +0.      00101045
001020     05  DK-TRIP-ID                PIC S9(09) COMP VALUE +0.      00102005
001200     05  DK-DOOR-ID                PIC X(04)      VALUE SPACES.   00120002
001300     05  DK-ASGD-STRT-TMST         PIC X(26)      VALUE SPACES.   00130005
001700                                                                  00170002
001800 01  PC-PROGRAM-CONSTANTS.                                        00180002
001900     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'SUK797  '.  00190002
002000     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'SUKM797 '.  00200002
002100     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'SUKCS797'.  00210002
002200     05  PC-APPL-MAP               PIC S9(04)  VALUE  +1          00220002
002300                                                     COMP.        00230002
002400     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00240002
002500     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00250002
002600     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00260002
002700     05  PC-DETAIL-SCREEN          PIC  X(01)  VALUE '2'.         00270002
002800     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +10          00280023
002900                                               COMP SYNC.         00290002
003000     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00300002
003100                                               COMP SYNC.         00310002
003200     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00320002
003300                                               COMP-3.            00330002
003400     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00340002
003500                                               COMP SYNC.         00350002
003600     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00360002
003700                                               COMP-3.            00370002
003800     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00380002
003900     05  PC-ADD                    PIC  X(03)  VALUE 'ADD'.       00390002
004000     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00400002
004100     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00410002
004200     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00420002
004201     05  PC-DOOR                   PIC  X(04)  VALUE 'DOOR'.      00420102
004202     05  PC-STORE                  PIC  X(05)  VALUE 'STORE'.     00420202
004203     05  PC-01                     PIC  X(02)  VALUE '01'.        00420302
004204     05  PC-A                      PIC  X(01)  VALUE 'A'.         00420402
004205     05  PC-I                      PIC  X(01)  VALUE 'I'.         00420537
004206     05  PC-D                      PIC  X(01)  VALUE 'D'.         00420637
004207     05  PC-S                      PIC  X(01)  VALUE 'S'.         00420737
004208     05  PC-N                      PIC  X(01)  VALUE 'N'.         00420837
004209     05  PC-Y                      PIC  X(01)  VALUE 'Y'.         00420937
004210     05  PC-U                      PIC  X(01)  VALUE 'U'.         00421037
004211     05  PC-MULTI                  PIC  X(05)  VALUE 'MULTI'.     00421137
004212     05  PC-DEFAULT-TMST          PIC  X(26)                      00421241
004213                          VALUE  '9999-09-09-09.09.09.999999'.    00421337
004220                                                                  00422002
004230*----------------------------------------------------------------*00423002
004240*  SYSTEM MESSAGES                                               *00424002
004250*----------------------------------------------------------------*00425002
004260*   00005 = INVALID VALUE                                        *00426002
004270*   00008 = MUST BE NUMERIC                                      *00427002
004280*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00428002
004290*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00429002
004300*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00430002
004400*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00440002
004500*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00450002
004600*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00460002
004700*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00470002
004800*   00069 - TOP OF LIST                                          *00480002
004900*   00070 - BOTTOM OF LIST                                       *00490002
005000*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00500002
005100*   00279 - MORE ITEMS TO DISPLAY                                *00510002
005200*   02571 - UNABLE TO UPD - CURRENT OPER UNT AND OPER UNIT ID ENTE00520002
005300*   02575 - STORE ASSIGNMNT FUNCTION ONLY VALID FOR DOOR TYPES SHI00530002
005400*----------------------------------------------------------------*00540002
005500     05  PC-TSYMSG-NUMBERS.                                       00550002
005600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00560002
005700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00570002
005800         10  PC-TSYMSG-00045            PIC  9(05)  VALUE 00045.  00580026
005810         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00581026
005900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00590002
006000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00600002
006100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00610002
006200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00620002
006300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00630002
006400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00640002
006500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00650002
006600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00660002
006700         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00670002
006800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00680002
006900         10  PC-TSYMSG-02571            PIC  9(05)  VALUE 02571.  00690002
007000         10  PC-TSYMSG-02575            PIC  9(05)  VALUE 02575.  00700002
007100*                                                                 00710002
007200 01  PS-PROGRAM-SWITCHES.                                         00720002
007300     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00730002
007400         88  PS-NO-ERROR                            VALUE 'Y'.    00740002
007500         88  PS-ERROR                               VALUE 'N'.    00750002
007600     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    00760002
007700         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    00770002
007800         88  PS-BLOCK-ERROR                         VALUE 'N'.    00780002
007900     05  PS-CONFIRM-PROCESSING-IND      PIC  X(01)  VALUE  'N'.   00790002
008000         88  PS-CONFIRM-PROCESSING                  VALUE  'Y'.   00800002
008100         88  PS-NOT-CONFIRM-PROCESSING              VALUE  'N'.   00810002
008200     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE 'N'.    00820002
008300         88  PS-SOFT-ABORT-ERROR                    VALUE 'Y'.    00830002
008400         88  PS-NO-SOFT-ABORT-ERROR                 VALUE 'N'.    00840002
008500     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00850002
008600         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00860002
008700         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00870002
008800     05  PS-LIST-END-SW                 PIC  X(01)  VALUE 'N'.    00880002
008900         88  PS-LIST-END                            VALUE 'Y'.    00890002
009000         88  PS-NO-LIST-END                         VALUE 'N'.    00900002
009100*                                                                 00910002
009200 01  PV-PROGRAM-VARIABLES.                                        00920002
009300     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  00930002
009400                                        COMP SYNC.                00940002
009500     05  PV-SUB                         PIC S9(04)  VALUE +0      00950002
009600                                                    COMP SYNC.    00960002
009700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00970002
009800                                                    COMP SYNC.    00980002
009900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00990002
010000                                                    COMP-3.       01000002
010100     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01010002
010200                                                    COMP-3.       01020002
010300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01030002
010400                                                    COMP-3.       01040002
010500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01050002
010600                                                    COMP-3.       01060002
010700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01070002
010800                                                    COMP-3.       01080002
010900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01090002
011000                                                    COMP-3.       01100002
011100     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01110002
011200                                                    COMP-3.       01120002
011300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01130002
011400                                                    COMP SYNC.    01140002
011500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01150002
011600                                                    COMP SYNC.    01160002
011700     05  PV-ITEM                        PIC S9(04)  VALUE +0      01170002
011800                                                    COMP SYNC.    01180002
011900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01190002
012000                                                    COMP SYNC.    01200002
012100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01210002
012200                                                    COMP SYNC.    01220002
012300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01230002
012400                                                    COMP SYNC.    01240002
012500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01250002
012600                                                    COMP SYNC.    01260002
012700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01270002
012800                                                    COMP SYNC.    01280002
012900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01290002
013000                                                    COMP SYNC.    01300002
013100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01310002
013200                                                    COMP SYNC.    01320002
013300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01330002
013400                                                    COMP SYNC.    01340002
013500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01350002
013600                                                    COMP SYNC.    01360002
013700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01370002
013800                                                    COMP SYNC.    01380002
013900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01390002
014000                                                    COMP SYNC.    01400002
014100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01410002
014200                                                    COMP SYNC.    01420002
014300     05  PV-SOFT-ABORT-MSG.                                       01430002
014400         10  FILLER            PIC X(12) VALUE ' SUKCS797 - '.    01440002
014500         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       01450002
014600         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    01460002
014700         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    01470002
014800         10  PV-SOFT-PARAGRAPH PIC X(30).                         01480002
014900     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01490002
015000                                                     COMP SYNC.   01500002
015100     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 01510002
015200     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 01520002
015300     05  PV-CICS-MSG-HOLD.                                        01530002
015400         10  FILLER                      PIC  X(01)  VALUE SPACE. 01540002
015500         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 01550002
015600     05  PV-CICS-MSG-HOLD2.                                       01560002
015700         10  FILLER                      PIC  X(01)  VALUE SPACE. 01570002
015800         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 01580002
015900                                                                  01590002
016000     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01600002
016100                                                     COMP SYNC.   01610002
016200     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01620002
016300     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01630002
016400     05  PV-CASE-NBR                     PIC  X(10).              01640002
016500     05  PV-UNION-TYPE                   PIC  X(01) VALUE SPACE.  01650002
016600                                                                  01660002
016700******************************************************************01670002
016800**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01680002
016900**  THIS MUST BE THE EXACT SAME FORMAT AS BLOCK IN THE          **01690002
017000**  APPLICATION-SPECIFIC COMMAREA.                              **01700002
017100******************************************************************01710002
017200 01  LQW-LIST-QUEUE-WORK-AREA.                                    01720002
017300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01730002
017400     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           01740003
017500                                        INDEXED BY LQW-IDX.       01750002
017600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01760002
017700         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01770002
017800         10  LQW-SELECTED-SW            PIC  X(01).               01780002
017900             88  LQW-SELECT                         VALUE 'S'.    01790002
018000             88  LQW-DESELECT                       VALUE ' '.    01800002
018100         10  LQW-ACTION                 PIC  X(03).               01810002
018200             88  LQW-ADD                            VALUE 'ADD'.  01820002
018300             88  LQW-INQ                            VALUE 'INQ'.  01830002
018400             88  LQW-UPD                            VALUE 'UPD'.  01840002
018500             88  LQW-ERR                            VALUE 'ERR'.  01850002
018600         10  LQW-TK-TP-ASSIGNED         PIC  X(08).               01860004
018610         10  LQW-ACTV-IND               PIC  X(01).               01861004
018620         10  LQW-LOGIN-TMST             PIC  X(26).               01862050
018620         10  LQW-LOGOUT-TMST            PIC  X(26).               01862150
018650                                                                  01865002
018660*---------------------------------------------------------------* 01866002
018670* SELECTION QUEUE LAYOUT                                        * 01867002
018680*---------------------------------------------------------------* 01868002
018690     COPY SUWS088.                                                01869002
018700                                                                  01870002
018800*---------------------------------------------------------------* 01880002
018900*    MAP LAYOUT                                                 * 01890002
019000*---------------------------------------------------------------* 01900002
019100     COPY SUKM797.                                                01910002
019200*                                                                 01920002
019300 01  MR-OCCURS-LAYOUT                   REDEFINES  SUK797O.       01930002
019400     05  FILLER                         PIC X(141).               01940059
019500     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          01950003
020100                                                                  02010002
020200         10  MR-TK-TP-ASSIGNEDL         PIC S9(04) COMP.          02020004
020300         10  MR-TK-TP-ASSIGNEDA         PIC  X(01).               02030004
020400         10  MR-TK-TP-ASSIGNEDC         PIC  X(01).               02040004
020500         10  MR-TK-TP-ASSIGNEDH         PIC  X(01).               02050004
020600         10  MR-TK-TP-ASSIGNED          PIC  X(08).               02060004
020700                                                                  02070002
020800         10  MR-ACTV-INDL              PIC S9(04) COMP.           02080004
020900         10  MR-ACTV-INDA              PIC  X(01).                02090004
021000         10  MR-ACTV-INDC              PIC  X(01).                02100004
021100         10  MR-ACTV-INDH              PIC  X(01).                02110004
021200         10  MR-ACTV-IND               PIC  X(01).                02120004
022500                                                                  02250002
022600         10  MR-LOGIN-DATEL            PIC S9(04) COMP.           02260004
022700         10  MR-LOGIN-DATEA            PIC  X(01).                02270004
022800         10  MR-LOGIN-DATEC            PIC  X(01).                02280004
022900         10  MR-LOGIN-DATEH            PIC  X(01).                02290004
023000         10  MR-LOGIN-DATE             PIC  X(08).                02300004
023100                                                                  02310002
023200         10  MR-LOGIN-TIMEL            PIC S9(04) COMP.           02320004
023300         10  MR-LOGIN-TIMEA            PIC  X(01).                02330004
023400         10  MR-LOGIN-TIMEC            PIC  X(01).                02340004
023500         10  MR-LOGIN-TIMEH            PIC  X(01).                02350004
023600         10  MR-LOGIN-TIME             PIC  X(08).                02360004
023610                                                                  02361004
023620         10  MR-LOGOUT-DATEL           PIC S9(04) COMP.           02362004
023630         10  MR-LOGOUT-DATEA           PIC  X(01).                02363004
023640         10  MR-LOGOUT-DATEC           PIC  X(01).                02364004
023650         10  MR-LOGOUT-DATEH           PIC  X(01).                02365004
023660         10  MR-LOGOUT-DATE            PIC  X(08).                02366004
023670                                                                  02367004
023680         10  MR-LOGOUT-TIMEL           PIC S9(04) COMP.           02368004
023690         10  MR-LOGOUT-TIMEA           PIC  X(01).                02369004
023691         10  MR-LOGOUT-TIMEC           PIC  X(01).                02369104
023692         10  MR-LOGOUT-TIMEH           PIC  X(01).                02369204
023693         10  MR-LOGOUT-TIME            PIC  X(08).                02369304
023700                                                                  02370002
023800     05  FILLER                         PIC  X(12).               02380002
023900                                                                  02390002
024000*----------------------------------------------------------------*02400002
024100*  SENDING/RECEIVING AREA FOR THE                                 02410002
024200*  PRINTER VALIDATION ROUTING (DPKCS060)                          02420002
024300*----------------------------------------------------------------*02430002
024400     COPY DPWS072.                                                02440002
024500                                                                  02450002
024600*---------------------------------------------------------------* 02460002
024700*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02470002
024710*---------------------------------------------------------------* 02471002
024720     COPY DPWS015.                                                02472002
024730                                                                  02473002
024740*---------------------------------------------------------------* 02474002
024750*    FUNCTION KEYS COPYBOOK.                                    * 02475002
024760*---------------------------------------------------------------* 02476002
024770     COPY DPWS016.                                                02477002
024780                                                                  02478002
024790*---------------------------------------------------------------* 02479002
024800*    NUMERIC EDIT LAYOUT.                                       * 02480002
024900*---------------------------------------------------------------* 02490002
025000     COPY DPWS010I.                                               02500002
025100                                                                  02510002
025200*---------------------------------------------------------------* 02520002
025300*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 02530068
025400*---------------------------------------------------------------* 02540002
025500     COPY DPWS030.                                                02550002
025500     COPY DPWS930.                                                02551068
025600                                                                  02560002
025700*---------------------------------------------------------------* 02570002
025800*    STANDARD COMMAREA.                                         * 02580002
025900*---------------------------------------------------------------* 02590002
026000     COPY DPWS020.                                                02600002
026100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02610002
026200                                                                  02620002
026300*---------------------------------------------------------------* 02630002
026400* INTER-APPLICATION COMMAREA.                                   * 02640002
026500*   SUWS087 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02650002
026600*             SPEC SCREEN.                                      * 02660002
026700*   SUWS089 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02670002
026800*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02680002
026900*---------------------------------------------------------------* 02690002
027000         10  INTER-APPL-COMM-AREA       PIC X(200).               02700002
027100     COPY SUWS087.                                                02710002
027200     COPY SUWS089.                                                02720002
027300                                                                  02730002
027400*---------------------------------------------------------------* 02740002
027500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02750002
027600*---------------------------------------------------------------* 02760002
027700         10  ASC-SPECIFIC-COMMAREA.                               02770002
027800             15  ASC-FUNCTION                 PIC  X(01).         02780002
027900             15  ASC-OPER-UNT-ID              PIC  9(04).         02790002
028000             15  ASC-FCLTY-NAME               PIC  X(25).         02800002
028110             15  ASC-PNA-STA-NBR              PIC  9(04).         02811010
028111             15  ASC-SCAC                     PIC  X(04).         02811110
028112             15  ASC-TRAILER                  PIC  X(10).         02811210
028113             15  ASC-TRIP-ID                  PIC  9(09).         02811310
028114             15  ASC-ASSIGN-TMST              PIC  X(26).         02811431
028130             15  ASC-DOOR-ID                  PIC  X(04).         02813010
028200             15  ASC-COUNT                    PIC S9(09) COMP.    02820002
028300             15  ASC-BLK-SUB                  PIC S9(04) COMP     02830002
028400                                                         SYNC.    02840002
028500             15  ASC-ITEM-SUB                 PIC S9(04) COMP     02850002
028600                                                         SYNC.    02860002
028700             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  02870002
028800             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  02880002
028900             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  02890002
029000             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  02900002
029100             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  02910002
029200             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     02920002
029300                                                         SYNC.    02930002
029400             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  02940002
029500             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  02950002
029600             15  ASC-XCNTL-TO-RESEND-SW       PIC  X(01).         02960002
029700                 88  ASC-XCNTL-TO-RESEND           VALUE 'Y'.     02970002
029800                 88  ASC-XCNTL-TO-RESEND-NO        VALUE 'N'.     02980002
029900             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         02990002
030000                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03000002
030100                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03010002
030200             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         03020002
030300                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03030002
030400                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03040002
030500             15  ASC-LIST-QUEUE-NAME.                             03050002
030600                 20  ASC-LIST-TERM-ID         PIC  X(04).         03060002
030700                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  03070002
030800                 20  ASC-LIST-SEQ             PIC  9(01).         03080002
030900                                                                  03090002
031000             15  ASC-START-ITEM-REQUEST.                          03100002
031100                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         03110002
031200                                                                  03120002
031300             15  ASC-SEL-SUB                  PIC S9(4) COMP.     03130002
031400             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     03140002
031500             15  ASC-CURSOR-SW                PIC  X(02).         03150002
031600                 88  ASC-NO-CURSOR                   VALUE 'Z '.  03160002
031700                 88  ASC-TK-HISTORY-CSR              VALUE 'A '.  03170006
031800             15  ASC-STORE-SW                 PIC  X(01).         03180002
031900                 88  ASC-LIST-BY-STORE               VALUE 'S'.   03190002
032000                 88  ASC-LIST-BY-DOOR                VALUE 'D'.   03200002
032100                                                                  03210002
032200             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          03220002
032300                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03230002
032400             15  ASC-SEL-QUEUE-NAME.                              03240002
032500                 20  ASC-SEL-TERM-ID          PIC  X(04).         03250002
032600                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  03260002
032700                 20  ASC-SEL-SEQ              PIC  9(01).         03270002
032800                                                                  03280002
032900             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  03290002
033000                                                                  03300002
033100*-----------------------------------------------------------------03310002
033200             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03320002
033300                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03330002
033400                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03340002
033500                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03350002
033600                                                                  03360002
033700                 20  ASC-ITEM-ARRAY.                              03370002
033800                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        03380003
033900                         30  ASC-LIST-ITEM-NUMBER                 03390002
034000                                                     PIC S9(09)   03400002
034100                                                     COMP-3.      03410002
034200                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03420002
034300                             88  ASC-VALID-SELECT    VALUE ' '    03430002
034400                                                           'S'    03440002
034500                                                           'B'    03450002
034600                                                           'E'.   03460002
034700                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03470002
034800                             88  ASC-TEMP-SELECT     VALUE 'S'.   03480002
034900                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03490002
035000                             88  ASC-TEMP-END        VALUE 'E'.   03500002
035100                         30  ASC-SELECTED-SW         PIC  X(01).  03510002
035200                             88  ASC-NO-SELECT       VALUE ' '.   03520002
035300                             88  ASC-SELECT          VALUE 'S'.   03530002
035400                             88  ASC-BEGIN           VALUE 'B'.   03540002
035500                             88  ASC-END             VALUE 'E'.   03550002
035600                         30  ASC-TK-TP-NBR           PIC  X(08).  03560004
035700                         30  ASC-ACTV-IND            PIC  X(01).  03570004
036000                         30  ASC-LOGIN-TMST          PIC  X(26).  03600048
036000                         30  ASC-LOGOUT-TMST         PIC  X(26).  03600148
036200                                                                  03620002
036300*---------------------------------------------------------------* 03630002
036400*    ABEND PROCESSING COPYBOOK.                                 * 03640002
036500*---------------------------------------------------------------* 03650002
036600     COPY DPWS013.                                                03660002
036700                                                                  03670002
036800*----------------------------------------------------------------*03680002
036900*    DB2 TABLE FOR PRINT AND APPLY STATION WORKER                 03690005
037000*----------------------------------------------------------------*03700002
037100     EXEC SQL                                                     03710002
037200          INCLUDE SUT00111                                        03720005
037300     END-EXEC.                                                    03730002
038900                                                                  03890002
039000*---------------------------------------------------------------* 03900002
039100*    TK HISTORY CURSOR                                            03910005
039200*---------------------------------------------------------------* 03920002
039300     EXEC SQL                                                     03930005
039400        DECLARE TK-HISTORY-CSR CURSOR FOR                         03940005
039500         SELECT                                                   03950005
039600                 S111.WRKR_USR_ID                                 03960010
039700                ,S111.WRKR_STRT_TMST                              03970010
039800                ,S111.WRKR_END_TMST                               03980010
040000                                                                  04000005
040100           FROM  SUT_PNA_STA_WRKR  S111                           04010010
040200          WHERE  OPER_UNT_ID      = :DK-OPER-UNT-ID               04020005
040300            AND  ACM_LBL_STA_NBR  = :DK-ACM-LBL-STA-NBR           04030005
040310            AND  DOOR_ID          = :DK-DOOR-ID                   04031007
040320            AND  INBD_TRIP_ID     = :DK-TRIP-ID                   04032005
040330***GB       AND  ASGD_STRT_TMST   = :DK-ASGD-STRT-TMST            04033046
040400     END-EXEC                                                     04040005
040500                                                                  04050005
042066                                                                  04206602
042067*---------------------------------------------------------------* 04206702
042068*    DB2 AREA FOR COMMUNICATIONS                                * 04206802
042069*---------------------------------------------------------------* 04206902
042070     EXEC SQL                                                     04207002
042080          INCLUDE SQLCA                                           04208002
042090     END-EXEC.                                                    04209002
042100                                                                  04210002
042200***************************************************************** 04220002
042300 LINKAGE SECTION.                                                 04230002
042400                                                                  04240002
042500 01  DFHCOMMAREA.                                                 04250002
042600     05  FILLER                         OCCURS  1 TO 4072 TIMES   04260002
042700                                        DEPENDING ON EIBCALEN.    04270002
042800         10  FILLER                     PIC X.                    04280002
042900                                                                  04290002
043000                                                                  04300002
043100 PROCEDURE DIVISION.                                              04310002
043200******************************************************************04320002
043210**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04321002
043220**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04322002
043230**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04323002
043240******************************************************************04324002
043250 0000-MAIN-MODULE.                                                04325002
043260     INITIALIZE DP030-CICS-API-FIELDS.                            04326002
043270     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04327002
043280     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04328002
043290     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04329002
043300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04330002
043400     MOVE LENGTH OF SUK797I        TO DP030-MAP-LENGTH (1).       04340002
043500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04350002
043600     PERFORM 0001-CALL-CICS-ARCH-API.                             04360002
043700*                                                                 04370002
043800     PERFORM 1000-CONTROL-PROCESSING                              04380002
043900*                                                                 04390002
044000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04400002
044100     PERFORM 0001-CALL-CICS-ARCH-API.                             04410002
044200                                                                  04420002
044300******************************************************************04430002
044400**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04440002
044500**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04450002
044600******************************************************************04460002
044700 0001-CALL-CICS-ARCH-API.                                         04470002
044800*    CALL 'DPKCS030' USING DFHEIBLK                               04480068
044800     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04481068
044900                           DFHCOMMAREA                            04490002
045000                           DP030-CICS-API-FIELDS                  04500002
045100                           DP020-STANDARD-COMMAREA                04510002
045200                           SUK797I.                               04520002
045300*                                                                 04530002
045400     IF  DP030-RC-CALL-SUCCESSFUL                                 04540002
045500         CONTINUE                                                 04550002
045600     ELSE                                                         04560002
045700         SET DP013-NO-ROLLBACK                                    04570002
045800             DP013-XCTL-DISPLAY-RESTART                           04580002
045900             DP013-CICS-ABEND      TO TRUE                        04590002
046000         MOVE '0001-CALL-CICS-ARCH-API'                           04600002
046100                                   TO DP013-PARAGRAPH             04610002
046200*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX04620068
046300*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      04630068
046200         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04631068
046300-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04632068
046400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04640002
046500         PERFORM DP013-0000-PROCESS-ABEND                         04650002
046600     END-IF.                                                      04660002
046700                                                                  04670002
046800*----------------------------------------------------------------*04680002
046900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04690002
047000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04700002
047100*                                                                *04710002
047200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04720002
047300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04730002
047400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04740002
047500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04750002
047600*----------------------------------------------------------------*04760002
047700 1000-CONTROL-PROCESSING.                                         04770002
047800     EVALUATE TRUE                                                04780002
047900         WHEN DP020-NEXT-ACT-INITIAL                              04790002
048000             INITIALIZE ASC-SPECIFIC-COMMAREA                     04800002
048100             MOVE EIBTRMID    TO ASC-LIST-TERM-ID                 04810002
048200                                 ASC-SEL-TERM-ID                  04820002
048300             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   04830002
048400                                           ASC-SEL-TASK-NUMBER    04840002
048500             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               04850002
048600             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                04860002
048700             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04870002
049000             PERFORM 4000-BUILD-INITIAL-PANEL                     04900002
049100                                                                  04910002
049200         WHEN DP020-NEXT-ACT-READ-MAP                             04920002
049300             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         04930002
049400             PERFORM 2000-PROCESS-PANEL                           04940002
049500                                                                  04950002
049600         WHEN DP020-NEXT-ACT-RETURN                               04960002
049700             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         04970002
049800             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               04980002
049900             MOVE SPACES               TO  DK-DOOR-ID             04990002
050100             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05010002
050200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05020002
050300                                                                  05030002
050400         WHEN OTHER                                               05040002
050500             SET DP013-LOGIC-ABEND TO TRUE                        05050002
050600             SET DP013-NO-ROLLBACK TO TRUE                        05060002
050700             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    05070002
050800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05080002
050900                                   TO DP013-MESSAGE-TEXT(1)       05090002
051000             PERFORM DP013-0000-PROCESS-ABEND                     05100002
051100     END-EVALUATE.                                                05110002
051200                                                                  05120002
051910******************************************************************05191009
051920** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **05192009
051930** INTER-APPLICATION FORMAT CODE.                               **05193009
051940******************************************************************05194009
051950 1100-PROCESS-INTER-APPL-COMM.                                    05195009
051970                                                                  05197009
051971                                                                  05197138
051972     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          05197238
051973         MOVE SU087-OPER-UNT-ID    TO ASC-OPER-UNT-ID             05197342
051974         MOVE SU087-FCLTY-NME      TO ASC-FCLTY-NAME              05197442
051975         MOVE SU087-PNA-STA-NBR    TO ASC-PNA-STA-NBR             05197542
051976         MOVE SU087-DOOR-ID        TO ASC-DOOR-ID                 05197642
051990         MOVE SU087-TRIP-ID        TO ASC-TRIP-ID                 05199042
051990         MOVE SU087-SCAC           TO ASC-SCAC                    05199147
051990         MOVE SU087-TRAILER        TO ASC-TRAILER                 05199247
051995         MOVE SU087-ASGD-STRT-TMST TO ASC-ASSIGN-TMST             05199543
051997     ELSE                                                         05199738
051998        IF SU089-NUMBER-OF-SELECTED-ITEMS > 0                     05199838
051999           SET ASC-USE-SELECTION-QUEUE TO TRUE                    05199938
052000           MOVE SU089-NUMBER-OF-SELECTED-ITEMS                    05200038
052001                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  05200138
052002           MOVE SU089-NUMBER-OF-TS-ITEMS                          05200238
052003                                 TO ASC-NUMBER-OF-TS-ITEMS        05200338
052004           MOVE SU089-SEL-QUEUE-NAME                              05200438
052005                                 TO ASC-SEL-QUEUE-NAME            05200538
052006           MOVE SU089-OPER-UNT-ID      TO ASC-OPER-UNT-ID         05200638
052007           MOVE SU089-FCLTY-NME        TO ASC-FCLTY-NAME          05200738
052008           MOVE SU089-PNA-STA-NBR      TO ASC-PNA-STA-NBR         05200838
052009           PERFORM 1120-PREPARE-LIST-ENTRY.                       05200938
052010                                                                  05201009
052011                                                                  05201109
052012*----------------------------------------------------------------*05201209
052013* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *05201309
052014* STORAGE QUEUE PASSED FROM THE LIST.                            *05201409
052015*----------------------------------------------------------------*05201509
052016 1120-PREPARE-LIST-ENTRY.                                         05201609
052017     MOVE SU088-MAX-ITEMS          TO ASC-SEL-SUB.                05201709
052018     MOVE ZERO                     TO ASC-SEL-ITEM.               05201809
052019     PERFORM 1130-GET-NEXT-RECORD.                                05201909
052020                                                                  05202009
052021*---------------------------------------------------------------- 05202109
052022*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*05202209
052023*---------------------------------------------------------------- 05202309
052024 1130-GET-NEXT-RECORD.                                            05202409
052025     ADD +1                        TO ASC-SEL-SUB.                05202509
052026                                                                  05202609
052027     SET ASC-UPDATE-TSQ TO TRUE.                                  05202709
052028                                                                  05202809
052029     IF  ASC-SEL-SUB > SU088-MAX-ITEMS                            05202909
052030         ADD +1                    TO ASC-SEL-ITEM                05203009
052031         MOVE +1                   TO ASC-SEL-SUB                 05203109
052032     END-IF.                                                      05203209
052033                                                                  05203309
052034     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                05203409
052035         PERFORM 9100-READ-SEL-QUEUE                              05203509
052036         IF  SU088-ITEM (ASC-SEL-SUB) > ZERO                      05203609
052037             PERFORM 1160-MOVE-TO-ASC                             05203709
052038             SET SU088-INQ (ASC-SEL-SUB) TO TRUE                  05203809
052039             PERFORM 9200-REWRITE-SEL-QUEUE                       05203909
052040         ELSE                                                     05204009
052041             SUBTRACT +1 FROM ASC-SEL-SUB                         05204109
052042             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            05204209
052043             SET DP020-MSG-INFORMATIONAL                          05204309
052044                 PS-LIST-END       TO TRUE                        05204409
052045         END-IF                                                   05204509
052046     ELSE                                                         05204609
052047         SUBTRACT +1 FROM ASC-SEL-ITEM                            05204709
052048         MOVE SU088-MAX-ITEMS      TO ASC-SEL-SUB                 05204809
052049         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            05204909
052050         SET DP020-MSG-INFORMATIONAL                              05205009
052051                 PS-LIST-END       TO TRUE                        05205109
052052     END-IF.                                                      05205209
052053                                                                  05205309
052054******************************************************************05205409
052055*  GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING         05205509
052056*  PROCESSED.                                                     05205609
052057******************************************************************05205709
052058 1140-GET-PREV-RECORD.                                            05205809
052059     SUBTRACT +1 FROM ASC-SEL-SUB.                                05205909
052060                                                                  05206009
052061     IF  ASC-SEL-SUB < +1                                         05206109
052062         SUBTRACT +1 FROM ASC-SEL-ITEM                            05206209
052063         MOVE SU088-MAX-ITEMS      TO ASC-SEL-SUB                 05206309
052064     END-IF.                                                      05206409
052065                                                                  05206509
052066     IF  ASC-SEL-ITEM > ZERO                                      05206609
052067         PERFORM 9100-READ-SEL-QUEUE                              05206709
052068         IF  SU088-ITEM (ASC-SEL-SUB) > ZERO                      05206809
052069             PERFORM 1160-MOVE-TO-ASC                             05206909
052070         END-IF                                                   05207009
052071                                                                  05207109
052072         SET SU088-INQ (ASC-SEL-SUB) TO TRUE                      05207209
052073         PERFORM 9200-REWRITE-SEL-QUEUE                           05207309
052074     ELSE                                                         05207409
052075         MOVE +1                   TO ASC-SEL-ITEM                05207509
052076                                      ASC-SEL-SUB                 05207609
052077         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            05207709
052078         SET DP020-MSG-INFORMATIONAL                              05207809
052079             PS-LIST-END             TO TRUE                      05207909
052080     END-IF.                                                      05208009
052081                                                                  05208109
052082 1160-MOVE-TO-ASC.                                                05208209
052083                                                                  05208309
052085     MOVE SU088-DOOR-ID  (ASC-SEL-SUB)  TO ASC-DOOR-ID.           05208509
052086     MOVE SU088-TRIP-ID  (ASC-SEL-SUB)  TO ASC-TRIP-ID.           05208609
052087     MOVE SU088-SCAC     (ASC-SEL-SUB)  TO ASC-SCAC.              05208709
052088     MOVE SU088-TRAILER (ASC-SEL-SUB)   TO ASC-TRAILER.           05208814
052090                                                                  05209036
052091     MOVE SU088-ASSIGN-TMST (ASC-SEL-SUB) TO                      05209134
052092                              ASC-ASSIGN-TMST.                    05209231
052099                                                                  05209931
052100                                                                  05210031
052110*----------------------------------------------------------------*05211002
052200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05220002
052300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05230002
052400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05240002
052500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05250002
052600* FUNCTION KEYS CAN GET THIS FAR.                                *05260002
052700*----------------------------------------------------------------*05270002
052800 2000-PROCESS-PANEL.                                              05280002
052900     EVALUATE TRUE                                                05290002
053000         WHEN DP020-SRC-AID = DP016-CLEAR                         05300002
053100             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                05310002
053200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05320002
053300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05330002
053310                                                                  05331025
053320*F20-NEXT SEL                                                     05332025
053330         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             05333025
053360             IF DP020-INT-APPL-FORMAT-IND = '2'                   05336026
053370               IF  ASC-USE-SELECTION-QUEUE                        05337025
053380                   PERFORM 1130-GET-NEXT-RECORD                   05338025
053390                   PERFORM 3000-EDIT-DATA-IN-COMMAREA             05339025
053391                   IF PS-LIST-END                                 05339125
053392                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05339225
053393                       SET PS-NO-LIST-END TO TRUE                 05339325
053394                   ELSE                                           05339425
      **??  IR 17795                                                    05339555
053395                       PERFORM 2050-DELETE-LIST-QUEUE             05339655
053395                       PERFORM 4000-BUILD-INITIAL-PANEL           05339755
053396                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05339855
053397                       PERFORM 3200-RESET-ATTRIBUTES              05339955
053398                   END-IF                                         05340055
053399               ELSE                                               05340155
053400*                --- BOTTOM OF LIST ---                           05340255
053401                   MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER       05340355
053402                   SET DP020-MSG-INFORMATIONAL TO TRUE            05340455
053403               END-IF                                             05340555
053404           ELSE                                                   05340655
053405               MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER           05340755
053406               SET DP020-MSG-FATAL TO TRUE                        05340855
053407           END-IF                                                 05340955
053408                                                                  05341055
053409*F19-PREV SEL                                                     05341155
053410         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             05341255
053414             IF DP020-INT-APPL-FORMAT-IND = '2'                   05341427
053415                IF  ASC-USE-SELECTION-QUEUE                       05341525
053416                   PERFORM 1140-GET-PREV-RECORD                   05341625
053417                   PERFORM 3000-EDIT-DATA-IN-COMMAREA             05341725
053418                   IF PS-LIST-END                                 05341825
053419                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05341925
053420                       SET PS-NO-LIST-END TO TRUE                 05342025
053421                   ELSE                                           05342125
      **??  IR 17795                                                    05342255
053395                       PERFORM 2050-DELETE-LIST-QUEUE             05342355
053422                       PERFORM 4000-BUILD-INITIAL-PANEL           05342425
053423                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05342525
053424                       PERFORM 3200-RESET-ATTRIBUTES              05342625
053425                   END-IF                                         05342725
053426               ELSE                                               05342825
053427                   MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER       05342925
053428                   SET DP020-MSG-INFORMATIONAL TO TRUE            05343025
053429               END-IF                                             05343125
053430           ELSE                                                   05343225
053431               MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER           05343325
053432               SET DP020-MSG-FATAL TO TRUE                        05343425
053433           END-IF                                                 05343525
053434                                                                  05343625
053440                                                                  05344002
053500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05350002
053600             PERFORM 2050-DELETE-LIST-QUEUE                       05360002
053700             EVALUATE TRUE                                        05370002
053800                WHEN ASC-TK-HISTORY-CSR                           05380006
053900                     MOVE SPACES              TO DK-DOOR-ID       05390011
054100             END-EVALUATE                                         05410002
054200             PERFORM 4000-BUILD-INITIAL-PANEL                     05420002
054300                                                                  05430002
054400         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   05440002
054500             PERFORM 2140-DESELECT-ALL-ITEMS                      05450002
054600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05460002
054700                                                                  05470002
054800         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  05480002
054900             PERFORM 2150-SELECT-ALL-ITEMS                        05490002
055000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05500002
055100                                                                  05510002
055200         WHEN OTHER                                               05520002
055300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05530002
055400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05540002
055500             IF  PS-NO-ERROR                                      05550002
055600                 SET DP030-CONTINUE-GO TO TRUE                    05560002
055700                 PERFORM 2100-CHECK-FUNCTION-KEY                  05570002
055800             ELSE                                                 05580002
055900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05590002
056000                 SET DP030-OVERRIDE-GO TO TRUE                    05600002
056100             END-IF                                               05610002
056200     END-EVALUATE.                                                05620002
056300                                                                  05630002
056400*----------------------------------------------------------------*05640002
056500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05650002
056600*----------------------------------------------------------------*05660002
056700 2050-DELETE-LIST-QUEUE.                                          05670002
056800                                                                  05680002
056900     EXEC CICS                                                    05690002
057000         DELETEQ TS                                               05700002
057100             QUEUE (ASC-LIST-QUEUE-NAME)                          05710002
057200             RESP  (PV-CICS-RESP)                                 05720002
057300     END-EXEC.                                                    05730002
057400                                                                  05740002
057500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05750002
057600        (PV-CICS-RESP = DFHRESP(QIDERR))                          05760002
057700         CONTINUE                                                 05770002
057800     ELSE                                                         05780002
057900         SET DP013-CICS-ABEND      TO TRUE                        05790002
058000         SET DP013-NO-ROLLBACK     TO TRUE                        05800002
058100                                                                  05810002
058200         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         05820002
058300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05830002
058400                                   TO DP013-MESSAGE-TEXT (1)      05840002
058500         PERFORM DP013-0000-PROCESS-ABEND                         05850002
058600     END-IF.                                                      05860002
058700                                                                  05870002
058800     MOVE +0  TO ASC-HIGHEST-BLOCK-WRITTEN.                       05880002
058900                                                                  05890002
059000*----------------------------------------------------------------*05900002
059100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05910002
059200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05920002
059300* CICS ARCHITECTURE API.                                         *05930002
059400*----------------------------------------------------------------*05940002
059500 2100-CHECK-FUNCTION-KEY.                                         05950002
059600                                                                  05960002
059700     EVALUATE TRUE                                                05970002
059800                                                                  05980002
059900* F15 -  INQ/UPD (LOCAL-FUNC-01) SUKCS796 - DETAIL                05990002
060000*                PRINT AND APPLY ASSIGN / LOGIN                   06000002
060100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06010002
060200             MOVE DP020-LOCATION-NBR TO DK-OPER-UNT-ID            06020002
060300             IF ASC-OPER-UNT-ID = DK-OPER-UNT-ID                  06030002
060400                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 0              06040002
060500                     SET ASC-USE-SELECTION-QUEUE TO TRUE          06050002
060600                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            06060002
060700                                TO SU089-NUMBER-OF-SELECTED-ITEMS 06070002
060800                     MOVE ASC-NUMBER-OF-TS-ITEMS                  06080002
060900                                      TO SU089-NUMBER-OF-TS-ITEMS 06090002
061000                     MOVE ASC-SEL-QUEUE-NAME                      06100002
061100                                         TO  SU089-SEL-QUEUE-NAME 06110002
061200                     MOVE DP020-LOCATION-NBR TO DK-OPER-UNT-ID    06120002
061300                     MOVE ASC-OPER-UNT-ID  TO SU089-OPER-UNT-ID   06130002
061400                     MOVE 1                TO SU089-FCLTY-ID      06140002
061500                     SET SU089-UPD-DOOR  TO TRUE                  06150002
061600                     PERFORM 5000-PREPARE-SEL-QUEUE               06160002
061700                 ELSE                                             06170002
061800                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06180002
061900                     SET DP030-OVERRIDE-GO TO TRUE                06190002
062000                     MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER    06200002
062100                     SET DP020-MSG-FATAL   TO TRUE                06210002
062200                 END-IF                                           06220002
062300             ELSE                                                 06230002
062400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06240002
062500                 SET DP030-OVERRIDE-GO TO TRUE                    06250002
062600                 MOVE PC-TSYMSG-02571  TO DP020-MSG-NUMBER        06260002
062700                 SET PS-ERROR                                     06270002
062800                     DP020-MSG-FATAL   TO TRUE                    06280002
062900             END-IF                                               06290002
063000                                                                  06300002
063100* F17 -  INQUIRY / UPDATE (LOCAL-FUNC-02)                         06310002
063200         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06320002
063300               MOVE SPACE TO ASC-FUNCTION                         06330002
063400               PERFORM 2110-PREPARE-INTER-APPL-COMM               06340002
063500                                                                  06350002
063600* F22 -  UNASSIGN (LOCAL-FUNC-03)                                 06360002
063700         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              06370002
063800             PERFORM 2050-DELETE-LIST-QUEUE                       06380002
063900                                                                  06390036
064000             PERFORM 4000-BUILD-INITIAL-PANEL                     06400002
064100                                                                  06410002
064200* F6 - FIRST PAGE                                                 06420002
064300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06430002
064400             MOVE +1               TO PV-TOP-ITEM                 06440002
064500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06450002
064600                                                                  06460002
064700* F7 - PREVIOUS PAGE                                              06470002
064800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06480002
064900             PERFORM 2110-BROWSE-BACKWARD                         06490002
065000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06500002
065100                                                                  06510002
065200* F8 - NEXT PAGE                                                  06520002
065300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06530002
065400             PERFORM 2120-BROWSE-FORWARD                          06540002
065500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06550002
065600                                                                  06560002
065700* ENTER KEY                                                       06570002
065800         WHEN DP020-SRC-AID = DP016-ENTER                         06580002
065900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06590002
066000             IF  PS-ERROR                                         06600002
066100                 CONTINUE                                         06610002
066200             ELSE                                                 06620002
066300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06630002
066400             END-IF                                               06640002
066500                                                                  06650002
066600         WHEN OTHER                                               06660002
066700             SET DP013-NO-ROLLBACK                                06670002
066800                 DP013-XCTL-DISPLAY-RESTART                       06680002
066900                 DP013-CICS-ABEND  TO TRUE                        06690002
067000             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    06700002
067100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06710002
067200                                   TO DP013-MESSAGE-TEXT (1)      06720002
067300             PERFORM DP013-0000-PROCESS-ABEND                     06730002
067400     END-EVALUATE.                                                06740002
067500                                                                  06750002
067600******************************************************************06760002
067700** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **06770002
067800** INTER-APPLICATION COMMAREA.                                  **06780002
067900******************************************************************06790002
068000 2110-PREPARE-INTER-APPL-COMM.                                    06800002
068100                                                                  06810002
068200     INITIALIZE SU087-INTER-APPL-COMMAREA.                        06820002
068300                                                                  06830002
068400     MOVE DP020-LOCATION-NBR       TO DK-OPER-UNT-ID.             06840002
068500     MOVE ASC-OPER-UNT-ID          TO SU087-OPER-UNT-ID.          06850002
068600     MOVE ASC-FCLTY-NAME           TO SU087-FCLTY-NME.            06860002
068700                                                                  06870002
068800*----------------------------------------------------------------*06880002
068900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06890002
069000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06900002
069100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06910002
069200*    MESSAGE.                                                    *06920002
069300*----------------------------------------------------------------*06930002
069310 2110-BROWSE-BACKWARD.                                            06931002
069320     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06932002
069330         GIVING PV-TOP-ITEM.                                      06933002
069340*                                                                 06934002
069350     IF  ((PV-TOP-ITEM < +1)                                      06935002
069360       OR (PV-TOP-ITEM = +1))                                     06936002
069370         MOVE +1                   TO PV-TOP-ITEM                 06937002
069380*        -- TOP OF LIST --                                        06938002
069390         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06939002
069400         SET DP020-MSG-INFORMATIONAL TO TRUE                      06940002
069500     END-IF.                                                      06950002
069600                                                                  06960002
069700*----------------------------------------------------------------*06970002
069800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06980002
069900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06990002
070000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07000002
070100*----------------------------------------------------------------*07010002
070200 2120-BROWSE-FORWARD.                                             07020002
070300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07030002
070400         GIVING PV-TOP-ITEM.                                      07040002
070500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07050002
070600         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             07060002
070700*        -- BOTTOM OF LIST --                                     07070002
070800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07080002
070900         SET DP020-MSG-INFORMATIONAL TO TRUE                      07090002
071000     ELSE                                                         07100002
071100         COMPUTE PV-BOTTOM-ITEM =                                 07110002
071200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07120002
071300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07130002
071400*            -- BOTTOM OF LIST --                                 07140002
071500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07150002
071600             SET DP020-MSG-INFORMATIONAL TO TRUE                  07160002
071700         END-IF                                                   07170002
071800     END-IF.                                                      07180002
071900                                                                  07190002
072000*----------------------------------------------------------------*07200002
072100*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07210002
072200*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07220002
072300*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07230002
072400*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07240002
072500*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07250002
072600*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07260002
072700*----------------------------------------------------------------*07270002
072800 2130-CHECK-FOR-JUMP-BROWSE.                                      07280002
072900     SET PS-NO-ERROR               TO TRUE.                       07290002
073000     IF (ASC-START-ITEM-REQUEST = SPACE)                          07300002
073100         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             07310002
073200     ELSE                                                         07320002
073300         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     07330002
073400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07340002
073500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07350002
073600         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07360002
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07371067
263968              USING DP010I-NUMERIC-EDIT-AREA                      07372067
073800                                                                  07380002
073900         IF  NOT DP010I-ERROR-DETECTED                            07390002
074000             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N07400002
074100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07410002
074200                 IF  ASC-START-ITEM-REQUEST-N >                   07420002
074300                                          ASC-NUMBER-OF-ITEMS-READ07430002
074400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07440002
074500                     COMPUTE PV-TOP-ITEM =                        07450002
074600                             ASC-NUMBER-OF-ITEMS-READ             07460002
074700                             - PC-ITEMS-PER-PANEL + 1             07470002
074800                     IF  PV-TOP-ITEM < +1                         07480002
074900                         MOVE +1   TO PV-TOP-ITEM                 07490002
075000                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 07500002
075100                         SET DP020-MSG-INFORMATIONAL TO TRUE      07510002
075200                     END-IF                                       07520002
075300                 ELSE                                             07530002
075400                     MOVE ASC-START-ITEM-REQUEST-N                07540002
075500                                   TO PV-TOP-ITEM                 07550002
075600                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07560002
075700                     COMPUTE PV-BOTTOM-ITEM =                     07570002
075800                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07580002
075900                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07590002
076000*                        -- BOTTOM OF LIST --                     07600002
076100                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 07610002
076200                         SET DP020-MSG-INFORMATIONAL TO TRUE      07620002
076300                     END-IF                                       07630002
076400                 END-IF                                           07640002
076500             ELSE                                                 07650002
076600*                --- VALUE OUT OF RANGE ----                      07660002
076700                 MOVE PC-TSYMSG-00101 TO DP020-MSG-NUMBER         07670002
076800                 MOVE -1              TO ASTRTITL                 07680002
076900                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07690002
077000                 MOVE DP015-REVERSE   TO ASTRTITH                 07700002
077100                 MOVE DP015-RED       TO ASTRTITC                 07710002
077200                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           07720002
077300                 SET DP020-MSG-FATAL  TO TRUE                     07730002
077400                 SET PS-ERROR         TO TRUE                     07740002
077500             END-IF                                               07750002
077600         ELSE                                                     07760002
077700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07770002
077800             MOVE -1               TO ASTRTITL                    07780002
077900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07790002
078000             MOVE DP015-REVERSE    TO ASTRTITH                    07800002
078100             MOVE DP015-RED        TO ASTRTITC                    07810002
078200             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               07820002
078300             SET DP020-MSG-FATAL   TO TRUE                        07830002
078400             SET PS-ERROR          TO TRUE                        07840002
078500         END-IF                                                   07850002
078600     END-IF.                                                      07860002
078700                                                                  07870002
078800*----------------------------------------------------------------*07880002
078900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *07890002
079000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *07900002
079100*----------------------------------------------------------------*07910002
079200 2140-DESELECT-ALL-ITEMS.                                         07920002
079300     MOVE +1                       TO ASC-BLK-SUB.                07930002
079400                                                                  07940002
079500     PERFORM 2141-CLEAR-SELECTED-INDS                             07950002
079600         VARYING ASC-ITEM-SUB                                     07960002
079700         FROM 1 BY 1                                              07970002
079800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07980002
079900                                                                  07990002
080000     ADD +1                        TO ASC-BLK-SUB.                08000002
080100                                                                  08010002
080200     PERFORM 2141-CLEAR-SELECTED-INDS                             08020002
080300         VARYING ASC-ITEM-SUB                                     08030002
080400         FROM 1 BY 1                                              08040002
080500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08050002
080600                                                                  08060002
080700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08070002
080800                                   TO PV-LIST-ITEM-NUMBER.        08080002
080900                                                                  08090002
081000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08100002
081100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08110002
081200                                                                  08120002
081300     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            08130002
081400         MOVE +1                   TO ASC-BLK-SUB                 08140002
081500                                                                  08150002
081600         PERFORM 5100-WRITE-TEMP-STORAGE                          08160002
081700         MOVE +2                   TO ASC-BLK-SUB                 08170002
081800         PERFORM 5100-WRITE-TEMP-STORAGE                          08180002
081900         MOVE +1                   TO ASC-BLK-SUB                 08190002
082000         MOVE +1                   TO PV-BLOCK-NUMBER             08200002
082100     END-IF.                                                      08210002
082200                                                                  08220002
082300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08230002
082400        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      08240002
082500         MOVE +1                   TO ASC-BLK-SUB                 08250002
082600                                                                  08260002
082700         PERFORM 5100-WRITE-TEMP-STORAGE                          08270002
082800         MOVE +2  TO ASC-BLK-SUB                                  08280002
082900         PERFORM 5100-WRITE-TEMP-STORAGE                          08290002
083000         MOVE +1  TO ASC-BLK-SUB                                  08300002
083100         MOVE +1  TO PV-BLOCK-NUMBER                              08310002
083200                                                                  08320002
083300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08330002
083400             PV-FIRST-BLOCK-IN-ARRAY - 1                          08340002
083500                                                                  08350002
083600         PERFORM                                                  08360002
083700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08370002
083800                                                                  08380002
083900             PERFORM 4410-READ-TEMP-STORAGE                       08390002
084000                                                                  08400002
084100             PERFORM 2141-CLEAR-SELECTED-INDS                     08410002
084200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 08420002
084300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08430002
084400                                                                  08440002
084500             PERFORM 5100-WRITE-TEMP-STORAGE                      08450002
084600                                                                  08460002
084700             ADD +1                TO PV-BLOCK-NUMBER             08470002
084800                                                                  08480002
084900         END-PERFORM                                              08490002
085000                                                                  08500002
085100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08510002
085200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08520002
085300                                                                  08530002
085400         PERFORM                                                  08540002
085500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08550002
085600                   ASC-HIGHEST-BLOCK-WRITTEN                      08560002
085700                                                                  08570002
085800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08580002
085900                                   TO PV-BLOCK-NUMBER             08590002
086000                                                                  08600002
086100             PERFORM 4410-READ-TEMP-STORAGE                       08610002
086200                                                                  08620002
086300             PERFORM 2141-CLEAR-SELECTED-INDS                     08630002
086400                 VARYING ASC-ITEM-SUB                             08640002
086500                 FROM 1 BY 1                                      08650002
086600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08660002
086700                                                                  08670002
086800             PERFORM 5100-WRITE-TEMP-STORAGE                      08680002
086900                                                                  08690002
087000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08700002
087100                                                                  08710002
087200         END-PERFORM                                              08720002
087300                                                                  08730002
087400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             08740002
087500                                   TO PV-BLOCK-NUMBER             08750002
087600                                                                  08760002
087700         PERFORM 4410-READ-TEMP-STORAGE                           08770002
087800     END-IF.                                                      08780002
087900                                                                  08790002
088000     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 08800002
088100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.08810002
088200     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  08820002
088300                                                                  08830002
088400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08840002
088500                                                                  08850002
088600*----------------------------------------------------------------*08860002
088700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *08870002
088800*----------------------------------------------------------------*08880002
088900 2141-CLEAR-SELECTED-INDS.                                        08890002
089000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           08900002
089100             NOT EQUAL ZERO                                       08910002
089200         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08920002
089300             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08930002
089400                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    08940002
089500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          08950002
089600         END-IF                                                   08960002
089700     END-IF.                                                      08970002
089800                                                                  08980002
089900*----------------------------------------------------------------*08990002
090000*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *09000002
090100*  FOR ALL ITEMS.                                                *09010002
090200*----------------------------------------------------------------*09020002
090300 2150-SELECT-ALL-ITEMS.                                           09030002
090400     MOVE +1                       TO ASC-BLK-SUB.                09040002
090500                                                                  09050002
090600     PERFORM 2151-SET-SELECTED-INDS                               09060002
090700         VARYING ASC-ITEM-SUB                                     09070002
090800         FROM 1 BY 1                                              09080002
090900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09090002
091000                                                                  09100002
091100     ADD +1                        TO ASC-BLK-SUB.                09110002
091200                                                                  09120002
091300     PERFORM 2151-SET-SELECTED-INDS                               09130002
091400         VARYING ASC-ITEM-SUB                                     09140002
091500         FROM 1 BY 1                                              09150002
091600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09160002
091700                                                                  09170002
091800     MOVE ASC-LIST-ITEM-NUMBER(1 1)  TO PV-LIST-ITEM-NUMBER.      09180002
091900                                                                  09190002
092000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09200002
092100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09210002
092200                                                                  09220002
092300     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            09230002
092400         MOVE +1                   TO ASC-BLK-SUB                 09240002
092500                                                                  09250002
092600         PERFORM 5100-WRITE-TEMP-STORAGE                          09260002
092700         MOVE +2                   TO ASC-BLK-SUB                 09270002
092800         PERFORM 5100-WRITE-TEMP-STORAGE                          09280002
092900         MOVE +1                   TO ASC-BLK-SUB                 09290002
093000         MOVE +1                   TO PV-BLOCK-NUMBER             09300002
093100     END-IF.                                                      09310002
093200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09320002
093300        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09330002
093400         MOVE +1                   TO ASC-BLK-SUB                 09340002
093500                                                                  09350002
093600         PERFORM 5100-WRITE-TEMP-STORAGE                          09360002
093700                                                                  09370002
093800         MOVE +1                   TO PV-BLOCK-NUMBER             09380002
093900                                                                  09390002
094000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09400002
094100             PV-FIRST-BLOCK-IN-ARRAY - 1                          09410002
094200                                                                  09420002
094300         PERFORM                                                  09430002
094400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09440002
094500                                                                  09450002
094600             PERFORM 4410-READ-TEMP-STORAGE                       09460002
094700                                                                  09470002
094800             PERFORM 2151-SET-SELECTED-INDS                       09480002
094900                 VARYING ASC-ITEM-SUB                             09490002
095000                 FROM 1 BY 1                                      09500002
095100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09510002
095200                                                                  09520002
095300             PERFORM 5100-WRITE-TEMP-STORAGE                      09530002
095400                                                                  09540002
095500             ADD +1                TO PV-BLOCK-NUMBER             09550002
095600                                                                  09560002
095700         END-PERFORM                                              09570002
095800                                                                  09580002
095900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09590002
096000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09600002
096100                                                                  09610002
096200         PERFORM                                                  09620002
096300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09630002
096400                   ASC-HIGHEST-BLOCK-WRITTEN                      09640002
096500                                                                  09650002
096600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09660002
096700                                   TO PV-BLOCK-NUMBER             09670002
096800                                                                  09680002
096900             PERFORM 4410-READ-TEMP-STORAGE                       09690002
097000                                                                  09700002
097100             PERFORM 2151-SET-SELECTED-INDS                       09710002
097200                 VARYING ASC-ITEM-SUB                             09720002
097300                 FROM 1 BY 1                                      09730002
097400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09740002
097500                                                                  09750002
097600             PERFORM 5100-WRITE-TEMP-STORAGE                      09760002
097700                                                                  09770002
097800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09780002
097900                                                                  09790002
098000         END-PERFORM                                              09800002
098100                                                                  09810002
098200         MOVE PV-FIRST-BLOCK-IN-ARRAY  TO PV-BLOCK-NUMBER         09820002
098300                                                                  09830002
098400         PERFORM 4410-READ-TEMP-STORAGE                           09840002
098500     END-IF.                                                      09850002
098600                                                                  09860002
098700     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             09870002
098800                       ASC-NUMBER-OF-SELECTED-ITEMS.              09880002
098900                                                                  09890002
099000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09900002
099100                                                                  09910002
099200*----------------------------------------------------------------*09920002
099300*    MARK EACH ITEM AS BEING SELECTED.                           *09930002
099400*----------------------------------------------------------------*09940002
099500 2151-SET-SELECTED-INDS.                                          09950002
099600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09960002
099700             NOT EQUAL ZERO                                       09970002
099800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09980002
099900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09990002
100000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10000002
100100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10010002
100200                               TO  TRUE                           10020002
100300         END-IF                                                   10030002
100400     END-IF.                                                      10040002
100500                                                                  10050002
100600******************************************************************10060002
100700** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10070002
100800** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10080002
100900******************************************************************10090002
101000 2200-MOVE-SCREEN-TO-COMMAREA.                                    10100002
101100                                                                  10110002
101200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10120002
101300     MOVE +1                       TO PV-SUB.                     10130002
101400*                                                                 10140002
101500     PERFORM 3100-SET-SUBSCRIPTS.                                 10150002
101600                                                                  10160002
101700     IF  ASTRTITL > ZERO                                          10170002
101800         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10180002
101900     ELSE                                                         10190002
102000         IF  ASTRTITF = DP015-ERASE-EOF                           10200002
102100             INITIALIZE ASC-START-ITEM-REQUEST                    10210002
102200         END-IF                                                   10220002
102300     END-IF.                                                      10230002
102400                                                                  10240002
105000                                                                  10500002
105100******************************************************************10510002
105200** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **10520002
105300** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **10530002
105400******************************************************************10540002
105500 3000-EDIT-DATA-IN-COMMAREA.                                      10550002
105600     PERFORM 3200-RESET-ATTRIBUTES.                               10560002
105700     SET PS-NO-ERROR               TO TRUE.                       10570002
105800     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10580002
105900                                                                  10590002
106000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              10600002
106100* EDITTING IS DONE FROM THE BOTTOM UP.                            10610002
106200**                                                                10620002
106300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       10630002
106400         ASC-ITEMS-DISPLAYED - 1.                                 10640002
106500     PERFORM 3100-SET-SUBSCRIPTS.                                 10650002
106600                                                                  10660002
106700      IF  PS-NO-ERROR                                             10670002
106800          PERFORM 3005-EDIT-COMMAREA-BLOCKS                       10680002
106900      END-IF.                                                     10690002
107000                                                                  10700002
107100     IF  PS-NO-ERROR                                              10710002
107200         PERFORM 3400-CHECK-RANGE-SEQUENCE                        10720002
107300     END-IF.                                                      10730002
107400                                                                  10740002
107500     IF  ((PS-NO-ERROR)                                           10750002
107600       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   10760002
107700       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    10770002
107800             PERFORM 3500-MARK-RANGE-AS-SELECTED                  10780002
107900     END-IF.                                                      10790002
108000                                                                  10800002
108100*----------------------------------------------------------------*10810002
108200* 3005-EDIT-COMMAREA-BLOCKS                                      *10820002
108300*----------------------------------------------------------------*10830002
108400 3005-EDIT-COMMAREA-BLOCKS.                                       10840002
108500     MOVE +1                       TO PV-BLOCK-NUMBER.            10850002
108600     MOVE +1                       TO ASC-BLK-SUB.                10860002
108700     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               10870002
108800                                                                  10880002
108900     COMPUTE PV-BLOCK-NUMBER  =                                   10890002
109000             1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /            10900002
109100             PC-ITEMS-PER-PANEL.                                  10910002
109200                                                                  10920002
109300     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          10930002
109400                                                                  10940002
109500     PERFORM                                                      10950002
109600        UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN         10960002
109700           OR PS-ERROR                                            10970002
109800           OR PS-BLOCK-ERROR                                      10980002
109900                                                                  10990002
110000              COMPUTE PV-ITEMS-HOLD  =                            11000002
110100                      ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +       11010002
110200                      PC-ITEMS-PER-PANEL - 1                      11020002
110300                                                                  11030002
110400               IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ     11040002
110500                   SUBTRACT  ASC-NUMBER-OF-ITEMS-READ             11050002
110600                       FROM  PV-ITEMS-HOLD                        11060002
110700                     GIVING  PV-ITEMS-DIFF                        11070002
110800                   SUBTRACT  PV-ITEMS-DIFF                        11080002
110900                       FROM  PC-ITEMS-PER-PANEL                   11090002
111000                     GIVING  PV-ITEMS-HOLD                        11100002
111100                       MOVE  PV-ITEMS-HOLD TO PV-SUB              11110002
111200                                              ASC-ITEM-SUB        11120002
111300                                              ASC-ITEMS-DISPLAYED 11130002
111400               ELSE                                               11140002
111500                   MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB            11150002
111600                   MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB      11160002
111700               END-IF                                             11170002
111800                                                                  11180002
111900               PERFORM 3300-EDIT-SELECTIONS                       11190002
112000                       VARYING PV-SUB                             11200002
112100                          FROM PV-SUB BY -1                       11210002
112200                          UNTIL PV-SUB < +1                       11220002
112300                                                                  11230002
112400               MOVE +1               TO ASC-BLK-SUB               11240002
112500                                                                  11250002
112600               PERFORM 5105-REWRITE-ASC-LISTQ                     11260002
112700                                                                  11270002
112800               MOVE +1                TO ASC-BLK-SUB              11280002
112900                                                                  11290002
113000               IF  PS-BLOCK-ERROR                                 11300002
113100                   SET  PS-ERROR     TO TRUE                      11310002
113200                   MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)      11320002
113300                                     TO PV-TOP-ITEM               11330002
113400               ELSE                                               11340002
113500                   ADD  +1           TO PV-BLOCK-NUMBER           11350002
113600                   IF  PV-BLOCK-NUMBER >                          11360002
113700                       ASC-HIGHEST-BLOCK-WRITTEN                  11370002
113800                       MOVE +2       TO ASC-BLK-SUB               11380002
113900                       PERFORM 4410-READ-TEMP-STORAGE             11390002
114000                       MOVE +1       TO ASC-BLK-SUB               11400002
114100                   ELSE                                           11410002
114200                       PERFORM 4410-READ-TEMP-STORAGE             11420002
114300                       ADD  +1        TO PV-BLOCK-NUMBER          11430002
114400                       MOVE +2        TO ASC-BLK-SUB              11440002
114500                       PERFORM 4410-READ-TEMP-STORAGE             11450002
114600                       SUBTRACT +1  FROM PV-BLOCK-NUMBER          11460002
114700                       MOVE +1        TO ASC-BLK-SUB              11470002
114800               END-IF                                             11480002
114900           END-IF                                                 11490002
115000     END-PERFORM.                                                 11500002
115100                                                                  11510002
115200     IF  (PV-ORIGINAL-BLOCK  = +1   AND                           11520002
115300          ASC-LIST-ITEM-NUMBER (1 1) = 1)  OR                     11530002
115400         PS-ERROR                   OR                            11540002
115500         PS-BLOCK-ERROR                                           11550002
115600             CONTINUE                                             11560002
115700     ELSE                                                         11570002
115800         MOVE +1                 TO PV-BLOCK-NUMBER               11580002
115900         MOVE +1                 TO ASC-BLK-SUB                   11590002
116000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  11600002
116100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           11610002
116200         PERFORM 4410-READ-TEMP-STORAGE                           11620002
116300                                                                  11630002
116400         PERFORM                                                  11640002
116500            UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK             11650002
116600               OR PS-ERROR                                        11660002
116700               OR PS-BLOCK-ERROR                                  11670002
116800                                                                  11680002
116900                  COMPUTE PV-ITEMS-HOLD  =                        11690002
117000                          ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +   11700002
117100                          PC-ITEMS-PER-PANEL - 1                  11710002
117200                                                                  11720002
117300                  IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ    11730002
117400                      SUBTRACT  ASC-NUMBER-OF-ITEMS-READ          11740002
117500                          FROM  PV-ITEMS-HOLD                     11750002
117600                        GIVING  PV-ITEMS-DIFF                     11760002
117700                      SUBTRACT  PV-ITEMS-DIFF                     11770002
117800                          FROM  PC-ITEMS-PER-PANEL                11780002
117900                        GIVING  PV-ITEMS-HOLD                     11790002
118000                          MOVE  PV-ITEMS-HOLD TO PV-SUB           11800002
118100                                                 ASC-ITEM-SUB     11810002
118200                                              ASC-ITEMS-DISPLAYED 11820002
118300                  ELSE                                            11830002
118400                      MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB         11840002
118500                      MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB   11850002
118600                  END-IF                                          11860002
118700                                                                  11870002
118800                  PERFORM 3300-EDIT-SELECTIONS                    11880002
118900                          VARYING PV-SUB                          11890002
119000                             FROM PV-SUB BY -1                    11900002
119100                            UNTIL PV-SUB < +1                     11910002
119200                                                                  11920002
119300                  MOVE +1               TO ASC-BLK-SUB            11930002
119400                                                                  11940002
119500                  PERFORM 5105-REWRITE-ASC-LISTQ                  11950002
119600                                                                  11960002
119700                  MOVE +1                TO ASC-BLK-SUB           11970002
119800                                                                  11980002
119900                  IF  PS-BLOCK-ERROR                              11990002
120000                      SET  PS-ERROR     TO TRUE                   12000002
120100                      MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)   12010002
120200                                        TO PV-TOP-ITEM            12020002
120300                  ELSE                                            12030002
120400                      ADD  +1            TO PV-BLOCK-NUMBER       12040002
120500                      IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK     12050002
120600                          MOVE +2        TO ASC-BLK-SUB           12060002
120700                          PERFORM 4410-READ-TEMP-STORAGE          12070002
120800                          MOVE +1        TO ASC-BLK-SUB           12080002
120900                      ELSE                                        12090002
121000                          PERFORM 4410-READ-TEMP-STORAGE          12100002
121100                          ADD  +1        TO PV-BLOCK-NUMBER       12110002
121200                          MOVE +2        TO ASC-BLK-SUB           12120002
121300                          PERFORM 4410-READ-TEMP-STORAGE          12130002
121400                          SUBTRACT +1  FROM PV-BLOCK-NUMBER       12140002
121500                          MOVE +1        TO ASC-BLK-SUB           12150002
121600                      END-IF                                      12160002
121700                  END-IF                                          12170002
121800     END-PERFORM.                                                 12180002
121900     MOVE +0 TO PV-ITEMS-HOLD.                                    12190002
122000                                                                  12200002
122100*----------------------------------------------------------------*12210002
122200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12220002
122300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12230002
122400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12240002
122500*                                                                *12250002
122600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12260002
122700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12270002
122800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12280002
122900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12290002
123000*----------------------------------------------------------------*12300002
123100 3100-SET-SUBSCRIPTS.                                             12310002
123200     COMPUTE ASC-ITEM-SUB =                                       12320002
123300         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12330002
123400                                                                  12340002
123500     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12350002
123600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12360002
123700         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               12370002
123800     ELSE                                                         12380002
123900         MOVE +1                     TO ASC-BLK-SUB               12390002
124000     END-IF.                                                      12400002
124100                                                                  12410002
124200******************************************************************12420002
124300** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **12430002
124400******************************************************************12440002
124500 3200-RESET-ATTRIBUTES.                                           12450002
124600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   12460002
124700     MOVE DP015-GREEN              TO ASTRTITC.                   12470002
124800     MOVE DP015-UNDERLINE          TO ASTRTITH.                   12480002
124900                                                                  12490002
126516                                                                  12651604
126517******************************************************************12651704
126518** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **12651804
126520** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **12652002
126530** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **12653002
126540** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **12654002
126550******************************************************************12655002
126560 3300-EDIT-SELECTIONS.                                            12656002
126570     EVALUATE TRUE                                                12657002
126580         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12658002
126590             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         12659002
126600                 CONTINUE                                         12660002
126700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         12670002
126800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12680002
126900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   12690002
127000                 MOVE ASC-TEMP-SELECTED-SW                        12700002
127100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12710002
127200                                TO ASC-SELECTED-SW                12720002
127300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12730002
127400             END-IF                                               12740002
127500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12750002
127600                 = SPACE                                          12760002
127700             EVALUATE TRUE                                        12770002
127800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       12780002
127900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS12790002
128000                     MOVE SPACE TO ASC-SELECTED-SW                12800002
128100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12810002
128200                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        12820002
128300                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    12830002
128400                     MOVE SPACE TO ASC-SELECTED-SW                12840002
128500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12850002
128600                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          12860002
128700                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      12870002
128800                     MOVE SPACE TO ASC-SELECTED-SW                12880002
128900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12890002
129000             END-EVALUATE                                         12900002
129100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           12910002
129200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12920002
129300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12930002
129400             END-IF                                               12940002
129500             PERFORM 3310-EDIT-RANGE                              12950002
129600         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12960002
129700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12970002
129800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12980002
129900             END-IF                                               12990002
130000             PERFORM 3310-EDIT-RANGE                              13000002
130100         WHEN OTHER                                               13010002
130200             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13020002
130300             SET DP020-MSG-FATAL    TO TRUE                       13030002
130400             MOVE -1                TO ASTRTITL                   13040002
130500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  13050002
130800             SET PS-ERROR TO TRUE                                 13080002
130900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13090002
131000                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13100002
131100                 MOVE SPACE         TO ASC-SELECTED-SW            13110002
131200                                        (ASC-BLK-SUB ASC-ITEM-SUB)13120002
131300             END-IF                                               13130002
131400     END-EVALUATE.                                                13140002
131500                                                                  13150002
131600     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13160002
131700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13170002
131800     IF  ASC-ITEM-SUB < 1                                         13180002
131900         SUBTRACT +1 FROM ASC-BLK-SUB                             13190002
132000         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13200002
132100     END-IF.                                                      13210002
132200                                                                  13220002
132300******************************************************************13230002
132400** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **13240002
132500** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **13250002
132600** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**13260002
132700** THE ENDING.                                                  **13270002
132800******************************************************************13280002
132900 3310-EDIT-RANGE.                                                 13290002
133000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13300002
133100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   13310002
133200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)13320002
133300                                   TO ASC-SELECTED-SW             13330002
133400                                        (ASC-BLK-SUB ASC-ITEM-SUB)13340002
133500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 13350002
133600         ELSE                                                     13360002
133700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     13370002
133800                 CONTINUE                                         13380002
133900             ELSE                                                 13390002
134000*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        13400002
134100                 MOVE PC-TSYMSG-00054                             13410002
134200                                   TO DP020-MSG-NUMBER            13420002
134300                 SET DP020-MSG-FATAL                              13430002
134400                                   TO TRUE                        13440002
134500                 MOVE -1           TO ASTRTITL                    13450002
134600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              13460002
134900                 SET PS-ERROR      TO TRUE                        13490002
135000             END-IF                                               13500002
135100         END-IF                                                   13510002
135200     ELSE                                                         13520002
135300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     13530002
135400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 13540002
135500                                   TO ASC-SELECTED-SW             13550002
135600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13560002
135700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   13570002
135800         ELSE                                                     13580002
135900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       13590002
136000                 CONTINUE                                         13600002
136100             ELSE                                                 13610002
136200*                -- ONLY ONE END-OF-RANGE ALLOWED --              13620002
136300                 MOVE PC-TSYMSG-00055                             13630002
136400                                   TO DP020-MSG-NUMBER            13640002
136500                 SET DP020-MSG-FATAL                              13650002
136600                                   TO TRUE                        13660002
136700                 MOVE -1           TO ASTRTITL                    13670002
136800                 SET DP030-SET-CURSOR-APPL-1                      13680002
136900                                   TO TRUE                        13690002
137000                 SET PS-ERROR      TO TRUE                        13700002
137100             END-IF                                               13710002
137200         END-IF                                                   13720002
137300     END-IF.                                                      13730002
137400*                                                                 13740002
137500******************************************************************13750002
137600** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **13760002
137700** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **13770002
137800******************************************************************13780002
137900 3400-CHECK-RANGE-SEQUENCE.                                       13790002
138000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       13800002
138100       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      13810002
138200       AND  ASC-START-OF-SELECTED-RANGE >                         13820002
138300                                         ASC-END-OF-SELECTED-RANGE13830002
138400*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                13840002
138500         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 13850002
138600         SET DP020-MSG-FATAL TO TRUE                              13860002
138700         SET PS-ERROR TO TRUE                                     13870002
138800         PERFORM 3410-POSITION-AT-ERROR                           13880002
138900     END-IF.                                                      13890002
139000                                                                  13900002
139100******************************************************************13910002
139200** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **13920002
139300** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **13930002
139400** SHOULD BE POSITIONED ON A RANGE ERROR.                       **13940002
139500******************************************************************13950002
139600 3410-POSITION-AT-ERROR.                                          13960002
139700     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       13970002
139800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 13980002
139900                    - PV-TOP-ITEM + 1.                            13990002
140000**??                                                              14000010
140010**?? IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14001010
140100**??     CONTINUE                                                 14010010
140200**?? ELSE                                                         14020010
140300**??     MOVE -1                   TO MR-SELECTL (PV-SUB)         14030010
140400**??     MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14040010
140500**??     MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14050010
140600**?? END-IF.                                                      14060010
140700                                                                  14070002
140800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14080002
140900                    - PV-TOP-ITEM + 1.                            14090002
141000**?? IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14100010
141100**??     CONTINUE                                                 14110010
141200**?? ELSE                                                         14120010
141300**??     MOVE -1                   TO MR-SELECTL (PV-SUB)         14130010
141400**??     MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14140010
141500**??     MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14150010
141600**?? END-IF.                                                      14160010
141700                                                                  14170002
141800*----------------------------------------------------------------*14180002
141900*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14190002
142000*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14200002
142100*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14210002
142200*----------------------------------------------------------------*14220002
142300 3500-MARK-RANGE-AS-SELECTED.                                     14230002
142400     MOVE +1                       TO  ASC-BLK-SUB.               14240002
142500     PERFORM 3510-MARK-SELECTED-INDS                              14250002
142600         VARYING ASC-ITEM-SUB                                     14260002
142700         FROM 1 BY 1                                              14270002
142800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14280002
142900                                                                  14290002
143000     ADD +1                        TO ASC-BLK-SUB.                14300002
143100     PERFORM 3510-MARK-SELECTED-INDS                              14310002
143200         VARYING ASC-ITEM-SUB                                     14320002
143300         FROM 1 BY 1                                              14330002
143400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14340002
143500                                                                  14350002
143600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14360002
143700                                   TO  PV-LIST-ITEM-NUMBER.       14370002
143800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14380002
143900         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         14390002
144000               PC-ITEMS-PER-PANEL).                               14400002
144100                                                                  14410002
144200     MOVE ASC-START-OF-SELECTED-RANGE                             14420002
144300                                   TO PV-START-OF-SELECTED-RANGE. 14430002
144400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            14440002
144500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  14450002
144600               PC-ITEMS-PER-PANEL).                               14460002
144700                                                                  14470002
144800     MOVE ASC-END-OF-SELECTED-RANGE                               14480002
144900                                   TO  PV-END-OF-SELECTED-RANGE.  14490002
145000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             14500002
145100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    14510002
145200               PC-ITEMS-PER-PANEL).                               14520002
145300     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             14530002
145400         PV-FIRST-BLOCK-IN-ARRAY + 1.                             14540002
145500                                                                  14550002
145600     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    14560002
145700        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        14570002
145800         MOVE +1                   TO ASC-BLK-SUB                 14580002
145900         PERFORM 5100-WRITE-TEMP-STORAGE                          14590002
146000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14600002
146100             PV-FIRST-BLOCK-IN-ARRAY - 1                          14610002
146200                                                                  14620002
146300         PERFORM                                                  14630002
146400             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14640002
146500                   PV-PREV-BLOCK-IN-ARRAY                         14650002
146600             MOVE PV-FIRST-BLOCK-IN-RANGE                         14660002
146700                                   TO PV-BLOCK-NUMBER             14670002
146800             PERFORM 4410-READ-TEMP-STORAGE                       14680002
146900             PERFORM 3510-MARK-SELECTED-INDS                      14690002
147000                 VARYING ASC-ITEM-SUB                             14700002
147100                 FROM 1 BY 1                                      14710002
147200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14720002
147300             PERFORM 5100-WRITE-TEMP-STORAGE                      14730002
147400             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     14740002
147500         END-PERFORM                                              14750002
147600                                                                  14760002
147700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14770002
147800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14780002
147900         PERFORM                                                  14790002
148000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14800002
148100                   PV-LAST-BLOCK-IN-RANGE                         14810002
148200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14820002
148300                                   TO PV-BLOCK-NUMBER             14830002
148400             PERFORM 4410-READ-TEMP-STORAGE                       14840002
148500             PERFORM 3510-MARK-SELECTED-INDS                      14850002
148600                 VARYING ASC-ITEM-SUB                             14860002
148700                 FROM 1 BY 1                                      14870002
148800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14880002
148900             PERFORM 5100-WRITE-TEMP-STORAGE                      14890002
149000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14900002
149100         END-PERFORM                                              14910002
149200                                                                  14920002
149300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14930002
149400                                   TO PV-BLOCK-NUMBER             14940002
149500         PERFORM 4410-READ-TEMP-STORAGE                           14950002
149600     END-IF.                                                      14960002
149700                                                                  14970002
149800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 14980002
149900                                      ASC-END-OF-SELECTED-RANGE.  14990002
150000                                                                  15000002
150100*----------------------------------------------------------------*15010002
150200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15020002
150300*----------------------------------------------------------------*15030002
150400 3510-MARK-SELECTED-INDS.                                         15040002
150500     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15050002
150600                                ASC-ITEM-SUB) >                   15060002
150700         ASC-START-OF-SELECTED-RANGE)                             15070002
150800     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15080002
150900                                ASC-ITEM-SUB) =                   15090002
151000         ASC-START-OF-SELECTED-RANGE)                             15100002
151100                                                                  15110002
151200         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15120002
151300                                    ASC-ITEM-SUB) <               15130002
151400             ASC-END-OF-SELECTED-RANGE)                           15140002
151500         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15150002
151600                                    ASC-ITEM-SUB) =               15160002
151700             ASC-END-OF-SELECTED-RANGE)                           15170002
151800                                                                  15180002
151900             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15190002
152000                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15200002
152100                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15210002
152200                               TO TRUE                            15220002
152300                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15230002
152400                               TO TRUE                            15240002
152500                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    15250002
152600             END-IF                                               15260002
152700         END-IF                                                   15270002
152800     END-IF.                                                      15280002
152900                                                                  15290002
153000*----------------------------------------------------------------*15300002
153100*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15310002
153200*    INITIALIZE ALL COUNTERS AND FLAGS.                          *15320002
153300*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *15330002
153400*    DISPLAY THE PANEL TO USER.                                  *15340002
153500*----------------------------------------------------------------*15350002
153600 4000-BUILD-INITIAL-PANEL.                                        15360002
153700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            15370002
153800                                 ASC-BLOCK-ENTRIES (2).           15380002
153900     MOVE +1                   TO ASC-BLK-SUB.                    15390002
154000     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           15400002
154100                                                                  15410002
154200     MOVE +0                 TO ASC-ITEM-SUB                      15420002
154300                                ASC-NUMBER-OF-ITEMS-READ          15430002
154400                                ASC-NUMBER-OF-SELECTED-ITEMS      15440002
154500                                ASC-HIGHEST-BLOCK-WRITTEN         15450002
154600                                ASC-START-OF-SELECTED-RANGE       15460002
154700                                ASC-END-OF-SELECTED-RANGE         15470002
154800                                ASC-ITEM-AT-TOP-OF-PANEL.         15480002
154900                                                                  15490002
155000     PERFORM 4100-PREPARE-CURSOR.                                 15500006
155100     PERFORM 4110-OPEN-CURSOR.                                    15510006
155200     PERFORM 4300-READ-ITEMS-FROM-DB.                             15520006
155300     PERFORM 4120-CLOSE-CURSOR.                                   15530006
156800                                                                  15680002
156900     MOVE +1                   TO  PV-TOP-ITEM.                   15690002
157000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          15700002
157100         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    15710002
157200         SET DP020-MSG-FATAL   TO  TRUE                           15720002
157210         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               15721002
157220     ELSE                                                         15722002
157230**??     MOVE -1               TO MR-SELECTL (1)                  15723010
157240         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      15724002
157250         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15725002
157260     END-IF.                                                      15726002
157270                                                                  15727002
157280*----------------------------------------------------------------*15728002
157290* OPEN THE CURSOR.                                               *15729002
157300*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *15730002
157400*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *15740002
157500*   ASSOCIATE.                                                   *15750002
157600*----------------------------------------------------------------*15760002
157700 4110-OPEN-CURSOR.                                                15770006
157800     PERFORM                                                      15780002
157900         WITH TEST AFTER                                          15790002
158000         VARYING PV-RETRY-COUNTER                                 15800002
158100         FROM 1 BY 1                                              15810002
158200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15820002
158300                   OR (SQLCODE = ZERO))                           15830002
158400                                                                  15840002
158500         MOVE 'CURSOR:  TK-HISTORY-CSR'                           15850006
158600                                        TO DP013-MESSAGE-TEXT (2) 15860002
158700         EXEC SQL                                                 15870002
158800              OPEN TK-HISTORY-CSR                                 15880006
158900         END-EXEC                                                 15890002
159000                                                                  15900002
159100         EVALUATE TRUE                                            15910002
159200             WHEN SQLCODE = ZERO                                  15920002
159300             WHEN SQLCODE = -904                                  15930002
159400             WHEN SQLCODE = -913                                  15940002
159500                 CONTINUE                                         15950002
159600             WHEN SQLWARN0 NOT = SPACES                           15960002
159700             WHEN SQLCODE < ZERO                                  15970002
159800             WHEN SQLCODE > ZERO                                  15980002
159900                 MOVE '4110-OPEN-CURSOR' TO DP013-PARAGRAPH       15990006
160000                 MOVE 'UNABLE TO OPEN A CURSOR -'                 16000002
160100                                   TO DP013-MESSAGE-TEXT (1)      16010002
160200                 MOVE SQLCA        TO DP013-SQLCA                 16020002
160300                 MOVE 'TCNDCDR '   TO                             16030007
160310                                      DP013-DB2-TABLE-NAME (1)    16031007
160400                 SET DP013-DB2-ABEND                              16040002
160500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           16050002
160600                 PERFORM DP013-0000-PROCESS-ABEND                 16060002
160700         END-EVALUATE                                             16070002
160800     END-PERFORM.                                                 16080002
160900                                                                  16090002
161000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16100002
161100         MOVE '4110-OPEN-CURSOR'   TO DP013-PARAGRAPH             16110006
161200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   16120002
161300                                   TO DP013-MESSAGE-TEXT (1)      16130002
161400         MOVE SQLCA                TO DP013-SQLCA                 16140002
161500         MOVE 'TCNDCDR '           TO DP013-DB2-TABLE-NAME (1)    16150002
161600         SET DP013-DB2-ABEND                                      16160002
161700             DP013-XCTL-DISPLAY-RESTART TO TRUE                   16170002
161800         PERFORM DP013-0000-PROCESS-ABEND                         16180002
161900     END-IF.                                                      16190002
162000                                                                  16200002
162100*----------------------------------------------------------------*16210002
162200* CLOSE THE CURSOR                                               *16220002
162300*----------------------------------------------------------------*16230002
162400 4120-CLOSE-CURSOR.                                               16240006
162500                                                                  16250002
162600     EXEC SQL                                                     16260002
162700          CLOSE TK-HISTORY-CSR                                    16270006
162800     END-EXEC.                                                    16280002
162900                                                                  16290002
163000     EVALUATE TRUE                                                16300002
163100         WHEN SQLCODE = ZERO                                      16310002
163200             CONTINUE                                             16320002
163300         WHEN SQLWARN0 NOT = SPACES                               16330002
163400         WHEN SQLCODE < ZERO                                      16340002
163500         WHEN SQLCODE > ZERO                                      16350002
163600             MOVE '4120-CLOSE-CURSOR' TO DP013-PARAGRAPH          16360006
163700             MOVE 'UNABLE TO CLOSE CURSOR '                       16370002
163800                               TO DP013-MESSAGE-TEXT (1)          16380002
163900             MOVE SQLCA        TO DP013-SQLCA                     16390002
164000             MOVE 'TCNDCDR '   TO DP013-DB2-TABLE-NAME (1)        16400002
164100             SET DP013-DB2-ABEND                                  16410002
164200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16420002
164300             PERFORM DP013-0000-PROCESS-ABEND                     16430002
164400     END-EVALUATE.                                                16440002
164500                                                                  16450002
164600                                                                  16460002
164700*----------------------------------------------------------------*16470002
164800*    SET UP THE HOST VARIABLES.                                  *16480002
164900*----------------------------------------------------------------*16490002
165000 4100-PREPARE-CURSOR.                                             16500002
165100                                                                  16510002
165200     MOVE ASC-OPER-UNT-ID      TO  DK-OPER-UNT-ID.                16520002
165201     MOVE ASC-PNA-STA-NBR      TO  DK-ACM-LBL-STA-NBR.            16520111
165210     MOVE ASC-DOOR-ID          TO  DK-DOOR-ID.                    16521011
165230     MOVE ASC-TRIP-ID          TO  DK-TRIP-ID.                    16523005
165240     MOVE ASC-ASSIGN-TMST      TO  DK-ASGD-STRT-TMST.             16524032
165300                                                                  16530002
165600*----------------------------------------------------------------*16560002
165700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *16570002
165800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *16580002
165900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *16590002
166000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *16600002
166100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *16610002
166200*                                                                *16620002
166300*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *16630002
166400*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *16640002
166500*    UPON INITIALIZATION.                                        *16650002
166600*----------------------------------------------------------------*16660002
166700 4300-READ-ITEMS-FROM-DB.                                         16670002
166800     PERFORM                                                      16680002
166900         VARYING PV-READ-COUNT                                    16690002
167000         FROM 1 BY 1                                              16700002
167100         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    16710002
167200            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         16720002
167300                                                                  16730002
               IF ASC-TRAILER = 'AVAILABLE'                             16731057
177300             SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                  16731157
                   MOVE SPACES TO SUT00111-WRKR-USR-ID                  16731257
                                  SUT00111-WRKR-STRT-TMST               16731357
                                  SUT00111-WRKR-END-TMST                16731457
157200             SET DP020-MSG-INFORMATIONAL TO TRUE                  16731564
157210             MOVE PC-TSYMSG-00050        TO DP020-MSG-NUMBER      16731665
200800             SET DP020-MSG-WARNING       TO TRUE                  16731765
                   MOVE +1 TO ASC-NUMBER-OF-ITEMS-READ                  16731958
               ELSE                                                     16732057
167400             PERFORM 4310-FETCH                                   16740057
               END-IF                                                   16741057
167500                                                                  16750002
167600         IF  ASC-ITEMS-LEFT-ON-DB                                 16760002
167700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                16770002
167800                 ADD +1            TO ASC-ITEM-SUB                16780002
167900             ELSE                                                 16790002
168000                 ADD +1            TO ASC-BLK-SUB                 16800002
168100                 MOVE +1           TO ASC-ITEM-SUB                16810002
168200                                                                  16820002
168300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16830002
168400                     MOVE +1       TO ASC-BLK-SUB                 16840002
168500                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           16850002
168600                     PERFORM 5100-WRITE-TEMP-STORAGE              16860002
168700                     MOVE ASC-BLOCK-ENTRIES                       16870002
168800                               (PC-MAX-BLOCKS-IN-ARRAY)           16880002
168900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 16890002
169000                     ADD +1        TO ASC-BLK-SUB                 16900002
169100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   16910002
169200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16920002
169300                                   TO TRUE                        16930002
169400                 END-IF                                           16940002
169500             END-IF                                               16950002
169600             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    16960002
169700             MOVE ASC-NUMBER-OF-ITEMS-READ                        16970002
169800                                   TO ASC-LIST-ITEM-NUMBER        16980002
169900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16990002
171210             MOVE SUT00111-WRKR-USR-ID TO ASC-TK-TP-NBR           17121028
171220                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17122028
                   MOVE SUT00111-WRKR-STRT-TMST TO                      17130148
                                           ASC-LOGIN-TMST               17130250
                                      (ASC-BLK-SUB ASC-ITEM-SUB)        17130348
171404             IF SUT00111-WRKR-END-TMST = PC-DEFAULT-TMST          17140437
171405                MOVE PC-A  TO ASC-ACTV-IND                        17140537
171406                                 (ASC-BLK-SUB ASC-ITEM-SUB)       17140637
171407             ELSE                                                 17140737
171408                MOVE PC-I  TO ASC-ACTV-IND                        17140837
171409                                 (ASC-BLK-SUB ASC-ITEM-SUB)       17140937
171410             END-IF                                               17141037
                                                                        17141154
                   MOVE SUT00111-WRKR-END-TMST TO                       17141248
                                           ASC-LOGOUT-TMST              17141350
                                      (ASC-BLK-SUB ASC-ITEM-SUB)        17141448
172100                                                                  17210002
172200         END-IF                                                   17220002
172300     END-PERFORM.                                                 17230002
172400                                                                  17240002
172500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17250002
172600         MOVE +1               TO ASC-BLK-SUB                     17260002
172700         PERFORM 5100-WRITE-TEMP-STORAGE                          17270002
172800         ADD +1                TO ASC-BLK-SUB                     17280002
172900         PERFORM 5100-WRITE-TEMP-STORAGE                          17290002
173000                                                                  17300002
173100         MOVE 1                TO ASC-BLK-SUB                     17310002
173200                                  PV-BLOCK-NUMBER                 17320002
173300         PERFORM 4410-READ-TEMP-STORAGE                           17330002
173400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17340002
173500             MOVE 2            TO ASC-BLK-SUB                     17350002
173600                                  PV-BLOCK-NUMBER                 17360002
173700             PERFORM 4410-READ-TEMP-STORAGE                       17370002
173800         END-IF                                                   17380002
173900     END-IF.                                                      17390002
174000                                                                  17400002
174100*----------------------------------------------------------------*17410002
174200*    FETCH THE CURSOR                                             17420002
174300*----------------------------------------------------------------*17430002
174400 4310-FETCH.                                                      17440002
174500                                                                  17450002
174600     EXEC SQL                                                     17460002
174700          FETCH TK-HISTORY-CSR                                    17470006
174800          INTO  :SUT00111-WRKR-USR-ID                             17480007
174900              , :SUT00111-WRKR-STRT-TMST                          17490007
174910              , :SUT00111-WRKR-END-TMST                           17491007
175500     END-EXEC.                                                    17550002
175600                                                                  17560002
175700     EVALUATE TRUE                                                17570002
175800         WHEN SQLCODE = ZERO                                      17580002
175900              CONTINUE                                            17590005
176000         WHEN SQLCODE = +100                                      17600002
176100              CONTINUE                                            17610002
176200         WHEN SQLWARN0 NOT = SPACE                                17620002
176300         WHEN SQLCODE NOT = ZERO                                  17630002
176400              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         17640002
176500              MOVE 'COULD NOT FETCH CURSOR'                       17650002
176600                               TO DP013-MESSAGE-TEXT (1)          17660002
176700              MOVE SQLCA       TO DP013-SQLCA                     17670002
176800              SET DP013-DB2-ABEND TO TRUE                         17680002
176900              PERFORM DP013-0000-PROCESS-ABEND                    17690002
177000     END-EVALUATE.                                                17700002
177100                                                                  17710002
177200     IF  SQLCODE EQUAL +100                                       17720002
177300         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      17730002
177400     END-IF.                                                      17740002
177500                                                                  17750002
185400                                                                  18540002
185500*----------------------------------------------------------------*18550002
185600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18560002
185700*----------------------------------------------------------------*18570002
185800 4400-MOVE-COMMAREA-TO-SCREEN.                                    18580002
185900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18590002
186000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18600002
186100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18610002
186200             MOVE +1    TO ASC-BLK-SUB                            18620002
186300             PERFORM 5100-WRITE-TEMP-STORAGE                      18630002
186400             ADD +1     TO ASC-BLK-SUB                            18640002
186500             PERFORM 5100-WRITE-TEMP-STORAGE                      18650002
186600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18660002
186700                 GIVING PV-BLOCK-NUMBER                           18670002
186800                 REMAINDER PV-REMAINDER                           18680002
186900             IF  PV-REMAINDER > ZERO                              18690002
187000                 ADD +1 TO PV-BLOCK-NUMBER                        18700002
187100             END-IF                                               18710002
187200             MOVE +1    TO ASC-BLK-SUB                            18720002
187300             PERFORM 4410-READ-TEMP-STORAGE                       18730002
187400             ADD +1     TO ASC-BLK-SUB                            18740002
187500                           PV-BLOCK-NUMBER                        18750002
187600             PERFORM 4410-READ-TEMP-STORAGE                       18760002
187700     END-IF.                                                      18770002
187800     MOVE +1            TO ASC-BLK-SUB.                           18780002
187900     COMPUTE ASC-ITEM-SUB =                                       18790002
188000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18800002
188100         + PC-ITEMS-PER-PANEL).                                   18810002
188200*                                                                 18820002
188300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18830002
188400         ADD +1         TO ASC-BLK-SUB                            18840002
188500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18850002
188600     END-IF.                                                      18860002
188700*                                                                 18870002
188800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18880002
188900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18890002
189000     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        18900002
189100     PERFORM 4420-FORMAT-LIST-LINES                               18910002
189200         VARYING PV-SUB                                           18920002
189300         FROM PC-ITEMS-PER-PANEL BY -1                            18930002
189400         UNTIL PV-SUB < +1.                                       18940002
189500*                                                                 18950002
189600     COMPUTE ASC-ITEMS-DISPLAYED =                                18960002
189700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          18970002
189800     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    18980002
189900                                      ASTRTITO.                   18990002
190000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19000002
190100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19010002
190200**?? MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19020011
190300**??                               TO ASELITO.                    19030012
190400     MOVE ASC-OPER-UNT-ID          TO AOPRUNTO.                   19040002
190500     MOVE ASC-FCLTY-NAME           TO AOPRNMEO.                   19050002
190510     MOVE ASC-PNA-STA-NBR          TO ASTANBRO.                   19051021
190520     MOVE ASC-SCAC                 TO ASCACO.                     19052021
190521     MOVE ASC-DOOR-ID              TO ADOORIDO.                   19052144
190522     MOVE ASC-TRIP-ID              TO ATRIPIDO.                   19052244
190523     MOVE ASC-TRAILER              TO ATRAILRO.                   19052344
           IF ASC-TRAILER = 'AVAILABLE'                                 19052461
190523         MOVE DP015-YELLOW         TO ATRAILRC                    19052562
190523     ELSE                                                         19052663
190523         MOVE DP015-BLUE           TO ATRAILRC                    19052766
191300     END-IF.                                                      19052963
190600                                                                  19060002
190700     IF  DP020-MSG-NUMBER-X = SPACE                               19070002
190800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  19080002
190900*            --- MORE ITEMS TO DISPLAY ----                       19090002
191000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            19100002
191100             SET DP020-MSG-INFORMATIONAL TO TRUE                  19110002
191200         END-IF                                                   19120002
191300     END-IF.                                                      19130002
191400                                                                  19140002
191500*----------------------------------------------------------------*19150002
191600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *19160002
191700*----------------------------------------------------------------*19170002
191800 4410-READ-TEMP-STORAGE.                                          19180002
191900     EXEC CICS                                                    19190002
192000         READQ TS                                                 19200002
192100             QUEUE (ASC-LIST-QUEUE-NAME)                          19210002
192200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19220002
192300             ITEM  (PV-BLOCK-NUMBER)                              19230002
192400             RESP  (PV-CICS-RESP)                                 19240002
192500     END-EXEC.                                                    19250002
192600                                                                  19260002
192700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       19270002
192800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     19280002
192900         CONTINUE                                                 19290002
193000     ELSE                                                         19300002
193100         SET DP013-CICS-ABEND     TO TRUE                         19310002
193200         SET DP013-NO-ROLLBACK    TO TRUE                         19320002
193300         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         19330002
193400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      19340002
193500                                  TO DP013-MESSAGE-TEXT(1)        19350002
193600         PERFORM DP013-0000-PROCESS-ABEND                         19360002
193700     END-IF.                                                      19370002
193800                                                                  19380002
193900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19390002
194000*                                                                 19400002
194100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         19410002
194200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               19420002
194300     END-IF.                                                      19430002
194400                                                                  19440002
194500*----------------------------------------------------------------*19450002
194600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *19460002
194700*----------------------------------------------------------------*19470002
194800 4420-FORMAT-LIST-LINES.                                          19480002
194900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      19490002
195000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                19500002
195100**??     MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           19510010
195200**??     MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           19520010
195400         MOVE SPACES             TO MR-TK-TP-ASSIGNED (PV-SUB)    19540024
195500                                    MR-ACTV-IND     (PV-SUB)      19550004
195510                                    MR-LOGIN-DATE   (PV-SUB)      19551004
195600                                    MR-LOGIN-TIME   (PV-SUB)      19560004
195700                                    MR-LOGOUT-DATE  (PV-SUB)      19570004
195800                                    MR-LOGOUT-TIME  (PV-SUB)      19580004
196000     ELSE                                                         19600002
196100**??                                                              19610010
196110**??     IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19611010
196200**??                                               > SPACE        19620010
196300**??         MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19630010
196400**??                                      TO MR-SELECTI (PV-SUB)  19640010
196500**??     ELSE                                                     19650010
196600**??         MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19660010
196700**??                                       TO MR-SELECTI (PV-SUB) 19670010
196800**??     END-IF                                                   19680010
196900                                                                  19690002
197000         IF  DP030-SET-CURSOR-TRAILER                             19700002
197100             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)19710002
197200                 > SPACE)                                         19720002
197300               OR (PV-SUB = 1))                                   19730002
197400                SET DP030-SET-CURSOR-APPL-1 TO TRUE               19740002
197500**??            MOVE -1          TO MR-SELECTL (PV-SUB)           19750010
197600             END-IF                                               19760002
197700         END-IF                                                   19770002
197800*>>>>>>>>                                                         19780002
197900         MOVE ASC-TK-TP-NBR      (ASC-BLK-SUB ASC-ITEM-SUB)       19790011
198000                                    TO MR-TK-TP-ASSIGNED (PV-SUB) 19800004
198100         MOVE ASC-ACTV-IND (ASC-BLK-SUB ASC-ITEM-SUB)             19810004
198200                                          TO MR-ACTV-IND (PV-SUB) 19820004
               STRING ASC-LOGIN-TMST (ASC-BLK-SUB ASC-ITEM-SUB) (6:6)   19905051
                      ASC-LOGIN-TMST (ASC-BLK-SUB ASC-ITEM-SUB) (3:2)   19906051
                      DELIMITED BY SIZE                                 19907048
                      INTO MR-LOGIN-DATE (PV-SUB)                       19908050
                                                                        19909050
               MOVE ASC-LOGIN-TMST   (ASC-BLK-SUB ASC-ITEM-SUB) (12:08) 19909151
                                TO MR-LOGIN-TIME (PV-SUB)               19909251
                                                                        19909350
               IF ASC-LOGOUT-TMST  (ASC-BLK-SUB ASC-ITEM-SUB) =         19909553
                                                PC-DEFAULT-TMST         19909752
                  MOVE SPACES TO MR-LOGOUT-DATE (PV-SUB)                19909849
                                 MR-LOGOUT-TIME (PV-SUB)                19909949
               ELSE                                                     19910049
                  STRING ASC-LOGOUT-TMST                                19910151
                                    (ASC-BLK-SUB ASC-ITEM-SUB) (6:6)    19910251
                         ASC-LOGOUT-TMST                                19910351
                                    (ASC-BLK-SUB ASC-ITEM-SUB) (3:2)    19910451
                         DELIMITED BY SIZE                              19910549
                         INTO MR-LOGOUT-DATE (PV-SUB)                   19910650
                                                                        19910750
                  MOVE ASC-LOGOUT-TMST                                  19910851
                                    (ASC-BLK-SUB ASC-ITEM-SUB) (12:8)   19910951
                                  TO  MR-LOGOUT-TIME (PV-SUB)           19911051
                                                                        19911150
              END-IF                                                    19911249
199100     END-IF.                                                      19912049
199200     SUBTRACT +1 FROM ASC-ITEM-SUB                                19920002
199300     IF  ASC-ITEM-SUB < + 1                                       19930002
199400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  19940002
199500         MOVE +1                 TO ASC-BLK-SUB                   19950002
199600     END-IF.                                                      19960002
199700                                                                  19970002
199800******************************************************************19980002
199900** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **19990002
200000** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **20000002
200100** ISSUE A WARNING.                                             **20010002
200200******************************************************************20020002
200300 4430-CHECK-FOR-BEGIN-AND-END.                                    20030002
200400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       20040002
200500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     20050002
200600*            -- NO END-OF-RANGE SPECFIED ---                      20060002
200700             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            20070002
200800             SET DP020-MSG-WARNING TO TRUE                        20080002
200900             PERFORM 4431-POSITION-AT-WARNING                     20090002
201000         END-IF                                                   20100002
201100     ELSE                                                         20110002
201200         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     20120002
201300*            -- NO BEGINNING-OF-RANGE SPECFIED ---                20130002
201400             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            20140002
201500             SET DP020-MSG-WARNING TO TRUE                        20150002
201600             PERFORM 4431-POSITION-AT-WARNING                     20160002
201700         END-IF                                                   20170002
201800     END-IF.                                                      20180002
201900                                                                  20190002
202000******************************************************************20200002
202100** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **20210002
202200** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **20220002
202300** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **20230002
202400** POSITION THE CURSOR THERE.                                   **20240002
202500******************************************************************20250002
202600 4431-POSITION-AT-WARNING.                                        20260002
202700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 20270002
202800                    - PV-TOP-ITEM + 1.                            20280002
202900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20290002
203000         CONTINUE                                                 20300002
203100     ELSE                                                         20310002
203200         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      20320002
203300**??                                                              20330010
203310**??     MOVE -1                     TO MR-SELECTL (PV-SUB)       20331010
203400**??     MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)       20340010
203500**??     MOVE DP015-YELLOW           TO MR-SELECTC (PV-SUB)       20350010
203600     END-IF.                                                      20360002
203700                                                                  20370002
203800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   20380002
203900                    - PV-TOP-ITEM + 1.                            20390002
204000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20400002
204100         CONTINUE                                                 20410002
204200     ELSE                                                         20420002
204300         SET DP030-SET-CURSOR-APPL-1                              20430002
204400                                   TO TRUE                        20440002
204500**??     MOVE -1                   TO MR-SELECTL (PV-SUB)         20450010
204600**??     MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20460010
204700**??     MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         20470010
204800     END-IF.                                                      20480002
204900                                                                  20490002
205000*----------------------------------------------------------------*20500002
205100* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *20510002
205200* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *20520002
205300* FOR THE SELECTED ITEMS QUEUE.                                  *20530002
205400*                                                                *20540002
205500* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *20550002
205600* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *20560002
205700* THE ARRAY IS FULL.                                             *20570002
205800*----------------------------------------------------------------*20580002
205900 5000-PREPARE-SEL-QUEUE.                                          20590002
206000     MOVE +1                   TO  ASC-BLK-SUB.                   20600002
206100     PERFORM 5100-WRITE-TEMP-STORAGE.                             20610002
206200     ADD +1                    TO  ASC-BLK-SUB.                   20620002
206300     PERFORM 5100-WRITE-TEMP-STORAGE.                             20630002
206400                                                                  20640002
206500     MOVE ASC-SEL-QUEUE-NAME   TO  SU089-SEL-QUEUE-NAME.          20650002
206600     PERFORM 6010-DELETE-SEL-QUEUE.                               20660002
206700                                                                  20670002
206800     SET ASC-UPDATE-TSQ        TO  TRUE.                          20680002
206900                                                                  20690002
207000     SET SU088-IDX             TO  1.                             20700002
207100     MOVE ZERO                 TO SU089-NUMBER-OF-TS-ITEMS.       20710002
207200     INITIALIZE SU088-SELECTED-ITEM-ARRAY.                        20720002
207300                                                                  20730002
207400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           20740002
207500             VARYING PV-ITEM                                      20750002
207600             FROM 1 BY 1                                          20760002
207700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     20770002
207800                                                                  20780002
207900     IF  SU088-IDX > 1                                            20790002
208000         PERFORM 5205-WRITE-SEL-QUEUE                             20800002
208100         ADD +1                TO SU089-NUMBER-OF-TS-ITEMS        20810002
208200     END-IF.                                                      20820002
208300                                                                  20830002
208400*----------------------------------------------------------------*20840002
208500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *20850002
208600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *20860002
208700*----------------------------------------------------------------*20870002
208800 5100-WRITE-TEMP-STORAGE.                                         20880002
208900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     20890002
209000                                   TO PV-LIST-ITEM-NUMBER.        20900002
209100     COMPUTE PV-BLOCK-NUMBER =                                    20910002
209200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20920002
209300                                                                  20930002
209400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             20940002
209500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             20950002
209600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      20960002
209700             PERFORM 5105-REWRITE-ASC-LISTQ                       20970002
209800         END-IF                                                   20980002
209900     ELSE                                                         20990002
210000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       21000002
210100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            21010002
210200         PERFORM 5110-WRITE-ASC-LISTQ                             21020002
210300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   21030002
210400     END-IF.                                                      21040002
210500                                                                  21050002
210600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             21060002
210700                                                                  21070002
210800******************************************************************21080002
210900** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **21090002
211000** SPECIFIC COMMAREA.                                           **21100002
211100******************************************************************21110002
211200 5105-REWRITE-ASC-LISTQ.                                          21120002
211300     EXEC CICS                                                    21130002
211400         WRITEQ TS                                                21140002
211500             QUEUE (ASC-LIST-QUEUE-NAME)                          21150002
211600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21160002
211700             ITEM  (PV-BLOCK-NUMBER)                              21170002
211800             REWRITE                                              21180002
211900             RESP  (PV-CICS-RESP)                                 21190002
212000     END-EXEC.                                                    21200002
212100                                                                  21210002
212200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           21220002
212300         CONTINUE                                                 21230002
212400     ELSE                                                         21240002
212500         SET DP013-CICS-ABEND            TO TRUE                  21250002
212600         SET DP013-NO-ROLLBACK           TO TRUE                  21260002
212700         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       21270002
212800         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     21280002
212900                                         TO DP013-MESSAGE-TEXT(1) 21290002
213000         PERFORM DP013-0000-PROCESS-ABEND                         21300002
213100     END-IF.                                                      21310002
213200                                                                  21320002
213300******************************************************************21330002
213400** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **21340002
213500** SPECIFIC COMMAREA.                                           **21350002
213600******************************************************************21360002
213700 5110-WRITE-ASC-LISTQ.                                            21370002
213800     EXEC CICS                                                    21380002
213900         WRITEQ TS                                                21390002
214000             QUEUE (ASC-LIST-QUEUE-NAME)                          21400002
214100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21410002
214200             ITEM  (PV-BLOCK-NUMBER)                              21420002
214300             RESP  (PV-CICS-RESP)                                 21430002
214400     END-EXEC.                                                    21440002
214500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      21450002
214600         SET DP013-CICS-ABEND      TO TRUE                        21460002
214700         SET DP013-NO-ROLLBACK     TO TRUE                        21470002
214800         MOVE '5110-WRITE-ASC-LISTQ'                              21480002
214900                                   TO DP013-PARAGRAPH             21490002
215000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           21500002
215100                                   TO DP013-MESSAGE-TEXT(1)       21510002
215200         PERFORM DP013-0000-PROCESS-ABEND                         21520002
215300     END-IF.                                                      21530002
215400                                                                  21540002
215500*----------------------------------------------------------------*21550002
215600* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *21560002
215700* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *21570002
215800*----------------------------------------------------------------*21580002
215900 5200-FILL-SEL-QUEUE-RECORD.                                      21590002
216000     PERFORM 6112-READ-LIST-QUEUE.                                21600002
216100                                                                  21610002
216200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       21620002
216300         PERFORM VARYING LQW-IDX                                  21630002
216400         FROM 1 BY 1                                              21640002
216500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            21650002
216600           OR  LQW-LIST-ITEM-NUMBER(LQW-IDX) = ZERO               21660002
216700                                                                  21670002
216800           IF LQW-SELECT (LQW-IDX)                                21680002
216900                 MOVE LQW-LIST-ITEM-NUMBER(LQW-IDX) TO            21690002
217000                                            SU088-ITEM (SU088-IDX)21700002
217100                 MOVE LQW-ACTION (LQW-IDX)                        21710002
217200                                   TO SU088-ACTION-SW (SU088-IDX) 21720002
217300                 MOVE LQW-TK-TP-ASSIGNED (LQW-IDX)                21730004
217400                                 TO SU088-TRAILER     (SU088-IDX) 21740004
217500                                                                  21750002
217600                 SET SU088-IDX UP BY 1                            21760002
217700                 IF  SU088-IDX > SU088-MAX-ITEMS                  21770002
217800                     PERFORM 5205-WRITE-SEL-QUEUE                 21780002
217900                     ADD +1        TO SU089-NUMBER-OF-TS-ITEMS    21790002
218000                     INITIALIZE SU088-SELECTED-ITEM-ARRAY         21800002
218100                     SET SU088-IDX TO  1                          21810002
218200                 END-IF                                           21820002
218300           END-IF                                                 21830002
218400         END-PERFORM                                              21840002
218500     END-IF.                                                      21850002
218600                                                                  21860002
218700*----------------------------------------------------------------*21870002
218800*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *21880002
218900*----------------------------------------------------------------*21890002
219000 5205-WRITE-SEL-QUEUE.                                            21900002
219100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO SU088-SELECTED-ITEMS.   21910002
219200                                                                  21920002
219300     EXEC CICS                                                    21930002
219400          WRITEQ TS                                               21940002
219500              QUEUE (ASC-SEL-QUEUE-NAME)                          21950002
219600              FROM  (SU088-SELECT-RECORD)                         21960002
219700              ITEM  (PV-SEL-QUEUE-ITEM)                           21970002
219800              RESP  (PV-CICS-RESP)                                21980002
219900     END-EXEC.                                                    21990002
220000                                                                  22000002
220100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22010002
220200         CONTINUE                                                 22020002
220300     ELSE                                                         22030002
220400         SET DP013-CICS-ABEND      TO TRUE                        22040002
220500         SET DP013-NO-ROLLBACK     TO TRUE                        22050002
220600         MOVE '5205-WRITE-SEL-QUEUE'                              22060002
220700                                   TO DP013-PARAGRAPH             22070002
220800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          22080002
220900                                   TO DP013-MESSAGE-TEXT(1)       22090002
221000         PERFORM DP013-0000-PROCESS-ABEND                         22100002
221100     END-IF.                                                      22110002
221200                                                                  22120002
221300******************************************************************22130002
221400** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **22140002
221500** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **22150002
221600** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **22160002
221700** THE USER.                                                    **22170002
221800******************************************************************22180002
221900 6000-REFRESH-PANEL-FROM-TEMP.                                    22190002
222000     IF  ASC-UPDATE-TSQ                                           22200002
222100         SET ASC-NO-TSQ-UPDATE TO TRUE                            22210002
222200         MOVE ZERO                 TO PV-SAVE-ITEM                22220002
222300                                      PV-SEL-QUEUE-ITEM           22230002
222400         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        22240002
222500                                   TO PV-HOLD-SELECTED-ITEMS      22250002
222600         MOVE +1                   TO PV-ITEMS-PROCESSED          22260002
222700         PERFORM 6100-UPDATE-TSQ                                  22270002
222800             UNTIL PV-ITEMS-PROCESSED >                           22280002
222900                                     PV-HOLD-SELECTED-ITEMS       22290002
223000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         22300002
223100                    ASC-BLOCK-ENTRIES (2)                         22310002
223200     END-IF.                                                      22320002
223300                                                                  22330002
223400*----------------------------------------------------------------*22340002
223500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *22350002
223600*----------------------------------------------------------------*22360002
223700 6010-DELETE-SEL-QUEUE.                                           22370002
223800                                                                  22380002
223900     EXEC CICS                                                    22390002
224000         DELETEQ TS                                               22400002
224100             QUEUE (ASC-SEL-QUEUE-NAME)                           22410002
224200             RESP  (PV-CICS-RESP)                                 22420002
224300     END-EXEC.                                                    22430002
224400*                                                                 22440002
224500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      22450002
224600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         22460002
224700         CONTINUE                                                 22470002
224800     ELSE                                                         22480002
224900         SET DP013-CICS-ABEND TO TRUE                             22490002
225000         SET DP013-NO-ROLLBACK TO TRUE                            22500002
225100         MOVE '6010-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          22510002
225200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         22520002
225300                                        TO DP013-MESSAGE-TEXT (1) 22530002
225400         PERFORM DP013-0000-PROCESS-ABEND                         22540002
225500     END-IF.                                                      22550002
225600                                                                  22560002
225700*----------------------------------------------------------------*22570002
225800*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *22580002
225900*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *22590002
226000*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *22600002
226100*    THE TEMP QUEUE.                                             *22610002
226200*----------------------------------------------------------------*22620002
226300 6100-UPDATE-TSQ.                                                 22630002
226400                                                                  22640002
226500     ADD 1    TO  PV-SEL-QUEUE-ITEM.                              22650002
226600     PERFORM 6105-READ-SEL-QUEUE.                                 22660002
226700     PERFORM                                                      22670002
226800         VARYING SU088-IDX FROM 1 BY 1                            22680002
226900         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     22690002
227000         OR (SU088-IDX GREATER THAN SU088-MAX-ITEMS))             22700002
227100         IF  SU088-ACTION-SW (SU088-IDX) > SPACE                  22710002
227200             PERFORM 6110-PROCESS-ITEMS                           22720002
227300         END-IF                                                   22730002
227400         ADD +1                TO PV-ITEMS-PROCESSED              22740002
227500     END-PERFORM.                                                 22750002
227600     PERFORM 6111-WRITE-LIST-QUEUE.                               22760002
227700                                                                  22770002
227800*----------------------------------------------------------------*22780002
227900*    READ THE LIST QUEUE RECORD.                                 *22790002
228000*----------------------------------------------------------------*22800002
228100 6105-READ-SEL-QUEUE.                                             22810002
228200                                                                  22820002
228300     EXEC CICS                                                    22830002
228400          READQ TS                                                22840002
228500              QUEUE (ASC-SEL-QUEUE-NAME)                          22850002
228600              INTO  (SU088-SELECT-RECORD)                         22860002
228700              ITEM  (PV-SEL-QUEUE-ITEM)                           22870002
228800              RESP  (PV-CICS-RESP)                                22880002
228900     END-EXEC.                                                    22890002
229000*                                                                 22900002
229100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22910002
229200         CONTINUE                                                 22920002
229300     ELSE                                                         22930002
229400         SET DP013-CICS-ABEND      TO  TRUE                       22940002
229500         SET DP013-NO-ROLLBACK     TO  TRUE                       22950002
229600         MOVE '6105-READ-SEL-QUEUE'                               22960002
229700                                   TO  DP013-PARAGRAPH            22970002
229800         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           22980002
229900                                   TO  DP013-MESSAGE-TEXT(1)      22990002
230000         PERFORM DP013-0000-PROCESS-ABEND                         23000002
230100     END-IF.                                                      23010002
230200                                                                  23020002
230300*----------------------------------------------------------------*23030002
230400*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*23040002
230500*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*23050002
230600*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *23060002
230700*----------------------------------------------------------------*23070002
230800 6110-PROCESS-ITEMS.                                              23080002
230900                                                                  23090002
231000     COMPUTE PV-ITEM = 1 + ((SU088-ITEM (SU088-IDX) - 1)          23100002
231100                     / PC-ITEMS-PER-PANEL).                       23110002
231200                                                                  23120002
231300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           23130002
231400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          23140002
231500             PERFORM 6111-WRITE-LIST-QUEUE                        23150002
231600         END-IF                                                   23160002
231700         MOVE PV-ITEM          TO PV-SAVE-ITEM                    23170002
231800                                                                  23180002
231900         PERFORM 6112-READ-LIST-QUEUE                             23190002
232000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               23200002
232100             CONTINUE                                             23210002
232200         END-IF                                                   23220002
232300     END-IF.                                                      23230002
232400                                                                  23240002
232500     COMPUTE PV-SUB = (SU088-ITEM (SU088-IDX)                     23250002
232600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              23260002
232700     SET LQW-DESELECT (PV-SUB) TO    TRUE                         23270002
232800     MOVE LQW-SELECTED-SW (PV-SUB)                                23280002
232900                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  23290002
233000     EVALUATE TRUE                                                23300002
233100         WHEN SU088-INQ (SU088-IDX)                               23310002
233200              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             23320002
233300                                                                  23330002
233400         WHEN SU088-UPD (SU088-IDX)                               23340002
233500              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             23350002
233600              MOVE SU088-TRAILER     (SU088-IDX)                  23360004
233700                               TO LQW-TK-TP-ASSIGNED (PV-SUB)     23370004
233800                                                                  23380002
233900         WHEN SU088-DEL (SU088-IDX)                               23390002
234000              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             23400002
234100                                                                  23410002
234200         WHEN SU088-ERR (SU088-IDX)                               23420002
234300              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             23430002
234400                                                                  23440002
234500         WHEN OTHER                                               23450002
234600              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             23460002
234700                                                                  23470002
234800     END-EVALUATE.                                                23480002
234900                                                                  23490002
235000     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                23500002
235100                                                                  23510002
235200*----------------------------------------------------------------*23520002
235300*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *23530002
235400*----------------------------------------------------------------*23540002
235500 6111-WRITE-LIST-QUEUE.                                           23550002
235600                                                                  23560002
235700     EXEC CICS                                                    23570002
235800         WRITEQ TS                                                23580002
235900             QUEUE (ASC-LIST-QUEUE-NAME)                          23590002
236000             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     23600002
236100             ITEM  (PV-SAVE-ITEM)                                 23610002
236200             REWRITE                                              23620002
236300             RESP  (PV-CICS-RESP)                                 23630002
236400     END-EXEC.                                                    23640002
236500*                                                                 23650002
236600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23660002
236700         CONTINUE                                                 23670002
236800     ELSE                                                         23680002
236900         SET DP013-CICS-ABEND  TO  TRUE                           23690002
237000         SET DP013-NO-ROLLBACK TO  TRUE                           23700002
237100         MOVE '6111-WRITE-LIST-QUEUE' TO  DP013-PARAGRAPH         23710002
237200         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  23720002
237300                               TO  DP013-MESSAGE-TEXT(1)          23730002
237400         PERFORM DP013-0000-PROCESS-ABEND                         23740002
237500     END-IF.                                                      23750002
237600                                                                  23760002
237700*----------------------------------------------------------------*23770002
237800*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*23780002
237900*----------------------------------------------------------------*23790002
238000 6112-READ-LIST-QUEUE.                                            23800002
238100     EXEC CICS                                                    23810002
238200         READQ TS                                                 23820002
238300             QUEUE (ASC-LIST-QUEUE-NAME)                          23830002
238400             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     23840002
238500             ITEM  (PV-ITEM)                                      23850002
238600             RESP  (PV-CICS-RESP)                                 23860002
238700     END-EXEC.                                                    23870002
238800*                                                                 23880002
238900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23890002
239000         CONTINUE                                                 23900002
239100     ELSE                                                         23910002
239200         SET DP013-CICS-ABEND        TO TRUE                      23920002
239300         SET DP013-NO-ROLLBACK       TO TRUE                      23930002
239400         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           23940002
239500         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    23950002
239600                                     TO DP013-MESSAGE-TEXT(1)     23960002
239700         PERFORM DP013-0000-PROCESS-ABEND                         23970002
239800     END-IF.                                                      23980002
239810                                                                  23981009
239820*----------------------------------------------------------------*23982009
239830* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *23983009
239840*----------------------------------------------------------------*23984009
239850 9100-READ-SEL-QUEUE.                                             23985009
239860     EXEC CICS                                                    23986009
239870         READQ TS                                                 23987009
239880             QUEUE (ASC-SEL-QUEUE-NAME)                           23988009
239890             INTO  (SU088-SELECT-RECORD)                          23989009
239891             ITEM  (ASC-SEL-ITEM)                                 23989109
239892             RESP  (PV-CICS-RESPONSE)                             23989209
239893     END-EXEC.                                                    23989309
239894                                                                  23989409
239895     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       23989509
239896         CONTINUE                                                 23989609
239897     ELSE                                                         23989709
239898         SET DP013-LOGIC-ABEND                                    23989809
239899             DP013-NO-ROLLBACK     TO TRUE                        23989909
239900         MOVE '9100-READ-SEL-QUEUE' TO DP013-PARAGRAPH            23990009
239901         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   23990109
239902                                   TO DP013-MESSAGE-TEXT (1)      23990209
239903         PERFORM DP013-0000-PROCESS-ABEND                         23990309
239904     END-IF.                                                      23990409
239905                                                                  23990509
239906*----------------------------------------------------------------*23990609
239907* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *23990709
239908*----------------------------------------------------------------*23990809
239909 9200-REWRITE-SEL-QUEUE.                                          23990909
239910     EXEC CICS                                                    23991009
239911          WRITEQ TS                                               23991109
239912              QUEUE  (ASC-SEL-QUEUE-NAME)                         23991209
239913              FROM   (SU088-SELECT-RECORD)                        23991309
239914              ITEM   (ASC-SEL-ITEM)                               23991409
239915              RESP   (PV-CICS-RESPONSE)                           23991509
239916              REWRITE                                             23991609
239917     END-EXEC.                                                    23991709
239918                                                                  23991809
239919     IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                   23991909
239920         SET DP013-CICS-ABEND                                     23992009
239921             DP013-NO-ROLLBACK     TO TRUE                        23992109
239922         MOVE '9200-REWRITE-SEL-QUEUE'  TO DP013-PARAGRAPH        23992209
239923         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   23992309
239924                                   TO DP013-MESSAGE-TEXT (1)      23992409
239925         PERFORM DP013-0000-PROCESS-ABEND                         23992509
239926     END-IF.                                                      23992609
239930                                                                  23993002
240000*----------------------------------------------------------------*24000002
240100*    ABEND PROCESSOR MODULE                                      *24010002
240200*----------------------------------------------------------------*24020002
240300     COPY DPPD013.                                                24030002
