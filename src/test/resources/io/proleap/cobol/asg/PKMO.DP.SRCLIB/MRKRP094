000100*************************                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*************************                                         00030000
000400 PROGRAM-ID.      MRKRP094.                                       00040000
000500 AUTHOR.          ANNE KINTOPF.                                   00050000
000600 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060000
000700 DATE-WRITTEN.    ??/??/??.                                       00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000* THIS PROGRAM WILL CREATE A REPORT TO DETERMINE WHETHER INFOREM *00100000
001100* IS PERFORMING AS DESIRED.                                      *00110000
001200******************************************************************00120000
001300*                                                                 00130000
001400* CHANGED 01/16/2001 BY ANNE KINTOPF                              00140000
001500*   WR# 21599                                                     00150000
001600*   MODIFIED CURSORS AND SINGELTON SELECTS THAT USE THE TMRITST   00160000
001700*   TABLE SO THEY ALSO USE THE TSTR000 TABLE TO EXCLUDE THE       00170000
001800*   TMRITST ROW IF THE STORE NUMBER IS AN E-COMMERCE STORE.       00180000
001900*                                                                 00190000
002000* CHANGED 05/01/2001 BY MIKE BANSEMAR (COMPUWARE)                 00200000
002100*   WR# 21839                                                     00210000
002200*   A) ADDED SUBCLASS TO GROUP CODE LEVEL PROCESSING              00220000
002300*   B) MODIFIED CURSORS USING TSTR000 TO CHECK FOR THE            00230000
002400*      CONDITION WHERE OP_CO_NMBR = '03' (PC-CO-NMBR)             00240000
002500***************************************************************** 00250000
002600*                                                                 00260000
002700* CHANGED 10/15/2001 BY NICK MOULTON    WR#21601                  00270000
002800*   UPDATES FOR NI-SKU:                                           00280000
002900*     - ADDED ACCESS TO TSKXREF WHEN NECESSARY.                   00290000
003000*     - CHANGED REPORT TO REFLECT INCREASED FIELD SIZES.          00300000
003010*   OPTIMIZED PROGRAM FOR PERFORMANCE                             00310000
003020*     - REPLACED PROGRAM CONSTANTS IN SQL STATEMENTS WITH THE     00320000
003030*       LITERAL VALUES.                                           00330000
002500***************************************************************** 00340000
002600*                                                                 00350000
002700* CHANGED 07/25/2002 BY LINDA FRIESS    PITS# PM00482645          00360000
002800*   ADDED VSAM STATUS CODE 97 (VERIFY) AS ACCEPTABLE FOR          00370000
002800*   EXCEPTION FILE & BIM FILE.                                    00380000
003100******************************************************************00390000
002600*                                                                 00400000
002700* CHANGED 03/11/2003 BY ANNE KINTOPF    PITS#                     00410000
002800*   ADDED CODE TO MOVE SPACES TO THE DL2-RPT-LVL-DATA FIELD       00420000
002800*   BEFORE FORMATTING THE HEADER ROW.                             00430000
003100******************************************************************00440000
002600*                                                                 00450000
002700* CHANGED 07/01/2004 BY BOB FORD        WR# 26363                 00460000
002800*   CHANGED PROGRAM TO HANDLE 5 DIGIT STORE AS PART OF STORE      00470000
002800*   NUMBER EXPANSION.  CHANGED CURSORS AND SELECTS TO USE XMT_LOC 00480000
002800*   INSTEAD OF TSTR000.  CHANGED TO USE MHT_DLY_SLS FOR SALES INFO00490000
002800*   INSTEAD OF TSKSTWKS.                                          00500000
003100******************************************************************00510000
003200                                                                  00520000
003300 ENVIRONMENT DIVISION.                                            00530000
003400                                                                  00540000
003500 CONFIGURATION SECTION.                                           00550000
003600 SOURCE-COMPUTER. IBM-3090.                                       00560000
003700 OBJECT-COMPUTER. IBM-3090.                                       00570000
003800                                                                  00580000
003900 INPUT-OUTPUT SECTION.                                            00590000
004000 FILE-CONTROL.                                                    00600000
004100                                                                  00610000
004200     SELECT EXCEPTION-FILE     ORGANIZATION IS INDEXED            00620000
004300                               ACCESS       IS RANDOM             00630000
004400                               RECORD KEY   IS EXCEPTION-KEY      00640000
004500                               ASSIGN       TO INP01              00650000
004600                               FILE STATUS  IS SC-EXCEPT-STATUS.  00660000
004700                                                                  00670000
004800     SELECT BIM-FILE           ASSIGN       TO INP02              00680000
004900                               ORGANIZATION IS INDEXED            00690000
005000                               ACCESS       IS RANDOM             00700000
005100                               RECORD KEY   IS BIM-FILE-KEY       00710000
005200                               FILE STATUS  IS SC-BIM-STATUS.     00720000
005300                                                                  00730000
005400     SELECT IC-PARM-FILE       ASSIGN       TO INP03.             00740000
005500                                                                  00750000
005600     SELECT PRINT-REPORT       ASSIGN       TO RPT01.             00760000
005700                                                                  00770000
005800     EJECT                                                        00780000
005900                                                                  00790000
006000***************                                                   00800000
006100 DATA DIVISION.                                                   00810000
006200***************                                                   00820000
006300                                                                  00830000
006400 FILE SECTION.                                                    00840000
006500                                                                  00850000
006600 FD  EXCEPTION-FILE.                                              00860000
006700                                                                  00870000
006800 01  EXCEPTION-REC.                                               00880000
006900     05  EXCEPTION-KEY               PIC  X(4).                   00890000
007000     05  EXCEPTION-KEY-NBR  REDEFINES                             00900000
007100         EXCEPTION-KEY               PIC  9(4).                   00910000
007200     05  FILLER                      PIC  X(76).                  00920000
007300                                                                  00930000
007400 FD  BIM-FILE.                                                    00940000
007500                                                                  00950000
007600 01  BIM-REC.                                                     00960000
007700     05  BIM-FILE-KEY                PIC  X(07).                  00970000
007800     05  FILLER                      PIC  X(228).                 00980000
007900                                                                  00990000
008000 FD  IC-PARM-FILE                                                 01000000
008100     RECORDING MODE IS F.                                         01010000
008200                                                                  01020000
008300 01  IC-PARM-REC.                                                 01030000
008400     05  FILLER                      PIC  X(80).                  01040000
008500                                                                  01050000
008600 FD  PRINT-REPORT                                                 01060000
008700     LABEL RECORDS ARE STANDARD                                   01070000
008800     RECORDING MODE IS F                                          01080000
008900     BLOCK CONTAINS 0 RECORDS.                                    01090000
009000                                                                  01100000
009100 01  PRINT-LINE                       PIC X(132).                 01110000
009200                                                                  01120000
009300 WORKING-STORAGE SECTION.                                         01130000
009400                                                                  01140000
009500 01  FILLER.                                                      01150000
009600     05  FILLER                      PIC  X(36)    VALUE          01160000
009700        ' ***** WORKING STORAGE PGM=MRKRP094 '.                   01170000
009800     05  FILLER                      PIC  X(10)    VALUE          01180000
009900         ' LOCATION='.                                            01190000
010000     05  PGM-LOCATION                PIC  X(05)    VALUE SPACE.   01200000
010100     05  FILLER                      PIC  X(06)    VALUE          01210000
010200         ' *****'.                                                01220000
010300 EJECT                                                            01230000
010400                                                                  01240000
010500****************************************************************  01250000
010600** STANDARD HEADER LINE - KOHLS 132 COL                           01260000
010700****************************************************************  01270000
010800     COPY DPWS132.                                                01280000
010900                                                                  01290000
011000*---------------------------------------------------------------* 01300000
011100*   COPYBOOK FOR DATE MODULE                                      01310000
011200*---------------------------------------------------------------* 01320000
011300     COPY DPWS500.                                                01330000
011400*                                                                 01340000
011500     COPY MRRD001I.                                               01350000
011600*                                                                 01360000
011700                                                                  01370000
011800 01  CT-CPU-TIME.                                                 01380000
011900     05  CT-CPU-HR                    PIC 9(2)       VALUE ZEROS. 01390000
012000     05  CT-CPU-MIN                   PIC 9(2)       VALUE ZEROS. 01400000
012100     05  CT-CPU-SEC                   PIC 9(2)       VALUE ZEROS. 01410000
012200     05  CT-CPU-HSEC                  PIC 9(2)       VALUE ZEROS. 01420000
012300                                                                  01430000
012400 01  CD-SCHEDULE-DATE            PIC X(10).                       01440000
012500 01  CD-DATE REDEFINES CD-SCHEDULE-DATE.                          01450000
012600     05  CD-YEAR                 PIC 9(4).                        01460000
012700     05  FILLER                  PIC X.                           01470000
012800     05  CD-MONTH                PIC 99.                          01480000
012900     05  FILLER                  PIC X.                           01490000
013000     05  CD-DAY                  PIC 99.                          01500000
013100                                                                  01510000
013200 01  END-OF-REPORT-LINE.                                          01520000
013300     05  FILLER                       PIC X(25)      VALUE        01530000
013400         ' ** END OF REPORT **     '.                             01540000
013500                                                                  01550000
013600 01  HL-HEADING-BLANK.                                            01560000
013700     05  FILLER                       PIC X(132)     VALUE        01570000
013800         '                    '.                                  01580000
013900                                                                  01590000
014000 01  HL-HEADING-LINE1.                                            01600000
014100     05  FILLER                       PIC X(50)      VALUE SPACE. 01610000
014200     05  FILLER                       PIC X(23)      VALUE        01620000
014300         'FORECAST VS. ACTUAL  - '.                               01630000
014400     05  HL-SYSID                     PIC X(2)       VALUE SPACE. 01640000
014500     05  FILLER                       PIC X(8)       VALUE        01650000
014600         ' SYSTEM '.                                              01660000
014700     05  FILLER                       PIC X(49)      VALUE SPACE. 01670000
014800                                                                  01680000
014900 01  DETAIL-LINE1.                                                01690000
015000     05  FILLER                       PIC X(12)      VALUE        01700000
015100         '        DPT:'.                                          01710000
015200     05  DL1-DEPARTMENT               PIC ZZZ9.                   01720000
015300     05  FILLER                       PIC X(03)      VALUE SPACES.01730000
015400     05  DL1-MCL-TITLE                PIC X(04)      VALUE SPACES.01740000
015500     05  DL1-MCL                      PIC X(04)      VALUE SPACES.01750000
015600     05  DL1-MCL-94 REDEFINES DL1-MCL PIC ZZZ9.                   01760000
015700     05  FILLER                       PIC X(03)      VALUE SPACES.01770000
015800     05  DL1-SCL-TITLE                PIC X(04)      VALUE SPACES.01780000
015900     05  DL1-SCL                      PIC X(04)      VALUE SPACES.01790000
016000     05  DL1-SCL-94 REDEFINES DL1-SCL PIC ZZZ9.                   01800000
016100     05  FILLER                       PIC X(94)      VALUE SPACES.01810000
016200                                                                  01820000
016300 01  DETAIL-LINE2.                                                01830000
016400     05  DL2-RPT-LVL                  PIC X(12).                  01840000
016500     05  DL2-DATA.                                                01850000
016600         10  FILLER                   PIC X(01)      VALUE SPACE. 01860000
016700         10  DL2-RPT-LVL-DATA         PIC X(40)      VALUE SPACES.01870000
016800     05  DL2-DATA-NUM REDEFINES DL2-DATA.                         01880000
016900         10  DL2-RPT-LVL-DATA-94      PIC ZZZ9.                   01890000
017000         10  FILLER                   PIC X(37).                  01900000
017100     05  FILLER                       PIC X(10)      VALUE        01910000
017200         ' MAX LT:  '.                                            01920000
017300     05  DL2-LEAD-TIME                PIC X(03).                  01930000
017400     05  FILLER                       PIC X(20)      VALUE        01940000
017500         '      AVG. OSTRAT:  '.                                  01950000
017600     05  DL2-AVG-OSTRAT               PIC ZZ9.9.                  01960000
017700     05  FILLER                       PIC X(41)      VALUE SPACE. 01970000
017800                                                                  01980000
017900 01  DETAIL-LINE3.                                                01990000
018000     05  FILLER                       PIC X(13)      VALUE        02000000
018100         '    ONORDER: '.                                         02010000
018200     05  DL3-ONORDER                  PIC ZZZZZZ9.                02020000
018300     05  FILLER                       PIC X(20)      VALUE        02030000
018400         '              WOS:  '.                                  02040000
018500     05  DL3-WOS-ONHAND               PIC X(03).                  02050000
018600     05  FILLER                       PIC X(19)      VALUE        02060000
018700         '    WEEKS ONORDER: '.                                   02070000
018800     05  DL3-WOS-ONORDER              PIC X(03).                  02080000
018900     05  FILLER                       PIC X(24)      VALUE        02090000
019000         '     WOS ABOVE CSTOCK:  '.                              02100000
019100     05  DL3-WOS-CSTOCK               PIC X(03).                  02110000
019200     05  FILLER                       PIC X(20)      VALUE        02120000
019300         '          % CSTOCK: '.                                  02130000
019400     05  DL3-PCNT-CSTOCK              PIC ZZ9.                    02140000
019500     05  FILLER                       PIC X(15)     VALUE SPACE.  02150000
019600                                                                  02160000
019700 01  DETAIL-LINE4.                                                02170000
019800     05  FILLER                       PIC X(32)      VALUE SPACE. 02180000
019900     05  FILLER                       PIC X(50)      VALUE        02190000
020000         'LAST 4 WEEKS                     4 WEEK   CURRENT '.    02200000
020100     05  FILLER                       PIC X(50)      VALUE        02210000
020200         '                FORECAST NEXT 5 WEEKS             '.    02220000
020300                                                                  02230000
020400 01  DETAIL-LINE5.                                                02240000
020500     05  FILLER                       PIC X(25)      VALUE        02250000
020600         '                    WEEK '.                             02260000
020700     05  DL5-LAST-WEEK-1              PIC 9(2).                   02270000
020800     05  FILLER                       PIC X(9)       VALUE        02280000
020900         '    WEEK '.                                             02290000
021000     05  DL5-LAST-WEEK-2              PIC 9(2).                   02300000
021100     05  FILLER                       PIC X(9)       VALUE        02310000
021200         '    WEEK '.                                             02320000
021300     05  DL5-LAST-WEEK-3              PIC 9(2).                   02330000
021400     05  FILLER                       PIC X(9)       VALUE        02340000
021500         '    WEEK '.                                             02350000
021600     05  DL5-LAST-WEEK-4              PIC 9(2).                   02360000
021700     05  FILLER                       PIC X(12)      VALUE        02370000
021800         '      TOTAL '.                                          02380000
021900     05  FILLER                       PIC X(7)       VALUE        02390000
022000         '  WEEK '.                                               02400000
022100     05  DL5-CURRENT-WEEK             PIC 9(2).                   02410000
022200     05  FILLER                       PIC X(9)       VALUE        02420000
022300         '   WEEK '.                                              02430000
022400     05  DL5-FRCST-WEEK-1             PIC 9(2).                   02440000
022500     05  FILLER                       PIC X(8)       VALUE        02450000
022600         '   WEEK '.                                              02460000
022700     05  DL5-FRCST-WEEK-2             PIC 9(2).                   02470000
022800     05  FILLER                       PIC X(8)       VALUE        02480000
022900         '   WEEK '.                                              02490000
023000     05  DL5-FRCST-WEEK-3             PIC 9(2).                   02500000
023100     05  FILLER                       PIC X(8)       VALUE        02510000
023200         '   WEEK '.                                              02520000
023300     05  DL5-FRCST-WEEK-4             PIC 9(2).                   02530000
023400     05  FILLER                       PIC X(8)      VALUE         02540000
023500         '   WEEK '.                                              02550000
023600     05  DL5-FRCST-WEEK-5             PIC 9(2).                   02560000
023700                                                                  02570000
023800 01  DETAIL-LINE6.                                                02580000
023900     05  FILLER                       PIC X(18)      VALUE        02590000
024000         'DD                '.                                    02600000
024100     05  DL6-DD-WEEK-TABLE            OCCURS 4 TIMES.             02610000
024200         10  DL6-DD                   PIC Z,ZZZ,ZZ9.              02620000
024300         10  FILLER                   PIC X(2)      VALUE SPACE.  02630000
024400     05  FILLER                       PIC X(10)     VALUE SPACE.  02640000
024500     05  DL6-DD-CURR                  PIC Z,ZZZ,ZZ9.              02650000
024600     05  FILLER                       PIC X(51)      VALUE SPACE. 02660000
024700                                                                  02670000
024800 01  DETAIL-LINE7.                                                02680000
024900     05  FILLER                       PIC X(18)      VALUE        02690000
025000         'FORECAST          '.                                    02700000
025100     05  DL7-HIST-FRCST-TABLE         OCCURS 4 TIMES.             02710000
025200         10  DL7-HIST-FRCST           PIC Z,ZZZ,ZZ9.              02720000
025300         10  FILLER                   PIC X(2)       VALUE SPACE. 02730000
025400     05  DL7-CUMM-FRCST               PIC Z,ZZZ,ZZ9.              02740000
025500     05  FILLER                       PIC X(1)       VALUE SPACE. 02750000
025600     05  DL7-CURRENT-FRCST            PIC Z,ZZZ,ZZ9.              02760000
025700     05  FILLER                       PIC X(1)       VALUE SPACE. 02770000
025800     05  DL7-FUTURE-FRCST-TABLE              OCCURS 5 TIMES.      02780000
025900         10  FILLER                   PIC X(1)       VALUE SPACE. 02790000
026000         10  DL7-FUTURE-FRCST         PIC Z,ZZZ,ZZ9.              02800000
026100                                                                  02810000
026200 01  DETAIL-LINE8.                                                02820000
026300     05  FILLER                       PIC X(18)      VALUE        02830000
026400         'ACTUAL SALES      '.                                    02840000
026500     05  DL8-SALES-TABLE                      OCCURS 4 TIMES.     02850000
026600         10  DL8-SALES                PIC Z,ZZZ,ZZ9.              02860000
026700         10  FILLER                   PIC X(2)       VALUE SPACE. 02870000
026800     05  DL8-CUMM-SALES               PIC Z,ZZZ,ZZ9.              02880000
026900     05  FILLER                       PIC X(61)      VALUE SPACE. 02890000
027000                                                                  02900000
027100 01  DETAIL-LINE9.                                                02910000
027200     05  FILLER                       PIC X(22)      VALUE        02920000
027300         '% DIFFERENCES    '.                                     02930000
027400     05  DL9-DIFFERENCE-TABLE                 OCCURS 4 TIMES.     02940000
027500         10  DL9-DIFFRNC-N            PIC ---9.                   02950000
027600         10  DL9-DIFFRNC-ALPHA REDEFINES DL9-DIFFRNC-N.           02960000
027700             15  DL9-DIFFRNC          PIC X(4).                   02970000
027800         10  FILLER                   PIC X(7)                    02980000
027900                                      VALUE '%      '.            02990000
028000     05  DL9-CUMM-DIFFRNC             PIC ---9.                   03000000
028100     05  FILLER                       PIC X(1)       VALUE '%'.   03010000
028200     05  FILLER                       PIC X(60)      VALUE SPACE. 03020000
028300                                                                  03030000
028400                                                                  03040000
028500 01  DETAIL-LINE10.                                               03050000
028600     05  FILLER                       PIC X(18)      VALUE        03060000
028700         'ONHAND            '.                                    03070000
028800     05  DL10-ONHAND-TABLE                     OCCURS 4 TIMES.    03080000
028900         10  DL10-OH-HIST             PIC Z,ZZZ,ZZ9.              03090000
029000         10  FILLER                   PIC X(2)       VALUE SPACE. 03100000
029100     05  FILLER                       PIC X(10)      VALUE SPACE. 03110000
029200     05  DL10-ONHAND                  PIC Z,ZZZ,ZZ9.              03120000
029300     05  FILLER                       PIC X(51)      VALUE SPACE. 03130000
029400                                                                  03140000
029500 01  DETAIL-LINE11.                                               03150000
029600     05  FILLER                       PIC X(18)      VALUE        03160000
029700         'CSTOCK            '.                                    03170000
029800     05  FILLER                       PIC X(54)      VALUE SPACE. 03180000
029900     05  DL11-CSTOCK                  PIC Z,ZZZ,ZZ9.              03190000
030000     05  FILLER                       PIC X(51)      VALUE SPACE. 03200000
030100                                                                  03210000
030200 01  PROGRAM-CONSTANTS.                                           03220000
030300     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     03230000
030400                                                   COMP SYNC.     03240000
030500     05  PC-ONE                     PIC S9(2)      VALUE +1.      03250000
030600     05  PC-TWO                     PIC S9(2)      VALUE +2.      03260000
030700     05  PC-THREE                   PIC S9(2)      VALUE +3.      03270000
030800     05  PC-FOUR                    PIC S9(2)      VALUE +4.      03280000
030900     05  PC-FIVE                    PIC S9(2)      VALUE +5.      03290000
031000     05  PC-SIX                     PIC S9(2)      VALUE +6.      03300000
031100     05  PC-SEVEN                   PIC S9(2)      VALUE +7.      03310000
031200     05  PC-FOURTEEN                PIC S9(2)      VALUE +14.     03320000
031300     05  PC-51                      PIC S9(03)     VALUE +51      03330000
031400                                                   COMP-3.        03340000
031500     05  PC-52                      PIC S9(03)     VALUE +52      03350000
031600                                                   COMP-3.        03360000
031700     05  PC-52X                     PIC X(02)    VALUE '52'.      03370000
031800     05  PC-F2                      PIC X(02)    VALUE 'F2'.      03380000
031900     05  PC-DASH                    PIC X        VALUE '-'.       03390000
032000     05  PC-N                       PIC X(01)    VALUE 'N'.       03400000
032100     05  PC-Y                       PIC X(01)    VALUE 'Y'.       03410000
032200     05  PC-PGRM-NAME               PIC X(8)     VALUE 'MRKRP094'.03420000
032300     05  PC-PGM-DPKUT500            PIC X(8)     VALUE 'DPKUT500'.03430000
032300     05  PC-D                       PIC X(01)    VALUE 'D'.       03440002
032400                                                                  03450000
032500 01  SC-STATUS-CODES.                                             03460000
032600     05  SC-EXCEPT-STATUS            PIC X(02).                   03470000
032700         88  SC-EXCEPT-STATUS-OK               VALUE '00', '97'.  03480000
032800     05  SC-BIM-STATUS               PIC X(02).                   03490000
032900         88  SC-BIM-STATUS-OK                  VALUE '00', '97'.  03500000
033000         88  SC-BIM-RECORD-NOT-FOUND           VALUE '23'.        03510000
033100                                                                  03520000
033200 01  PS-PROGRAM-SWITCHES.                                         03530000
033300     05  PS-EOC-LEVEL-CSR            PIC  X(01)    VALUE 'N'.     03540000
033400         88  EOC-LEVEL-CSR                         VALUE 'Y'.     03550000
033500     05  PS-EOC-H-FRCST-CSR          PIC  X(01)    VALUE 'N'.     03560000
033600         88  EOC-H-FRCST-CSR                       VALUE 'Y'.     03570000
033700     05  PS-EOC-C-FRCST-CSR          PIC  X(01)    VALUE 'N'.     03580000
033800         88  EOC-C-FRCST-CSR                       VALUE 'Y'.     03590000
033900     05  PS-EOC-HIST-CSR             PIC  X(01)    VALUE 'N'.     03600000
034000         88  EOC-HIST-CSR                          VALUE 'Y'.     03610000
034100     05  PS-EOC-SLS-HIST-CSR         PIC  X(01)    VALUE 'N'.     03620000
034200         88  EOC-SLS-HIST-CSR                      VALUE 'Y'.     03630000
034300     05  PS-EOC-CURR-CSR             PIC  X(01)    VALUE 'N'.     03640000
034400         88  EOC-CURR-CSR                          VALUE 'Y'.     03650000
034500     05  PS-EOC-COLOR-STYLE-CSR      PIC  X(01)    VALUE 'N'.     03660000
034600         88  EOC-COLOR-STYLE-CSR                   VALUE 'Y'.     03670000
034700     05  PS-EOC-MAJOR-CLASS-CSR      PIC  X(01)    VALUE 'N'.     03680000
034800         88  EOC-MAJOR-CLASS-CSR                   VALUE 'Y'.     03690000
034900     05  PS-EOC-SUB-CLASS-CSR        PIC  X(01)    VALUE 'N'.     03700000
035000         88  EOC-SUB-CLASS-CSR                     VALUE 'Y'.     03710000
035100     05  PS-EOC-GROUP-CSR            PIC  X(01)    VALUE 'N'.     03720000
035200         88  EOC-GROUP-CSR                         VALUE 'Y'.     03730000
035300     05  PS-EOC-VENDOR-CSR           PIC  X(01)    VALUE 'N'.     03740000
035400         88  EOC-VENDOR-CSR                        VALUE 'Y'.     03750000
035500     05  PS-FOUND-WEEKS-ONHAND       PIC  X(01)    VALUE 'N'.     03760000
035600         88  FOUND-WEEKS-ONHAND                    VALUE 'Y'.     03770000
035700     05  PS-FOUND-WEEKS-ONORDER      PIC  X(01)    VALUE 'N'.     03780000
035800         88  FOUND-WEEKS-ONORDER                   VALUE 'Y'.     03790000
035900     05  PS-FOUND-WEEKS-CSTOCK       PIC  X(01)    VALUE 'N'.     03800000
036000         88  FOUND-WEEKS-CSTOCK                    VALUE 'Y'.     03810000
036100     05  PS-PROCESS-LINE-INFO        PIC  X(01)    VALUE 'Y'.     03820000
036200         88  PROCESS-LINE-INFO                     VALUE 'Y'.     03830000
036300         88  DONE-PROCESSING                       VALUE 'N'.     03840000
036400     05  PS-WITHIN-WEEK-RANGE        PIC  X(01)    VALUE 'N'.     03850000
036500         88  WITHIN-WEEK-RANGE                     VALUE 'Y'.     03860000
036600     05  PS-WITHIN-PCNT-RANGE        PIC  X(01)    VALUE 'N'.     03870000
036700         88  WITHIN-PCNT-RANGE                     VALUE 'Y'.     03880000
036800     05  PS-BIM-RECORD-FOUND-SW      PIC  X(01)    VALUE 'Y'.     03890000
036900         88  BIM-RECORD-FOUND                      VALUE 'Y'.     03900000
037000         88  BIM-RECORD-NOT-FOUND                  VALUE 'N'.     03910000
037100*                                                                 03920000
037200 01  PV-PROGRAM-VARIABLES.                                        03930000
037300     05  PV-REPORT-VARIABLES.                                     03940000
037400         10  PV-LINE-CNT                  PIC S9(3)  VALUE +61    03950000
037500                                                     COMP-3.      03960000
037600         10  PV-MAX-LINES                 PIC S9(3)  VALUE +60    03970000
037700                                                     COMP-3.      03980000
037800         10  PV-PAGE-CNT                  PIC 9(3)   VALUE ZEROS. 03990000
037900         10  PV-LINE-CONTROL              PIC 9(1)   VALUE ZEROS. 04000000
038000     05  PV-INDEXES.                                              04010000
038100         10  PV-FUTR-INDEX                PIC 9(02)  VALUE ZEROS. 04020000
038200         10  PV-HIST-INDEX                PIC 9(02)  VALUE ZEROS. 04030000
038200         10  PV-DATE-INDEX                PIC 9(02)  VALUE ZEROS. 04040000
038300         10  PV-BIM-WEEK-INDEX            PIC 9(02)  VALUE ZEROS. 04050000
038400         10  PV-BIM-INDEX                 PIC 9(02)  VALUE ZEROS. 04060000
038500         10  PV-WOS-INDEX                 PIC 9(02)  VALUE ZEROS. 04070000
038600         10  PV-PCNT-INDEX                PIC 9(02)  VALUE ZEROS. 04080000
038700     05  PV-DATE-FIELDS.                                          04090000
038800         10 PV-DATE.                                              04100000
038900             15 PV-YR                     PIC  9(4) VALUE ZEROES. 04110000
039000             15 PV-MO                     PIC  9(2) VALUE ZEROES. 04120000
039100             15 PV-DY                     PIC  9(2) VALUE ZEROES. 04130000
039200         10  PV-CURR-WEEK-YEAR.                                   04140000
039300             15  PV-CURR-YEAR             PIC  X(04).             04150000
039400             15  PV-CURR-WEEK             PIC  X(02).             04160000
039500         10  PV-HOLD-WEEK-YEAR.                                   04170000
039600             15  PV-HOLD-YEAR             PIC  X(04).             04180000
039700             15  PV-HOLD-WEEK             PIC  X(02).             04190000
039800         10  PV-WEEK-YEAR.                                        04200000
039900             15  PV-YEAR                  PIC  9(04).             04210000
040000             15  PV-WEEK                  PIC  9(02).             04220000
040100         10  PV-EVEN-ODD-WEEK             PIC  9.                 04230000
040200             88  PV-EVEN                        VALUE 0 2 4 6 8.  04240000
040300             88  PV-ODD                         VALUE 1 3 5 7 9.  04250000
040400         10  PV-CC-DAY                    PIC  S9(3)V COMP-3      04260000
040500                                                     VALUE ZEROS. 04270000
040600         10  PV-CC-DAY2                   PIC  S9(3)V COMP-3      04280000
040700                                                     VALUE ZEROS. 04290000
040800         10  PV-HOLD-FSCL-DATE            PIC  X(10).             04300000
040900         10  PV-DECREMENT                 PIC  9(2) VALUE ZERO.   04310000
           05  PV-FSCL-WRK-DATE               PIC X(10).                04320000
           05  PV-FSCL-EOW-DATE               PIC X(10).                04330000
           05  PV-FSCL-VAR-DATE1              PIC X(10).                04340000
           05  PV-FSCL-VAR-DATE2              PIC X(10).                04350000
           05  PV-FSCL-VAR-DATE3              PIC X(10).                04360000
           05  PV-FSCL-VAR-DATE4              PIC X(10).                04370000
           05  PV-FSCL-VAR-DATE5              PIC X(10).                04380000
           05  PV-FSCL-VAR-DATE6              PIC X(10).                04390000
           05  PV-FSCL-VAR-DATE7              PIC X(10).                04400000
041000     05  PV-SYS-ID.                                               04410000
041100         10  PV-DAY-NBR                   PIC  9.                 04420000
041200         10  PV-SYS-ID-X                  PIC  X.                 04430000
041300     05 PV-COMPUTE-FIELDS.                                        04440000
041400         10 PV-FORECAST                  PIC 9(7)V99 VALUE ZEROES.04450000
041500         10 PV-TOTAL-FORECAST            PIC 9(7)V99 VALUE ZEROES.04460000
041600         10 PV-CUMM-FRCST                 PIC 9(7)   VALUE ZEROES.04470000
041700         10 PV-CUMM-SALES                 PIC 9(7)   VALUE ZEROES.04480000
041800         10 PV-DD-COMPUTED                PIC S9(8)V999 COMP-3.   04490000
041900     05 PV-HOLD-FIELDS.                                           04500000
042000         10 PV-DD                         PIC S9(8)V9 COMP-3.     04510000
042100         10 PV-SALES                      PIC S9(8)V  COMP-3.     04520000
042200         10 PV-MADDSS                     PIC S9(8)V9 COMP-3.     04530000
042300         10 PV-ONHAND                     PIC S9(11)V COMP-3.     04540000
042400         10 PV-ON-ORDER                   PIC S9(11)V COMP-3.     04550000
042500         10 PV-CSTOCK                     PIC S9(11)V COMP-3.     04560000
042600         10 PV-OSTRAT                     PIC S9(3)V9 COMP-3.     04570000
042700         10 PV-LT                         PIC S9(3)V  COMP-3.     04580000
042800         10 PV-BI                         PIC S99V99  COMP-3.     04590000
043000     05 PV-PERCENT-FIELDS.                                        04600000
043100         10  PV-HOLD-CSTOCK-PCT           PIC S9(04)V9(03)        04610000
043200                                          VALUE ZERO  COMP-3.     04620000
043300         10  PV-HOLD-CUMM-FRCST-PCT       PIC S9(04)V9(03)        04630000
043400                                          VALUE ZERO COMP-3.      04640000
043500         10  PV-CSTOCK-PERCENT            PIC S9(3) VALUE ZEROS.  04650000
043600         10  PV-FRCST-PERCENT             PIC S9(3) VALUE ZEROS.  04660000
043700         10  PV-CUMM-FRCST-PCT            PIC S9(3) VALUE ZEROS.  04670000
043800     05 PV-COMPARE-VARIABLES.                                     04680000
043900         10 PV-ONHAND-COMPARE             PIC S9(11)V COMP-3      04690000
044000                                                    VALUE ZEROES. 04700000
044100         10 PV-ONORDER-COMPARE            PIC S9(11)V COMP-3      04710000
044200                                                    VALUE ZEROES. 04720000
044300         10 PV-CSTOCK-COMPARE             PIC S9(11)V COMP-3      04730000
044400                                                    VALUE ZEROES. 04740000
044500         10 PV-ONHAND-ONORDER             PIC S9(11)V COMP-3      04750000
044600                                                    VALUE ZEROES. 04760000
044700         10 PV-ONHAND-CSTOCK              PIC S9(11)V COMP-3      04770000
044800                                                    VALUE ZEROES. 04780000
044900         10 PV-WOS                        PIC 9(2)  VALUE ZEROES. 04790000
045000         10 PV-WOO                        PIC 9(2)  VALUE ZEROES. 04800000
045100         10 PV-COMP-PERCENT               PIC S9(3) VALUE ZEROES. 04810000
045200     05 PV-DEFAULT-VARIABLES.                                     04820000
045300         10 PV-DEFAULT-LEVEL              PIC X(3)  VALUE SPACES. 04830000
045400         10 PV-DEFAULT-SW-EXCEPT          PIC X(3)  VALUE SPACES. 04840000
045500             88 PV-DEFAULT-NONE                     VALUE 'NO '.  04850000
045600             88 PV-DEFAULT-PER                      VALUE 'PER'.  04860000
045700             88 PV-DEFAULT-WOS                      VALUE 'WOS'.  04870000
045800         10 PV-DEFAULT-PERCENT            PIC S9(3) VALUE ZEROES. 04880000
045900         10 PV-DEFAULT-NEG-PERCENT        PIC S9(3) VALUE ZEROES. 04890000
046000         10 PV-DEFAULT-LESS-WEEK          PIC 9(2) VALUE ZEROES.  04900000
046100         10 PV-DEFAULT-MORE-WEEK          PIC 9(2) VALUE ZEROES.  04910000
046200     05 PV-HOLD-VARIABLES.                                        04920000
046300         10 PV-HOLD-LEVEL                 PIC X(3) VALUE SPACES.  04930000
046400         10 PV-HOLD-SW-EXCEPT             PIC X(3) VALUE SPACES.  04940000
046500             88 PV-HOLD-NONE                        VALUE 'NO '.  04950000
046600             88 PV-HOLD-PER                         VALUE 'PER'.  04960000
046700             88 PV-HOLD-WOS                         VALUE 'WOS'.  04970000
046800         10 PV-HOLD-PERCENT               PIC S9(3) VALUE ZEROES. 04980000
046900         10 PV-HOLD-NEG-PERCENT           PIC S9(3) VALUE ZEROES. 04990000
047000         10 PV-HOLD-LESS-WEEK             PIC 9(2)  VALUE ZEROES. 05000000
047100         10 PV-HOLD-MORE-WEEK             PIC 9(2)  VALUE ZEROES. 05010000
047200         10 PV-HOLD-DEPT-NBR              PIC S9(04)V VALUE ZERO  05020000
047300                                                      COMP-3.     05030000
047400         10 PV-HOLD-CLASS-NBR             PIC S9(04)V VALUE ZERO  05040000
047500                                                      COMP-3.     05050000
047600         10 PV-HOLD-SCL-NBR               PIC S9(04)V VALUE ZERO  05060000
047700                                                      COMP-3.     05070000
047800         10 PV-HOLD-COLOR                 PIC X(20) VALUE SPACES. 05080000
047900         10 PV-HOLD-STYLE                 PIC X(20) VALUE SPACES. 05090000
048000         10 PV-HOLD-GROUP-CODE            PIC X(3)  VALUE SPACES. 05100000
048100         10 PV-HOLD-VENDOR-NAME           PIC X(30) VALUE SPACES. 05110000
048200         10 PV-HOLD-VENDOR-CODE           PIC S9(9) COMP.         05120000
048300                                                                  05130000
048400 01  PV-ABEND-INFO.                                               05140000
048500     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO.    05150000
048600     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  05160000
048800     05  PV-MESSAGES.                                             05170000
048900         10   PV-PARAGRAPH-NAME-MSG.                              05180000
049000             15  FILLER              PIC  X(13)    VALUE          05190000
049100                                    'PARAGRAPH IS '.              05200000
049200             15  PV-PARAGRAPH-NAME   PIC  X(25).                  05210000
049300         10   PV-ERROR-FILE-MSG.                                  05220000
049400             15  FILLER              PIC  X(26)    VALUE          05230000
049500                   'ERROR HAS OCCURED FILE IS '.                  05240000
049600             15  PV-ERROR-FILE       PIC  X(19).                  05250000
049700         10   PV-ERROR-OPERATION-MSG.                             05260000
049800             15  FILLER              PIC  X(13)    VALUE          05270000
049900                   'OPERATION IS '.                               05280000
050000             15  PV-ERROR-OPERATION  PIC  X(19).                  05290000
050100         10   PV-ERROR-STATUS-MSG.                                05300000
050200             15  FILLER              PIC  X(10)    VALUE          05310000
050300                   'STATUS IS '.                                  05320000
050400             15  PV-ERROR-STATUS     PIC  X(20).                  05330000
050500         10   PV-NOT-FOUND-MSG.                                   05340000
050600             15  FILLER              PIC  X(12)    VALUE          05350000
050700                   'FILE KEY IS '.                                05360000
050800             15  PV-NOT-FOUND-KEY    PIC  X(21).                  05370000
050900     05  PV-VSAM-STATUS              PIC  X(02)    VALUE SPACE.   05380000
051000         88   PV-NO-REC-FOUND                      VALUE '23'.    05390000
051100                                                                  05400000
051200                                                                  05410000
051300 EJECT                                                            05420000
051400 01 PAN-BIM-FILE.                                                 05430000
051500     COPY IPFGBIC.                                                05440000
051600 EJECT                                                            05450000
051700                                                                  05460000
051800** RECORD LAYOUT FOR INPUT FILE                                   05470000
051900     COPY MRRD032.                                                05480000
052000 EJECT                                                            05490000
052100                                                                  05500000
052200 01  PT-PGM-TABLES.                                               05510000
052300     05  PT-FUTURE-WEEK-TABLE.                                    05520000
052400         10 PT-FUTURE-WEEK            PIC  X(2)                   05530000
052500                                      OCCURS 5 TIMES.             05540000
052600         10 PT-FUTURE-YEAR            PIC  X(4)                   05550000
052700                                      OCCURS 5 TIMES.             05560000
052800     05  PT-HIST-WEEK-TABLE.                                      05570000
052900         10 PT-HIST-WEEK              PIC  X(2)                   05580000
053000                                      OCCURS 4 TIMES.             05590000
053100         10 PT-HIST-YEAR              PIC  X(4)                   05600000
053200                                      OCCURS 4 TIMES.             05610000
053300     05  PT-FSCL-DATE-TABLE.                                      05620000
053400         10 PT-FSCL-DATE              PIC  X(10)                  05630000
053500                                      OCCURS 4 TIMES.             05640000
053300     05  PT-FSCL-DAYS-TABLE.                                      05650000
053400         10 PT-FSCL-DAY               PIC  X(10)                  05660000
053500                                      OCCURS 28 TIMES.            05670000
053600     05  PT-FORECAST-TABLE.                                       05680000
053700         10 PT-FORECAST-AMOUNT        PIC  9(6)V99                05690000
053800                                      OCCURS 52 TIMES.            05700000
053900                                                                  05710000
054000     EXEC SQL                                                     05720000
054100         INCLUDE TMRITEM                                          05730000
054200     END-EXEC.                                                    05740000
054300                                                                  05750000
054400     EXEC SQL                                                     05760000
054500         INCLUDE TMRITST                                          05770000
054600     END-EXEC.                                                    05780000
054700                                                                  05790000
054800     EXEC SQL                                                     05800000
054900         INCLUDE TSK                                              05810000
055000     END-EXEC.                                                    05820000
055100                                                                  05830000
055200     EXEC SQL                                                     05840000
055300         INCLUDE MHT00000                                         05850000
055400     END-EXEC.                                                    05860000
055500                                                                  05870000
055600     EXEC SQL                                                     05880000
055700         INCLUDE TSKST                                            05890000
055800     END-EXEC.                                                    05900000
055900                                                                  05910000
056000     EXEC SQL                                                     05920000
056100         INCLUDE TMRISHS                                          05930000
056200     END-EXEC.                                                    05940000
056300                                                                  05950000
056400     EXEC SQL                                                     05960000
056500         INCLUDE TENTNME                                          05970000
056600     END-EXEC.                                                    05980000
056700                                                                  05990000
056800     EXEC SQL                                                     06000000
056900         INCLUDE XMT00001                                         06010000
057000     END-EXEC.                                                    06020000
057100                                                                  06030000
057200******************************************************************06040000
057300* MRNIS-RFC      PREVIOUS   NOT INCLUDED                          06050000
057400* MRNIS-RFC      CURRENT    DCLGEN FOR TSKXREF                    06060000
057500* MRNIS-RFC      FUTURE     REMOVE WHEN TSKXREF NO LONGER NEEDED  06070000
057600******************************************************************06080000
057700     EXEC SQL                                                     06090000
057800         INCLUDE TSKXREF                                          06100000
057900     END-EXEC.                                                    06110000
00513      EXEC SQL                                                     06120000
00514           INCLUDE TDTATTR                                         06130000
00515      END-EXEC.                                                    06140000
058000                                                                  06150000
058100* DB2 COMMUNICATION AREA                                          06160000
058200                                                                  06170000
058300     EXEC SQL                                                     06180000
058400         INCLUDE SQLCA                                            06190000
058500     END-EXEC.                                                    06200000
058600                                                                  06210000
058700* DB2 COMMUNICATION AREA2                                         06220000
058800                                                                  06230000
058900     COPY SQLCA2.                                                 06240000
059000                                                                  06250000
059100******************************************************************06260000
059200* MRNIS-RFC   PREVIOUS   DEPT FROM TSK OF FS                      06270000
059300* MRNIS-RFC   CURRENT    DEPT FROM TSKXREF                        06280000
059400* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 06290000
059500******************************************************************06300000
059600                                                                  06310000
059700     EXEC SQL                                                     06320000
059800       DECLARE DEPT-LEVEL CURSOR FOR                              06330000
059900             SELECT DISTINCT                                      06340000
060000                    X.DEPT                                        06350000
060100              FROM TSKXREF   X                                    06360000
060200                  ,TMRITEM   B                                    06370000
060300              WHERE B.ITEM_NBR  = X.ITM_NBR                       06380000
060400               AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)     06390000
060500               OR   (RT_NBR > 4                                   06400000
060600               AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)       06410000
060700               AND  RT_DAY_NBR <> 0))                             06420000
060800** BELOW LINE IS USED FOR UNIT TESTING                            06430000
060900**             AND X.DEPT  IN (025)                               06440000
061000                       WITH UR                                    06450000
061010              FOR FETCH ONLY                                      06460000
061100     END-EXEC.                                                    06470000
061200                                                                  06480000
060800** BELOW LINE IS USED FOR UNIT TESTING                            06490000
061300******************************************************************06500000
061400* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       06510000
061500* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  06520000
061600* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 06530000
061700******************************************************************06540000
061800                                                                  06550000
061900     EXEC SQL                                                     06560000
062000       DECLARE COLOR-STYLE-LEVEL CURSOR FOR                       06570000
062100             SELECT DISTINCT                                      06580000
062200                    X.DEPT                                        06590000
062300                   ,X.CLASS                                       06600000
062400                   ,X.SUBCLASS                                    06610000
062410                   ,A.LONG_COLOR_DESC                             06620000
062500                   ,A.LONG_VENDOR_STYLE                           06630000
062600               FROM TSK       A                                   06640000
062700                  ,TMRITEM   B                                    06650000
062800                  ,TMRITST   D                                    06660000
062900                  ,XMT_LOC   G                                    06670000
063000                  ,TSKXREF   X                                    06680000
063100             WHERE  X.DEPT              = :PV-HOLD-DEPT-NBR       06690000
063200               AND  B.ITEM_NBR          = A.ITEM_NMBR             06700000
063300               AND  A.ITEM_NMBR         = D.ITEM_NBR              06710000
063400               AND  A.ITEM_NMBR         = X.ITM_NBR               06720000
063500               AND  D.STR_NBR           > 0                       06730000
063600               AND  D.FT_CDE            =  'O'                    06740000
063700               AND  D.STR_NBR           = G.LOC_NBR               06750000
063800               AND  G.E_BUS_IND         = 'N'                     06760000
064000               AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)     06770000
064100               OR   (RT_NBR > 4                                   06780000
064200               AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)       06790000
064300               AND  RT_DAY_NBR <> 0))                             06800000
064400                       WITH UR                                    06810000
064410             FOR FETCH ONLY                                       06820000
064500     END-EXEC.                                                    06830000
064600                                                                  06840000
064700******************************************************************06850000
064800* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       06860000
064900* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  06870000
065000* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 06880000
065100******************************************************************06890000
065200                                                                  06900000
065300     EXEC SQL                                                     06910000
065400       DECLARE CLR-STL-HIST-FRCST CURSOR FOR                      06920000
065500             SELECT B.UCYCLE_CDE                                  06930000
065600                   ,C.DSD_HIST_QTY                                06940000
065700                   ,D.PTAG_ID                                     06950000
065800              FROM TSK         A                                  06960000
065900                  ,TMRITEM     B                                  06970000
066000                  ,TMRISHS     C                                  06980000
066100                  ,TMRITST     D                                  06990000
066200                  ,XMT_LOC     G                                  07000000
066300                  ,TSKXREF     X                                  07010000
066400               WHERE A.ITEM_NMBR         =  B.ITEM_NBR            07020000
066500                AND  A.ITEM_NMBR         =  C.ITM_NBR             07030000
066600                AND  A.ITEM_NMBR         =  D.ITEM_NBR            07040000
066700                AND  A.ITEM_NMBR         =  X.ITM_NBR             07050000
066800                AND  C.STR_NBR           =  D.STR_NBR             07060000
066900                AND  C.STR_NBR           > 0                      07070000
067000                AND  D.FT_CDE            =  'O'                   07080000
067100                AND  D.STR_NBR           = G.LOC_NBR              07090000
067200                AND  G.E_BUS_IND         = 'N'                    07100000
067400                AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)    07110000
067500                OR   (RT_NBR > 4                                  07120000
067600                AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)      07130000
067700                AND  RT_DAY_NBR <> 0))                            07140000
067800                AND  C.YR_NBR            = :PV-HOLD-YEAR          07150000
067900                AND  C.WK_NBR            = :PV-HOLD-WEEK          07160000
068000                AND  X.DEPT              = :PV-HOLD-DEPT-NBR      07170000
068100                AND  X.CLASS             = :PV-HOLD-CLASS-NBR     07180000
068200                AND  X.SUBCLASS          = :PV-HOLD-SCL-NBR       07190000
068300                AND  A.LONG_COLOR_DESC   = :PV-HOLD-COLOR         07200000
068400                AND  A.LONG_VENDOR_STYLE = :PV-HOLD-STYLE         07210000
068500                AND  C.ITM_REV_ID     = (SELECT MAX (E.ITM_REV_ID)07220000
068600                     FROM TMRISHS  E                              07230000
068700                 WHERE                                            07240000
068800                         E.ITM_NBR         =  C.ITM_NBR           07250000
068900                     AND E.STR_NBR         =  C.STR_NBR           07260000
069000                     AND E.YR_NBR          = :PV-HOLD-YEAR        07270000
069100                     AND E.WK_NBR          = :PV-HOLD-WEEK)       07280000
064400                       WITH UR                                    07290000
069110             FOR FETCH ONLY                                       07300000
069200     END-EXEC.                                                    07310000
069300                                                                  07320000
069400******************************************************************07330000
069500* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       07340000
069600* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  07350000
069700* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 07360000
069800******************************************************************07370000
069900                                                                  07380000
070000     EXEC SQL                                                     07390000
070100       DECLARE CLR-STL-CURR-FRCST CURSOR FOR                      07400000
070200             SELECT B.UCYCLE_CDE                                  07410000
070300                   ,D.DD_FCTR                                     07420000
070400                   ,D.PTAG_ID                                     07430000
070500              FROM TSK         A                                  07440000
070600                  ,TMRITEM     B                                  07450000
070700                  ,TMRITST     D                                  07460000
070800                  ,XMT_LOC     G                                  07470000
070900                  ,TSKXREF     X                                  07480000
071000               WHERE A.ITEM_NMBR         = B.ITEM_NBR             07490000
071100                AND  A.ITEM_NMBR         = D.ITEM_NBR             07500000
071200                AND  A.ITEM_NMBR         = X.ITM_NBR              07510000
071300                AND  D.STR_NBR           > 0                      07520000
071400                AND  D.FT_CDE            =  'O'                   07530000
071500                AND  D.STR_NBR           = G.LOC_NBR              07540000
071600                AND  G.E_BUS_IND         = 'N'                    07550000
071800                AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)    07560000
071900                OR   (RT_NBR > 4                                  07570000
072000                AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)      07580000
072100                AND  RT_DAY_NBR <> 0))                            07590000
072200                AND  X.DEPT              = :PV-HOLD-DEPT-NBR      07600000
072300                AND  X.CLASS             = :PV-HOLD-CLASS-NBR     07610000
072400                AND  X.SUBCLASS          = :PV-HOLD-SCL-NBR       07620000
072500                AND  A.LONG_COLOR_DESC   = :PV-HOLD-COLOR         07630000
072600                AND  A.LONG_VENDOR_STYLE = :PV-HOLD-STYLE         07640000
064400                       WITH UR                                    07650000
072610             FOR FETCH ONLY                                       07660000
072700     END-EXEC.                                                    07670000
072800                                                                  07680000
072900******************************************************************07690000
073000* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       07700000
073100* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  07710000
073200* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 07720000
073300******************************************************************07730000
073400                                                                  07740000
073500     EXEC SQL                                                     07750000
073600       DECLARE MAJOR-CLASS-LEVEL CURSOR FOR                       07760000
073700             SELECT DISTINCT                                      07770000
073800                    X.DEPT                                        07780000
073900                   ,X.CLASS                                       07790000
074000              FROM TSKXREF   X                                    07800000
074100                  ,TMRITEM   B                                    07810000
074200                  ,TMRITST   D                                    07820000
074300                  ,XMT_LOC   G                                    07830000
074400             WHERE  X.DEPT              = :PV-HOLD-DEPT-NBR       07840000
074500               AND  X.ITM_NBR           = B.ITEM_NBR              07850000
074600               AND  X.ITM_NBR           = D.ITEM_NBR              07860000
074700               AND  D.STR_NBR           > 0                       07870000
074800               AND  D.FT_CDE            =  'O'                    07880000
074900               AND  D.STR_NBR           = G.LOC_NBR               07890000
075000               AND  G.E_BUS_IND         = 'N'                     07900000
075200               AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)     07910000
075300               OR   (RT_NBR > 4                                   07920000
075400               AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)       07930000
075500               AND  RT_DAY_NBR <> 0))                             07940000
075600                       WITH UR                                    07950000
075610             FOR FETCH ONLY                                       07960000
075700     END-EXEC.                                                    07970000
075800                                                                  07980000
075900******************************************************************07990000
076000* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       08000000
076100* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  08010000
076200* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 08020000
076300******************************************************************08030000
076400                                                                  08040000
076500     EXEC SQL                                                     08050000
076600       DECLARE MAJ-CLS-HIST-FRCST CURSOR FOR                      08060000
076700             SELECT B.UCYCLE_CDE                                  08070000
076800                   ,C.DSD_HIST_QTY                                08080000
076900                   ,D.PTAG_ID                                     08090000
077000              FROM TSKXREF     X                                  08100000
077100                  ,TMRITEM     B                                  08110000
077200                  ,TMRISHS     C                                  08120000
077300                  ,TMRITST     D                                  08130000
077400                  ,XMT_LOC     G                                  08140000
077500              WHERE X.ITM_NBR           =  B.ITEM_NBR             08150000
077600                AND X.ITM_NBR           =  C.ITM_NBR              08160000
077700                AND X.ITM_NBR           =  D.ITEM_NBR             08170000
077800                AND C.STR_NBR           =  D.STR_NBR              08180000
077900                AND C.STR_NBR           > 0                       08190000
078000                AND D.FT_CDE            =  'O'                    08200000
078100                AND  D.STR_NBR           = G.LOC_NBR              08210000
078200                AND  G.E_BUS_IND         = 'N'                    08220000
078400                AND X.CLASS             = :PV-HOLD-CLASS-NBR      08230000
078500                AND ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)     08240000
078600                OR  (RT_NBR > 4                                   08250000
078700                AND RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)       08260000
078800                AND RT_DAY_NBR <> 0))                             08270000
078900                AND C.YR_NBR            = :PV-HOLD-YEAR           08280000
079000                AND C.WK_NBR            = :PV-HOLD-WEEK           08290000
079100                AND X.DEPT              = :PV-HOLD-DEPT-NBR       08300000
079200                AND  C.ITM_REV_ID     = (SELECT MAX (E.ITM_REV_ID)08310000
079300                     FROM TMRISHS  E                              08320000
079400                 WHERE                                            08330000
079500                         E.ITM_NBR         =  C.ITM_NBR           08340000
079600                     AND E.STR_NBR         =  C.STR_NBR           08350000
079700                     AND E.YR_NBR          = :PV-HOLD-YEAR        08360000
079800                     AND E.WK_NBR          = :PV-HOLD-WEEK)       08370000
064400                       WITH UR                                    08380000
079810             FOR FETCH ONLY                                       08390000
079900     END-EXEC.                                                    08400000
080000                                                                  08410000
080100******************************************************************08420000
080200* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       08430000
080300* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  08440000
080400* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 08450000
080500******************************************************************08460000
080600                                                                  08470000
080700     EXEC SQL                                                     08480000
080800       DECLARE MAJ-CLS-CURR-FRCST CURSOR FOR                      08490000
080900             SELECT B.UCYCLE_CDE                                  08500000
081000                   ,D.DD_FCTR                                     08510000
081100                   ,D.PTAG_ID                                     08520000
081200             FROM  TSKXREF     X                                  08530000
081300                  ,TMRITEM     B                                  08540000
081400                  ,TMRITST     D                                  08550000
081500                  ,XMT_LOC     G                                  08560000
081600             WHERE  X.DEPT              = :PV-HOLD-DEPT-NBR       08570000
081700               AND  X.CLASS             = :PV-HOLD-CLASS-NBR      08580000
081800               AND  X.ITM_NBR           = B.ITEM_NBR              08590000
081900               AND  X.ITM_NBR           = D.ITEM_NBR              08600000
082000               AND  D.STR_NBR           > 0                       08610000
082100               AND  D.FT_CDE            =  'O'                    08620000
082200               AND  D.STR_NBR           = G.LOC_NBR               08630000
082300               AND  G.E_BUS_IND         = 'N'                     08640000
082500               AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)     08650000
082600               OR   (RT_NBR > 4                                   08660000
082700               AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)       08670000
082800               AND  RT_DAY_NBR <> 0))                             08680000
064400                       WITH UR                                    08690000
082810             FOR FETCH ONLY                                       08700000
082900     END-EXEC.                                                    08710000
083000                                                                  08720000
083100******************************************************************08730000
083200* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       08740000
083300* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  08750000
083400* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 08760000
083500******************************************************************08770000
083600                                                                  08780000
083700     EXEC SQL                                                     08790000
083800       DECLARE SUB-CLASS-LEVEL CURSOR FOR                         08800000
083900             SELECT DISTINCT                                      08810000
084000                    X.DEPT                                        08820000
084100                   ,X.CLASS                                       08830000
084200                   ,X.SUBCLASS                                    08840000
084300              FROM TSKXREF     X                                  08850000
084400                  ,TMRITEM     B                                  08860000
084500                  ,TMRITST     D                                  08870000
084600                  ,XMT_LOC     G                                  08880000
084700             WHERE  X.DEPT              = :PV-HOLD-DEPT-NBR       08890000
084800               AND  B.ITEM_NBR          = X.ITM_NBR               08900000
084900               AND  X.ITM_NBR           = D.ITEM_NBR              08910000
085000               AND  D.STR_NBR           > 0                       08920000
085100               AND  D.FT_CDE            =  'O'                    08930000
085200               AND  D.STR_NBR           = G.LOC_NBR               08940000
085300               AND  G.E_BUS_IND         = 'N'                     08950000
085500               AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)     08960000
085600               OR   (RT_NBR > 4                                   08970000
085700               AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)       08980000
085800               AND  RT_DAY_NBR <> 0))                             08990000
085900                       WITH UR                                    09000000
085910             FOR FETCH ONLY                                       09010000
086000     END-EXEC.                                                    09020000
086100                                                                  09030000
086200******************************************************************09040000
086300* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       09050000
086400* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  09060000
086500* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 09070000
086600******************************************************************09080000
086700                                                                  09090000
086800     EXEC SQL                                                     09100000
086900       DECLARE SUB-CLS-HIST-FRCST CURSOR FOR                      09110000
087000             SELECT B.UCYCLE_CDE                                  09120000
087100                   ,C.DSD_HIST_QTY                                09130000
087200                   ,D.PTAG_ID                                     09140000
087300              FROM TSKXREF     X                                  09150000
087400                  ,TMRITEM     B                                  09160000
087500                  ,TMRISHS     C                                  09170000
087600                  ,TMRITST     D                                  09180000
087700                  ,XMT_LOC     G                                  09190000
087800               WHERE X.ITM_NBR          =  B.ITEM_NBR             09200000
087900                AND  X.ITM_NBR          =  C.ITM_NBR              09210000
088000                AND  X.ITM_NBR          =  D.ITEM_NBR             09220000
088100                AND  C.STR_NBR          =  D.STR_NBR              09230000
088200                AND  C.STR_NBR          > 0                       09240000
088300                AND  D.FT_CDE           =  'O'                    09250000
088400                AND  D.STR_NBR           = G.LOC_NBR              09260000
088500                AND  G.E_BUS_IND         = 'N'                    09270000
088700                AND  X.CLASS            = :PV-HOLD-CLASS-NBR      09280000
088800                AND  X.SUBCLASS         = :PV-HOLD-SCL-NBR        09290000
088900                AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)    09300000
089000                OR   (RT_NBR > 4                                  09310000
089100                AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)      09320000
089200                AND  RT_DAY_NBR <> 0))                            09330000
089300                AND  C.YR_NBR           = :PV-HOLD-YEAR           09340000
089400                AND  C.WK_NBR           = :PV-HOLD-WEEK           09350000
089500                AND  X.DEPT             = :PV-HOLD-DEPT-NBR       09360000
089600                AND  C.ITM_REV_ID     = (SELECT MAX (E.ITM_REV_ID)09370000
089700                     FROM TMRISHS  E                              09380000
089800                 WHERE                                            09390000
089900                         E.ITM_NBR         =  C.ITM_NBR           09400000
090000                     AND E.STR_NBR         =  C.STR_NBR           09410000
090100                     AND E.YR_NBR          = :PV-HOLD-YEAR        09420000
090200                     AND E.WK_NBR          = :PV-HOLD-WEEK)       09430000
064400                       WITH UR                                    09440000
090210             FOR FETCH ONLY                                       09450000
090300     END-EXEC.                                                    09460000
090400                                                                  09470000
090500******************************************************************09480000
090600* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       09490000
090700* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  09500000
090800* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 09510000
090900******************************************************************09520000
091000                                                                  09530000
091100     EXEC SQL                                                     09540000
091200       DECLARE SUB-CLS-CURR-FRCST CURSOR FOR                      09550000
091300             SELECT B.UCYCLE_CDE                                  09560000
091400                   ,D.DD_FCTR                                     09570000
091500                   ,D.PTAG_ID                                     09580000
091600             FROM  TSKXREF     X                                  09590000
091700                  ,TMRITEM     B                                  09600000
091800                  ,TMRITST     D                                  09610000
091900                  ,XMT_LOC     G                                  09620000
092000             WHERE  X.ITM_NBR          = B.ITEM_NBR               09630000
092100               AND  X.ITM_NBR          = D.ITEM_NBR               09640000
092200               AND  D.STR_NBR          > 0                        09650000
092300               AND  D.FT_CDE           =  'O'                     09660000
092400               AND  D.STR_NBR           = G.LOC_NBR               09670000
092500               AND  G.E_BUS_IND         = 'N'                     09680000
092700               AND  X.CLASS            = :PV-HOLD-CLASS-NBR       09690000
092800               AND  X.SUBCLASS         = :PV-HOLD-SCL-NBR         09700000
092900               AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)     09710000
093000               OR   (RT_NBR > 4                                   09720000
093100               AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)       09730000
093200               AND  RT_DAY_NBR <> 0))                             09740000
093300               AND  X.DEPT             = :PV-HOLD-DEPT-NBR        09750000
064400                       WITH UR                                    09760000
093310             FOR FETCH ONLY                                       09770000
093400     END-EXEC.                                                    09780000
093500                                                                  09790000
093600******************************************************************09800000
093700* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       09810000
093800* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  09820000
093900* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 09830000
094000******************************************************************09840000
094100                                                                  09850000
094200     EXEC SQL                                                     09860000
094300       DECLARE GROUP-LEVEL CURSOR FOR                             09870000
094400             SELECT DISTINCT                                      09880000
094500                    X.DEPT                                        09890000
094600                   ,X.CLASS                                       09900000
094700                   ,X.SUBCLASS                                    09910000
094800                   ,A.GROUP_CODE                                  09920000
094900              FROM TSK         A                                  09930000
095000                  ,TMRITEM     B                                  09940000
095100                  ,TMRITST     D                                  09950000
095200                  ,XMT_LOC     G                                  09960000
095300                  ,TSKXREF     X                                  09970000
095400             WHERE  X.DEPT              = :PV-HOLD-DEPT-NBR       09980000
095500               AND  B.ITEM_NBR          = A.ITEM_NMBR             09990000
095600               AND  A.ITEM_NMBR         = D.ITEM_NBR              10000000
095700               AND  A.ITEM_NMBR         = X.ITM_NBR               10010000
095800               AND  D.STR_NBR           > 0                       10020000
095900               AND  D.FT_CDE            =  'O'                    10030000
096000               AND  D.STR_NBR           = G.LOC_NBR               10040000
096100               AND  G.E_BUS_IND         = 'N'                     10050000
096300               AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)     10060000
096400               OR   (RT_NBR > 4                                   10070000
096500               AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)       10080000
096600               AND  RT_DAY_NBR <> 0))                             10090000
096700                       WITH UR                                    10100000
096710             FOR FETCH ONLY                                       10110000
096800     END-EXEC.                                                    10120000
096900                                                                  10130000
097000******************************************************************10140000
097100* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       10150000
097200* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  10160000
097300* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 10170000
097400******************************************************************10180000
097500                                                                  10190000
097600     EXEC SQL                                                     10200000
097700       DECLARE GROUP-HIST-FRCST CURSOR FOR                        10210000
097800             SELECT B.UCYCLE_CDE                                  10220000
097900                   ,C.DSD_HIST_QTY                                10230000
098000                   ,D.PTAG_ID                                     10240000
098100              FROM TSK         A                                  10250000
098200                  ,TMRITEM     B                                  10260000
098300                  ,TMRISHS     C                                  10270000
098400                  ,TMRITST     D                                  10280000
098500                  ,XMT_LOC     G                                  10290000
098600                  ,TSKXREF     X                                  10300000
098700               WHERE A.ITEM_NMBR        =  B.ITEM_NBR             10310000
098800                AND  A.ITEM_NMBR        =  C.ITM_NBR              10320000
098900                AND  A.ITEM_NMBR        =  D.ITEM_NBR             10330000
099000                AND  A.ITEM_NMBR        =  X.ITM_NBR              10340000
099100                AND  C.STR_NBR          =  D.STR_NBR              10350000
099200                AND  C.STR_NBR          > 0                       10360000
099300                AND  D.FT_CDE           =  'O'                    10370000
099400                AND  D.STR_NBR           = G.LOC_NBR              10380000
099500                AND  G.E_BUS_IND         = 'N'                    10390000
099700                AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)    10400000
099800                OR    (RT_NBR > 4                                 10410000
099900                AND    RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)    10420000
100000                AND    RT_DAY_NBR <> 0))                          10430000
100100                AND  C.YR_NBR           = :PV-HOLD-YEAR           10440000
100200                AND  C.WK_NBR           = :PV-HOLD-WEEK           10450000
100300                AND  X.DEPT             = :PV-HOLD-DEPT-NBR       10460000
100400                AND  X.CLASS            = :PV-HOLD-CLASS-NBR      10470000
100500                AND  X.SUBCLASS         = :PV-HOLD-SCL-NBR        10480000
100600                AND  A.GROUP_CODE       = :PV-HOLD-GROUP-CODE     10490000
100700                AND  C.ITM_REV_ID     = (SELECT MAX (E.ITM_REV_ID)10500000
100800                     FROM TMRISHS  E                              10510000
100900                 WHERE                                            10520000
101000                         E.ITM_NBR         =  C.ITM_NBR           10530000
101100                     AND E.STR_NBR         =  C.STR_NBR           10540000
101200                     AND E.YR_NBR          = :PV-HOLD-YEAR        10550000
101300                     AND E.WK_NBR          = :PV-HOLD-WEEK)       10560000
064400                       WITH UR                                    10570000
101310             FOR FETCH ONLY                                       10580000
101400     END-EXEC.                                                    10590000
101500                                                                  10600000
101600******************************************************************10610000
101700* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       10620000
101800* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  10630000
101900* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 10640000
102000******************************************************************10650000
102100                                                                  10660000
102200     EXEC SQL                                                     10670000
102300       DECLARE GROUP-CURR-FRCST CURSOR FOR                        10680000
102400             SELECT B.UCYCLE_CDE                                  10690000
102500                   ,D.DD_FCTR                                     10700000
102600                   ,D.PTAG_ID                                     10710000
102700             FROM  TSK         A                                  10720000
102800                  ,TMRITEM     B                                  10730000
102900                  ,TMRITST     D                                  10740000
103000                  ,XMT_LOC     G                                  10750000
103100                  ,TSKXREF     X                                  10760000
103200             WHERE  A.ITEM_NMBR        = B.ITEM_NBR               10770000
103300               AND  A.ITEM_NMBR        = D.ITEM_NBR               10780000
103400               AND  A.ITEM_NMBR        = X.ITM_NBR                10790000
103500               AND  D.STR_NBR          > 0                        10800000
103600               AND  D.FT_CDE           =  'O'                     10810000
103700               AND  D.STR_NBR           = G.LOC_NBR               10820000
103800               AND  G.E_BUS_IND         = 'N'                     10830000
104000               AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)     10840000
104100               OR   (RT_NBR > 4                                   10850000
104200               AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)       10860000
104300               AND  RT_DAY_NBR <> 0))                             10870000
104400               AND  X.DEPT             = :PV-HOLD-DEPT-NBR        10880000
104500               AND  X.CLASS            = :PV-HOLD-CLASS-NBR       10890000
104600               AND  X.SUBCLASS         = :PV-HOLD-SCL-NBR         10900000
104700               AND  A.GROUP_CODE       = :PV-HOLD-GROUP-CODE      10910000
064400                       WITH UR                                    10920000
104710             FOR FETCH ONLY                                       10930000
104800     END-EXEC.                                                    10940000
104900                                                                  10950000
105000******************************************************************10960000
105100* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       10970000
105200* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  10980000
105300* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 10990000
105400******************************************************************11000000
105500                                                                  11010000
105600     EXEC SQL                                                     11020000
105700       DECLARE VENDOR-LEVEL CURSOR FOR                            11030000
105800             SELECT DISTINCT                                      11040000
105900                    X.DEPT                                        11050000
106000                   ,A.ENT_ID                                      11060000
106100                   ,E.ENT_NAME_DESC                               11070000
106200              FROM TSK         A                                  11080000
106300                  ,TMRITEM     B                                  11090000
106400                  ,TMRITST     D                                  11100000
106500                  ,TENTNME     E                                  11110000
106600                  ,XMT_LOC     G                                  11120000
106700                  ,TSKXREF     X                                  11130000
106800             WHERE  X.DEPT              = :PV-HOLD-DEPT-NBR       11140000
106900               AND  B.ITEM_NBR          = A.ITEM_NMBR             11150000
107000               AND  A.ITEM_NMBR         = D.ITEM_NBR              11160000
107100               AND  A.ITEM_NMBR         = X.ITM_NBR               11170000
107200               AND  D.STR_NBR           > 0                       11180000
107300               AND  D.FT_CDE            =  'O'                    11190000
107400               AND  A.ENT_ID            = E.ENT_ID                11200000
107500               AND  E.TYPE_CDE          = '04'                    11210000
107600               AND  D.STR_NBR           = G.LOC_NBR               11220000
107700               AND  G.E_BUS_IND         = 'N'                     11230000
107900               AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)     11240000
108000               OR   (RT_NBR > 4                                   11250000
108100               AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)       11260000
108200               AND  RT_DAY_NBR <> 0))                             11270000
108300                       WITH UR                                    11280000
108310             FOR FETCH ONLY                                       11290000
108400     END-EXEC.                                                    11300000
108500                                                                  11310000
108600******************************************************************11320000
108700* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       11330000
108800* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  11340000
108900* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 11350000
109000******************************************************************11360000
109100                                                                  11370000
109200     EXEC SQL                                                     11380000
109300       DECLARE VENDOR-HIST-FRCST CURSOR FOR                       11390000
109400             SELECT B.UCYCLE_CDE                                  11400000
109500                   ,C.DSD_HIST_QTY                                11410000
109600                   ,D.PTAG_ID                                     11420000
109700              FROM TSK         A                                  11430000
109800                  ,TMRITEM     B                                  11440000
109900                  ,TMRISHS     C                                  11450000
110000                  ,TMRITST     D                                  11460000
110100                  ,XMT_LOC     G                                  11470000
110200                  ,TSKXREF     X                                  11480000
110300               WHERE A.ITEM_NMBR        =  B.ITEM_NBR             11490000
110400                AND  A.ITEM_NMBR        =  C.ITM_NBR              11500000
110500                AND  A.ITEM_NMBR        =  D.ITEM_NBR             11510000
110600                AND  A.ITEM_NMBR        =  X.ITM_NBR              11520000
110700                AND  C.STR_NBR          =  D.STR_NBR              11530000
110800                AND  C.STR_NBR          > 0                       11540000
110900                AND  D.FT_CDE           =  'O'                    11550000
111000                AND  D.STR_NBR          = G.LOC_NBR               11560000
111100                AND  G.E_BUS_IND        = 'N'                     11570000
111300                AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)    11580000
111400                OR   (RT_NBR > 4                                  11590000
111500                AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)      11600000
111600                AND  RT_DAY_NBR <> 0))                            11610000
111700                AND  C.YR_NBR           = :PV-HOLD-YEAR           11620000
111800                AND  C.WK_NBR           = :PV-HOLD-WEEK           11630000
111900                AND  X.DEPT             = :PV-HOLD-DEPT-NBR       11640000
112000                AND  A.ENT_ID           = :PV-HOLD-VENDOR-CODE    11650000
112100                AND  C.ITM_REV_ID      = (SELECT MAX(E.ITM_REV_ID)11660000
112200                     FROM TMRISHS  E                              11670000
112300                 WHERE                                            11680000
112400                         E.ITM_NBR         =  C.ITM_NBR           11690000
112500                     AND E.STR_NBR         =  C.STR_NBR           11700000
112600                     AND E.YR_NBR          = :PV-HOLD-YEAR        11710000
112700                     AND E.WK_NBR          = :PV-HOLD-WEEK)       11720000
064400                       WITH UR                                    11730000
112710             FOR FETCH ONLY                                       11740000
112800     END-EXEC.                                                    11750000
112900                                                                  11760000
113000******************************************************************11770000
113100* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       11780000
113200* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  11790000
113300* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 11800000
113400******************************************************************11810000
113500                                                                  11820000
113600     EXEC SQL                                                     11830000
113700       DECLARE VENDOR-CURR-FRCST CURSOR FOR                       11840000
113800             SELECT B.UCYCLE_CDE                                  11850000
113900                   ,D.DD_FCTR                                     11860000
114000                   ,D.PTAG_ID                                     11870000
114100             FROM  TSK         A                                  11880000
114200                  ,TMRITEM     B                                  11890000
114300                  ,TMRITST     D                                  11900000
114400                  ,XMT_LOC     G                                  11910000
114500                  ,TSKXREF     X                                  11920000
114600             WHERE  A.ITEM_NMBR        = B.ITEM_NBR               11930000
114700               AND  A.ITEM_NMBR        = D.ITEM_NBR               11940000
114800               AND  A.ITEM_NMBR        = X.ITM_NBR                11950000
114900               AND  D.STR_NBR          > 0                        11960000
115000               AND  D.FT_CDE           =  'O'                     11970000
115100               AND  D.STR_NBR          = G.LOC_NBR                11980000
115200               AND  G.E_BUS_IND        = 'N'                      11990000
115400               AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)     12000000
115500               OR   (RT_NBR > 4                                   12010000
115600               AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)       12020000
115700               AND  RT_DAY_NBR <> 0))                             12030000
115800               AND  X.DEPT             = :PV-HOLD-DEPT-NBR        12040000
115900               AND  A.ENT_ID           = :PV-HOLD-VENDOR-CODE     12050000
064400                       WITH UR                                    12060000
115910             FOR FETCH ONLY                                       12070000
116000     END-EXEC.                                                    12080000
116100                                                                  12090000
116200 LINKAGE SECTION.                                                 12100000
116300                                                                  12110000
116400 PROCEDURE DIVISION.                                              12120000
116500****************************************************************  12130000
116600* CONTROLS THE MAIN PROCESSING OF THE PROGRAM                  *  12140000
116700****************************************************************  12150000
116800                                                                  12160000
116900 0000-PROGRAM-MAINLINE.                                           12170000
117000                                                                  12180000
117100     PERFORM A0000-INITIALIZE.                                    12190000
117200                                                                  12200000
117300     PERFORM B0000-MAINLINE                                       12210000
117400         UNTIL EOC-LEVEL-CSR.                                     12220000
117500                                                                  12230000
117600     PERFORM Z9000-EOF-PROCESSING.                                12240000
117700                                                                  12250000
117800     STOP RUN.                                                    12260000
117900                                                                  12270000
118000     EJECT                                                        12280000
118100                                                                  12290000
118200****************************************************************  12300000
118300* OPENS ALL FILES ASSOCIATED WITH THE JOB, GETS CURRENT DATE   *  12310000
118400* AND TIME FOR REPORT HEADINGS, AND GETS DEFAULT VALUES        *  12320000
118500****************************************************************  12330000
118600 A0000-INITIALIZE.                                                12340000
118700                                                                  12350000
118800     OPEN INPUT  EXCEPTION-FILE                                   12360000
118900                 BIM-FILE                                         12370000
119000                 IC-PARM-FILE                                     12380000
119100          OUTPUT PRINT-REPORT.                                    12390000
119200                                                                  12400000
119300     IF  NOT SC-EXCEPT-STATUS-OK                                  12410000
119400         MOVE 'A0000-INITIALIZE'      TO PV-ABEND-PARAGRAPH       12420000
119500         MOVE 'EXCPT-FILE'            TO PV-ERROR-FILE            12430000
119600         MOVE 'OPENING INPUT FILE'    TO PV-ERROR-OPERATION       12440000
119700         MOVE 'BAD-OPEN'              TO PV-ERROR-STATUS          12450000
119800         MOVE SC-EXCEPT-STATUS        TO PV-VSAM-STATUS           12460000
119900         MOVE '//////////////'        TO PV-NOT-FOUND-KEY         12470000
120000         PERFORM Z9999-VSAM-ERROR                                 12480000
120100         MOVE +4005                   TO PV-ABEND-CODE            12490000
120200         CALL 'ILBOABN0'        USING PV-ABEND-CODE               12500000
120300     END-IF.                                                      12510000
120400                                                                  12520000
120500     IF  NOT SC-BIM-STATUS-OK                                     12530000
120600         MOVE 'A0000-INITIALIZE'      TO PV-ABEND-PARAGRAPH       12540000
120700         MOVE 'BIM-FILE'              TO PV-ERROR-FILE            12550000
120800         MOVE 'OPENING INPUT FILE'    TO PV-ERROR-OPERATION       12560000
120900         MOVE 'BAD-OPEN'              TO PV-ERROR-STATUS          12570000
121000         MOVE SC-BIM-STATUS           TO PV-VSAM-STATUS           12580000
121100         MOVE '//////////////'        TO PV-NOT-FOUND-KEY         12590000
121200         PERFORM Z9999-VSAM-ERROR                                 12600000
121300         MOVE +4005                   TO PV-ABEND-CODE            12610000
121400         CALL 'ILBOABN0'        USING PV-ABEND-CODE               12620000
121500     END-IF.                                                      12630000
121600                                                                  12640000
121900     ACCEPT CT-CPU-TIME FROM TIME.                                12650000
122000     MOVE CT-CPU-HR                   TO DP132-RUN-HOUR.          12660000
122100     MOVE CT-CPU-MIN                  TO DP132-RUN-MINUTE.        12670000
122200                                                                  12680000
122300     ACCEPT CD-SCHEDULE-DATE.                                     12690000
122400     MOVE CD-MONTH                    TO DP132-RUN-MONTH          12700000
122500                                         PV-MO.                   12710000
122600     MOVE CD-DAY                      TO DP132-RUN-DAY            12720000
122700                                         PV-DY.                   12730000
122800     MOVE CD-YEAR                     TO DP132-RUN-YEAR           12740000
122900                                         PV-YR.                   12750000
123000                                                                  12760000
123100     MOVE 1                           TO DP132-REPORT-NUMBER.     12770000
123200     MOVE 'MRKRP094'                  TO DP132-PROGRAM-NAME.      12780000
123300                                                                  12790000
123400     PERFORM A1000-POPULATE-TABLE.                                12800000
123500                                                                  12810000
123600     MOVE ZEROES                      TO EXCEPTION-KEY.           12820000
123700     PERFORM B0200-READ-INPUT-FILE.                               12830000
123800                                                                  12840000
123900     MOVE MR032-LEVEL                 TO PV-DEFAULT-LEVEL.        12850000
124000     MOVE MR032-SW-EXCEPT             TO PV-DEFAULT-SW-EXCEPT.    12860000
124100     IF PV-DEFAULT-PER                                            12870000
124200         MOVE MR032-PERCENT-VARIANCE  TO PV-DEFAULT-PERCENT       12880000
124300         COMPUTE PV-DEFAULT-NEG-PERCENT = PV-DEFAULT-PERCENT * -1 12890000
124400     ELSE                                                         12900000
124500         IF PV-DEFAULT-WOS                                        12910000
124600             MOVE MR032-LESS-THAN     TO PV-DEFAULT-LESS-WEEK     12920000
124700             MOVE MR032-MORE-THAN     TO PV-DEFAULT-MORE-WEEK     12930000
124800         END-IF                                                   12940000
124900     END-IF.                                                      12950000
125000                                                                  12960000
125100     PERFORM A2000-READ-PARM-FILE.                                12970000
125200     MOVE MR001I-S-SYS-ID             TO HL-SYSID.                12980000
125300     MOVE MR001I-S-SYS-ID             TO PV-SYS-ID.               12990000
125400                                                                  13000000
125500     IF PV-DAY-NBR = 0                                            13010000
125600         MOVE 0                       TO PV-CC-DAY                13020000
125700         MOVE 0                       TO PV-CC-DAY2               13030000
125800     ELSE                                                         13040000
125900         MOVE PV-DAY-NBR              TO PV-CC-DAY                13050000
126000         MOVE PV-DAY-NBR              TO PV-CC-DAY2               13060000
126100         IF PV-EVEN                                               13070000
126200             ADD PC-SEVEN             TO PV-CC-DAY2               13080000
126300         END-IF                                                   13090000
126400     END-IF.                                                      13100000
126500                                                                  13110000
126600** SMM 2/14/00                                                    13120000
126700     IF (PV-SYS-ID-X = 'B') OR (PV-SYS-ID-X = '2')                13130000
126800         ADD 100                      TO PV-CC-DAY                13140000
126900         ADD 100                      TO PV-CC-DAY2               13150000
127000     END-IF.                                                      13160000
126600** RAS 10/25/07                                                   13170000
126700     IF (PV-SYS-ID-X = 'C')                                       13180000
126800         ADD 200                      TO PV-CC-DAY                13190000
126900         ADD 200                      TO PV-CC-DAY2               13200000
127000     END-IF.                                                      13210000
127000                                                                  13220001
126700     IF PV-SYS-ID-X = PC-D                                        13230002
126800        ADD 400                       TO PV-CC-DAY                13240002
126900        ADD 400                       TO PV-CC-DAY2               13250002
127000     END-IF.                                                      13260001
127000                                                                  13270001
127100     DISPLAY 'PV-CC-DAY = ' PV-CC-DAY                             13280000
127100     DISPLAY 'PV-CC-DAY2 = ' PV-CC-DAY2                           13290000
127200                                                                  13300000
127300     PERFORM A3000-OPEN-DRIVING-CURSOR.                           13310000
127400                                                                  13320000
127500***************************************************************** 13330000
127600*  POPULATE MONTH TABLE                                         * 13340000
127700***************************************************************** 13350000
127800 A1000-POPULATE-TABLE.                                            13360000
127900                                                                  13370000
128000     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              13380000
128100     MOVE PV-DATE             TO DPG52-LK-DATE-INPUT.             13390000
128200                                                                  13400000
128300     MOVE SPACES              TO DPG51-INCREMENT-DECREMENT-FLAG.  13410000
128400     MOVE PC-F2               TO DPG51-CALENDAR-TYPE.             13420000
128500     SET DPG52-LK-DTE-ISO     TO TRUE.                            13430000
128600                                                                  13440000
128700     PERFORM A1100-CALENDAR-ROUTINE.                              13450000
128800     MOVE DPG56-FISCAL-YEAR-CCYY TO PV-YEAR                       13460000
128900                                    PV-CURR-YEAR.                 13470000
129000     MOVE DPG56-FISCAL-WEEK-NBR  TO PV-WEEK                       13480000
129100                                    PV-CURR-WEEK.                 13490000
129200                                                                  13500000
129300     IF PV-WEEK = 53                                              13510000
129400         MOVE PC-52             TO PV-WEEK                        13520000
129500         MOVE PC-52X            TO PV-CURR-WEEK                   13530000
129600     END-IF.                                                      13540000
129700                                                                  13550000
129800     MOVE PV-WEEK(2:1)          TO PV-EVEN-ODD-WEEK.              13560000
129900                                                                  13570000
130000     PERFORM A1200-CALCULATE-FUTURE-WEEK                          13580000
130100             VARYING PV-FUTR-INDEX       FROM 1 BY 1              13590000
130200             UNTIL PV-FUTR-INDEX       GREATER THAN PC-FIVE.      13600000
130300                                                                  13610000
130400     PERFORM A1300-CALCULATE-HIST-WEEK.                           13620000
130500                                                                  13630000
130600******************************************************************13640000
130700* CALL CALENDAR ROUTINE                                           13650000
130800******************************************************************13660000
130900 A1100-CALENDAR-ROUTINE.                                          13670000
131000                                                                  13680000
131100     CALL PC-PGM-DPKUT500 USING DPG51 DPG52                       13690000
131200                                DPG53 DPG54                       13700000
131300                                DPG55 DPG56.                      13710000
131400     EVALUATE TRUE                                                13720000
131500     WHEN DPG54-SEVERE-ERROR                                      13730000
131600         DISPLAY 'SEVERE ERROR IN CALENDAR ROUTINE'               13740000
131700         DISPLAY DPG54-ERROR-MESSAGE                              13750000
131800         DISPLAY 'INPUT DATE: '  DPG52-LK-DATE-INPUT              13760000
131900         CALL 'ILBOABN0'        USING PV-ABEND-CODE               13770000
132000     WHEN DPG54-WARNING-ERROR                                     13780000
132100         DISPLAY 'WARNING ERROR IN CALENDAR ROUTINE'              13790000
132200         DISPLAY DPG54-ERROR-MESSAGE                              13800000
132300     WHEN DPG54-NO-ERROR                                          13810000
132400         CONTINUE                                                 13820000
132500     END-EVALUATE.                                                13830000
132600                                                                  13840000
132700******************************************************************13850000
132800* CALCULATE NEXT 5 FISCAL WEEKS AND STORES THEM TO GET THE FUTURE 13860000
132900* FORECASTS.                                                      13870000
133000******************************************************************13880000
133100 A1200-CALCULATE-FUTURE-WEEK.                                     13890000
133200                                                                  13900000
133300     IF PV-WEEK  < PC-52                                          13910000
133400         ADD 1              TO PV-WEEK                            13920000
133500     ELSE                                                         13930000
133600         IF PV-WEEK = PC-52                                       13940000
133700             MOVE PC-ONE    TO   PV-WEEK                          13950000
133800             ADD 1          TO PV-YEAR                            13960000
133900         END-IF                                                   13970000
134000     END-IF.                                                      13980000
134100                                                                  13990000
134200     MOVE PV-WEEK          TO PT-FUTURE-WEEK(PV-FUTR-INDEX).      14000000
134300     MOVE PV-YEAR          TO PT-FUTURE-YEAR(PV-FUTR-INDEX).      14010000
134400                                                                  14020000
134500******************************************************************14030000
134600* CALCULATE PREV 4 FISCAL WEEKS AND STORES THEM TO GET HISTORICAL 14040000
134700* DATA.                                                           14050000
134800******************************************************************14060000
134900 A1300-CALCULATE-HIST-WEEK.                                       14070000
135000                                                                  14080000
135100     MOVE PC-FOUR           TO PV-HIST-INDEX.                     14090000
135200     MOVE PC-ONE            TO PV-DECREMENT.                      14100000
135300     PERFORM A1400-FORMAT-DATE-READ.                              14110000
135400                                                                  14120000
135500     MOVE PC-THREE          TO PV-HIST-INDEX.                     14130000
135600     ADD  PC-ONE            TO PV-DECREMENT.                      14140000
135700     PERFORM A1400-FORMAT-DATE-READ.                              14150000
135800                                                                  14160000
135900     MOVE PC-TWO            TO PV-HIST-INDEX.                     14170000
136000     ADD  PC-ONE            TO PV-DECREMENT.                      14180000
136100     PERFORM A1400-FORMAT-DATE-READ.                              14190000
136200                                                                  14200000
136300     MOVE PC-ONE            TO PV-HIST-INDEX.                     14210000
136400     ADD  PC-ONE            TO PV-DECREMENT.                      14220000
136500     PERFORM A1400-FORMAT-DATE-READ.                              14230000
136600                                                                  14240000
136700******************************************************************14250000
136800* CALCULATE PREV 4 FISCAL WEEKS AND STORES THEM TO GET HISTORICAL 14260000
136900* DATA.                                                           14270000
137000******************************************************************14280000
137100 A1400-FORMAT-DATE-READ.                                          14290000
137200                                                                  14300000
137300     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              14310000
137400     MOVE PV-CURR-WEEK-YEAR        TO DPG52-LK-DATE-INPUT.        14320000
137500     SET DPG52-LK-DTE-FISC-WEEK-CC TO TRUE.                       14330000
137600     SET DPG51-DECREMENT-DATE    TO TRUE.                         14340000
137700     MOVE PV-DECREMENT           TO DPG51-INCR-DECR-FISCAL-WEEK-9.14350000
137800     MOVE PC-F2                  TO DPG51-CALENDAR-TYPE.          14360000
137900     PERFORM A1100-CALENDAR-ROUTINE.                              14370000
138000                                                                  14380000
138100     IF DPG56-FISCAL-WEEK-NBR  =  53                              14390000
138200         ADD  PC-ONE                    TO PV-DECREMENT           14400000
138300         INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56           14410000
138400         MOVE PV-CURR-WEEK-YEAR         TO DPG52-LK-DATE-INPUT    14420000
138500         SET  DPG52-LK-DTE-FISC-WEEK-CC TO TRUE                   14430000
138600         SET  DPG51-DECREMENT-DATE      TO TRUE                   14440000
138700         MOVE PV-DECREMENT       TO DPG51-INCR-DECR-FISCAL-WEEK-9 14450000
138800         MOVE PC-F2              TO DPG51-CALENDAR-TYPE           14460000
138900         PERFORM A1100-CALENDAR-ROUTINE                           14470000
139000     END-IF.                                                      14480000
139100                                                                  14490000
139200     MOVE DPG56-FISCAL-YEAR-CCYY TO PT-HIST-YEAR(PV-HIST-INDEX).  14500000
139300     MOVE DPG56-FISCAL-WEEK-NBR  TO PT-HIST-WEEK(PV-HIST-INDEX).  14510000
139400     DISPLAY 'DATE = ' DPG55-1ST-WKDY-DB2ISO-FMT                  14520000
139400     MOVE DPG55-1ST-WKDY-DB2ISO-FMT                               14530000
139500                                 TO PT-FSCL-DATE(PV-HIST-INDEX).  14540000
139600*RAF                                                              14550000
139600     COMPUTE PV-DATE-INDEX = (PV-HIST-INDEX * PC-SEVEN) - PC-SIX. 14560000
           MOVE DPG55-1ST-WKDY-DB2ISO-FMT TO PT-FSCL-DAY(PV-DATE-INDEX) 14570000
                                     PV-FSCL-WRK-DATE                   14580000
           ADD PC-ONE TO PV-DATE-INDEX                                  14590000
           MOVE DPG55-1ST-WKDY-DB2ISO-FMT TO PV-FSCL-WRK-DATE           14600000
           PERFORM G4500-GET-FSCL-DATES.                                14610000
           MOVE PV-FSCL-EOW-DATE  TO PT-FSCL-DAY(PV-DATE-INDEX)         14620000
                                     PV-FSCL-WRK-DATE                   14630000
           ADD PC-ONE TO PV-DATE-INDEX                                  14640000
           PERFORM G4500-GET-FSCL-DATES.                                14650000
           MOVE PV-FSCL-EOW-DATE  TO PT-FSCL-DAY(PV-DATE-INDEX)         14660000
                                     PV-FSCL-WRK-DATE                   14670000
           ADD PC-ONE TO PV-DATE-INDEX                                  14680000
           PERFORM G4500-GET-FSCL-DATES.                                14690000
           MOVE PV-FSCL-EOW-DATE  TO PT-FSCL-DAY(PV-DATE-INDEX)         14700000
                                     PV-FSCL-WRK-DATE                   14710000
           ADD PC-ONE TO PV-DATE-INDEX                                  14720000
           PERFORM G4500-GET-FSCL-DATES.                                14730000
           MOVE PV-FSCL-EOW-DATE  TO PT-FSCL-DAY(PV-DATE-INDEX)         14740000
                                     PV-FSCL-WRK-DATE                   14750000
           ADD PC-ONE TO PV-DATE-INDEX                                  14760000
           PERFORM G4500-GET-FSCL-DATES.                                14770000
           MOVE PV-FSCL-EOW-DATE  TO PT-FSCL-DAY(PV-DATE-INDEX)         14780000
                                     PV-FSCL-WRK-DATE                   14790000
           ADD PC-ONE TO PV-DATE-INDEX                                  14800000
           PERFORM G4500-GET-FSCL-DATES.                                14810000
           MOVE PV-FSCL-EOW-DATE  TO PT-FSCL-DAY(PV-DATE-INDEX)         14820000
                                     PV-FSCL-WRK-DATE.                  14830000
      *    ADD PC-ONE TO PV-DATE-INDEX                                  14840000
      *    PERFORM G4500-GET-FSCL-DATES.                                14850000
      *    MOVE PV-FSCL-EOW-DATE  TO PT-FSCL-DAY(PV-DATE-INDEX).        14860000
                                                                        14870000
139600*RAF                                                              14880000
139700***************************************************************** 14890000
139800*  READS PARM FILE TO GET SYS-IS AND RT-DAY-NBR.                  14900000
139900***************************************************************** 14910000
140000 A2000-READ-PARM-FILE.                                            14920000
140100                                                                  14930000
140200     READ IC-PARM-FILE INTO  PARAMETER-INPUT-RECORD.              14940000
140300                                                                  14950000
140400******************************************************************14960000
140500* OPEN DRIVING CURSOR                                             14970000
140600******************************************************************14980000
140700 A3000-OPEN-DRIVING-CURSOR.                                       14990000
140800                                                                  15000000
140900     MOVE 'A3000'                    TO PGM-LOCATION.             15010000
141000     MOVE 'A3000-OPEN-DRIVING-CURSOR' TO PV-ABEND-PARAGRAPH.      15020000
141100                                                                  15030000
141200     EXEC SQL                                                     15040000
141300         OPEN DEPT-LEVEL                                          15050000
141400     END-EXEC.                                                    15060000
141500                                                                  15070000
141600     EVALUATE TRUE                                                15080000
141700       WHEN SQLCODE         = ZERO                                15090000
141800       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    15100000
141900         CONTINUE                                                 15110000
142000       WHEN OTHER                                                 15120000
142100         DISPLAY PV-ABEND-PARAGRAPH                               15130000
142200         PERFORM Z9900-SQL-ERROR                                  15140000
142300     END-EVALUATE.                                                15150000
142400                                                                  15160000
142500******************************************************************15170000
142600* MAIN PROCESSING                                                 15180000
142700******************************************************************15190000
142800 B0000-MAINLINE.                                                  15200000
142900                                                                  15210000
143000     PERFORM B0100-FETCH-DEPT-LEVEL-CSR.                          15220000
143100                                                                  15230000
143200     IF EOC-LEVEL-CSR                                             15240000
143300         CONTINUE                                                 15250000
143400     ELSE                                                         15260000
143500         IF PV-LINE-CNT > 2                                       15270000
143600             PERFORM R1100-PRINT-HEADINGS                         15280000
143700         END-IF                                                   15290000
143800         MOVE SKXREF-DEPT                  TO  PV-HOLD-DEPT-NBR   15300000
143900                                               EXCEPTION-KEY-NBR  15310000
144000         PERFORM B0200-READ-INPUT-FILE                            15320000
144100         MOVE SC-EXCEPT-STATUS             TO PV-VSAM-STATUS      15330000
144200         IF PV-NO-REC-FOUND                                       15340000
144300             MOVE PV-DEFAULT-LEVEL         TO PV-HOLD-LEVEL       15350000
144400             MOVE PV-DEFAULT-SW-EXCEPT     TO PV-HOLD-SW-EXCEPT   15360000
144500             MOVE PV-DEFAULT-PERCENT       TO PV-HOLD-PERCENT     15370000
144600             MOVE PV-DEFAULT-NEG-PERCENT   TO PV-HOLD-NEG-PERCENT 15380000
144700             MOVE PV-DEFAULT-LESS-WEEK     TO PV-HOLD-LESS-WEEK   15390000
144800             MOVE PV-DEFAULT-MORE-WEEK     TO PV-HOLD-MORE-WEEK   15400000
144900         ELSE                                                     15410000
145000             MOVE MR032-LEVEL              TO PV-HOLD-LEVEL       15420000
145100             MOVE MR032-SW-EXCEPT          TO PV-HOLD-SW-EXCEPT   15430000
145200             IF PV-HOLD-PER                                       15440000
145300                 MOVE MR032-PERCENT-VARIANCE TO PV-HOLD-PERCENT   15450000
145400                 COMPUTE PV-HOLD-NEG-PERCENT =                    15460000
145500                                          PV-HOLD-PERCENT * -1    15470000
145600             ELSE                                                 15480000
145700                 IF PV-HOLD-WOS                                   15490000
145800                     MOVE MR032-LESS-THAN  TO PV-HOLD-LESS-WEEK   15500000
145900                     MOVE MR032-MORE-THAN  TO PV-HOLD-MORE-WEEK   15510000
146000                 END-IF                                           15520000
146100             END-IF                                               15530000
146200         END-IF                                                   15540000
146300         PERFORM B1000-DECIDE-CURSOR-PATH                         15550000
146400     END-IF.                                                      15560000
146500                                                                  15570000
146600******************************************************************15580000
146700* FETCHS ROW FROM THE DRIVING CURSOR                              15590000
146800******************************************************************15600000
146900 B0100-FETCH-DEPT-LEVEL-CSR.                                      15610000
147000                                                                  15620000
147100     MOVE 'B0100'                        TO PGM-LOCATION.         15630000
147200     MOVE 'B0100-FETCH-DEPT-LEVEL-CSR' TO PV-ABEND-PARAGRAPH.     15640000
147300                                                                  15650000
147400     EXEC SQL                                                     15660000
147500       FETCH DEPT-LEVEL                                           15670000
147600        INTO                                                      15680000
147700              :SKXREF-DEPT                                        15690000
147800     END-EXEC.                                                    15700000
147900                                                                  15710000
148000     EVALUATE TRUE                                                15720000
148100       WHEN SQLCODE         = ZERO                                15730000
148200**       CONTINUE                                                 15740000
148300         DISPLAY '  DPT NUMBER: ' SKXREF-DEPT                     15750000
148400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    15760000
148500         PERFORM Z8000-CLOSE-DEPT-LEVEL-CSR                       15770000
148600         MOVE PC-Y TO PS-EOC-LEVEL-CSR                            15780000
148700       WHEN OTHER                                                 15790000
148800         DISPLAY PV-ABEND-PARAGRAPH                               15800000
148900         PERFORM Z9900-SQL-ERROR                                  15810000
149000     END-EVALUATE.                                                15820000
149100                                                                  15830000
149200***************************************************************** 15840000
149300* B0200-READ-INPUT-FILE - EXCEPTION FILE CONTAINS THE MERCHANDISE 15850000
149400* LEVEL TO REPORT AT AND EXCEPTION CRITERIA FOR A DEPARTMENT      15860000
149500***************************************************************** 15870000
149600 B0200-READ-INPUT-FILE.                                           15880000
149700                                                                  15890000
149800     READ EXCEPTION-FILE     INTO MR032-FORECAST-V-ACTUAL-RECORD. 15900000
149900                                                                  15910000
150000***************************************************************** 15920000
150100* DECIDES WHICH LEVEL TO REPORT AT AND CREATES CONTROL BREAKS     15930000
150200***************************************************************** 15940000
150300 B1000-DECIDE-CURSOR-PATH.                                        15950000
150400                                                                  15960000
150500     EVALUATE TRUE                                                15970000
150600       WHEN PV-HOLD-LEVEL   = 'VSC'                               15980000
150700           PERFORM C0000-COLOR-STYLE-BREAK                        15990000
150800       WHEN PV-HOLD-LEVEL   = 'MCL'                               16000000
150900           PERFORM D0000-MAJOR-CLASS-BREAK                        16010000
151000       WHEN PV-HOLD-LEVEL   = 'SCL'                               16020000
151100           PERFORM E0000-SUB-CLASS-BREAK                          16030000
151200       WHEN PV-HOLD-LEVEL   = 'GRP'                               16040000
151300           PERFORM F0000-GROUP-BREAK                              16050000
151400       WHEN PV-HOLD-LEVEL   = 'VND'                               16060000
151500           PERFORM G0000-VENDOR-BREAK                             16070000
151600     END-EVALUATE.                                                16080000
151700                                                                  16090000
151800***************************************************************** 16100000
151900* READ BIM FILE TO GET BI FOR FORECAST CALCULATION                16110000
152000***************************************************************** 16120000
152100 B2000-READ-BIM-FILE.                                             16130000
152200                                                                  16140000
152300     READ BIM-FILE        INTO  PAN-BIM-FILE                      16150000
152400                                KEY IS BIM-FILE-KEY.              16160000
152500                                                                  16170000
152600     IF  NOT SC-BIM-STATUS-OK                                     16180000
152700         IF SC-BIM-RECORD-NOT-FOUND                               16190000
152800             SET BIM-RECORD-NOT-FOUND TO TRUE                     16200000
152900         ELSE                                                     16210000
153000             MOVE 'B2000-READ-BIM-FILE'   TO PV-ABEND-PARAGRAPH   16220000
153100             MOVE 'BIM-FILE'              TO PV-ERROR-FILE        16230000
153200             MOVE 'READ FILE         ' TO PV-ERROR-OPERATION      16240000
153300             MOVE 'BAD-READ'          TO PV-ERROR-STATUS          16250000
153400             MOVE SC-BIM-STATUS       TO PV-VSAM-STATUS           16260000
153500             MOVE BIM-FILE-KEY        TO PV-NOT-FOUND-KEY         16270000
153600             PERFORM Z9999-VSAM-ERROR                             16280000
153700             MOVE +4005               TO PV-ABEND-CODE            16290000
153800             CALL 'ILBOABN0'    USING PV-ABEND-CODE               16300000
153900         END-IF                                                   16310000
154000     END-IF.                                                      16320000
154100                                                                  16330000
154200***************************************************************** 16340000
154300* B3000-CALCULATE-WEEKS-SUPPLY.                                   16350000
154400***************************************************************** 16360000
154500 B3000-CALCULATE-WEEKS-SUPPLY.                                    16370000
154600                                                                  16380000
154700     MOVE PC-N  TO PS-FOUND-WEEKS-ONHAND.                         16390000
154800     MOVE ZERO  TO PV-ONHAND-COMPARE.                             16400000
154900     MOVE ZERO  TO PV-WOS.                                        16410000
155000     PERFORM B3100-FIND-WEEKS-ONHAND                              16420000
155100         VARYING PV-WOS-INDEX  FROM 1 BY 1                        16430000
155200         UNTIL FOUND-WEEKS-ONHAND                                 16440000
155300           OR PV-WOS-INDEX > PC-52.                               16450000
155400                                                                  16460000
155500     IF PV-HOLD-WOS                                               16470000
155600         IF DL3-WOS-ONHAND  = '+++'                               16480000
155700             CONTINUE                                             16490000
155800         ELSE                                                     16500000
155900             MOVE PC-N                   TO PS-WITHIN-WEEK-RANGE  16510000
156000             IF PV-HOLD-MORE-WEEK  NOT = 0                        16520000
156100                 IF PV-HOLD-MORE-WEEK < PV-WOS                    16530000
156200                     MOVE PC-Y           TO PS-WITHIN-WEEK-RANGE  16540000
156300                 END-IF                                           16550000
156400             END-IF                                               16560000
156500             IF PV-HOLD-LESS-WEEK  NOT = 0                        16570000
156600                 IF PV-HOLD-LESS-WEEK > PV-WOS                    16580000
156700                     MOVE PC-Y           TO PS-WITHIN-WEEK-RANGE  16590000
156800                 END-IF                                           16600000
156900             END-IF                                               16610000
157000             IF NOT WITHIN-WEEK-RANGE                             16620000
157100                 MOVE PC-N               TO PS-PROCESS-LINE-INFO  16630000
157200             END-IF                                               16640000
157300         END-IF                                                   16650000
157400     END-IF.                                                      16660000
157500                                                                  16670000
157600     IF PROCESS-LINE-INFO                                         16680000
157700         IF DL3-WOS-ONHAND  = '+++'                               16690000
157800            MOVE  '+++'              TO DL3-WOS-ONORDER           16700000
157900         ELSE                                                     16710000
158000            MOVE 0                   TO PV-WOO                    16720000
158100            MOVE SPACES              TO DL3-WOS-ONORDER           16730000
158200            ADD PV-ONHAND TO PV-ON-ORDER GIVING PV-ONHAND-ONORDER 16740000
158300            MOVE ZERO TO PV-ONORDER-COMPARE                       16750000
158400            MOVE PC-N TO PS-FOUND-WEEKS-ONORDER                   16760000
158500            PERFORM B3200-FIND-WEEKS-ONORDER                      16770000
158600              VARYING PV-WOS-INDEX  FROM 1 BY 1                   16780000
158700              UNTIL FOUND-WEEKS-ONORDER OR PV-WOS-INDEX > PC-52   16790000
158800            IF DL3-WOS-ONORDER  NOT EQUAL '+++'                   16800000
158900                SUBTRACT PV-WOS FROM PV-WOO                       16810000
159000                MOVE PV-WOO                TO DL3-WOS-ONORDER     16820000
159100            END-IF                                                16830000
159200         END-IF                                                   16840000
159300         SUBTRACT PV-CSTOCK FROM PV-ONHAND                        16850000
159400                                          GIVING PV-ONHAND-CSTOCK 16860000
159500         MOVE ZERO TO PV-CSTOCK-COMPARE                           16870000
159600         MOVE PC-N TO PS-FOUND-WEEKS-CSTOCK                       16880000
159700         PERFORM B3300-FIND-WEEKS-CSTOCK                          16890000
159800             VARYING PV-WOS-INDEX  FROM 1 BY 1                    16900000
159900             UNTIL FOUND-WEEKS-CSTOCK                             16910000
160000               OR PV-WOS-INDEX > PC-52                            16920000
160100     END-IF.                                                      16930000
160200                                                                  16940000
160300***************************************************************** 16950000
160400* CALCULATE WEEKS OF SUPPLY ONHAND                                16960000
160500***************************************************************** 16970000
160600 B3100-FIND-WEEKS-ONHAND.                                         16980000
160700                                                                  16990000
160800     ADD PT-FORECAST-AMOUNT(PV-WOS-INDEX) TO PV-ONHAND-COMPARE.   17000000
160900     IF PV-ONHAND-COMPARE          =  PV-ONHAND                   17010000
161000         SET FOUND-WEEKS-ONHAND TO TRUE                           17020000
161100         MOVE PV-WOS-INDEX      TO DL3-WOS-ONHAND                 17030000
161200                                   PV-WOS                         17040000
161300     ELSE                                                         17050000
161400         IF PV-ONHAND-COMPARE > PV-ONHAND                         17060000
161500             SET FOUND-WEEKS-ONHAND  TO TRUE                      17070000
161600             SUBTRACT PC-ONE         FROM PV-WOS-INDEX            17080000
161700             MOVE PV-WOS-INDEX       TO DL3-WOS-ONHAND            17090000
161800                                        PV-WOS                    17100000
161900         ELSE                                                     17110000
162000             IF PV-WOS-INDEX = PC-52                              17120000
162100                 MOVE '+++'              TO DL3-WOS-ONHAND        17130000
162200             END-IF                                               17140000
162300         END-IF                                                   17150000
162400     END-IF.                                                      17160000
162500                                                                  17170000
162600***************************************************************** 17180000
162700* CALCULATE WEEKS OF SUPPLY THAT ARE ONORDER                      17190000
162800***************************************************************** 17200000
162900 B3200-FIND-WEEKS-ONORDER.                                        17210000
163000                                                                  17220000
163100     ADD PT-FORECAST-AMOUNT(PV-WOS-INDEX) TO PV-ONORDER-COMPARE.  17230000
163200     IF PV-ONORDER-COMPARE         =  PV-ONHAND-ONORDER           17240000
163300         SET FOUND-WEEKS-ONORDER TO TRUE                          17250000
163400         MOVE PV-WOS-INDEX      TO PV-WOO                         17260000
163500     ELSE                                                         17270000
163600         IF PV-ONORDER-COMPARE > PV-ONHAND-ONORDER                17280000
163700             SET FOUND-WEEKS-ONORDER  TO TRUE                     17290000
163800             SUBTRACT PC-ONE         FROM PV-WOS-INDEX            17300000
163900             MOVE PV-WOS-INDEX       TO PV-WOO                    17310000
164000         ELSE                                                     17320000
164100             IF PV-WOS-INDEX = PC-52                              17330000
164200                 MOVE '+++'              TO DL3-WOS-ONORDER       17340000
164300             END-IF                                               17350000
164400         END-IF                                                   17360000
164500     END-IF.                                                      17370000
164600                                                                  17380000
164700***************************************************************** 17390000
164800* CALCULATE WEEKS OF SUPPLY LESS CSTOCK                           17400000
164900***************************************************************** 17410000
165000 B3300-FIND-WEEKS-CSTOCK.                                         17420000
165100                                                                  17430000
165200     ADD PT-FORECAST-AMOUNT(PV-WOS-INDEX) TO PV-CSTOCK-COMPARE.   17440000
165300     IF PV-CSTOCK-COMPARE         =  PV-ONHAND-CSTOCK             17450000
165400         SET FOUND-WEEKS-CSTOCK  TO TRUE                          17460000
165500         MOVE PV-WOS-INDEX      TO DL3-WOS-CSTOCK                 17470000
165600     ELSE                                                         17480000
165700         IF PV-CSTOCK-COMPARE > PV-ONHAND-CSTOCK                  17490000
165800             SET FOUND-WEEKS-CSTOCK   TO TRUE                     17500000
165900             SUBTRACT PC-ONE         FROM PV-WOS-INDEX            17510000
166000             MOVE PV-WOS-INDEX       TO DL3-WOS-CSTOCK            17520000
166100         ELSE                                                     17530000
166200             IF PV-WOS-INDEX = PC-52                              17540000
166300                 MOVE '+++'              TO DL3-WOS-CSTOCK        17550000
166400             END-IF                                               17560000
166500         END-IF                                                   17570000
166600     END-IF.                                                      17580000
166700                                                                  17590000
166800***************************************************************** 17600000
166900* CHECK PERCENT VARIANCE TO DECIDE IF THE REPORT LINES SHOULD     17610000
167000* BE WRITTEN.                                                     17620000
167100***************************************************************** 17630000
167200  B4000-CHECK-PERCENT-VARIANCE.                                   17640000
167300                                                                  17650000
167400     MOVE PC-N                      TO PS-WITHIN-PCNT-RANGE.      17660000
167500     PERFORM VARYING PV-PCNT-INDEX FROM 1 BY 1                    17670000
167600      UNTIL WITHIN-PCNT-RANGE OR PV-PCNT-INDEX > PC-FOUR          17680000
167700         IF DL9-DIFFRNC(PV-PCNT-INDEX) = '***'                    17690000
167800             CONTINUE                                             17700000
167900         ELSE                                                     17710000
168000             MOVE DL9-DIFFRNC-N(PV-PCNT-INDEX) TO PV-COMP-PERCENT 17720000
168100             IF PV-COMP-PERCENT           =  PV-HOLD-PERCENT      17730000
168200              OR PV-COMP-PERCENT          >  PV-HOLD-PERCENT      17740000
168300                 MOVE PC-Y                TO PS-WITHIN-PCNT-RANGE 17750000
168400             ELSE                                                 17760000
168500                 IF PV-COMP-PERCENT        =  PV-HOLD-NEG-PERCENT 17770000
168600                  OR PV-COMP-PERCENT       <  PV-HOLD-NEG-PERCENT 17780000
168700                     MOVE PC-Y            TO PS-WITHIN-PCNT-RANGE 17790000
168800                 END-IF                                           17800000
168900             END-IF                                               17810000
169000         END-IF                                                   17820000
169100     END-PERFORM.                                                 17830000
169200                                                                  17840000
169300     IF WITHIN-PCNT-RANGE                                         17850000
169400         CONTINUE                                                 17860000
169500     ELSE                                                         17870000
169600         SET DONE-PROCESSING        TO TRUE                       17880000
169700     END-IF.                                                      17890000
169800                                                                  17900000
169900***************************************************************** 17910000
170000* CALCULATE THE PERCENT OF VARIANCE FOR THE PREVIOUS FOUR WEEKS   17920000
170100***************************************************************** 17930000
170200 B4100-CALCULATE-CUMM-PCNT.                                       17940000
170300                                                                  17950000
170400     IF PV-CUMM-FRCST = 0 OR PV-CUMM-SALES = 0                    17960000
170500         MOVE 0                       TO DL9-CUMM-DIFFRNC         17970000
170600     ELSE                                                         17980000
170700        COMPUTE PV-HOLD-CUMM-FRCST-PCT =                          17990000
170800             (PV-CUMM-SALES - PV-CUMM-FRCST) / PV-CUMM-FRCST * 10018000000
170900        COMPUTE PV-CUMM-FRCST-PCT ROUNDED = PV-HOLD-CUMM-FRCST-PCT18010000
171000        MOVE PV-CUMM-FRCST-PCT       TO DL9-CUMM-DIFFRNC          18020000
171100     END-IF.                                                      18030000
171200                                                                  18040000
171300***************************************************************** 18050000
171400* CALCULATE THE PERCENT OF CSTOCK.                                18060000
171500***************************************************************** 18070000
171600 B4200-CALCULATE-CSTOCK-PERCENT.                                  18080000
171700                                                                  18090000
171800     IF PV-CSTOCK = 0 OR PV-ONHAND = 0                            18100000
171900         MOVE 0                       TO DL3-PCNT-CSTOCK          18110000
172000     ELSE                                                         18120000
172100         COMPUTE PV-HOLD-CSTOCK-PCT =                             18130000
172200                           (PV-CSTOCK / PV-ONHAND) * 100          18140000
172300         COMPUTE PV-CSTOCK-PERCENT ROUNDED = PV-HOLD-CSTOCK-PCT   18150000
172400         MOVE PV-CSTOCK-PERCENT       TO DL3-PCNT-CSTOCK          18160000
172500     END-IF.                                                      18170000
172600                                                                  18180000
172700***************************************************************** 18190000
172800* CONTROL BREAK AT THE COLOR STYLE LEVEL                          18200000
172900***************************************************************** 18210000
173000 C0000-COLOR-STYLE-BREAK.                                         18220000
173100                                                                  18230000
173200     MOVE PC-N                         TO PS-EOC-COLOR-STYLE-CSR. 18240000
173300     PERFORM C0100-OPEN-COLOR-STYLE-CSR.                          18250000
173400     PERFORM C0200-PROCESS-COLOR-STYLE-CSR                        18260000
173500                                       UNTIL EOC-COLOR-STYLE-CSR. 18270000
173600                                                                  18280000
173700***************************************************************** 18290000
173800* OPEN COLOR STYLE CURSOR                                         18300000
173900***************************************************************** 18310000
174000 C0100-OPEN-COLOR-STYLE-CSR.                                      18320000
174100                                                                  18330000
174200     MOVE 'C0100'                      TO PGM-LOCATION.           18340000
174300     MOVE 'C0100-OPEN-COLOR-STYLE-CSR' TO PV-ABEND-PARAGRAPH.     18350000
174400                                                                  18360000
174500     EXEC SQL                                                     18370000
174600         OPEN COLOR-STYLE-LEVEL                                   18380000
174700     END-EXEC.                                                    18390000
174800                                                                  18400000
174900     EVALUATE TRUE                                                18410000
175000       WHEN SQLCODE         = ZERO                                18420000
175100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    18430000
175200         CONTINUE                                                 18440000
175300       WHEN OTHER                                                 18450000
175400         DISPLAY PV-ABEND-PARAGRAPH                               18460000
175500         PERFORM Z9900-SQL-ERROR                                  18470000
175600     END-EVALUATE.                                                18480000
175700                                                                  18490000
175800***************************************************************** 18500000
175900* PROCESS COLOR STYLE CURSOR                                      18510000
176000***************************************************************** 18520000
176100 C0200-PROCESS-COLOR-STYLE-CSR.                                   18530000
176200                                                                  18540000
176300     PERFORM C0300-FETCH-COLOR-STYLE-CSR.                         18550000
176400     IF EOC-COLOR-STYLE-CSR                                       18560000
176500         CONTINUE                                                 18570000
176600     ELSE                                                         18580000
176800         MOVE SKXREF-CLASS               TO  PV-HOLD-CLASS-NBR    18590000
176900         MOVE SKXREF-SUBCLASS            TO  PV-HOLD-SCL-NBR      18600000
177000         MOVE TSK-LONG-COLOR-DESC        TO  PV-HOLD-COLOR        18610000
177100         MOVE TSK-LONG-VENDOR-STYLE      TO  PV-HOLD-STYLE        18620000
177200         MOVE PC-Y                       TO  PS-PROCESS-LINE-INFO 18630000
177300         PERFORM C1000-CREATE-REPORT-LINES                        18640000
177400         IF PROCESS-LINE-INFO                                     18650000
177500             PERFORM R0000-PRINT-REPORT-LINES                     18660000
177600         END-IF                                                   18670000
177700     END-IF.                                                      18680000
177800                                                                  18690000
177900***************************************************************** 18700000
178000* FETCH COLOR STYLE CURSOR                                        18710000
178100***************************************************************** 18720000
178200  C0300-FETCH-COLOR-STYLE-CSR.                                    18730000
178300                                                                  18740000
178400     MOVE 'C0300'                       TO PGM-LOCATION.          18750000
178500     MOVE 'C0300-FETCH-COLOR-STYLE-CURSOR'                        18760000
178600                                        TO PV-ABEND-PARAGRAPH.    18770000
178700                                                                  18780000
178800     EXEC SQL                                                     18790000
178900       FETCH COLOR-STYLE-LEVEL                                    18800000
179000        INTO                                                      18810000
179100              :SKXREF-DEPT                                        18820000
179200             ,:SKXREF-CLASS                                       18830000
179300             ,:SKXREF-SUBCLASS                                    18840000
179400             ,:TSK-LONG-COLOR-DESC                                18850000
179500             ,:TSK-LONG-VENDOR-STYLE                              18860000
179600     END-EXEC.                                                    18870000
179700                                                                  18880000
179800     EVALUATE TRUE                                                18890000
179900       WHEN SQLCODE         = ZERO                                18900000
180000         CONTINUE                                                 18910000
180100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    18920000
180200         PERFORM C0400-CLOSE-COLOR-STYLE-CSR                      18930000
180300         MOVE PC-Y TO PS-EOC-COLOR-STYLE-CSR                      18940000
180400       WHEN OTHER                                                 18950000
180500         DISPLAY PV-ABEND-PARAGRAPH                               18960000
180600         PERFORM Z9900-SQL-ERROR                                  18970000
180700     END-EVALUATE.                                                18980000
180800                                                                  18990000
180900******************************************************************19000000
181000* CLOSE COLOR STYLE CURSOR                                       *19010000
181100******************************************************************19020000
181200 C0400-CLOSE-COLOR-STYLE-CSR.                                     19030000
181300                                                                  19040000
181400     MOVE 'C0400'                        TO PGM-LOCATION.         19050000
181500     MOVE 'C0400-CLOSE-COLOR-STYLE-CSR'  TO PV-ABEND-PARAGRAPH.   19060000
181600                                                                  19070000
181700     EXEC SQL                                                     19080000
181800         CLOSE COLOR-STYLE-LEVEL                                  19090000
181900     END-EXEC.                                                    19100000
182000                                                                  19110000
182100     EVALUATE TRUE                                                19120000
182200         WHEN SQLCODE EQUAL ZERO                                  19130000
182300         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      19140000
182400             CONTINUE                                             19150000
182500         WHEN OTHER                                               19160000
182600             DISPLAY PV-ABEND-PARAGRAPH                           19170000
182700             PERFORM Z9900-SQL-ERROR                              19180000
182800     END-EVALUATE.                                                19190000
182900                                                                  19200000
183000***************************************************************** 19210000
183100* SET UP DATA FOR THE REPORT LINES                                19220000
183200***************************************************************** 19230000
183300 C1000-CREATE-REPORT-LINES.                                       19240000
183400                                                                  19250000
183500     MOVE ZERO                       TO PV-CUMM-SALES.            19260000
183600     PERFORM C2000-GET-HISTORY-INFO.                              19270000
183700     MOVE PV-CUMM-SALES              TO DL8-CUMM-SALES.           19280000
183800                                                                  19290000
183900     MOVE ZERO                       TO PV-CUMM-FRCST.            19300000
184000     PERFORM C3000-GET-HISTORY-FORECAST.                          19310000
184100     MOVE PV-CUMM-FRCST              TO DL7-CUMM-FRCST.           19320000
184200                                                                  19330000
184300     IF PV-HOLD-PER                                               19340000
184400         PERFORM B4000-CHECK-PERCENT-VARIANCE                     19350000
184500     END-IF.                                                      19360000
184600                                                                  19370000
184700                                                                  19380000
184800     IF PROCESS-LINE-INFO                                         19390000
184900         PERFORM C4000-GET-CURRENT-INFO                           19400000
185000         PERFORM C5000-GET-CURRENT-FORECAST                       19410000
185100         PERFORM B3000-CALCULATE-WEEKS-SUPPLY                     19420000
185200     END-IF.                                                      19430000
185300                                                                  19440000
185400     IF PROCESS-LINE-INFO                                         19450000
185500         PERFORM B4100-CALCULATE-CUMM-PCNT                        19460000
185600         PERFORM B4200-CALCULATE-CSTOCK-PERCENT                   19470000
185700     END-IF.                                                      19480000
185800***************************************************************** 19490000
185900* GETS DD,  MADDSS, ONHAND, AND SALES FOR PREVIOUS FOUR WEEKS     19500000
186000***************************************************************** 19510000
186100 C2000-GET-HISTORY-INFO.                                          19520000
186200                                                                  19530000
186300     PERFORM                                                      19540000
186400       VARYING PV-HIST-INDEX FROM 1 BY 1                          19550000
186500       UNTIL PV-HIST-INDEX > 4                                    19560000
186600          MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR        19570000
186700          MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK        19580000
186800          MOVE PC-N                   TO PS-EOC-HIST-CSR          19590000
186900          PERFORM C2100-FETCH-HISTORY-INFO                        19600000
187000          IF EOC-HIST-CSR                                         19610000
187100              MOVE ZEROES      TO  DL6-DD(PV-HIST-INDEX)          19620000
187200              MOVE ZEROES      TO  DL10-OH-HIST(PV-HIST-INDEX)    19630000
187300          ELSE                                                    19640000
187400              MOVE PV-DD       TO  DL6-DD(PV-HIST-INDEX)          19650000
187500              MOVE PV-ONHAND   TO  DL10-OH-HIST(PV-HIST-INDEX)    19660000
187600          END-IF                                                  19670000
187700     END-PERFORM.                                                 19680000
187800                                                                  19690000
187900     PERFORM                                                      19700000
188000       VARYING PV-HIST-INDEX FROM 1 BY 1                          19710000
188100       UNTIL PV-HIST-INDEX > 4                                    19720000
188200          MOVE PT-FSCL-DATE(PV-HIST-INDEX) TO PV-HOLD-FSCL-DATE   19730000
188300          MOVE PC-N                        TO PS-EOC-SLS-HIST-CSR 19740000
139600          COMPUTE PV-DATE-INDEX =                                 19750000
139600             (PV-HIST-INDEX * PC-SEVEN) - PC-SIX                  19760000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE1    19770000
                ADD PC-ONE TO PV-DATE-INDEX                             19780000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE2    19790000
                ADD PC-ONE TO PV-DATE-INDEX                             19800000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE3    19810000
                ADD PC-ONE TO PV-DATE-INDEX                             19820000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE4    19830000
                ADD PC-ONE TO PV-DATE-INDEX                             19840000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE5    19850000
                ADD PC-ONE TO PV-DATE-INDEX                             19860000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE6    19870000
                ADD PC-ONE TO PV-DATE-INDEX                             19880000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE7    19890000
188400          PERFORM C2300-FETCH-HIST-SLS-INFO                       19900000
188500          IF EOC-SLS-HIST-CSR                                     19910000
188600              MOVE ZEROES      TO  DL8-SALES(PV-HIST-INDEX)       19920000
188700          ELSE                                                    19930000
188800              MOVE PV-SALES    TO  DL8-SALES(PV-HIST-INDEX)       19940000
188900              ADD  PV-SALES    TO  PV-CUMM-SALES                  19950000
189000          END-IF                                                  19960000
189100     END-PERFORM.                                                 19970000
189200                                                                  19980000
189300***************************************************************** 19990000
189400* FETCHS DD, MADDSS, AND ONHAND FOUR THE 4 PREVIOUS WEEKS.        20000000
189500***************************************************************** 20010000
189600 C2100-FETCH-HISTORY-INFO.                                        20020000
189700                                                                  20030000
189800     MOVE 'C2100'                       TO PGM-LOCATION.          20040000
189900     MOVE 'C2100-FETCH-HISTORY-INFO'    TO PV-ABEND-PARAGRAPH.    20050000
190000                                                                  20060000
190100     EXEC SQL                                                     20070000
190200          SELECT                                                  20080000
190300                  COALESCE(SUM(C.OH_HIST_QTY),0)                  20090000
190400                , COALESCE(SUM(C.DSD_HIST_QTY),0)                 20100000
190500                , COALESCE(SUM(C.MAD_HIST_QTY),0)                 20110000
190600          INTO                                                    20120000
190700                :PV-ONHAND                                        20130000
190800               ,:PV-DD                                            20140000
190900               ,:PV-MADDSS                                        20150000
191000          FROM   TSK         A                                    20160000
191100                ,TMRITEM     B                                    20170000
191200                ,TMRISHS     C                                    20180000
191300                ,TMRITST     D                                    20190000
191400                ,XMT_LOC     G                                    20200000
191500                ,TSKXREF     X                                    20210000
191600          WHERE  A.ITEM_NMBR         =  B.ITEM_NBR                20220000
191700            AND  A.ITEM_NMBR         =  C.ITM_NBR                 20230000
191800            AND  A.ITEM_NMBR         =  D.ITEM_NBR                20240000
191900            AND  A.ITEM_NMBR         =  X.ITM_NBR                 20250000
192000            AND  D.FT_CDE            =  'O'                       20260000
192100            AND  D.STR_NBR           =  C.STR_NBR                 20270000
192200            AND  C.STR_NBR           > 0                          20280000
192300            AND  D.STR_NBR           = G.LOC_NBR                  20290000
192400            AND  G.E_BUS_IND         = 'N'                        20300000
192600            AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)        20310000
192700            OR   (RT_NBR > 4                                      20320000
192800            AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)          20330000
192900            AND  RT_DAY_NBR <> 0))                                20340000
193000            AND  C.YR_NBR            = :PV-HOLD-YEAR              20350000
193100            AND  C.WK_NBR            = :PV-HOLD-WEEK              20360000
193200            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          20370000
193300            AND  X.CLASS             = :PV-HOLD-CLASS-NBR         20380000
193400            AND  X.SUBCLASS          = :PV-HOLD-SCL-NBR           20390000
193500            AND  A.LONG_COLOR_DESC   = :PV-HOLD-COLOR             20400000
193600            AND  A.LONG_VENDOR_STYLE = :PV-HOLD-STYLE             20410000
193700            AND  C.ITM_REV_ID        = (SELECT MAX (E.ITM_REV_ID) 20420000
193800                  FROM TMRISHS  E                                 20430000
193900              WHERE                                               20440000
194000                    E.ITM_NBR         =  C.ITM_NBR                20450000
194100                AND E.STR_NBR         =  C.STR_NBR                20460000
194200                AND E.YR_NBR          = :PV-HOLD-YEAR             20470000
194300                AND E.WK_NBR          = :PV-HOLD-WEEK)            20480000
064400            WITH UR                                               20490000
194400     END-EXEC.                                                    20500000
194500                                                                  20510000
194600     EVALUATE TRUE                                                20520000
194700       WHEN SQLCODE         = ZERO                                20530000
194800         CONTINUE                                                 20540000
194900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    20550000
195000         MOVE PC-Y TO PS-EOC-HIST-CSR                             20560000
195100       WHEN OTHER                                                 20570000
195200         DISPLAY PV-ABEND-PARAGRAPH                               20580000
195300         PERFORM Z9900-SQL-ERROR                                  20590000
195400     END-EVALUATE.                                                20600000
195500                                                                  20610000
195600***************************************************************** 20620000
195700* FETCHS SALES FOR 4 PREVIOUS WEEKS.                              20630000
195800***************************************************************** 20640000
195900 C2300-FETCH-HIST-SLS-INFO.                                       20650000
196000                                                                  20660000
196100     MOVE 'C2300'                       TO PGM-LOCATION.          20670000
196200     MOVE 'C2300-FETCH-HIST-SLS-INFO'   TO PV-ABEND-PARAGRAPH.    20680000
196300                                                                  20690000
196400     EXEC SQL                                                     20700000
196500          SELECT                                                  20710000
196600                  COALESCE(SUM(C.SLS_UNT_QTY),0)                  20720000
196700          INTO                                                    20730000
196800                :PV-SALES                                         20740000
196900          FROM   TSK         A                                    20750000
197000                ,TMRITEM     B                                    20760000
262400                ,MHT_DLY_SLS C                                    20770000
197200                ,TMRITST     D                                    20780000
197300                ,XMT_LOC     G                                    20790000
197400                ,TSKXREF     X                                    20800000
197500          WHERE  A.ITEM_NMBR         =  B.ITEM_NBR                20810000
197700            AND  A.ITEM_NMBR         =  D.ITEM_NBR                20820000
197800            AND  A.ITEM_NMBR         =  X.ITM_NBR                 20830000
457000            AND  X.SKU               = C.SKU_NBR                  20840000
197900            AND  D.FT_CDE            =  'O'                       20850000
198000            AND  D.STR_NBR           = C.STR_NBR                  20860000
198100            AND  C.STR_NBR           > 0                          20870000
198200            AND  D.STR_NBR           = G.LOC_NBR                  20880000
198300            AND  G.E_BUS_IND         = 'N'                        20890000
198500            AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)        20900000
198600            OR   (RT_NBR > 4                                      20910000
198700            AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)          20920000
198800            AND  RT_DAY_NBR <> 0))                                20930000
198900            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          20940000
199000            AND  X.CLASS             = :PV-HOLD-CLASS-NBR         20950000
199100            AND  X.SUBCLASS          = :PV-HOLD-SCL-NBR           20960000
199200            AND  A.LONG_COLOR_DESC   = :PV-HOLD-COLOR             20970000
199300            AND  A.LONG_VENDOR_STYLE = :PV-HOLD-STYLE             20980000
458500            AND  C.PRCG_DTE BETWEEN :PV-FSCL-VAR-DATE1 AND        20990000
                                      :PV-FSCL-VAR-DATE7                21000000
064400            WITH UR                                               21010000
194400     END-EXEC.                                                    21020000
199700                                                                  21030000
199800     EVALUATE TRUE                                                21040000
199900       WHEN SQLCODE         = ZERO                                21050000
200000         CONTINUE                                                 21060000
200100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    21070000
200200         MOVE PC-Y TO PS-EOC-SLS-HIST-CSR                         21080000
200300       WHEN OTHER                                                 21090000
200400         DISPLAY PV-ABEND-PARAGRAPH                               21100000
200500         PERFORM Z9900-SQL-ERROR                                  21110000
200600     END-EVALUATE.                                                21120000
200700                                                                  21130000
200800***************************************************************** 21140000
200900* CALCULATES FORECAST FOR LAST 4 WEEKS                            21150000
201000***************************************************************** 21160000
201100 C3000-GET-HISTORY-FORECAST.                                      21170000
201200                                                                  21180000
201300     PERFORM                                                      21190000
201400       VARYING PV-HIST-INDEX FROM 1 BY 1                          21200000
201500       UNTIL PV-HIST-INDEX > 4                                    21210000
201600        MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR          21220000
201700        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK          21230000
201800        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-BIM-WEEK-INDEX     21240000
201900        MOVE PC-N TO PS-EOC-H-FRCST-CSR                           21250000
202000        PERFORM C3100-OPEN-HIST-FRCST-CSR                         21260000
202100        MOVE ZERO                        TO PV-TOTAL-FORECAST     21270000
202200        PERFORM C3200-LOOP-THRU-CSR                               21280000
202300                    UNTIL EOC-H-FRCST-CSR                         21290000
202400        MOVE PV-TOTAL-FORECAST                                    21300000
202500                                 TO DL7-HIST-FRCST(PV-HIST-INDEX) 21310000
202600        ADD  PV-TOTAL-FORECAST   TO PV-CUMM-FRCST                 21320000
202700     END-PERFORM.                                                 21330000
202800                                                                  21340000
202900     PERFORM C3500-CALCULATE-FRCST-PERCENT                        21350000
203000       VARYING PV-HIST-INDEX FROM 1 BY 1                          21360000
203100       UNTIL PV-HIST-INDEX > 4.                                   21370000
203200                                                                  21380000
203300***************************************************************** 21390000
203400* OPEN HIST-FRCST CURSOR                                          21400000
203500***************************************************************** 21410000
203600 C3100-OPEN-HIST-FRCST-CSR.                                       21420000
203700                                                                  21430000
203800     MOVE 'C3100'                    TO PGM-LOCATION.             21440000
203900     MOVE 'C3100-OPEN-HIST-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      21450000
204000                                                                  21460000
204100     EXEC SQL                                                     21470000
204200         OPEN CLR-STL-HIST-FRCST                                  21480000
204300     END-EXEC.                                                    21490000
204400                                                                  21500000
204500     EVALUATE TRUE                                                21510000
204600       WHEN SQLCODE         = ZERO                                21520000
204700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    21530000
204800         CONTINUE                                                 21540000
204900       WHEN OTHER                                                 21550000
205000         DISPLAY PV-ABEND-PARAGRAPH                               21560000
205100         PERFORM Z9900-SQL-ERROR                                  21570000
205200     END-EVALUATE.                                                21580000
205300                                                                  21590000
205400***************************************************************** 21600000
205500* LOOP THRU HIST-FRCST CURSOR AND CALCULATES AND ADDS FORECAST    21610000
205600* TO TOTAL                                                        21620000
205700***************************************************************** 21630000
205800 C3200-LOOP-THRU-CSR.                                             21640000
205900                                                                  21650000
206000     PERFORM C3300-FETCH-HIST-FRCST-CSR.                          21660000
206100     IF EOC-H-FRCST-CSR                                           21670000
206200         CONTINUE                                                 21680000
206300     ELSE                                                         21690000
206400         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                21700000
206500         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      21710000
206600         PERFORM B2000-READ-BIM-FILE                              21720000
206700         IF BIM-RECORD-FOUND                                      21730000
206800             MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI         21740000
206900             IF MRITEM-UCYCLE-CDE = 9                             21750000
207000                 MOVE MRISHS-DSD-HIST-QTY TO PV-DD-COMPUTED       21760000
207100             ELSE                                                 21770000
207200                 IF MRITEM-UCYCLE-CDE = 5                         21780000
207300                     DIVIDE MRISHS-DSD-HIST-QTY BY PC-FOUR        21790000
207400                                     GIVING PV-DD-COMPUTED ROUNDED21800000
207500                 END-IF                                           21810000
207600             END-IF                                               21820000
207700             MULTIPLY PV-BI BY PV-DD-COMPUTED                     21830000
207800                                            GIVING PV-FORECAST    21840000
207900             ADD PV-FORECAST TO PV-TOTAL-FORECAST                 21850000
208000         END-IF                                                   21860000
208100     END-IF.                                                      21870000
208200                                                                  21880000
208300***************************************************************** 21890000
208400* FETCH CLR-STL-HIST-FRCST CURSOR GETS DD AND PTAG TO READ BIM    21900000
208500* FILE                                                            21910000
208600***************************************************************** 21920000
208700 C3300-FETCH-HIST-FRCST-CSR.                                      21930000
208800                                                                  21940000
208900     MOVE 'C3300'                       TO PGM-LOCATION.          21950000
209000     MOVE 'C3300-FETCH-HIST-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    21960000
209100                                                                  21970000
209200     EXEC SQL                                                     21980000
209300       FETCH CLR-STL-HIST-FRCST                                   21990000
209400        INTO                                                      22000000
209500              :MRITEM-UCYCLE-CDE,                                 22010000
209600              :MRISHS-DSD-HIST-QTY,                               22020000
209700              :MRITST-PTAG-ID                                     22030000
209800     END-EXEC.                                                    22040000
209900                                                                  22050000
210000     EVALUATE TRUE                                                22060000
210100       WHEN SQLCODE         = ZERO                                22070000
210200         CONTINUE                                                 22080000
210300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    22090000
210400         PERFORM C3400-CLOSE-FRCST-LEVEL-CSR                      22100000
210500         MOVE PC-Y TO PS-EOC-H-FRCST-CSR                          22110000
210600       WHEN OTHER                                                 22120000
210700         DISPLAY PV-ABEND-PARAGRAPH                               22130000
210800         PERFORM Z9900-SQL-ERROR                                  22140000
210900     END-EVALUATE.                                                22150000
211000                                                                  22160000
211100******************************************************************22170000
211200* CLOSE CLR-STL-HIST-FRCST CURSOR                               * 22180000
211300******************************************************************22190000
211400 C3400-CLOSE-FRCST-LEVEL-CSR.                                     22200000
211500                                                                  22210000
211600     MOVE 'C3400'                        TO PGM-LOCATION.         22220000
211700     MOVE 'C3400-CLOSE-FRCST-LEVEL-CSR'  TO PV-ABEND-PARAGRAPH.   22230000
211800                                                                  22240000
211900     EXEC SQL                                                     22250000
212000         CLOSE CLR-STL-HIST-FRCST                                 22260000
212100     END-EXEC.                                                    22270000
212200                                                                  22280000
212300     EVALUATE TRUE                                                22290000
212400         WHEN SQLCODE EQUAL ZERO                                  22300000
212500         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      22310000
212600             CONTINUE                                             22320000
212700         WHEN OTHER                                               22330000
212800             DISPLAY PV-ABEND-PARAGRAPH                           22340000
212900             PERFORM Z9900-SQL-ERROR                              22350000
213000     END-EVALUATE.                                                22360000
213100                                                                  22370000
213200***************************************************************** 22380000
213300* CALCULATES PERCENT DIFFERENCE BETWEEN WHAT WAS FORECAST AND     22390000
213400* WHAT WAS SOLD.                                                  22400000
213500***************************************************************** 22410000
213600 C3500-CALCULATE-FRCST-PERCENT.                                   22420000
213700                                                                  22430000
213800     MOVE DL7-HIST-FRCST(PV-HIST-INDEX)   TO PV-FORECAST.         22440000
213900     MOVE DL8-SALES(PV-HIST-INDEX)        TO PV-SALES.            22450000
214000                                                                  22460000
214100     IF  PV-FORECAST = 0                                          22470000
214200         MOVE '***'          TO  DL9-DIFFRNC(PV-HIST-INDEX)       22480000
214300     ELSE                                                         22490000
214400         IF PV-SALES  = 0                                         22500000
214500             MOVE 0          TO  DL9-DIFFRNC-N(PV-HIST-INDEX)     22510000
214600         ELSE                                                     22520000
214700             COMPUTE PV-FRCST-PERCENT ROUNDED =                   22530000
214800                  (PV-SALES - PV-FORECAST) / PV-FORECAST * 100    22540000
214900             MOVE PV-FRCST-PERCENT                                22550000
215000                         TO DL9-DIFFRNC-N(PV-HIST-INDEX)          22560000
215100         END-IF                                                   22570000
215200     END-IF.                                                      22580000
215300                                                                  22590000
215400***************************************************************** 22600000
215500* GETS ONORDER, ONHAND, DD, CSTOCK, AVG OSTRAT, AND MAXIMUM LEAD  22610000
215600* TIME.                                                           22620000
215700***************************************************************** 22630000
215800 C4000-GET-CURRENT-INFO.                                          22640000
215900                                                                  22650000
216000     MOVE PC-N TO PS-EOC-CURR-CSR.                                22660000
216100     PERFORM C4100-FETCH-CURRENT-INFO.                            22670000
216200     IF EOC-CURR-CSR                                              22680000
216300         MOVE ZEROES           TO  DL3-ONORDER                    22690000
216400         MOVE ZEROES           TO  DL10-ONHAND                    22700000
216500         MOVE ZEROES           TO  DL6-DD-CURR                    22710000
216600         MOVE ZEROES           TO  DL11-CSTOCK                    22720000
216700         MOVE ZEROES           TO  DL2-AVG-OSTRAT                 22730000
216800         MOVE ZEROES           TO  DL2-LEAD-TIME                  22740000
216900     ELSE                                                         22750000
217000         MOVE PV-ON-ORDER      TO  DL3-ONORDER                    22760000
217100         MOVE PV-ONHAND        TO  DL10-ONHAND                    22770000
217200         MOVE PV-DD            TO  DL6-DD-CURR                    22780000
217300         MOVE PV-CSTOCK        TO  DL11-CSTOCK                    22790000
217400         MOVE PV-OSTRAT        TO  DL2-AVG-OSTRAT                 22800000
217500         MOVE PV-LT            TO  DL2-LEAD-TIME                  22810000
217600     END-IF.                                                      22820000
217700                                                                  22830000
217800***************************************************************** 22840000
217900* FETCH CURRENT INFO FOR DD, ONHAND, CSTOCK, ONORDER, AVG OSTRAT  22850000
218000* AND MAXIMUM LEAD TIME                                           22860000
218100***************************************************************** 22870000
218200 C4100-FETCH-CURRENT-INFO.                                        22880000
218300                                                                  22890000
218400     MOVE 'C4100'                       TO PGM-LOCATION.          22900000
218500     MOVE 'C4100-FETCH-CURRENT-INFO'    TO PV-ABEND-PARAGRAPH.    22910000
218600                                                                  22920000
218700     EXEC SQL                                                     22930000
218800          SELECT                                                  22940000
218900                  COALESCE(SUM(D.DD_FCTR),0)                      22950000
219000                , COALESCE(SUM(F.ONHAND_QTY),0)                   22960000
219100                , COALESCE(SUM(D.CSTOCK_QTY),0)                   22970000
219200                , COALESCE(SUM(D.ON_ORDER_QTY),0)                 22980000
219300                , COALESCE(AVG(D.OSTRAT_QTY),0)                   22990000
219400                , COALESCE(MAX(LT_QTY),0)                         23000000
219500          INTO  :PV-DD                                            23010000
219600               ,:PV-ONHAND                                        23020000
219700               ,:PV-CSTOCK                                        23030000
219800               ,:PV-ON-ORDER                                      23040000
219900               ,:PV-OSTRAT                                        23050000
220000               ,:PV-LT                                            23060000
220100          FROM   TSK         A                                    23070000
220200                ,TMRITEM     B                                    23080000
220300                ,TMRITST     D                                    23090000
220400                ,TSKST       F                                    23100000
220500                ,XMT_LOC     G                                    23110000
220600                ,TSKXREF     X                                    23120000
220700          WHERE  A.ITEM_NMBR         =  B.ITEM_NBR                23130000
220800            AND  A.ITEM_NMBR         =  D.ITEM_NBR                23140000
220900            AND  A.ITEM_NMBR         =  F.ITEM_NMBR               23150000
221000            AND  A.ITEM_NMBR         =  X.ITM_NBR                 23160000
221100            AND  D.STR_NBR           =  F.LOC_NBR                 23170000
221200            AND  D.STR_NBR           > 0                          23180000
221300            AND  D.FT_CDE            =  'O'                       23190000
221400            AND  D.STR_NBR           = G.LOC_NBR                  23200000
221500            AND  G.E_BUS_IND         = 'N'                        23210000
221700            AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)        23220000
221800            OR   (RT_NBR > 4                                      23230000
221900            AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)          23240000
222000            AND  RT_DAY_NBR <> 0))                                23250000
222100            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          23260000
222200            AND  X.CLASS             = :PV-HOLD-CLASS-NBR         23270000
222300            AND  X.SUBCLASS          = :PV-HOLD-SCL-NBR           23280000
222400            AND  A.LONG_COLOR_DESC   = :PV-HOLD-COLOR             23290000
222500            AND  A.LONG_VENDOR_STYLE = :PV-HOLD-STYLE             23300000
064400            WITH UR                                               23310000
222600     END-EXEC.                                                    23320000
222700                                                                  23330000
222800     EVALUATE TRUE                                                23340000
222900       WHEN SQLCODE         = ZERO                                23350000
223000         CONTINUE                                                 23360000
223100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    23370000
223200         MOVE PC-Y TO PS-EOC-CURR-CSR                             23380000
223300       WHEN OTHER                                                 23390000
223400         DISPLAY PV-ABEND-PARAGRAPH                               23400000
223500         PERFORM Z9900-SQL-ERROR                                  23410000
223600     END-EVALUATE.                                                23420000
223700                                                                  23430000
223800***************************************************************** 23440000
223900* GETS CURRENT FORECAST AND CALCULATES AND STORES THE FORECAST    23450000
224000* FOR THE NEXT 52 WEEKS.                                          23460000
224100***************************************************************** 23470000
224200 C5000-GET-CURRENT-FORECAST.                                      23480000
224300                                                                  23490000
224400        PERFORM C5100-INITIALZE-TABLE.                            23500000
224500        MOVE PC-N TO PS-EOC-C-FRCST-CSR                           23510000
224600        PERFORM C5200-OPEN-CURR-FRCST-CSR.                        23520000
224700        PERFORM C5300-LOOP-THRU-CURR-CSR UNTIL EOC-C-FRCST-CSR.   23530000
224800        MOVE PT-FORECAST-AMOUNT(PC-ONE)                           23540000
224900                                    TO DL7-CURRENT-FRCST.         23550000
225000        MOVE PT-FORECAST-AMOUNT(PC-TWO)                           23560000
225100                                    TO DL7-FUTURE-FRCST(PC-ONE).  23570000
225200        MOVE PT-FORECAST-AMOUNT(PC-THREE)                         23580000
225300                                    TO DL7-FUTURE-FRCST(PC-TWO).  23590000
225400        MOVE PT-FORECAST-AMOUNT(PC-FOUR)                          23600000
225500                                    TO DL7-FUTURE-FRCST(PC-THREE).23610000
225600        MOVE PT-FORECAST-AMOUNT(PC-FIVE)                          23620000
225700                                    TO DL7-FUTURE-FRCST(PC-FOUR). 23630000
225800        MOVE PT-FORECAST-AMOUNT(PC-SIX)                           23640000
225900                                    TO DL7-FUTURE-FRCST(PC-FIVE). 23650000
226000                                                                  23660000
226100***************************************************************** 23670000
226200* INITIALZE FORECAST TABLE.                                       23680000
226300***************************************************************** 23690000
226400 C5100-INITIALZE-TABLE.                                           23700000
226500                                                                  23710000
226600        MOVE PC-ONE      TO PV-BIM-INDEX.                         23720000
226700        PERFORM UNTIL PV-BIM-INDEX > PC-52                        23730000
226800            MOVE ZEROES  TO PT-FORECAST-AMOUNT(PV-BIM-INDEX)      23740000
226900            ADD PC-ONE   TO PV-BIM-INDEX                          23750000
227000        END-PERFORM.                                              23760000
227100                                                                  23770000
227200                                                                  23780000
227300***************************************************************** 23790000
227400* OPEN CLR-STL-CURR-FRCST CURSOR                                  23800000
227500***************************************************************** 23810000
227600 C5200-OPEN-CURR-FRCST-CSR.                                       23820000
227700                                                                  23830000
227800     MOVE 'C5200'                    TO PGM-LOCATION.             23840000
227900     MOVE 'C5200-OPEN-CURR-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      23850000
228000                                                                  23860000
228100     EXEC SQL                                                     23870000
228200         OPEN CLR-STL-CURR-FRCST                                  23880000
228300     END-EXEC.                                                    23890000
228400                                                                  23900000
228500     EVALUATE TRUE                                                23910000
228600       WHEN SQLCODE         = ZERO                                23920000
228700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    23930000
228800         CONTINUE                                                 23940000
228900       WHEN OTHER                                                 23950000
229000         DISPLAY PV-ABEND-PARAGRAPH                               23960000
229100         PERFORM Z9900-SQL-ERROR                                  23970000
229200     END-EVALUATE.                                                23980000
229300                                                                  23990000
229400***************************************************************** 24000000
229500* LOOP THRU CLR-STL-CURR-FRCST CURSOR AND CALCULATE FORECASTS.    24010000
229600***************************************************************** 24020000
229700 C5300-LOOP-THRU-CURR-CSR.                                        24030000
229800                                                                  24040000
229900     PERFORM C5400-FETCH-CURR-FRCST-CSR.                          24050000
230000     IF EOC-C-FRCST-CSR                                           24060000
230100         CONTINUE                                                 24070000
230200     ELSE                                                         24080000
230300         MOVE PV-CURR-WEEK         TO PV-BIM-WEEK-INDEX           24090000
230400         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                24100000
230500         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      24110000
230600         PERFORM B2000-READ-BIM-FILE                              24120000
230700         IF BIM-RECORD-FOUND                                      24130000
230800             PERFORM C5600-CALCULATE-FORECAST                     24140000
230900                 VARYING PV-BIM-INDEX  FROM 1 BY 1                24150000
231000                 UNTIL PV-BIM-INDEX GREATER THAN PC-52            24160000
231100         END-IF                                                   24170000
231200     END-IF.                                                      24180000
231300                                                                  24190000
231400***************************************************************** 24200000
231500* FETCH CLR-STL-CURR-FRCST CURSOR                                 24210000
231600***************************************************************** 24220000
231700 C5400-FETCH-CURR-FRCST-CSR.                                      24230000
231800                                                                  24240000
231900     MOVE 'C5400'                       TO PGM-LOCATION.          24250000
232000     MOVE 'C5400-FETCH-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    24260000
232100                                                                  24270000
232200     EXEC SQL                                                     24280000
232300       FETCH CLR-STL-CURR-FRCST                                   24290000
232400        INTO                                                      24300000
232500              :MRITEM-UCYCLE-CDE,                                 24310000
232600              :MRITST-DD-FCTR,                                    24320000
232700              :MRITST-PTAG-ID                                     24330000
232800     END-EXEC.                                                    24340000
232900                                                                  24350000
233000     EVALUATE TRUE                                                24360000
233100       WHEN SQLCODE         = ZERO                                24370000
233200         CONTINUE                                                 24380000
233300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    24390000
233400         PERFORM C5500-CLOSE-CURR-FRCST-CSR                       24400000
233500         MOVE PC-Y TO PS-EOC-C-FRCST-CSR                          24410000
233600       WHEN OTHER                                                 24420000
233700         DISPLAY PV-ABEND-PARAGRAPH                               24430000
233800         PERFORM Z9900-SQL-ERROR                                  24440000
233900     END-EVALUATE.                                                24450000
234000                                                                  24460000
234100******************************************************************24470000
234200* CLOSE CLR-STL-CURR-FRCST CURSOR                                *24480000
234300******************************************************************24490000
234400 C5500-CLOSE-CURR-FRCST-CSR.                                      24500000
234500                                                                  24510000
234600     MOVE 'C5500'                       TO PGM-LOCATION.          24520000
234700     MOVE 'C5500-CLOSE-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    24530000
234800                                                                  24540000
234900     EXEC SQL                                                     24550000
235000         CLOSE CLR-STL-CURR-FRCST                                 24560000
235100     END-EXEC.                                                    24570000
235200                                                                  24580000
235300     EVALUATE TRUE                                                24590000
235400         WHEN SQLCODE EQUAL ZERO                                  24600000
235500         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      24610000
235600             CONTINUE                                             24620000
235700         WHEN OTHER                                               24630000
235800             DISPLAY PV-ABEND-PARAGRAPH                           24640000
235900             PERFORM Z9900-SQL-ERROR                              24650000
236000     END-EVALUATE.                                                24660000
236100                                                                  24670000
236200***************************************************************** 24680000
236300* CALCULATE FORECAST.                                             24690000
236400***************************************************************** 24700000
236500 C5600-CALCULATE-FORECAST.                                        24710000
236600                                                                  24720000
236700     MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI.                24730000
236800     IF MRITEM-UCYCLE-CDE = 9                                     24740000
236900         MOVE MRITST-DD-FCTR      TO PV-DD-COMPUTED               24750000
237000     ELSE                                                         24760000
237100         IF MRITEM-UCYCLE-CDE = 5                                 24770000
237200             DIVIDE MRITST-DD-FCTR      BY PC-FOUR                24780000
237300                             GIVING PV-DD-COMPUTED ROUNDED        24790000
237400         END-IF                                                   24800000
237500     END-IF.                                                      24810000
237600                                                                  24820000
237700     MULTIPLY PV-BI BY PV-DD-COMPUTED  GIVING PV-FORECAST.        24830000
237800     ADD  PV-FORECAST  TO  PT-FORECAST-AMOUNT(PV-BIM-INDEX).      24840000
237900                                                                  24850000
238000     IF PV-BIM-WEEK-INDEX = PC-52                                 24860000
238100         MOVE PC-ONE      TO PV-BIM-WEEK-INDEX                    24870000
238200     ELSE                                                         24880000
238300         ADD PC-ONE       TO PV-BIM-WEEK-INDEX                    24890000
238400     END-IF.                                                      24900000
238500                                                                  24910000
238600***************************************************************** 24920000
238700* CONTROL BREAK AT THE MAJOR CLASS LEVEL                          24930000
238800***************************************************************** 24940000
238900 D0000-MAJOR-CLASS-BREAK.                                         24950000
239000                                                                  24960000
239100     MOVE PC-N                         TO PS-EOC-MAJOR-CLASS-CSR. 24970000
239200     PERFORM D0100-OPEN-MAJOR-CLASS-CSR.                          24980000
239300     PERFORM D0200-PROCESS-MAJOR-CLASS-CSR                        24990000
239400                                       UNTIL EOC-MAJOR-CLASS-CSR. 25000000
239500                                                                  25010000
239600***************************************************************** 25020000
239700* OPEN MAJOR-CLASS-LEVEL CURSOR                                   25030000
239800***************************************************************** 25040000
239900 D0100-OPEN-MAJOR-CLASS-CSR.                                      25050000
240000                                                                  25060000
240100     MOVE 'D0100'                      TO PGM-LOCATION.           25070000
240200     MOVE 'D0100-OPEN-MAJOR-CLASS-CSR' TO PV-ABEND-PARAGRAPH.     25080000
240300                                                                  25090000
240400     EXEC SQL                                                     25100000
240500         OPEN MAJOR-CLASS-LEVEL                                   25110000
240600     END-EXEC.                                                    25120000
240700                                                                  25130000
240800     EVALUATE TRUE                                                25140000
240900       WHEN SQLCODE         = ZERO                                25150000
241000       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    25160000
241100         CONTINUE                                                 25170000
241200       WHEN OTHER                                                 25180000
241300         DISPLAY PV-ABEND-PARAGRAPH                               25190000
241400         PERFORM Z9900-SQL-ERROR                                  25200000
241500     END-EVALUATE.                                                25210000
241600                                                                  25220000
241700***************************************************************** 25230000
241800* D0200-PROCESS-MAJOR-CLASS-CSR                                   25240000
241900***************************************************************** 25250000
242000 D0200-PROCESS-MAJOR-CLASS-CSR.                                   25260000
242100                                                                  25270000
242200     PERFORM D0300-FETCH-MAJOR-CLASS-CSR.                         25280000
242300                                                                  25290000
242400     IF EOC-MAJOR-CLASS-CSR                                       25300000
242500         CONTINUE                                                 25310000
242600     ELSE                                                         25320000
242700         IF SKXREF-CLASS = PV-HOLD-CLASS-NBR                      25330000
242800             CONTINUE                                             25340000
242900         ELSE                                                     25350000
243000             MOVE SKXREF-CLASS         TO PV-HOLD-CLASS-NBR       25360000
243100             MOVE PC-Y                 TO PS-PROCESS-LINE-INFO    25370000
243200             PERFORM D1000-CREATE-REPORT-LINES                    25380000
243300             IF PROCESS-LINE-INFO                                 25390000
243400                 PERFORM R0000-PRINT-REPORT-LINES                 25400000
243500             END-IF                                               25410000
243600         END-IF                                                   25420000
243700     END-IF.                                                      25430000
243800                                                                  25440000
243900***************************************************************** 25450000
244000* FETCH MAJOR-CLASS-LEVEL CURSOR                                  25460000
244100***************************************************************** 25470000
244200  D0300-FETCH-MAJOR-CLASS-CSR.                                    25480000
244300                                                                  25490000
244400     MOVE 'D0300'                       TO PGM-LOCATION.          25500000
244500     MOVE 'D0300-FETCH-MAJOR-CLASS-CURSOR'                        25510000
244600                                        TO PV-ABEND-PARAGRAPH.    25520000
244700                                                                  25530000
244800     EXEC SQL                                                     25540000
244900       FETCH MAJOR-CLASS-LEVEL                                    25550000
245000        INTO                                                      25560000
245100              :SKXREF-DEPT                                        25570000
245200             ,:SKXREF-CLASS                                       25580000
245300     END-EXEC.                                                    25590000
245400                                                                  25600000
245500     EVALUATE TRUE                                                25610000
245600       WHEN SQLCODE         = ZERO                                25620000
245700         CONTINUE                                                 25630000
245800       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    25640000
245900         PERFORM D0400-CLOSE-MAJOR-CLASS-CSR                      25650000
246000         MOVE PC-Y TO PS-EOC-MAJOR-CLASS-CSR                      25660000
246100       WHEN OTHER                                                 25670000
246200         DISPLAY PV-ABEND-PARAGRAPH                               25680000
246300         PERFORM Z9900-SQL-ERROR                                  25690000
246400     END-EVALUATE.                                                25700000
246500                                                                  25710000
246600******************************************************************25720000
246700* CLOSE MAJOR-CLASS-LEVEL CURSOR                                 *25730000
246800******************************************************************25740000
246900 D0400-CLOSE-MAJOR-CLASS-CSR.                                     25750000
247000                                                                  25760000
247100     MOVE 'D0400'                        TO PGM-LOCATION.         25770000
247200     MOVE 'D0400-CLOSE-MAJOR-CLASS-CSR'  TO PV-ABEND-PARAGRAPH.   25780000
247300                                                                  25790000
247400     EXEC SQL                                                     25800000
247500         CLOSE MAJOR-CLASS-LEVEL                                  25810000
247600     END-EXEC.                                                    25820000
247700                                                                  25830000
247800     EVALUATE TRUE                                                25840000
247900         WHEN SQLCODE EQUAL ZERO                                  25850000
248000         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      25860000
248100             CONTINUE                                             25870000
248200         WHEN OTHER                                               25880000
248300             DISPLAY PV-ABEND-PARAGRAPH                           25890000
248400             PERFORM Z9900-SQL-ERROR                              25900000
248500     END-EVALUATE.                                                25910000
248600                                                                  25920000
248700***************************************************************** 25930000
248800* SET UP DATA FOR THE REPORT LINES                                25940000
248900***************************************************************** 25950000
249000 D1000-CREATE-REPORT-LINES.                                       25960000
249100                                                                  25970000
249200     MOVE ZERO                       TO PV-CUMM-SALES.            25980000
249300     PERFORM D2000-GET-HISTORY-INFO.                              25990000
249400     MOVE PV-CUMM-SALES              TO DL8-CUMM-SALES.           26000000
249500                                                                  26010000
249600     MOVE ZERO                       TO PV-CUMM-FRCST.            26020000
249700     PERFORM D3000-GET-HISTORY-FORECAST.                          26030000
249800     MOVE PV-CUMM-FRCST              TO DL7-CUMM-FRCST.           26040000
249900                                                                  26050000
250000     IF PV-HOLD-PER                                               26060000
250100         PERFORM B4000-CHECK-PERCENT-VARIANCE                     26070000
250200     END-IF.                                                      26080000
250300                                                                  26090000
250400                                                                  26100000
250500     IF PROCESS-LINE-INFO                                         26110000
250600         PERFORM D4000-GET-CURRENT-INFO                           26120000
250700         PERFORM D5000-GET-CURRENT-FORECAST                       26130000
250800         PERFORM B3000-CALCULATE-WEEKS-SUPPLY                     26140000
250900     END-IF.                                                      26150000
251000                                                                  26160000
251100     IF PROCESS-LINE-INFO                                         26170000
251200         PERFORM B4100-CALCULATE-CUMM-PCNT                        26180000
251300         PERFORM B4200-CALCULATE-CSTOCK-PERCENT                   26190000
251400     END-IF.                                                      26200000
251500                                                                  26210000
251600***************************************************************** 26220000
251700* GETS DD, MADDSS, ONHAND, AND SALES FOR PREVIOUS FOUR WEEKS      26230000
251800***************************************************************** 26240000
251900 D2000-GET-HISTORY-INFO.                                          26250000
252000                                                                  26260000
252100     PERFORM                                                      26270000
252200       VARYING PV-HIST-INDEX FROM 1 BY 1                          26280000
252300       UNTIL PV-HIST-INDEX > 4                                    26290000
252400          MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR        26300000
252500          MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK        26310000
252600          MOVE PC-N                   TO PS-EOC-HIST-CSR          26320000
252700          PERFORM D2100-FETCH-HISTORY-INFO                        26330000
252800          IF EOC-HIST-CSR                                         26340000
252900              MOVE ZEROES      TO  DL6-DD(PV-HIST-INDEX)          26350000
253000              MOVE ZEROES      TO  DL10-OH-HIST(PV-HIST-INDEX)    26360000
253100          ELSE                                                    26370000
253200              MOVE PV-DD       TO  DL6-DD(PV-HIST-INDEX)          26380000
253300              MOVE PV-ONHAND   TO  DL10-OH-HIST(PV-HIST-INDEX)    26390000
253400          END-IF                                                  26400000
253500     END-PERFORM.                                                 26410000
253600                                                                  26420000
253700     PERFORM                                                      26430000
253800       VARYING PV-HIST-INDEX FROM 1 BY 1                          26440000
253900       UNTIL PV-HIST-INDEX > 4                                    26450000
254000          MOVE PT-FSCL-DATE(PV-HIST-INDEX) TO PV-HOLD-FSCL-DATE   26460000
254100          MOVE PC-N                        TO PS-EOC-SLS-HIST-CSR 26470000
139600          COMPUTE PV-DATE-INDEX =                                 26480000
139600             (PV-HIST-INDEX * PC-SEVEN) - PC-SIX                  26490000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE1    26500000
                ADD PC-ONE TO PV-DATE-INDEX                             26510000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE2    26520000
                ADD PC-ONE TO PV-DATE-INDEX                             26530000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE3    26540000
                ADD PC-ONE TO PV-DATE-INDEX                             26550000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE4    26560000
                ADD PC-ONE TO PV-DATE-INDEX                             26570000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE5    26580000
                ADD PC-ONE TO PV-DATE-INDEX                             26590000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE6    26600000
                ADD PC-ONE TO PV-DATE-INDEX                             26610000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE7    26620000
254200          PERFORM D2300-FETCH-HIST-SLS-INFO                       26630000
254300          IF EOC-SLS-HIST-CSR                                     26640000
254400              MOVE ZEROES      TO  DL8-SALES(PV-HIST-INDEX)       26650000
254500          ELSE                                                    26660000
254600              MOVE PV-SALES    TO  DL8-SALES(PV-HIST-INDEX)       26670000
254700              ADD  PV-SALES    TO  PV-CUMM-SALES                  26680000
254800          END-IF                                                  26690000
254900     END-PERFORM.                                                 26700000
255000                                                                  26710000
255100***************************************************************** 26720000
255200* FETCHS DD, MADDSS, AND ONHAND FOUR THE 4 PREVIOUS WEEKS.        26730000
255300***************************************************************** 26740000
255400 D2100-FETCH-HISTORY-INFO.                                        26750000
255500                                                                  26760000
255600     MOVE 'D2100'                       TO PGM-LOCATION.          26770000
255700     MOVE 'D2100-FETCH-HISTORY-INFO'    TO PV-ABEND-PARAGRAPH.    26780000
255800                                                                  26790000
255900     EXEC SQL                                                     26800000
256000          SELECT                                                  26810000
256100                  COALESCE(SUM(C.OH_HIST_QTY),0)                  26820000
256200                , COALESCE(SUM(C.DSD_HIST_QTY),0)                 26830000
256300                , COALESCE(SUM(C.MAD_HIST_QTY),0)                 26840000
256400          INTO                                                    26850000
256500                :PV-ONHAND                                        26860000
256600               ,:PV-DD                                            26870000
256700               ,:PV-MADDSS                                        26880000
256800          FROM   TSKXREF     X                                    26890000
256900                ,TMRITEM     B                                    26900000
257000                ,TMRISHS     C                                    26910000
257100                ,TMRITST     D                                    26920000
257200                ,XMT_LOC     G                                    26930000
257300          WHERE  X.ITM_NBR           =  B.ITEM_NBR                26940000
257400            AND  X.ITM_NBR           =  C.ITM_NBR                 26950000
257500            AND  X.ITM_NBR           =  D.ITEM_NBR                26960000
257600            AND  D.FT_CDE            =  'O'                       26970000
257700            AND  C.STR_NBR           =  D.STR_NBR                 26980000
257800            AND  C.STR_NBR         > 0                            26990000
257900            AND  D.STR_NBR           = G.LOC_NBR                  27000000
258000            AND  G.E_BUS_IND         = 'N'                        27010000
258200            AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)        27020000
258300            OR   (RT_NBR > 4                                      27030000
258400            AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)          27040000
258500            AND  RT_DAY_NBR <> 0))                                27050000
258600            AND  C.YR_NBR            = :PV-HOLD-YEAR              27060000
258700            AND  C.WK_NBR            = :PV-HOLD-WEEK              27070000
258800            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          27080000
258900            AND  X.CLASS             = :PV-HOLD-CLASS-NBR         27090000
259000            AND  C.ITM_REV_ID        = (SELECT MAX (E.ITM_REV_ID) 27100000
259100                  FROM TMRISHS  E                                 27110000
259200              WHERE                                               27120000
259300                    E.ITM_NBR        = C.ITM_NBR                  27130000
259400                AND E.STR_NBR        = C.STR_NBR                  27140000
259500                AND E.YR_NBR         = :PV-HOLD-YEAR              27150000
259600                AND E.WK_NBR         = :PV-HOLD-WEEK)             27160000
064400            WITH UR                                               27170000
259700     END-EXEC.                                                    27180000
259800                                                                  27190000
259900     EVALUATE TRUE                                                27200000
260000       WHEN SQLCODE         = ZERO                                27210000
260100         CONTINUE                                                 27220000
260200       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    27230000
260300         MOVE PC-Y TO PS-EOC-HIST-CSR                             27240000
260400       WHEN OTHER                                                 27250000
260500         DISPLAY PV-ABEND-PARAGRAPH                               27260000
260600         PERFORM Z9900-SQL-ERROR                                  27270000
260700     END-EVALUATE.                                                27280000
260800                                                                  27290000
260900***************************************************************** 27300000
261000* FETCHS SALES FOR 4 PREVIOUS WEEKS.                              27310000
261100***************************************************************** 27320000
261200 D2300-FETCH-HIST-SLS-INFO.                                       27330000
261300                                                                  27340000
261400     MOVE 'D2300'                       TO PGM-LOCATION.          27350000
261500     MOVE 'D2300-FETCH-HIST-SLS-INFO'   TO PV-ABEND-PARAGRAPH.    27360000
261600                                                                  27370000
261700     EXEC SQL                                                     27380000
261800          SELECT                                                  27390000
261900                  COALESCE(SUM(C.SLS_UNT_QTY),0)                  27400000
262000          INTO                                                    27410000
262100                :PV-SALES                                         27420000
262200          FROM   TSKXREF     X                                    27430000
262300                ,TMRITEM     B                                    27440000
262400                ,MHT_DLY_SLS C                                    27450000
262500                ,TMRITST     D                                    27460000
262600                ,XMT_LOC     G                                    27470000
262700          WHERE  X.ITM_NBR          =  B.ITEM_NBR                 27480000
457000            AND  X.SKU               = C.SKU_NBR                  27490000
262900            AND  X.ITM_NBR          =  D.ITEM_NBR                 27500000
263000            AND  D.FT_CDE           =  'O'                        27510000
263100            AND  D.STR_NBR          = C.STR_NBR                   27520000
263200            AND  C.STR_NBR          > 0                           27530000
263300            AND  D.STR_NBR           = G.LOC_NBR                  27540000
263400            AND  G.E_BUS_IND         = 'N'                        27550000
263600            AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)        27560000
263700            OR   (RT_NBR > 4                                      27570000
263800            AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)          27580000
263900            AND  RT_DAY_NBR <> 0))                                27590000
264000            AND  X.DEPT             = :PV-HOLD-DEPT-NBR           27600000
264100            AND  X.CLASS            = :PV-HOLD-CLASS-NBR          27610000
458500            AND  C.PRCG_DTE BETWEEN :PV-FSCL-VAR-DATE1 AND        27620000
                                      :PV-FSCL-VAR-DATE7                27630000
264300            AND C.SKU_STAT_CDE IN ('10', '20', '40')              27640000
064400            WITH UR                                               27650000
264400     END-EXEC.                                                    27660000
264500                                                                  27670000
264600     EVALUATE TRUE                                                27680000
264700       WHEN SQLCODE         = ZERO                                27690000
264800         CONTINUE                                                 27700000
264900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    27710000
265000         MOVE PC-Y TO PS-EOC-SLS-HIST-CSR                         27720000
265100       WHEN OTHER                                                 27730000
265200         DISPLAY PV-ABEND-PARAGRAPH                               27740000
265300         PERFORM Z9900-SQL-ERROR                                  27750000
265400     END-EVALUATE.                                                27760000
265500                                                                  27770000
265600***************************************************************** 27780000
265700* CALCULATES FORECAST FOR LAST 4 WEEKS                            27790000
265800***************************************************************** 27800000
265900 D3000-GET-HISTORY-FORECAST.                                      27810000
266000                                                                  27820000
266100     PERFORM                                                      27830000
266200       VARYING PV-HIST-INDEX FROM 1 BY 1                          27840000
266300       UNTIL PV-HIST-INDEX > 4                                    27850000
266400        MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR          27860000
266500        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK          27870000
266600        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-BIM-WEEK-INDEX     27880000
266700        MOVE PC-N TO PS-EOC-H-FRCST-CSR                           27890000
266800        PERFORM D3100-OPEN-HIST-FRCST-CSR                         27900000
266900        MOVE ZERO                        TO PV-TOTAL-FORECAST     27910000
267000        PERFORM D3200-LOOP-THRU-CSR                               27920000
267100                    UNTIL EOC-H-FRCST-CSR                         27930000
267200        MOVE PV-TOTAL-FORECAST                                    27940000
267300                                 TO DL7-HIST-FRCST(PV-HIST-INDEX) 27950000
267400        ADD  PV-TOTAL-FORECAST   TO PV-CUMM-FRCST                 27960000
267500     END-PERFORM.                                                 27970000
267600                                                                  27980000
267700     PERFORM D3500-CALCULATE-FRCST-PERCENT                        27990000
267800       VARYING PV-HIST-INDEX FROM 1 BY 1                          28000000
267900       UNTIL PV-HIST-INDEX > 4.                                   28010000
268000                                                                  28020000
268100***************************************************************** 28030000
268200* OPEN MAJ-CLS-HIST-FRCST CURSOR                                  28040000
268300***************************************************************** 28050000
268400 D3100-OPEN-HIST-FRCST-CSR.                                       28060000
268500                                                                  28070000
268600     MOVE 'D3100'                     TO PGM-LOCATION.            28080000
268700     MOVE 'D3100-OPEN-HIST-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      28090000
268800                                                                  28100000
268900     EXEC SQL                                                     28110000
269000         OPEN MAJ-CLS-HIST-FRCST                                  28120000
269100     END-EXEC.                                                    28130000
269200                                                                  28140000
269300     EVALUATE TRUE                                                28150000
269400       WHEN SQLCODE         = ZERO                                28160000
269500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    28170000
269600         CONTINUE                                                 28180000
269700       WHEN OTHER                                                 28190000
269800         DISPLAY PV-ABEND-PARAGRAPH                               28200000
269900         PERFORM Z9900-SQL-ERROR                                  28210000
270000     END-EVALUATE.                                                28220000
270100                                                                  28230000
270200***************************************************************** 28240000
270300* LOOP THRU HIST-FRCST CURSOR AND CALCULATES AND ADDS FORECAST    28250000
270400* TO TOTAL                                                        28260000
270500***************************************************************** 28270000
270600 D3200-LOOP-THRU-CSR.                                             28280000
270700                                                                  28290000
270800     PERFORM D3300-FETCH-HIST-FRCST-CSR.                          28300000
270900                                                                  28310000
271000     IF EOC-H-FRCST-CSR                                           28320000
271100         CONTINUE                                                 28330000
271200     ELSE                                                         28340000
271300         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                28350000
271400         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      28360000
271500         PERFORM B2000-READ-BIM-FILE                              28370000
271600         IF BIM-RECORD-FOUND                                      28380000
271700             MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI         28390000
271800             IF MRITEM-UCYCLE-CDE = 9                             28400000
271900                 MOVE MRISHS-DSD-HIST-QTY TO PV-DD-COMPUTED       28410000
272000             ELSE                                                 28420000
272100                 IF MRITEM-UCYCLE-CDE = 5                         28430000
272200                     DIVIDE MRISHS-DSD-HIST-QTY BY PC-FOUR        28440000
272300                                     GIVING PV-DD-COMPUTED ROUNDED28450000
272400                 END-IF                                           28460000
272500             END-IF                                               28470000
272600             MULTIPLY PV-BI BY PV-DD-COMPUTED                     28480000
272700                                            GIVING PV-FORECAST    28490000
272800             ADD PV-FORECAST TO PV-TOTAL-FORECAST                 28500000
272900         END-IF                                                   28510000
273000     END-IF.                                                      28520000
273100                                                                  28530000
273200***************************************************************** 28540000
273300* FETCH MAJ-CLS-HIST-FRCST CURSOR - GETS DD AND PTAG TO READ BIM  28550000
273400* FILE                                                            28560000
273500***************************************************************** 28570000
273600 D3300-FETCH-HIST-FRCST-CSR.                                      28580000
273700                                                                  28590000
273800     MOVE 'D3300'                       TO PGM-LOCATION.          28600000
273900     MOVE 'D3300-FETCH-HIST-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    28610000
274000                                                                  28620000
274100     EXEC SQL                                                     28630000
274200       FETCH MAJ-CLS-HIST-FRCST                                   28640000
274300        INTO                                                      28650000
274400              :MRITEM-UCYCLE-CDE,                                 28660000
274500              :MRISHS-DSD-HIST-QTY,                               28670000
274600              :MRITST-PTAG-ID                                     28680000
274700     END-EXEC.                                                    28690000
274800                                                                  28700000
274900     EVALUATE TRUE                                                28710000
275000       WHEN SQLCODE         = ZERO                                28720000
275100         CONTINUE                                                 28730000
275200       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    28740000
275300         PERFORM D3400-CLOSE-FRCST-LEVEL-CSR                      28750000
275400         MOVE PC-Y TO PS-EOC-H-FRCST-CSR                          28760000
275500       WHEN OTHER                                                 28770000
275600         DISPLAY PV-ABEND-PARAGRAPH                               28780000
275700         PERFORM Z9900-SQL-ERROR                                  28790000
275800     END-EVALUATE.                                                28800000
275900                                                                  28810000
276000******************************************************************28820000
276100* CLOSE MAJ CLS-HIST-FRCST CURSOR                                *28830000
276200******************************************************************28840000
276300 D3400-CLOSE-FRCST-LEVEL-CSR.                                     28850000
276400                                                                  28860000
276500     MOVE 'D3400'                        TO PGM-LOCATION.         28870000
276600     MOVE 'D3400-CLOSE-FRCST-LEVEL-CSR'  TO PV-ABEND-PARAGRAPH.   28880000
276700                                                                  28890000
276800     EXEC SQL                                                     28900000
276900         CLOSE MAJ-CLS-HIST-FRCST                                 28910000
277000     END-EXEC.                                                    28920000
277100                                                                  28930000
277200     EVALUATE TRUE                                                28940000
277300         WHEN SQLCODE EQUAL ZERO                                  28950000
277400         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      28960000
277500             CONTINUE                                             28970000
277600         WHEN OTHER                                               28980000
277700             DISPLAY PV-ABEND-PARAGRAPH                           28990000
277800             PERFORM Z9900-SQL-ERROR                              29000000
277900     END-EVALUATE.                                                29010000
278000                                                                  29020000
278100***************************************************************** 29030000
278200* CALCULATES PERCENT DIFFERENCE BETWEEN WHAT WAS FORECAST AND     29040000
278300* WHAT WAS SOLD.                                                  29050000
278400***************************************************************** 29060000
278500 D3500-CALCULATE-FRCST-PERCENT.                                   29070000
278600                                                                  29080000
278700     MOVE DL7-HIST-FRCST(PV-HIST-INDEX)   TO PV-FORECAST.         29090000
278800     MOVE DL8-SALES(PV-HIST-INDEX)        TO PV-SALES.            29100000
278900                                                                  29110000
279000     IF  PV-FORECAST = 0                                          29120000
279100         MOVE '***'          TO  DL9-DIFFRNC(PV-HIST-INDEX)       29130000
279200     ELSE                                                         29140000
279300         IF  PV-SALES  = 0                                        29150000
279400             MOVE 0          TO  DL9-DIFFRNC-N(PV-HIST-INDEX)     29160000
279500         ELSE                                                     29170000
279600             COMPUTE PV-FRCST-PERCENT ROUNDED =                   29180000
279700                  (PV-SALES - PV-FORECAST) / PV-FORECAST * 100    29190000
279800             MOVE PV-FRCST-PERCENT                                29200000
279900                         TO DL9-DIFFRNC-N(PV-HIST-INDEX)          29210000
280000         END-IF                                                   29220000
280100     END-IF.                                                      29230000
280200                                                                  29240000
280300***************************************************************** 29250000
280400* GETS ONORDER, ONHAND, DD, CSTOCK, AVG OSTRAT, AND MAXIMUM LEAD  29260000
280500* TIME.                                                           29270000
280600***************************************************************** 29280000
280700 D4000-GET-CURRENT-INFO.                                          29290000
280800                                                                  29300000
280900     MOVE PC-N TO PS-EOC-CURR-CSR                                 29310000
281000     PERFORM D4100-FETCH-CURRENT-INFO.                            29320000
281100                                                                  29330000
281200     IF EOC-CURR-CSR                                              29340000
281300         MOVE ZEROES           TO  DL3-ONORDER                    29350000
281400         MOVE ZEROES           TO  DL10-ONHAND                    29360000
281500         MOVE ZEROES           TO  DL6-DD-CURR                    29370000
281600         MOVE ZEROES           TO  DL11-CSTOCK                    29380000
281700         MOVE ZEROES           TO  DL2-AVG-OSTRAT                 29390000
281800         MOVE ZEROES           TO  DL2-LEAD-TIME                  29400000
281900     ELSE                                                         29410000
282000         MOVE PV-ON-ORDER      TO  DL3-ONORDER                    29420000
282100         MOVE PV-ONHAND        TO  DL10-ONHAND                    29430000
282200         MOVE PV-DD            TO  DL6-DD-CURR                    29440000
282300         MOVE PV-CSTOCK        TO  DL11-CSTOCK                    29450000
282400         MOVE PV-OSTRAT        TO  DL2-AVG-OSTRAT                 29460000
282500         MOVE PV-LT            TO  DL2-LEAD-TIME                  29470000
282600     END-IF.                                                      29480000
282700                                                                  29490000
282800***************************************************************** 29500000
282900* FETCH CURRENT INFO FOR DD, ONHAND, CSTOCK, ONORDER, AVG OSTRAT  29510000
283000***************************************************************** 29520000
283100 D4100-FETCH-CURRENT-INFO.                                        29530000
283200                                                                  29540000
283300     MOVE 'D4100'                       TO PGM-LOCATION.          29550000
283400     MOVE 'D4100-FETCH-CURRENT-INFO'    TO PV-ABEND-PARAGRAPH.    29560000
283500                                                                  29570000
283600     EXEC SQL                                                     29580000
283700          SELECT                                                  29590000
283800                  COALESCE(SUM(D.DD_FCTR),0)                      29600000
283900                , COALESCE(SUM(F.ONHAND_QTY),0)                   29610000
284000                , COALESCE(SUM(D.CSTOCK_QTY),0)                   29620000
284100                , COALESCE(SUM(D.ON_ORDER_QTY),0)                 29630000
284200                , COALESCE(AVG(D.OSTRAT_QTY),0)                   29640000
284300                , COALESCE(MAX(LT_QTY),0)                         29650000
284400          INTO  :PV-DD                                            29660000
284500               ,:PV-ONHAND                                        29670000
284600               ,:PV-CSTOCK                                        29680000
284700               ,:PV-ON-ORDER                                      29690000
284800               ,:PV-OSTRAT                                        29700000
284900               ,:PV-LT                                            29710000
285000          FROM   TSKXREF     X                                    29720000
285100                ,TMRITEM     B                                    29730000
285200                ,TMRITST     D                                    29740000
285300                ,TSKST       F                                    29750000
285400                ,XMT_LOC     G                                    29760000
285500          WHERE  X.ITM_NBR            =  B.ITEM_NBR               29770000
285600            AND  X.ITM_NBR            =  D.ITEM_NBR               29780000
285700            AND  X.ITM_NBR            =  F.ITEM_NMBR              29790000
285800            AND  D.STR_NBR            =  F.LOC_NBR                29800000
285900            AND  D.STR_NBR            > 0                         29810000
286000            AND  D.FT_CDE             =  'O'                      29820000
286100            AND  D.STR_NBR            = G.LOC_NBR                 29830000
286200            AND  G.E_BUS_IND          = 'N'                       29840000
286400            AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)        29850000
286500            OR   (RT_NBR > 4                                      29860000
286600            AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)          29870000
286700            AND  RT_DAY_NBR <> 0))                                29880000
286800            AND  X.DEPT               = :PV-HOLD-DEPT-NBR         29890000
286900            AND  X.CLASS              = :PV-HOLD-CLASS-NBR        29900000
064400            WITH UR                                               29910000
287000     END-EXEC.                                                    29920000
287100                                                                  29930000
287200     EVALUATE TRUE                                                29940000
287300       WHEN SQLCODE         = ZERO                                29950000
287400         CONTINUE                                                 29960000
287500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    29970000
287600         MOVE PC-Y TO PS-EOC-CURR-CSR                             29980000
287700       WHEN OTHER                                                 29990000
287800         DISPLAY PV-ABEND-PARAGRAPH                               30000000
287900         PERFORM Z9900-SQL-ERROR                                  30010000
288000     END-EVALUATE.                                                30020000
288100                                                                  30030000
288200***************************************************************** 30040000
288300* GETS CURRENT FORECAST AND CALCULATES AND STORES THE FORECAST    30050000
288400* FOR THE NEXT 52 WEEKS.                                          30060000
288500***************************************************************** 30070000
288600 D5000-GET-CURRENT-FORECAST.                                      30080000
288700                                                                  30090000
288800        PERFORM D5100-INITIALZE-TABLE.                            30100000
288900        MOVE PC-N TO PS-EOC-C-FRCST-CSR                           30110000
289000        PERFORM D5200-OPEN-CURR-FRCST-CSR.                        30120000
289100        PERFORM D5300-LOOP-THRU-CURR-CSR UNTIL EOC-C-FRCST-CSR.   30130000
289200        MOVE PT-FORECAST-AMOUNT(PC-ONE)                           30140000
289300                                    TO DL7-CURRENT-FRCST.         30150000
289400        MOVE PT-FORECAST-AMOUNT(PC-TWO)                           30160000
289500                                    TO DL7-FUTURE-FRCST(PC-ONE).  30170000
289600        MOVE PT-FORECAST-AMOUNT(PC-THREE)                         30180000
289700                                    TO DL7-FUTURE-FRCST(PC-TWO).  30190000
289800        MOVE PT-FORECAST-AMOUNT(PC-FOUR)                          30200000
289900                                    TO DL7-FUTURE-FRCST(PC-THREE).30210000
290000        MOVE PT-FORECAST-AMOUNT(PC-FIVE)                          30220000
290100                                    TO DL7-FUTURE-FRCST(PC-FOUR). 30230000
290200        MOVE PT-FORECAST-AMOUNT(PC-SIX)                           30240000
290300                                    TO DL7-FUTURE-FRCST(PC-FIVE). 30250000
290400                                                                  30260000
290500***************************************************************** 30270000
290600* INITIALZE FORECAST TABLE.                                       30280000
290700***************************************************************** 30290000
290800 D5100-INITIALZE-TABLE.                                           30300000
290900                                                                  30310000
291000        MOVE PC-ONE      TO PV-BIM-INDEX.                         30320000
291100        PERFORM UNTIL PV-BIM-INDEX > PC-52                        30330000
291200            MOVE ZEROES  TO PT-FORECAST-AMOUNT(PV-BIM-INDEX)      30340000
291300            ADD PC-ONE   TO PV-BIM-INDEX                          30350000
291400        END-PERFORM.                                              30360000
291500                                                                  30370000
291600                                                                  30380000
291700***************************************************************** 30390000
291800* OPEN MAJ-CLS-CURR-FRCST CURSOR                                  30400000
291900***************************************************************** 30410000
292000 D5200-OPEN-CURR-FRCST-CSR.                                       30420000
292100                                                                  30430000
292200     MOVE 'D5200'                    TO PGM-LOCATION.             30440000
292300     MOVE 'D5200-OPEN-CURR-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      30450000
292400                                                                  30460000
292500     EXEC SQL                                                     30470000
292600         OPEN MAJ-CLS-CURR-FRCST                                  30480000
292700     END-EXEC.                                                    30490000
292800                                                                  30500000
292900     EVALUATE TRUE                                                30510000
293000       WHEN SQLCODE         = ZERO                                30520000
293100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    30530000
293200         CONTINUE                                                 30540000
293300       WHEN OTHER                                                 30550000
293400         DISPLAY PV-ABEND-PARAGRAPH                               30560000
293500         PERFORM Z9900-SQL-ERROR                                  30570000
293600     END-EVALUATE.                                                30580000
293700                                                                  30590000
293800***************************************************************** 30600000
293900* LOOP THRU CLR-STL-CURR-FRCST CURSOR AND CALCULATE FORECASTS.    30610000
294000***************************************************************** 30620000
294100 D5300-LOOP-THRU-CURR-CSR.                                        30630000
294200                                                                  30640000
294300     PERFORM D5400-FETCH-CURR-FRCST-CSR.                          30650000
294400     IF EOC-C-FRCST-CSR                                           30660000
294500         CONTINUE                                                 30670000
294600     ELSE                                                         30680000
294700         MOVE PV-CURR-WEEK         TO PV-BIM-WEEK-INDEX           30690000
294800         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                30700000
294900         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      30710000
295000         PERFORM B2000-READ-BIM-FILE                              30720000
295100         IF BIM-RECORD-FOUND                                      30730000
295200             PERFORM D5600-CALCULATE-FORECAST                     30740000
295300                 VARYING PV-BIM-INDEX  FROM 1 BY 1                30750000
295400                 UNTIL PV-BIM-INDEX GREATER THAN PC-52            30760000
295500         END-IF                                                   30770000
295600     END-IF.                                                      30780000
295700                                                                  30790000
295800***************************************************************** 30800000
295900* FETCH MAJ-CLS-CURR-FRCST CURSOR                                 30810000
296000***************************************************************** 30820000
296100 D5400-FETCH-CURR-FRCST-CSR.                                      30830000
296200                                                                  30840000
296300     MOVE 'D5400'                       TO PGM-LOCATION.          30850000
296400     MOVE 'D5400-FETCH-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    30860000
296500                                                                  30870000
296600     EXEC SQL                                                     30880000
296700       FETCH MAJ-CLS-CURR-FRCST                                   30890000
296800        INTO                                                      30900000
296900              :MRITEM-UCYCLE-CDE,                                 30910000
297000              :MRITST-DD-FCTR,                                    30920000
297100              :MRITST-PTAG-ID                                     30930000
297200     END-EXEC.                                                    30940000
297300                                                                  30950000
297400     EVALUATE TRUE                                                30960000
297500       WHEN SQLCODE         = ZERO                                30970000
297600         CONTINUE                                                 30980000
297700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    30990000
297800         PERFORM D5500-CLOSE-CURR-FRCST-CSR                       31000000
297900         MOVE PC-Y TO PS-EOC-C-FRCST-CSR                          31010000
298000       WHEN OTHER                                                 31020000
298100         DISPLAY PV-ABEND-PARAGRAPH                               31030000
298200         PERFORM Z9900-SQL-ERROR                                  31040000
298300     END-EVALUATE.                                                31050000
298400                                                                  31060000
298500******************************************************************31070000
298600*  CLOSE MAJ-CLS-CURR-FRCST CURSOR                               *31080000
298700******************************************************************31090000
298800 D5500-CLOSE-CURR-FRCST-CSR.                                      31100000
298900*                                                                 31110000
299000     MOVE 'D5500'                       TO PGM-LOCATION.          31120000
299100     MOVE 'D5500-CLOSE-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    31130000
299200                                                                  31140000
299300     EXEC SQL                                                     31150000
299400         CLOSE MAJ-CLS-CURR-FRCST                                 31160000
299500     END-EXEC.                                                    31170000
299600                                                                  31180000
299700     EVALUATE TRUE                                                31190000
299800         WHEN SQLCODE EQUAL ZERO                                  31200000
299900         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      31210000
300000             CONTINUE                                             31220000
300100         WHEN OTHER                                               31230000
300200             DISPLAY PV-ABEND-PARAGRAPH                           31240000
300300             PERFORM Z9900-SQL-ERROR                              31250000
300400     END-EVALUATE.                                                31260000
300500                                                                  31270000
300600***************************************************************** 31280000
300700* CALCULATE FORECAST.                                             31290000
300800***************************************************************** 31300000
300900 D5600-CALCULATE-FORECAST.                                        31310000
301000                                                                  31320000
301100     MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI                 31330000
301200     IF MRITEM-UCYCLE-CDE = 9                                     31340000
301300         MOVE MRITST-DD-FCTR      TO PV-DD-COMPUTED               31350000
301400     ELSE                                                         31360000
301500         IF MRITEM-UCYCLE-CDE = 5                                 31370000
301600             DIVIDE MRITST-DD-FCTR      BY PC-FOUR                31380000
301700                            GIVING PV-DD-COMPUTED ROUNDED         31390000
301800         END-IF                                                   31400000
301900     END-IF.                                                      31410000
302000                                                                  31420000
302100     MULTIPLY PV-BI BY PV-DD-COMPUTED  GIVING PV-FORECAST.        31430000
302200     ADD  PV-FORECAST  TO  PT-FORECAST-AMOUNT(PV-BIM-INDEX).      31440000
302300                                                                  31450000
302400     IF PV-BIM-WEEK-INDEX = PC-52                                 31460000
302500         MOVE PC-ONE      TO PV-BIM-WEEK-INDEX                    31470000
302600     ELSE                                                         31480000
302700         ADD PC-ONE       TO PV-BIM-WEEK-INDEX                    31490000
302800     END-IF.                                                      31500000
302900                                                                  31510000
303000                                                                  31520000
303100***************************************************************** 31530000
303200* CONTROL BREAK AT THE SUB CLASS LEVEL                            31540000
303300***************************************************************** 31550000
303400 E0000-SUB-CLASS-BREAK.                                           31560000
303500                                                                  31570000
303600     MOVE PC-N                         TO PS-EOC-SUB-CLASS-CSR.   31580000
303700     PERFORM E0100-OPEN-SUB-CLASS-CSR.                            31590000
303800     PERFORM E0200-PROCESS-SUB-CLASS-CSR                          31600000
303900                                       UNTIL EOC-SUB-CLASS-CSR.   31610000
304000                                                                  31620000
304100***************************************************************** 31630000
304200*  OPEN SUB CLASS CURSOR                                          31640000
304300***************************************************************** 31650000
304400 E0100-OPEN-SUB-CLASS-CSR.                                        31660000
304500                                                                  31670000
304600     MOVE 'E0100'                      TO PGM-LOCATION.           31680000
304700     MOVE 'E0100-OPEN-SUB-CLASS-CSR'   TO PV-ABEND-PARAGRAPH.     31690000
304800                                                                  31700000
304900     EXEC SQL                                                     31710000
305000         OPEN SUB-CLASS-LEVEL                                     31720000
305100     END-EXEC.                                                    31730000
305200                                                                  31740000
305300     EVALUATE TRUE                                                31750000
305400       WHEN SQLCODE         = ZERO                                31760000
305500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    31770000
305600         CONTINUE                                                 31780000
305700       WHEN OTHER                                                 31790000
305800         DISPLAY PV-ABEND-PARAGRAPH                               31800000
305900         PERFORM Z9900-SQL-ERROR                                  31810000
306000     END-EVALUATE.                                                31820000
306100                                                                  31830000
306200***************************************************************** 31840000
306300* PROCESS SUB CLASS CURSOR                                        31850000
306400***************************************************************** 31860000
306500 E0200-PROCESS-SUB-CLASS-CSR.                                     31870000
306600                                                                  31880000
306700     PERFORM E0300-FETCH-SUB-CLASS-CSR.                           31890000
306800     IF EOC-SUB-CLASS-CSR                                         31900000
306900         CONTINUE                                                 31910000
307000     ELSE                                                         31920000
307100         MOVE SKXREF-CLASS               TO  PV-HOLD-CLASS-NBR    31930000
307200         MOVE SKXREF-SUBCLASS            TO  PV-HOLD-SCL-NBR      31940000
307300         MOVE PC-Y                       TO  PS-PROCESS-LINE-INFO 31950000
307400         PERFORM E1000-CREATE-REPORT-LINES                        31960000
307500         IF PROCESS-LINE-INFO                                     31970000
307600             PERFORM R0000-PRINT-REPORT-LINES                     31980000
307700         END-IF                                                   31990000
307800     END-IF.                                                      32000000
307900                                                                  32010000
308000***************************************************************** 32020000
308100* FETCH SUB CLASS CURSOR                                          32030000
308200***************************************************************** 32040000
308300  E0300-FETCH-SUB-CLASS-CSR.                                      32050000
308400                                                                  32060000
308500     MOVE 'E0300'                       TO PGM-LOCATION.          32070000
308600     MOVE 'E0300-FETCH-SUB-CLASS-CURSOR'                          32080000
308700                                        TO PV-ABEND-PARAGRAPH.    32090000
308800                                                                  32100000
308900     EXEC SQL                                                     32110000
309000       FETCH SUB-CLASS-LEVEL                                      32120000
309100        INTO                                                      32130000
309200              :SKXREF-DEPT                                        32140000
309300             ,:SKXREF-CLASS                                       32150000
309400             ,:SKXREF-SUBCLASS                                    32160000
309500     END-EXEC.                                                    32170000
309600                                                                  32180000
309700     EVALUATE TRUE                                                32190000
309800       WHEN SQLCODE         = ZERO                                32200000
309900         CONTINUE                                                 32210000
310000       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    32220000
310100         PERFORM E0400-CLOSE-SUB-CLASS-CSR                        32230000
310200         MOVE PC-Y TO PS-EOC-SUB-CLASS-CSR                        32240000
310300       WHEN OTHER                                                 32250000
310400         DISPLAY PV-ABEND-PARAGRAPH                               32260000
310500         PERFORM Z9900-SQL-ERROR                                  32270000
310600     END-EVALUATE.                                                32280000
310700                                                                  32290000
310800******************************************************************32300000
310900*  CLOSE SUB CLASS CURSOR                                        *32310000
311000******************************************************************32320000
311100 E0400-CLOSE-SUB-CLASS-CSR.                                       32330000
311200                                                                  32340000
311300     MOVE 'E0400'                        TO PGM-LOCATION.         32350000
311400     MOVE 'E0400-CLOSE-SUB-CLASS-CSR'    TO PV-ABEND-PARAGRAPH.   32360000
311500                                                                  32370000
311600     EXEC SQL                                                     32380000
311700         CLOSE SUB-CLASS-LEVEL                                    32390000
311800     END-EXEC.                                                    32400000
311900                                                                  32410000
312000     EVALUATE TRUE                                                32420000
312100         WHEN SQLCODE EQUAL ZERO                                  32430000
312200         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      32440000
312300             CONTINUE                                             32450000
312400         WHEN OTHER                                               32460000
312500             DISPLAY PV-ABEND-PARAGRAPH                           32470000
312600             PERFORM Z9900-SQL-ERROR                              32480000
312700     END-EVALUATE.                                                32490000
312800                                                                  32500000
312900***************************************************************** 32510000
313000* SET UP DATA FOR THE REPORT LINES                                32520000
313100***************************************************************** 32530000
313200 E1000-CREATE-REPORT-LINES.                                       32540000
313300                                                                  32550000
313400     MOVE ZERO                       TO PV-CUMM-SALES.            32560000
313500     PERFORM E2000-GET-HISTORY-INFO.                              32570000
313600     MOVE PV-CUMM-SALES              TO DL8-CUMM-SALES.           32580000
313700                                                                  32590000
313800     MOVE ZERO                       TO PV-CUMM-FRCST.            32600000
313900     PERFORM E3000-GET-HISTORY-FORECAST.                          32610000
314000     MOVE PV-CUMM-FRCST              TO DL7-CUMM-FRCST.           32620000
314100                                                                  32630000
314200     IF PV-HOLD-PER                                               32640000
314300         PERFORM B4000-CHECK-PERCENT-VARIANCE                     32650000
314400     END-IF.                                                      32660000
314500                                                                  32670000
314600                                                                  32680000
314700     IF PROCESS-LINE-INFO                                         32690000
314800         PERFORM E4000-GET-CURRENT-INFO                           32700000
314900         PERFORM E5000-GET-CURRENT-FORECAST                       32710000
315000         PERFORM B3000-CALCULATE-WEEKS-SUPPLY                     32720000
315100     END-IF.                                                      32730000
315200                                                                  32740000
315300     IF PROCESS-LINE-INFO                                         32750000
315400         PERFORM B4100-CALCULATE-CUMM-PCNT                        32760000
315500         PERFORM B4200-CALCULATE-CSTOCK-PERCENT                   32770000
315600     END-IF.                                                      32780000
315700                                                                  32790000
315800***************************************************************** 32800000
315900* GETS DD, MADDSS, ONHAND, AND SALES FOR PREVIOUS FOUR WEEKS      32810000
316000***************************************************************** 32820000
316100 E2000-GET-HISTORY-INFO.                                          32830000
316200                                                                  32840000
316300     PERFORM                                                      32850000
316400       VARYING PV-HIST-INDEX FROM 1 BY 1                          32860000
316500       UNTIL PV-HIST-INDEX > 4                                    32870000
316600          MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR        32880000
316700          MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK        32890000
316800          MOVE PC-N                   TO PS-EOC-HIST-CSR          32900000
316900          PERFORM E2100-FETCH-HISTORY-INFO                        32910000
317000          IF EOC-HIST-CSR                                         32920000
317100              MOVE ZEROES      TO  DL6-DD(PV-HIST-INDEX)          32930000
317200              MOVE ZEROES      TO  DL10-OH-HIST(PV-HIST-INDEX)    32940000
317300          ELSE                                                    32950000
317400              MOVE PV-DD       TO  DL6-DD(PV-HIST-INDEX)          32960000
317500              MOVE PV-ONHAND   TO  DL10-OH-HIST(PV-HIST-INDEX)    32970000
317600          END-IF                                                  32980000
317700     END-PERFORM.                                                 32990000
317800                                                                  33000000
317900     PERFORM                                                      33010000
318000       VARYING PV-HIST-INDEX FROM 1 BY 1                          33020000
318100       UNTIL PV-HIST-INDEX > 4                                    33030000
318200          MOVE PT-FSCL-DATE(PV-HIST-INDEX) TO PV-HOLD-FSCL-DATE   33040000
318300          MOVE PC-N                        TO PS-EOC-SLS-HIST-CSR 33050000
139600          COMPUTE PV-DATE-INDEX =                                 33060000
139600             (PV-HIST-INDEX * PC-SEVEN) - PC-SIX                  33070000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE1    33080000
                ADD PC-ONE TO PV-DATE-INDEX                             33090000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE2    33100000
                ADD PC-ONE TO PV-DATE-INDEX                             33110000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE3    33120000
                ADD PC-ONE TO PV-DATE-INDEX                             33130000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE4    33140000
                ADD PC-ONE TO PV-DATE-INDEX                             33150000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE5    33160000
                ADD PC-ONE TO PV-DATE-INDEX                             33170000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE6    33180000
                ADD PC-ONE TO PV-DATE-INDEX                             33190000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE7    33200000
318400          PERFORM E2300-FETCH-HIST-SLS-INFO                       33210000
318500          IF EOC-SLS-HIST-CSR                                     33220000
318600              MOVE ZEROES      TO  DL8-SALES(PV-HIST-INDEX)       33230000
318700          ELSE                                                    33240000
318800              MOVE PV-SALES    TO  DL8-SALES(PV-HIST-INDEX)       33250000
318900              ADD  PV-SALES    TO  PV-CUMM-SALES                  33260000
319000          END-IF                                                  33270000
319100     END-PERFORM.                                                 33280000
319200                                                                  33290000
319300***************************************************************** 33300000
319400* FETCHS DD, MADDSS, AND ONHAND FOUR THE 4 PREVIOUS WEEKS.        33310000
319500***************************************************************** 33320000
319600 E2100-FETCH-HISTORY-INFO.                                        33330000
319700                                                                  33340000
319800     MOVE 'E2100'                       TO PGM-LOCATION.          33350000
319900     MOVE 'E2100-FETCH-HISTORY-INFO'    TO PV-ABEND-PARAGRAPH.    33360000
320000                                                                  33370000
320100     EXEC SQL                                                     33380000
320200          SELECT                                                  33390000
320300                  COALESCE(SUM(C.OH_HIST_QTY),0)                  33400000
320400                , COALESCE(SUM(C.DSD_HIST_QTY),0)                 33410000
320500                , COALESCE(SUM(C.MAD_HIST_QTY),0)                 33420000
320600          INTO                                                    33430000
320700                :PV-ONHAND                                        33440000
320800               ,:PV-DD                                            33450000
320900               ,:PV-MADDSS                                        33460000
321000          FROM   TSKXREF     X                                    33470000
321100                ,TMRITEM     B                                    33480000
321200                ,TMRISHS     C                                    33490000
321300                ,TMRITST     D                                    33500000
321400                ,XMT_LOC     G                                    33510000
321500          WHERE  X.ITM_NBR           =  B.ITEM_NBR                33520000
321600            AND  X.ITM_NBR           =  C.ITM_NBR                 33530000
321700            AND  X.ITM_NBR           =  D.ITEM_NBR                33540000
321800            AND  C.STR_NBR           =  D.STR_NBR                 33550000
321900            AND  C.STR_NBR           > 0                          33560000
322000            AND  D.FT_CDE            =  'O'                       33570000
322100            AND  D.STR_NBR           = G.LOC_NBR                  33580000
322200            AND  G.E_BUS_IND         = 'N'                        33590000
322400            AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)        33600000
322500            OR   (RT_NBR > 4                                      33610000
322600            AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)          33620000
322700            AND  RT_DAY_NBR <> 0))                                33630000
322800            AND  C.YR_NBR            = :PV-HOLD-YEAR              33640000
322900            AND  C.WK_NBR            = :PV-HOLD-WEEK              33650000
323000            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          33660000
323100            AND  X.CLASS             = :PV-HOLD-CLASS-NBR         33670000
323200            AND  X.SUBCLASS          = :PV-HOLD-SCL-NBR           33680000
323300            AND  C.ITM_REV_ID        = (SELECT MAX (E.ITM_REV_ID) 33690000
323400                  FROM TMRISHS  E                                 33700000
323500              WHERE                                               33710000
323600                    E.ITM_NBR        = C.ITM_NBR                  33720000
323700                AND E.STR_NBR        = C.STR_NBR                  33730000
323800                AND E.YR_NBR         = :PV-HOLD-YEAR              33740000
323900                AND E.WK_NBR         = :PV-HOLD-WEEK)             33750000
064400            WITH UR                                               33760000
324000     END-EXEC.                                                    33770000
324100                                                                  33780000
324200     EVALUATE TRUE                                                33790000
324300       WHEN SQLCODE         = ZERO                                33800000
324400         CONTINUE                                                 33810000
324500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    33820000
324600         MOVE PC-Y TO PS-EOC-HIST-CSR                             33830000
324700       WHEN OTHER                                                 33840000
324800         DISPLAY PV-ABEND-PARAGRAPH                               33850000
324900         PERFORM Z9900-SQL-ERROR                                  33860000
325000     END-EVALUATE.                                                33870000
325100                                                                  33880000
325200***************************************************************** 33890000
325300* FETCHS SALES FOR 4 PREVIOUS WEEKS.                              33900000
325400***************************************************************** 33910000
325500 E2300-FETCH-HIST-SLS-INFO.                                       33920000
325600                                                                  33930000
325700     MOVE 'E2300'                       TO PGM-LOCATION.          33940000
325800     MOVE 'E2300-FETCH-HIST-SLS-INFO'   TO PV-ABEND-PARAGRAPH.    33950000
325900                                                                  33960000
326000     EXEC SQL                                                     33970000
326100          SELECT                                                  33980000
326200                  COALESCE(SUM(C.SLS_UNT_QTY),0)                  33990000
326300          INTO                                                    34000000
326400                :PV-SALES                                         34010000
326500          FROM   TSKXREF     X                                    34020000
326600                ,TMRITEM     B                                    34030000
326700                ,MHT_DLY_SLS C                                    34040000
326800                ,TMRITST     D                                    34050000
326900                ,XMT_LOC     G                                    34060000
327000          WHERE  X.ITM_NBR           =  B.ITEM_NBR                34070000
457000            AND  X.SKU               = C.SKU_NBR                  34080000
327200            AND  X.ITM_NBR           =  D.ITEM_NBR                34090000
327300            AND  D.FT_CDE            =  'O'                       34100000
327400            AND  D.STR_NBR           = C.STR_NBR                  34110000
327500            AND  C.STR_NBR           > 0                          34120000
327600            AND  D.STR_NBR           = G.LOC_NBR                  34130000
327700            AND  G.E_BUS_IND         = 'N'                        34140000
327900            AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)        34150000
328000            OR   (RT_NBR > 4                                      34160000
328100            AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)          34170000
328200            AND  RT_DAY_NBR <> 0))                                34180000
328300            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          34190000
328400            AND  X.CLASS             = :PV-HOLD-CLASS-NBR         34200000
328500            AND  X.SUBCLASS          = :PV-HOLD-SCL-NBR           34210000
458500            AND  C.PRCG_DTE BETWEEN :PV-FSCL-VAR-DATE1 AND        34220000
                                      :PV-FSCL-VAR-DATE7                34230000
328700            AND C.SKU_STAT_CDE IN ('10', '20', '40')              34240000
064400            WITH UR                                               34250000
328800     END-EXEC.                                                    34260000
328900                                                                  34270000
329000     EVALUATE TRUE                                                34280000
329100       WHEN SQLCODE         = ZERO                                34290000
329200         CONTINUE                                                 34300000
329300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    34310000
329400         MOVE PC-Y TO PS-EOC-SLS-HIST-CSR                         34320000
329500       WHEN OTHER                                                 34330000
329600         DISPLAY PV-ABEND-PARAGRAPH                               34340000
329700         PERFORM Z9900-SQL-ERROR                                  34350000
329800     END-EVALUATE.                                                34360000
329900                                                                  34370000
330000***************************************************************** 34380000
330100* CALCULATES FORECAST FOR LAST 4 WEEKS                            34390000
330200***************************************************************** 34400000
330300 E3000-GET-HISTORY-FORECAST.                                      34410000
330400                                                                  34420000
330500     PERFORM                                                      34430000
330600       VARYING PV-HIST-INDEX FROM 1 BY 1                          34440000
330700       UNTIL PV-HIST-INDEX > 4                                    34450000
330800        MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR          34460000
330900        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK          34470000
331000        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-BIM-WEEK-INDEX     34480000
331100        MOVE PC-N TO PS-EOC-H-FRCST-CSR                           34490000
331200        PERFORM E3100-OPEN-HIST-FRCST-CSR                         34500000
331300        MOVE ZERO                        TO PV-TOTAL-FORECAST     34510000
331400        PERFORM E3200-LOOP-THRU-CSR                               34520000
331500                    UNTIL EOC-H-FRCST-CSR                         34530000
331600        MOVE PV-TOTAL-FORECAST                                    34540000
331700                                 TO DL7-HIST-FRCST(PV-HIST-INDEX) 34550000
331800        ADD  PV-TOTAL-FORECAST   TO PV-CUMM-FRCST                 34560000
331900     END-PERFORM.                                                 34570000
332000                                                                  34580000
332100     PERFORM E3500-CALCULATE-FRCST-PERCENT                        34590000
332200       VARYING PV-HIST-INDEX FROM 1 BY 1                          34600000
332300       UNTIL PV-HIST-INDEX > 4.                                   34610000
332400                                                                  34620000
332500***************************************************************** 34630000
332600*  OPEN SUB-CLS-HIST-FRCST CURSOR                                 34640000
332700***************************************************************** 34650000
332800 E3100-OPEN-HIST-FRCST-CSR.                                       34660000
332900                                                                  34670000
333000     MOVE 'E3100'                    TO PGM-LOCATION.             34680000
333100     MOVE 'E3100-OPEN-HIST-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      34690000
333200                                                                  34700000
333300     EXEC SQL                                                     34710000
333400         OPEN SUB-CLS-HIST-FRCST                                  34720000
333500     END-EXEC.                                                    34730000
333600                                                                  34740000
333700     EVALUATE TRUE                                                34750000
333800       WHEN SQLCODE         = ZERO                                34760000
333900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    34770000
334000         CONTINUE                                                 34780000
334100       WHEN OTHER                                                 34790000
334200         DISPLAY PV-ABEND-PARAGRAPH                               34800000
334300         PERFORM Z9900-SQL-ERROR                                  34810000
334400     END-EVALUATE.                                                34820000
334500                                                                  34830000
334600***************************************************************** 34840000
334700* LOOP THRU HIST-FRCST CURSOR AND CALCULATES AND ADDS FORECAST    34850000
334800* TO TOTAL                                                        34860000
334900***************************************************************** 34870000
335000 E3200-LOOP-THRU-CSR.                                             34880000
335100                                                                  34890000
335200     PERFORM E3300-FETCH-HIST-FRCST-CSR.                          34900000
335300     IF EOC-H-FRCST-CSR                                           34910000
335400         CONTINUE                                                 34920000
335500     ELSE                                                         34930000
335600         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                34940000
335700         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      34950000
335800         PERFORM B2000-READ-BIM-FILE                              34960000
335900         IF BIM-RECORD-FOUND                                      34970000
336000             MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI         34980000
336100             IF MRITEM-UCYCLE-CDE = 9                             34990000
336200                 MOVE MRISHS-DSD-HIST-QTY TO PV-DD-COMPUTED       35000000
336300             ELSE                                                 35010000
336400                 IF MRITEM-UCYCLE-CDE = 5                         35020000
336500                     DIVIDE MRISHS-DSD-HIST-QTY BY PC-FOUR        35030000
336600                                     GIVING PV-DD-COMPUTED ROUNDED35040000
336700                 END-IF                                           35050000
336800             END-IF                                               35060000
336900             MULTIPLY PV-BI BY PV-DD-COMPUTED                     35070000
337000                                            GIVING PV-FORECAST    35080000
337100             ADD PV-FORECAST TO PV-TOTAL-FORECAST                 35090000
337200         END-IF                                                   35100000
337300     END-IF.                                                      35110000
337400                                                                  35120000
337500***************************************************************** 35130000
337600* FETCH SUB-CLS-HIST-FRCST CURSOR - GETS DD AND PTAG TO READ BIM  35140000
337700* FILE                                                            35150000
337800***************************************************************** 35160000
337900 E3300-FETCH-HIST-FRCST-CSR.                                      35170000
338000                                                                  35180000
338100     MOVE 'E3300'                       TO PGM-LOCATION.          35190000
338200     MOVE 'E3300-FETCH-HIST-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    35200000
338300                                                                  35210000
338400     EXEC SQL                                                     35220000
338500       FETCH SUB-CLS-HIST-FRCST                                   35230000
338600        INTO                                                      35240000
338700              :MRITEM-UCYCLE-CDE,                                 35250000
338800              :MRISHS-DSD-HIST-QTY,                               35260000
338900              :MRITST-PTAG-ID                                     35270000
339000     END-EXEC.                                                    35280000
339100*                                                                 35290000
339200     EVALUATE TRUE                                                35300000
339300       WHEN SQLCODE         = ZERO                                35310000
339400         CONTINUE                                                 35320000
339500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    35330000
339600         PERFORM E3400-CLOSE-FRCST-LEVEL-CSR                      35340000
339700         MOVE PC-Y TO PS-EOC-H-FRCST-CSR                          35350000
339800       WHEN OTHER                                                 35360000
339900         DISPLAY PV-ABEND-PARAGRAPH                               35370000
340000         PERFORM Z9900-SQL-ERROR                                  35380000
340100     END-EVALUATE.                                                35390000
340200                                                                  35400000
340300******************************************************************35410000
340400* CLOSE SUB-CLS-HIST-FRCST CURSOR                                *35420000
340500******************************************************************35430000
340600 E3400-CLOSE-FRCST-LEVEL-CSR.                                     35440000
340700                                                                  35450000
340800     MOVE 'E3400'                        TO PGM-LOCATION.         35460000
340900     MOVE 'E3400-CLOSE-FRCST-LEVEL-CSR'  TO PV-ABEND-PARAGRAPH.   35470000
341000                                                                  35480000
341100     EXEC SQL                                                     35490000
341200         CLOSE SUB-CLS-HIST-FRCST                                 35500000
341300     END-EXEC.                                                    35510000
341400                                                                  35520000
341500     EVALUATE TRUE                                                35530000
341600         WHEN SQLCODE EQUAL ZERO                                  35540000
341700         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      35550000
341800             CONTINUE                                             35560000
341900         WHEN OTHER                                               35570000
342000             DISPLAY PV-ABEND-PARAGRAPH                           35580000
342100             PERFORM Z9900-SQL-ERROR                              35590000
342200     END-EVALUATE.                                                35600000
342300                                                                  35610000
342400***************************************************************** 35620000
342500* CALCULATES PERCENT DIFFERENCE BETWEEN WHAT WAS FORECAST AND     35630000
342600* WHAT WAS SOLD.                                                  35640000
342700***************************************************************** 35650000
342800 E3500-CALCULATE-FRCST-PERCENT.                                   35660000
342900                                                                  35670000
343000     MOVE DL7-HIST-FRCST(PV-HIST-INDEX)   TO PV-FORECAST.         35680000
343100     MOVE DL8-SALES(PV-HIST-INDEX)        TO PV-SALES.            35690000
343200                                                                  35700000
343300     IF  PV-FORECAST = 0                                          35710000
343400         MOVE '***'          TO  DL9-DIFFRNC(PV-HIST-INDEX)       35720000
343500     ELSE                                                         35730000
343600         IF PV-SALES  = 0                                         35740000
343700             MOVE 0          TO  DL9-DIFFRNC-N(PV-HIST-INDEX)     35750000
343800         ELSE                                                     35760000
343900             COMPUTE PV-FRCST-PERCENT ROUNDED =                   35770000
344000                  (PV-SALES - PV-FORECAST) / PV-FORECAST * 100    35780000
344100             MOVE PV-FRCST-PERCENT                                35790000
344200                         TO DL9-DIFFRNC-N(PV-HIST-INDEX)          35800000
344300         END-IF                                                   35810000
344400     END-IF.                                                      35820000
344500                                                                  35830000
344600***************************************************************** 35840000
344700* GETS ONORDER, ONHAND, DD, CSTOCK, AVG OSTRAT, AND MAXIMUM LEAD  35850000
344800* TIME.                                                           35860000
344900***************************************************************** 35870000
345000 E4000-GET-CURRENT-INFO.                                          35880000
345100                                                                  35890000
345200     MOVE PC-N TO PS-EOC-CURR-CSR.                                35900000
345300     PERFORM E4100-FETCH-CURRENT-INFO.                            35910000
345400     IF EOC-CURR-CSR                                              35920000
345500         MOVE ZEROES           TO  DL3-ONORDER                    35930000
345600         MOVE ZEROES           TO  DL10-ONHAND                    35940000
345700         MOVE ZEROES           TO  DL6-DD-CURR                    35950000
345800         MOVE ZEROES           TO  DL11-CSTOCK                    35960000
345900         MOVE ZEROES           TO  DL2-AVG-OSTRAT                 35970000
346000         MOVE ZEROES           TO  DL2-LEAD-TIME                  35980000
346100     ELSE                                                         35990000
346200         MOVE PV-ON-ORDER      TO  DL3-ONORDER                    36000000
346300         MOVE PV-ONHAND        TO  DL10-ONHAND                    36010000
346400         MOVE PV-DD            TO  DL6-DD-CURR                    36020000
346500         MOVE PV-CSTOCK        TO  DL11-CSTOCK                    36030000
346600         MOVE PV-OSTRAT        TO  DL2-AVG-OSTRAT                 36040000
346700         MOVE PV-LT            TO  DL2-LEAD-TIME                  36050000
346800     END-IF.                                                      36060000
346900                                                                  36070000
347000***************************************************************** 36080000
347100* FETCH CURRENT INFO FOR DD, ONHAND, CSTOCK, ONORDER, AVG OSTRAT  36090000
347200* AND MAXIMUM LEAD TIME                                           36100000
347300***************************************************************** 36110000
347400 E4100-FETCH-CURRENT-INFO.                                        36120000
347500                                                                  36130000
347600     MOVE 'E4100'                       TO PGM-LOCATION.          36140000
347700     MOVE 'E4100-FETCH-CURRENT-INFO'    TO PV-ABEND-PARAGRAPH.    36150000
347800                                                                  36160000
347900     EXEC SQL                                                     36170000
348000          SELECT                                                  36180000
348100                  COALESCE(SUM(D.DD_FCTR),0)                      36190000
348200                , COALESCE(SUM(F.ONHAND_QTY),0)                   36200000
348300                , COALESCE(SUM(D.CSTOCK_QTY),0)                   36210000
348400                , COALESCE(SUM(D.ON_ORDER_QTY),0)                 36220000
348500                , COALESCE(AVG(D.OSTRAT_QTY),0)                   36230000
348600                , COALESCE(MAX(LT_QTY),0)                         36240000
348700          INTO  :PV-DD                                            36250000
348800               ,:PV-ONHAND                                        36260000
348900               ,:PV-CSTOCK                                        36270000
349000               ,:PV-ON-ORDER                                      36280000
349100               ,:PV-OSTRAT                                        36290000
349200               ,:PV-LT                                            36300000
349300          FROM   TSKXREF     X                                    36310000
349400                ,TMRITEM     B                                    36320000
349500                ,TMRITST     D                                    36330000
349600                ,TSKST       F                                    36340000
349700                ,XMT_LOC     G                                    36350000
349800          WHERE  X.ITM_NBR            = B.ITEM_NBR                36360000
349900            AND  X.ITM_NBR            = D.ITEM_NBR                36370000
350000            AND  X.ITM_NBR            = F.ITEM_NMBR               36380000
350100            AND  D.STR_NBR            = F.LOC_NBR                 36390000
350200            AND  D.STR_NBR            > 0                         36400000
350300            AND  D.FT_CDE             = 'O'                       36410000
350400            AND  D.STR_NBR            = G.LOC_NBR                 36420000
350500            AND  G.E_BUS_IND          = 'N'                       36430000
350700            AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)        36440000
350800            OR   (RT_NBR > 4                                      36450000
350900            AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)          36460000
351000            AND  RT_DAY_NBR <> 0))                                36470000
351100            AND  X.DEPT               = :PV-HOLD-DEPT-NBR         36480000
351200            AND  X.CLASS              = :PV-HOLD-CLASS-NBR        36490000
351300            AND  X.SUBCLASS           = :PV-HOLD-SCL-NBR          36500000
064400            WITH UR                                               36510000
351400     END-EXEC.                                                    36520000
351500                                                                  36530000
351600     EVALUATE TRUE                                                36540000
351700       WHEN SQLCODE         = ZERO                                36550000
351800         CONTINUE                                                 36560000
351900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    36570000
352000         MOVE PC-Y TO PS-EOC-CURR-CSR                             36580000
352100       WHEN OTHER                                                 36590000
352200         DISPLAY PV-ABEND-PARAGRAPH                               36600000
352300         PERFORM Z9900-SQL-ERROR                                  36610000
352400     END-EVALUATE.                                                36620000
352500                                                                  36630000
352600***************************************************************** 36640000
352700* GETS CURRENT FORECAST AND CALCULATES AND STORES THE FORECAST    36650000
352800* FOR THE NEXT 52 WEEKS.                                          36660000
352900***************************************************************** 36670000
353000 E5000-GET-CURRENT-FORECAST.                                      36680000
353100                                                                  36690000
353200        PERFORM E5100-INITIALZE-TABLE.                            36700000
353300        MOVE PC-N TO PS-EOC-C-FRCST-CSR                           36710000
353400        PERFORM E5200-OPEN-CURR-FRCST-CSR.                        36720000
353500        PERFORM E5300-LOOP-THRU-CURR-CSR UNTIL EOC-C-FRCST-CSR.   36730000
353600        MOVE PT-FORECAST-AMOUNT(PC-ONE)                           36740000
353700                                    TO DL7-CURRENT-FRCST.         36750000
353800        MOVE PT-FORECAST-AMOUNT(PC-TWO)                           36760000
353900                            TO DL7-FUTURE-FRCST(PC-ONE).          36770000
354000        MOVE PT-FORECAST-AMOUNT(PC-THREE)                         36780000
354100                            TO DL7-FUTURE-FRCST(PC-TWO).          36790000
354200        MOVE PT-FORECAST-AMOUNT(PC-FOUR)                          36800000
354300                            TO DL7-FUTURE-FRCST(PC-THREE).        36810000
354400        MOVE PT-FORECAST-AMOUNT(PC-FIVE)                          36820000
354500                            TO DL7-FUTURE-FRCST(PC-FOUR).         36830000
354600        MOVE PT-FORECAST-AMOUNT(PC-SIX)                           36840000
354700                            TO DL7-FUTURE-FRCST(PC-FIVE).         36850000
354800                                                                  36860000
354900***************************************************************** 36870000
355000* INITIALZE FORECAST TABLE.                                       36880000
355100***************************************************************** 36890000
355200 E5100-INITIALZE-TABLE.                                           36900000
355300                                                                  36910000
355400        MOVE PC-ONE      TO PV-BIM-INDEX.                         36920000
355500        PERFORM UNTIL PV-BIM-INDEX > PC-52                        36930000
355600            MOVE ZEROES  TO PT-FORECAST-AMOUNT(PV-BIM-INDEX)      36940000
355700            ADD PC-ONE   TO PV-BIM-INDEX                          36950000
355800        END-PERFORM.                                              36960000
355900                                                                  36970000
356000                                                                  36980000
356100***************************************************************** 36990000
356200* OPEN SUB-CLS-CURR-FRCST CURSOR                                  37000000
356300***************************************************************** 37010000
356400 E5200-OPEN-CURR-FRCST-CSR.                                       37020000
356500                                                                  37030000
356600     MOVE 'E5200'                    TO PGM-LOCATION.             37040000
356700     MOVE 'E5200-OPEN-CURR-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      37050000
356800                                                                  37060000
356900     EXEC SQL                                                     37070000
357000         OPEN SUB-CLS-CURR-FRCST                                  37080000
357100     END-EXEC.                                                    37090000
357200                                                                  37100000
357300     EVALUATE TRUE                                                37110000
357400       WHEN SQLCODE         = ZERO                                37120000
357500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    37130000
357600         CONTINUE                                                 37140000
357700       WHEN OTHER                                                 37150000
357800         DISPLAY PV-ABEND-PARAGRAPH                               37160000
357900         PERFORM Z9900-SQL-ERROR                                  37170000
358000     END-EVALUATE.                                                37180000
358100                                                                  37190000
358200***************************************************************** 37200000
358300* LOOP THRU SUB-CLS-CURR-FRCST CURSOR AND CALCULATE FORECASTS.    37210000
358400***************************************************************** 37220000
358500 E5300-LOOP-THRU-CURR-CSR.                                        37230000
358600                                                                  37240000
358700     PERFORM E5400-FETCH-CURR-FRCST-CSR.                          37250000
358800     IF EOC-C-FRCST-CSR                                           37260000
358900         CONTINUE                                                 37270000
359000     ELSE                                                         37280000
359100         MOVE PV-CURR-WEEK         TO PV-BIM-WEEK-INDEX           37290000
359200         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                37300000
359300         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      37310000
359400         PERFORM B2000-READ-BIM-FILE                              37320000
359500         IF BIM-RECORD-FOUND                                      37330000
359600             PERFORM E5600-CALCULATE-FORECAST                     37340000
359700                 VARYING PV-BIM-INDEX  FROM 1 BY 1                37350000
359800                 UNTIL PV-BIM-INDEX GREATER THAN PC-52            37360000
359900         END-IF                                                   37370000
360000     END-IF.                                                      37380000
360100                                                                  37390000
360200***************************************************************** 37400000
360300* FETCH SUB-CLS-CURR-FRCST CURSOR                                 37410000
360400***************************************************************** 37420000
360500 E5400-FETCH-CURR-FRCST-CSR.                                      37430000
360600                                                                  37440000
360700     MOVE 'E5400'                       TO PGM-LOCATION.          37450000
360800     MOVE 'E5400-FETCH-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    37460000
360900                                                                  37470000
361000     EXEC SQL                                                     37480000
361100       FETCH SUB-CLS-CURR-FRCST                                   37490000
361200        INTO                                                      37500000
361300              :MRITEM-UCYCLE-CDE,                                 37510000
361400              :MRITST-DD-FCTR,                                    37520000
361500              :MRITST-PTAG-ID                                     37530000
361600     END-EXEC.                                                    37540000
361700                                                                  37550000
361800     EVALUATE TRUE                                                37560000
361900       WHEN SQLCODE         = ZERO                                37570000
362000         CONTINUE                                                 37580000
362100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    37590000
362200         PERFORM E5500-CLOSE-CURR-FRCST-CSR                       37600000
362300         MOVE PC-Y TO PS-EOC-C-FRCST-CSR                          37610000
362400       WHEN OTHER                                                 37620000
362500         DISPLAY PV-ABEND-PARAGRAPH                               37630000
362600         PERFORM Z9900-SQL-ERROR                                  37640000
362700     END-EVALUATE.                                                37650000
362800                                                                  37660000
362900******************************************************************37670000
363000* CLOSE SUB-CLS-CURR-FRCST CURSOR                                *37680000
363100******************************************************************37690000
363200 E5500-CLOSE-CURR-FRCST-CSR.                                      37700000
363300                                                                  37710000
363400     MOVE 'E5500'                       TO PGM-LOCATION.          37720000
363500     MOVE 'E5500-CLOSE-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    37730000
363600                                                                  37740000
363700     EXEC SQL                                                     37750000
363800         CLOSE SUB-CLS-CURR-FRCST                                 37760000
363900     END-EXEC.                                                    37770000
364000                                                                  37780000
364100     EVALUATE TRUE                                                37790000
364200         WHEN SQLCODE EQUAL ZERO                                  37800000
364300         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      37810000
364400             CONTINUE                                             37820000
364500         WHEN OTHER                                               37830000
364600             DISPLAY PV-ABEND-PARAGRAPH                           37840000
364700             PERFORM Z9900-SQL-ERROR                              37850000
364800     END-EVALUATE.                                                37860000
364900                                                                  37870000
365000***************************************************************** 37880000
365100* CALCULATE FORECAST.                                             37890000
365200***************************************************************** 37900000
365300 E5600-CALCULATE-FORECAST.                                        37910000
365400                                                                  37920000
365500     MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI                 37930000
365600     IF MRITEM-UCYCLE-CDE = 9                                     37940000
365700         MOVE MRITST-DD-FCTR    TO PV-DD-COMPUTED                 37950000
365800     ELSE                                                         37960000
365900         IF MRITEM-UCYCLE-CDE = 5                                 37970000
366000             DIVIDE MRITST-DD-FCTR      BY PC-FOUR                37980000
366100                            GIVING PV-DD-COMPUTED ROUNDED         37990000
366200         END-IF                                                   38000000
366300     END-IF.                                                      38010000
366400                                                                  38020000
366500     MULTIPLY PV-BI BY PV-DD-COMPUTED  GIVING PV-FORECAST.        38030000
366600     ADD  PV-FORECAST  TO  PT-FORECAST-AMOUNT(PV-BIM-INDEX).      38040000
366700                                                                  38050000
366800     IF PV-BIM-WEEK-INDEX = PC-52                                 38060000
366900         MOVE PC-ONE      TO PV-BIM-WEEK-INDEX                    38070000
367000     ELSE                                                         38080000
367100         ADD PC-ONE       TO PV-BIM-WEEK-INDEX                    38090000
367200     END-IF.                                                      38100000
367300                                                                  38110000
367400***************************************************************** 38120000
367500* CONTROL BREAK AT THE GROUP LEVEL                                38130000
367600***************************************************************** 38140000
367700 F0000-GROUP-BREAK.                                               38150000
367800                                                                  38160000
367900     MOVE PC-N                         TO PS-EOC-GROUP-CSR.       38170000
368000     PERFORM F0100-OPEN-GROUP-CSR.                                38180000
368100     PERFORM F0200-PROCESS-GROUP-CSR   UNTIL EOC-GROUP-CSR.       38190000
368200                                                                  38200000
368300***************************************************************** 38210000
368400*  OPEN GROUP CURSOR                                              38220000
368500***************************************************************** 38230000
368600 F0100-OPEN-GROUP-CSR.                                            38240000
368700                                                                  38250000
368800     MOVE 'F0100'                      TO PGM-LOCATION.           38260000
368900     MOVE 'F0100-OPEN-GROUP-CSR' TO PV-ABEND-PARAGRAPH.           38270000
369000                                                                  38280000
369100     EXEC SQL                                                     38290000
369200         OPEN GROUP-LEVEL                                         38300000
369300     END-EXEC.                                                    38310000
369400                                                                  38320000
369500     EVALUATE TRUE                                                38330000
369600       WHEN SQLCODE         = ZERO                                38340000
369700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    38350000
369800         CONTINUE                                                 38360000
369900       WHEN OTHER                                                 38370000
370000         DISPLAY PV-ABEND-PARAGRAPH                               38380000
370100         PERFORM Z9900-SQL-ERROR                                  38390000
370200     END-EVALUATE.                                                38400000
370300                                                                  38410000
370400***************************************************************** 38420000
370500* PROCESS GROUP CURSOR                                            38430000
370600***************************************************************** 38440000
370700 F0200-PROCESS-GROUP-CSR.                                         38450000
370800                                                                  38460000
370900     PERFORM F0300-FETCH-GROUP-CSR.                               38470000
371000     IF EOC-GROUP-CSR                                             38480000
371100         CONTINUE                                                 38490000
371200     ELSE                                                         38500000
371300         MOVE TSK-GROUP-CODE             TO  PV-HOLD-GROUP-CODE   38510000
371400         MOVE SKXREF-CLASS               TO  PV-HOLD-CLASS-NBR    38520000
371500         MOVE SKXREF-SUBCLASS            TO  PV-HOLD-SCL-NBR      38530000
371600         MOVE PC-Y                       TO  PS-PROCESS-LINE-INFO 38540000
371700         PERFORM F1000-CREATE-REPORT-LINES                        38550000
371800         IF PROCESS-LINE-INFO                                     38560000
371900             PERFORM R0000-PRINT-REPORT-LINES                     38570000
372000         END-IF                                                   38580000
372100     END-IF.                                                      38590000
372200                                                                  38600000
372300***************************************************************** 38610000
372400* FETCH GROUP CURSOR                                              38620000
372500***************************************************************** 38630000
372600  F0300-FETCH-GROUP-CSR.                                          38640000
372700                                                                  38650000
372800     MOVE 'F0300'                       TO PGM-LOCATION.          38660000
372900     MOVE 'F0300-FETCH-GROUP-CURSOR'                              38670000
373000                                        TO PV-ABEND-PARAGRAPH.    38680000
373100                                                                  38690000
373200     EXEC SQL                                                     38700000
373300       FETCH GROUP-LEVEL                                          38710000
373400        INTO                                                      38720000
373500              :SKXREF-DEPT                                        38730000
373600             ,:SKXREF-CLASS                                       38740000
373700             ,:SKXREF-SUBCLASS                                    38750000
373800             ,:TSK-GROUP-CODE                                     38760000
373900     END-EXEC.                                                    38770000
374000                                                                  38780000
374100     EVALUATE TRUE                                                38790000
374200       WHEN SQLCODE         = ZERO                                38800000
374300         CONTINUE                                                 38810000
374400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    38820000
374500         PERFORM F0400-CLOSE-GROUP-CSR                            38830000
374600         MOVE PC-Y TO PS-EOC-GROUP-CSR                            38840000
374700       WHEN OTHER                                                 38850000
374800         DISPLAY PV-ABEND-PARAGRAPH                               38860000
374900         PERFORM Z9900-SQL-ERROR                                  38870000
375000     END-EVALUATE.                                                38880000
375100                                                                  38890000
375200******************************************************************38900000
375300*  CLOSE GROUP CURSOR                                            *38910000
375400******************************************************************38920000
375500 F0400-CLOSE-GROUP-CSR.                                           38930000
375600                                                                  38940000
375700     MOVE 'F0400'                        TO PGM-LOCATION.         38950000
375800     MOVE 'F0400-CLOSE-GROUP-CSR'        TO PV-ABEND-PARAGRAPH.   38960000
375900                                                                  38970000
376000     EXEC SQL                                                     38980000
376100         CLOSE GROUP-LEVEL                                        38990000
376200     END-EXEC.                                                    39000000
376300                                                                  39010000
376400     EVALUATE TRUE                                                39020000
376500         WHEN SQLCODE EQUAL ZERO                                  39030000
376600         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      39040000
376700             CONTINUE                                             39050000
376800         WHEN OTHER                                               39060000
376900             DISPLAY PV-ABEND-PARAGRAPH                           39070000
377000             PERFORM Z9900-SQL-ERROR                              39080000
377100     END-EVALUATE.                                                39090000
377200                                                                  39100000
377300***************************************************************** 39110000
377400*  SET UP DATA FOR THE REPORT LINES                               39120000
377500***************************************************************** 39130000
377600 F1000-CREATE-REPORT-LINES.                                       39140000
377700                                                                  39150000
377800     MOVE ZERO                       TO PV-CUMM-SALES.            39160000
377900     PERFORM F2000-GET-HISTORY-INFO.                              39170000
378000     MOVE PV-CUMM-SALES              TO DL8-CUMM-SALES.           39180000
378100                                                                  39190000
378200     MOVE ZERO                       TO PV-CUMM-FRCST.            39200000
378300     PERFORM F3000-GET-HISTORY-FORECAST.                          39210000
378400     MOVE PV-CUMM-FRCST              TO DL7-CUMM-FRCST.           39220000
378500                                                                  39230000
378600     IF PV-HOLD-PER                                               39240000
378700         PERFORM B4000-CHECK-PERCENT-VARIANCE                     39250000
378800     END-IF.                                                      39260000
378900                                                                  39270000
379000                                                                  39280000
379100     IF PROCESS-LINE-INFO                                         39290000
379200         PERFORM F4000-GET-CURRENT-INFO                           39300000
379300         PERFORM F5000-GET-CURRENT-FORECAST                       39310000
379400         PERFORM B3000-CALCULATE-WEEKS-SUPPLY                     39320000
379500     END-IF.                                                      39330000
379600                                                                  39340000
379700     IF PROCESS-LINE-INFO                                         39350000
379800         PERFORM B4100-CALCULATE-CUMM-PCNT                        39360000
379900         PERFORM B4200-CALCULATE-CSTOCK-PERCENT                   39370000
380000     END-IF.                                                      39380000
380100                                                                  39390000
380200                                                                  39400000
380300***************************************************************** 39410000
380400*  GETS DD, MADDSS, ONHAND, AND SALES FOR PREVIOUS FOUR WEEKS     39420000
380500***************************************************************** 39430000
380600 F2000-GET-HISTORY-INFO.                                          39440000
380700                                                                  39450000
380800     PERFORM                                                      39460000
380900       VARYING PV-HIST-INDEX FROM 1 BY 1                          39470000
381000       UNTIL PV-HIST-INDEX > 4                                    39480000
381100          MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR        39490000
381200          MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK        39500000
381300          MOVE PC-N                   TO PS-EOC-HIST-CSR          39510000
381400          PERFORM F2100-FETCH-HISTORY-INFO                        39520000
381500          IF EOC-HIST-CSR                                         39530000
381600              MOVE ZEROES      TO  DL6-DD(PV-HIST-INDEX)          39540000
381700              MOVE ZEROES      TO  DL10-OH-HIST(PV-HIST-INDEX)    39550000
381800          ELSE                                                    39560000
381900              MOVE PV-DD       TO  DL6-DD(PV-HIST-INDEX)          39570000
382000              MOVE PV-ONHAND   TO  DL10-OH-HIST(PV-HIST-INDEX)    39580000
382100          END-IF                                                  39590000
382200     END-PERFORM.                                                 39600000
382300                                                                  39610000
382400     PERFORM                                                      39620000
382500       VARYING PV-HIST-INDEX FROM 1 BY 1                          39630000
382600       UNTIL PV-HIST-INDEX > 4                                    39640000
382700          MOVE PT-FSCL-DATE(PV-HIST-INDEX) TO PV-HOLD-FSCL-DATE   39650000
382800          MOVE PC-N                        TO PS-EOC-SLS-HIST-CSR 39660000
139600          COMPUTE PV-DATE-INDEX =                                 39670000
139600             (PV-HIST-INDEX * PC-SEVEN) - PC-SIX                  39680000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE1    39690000
                ADD PC-ONE TO PV-DATE-INDEX                             39700000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE2    39710000
                ADD PC-ONE TO PV-DATE-INDEX                             39720000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE3    39730000
                ADD PC-ONE TO PV-DATE-INDEX                             39740000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE4    39750000
                ADD PC-ONE TO PV-DATE-INDEX                             39760000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE5    39770000
                ADD PC-ONE TO PV-DATE-INDEX                             39780000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE6    39790000
                ADD PC-ONE TO PV-DATE-INDEX                             39800000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE7    39810000
382900          PERFORM F2300-FETCH-HIST-SLS-INFO                       39820000
383000          IF EOC-SLS-HIST-CSR                                     39830000
383100              MOVE ZEROES      TO  DL8-SALES(PV-HIST-INDEX)       39840000
383200          ELSE                                                    39850000
383300              MOVE PV-SALES    TO  DL8-SALES(PV-HIST-INDEX)       39860000
383400              ADD  PV-SALES    TO  PV-CUMM-SALES                  39870000
383500          END-IF                                                  39880000
383600     END-PERFORM.                                                 39890000
383700                                                                  39900000
383800***************************************************************** 39910000
383900*  FETCHS DD, MADDSS, AND ONHAND FOUR THE 4 PREVIOUS WEEKS.       39920000
384000***************************************************************** 39930000
384100 F2100-FETCH-HISTORY-INFO.                                        39940000
384200                                                                  39950000
384300     MOVE 'F2100'                       TO PGM-LOCATION.          39960000
384400     MOVE 'F2100-FETCH-HISTORY-INFO'    TO PV-ABEND-PARAGRAPH.    39970000
384500                                                                  39980000
384600     EXEC SQL                                                     39990000
384700          SELECT                                                  40000000
384800                  COALESCE(SUM(C.OH_HIST_QTY),0)                  40010000
384900                , COALESCE(SUM(C.DSD_HIST_QTY),0)                 40020000
385000                , COALESCE(SUM(C.MAD_HIST_QTY),0)                 40030000
385100          INTO                                                    40040000
385200                :PV-ONHAND                                        40050000
385300               ,:PV-DD                                            40060000
385400               ,:PV-MADDSS                                        40070000
385500          FROM   TSK         A                                    40080000
385600                ,TMRITEM     B                                    40090000
385700                ,TMRISHS     C                                    40100000
385800                ,TMRITST     D                                    40110000
385900                ,XMT_LOC     G                                    40120000
386000                ,TSKXREF     X                                    40130000
386100          WHERE A.ITEM_NMBR         = B.ITEM_NBR                  40140000
386200            AND A.ITEM_NMBR         = C.ITM_NBR                   40150000
386300            AND A.ITEM_NMBR         = D.ITEM_NBR                  40160000
386400            AND A.ITEM_NMBR         = X.ITM_NBR                   40170000
386500            AND C.STR_NBR           = D.STR_NBR                   40180000
386600            AND C.STR_NBR           > 0                           40190000
386700            AND D.FT_CDE            = 'O'                         40200000
386800            AND D.STR_NBR           = G.LOC_NBR                   40210000
386900            AND G.E_BUS_IND         = 'N'                         40220000
387100            AND ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)         40230000
387200            OR  (RT_NBR > 4                                       40240000
387300            AND RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)           40250000
387400            AND RT_DAY_NBR <> 0))                                 40260000
387500            AND C.YR_NBR            = :PV-HOLD-YEAR               40270000
387600            AND C.WK_NBR            = :PV-HOLD-WEEK               40280000
387700            AND X.DEPT              = :PV-HOLD-DEPT-NBR           40290000
387800            AND X.CLASS             = :PV-HOLD-CLASS-NBR          40300000
387900            AND X.SUBCLASS          = :PV-HOLD-SCL-NBR            40310000
388000            AND A.GROUP_CODE        = :PV-HOLD-GROUP-CODE         40320000
388100            AND C.ITM_REV_ID        = (SELECT MAX (E.ITM_REV_ID)  40330000
388200                  FROM TMRISHS  E                                 40340000
388300              WHERE                                               40350000
388400                    E.ITM_NBR       = C.ITM_NBR                   40360000
388500                AND E.STR_NBR       = C.STR_NBR                   40370000
388600                AND E.YR_NBR        = :PV-HOLD-YEAR               40380000
388700                AND E.WK_NBR        = :PV-HOLD-WEEK)              40390000
064400            WITH UR                                               40400000
388800     END-EXEC.                                                    40410000
388900                                                                  40420000
389000     EVALUATE TRUE                                                40430000
389100       WHEN SQLCODE         = ZERO                                40440000
389200         CONTINUE                                                 40450000
389300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    40460000
389400         MOVE PC-Y TO PS-EOC-HIST-CSR                             40470000
389500       WHEN OTHER                                                 40480000
389600         DISPLAY PV-ABEND-PARAGRAPH                               40490000
389700         PERFORM Z9900-SQL-ERROR                                  40500000
389800     END-EVALUATE.                                                40510000
389900                                                                  40520000
390000***************************************************************** 40530000
390100* FETCHS SALES FOR 4 PREVIOUS WEEKS.                              40540000
390200***************************************************************** 40550000
390300 F2300-FETCH-HIST-SLS-INFO.                                       40560000
390400                                                                  40570000
390500     MOVE 'F2300'                       TO PGM-LOCATION.          40580000
390600     MOVE 'F2300-FETCH-HIST-SLS-INFO'   TO PV-ABEND-PARAGRAPH.    40590000
390700                                                                  40600000
390800     EXEC SQL                                                     40610000
390900          SELECT                                                  40620000
391000                  COALESCE(SUM(C.SLS_UNT_QTY),0)                  40630000
391100          INTO                                                    40640000
391200                :PV-SALES                                         40650000
391300          FROM   TSK         A                                    40660000
391400                ,TMRITEM     B                                    40670000
391500                ,MHT_DLY_SLS C                                    40680000
391600                ,TMRITST     D                                    40690000
391700                ,XMT_LOC     G                                    40700000
391800                ,TSKXREF     X                                    40710000
391900          WHERE  A.ITEM_NMBR        = B.ITEM_NBR                  40720000
392100            AND  A.ITEM_NMBR        = D.ITEM_NBR                  40730000
392200            AND  A.ITEM_NMBR        = X.ITM_NBR                   40740000
457000            AND  X.SKU               = C.SKU_NBR                  40750000
392300            AND  D.FT_CDE           = 'O'                         40760000
392400            AND  D.STR_NBR          = C.STR_NBR                   40770000
392500            AND  C.STR_NBR          > 0                           40780000
392600            AND  D.STR_NBR           = G.LOC_NBR                  40790000
392700            AND  G.E_BUS_IND         = 'N'                        40800000
392900            AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)        40810000
393000            OR   (RT_NBR > 4                                      40820000
393100            AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)          40830000
393200            AND  RT_DAY_NBR <> 0))                                40840000
393300            AND  X.DEPT             = :PV-HOLD-DEPT-NBR           40850000
393400            AND  X.CLASS            = :PV-HOLD-CLASS-NBR          40860000
393500            AND  X.SUBCLASS         = :PV-HOLD-SCL-NBR            40870000
393600            AND  A.GROUP_CODE       = :PV-HOLD-GROUP-CODE         40880000
458500            AND  C.PRCG_DTE BETWEEN :PV-FSCL-VAR-DATE1 AND        40890000
                                      :PV-FSCL-VAR-DATE7                40900000
393800            AND C.SKU_STAT_CDE IN ('10', '20', '40')              40910000
064400            WITH UR                                               40920000
393900     END-EXEC.                                                    40930000
394000                                                                  40940000
394100     EVALUATE TRUE                                                40950000
394200       WHEN SQLCODE         = ZERO                                40960000
394300         CONTINUE                                                 40970000
394400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    40980000
394500         MOVE PC-Y TO PS-EOC-SLS-HIST-CSR                         40990000
394600       WHEN OTHER                                                 41000000
394700         DISPLAY PV-ABEND-PARAGRAPH                               41010000
394800         PERFORM Z9900-SQL-ERROR                                  41020000
394900     END-EVALUATE.                                                41030000
395000                                                                  41040000
395100***************************************************************** 41050000
395200* CALCULATES FORECAST FOR LAST 4 WEEKS                            41060000
395300***************************************************************** 41070000
395400 F3000-GET-HISTORY-FORECAST.                                      41080000
395500                                                                  41090000
395600     PERFORM                                                      41100000
395700       VARYING PV-HIST-INDEX FROM 1 BY 1                          41110000
395800       UNTIL PV-HIST-INDEX > 4                                    41120000
395900        MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR          41130000
396000        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK          41140000
396100        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-BIM-WEEK-INDEX     41150000
396200        MOVE PC-N TO PS-EOC-H-FRCST-CSR                           41160000
396300        PERFORM F3100-OPEN-HIST-FRCST-CSR                         41170000
396400        MOVE ZERO                        TO PV-TOTAL-FORECAST     41180000
396500        PERFORM F3200-LOOP-THRU-CSR                               41190000
396600                    UNTIL EOC-H-FRCST-CSR                         41200000
396700        MOVE PV-TOTAL-FORECAST                                    41210000
396800                                 TO DL7-HIST-FRCST(PV-HIST-INDEX) 41220000
396900        ADD  PV-TOTAL-FORECAST   TO PV-CUMM-FRCST                 41230000
397000     END-PERFORM.                                                 41240000
397100                                                                  41250000
397200     PERFORM F3500-CALCULATE-FRCST-PERCENT                        41260000
397300       VARYING PV-HIST-INDEX FROM 1 BY 1                          41270000
397400       UNTIL PV-HIST-INDEX > 4.                                   41280000
397500                                                                  41290000
397600***************************************************************** 41300000
397700* OPEN GROUP-HIST-FRCST CURSOR                                    41310000
397800***************************************************************** 41320000
397900 F3100-OPEN-HIST-FRCST-CSR.                                       41330000
398000                                                                  41340000
398100     MOVE 'F3100'                    TO PGM-LOCATION.             41350000
398200     MOVE 'F3100-OPEN-HIST-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      41360000
398300                                                                  41370000
398400     EXEC SQL                                                     41380000
398500         OPEN GROUP-HIST-FRCST                                    41390000
398600     END-EXEC.                                                    41400000
398700                                                                  41410000
398800     EVALUATE TRUE                                                41420000
398900       WHEN SQLCODE         = ZERO                                41430000
399000       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    41440000
399100         CONTINUE                                                 41450000
399200       WHEN OTHER                                                 41460000
399300         DISPLAY PV-ABEND-PARAGRAPH                               41470000
399400         PERFORM Z9900-SQL-ERROR                                  41480000
399500     END-EVALUATE.                                                41490000
399600                                                                  41500000
399700***************************************************************** 41510000
399800* LOOP THRU HIST-FRCST CURSOR AND CALCULATES AND ADDS FORECAST    41520000
399900* TO TOTAL                                                        41530000
400000***************************************************************** 41540000
400100 F3200-LOOP-THRU-CSR.                                             41550000
400200                                                                  41560000
400300     PERFORM F3300-FETCH-HIST-FRCST-CSR.                          41570000
400400     IF EOC-H-FRCST-CSR                                           41580000
400500         CONTINUE                                                 41590000
400600     ELSE                                                         41600000
400700         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                41610000
400800         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      41620000
400900         PERFORM B2000-READ-BIM-FILE                              41630000
401000         IF BIM-RECORD-FOUND                                      41640000
401100             MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI         41650000
401200             IF MRITEM-UCYCLE-CDE = 9                             41660000
401300                 MOVE MRISHS-DSD-HIST-QTY TO PV-DD-COMPUTED       41670000
401400             ELSE                                                 41680000
401500                 IF MRITEM-UCYCLE-CDE = 5                         41690000
401600                     DIVIDE MRISHS-DSD-HIST-QTY BY PC-FOUR        41700000
401700                                     GIVING PV-DD-COMPUTED ROUNDED41710000
401800                 END-IF                                           41720000
401900             END-IF                                               41730000
402000             MULTIPLY PV-BI BY PV-DD-COMPUTED                     41740000
402100                                            GIVING PV-FORECAST    41750000
402200             ADD PV-FORECAST TO PV-TOTAL-FORECAST                 41760000
402300         END-IF                                                   41770000
402400     END-IF.                                                      41780000
402500                                                                  41790000
402600***************************************************************** 41800000
402700* FETCH GROUP-HIST-FRCST CURSOR - GETS DD AND PTAG TO READ BIM    41810000
402800* FILE                                                            41820000
402900***************************************************************** 41830000
403000 F3300-FETCH-HIST-FRCST-CSR.                                      41840000
403100                                                                  41850000
403200     MOVE 'F3300'                       TO PGM-LOCATION.          41860000
403300     MOVE 'F3300-FETCH-HIST-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    41870000
403400                                                                  41880000
403500     EXEC SQL                                                     41890000
403600       FETCH GROUP-HIST-FRCST                                     41900000
403700        INTO                                                      41910000
403800              :MRITEM-UCYCLE-CDE,                                 41920000
403900              :MRISHS-DSD-HIST-QTY,                               41930000
404000              :MRITST-PTAG-ID                                     41940000
404100     END-EXEC.                                                    41950000
404200                                                                  41960000
404300     EVALUATE TRUE                                                41970000
404400       WHEN SQLCODE         = ZERO                                41980000
404500         CONTINUE                                                 41990000
404600       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    42000000
404700         PERFORM F3400-CLOSE-FRCST-LEVEL-CSR                      42010000
404800         MOVE PC-Y TO PS-EOC-H-FRCST-CSR                          42020000
404900       WHEN OTHER                                                 42030000
405000         DISPLAY PV-ABEND-PARAGRAPH                               42040000
405100         PERFORM Z9900-SQL-ERROR                                  42050000
405200     END-EVALUATE.                                                42060000
405300                                                                  42070000
405400******************************************************************42080000
405500*  CLOSE GROUP-HIST-FRCST CURSOR                               *  42090000
405600******************************************************************42100000
405700 F3400-CLOSE-FRCST-LEVEL-CSR.                                     42110000
405800                                                                  42120000
405900     MOVE 'F3400'                        TO PGM-LOCATION.         42130000
406000     MOVE 'F3400-CLOSE-FRCST-LEVEL-CSR'  TO PV-ABEND-PARAGRAPH.   42140000
406100                                                                  42150000
406200     EXEC SQL                                                     42160000
406300         CLOSE GROUP-HIST-FRCST                                   42170000
406400     END-EXEC.                                                    42180000
406500                                                                  42190000
406600     EVALUATE TRUE                                                42200000
406700         WHEN SQLCODE EQUAL ZERO                                  42210000
406800         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      42220000
406900             CONTINUE                                             42230000
407000         WHEN OTHER                                               42240000
407100             DISPLAY PV-ABEND-PARAGRAPH                           42250000
407200             PERFORM Z9900-SQL-ERROR                              42260000
407300     END-EVALUATE.                                                42270000
407400                                                                  42280000
407500***************************************************************** 42290000
407600* CALCULATES PERCENT DIFFERENCE BETWEEN WHAT WAS FORECAST AND     42300000
407700* WHAT WAS SOLD.                                                  42310000
407800***************************************************************** 42320000
407900 F3500-CALCULATE-FRCST-PERCENT.                                   42330000
408000                                                                  42340000
408100     MOVE DL7-HIST-FRCST(PV-HIST-INDEX)   TO PV-FORECAST.         42350000
408200     MOVE DL8-SALES(PV-HIST-INDEX)        TO PV-SALES.            42360000
408300                                                                  42370000
408400     IF  PV-FORECAST = 0                                          42380000
408500         MOVE '***'          TO  DL9-DIFFRNC(PV-HIST-INDEX)       42390000
408600     ELSE                                                         42400000
408700         IF (PV-FORECAST = 0) OR (PV-SALES  = 0)                  42410000
408800             MOVE 0          TO  DL9-DIFFRNC-N(PV-HIST-INDEX)     42420000
408900         ELSE                                                     42430000
409000             COMPUTE PV-FRCST-PERCENT ROUNDED =                   42440000
409100                  (PV-SALES - PV-FORECAST) / PV-FORECAST * 100    42450000
409200             MOVE PV-FRCST-PERCENT                                42460000
409300                         TO DL9-DIFFRNC-N(PV-HIST-INDEX)          42470000
409400         END-IF                                                   42480000
409500     END-IF.                                                      42490000
409600                                                                  42500000
409700***************************************************************** 42510000
409800* GETS ONORDER, ONHAND, DD, CSTOCK, AVG OSTRAT, AND MAXIMUM LEAD  42520000
409900* TIME.                                                           42530000
410000***************************************************************** 42540000
410100 F4000-GET-CURRENT-INFO.                                          42550000
410200                                                                  42560000
410300     MOVE PC-N TO PS-EOC-CURR-CSR                                 42570000
410400     PERFORM F4100-FETCH-CURRENT-INFO.                            42580000
410500     IF EOC-CURR-CSR                                              42590000
410600         MOVE ZEROES           TO  DL3-ONORDER                    42600000
410700         MOVE ZEROES           TO  DL10-ONHAND                    42610000
410800         MOVE ZEROES           TO  DL6-DD-CURR                    42620000
410900         MOVE ZEROES           TO  DL11-CSTOCK                    42630000
411000         MOVE ZEROES           TO  DL2-AVG-OSTRAT                 42640000
411100         MOVE ZEROES           TO  DL2-LEAD-TIME                  42650000
411200     ELSE                                                         42660000
411300         MOVE PV-ON-ORDER      TO  DL3-ONORDER                    42670000
411400         MOVE PV-ONHAND        TO  DL10-ONHAND                    42680000
411500         MOVE PV-DD            TO  DL6-DD-CURR                    42690000
411600         MOVE PV-CSTOCK        TO  DL11-CSTOCK                    42700000
411700         MOVE PV-OSTRAT        TO  DL2-AVG-OSTRAT                 42710000
411800         MOVE PV-LT            TO  DL2-LEAD-TIME                  42720000
411900     END-IF.                                                      42730000
412000                                                                  42740000
412100***************************************************************** 42750000
412200* FETCH CURRENT INFO FOR DD, ONHAND, CSTOCK, ONORDER, AVG OSTRAT  42760000
412300* AND MAXIMUM LEAD TIME                                           42770000
412400***************************************************************** 42780000
412500 F4100-FETCH-CURRENT-INFO.                                        42790000
412600                                                                  42800000
412700     MOVE 'F4100'                       TO PGM-LOCATION.          42810000
412800     MOVE 'F4100-FETCH-CURRENT-INFO'    TO PV-ABEND-PARAGRAPH.    42820000
412900                                                                  42830000
413000     EXEC SQL                                                     42840000
413100          SELECT                                                  42850000
413200                  COALESCE(SUM(D.DD_FCTR),0)                      42860000
413300                , COALESCE(SUM(F.ONHAND_QTY),0)                   42870000
413400                , COALESCE(SUM(D.CSTOCK_QTY),0)                   42880000
413500                , COALESCE(SUM(D.ON_ORDER_QTY),0)                 42890000
413600                , COALESCE(AVG(D.OSTRAT_QTY),0)                   42900000
413700                , COALESCE(MAX(LT_QTY),0)                         42910000
413800          INTO  :PV-DD                                            42920000
413900               ,:PV-ONHAND                                        42930000
414000               ,:PV-CSTOCK                                        42940000
414100               ,:PV-ON-ORDER                                      42950000
414200               ,:PV-OSTRAT                                        42960000
414300               ,:PV-LT                                            42970000
414400          FROM   TSK         A                                    42980000
414500                ,TMRITEM     B                                    42990000
414600                ,TMRITST     D                                    43000000
414700                ,TSKST       F                                    43010000
414800                ,XMT_LOC     G                                    43020000
414900                ,TSKXREF     X                                    43030000
415000          WHERE  A.ITEM_NMBR          = B.ITEM_NBR                43040000
415100            AND  A.ITEM_NMBR          = D.ITEM_NBR                43050000
415200            AND  A.ITEM_NMBR          = F.ITEM_NMBR               43060000
415300            AND  A.ITEM_NMBR          = X.ITM_NBR                 43070000
415400            AND  D.STR_NBR            = F.LOC_NBR                 43080000
415500            AND  D.STR_NBR            > 0                         43090000
415600            AND  D.FT_CDE             = 'O'                       43100000
415700            AND  D.STR_NBR            = G.LOC_NBR                 43110000
415800            AND  G.E_BUS_IND          = 'N'                       43120000
416000            AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)        43130000
416100            OR   (RT_NBR > 4                                      43140000
416200            AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)          43150000
416300            AND  RT_DAY_NBR <> 0))                                43160000
416400            AND  X.DEPT               = :PV-HOLD-DEPT-NBR         43170000
416500            AND  X.CLASS              = :PV-HOLD-CLASS-NBR        43180000
416600            AND  X.SUBCLASS           = :PV-HOLD-SCL-NBR          43190000
416700            AND  A.GROUP_CODE         = :PV-HOLD-GROUP-CODE       43200000
064400            WITH UR                                               43210000
416800     END-EXEC.                                                    43220000
416900                                                                  43230000
417000     EVALUATE TRUE                                                43240000
417100       WHEN SQLCODE         = ZERO                                43250000
417200         CONTINUE                                                 43260000
417300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    43270000
417400         MOVE PC-Y TO PS-EOC-CURR-CSR                             43280000
417500       WHEN OTHER                                                 43290000
417600         DISPLAY PV-ABEND-PARAGRAPH                               43300000
417700         PERFORM Z9900-SQL-ERROR                                  43310000
417800     END-EVALUATE.                                                43320000
417900                                                                  43330000
418000***************************************************************** 43340000
418100* GETS CURRENT FORECAST AND CALCULATES AND STORES THE FORECAST    43350000
418200* FOR THE NEXT 52 WEEKS.                                          43360000
418300***************************************************************** 43370000
418400 F5000-GET-CURRENT-FORECAST.                                      43380000
418500                                                                  43390000
418600        PERFORM F5100-INITIALZE-TABLE.                            43400000
418700        MOVE PC-N TO PS-EOC-C-FRCST-CSR                           43410000
418800        PERFORM F5200-OPEN-CURR-FRCST-CSR.                        43420000
418900        PERFORM F5300-LOOP-THRU-CURR-CSR UNTIL EOC-C-FRCST-CSR.   43430000
419000        MOVE PT-FORECAST-AMOUNT(PC-ONE)                           43440000
419100                                    TO DL7-CURRENT-FRCST.         43450000
419200        MOVE PT-FORECAST-AMOUNT(PC-TWO)                           43460000
419300                            TO DL7-FUTURE-FRCST(PC-ONE).          43470000
419400        MOVE PT-FORECAST-AMOUNT(PC-THREE)                         43480000
419500                            TO DL7-FUTURE-FRCST(PC-TWO).          43490000
419600        MOVE PT-FORECAST-AMOUNT(PC-FOUR)                          43500000
419700                            TO DL7-FUTURE-FRCST(PC-THREE).        43510000
419800        MOVE PT-FORECAST-AMOUNT(PC-FIVE)                          43520000
419900                            TO DL7-FUTURE-FRCST(PC-FOUR).         43530000
420000        MOVE PT-FORECAST-AMOUNT(PC-SIX)                           43540000
420100                            TO DL7-FUTURE-FRCST(PC-FIVE).         43550000
420200                                                                  43560000
420300***************************************************************** 43570000
420400* INITIALZE FORECAST TABLE.                                       43580000
420500***************************************************************** 43590000
420600 F5100-INITIALZE-TABLE.                                           43600000
420700                                                                  43610000
420800        MOVE PC-ONE      TO PV-BIM-INDEX.                         43620000
420900        PERFORM UNTIL PV-BIM-INDEX > PC-52                        43630000
421000            MOVE ZEROES  TO PT-FORECAST-AMOUNT(PV-BIM-INDEX)      43640000
421100            ADD PC-ONE   TO PV-BIM-INDEX                          43650000
421200        END-PERFORM.                                              43660000
421300                                                                  43670000
421400                                                                  43680000
421500***************************************************************** 43690000
421600* OPEN GROUP-CURR-FRCST CURSOR                                    43700000
421700***************************************************************** 43710000
421800 F5200-OPEN-CURR-FRCST-CSR.                                       43720000
421900                                                                  43730000
422000     MOVE 'F5200'                    TO PGM-LOCATION.             43740000
422100     MOVE 'F5200-OPEN-CURR-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      43750000
422200                                                                  43760000
422300     EXEC SQL                                                     43770000
422400         OPEN GROUP-CURR-FRCST                                    43780000
422500     END-EXEC.                                                    43790000
422600                                                                  43800000
422700     EVALUATE TRUE                                                43810000
422800       WHEN SQLCODE         = ZERO                                43820000
422900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    43830000
423000         CONTINUE                                                 43840000
423100       WHEN OTHER                                                 43850000
423200         DISPLAY PV-ABEND-PARAGRAPH                               43860000
423300         PERFORM Z9900-SQL-ERROR                                  43870000
423400     END-EVALUATE.                                                43880000
423500                                                                  43890000
423600***************************************************************** 43900000
423700* LOOP THRU GROUP-CURR-FRCST CURSOR AND CALCULATE FORECASTS.      43910000
423800***************************************************************** 43920000
423900 F5300-LOOP-THRU-CURR-CSR.                                        43930000
424000                                                                  43940000
424100     PERFORM F5400-FETCH-CURR-FRCST-CSR.                          43950000
424200     IF EOC-C-FRCST-CSR                                           43960000
424300         CONTINUE                                                 43970000
424400     ELSE                                                         43980000
424500         MOVE PV-CURR-WEEK         TO PV-BIM-WEEK-INDEX           43990000
424600         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                44000000
424700         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      44010000
424800         PERFORM B2000-READ-BIM-FILE                              44020000
424900         IF BIM-RECORD-FOUND                                      44030000
425000             PERFORM F5600-CALCULATE-FORECAST                     44040000
425100                 VARYING PV-BIM-INDEX  FROM 1 BY 1                44050000
425200                 UNTIL PV-BIM-INDEX GREATER THAN PC-52            44060000
425300         END-IF                                                   44070000
425400     END-IF.                                                      44080000
425500                                                                  44090000
425600***************************************************************** 44100000
425700* FETCH GROUP-CURR-FRCST CURSOR                                   44110000
425800***************************************************************** 44120000
425900 F5400-FETCH-CURR-FRCST-CSR.                                      44130000
426000                                                                  44140000
426100     MOVE 'F5400'                       TO PGM-LOCATION.          44150000
426200     MOVE 'F5400-FETCH-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    44160000
426300                                                                  44170000
426400     EXEC SQL                                                     44180000
426500       FETCH GROUP-CURR-FRCST                                     44190000
426600        INTO                                                      44200000
426700              :MRITEM-UCYCLE-CDE,                                 44210000
426800              :MRITST-DD-FCTR,                                    44220000
426900              :MRITST-PTAG-ID                                     44230000
427000     END-EXEC.                                                    44240000
427100                                                                  44250000
427200     EVALUATE TRUE                                                44260000
427300       WHEN SQLCODE         = ZERO                                44270000
427400         CONTINUE                                                 44280000
427500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    44290000
427600         PERFORM F5500-CLOSE-CURR-FRCST-CSR                       44300000
427700         MOVE PC-Y TO PS-EOC-C-FRCST-CSR                          44310000
427800       WHEN OTHER                                                 44320000
427900         DISPLAY PV-ABEND-PARAGRAPH                               44330000
428000         PERFORM Z9900-SQL-ERROR                                  44340000
428100     END-EVALUATE.                                                44350000
428200                                                                  44360000
428300******************************************************************44370000
428400* CLOSE GROUP-CURR-FRCST CURSOR                                  *44380000
428500******************************************************************44390000
428600 F5500-CLOSE-CURR-FRCST-CSR.                                      44400000
428700                                                                  44410000
428800     MOVE 'F5500'                       TO PGM-LOCATION.          44420000
428900     MOVE 'F5500-CLOSE-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    44430000
429000                                                                  44440000
429100     EXEC SQL                                                     44450000
429200         CLOSE GROUP-CURR-FRCST                                   44460000
429300     END-EXEC.                                                    44470000
429400                                                                  44480000
429500     EVALUATE TRUE                                                44490000
429600         WHEN SQLCODE EQUAL ZERO                                  44500000
429700         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      44510000
429800             CONTINUE                                             44520000
429900         WHEN OTHER                                               44530000
430000             DISPLAY PV-ABEND-PARAGRAPH                           44540000
430100             PERFORM Z9900-SQL-ERROR                              44550000
430200     END-EVALUATE.                                                44560000
430300                                                                  44570000
430400***************************************************************** 44580000
430500* CALCULATE FORECAST.                                             44590000
430600***************************************************************** 44600000
430700 F5600-CALCULATE-FORECAST.                                        44610000
430800                                                                  44620000
430900     MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI                 44630000
431000     IF MRITEM-UCYCLE-CDE = 9                                     44640000
431100         MOVE MRITST-DD-FCTR      TO PV-DD-COMPUTED               44650000
431200     ELSE                                                         44660000
431300         IF MRITEM-UCYCLE-CDE = 5                                 44670000
431400             DIVIDE MRITST-DD-FCTR      BY PC-FOUR                44680000
431500                             GIVING PV-DD-COMPUTED ROUNDED        44690000
431600         END-IF                                                   44700000
431700     END-IF.                                                      44710000
431800                                                                  44720000
431900     MULTIPLY PV-BI BY PV-DD-COMPUTED  GIVING PV-FORECAST.        44730000
432000     ADD  PV-FORECAST  TO  PT-FORECAST-AMOUNT(PV-BIM-INDEX)       44740000
432100                                                                  44750000
432200     IF PV-BIM-WEEK-INDEX = PC-52                                 44760000
432300         MOVE PC-ONE      TO PV-BIM-WEEK-INDEX                    44770000
432400     ELSE                                                         44780000
432500         ADD PC-ONE       TO PV-BIM-WEEK-INDEX                    44790000
432600     END-IF.                                                      44800000
432700                                                                  44810000
432800***************************************************************** 44820000
432900* CONTROL BREAK AT THE COLOR VENDOR LEVEL                         44830000
433000***************************************************************** 44840000
433100 G0000-VENDOR-BREAK.                                              44850000
433200                                                                  44860000
433300     MOVE PC-N                         TO PS-EOC-VENDOR-CSR.      44870000
433400     PERFORM G0100-OPEN-VENDOR-CSR.                               44880000
433500     PERFORM G0200-PROCESS-VENDOR-CSR  UNTIL EOC-VENDOR-CSR.      44890000
433600                                                                  44900000
433700***************************************************************** 44910000
433800*  OPEN VENDOR CURSOR                                             44920000
433900***************************************************************** 44930000
434000 G0100-OPEN-VENDOR-CSR.                                           44940000
434100                                                                  44950000
434200     MOVE 'G0100'                      TO PGM-LOCATION.           44960000
434300     MOVE 'G0100-OPEN-VENDOR-CSR' TO PV-ABEND-PARAGRAPH.          44970000
434400                                                                  44980000
434500     EXEC SQL                                                     44990000
434600         OPEN VENDOR-LEVEL                                        45000000
434700     END-EXEC.                                                    45010000
434800                                                                  45020000
434900     EVALUATE TRUE                                                45030000
435000       WHEN SQLCODE         = ZERO                                45040000
435100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    45050000
435200         CONTINUE                                                 45060000
435300       WHEN OTHER                                                 45070000
435400         DISPLAY PV-ABEND-PARAGRAPH                               45080000
435500         PERFORM Z9900-SQL-ERROR                                  45090000
435600     END-EVALUATE.                                                45100000
435700                                                                  45110000
435800***************************************************************** 45120000
435900* PROCESS VENDOR CURSOR                                           45130000
436000***************************************************************** 45140000
436100 G0200-PROCESS-VENDOR-CSR.                                        45150000
436200                                                                  45160000
436300     PERFORM G0300-FETCH-VENDOR-CSR.                              45170000
436400     IF EOC-VENDOR-CSR                                            45180000
436500         CONTINUE                                                 45190000
436600     ELSE                                                         45200000
436700         MOVE TSK-ENT-ID                 TO  PV-HOLD-VENDOR-CODE  45210000
436800         MOVE ENTNME-ENT-NAME-DESC       TO  PV-HOLD-VENDOR-NAME  45220000
436900         MOVE PC-Y                       TO  PS-PROCESS-LINE-INFO 45230000
437000         PERFORM G1000-CREATE-REPORT-LINES                        45240000
437100         IF PROCESS-LINE-INFO                                     45250000
437200             PERFORM R0000-PRINT-REPORT-LINES                     45260000
437300         END-IF                                                   45270000
437400     END-IF.                                                      45280000
437500                                                                  45290000
437600***************************************************************** 45300000
437700* FETCH VENDOR CURSOR                                             45310000
437800***************************************************************** 45320000
437900  G0300-FETCH-VENDOR-CSR.                                         45330000
438000                                                                  45340000
438100     MOVE 'G0300'                       TO PGM-LOCATION.          45350000
438200     MOVE 'G0300-FETCH-VENDOR-CSR'                                45360000
438300                                        TO PV-ABEND-PARAGRAPH.    45370000
438400                                                                  45380000
438500     EXEC SQL                                                     45390000
438600       FETCH VENDOR-LEVEL                                         45400000
438700        INTO                                                      45410000
438800              :SKXREF-DEPT                                        45420000
438900             ,:TSK-ENT-ID                                         45430000
439000             ,:ENTNME-ENT-NAME-DESC                               45440000
439100     END-EXEC.                                                    45450000
439200                                                                  45460000
439300     EVALUATE TRUE                                                45470000
439400       WHEN SQLCODE         = ZERO                                45480000
439500         CONTINUE                                                 45490000
439600       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    45500000
439700         PERFORM G0400-CLOSE-VENDOR-CSR                           45510000
439800         MOVE PC-Y TO PS-EOC-VENDOR-CSR                           45520000
439900       WHEN OTHER                                                 45530000
440000         DISPLAY PV-ABEND-PARAGRAPH                               45540000
440100         PERFORM Z9900-SQL-ERROR                                  45550000
440200     END-EVALUATE.                                                45560000
440300                                                                  45570000
440400******************************************************************45580000
440500*  CLOSE VENDOR CURSOR                                           *45590000
440600******************************************************************45600000
440700 G0400-CLOSE-VENDOR-CSR.                                          45610000
440800                                                                  45620000
440900     MOVE 'G0400'                        TO PGM-LOCATION.         45630000
441000     MOVE 'G0400-CLOSE-VENDOR-CSR'       TO PV-ABEND-PARAGRAPH.   45640000
441100                                                                  45650000
441200     EXEC SQL                                                     45660000
441300         CLOSE VENDOR-LEVEL                                       45670000
441400     END-EXEC.                                                    45680000
441500                                                                  45690000
441600     EVALUATE TRUE                                                45700000
441700         WHEN SQLCODE EQUAL ZERO                                  45710000
441800         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      45720000
441900             CONTINUE                                             45730000
442000         WHEN OTHER                                               45740000
442100             DISPLAY PV-ABEND-PARAGRAPH                           45750000
442200             PERFORM Z9900-SQL-ERROR                              45760000
442300     END-EVALUATE.                                                45770000
442400                                                                  45780000
442500***************************************************************** 45790000
442600*  SET UP DATA FOR THE REPORT LINES                               45800000
442700***************************************************************** 45810000
442800 G1000-CREATE-REPORT-LINES.                                       45820000
442900                                                                  45830000
443000     MOVE ZERO                       TO PV-CUMM-SALES.            45840000
443100     PERFORM G2000-GET-HISTORY-INFO.                              45850000
443200     MOVE PV-CUMM-SALES              TO DL8-CUMM-SALES.           45860000
443300                                                                  45870000
443400     MOVE ZERO                       TO PV-CUMM-FRCST.            45880000
443500     PERFORM G3000-GET-HISTORY-FORECAST.                          45890000
443600     MOVE PV-CUMM-FRCST              TO DL7-CUMM-FRCST.           45900000
443700                                                                  45910000
443800     IF PV-HOLD-PER                                               45920000
443900         PERFORM B4000-CHECK-PERCENT-VARIANCE                     45930000
444000     END-IF.                                                      45940000
444100                                                                  45950000
444200                                                                  45960000
444300     IF PROCESS-LINE-INFO                                         45970000
444400         PERFORM G4000-GET-CURRENT-INFO                           45980000
444500         PERFORM G5000-GET-CURRENT-FORECAST                       45990000
444600         PERFORM B3000-CALCULATE-WEEKS-SUPPLY                     46000000
444700     END-IF.                                                      46010000
444800                                                                  46020000
444900     IF PROCESS-LINE-INFO                                         46030000
445000         PERFORM B4100-CALCULATE-CUMM-PCNT                        46040000
445100         PERFORM B4200-CALCULATE-CSTOCK-PERCENT                   46050000
445200     END-IF.                                                      46060000
445300                                                                  46070000
445400                                                                  46080000
445500***************************************************************** 46090000
445600*  GETS DD, MADDSS, ONHAND, AND SALES FOR PREVIOUS FOUR WEEKS     46100000
445700***************************************************************** 46110000
445800 G2000-GET-HISTORY-INFO.                                          46120000
445900                                                                  46130000
446000     PERFORM                                                      46140000
446100       VARYING PV-HIST-INDEX FROM 1 BY 1                          46150000
446200       UNTIL PV-HIST-INDEX > 4                                    46160000
446300          MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR        46170000
446400          MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK        46180000
446500          MOVE PC-N                   TO PS-EOC-HIST-CSR          46190000
446600          PERFORM G2100-FETCH-HISTORY-INFO                        46200000
446700          IF EOC-HIST-CSR                                         46210000
446800              MOVE ZEROES      TO  DL6-DD(PV-HIST-INDEX)          46220000
446900              MOVE ZEROES      TO  DL10-OH-HIST(PV-HIST-INDEX)    46230000
447000          ELSE                                                    46240000
447100              MOVE PV-DD       TO  DL6-DD(PV-HIST-INDEX)          46250000
447200              MOVE PV-ONHAND   TO  DL10-OH-HIST(PV-HIST-INDEX)    46260000
447300          END-IF                                                  46270000
447400     END-PERFORM.                                                 46280000
447500                                                                  46290000
447600     PERFORM                                                      46300000
447700       VARYING PV-HIST-INDEX FROM 1 BY 1                          46310000
447800       UNTIL PV-HIST-INDEX > 4                                    46320000
447900          MOVE PT-FSCL-DATE(PV-HIST-INDEX) TO PV-HOLD-FSCL-DATE   46330000
448000          MOVE PC-N                        TO PS-EOC-SLS-HIST-CSR 46340000
139600          COMPUTE PV-DATE-INDEX =                                 46350000
139600             (PV-HIST-INDEX * PC-SEVEN) - PC-SIX                  46360000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE1    46370000
                ADD PC-ONE TO PV-DATE-INDEX                             46380000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE2    46390000
                ADD PC-ONE TO PV-DATE-INDEX                             46400000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE3    46410000
                ADD PC-ONE TO PV-DATE-INDEX                             46420000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE4    46430000
                ADD PC-ONE TO PV-DATE-INDEX                             46440000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE5    46450000
                ADD PC-ONE TO PV-DATE-INDEX                             46460000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE6    46470000
                ADD PC-ONE TO PV-DATE-INDEX                             46480000
                MOVE PT-FSCL-DAY(PV-DATE-INDEX) TO PV-FSCL-VAR-DATE7    46490000
448100          PERFORM G2300-FETCH-HIST-SLS-INFO                       46500000
448200          IF EOC-SLS-HIST-CSR                                     46510000
448300              MOVE ZEROES      TO  DL8-SALES(PV-HIST-INDEX)       46520000
448400          ELSE                                                    46530000
448500              MOVE PV-SALES    TO  DL8-SALES(PV-HIST-INDEX)       46540000
448600              ADD  PV-SALES    TO  PV-CUMM-SALES                  46550000
448700          END-IF                                                  46560000
448800     END-PERFORM.                                                 46570000
448900                                                                  46580000
449000***************************************************************** 46590000
449100*  FETCHS DD, MADDSS, AND ONHAND FOUR THE 4 PREVIOUS WEEKS.       46600000
449200***************************************************************** 46610000
449300 G2100-FETCH-HISTORY-INFO.                                        46620000
449400                                                                  46630000
449500     MOVE 'G2100'                       TO PGM-LOCATION.          46640000
449600     MOVE 'G2100-FETCH-HISTORY-INFO'    TO PV-ABEND-PARAGRAPH.    46650000
449700                                                                  46660000
449800     EXEC SQL                                                     46670000
449900          SELECT                                                  46680000
450000                  COALESCE(SUM(C.OH_HIST_QTY),0)                  46690000
450100                , COALESCE(SUM(C.DSD_HIST_QTY),0)                 46700000
450200                , COALESCE(SUM(C.MAD_HIST_QTY),0)                 46710000
450300          INTO                                                    46720000
450400                :PV-ONHAND                                        46730000
450500               ,:PV-DD                                            46740000
450600               ,:PV-MADDSS                                        46750000
450700          FROM   TSK         A                                    46760000
450800                ,TMRITEM     B                                    46770000
450900                ,TMRISHS     C                                    46780000
451000                ,TMRITST     D                                    46790000
451100                ,XMT_LOC     G                                    46800000
451200                ,TSKXREF     X                                    46810000
451300          WHERE  A.ITEM_NMBR         = B.ITEM_NBR                 46820000
451400            AND  A.ITEM_NMBR         = C.ITM_NBR                  46830000
451500            AND  A.ITEM_NMBR         = D.ITEM_NBR                 46840000
451600            AND  A.ITEM_NMBR         = X.ITM_NBR                  46850000
451700            AND  C.STR_NBR           = D.STR_NBR                  46860000
451800            AND  C.STR_NBR           > 0                          46870000
451900            AND  D.FT_CDE            = 'O'                        46880000
452000            AND  D.STR_NBR           = G.LOC_NBR                  46890000
452100            AND  G.E_BUS_IND         = 'N'                        46900000
452300            AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)        46910000
452400            OR   (RT_NBR > 4                                      46920000
452500            AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)          46930000
452600            AND  RT_DAY_NBR <> 0))                                46940000
452700            AND  C.YR_NBR            = :PV-HOLD-YEAR              46950000
452800            AND  C.WK_NBR            = :PV-HOLD-WEEK              46960000
452900            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          46970000
453000            AND  A.ENT_ID            = :PV-HOLD-VENDOR-CODE       46980000
453100            AND  C.ITM_REV_ID        = (SELECT MAX (E.ITM_REV_ID) 46990000
453200                  FROM TMRISHS  E                                 47000000
453300              WHERE                                               47010000
453400                    E.ITM_NBR        = C.ITM_NBR                  47020000
453500                AND E.STR_NBR        = C.STR_NBR                  47030000
453600                AND E.YR_NBR         = :PV-HOLD-YEAR              47040000
453700                AND E.WK_NBR         = :PV-HOLD-WEEK)             47050000
064400            WITH UR                                               47060000
453800     END-EXEC.                                                    47070000
453900                                                                  47080000
454000     EVALUATE TRUE                                                47090000
454100       WHEN SQLCODE         = ZERO                                47100000
454200         CONTINUE                                                 47110000
454300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    47120000
454400         MOVE PC-Y TO PS-EOC-HIST-CSR                             47130000
454500       WHEN OTHER                                                 47140000
454600         DISPLAY PV-ABEND-PARAGRAPH                               47150000
454700         PERFORM Z9900-SQL-ERROR                                  47160000
454800     END-EVALUATE.                                                47170000
454900                                                                  47180000
455000***************************************************************** 47190000
455100*  FETCHS SALES FOR 4 PREVIOUS WEEKS.                             47200000
455200***************************************************************** 47210000
455300 G2300-FETCH-HIST-SLS-INFO.                                       47220000
455400                                                                  47230000
455500     MOVE 'G2300'                       TO PGM-LOCATION.          47240000
455600     MOVE 'G2300-FETCH-HIST-SLS-INFO'   TO PV-ABEND-PARAGRAPH.    47250000
455700                                                                  47260000
455800     EXEC SQL                                                     47270000
455900          SELECT                                                  47280000
456000                  COALESCE(SUM(C.SLS_UNT_QTY),0)                  47290000
456100          INTO                                                    47300000
456200                :PV-SALES                                         47310000
456300          FROM   TSK         A                                    47320000
456400                ,TMRITEM     B                                    47330000
456500                ,MHT_DLY_SLS C                                    47340000
456600                ,TMRITST     D                                    47350000
456700                ,XMT_LOC     G                                    47360000
456800                ,TSKXREF     X                                    47370000
456900          WHERE  A.ITEM_NMBR         = B.ITEM_NBR                 47380000
457100            AND  A.ITEM_NMBR         = D.ITEM_NBR                 47390000
457200            AND  A.ITEM_NMBR         = X.ITM_NBR                  47400000
457000            AND  X.SKU               = C.SKU_NBR                  47410000
457300            AND  D.FT_CDE            = 'O'                        47420000
457400            AND  D.STR_NBR           = C.STR_NBR                  47430000
457500            AND  C.STR_NBR           > 0                          47440000
457600            AND  D.STR_NBR           = G.LOC_NBR                  47450000
457700            AND  G.E_BUS_IND         = 'N'                        47460000
457900            AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)        47470000
458000            OR   (RT_NBR > 4                                      47480000
458100            AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)          47490000
458200            AND  RT_DAY_NBR <> 0))                                47500000
458300            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          47510000
458400            AND  A.ENT_ID            = :PV-HOLD-VENDOR-CODE       47520000
458500            AND  C.PRCG_DTE BETWEEN :PV-FSCL-VAR-DATE1 AND        47530000
                                      :PV-FSCL-VAR-DATE7                47540000
458600            AND C.SKU_STAT_CDE IN ('10', '20', '40')              47550000
064400            WITH UR                                               47560000
458700     END-EXEC.                                                    47570000
458800                                                                  47580000
458900     EVALUATE TRUE                                                47590000
459000       WHEN SQLCODE         = ZERO                                47600000
459100         CONTINUE                                                 47610000
459200       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    47620000
459300         MOVE PC-Y TO PS-EOC-SLS-HIST-CSR                         47630000
459400       WHEN OTHER                                                 47640000
459500         DISPLAY PV-ABEND-PARAGRAPH                               47650000
459600         PERFORM Z9900-SQL-ERROR                                  47660000
459700     END-EVALUATE.                                                47670000
459800                                                                  47680000
459900***************************************************************** 47690000
460000* CALCULATES FORECAST FOR LAST 4 WEEKS                            47700000
460100***************************************************************** 47710000
460200 G3000-GET-HISTORY-FORECAST.                                      47720000
460300                                                                  47730000
460400     PERFORM                                                      47740000
460500       VARYING PV-HIST-INDEX FROM 1 BY 1                          47750000
460600       UNTIL PV-HIST-INDEX > 4                                    47760000
460700        MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR          47770000
460800        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK          47780000
460900        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-BIM-WEEK-INDEX     47790000
461000        MOVE PC-N TO PS-EOC-H-FRCST-CSR                           47800000
461100        PERFORM G3100-OPEN-HIST-FRCST-CSR                         47810000
461200        MOVE ZERO                        TO PV-TOTAL-FORECAST     47820000
461300        PERFORM G3200-LOOP-THRU-CSR                               47830000
461400                    UNTIL EOC-H-FRCST-CSR                         47840000
461500        MOVE PV-TOTAL-FORECAST                                    47850000
461600                                 TO DL7-HIST-FRCST(PV-HIST-INDEX) 47860000
461700        ADD  PV-TOTAL-FORECAST   TO PV-CUMM-FRCST                 47870000
461800     END-PERFORM.                                                 47880000
461900                                                                  47890000
462000     PERFORM G3500-CALCULATE-FRCST-PERCENT                        47900000
462100       VARYING PV-HIST-INDEX FROM 1 BY 1                          47910000
462200       UNTIL PV-HIST-INDEX > 4.                                   47920000
462300                                                                  47930000
462400***************************************************************** 47940000
462500* OPEN VENDOR-HIST-FRCST CURSOR                                   47950000
462600***************************************************************** 47960000
462700 G3100-OPEN-HIST-FRCST-CSR.                                       47970000
462800                                                                  47980000
462900     MOVE 'G3100'                    TO PGM-LOCATION.             47990000
463000     MOVE 'G3100-OPEN-HIST-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      48000000
463100                                                                  48010000
463200     EXEC SQL                                                     48020000
463300         OPEN VENDOR-HIST-FRCST                                   48030000
463400     END-EXEC.                                                    48040000
463500                                                                  48050000
463600     EVALUATE TRUE                                                48060000
463700       WHEN SQLCODE         = ZERO                                48070000
463800       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    48080000
463900         CONTINUE                                                 48090000
464000       WHEN OTHER                                                 48100000
464100         DISPLAY PV-ABEND-PARAGRAPH                               48110000
464200         PERFORM Z9900-SQL-ERROR                                  48120000
464300     END-EVALUATE.                                                48130000
464400                                                                  48140000
464500***************************************************************** 48150000
464600*  LOOP THRU HIST-FRCST CURSOR AND CALCULATES AND ADDS FORECAST   48160000
464700*  TO TOTAL                                                       48170000
464800***************************************************************** 48180000
464900 G3200-LOOP-THRU-CSR.                                             48190000
465000                                                                  48200000
465100     PERFORM G3300-FETCH-HIST-FRCST-CSR.                          48210000
465200     IF EOC-H-FRCST-CSR                                           48220000
465300         CONTINUE                                                 48230000
465400     ELSE                                                         48240000
465500         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                48250000
465600         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      48260000
465700         PERFORM B2000-READ-BIM-FILE                              48270000
465800         IF BIM-RECORD-FOUND                                      48280000
465900             MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI         48290000
466000             IF MRITEM-UCYCLE-CDE = 9                             48300000
466100                 MOVE MRISHS-DSD-HIST-QTY TO PV-DD-COMPUTED       48310000
466200             ELSE                                                 48320000
466300                 IF MRITEM-UCYCLE-CDE = 5                         48330000
466400                     DIVIDE MRISHS-DSD-HIST-QTY BY PC-FOUR        48340000
466500                                     GIVING PV-DD-COMPUTED ROUNDED48350000
466600                 END-IF                                           48360000
466700             END-IF                                               48370000
466800             MULTIPLY PV-BI BY PV-DD-COMPUTED                     48380000
466900                                            GIVING PV-FORECAST    48390000
467000             ADD PV-FORECAST TO PV-TOTAL-FORECAST                 48400000
467100         END-IF                                                   48410000
467200     END-IF.                                                      48420000
467300                                                                  48430000
467400***************************************************************** 48440000
467500* FETCH VENDOR-HIST-FRCST CURSOR GETS DD AND PTAG TO READ BIM     48450000
467600* FILE                                                            48460000
467700***************************************************************** 48470000
467800 G3300-FETCH-HIST-FRCST-CSR.                                      48480000
467900                                                                  48490000
468000     MOVE 'G3300'                       TO PGM-LOCATION.          48500000
468100     MOVE 'G3300-FETCH-HIST-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    48510000
468200                                                                  48520000
468300     EXEC SQL                                                     48530000
468400       FETCH VENDOR-HIST-FRCST                                    48540000
468500        INTO                                                      48550000
468600              :MRITEM-UCYCLE-CDE,                                 48560000
468700              :MRISHS-DSD-HIST-QTY,                               48570000
468800              :MRITST-PTAG-ID                                     48580000
468900     END-EXEC.                                                    48590000
469000*                                                                 48600000
469100     EVALUATE TRUE                                                48610000
469200       WHEN SQLCODE         = ZERO                                48620000
469300         CONTINUE                                                 48630000
469400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    48640000
469500         PERFORM G3400-CLOSE-FRCST-LEVEL-CSR                      48650000
469600         MOVE PC-Y TO PS-EOC-H-FRCST-CSR                          48660000
469700       WHEN OTHER                                                 48670000
469800         DISPLAY PV-ABEND-PARAGRAPH                               48680000
469900         PERFORM Z9900-SQL-ERROR                                  48690000
470000     END-EVALUATE.                                                48700000
470100                                                                  48710000
470200******************************************************************48720000
470300*  CLOSE VENDOR-HIST-FRCST CURSOR                               * 48730000
470400******************************************************************48740000
470500 G3400-CLOSE-FRCST-LEVEL-CSR.                                     48750000
470600*                                                                 48760000
470700     MOVE 'G3400'                        TO PGM-LOCATION.         48770000
470800     MOVE 'G3400-CLOSE-FRCST-LEVEL-CSR'  TO PV-ABEND-PARAGRAPH.   48780000
470900                                                                  48790000
471000     EXEC SQL                                                     48800000
471100         CLOSE VENDOR-HIST-FRCST                                  48810000
471200     END-EXEC.                                                    48820000
471300*                                                                 48830000
471400     EVALUATE TRUE                                                48840000
471500         WHEN SQLCODE EQUAL ZERO                                  48850000
471600         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      48860000
471700             CONTINUE                                             48870000
471800         WHEN OTHER                                               48880000
471900             DISPLAY PV-ABEND-PARAGRAPH                           48890000
472000             PERFORM Z9900-SQL-ERROR                              48900000
472100     END-EVALUATE.                                                48910000
472200                                                                  48920000
472300***************************************************************** 48930000
472400* CALCULATES PERCENT DIFFERENCE BETWEEN WHAT WAS FORECAST AND     48940000
472500* WHAT WAS SOLD.                                                  48950000
472600***************************************************************** 48960000
472700 G3500-CALCULATE-FRCST-PERCENT.                                   48970000
472800                                                                  48980000
472900     MOVE DL7-HIST-FRCST(PV-HIST-INDEX)   TO PV-FORECAST.         48990000
473000     MOVE DL8-SALES(PV-HIST-INDEX)        TO PV-SALES.            49000000
473100                                                                  49010000
473200     IF  PV-FORECAST = 0                                          49020000
473300         MOVE '***'          TO  DL9-DIFFRNC(PV-HIST-INDEX)       49030000
473400     ELSE                                                         49040000
473500         IF (PV-FORECAST = 0) OR (PV-SALES  = 0)                  49050000
473600             MOVE 0          TO  DL9-DIFFRNC-N(PV-HIST-INDEX)     49060000
473700         ELSE                                                     49070000
473800             COMPUTE PV-FRCST-PERCENT ROUNDED =                   49080000
473900                  (PV-SALES - PV-FORECAST) / PV-FORECAST * 100    49090000
474000             MOVE PV-FRCST-PERCENT                                49100000
474100                         TO DL9-DIFFRNC-N(PV-HIST-INDEX)          49110000
474200         END-IF                                                   49120000
474300     END-IF.                                                      49130000
474400                                                                  49140000
474500***************************************************************** 49150000
474600* GETS ONORDER, ONHAND, DD, CSTOCK, AVG OSTRAT, AND MAXIMUM LEAD  49160000
474700* TIME.                                                           49170000
474800***************************************************************** 49180000
474900 G4000-GET-CURRENT-INFO.                                          49190000
475000                                                                  49200000
475100     MOVE PC-N TO PS-EOC-CURR-CSR                                 49210000
475200     PERFORM G4100-FETCH-CURRENT-INFO.                            49220000
475300     IF EOC-CURR-CSR                                              49230000
475400         MOVE ZEROES           TO  DL3-ONORDER                    49240000
475500         MOVE ZEROES           TO  DL10-ONHAND                    49250000
475600         MOVE ZEROES           TO  DL6-DD-CURR                    49260000
475700         MOVE ZEROES           TO  DL11-CSTOCK                    49270000
475800         MOVE ZEROES           TO  DL2-AVG-OSTRAT                 49280000
475900         MOVE ZEROES           TO  DL2-LEAD-TIME                  49290000
476000     ELSE                                                         49300000
476100         MOVE PV-ON-ORDER      TO  DL3-ONORDER                    49310000
476200         MOVE PV-ONHAND        TO  DL10-ONHAND                    49320000
476300         MOVE PV-DD            TO  DL6-DD-CURR                    49330000
476400         MOVE PV-CSTOCK        TO  DL11-CSTOCK                    49340000
476500         MOVE PV-OSTRAT        TO  DL2-AVG-OSTRAT                 49350000
476600         MOVE PV-LT            TO  DL2-LEAD-TIME                  49360000
476700     END-IF.                                                      49370000
476800                                                                  49380000
476900***************************************************************** 49390000
477000* FETCH CURRENT INFO FOR DD, ONHAND, CSTOCK, ONORDER, AVG OSTRAT  49400000
477100* AND MAXIMUM LEAD TIME                                           49410000
477200***************************************************************** 49420000
477300 G4100-FETCH-CURRENT-INFO.                                        49430000
477400                                                                  49440000
477500     MOVE 'G4100'                       TO PGM-LOCATION.          49450000
477600     MOVE 'G4100-FETCH-CURRENT-INFO'    TO PV-ABEND-PARAGRAPH.    49460000
477700                                                                  49470000
477800     EXEC SQL                                                     49480000
477900          SELECT                                                  49490000
478000                  COALESCE(SUM(D.DD_FCTR),0)                      49500000
478100                , COALESCE(SUM(F.ONHAND_QTY),0)                   49510000
478200                , COALESCE(SUM(D.CSTOCK_QTY),0)                   49520000
478300                , COALESCE(SUM(D.ON_ORDER_QTY),0)                 49530000
478400                , COALESCE(AVG(D.OSTRAT_QTY),0)                   49540000
478500                , COALESCE(MAX(LT_QTY),0)                         49550000
478600          INTO  :PV-DD                                            49560000
478700               ,:PV-ONHAND                                        49570000
478800               ,:PV-CSTOCK                                        49580000
478900               ,:PV-ON-ORDER                                      49590000
479000               ,:PV-OSTRAT                                        49600000
479100               ,:PV-LT                                            49610000
479200          FROM   TSK         A                                    49620000
479300                ,TMRITEM     B                                    49630000
479400                ,TMRITST     D                                    49640000
479500                ,TSKST       F                                    49650000
479600                ,XMT_LOC     G                                    49660000
479700                ,TSKXREF     X                                    49670000
479800          WHERE  A.ITEM_NMBR          = B.ITEM_NBR                49680000
479900            AND  A.ITEM_NMBR          = D.ITEM_NBR                49690000
480000            AND  A.ITEM_NMBR          = F.ITEM_NMBR               49700000
480100            AND  A.ITEM_NMBR          = X.ITM_NBR                 49710000
480200            AND  D.STR_NBR            = F.LOC_NBR                 49720000
480300            AND  D.STR_NBR            > 0                         49730000
480400            AND  D.FT_CDE             = 'O'                       49740000
480500            AND  D.STR_NBR            = G.LOC_NBR                 49750000
480600            AND  G.E_BUS_IND          = 'N'                       49760000
480800            AND  ((RT_NBR = 4 AND RT_DAY_NBR = :PV-CC-DAY)        49770000
480900            OR   (RT_NBR > 4                                      49780000
481000            AND  RT_DAY_NBR IN (:PV-CC-DAY, :PV-CC-DAY2)          49790000
481100            AND  RT_DAY_NBR <> 0))                                49800000
481200            AND  X.DEPT               = :PV-HOLD-DEPT-NBR         49810000
481300            AND  A.ENT_ID             = :PV-HOLD-VENDOR-CODE      49820000
064400            WITH UR                                               49830000
481400     END-EXEC.                                                    49840000
481500                                                                  49850000
481600     EVALUATE TRUE                                                49860000
481700       WHEN SQLCODE         = ZERO                                49870000
481800         CONTINUE                                                 49880000
481900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    49890000
482000         MOVE PC-Y TO PS-EOC-CURR-CSR                             49900000
482100       WHEN OTHER                                                 49910000
482200         DISPLAY PV-ABEND-PARAGRAPH                               49920000
482300         PERFORM Z9900-SQL-ERROR                                  49930000
482400     END-EVALUATE.                                                49940000
482500                                                                  49950000
476900***************************************************************** 49960000
477000* THIS CALL GETS THE DATES NEEDED TO ACCESS MHT.                  49970000
477200***************************************************************** 49980000
477300 G4500-GET-FSCL-DATES.                                            49990000
477400                                                                  50000000
477500     MOVE 'G4500'                       TO PGM-LOCATION.          50010000
477600     MOVE 'G4500-GET-FSCL-DATES'        TO PV-ABEND-PARAGRAPH.    50020000
477700                                                                  50030000
             EXEC SQL                                                   50040000
W10763         SELECT                                                   50050000
WR6041               KY_DTE + 1 DAYS                                    50060000
                  INTO  :PV-FSCL-EOW-DATE                               50070000
WR6041         FROM   TDTATTR                                           50080000
               WHERE KY_DTE      = :PV-FSCL-WRK-DATE                    50090000
             END-EXEC                                                   50100000
481500                                                                  50110000
481600     EVALUATE TRUE                                                50120000
481700       WHEN SQLCODE         = ZERO                                50130000
481800         CONTINUE                                                 50140000
482100       WHEN OTHER                                                 50150000
482200         DISPLAY PV-ABEND-PARAGRAPH                               50160000
482300         PERFORM Z9900-SQL-ERROR                                  50170000
482400     END-EVALUATE.                                                50180000
482500                                                                  50190000
482600***************************************************************** 50200000
482700* GETS CURRENT FORECAST AND CALCULATES AND STORES THE FORECAST    50210000
482800* FOR THE NEXT 52 WEEKS.                                          50220000
482900***************************************************************** 50230000
483000 G5000-GET-CURRENT-FORECAST.                                      50240000
483100                                                                  50250000
483200        PERFORM G5100-INITIALZE-TABLE.                            50260000
483300        MOVE PC-N TO PS-EOC-C-FRCST-CSR                           50270000
483400        PERFORM G5200-OPEN-CURR-FRCST-CSR.                        50280000
483500        PERFORM G5300-LOOP-THRU-CURR-CSR UNTIL EOC-C-FRCST-CSR.   50290000
483600        MOVE PT-FORECAST-AMOUNT(PC-ONE)                           50300000
483700                                    TO DL7-CURRENT-FRCST.         50310000
483800        MOVE PT-FORECAST-AMOUNT(PC-TWO)                           50320000
483900                            TO DL7-FUTURE-FRCST(PC-ONE).          50330000
484000        MOVE PT-FORECAST-AMOUNT(PC-THREE)                         50340000
484100                            TO DL7-FUTURE-FRCST(PC-TWO).          50350000
484200        MOVE PT-FORECAST-AMOUNT(PC-FOUR)                          50360000
484300                            TO DL7-FUTURE-FRCST(PC-THREE).        50370000
484400        MOVE PT-FORECAST-AMOUNT(PC-FIVE)                          50380000
484500                            TO DL7-FUTURE-FRCST(PC-FOUR).         50390000
484600        MOVE PT-FORECAST-AMOUNT(PC-SIX)                           50400000
484700                            TO DL7-FUTURE-FRCST(PC-FIVE).         50410000
484800                                                                  50420000
484900***************************************************************** 50430000
485000* INITIALZE FORECAST TABLE.                                       50440000
485100***************************************************************** 50450000
485200 G5100-INITIALZE-TABLE.                                           50460000
485300                                                                  50470000
485400        MOVE PC-ONE      TO PV-BIM-INDEX.                         50480000
485500        PERFORM UNTIL PV-BIM-INDEX > PC-52                        50490000
485600            MOVE ZEROES  TO PT-FORECAST-AMOUNT(PV-BIM-INDEX)      50500000
485700            ADD PC-ONE   TO PV-BIM-INDEX                          50510000
485800        END-PERFORM.                                              50520000
485900                                                                  50530000
486000                                                                  50540000
486100***************************************************************** 50550000
486200* OPEN VENDOR-CURR-FRCST CURSOR                                   50560000
486300***************************************************************** 50570000
486400 G5200-OPEN-CURR-FRCST-CSR.                                       50580000
486500                                                                  50590000
486600     MOVE 'G5200'                    TO PGM-LOCATION.             50600000
486700     MOVE 'G5200-OPEN-CURR-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      50610000
486800                                                                  50620000
486900     EXEC SQL                                                     50630000
487000         OPEN VENDOR-CURR-FRCST                                   50640000
487100     END-EXEC.                                                    50650000
487200                                                                  50660000
487300     EVALUATE TRUE                                                50670000
487400       WHEN SQLCODE         = ZERO                                50680000
487500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    50690000
487600         CONTINUE                                                 50700000
487700       WHEN OTHER                                                 50710000
487800         DISPLAY PV-ABEND-PARAGRAPH                               50720000
487900         PERFORM Z9900-SQL-ERROR                                  50730000
488000     END-EVALUATE.                                                50740000
488100                                                                  50750000
488200***************************************************************** 50760000
488300* LOOP THRU VENDOR-CURR-FRCST CURSOR AND CALCULATE FORECASTS.     50770000
488400***************************************************************** 50780000
488500 G5300-LOOP-THRU-CURR-CSR.                                        50790000
488600                                                                  50800000
488700     PERFORM G5400-FETCH-CURR-FRCST-CSR.                          50810000
488800     IF EOC-C-FRCST-CSR                                           50820000
488900         CONTINUE                                                 50830000
489000     ELSE                                                         50840000
489100         MOVE PV-CURR-WEEK         TO PV-BIM-WEEK-INDEX           50850000
489200         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                50860000
489300         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      50870000
489400         PERFORM B2000-READ-BIM-FILE                              50880000
489500         IF BIM-RECORD-FOUND                                      50890000
489600             PERFORM G5600-CALCULATE-FORECAST                     50900000
489700                 VARYING PV-BIM-INDEX  FROM 1 BY 1                50910000
489800                 UNTIL PV-BIM-INDEX GREATER THAN PC-52            50920000
489900         END-IF                                                   50930000
490000     END-IF.                                                      50940000
490100                                                                  50950000
490200***************************************************************** 50960000
490300* FETCH VENDOR-CURR-FRCST CURSOR                                  50970000
490400***************************************************************** 50980000
490500 G5400-FETCH-CURR-FRCST-CSR.                                      50990000
490600                                                                  51000000
490700     MOVE 'G5400'                       TO PGM-LOCATION.          51010000
490800     MOVE 'G5400-FETCH-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    51020000
490900                                                                  51030000
491000     EXEC SQL                                                     51040000
491100       FETCH VENDOR-CURR-FRCST                                    51050000
491200        INTO                                                      51060000
491300              :MRITEM-UCYCLE-CDE,                                 51070000
491400              :MRITST-DD-FCTR,                                    51080000
491500              :MRITST-PTAG-ID                                     51090000
491600     END-EXEC.                                                    51100000
491700*                                                                 51110000
491800     EVALUATE TRUE                                                51120000
491900       WHEN SQLCODE         = ZERO                                51130000
492000         CONTINUE                                                 51140000
492100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    51150000
492200         PERFORM G5500-CLOSE-CURR-FRCST-CSR                       51160000
492300         MOVE PC-Y TO PS-EOC-C-FRCST-CSR                          51170000
492400       WHEN OTHER                                                 51180000
492500         DISPLAY PV-ABEND-PARAGRAPH                               51190000
492600         PERFORM Z9900-SQL-ERROR                                  51200000
492700     END-EVALUATE.                                                51210000
492800                                                                  51220000
492900******************************************************************51230000
493000* CLOSE VENDOR-CURR-FRCST CURSOR                                 *51240000
493100******************************************************************51250000
493200 G5500-CLOSE-CURR-FRCST-CSR.                                      51260000
493300*                                                                 51270000
493400     MOVE 'G5500'                       TO PGM-LOCATION.          51280000
493500     MOVE 'G5500-CLOSE-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    51290000
493600                                                                  51300000
493700     EXEC SQL                                                     51310000
493800         CLOSE VENDOR-CURR-FRCST                                  51320000
493900     END-EXEC.                                                    51330000
494000*                                                                 51340000
494100     EVALUATE TRUE                                                51350000
494200         WHEN SQLCODE EQUAL ZERO                                  51360000
494300         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      51370000
494400             CONTINUE                                             51380000
494500         WHEN OTHER                                               51390000
494600             DISPLAY PV-ABEND-PARAGRAPH                           51400000
494700             PERFORM Z9900-SQL-ERROR                              51410000
494800     END-EVALUATE.                                                51420000
494900                                                                  51430000
495000***************************************************************** 51440000
495100* CALCULATE FORECAST.                                             51450000
495200***************************************************************** 51460000
495300 G5600-CALCULATE-FORECAST.                                        51470000
495400                                                                  51480000
495500     MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI                 51490000
495600     IF MRITEM-UCYCLE-CDE = 9                                     51500000
495700         MOVE MRITST-DD-FCTR      TO PV-DD-COMPUTED               51510000
495800     ELSE                                                         51520000
495900         IF MRITEM-UCYCLE-CDE = 5                                 51530000
496000             DIVIDE MRITST-DD-FCTR      BY PC-FOUR                51540000
496100                            GIVING PV-DD-COMPUTED ROUNDED         51550000
496200         END-IF                                                   51560000
496300     END-IF.                                                      51570000
496400                                                                  51580000
496500     MULTIPLY PV-BI BY PV-DD-COMPUTED  GIVING PV-FORECAST.        51590000
496600     ADD  PV-FORECAST  TO  PT-FORECAST-AMOUNT(PV-BIM-INDEX)       51600000
496700                                                                  51610000
496800     IF PV-BIM-WEEK-INDEX = PC-52                                 51620000
496900         MOVE PC-ONE      TO PV-BIM-WEEK-INDEX                    51630000
497000     ELSE                                                         51640000
497100         ADD PC-ONE       TO PV-BIM-WEEK-INDEX                    51650000
497200     END-IF.                                                      51660000
497300                                                                  51670000
497400***************************************************************** 51680000
497500* R0000-PRINT-REPORT-LINES CHECKS FOR PAGE BREAK AND PRINTS OUT   51690000
497600* THE REPORT LINES.                                               51700000
497700***************************************************************** 51710000
497800 R0000-PRINT-REPORT-LINES.                                        51720000
497900                                                                  51730000
498000     PERFORM R1000-SET-HEADING-LINES.                             51740000
498100                                                                  51750000
498200     IF PV-LINE-CNT > 54                                          51760000
498300          PERFORM R1100-PRINT-HEADINGS                            51770000
498400     END-IF                                                       51780000
498500                                                                  51790000
498600     MOVE PC-ONE                       TO PV-LINE-CONTROL.        51800000
498700     MOVE HL-HEADING-BLANK             TO PRINT-LINE.             51810000
498800     PERFORM R1200-WRITE-PRINT-LINE.                              51820000
498900     MOVE HL-HEADING-BLANK             TO PRINT-LINE.             51830000
499000     PERFORM R1200-WRITE-PRINT-LINE.                              51840000
499100     MOVE DETAIL-LINE1                 TO PRINT-LINE.             51850000
499200     PERFORM R1200-WRITE-PRINT-LINE.                              51860000
499300     MOVE DETAIL-LINE2                 TO PRINT-LINE.             51870000
499400     PERFORM R1200-WRITE-PRINT-LINE.                              51880000
499500     MOVE DETAIL-LINE3                 TO PRINT-LINE.             51890000
499600     PERFORM R1200-WRITE-PRINT-LINE.                              51900000
499700     MOVE HL-HEADING-BLANK             TO PRINT-LINE.             51910000
499800     PERFORM R1200-WRITE-PRINT-LINE.                              51920000
499900     MOVE DETAIL-LINE4                 TO PRINT-LINE.             51930000
500000     PERFORM R1200-WRITE-PRINT-LINE.                              51940000
500100     MOVE DETAIL-LINE5                 TO PRINT-LINE.             51950000
500200     PERFORM R1200-WRITE-PRINT-LINE.                              51960000
500300*    MOVE HL-HEADING-BLANK             TO PRINT-LINE.             51970000
500400*    PERFORM R1200-WRITE-PRINT-LINE.                              51980000
500500     MOVE DETAIL-LINE6                 TO PRINT-LINE.             51990000
500600     PERFORM R1200-WRITE-PRINT-LINE.                              52000000
500700     MOVE DETAIL-LINE7                 TO PRINT-LINE.             52010000
500800     PERFORM R1200-WRITE-PRINT-LINE.                              52020000
500900     MOVE DETAIL-LINE8                 TO PRINT-LINE.             52030000
501000     PERFORM R1200-WRITE-PRINT-LINE.                              52040000
501100     MOVE DETAIL-LINE9                 TO PRINT-LINE.             52050000
501200     PERFORM R1200-WRITE-PRINT-LINE.                              52060000
501300     MOVE DETAIL-LINE10                TO PRINT-LINE.             52070000
501400     PERFORM R1200-WRITE-PRINT-LINE.                              52080000
501500     MOVE DETAIL-LINE11                TO PRINT-LINE.             52090000
501600     PERFORM R1200-WRITE-PRINT-LINE.                              52100000
501700                                                                  52110000
501800     ADD  PC-FOURTEEN                  TO PV-LINE-CNT.            52120000
501900                                                                  52130000
502000***************************************************************** 52140000
502100* R1000-SET-HEADING-LINES.                                        52150000
502200***************************************************************** 52160000
502300 R1000-SET-HEADING-LINES.                                         52170000
502400                                                                  52180000
502500     INITIALIZE DETAIL-LINE1.                                     52190000
502600     MOVE PV-HOLD-DEPT-NBR            TO DL1-DEPARTMENT.          52200000
505100     MOVE SPACES                      TO DL2-RPT-LVL-DATA.        52210000
502700                                                                  52220000
502800     EVALUATE PV-HOLD-LEVEL                                       52230000
502900         WHEN 'MCL'                                               52240000
503400             MOVE '        MCL:'      TO DL2-RPT-LVL              52250000
503500             MOVE PV-HOLD-CLASS-NBR   TO DL2-RPT-LVL-DATA-94      52260000
503600         WHEN 'SCL'                                               52270000
503650             MOVE 'MCL:'              TO DL1-MCL-TITLE            52280000
503700             MOVE PV-HOLD-CLASS-NBR   TO DL1-MCL-94               52290000
504000             MOVE '        SCL:'      TO DL2-RPT-LVL              52300000
504100             MOVE PV-HOLD-SCL-NBR     TO DL2-RPT-LVL-DATA-94      52310000
504200         WHEN 'GRP'                                               52320000
504210             MOVE 'MCL:'              TO DL1-MCL-TITLE            52330000
504300             MOVE PV-HOLD-CLASS-NBR   TO DL1-MCL-94               52340000
504310             MOVE 'SCL:'              TO DL1-SCL-TITLE            52350000
504400             MOVE PV-HOLD-SCL-NBR     TO DL1-SCL-94               52360000
504500             MOVE '      GROUP:'      TO DL2-RPT-LVL              52370000
504600             MOVE PV-HOLD-GROUP-CODE  TO DL2-RPT-LVL-DATA         52380000
504700         WHEN 'VSC'                                               52390000
504710             MOVE 'MCL:'              TO DL1-MCL-TITLE            52400000
504800             MOVE PV-HOLD-CLASS-NBR   TO DL1-MCL-94               52410000
504810             MOVE 'SCL:'              TO DL1-SCL-TITLE            52420000
504900             MOVE PV-HOLD-SCL-NBR     TO DL1-SCL-94               52430000
505000             MOVE 'STYLE/COLOR:'      TO DL2-RPT-LVL              52440000
505100             MOVE PV-HOLD-STYLE       TO DL2-RPT-LVL-DATA         52450000
505200             MOVE '/'                 TO DL2-RPT-LVL-DATA(21:1)   52460000
505300             MOVE PV-HOLD-COLOR       TO DL2-RPT-LVL-DATA(22:15)  52470000
505400         WHEN 'VND'                                               52480000
505900             MOVE '     VENDOR:'      TO DL2-RPT-LVL              52490000
506000             MOVE PV-HOLD-VENDOR-NAME TO DL2-RPT-LVL-DATA         52500000
506100     END-EVALUATE.                                                52510000
506200                                                                  52520000
506300     MOVE PT-HIST-WEEK(PC-ONE)        TO DL5-LAST-WEEK-1.         52530000
506400     MOVE PT-HIST-WEEK(PC-TWO)        TO DL5-LAST-WEEK-2.         52540000
506500     MOVE PT-HIST-WEEK(PC-THREE)      TO DL5-LAST-WEEK-3.         52550000
506600     MOVE PT-HIST-WEEK(PC-FOUR)       TO DL5-LAST-WEEK-4.         52560000
506700     MOVE PV-CURR-WEEK                TO DL5-CURRENT-WEEK.        52570000
506800     MOVE PT-FUTURE-WEEK(PC-ONE)      TO DL5-FRCST-WEEK-1.        52580000
506900     MOVE PT-FUTURE-WEEK(PC-TWO)      TO DL5-FRCST-WEEK-2.        52590000
507000     MOVE PT-FUTURE-WEEK(PC-THREE)    TO DL5-FRCST-WEEK-3.        52600000
507100     MOVE PT-FUTURE-WEEK(PC-FOUR)     TO DL5-FRCST-WEEK-4.        52610000
507200     MOVE PT-FUTURE-WEEK(PC-FIVE)     TO DL5-FRCST-WEEK-5.        52620000
507300                                                                  52630000
507400****************************************************************  52640000
507500* R1100-PRINT-HEADINGS - WRITES THE HEADING LINES FOR THE      *  52650000
507600* REPORT WHEN THER PAGE IS FULL.                               *  52660000
507700****************************************************************  52670000
507800 R1100-PRINT-HEADINGS.                                            52680000
507900                                                                  52690000
508000     ADD +1                             TO PV-PAGE-CNT.           52700000
508100     MOVE PV-PAGE-CNT                   TO DP132-PAGE-NUMBER.     52710000
508200                                                                  52720000
508300                                                                  52730000
508400     MOVE DP132-STANDRD-HEADER-132-COLS TO PRINT-LINE.            52740000
508500     MOVE PC-ONE                        TO PV-LINE-CONTROL.       52750000
508600     PERFORM R1300-WRITE-TOP-OF-PAGE.                             52760000
508700                                                                  52770000
508800     MOVE  HL-HEADING-LINE1             TO PRINT-LINE.            52780000
508900     MOVE  PC-ONE                       TO PV-LINE-CONTROL.       52790000
509000     PERFORM R1200-WRITE-PRINT-LINE.                              52800000
509100                                                                  52810000
509200     MOVE PC-TWO                        TO PV-LINE-CNT.           52820000
509300                                                                  52830000
509400***************************************************************** 52840000
509500* R1200-WRITE-PRINT-LINE -                                        52850000
509600***************************************************************** 52860000
509700 R1200-WRITE-PRINT-LINE.                                          52870000
509800                                                                  52880000
509900     WRITE PRINT-LINE                                             52890000
510000         AFTER ADVANCING PV-LINE-CONTROL.                         52900000
510100                                                                  52910000
510200***************************************************************** 52920000
510300* R1300-WRITE-TOP-OF-PAGE -                                       52930000
510400***************************************************************** 52940000
510500 R1300-WRITE-TOP-OF-PAGE.                                         52950000
510600                                                                  52960000
510700     WRITE PRINT-LINE                                             52970000
510800         AFTER ADVANCING PAGE.                                    52980000
510900                                                                  52990000
511000******************************************************************53000000
511100* Z8000-CLOSE-DEPT-LEVEL-CSR                                    * 53010000
511200******************************************************************53020000
511300 Z8000-CLOSE-DEPT-LEVEL-CSR.                                      53030000
511400*                                                                 53040000
511500     MOVE 'Z8000'                       TO PGM-LOCATION.          53050000
511600     MOVE 'Z8000-CLOSE-DEPT-LEVEL-CSR' TO PV-ABEND-PARAGRAPH.     53060000
511700                                                                  53070000
511800     EXEC SQL                                                     53080000
511900         CLOSE DEPT-LEVEL                                         53090000
512000     END-EXEC.                                                    53100000
512100*                                                                 53110000
512200     EVALUATE TRUE                                                53120000
512300         WHEN SQLCODE EQUAL ZERO                                  53130000
512400         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      53140000
512500             CONTINUE                                             53150000
512600         WHEN OTHER                                               53160000
512700             DISPLAY PV-ABEND-PARAGRAPH                           53170000
512800             PERFORM Z9900-SQL-ERROR                              53180000
512900     END-EVALUATE.                                                53190000
513000                                                                  53200000
513100******************************************************************53210000
513200* Z9000-EOF-PROCESSING - CLOSES ALL FILES ASSOCIATED WITH THE JOB*53220000
513300******************************************************************53230000
513400 Z9000-EOF-PROCESSING.                                            53240000
513500                                                                  53250000
513600     CLOSE EXCEPTION-FILE                                         53260000
513700           BIM-FILE                                               53270000
513800           IC-PARM-FILE                                           53280000
513900           PRINT-REPORT.                                          53290000
514000                                                                  53300000
514100     IF  NOT SC-EXCEPT-STATUS-OK                                  53310000
514200         MOVE 'Z9000-EOF-PROCESSING' TO PV-PARAGRAPH-NAME         53320000
514300         MOVE 'BIM-FILE'            TO PV-ERROR-FILE              53330000
514400         MOVE 'CLOSING INPUT FILE'  TO PV-ERROR-OPERATION         53340000
514500         MOVE 'BAD-CLOSE'           TO PV-ERROR-STATUS            53350000
514600         MOVE  SC-BIM-STATUS        TO PV-VSAM-STATUS             53360000
514700         MOVE  '//////////////'     TO PV-NOT-FOUND-KEY           53370000
514800         PERFORM Z9999-VSAM-ERROR                                 53380000
514900         MOVE +4006                 TO PV-ABEND-CODE              53390000
515000         CALL 'ILBOABN0'            USING PV-ABEND-CODE           53400000
515100     END-IF.                                                      53410000
515200                                                                  53420000
515300     IF  NOT SC-BIM-STATUS-OK                                     53430000
515400         MOVE 'Z9000-EOF-PROCESSING' TO PV-PARAGRAPH-NAME         53440000
515500         MOVE 'EXCEPT-FILE'         TO PV-ERROR-FILE              53450000
515600         MOVE 'CLOSING INPUT FILE'  TO PV-ERROR-OPERATION         53460000
515700         MOVE 'BAD-CLOSE'           TO PV-ERROR-STATUS            53470000
515800         MOVE  SC-BIM-STATUS        TO PV-VSAM-STATUS             53480000
515900         MOVE  '//////////////'     TO PV-NOT-FOUND-KEY           53490000
516000         PERFORM Z9999-VSAM-ERROR                                 53500000
516100         MOVE +4006                 TO PV-ABEND-CODE              53510000
516200         CALL 'ILBOABN0'            USING PV-ABEND-CODE           53520000
516300     END-IF.                                                      53530000
516400                                                                  53540000
516500******************************************************************53550000
516600*     VSAM WARNING OR ERROR PROCESSING                           *53560000
516700******************************************************************53570000
516800 Z9900-SQL-ERROR.                                                 53580000
516900                                                                  53590000
517000     MOVE SQLCODE    TO SQLCODE2.                                 53600000
517100     MOVE SQLERRD(3) TO SQLERRD3.                                 53610000
517200     DISPLAY '** ABEND **       ** = SQLERROR'.                   53620000
517300     DISPLAY '** PROGRAM        ** = MRKRP094'.                   53630000
517400     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  53640000
517500     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  53650000
517600     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   53660000
517700     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  53670000
517800     MOVE +4013 TO PV-ABEND-CODE.                                 53680000
517900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         53690000
518000                                                                  53700000
518100******************************************************************53710000
518200*     VSAM WARNING OR ERROR PROCESSING                           *53720000
518300******************************************************************53730000
518400 Z9999-VSAM-ERROR.                                                53740000
518500                                                                  53750000
518600     DISPLAY '**   ABEND   **'.                                   53760000
518700     DISPLAY 'PROGRAM NAME = ' PC-PGRM-NAME.                      53770000
518800     DISPLAY PV-PARAGRAPH-NAME-MSG.                               53780000
518900     DISPLAY PV-ERROR-FILE-MSG.                                   53790000
519000     DISPLAY PV-ERROR-OPERATION-MSG.                              53800000
519100     DISPLAY PV-ERROR-STATUS-MSG.                                 53810000
519200     DISPLAY PV-NOT-FOUND-MSG                                     53820000
519300     DISPLAY 'VSAM STATUS = ' PV-VSAM-STATUS.                     53830000
519400     DISPLAY '***************'.                                   53840000
519500******************************************************************53850000
519600******************END OF PROGRAM   *******************************53860000
519700******************************************************************53870000
