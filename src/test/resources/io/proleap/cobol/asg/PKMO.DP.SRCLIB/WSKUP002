000100******************************************************************00010005
000200 IDENTIFICATION DIVISION.                                         00020005
000300******************************************************************00030005
000400 PROGRAM-ID.   WSKUP002.                                          00040005
000500 AUTHOR.       JOE LAROSA.                                        00050005
000600 INSTALLATION. KOHLS DEPARTMENT STORES.                           00060005
000700 DATE-WRITTEN. FEBRUARY 2007.                                     00070005
000800 DATE-COMPILED.                                                   00080005
000900******************************************************************00090005
001000*    CENTRAL STOCK ORDER REPOSITORY LOAD (FOR WMOS DOWNLOAD)      00100005
001100* THIS PROGRAM READS THE CENTRAL STOCK RDM EXTRACT FILES & INSERTS00110005
001200* THEM INTO WMOS E-FULFILLMENT REPOSITORY FOR LATER PROCESSING.   00120005
001300******************************************************************00130005
001400* CONVERTED PROGRAM TO BUILD NEW DATA REPOSITORY ROWS FOR WMOS    00140005
001500* DOWNLOADS.  READ RDM V9 EXTRACT DATA SET(S) AND CONVERT INTO    00150005
001600* NEW LAYOUTS USING NEW COPYBOOKS FOR THE MANHATTAN SYSTEM.       00160005
001700******************************************************************00170005
W38216******************************************************************00171005
W38216*  CHANGE LOG                                                     00172005
W38216*  DATE       CHANGED BY    DESC                                  00173005
W38216*  ---------- ------------- --------------------------------------00174005
001800*    3/7/07 -               BUILD A UNIQUE HEADER FOR EACH STORE. 00175005
      *  03/16/10 - DJK           CHANGE NUMBER 38216                   00176005
      *                           CHANGED CODE TO REFLECT THE           00177005
      *                           C010 EFC #2 PROJECT                   00178005
X38216*  04/28/2010 BRUCE GRAHAM - KFORCE                               00179005
X38216*                           WAREHOUSE TRANSFERS EFC2 PROJECT      00180005
X38216*                           (WR38216)                             00181005
X38216*                           PROGRAM CHANGES CAN BE FOUND BY       00182005
X38216*                           DOING A SEARCH ON X38216 IN COLS      00182105
X38216*                           1 THRU 6.                             00182205
X38216*  05/15/2020 Jean Kurk     Rename WMRD009 to CERD009,            00182334
X38216*                           WMRD010 to CERD021                    00182434
001900******************************************************************00182505
002000 ENVIRONMENT DIVISION.                                            00182605
002100******************************************************************00182705
002200 CONFIGURATION SECTION.                                           00182805
002300 SOURCE-COMPUTER.        IBM-3090.                                00182905
002400 OBJECT-COMPUTER.        IBM-3090.                                00183005
002500 INPUT-OUTPUT SECTION.                                            00183105
002600                                                                  00183205
002700 FILE-CONTROL.                                                    00184005
002800     SELECT INPUT-FILE           ASSIGN TO INP01.                 00185005
002900******************************************************************00186005
003000 DATA DIVISION.                                                   00187005
003100******************************************************************00188005
003200 FILE SECTION.                                                    00189005
003300                                                                  00190005
003400 FD  INPUT-FILE                                                   00200005
003500     RECORDING MODE IS F                                          00210005
003600     LABEL RECORDS ARE STANDARD                                   00220005
003700     BLOCK CONTAINS 0 RECORDS.                                    00230005
003800 01  INPUT-RECORD.                                                00240005
003900     05  INPUT-ACTION-TYPE       PIC X(01).                       00250005
004000     05  FILLER                  PIC X(01).                       00260005
004100     05  INPUT-LOCATION          PIC 9(04).                       00270005
004200     05  FILLER                  PIC X(01).                       00280005
004300     05  INPUT-TRANS-DATE-TIME   PIC 9(12).                       00290005
004400     05  FILLER                  PIC X(01).                       00300005
P06258     05  INPUT-DISTRO            PIC X(09).                       00310029
004600     05  FILLER                  PIC X(01).                       00320005
004700     05  INPUT-DOWNLOAD-COMMENT  PIC X(30).                       00330005
004800         88  INPUT-CS-HDR        VALUE LOW-VALUES                 00340005
004900                                       SPACES.                    00350005
005000     05  FILLER                  PIC X(1096).                     00360005
005100                                                                  00370005
005200******************************************************************00380005
005300 WORKING-STORAGE SECTION.                                         00390005
005400******************************************************************00400005
005500 01  PS-PROGRAM-SWITCHES.                                         00410005
005600     05  PS-END-OF-INPUT-SW         PIC X(01) VALUE 'N'.          00420005
005700         88  PS-END-OF-INPUT-YES              VALUE 'Y'.          00430005
005800         88  PS-END-OF-INPUT-NO               VALUE 'N'.          00440005
005900     05  PS-INPUT-REC-TYPE          PIC X(01) VALUE SPACE.        00450005
006000         88  PS-CURR-TYPE-IS-HDR              VALUE 'H'.          00460005
006100         88  PS-CURR-TYPE-IS-DTL              VALUE 'D'.          00470005
006200                                                                  00480005
006300 01  PC-PROGRAM-CONSTANTS.                                        00490005
006400     05  PC-CURRENT-PROGRAM-NAME    PIC  X(08) VALUE 'WSKUP002'.  00500005
006500     05  PC-PKT                     PIC  X(08) VALUE 'PKT     '.  00510005
      *DK - 03/16/10 - removed field for 2010 EFC #2                    00520005
006600*    05  PC-870                     PIC S9(04) VALUE 870 COMP.    00530005
006700     05  PC-READY                   PIC  X(06) VALUE 'READY '.    00540005
006800     05  PC-DEFAULT-TMST            PIC  X(26) VALUE              00550005
006900                                    '0001-01-01-00.00.00.000000'. 00560005
X38216     05  PC-X                       PIC  X(01) VALUE 'X'.         00570005
P06258     05  PC-DTL-INSTR               PIC  9(02) VALUE 10.          00571033
007000     05  DK-LOC-NBR                 PIC S9(04) VALUE +0 COMP.     00580005
013400     05  DK-NIS-SKU                    PIC S9(8)V COMP-3.         00590005
007100 01  PV-PROGRAM-VARIABLES.                                        00600005
P06258     05  PV-DISTRO                  PIC  X(09) VALUE SPACES.      00610029
007300     05  PV-DEST-ID                 PIC  9(04) VALUE ZEROES.      00620005
007400*JPL - INPUT FORMAT IS 1=C, 2-6=PULL#, 7-9=LINE#                  00630005
007500     05  PV-IN-DISTRO.                                            00640005
007600         10  PV-INP-DISTRO-1-6      PIC  X(06).                   00650005
P06258         10  PV-INP-DISTRO-7-9      PIC  X(03).                   00660029
P06258         10  PV-INP-DISTRO-7-9-N    REDEFINES                     00670029
P06258             PV-INP-DISTRO-7-9      PIC  9(03).                   00680029
007800     05  PV-OUT-DISTRO.                                           00690005
007900         10  PV-OUT-DISTRO-1-6      PIC  X(06).                   00700005
P06258         10  PV-OUT-DISTRO-7-10     PIC  X(04).                   00710030
P06258         10  PV-OUT-DISTRO-7-10-N   REDEFINES                     00720029
P06258             PV-OUT-DISTRO-7-10     PIC  9(04).                   00730030
008100     05  PV-COMMIT-COUNT            PIC  9(07) VALUE ZEROES.      00740005
008200     05  PV-DISPLAY-RECORD          PIC Z,ZZZ,ZZ9-.               00750005
008300     05  PV-VERSION-CNTL-NBR        PIC S9(02)V9(02) COMP-3.      00760005
008400     05  PV-PRC-GRP-ID              PIC S9(09) VALUE +0 COMP.     00770005
008500     05  PV-REC-SEQ-NBR             PIC S9(09) VALUE +0 COMP.     00780005
008600     05  PV-LOCATION                PIC S9(04) VALUE +0 COMP.     00790005
008700     05  PV-RDM-PRC-TYP-CDE         PIC  X(16) VALUE SPACES.      00800005
008800     05  PV-SQLCODE                 PIC S9(09).                   00810005
008900     05  PV-DISPLAY-SQLCODE         PIC -------999.               00820005
009000     05  PV-LOC-NBR                 PIC S9(04) VALUE +0 COMP.     00830005
009100     05  PV-DC-NBR                  PIC S9(04) VALUE +0 COMP.     00840005
009100     05  PV-SHIPTO-NAME.                                          00850005
007900         10  PV-SHIPTO-NAME-1-8     PIC  X(08).                   00860005
007900         10  PV-SHIPTO-NAME-9-35    PIC  X(27).                   00870005
009100     05  PV-SOLDTO-ADDR1.                                         00880005
007900         10  PV-SOLDTO-ADDR1-1-15   PIC  X(15).                   00890005
007900         10  PV-SOLDTO-ADDR1-16-19  PIC  9(04).                   00900005
007900         10  PV-SOLDTO-75           PIC  X(56).                   00910005
007900     05  PV-SAVE-UPC-NBR        PIC  9(15)     VALUE ZEROS.       00911005
009200                                                                  00912005
009300 01  PV-PRC-CNTL-TMST           PIC  X(26).                       00913005
009400 01  FILLER REDEFINES PV-PRC-CNTL-TMST.                           00914005
009500     05  PV-TMST-CCYY           PIC  9(04).                       00915005
009600     05  PV-TMST-H1             PIC  X(01).                       00916005
009700     05  PV-TMST-MONTH          PIC  9(02).                       00917005
009800     05  PV-TMST-H2             PIC  X(01).                       00918005
009900     05  PV-TMST-DAY            PIC  9(02).                       00919005
010000     05  PV-TMST-H3             PIC  X(01).                       00920005
010100     05  PV-TMST-HOUR           PIC  9(02).                       00930005
010200     05  PV-TMST-P1             PIC  X(01).                       00940005
010300     05  PV-TMST-MINUTE         PIC  9(02).                       00950005
010400     05  PV-TMST-P2             PIC  X(01).                       00960005
010500     05  PV-TMST-SECOND         PIC  9(02).                       00970005
010600     05  PV-TMST-P3             PIC  X(01).                       00980005
010700     05  PV-TMST-LAST6          PIC  9(06).                       00990005
010800 01  PV-PRC-CNTL-TMST-WMOS.                                       01000005
010900     05  PV-WMOS-CCYY           PIC  9(04).                       01010005
011000     05  PV-WMOS-H1             PIC  X(01).                       01020005
011100     05  PV-WMOS-MONTH          PIC  9(02).                       01030005
011200     05  PV-WMOS-H2             PIC  X(01).                       01040005
011300     05  PV-WMOS-DAY            PIC  9(02).                       01050005
011400     05  PV-WMOS-H3             PIC  X(01).                       01060005
011500     05  PV-WMOS-HOUR           PIC  9(02).                       01070005
011600     05  PV-WMOS-P1             PIC  X(01).                       01080005
011700     05  PV-WMOS-MINUTE         PIC  9(02).                       01090005
011800     05  PV-WMOS-P2             PIC  X(01).                       01100005
011900     05  PV-WMOS-SECOND         PIC  9(02).                       01110005
012000                                                                  01120005
012100 01  PA-PROGRAM-ACCUMULATORS.                                     01130005
012200     05  PA-TOTAL-RECS-READ         PIC S9(07) VALUE +0 COMP-3.   01140005
012300     05  PA-TOTAL-REC1-READ         PIC S9(07) VALUE +0 COMP-3.   01150005
012400     05  PA-TOTAL-CNTL-WRITTEN      PIC S9(07) VALUE +0 COMP-3.   01160005
012500     05  PA-TOTAL-XFER-WRITTEN      PIC S9(07) VALUE +0 COMP-3.   01170005
012600                                                                  01180005
012700 01  PV-ABEND-FIELDS.                                             01190005
012800     05  PV-ABEND-CODE              PIC S9(04) VALUE +0 COMP SYNC.01200005
012900     05  PV-ABEND-PROGRAM           PIC  X(08) VALUE 'WSKUP002'.  01210005
013000     05  PV-ABEND-PARAGRAPH         PIC  X(25) VALUE SPACES.      01220005
013100     05  PV-ABEND-OPERATION         PIC  X(20) VALUE SPACES.      01230005
013200                                                                  01240005
013300*INSTRUCTIONS.                                                    01250005
013400     COPY WSWS005.                                                01260005
013500                                                                  01270005
013600******************************************************************01280005
013700*  DB2 TABLE DECLARATION - WMOS EFC LOAD CONTROL.                 01290005
013800*      (WST_DAT_CNTL)                                             01300005
013900******************************************************************01310005
014000     EXEC SQL                                                     01320005
014100          INCLUDE WST00003                                        01330005
014200     END-EXEC.                                                    01340005
014300                                                                  01350005
014400******************************************************************01360005
014500*  DB2 TABLE DECLARATION - WMOS EFC LOAD TRANSACTIONS.            01370005
014600*      (WST_DAT_XFER)                                             01380005
014700******************************************************************01390005
014800     EXEC SQL                                                     01400005
014900          INCLUDE WST00004                                        01410005
015000     END-EXEC.                                                    01420005
043900                                                                  01430005
043300******************************************************************01440005
043400*    XLT_UPC TABLE (XLT00006)                                     01450005
043500******************************************************************01460005
043600     EXEC SQL                                                     01470005
043700          INCLUDE XLT00006                                        01480005
043800     END-EXEC.                                                    01490005
043900                                                                  01500005
044000******************************************************************01501005
044100*    XLT_SKU TABLE (XLT00003)                                     01502005
044200******************************************************************01503005
044300     EXEC SQL                                                     01504005
044400          INCLUDE XLT00003                                        01505005
044500     END-EXEC.                                                    01506005
015100                                                                  01507005
015200******************************************************************01508005
015300*  DB2 TABLE DECLARATION - LOCATION TABLE.                        01509005
015400*      (XLT_LOC)                                                  01510005
015500******************************************************************01520005
015600     EXEC SQL                                                     01530005
015700          INCLUDE XLT00010                                        01540005
015800     END-EXEC.                                                    01550005
015900                                                                  01560005
016000******************************************************************01570005
016100*  DB2 TABLE DECLARATION - DC LOCATION ASSIGNMENT TABLE.          01580005
016200*      (XLT_DC_LOC_ASGMT)                                         01590005
016300******************************************************************01600005
016400     EXEC SQL                                                     01610005
016500          INCLUDE XLT00014                                        01620005
016600     END-EXEC.                                                    01630005
016700                                                                  01640005
016000******************************************************************01650005
016100*  DB2 TABLE DECLARATION - CENTRAL STOCK LINE ITEM                01660005
016200*      (TCEPLIT)                                                  01670005
016300******************************************************************01671005
016400     EXEC SQL                                                     01672005
016500          INCLUDE TCEPLIT                                         01673005
016600     END-EXEC.                                                    01674005
016700                                                                  01675005
016800******************************************************************01676005
016900* INPUT LAYOUTS - STOCK ORDER HEADER / DETAIL.                    01677005
017000******************************************************************01678005
017100* I/O LAYOUT1 - CE009-SOHDR-DOWNLOAD-REC.                         01679034
017200     COPY CERD009.                                                01680034
017300                                                                  01690005
017400* I/O LAYOUT2 - CE021-SODTL-DOWNLOAD-REC.                         01700034
017500     COPY CERD021.                                                01710034
017600                                                                  01720005
017700******************************************************************01730005
017800* OUTPUT LAYOUTS - PICKTICKET HEADER / DETAIL.                    01740005
017900******************************************************************01750005
018000* OUTPUT LAYOUT - WS001-PICK-TICKET-HDR.                          01760005
018100     COPY WSRD001.                                                01770005
018200                                                                  01780005
018300* OUTPUT LAYOUT - WS002-PICK-TICKET-DTL.                          01790005
018400     COPY WSRD002.                                                01800005
018500                                                                  01810005
018600* OUTPUT LAYOUT - WS003-PICK-TICKET-INST.                         01820005
018700     COPY WSRD003.                                                01830005
018800                                                                  01840005
018900******************************************************************01850005
019000*  DB2 FORMATTED MESSAGE AREA                                     01860005
019100******************************************************************01870005
019200     COPY DPWS004.                                                01880005
019300                                                                  01890005
019400******************************************************************01900005
019500*  COMMUNICATIONS AREA FOR DB2                                    01910005
019600******************************************************************01920005
019700     EXEC SQL                                                     01930005
019800         INCLUDE SQLCA                                            01940005
019900     END-EXEC.                                                    01950005
020000                                                                  01960005
020100******************************************************************01970005
020200 LINKAGE SECTION.                                                 01980005
020300******************************************************************01990005
020400                                                                  02000005
020500******************************************************************02010005
020600 PROCEDURE DIVISION.                                              02020005
020700******************************************************************02030005
020800 0000-PROGRAM-MAINLINE.                                           02040005
020900     DISPLAY '************ START OF WSKUP002 ***************'     02050005
021000                                                                  02060005
021100     PERFORM 1000-INITIALIZE.                                     02070005
021200                                                                  02080005
021300*READ FIRST RECORD.                                               02090005
021400     PERFORM 1100-READ-INPUT-FILE.                                02100005
021500                                                                  02110005
021600     IF PS-END-OF-INPUT-YES                                       02120005
021700         DISPLAY ' '                                              02130005
021800         DISPLAY ' ****------------------------------------****'  02140005
021900         DISPLAY ' *  NO RECORDS ON CENTRAL STOCK INPUT FILE  *'  02150005
022000         DISPLAY ' ****------------------------------------****'  02160005
022100         DISPLAY ' '                                              02170005
022200     END-IF.                                                      02180005
022300                                                                  02190005
022400*PROCESS THE RECORDS.                                             02200005
022500     IF PS-END-OF-INPUT-NO                                        02210005
022600         PERFORM 2000-PROCESS-STOCK-ORDERS                        02220005
022700           UNTIL PS-END-OF-INPUT-YES                              02230005
022800     END-IF.                                                      02240005
022900                                                                  02250005
023000     CLOSE INPUT-FILE.                                            02260005
023100                                                                  02270005
023200*    PRINT PROGRAM ACCUMULATORS.                                  02280005
023300     DISPLAY ' '.                                                 02290005
023400     DISPLAY '*********************************************'.     02300005
023500     DISPLAY '     * WSKUP002 SUMMARY STATISTICS *         '.     02310005
023600     DISPLAY ' '.                                                 02320005
023700     DISPLAY '     -------------------------------         '.     02330005
023800     DISPLAY '      CENTRAL STOCK HDR/DTL INSERTS          '.     02340005
023900     DISPLAY '     -------------------------------         '.     02350005
024000     DISPLAY ' '.                                                 02360005
024100     MOVE PA-TOTAL-RECS-READ    TO PV-DISPLAY-RECORD.             02370005
024200     DISPLAY '  TOTAL INPUT RECORDS READ = ' PV-DISPLAY-RECORD.   02380005
024300     MOVE PA-TOTAL-REC1-READ    TO PV-DISPLAY-RECORD.             02390005
024400     DISPLAY '  TOTAL CS HEADERS READ    = ' PV-DISPLAY-RECORD.   02400005
024500     DISPLAY ' '.                                                 02410005
024600     MOVE PA-TOTAL-CNTL-WRITTEN TO PV-DISPLAY-RECORD.             02420005
024700     DISPLAY '  TOTAL CNTL ROWS INSERTED = ' PV-DISPLAY-RECORD.   02430005
024800     MOVE PA-TOTAL-XFER-WRITTEN TO PV-DISPLAY-RECORD.             02440005
024900     DISPLAY '  TOTAL XFER ROWS INSERTED = ' PV-DISPLAY-RECORD.   02450005
025000     DISPLAY ' '.                                                 02460005
025100     DISPLAY '*********************************************'.     02470005
025200     DISPLAY ' '.                                                 02480005
025300                                                                  02490005
025400     DISPLAY '* ==> ENDING PROCESS GROUP ID  = ' PV-TMST-LAST6.   02500005
025500     DISPLAY '************  END OF WSKUP002  ***************'     02510005
025600                                                                  02520005
025700     STOP RUN.                                                    02530005
025800                                                                  02540005
025900******************************************************************02550005
026000*              I N I T I A L I Z A T I O N                        02560005
026100******************************************************************02570005
026200 1000-INITIALIZE.                                                 02580005
026300                                                                  02590005
026400     INITIALIZE PA-TOTAL-RECS-READ                                02600005
026500                PA-TOTAL-REC1-READ                                02610005
026600                PA-TOTAL-CNTL-WRITTEN                             02620005
026700                PA-TOTAL-XFER-WRITTEN                             02630005
026800                PV-COMMIT-COUNT.                                  02640005
026900                                                                  02650005
027000     SET PS-END-OF-INPUT-NO TO TRUE.                              02660005
027100                                                                  02670005
027200     OPEN INPUT INPUT-FILE.                                       02680005
027300                                                                  02690005
027400* ------------------------------------                            02700005
027500* CREATE THE PROCESS CONTROL TIMESTAMP                            02710005
027600* BY GETTING THE DB2 CURRENT TIMESTAMP                            02720005
027700* ------------------------------------                            02730005
027800     EXEC SQL                                                     02740005
027900         SET :PV-PRC-CNTL-TMST = CURRENT TIMESTAMP                02750005
028000     END-EXEC.                                                    02760005
028100                                                                  02770005
028200     EVALUATE TRUE                                                02780005
028300       WHEN SQLCODE EQUAL +0                                      02790005
028400           MOVE PV-TMST-CCYY     TO PV-WMOS-CCYY                  02800005
028500           MOVE PV-TMST-H1       TO PV-WMOS-H1                    02810005
028600           MOVE PV-TMST-MONTH    TO PV-WMOS-MONTH                 02820005
028700           MOVE PV-TMST-H2       TO PV-WMOS-H2                    02830005
028800           MOVE PV-TMST-DAY      TO PV-WMOS-DAY                   02840005
028900           MOVE PV-TMST-H3       TO PV-WMOS-H3                    02850005
029000           MOVE PV-TMST-HOUR     TO PV-WMOS-HOUR                  02860005
029100           MOVE PV-TMST-P1       TO PV-WMOS-P1                    02870005
029200           MOVE PV-TMST-MINUTE   TO PV-WMOS-MINUTE                02880005
029300           MOVE PV-TMST-P2       TO PV-WMOS-P2                    02890005
029400           MOVE PV-TMST-SECOND   TO PV-WMOS-SECOND                02900005
029500                                                                  02910005
029600           MOVE 'T'  TO PV-WMOS-H3                                02920005
029700           MOVE ':'  TO PV-WMOS-P1                                02930005
029800                        PV-WMOS-P2                                02940005
029900       WHEN OTHER                                                 02950005
030000           MOVE '1000-INITIALIZATION' TO PV-ABEND-PARAGRAPH       02960005
030100           MOVE 'GET DB2 TMST'        TO PV-ABEND-OPERATION       02970005
030200           PERFORM 9900-DB2-ABEND                                 02980005
030300     END-EVALUATE.                                                02990005
030400                                                                  03000005
030500     DISPLAY '* ==> STARTING PROCESS GROUP ID = ' PV-TMST-LAST6.  03010005
030600                                                                  03020005
030700******************************************************************03030005
030800*              READ THE INPUT FILE.                               03040005
030900******************************************************************03050005
031000 1100-READ-INPUT-FILE.                                            03060005
031100                                                                  03070005
031200     READ INPUT-FILE                                              03080005
031300       AT END                                                     03090005
031400         SET PS-END-OF-INPUT-YES TO TRUE.                         03100005
031500                                                                  03110005
031600     IF PS-END-OF-INPUT-NO                                        03120005
031700         ADD +1 TO PA-TOTAL-RECS-READ                             03130005
031800     END-IF.                                                      03140005
031900                                                                  03150005
032000     IF INPUT-CS-HDR                                              03160005
032100         ADD +1 TO PA-TOTAL-REC1-READ                             03170005
032200         SET PS-CURR-TYPE-IS-HDR TO TRUE                          03180005
032300         MOVE INPUT-RECORD TO CE009-SOHDR-DOWNLOAD-REC            03190034
032400     ELSE                                                         03200005
032500         SET PS-CURR-TYPE-IS-DTL TO TRUE                          03210005
032600         MOVE INPUT-RECORD TO CE021-SODTL-DOWNLOAD-REC            03220034
032700     END-IF.                                                      03230005
032800                                                                  03240005
032900*GET DC RELATED TO INPUT LOCATION.                                03250005
033000     PERFORM 1200-GET-LOC-DC.                                     03260005
033100                                                                  03270005
033200******************************************************************03280005
033300 1200-GET-LOC-DC.                                                 03290005
033400                                                                  03300005
033500     MOVE INPUT-LOCATION TO PV-LOC-NBR.                           03310005
033600                                                                  03320005
033700     EXEC SQL                                                     03330005
033800         SELECT DC_NBR                                            03340005
033900           INTO :PV-DC-NBR                                        03350005
034000           FROM XLT_DC_LOC_ASGMT                                  03360005
034100          WHERE LOC_NBR = :PV-LOC-NBR                             03370005
034200     END-EXEC.                                                    03380005
034300                                                                  03390005
034400     EVALUATE TRUE                                                03400005
034500       WHEN SQLCODE EQUAL +0                                      03410005
034600           MOVE PV-DC-NBR  TO INPUT-LOCATION                      03420005
034700                                                                  03430005
034800       WHEN SQLCODE EQUAL +100                                    03440005
034900           MOVE PV-LOC-NBR TO PV-DC-NBR                           03450005
035000                                                                  03460005
035100       WHEN OTHER                                                 03470005
035200           MOVE '1200-GET-LOC-DC ' TO PV-ABEND-PARAGRAPH          03480005
035300           MOVE 'XLT_DC_LOC_ASGMT' TO PV-ABEND-OPERATION          03490005
035400           PERFORM 9900-DB2-ABEND                                 03500005
035500     END-EVALUATE.                                                03510005
035600                                                                  03520005
035700******************************************************************03530005
035800*      PROCESS INPUT STOCK ORDER HEADER AND DETAIL RECORDS        03540005
035900******************************************************************03550005
036000 2000-PROCESS-STOCK-ORDERS.                                       03560005
036100                                                                  03570005
036200     EVALUATE TRUE                                                03580005
036300       WHEN PS-CURR-TYPE-IS-HDR                                   03590020
036400           CONTINUE                                               03600005
036500                                                                  03610005
036600       WHEN PS-CURR-TYPE-IS-DTL                                   03620005
X38216           IF CE021-DISTRO-NUMBER (1:1) = PC-X                    03630034
X38216               PERFORM 2050-WHSE-TRANSFER                         03640005
X38216           ELSE                                                   03641005
P06258            IF (CE021-DEST-ID NOT = PV-DEST-ID)                   03643134
P06258              OR (INPUT-DISTRO(2:5) NOT = PV-DISTRO(2:5))         03643232
036900                DISPLAY 'INPUT-DISTRO/PV-DISTRO = '               03644017
037000                        INPUT-DISTRO ' / ' PV-DISTRO              03645017
037100                DISPLAY 'CE021-DEST-ID/PV-DEST-ID = '             03646034
037200                        CE021-DEST-ID ' / ' PV-DEST-ID            03647034
037300                PERFORM 2100-INSERT-CNTL-ROW                      03648017
037400                MOVE ZEROES TO PV-REC-SEQ-NBR                     03649017
037500                PERFORM 2200-BUILD-CS-HEADER                      03650017
037600                PERFORM 2400-INSERT-XFER-CSHDR                    03660017
037800                PERFORM 2220-PROCESS-HDR-INSTRS                   03680017
037900                MOVE INPUT-DISTRO  TO PV-DISTRO                   03690017
038000                MOVE CE021-DEST-ID TO PV-DEST-ID                  03700034
P06258                MOVE PC-DTL-INSTR TO PV-SPL-INSTR-NBR             03710033
038300            END-IF                                                03730017
P06258                                                                  03731017
P06258           PERFORM 2300-BUILD-CS-DETAIL                           03740017
038600           PERFORM 2410-INSERT-XFER-CSDTL                         03760017
X38216           PERFORM 2310-BUILD-DTL-INSTR                           03780017
P06258           END-IF                                                 03781010
X38216     END-EVALUATE.                                                03790005
038900                                                                  03800005
039000*READ THE NEXT INPUT RECORD.                                      03810005
039100     PERFORM 1100-READ-INPUT-FILE.                                03820005
039200                                                                  03830005
X38216***************************************************************   03840005
X38216** WAREHOUSE TRANSFERS NEED TO CREATE A SEPARATE PICK TICKET      03850005
X38216** FOR EACH SKU ON THE ORDER. THIS IS TO BE DONE REGARDLESS       03860005
X38216** OF CHANGE TO THE INCOMING DISTRO.                              03870005
X38216***************************************************************   03880005
X38216                                                                  03890005
X38216 2050-WHSE-TRANSFER.                                              03900005
X38216                                                                  03901005
X38216     PERFORM 2100-INSERT-CNTL-ROW.                                03902005
X38216     MOVE ZEROES TO PV-REC-SEQ-NBR.                               03903005
X38216     PERFORM 2200-BUILD-CS-HEADER.                                03904005
X38216     PERFORM 2400-INSERT-XFER-CSHDR.                              03905005
X38216     PERFORM 2220-PROCESS-HDR-INSTRS.                             03906005
X38216     PERFORM 2300-BUILD-CS-DETAIL.                                03907007
P06258     MOVE PC-DTL-INSTR TO PV-SPL-INSTR-NBR.                       03907133
X38216     PERFORM 2410-INSERT-XFER-CSDTL.                              03909005
X38216     PERFORM 2310-BUILD-DTL-INSTR.                                03909205
X38216                                                                  03909305
039300******************************************************************03909405
039400*          INSERT ROW TO WMOS REPOSITORY CNTL                     03909505
039500******************************************************************03909605
039600 2100-INSERT-CNTL-ROW.                                            03909705
039700                                                                  03909805
039800     ADD +1              TO PV-TMST-LAST6.                        03909905
039900     MOVE PV-TMST-LAST6  TO PV-PRC-GRP-ID.                        03910005
040000     MOVE INPUT-LOCATION TO PV-LOCATION.                          03920005
040100     MOVE +10.0          TO PV-VERSION-CNTL-NBR.                  03930005
040200                                                                  03940005
040300     EXEC SQL                                                     03950005
040400         INSERT INTO WST_DAT_CNTL                                 03960005
040500             ( TRN_TYP_CDE                                        03970005
040600              ,PRC_GP_ID                                          03980005
040700              ,PRC_CNTL_TMST                                      03990005
040800              ,LOC_NBR                                            04000005
040900              ,STAT_CDE                                           04010005
041000              ,BEG_PRC_TMST                                       04020005
041100              ,END_PRC_TMST                                       04030005
041200              ,DAT_LOD_VER_NBR                                    04040005
041300             )                                                    04050005
041400         VALUES                                                   04060005
041500             (:PC-PKT                                             04070005
041600             ,:PV-PRC-GRP-ID                                      04080005
041700             ,:PV-PRC-CNTL-TMST                                   04090005
041800             ,:PV-LOCATION                                        04100005
041900             ,:PC-READY                                           04110005
042000             ,:PC-DEFAULT-TMST                                    04120005
042100             ,:PC-DEFAULT-TMST                                    04130005
042200             ,:PV-VERSION-CNTL-NBR                                04140005
042300             )                                                    04150005
042400     END-EXEC.                                                    04160005
042500                                                                  04170005
042600     EVALUATE TRUE                                                04180005
042700       WHEN SQLCODE EQUAL +0                                      04190005
042800           ADD +1 TO PA-TOTAL-CNTL-WRITTEN                        04200005
042900                                                                  04210005
043000       WHEN OTHER                                                 04220005
043100           MOVE '2100-INSERT-CNTL-ROW' TO PV-ABEND-PARAGRAPH      04230005
043200           MOVE 'ISRT WST00003'        TO PV-ABEND-OPERATION      04240005
043300           PERFORM 9900-DB2-ABEND                                 04250005
043400     END-EVALUATE.                                                04260005
043500                                                                  04270005
043600******************************************************************04280005
043700*              BUILD CENTRAL STOCK HEADER RECORD                  04290005
043800******************************************************************04300005
043900 2200-BUILD-CS-HEADER.                                            04310005
044000                                                                  04320005
044100     INITIALIZE WS001-PICK-TICKET-HDR.                            04330005
044200     MOVE ZEROES TO PV-SPL-INSTR-NBR.                             04340005
044300                                                                  04350005
044400     MOVE INPUT-ACTION-TYPE      TO WS001-ACTION-TYPE.            04360005
044500*TICKET NUMBER.                                                   04370005
X38216                                                                  04380005
X38216****************************************************************  04390005
X38216** FOR WAREHOUSE TRANSFERS THE FIRST 6 CHARACTERS OF DISTRO       04400005
X38216** NUMBER ARE AN X AND THE LAST FIVE DIGITS OF THE REQUEST        04410005
X38216** NUMBER (PULL NUMBER) AND POS 7 THRU 9 CONTAIN THE LINE         04420005
X38216** ITEM NUMBER.                                                   04430005
X38216************************************************************      04431005
X38216                                                                  04432005
P06258     MOVE CE021-DISTRO-NUMBER    TO PV-IN-DISTRO.                 04433034
044700     MOVE PV-INP-DISTRO-1-6      TO PV-OUT-DISTRO-1-6.            04434005
P06258     IF CE021-DISTRO-NUMBER (1:1) = PC-X                          04438034
P06258         MOVE PV-INP-DISTRO-7-9-N TO PV-OUT-DISTRO-7-10-N         04439029
X38216     ELSE                                                         04440005
P06258         MOVE CE021-DEST-ID      TO PV-OUT-DISTRO-7-10            04450034
X38216     END-IF.                                                      04460005
045300     MOVE PV-OUT-DISTRO          TO WS001-PKT-CTRL-NBR.           04510005
045500*CONVERT KOHLS FOUR-DIGIT LOCATION TO MANHATTAN 3-DIGIT CODE.     04530005
           MOVE INPUT-LOCATION (2:3)    TO WS001-WHSE.                  04560005
045700                                                                  04562005
045800     MOVE SPACES TO WS001-PKT-NBR.                                04563005
045900     MOVE SPACES TO WS001-ORD-NBR.                                04564005
046000*SET ORDER TYPE FOR EACH DISTRO(GW/AB/ST).                        04565005
046100     MOVE 'ST'   TO WS001-ORD-TYPE.                               04566005
046200*GET SHIPPING ADDRESS OF DESTINATION STORE.                       04567005
046300     PERFORM 2210-GET-SHIP-ADDRESS.                               04568005
           MOVE 'E-COMMERCE CENTRAL STOCK'    TO WS001-SOLDTO-NAME.     04569005
           MOVE 'STORE NUMBER - '  TO PV-SOLDTO-ADDR1-1-15.             04570005
049100     MOVE CE021-DEST-ID      TO PV-SOLDTO-ADDR1-16-19.            04580034
049100     MOVE SPACES             TO PV-SOLDTO-75.                     04590005
049100     MOVE PV-SOLDTO-ADDR1    TO WS001-SOLDTO-ADDR-1.              04600005
046400*BLUE MARTINI ORDER NUMBER.                                       04610005
P06258*    MOVE CE021-PO-NUMBER    TO WS001-CUST-PO-NBR.                04620034
046600*CENTRAL STOCK = '01' / RTV = '02' / CUST ORDER = NULL            04630005
046700     MOVE '01'   TO WS001-PKT-TYPE.                               04640005
046800*CUSTOMER ORDER = 'Y' / CENTRAL STOCK ORDER = 'N'                 04650005
046900     MOVE 'N'    TO WS001-CUST-RTE.                               04660005
047000*USE PICK TICKET CONTROL NUMBER.                                  04670005
047100     MOVE WS001-PKT-CTRL-NBR TO WS001-RTE-ATTR.                   04680005
047200*COUNT NUMBER OF ITEMS ON THE SHIPMENT.                           04690005
047300     MOVE ZEROES TO WS001-TOT-NBR-OF-UNITS.                       04700005
047400*DOLLARS AND CENTS.                                               04710005
047500     MOVE ZEROES TO WS001-TOT-DLRS-UNDISC.                        04720005
047600     MOVE ZEROES TO WS001-TOT-DLRS-DISC.                          04730005
047700     MOVE ZEROES TO WS001-PROD-VALUE.                             04740005
047800*ADD = '10' / UPDATE = '10' / CANCEL = '99'                       04750005
047900     MOVE '10'   TO WS001-STAT-CODE.                              04760005
048000*PICK TICKET ROUTING RULES.                                       04770005
048100     MOVE 'Standard  ' TO WS001-RTE-GUIDE-NBR.                    04780005
048200*SET DATES (DATE/TIME FORMAT = CCYYMMDDHH24MISS).                 04790005
048300     MOVE PV-PRC-CNTL-TMST-WMOS TO WS001-ORD-DATE.                04800005
048400     MOVE PV-PRC-CNTL-TMST-WMOS TO WS001-PKT-CURR-DAT-TIME.       04810005
048500     MOVE PV-PRC-CNTL-TMST-WMOS TO WS001-CREATE-DATE-TIME.        04820005
048600     MOVE PV-PRC-CNTL-TMST-WMOS TO WS001-MOD-DATE-TIME.           04830005
048700                                                                  04840005
048800******************************************************************04850005
048900 2210-GET-SHIP-ADDRESS.                                           04860005
049000                                                                  04870005
049100     MOVE CE021-DEST-ID TO DK-LOC-NBR.                            04880034
049200                                                                  04890005
049300     EXEC SQL                                                     04900005
049400         SELECT LOC_NM                                            04910005
049500              , LOC_5_ABBR_NM                                     04920005
049600              , LNE_1_ADDR                                        04930005
049700              , LNE_2_ADDR                                        04940005
049800              , CTY_NM                                            04950005
049900              , ST_CDE                                            04960005
050000              , ZIP_10_CDE                                        04970005
050100           INTO :XLT00010-LOC-NM                                  04980005
050200              , :XLT00010-LOC-5-ABBR-NM                           04990005
050300              , :XLT00010-LNE-1-ADDR                              05000005
050400              , :XLT00010-LNE-2-ADDR                              05010005
050500              , :XLT00010-CTY-NM                                  05020005
050600              , :XLT00010-ST-CDE                                  05030005
050700              , :XLT00010-ZIP-10-CDE                              05040005
050800           FROM XLT_LOC                                           05050005
050900          WHERE LOC_NBR = :DK-LOC-NBR                             05060005
051000     END-EXEC.                                                    05070005
051100                                                                  05080005
051200     EVALUATE TRUE                                                05090005
051300       WHEN SQLCODE EQUAL +0                                      05100005
051400           MOVE PV-DC-NBR  TO INPUT-LOCATION                      05110005
051500           MOVE 'KOHLS - '              TO PV-SHIPTO-NAME-1-8     05120005
051500           MOVE XLT00010-LOC-NM         TO PV-SHIPTO-NAME-9-35    05130005
051500           MOVE PV-SHIPTO-NAME          TO WS001-SHIPTO-NAME      05140005
051500*******    MOVE XLT00010-LOC-NM         TO WS001-SHIPTO-NAME      05150005
051600           MOVE XLT00010-LNE-1-ADDR     TO WS001-SHIPTO-ADDR-1    05160005
051700           MOVE XLT00010-LNE-2-ADDR     TO WS001-SHIPTO-ADDR-2    05170005
051800           MOVE XLT00010-CTY-NM         TO WS001-SHIPTO-CITY      05180005
051900           MOVE XLT00010-ST-CDE         TO WS001-SHIPTO-STATE     05190005
052000           MOVE XLT00010-ZIP-10-CDE     TO WS001-SHIPTO-ZIP       05200005
052100           MOVE 'US '                   TO WS001-SHIPTO-CNTRY     05210005
052200                                                                  05220005
052300       WHEN OTHER                                                 05230005
052400           MOVE '2210-GET-SHIP-ADDRESS' TO PV-ABEND-PARAGRAPH     05240005
052500           MOVE 'SELECT XLT_LOC'        TO PV-ABEND-OPERATION     05250005
052600           PERFORM 9900-DB2-ABEND                                 05260005
052700     END-EVALUATE.                                                05270005
052800                                                                  05280005
052900*jpl**************************************************************05290005
053000 2220-PROCESS-HDR-INSTRS.                                         05300005
053100                                                                  05310005
053200*PKT HDR - 'TT/01'.                                               05320005
053300     ADD 1        TO PV-SPL-INSTR-NBR.                            05330005
053400     MOVE 'TT'    TO PV-SPL-INSTR-TYPE.                           05340005
053500     MOVE '01'    TO PV-SPL-INSTR-CODE.                           05350005
053600     MOVE SPACES  TO PV-SPL-INSTR-DESC.                           05360005
053700     PERFORM 2225-BUILD-HDR-INSTR.                                05370005
053800                                                                  05380005
053900*PKT HDR - 'AZ/01'.                                               05390005
054000     ADD 1        TO PV-SPL-INSTR-NBR.                            05400005
054100     MOVE 'AZ'    TO PV-SPL-INSTR-TYPE.                           05410005
054200     MOVE '01'    TO PV-SPL-INSTR-CODE.                           05420005
054300     MOVE SPACES  TO PV-SPL-INSTR-DESC.                           05430005
054400     MOVE ZEROES  TO PV-SUB-TOTAL-AMT.                            05440005
054500     MOVE ZEROES  TO PV-TOTAL-TAX-AMT.                            05450005
054600     MOVE ZEROES  TO PV-TRAN-DISC-PCT.                            05460005
054700     MOVE ZEROES  TO PV-TRAN-DISC-AMT.                            05470005
054800     MOVE ZEROES  TO PV-SHIP-CHARGE-AMT                           05480005
054900                     PV-SHIP-TAX-PCT                              05490005
055000                     PV-SHIP-TAX-AMT.                             05500005
055100     MOVE ZEROES  TO PV-MVC-SHIP-PCT.                             05510005
055200     MOVE ZEROES  TO PV-TOTAL-AMT.                                05520005
055300     PERFORM 2225-BUILD-HDR-INSTR.                                05530005
055400                                                                  05540005
055500*PKT HDR - 'AZ/02'.                                               05550005
055600     ADD 1        TO PV-SPL-INSTR-NBR.                            05560005
055700     MOVE 'AZ'    TO PV-SPL-INSTR-TYPE.                           05570005
055800     MOVE '02'    TO PV-SPL-INSTR-CODE.                           05580005
055900     MOVE SPACES  TO PV-SPL-INSTR-DESC.                           05590005
056000     MOVE SPACES  TO PV-GIFT-RCPT-ID.                             05600005
056100     PERFORM 2225-BUILD-HDR-INSTR.                                05610005
056200                                                                  05620005
056300******************************************************************05630005
056400 2225-BUILD-HDR-INSTR.                                            05640005
056500                                                                  05650005
056600     INITIALIZE WS003-PICK-TICKET-INST.                           05660005
056700                                                                  05670005
056800     MOVE WS001-ACTION-TYPE  TO WS003-ACTION-TYPE.                05680005
056900                                                                  05690005
057000*DISTRO#.                                                         05700005
057100     MOVE WS001-PKT-CTRL-NBR TO WS003-PKT-CTRL-NBR.               05710005
057200*SEQUENCE#.                                                       05720005
057300     MOVE PV-SPL-INSTR-NBR   TO WS003-SPL-INSTR-NBR.              05730005
057400*LINE#.                                                           05740005
057500     MOVE ZEROES             TO WS003-PKT-SEQ-NBR.                05750005
057600                                                                  05760005
057700*LOAD VARIABLE DATA.                                              05770005
057800     MOVE PV-SPL-INSTR-TYPE  TO WS003-SPL-INSTR-TYPE.             05780005
057900     MOVE PV-SPL-INSTR-CODE  TO WS003-SPL-INSTR-CODE.             05790005
058000     MOVE PV-SPL-INSTR-DESC  TO WS003-SPL-INSTR-DESC.             05800005
058100     MOVE SPACES             TO WS003-PKT-PROFILE-ID.             05810005
058200                                                                  05820005
058300     MOVE WS001-CREATE-DATE-TIME TO WS003-CREATE-DATE-TIME.       05830005
058400     MOVE WS001-MOD-DATE-TIME    TO WS003-MOD-DATE-TIME.          05840005
058500                                                                  05850005
058600     PERFORM 2425-INSERT-XFER-CSHINSTR.                           05860005
058700                                                                  05870005
058800******************************************************************05880005
058900*          BUILD STOCK ORDER DETAIL RECORD                        05890005
059000******************************************************************05900005
059100 2300-BUILD-CS-DETAIL.                                            05910005
059200                                                                  05920005
059300     INITIALIZE WS002-PICK-TICKET-DTL.                            05930005
059400                                                                  05940005
059500     MOVE INPUT-ACTION-TYPE      TO WS002-ACTION-TYPE.            05950005
059600*TICKET NUMBER.                                                   05960005
X38216                                                                  05961005
X38216****************************************************************  05962005
X38216** FOR WAREHOUSE TRANSFERS THE FIRST 6 CHARACTERS OF DISTRO       05963005
X38216** NUMBER ARE AN X AND THE LAST FIVE DIGITS OF THE REQUEST        05964005
X38216** NUMBER (PULL NUMBER) AND POS 7 THRU 9 CONTAIN THE LINE         05965005
X38216** ITEM NUMBER. WAREHOUSE TRANSFERS ALSO REQUIRE THE              05966005
X38216** CARTON BREAK ATTR TO BE SET TO THE LINE NUMBER.                05967005
X38216************************************************************      05968005
X38216                                                                  05969005
X38216     MOVE CE021-DISTRO-NUMBER    TO PV-IN-DISTRO.                 05970034
059800     MOVE PV-INP-DISTRO-1-6      TO PV-OUT-DISTRO-1-6.            05980005
X38216                                                                  05981005
X38216                                                                  05982105
X38216     IF CE021-DISTRO-NUMBER (1:1) = PC-X                          05982234
P06258         MOVE PV-INP-DISTRO-7-9-N  TO PV-OUT-DISTRO-7-10-N        05982329
P06258         MOVE PV-INP-DISTRO-7-9  TO WS002-CARTON-BREAK-ATTR       05982429
P06258         MOVE 1                  TO WS002-PKT-SEQ-NBR             05982528
X38216     ELSE                                                         05982605
P06258         MOVE CE021-DEST-ID      TO PV-OUT-DISTRO-7-10            05982734
P06258         MOVE CE021-DISTRO-NUMBER(7:3)                            05982834
X38216                                 TO WS002-PKT-SEQ-NBR             05982905
X38216     END-IF.                                                      05983005
X38216                                                                  05984005
X38216                                                                  05985005
060000     MOVE PV-OUT-DISTRO          TO WS002-PKT-CTRL-NBR.           05986005
X38216                                                                  05987005
060400*SKU NUMBER.                                                      06000005
060500     MOVE CE021-SKU              TO WS002-SKU-ID                  06010034
060600                                    WS002-STYLE-SFX.              06020005
060700*SKU QUANTITY.                                                    06030005
060800     MOVE CE021-RQST-UNIT-QTY    TO WS002-ORIG-ORD-QTY            06040034
060900                                    WS002-ORIG-PKT-QTY.           06050005
061000*CARTON TYPE = STD/BAG                                            06060005
061100     MOVE 'BOX' TO WS002-CARTON-TYPE.                             06070005
061200*CHUTE ASSIGNMENT - STD/CAG                                       06080005
061300     MOVE 'STD' TO WS002-CHUTE-ASSIGN-TYPE.                       06090005
061400*SET DATES (DATE/TIME FORMAT = CCYYMMDDHH24MISS).                 06100005
061500     MOVE PV-PRC-CNTL-TMST-WMOS TO WS002-CREATE-DATE-TIME         06110005
061600                                   WS002-MOD-DATE-TIME.           06120005
061700                                                                  06130005
061800*JPL**************************************************************06140005
061900 2310-BUILD-DTL-INSTR.                                            06150005
062000                                                                  06160005
062100***********                                                       06170005
062200* 'AZ/01' *                                                       06180005
062300***********                                                       06190005
062400     INITIALIZE WS003-PICK-TICKET-INST.                           06200005
062500                                                                  06210005
062600     MOVE CE021-ACTION-TYPE        TO WS003-ACTION-TYPE.          06220034
062700*TICKET NUMBER.                                                   06230005
062800     MOVE WS002-PKT-CTRL-NBR       TO WS003-PKT-CTRL-NBR.         06240005
062900*LINE NUMBER.                                                     06250009
P06258     MOVE WS002-PKT-SEQ-NBR        TO WS003-PKT-SEQ-NBR.          06251009
063100*SEQUENCE#.                                                       06270005
063200     ADD 1        TO PV-SPL-INSTR-NBR.                            06280005
063300                                                                  06290005
063400     MOVE 'AZ'    TO PV-SPL-INSTR-TYPE.                           06300005
063500     MOVE '01'    TO PV-SPL-INSTR-CODE.                           06310005
063600     MOVE SPACES  TO PV-SPL-INSTR-DESC.                           06320005
063700*LOAD VARIABLE DATA.                                              06330005
063900     MOVE ZEROES  TO PV-ITEM-UNIT-PRICE                           06350005
064100                     PV-ITEM-TAX-RATE.                            06370031
064500                                                                  06410005
064600     MOVE PV-SPL-INSTR-NBR   TO WS003-SPL-INSTR-NBR.              06420005
064700     MOVE PV-SPL-INSTR-TYPE  TO WS003-SPL-INSTR-TYPE.             06430005
064800     MOVE PV-SPL-INSTR-CODE  TO WS003-SPL-INSTR-CODE.             06440005
065000     MOVE SPACES             TO WS003-PKT-PROFILE-ID.             06450005
065100                                                                  06460005
065200     MOVE WS002-CREATE-DATE-TIME TO WS003-CREATE-DATE-TIME.       06470005
065300     MOVE WS002-MOD-DATE-TIME    TO WS003-MOD-DATE-TIME.          06480005
060500     MOVE CE021-SKU              TO DK-NIS-SKU.                   06490034
065400                                                                  06500005
065500     PERFORM 4050-SELECT-UPC.                                     06510005
                                                                        06520005
064900     MOVE CEPLIT-UNT-RTL-AMT TO PV-ITEM-UNIT-PRICE.               06530005
064900     MOVE PV-SPL-INSTR-DESC  TO WS003-SPL-INSTR-DESC.             06540005
065500     PERFORM 2420-INSERT-XFER-CSINSTR.                            06540105
065600                                                                  06540205
065700***********                                                       06540305
065800* 'AZ/02' *                                                       06540405
065900***********                                                       06540505
066000     INITIALIZE WS003-PICK-TICKET-INST.                           06540605
066100                                                                  06540705
066200     MOVE CE021-ACTION-TYPE        TO WS003-ACTION-TYPE.          06540834
066300*TICKET NUMBER.                                                   06540905
066400     MOVE WS002-PKT-CTRL-NBR       TO WS003-PKT-CTRL-NBR.         06541005
066500*LINE NUMBER.                                                     06542009
P06258     MOVE WS002-PKT-SEQ-NBR        TO WS003-PKT-SEQ-NBR.          06542109
066700*SEQUENCE#.                                                       06544005
066800     ADD 1        TO PV-SPL-INSTR-NBR.                            06545005
066900                                                                  06546005
067000     MOVE 'AZ'    TO PV-SPL-INSTR-TYPE.                           06547005
067100     MOVE '02'    TO PV-SPL-INSTR-CODE.                           06548005
067200     MOVE SPACES  TO PV-SPL-INSTR-DESC.                           06549005
067300*LOAD VARIABLE DATA.                                              06550005
067400     MOVE 'N'     TO PV-ITEM-GIFT-IND                             06560005
067500                     PV-ITEM-GIFT-WRAP-IND.                       06570005
067600                                                                  06580005
067700     MOVE PV-SPL-INSTR-NBR   TO WS003-SPL-INSTR-NBR.              06590005
067800     MOVE PV-SPL-INSTR-TYPE  TO WS003-SPL-INSTR-TYPE.             06600005
067900     MOVE PV-SPL-INSTR-CODE  TO WS003-SPL-INSTR-CODE.             06610005
           MOVE PV-SAVE-UPC-NBR    TO PV-ITEM-UPC-NBR.                  06620005
068000     MOVE PV-SPL-INSTR-DESC  TO WS003-SPL-INSTR-DESC.             06630005
068100     MOVE SPACES             TO WS003-PKT-PROFILE-ID.             06640005
068200                                                                  06650005
068300     MOVE WS002-CREATE-DATE-TIME TO WS003-CREATE-DATE-TIME.       06660005
068400     MOVE WS002-MOD-DATE-TIME    TO WS003-MOD-DATE-TIME.          06670005
068500                                                                  06680005
068600     PERFORM 2420-INSERT-XFER-CSINSTR.                            06690005
068700                                                                  06700005
068800***********                                                       06710005
068900* 'GW/01' *                                                       06720005
069000***********                                                       06730005
069100     INITIALIZE WS003-PICK-TICKET-INST.                           06740005
069200                                                                  06750005
069300     MOVE CE021-ACTION-TYPE        TO WS003-ACTION-TYPE.          06760034
069400*TICKET NUMBER.                                                   06770005
069500     MOVE WS002-PKT-CTRL-NBR       TO WS003-PKT-CTRL-NBR.         06780005
069600*LINE NUMBER.                                                     06790005
P06258     MOVE WS002-PKT-SEQ-NBR        TO WS003-PKT-SEQ-NBR.          06791009
069800*SEQUENCE#.                                                       06810005
069900     ADD 1        TO PV-SPL-INSTR-NBR.                            06820005
070000                                                                  06830005
070100     MOVE 'GW'    TO PV-SPL-INSTR-TYPE.                           06840005
070200     MOVE '01'    TO PV-SPL-INSTR-CODE.                           06850005
070300     MOVE SPACES  TO PV-SPL-INSTR-DESC.                           06860005
070400*LOAD VARIABLE DATA.                                              06870005
070500     MOVE SPACES  TO PV-SPL-INSTR-DESC.                           06880005
070600     MOVE 0       TO PV-GW-DUMMY-QTY.                             06890005
070700     MOVE 0.00    TO PV-GW-DUMMY-PRICE.                           06900005
070800                                                                  06910005
070900     MOVE PV-SPL-INSTR-NBR   TO WS003-SPL-INSTR-NBR.              06920005
071000     MOVE PV-SPL-INSTR-TYPE  TO WS003-SPL-INSTR-TYPE.             06930005
071100     MOVE PV-SPL-INSTR-CODE  TO WS003-SPL-INSTR-CODE.             06940005
071200     MOVE PV-SPL-INSTR-DESC  TO WS003-SPL-INSTR-DESC.             06950005
071300     MOVE SPACES             TO WS003-PKT-PROFILE-ID.             06960005
071400                                                                  06970005
071500     MOVE WS002-CREATE-DATE-TIME   TO WS003-CREATE-DATE-TIME.     06980005
071600     MOVE WS002-MOD-DATE-TIME      TO WS003-MOD-DATE-TIME.        06990005
071700                                                                  07000005
071800     PERFORM 2420-INSERT-XFER-CSINSTR.                            07010005
071900                                                                  07020005
072000******************************************************************07030005
072100*          INSERT ROW TO WMOS REPOSITORY DATA                     07040005
072200******************************************************************07050005
072300 2400-INSERT-XFER-CSHDR.                                          07060005
072400                                                                  07070005
072500     INITIALIZE WST00004-LOD-DAT-TXT.                             07080005
072600                                                                  07090005
072700     MOVE WS001-PICK-TICKET-HDR                                   07100005
072800       TO WST00004-LOD-DAT-TXT-TEXT.                              07110005
072900     MOVE LENGTH OF WS001-PICK-TICKET-HDR                         07120005
073000       TO WST00004-LOD-DAT-TXT-LEN.                               07130005
073100                                                                  07140005
073200     IF INPUT-ACTION-TYPE = 'A'                                   07150005
073300         MOVE 'PKTCRE          ' TO PV-RDM-PRC-TYP-CDE            07160005
073400     END-IF.                                                      07170005
073500     IF INPUT-ACTION-TYPE = 'M' OR 'C'                            07180005
073600         MOVE 'PKTMOD          ' TO PV-RDM-PRC-TYP-CDE            07190005
073700     END-IF.                                                      07200005
073800     IF INPUT-ACTION-TYPE = 'D'                                   07210005
073900         MOVE 'PKTDEL          ' TO PV-RDM-PRC-TYP-CDE            07220005
074000     END-IF.                                                      07230005
074100     ADD +1 TO PV-REC-SEQ-NBR.                                    07240005
074200                                                                  07250005
074300     PERFORM 2450-INSERT-XFER-ROW.                                07260005
074400                                                                  07270005
074500******************************************************************07280005
074600 2410-INSERT-XFER-CSDTL.                                          07290005
074700                                                                  07300005
074800     INITIALIZE WST00004-LOD-DAT-TXT.                             07310005
074900                                                                  07320005
075000     MOVE WS002-PICK-TICKET-DTL                                   07330005
075100       TO WST00004-LOD-DAT-TXT-TEXT.                              07340005
075200     MOVE LENGTH OF WS002-PICK-TICKET-DTL                         07350005
075300       TO WST00004-LOD-DAT-TXT-LEN.                               07360005
075400     MOVE 'PKTDCRE         ' TO PV-RDM-PRC-TYP-CDE                07370005
075500                                                                  07380005
075600     ADD +1 TO PV-REC-SEQ-NBR.                                    07390005
075700                                                                  07400005
075800     PERFORM 2450-INSERT-XFER-ROW.                                07410005
075900                                                                  07420005
076000******************************************************************07430005
076100 2420-INSERT-XFER-CSINSTR.                                        07440005
076200                                                                  07450005
076300     INITIALIZE WST00004-LOD-DAT-TXT.                             07460005
076400                                                                  07470005
076500     MOVE WS003-PICK-TICKET-INST                                  07480005
076600       TO WST00004-LOD-DAT-TXT-TEXT.                              07490005
076700     MOVE LENGTH OF WS003-PICK-TICKET-INST                        07500005
076800       TO WST00004-LOD-DAT-TXT-LEN.                               07510005
076900     MOVE 'PKTDICRE        ' TO PV-RDM-PRC-TYP-CDE                07520005
077000                                                                  07530005
077100     ADD +1 TO PV-REC-SEQ-NBR.                                    07540005
077200                                                                  07550005
077300     PERFORM 2450-INSERT-XFER-ROW.                                07560005
077400                                                                  07570005
077500******************************************************************07580005
077600 2425-INSERT-XFER-CSHINSTR.                                       07590005
077700                                                                  07600005
077800     INITIALIZE WST00004-LOD-DAT-TXT.                             07610005
077900                                                                  07620005
078000     MOVE WS003-PICK-TICKET-INST                                  07630005
078100       TO WST00004-LOD-DAT-TXT-TEXT.                              07640005
078200     MOVE LENGTH OF WS003-PICK-TICKET-INST                        07650005
078300       TO WST00004-LOD-DAT-TXT-LEN.                               07660005
078400     MOVE 'PKTHICRE        ' TO PV-RDM-PRC-TYP-CDE                07670005
078500                                                                  07680005
078600     ADD +1 TO PV-REC-SEQ-NBR.                                    07690005
078700                                                                  07700005
078800     PERFORM 2450-INSERT-XFER-ROW.                                07710005
078900                                                                  07720005
079000******************************************************************07730005
079100 2450-INSERT-XFER-ROW.                                            07740005
079200                                                                  07750005
079300     EXEC SQL                                                     07760005
079400         INSERT INTO WST_DAT_XFER                                 07770005
079500             ( TRN_TYP_CDE                                        07780005
079600              ,PRC_GP_ID                                          07790005
079700              ,PRC_CNTL_TMST                                      07800005
079800              ,PRC_LOD_SEQ_ID                                     07810005
079900              ,RDM_PRC_TYP_CDE                                    07820005
080000              ,LOD_DAT_TXT                                        07830005
080100             )                                                    07840005
080200         VALUES                                                   07850005
080300             (:PC-PKT                                             07860005
080400             ,:PV-PRC-GRP-ID                                      07870005
080500             ,:PV-PRC-CNTL-TMST                                   07880005
080600             ,:PV-REC-SEQ-NBR                                     07890005
080700             ,:PV-RDM-PRC-TYP-CDE                                 07900005
080800             ,:WST00004-LOD-DAT-TXT                               07910005
080900             )                                                    07920005
081000     END-EXEC.                                                    07930005
081100                                                                  07940005
081200     EVALUATE TRUE                                                07950005
081300       WHEN SQLCODE EQUAL +0                                      07960005
081400           ADD +1 TO PA-TOTAL-XFER-WRITTEN                        07970005
081500                     PV-COMMIT-COUNT                              07980005
081600           IF PV-COMMIT-COUNT > 999                               07990005
081700               DISPLAY '3000-COMMIT COUNT = ' PV-COMMIT-COUNT     08000005
081800               PERFORM 3000-COMMIT                                08010005
081900               MOVE ZEROES TO PV-COMMIT-COUNT                     08020005
082000           END-IF                                                 08030005
082100                                                                  08040005
082200       WHEN OTHER                                                 08050005
082300           MOVE '2450-INSERT-XFER-ROW' TO PV-ABEND-PARAGRAPH      08060005
082400           MOVE 'ISRT WST00004'        TO PV-ABEND-OPERATION      08070005
082500           PERFORM 9900-DB2-ABEND                                 08080005
082600     END-EVALUATE.                                                08090005
082700                                                                  08100005
082800******************************************************************08110005
082900*          PERFORM DB2 COMMIT EVERY 1000 ROWS                     08120005
083000******************************************************************08130005
083100 3000-COMMIT.                                                     08140005
083200                                                                  08150005
083300     EXEC SQL                                                     08160005
083400         COMMIT                                                   08170005
083500     END-EXEC.                                                    08180005
083600                                                                  08190005
083700     EVALUATE TRUE                                                08200005
083800       WHEN SQLCODE EQUAL +0                                      08210005
083900           CONTINUE                                               08220005
084000                                                                  08230005
084100       WHEN OTHER                                                 08240005
084200           MOVE '3000-COMMIT'         TO PV-ABEND-PARAGRAPH       08250005
084300           MOVE 'COMMIT WFT_DAT_XFER' TO PV-ABEND-OPERATION       08260005
084400           PERFORM 9900-DB2-ABEND                                 08270005
084500     END-EVALUATE.                                                08280005
084600                                                                  08290005
173500****************************************************************  08300005
173600*                                                              *  08310005
173700*                                                              *  08320005
173800****************************************************************  08330005
173900 4050-SELECT-UPC.                                                 08340005
174000     MOVE '4050-UPC' TO PV-ABEND-PARAGRAPH.                       08350005
174100***  DISPLAY 'NOW IN 4050-SELECT-UPC'                             08360005
174200                                                                  08370005
175200         EXEC SQL                                                 08380005
175300             SELECT DISTINCT                                      08390005
175400                A.UNT_RTL_AMT                                     08400005
175400               ,C.SKU_DESC                                        08410005
175500               ,B.UPC_NBR                                         08420005
175600             INTO :CEPLIT-UNT-RTL-AMT                             08430005
175600                 ,:XLT00003-SKU-DESC                              08440005
175700                 ,:XLT00006-UPC-NBR                               08450005
175900             FROM TCEPLIT   A                                     08460005
175900                , XLT_UPC   B                                     08470005
176000                , XLT_SKU   C                                     08470105
176400             WHERE C.INTR_UPC_ID = B.INTR_UPC_ID                  08470205
                     AND C.ITM_NBR     = A.ITM_NBR                      08470305
                     AND C.SKU_NBR     = :DK-NIS-SKU                    08470405
                     AND B.UPC_TYP_CDE = 'V'                            08470505
176600              WITH UR                                             08470605
176700         END-EXEC.                                                08470705
176800                                                                  08470805
176900         EVALUATE TRUE                                            08470905
177000             WHEN SQLCODE = ZERO                                  08471005
177100             WHEN SQLCODE = -811                                  08471105
178800                 MOVE XLT00006-UPC-NBR  TO PV-SAVE-UPC-NBR        08471205
178900                 MOVE XLT00003-SKU-DESC  TO PV-ITEM-DESCRIPTION   08471305
 77200             WHEN SQLCODE = +100                                  08471405
178800                 PERFORM 4060-SELECT-INT-UPC                      08471505
 77200             WHEN OTHER                                           08471605
179400                 MOVE 'XLT_SKU JOIN' TO PV-ABEND-OPERATION        08471705
179900                 PERFORM 9900-DB2-ABEND                           08471805
178100         END-EVALUATE.                                            08471905
178300                                                                  08472005
173500****************************************************************  08473005
173600*                                                              *  08473105
173700*                                                              *  08473205
173800****************************************************************  08473305
173900 4060-SELECT-INT-UPC.                                             08473405
174000     MOVE '4060-UPC' TO PV-ABEND-PARAGRAPH.                       08473505
174100***  DISPLAY 'NOW IN 4060-SELECT-UPC'                             08473605
174200                                                                  08473705
175200         EXEC SQL                                                 08473805
175300             SELECT DISTINCT                                      08473905
175400                A.UNT_RTL_AMT                                     08474005
175400               ,C.SKU_DESC                                        08475005
175500               ,B.UPC_NBR                                         08475105
175600             INTO :CEPLIT-UNT-RTL-AMT                             08475205
175600                 ,:XLT00003-SKU-DESC                              08475305
175700                 ,:XLT00006-UPC-NBR                               08475405
175900             FROM TCEPLIT   A                                     08475505
175900                , XLT_UPC   B                                     08475605
176000                , XLT_SKU   C                                     08475705
176400             WHERE C.INTR_UPC_ID = B.INTR_UPC_ID                  08475805
                     AND C.ITM_NBR     = A.ITM_NBR                      08475905
                     AND C.SKU_NBR     = :DK-NIS-SKU                    08476005
                     AND B.UPC_TYP_CDE = 'I'                            08476105
176600              WITH UR                                             08476205
176700         END-EXEC.                                                08476305
176800                                                                  08476405
176900         EVALUATE TRUE                                            08476505
177000             WHEN SQLCODE = ZERO                                  08476605
177100             WHEN SQLCODE = -811                                  08476705
178800                 MOVE XLT00006-UPC-NBR  TO PV-SAVE-UPC-NBR        08476805
178900                 MOVE XLT00003-SKU-DESC  TO PV-ITEM-DESCRIPTION   08476905
 77200             WHEN SQLCODE = +100                                  08477005
178800                 MOVE ZEROS               TO PV-SAVE-UPC-NBR      08477105
178900                 MOVE '* DESC NOT FOUND *'                        08477205
178900                           TO PV-ITEM-DESCRIPTION                 08477305
 77200             WHEN OTHER                                           08477405
179400                 MOVE 'XLT_SKU JOIN' TO PV-ABEND-OPERATION        08477505
179900                 PERFORM 9900-DB2-ABEND                           08477605
178100         END-EVALUATE.                                            08477705
178300                                                                  08477805
084700******************************************************************08477905
084800*          A B E N D   P R O C E S S I N G                        08478005
084900******************************************************************08478105
085000 9900-DB2-ABEND.                                                  08478205
085100                                                                  08478305
085200     MOVE SQLCODE    TO PV-SQLCODE.                               08478405
085300     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       08478505
085400                                                                  08478605
085500     DISPLAY '*** DB2 ERROR ***'.                                 08478705
085600     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               08478805
085700     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 08478905
085800     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               08479005
085900     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               08480005
086000                                                                  08490005
086100******************************************************************08500005
086200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    08510005
086300* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         08520005
086400* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     08530005
086500* FORMAT.                                                         08540005
086600******************************************************************08550005
086700     COPY DPPD004.                                                08560005
086800                                                                  08570005
086900     IF SQLCODE NOT EQUAL -911                                    08580005
087000         EXEC SQL                                                 08590005
087100             ROLLBACK                                             08600005
087200         END-EXEC                                                 08610005
087300     END-IF.                                                      08620005
087400                                                                  08630005
087500     MOVE +4013         TO PV-ABEND-CODE.                         08640005
087600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08650005
087700                                                                  08660005
087800******************************************************************08670005
087900******************************************************************08680005
