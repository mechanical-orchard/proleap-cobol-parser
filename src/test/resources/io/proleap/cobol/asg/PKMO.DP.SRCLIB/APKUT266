000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT266.                                        00020000
000300 AUTHOR.         R NOHE                                           00030000
000400*DATE-WRITTEN.   JAN 02, 2007.                                    00040009
000500*DATE-COMPILED.                                                   00050000
000600*************************************************************     00060000
000700*    COBOL 2                                                *     00070000
000800*                                                           *     00080000
000900*    BUMP INVOICE TO RECEIVING TO PULL OFF THE RECEIVING    *     00090000
001000*    DETAIL WHERE THE INVOICE HAS NO DETAIL ENTERED         *     00100000
001100*                                                           *     00110000
001200*************************************************************     00120000
001300*                                                           *     00130000
001400* INPUT                                                     *     00140000
001500* INP01   -  INVOICE EXTRACT FILE - SORTED INTO PO/DC       *     00150008
001510*            SEQUENCE.                                      *     00151008
001600* INP02   -  DUMP OF RECEIVE UNMATCHED FILE FROM APKUT041.  *     00160008
001800*                                                           *     00180000
001900* OUTPUT                                                    *     00190000
002000* OUT01   -  RECEIVING DETAIL FILE THAT MATCHES INVOICES    *     00200000
002100*            WITH NO DETAIL ENTERED                         *     00210000
002200*            ALL REPORT TYPE 01 AND 02 RECORDS              *     00220000
002300*************************************************************     00230000
002400* CHANGE LOG:                                               *     00240000
002500*                                                           *     00250000
002600* 03/11/07 - INITIAL VERSION.                               *     00260013
002610*            MATCH BY DC PROJECT.                           *     00261008
002620*       BY: ROLF NOHE                WR/IF #: WR21578       *     00262007
002700*                                                           *     00270000
002701* DATE  11/14/2014                                          *     00280014
002702*      RECOMPILED THE PROGRAM. CHANGES WERE MADE TO APRD271 *     00290014
002703*      COPYBOOK.                                            *     00300014
002704*      MADE BY: COGNIZANT              WR/IR: CHG0094517    *     00310014
002700*                                                           *     00311015
002701* DATE  05/11/2021                                          *     00312015
002702*      RECOMPILED FOR UPDATED APWS008 COPYBOOK              *     00313015
002704*      MADE BY: JEAN KURK              WR/IR: CHG0256545    *     00314115
003150*************************************************************     00315000
003160                                                                  00316000
003170 ENVIRONMENT DIVISION.                                            00317000
003180                                                                  00318000
003190 INPUT-OUTPUT SECTION.                                            00319000
003200                                                                  00320000
003300 FILE-CONTROL.                                                    00330000
003400     SELECT DC-INVOICES-FILE    ASSIGN    TO UT-S-INP01.          00340001
003500     SELECT RCV-UNMTCH-FILE     ASSIGN    TO UT-S-INP02.          00350001
003600     SELECT UPDT-DTL-ENTRY-FILE ASSIGN    TO UT-S-OUT01.          00360001
003800 DATA DIVISION.                                                   00380000
003900                                                                  00390000
004000 FILE SECTION.                                                    00400000
004100 FD  DC-INVOICES-FILE                                             00410001
004200         LABEL RECORDS  ARE STANDARD                              00420000
004300         RECORDING MODE IS  F                                     00430000
004400         DATA RECORD    IS  DC-INVOICE-RECORD.                    00440001
004500                                                                  00450000
004600 01  DC-INVOICE-RECORD             PIC X(175).                    00460011
004700                                                                  00470000
004710 FD  RCV-UNMTCH-FILE                                              00471001
004720         LABEL RECORDS  ARE STANDARD                              00472001
004730         RECORDING MODE IS  F                                     00473001
004740         DATA RECORD    IS  RCV-UNMTCH-RECORD.                    00474001
004750                                                                  00475001
004760 01  RCV-UNMTCH-RECORD             PIC X(150).                    00476001
004770                                                                  00477001
005500 FD  UPDT-DTL-ENTRY-FILE                                          00550000
005600         LABEL RECORDS  ARE STANDARD                              00560000
005700         RECORDING MODE IS  F                                     00570000
005800         DATA RECORD    IS  UPDT-DTL-ENTRY-RECORD.                00580000
005900                                                                  00590000
006000 01  UPDT-DTL-ENTRY-RECORD         PIC X(150).                    00600000
006100                                                                  00610000
006470/                                                                 00647000
006480 WORKING-STORAGE SECTION.                                         00648000
006490                                                                  00649000
006500 01  FILLER                           PIC X(25) VALUE             00650001
006600                             'WS FOR APKUT266 BEGINS==>'.         00660002
006700 01  ABEND-CODE                       PIC S9(4) COMP SYNC         00670001
006800                                                VALUE ZEROS.      00680001
006900                                                                  00690000
007000 01  PV-ABEND-FIELDS.                                             00700000
007100     05  PV-ABEND-PROGRAM             PIC X(08) VALUE 'APKUT266'. 00710002
007200     05  PV-ABEND-SQLCODE             PIC X(04) VALUE SPACES.     00720001
007300     05  PV-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     00730000
007400     05  PV-ABEND-OPERATION           PIC X(50) VALUE SPACES.     00740000
007500     05  PV-ABEND-STRUCTURE-1         PIC X(08) VALUE SPACES.     00750001
007600     05  PV-ABEND-STRUCTURE-2         PIC X(08) VALUE SPACES.     00760001
007700     05  PV-ABEND-STRUCTURE-3         PIC X(08) VALUE SPACES.     00770001
007800     05  PV-ABEND-STRUCTURE-4         PIC X(08) VALUE SPACES.     00780001
007900     05  PV-ABEND-STATUS              PIC X(02) VALUE SPACES.     00790001
008000                                                                  00800000
008100 01  PV-WORK-AREA.                                                00810000
008200     05  PV-PROGRAM-NAME              PIC X(08) VALUE 'APKUT266'. 00820001
008300     05  PV-DC-INVC-IN-REC-CNT        PIC 9(09) VALUE 0.          00830001
008400     05  PV-RCV-UNMTCH-REC-CNT        PIC 9(09) VALUE 0.          00840001
008500     05  PV-RECEIV-OUT-REC-CNT        PIC 9(09) VALUE 0.          00850001
008900                                                                  00890001
009000 01  PV-SWITCHES.                                                 00900000
009100     05  END-OF-DC-INVC-SW            PIC X(01) VALUE 'N'.        00910001
009200         88  END-OF-DC-INVC                     VALUE 'Y'.        00920001
009300         88  NOT-END-OF-DC-INVC                 VALUE 'N'.        00930001
009400     05  END-OF-RCV-UNMTCH-SW         PIC X(01) VALUE 'N'.        00940002
009500         88  END-OF-RCV-UNMTCH                  VALUE 'Y'.        00950002
009600         88  NOT-END-OF-RCV-UNMTCH              VALUE 'N'.        00960002
009700     05  END-OF-RECEIV-POLINE-SW      PIC X(01) VALUE 'N'.        00970001
009800         88  END-OF-RECEIV-PO-LNE-REC           VALUE 'Y'.        00980001
009900         88  NOT-END-OF-RECEIV-PO-LNE-REC       VALUE 'N'.        00990001
010000                                                                  01000000
010100 01  FILLER                           PIC X(35)  VALUE            01010001
010200     'BEGINNING OF AP060 INPUT FILE    **'.                       01020000
010300     COPY APRD060.                                                01030000
010400                                                                  01040000
010500 01  FILLER                           PIC X(35)  VALUE            01050001
010600     'BEGINNING OF AP271 OUTPUT FILE   **'.                       01060000
010700     COPY APRD271.                                                01070000
010800                                                                  01080000
010900 01  FILLER                           PIC X(35)  VALUE            01090001
011000     'END OF AP WORK RECORD AREA       **'.                       01100000
011100                                                                  01110000
011200 01  FILLER                           PIC X(25) VALUE             01120001
011300          '<====PV FOR APKUT266 ENDS'.                            01130001
011400                                                                  01140000
011500*LINKAGE SECTION.                                                 01150000
011600                                                                  01160000
011700                                                                  01170000
011800 PROCEDURE DIVISION.                                              01180000
011900                                                                  01190000
012000 A100-MAINLINE.                                                   01200000
012100                                                                  01210000
012302     PERFORM H100-HOUSEKEEPING.                                   01230200
012303                                                                  01230300
012304     PERFORM B100-PROCESSING                                      01230400
012305        UNTIL END-OF-DC-INVC                                      01230502
012306           OR END-OF-RCV-UNMTCH                                   01230602
012307           OR END-OF-RECEIV-PO-LNE-REC.                           01230700
012308                                                                  01230800
012309     IF NOT END-OF-RCV-UNMTCH                                     01230902
012310        PERFORM B300-PROCESS-REST                                 01231000
012320           UNTIL END-OF-RCV-UNMTCH                                01232002
012330     END-IF.                                                      01233000
012340                                                                  01234000
012350     PERFORM Z900-END-OF-JOB.                                     01235000
012360                                                                  01236000
012370     GOBACK.                                                      01237000
012380        EJECT                                                     01238000
012390                                                                  01239000
012400 B100-PROCESSING.                                                 01240000
012800     MOVE 'B100-PROCESSING  '    TO PV-ABEND-PARAGRAPH.           01280000
012900                                                                  01290000
013000     IF AP060-PO-NBR =  AP271-PURCHASE-ORDER                      01300000
013100        IF AP060-MTCH-LOC-NBR = 0                                 01310000
013200          PERFORM B200-PROCESS-UPDT                               01320000
013300             UNTIL END-OF-RCV-UNMTCH         OR                   01330002
013400                   END-OF-RECEIV-PO-LNE-REC  OR                   01340000
013500                  (AP060-PO-NBR NOT = AP271-PURCHASE-ORDER)       01350000
013600           PERFORM R100-READ-DC-INVC                              01360002
013700        ELSE                                                      01370000
013800           IF AP060-MTCH-LOC-NBR = AP271-DC-NBR                   01380005
013900              PERFORM B200-PROCESS-UPDT                           01390000
014000               UNTIL END-OF-RCV-UNMTCH         OR                 01400002
014100                     END-OF-RECEIV-PO-LNE-REC  OR                 01410000
014200                    (AP060-PO-NBR NOT = AP271-PURCHASE-ORDER) OR  01420000
014300                    (AP060-PO-NBR     = AP271-PURCHASE-ORDER AND  01430000
014400                     AP060-MTCH-LOC-NBR NOT = AP271-DC-NBR)       01440004
014500           ELSE                                                   01450000
014700              IF AP060-MTCH-LOC-NBR > AP271-DC-NBR                01470004
014800                 PERFORM R200-READ-AP271                          01480000
014900              ELSE                                                01490000
015000                 PERFORM R100-READ-DC-INVC                        01500002
015100              END-IF                                              01510000
015200           END-IF                                                 01520000
015300     ELSE                                                         01530000
015400        IF AP060-PO-NBR > AP271-PURCHASE-ORDER                    01540000
015500           PERFORM R200-READ-AP271                                01550000
015600        ELSE                                                      01560000
015700           PERFORM R100-READ-DC-INVC                              01570002
015800        END-IF                                                    01580000
015900     END-IF.                                                      01590000
016000                                                                  01600000
016100 B200-PROCESS-UPDT.                                               01610000
016200                                                                  01620000
016600     MOVE AP060-VENDOR-NAME      TO AP271-VENDOR-NAME.            01660000
016700     MOVE AP060-MTCH-LOC-NBR     TO AP271-DC-NBR.                 01670010
016800     MOVE AP060-STR-NBR          TO AP271-STORE-NUMBER.           01680010
016810     MOVE AP060-MTCH-LVL-CDE     TO AP271-MTCH-LVL-CDE.           01681012
016900                                                                  01690000
017000     PERFORM W100-WRITE-MATCHED.                                  01700000
017100                                                                  01710000
017200     PERFORM R200-READ-AP271.                                     01720000
017300                                                                  01730000
017400 B300-PROCESS-REST.                                               01740000
017500                                                                  01750000
017900     IF NOT PO-LINE-REC                                           01790000
018000        PERFORM W100-WRITE-MATCHED.                               01800000
018100                                                                  01810000
018200     PERFORM R200-READ-AP271.                                     01820000
018300                                                                  01830000
018400 H100-HOUSEKEEPING.                                               01840000
018500*                                                                 01850000
018600***************************************************************** 01860000
018700*    OPEN FILES                                                   01870000
018800***************************************************************** 01880000
018900*                                                                 01890000
019300     MOVE 'H100-HOUSEKEEPING' TO PV-ABEND-PARAGRAPH.              01930000
019400                                                                  01940000
019500     SET NOT-END-OF-DC-INVC           TO TRUE.                    01950001
019600     SET NOT-END-OF-RCV-UNMTCH        TO TRUE.                    01960002
019700     SET NOT-END-OF-RECEIV-PO-LNE-REC TO TRUE.                    01970000
019800                                                                  01980000
019900     OPEN INPUT  DC-INVOICES-FILE                                 01990001
020000                 RCV-UNMTCH-FILE                                  02000001
020410          OUTPUT UPDT-DTL-ENTRY-FILE.                             02041001
020413                                                                  02041300
020414     PERFORM R100-READ-DC-INVC.                                   02041401
020415                                                                  02041500
020416     PERFORM R200-READ-AP271.                                     02041600
020417                                                                  02041700
020418 R100-READ-DC-INVC.                                               02041801
020419*                                                                 02041900
020420***************************************************************** 02042000
020430*     READ THE SELECTED DC INVOICE FILE                           02043001
020440***************************************************************** 02044000
020450*                                                                 02045000
020490     MOVE 'R100-READ-DC-INVC' TO PV-ABEND-PARAGRAPH.              02049001
020500                                                                  02050000
020600     IF NOT END-OF-DC-INVC                                        02060001
020700        READ DC-INVOICES-FILE INTO AP060-INVOICE-EXTRACT          02070001
020800          AT END  SET END-OF-DC-INVC TO TRUE.                     02080001
020900                                                                  02090000
021000     IF NOT END-OF-DC-INVC                                        02100001
021100        ADD 1 TO PV-DC-INVC-IN-REC-CNT.                           02110001
021200                                                                  02120000
021300 R200-READ-AP271.                                                 02130000
021400*                                                                 02140000
021500***************************************************************** 02150000
021600*     READ THE UNMATCHED RECEIV BATCH FILE                        02160002
021700***************************************************************** 02170000
021800*                                                                 02180000
022200     MOVE 'R200-READ-AP271  ' TO PV-ABEND-PARAGRAPH.              02220000
022300                                                                  02230000
022400     IF NOT END-OF-RCV-UNMTCH                                     02240002
022500        READ RCV-UNMTCH-FILE INTO AP271-RECORD                    02250002
022600          AT END  SET END-OF-RCV-UNMTCH TO TRUE.                  02260002
022700                                                                  02270000
022800     IF NOT END-OF-RCV-UNMTCH                                     02280002
022900        ADD 1 TO PV-RCV-UNMTCH-REC-CNT                            02290002
023000        IF NOT PO-LINE-REC                                        02300000
023100           SET END-OF-RECEIV-PO-LNE-REC TO TRUE                   02310000
023200        END-IF                                                    02320000
023300     END-IF.                                                      02330000
023400                                                                  02340000
023500 W100-WRITE-MATCHED.                                              02350000
023600*                                                                 02360000
023700***************************************************************** 02370000
023800*     WRITE THE DUMPED BATCH MATCH FILE    - BULK                 02380000
023900***************************************************************** 02390000
024000*                                                                 02400000
024400     MOVE 'W100-WRITE-MATCHED' TO PV-ABEND-PARAGRAPH.             02440000
024500                                                                  02450000
024600     WRITE UPDT-DTL-ENTRY-RECORD FROM AP271-RECORD.               02460000
024700                                                                  02470000
024800     ADD 1 TO PV-RECEIV-OUT-REC-CNT.                              02480000
024900                                                                  02490000
025600 Z900-END-OF-JOB.                                                 02560000
025700*                                                                 02570000
025800***************************************************************** 02580000
025900*     CLOSE ALL FILES, REPORT ON NECESSARY TOTALS                 02590000
026000***************************************************************** 02600000
026100*                                                                 02610000
026140     MOVE 'Z900-END-OF-JOB  ' TO PV-ABEND-PARAGRAPH.              02614000
026150                                                                  02615000
026160     DISPLAY '************************************************'.  02616000
026170     DISPLAY 'TOTAL INVOICE  RECORDS READ    = '                  02617000
026180              PV-DC-INVC-IN-REC-CNT.                              02618002
026190     DISPLAY 'TOTAL AP271 RECEIV RECS READ   = '                  02619000
026200              PV-RCV-UNMTCH-REC-CNT.                              02620002
026300     DISPLAY '************************************************'.  02630000
026400     DISPLAY 'TOTAL AP271 INVC MATCH RECS OUT= '                  02640000
026500              PV-RECEIV-OUT-REC-CNT.                              02650000
026600     DISPLAY '************************************************'.  02660000
027000                                                                  02700000
027100     DISPLAY ' PROGRAM APKUT266 ENDS NORMALLY '.                  02710002
027200                                                                  02720000
027300     CLOSE       DC-INVOICES-FILE                                 02730002
027400                 RCV-UNMTCH-FILE                                  02740002
027810                 UPDT-DTL-ENTRY-FILE.                             02781002
027840                                                                  02784000
