000100*-----------------------*                                         00010006
000200 IDENTIFICATION DIVISION.                                         00020006
000300*-----------------------*                                         00030006
000400 PROGRAM-ID.    ETKCS306.                                         00040006
000500 AUTHOR.        J. SCHMIDT                                        00050006
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060006
000700 DATE-WRITTEN.  01/12/94.                                         00070006
000800 DATE-COMPILED.                                                   00080006
000900                                                                  00090006
001000*---------------------------------------------------------------* 00100006
001100*    E306 - EDI TRADING PARTNERSHIP LIST                        * 00110006
001200*                                                               * 00120006
001300*    THIS PROGRAM GENERATES A LIST OF TRADING PARTNERSHIPS FOR  * 00130006
001400*    ALL, OR A SUBSET OF, TRADING PARTNERS BASED UPON THE       * 00140006
001500*    SELECTION CRITERION ENTERED INTO ETKCS305, TP SELECT.      * 00150006
001600*    THE SELECTION CRITERION USED WILL BE EITHER ONE OR A       * 00160006
001700*    COMBINATION OF ANY OF THE FOLLOWING : VENDOR NAME, TP ID   * 00170006
001800*    QUALIFIER, TP ID, OR NETWORK CODE.                         * 00180006
001900*                                                               * 00190006
002000*    FROM THIS LIST THE USER MAY CHOOSE TO INQUIRE, UPDATE,     * 00200006
002100*    OR DELETE SELECTED TRADING PARTNERSHIPS. THEY MIGHT ALSO   * 00210006
002200*    CHOOSE TO TRANSFER TO THE EDI TRADING PARTNER FUCTIONAL    * 00220006
002300*    GROUP LIST OR THE EDI TRADING PARTNER TRANSACTION SET LIST.* 00230006
002400*                                                               * 00240006
002500*    CHANGES:                                                   * 00250006
002600*     03/20/97 TOM MEDREK - FIXED APPLICATION SPECIFIC SECTION. * 00260006
002700*       ADDED NRF INDICATOR WHICH WAS ADDED TO ETWS300 &        * 00270006
002800*       ETWS301 EARLIER.                                        * 00280006
002810*                                                               * 00281007
002820* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00282007
002830*            - CHANGE CALL OF DPKUT100 TO                       * 00283007
002840*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00284007
002850*              MAKING THE CALL DYNAMIC VS STATIC                * 00285007
002860*                                                               * 00286007
002870*---------------------------------------------------------------* 00287007
CICS  *  CHANGED 10/25/2022    BY BARB SCHULTZ    WR: CHG0277210        00288009
CICS  *                                                                 00289008
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     00289108
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00289208
002900*---------------------------------------------------------------* 00290006
003000 EJECT                                                            00300006
003100                                                                  00310006
003200 ENVIRONMENT DIVISION.                                            00320006
003300                                                                  00330006
003400 DATA DIVISION.                                                   00340006
003500                                                                  00350006
003600 WORKING-STORAGE SECTION.                                         00360006
003700                                                                  00370006
003800 01  WK-DB2-KEYS.                                                 00380006
003900     15  WK-VENDOR-NAME                 PIC  X(30)  VALUE SPACES. 00390006
004000     15  WK-VENDOR-NAME-BYTE            REDEFINES WK-VENDOR-NAME  00400006
004100                                        OCCURS 30 TIMES           00410006
004200                                        PIC  X(01).               00420006
004300                                                                  00430006
004400 01  PC-PROGRAM-CONSTANTS.                                        00440006
004500     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00450006
004600                                                    'ET306A  '.   00460006
004700     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00470006
004800                                                    'ETKM306 '.   00480006
004900     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00490006
005000                                                    'ETKCS306'.   00500006
005100     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00510006
005200     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00520006
005300     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00530006
005400     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00540006
005500                                                    COMP SYNC.    00550006
005600     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00560006
005700                                                    COMP SYNC.    00570006
005800     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00580006
005900                                                    +1000000      00590006
006000                                                    COMP-3.       00600006
006100     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00610006
006200                                                    COMP SYNC.    00620006
006300     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00630006
006400                                                    COMP-3.       00640006
006500     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00650006
006600     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00660006
006700     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00670006
006800     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00680006
006900     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00690006
007000     05  PC-TSYMSG-NUMBERS.                                       00700006
007100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00710006
007200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00720006
007300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00730006
007400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00740006
007500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00750006
007600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00760006
007700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00770006
007800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00780006
007900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00790006
008000         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00800006
008100         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00810006
008200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00820006
008300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00830006
008400         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  00840006
008500         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  00850006
008600*                                                                 00860006
008700 01  PS-PROGRAM-SWITCHES.                                         00870006
008800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'N'.    00880006
008900         88  PS-ERROR                               VALUE 'Y'.    00890006
009000         88  PS-NO-ERROR                            VALUE 'N'.    00900006
009100     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00910006
009200         88  PS-DONE                                VALUE 'Y'.    00920006
009300         88  PS-NOT-DONE                            VALUE 'N'.    00930006
009400     05  PS-SET-REMAINING-SW            PIC  X(01)  VALUE 'N'.    00940006
009500         88  PS-SET-REMAINING                       VALUE 'Y'.    00950006
009600         88  PS-DO-NOT-SET-REMAINING                VALUE 'N'.    00960006
009700     05  PS-USE-CSR-SW                  PIC  X      VALUE SPACE.  00970006
009800         88  PS-USE-ENT-ID-CSR                      VALUE 'E'.    00980006
009900         88  PS-USE-INCHG-ID-CSR                    VALUE 'I'.    00990006
010000         88  PS-USE-VENDOR-NAME-CSR                 VALUE 'V'.    01000006
010100         88  PS-USE-NETWRK-TSET-CSR                 VALUE 'N'.    01010006
010200                                                                  01020006
010300 01  PV-PROGRAM-VARIABLES.                                        01030006
010400     05  PV-SUB                         PIC S9(04)  VALUE +0      01040006
010500                                                    COMP SYNC.    01050006
010600     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01060006
010700                                                    COMP SYNC.    01070006
010800     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01080006
010900                                                    COMP-3.       01090006
011000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01100006
011100                                                    COMP-3.       01110006
011200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01120006
011300                                                    COMP-3.       01130006
011400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01140006
011500                                                    COMP-3.       01150006
011600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01160006
011700                                                    COMP-3.       01170006
011800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01180006
011900                                                    COMP-3.       01190006
012000     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01200006
012100                                                    COMP-3.       01210006
012200     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01220006
012300                                                    COMP SYNC.    01230006
012400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01240006
012500                                                    COMP SYNC.    01250006
012600     05  PV-ITEM                        PIC S9(04)  VALUE +0      01260006
012700                                                    COMP SYNC.    01270006
012800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01280006
012900                                                    COMP SYNC.    01290006
013000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01300006
013100                                                    COMP SYNC.    01310006
013200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01320006
013300                                                    COMP SYNC.    01330006
013400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01340006
013500                                                    COMP SYNC.    01350006
013600     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01360006
013700                                                    COMP SYNC.    01370006
013800     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01380006
013900                                                    COMP SYNC.    01390006
014000     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01400006
014100                                                    COMP SYNC.    01410006
014200     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01420006
014300                                                    COMP SYNC.    01430006
014400     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01440006
014500                                                    COMP SYNC.    01450006
014600     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01460006
014700                                                    COMP SYNC.    01470006
014800     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01480006
014900                                                    COMP SYNC.    01490006
015000     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01500006
015100                                                    COMP SYNC.    01510006
015200     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01520006
015300                                                    COMP SYNC.    01530006
015400                                                                  01540006
015500     05  PV-START-ITEM-REQUEST          PIC  X(05).               01550006
015600                                                                  01560006
015700     05  PV-ENT-ID               PIC S9(09) COMP VALUE +0.        01570006
015800                                                                  01580006
015900     05  PV-FROM-ALPHA-30        PIC  X(30)  VALUE SPACES.        01590006
016000     05  PV-FROM-ALPHA-BYTE      REDEFINES PV-FROM-ALPHA-30       01600006
016100                                 OCCURS 30 TIMES                  01610006
016200                                 PIC  X(01).                      01620006
016300     05  PV-TO-ALPHA-30          PIC  X(30)  VALUE SPACES.        01630006
016400     05  PV-TO-ALPHA-BYTE        REDEFINES PV-TO-ALPHA-30         01640006
016500                                 OCCURS 30 TIMES                  01650006
016600                                 PIC  X(01).                      01660006
016700                                                                  01670006
016800     05  PV-FROM-INCHG-QUAL      PIC  X(02)  VALUE SPACES.        01680006
016900     05  PV-FROM-INCHG-QUAL-BYTE REDEFINES PV-FROM-INCHG-QUAL     01690006
017000                                 OCCURS 2 TIMES                   01700006
017100                                 PIC  X(01).                      01710006
017200     05  PV-TO-INCHG-QUAL        PIC  X(02)  VALUE SPACES.        01720006
017300     05  PV-TO-INCHG-QUAL-BYTE   REDEFINES PV-TO-INCHG-QUAL       01730006
017400                                 OCCURS 2 TIMES                   01740006
017500                                 PIC  X(01).                      01750006
017600                                                                  01760006
017700     05  PV-FROM-INCHG-ID        PIC  X(15)  VALUE SPACES.        01770006
017800     05  PV-FROM-INCHG-ID-BYTE   REDEFINES PV-FROM-INCHG-ID       01780006
017900                                 OCCURS 15 TIMES                  01790006
018000                                 PIC  X(01).                      01800006
018100     05  PV-TO-INCHG-ID          PIC  X(15)  VALUE SPACES.        01810006
018200     05  PV-TO-INCHG-ID-BYTE     REDEFINES PV-TO-INCHG-ID         01820006
018300                                 OCCURS 15 TIMES                  01830006
018400                                 PIC  X(01).                      01840006
018500                                                                  01850006
018600     05  PV-FROM-NETWK-ID        PIC  X(01)  VALUE SPACES.        01860006
018700     05  PV-TO-NETWK-ID          PIC  X(01)  VALUE SPACES.        01870006
018800                                                                  01880006
018900     05  PV-FROM-TRAN-SET-CDE    PIC  X(03)  VALUE SPACES.        01890006
019000     05  PV-TO-TRAN-SET-CDE      PIC  X(03)  VALUE SPACES.        01900006
019100                                                                  01910006
019200*----------------------------------------------------------------*01920006
019300*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *01930006
019400*   THIS MUST BE THE EXACT SAME FORMAT AS A BLOCK IN THE         *01940006
019500*   APPLICATION-SPECIFIC COMMAREA.                               *01950006
019600*----------------------------------------------------------------*01960006
019700 01  LQW-LIST-QUEUE-WORK-AREA.                                    01970006
019800     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01980006
019900     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01990006
020000                                        INDEXED BY LQW-IDX.       02000006
020100         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02010006
020200         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02020006
020300         10  LQW-SELECTED-SW            PIC  X(01).               02030006
020400             88  LQW-SELECT                         VALUE 'S'.    02040006
020500             88  LQW-DESELECT                       VALUE ' '.    02050006
020600         10  LQW-ACTION                 PIC  X(03).               02060006
020700         10  LQW-KEY-DATA.                                        02070006
020800             15  LQW-ENT-ID             PIC  S9(9) COMP.          02080006
020900             15  LQW-VENDOR-NAME        PIC  X(30).               02090006
021000             15  LQW-TP-DKEY            PIC  S9(9) COMP.          02100006
021100             15  LQW-VEND-INCHG-QUAL    PIC  X(02).               02110006
021200             15  LQW-VEND-INCHG-ID      PIC  X(15).               02120006
021300             15  LQW-NETWK-ID           PIC  X(01).               02130006
021400             15  LQW-NRFC-ID            PIC  X(01).               02140006
021500             15  LQW-NETWORK-NAME       PIC  X(15).               02150006
021600                                                                  02160006
021700 EJECT                                                            02170006
021800*---------------------------------------------------------------* 02180006
021900*  RECORD LAYOUT FOR THE VENDOR LIST TEMP STORAGE QUEUE.        * 02190006
022000*---------------------------------------------------------------* 02200006
022100                                                                  02210006
022200     COPY ETWS301.                                                02220006
022300                                                                  02230006
022400     EJECT                                                        02240006
022500*---------------------------------------------------------------* 02250006
022600*    MAP LAYOUT                                                 * 02260006
022700*---------------------------------------------------------------* 02270006
022800                                                                  02280006
022900     COPY ETKM306.                                                02290006
023000*                                                                 02300006
023100 01  MR-OCCURS-LAYOUT                   REDEFINES  ET306AO.       02310006
023200*    ?? NEED TO ADJUST SIZE ??                                    02320006
023300     05  FILLER                         PIC X(48).                02330006
023400     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          02340006
023500         10  MR-SELECTL                 PIC S9(04) COMP.          02350006
023600         10  MR-SELECTA                 PIC  X(01).               02360006
023700         10  MR-SELECTC                 PIC  X(01).               02370006
023800         10  MR-SELECTH                 PIC  X(01).               02380006
023900         10  MR-SELECTI                 PIC  X(01).               02390006
024000                                                                  02400006
024100         10  MR-ACTIONL                 PIC S9(04) COMP.          02410006
024200         10  MR-ACTIONA                 PIC  X(01).               02420006
024300         10  MR-ACTIONC                 PIC  X(01).               02430006
024400         10  MR-ACTIONH                 PIC  X(01).               02440006
024500         10  MR-ACTION                  PIC  X(03).               02450006
024600                                                                  02460006
024700         10  MR-VNDRL                   PIC S9(04) COMP.          02470006
024800         10  MR-VNDRA                   PIC  X(01).               02480006
024900         10  MR-VNDRC                   PIC  X(01).               02490006
025000         10  MR-VNDRH                   PIC  X(01).               02500006
025100         10  MR-VNDR                    PIC  X(30).               02510006
025200                                                                  02520006
025300         10  MR-TPIDQL                  PIC S9(04) COMP.          02530006
025400         10  MR-TPIDQA                  PIC  X(01).               02540006
025500         10  MR-TPIDQC                  PIC  X(01).               02550006
025600         10  MR-TPIDQH                  PIC  X(01).               02560006
025700         10  MR-TPIDQ                   PIC  X(02).               02570006
025800                                                                  02580006
025900         10  MR-TPIDL                   PIC S9(04) COMP.          02590006
026000         10  MR-TPIDA                   PIC  X(01).               02600006
026100         10  MR-TPIDC                   PIC  X(01).               02610006
026200         10  MR-TPIDH                   PIC  X(01).               02620006
026300         10  MR-TPID                    PIC  X(15).               02630006
026400                                                                  02640006
026500         10  MR-NTWKL                   PIC S9(04) COMP.          02650006
026600         10  MR-NTWKA                   PIC  X(01).               02660006
026700         10  MR-NTWKC                   PIC  X(01).               02670006
026800         10  MR-NTWKH                   PIC  X(01).               02680006
026900         10  MR-NTWK                    PIC  X(15).               02690006
027000                                                                  02700006
027100 EJECT                                                            02710006
027200*---------------------------------------------------------------* 02720006
027300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02730006
027400*---------------------------------------------------------------* 02740006
027500                                                                  02750006
027600     COPY DPWS015.                                                02760006
027700                                                                  02770006
027800*---------------------------------------------------------------* 02780006
027900*    FUNCTION KEYS COPYBOOK.                                    * 02790006
028000*---------------------------------------------------------------* 02800006
028100                                                                  02810006
028200     COPY DPWS016.                                                02820006
028300                                                                  02830006
028400*---------------------------------------------------------------* 02840006
028500*    NUMERIC EDIT LAYOUT.                                       * 02850006
028600*---------------------------------------------------------------* 02860006
028700                                                                  02870006
028800     COPY DPWS010I.                                               02880006
028900 EJECT                                                            02890006
029000*---------------------------------------------------------------* 02900006
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02910008
029200*---------------------------------------------------------------* 02920006
029300                                                                  02930006
029400     COPY DPWS030.                                                02940006
CICS       COPY DPWS930.                                                02941008
029500 EJECT                                                            02950006
029600*---------------------------------------------------------------* 02960006
029700*    STANDARD COMMAREA.                                         * 02970006
029800*---------------------------------------------------------------* 02980006
029900                                                                  02990006
030000     COPY DPWS020.                                                03000006
030100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03010006
030200                                                                  03020006
030300*---------------------------------------------------------------* 03030006
030400*    INTER-APPLICATION COMMAREA.                                * 03040006
030500*                                                               * 03050006
030600*    ETWS300 - IS THE INCLUDE WHEN ARRIVING FROM CRITERIA SPEC  * 03060006
030700*                                                               * 03070006
030800*---------------------------------------------------------------* 03080006
030900                                                                  03090006
031000         10  INTER-APPL-COMM-AREA       PIC X(200).               03100006
031100                                                                  03110006
031200     COPY ETWS300.                                                03120006
031300                                                                  03130006
031400 EJECT                                                            03140006
031500                                                                  03150006
031600*---------------------------------------------------------------* 03160006
031700*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03170006
031800*---------------------------------------------------------------* 03180006
031900         10  ASC-SPECIFIC-COMMAREA.                               03190006
032000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03200006
032100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03210006
032200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03220006
032300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03230006
032400                                                                  03240006
032500                 20  ASC-ITEM-ARRAY.                              03250006
032600                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        03260006
032700                         30  ASC-LIST-ITEM-NUMBER                 03270006
032800                                                     PIC S9(09)   03280006
032900                                                     COMP-3.      03290006
033000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03300006
033100                             88  ASC-VALID-SELECT    VALUES       03310006
033200                                               ' ' 'S' 'B' 'E'.   03320006
033300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03330006
033400                             88  ASC-TEMP-SELECT     VALUE 'S'.   03340006
033500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03350006
033600                             88  ASC-TEMP-END        VALUE 'E'.   03360006
033700                         30  ASC-SELECTED-SW         PIC  X(01).  03370006
033800                             88  ASC-NO-SELECT       VALUE ' '.   03380006
033900                             88  ASC-SELECT          VALUE 'S'.   03390006
034000                             88  ASC-BEGIN           VALUE 'B'.   03400006
034100                             88  ASC-END             VALUE 'E'.   03410006
034200                         30  ASC-ACTION              PIC  X(03).  03420006
034300                         30  ASC-KEY-DATA.                        03430006
034400                             35 ASC-ENT-ID           PIC  S9(9)   03440006
034500                                                           COMP.  03450006
034600                             35 ASC-VENDOR-NAME      PIC  X(30).  03460006
034700                             35 ASC-TP-DKEY          PIC  S9(9)   03470006
034800                                                           COMP.  03480006
034900                             35 ASC-VEND-INCHG-QUAL  PIC  X(02).  03490006
035000                             35 ASC-VEND-INCHG-ID    PIC  X(15).  03500006
035100                             35 ASC-NETWK-ID         PIC  X(01).  03510006
035200                             35 ASC-NRFC-ID          PIC  X(01).  03520006
035300                             35 ASC-NETWORK-NAME     PIC  X(15).  03530006
035400                                                                  03540006
035500             15  ASC-BLK-SUB                         PIC S9(04)   03550006
035600                                                          COMP    03560006
035700                                                          SYNC.   03570006
035800             15  ASC-ITEM-SUB                        PIC S9(04)   03580006
035900                                                          COMP    03590006
036000                                                          SYNC.   03600006
036100             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03610006
036200                                                          COMP-3. 03620006
036300             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03630006
036400                                                          COMP-3. 03640006
036500             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03650006
036600                                                          COMP-3. 03660006
036700             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03670006
036800                                                          COMP-3. 03680006
036900             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03690006
037000                                                          COMP-3. 03700006
037100             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03710006
037200                                                          COMP    03720006
037300                                                          SYNC.   03730006
037400             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03740006
037500                                                          COMP-3. 03750006
037600             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03760006
037700                                                          COMP-3. 03770006
037800             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03780006
037900                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03790006
038000                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03800006
038100             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03810006
038200                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03820006
038300                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03830006
038400             15  ASC-LIST-QUEUE-NAME.                             03840006
038500                 20  ASC-LIST-TERM-ID                PIC  X(04).  03850006
038600                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03860006
038700                                                          COMP-3. 03870006
038800                 20  ASC-LIST-SEQ                    PIC  9(01).  03880006
038900             15  ASC-SEL-QUEUE-NAME.                              03890006
039000                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03900006
039100                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03910006
039200                                                          COMP-3. 03920006
039300                 20  ASC-SEL-SEQ                     PIC  9(01).  03930006
039400                                                                  03940006
039500             15  ASC-START-ITEM-REQUEST.                          03950006
039600                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03960006
039700             15  ASC-HOLD-INTER-APPL                 PIC X(200).  03970006
039800 EJECT                                                            03980006
039900*---------------------------------------------------------------* 03990006
040000*    ABEND PROCESSING COPYBOOK.                                 * 04000006
040100*---------------------------------------------------------------* 04010006
040200                                                                  04020006
040300     COPY DPWS013.                                                04030006
040400                                                                  04040006
040500 EJECT                                                            04050006
040600*---------------------------------------------------------------* 04060006
040700*    DB2 AREA FOR COMMUNICATIONS                                * 04070006
040800*---------------------------------------------------------------* 04080006
040900     EXEC SQL                                                     04090006
041000          INCLUDE SQLCA                                           04100006
041100     END-EXEC.                                                    04110006
041200                                                                  04120006
041300 EJECT                                                            04130006
041400*---------------------------------------------------------------* 04140006
041500*    DB2 AREA FOR ENTITY NAME DETAILS                           * 04150006
041600*---------------------------------------------------------------* 04160006
041700     EXEC SQL                                                     04170006
041800          INCLUDE TENTNME                                         04180006
041900     END-EXEC.                                                    04190006
042000                                                                  04200006
042100*---------------------------------------------------------------* 04210006
042200*    DB2 AREA FOR TRADING PARTNERSHIP DETAILS                   * 04220006
042300*---------------------------------------------------------------* 04230006
042400     EXEC SQL                                                     04240006
042500          INCLUDE TTRDPRT                                         04250006
042600     END-EXEC.                                                    04260006
042700                                                                  04270006
042800*---------------------------------------------------------------* 04280006
042900*    DB2 AREA FOR NETWORK DETAILS                               * 04290006
043000*---------------------------------------------------------------* 04300006
043100     EXEC SQL                                                     04310006
043200          INCLUDE TNETWRK                                         04320006
043300     END-EXEC.                                                    04330006
043400                                                                  04340006
043500*---------------------------------------------------------------* 04350006
043600*    DB2 AREA FOR TRADING PARTNER TRANSACTION SET TABLE           04360006
043700*---------------------------------------------------------------* 04370006
043800     EXEC SQL                                                     04380006
043900          INCLUDE TTRDTRN                                         04390006
044000     END-EXEC.                                                    04400006
044100                                                                  04410006
044200******************************************************************04420006
044300* BELOW ARE MULTIPLE CURSORS USED TO RETRIEVE THE VENDOR,         04430006
044400* TRADING PARTNER, AND NETWORK DETAILS. ONLY ONE WILL BE USED     04440006
044500* DURING ANY GIVEN EXECUTION OF THE PROGRAM. THE ONE TO BE USED   04450006
044600* IS DETERMINED BY THE PATH THAT WAS TAKEN TO ENTER THIS PROGRAM  04460006
044700* AND THE DATA THAT WAS ENTERED ON THE TRADING PARTNER CRITERIA   04470006
044800* SPEC SCREEN. (SEE 4100-PREPARE-CURSOR.)                         04480006
044900******************************************************************04490006
045000*---------------------------------------------------------------* 04500006
045100* THIS CURSOR IS USED WHEN THIS PROGRAM IS ENTERED BY GOING FROM  04510006
045200* THE VENDOR LIST TO THE TRADING PARTNER CRITERIA SPEC. THE       04520006
045300* ENT-ID IS PASSED FROM THE VENDOR LIST AND USED IN THE CURSOR    04530006
045400* DECLARATION. ANY FIELDS ENTERED ON THE CRITERIA SPEC ARE        04540006
045500* IGNORED.                                                        04550006
045600*---------------------------------------------------------------* 04560006
045700     EXEC SQL                                                     04570006
045800         DECLARE ENT-ID-CSR CURSOR FOR                            04580006
045900             SELECT                                               04590006
046000                 B.TP_DKEY                                        04600006
046100               , B.ENT_ID                                         04610006
046200               , A.ENT_ID                                         04620006
046300               , A.ENT_NAME_DESC                                  04630006
046400               , A.TYPE_CDE                                       04640006
046500               , B.VEND_INCHG_ID                                  04650006
046600               , B.VEND_INCHG_ID_DESC                             04660006
046700               , B.NETWK_ID                                       04670006
046800               , C.NETWK_ID                                       04680006
046900               , C.NETWK_NME                                      04690006
047000             FROM                                                 04700006
047100                 TENTNME A                                        04710006
047200               , TTRDPRT B                                        04720006
047300               , TNETWRK C                                        04730006
047400             WHERE                                                04740006
047500                   A.TYPE_CDE = '01'                              04750006
047600               AND A.ENT_ID   = :PV-ENT-ID                        04760006
047700               AND A.ENT_ID   =  B.ENT_ID                         04770006
047800               AND B.NETWK_ID =  C.NETWK_ID                       04780006
047900     END-EXEC.                                                    04790006
048000                                                                  04800006
048100*---------------------------------------------------------------* 04810006
048200* THIS CURSOR IS USED WHEN THIS PROGRAM IS ENTERED BY GOING       04820006
048300* FROM THE EDI MENU TO THE TRADING PARTNER CRITERIA SPEC, AND     04830006
048400* ENTERING INTERCHANGE ID INFO ON THE CRITERIA SPEC.  ANY OTHER   04840006
048500* FIELDS ENTERED ON THE CRITERIA SPEC SCREEN ARE IGNORED.         04850006
048600*---------------------------------------------------------------* 04860006
048700     EXEC SQL                                                     04870006
048800         DECLARE INCHG-ID-CSR CURSOR FOR                          04880006
048900             SELECT                                               04890006
049000                 B.TP_DKEY                                        04900006
049100               , B.ENT_ID                                         04910006
049200               , A.ENT_ID                                         04920006
049300               , A.ENT_NAME_DESC                                  04930006
049400               , A.TYPE_CDE                                       04940006
049500               , B.VEND_INCHG_ID                                  04950006
049600               , B.VEND_INCHG_ID_DESC                             04960006
049700               , B.NETWK_ID                                       04970006
049800               , C.NETWK_ID                                       04980006
049900               , C.NETWK_NME                                      04990006
050000             FROM                                                 05000006
050100                 TENTNME A                                        05010006
050200               , TTRDPRT B                                        05020006
050300               , TNETWRK C                                        05030006
050400             WHERE                                                05040006
050500                    A.TYPE_CDE = '01'                             05050006
050600               AND (B.VEND_INCHG_ID_DESC BETWEEN                  05060006
050700                                               :PV-FROM-INCHG-QUAL05070006
050800                                         AND   :PV-TO-INCHG-QUAL) 05080006
050900               AND (B.VEND_INCHG_ID  BETWEEN :PV-FROM-INCHG-ID    05090006
051000                                     AND     :PV-TO-INCHG-ID)     05100006
051100               AND  A.ENT_ID   = B.ENT_ID                         05110006
051200               AND  B.NETWK_ID = C.NETWK_ID                       05120006
051300             ORDER BY                                             05130006
051400                 A.ENT_NAME_DESC                                  05140006
051500     END-EXEC.                                                    05150006
051600                                                                  05160006
051700*---------------------------------------------------------------* 05170006
051800* THIS CURSOR IS USED WHEN THIS PROGRAM IS ENTERED BY GOING       05180006
051900* FROM THE EDI MENU TO THE TRADING PARTNER CRITERIA SPEC, AND THEN05190006
052000* ENTERING SOMETHING IN THE VENDOR NAME FIELD ON THE CRITERIA SPEC05200006
052100* SCREEN, WHILE LEAVING THE INTERCHANGE ID INFO BLANK. ANY OTHER  05210006
052200* FIELDS ENTERED ON THE CRITERIA SPEC SCREEN ARE IGNORED.         05220006
052300*---------------------------------------------------------------* 05230006
052400     EXEC SQL                                                     05240006
052500         DECLARE VENDOR-NAME-CSR CURSOR FOR                       05250006
052600             SELECT                                               05260006
052700                 B.TP_DKEY                                        05270006
052800               , B.ENT_ID                                         05280006
052900               , A.ENT_ID                                         05290006
053000               , A.ENT_NAME_DESC                                  05300006
053100               , A.TYPE_CDE                                       05310006
053200               , B.VEND_INCHG_ID                                  05320006
053300               , B.VEND_INCHG_ID_DESC                             05330006
053400               , B.NETWK_ID                                       05340006
053500               , C.NETWK_ID                                       05350006
053600               , C.NETWK_NME                                      05360006
053700             FROM                                                 05370006
053800                 TENTNME A                                        05380006
053900               , TTRDPRT B                                        05390006
054000               , TNETWRK C                                        05400006
054100             WHERE                                                05410006
054200                   A.TYPE_CDE = '01'                              05420006
054300               AND                                                05430006
054400                  (A.ENT_NAME_DESC  BETWEEN :PV-FROM-ALPHA-30     05440006
054500                                    AND     :PV-TO-ALPHA-30)      05450006
054600               AND A.ENT_ID   =  B.ENT_ID                         05460006
054700               AND B.NETWK_ID =  C.NETWK_ID                       05470006
054800             ORDER BY                                             05480006
054900                 A.ENT_NAME_DESC                                  05490006
055000     END-EXEC.                                                    05500006
055100                                                                  05510006
055200*---------------------------------------------------------------* 05520006
055300* THIS CURSOR IS USED WHEN THIS PROGRAM IS ENTERED BY GOING       05530006
055400* FROM THE EDI MENU TO THE TRADING PARTNER CRITERIA SPEC, AND THEN05540006
055500* ENTERING SOMETHING IN THE NETWORK OR TRAN SET FIELDS ON THE     05550006
055600* CRITERIA SPEC SCREEN WHILE LEAVING THE INTERCHANGE ID INFO AND  05560006
055700* THE VENDOR NAME BLANK.                                          05570006
055800*---------------------------------------------------------------* 05580006
055900     EXEC SQL                                                     05590006
056000         DECLARE NETWRK-TSET-CSR CURSOR FOR                       05600006
056100             SELECT DISTINCT                                      05610006
056200                 B.TP_DKEY                                        05620006
056300               , B.ENT_ID                                         05630006
056400               , A.ENT_ID                                         05640006
056500               , A.ENT_NAME_DESC                                  05650006
056600               , A.TYPE_CDE                                       05660006
056700               , B.VEND_INCHG_ID                                  05670006
056800               , B.VEND_INCHG_ID_DESC                             05680006
056900               , B.NETWK_ID                                       05690006
057000               , C.NETWK_ID                                       05700006
057100               , C.NETWK_NME                                      05710006
057200             FROM                                                 05720006
057300                 TENTNME A                                        05730006
057400               , TTRDPRT B                                        05740006
057500               , TNETWRK C                                        05750006
057600               , TTRDTRN D                                        05760006
057700             WHERE                                                05770006
057800                   A.TYPE_CDE = '01'                              05780006
057900               AND B.NETWK_ID     BETWEEN :PV-FROM-NETWK-ID       05790006
058000                                  AND     :PV-TO-NETWK-ID         05800006
058100               AND D.TRAN_SET_CDE BETWEEN :PV-FROM-TRAN-SET-CDE   05810006
058200                                  AND     :PV-TO-TRAN-SET-CDE     05820006
058300               AND A.ENT_ID   =  B.ENT_ID                         05830006
058400               AND B.NETWK_ID =  C.NETWK_ID                       05840006
058500               AND B.TP_DKEY  =  D.TP_DKEY                        05850006
058600             ORDER BY                                             05860006
058700                 A.ENT_NAME_DESC                                  05870006
058800     END-EXEC.                                                    05880006
058900                                                                  05890006
059000 LINKAGE SECTION.                                                 05900006
059100                                                                  05910006
059200 01  DFHCOMMAREA.                                                 05920006
059300     05  FILLER                         OCCURS  1 TO 4072 TIMES   05930006
059400                                        DEPENDING ON EIBCALEN.    05940006
059500         10  FILLER                     PIC X.                    05950006
059600                                                                  05960006
059700 PROCEDURE DIVISION.                                              05970006
059800******************************************************************05980006
059900**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05990006
060000**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **06000006
060100**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **06010006
060200******************************************************************06020006
060300                                                                  06030006
060400 0000-MAIN-MODULE.                                                06040006
060500                                                                  06050006
060600     INITIALIZE DP030-CICS-API-FIELDS.                            06060006
060700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06070006
060800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06080006
060900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06090006
061000     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06100006
061100                                                                  06110006
061200     MOVE LENGTH OF ET306AI        TO DP030-MAP-LENGTH (1).       06120006
061300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06130006
061400     PERFORM 0001-CALL-CICS-ARCH-API.                             06140006
061500                                                                  06150006
061600     PERFORM 1000-CONTROL-PROCESSING                              06160006
061700                                                                  06170006
061800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06180006
061900     PERFORM 0001-CALL-CICS-ARCH-API.                             06190006
062000                                                                  06200006
062100*----------------------------------------------------------------*06210006
062200*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *06220006
062300*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *06230006
062400*----------------------------------------------------------------*06240006
062500                                                                  06250006
062600 0001-CALL-CICS-ARCH-API.                                         06260006
062700                                                                  06270006
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06280008
062900                                    DFHCOMMAREA                   06290008
063000                                    DP030-CICS-API-FIELDS         06300008
063100                                    DP020-STANDARD-COMMAREA       06310008
063200                                    ET306AI.                      06320008
063300                                                                  06330006
063400     IF  DP030-RC-CALL-SUCCESSFUL                                 06340006
063500         CONTINUE                                                 06350006
063600     ELSE                                                         06360006
063700         SET DP013-NO-ROLLBACK                                    06370006
063800             DP013-XCTL-DISPLAY-RESTART                           06380006
063900             DP013-CICS-ABEND      TO TRUE                        06390006
064000         MOVE '0001-CALL-CICS-ARCH-API'                           06400006
064100                                   TO DP013-PARAGRAPH             06410006
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06420008
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06430008
064400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06440006
064500         PERFORM DP013-0000-PROCESS-ABEND                         06450006
064600     END-IF.                                                      06460006
064700                                                                  06470006
064800*----------------------------------------------------------------*06480006
064900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06490006
065000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06500006
065100*                                                                *06510006
065200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06520006
065300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06530006
065400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06540006
065500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06550006
065600*----------------------------------------------------------------*06560006
065700                                                                  06570006
065800 1000-CONTROL-PROCESSING.                                         06580006
065900                                                                  06590006
066000     EVALUATE TRUE                                                06600006
066100         WHEN DP020-NEXT-ACT-INITIAL                              06610006
066200              INITIALIZE ASC-SPECIFIC-COMMAREA                    06620006
066300              MOVE EIBTRMID         TO  ASC-LIST-TERM-ID          06630006
066400                                        ASC-SEL-TERM-ID           06640006
066500              MOVE DP020-SRC-TASK-NUMBER                          06650006
066600                                    TO  ASC-LIST-TASK-NUMBER      06660006
066700                                        ASC-SEL-TASK-NUMBER       06670006
066800              MOVE PC-LIST-QUEUE-SEQ                              06680006
066900                                    TO  ASC-LIST-SEQ              06690006
067000              MOVE PC-SEL-QUEUE-SEQ TO  ASC-SEL-SEQ               06700006
067100                                                                  06710006
067200              PERFORM 1100-PROCESS-INTER-APPL-COMM                06720006
067300              PERFORM 4000-BUILD-INITIAL-PANEL                    06730006
067400                                                                  06740006
067500         WHEN DP020-NEXT-ACT-READ-MAP                             06750006
067600              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       06760006
067700                                       TO PV-TOP-ITEM             06770006
067800              MOVE ASC-HOLD-INTER-APPL TO INTER-APPL-COMM-AREA    06780006
067900              PERFORM 2000-PROCESS-PANEL                          06790006
068000                                                                  06800006
068100         WHEN DP020-NEXT-ACT-RETURN                               06810006
068200              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       06820006
068300                                   TO PV-TOP-ITEM                 06830006
068400              MOVE ZERO            TO ASC-ITEM-AT-TOP-OF-PANEL    06840006
068500              MOVE ASC-HOLD-INTER-APPL                            06850006
068600                                   TO INTER-APPL-COMM-AREA        06860006
068700              PERFORM 6000-REFRESH-PANEL-FROM-TEMP                06870006
068800              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  06880006
068900              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                06890006
069000                                                                  06900006
069100         WHEN OTHER                                               06910006
069200              SET DP013-LOGIC-ABEND TO TRUE                       06920006
069300              SET DP013-NO-ROLLBACK TO TRUE                       06930006
069400              MOVE '1000-CONTROL-PROCESSING'                      06940006
069500                                   TO DP013-PARAGRAPH             06950006
069600              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'   06960006
069700                                   TO DP013-MESSAGE-TEXT(1)       06970006
069800              PERFORM DP013-0000-PROCESS-ABEND                    06980006
069900     END-EVALUATE.                                                06990006
070000                                                                  07000006
070100 EJECT                                                            07010006
070200                                                                  07020006
070300*----------------------------------------------------------------*07030006
070400* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *07040006
070500* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *07050006
070600*----------------------------------------------------------------*07060006
070700                                                                  07070006
070800 1100-PROCESS-INTER-APPL-COMM.                                    07080006
070900                                                                  07090006
071000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07100006
071100     MOVE INTER-APPL-COMM-AREA     TO ASC-HOLD-INTER-APPL.        07110006
071200                                                                  07120006
071300                                                                  07130006
071400*----------------------------------------------------------------*07140006
071500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07150006
071600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07160006
071700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07170006
071800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07180006
071900* FUNCTION KEYS CAN GET THIS FAR.                                *07190006
072000*----------------------------------------------------------------*07200006
072100                                                                  07210006
072200 2000-PROCESS-PANEL.                                              07220006
072300                                                                  07230006
072400     EVALUATE TRUE                                                07240006
072500         WHEN DP020-SRC-AID = DP016-CLEAR                         07250006
072600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07260006
072700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07270006
072800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07280006
072900                                                                  07290006
073000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07300006
073100             PERFORM 2050-DELETE-LIST-QUEUE                       07310006
073200             PERFORM 4000-BUILD-INITIAL-PANEL                     07320006
073300                                                                  07330006
073400         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07340006
073500             PERFORM 2140-DESELECT-ALL-ITEMS                      07350006
073600             PERFORM 3200-RESET-ATTRIBUTES                        07360006
073700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07370006
073800                                                                  07380006
073900         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07390006
074000             PERFORM 2150-SELECT-ALL-ITEMS                        07400006
074100             PERFORM 3200-RESET-ATTRIBUTES                        07410006
074200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07420006
074300                                                                  07430006
074400         WHEN DP020-FK-GO-TO-TRAN (DP020-SRC-AID)                 07440006
074500             CONTINUE                                             07450006
074600                                                                  07460006
074700         WHEN OTHER                                               07470006
074800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07480006
074900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07490006
075000             IF  PS-NO-ERROR                                      07500006
075100                  SET DP030-CONTINUE-GO TO TRUE                   07510006
075200                  PERFORM 2100-CHECK-FUNCTION-KEY                 07520006
075300             ELSE                                                 07530006
075400                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            07540006
075500                  SET DP030-OVERRIDE-GO TO TRUE                   07550006
075600             END-IF                                               07560006
075700                                                                  07570006
075800     END-EVALUATE.                                                07580006
075900                                                                  07590006
076000 EJECT                                                            07600006
076100*----------------------------------------------------------------*07610006
076200*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07620006
076300*----------------------------------------------------------------*07630006
076400 2050-DELETE-LIST-QUEUE.                                          07640006
076500                                                                  07650006
076600     EXEC CICS                                                    07660006
076700         DELETEQ TS                                               07670006
076800             QUEUE (ASC-LIST-QUEUE-NAME)                          07680006
076900             RESP  (PV-CICS-RESP)                                 07690006
077000     END-EXEC.                                                    07700006
077100                                                                  07710006
077200     IF (PV-CICS-RESP = DFHRESP(NORMAL)                           07720006
077300     OR  PV-CICS-RESP = DFHRESP(QIDERR))                          07730006
077400         CONTINUE                                                 07740006
077500     ELSE                                                         07750006
077600         SET DP013-CICS-ABEND      TO TRUE                        07760006
077700         SET DP013-NO-ROLLBACK     TO TRUE                        07770006
077800                                                                  07780006
077900         MOVE '2050-DELETE-LIST-QUEUE'                            07790006
078000                                   TO DP013-PARAGRAPH             07800006
078100         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07810006
078200                                   TO DP013-MESSAGE-TEXT (1)      07820006
078300         PERFORM DP013-0000-PROCESS-ABEND                         07830006
078400     END-IF.                                                      07840006
078500                                                                  07850006
078600     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07860006
078700                                                                  07870006
078800 EJECT                                                            07880006
078900*----------------------------------------------------------------*07890006
079000* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07900006
079100* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07910006
079200* CICS ARCHITECTURE API.                                         *07920006
079300*----------------------------------------------------------------*07930006
079400                                                                  07940006
079500 2100-CHECK-FUNCTION-KEY.                                         07950006
079600                                                                  07960006
079700     EVALUATE TRUE                                                07970006
079800         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  07980006
079900             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              07990006
080000                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08000006
080100                                TO ET301-SELECTED-ITEMS           08010006
080200                                   ET300-NBR-SELECTED-ITEMS       08020006
080300                 PERFORM 5000-PREPARE-SEL-QUEUE                   08030006
080400             ELSE                                                 08040006
080500                 SET DP030-OVERRIDE-GO                            08050006
080600                                   TO TRUE                        08060006
080700                 MOVE PC-TSYMSG-00057                             08070006
080800                                   TO DP020-MSG-NUMBER            08080006
080900                 SET DP020-MSG-WARNING                            08090006
081000                                   TO TRUE                        08100006
081100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08110006
081200             END-IF                                               08120006
081300                                                                  08130006
081400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08140006
081500             MOVE +1               TO PV-TOP-ITEM                 08150006
081600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08160006
081700                                                                  08170006
081800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08180006
081900             PERFORM 2110-BROWSE-BACKWARD                         08190006
082000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08200006
082100                                                                  08210006
082200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08220006
082300             PERFORM 2120-BROWSE-FORWARD                          08230006
082400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08240006
082500                                                                  08250006
082600         WHEN DP020-SRC-AID = DP016-ENTER                         08260006
082700             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08270006
082800**           IF  PS-ERROR                                         08280006
082900**               CONTINUE                                         08290006
083000**           ELSE                                                 08300006
083100**               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08310006
083200**           END-IF                                               08320006
083300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08330006
083400                                                                  08340006
083500         WHEN OTHER                                               08350006
083600             SET DP013-NO-ROLLBACK                                08360006
083700                 DP013-XCTL-DISPLAY-RESTART                       08370006
083800                 DP013-CICS-ABEND  TO TRUE                        08380006
083900             MOVE '2100-CHECK-FUNCTION-KEY'                       08390006
084000                                   TO DP013-PARAGRAPH             08400006
084100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08410006
084200                                   TO DP013-MESSAGE-TEXT (1)      08420006
084300             PERFORM DP013-0000-PROCESS-ABEND                     08430006
084400     END-EVALUATE.                                                08440006
084500                                                                  08450006
084600*----------------------------------------------------------------*08460006
084700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08470006
084800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08480006
084900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08490006
085000*    MESSAGE.                                                    *08500006
085100*----------------------------------------------------------------*08510006
085200                                                                  08520006
085300 2110-BROWSE-BACKWARD.                                            08530006
085400                                                                  08540006
085500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08550006
085600         GIVING PV-TOP-ITEM.                                      08560006
085700                                                                  08570006
085800     IF  ((PV-TOP-ITEM < +1)                                      08580006
085900       OR (PV-TOP-ITEM = +1))                                     08590006
086000         MOVE +1                   TO PV-TOP-ITEM                 08600006
086100*        -- TOP OF LIST --                                        08610006
086200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08620006
086300         SET DP020-MSG-INFORMATIONAL TO TRUE                      08630006
086400     END-IF.                                                      08640006
086500                                                                  08650006
086600 EJECT                                                            08660006
086700*----------------------------------------------------------------*08670006
086800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08680006
086900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08690006
087000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08700006
087100*----------------------------------------------------------------*08710006
087200                                                                  08720006
087300 2120-BROWSE-FORWARD.                                             08730006
087400                                                                  08740006
087500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08750006
087600         GIVING PV-TOP-ITEM.                                      08760006
087700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08770006
087800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08780006
087900                                   TO PV-TOP-ITEM                 08790006
088000*        -- BOTTOM OF LIST --                                     08800006
088100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08810006
088200         SET DP020-MSG-INFORMATIONAL                              08820006
088300                                   TO TRUE                        08830006
088400     ELSE                                                         08840006
088500         COMPUTE PV-BOTTOM-ITEM =                                 08850006
088600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08860006
088700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08870006
088800*            -- BOTTOM OF LIST --                                 08880006
088900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08890006
089000             SET DP020-MSG-INFORMATIONAL                          08900006
089100                                   TO TRUE                        08910006
089200         END-IF                                                   08920006
089300     END-IF.                                                      08930006
089400 EJECT                                                            08940006
089500*----------------------------------------------------------------*08950006
089600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08960006
089700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08970006
089800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08980006
089900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08990006
090000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09000006
090100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09010006
090200*----------------------------------------------------------------*09020006
090300                                                                  09030006
090400 2130-CHECK-FOR-JUMP-BROWSE.                                      09040006
090500                                                                  09050006
090600     SET PS-NO-ERROR               TO TRUE.                       09060006
090700     IF (ASC-START-ITEM-REQUEST = SPACE)                          09070006
090800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09080006
090900                                   TO PV-TOP-ITEM                 09090006
091000     ELSE                                                         09100006
091100         MOVE ASC-START-ITEM-REQUEST                              09110006
091200                                   TO DP010I-UNEDITED-FIELD       09120006
091300                                      PV-START-ITEM-REQUEST       09130006
091400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       09140006
091500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09150006
091600         SET DP010I-NEGATIVE-NOT-ALLOWED                          09160006
091700                                   TO TRUE                        09170006
091810         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09181006
091820                         USING DP010I-NUMERIC-EDIT-AREA           09182006
091900                                                                  09190006
092000         IF  NOT DP010I-ERROR-DETECTED                            09200006
092100             MOVE DP010I-NUMERIC-FIELD                            09210006
092200                                   TO  ASC-START-ITEM-REQUEST-N   09220006
092300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09230006
092400                 IF  ASC-START-ITEM-REQUEST-N >                   09240006
092500                                          ASC-NUMBER-OF-ITEMS-READ09250006
092600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09260006
092700                     COMPUTE PV-TOP-ITEM =                        09270006
092800                             ASC-NUMBER-OF-ITEMS-READ             09280006
092900                             - PC-ITEMS-PER-PANEL + 1             09290006
093000                     IF  PV-TOP-ITEM < +1                         09300006
093100                         MOVE +1   TO PV-TOP-ITEM                 09310006
093200                         MOVE PC-TSYMSG-00070                     09320006
093300                                   TO DP020-MSG-NUMBER            09330006
093400                         SET DP020-MSG-INFORMATIONAL              09340006
093500                                   TO TRUE                        09350006
093600                     END-IF                                       09360006
093700                 ELSE                                             09370006
093800                     MOVE ASC-START-ITEM-REQUEST-N                09380006
093900                                   TO PV-TOP-ITEM                 09390006
094000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09400006
094100                     COMPUTE PV-BOTTOM-ITEM =                     09410006
094200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09420006
094300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09430006
094400*                        -- BOTTOM OF LIST --                     09440006
094500                         MOVE PC-TSYMSG-00070                     09450006
094600                                   TO DP020-MSG-NUMBER            09460006
094700                         SET DP020-MSG-INFORMATIONAL              09470006
094800                                   TO TRUE                        09480006
094900                     END-IF                                       09490006
095000                 END-IF                                           09500006
095100             ELSE                                                 09510006
095200*                --- VALUE OUT OF RANGE ----                      09520006
095300                 MOVE PC-TSYMSG-00101                             09530006
095400                                   TO DP020-MSG-NUMBER            09540006
095500                 MOVE -1           TO ASTRTITL                    09550006
095600                 SET DP030-SET-CURSOR-APPL-1                      09560006
095700                                   TO TRUE                        09570006
095800                 MOVE DP015-REVERSE                               09580006
095900                                   TO ASTRTITH                    09590006
096000                 MOVE DP015-RED    TO ASTRTITC                    09600006
096100                 MOVE DP015-UNP-NUM-BRT-OFF                       09610006
096200                                   TO ASTRTITA                    09620006
096300                 SET DP020-MSG-FATAL                              09630006
096400                                   TO TRUE                        09640006
096500                 SET PS-ERROR      TO TRUE                        09650006
096600             END-IF                                               09660006
096700                                                                  09670006
096800         ELSE                                                     09680006
096900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09690006
097000             MOVE -1               TO ASTRTITL                    09700006
097100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09710006
097200             MOVE DP015-REVERSE    TO ASTRTITH                    09720006
097300             MOVE DP015-RED        TO ASTRTITC                    09730006
097400             MOVE DP015-UNP-NUM-BRT-OFF                           09740006
097500                                   TO ASTRTITA                    09750006
097600             SET DP020-MSG-FATAL   TO TRUE                        09760006
097700             SET PS-ERROR          TO TRUE                        09770006
097800         END-IF                                                   09780006
097900     END-IF.                                                      09790006
098000 EJECT                                                            09800006
098100*----------------------------------------------------------------*09810006
098200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09820006
098300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09830006
098400*----------------------------------------------------------------*09840006
098500                                                                  09850006
098600 2140-DESELECT-ALL-ITEMS.                                         09860006
098700                                                                  09870006
098800     MOVE +1                       TO ASC-BLK-SUB.                09880006
098900                                                                  09890006
099000     PERFORM 2141-CLEAR-SELECTED-INDS                             09900006
099100         VARYING ASC-ITEM-SUB                                     09910006
099200         FROM 1 BY 1                                              09920006
099300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09930006
099400                                                                  09940006
099500     ADD +1                        TO ASC-BLK-SUB.                09950006
099600                                                                  09960006
099700     PERFORM 2141-CLEAR-SELECTED-INDS                             09970006
099800         VARYING ASC-ITEM-SUB                                     09980006
099900         FROM 1 BY 1                                              09990006
100000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10000006
100100                                                                  10010006
100200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10020006
100300                                   TO PV-LIST-ITEM-NUMBER.        10030006
100400                                                                  10040006
100500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10050006
100600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10060006
100700                                                                  10070006
100800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10080006
100900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10090006
101000         MOVE +1                   TO ASC-BLK-SUB                 10100006
101100                                                                  10110006
101200         PERFORM 5100-WRITE-TEMP-STORAGE                          10120006
101300                                                                  10130006
101400         MOVE +1                   TO PV-BLOCK-NUMBER             10140006
101500                                                                  10150006
101600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10160006
101700             PV-FIRST-BLOCK-IN-ARRAY - 1                          10170006
101800                                                                  10180006
101900         PERFORM                                                  10190006
102000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10200006
102100                                                                  10210006
102200             PERFORM 4410-READ-TEMP-STORAGE                       10220006
102300                                                                  10230006
102400             PERFORM 2141-CLEAR-SELECTED-INDS                     10240006
102500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10250006
102600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10260006
102700                                                                  10270006
102800             PERFORM 5100-WRITE-TEMP-STORAGE                      10280006
102900                                                                  10290006
103000             ADD +1                TO PV-BLOCK-NUMBER             10300006
103100                                                                  10310006
103200         END-PERFORM                                              10320006
103300                                                                  10330006
103400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10340006
103500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10350006
103600                                                                  10360006
103700         PERFORM                                                  10370006
103800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10380006
103900                   ASC-HIGHEST-BLOCK-WRITTEN                      10390006
104000                                                                  10400006
104100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10410006
104200                                   TO PV-BLOCK-NUMBER             10420006
104300                                                                  10430006
104400             PERFORM 4410-READ-TEMP-STORAGE                       10440006
104500                                                                  10450006
104600             PERFORM 2141-CLEAR-SELECTED-INDS                     10460006
104700                 VARYING ASC-ITEM-SUB                             10470006
104800                 FROM 1 BY 1                                      10480006
104900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10490006
105000                                                                  10500006
105100             PERFORM 5100-WRITE-TEMP-STORAGE                      10510006
105200                                                                  10520006
105300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10530006
105400                                                                  10540006
105500         END-PERFORM                                              10550006
105600                                                                  10560006
105700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10570006
105800                                   TO PV-BLOCK-NUMBER             10580006
105900                                                                  10590006
106000         PERFORM 4410-READ-TEMP-STORAGE                           10600006
106100     END-IF.                                                      10610006
106200                                                                  10620006
106300     MOVE +0 TO ASC-NUMBER-OF-SELECTED-ITEMS.                     10630006
106400     MOVE +0 TO ASC-START-OF-SELECTED-RANGE.                      10640006
106500     MOVE +0 TO ASC-END-OF-SELECTED-RANGE.                        10650006
106600                                                                  10660006
106700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10670006
106800                                                                  10680006
106900 EJECT                                                            10690006
107000*----------------------------------------------------------------*10700006
107100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10710006
107200*----------------------------------------------------------------*10720006
107300                                                                  10730006
107400 2141-CLEAR-SELECTED-INDS.                                        10740006
107500                                                                  10750006
107600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10760006
107700             NOT EQUAL ZERO                                       10770006
107800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10780006
107900         OR  NOT ASC-TEMP-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)     10790006
108000             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10800006
108100                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10810006
108200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10820006
108300                                   TO TRUE                        10830006
108400         END-IF                                                   10840006
108500     END-IF.                                                      10850006
108600                                                                  10860006
108700 EJECT                                                            10870006
108800*----------------------------------------------------------------*10880006
108900*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *10890006
109000*  FOR ALL ITEMS.                                                *10900006
109100*----------------------------------------------------------------*10910006
109200                                                                  10920006
109300 2150-SELECT-ALL-ITEMS.                                           10930006
109400                                                                  10940006
109500     MOVE +1                       TO ASC-BLK-SUB.                10950006
109600                                                                  10960006
109700     PERFORM 2151-SET-SELECTED-INDS                               10970006
109800         VARYING ASC-ITEM-SUB                                     10980006
109900         FROM 1 BY 1                                              10990006
110000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11000006
110100                                                                  11010006
110200     ADD +1                        TO ASC-BLK-SUB.                11020006
110300                                                                  11030006
110400     PERFORM 2151-SET-SELECTED-INDS                               11040006
110500         VARYING ASC-ITEM-SUB                                     11050006
110600         FROM 1 BY 1                                              11060006
110700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11070006
110800                                                                  11080006
110900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11090006
111000                                   TO PV-LIST-ITEM-NUMBER.        11100006
111100                                                                  11110006
111200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11120006
111300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11130006
111400                                                                  11140006
111500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11150006
111600        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11160006
111700         MOVE +1                   TO ASC-BLK-SUB                 11170006
111800                                                                  11180006
111900         PERFORM 5100-WRITE-TEMP-STORAGE                          11190006
112000                                                                  11200006
112100         MOVE +1                   TO PV-BLOCK-NUMBER             11210006
112200                                                                  11220006
112300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11230006
112400             PV-FIRST-BLOCK-IN-ARRAY - 1                          11240006
112500                                                                  11250006
112600         PERFORM                                                  11260006
112700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11270006
112800                                                                  11280006
112900             PERFORM 4410-READ-TEMP-STORAGE                       11290006
113000                                                                  11300006
113100             PERFORM 2151-SET-SELECTED-INDS                       11310006
113200                 VARYING ASC-ITEM-SUB                             11320006
113300                 FROM 1 BY 1                                      11330006
113400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11340006
113500                                                                  11350006
113600             PERFORM 5100-WRITE-TEMP-STORAGE                      11360006
113700                                                                  11370006
113800             ADD +1                TO PV-BLOCK-NUMBER             11380006
113900                                                                  11390006
114000         END-PERFORM                                              11400006
114100                                                                  11410006
114200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11420006
114300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11430006
114400                                                                  11440006
114500         PERFORM                                                  11450006
114600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11460006
114700                   ASC-HIGHEST-BLOCK-WRITTEN                      11470006
114800                                                                  11480006
114900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11490006
115000                                   TO PV-BLOCK-NUMBER             11500006
115100                                                                  11510006
115200             PERFORM 4410-READ-TEMP-STORAGE                       11520006
115300                                                                  11530006
115400             PERFORM 2151-SET-SELECTED-INDS                       11540006
115500                 VARYING ASC-ITEM-SUB                             11550006
115600                 FROM 1 BY 1                                      11560006
115700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11570006
115800                                                                  11580006
115900             PERFORM 5100-WRITE-TEMP-STORAGE                      11590006
116000                                                                  11600006
116100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11610006
116200                                                                  11620006
116300         END-PERFORM                                              11630006
116400                                                                  11640006
116500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11650006
116600                                   TO PV-BLOCK-NUMBER             11660006
116700                                                                  11670006
116800         PERFORM 4410-READ-TEMP-STORAGE                           11680006
116900     END-IF.                                                      11690006
117000                                                                  11700006
117100                                                                  11710006
117200     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11720006
117300                       ASC-NUMBER-OF-SELECTED-ITEMS.              11730006
117400                                                                  11740006
117500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11750006
117600                                                                  11760006
117700 EJECT                                                            11770006
117800*----------------------------------------------------------------*11780006
117900*    MARK EACH ITEM AS BEING SELECTED.                           *11790006
118000*----------------------------------------------------------------*11800006
118100                                                                  11810006
118200 2151-SET-SELECTED-INDS.                                          11820006
118300                                                                  11830006
118400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11840006
118500             NOT EQUAL ZERO                                       11850006
118600         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11860006
118700             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11870006
118800                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11880006
118900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11890006
119000                               TO  TRUE                           11900006
119100         END-IF                                                   11910006
119200     END-IF.                                                      11920006
119300                                                                  11930006
119400*----------------------------------------------------------------*11940006
119500*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *11950006
119600*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *11960006
119700*----------------------------------------------------------------*11970006
119800                                                                  11980006
119900 2200-MOVE-SCREEN-TO-COMMAREA.                                    11990006
120000                                                                  12000006
120100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12010006
120200     MOVE +1                       TO PV-SUB.                     12020006
120300                                                                  12030006
120400     PERFORM 3100-SET-SUBSCRIPTS.                                 12040006
120500                                                                  12050006
120600     IF  ASTRTITL > ZERO                                          12060006
120700         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12070006
120800     ELSE                                                         12080006
120900         IF  ASTRTITF EQUAL DP015-ERASE-EOF                       12090006
121000             INITIALIZE ASC-START-ITEM-REQUEST                    12100006
121100         END-IF                                                   12110006
121200     END-IF.                                                      12120006
121300                                                                  12130006
121400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12140006
121500         VARYING PV-SUB                                           12150006
121600         FROM 1 BY 1                                              12160006
121700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12170006
121800                                                                  12180006
121900******************************************************************12190006
122000** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12200006
122100******************************************************************12210006
122200                                                                  12220006
122300 2210-MOVE-LINES-TO-COMMAREA.                                     12230006
122400                                                                  12240006
122500     IF  MR-SELECTL (PV-SUB) > ZERO                               12250006
122600         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12260006
122700         MOVE MR-SELECTI (PV-SUB)                                 12270006
122800                                   TO ASC-TEMP-SELECTED-SW        12280006
122900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12290006
123000     ELSE                                                         12300006
123100         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12310006
123200                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12320006
123300                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12330006
123400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12340006
123500         END-IF                                                   12350006
123600     END-IF.                                                      12360006
123700                                                                  12370006
123800     ADD +1                        TO ASC-ITEM-SUB.               12380006
123900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12390006
124000         ADD +1                    TO ASC-BLK-SUB                 12400006
124100         MOVE +1                   TO ASC-ITEM-SUB                12410006
124200     END-IF.                                                      12420006
124300                                                                  12430006
124400*----------------------------------------------------------------*12440006
124500*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *12450006
124600*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *12460006
124700*----------------------------------------------------------------*12470006
124800                                                                  12480006
124900 3000-EDIT-DATA-IN-COMMAREA.                                      12490006
125000                                                                  12500006
125100     SET PS-NO-ERROR               TO TRUE.                       12510006
125200     PERFORM 3200-RESET-ATTRIBUTES.                               12520006
125300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12530006
125400**                                                                12540006
125500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12550006
125600* EDITTING IS DONE FROM THE BOTTOM UP.                            12560006
125700**                                                                12570006
125800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12580006
125900         ASC-ITEMS-DISPLAYED - 1.                                 12590006
126000     PERFORM 3100-SET-SUBSCRIPTS.                                 12600006
126100     PERFORM 3300-EDIT-SELECTIONS                                 12610006
126200         VARYING PV-SUB                                           12620006
126300         FROM PV-SUB BY -1                                        12630006
126400         UNTIL PV-SUB < +1.                                       12640006
126500                                                                  12650006
126600     IF  PS-NO-ERROR                                              12660006
126700         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12670006
126800     END-IF.                                                      12680006
126900                                                                  12690006
127000     IF  ((PS-NO-ERROR)                                           12700006
127100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12710006
127200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12720006
127300             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12730006
127400     END-IF.                                                      12740006
127500 EJECT                                                            12750006
127600*----------------------------------------------------------------*12760006
127700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12770006
127800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12780006
127900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12790006
128000*                                                                *12800006
128100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12810006
128200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12820006
128300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12830006
128400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12840006
128500*----------------------------------------------------------------*12850006
128600                                                                  12860006
128700 3100-SET-SUBSCRIPTS.                                             12870006
128800                                                                  12880006
128900     COMPUTE ASC-ITEM-SUB =                                       12890006
129000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12900006
129100                                                                  12910006
129200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12920006
129300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12930006
129400                                                                  12940006
129500         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               12950006
129600     ELSE                                                         12960006
129700         MOVE +1                     TO ASC-BLK-SUB               12970006
129800     END-IF.                                                      12980006
129900                                                                  12990006
130000*----------------------------------------------------------------*13000006
130100*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *13010006
130200*----------------------------------------------------------------*13020006
130300                                                                  13030006
130400 3200-RESET-ATTRIBUTES.                                           13040006
130500                                                                  13050006
130600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13060006
130700     MOVE DP015-GREEN              TO ASTRTITC.                   13070006
130800     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13080006
130900                                                                  13090006
131000     PERFORM                                                      13100006
131100         VARYING PV-SUB                                           13110006
131200         FROM 1 BY 1                                              13120006
131300         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13130006
131400         MOVE DP015-UNP-ALP-NOR-OFF                               13140006
131500                                   TO MR-SELECTA (PV-SUB)         13150006
131600         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         13160006
131700         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         13170006
131800     END-PERFORM.                                                 13180006
131900                                                                  13190006
132000*----------------------------------------------------------------*13200006
132100*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *13210006
132200*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *13220006
132300*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *13230006
132400*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *13240006
132500*----------------------------------------------------------------*13250006
132600                                                                  13260006
132700 3300-EDIT-SELECTIONS.                                            13270006
132800                                                                  13280006
132900     EVALUATE TRUE                                                13290006
133000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13300006
133100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13310006
133200                 CONTINUE                                         13320006
133300                                                                  13330006
133400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13340006
133500             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13350006
133600                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   13360006
133700                 MOVE ASC-TEMP-SELECTED-SW                        13370006
133800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13380006
133900                                TO ASC-SELECTED-SW                13390006
134000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13400006
134100             END-IF                                               13410006
134200                                                                  13420006
134300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13430006
134400                 = SPACE                                          13440006
134500             EVALUATE TRUE                                        13450006
134600                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13460006
134700                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13470006
134800                     MOVE SPACE TO ASC-SELECTED-SW                13480006
134900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13490006
135000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13500006
135100                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13510006
135200                     MOVE SPACE TO ASC-SELECTED-SW                13520006
135300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13530006
135400                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13540006
135500                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      13550006
135600                     MOVE SPACE TO ASC-SELECTED-SW                13560006
135700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13570006
135800             END-EVALUATE                                         13580006
135900                                                                  13590006
136000         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13600006
136100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13610006
136200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13620006
136300             END-IF                                               13630006
136400             PERFORM 3310-EDIT-RANGE                              13640006
136500                                                                  13650006
136600         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             13660006
136700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13670006
136800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13680006
136900             END-IF                                               13690006
137000             PERFORM 3310-EDIT-RANGE                              13700006
137100                                                                  13710006
137200         WHEN OTHER                                               13720006
137300             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13730006
137400             SET DP020-MSG-FATAL    TO TRUE                       13740006
137500             MOVE -1                TO MR-SELECTL (PV-SUB)        13750006
137600             SET DP030-SET-CURSOR-APPL-1                          13760006
137700                                    TO TRUE                       13770006
137800             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13780006
137900             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        13790006
138000             SET PS-ERROR TO TRUE                                 13800006
138100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13810006
138200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13820006
138300                 MOVE SPACE         TO ASC-SELECTED-SW            13830006
138400                                        (ASC-BLK-SUB ASC-ITEM-SUB)13840006
138500             END-IF                                               13850006
138600                                                                  13860006
138700     END-EVALUATE.                                                13870006
138800                                                                  13880006
138900     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13890006
139000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13900006
139100     IF  ASC-ITEM-SUB < 1                                         13910006
139200         SUBTRACT +1 FROM ASC-BLK-SUB                             13920006
139300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13930006
139400     END-IF.                                                      13940006
139500                                                                  13950006
139600*----------------------------------------------------------------*13960006
139700*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *13970006
139800*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *13980006
139900*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *13990006
140000*  THE ENDING.                                                   *14000006
140100*----------------------------------------------------------------*14010006
140200                                                                  14020006
140300 3310-EDIT-RANGE.                                                 14030006
140400                                                                  14040006
140500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14050006
140600         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14060006
140700             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14070006
140800                                   TO ASC-SELECTED-SW             14080006
140900                                        (ASC-BLK-SUB ASC-ITEM-SUB)14090006
141000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14100006
141100         ELSE                                                     14110006
141200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14120006
141300                 CONTINUE                                         14130006
141400             ELSE                                                 14140006
141500*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14150006
141600                 MOVE PC-TSYMSG-00054                             14160006
141700                                   TO DP020-MSG-NUMBER            14170006
141800                 SET DP020-MSG-FATAL                              14180006
141900                                   TO TRUE                        14190006
142000                 MOVE -1           TO MR-SELECTL (PV-SUB)         14200006
142100                 SET DP030-SET-CURSOR-APPL-1                      14210006
142200                                   TO TRUE                        14220006
142300                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14230006
142400                 MOVE DP015-UNDERLINE                             14240006
142500                                   TO MR-SELECTH (PV-SUB)         14250006
142600                 SET PS-ERROR      TO TRUE                        14260006
142700             END-IF                                               14270006
142800         END-IF                                                   14280006
142900     ELSE                                                         14290006
143000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14300006
143100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14310006
143200                                   TO ASC-SELECTED-SW             14320006
143300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14330006
143400             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14340006
143500         ELSE                                                     14350006
143600             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14360006
143700                 CONTINUE                                         14370006
143800             ELSE                                                 14380006
143900*                -- ONLY ONE END-OF-RANGE ALLOWED --              14390006
144000                 MOVE PC-TSYMSG-00055                             14400006
144100                                   TO DP020-MSG-NUMBER            14410006
144200                 SET DP020-MSG-FATAL                              14420006
144300                                   TO TRUE                        14430006
144400                 MOVE -1           TO MR-SELECTL (PV-SUB)         14440006
144500                 SET DP030-SET-CURSOR-APPL-1                      14450006
144600                                   TO TRUE                        14460006
144700                 SET PS-ERROR      TO TRUE                        14470006
144800             END-IF                                               14480006
144900         END-IF                                                   14490006
145000     END-IF.                                                      14500006
145100                                                                  14510006
145200*----------------------------------------------------------------*14520006
145300*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *14530006
145400*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *14540006
145500*----------------------------------------------------------------*14550006
145600                                                                  14560006
145700 3400-CHECK-RANGE-SEQUENCE.                                       14570006
145800                                                                  14580006
145900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14590006
146000       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14600006
146100       AND  ASC-START-OF-SELECTED-RANGE >                         14610006
146200                                         ASC-END-OF-SELECTED-RANGE14620006
146300*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14630006
146400         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 14640006
146500         SET DP020-MSG-FATAL TO TRUE                              14650006
146600         SET PS-ERROR TO TRUE                                     14660006
146700         PERFORM 3410-POSITION-AT-ERROR                           14670006
146800     END-IF.                                                      14680006
146900                                                                  14690006
147000*----------------------------------------------------------------*14700006
147100*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *14710006
147200*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *14720006
147300*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *14730006
147400*----------------------------------------------------------------*14740006
147500                                                                  14750006
147600 3410-POSITION-AT-ERROR.                                          14760006
147700                                                                  14770006
147800     SET DP030-SET-CURSOR-APPL-1                                  14780006
147900                                   TO TRUE.                       14790006
148000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14800006
148100                    - PV-TOP-ITEM + 1.                            14810006
148200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14820006
148300         CONTINUE                                                 14830006
148400     ELSE                                                         14840006
148500         MOVE -1                   TO MR-SELECTL (PV-SUB)         14850006
148600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14860006
148700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14870006
148800     END-IF.                                                      14880006
148900*                                                                 14890006
149000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14900006
149100                    - PV-TOP-ITEM + 1.                            14910006
149200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14920006
149300         CONTINUE                                                 14930006
149400     ELSE                                                         14940006
149500         MOVE -1                   TO MR-SELECTL (PV-SUB)         14950006
149600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14960006
149700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14970006
149800     END-IF.                                                      14980006
149900 EJECT                                                            14990006
150000*----------------------------------------------------------------*15000006
150100*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *15010006
150200*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *15020006
150300*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *15030006
150400*----------------------------------------------------------------*15040006
150500                                                                  15050006
150600 3500-MARK-RANGE-AS-SELECTED.                                     15060006
150700                                                                  15070006
150800     MOVE +1                       TO  ASC-BLK-SUB.               15080006
150900     PERFORM 3510-MARK-SELECTED-INDS                              15090006
151000         VARYING ASC-ITEM-SUB                                     15100006
151100         FROM 1 BY 1                                              15110006
151200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15120006
151300                                                                  15130006
151400     ADD +1                        TO ASC-BLK-SUB.                15140006
151500     PERFORM 3510-MARK-SELECTED-INDS                              15150006
151600         VARYING ASC-ITEM-SUB                                     15160006
151700         FROM 1 BY 1                                              15170006
151800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15180006
151900                                                                  15190006
152000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15200006
152100                                   TO  PV-LIST-ITEM-NUMBER.       15210006
152200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15220006
152300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15230006
152400               PC-ITEMS-PER-PANEL).                               15240006
152500                                                                  15250006
152600     MOVE ASC-START-OF-SELECTED-RANGE                             15260006
152700                                   TO PV-START-OF-SELECTED-RANGE. 15270006
152800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15280006
152900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15290006
153000               PC-ITEMS-PER-PANEL).                               15300006
153100                                                                  15310006
153200     MOVE ASC-END-OF-SELECTED-RANGE                               15320006
153300                                   TO  PV-END-OF-SELECTED-RANGE.  15330006
153400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15340006
153500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15350006
153600               PC-ITEMS-PER-PANEL).                               15360006
153700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15370006
153800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15380006
153900                                                                  15390006
154000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15400006
154100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15410006
154200         MOVE +1                   TO ASC-BLK-SUB                 15420006
154300         PERFORM 5100-WRITE-TEMP-STORAGE                          15430006
154400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15440006
154500             PV-FIRST-BLOCK-IN-ARRAY - 1                          15450006
154600                                                                  15460006
154700         PERFORM                                                  15470006
154800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15480006
154900                   PV-PREV-BLOCK-IN-ARRAY                         15490006
155000             MOVE PV-FIRST-BLOCK-IN-RANGE                         15500006
155100                                   TO PV-BLOCK-NUMBER             15510006
155200             PERFORM 4410-READ-TEMP-STORAGE                       15520006
155300             PERFORM 3510-MARK-SELECTED-INDS                      15530006
155400                 VARYING ASC-ITEM-SUB                             15540006
155500                 FROM 1 BY 1                                      15550006
155600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15560006
155700             PERFORM 5100-WRITE-TEMP-STORAGE                      15570006
155800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15580006
155900         END-PERFORM                                              15590006
156000                                                                  15600006
156100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15610006
156200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15620006
156300         PERFORM                                                  15630006
156400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15640006
156500                   PV-LAST-BLOCK-IN-RANGE                         15650006
156600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15660006
156700                                   TO PV-BLOCK-NUMBER             15670006
156800             PERFORM 4410-READ-TEMP-STORAGE                       15680006
156900             PERFORM 3510-MARK-SELECTED-INDS                      15690006
157000                 VARYING ASC-ITEM-SUB                             15700006
157100                 FROM 1 BY 1                                      15710006
157200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15720006
157300             PERFORM 5100-WRITE-TEMP-STORAGE                      15730006
157400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15740006
157500         END-PERFORM                                              15750006
157600                                                                  15760006
157700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15770006
157800                                   TO PV-BLOCK-NUMBER             15780006
157900         PERFORM 4410-READ-TEMP-STORAGE                           15790006
158000     END-IF.                                                      15800006
158100                                                                  15810006
158200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15820006
158300                                      ASC-END-OF-SELECTED-RANGE.  15830006
158400 EJECT                                                            15840006
158500*----------------------------------------------------------------*15850006
158600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15860006
158700*----------------------------------------------------------------*15870006
158800                                                                  15880006
158900 3510-MARK-SELECTED-INDS.                                         15890006
159000                                                                  15900006
159100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15910006
159200                                ASC-ITEM-SUB) >                   15920006
159300         ASC-START-OF-SELECTED-RANGE)                             15930006
159400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15940006
159500                                ASC-ITEM-SUB) =                   15950006
159600         ASC-START-OF-SELECTED-RANGE)                             15960006
159700                                                                  15970006
159800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15980006
159900                                    ASC-ITEM-SUB) <               15990006
160000             ASC-END-OF-SELECTED-RANGE)                           16000006
160100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16010006
160200                                    ASC-ITEM-SUB) =               16020006
160300             ASC-END-OF-SELECTED-RANGE)                           16030006
160400                                                                  16040006
160500             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16050006
160600                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   16060006
160700                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   16070006
160800                               TO TRUE                            16080006
160900                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              16090006
161000                               TO TRUE                            16100006
161100                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    16110006
161200             END-IF                                               16120006
161300         END-IF                                                   16130006
161400     END-IF.                                                      16140006
161500 EJECT                                                            16150006
161600*----------------------------------------------------------------*16160006
161700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16170006
161800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16180006
161900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16190006
162000*    DISPLAY THE PANEL TO USER.                                  *16200006
162100*----------------------------------------------------------------*16210006
162200                                                                  16220006
162300 4000-BUILD-INITIAL-PANEL.                                        16230006
162400                                                                  16240006
162500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            16250006
162600                                 ASC-BLOCK-ENTRIES (2).           16260006
162700     MOVE +1                 TO  ASC-BLK-SUB.                     16270006
162800     SET ASC-ITEMS-LEFT-ON-DB                                     16280006
162900                             TO TRUE.                             16290006
163000                                                                  16300006
163100     MOVE +0                 TO ASC-ITEM-SUB                      16310006
163200                                ASC-NUMBER-OF-ITEMS-READ          16320006
163300                                ASC-NUMBER-OF-SELECTED-ITEMS      16330006
163400                                ASC-HIGHEST-BLOCK-WRITTEN         16340006
163500                                ASC-START-OF-SELECTED-RANGE       16350006
163600                                ASC-END-OF-SELECTED-RANGE         16360006
163700                                ASC-ITEM-AT-TOP-OF-PANEL.         16370006
163800                                                                  16380006
163900     PERFORM 4100-PREPARE-CURSOR.                                 16390006
164000                                                                  16400006
164100     IF PS-ERROR                                                  16410006
164200         CONTINUE                                                 16420006
164300     ELSE                                                         16430006
164400         PERFORM 4010-OPEN-CURSOR                                 16440006
164500         PERFORM 4300-READ-ITEMS-FROM-DB                          16450006
164600         PERFORM 4020-CLOSE-CURSOR                                16460006
164700     END-IF.                                                      16470006
164800                                                                  16480006
164900     MOVE +1                   TO  PV-TOP-ITEM.                   16490006
165000                                                                  16500006
165100*    ** THE FOLLOWING 1 LINE WAS ADDED **                         16510006
165200     MOVE SPACE                TO  ASC-START-ITEM-REQUEST.        16520006
165300                                                                  16530006
165400     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          16540006
165500         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    16550006
165600         SET DP020-MSG-FATAL   TO  TRUE                           16560006
165700                                                                  16570006
165800         IF  PS-ERROR                                             16580006
165900             CONTINUE                                             16590006
166000         ELSE                                                     16600006
166100             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER           16610006
166200         END-IF                                                   16620006
166300                                                                  16630006
166400     ELSE                                                         16640006
166500         MOVE -1               TO MR-SELECTL (1)                  16650006
166600         SET DP030-SET-CURSOR-APPL-1                              16660006
166700                               TO TRUE                            16670006
166800         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     16680006
166900     END-IF.                                                      16690006
167000                                                                  16700006
167100                                                                  16710006
167200 4010-OPEN-CURSOR.                                                16720006
167300                                                                  16730006
167400     EVALUATE TRUE                                                16740006
167500         WHEN PS-USE-ENT-ID-CSR                                   16750006
167600             EXEC SQL                                             16760006
167700                  OPEN ENT-ID-CSR                                 16770006
167800             END-EXEC                                             16780006
167900         WHEN PS-USE-INCHG-ID-CSR                                 16790006
168000             EXEC SQL                                             16800006
168100                  OPEN INCHG-ID-CSR                               16810006
168200             END-EXEC                                             16820006
168300         WHEN PS-USE-VENDOR-NAME-CSR                              16830006
168400             EXEC SQL                                             16840006
168500                  OPEN VENDOR-NAME-CSR                            16850006
168600             END-EXEC                                             16860006
168700         WHEN PS-USE-NETWRK-TSET-CSR                              16870006
168800             EXEC SQL                                             16880006
168900                  OPEN NETWRK-TSET-CSR                            16890006
169000             END-EXEC                                             16900006
169100     END-EVALUATE.                                                16910006
169200                                                                  16920006
169300     EVALUATE TRUE                                                16930006
169400         WHEN SQLCODE = ZERO                                      16940006
169500         WHEN SQLCODE = +100                                      16950006
169600             CONTINUE                                             16960006
169700         WHEN SQLCODE = -904                                      16970006
169800         WHEN SQLCODE = -913                                      16980006
169900              PERFORM 9900-SOFT-ABORT                             16990006
170000         WHEN SQLWARN0 NOT = SPACES                               17000006
170100         WHEN SQLCODE < ZERO                                      17010006
170200         WHEN SQLCODE > ZERO                                      17020006
170300             MOVE '4010-OPEN-CURSOR'                              17030006
170400                               TO DP013-PARAGRAPH                 17040006
170500             MOVE SQLCA        TO DP013-SQLCA                     17050006
170600             SET DP013-DB2-ABEND                                  17060006
170700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17070006
170800             EVALUATE TRUE                                        17080006
170900                 WHEN PS-USE-ENT-ID-CSR                           17090006
171000                     MOVE 'OPEN ENT-ID-CSR'                       17100006
171100                                       TO DP013-MESSAGE-TEXT   (1)17110006
171200                     MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)17120006
171300                     MOVE 'TTRDPRT'    TO DP013-DB2-TABLE-NAME (2)17130006
171400                     MOVE 'TNETWRK'    TO DP013-DB2-TABLE-NAME (3)17140006
171500                 WHEN PS-USE-INCHG-ID-CSR                         17150006
171600                     MOVE 'OPEN INCHG-ID-CSR'                     17160006
171700                                       TO DP013-MESSAGE-TEXT   (1)17170006
171800                     MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)17180006
171900                     MOVE 'TTRDPRT'    TO DP013-DB2-TABLE-NAME (2)17190006
172000                     MOVE 'TNETWRK'    TO DP013-DB2-TABLE-NAME (3)17200006
172100                 WHEN PS-USE-VENDOR-NAME-CSR                      17210006
172200                     MOVE 'OPEN VENDOR-NAME-CSR'                  17220006
172300                                       TO DP013-MESSAGE-TEXT   (1)17230006
172400                     MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)17240006
172500                     MOVE 'TTRDPRT'    TO DP013-DB2-TABLE-NAME (2)17250006
172600                     MOVE 'TNETWRK'    TO DP013-DB2-TABLE-NAME (3)17260006
172700                 WHEN PS-USE-NETWRK-TSET-CSR                      17270006
172800                     MOVE 'OPEN NETWRK-TSET-CSR'                  17280006
172900                                       TO DP013-MESSAGE-TEXT   (1)17290006
173000                     MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)17300006
173100                     MOVE 'TTRDPRT'    TO DP013-DB2-TABLE-NAME (2)17310006
173200                     MOVE 'TNETWRK'    TO DP013-DB2-TABLE-NAME (3)17320006
173300                     MOVE 'TTRDTRN'    TO DP013-DB2-TABLE-NAME (4)17330006
173400             END-EVALUATE                                         17340006
173500             PERFORM DP013-0000-PROCESS-ABEND                     17350006
173600     END-EVALUATE.                                                17360006
173700                                                                  17370006
173800                                                                  17380006
173900 4020-CLOSE-CURSOR.                                               17390006
174000                                                                  17400006
174100     EVALUATE TRUE                                                17410006
174200         WHEN PS-USE-ENT-ID-CSR                                   17420006
174300             EXEC SQL                                             17430006
174400                  CLOSE ENT-ID-CSR                                17440006
174500             END-EXEC                                             17450006
174600         WHEN PS-USE-INCHG-ID-CSR                                 17460006
174700             EXEC SQL                                             17470006
174800                  CLOSE INCHG-ID-CSR                              17480006
174900             END-EXEC                                             17490006
175000         WHEN PS-USE-VENDOR-NAME-CSR                              17500006
175100             EXEC SQL                                             17510006
175200                  CLOSE VENDOR-NAME-CSR                           17520006
175300             END-EXEC                                             17530006
175400         WHEN PS-USE-NETWRK-TSET-CSR                              17540006
175500             EXEC SQL                                             17550006
175600                  CLOSE NETWRK-TSET-CSR                           17560006
175700             END-EXEC                                             17570006
175800     END-EVALUATE.                                                17580006
175900                                                                  17590006
176000     EVALUATE TRUE                                                17600006
176100         WHEN SQLCODE = ZERO                                      17610006
176200             CONTINUE                                             17620006
176300         WHEN SQLWARN0 NOT = SPACES                               17630006
176400         WHEN SQLCODE < ZERO                                      17640006
176500         WHEN SQLCODE > ZERO                                      17650006
176600             MOVE '4020-CLOSE-CURSOR'                             17660006
176700                               TO DP013-PARAGRAPH                 17670006
176800             MOVE SQLCA        TO DP013-SQLCA                     17680006
176900             SET DP013-DB2-ABEND                                  17690006
177000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17700006
177100             EVALUATE TRUE                                        17710006
177200                 WHEN PS-USE-ENT-ID-CSR                           17720006
177300                     MOVE 'CLOSE ENT-ID-CSR'                      17730006
177400                                       TO DP013-MESSAGE-TEXT   (1)17740006
177500                     MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)17750006
177600                     MOVE 'TTRDPRT'    TO DP013-DB2-TABLE-NAME (2)17760006
177700                     MOVE 'TNETWRK'    TO DP013-DB2-TABLE-NAME (3)17770006
177800                 WHEN PS-USE-INCHG-ID-CSR                         17780006
177900                     MOVE 'CLOSE INCHG-ID-CSR'                    17790006
178000                                       TO DP013-MESSAGE-TEXT   (1)17800006
178100                     MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)17810006
178200                     MOVE 'TTRDPRT'    TO DP013-DB2-TABLE-NAME (2)17820006
178300                     MOVE 'TNETWRK'    TO DP013-DB2-TABLE-NAME (3)17830006
178400                 WHEN PS-USE-VENDOR-NAME-CSR                      17840006
178500                     MOVE 'CLOSE VENDOR-NAME-CSR'                 17850006
178600                                       TO DP013-MESSAGE-TEXT   (1)17860006
178700                     MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)17870006
178800                     MOVE 'TTRDPRT'    TO DP013-DB2-TABLE-NAME (2)17880006
178900                     MOVE 'TNETWRK'    TO DP013-DB2-TABLE-NAME (3)17890006
179000                 WHEN PS-USE-NETWRK-TSET-CSR                      17900006
179100                     MOVE 'CLOSE NETWRK-TSET-CSR'                 17910006
179200                                       TO DP013-MESSAGE-TEXT   (1)17920006
179300                     MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)17930006
179400                     MOVE 'TTRDPRT'    TO DP013-DB2-TABLE-NAME (2)17940006
179500                     MOVE 'TNETWRK'    TO DP013-DB2-TABLE-NAME (3)17950006
179600                     MOVE 'TTRDTRN'    TO DP013-DB2-TABLE-NAME (4)17960006
179700             END-EVALUATE                                         17970006
179800             PERFORM DP013-0000-PROCESS-ABEND                     17980006
179900     END-EVALUATE.                                                17990006
180000                                                                  18000006
180100                                                                  18010006
180200*-----------------------------------------------------------------18020006
180300* DETERMINE WHICH CURSOR SHOULD BE USED AND SET UP THE APPROPRIATE18030006
180400* HOST VARIABLES.                                                 18040006
180500*-----------------------------------------------------------------18050006
180600 4100-PREPARE-CURSOR.                                             18060006
180700                                                                  18070006
180800     EVALUATE TRUE                                                18080006
180900*        *--------------------------------------------------------18090006
181000*        * IF AN ENT-ID WAS PASSED TO THE PROGRAM, WE KNOW THE    18100006
181100*        * PROGRAM WAS ENTERED BY GOING THROUGH THE VENDOR LIST TO18110006
181200*        * THE TRADING PARTNER CRITERIA SPEC. IN THIS CASE, ONLY  18120006
181300*        * THE ENT-ID IS USED IN THE CURSOR DECLARATION. ANY      18130006
181400*        * FIELDS ENTERED ON THE CRITERIA SPEC ARE IGNORED.       18140006
181500*        *--------------------------------------------------------18150006
181600         WHEN ET300-ENT-ID NOT = ZEROES                           18160006
181700             SET PS-USE-ENT-ID-CSR TO TRUE                        18170006
181800             MOVE ET300-ENT-ID     TO PV-ENT-ID                   18180006
181900                                                                  18190006
182000         WHEN (ET300-VEND-INCHG-QUAL NOT = SPACES AND LOW-VALUES) 18200006
182100         OR   (ET300-VEND-INCHG-ID   NOT = SPACES AND LOW-VALUES) 18210006
182200             SET PS-USE-INCHG-ID-CSR TO TRUE                      18220006
182300             IF  ET300-VEND-INCHG-QUAL = SPACES OR LOW-VALUES     18230006
182400                 MOVE LOW-VALUES            TO PV-FROM-INCHG-QUAL 18240006
182500                 MOVE HIGH-VALUES           TO PV-TO-INCHG-QUAL   18250006
182600             ELSE                                                 18260006
182700                 MOVE ET300-VEND-INCHG-QUAL TO PV-FROM-INCHG-QUAL 18270006
182800                                               PV-TO-INCHG-QUAL   18280006
182900             END-IF                                               18290006
183000             IF  ET300-VEND-INCHG-ID = SPACES OR LOW-VALUES       18300006
183100                  MOVE LOW-VALUES           TO PV-FROM-INCHG-ID   18310006
183200                  MOVE HIGH-VALUES          TO PV-TO-INCHG-ID     18320006
183300             ELSE                                                 18330006
183400                  MOVE ET300-VEND-INCHG-ID  TO PV-FROM-INCHG-ID   18340006
183500                                               PV-TO-INCHG-ID     18350006
183600             END-IF                                               18360006
183700                                                                  18370006
183800         WHEN (ET300-VENDOR-NAME NOT = SPACES AND LOW-VALUES)     18380006
183900             SET PS-USE-VENDOR-NAME-CSR  TO TRUE                  18390006
184000             MOVE ET300-VENDOR-NAME      TO WK-VENDOR-NAME        18400006
184100             SET PS-DO-NOT-SET-REMAINING TO TRUE                  18410006
184200             PERFORM VARYING PV-SUB FROM +1 BY +1                 18420006
184300             UNTIL   PV-SUB EQUAL LENGTH OF ET300-VENDOR-NAME     18430006
184400             OR      PS-ERROR                                     18440006
184500                 IF PS-SET-REMAINING                              18450006
184600                     MOVE PC-PERCENT                              18460006
184700                                   TO WK-VENDOR-NAME-BYTE (PV-SUB)18470006
184800                 ELSE                                             18480006
184900                     IF  WK-VENDOR-NAME-BYTE (PV-SUB) = '*'       18490006
185000                           MOVE PC-PERCENT                        18500006
185100                                   TO WK-VENDOR-NAME-BYTE (PV-SUB)18510006
185200                           SET PS-SET-REMAINING TO TRUE           18520006
185300                     ELSE                                         18530006
185400                           CONTINUE                               18540006
185500                     END-IF                                       18550006
185600                 END-IF                                           18560006
185700             END-PERFORM                                          18570006
185800                                                                  18580006
185900             INSPECT  WK-VENDOR-NAME                              18590006
186000                 REPLACING  ALL '%' BY LOW-VALUES                 18600006
186100             MOVE WK-VENDOR-NAME TO PV-FROM-ALPHA-30              18610006
186200                                                                  18620006
186300             INSPECT  WK-VENDOR-NAME                              18630006
186400                 REPLACING  ALL LOW-VALUES BY HIGH-VALUES         18640006
186500             MOVE WK-VENDOR-NAME TO PV-TO-ALPHA-30                18650006
186600                                                                  18660006
186700         WHEN (ET300-NETWK-ID NOT = SPACES AND LOW-VALUES)        18670006
186800         OR   (ET300-TRAN-SET NOT = SPACES AND LOW-VALUES)        18680006
186900             SET PS-USE-NETWRK-TSET-CSR TO TRUE                   18690006
187000             IF  ET300-NETWK-ID = SPACES OR LOW-VALUES            18700006
187100                  MOVE LOW-VALUES     TO PV-FROM-NETWK-ID         18710006
187200                  MOVE HIGH-VALUES    TO PV-TO-NETWK-ID           18720006
187300             ELSE                                                 18730006
187400                  MOVE ET300-NETWK-ID TO PV-FROM-NETWK-ID         18740006
187500                                         PV-TO-NETWK-ID           18750006
187600             END-IF                                               18760006
187700             IF  ET300-TRAN-SET = SPACES OR LOW-VALUES            18770006
187800                  MOVE LOW-VALUES     TO PV-FROM-TRAN-SET-CDE     18780006
187900                  MOVE HIGH-VALUES    TO PV-TO-TRAN-SET-CDE       18790006
188000             ELSE                                                 18800006
188100                  MOVE ET300-TRAN-SET TO PV-FROM-TRAN-SET-CDE     18810006
188200                                         PV-TO-TRAN-SET-CDE       18820006
188300             END-IF                                               18830006
188400                                                                  18840006
188500         WHEN OTHER                                               18850006
188600             SET PS-ERROR TO TRUE                                 18860006
188700*            ** ENTRY OF A FIELD REQUIRED FOR FUNCTION SELECTED **18870006
188800             MOVE PC-TSYMSG-00330          TO DP020-MSG-NUMBER    18880006
188900             SET DP020-MSG-FATAL           TO TRUE                18890006
189000             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                18900006
189100     END-EVALUATE.                                                18910006
189200                                                                  18920006
189300                                                                  18930006
189400*----------------------------------------------------------------*18940006
189500*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *18950006
189600*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *18960006
189700*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *18970006
189800*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *18980006
189900*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *18990006
190000*                                                                *19000006
190100*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *19010006
190200*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *19020006
190300*    UPON INITIALIZATION.                                        *19030006
190400*----------------------------------------------------------------*19040006
190500                                                                  19050006
190600 4300-READ-ITEMS-FROM-DB.                                         19060006
190700                                                                  19070006
190800     PERFORM                                                      19080006
190900         VARYING PV-READ-COUNT                                    19090006
191000         FROM 1 BY 1                                              19100006
191100         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19110006
191200            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19120006
191300                                                                  19130006
191400         PERFORM 4310-FETCH-CURSOR                                19140006
191500                                                                  19150006
191600         IF  ASC-ITEMS-LEFT-ON-DB                                 19160006
191700                                                                  19170006
191800             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19180006
191900                 ADD +1            TO  ASC-ITEM-SUB               19190006
192000             ELSE                                                 19200006
192100                 ADD +1            TO  ASC-BLK-SUB                19210006
192200                 MOVE +1           TO  ASC-ITEM-SUB               19220006
192300                                                                  19230006
192400                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         19240006
192500                     MOVE +1       TO  ASC-BLK-SUB                19250006
192600                     SET ASC-BLOCK-MODIFIED (1)                   19260006
192700                                   TO  TRUE                       19270006
192800                     PERFORM 5100-WRITE-TEMP-STORAGE              19280006
192900                     MOVE ASC-BLOCK-ENTRIES                       19290006
193000                               (PC-MAX-BLOCKS-IN-ARRAY)           19300006
193100                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 19310006
193200                     ADD +1        TO  ASC-BLK-SUB                19320006
193300                     INITIALIZE ASC-BLOCK-ENTRIES(ASC-BLK-SUB)    19330006
193400                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      19340006
193500                                   TO  TRUE                       19350006
193600                 END-IF                                           19360006
193700             END-IF                                               19370006
193800                                                                  19380006
193900                 ADD +1            TO ASC-NUMBER-OF-ITEMS-READ    19390006
194000                 MOVE ASC-NUMBER-OF-ITEMS-READ                    19400006
194100                                   TO ASC-LIST-ITEM-NUMBER        19410006
194200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19420006
194300                                                                  19430006
194400*                ---------------------------------------          19440006
194500*                ** MOVE ALL DB2 ITEMS TO LIST BLOCKS **          19450006
194600*                ---------------------------------------          19460006
194700                 MOVE ENTNME-ENT-ID                               19470006
194800*              * MOVE TRDPRT-ENT-ID                               19480006
194900                   TO ASC-ENT-ID (ASC-BLK-SUB ASC-ITEM-SUB)       19490006
195000                                                                  19500006
195100                 MOVE ENTNME-ENT-NAME-DESC                        19510006
195200                   TO ASC-VENDOR-NAME                             19520006
195300                           (ASC-BLK-SUB ASC-ITEM-SUB)             19530006
195400                                                                  19540006
195500                 MOVE TRDPRT-TP-DKEY                              19550006
195600                   TO ASC-TP-DKEY                                 19560006
195700                           (ASC-BLK-SUB ASC-ITEM-SUB)             19570006
195800                                                                  19580006
195900                 MOVE TRDPRT-VEND-INCHG-ID-DESC                   19590006
196000                   TO ASC-VEND-INCHG-QUAL                         19600006
196100                           (ASC-BLK-SUB ASC-ITEM-SUB)             19610006
196200                                                                  19620006
196300                 MOVE TRDPRT-VEND-INCHG-ID                        19630006
196400                   TO ASC-VEND-INCHG-ID                           19640006
196500                           (ASC-BLK-SUB ASC-ITEM-SUB)             19650006
196600                                                                  19660006
196700                 MOVE TRDPRT-NETWK-ID                             19670006
196800                   TO ASC-NETWK-ID                                19680006
196900                           (ASC-BLK-SUB ASC-ITEM-SUB)             19690006
197000                                                                  19700006
197100                 MOVE NETWRK-NETWK-NME                            19710006
197200                   TO ASC-NETWORK-NAME                            19720006
197300                           (ASC-BLK-SUB ASC-ITEM-SUB)             19730006
197400                                                                  19740006
197500         END-IF                                                   19750006
197600                                                                  19760006
197700     END-PERFORM.                                                 19770006
197800                                                                  19780006
197900     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19790006
198000         MOVE +1               TO ASC-BLK-SUB                     19800006
198100         PERFORM 5100-WRITE-TEMP-STORAGE                          19810006
198200         ADD +1                TO ASC-BLK-SUB                     19820006
198300         PERFORM 5100-WRITE-TEMP-STORAGE                          19830006
198400                                                                  19840006
198500         MOVE 1                TO ASC-BLK-SUB                     19850006
198600                                  PV-BLOCK-NUMBER                 19860006
198700         PERFORM 4410-READ-TEMP-STORAGE                           19870006
198800         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19880006
198900             MOVE 2            TO ASC-BLK-SUB                     19890006
199000                                  PV-BLOCK-NUMBER                 19900006
199100             PERFORM 4410-READ-TEMP-STORAGE                       19910006
199200         END-IF                                                   19920006
199300     END-IF.                                                      19930006
199400                                                                  19940006
199500                                                                  19950006
199600 4310-FETCH-CURSOR.                                               19960006
199700                                                                  19970006
199800     EVALUATE TRUE                                                19980006
199900         WHEN PS-USE-ENT-ID-CSR                                   19990006
200000             EXEC SQL                                             20000006
200100                  FETCH                                           20010006
200200                        ENT-ID-CSR                                20020006
200300                  INTO                                            20030006
200400                        :TRDPRT-TP-DKEY                           20040006
200500                      , :TRDPRT-ENT-ID                            20050006
200600                      , :ENTNME-ENT-ID                            20060006
200700                      , :ENTNME-ENT-NAME-DESC                     20070006
200800                      , :ENTNME-TYPE-CDE                          20080006
200900                      , :TRDPRT-VEND-INCHG-ID                     20090006
201000                      , :TRDPRT-VEND-INCHG-ID-DESC                20100006
201100                      , :TRDPRT-NETWK-ID                          20110006
201200                      , :NETWRK-NETWK-ID                          20120006
201300                      , :NETWRK-NETWK-NME                         20130006
201400             END-EXEC                                             20140006
201500         WHEN PS-USE-INCHG-ID-CSR                                 20150006
201600             EXEC SQL                                             20160006
201700                  FETCH                                           20170006
201800                        INCHG-ID-CSR                              20180006
201900                  INTO                                            20190006
202000                        :TRDPRT-TP-DKEY                           20200006
202100                      , :TRDPRT-ENT-ID                            20210006
202200                      , :ENTNME-ENT-ID                            20220006
202300                      , :ENTNME-ENT-NAME-DESC                     20230006
202400                      , :ENTNME-TYPE-CDE                          20240006
202500                      , :TRDPRT-VEND-INCHG-ID                     20250006
202600                      , :TRDPRT-VEND-INCHG-ID-DESC                20260006
202700                      , :TRDPRT-NETWK-ID                          20270006
202800                      , :NETWRK-NETWK-ID                          20280006
202900                      , :NETWRK-NETWK-NME                         20290006
203000             END-EXEC                                             20300006
203100         WHEN PS-USE-VENDOR-NAME-CSR                              20310006
203200             EXEC SQL                                             20320006
203300                  FETCH                                           20330006
203400                        VENDOR-NAME-CSR                           20340006
203500                  INTO                                            20350006
203600                        :TRDPRT-TP-DKEY                           20360006
203700                      , :TRDPRT-ENT-ID                            20370006
203800                      , :ENTNME-ENT-ID                            20380006
203900                      , :ENTNME-ENT-NAME-DESC                     20390006
204000                      , :ENTNME-TYPE-CDE                          20400006
204100                      , :TRDPRT-VEND-INCHG-ID                     20410006
204200                      , :TRDPRT-VEND-INCHG-ID-DESC                20420006
204300                      , :TRDPRT-NETWK-ID                          20430006
204400                      , :NETWRK-NETWK-ID                          20440006
204500                      , :NETWRK-NETWK-NME                         20450006
204600             END-EXEC                                             20460006
204700         WHEN PS-USE-NETWRK-TSET-CSR                              20470006
204800             EXEC SQL                                             20480006
204900                  FETCH                                           20490006
205000                        NETWRK-TSET-CSR                           20500006
205100                  INTO                                            20510006
205200                        :TRDPRT-TP-DKEY                           20520006
205300                      , :TRDPRT-ENT-ID                            20530006
205400                      , :ENTNME-ENT-ID                            20540006
205500                      , :ENTNME-ENT-NAME-DESC                     20550006
205600                      , :ENTNME-TYPE-CDE                          20560006
205700                      , :TRDPRT-VEND-INCHG-ID                     20570006
205800                      , :TRDPRT-VEND-INCHG-ID-DESC                20580006
205900                      , :TRDPRT-NETWK-ID                          20590006
206000                      , :NETWRK-NETWK-ID                          20600006
206100                      , :NETWRK-NETWK-NME                         20610006
206200             END-EXEC                                             20620006
206300     END-EVALUATE.                                                20630006
206400                                                                  20640006
206500     EVALUATE TRUE                                                20650006
206600         WHEN SQLCODE = ZERO                                      20660006
206700         WHEN SQLCODE = +100                                      20670006
206800              CONTINUE                                            20680006
206900                                                                  20690006
207000         WHEN SQLCODE = -904                                      20700006
207100         WHEN SQLCODE = -913                                      20710006
207200              PERFORM 9900-SOFT-ABORT                             20720006
207300                                                                  20730006
207400         WHEN SQLWARN0 NOT = SPACE                                20740006
207500         WHEN SQLCODE NOT = ZERO                                  20750006
207600             MOVE '4310-FETCH-CURSOR'TO DP013-PARAGRAPH           20760006
207700             MOVE SQLCA              TO DP013-SQLCA               20770006
207800             SET DP013-DB2-ABEND     TO TRUE                      20780006
207900             EVALUATE TRUE                                        20790006
208000                 WHEN PS-USE-ENT-ID-CSR                           20800006
208100                     MOVE 'FETCH ENT-ID-CSR'                      20810006
208200                                       TO DP013-MESSAGE-TEXT   (1)20820006
208300                     MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)20830006
208400                     MOVE 'TTRDPRT'    TO DP013-DB2-TABLE-NAME (2)20840006
208500                     MOVE 'TNETWRK'    TO DP013-DB2-TABLE-NAME (3)20850006
208600                 WHEN PS-USE-INCHG-ID-CSR                         20860006
208700                     MOVE 'FETCH INCHG-ID-CSR'                    20870006
208800                                       TO DP013-MESSAGE-TEXT   (1)20880006
208900                     MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)20890006
209000                     MOVE 'TTRDPRT'    TO DP013-DB2-TABLE-NAME (2)20900006
209100                     MOVE 'TNETWRK'    TO DP013-DB2-TABLE-NAME (3)20910006
209200                 WHEN PS-USE-VENDOR-NAME-CSR                      20920006
209300                     MOVE 'FETCH VENDOR-NAME-CSR'                 20930006
209400                                       TO DP013-MESSAGE-TEXT   (1)20940006
209500                     MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)20950006
209600                     MOVE 'TTRDPRT'    TO DP013-DB2-TABLE-NAME (2)20960006
209700                     MOVE 'TNETWRK'    TO DP013-DB2-TABLE-NAME (3)20970006
209800                 WHEN PS-USE-NETWRK-TSET-CSR                      20980006
209900                     MOVE 'FETCH NETWRK-TSET-CSR'                 20990006
210000                                       TO DP013-MESSAGE-TEXT   (1)21000006
210100                     MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)21010006
210200                     MOVE 'TTRDPRT'    TO DP013-DB2-TABLE-NAME (2)21020006
210300                     MOVE 'TNETWRK'    TO DP013-DB2-TABLE-NAME (3)21030006
210400                     MOVE 'TTRDTRN'    TO DP013-DB2-TABLE-NAME (4)21040006
210500             END-EVALUATE                                         21050006
210600             PERFORM DP013-0000-PROCESS-ABEND                     21060006
210700     END-EVALUATE.                                                21070006
210800                                                                  21080006
210900     IF  SQLCODE EQUAL +100                                       21090006
211000         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      21100006
211100     END-IF.                                                      21110006
211200                                                                  21120006
211300                                                                  21130006
211400*----------------------------------------------------------------*21140006
211500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *21150006
211600*----------------------------------------------------------------*21160006
211700                                                                  21170006
211800 4400-MOVE-COMMAREA-TO-SCREEN.                                    21180006
211900                                                                  21190006
212000     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             21200006
212100         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          21210006
212200         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          21220006
212300             MOVE +1    TO ASC-BLK-SUB                            21230006
212400             PERFORM 5100-WRITE-TEMP-STORAGE                      21240006
212500             ADD +1     TO ASC-BLK-SUB                            21250006
212600             PERFORM 5100-WRITE-TEMP-STORAGE                      21260006
212700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             21270006
212800                 GIVING PV-BLOCK-NUMBER                           21280006
212900                 REMAINDER PV-REMAINDER                           21290006
213000             IF  PV-REMAINDER > ZERO                              21300006
213100                 ADD +1 TO PV-BLOCK-NUMBER                        21310006
213200             END-IF                                               21320006
213300             MOVE +1    TO ASC-BLK-SUB                            21330006
213400             PERFORM 4410-READ-TEMP-STORAGE                       21340006
213500             ADD +1     TO ASC-BLK-SUB                            21350006
213600                           PV-BLOCK-NUMBER                        21360006
213700             PERFORM 4410-READ-TEMP-STORAGE                       21370006
213800     END-IF.                                                      21380006
213900                                                                  21390006
214000     MOVE +1            TO ASC-BLK-SUB.                           21400006
214100     COMPUTE ASC-ITEM-SUB =                                       21410006
214200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              21420006
214300         + PC-ITEMS-PER-PANEL).                                   21430006
214400                                                                  21440006
214500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21450006
214600         ADD +1         TO ASC-BLK-SUB                            21460006
214700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            21470006
214800     END-IF.                                                      21480006
214900                                                                  21490006
215000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           21500006
215100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                21510006
215200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        21520006
215300     PERFORM 4420-FORMAT-LIST-LINES                               21530006
215400         VARYING PV-SUB                                           21540006
215500         FROM PC-ITEMS-PER-PANEL BY -1                            21550006
215600         UNTIL PV-SUB < +1.                                       21560006
215700                                                                  21570006
215800     COMPUTE ASC-ITEMS-DISPLAYED =                                21580006
215900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          21590006
216000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL.   21600006
216100     IF  PS-NO-ERROR                                              21610006
216200         MOVE PV-TOP-ITEM          TO ASTRTITO                    21620006
216300     END-IF.                                                      21630006
216400                                                                  21640006
216500     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    21650006
216600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    21660006
216700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21670006
216800                                   TO ASELITO.                    21680006
216900                                                                  21690006
217000*    ** THE FOLLOWING 1 LINE WAS ADDED **                         21700006
217100     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     21710006
217200                                                                  21720006
217300     IF  DP020-MSG-NUMBER-X = SPACE                               21730006
217400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  21740006
217500*            --- MORE ITEMS TO DISPLAY ----                       21750006
217600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            21760006
217700             SET DP020-MSG-INFORMATIONAL TO TRUE                  21770006
217800         END-IF                                                   21780006
217900     END-IF.                                                      21790006
218000                                                                  21800006
218100*----------------------------------------------------------------*21810006
218200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *21820006
218300*----------------------------------------------------------------*21830006
218400                                                                  21840006
218500 4410-READ-TEMP-STORAGE.                                          21850006
218600                                                                  21860006
218700     EXEC CICS                                                    21870006
218800         READQ TS                                                 21880006
218900             QUEUE (ASC-LIST-QUEUE-NAME)                          21890006
219000             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21900006
219100             ITEM  (PV-BLOCK-NUMBER)                              21910006
219200             RESP  (PV-CICS-RESP)                                 21920006
219300     END-EXEC.                                                    21930006
219400                                                                  21940006
219500     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       21950006
219600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     21960006
219700         CONTINUE                                                 21970006
219800     ELSE                                                         21980006
219900         SET DP013-CICS-ABEND     TO TRUE                         21990006
220000         SET DP013-NO-ROLLBACK    TO TRUE                         22000006
220100         MOVE '4410-READ-TEMP-STORAGE'                            22010006
220200                                  TO DP013-PARAGRAPH              22020006
220300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      22030006
220400                                  TO DP013-MESSAGE-TEXT(1)        22040006
220500         PERFORM DP013-0000-PROCESS-ABEND                         22050006
220600     END-IF.                                                      22060006
220700                                                                  22070006
220800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22080006
220900                                                                  22090006
221000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         22100006
221100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               22110006
221200     END-IF.                                                      22120006
221300 EJECT                                                            22130006
221400*----------------------------------------------------------------*22140006
221500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *22150006
221600*----------------------------------------------------------------*22160006
221700                                                                  22170006
221800 4420-FORMAT-LIST-LINES.                                          22180006
221900                                                                  22190006
222000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      22200006
222100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                22210006
222200         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA      (PV-SUB)      22220006
222300         MOVE SPACE              TO MR-SELECTI      (PV-SUB)      22230006
222400                                    MR-ACTION       (PV-SUB)      22240006
222500*                                                                 22250006
222600*                          ** ADD YOUR REDEF. FIELDS HERE **      22260006
222700                                    MR-VNDR         (PV-SUB)      22270006
222800                                    MR-TPIDQ        (PV-SUB)      22280006
222900                                    MR-TPID         (PV-SUB)      22290006
223000                                    MR-NTWK         (PV-SUB)      22300006
223100                                                                  22310006
223200     ELSE                                                         22320006
223300*        ** IF ACS-TEMP CODE, WAS ADDED HERE **                   22330006
223400         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22340006
223500                                                   > SPACE        22350006
223600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 22360006
223700                                 TO MR-SELECTI (PV-SUB)           22370006
223800         ELSE                                                     22380006
223900             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22390006
224000                                 TO MR-SELECTI (PV-SUB)           22400006
224100         END-IF                                                   22410006
224200                                                                  22420006
224300         IF  DP030-SET-CURSOR-TRAILER                             22430006
224400             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)22440006
224500                 > SPACE)                                         22450006
224600               OR (PV-SUB = 1))                                   22460006
224700                SET DP030-SET-CURSOR-APPL-1 TO TRUE               22470006
224800                MOVE -1          TO MR-SELECTL (PV-SUB)           22480006
224900             END-IF                                               22490006
225000         END-IF                                                   22500006
225100                                                                  22510006
225200         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           22520006
225300             MOVE ASC-ACTION         (ASC-BLK-SUB ASC-ITEM-SUB)   22530006
225400                                 TO  MR-ACTION        (PV-SUB)    22540006
225500                                                                  22550006
225600*            ** ADD YOUR REDEFINED DESECT FIELDS HERE **          22560006
225700             MOVE ASC-VENDOR-NAME     (ASC-BLK-SUB ASC-ITEM-SUB)  22570006
225800               TO  MR-VNDR            (PV-SUB)                    22580006
225900             MOVE ASC-VEND-INCHG-QUAL (ASC-BLK-SUB ASC-ITEM-SUB)  22590006
226000               TO  MR-TPIDQ           (PV-SUB)                    22600006
226100             MOVE ASC-VEND-INCHG-ID   (ASC-BLK-SUB ASC-ITEM-SUB)  22610006
226200               TO  MR-TPID            (PV-SUB)                    22620006
226300             MOVE ASC-NETWORK-NAME    (ASC-BLK-SUB ASC-ITEM-SUB)  22630006
226400               TO  MR-NTWK            (PV-SUB)                    22640006
226500         END-IF                                                   22650006
226600     END-IF.                                                      22660006
226700                                                                  22670006
226800     SUBTRACT +1 FROM ASC-ITEM-SUB                                22680006
226900     IF  ASC-ITEM-SUB < + 1                                       22690006
227000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  22700006
227100         MOVE +1                 TO ASC-BLK-SUB                   22710006
227200     END-IF.                                                      22720006
227300                                                                  22730006
227400******************************************************************22740006
227500** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **22750006
227600** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **22760006
227700** ISSUE A WARNING.                                             **22770006
227800******************************************************************22780006
227900                                                                  22790006
228000 4430-CHECK-FOR-BEGIN-AND-END.                                    22800006
228100                                                                  22810006
228200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       22820006
228300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     22830006
228400*            -- NO END-OF-RANGE SPECFIED ---                      22840006
228500             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            22850006
228600             SET DP020-MSG-WARNING TO TRUE                        22860006
228700             PERFORM 4431-POSITION-AT-WARNING                     22870006
228800         END-IF                                                   22880006
228900     ELSE                                                         22890006
229000         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     22900006
229100*            -- NO BEGINNING-OF-RANGE SPECFIED ---                22910006
229200             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            22920006
229300             SET DP020-MSG-WARNING TO TRUE                        22930006
229400             PERFORM 4431-POSITION-AT-WARNING                     22940006
229500         END-IF                                                   22950006
229600     END-IF.                                                      22960006
229700******************************************************************22970006
229800** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **22980006
229900** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **22990006
230000** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **23000006
230100** POSITION THE CURSOR THERE.                                   **23010006
230200******************************************************************23020006
230300                                                                  23030006
230400 4431-POSITION-AT-WARNING.                                        23040006
230500                                                                  23050006
230600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 23060006
230700                    - PV-TOP-ITEM + 1.                            23070006
230800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23080006
230900         CONTINUE                                                 23090006
231000     ELSE                                                         23100006
231100         SET DP030-SET-CURSOR-APPL-1                              23110006
231200                                   TO TRUE                        23120006
231300         MOVE -1                   TO MR-SELECTL (PV-SUB)         23130006
231400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23140006
231500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23150006
231600     END-IF.                                                      23160006
231700                                                                  23170006
231800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   23180006
231900                    - PV-TOP-ITEM + 1.                            23190006
232000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23200006
232100         CONTINUE                                                 23210006
232200     ELSE                                                         23220006
232300         SET DP030-SET-CURSOR-APPL-1                              23230006
232400                                   TO TRUE                        23240006
232500         MOVE -1                   TO MR-SELECTL (PV-SUB)         23250006
232600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23260006
232700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23270006
232800     END-IF.                                                      23280006
232900                                                                  23290006
233000 EJECT                                                            23300006
233100*----------------------------------------------------------------*23310006
233200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *23320006
233300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *23330006
233400* FOR THE SELECTED ITEMS QUEUE.                                  *23340006
233500*                                                                *23350006
233600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *23360006
233700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *23370006
233800* THE ARRAY IS FULL.                                             *23380006
233900*----------------------------------------------------------------*23390006
234000                                                                  23400006
234100 5000-PREPARE-SEL-QUEUE.                                          23410006
234200                                                                  23420006
234300     MOVE +1                   TO  ASC-BLK-SUB.                   23430006
234400     PERFORM 5100-WRITE-TEMP-STORAGE.                             23440006
234500     ADD +1                    TO  ASC-BLK-SUB.                   23450006
234600     PERFORM 5100-WRITE-TEMP-STORAGE.                             23460006
234700                                                                  23470006
234800     MOVE ASC-SEL-QUEUE-NAME   TO  ET300-SEL-QUEUE-NAME.          23480006
234900     PERFORM 6010-DELETE-SEL-QUEUE.                               23490006
235000                                                                  23500006
235100     SET ASC-UPDATE-TSQ        TO  TRUE.                          23510006
235200                                                                  23520006
235300     SET ET301-IDX             TO  1.                             23530006
235400     MOVE ZERO                 TO ET300-NUMBER-OF-TS-ITEMS.       23540006
235500     INITIALIZE ET301-SELECTED-ITEM-ARRAY.                        23550006
235600                                                                  23560006
235700     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           23570006
235800             VARYING PV-ITEM                                      23580006
235900             FROM 1 BY 1                                          23590006
236000             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     23600006
236100                                                                  23610006
236200     IF  ET301-IDX > 1                                            23620006
236300         PERFORM 5205-WRITE-SEL-QUEUE                             23630006
236400         ADD +1                TO ET300-NUMBER-OF-TS-ITEMS        23640006
236500     END-IF.                                                      23650006
236600                                                                  23660006
236700 EJECT                                                            23670006
236800*----------------------------------------------------------------*23680006
236900*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *23690006
237000*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *23700006
237100*----------------------------------------------------------------*23710006
237200                                                                  23720006
237300 5100-WRITE-TEMP-STORAGE.                                         23730006
237400                                                                  23740006
237500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     23750006
237600                                   TO PV-LIST-ITEM-NUMBER.        23760006
237700     COMPUTE PV-BLOCK-NUMBER =                                    23770006
237800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    23780006
237900                                                                  23790006
238000     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             23800006
238100     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             23810006
238200         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      23820006
238300             PERFORM 5105-REWRITE-ASC-LISTQ                       23830006
238400         END-IF                                                   23840006
238500     ELSE                                                         23850006
238600         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       23860006
238700         ASC-HIGHEST-BLOCK-WRITTEN + 1                            23870006
238800         PERFORM 5110-WRITE-ASC-LISTQ                             23880006
238900         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   23890006
239000     END-IF.                                                      23900006
239100                                                                  23910006
239200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23920006
239300                                                                  23930006
239400******************************************************************23940006
239500** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **23950006
239600** SPECIFIC COMMAREA.                                           **23960006
239700******************************************************************23970006
239800                                                                  23980006
239900 5105-REWRITE-ASC-LISTQ.                                          23990006
240000                                                                  24000006
240100     EXEC CICS                                                    24010006
240200         WRITEQ TS                                                24020006
240300             QUEUE (ASC-LIST-QUEUE-NAME)                          24030006
240400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24040006
240500             ITEM  (PV-BLOCK-NUMBER)                              24050006
240600             REWRITE                                              24060006
240700             RESP  (PV-CICS-RESP)                                 24070006
240800     END-EXEC.                                                    24080006
240900                                                                  24090006
241000     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           24100006
241100         CONTINUE                                                 24110006
241200     ELSE                                                         24120006
241300         SET DP013-CICS-ABEND            TO TRUE                  24130006
241400         SET DP013-NO-ROLLBACK           TO TRUE                  24140006
241500         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       24150006
241600         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     24160006
241700                                         TO DP013-MESSAGE-TEXT(1) 24170006
241800         PERFORM DP013-0000-PROCESS-ABEND                         24180006
241900     END-IF.                                                      24190006
242000                                                                  24200006
242100******************************************************************24210006
242200** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **24220006
242300** SPECIFIC COMMAREA.                                           **24230006
242400******************************************************************24240006
242500                                                                  24250006
242600 5110-WRITE-ASC-LISTQ.                                            24260006
242700                                                                  24270006
242800     EXEC CICS                                                    24280006
242900         WRITEQ TS                                                24290006
243000             QUEUE (ASC-LIST-QUEUE-NAME)                          24300006
243100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24310006
243200             ITEM  (PV-BLOCK-NUMBER)                              24320006
243300             RESP  (PV-CICS-RESP)                                 24330006
243400     END-EXEC.                                                    24340006
243500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      24350006
243600         SET DP013-CICS-ABEND      TO TRUE                        24360006
243700         SET DP013-NO-ROLLBACK     TO TRUE                        24370006
243800         MOVE '5110-WRITE-ASC-LISTQ'                              24380006
243900                                   TO DP013-PARAGRAPH             24390006
244000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           24400006
244100                                   TO DP013-MESSAGE-TEXT(1)       24410006
244200         PERFORM DP013-0000-PROCESS-ABEND                         24420006
244300     END-IF.                                                      24430006
244400                                                                  24440006
244500 EJECT                                                            24450006
244600*----------------------------------------------------------------*24460006
244700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *24470006
244800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *24480006
244900*----------------------------------------------------------------*24490006
245000                                                                  24500006
245100 5200-FILL-SEL-QUEUE-RECORD.                                      24510006
245200                                                                  24520006
245300     PERFORM 6112-READ-LIST-QUEUE.                                24530006
245400                                                                  24540006
245500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       24550006
245600         PERFORM                                                  24560006
245700         VARYING LQW-IDX                                          24570006
245800         FROM 1 BY 1                                              24580006
245900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            24590006
246000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          24600006
246100                                                                  24610006
246200             IF  LQW-SELECT (LQW-IDX)                             24620006
246300                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              24630006
246400                                   TO ET301-ITEM (ET301-IDX)      24640006
246500                                                                  24650006
246600                 MOVE LQW-KEY-DATA (LQW-IDX)                      24660006
246700                   TO ET301-KEY-DATA (ET301-IDX)                  24670006
246800                                                                  24680006
246900                 MOVE SPACE                                       24690006
247000                   TO ET301-ACTION-SW (ET301-IDX)                 24700006
247100                                                                  24710006
247200                 SET ET301-IDX UP BY 1                            24720006
247300                 IF  ET301-IDX > ET301-MAX-ITEMS                  24730006
247400                     PERFORM 5205-WRITE-SEL-QUEUE                 24740006
247500                     ADD +1        TO ET300-NUMBER-OF-TS-ITEMS    24750006
247600                     INITIALIZE ET301-SELECTED-ITEM-ARRAY         24760006
247700                     SET ET301-IDX TO  1                          24770006
247800                 END-IF                                           24780006
247900             END-IF                                               24790006
248000         END-PERFORM                                              24800006
248100     END-IF.                                                      24810006
248200                                                                  24820006
248300*----------------------------------------------------------------*24830006
248400*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *24840006
248500*----------------------------------------------------------------*24850006
248600                                                                  24860006
248700 5205-WRITE-SEL-QUEUE.                                            24870006
248800                                                                  24880006
248900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            24890006
249000                                   TO ET301-SELECTED-ITEMS.       24900006
249100                                                                  24910006
249200     EXEC CICS                                                    24920006
249300          WRITEQ TS                                               24930006
249400              QUEUE (ASC-SEL-QUEUE-NAME)                          24940006
249500              FROM  (ET301-SELECTED-VNDRS)                        24950006
249600              ITEM  (PV-SEL-QUEUE-ITEM)                           24960006
249700              RESP  (PV-CICS-RESP)                                24970006
249800     END-EXEC.                                                    24980006
249900                                                                  24990006
250000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25000006
250100         CONTINUE                                                 25010006
250200     ELSE                                                         25020006
250300         SET DP013-CICS-ABEND      TO TRUE                        25030006
250400         SET DP013-NO-ROLLBACK     TO TRUE                        25040006
250500         MOVE '5205-WRITE-SEL-QUEUE'                              25050006
250600                                   TO DP013-PARAGRAPH             25060006
250700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          25070006
250800                                   TO DP013-MESSAGE-TEXT(1)       25080006
250900         PERFORM DP013-0000-PROCESS-ABEND                         25090006
251000     END-IF.                                                      25100006
251100 EJECT                                                            25110006
251200*----------------------------------------------------------------*25120006
251300*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *25130006
251400*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *25140006
251500*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *25150006
251600*  THE USER.                                                     *25160006
251700*----------------------------------------------------------------*25170006
251800                                                                  25180006
251900 6000-REFRESH-PANEL-FROM-TEMP.                                    25190006
252000                                                                  25200006
252100     IF  ASC-UPDATE-TSQ                                           25210006
252200         SET ASC-NO-TSQ-UPDATE TO TRUE                            25220006
252300         MOVE ZERO                 TO PV-SAVE-ITEM                25230006
252400                                      PV-SEL-QUEUE-ITEM           25240006
252500         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        25250006
252600                                   TO PV-HOLD-SELECTED-ITEMS      25260006
252700         PERFORM 6100-UPDATE-TSQ                                  25270006
252800             UNTIL PV-ITEMS-PROCESSED >                           25280006
252900                                     ASC-NUMBER-OF-SELECTED-ITEMS 25290006
253000         PERFORM 6010-DELETE-SEL-QUEUE                            25300006
253100         INITIALIZE ASC-BLOCK-ENTRIES (1)                         25310006
253200                    ASC-BLOCK-ENTRIES (2)                         25320006
253300                                                                  25330006
253400*        ** THE REMAINING IS ADDED CODE TO THE PARAGRAPH **       25340006
253500         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 25350006
253600                GIVING PV-BLOCK-NUMBER                            25360006
253700                REMAINDER PV-REMAINDER                            25370006
253800         IF  PV-REMAINDER > ZERO                                  25380006
253900             ADD +1     TO PV-BLOCK-NUMBER                        25390006
254000         END-IF                                                   25400006
254100                                                                  25410006
254200         MOVE +1        TO ASC-BLK-SUB                            25420006
254300         PERFORM 4410-READ-TEMP-STORAGE                           25430006
254400         ADD +1         TO ASC-BLK-SUB                            25440006
254500                           PV-BLOCK-NUMBER                        25450006
254600         PERFORM 4410-READ-TEMP-STORAGE                           25460006
254700     END-IF.                                                      25470006
254800                                                                  25480006
254900*----------------------------------------------------------------*25490006
255000*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *25500006
255100*----------------------------------------------------------------*25510006
255200                                                                  25520006
255300 6010-DELETE-SEL-QUEUE.                                           25530006
255400                                                                  25540006
255500     EXEC CICS                                                    25550006
255600         DELETEQ TS                                               25560006
255700             QUEUE (ASC-SEL-QUEUE-NAME)                           25570006
255800             RESP  (PV-CICS-RESP)                                 25580006
255900     END-EXEC.                                                    25590006
256000                                                                  25600006
256100     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      25610006
256200        (PV-CICS-RESP = DFHRESP(QIDERR)))                         25620006
256300         CONTINUE                                                 25630006
256400     ELSE                                                         25640006
256500         SET DP013-CICS-ABEND TO TRUE                             25650006
256600         SET DP013-NO-ROLLBACK TO TRUE                            25660006
256700         MOVE '6010-DELETE-SEL-QUEUE'                             25670006
256800                        TO DP013-PARAGRAPH                        25680006
256900         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         25690006
257000                        TO DP013-MESSAGE-TEXT (1)                 25700006
257100         PERFORM DP013-0000-PROCESS-ABEND                         25710006
257200     END-IF.                                                      25720006
257300                                                                  25730006
257400*----------------------------------------------------------------*25740006
257500*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *25750006
257600*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *25760006
257700*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *25770006
257800*    THE TEMP QUEUE.                                             *25780006
257900*----------------------------------------------------------------*25790006
258000                                                                  25800006
258100 6100-UPDATE-TSQ.                                                 25810006
258200                                                                  25820006
258300     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             25830006
258400     PERFORM 6105-READ-SEL-QUEUE.                                 25840006
258500     PERFORM                                                      25850006
258600         VARYING ET301-IDX                                        25860006
258700         FROM 1 BY 1                                              25870006
258800         UNTIL ((PV-ITEMS-PROCESSED >                             25880006
258900                              PV-HOLD-SELECTED-ITEMS)             25890006
259000         OR (ET301-IDX GREATER THAN ET301-MAX-ITEMS))             25900006
259100         IF  ET301-ACTION-SW (ET301-IDX) > SPACE                  25910006
259200             PERFORM 6110-PROCESS-ITEMS                           25920006
259300         END-IF                                                   25930006
259400         ADD +1                TO PV-ITEMS-PROCESSED              25940006
259500     END-PERFORM.                                                 25950006
259600                                                                  25960006
259700     PERFORM 6111-WRITE-LIST-QUEUE.                               25970006
259800                                                                  25980006
259900*----------------------------------------------------------------*25990006
260000*    READ THE LIST QUEUE RECORD.                                 *26000006
260100*----------------------------------------------------------------*26010006
260200                                                                  26020006
260300 6105-READ-SEL-QUEUE.                                             26030006
260400                                                                  26040006
260500     EXEC CICS                                                    26050006
260600          READQ TS                                                26060006
260700              QUEUE (ASC-SEL-QUEUE-NAME)                          26070006
260800              INTO  (ET301-SELECTED-VNDRS)                        26080006
260900              ITEM  (PV-SEL-QUEUE-ITEM)                           26090006
261000              RESP  (PV-CICS-RESP)                                26100006
261100     END-EXEC.                                                    26110006
261200                                                                  26120006
261300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26130006
261400         CONTINUE                                                 26140006
261500     ELSE                                                         26150006
261600         SET DP013-CICS-ABEND      TO  TRUE                       26160006
261700         SET DP013-NO-ROLLBACK     TO  TRUE                       26170006
261800         MOVE '6105-READ-SEL-QUEUE'                               26180006
261900                                   TO  DP013-PARAGRAPH            26190006
262000         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           26200006
262100                                   TO  DP013-MESSAGE-TEXT(1)      26210006
262200         PERFORM DP013-0000-PROCESS-ABEND                         26220006
262300     END-IF.                                                      26230006
262400                                                                  26240006
262500 EJECT                                                            26250006
262600*----------------------------------------------------------------*26260006
262700*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*26270006
262800*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*26280006
262900*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *26290006
263000*----------------------------------------------------------------*26300006
263100                                                                  26310006
263200 6110-PROCESS-ITEMS.                                              26320006
263300                                                                  26330006
263400     COMPUTE PV-ITEM = 1 + ((ET301-ITEM (ET301-IDX) - 1)          26340006
263500                     / PC-ITEMS-PER-PANEL).                       26350006
263600                                                                  26360006
263700     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           26370006
263800         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          26380006
263900             PERFORM 6111-WRITE-LIST-QUEUE                        26390006
264000         END-IF                                                   26400006
264100         MOVE PV-ITEM          TO PV-SAVE-ITEM                    26410006
264200                                                                  26420006
264300         PERFORM 6112-READ-LIST-QUEUE                             26430006
264400     END-IF.                                                      26440006
264500                                                                  26450006
264600     COMPUTE PV-SUB = (ET301-ITEM (ET301-IDX)                     26460006
264700                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              26470006
264800     SET LQW-DESELECT (PV-SUB) TO    TRUE                         26480006
264900     MOVE LQW-SELECTED-SW (PV-SUB)                                26490006
265000                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  26500006
265100     EVALUATE TRUE                                                26510006
265200         WHEN ET301-INQ (ET301-IDX)                               26520006
265300              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             26530006
265400                                                                  26540006
265500         WHEN ET301-UPD (ET301-IDX)                               26550006
265600              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             26560006
265700                                                                  26570006
265800*             ** UPDATE REMAINING LQW-KEY-DATA FIELDS **          26580006
265900              MOVE ET301-VEND-INCHG-QUAL (ET301-IDX)              26590006
266000                TO LQW-VEND-INCHG-QUAL   (PV-SUB)                 26600006
266100              MOVE ET301-VEND-INCHG-ID   (ET301-IDX)              26610006
266200                TO LQW-VEND-INCHG-ID     (PV-SUB)                 26620006
266300              MOVE ET301-NETWK-ID        (ET301-IDX)              26630006
266400                TO LQW-NETWK-ID          (PV-SUB)                 26640006
266500              MOVE ET301-NETWK-NAME      (ET301-IDX)              26650006
266600                TO LQW-NETWORK-NAME      (PV-SUB)                 26660006
266700                                                                  26670006
266800         WHEN ET301-DEL (ET301-IDX)                               26680006
266900              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             26690006
267000                                                                  26700006
267100         WHEN ET301-ERR (ET301-IDX)                               26710006
267200              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             26720006
267300     END-EVALUATE.                                                26730006
267400                                                                  26740006
267500     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                26750006
267600                                                                  26760006
267700*----------------------------------------------------------------*26770006
267800*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *26780006
267900*----------------------------------------------------------------*26790006
268000                                                                  26800006
268100 6111-WRITE-LIST-QUEUE.                                           26810006
268200                                                                  26820006
268300     EXEC CICS                                                    26830006
268400         WRITEQ TS                                                26840006
268500             QUEUE (ASC-LIST-QUEUE-NAME)                          26850006
268600             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     26860006
268700             ITEM  (PV-SAVE-ITEM)                                 26870006
268800             REWRITE                                              26880006
268900             RESP  (PV-CICS-RESP)                                 26890006
269000     END-EXEC.                                                    26900006
269100                                                                  26910006
269200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26920006
269300         CONTINUE                                                 26930006
269400     ELSE                                                         26940006
269500         SET DP013-CICS-ABEND  TO  TRUE                           26950006
269600         SET DP013-NO-ROLLBACK TO  TRUE                           26960006
269700         MOVE '6111-WRITE-LIST-QUEUE'                             26970006
269800                               TO  DP013-PARAGRAPH                26980006
269900         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  26990006
270000                               TO  DP013-MESSAGE-TEXT(1)          27000006
270100         PERFORM DP013-0000-PROCESS-ABEND                         27010006
270200     END-IF.                                                      27020006
270300                                                                  27030006
270400 EJECT                                                            27040006
270500*----------------------------------------------------------------*27050006
270600*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*27060006
270700*----------------------------------------------------------------*27070006
270800                                                                  27080006
270900 6112-READ-LIST-QUEUE.                                            27090006
271000                                                                  27100006
271100     EXEC CICS                                                    27110006
271200         READQ TS                                                 27120006
271300             QUEUE (ASC-LIST-QUEUE-NAME)                          27130006
271400             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     27140006
271500             ITEM  (PV-ITEM)                                      27150006
271600             RESP  (PV-CICS-RESP)                                 27160006
271700     END-EXEC.                                                    27170006
271800                                                                  27180006
271900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27190006
272000         CONTINUE                                                 27200006
272100     ELSE                                                         27210006
272200         SET DP013-CICS-ABEND        TO TRUE                      27220006
272300         SET DP013-NO-ROLLBACK       TO TRUE                      27230006
272400         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           27240006
272500         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    27250006
272600                                     TO DP013-MESSAGE-TEXT(1)     27260006
272700         PERFORM DP013-0000-PROCESS-ABEND                         27270006
272800     END-IF.                                                      27280006
272900 EJECT                                                            27290006
273000*----------------------------------------------------------------*27300006
273100*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *27310006
273200*    AND THE ERROR SWITCHES.                                     *27320006
273300*----------------------------------------------------------------*27330006
273400                                                                  27340006
273500 9900-SOFT-ABORT.                                                 27350006
273600                                                                  27360006
273700     SET PS-ERROR                TO  TRUE.                        27370006
273800     SET DP020-MSG-FATAL         TO  TRUE.                        27380006
273900     MOVE PC-TSYMSG-00551        TO  DP020-MSG-NUMBER.            27390006
274000                                                                  27400006
274100 EJECT                                                            27410006
274200*----------------------------------------------------------------*27420006
274300*    ABEND PROCESSOR MODULE                                      *27430006
274400*----------------------------------------------------------------*27440006
274500                                                                  27450006
274600     COPY DPPD013.                                                27460006
274700                                                                  27470006
274800 EJECT                                                            27480006
