00001 *************************                                         02/05/92
00002  IDENTIFICATION DIVISION.                                         MBKCS109
00003 *************************                                            LV022
00004  PROGRAM-ID.    MBKCS109.                                            CL**1
00005  AUTHOR.        MIKE FURLICK.                                        CL**1
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**1
00007  DATE-WRITTEN.  10-8-91.                                             CL**1
00008  DATE-COMPILED.                                                      CL**1
00009                                                                      CL**1
00010 *****************************************************************    CL**1
00011 *    R109 - MERCHANDISE SUB CLASS INQUIRY                            CL**1
00012 *                                                                    CL**1
00013 *    THIS PROGRAM DISPLAYS THE POS DESCRIPTION AND TAX DEFAULT       CL**1
00014 *    FOR THE SELECTED SUB CLASS.  THE GMA, DMA, DEPARTMENT AND       CL**1
00015 *    MAJOR CLASS CODES AND DESCRIPTIONS ARE ALSO DISPLAYED.          CL**1
00016 *    PF20 "PAGES" TO THE NEXT SET OF READ CRITERIA SUPPLIED BY       CL*12
00017 *    MBKCS108 (MERCHANDISE SUB CLASS LIST).                          CL**1
00018 *                                                                    CL**1
00019 *****************************************************************    CL**1
00020 *                                                                    CL**1
00021 *                                                                    CL**1
00022 *                                                                    CL**1
00023  ENVIRONMENT DIVISION.                                               CL**1
00024 *                                                                    CL**1
00025 *                                                                    CL**1
00026 *                                                                    CL**1
00027  DATA DIVISION.                                                      CL**1
00028 *                                                                    CL**1
00029 *                                                                    CL**1
00030  WORKING-STORAGE SECTION.                                            CL**1
00031 *                                                                    CL**1
00032  01  PC-PROGRAM-CONSTANTS.                                           CL**1
00033      05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.   CL**1
00034      05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072     CL**1
00035                                                      COMP SYNC.      CL**1
00036      05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE           CL**1
00037      'MB109A  '.                                                     CL**1
00038      05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE           CL**1
00039      'MBKM109 '.                                                     CL**1
00040      05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE           CL**1
00041      'MBKCS109'.                                                     CL**1
00042      05  PC-BLOCK-LENGTH                PIC S9(04)   VALUE +1314     CL**1
00043                                                      COMP SYNC.      CL**1
00044      05  PC-FIELD-LENGTH                PIC S9(04)   VALUE +5        CL**1
00045                                                      COMP SYNC.      CL**1
00046      05  PC-ERASE-EOF-COMP              PIC S9(04)   VALUE +128      CL**1
00047                                                      COMP SYNC.      CL**1
00048      05  FILLER REDEFINES PC-ERASE-EOF-COMP.                         CL**1
00049          10  FILLER                     PIC X(01).                   CL**1
00050          10  PC-ERASE-EOF               PIC X(01).                   CL**1
00051      05  PC-ZERO                        PIC X(3)     VALUE '000'.    CL**2
00052      05  PC-GMA                         PIC X(3)     VALUE 'GMA'.    CL*13
00053      05  PC-DMA                         PIC X(3)     VALUE 'DMA'.    CL*13
00054      05  PC-DPT                         PIC X(3)     VALUE 'DPT'.    CL*13
00055      05  PC-MCL                         PIC X(3)     VALUE 'MCL'.    CL*13
00056      05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3         CL**1
00057                                                      COMP-3.         CL**1
00058  01  PC-COMPANY                         PIC XX       VALUE '03'.     CL**1
00059 *                                                                    CL**1
00060  01  PC-TSYMSG-NUMBERS.                                              CL**1
00061      05  PC-TSYMSG-00005                PIC 9(5)    VALUE 00005.     CL**1
00062      05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.     CL**1
00063      05  PC-TSYMSG-00045                PIC 9(5)    VALUE 00045.     CL**4
00064      05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.     CL**4
00065      05  PC-TSYMSG-00051                PIC 9(5)    VALUE 00051.     CL**1
00066      05  PC-TSYMSG-00052                PIC 9(5)    VALUE 00052.     CL**1
00067      05  PC-TSYMSG-00053                PIC 9(5)    VALUE 00053.     CL**1
00068      05  PC-TSYMSG-00054                PIC 9(5)    VALUE 00054.     CL**1
00069      05  PC-TSYMSG-00055                PIC 9(5)    VALUE 00055.     CL**1
00070      05  PC-TSYMSG-00057                PIC 9(5)    VALUE 00057.     CL**1
00071      05  PC-TSYMSG-00061                PIC 9(5)    VALUE 00061.     CL**1
00072      05  PC-TSYMSG-00062                PIC 9(5)    VALUE 00062.     CL**1
00073      05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.     CL**1
00074      05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.     CL**1
00075      05  PC-TSYMSG-99901                PIC 9(5)    VALUE 99901.     CL*17
00076 *                                                                    CL**1
00077  01  PM-PROGRAM-MESSAGES.                                            CL**1
00078      05  PM-PROGRAM-MESSAGE-12          PIC X(78)    VALUE           CL**1
00079      'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.                   CL**1
00080      05  PM-PROGRAM-MESSAGE-22          PIC X(78)    VALUE           CL**1
00081      'LOGIC ERROR IN TRYING TO READ MD LIST QUEUE - RESP = '.        CL**1
00082      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-22.                     CL**1
00083          10  FILLER                     PIC X(61).                   CL**1
00084          10  PM-RESP-22                 PIC 9999.                    CL**1
00085          10  FILLER                     PIC X(12).                   CL**1
00086 *                                                                    CL**1
00087  01  PS-PROGRAM-SUBSCRIPTS.                                          CL**1
00088      05  PS-SUB                         PIC S9(04)   VALUE +0        CL**1
00089                                                      COMP SYNC.      CL**1
00090      05  PS-SC-SUB1                     PIC S9(04)   VALUE +0        CL**1
00091                                                      COMP SYNC.      CL**1
00092      05  PS-SC-SUB2                     PIC S9(04)   VALUE +0        CL**1
00093                                                      COMP SYNC.      CL**1
00094      05  PS-ITEM-SUB                    PIC S9(09)   VALUE +0        CL**1
00095                                                      COMP-3.         CL**1
00096                                                                      CL**1
00097  01  PS-PROGRAM-SWITCHES.                                            CL**1
00098      05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.      CL**1
00099          88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.      CL**1
00100          88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.      CL**1
00101          88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.      CL**1
00102          88  PS-SEND-DATA-ONLY                       VALUE '4'.      CL**1
00103          88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.      CL**1
00104          88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.      CL**1
00105      05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.      CL**1
00106          88  PS-ERROR                                VALUE 'Y'.      CL**1
00107          88  PS-NO-ERROR                             VALUE 'N'.      CL**1
00108      05  PS-INTER-APPL-VALID-SW         PIC X(01)    VALUE 'N'.      CL**1
00109          88  PS-INTER-APPL-VALID                     VALUE 'Y'.      CL**1
00110          88  PS-INTER-APPL-NOT-VALID                 VALUE 'N'.      CL**1
00111      05  PS-PROCESSING-SW               PIC X(01)    VALUE 'N'.      CL**1
00112          88  PS-CONTINUE                             VALUE 'Y'.      CL*13
00113          88  PS-DONT-PROCESS                         VALUE 'N'.      CL*13
00114      05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.      CL*17
00115          88  PS-COMMAREA-VALID                       VALUE 'Y'.      CL*17
00116          88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.      CL*17
00117      EJECT                                                           CL**1
00118  01  PV-PROGRAM-VARIABLES.                                           CL**1
00119      05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0        CL**1
00120                                                      COMP SYNC.      CL**1
00121      05  PV-RESP                        PIC S9(04)   VALUE +0        CL**1
00122                                                      COMP SYNC.      CL**1
00123      05  PV-ITEM                        PIC S9(04)   VALUE +0        CL**1
00124                                                      COMP SYNC.      CL**1
00125      05  PV-SC-ITEM                     PIC S9(04)   VALUE +0        CL**1
00126                                                      COMP SYNC.      CL**1
00127      05  PV-MESSAGE                     PIC X(78)    VALUE SPACES.   CL**1
00128      05  PV-SQL-SUB                     PIC S9(4)    COMP.           CL**1
00129      05  PV-RETRY-COUNTER               PIC S9(3)    COMP-3.         CL**1
00130      05  PV-WORK-DATE.                                               CL**1
00131          10  PV-WD-MM                   PIC XX.                      CL**1
00132          10  FILLER                     PIC X        VALUE '/'.      CL**1
00133          10  PV-WD-DD                   PIC XX.                      CL**1
00134          10  FILLER                     PIC X        VALUE '/'.      CL**1
00135          10  PV-WD-YY                   PIC XX.                      CL**1
00136 *                                                                    CL**1
00137  01  PV-DB2-DATE.                                                    CL**1
00138      05  FILLER                         PIC XX.                      CL**1
00139      05  PV-DD-YY                       PIC XX.                      CL**1
00140      05  FILLER                         PIC X.                       CL**1
00141      05  PV-DD-MM                       PIC XX.                      CL**1
00142      05  FILLER                         PIC X.                       CL**1
00143      05  PV-DD-DD                       PIC XX.                      CL**1
00144  EJECT                                                               CL**1
00145 *****************************************************************    CL**1
00146 *    STANDARD COMMAREA.                                              CL**1
00147 *****************************************************************    CL**1
00148                                                                      CL**1
00149      COPY DPWS020.                                                   CL*22
00150      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                   CL**1
00151                                                                      CL**1
00152 *****************************************************************    CL**1
00153 *    INTER-APPLICATION COMMAREA.                                     CL**1
00154 *****************************************************************    CL**1
00155                                                                      CL**1
00156          10  INTER-APPL-COMM-AREA       PIC X(200).                  CL**1
00157      COPY MBWS005.                                                   CL*22
00158 *****************************************************************    CL**1
00159 *    SPECIFIC COMMMAREA FOR MBKCS109.                                CL**1
00160 *****************************************************************    CL**1
00161          10  MB109-SPECIFIC-COMMAREA.                                CL**1
00162              15  MB109-APPL-CURSOR-POSITION          PIC S9(04)      CL**1
00163                                                      COMP.           CL**1
00164              15  MB109-SC-SUB                        PIC S9(4)       CL**1
00165                                                          COMP.       CL**1
00166              15  MB109-SC-ITEM                       PIC S9(4)       CL**1
00167                                                          COMP.       CL**1
00168              15  MB109-LAST-KEY-DATA.                                CL**1
00169                  20  MB109-LAST-GMA-NBR              PIC X(02).      CL**1
00170                  20  MB109-LAST-DMA-NBR              PIC X(02).      CL**1
00171                  20  MB109-LAST-DEPT-NBR             PIC X(03).      CL**1
00172                  20  MB109-LAST-MCLASS-NBR           PIC X(02).      CL**1
00173                  20  MB109-LAST-SCLASS-NBR           PIC X(03).      CL**1
00174                  20  MB109-LAST-MDSELV-NBR           PIC X(03).      CL**1
00175              15  MB109-GMA-DESC                      PIC X(25).      CL*15
00176              15  MB109-DMA-DESC                      PIC X(25).      CL*15
00177              15  MB109-DEPT-DESC                     PIC X(25).      CL*15
00178              15  MB109-MCLASS-DESC                   PIC X(25).      CL*15
00179              15  MB109-SCLASS-DESC                   PIC X(25).      CL*15
00180              15  MB109-POS-DESC                      PIC X(17).      CL**1
00181              15  MB109-TAX-DEFAULT                   PIC X.          CL**1
00182              15  MB109-TEMP-QUEUE-NAME.                              CL**1
00183                  20  MB109-TERM-ID                   PIC X(4).       CL**1
00184                  20  MB109-TASK-NUMBER               PIC S9(7)       CL**1
00185                                                          COMP-3.     CL**1
00186              15  MB109-LIST-SWITCH                   PIC X.          CL**1
00187                  88  MB109-LIST-EXISTS               VALUE 'Y'.      CL*13
00188                  88  MB109-NO-LIST-EXISTS            VALUE 'N'.      CL*13
00189              15  MB109-SAVE-INTER-APPL-COMMAREA      PIC X(200).     CL**1
00190              15  MB109-SAVE-LIST-RECORD              PIC X(2100).    CL**4
00191 *                                                                    CL**1
00192      EJECT                                                           CL**1
00193 *****************************************************************    CL**1
00194 *    MERCHANDISE SUB CLASS LIST RECORD LAYOUT.                       CL**1
00195 *****************************************************************    CL**1
00196  01 SC-LIST-RECORD.                                                  CL**1
00197      COPY MBWS003.                                                   CL*22
00198                                                                      CL**1
00199 *                                                                    CL**1
00200      EJECT                                                           CL**1
00201 *****************************************************************    CL**1
00202 *    ABEND PROCESSING COPYBOOK.                                      CL**1
00203 *****************************************************************    CL**1
00204                                                                      CL**1
00205      COPY DPWS013.                                                   CL**1
00206                                                                      CL**1
00207      EJECT                                                           CL**1
00208 *****************************************************************    CL**1
00209 *    ATTRIBUTE SETTINGS COPYBOOK.                                    CL**1
00210 *****************************************************************    CL**1
00211                                                                      CL**1
00212      COPY DPWS015.                                                   CL**1
00213                                                                      CL**1
00214 *****************************************************************    CL**1
00215 *    CURRENT DATE AND TIME COPYBOOK.                                 CL**1
00216 *****************************************************************    CL**1
00217                                                                      CL**1
00218      COPY DPWS017.                                                   CL**1
00219                                                                      CL**1
00220 *****************************************************************    CL**1
00221 *    TOGGLE FUNCTION KEY LINES COPYBOOK.                             CL**1
00222 *****************************************************************    CL**1
00223                                                                      CL**1
00224      COPY DPWS009.                                                   CL**1
                                                                        MBKCS101
      *****************************************************************         
      *    SYSTEM MESSAGE FIELDS                                                
      *****************************************************************         
                                                                                
           COPY DPWS006.                                                        
                                                                                
00226 *****************************************************************    CL**1
00227 *    FUNCTION KEYS COPYBOOK.                                         CL**1
00228 *****************************************************************    CL**1
00229                                                                      CL**1
00230      COPY DPWS016.                                                   CL**1
00231                                                                      CL**1
00232 *****************************************************************    CL**1
00233 *    DPKUT045 COPYBOOK.                                              CL**1
00234 *****************************************************************    CL**1
00235                                                                      CL**1
00236      COPY DPWS045.                                                   CL**1
00237                                                                      CL**1
00238 *****************************************************************    CL**1
00239 *    NUMERIC EDIT LAYOUT.                                            CL**1
00240 *****************************************************************    CL**1
00241                                                                      CL**1
00242      COPY DPWS010I.                                                  CL**1
00243                                                                      CL**1
00244 *****************************************************************    CL**1
00245 *    MESSAGE RECORD LAYOUT                                           CL**1
00246 *****************************************************************    CL**1
00247                                                                      CL**1
00248      COPY DPRD507I.                                                  CL**1
00249                                                                      CL**1
00250 *****************************************************************    CL**1
00251 *    STANDARD ATTENTION IDENTIFIER LIST                              CL**1
00252 *****************************************************************    CL**1
00253                                                                      CL**1
00254      COPY DFHAID.                                                    CL**1
00255                                                                      CL**1
00256 *****************************************************************    CL**1
00257 *    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST           CL**1
00258 *****************************************************************    CL**1
00259                                                                      CL**1
00260      COPY DFHBMSCA.                                                  CL**1
00261                                                                      CL**1
00262 *****************************************************************    CL**1
00263 *    MAP LAYOUT                                                      CL**1
00264 *****************************************************************    CL**1
00265                                                                      CL**1
00266      COPY MBKM109.                                                   CL**1
00267  01  MD-MAP-DATA-AREA  REDEFINES MB109AO PIC X(1200).                CL**1
00268 *                                                                    CL**1
00269  EJECT                                                               CL**1
00270 *                                                                    CL**1
00271 *    DB2 AREA FOR TMDSEAR                                            CL**1
00272 *                                                                    CL**1
00273      EXEC SQL                                                        CL**1
00274           INCLUDE TMDSEAR                                            CL**1
00275      END-EXEC.                                                       CL**1
00276 *                                                                    CL**1
00277 *    DB2 AREA FOR TMDSECL                                            CL**1
00278 *                                                                    CL**1
00279      EXEC SQL                                                        CL**1
00280           INCLUDE TMDSECL                                            CL**1
00281      END-EXEC.                                                       CL**1
00282 *                                                                    CL**1
00283 *    DB2 AREA FOR COMMUNICATIONS                                     CL**1
00284 *                                                                    CL**1
00285      EXEC SQL                                                        CL**1
00286           INCLUDE SQLCA                                              CL**1
00287      END-EXEC.                                                       CL**1
00288 *                                                                    CL**1
00289  EJECT                                                               CL**1
00290  LINKAGE SECTION.                                                    CL**1
00291                                                                      CL**1
00292  01  DFHCOMMAREA.                                                    CL**1
00293      05  FILLER                         OCCURS  1 TO 4072 TIMES      CL**1
00294                                         DEPENDING ON EIBCALEN.       CL**1
00295          10  FILLER                     PIC X.                       CL**1
00296                                                                      CL**1
00297 *                                                                    CL**1
00298 *                                                                    CL**1
00299 *                                                                    CL**1
00300  PROCEDURE DIVISION.                                                 CL**1
00301                                                                      CL**1
00302                                                                      CL**1
00303  0000-MAIN-MODULE.                                                   CL**1
00304                                                                      CL**1
00305 ******************************************************************   CL**1
00306 *    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.              CL**1
00307 ******************************************************************   CL**1
00308                                                                      CL**1
00309      PERFORM DP015-0000-CHECK-COMMAREA.                              CL**1
00310                                                                      CL**1
00311      IF DP020-SRC-RETURN-W-TRAN-ID                                   CL**1
00312          PERFORM 1000-CONTROL-PROCESSING                             CL**1
00313      END-IF.                                                         CL**1
00314                                                                      CL**1
00315      PERFORM DP003-0000-RETURN-TO-CICS.                              CL**1
00316  EJECT                                                               CL**1
00317 ******************************************************************   CL**1
00318 *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       CL**1
00319 *    COURSE OF ACTION IS FOR THIS TRANSACTION.                       CL**1
00320 *                                                                    CL**1
00321 *    PERFORMED BY 0000-MAIN-MODULE.                                  CL**1
00322 ******************************************************************   CL**1
00323 *                                                                    CL**1
00324  1000-CONTROL-PROCESSING.                                            CL**1
00325 *                                                                    CL**1
00326      SET PS-CONTINUE           TO  TRUE.                             CL*13
00327 *                                                                    CL**1
00328      EVALUATE TRUE                                                   CL**1
00329          WHEN DP020-NEXT-ACT-INITIAL                                 CL**1
00330              PERFORM 4100-VALIDATE-COMMAREA                          CL*17
00331              IF  PS-COMMAREA-NOT-VALID                               CL*17
00332                  MOVE PC-TSYMSG-99901                                CL*17
00333                                TO  DP020-MSG-NUMBER                  CL*17
00334                  SET DP020-MSG-FATAL                                 CL*17
00335                                TO  TRUE                              CL*17
00336                  MOVE DP016-PF3                                      CL*18
00337                                TO  DP020-SRC-AID                     CL*18
00338                  PERFORM DP015-1000-START-NAVIGATOR                  CL*17
00339              ELSE                                                    CL*17
00340                  INITIALIZE MB109-SPECIFIC-COMMAREA                  CL*17
00341                  SET PS-SEND-MAP-N-DATA-FRSET                        CL*17
00342                                TO  TRUE                              CL*17
00343                  SET DP020-NEXT-ACT-READ-MAP                         CL*17
00344                                TO  TRUE                              CL*17
00345                  PERFORM 2000-BUILD-INITIAL-PANEL                    CL*17
00346              END-IF                                                  CL*17
00347 *                                                                    CL**1
00348          WHEN DP020-NEXT-ACT-READ-MAP                                CL**1
00349              PERFORM 3000-PROCESS-PANEL                              CL**1
00350 *                                                                    CL**1
00351          WHEN DP020-NEXT-ACT-RETURN                                  CL**1
00352              SET PS-SEND-MAP-N-DATA-FRSET                            CL**1
00353                                TO  TRUE                              CL**1
00354              MOVE MB109-SAVE-INTER-APPL-COMMAREA                     CL**1
00355                                TO  MB005-INTER-APPL-COMMAREA         CL**1
00356              PERFORM 3400-MOVE-COMMAREA-TO-SCREEN                    CL**1
00357              PERFORM 2200-DISPLAY-PANEL                              CL**1
00358 *                                                                    CL**1
00359          WHEN DP020-NEXT-ACT-ERROR                                   CL**1
00360              MOVE DP020-MSG-MESSAGE TO PV-MESSAGE                    CL**1
00361              IF DP020-NAV-MNEMONIC = SPACES                          CL**1
00362                  MOVE SPACES   TO  ANAVCMDO                          CL**1
00363                  MOVE DP015-UNDERLINE                                CL**1
00364                                TO  ANAVCMDH                          CL**1
00365                  MOVE DP015-GREEN                                    CL**1
00366                                TO  ANAVCMDC                          CL**1
00367              ELSE                                                    CL**1
00368                  MOVE DP015-REVERSE                                  CL**1
00369                                TO  ANAVCMDH                          CL**1
00370                  MOVE DP015-RED                                      CL**1
00371                                TO  ANAVCMDC                          CL**1
00372              END-IF                                                  CL**1
00373 *                                                                    CL**1
00374              MOVE PV-MESSAGE   TO  DP020-MSG-MESSAGE                 CL**1
00375                                                                      CL**1
00376              SET DP020-MSG-FATAL                                     CL**1
00377                                TO  TRUE                              CL**1
00378              SET PS-SEND-DATA-ONLY-FRSET                             CL**1
00379                                TO  TRUE                              CL**1
00380              PERFORM 2200-DISPLAY-PANEL                              CL**1
00381 *                                                                    CL**1
00382          WHEN OTHER                                                  CL**1
00383              SET DP013-LOGIC-ABEND TO TRUE                           CL**1
00384              SET DP013-NO-ROLLBACK TO TRUE                           CL**1
00385              MOVE 'B100-CONTROL-PROCESSING'                          CL**1
00386                                TO  DP013-PARAGRAPH                   CL**1
00387              MOVE PM-PROGRAM-MESSAGE-12                              CL**1
00388                                TO  DP013-MESSAGE-TEXT(1)             CL**1
00389              PERFORM DP013-0000-PROCESS-ABEND                        CL**1
00390      END-EVALUATE.                                                   CL**1
00391 *                                                                    CL**1
00392  EJECT                                                               CL**1
00393 ******************************************************************   CL**1
00394 *    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST         CL**1
00395 *    ENTRY.                                                          CL**1
00396 *                                                                    CL**1
00397 *    PERFORMED BY 1000-CONTROL-PROCESSING.                           CL**1
00398 ******************************************************************   CL**1
00399 *                                                                    CL**1
00400  2000-BUILD-INITIAL-PANEL.                                           CL**1
00401 *                                                                    CL**1
00402      MOVE 1                    TO  MB109-SC-ITEM                     CL**9
00403                                    MB109-SC-SUB.                     CL**9
00404      IF  DP020-MB-SUB-CLASS-LIST                                     CL*20
00405          PERFORM 2150-READ-LIST-QUEUE                                CL**2
00406          MOVE SC-LIST-RECORD   TO  MB109-SAVE-LIST-RECORD            CL*16
00407          MOVE MB003-KEY-DATA (1)                                     CL*16
00408                                TO  MB109-LAST-KEY-DATA               CL*16
00409          SET MB109-LIST-EXISTS TO  TRUE                              CL*16
00410      ELSE                                                            CL**2
00411          MOVE MB005-REQUEST-DATA   TO  MB109-LAST-KEY-DATA           CL**2
00412          SET MB109-NO-LIST-EXISTS  TO  TRUE                          CL*13
00413      END-IF.                                                         CL**2
00414 *                                                                    CL**1
00415      PERFORM 2100-RETRIEVE-DATA-FOR-PANEL.                           CL**1
00416 *                                                                    CL**1
00417      PERFORM 2200-DISPLAY-PANEL.                                     CL**1
00418 *                                                                    CL**1
00419  EJECT                                                               CL**1
00420 ******************************************************************   CL**1
00421 *    DETERMINE WHAT LEVEL OF DATA WAS PASSED AND PERFORM THE         CL**1
00422 *    READ FOR EACH LEVEL.                                            CL**1
00423 *                                                                    CL**1
00424 *    PERFORMED BY 2000, 2160, 3000                                   CL**1
00425 ******************************************************************   CL**1
00426 *                                                                    CL**1
00427  2100-RETRIEVE-DATA-FOR-PANEL.                                       CL**1
00428 *                                                                    CL**1
00429 *    FIRST, SET UP THE HOST VARIABLES.                               CL**1
00430 *                                                                    CL**1
00431      MOVE MB109-LAST-GMA-NBR   TO  MDSEAR-GMA-NBR.                   CL**1
00432      MOVE MB109-LAST-DMA-NBR   TO  MDSEAR-DMA-NBR.                   CL**1
00433      MOVE MB109-LAST-DEPT-NBR  TO  MDSEAR-DEPT-NBR.                  CL**1
00434      MOVE MB109-LAST-MCLASS-NBR                                      CL**1
00435                                TO  MDSEAR-MAJ-CL-NBR.                CL**1
00436      MOVE MB109-LAST-SCLASS-NBR                                      CL**1
00437                                TO  MDSEAR-SUB-CL-NBR.                CL**1
00438      MOVE MB109-LAST-MDSELV-NBR                                      CL**1
00439                                TO  MDSEAR-MDSELV-CDE.                CL**1
00440 *                                                                    CL**1
00441 *    NOW, RETRIEVE THE SUBCLASS INFORMATION.                         CL*13
00442 *                                                                    CL**1
00443      PERFORM 2120-READ-MDSECL.                                       CL**1
00444      MOVE MDSEAR-DESC          TO  MB109-SCLASS-DESC.                CL**1
00445      MOVE MDSECL-POS-DESC      TO  MB109-POS-DESC.                   CL**1
00446      MOVE MDSECL-TAX-DFLT-IND  TO  MB109-TAX-DEFAULT.                CL**1
00447 *                                                                    CL**1
00448 *    MAJOR CLASS NEXT.                                               CL**1
00449 *                                                                    CL**1
00450      MOVE PC-MCL               TO  MDSEAR-MDSELV-CDE.                CL*13
00451      MOVE PC-ZERO              TO  MDSEAR-SUB-CL-NBR.                CL**2
00452      PERFORM 2110-READ-MDSEAR.                                       CL**1
00453      MOVE MDSEAR-DESC          TO  MB109-MCLASS-DESC.                CL**1
00454 *                                                                    CL**1
00455 *    DEPARTMENT NEXT.                                                CL**1
00456 *                                                                    CL**1
00457      MOVE PC-DPT               TO  MDSEAR-MDSELV-CDE.                CL*13
00458      MOVE PC-ZERO              TO  MDSEAR-MAJ-CL-NBR.                CL**2
00459      PERFORM 2110-READ-MDSEAR.                                       CL**1
00460      MOVE MDSEAR-DESC          TO  MB109-DEPT-DESC.                  CL**1
00461 *                                                                    CL**1
00462 *    NOW THE DMA.                                                    CL**1
00463 *                                                                    CL**1
00464      MOVE PC-DMA               TO  MDSEAR-MDSELV-CDE.                CL*13
00465      MOVE PC-ZERO              TO  MDSEAR-DEPT-NBR.                  CL**2
00466      PERFORM 2110-READ-MDSEAR.                                       CL**1
00467      MOVE MDSEAR-DESC          TO  MB109-DMA-DESC.                   CL**1
00468 *                                                                    CL**1
00469 *    FINALLY, THE GMA.                                               CL**1
00470 *                                                                    CL**1
00471      MOVE PC-GMA               TO  MDSEAR-MDSELV-CDE.                CL*13
00472      MOVE PC-ZERO              TO  MDSEAR-DMA-NBR.                   CL**2
00473      PERFORM 2110-READ-MDSEAR.                                       CL**1
00474      MOVE MDSEAR-DESC          TO  MB109-GMA-DESC.                   CL**1
00475 *                                                                    CL**1
00476      PERFORM 3400-MOVE-COMMAREA-TO-SCREEN.                           CL**1
00477 *                                                                    CL**1
00478  EJECT                                                               CL**1
00479 ******************************************************************   CL**1
00480 *    READ THE TMDSEAR TABLE HERE.                                    CL**1
00481 *                                                                    CL**1
00482 *    PERFORMED BY 2100.                                              CL**1
00483 ******************************************************************   CL**1
00484 *                                                                    CL**1
00485  2110-READ-MDSEAR.                                                   CL**1
00486 *                                                                    CL**1
00487      PERFORM                                                         CL**1
00488          WITH TEST AFTER                                             CL**1
00489          VARYING PV-SQL-SUB                                          CL**1
00490          FROM 1 BY 1                                                 CL**1
00491          UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                CL**4
00492             OR SQLCODE = 0                                           CL**1
00493             OR SQLCODE = +100                                        CL**1
00494 *                                                                    CL**1
00495          EXEC SQL                                                    CL**1
00496               SELECT                                                 CL**1
00497                      MDSEAR_DESC                                     CL**1
00498               INTO                                                   CL**1
00499                      :MDSEAR-DESC                                    CL**1
00500               FROM                                                   CL**1
00501                      TMDSEAR                                         CL**1
00502               WHERE                                                  CL**1
00503                      OPERCO_NBR     = :PC-COMPANY                    CL**1
00504                 AND  GMA_NBR        = :MDSEAR-GMA-NBR                CL**1
00505                 AND  DMA_NBR        = :MDSEAR-DMA-NBR                CL**1
00506                 AND  DEPT_NBR       = :MDSEAR-DEPT-NBR               CL**1
00507                 AND  MAJ_CL_NBR     = :MDSEAR-MAJ-CL-NBR             CL**2
00508                 AND  SUB_CL_NBR     = :MDSEAR-SUB-CL-NBR             CL**1
00509                 AND  MDSELV_CDE     = :MDSEAR-MDSELV-CDE             CL**1
00510          END-EXEC                                                    CL**1
00511 *                                                                    CL**1
00512          EVALUATE TRUE                                               CL**1
00513              WHEN SQLCODE = -904                                     CL**1
00514              WHEN SQLCODE = -913                                     CL**1
00515              WHEN SQLCODE = ZERO                                     CL**1
00516                   CONTINUE                                           CL**1
00517              WHEN SQLWARN0 NOT EQUAL SPACE                           CL**1
00518              WHEN SQLCODE NOT EQUAL ZERO                             CL**1
00519                   MOVE '2110-READ-MDSEAR'                            CL**1
00520                                TO  DP013-PARAGRAPH                   CL**1
00521                   MOVE 'READ MDSEAR'                                 CL**1
00522                                TO  DP013-MESSAGE-TEXT (1)            CL**1
00523                   MOVE SQLCA   TO  DP013-SQLCA                       CL**1
00524                   SET DP013-DB2-ABEND                                CL**1
00525                                TO  TRUE                              CL**1
00526                   PERFORM DP013-0000-PROCESS-ABEND                   CL**1
00527          END-EVALUATE                                                CL**1
00528      END-PERFORM.                                                    CL**1
00529 *                                                                    CL**1
00530      IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                      CL**4
00531          MOVE '2110-READ-MDSEAR'                                     CL**1
00532                                TO  DP013-PARAGRAPH                   CL**1
00533          MOVE 'MAX RETRIES EXCEEDED FOR READ MDSEAR'                 CL**1
00534                                TO  DP013-MESSAGE-TEXT (1)            CL**1
00535          MOVE SQLCA            TO  DP013-SQLCA                       CL**1
00536          SET DP013-DB2-ABEND   TO  TRUE                              CL**1
00537          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
00538      END-IF.                                                         CL**1
00539 *                                                                    CL**1
00540  EJECT                                                               CL**1
00541 ******************************************************************   CL**1
00542 *    READ THE TMDSECL TABLE HERE.                                    CL**1
00543 *                                                                    CL**1
00544 *    PERFORMED BY 2100.                                              CL**1
00545 ******************************************************************   CL**1
00546 *                                                                    CL**1
00547  2120-READ-MDSECL.                                                   CL**1
00548 *                                                                    CL**1
00549      PERFORM                                                         CL**1
00550          WITH TEST AFTER                                             CL**1
00551          VARYING PV-SQL-SUB                                          CL**1
00552          FROM 1 BY 1                                                 CL**1
00553          UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                CL**4
00554             OR SQLCODE = 0                                           CL**1
00555             OR SQLCODE = +100                                        CL**1
00556 *                                                                    CL**1
00557          EXEC SQL                                                    CL**1
00558               SELECT                                                 CL**1
00559                      A.MDSEAR_DESC,                                  CL**1
00560                      C.POS_DESC,                                     CL**1
00561                      C.TAX_DFLT_IND                                  CL**1
00562               INTO                                                   CL**1
00563                      :MDSEAR-DESC,                                   CL**1
00564                      :MDSECL-POS-DESC,                               CL**1
00565                      :MDSECL-TAX-DFLT-IND                            CL**1
00566               FROM                                                   CL**1
00567                      TMDSEAR A,                                      CL**1
00568                      TMDSECL C                                       CL**1
00569               WHERE                                                  CL**1
00570                      A.OPERCO_NBR   = :PC-COMPANY                    CL**1
00571                 AND  A.GMA_NBR      = :MDSEAR-GMA-NBR                CL**1
00572                 AND  A.DMA_NBR      = :MDSEAR-DMA-NBR                CL**1
00573                 AND  A.DEPT_NBR     = :MDSEAR-DEPT-NBR               CL**1
00574                 AND  A.MAJ_CL_NBR   = :MDSEAR-MAJ-CL-NBR             CL**3
00575                 AND  A.SUB_CL_NBR   = :MDSEAR-SUB-CL-NBR             CL**1
00576                 AND  A.MDSEAR_DKEY  = C.MDSEAR_DKEY                  CL**1
00577          END-EXEC                                                    CL**1
00578 *                                                                    CL**1
00579          EVALUATE TRUE                                               CL**1
00580              WHEN SQLCODE = -904                                     CL**1
00581              WHEN SQLCODE = -913                                     CL**1
00582              WHEN SQLCODE = ZERO                                     CL**1
00583                   CONTINUE                                           CL**1
00584              WHEN SQLWARN0 NOT EQUAL SPACE                           CL**1
00585              WHEN SQLCODE NOT EQUAL ZERO                             CL**1
00586                   MOVE '2120-READ-MDSECL'                            CL**1
00587                                TO  DP013-PARAGRAPH                   CL**1
00588                   MOVE 'READ MDSECL'                                 CL**1
00589                                TO  DP013-MESSAGE-TEXT (1)            CL**1
00590                   MOVE SQLCA   TO  DP013-SQLCA                       CL**1
00591                   SET DP013-DB2-ABEND                                CL**1
00592                                TO  TRUE                              CL**1
00593                   PERFORM DP013-0000-PROCESS-ABEND                   CL**1
00594          END-EVALUATE                                                CL**1
00595      END-PERFORM.                                                    CL**1
00596 *                                                                    CL**1
00597      IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                      CL**4
00598          MOVE '2120-READ-MDSECL'                                     CL**1
00599                                TO  DP013-PARAGRAPH                   CL**1
00600          MOVE 'MAX RETRIES EXCEEDED FOR READ MDSECL'                 CL**1
00601                                TO  DP013-MESSAGE-TEXT (1)            CL**1
00602          MOVE SQLCA            TO  DP013-SQLCA                       CL**1
00603          SET DP013-DB2-ABEND   TO  TRUE                              CL**1
00604          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
00605      END-IF.                                                         CL**1
00606 *                                                                    CL**1
00607  EJECT                                                               CL**1
00608 ******************************************************************   CL**1
00609 *    READ THE TEMPORARY STORAGE QUEUE THAT CONTAINS THE SELECTED     CL**1
00610 *    MERCHANDISE DEPARTMENTS FROM MBKCS123 (MERCH DEPT DISCNT LST)   CL**1
00611 *                                                                    CL**1
00612 *    PERFORMED BY 2000, 2160                                         CL**1
00613 ******************************************************************   CL**1
00614 *                                                                    CL**1
00615  2150-READ-LIST-QUEUE.                                               CL**1
00616 *                                                                    CL**1
00617      EXEC CICS                                                       CL**1
00618          READQ TS                                                    CL**1
00619          QUEUE(MB005-LIST-QUEUE-NAME)                                CL**1
00620          INTO(SC-LIST-RECORD)                                        CL**1
00621          LENGTH(MB005-LIST-QUEUE-LENGTH)                             CL**1
00622          ITEM(MB109-SC-ITEM)                                         CL**1
00623          RESP(PV-RESP)                                               CL**1
00624      END-EXEC.                                                       CL**1
00625 *                                                                    CL**1
00626      IF  PV-RESP EQUAL DFHRESP(NORMAL)                               CL**1
00627          CONTINUE                                                    CL**1
00628      ELSE                                                            CL**1
00629          MOVE PV-RESP          TO  PM-RESP-22                        CL**1
00630          SET DP013-LOGIC-ABEND TO  TRUE                              CL**1
00631          SET DP013-NO-ROLLBACK TO  TRUE                              CL**1
00632          MOVE '2150-READ-LIST-QUEUE'                                 CL**1
00633                                TO  DP013-PARAGRAPH                   CL**1
00634          MOVE PM-PROGRAM-MESSAGE-22                                  CL**1
00635                                TO  DP013-MESSAGE-TEXT (1)            CL**1
00636          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
00637      END-IF.                                                         CL**1
00638 *                                                                    CL**1
00639  EJECT                                                               CL**1
00640 ******************************************************************   CL**1
00641 *    READ THE TEMP STORAGE QUEUE, GET THE NEXT BUSINESS GROUP.       CL**1
00642 *    IF AT END, ISSUE MESSAGE, OTHERWISE CONTINUE PROCESSING.        CL**1
00643 *                                                                    CL**1
00644 *    PERFORMED BY 3000                                               CL**1
00645 ******************************************************************   CL**1
00646 *                                                                    CL**1
00647  2160-GET-NEXT-MDSEAR.                                               CL**1
00648 *                                                                    CL**1
00649      ADD 1                     TO  MB109-SC-SUB.                     CL**1
00650      IF  MB109-SC-SUB GREATER THAN MB003-MAX-ITEMS                   CL*14
00651          ADD 1                 TO  MB109-SC-ITEM                     CL**1
00652          MOVE 1                TO  MB109-SC-SUB                      CL**1
00653          PERFORM 2150-READ-LIST-QUEUE                                CL**4
00654          MOVE SC-LIST-RECORD   TO  MB109-SAVE-LIST-RECORD            CL**4
00655      ELSE                                                            CL**4
00656          MOVE MB109-SAVE-LIST-RECORD                                 CL**4
00657                                TO  SC-LIST-RECORD                    CL**4
00658      END-IF.                                                         CL**1
00659 *                                                                    CL**1
00660      IF  MB003-KEY-DATA (MB109-SC-SUB) GREATER THAN SPACES           CL*14
00661          MOVE MB003-KEY-DATA (MB109-SC-SUB)                          CL*14
00662                                TO  MB109-LAST-KEY-DATA               CL**4
00663          PERFORM 2100-RETRIEVE-DATA-FOR-PANEL                        CL**1
00664      ELSE                                                            CL**1
00665          SUBTRACT 1          FROM  MB109-SC-SUB                      CL**1
00666          MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER                  CL*13
00667          SET DP020-MSG-INFORMATIONAL                                 CL*13
00668                                TO  TRUE                              CL*13
00669      END-IF.                                                         CL**1
00670 *                                                                    CL**1
00671  EJECT                                                               CL**1
00672 ******************************************************************   CL**1
00673 *    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.          CL**1
00674 *                                                                    CL**1
00675 *    PERFORMED BY 1000-CONTROL-PROCESSING.                           CL**1
00676 *    PERFORMED BY 3000-PROCESS-PANEL.                                CL**1
00677 ******************************************************************   CL**1
00678 *                                                                    CL**1
00679  2200-DISPLAY-PANEL.                                                 CL**1
00680 *                                                                    CL**1
00681      PERFORM DP017-0000-GET-CURR-DATE-TIME.                          CL**1
00682      MOVE DP017-EDITED-TIME-HMS                                      CL**1
00683                                TO  ATIMEO.                           CL**1
00684      MOVE -1                   TO  ANAVCMDL.                         CL**8
00685 *                                                                    CL**1
00686      IF  PS-SEND-MAP-N-DATA-FRSET                                    CL**1
00687          PERFORM DP002-0000-FORMAT-TITLE-LINES                       CL**1
00688          PERFORM DP009-0000-LOAD-FK-LINES                            CL**1
00689      END-IF.                                                         CL**1
00690 *                                                                    CL**1
00691      PERFORM DP005-0000-FORMAT-MSG-LINES.                            CL**1
00692                                                                      CL**1
00693      PERFORM DP008-0000-WRITE-PANEL.                                 CL**1
00694 *                                                                    CL**1
00695  EJECT                                                               CL**1
00696 ******************************************************************   CL**1
00697 *    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED     CL**1
00698 *    ON WHAT FUNCTION KEY WAS SELECTED.                              CL**1
00699 *                                                                    CL**1
00700 *    PERFORMED BY 1000-CONTROL-PROCESSING.                           CL**1
00701 ******************************************************************   CL**1
00702 *                                                                    CL**1
00703  3000-PROCESS-PANEL.                                                 CL**1
00704 *                                                                    CL**1
00705      PERFORM DP007-0000-GET-PANEL.                                   CL**1
00706      SET PS-SEND-DATA-ONLY-FRSET                                     CL**1
00707                                TO TRUE.                              CL**1
00708      PERFORM 3100-CHECK-LOCAL-FKEYS.                                 CL**1
00709 *                                                                    CL**1
00710  EJECT                                                               CL**1
00711 ******************************************************************   CL**1
00712 *   DETERMINE THE PROCESSING PATH HERE.                              CL**1
00713 *                                                                    CL**1
00714 *   PERFORMED BY 3000.                                               CL**1
00715 ******************************************************************   CL**1
00716 *                                                                    CL**1
00717  3100-CHECK-LOCAL-FKEYS.                                             CL**1
00718 *                                                                    CL**1
00719      EVALUATE TRUE                                                   CL**1
00720 *                                                                    CL**1
00721          WHEN DP020-SRC-AID = DP016-CLEAR                            CL**1
00722          WHEN DP020-FK-REFRESH(DP020-SRC-AID)                        CL**1
00723              MOVE SPACES       TO  ANAVCMDO                          CL*21
00724                                    ANAVKEYO                          CL*21
00725              SET PS-SEND-MAP-N-DATA-FRSET                            CL**1
00726                                TO  TRUE                              CL**1
00727              PERFORM 3400-MOVE-COMMAREA-TO-SCREEN                    CL**1
00728              PERFORM 2200-DISPLAY-PANEL                              CL**1
00729 *                                                                    CL**1
00730 *    "NEXT" PROCESSING - POSITION TO NEXT MERCH AREA CODE            CL**1
00731 *                                                                    CL**1
00732          WHEN DP020-FK-NEXT-SELECTION(DP020-SRC-AID)                 CL*12
00733              IF  MB109-LIST-EXISTS                                   CL*13
00734                  PERFORM 2160-GET-NEXT-MDSEAR                        CL**1
00735              ELSE                                                    CL**1
00736                  MOVE PC-TSYMSG-00070                                CL*13
00737                                TO  DP020-MSG-NUMBER                  CL*13
00738                  SET DP020-MSG-INFORMATIONAL                         CL*13
00739                                TO  TRUE                              CL*13
00740              END-IF                                                  CL**1
00741              PERFORM 2200-DISPLAY-PANEL                              CL*13
00742 *                                                                    CL**1
00743          WHEN DP020-SRC-AID = DP016-PA2                              CL**1
00744              PERFORM DP009-0000-LOAD-FK-LINES                        CL**1
00745              PERFORM DP017-0000-GET-CURR-DATE-TIME                   CL**1
00746              SET PS-SEND-DATA-ONLY                                   CL**1
00747                                TO  TRUE                              CL**1
00748              MOVE -1           TO  ANAVCMDL                          CL**1
00749              PERFORM DP008-0000-WRITE-PANEL                          CL**1
00750 *                                                                    CL**1
00751          WHEN DP020-FK-RETURN(DP020-SRC-AID)                         CL**1
00752          WHEN DP020-FK-GO-TO-TRAN(DP020-SRC-AID)                     CL*10
00753               PERFORM 4000-NAVIGATE                                  CL**1
00754 *                                                                    CL**1
00755          WHEN DP020-SRC-AID = DP016-ENTER                            CL**1
00756              IF  DP020-NAV-MNEMONIC GREATER THAN SPACES              CL**1
00757                  PERFORM 4000-NAVIGATE                               CL**1
00758              ELSE                                                    CL**1
00759                  PERFORM 2200-DISPLAY-PANEL                          CL**1
00760              END-IF                                                  CL**1
00761 *                                                                    CL**1
00762          WHEN OTHER                                                  CL**1
00763              MOVE PC-TSYMSG-00045                                    CL**1
00764                                TO  DP020-MSG-NUMBER                  CL**1
00765              SET DP020-MSG-FATAL                                     CL**1
00766                                TO  TRUE                              CL**1
00767              MOVE -1           TO  ANAVCMDL                          CL**1
00768              PERFORM 2200-DISPLAY-PANEL                              CL**1
00769      END-EVALUATE.                                                   CL**1
00770 *                                                                    CL**1
00771  EJECT                                                               CL**1
00772 ******************************************************************   CL**1
00773 *    HERE WE SIMPLY MOVE DATA ENTERED ON THE SCREEN TO THE COMM      CL**1
00774 *    AREA.                                                           CL**1
00775 *                                                                    CL**1
00776 *    PERFORMED BY 3000                                               CL**1
00777 ******************************************************************   CL**1
00778 *                                                                    CL**1
00779 *3200-MOVE-SCREEN-TO-COMMAREA.                                       CL**1
00780 *                                                                    CL**1
00781  EJECT                                                               CL**1
00782 ******************************************************************   CL**1
00783 *    HERE WE SIMPLY ENSURE THE DATA IS CORRECT.  IF NOT, ISSUE       CL**1
00784 *    APPROPRIATE ERRORS.                                             CL**1
00785 *                                                                    CL**1
00786 *    PERFORMED BY 3000                                               CL**1
00787 ******************************************************************   CL**1
00788 *                                                                    CL**1
00789 *3300-EDIT-DATA-IN-COMMAREA.                                         CL**1
00790 *                                                                    CL**1
00791  EJECT                                                               CL**1
00792 ******************************************************************   CL**1
00793 *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.              CL**1
00794 *                                                                    CL**1
00795 *    PERFORMED BY 2000, 2160.                                        CL**1
00796 ******************************************************************   CL**1
00797 *                                                                    CL**1
00798  3400-MOVE-COMMAREA-TO-SCREEN.                                       CL**1
00799 *                                                                    CL**1
00800      MOVE MB109-LAST-GMA-NBR   TO  AGMAO.                            CL**2
00801      MOVE MB109-LAST-DMA-NBR   TO  ADMAO.                            CL**2
00802      MOVE MB109-LAST-DEPT-NBR  TO  ADEPTO.                           CL**2
00803      MOVE MB109-LAST-MCLASS-NBR                                      CL**1
00804                                TO  AMCLASSO.                         CL**2
00805      MOVE MB109-LAST-SCLASS-NBR                                      CL**1
00806                                TO  ASCLASSO.                         CL**2
00807 *                                                                    CL**1
00808      MOVE MB109-GMA-DESC       TO  AGMADESO.                         CL**2
00809      MOVE MB109-DMA-DESC       TO  ADMADESO.                         CL**2
00810      MOVE MB109-DEPT-DESC      TO  ADPTDESO.                         CL**2
00811      MOVE MB109-MCLASS-DESC    TO  AMCDESO.                          CL**2
00812      MOVE MB109-SCLASS-DESC    TO  ASCDESO.                          CL**4
00813 *                                                                    CL**1
00814      MOVE MB109-POS-DESC       TO  APDESCO.                          CL**6
00815      MOVE MB109-TAX-DEFAULT    TO  ATAXDFTO.                         CL**2
00816      MOVE PC-COMPANY           TO  AOPERCOO.                         CL*10
00817 *                                                                    CL**1
00818  EJECT                                                               CL**1
00819 ******************************************************************   CL**1
00820 *    IF THE USER HITS A KEY THAT REQUIRES US TO GO TO ANOTHER        CL**1
00821 *    TRANSACTION, SAVE THE INTER APPLICATION COMMUNICATIONS AREA     CL**1
00822 *    AND START THE NAVIGATOR.                                        CL**1
00823 *                                                                    CL**1
00824 *    PERFORMED BY 3000                                               CL**1
00825 ******************************************************************   CL**1
00826 *                                                                    CL**1
00827  4000-NAVIGATE.                                                      CL**1
00828 *                                                                    CL**1
00829      IF  MB109-LIST-EXISTS                                           CL*13
00830          COMPUTE MB005-NUMBER-PROCESSED-ITEMS =                      CL**9
00831              ((MB109-SC-ITEM - 1) * MB003-MAX-ITEMS) +               CL*14
00832                MB109-SC-SUB                                          CL**9
00833      END-IF.                                                         CL**9
00834 *                                                                    CL**9
00835      MOVE MB005-INTER-APPL-COMMAREA                                  CL**1
00836                                TO  MB109-SAVE-INTER-APPL-COMMAREA.   CL**1
00837      PERFORM DP015-1000-START-NAVIGATOR.                             CL**1
00838 *                                                                    CL*17
00839  EJECT                                                               CL*17
00840 ******************************************************************   CL*17
00841 *    ENSURE WE ENTERED THIS PROGRAM PROPERLY.                        CL*17
00842 *                                                                    CL*17
00843 *    PERFORMED BY 1000                                               CL*17
00844 ******************************************************************   CL*17
00845 *                                                                    CL*17
00846  4100-VALIDATE-COMMAREA.                                             CL*17
00847 *                                                                    CL*17
00848      IF (DP020-MB-SUB-CLASS-SELECT                                   CL*17
00849      OR  DP020-MB-SUB-CLASS-LIST                                     CL*19
00850      OR  DP020-MB-MERCH-AREA-INQUIRY)                                CL*19
00851          SET PS-COMMAREA-VALID TO  TRUE                              CL*17
00852      ELSE                                                            CL*17
00853          SET PS-COMMAREA-NOT-VALID                                   CL*17
00854                                TO  TRUE                              CL*17
00855      END-IF.                                                         CL*17
00856 *                                                                    CL**1
00857  EJECT                                                               CL**1
00858 ******************************************************************   CL**1
00859 *    FILL IN SCREEN HEADER MODULE                                    CL**1
00860 ******************************************************************   CL**1
00861                                                                      CL**1
00862      COPY DPPD002.                                                   CL**1
00863  EJECT                                                               CL**1
00864 ******************************************************************   CL**1
00865 *    RETURN TO CICS MODULE                                           CL**1
00866 ******************************************************************   CL**1
00867                                                                      CL**1
00868      COPY DPPD003.                                                   CL**1
00869  EJECT                                                               CL**1
00870 ******************************************************************   CL**1
00871 *    FORMAT MESSAGE LINES MODULE                                     CL**1
00872 ******************************************************************   CL**1
00873                                                                      CL**1
00874      COPY DPPD005.                                                   CL**1
00875  EJECT                                                               CL**1
00876 ******************************************************************   CL**1
00877 *    GET PANEL MODULE                                                CL**1
00878 ******************************************************************   CL**1
00879                                                                      CL**1
00880      COPY DPPD007.                                                   CL**1
00881  EJECT                                                               CL**1
00882 ******************************************************************   CL**1
00883 *    WRITE PANEL MODULE                                              CL**1
00884 ******************************************************************   CL**1
00885                                                                      CL**1
00886      COPY DPPD008.                                                   CL**1
00887  EJECT                                                               CL**1
00888 ******************************************************************   CL**1
00889 *    TOGGLE THE FUNCTION KEY LINE MODULE                             CL**1
00890 ******************************************************************   CL**1
00891                                                                      CL**1
00892      COPY DPPD009.                                                   CL**1
00893  EJECT                                                               CL**1
00894 ******************************************************************   CL**1
00895 *    ABEND PROCESSOR MODULE                                          CL**1
00896 ******************************************************************   CL**1
00897                                                                      CL**1
00898      COPY DPPD013.                                                   CL**1
00899  EJECT                                                               CL**1
00900 ******************************************************************   CL**1
00901 *    CHECK COMMUNICATION AREA MODULE                                 CL**1
00902 ******************************************************************   CL**1
00903                                                                      CL**1
00904      COPY DPPD015.                                                   CL**1
00905  EJECT                                                               CL**1
00906 ******************************************************************   CL**1
00907 *    UPDATE TIME AND DATE MODULE                                     CL**1
00908 ******************************************************************   CL**1
00909                                                                      CL**1
00910      COPY DPPD017.                                                   CL**1
