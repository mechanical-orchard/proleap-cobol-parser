000100******************************************************************00010016
000200 IDENTIFICATION DIVISION.                                         00020017
000300******************************************************************00030017
000400 PROGRAM-ID.    RCKUT825.                                         00040017
000500 AUTHOR.        CRAIG KEHOE.                                      00050017
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060017
000700 DATE-WRITTEN.  02-2003                                           00070017
000800 DATE-COMPILED. 05/30/2003                                        00080017
000810******************************************************************00081017
000820******************************************************************00082017
000830*      THIS PROGRAM IS THE PRORATION RANDOM ROUTINE.             *00083017
000840*      ITS BASIC FUNCTION IS TO COME UP WITH RANDOM STORES.      *00084017
000850******************************************************************00085017
000860******************************************************************00086017
000870 ENVIRONMENT DIVISION.                                            00087017
000880******************************************************************00088017
000890                                                                  00089017
000900******************************************************************00090017
001000 DATA DIVISION.                                                   00100017
001100******************************************************************00110017
001200 WORKING-STORAGE SECTION.                                         00120017
001300******************************************************************00130017
001400 01  PC-WG-PROGRAM-CONSTANTS.                                     00140017
001500     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'RCKUT825'.  00150017
001600     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00160017
001700                                              COMP.               00170017
001800 01  PV-WG-PROGRAM-VARIABLES.                                     00180017
001900     05  PV-UNIQUE-RANDOM     PIC  X(01)  VALUE 'N'.              00190017
002000     05  PV-RANDOM-MATCH      PIC  X(01)  VALUE 'N'.              00200017
002100     05  PV-DISPLAY-CNT       PIC  9(03)  VALUE 0.                00210017
002200     05  PV-RANDOM-VALUE      PIC  9(03)  VALUE 0.                00220017
002300     05  PV-RAND-ORDER        PIC  9(03)  VALUE 0.                00230017
002400     05  PV-STORES-CNT        PIC  9(03)  VALUE 0.                00240017
002500     05  PV-SWAP-NUM          PIC 9.                              00250017
002600     05  PV-RANDOM-SEL-MIN    PIC 9999.                           00260017
002700     05  PV-RANDOM-SEL-MAX    PIC 9999.                           00270017
002800     05  PV-RANDOM-SEL-CNT    PIC 9999.                           00280017
002900     05  PV-RANDOM-STORE-MIN  PIC 9999.                           00290017
003000     05  PV-RANDOM-STORE-MAX  PIC 9999.                           00300017
003100     05  PV-RANDOM-SEED       PIC 9(8).                           00310017
003200                                                                  00320017
003300 01  PV-RANDOM-SEED-X     PIC  X(08).                             00330017
003400 01  PT-RANDOM-SEED REDEFINES PV-RANDOM-SEED-X.                   00340017
003500     05  PT-SEED-DIGITS OCCURS 8 TIMES                            00350017
003600                            INDEXED BY PT-SEED-IDX.               00360017
003700         10 PT-SEED            PIC 9.                             00370017
003800                                                                  00380017
004300******************************************************************00430017
004400*  LAYOUT FOR THE ABEND MODULE COMMUNICATION AREA.               *00440017
004500******************************************************************00450017
004600     COPY DPWS013.                                                00460017
004700******************************************************************00470017
004800*    STANDARD COMMAREA.                                          *00480017
004900******************************************************************00490017
005000     COPY DPWS020.                                                00500017
005100*    THE FOLLOWING LINE ALWAYS GETS A WARNING THAT IT REDEFINES   00510017
005200*    A LARGER ITEM.                                               00520017
005300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00530017
005400******************************************************************00540017
005500*    INTER-APPLICATION COMMAREA.                                 *00550017
005600******************************************************************00560017
005700         10  INTER-APPL-COMM-AREA PIC X(200).                     00570017
005800******************************************************************00580017
005900*  LAYOUT FOR THE RANDOM ROUTINE.                                *00590017
006000******************************************************************00600017
006100     COPY RCWS825.                                                00610017
006200                                                                  00620017
006300******************************************************************00630017
006400 LINKAGE SECTION.                                                 00640017
006500******************************************************************00650017
006600 01  LINK-COMMAREA                    PIC X(1811).                00660017
006700******************************************************************00670017
006800 PROCEDURE DIVISION USING LINK-COMMAREA.                          00680017
006900******************************************************************00690017
007000     PERFORM 0001-HOUSEKEEPING.                                   00700017
007100     PERFORM 1000-CONTROL-PROCESSING.                             00710017
007200     MOVE RC825-COMMAREA TO LINK-COMMAREA.                        00720017
007300     GOBACK.                                                      00730017
007400                                                                  00740017
007500 0001-HOUSEKEEPING.                                               00750017
007600                                                                  00760017
007700     INITIALIZE RC825-COMMAREA                                    00770017
007800                PV-RAND-ORDER.                                    00780017
007900                                                                  00790017
008000     MOVE LINK-COMMAREA TO RC825-COMMAREA.                        00800017
008100                                                                  00810017
008200     SET RND-INDEX TO 1.                                          00820017
008300     PERFORM RC825-RANDOM-STORE-MAX TIMES                         00830017
008400         MOVE ZERO TO RC825-RANDOM-STORE-NBR (RND-INDEX)          00840017
008500         SET RND-INDEX UP BY 1                                    00850017
008600     END-PERFORM.                                                 00860017
008700                                                                  00870017
008800******************************************************************00880017
008900*  CONTROL PROCESSING                                            *00890017
009000******************************************************************00900017
009100 1000-CONTROL-PROCESSING.                                         00910017
009200     PERFORM 2000-INITIALIZE.                                     00920017
009300                                                                  00930017
009400     PERFORM 2100-VALIDATE-INPUT.                                 00940017
009500                                                                  00950017
009600*      GET RANDOM STORE NUMBERS                                   00960017
009700     PERFORM 2200-PROCESS-RANDOM-FUNCTION.                        00970017
009800                                                                  00980017
009900******************************************************************00990017
010000* INITIALIZE THE STORE-COUNT-NUMBERS AND                         *01000017
010100* PRIME THE RANDOM FUNCTION (ONLY ONCE).                         *01010017
010200******************************************************************01020017
010300 2000-INITIALIZE.                                                 01030017
010400                                                                  01040017
010500     MOVE FUNCTION CURRENT-DATE(9:8) TO PV-RANDOM-SEED-X.         01050017
010600                                                                  01060017
010700     MOVE PT-SEED(1)  TO PV-SWAP-NUM.                             01070017
010800     MOVE PT-SEED(8)  TO PT-SEED(1).                              01080017
010900     MOVE PV-SWAP-NUM TO PT-SEED(8).                              01090017
011000     MOVE PT-SEED(2)  TO PV-SWAP-NUM.                             01100017
011100     MOVE PT-SEED(7)  TO PT-SEED(2).                              01110017
011200     MOVE PV-SWAP-NUM TO PT-SEED(7).                              01120017
011300     MOVE PT-SEED(3)  TO PV-SWAP-NUM.                             01130017
011400     MOVE PT-SEED(6)  TO PT-SEED(3).                              01140017
011500     MOVE PV-SWAP-NUM TO PT-SEED(6).                              01150017
011600     MOVE PT-SEED(4)  TO PV-SWAP-NUM.                             01160017
011700     MOVE PT-SEED(5)  TO PT-SEED(4).                              01170017
011800     MOVE PV-SWAP-NUM TO PT-SEED(5).                              01180017
011900                                                                  01190017
012000     MOVE PT-RANDOM-SEED TO PV-RANDOM-SEED.                       01200017
012100                                                                  01210017
012200     COMPUTE PV-RANDOM-VALUE =                                    01220017
012300             FUNCTION RANDOM(PV-RANDOM-SEED).                     01230017
012400                                                                  01240017
012500******************************************************************01250017
012600* VALIDATE THE STORE COUNT, THE STORE MINIMUM AND THE STORE      *01260017
012700* MAXIMUM.                                                       *01270017
012800******************************************************************01280017
012900 2100-VALIDATE-INPUT.                                             01290017
013000     SET RC825-NO-ERRORS TO TRUE.                                 01300017
013100                                                                  01310017
013200     MOVE RC825-RANDOM-SEL-MIN     TO PV-RANDOM-SEL-MIN.          01320017
013300     MOVE RC825-RANDOM-SEL-MAX     TO PV-RANDOM-SEL-MAX.          01330017
013400     MOVE RC825-RANDOM-STR-SEL-CNT TO PV-RANDOM-SEL-CNT.          01340017
013500                                                                  01350017
013600     IF RC825-RANDOM-SEL-MIN < RC825-RANDOM-STORE-MIN             01360017
013700     OR RC825-RANDOM-SEL-MIN > RC825-RANDOM-SEL-MAX               01370017
013800     THEN                                                         01380017
013900       SET RC825-INV-MINIMUM TO TRUE                              01390017
014000     END-IF.                                                      01400017
014100                                                                  01410017
014200     IF RC825-RANDOM-SEL-MAX > RC825-RANDOM-STORE-MAX             01420017
014300     OR RC825-RANDOM-SEL-MAX < RC825-RANDOM-SEL-MIN               01430017
014400     THEN                                                         01440017
014500       SET RC825-INV-MAXIMUM TO TRUE                              01450017
014600     END-IF.                                                      01460017
014700                                                                  01470017
014800     IF RC825-RANDOM-STR-SEL-CNT < RC825-RANDOM-STORE-MIN         01480017
014900     OR RC825-RANDOM-STR-SEL-CNT > RC825-RANDOM-STORE-MAX         01490017
015000     THEN                                                         01500017
015100       SET RC825-INV-COUNT TO TRUE                                01510017
015200     END-IF.                                                      01520017
015300                                                                  01530017
015400******************************************************************01540017
015500* LOOP THROUGH RANDOM NUMBERS.  FOR EACH NUMBER CHOSEN           *01550017
015600*   SET RANDOM INDICATOR TO "Y" FOR MATCHING STORE-INDEX-NUMBER  *01560017
015700******************************************************************01570017
015800                                                                  01580017
015900 2200-PROCESS-RANDOM-FUNCTION.                                    01590017
016000     PERFORM PV-RANDOM-SEL-CNT TIMES                              01600017
016100       PERFORM 2210-GET-RANDOM-VALUE                              01610017
016200     END-PERFORM.                                                 01620017
016300                                                                  01630017
016400******************************************************************01640017
016500* GENERATE UNIQUE RANDOM VALUES.                                 *01650017
016600******************************************************************01660017
016700 2210-GET-RANDOM-VALUE.                                           01670017
016800                                                                  01680017
016900     PERFORM  UNTIL PV-UNIQUE-RANDOM = 'Y'                        01690017
017000* ASSUME THAT THIS WILL BE A RANDOM STORE INDEX                   01700017
017100       MOVE 'Y'  TO PV-UNIQUE-RANDOM                              01710017
017200* GET A RANDOM NUMBER WITHIN THE MINIMUM AND THE MAXIMUM          01720017
017300       COMPUTE PV-RANDOM-VALUE = FUNCTION RANDOM                  01730017
017400                              * (PV-RANDOM-SEL-MAX -              01740017
017500                                 PV-RANDOM-SEL-MIN)               01750017
017600                              + PV-RANDOM-SEL-MIN                 01760017
017700* IS THE RANDOM NUMBER UNIQUE?                                    01770017
017800       IF RC825-STORE-RANDOM-IND(PV-RANDOM-VALUE) = 'Y'           01780017
017900       THEN                                                       01790017
018000         MOVE 'N'  TO PV-UNIQUE-RANDOM                            01800017
018100       END-IF                                                     01810017
018200     END-PERFORM.                                                 01820017
018300                                                                  01830017
018400     MOVE 'Y'  TO RC825-STORE-RANDOM-IND (PV-RANDOM-VALUE).       01840017
018500                                                                  01850017
018600* FOUND 1 MORE UNIQUE RANDOM STORE                                01860017
018700     ADD 1 TO PV-RAND-ORDER.                                      01870017
018800                                                                  01880017
018900* MOVE THE CURRENT RANDOM STORE INDEX TO THE STORE TABLE          01890017
019000     MOVE RC825-STORE-NUMBER (PV-RANDOM-VALUE) TO                 01900017
019100          RC825-RANDOM-STORE-NBR (PV-RAND-ORDER).                 01910017
019200                                                                  01920017
019300* MOVE THE RANDOM STORE NUMBER TO THE RANDOM STORE TABLE          01930017
019400     MOVE 'N'  TO PV-UNIQUE-RANDOM.                               01940017
019500                                                                  01950017
