000100******************************************************************00010028
000200 IDENTIFICATION DIVISION.                                         00020028
000300******************************************************************00030028
000400 PROGRAM-ID.    RCKCS826.                                         00040028
000500 AUTHOR.        CRAIG KEHOE.                                      00050028
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060028
000700 DATE-WRITTEN.  03-27-03.                                         00070028
000800 DATE-COMPILED.                                                   00080028
000900******************************************************************00090028
001000*      THIS PROGRAM RULES ON ELIGIBILITY VIA MQSERIES            *00100028
001001******************************************************************00100163
001002* DATE  10/08/2018                                                00100264
001003*     CHANGE MADE: MAINFRAME REFACTORING - CALL WSV_PRVDR_QUE TO  00100364
001004*                  GET MQ PARMS FOR REFACTORED CODE.              00100464
001005*     MADE BY: JIM ARENDT              WR/IR #: CHG0209972        00100564
001100******************************************************************00110028
001200 DATA DIVISION.                                                   00120028
001300******************************************************************00130037
001400 WORKING-STORAGE SECTION.                                         00140028
001500                                                                  00150028
001600 01  PC-PROGRAM-CONSTANTS.                                        00160028
001700   05  PC-CURRENT-PROGRAM-NAME PIC  X(08) VALUE 'RCKCS826'.       00170032
001800   05  PC-PGM-NAME             PIC  X(08) VALUE 'RCKCS826'.       00180032
001900   05  PC-LOG-QUEUE            PIC  X(04) VALUE 'CSSL'.           00190037
002000   05  PC-MAX-RETRIES          PIC S9(04) VALUE  +3 COMP.         00200032
002100*  05  PC-QMGR-NAME-GET        PIC  X(48) VALUE SPACES.           00210064
002200*      88  PC-PROD-QMGR-GET               VALUE 'QKSP'.           00220064
002300*      88  PC-QA-QMGR-GET                 VALUE 'QKSQ'.           00230064
002400*      88  PC-TEST-QMGR-GET               VALUE 'QKST'.           00240064
002500*  05  PC-QMGR-NAME-PUT        PIC  X(48) VALUE SPACES.           00250064
002600*      88  PC-PROD-QMGR-PUT               VALUE 'ISWMQ122P'.      00260064
002700*      88  PC-QA-QMGR-PUT                 VALUE 'ISWMQ60Q'.       00270064
002800*      88  PC-TEST-QMGR-PUT               VALUE 'ISWMQ80T'.       00280064
002900*  05  PC-QNAME-PUT            PIC  X(48) VALUE                   00290064
003000*                      'MQSI.ITEM.ELIGIBILITY.REQUEST.INQ'.       00300064
003100*  05  PC-QNAME-GET            PIC  X(48) VALUE                   00310064
003200*                      'MH.ITEM.ELIGIBILITY.RESPONSE.Q'.          00320064
003300   05  PC-MQOPEN               PIC  X(08) VALUE 'CSQCOPEN'.       00330064
003400   05  PC-MQPUT                PIC  X(08) VALUE 'CSQCPUT '.       00340064
003500   05  PC-MQGET                PIC  X(08) VALUE 'CSQCGET '.       00350064
003600   05  PC-MQCLOSE              PIC  X(08) VALUE 'CSQCCLOS'.       00360064
003700   05  PC-WAIT-5-SECS          PIC S9(09) VALUE 5000.             00370064
003800   05  PC-WAIT-10-SECS         PIC S9(09) VALUE 10000.            00380064
003900   05  PC-WAIT-15-SECS         PIC S9(09) VALUE 15000.            00390064
004000   05  PC-WAIT-30-SECS         PIC S9(09) VALUE 30000.            00400064
004100   05  PC-MAX-REQUEST-LENGTH   PIC S9(09) BINARY VALUE +4139.     00410064
004200   05  PC-XML-LOC-FOUND        PIC S9(09) VALUE +3 COMP.          00420064
004300   05  PC-ER-MSGLENGTH         PIC S9(03) VALUE +147 COMP.        00430064
004400   05  PC-DATE-SEPARATOR       PIC  X(01) VALUE '/'.              00440064
004500   05  PC-EXPIRY               PIC S9(01) VALUE +5 COMP.          00450064
004600   05  PC-NO-XML-TAGS          PIC S9(01) VALUE +0 COMP.          00460064
004700   05  PC-ONE-XML-TAG          PIC S9(01) VALUE +1 COMP.          00470064
004800   05  PC-READING-THE-2ND-TAG  PIC S9(01) VALUE +2 COMP.          00480064
004900   05  PC-TWO-XML-TAGS         PIC S9(01) VALUE +3 COMP.          00490064
005000   05  PC-READING-THE-3RD-TAG  PIC S9(01) VALUE +4 COMP.          00500064
005100   05  PC-THREE-XML-TAGS       PIC S9(01) VALUE +5 COMP.          00510064
005200   05  PC-STORE-IS-ELIGIBLE    PIC  X(01) VALUE 'Y'.              00520064
005300   05  PC-STORE-NOT-ELIGIBLE   PIC  X(01) VALUE 'N'.              00530064
005400   05  PC-BEGINNING-OF-TAG     PIC  X(01) VALUE '<'.              00540064
005500   05  PC-END-OF-TAG           PIC  X(01) VALUE '>'.              00550064
005600   05  PC-PIPE                 PIC  X(01) VALUE '|'.              00560064
005700                                                                  00570064
005800 01  RC001-WORK-FIELDS.                                           00580064
005900     05  RC001-LOG-QUEUE       PIC  X(04) VALUE 'CSSL'.           00590064
006000     05  RC001-LOG-LINE        PIC  X(80) VALUE SPACES.           00600064
006100     05  RC001-CICS-RESPONSE   PIC S9(08) COMP VALUE ZERO.        00610064
006200     05  RC001-SAVE-SQLCODE    PIC S9(08) COMP VALUE ZERO.        00620064
006300                                                                  00630064
006400 01  RC001-ERROR-MESSAGE-LINES.                                   00640064
006500     05  RC001-LINE-01.                                           00650064
006600         10  FILLER                   PIC X(44) VALUE             00660064
006700             '****** RCKCS826 - ELIGIBILITY ERROR ****** '.       00670064
006800         10  FILLER                   PIC X(03) VALUE SPACES.     00680064
006900         10  FILLER                   PIC X(08) VALUE             00690064
007000                                                'USERID= '.       00700064
007100         10  RC001-USERID             PIC X(07) VALUE SPACES.     00710064
007200         10  FILLER                   PIC X(18) VALUE SPACES.     00720064
007300     05  RC001-LINE-02.                                           00730064
007400         10  FILLER                   PIC X(04) VALUE SPACES.     00740064
007500         10  RC001-DATE               PIC X(10) VALUE SPACES.     00750064
007600         10  FILLER                   PIC X(02) VALUE SPACES.     00760064
007700         10  RC001-TIME               PIC X(08) VALUE SPACES.     00770064
007800         10  FILLER                   PIC X(02) VALUE SPACES.     00780064
007900         10  FILLER                   PIC X(11) VALUE             00790064
008000                                                'PARAGRAPH= '.    00800064
008100         10  RC001-PARAGRAPH          PIC X(30) VALUE SPACES.     00810064
008200         10  FILLER                   PIC X(13) VALUE SPACES.     00820064
008300                                                                  00830064
008400     05  RC001-LINE-03.                                           00840064
008500         10  FILLER                   PIC X(04) VALUE SPACES.     00850064
008600         10  RC001-ACTION             PIC X(76).                  00860064
008700                                                                  00870064
008800 01  PV-PROGRAM-VARIABLES.                                        00880064
008900   05  PV-PARAGRAPH-NAME       PIC  X(30) VALUE SPACES.           00890064
009000   05  PV-HCONN                PIC S9(09) BINARY VALUE +0.        00900064
009100   05  PV-MSGLENGTH            PIC S9(09) BINARY VALUE +0.        00910064
009200   05  PV-PUTQ-HANDLE          PIC S9(09) BINARY VALUE +0.        00920064
009300   05  PV-GETQ-HANDLE          PIC S9(09) BINARY VALUE +0.        00930064
009400   05  PV-OPEN-OPTIONS         PIC S9(09) BINARY VALUE +0.        00940064
009500   05  PV-MSGBUFFER            PIC  X(4139) VALUE SPACES.         00950064
009600   05  PV-REASON-TEXT          PIC  X(30) VALUE SPACES.           00960064
009700   05  PV-MESSAGE-ID           PIC  X(24) VALUE SPACES.           00970064
009800   05  PV-DATA-LENGTH          PIC S9(09) BINARY VALUE +0.        00980064
009900   05  PV-COMPLETION-CODE      PIC S9(09) BINARY.                 00990064
010000   05  PV-REASON               PIC S9(09) BINARY.                 01000064
010100   05  PV-CON-REASON           PIC S9(09) BINARY.                 01010064
010200   05  PV-MQCHECK              PIC  X(08) VALUE 'MQR2C'.          01020064
010300   05  PV-ERROR-MESSAGE        PIC  X(48) VALUE SPACES.           01030064
010400   05  PV-MQ-REASON-TEXT       PIC  X(30) VALUE SPACES.           01040064
010500   05  PV-CICS-REGION          PIC  X(08) VALUE SPACES.           01050064
011100   05  PV-QM-NAME              PIC  X(48) VALUE SPACES.           01110032
011200   05  PV-ACTION               PIC  X(80) VALUE SPACES.           01120032
011300   05  PV-XML-MESSAGE          PIC  X(300) VALUE SPACES.          01130032
011400   05  FILLER REDEFINES PV-XML-MESSAGE.                           01140028
011500       10  PV-XML-MSG-BYTE     OCCURS 300 TIMES                   01150032
011600                               PIC  X(01).                        01160032
011700   05  PV-XML-LENGTH           PIC S9(03) VALUE +0 COMP.          01170032
011800   05  PV-XML-MARKERS          PIC S9(01) VALUE +0 COMP.          01180032
011900   05  PV-XML-POSITION         PIC S9(04) COMP SYNC.              01190032
012000   05  L                       PIC S9(04) COMP SYNC.              01200041
012001   05  PV-GET-QMGR-NAME        PIC X(48).                         01200163
012002   05  PV-GET-QUE-NAME         PIC X(48).                         01200263
012003   05  PV-PUT-QMGR-NAME        PIC X(48).                         01200363
012004   05  PV-PUT-QUE-NAME         PIC X(48).                         01200463
012100                                                                  01210032
012200 01  PV-ABEND-VARIABLES.                                          01220028
012300   05  PV-ABEND-CODE           PIC S9(04) VALUE +0 COMP SYNC.     01230032
012400                                                                  01240028
012500 01  PE-MQ-ABEND-VARIABLES.                                       01250028
012600   05  PE-MQ-QMANAGER          PIC  X(05) VALUE SPACES.           01260032
012700   05  PE-MQ-QMANAGER-REMOTE   PIC  X(30) VALUE SPACES.           01270032
012800   05  PE-MQ-QNAME             PIC  X(48) VALUE SPACES.           01280032
012900   05  PE-MQ-COMPLETION-CODE   PIC  9(04) VALUE ZEROES.           01290038
013000   05  PE-MQ-REASON-CODE       PIC  9(04) VALUE ZEROES.           01300038
013100                                                                  01310028
013200* MQSERIES COMPLETION CODES                                       01320030
013300     COPY ISWS005.                                                01330032
013400                                                                  01340028
013500****************************************************************  01350037
013600*    ELIGIBILITY RULES COPYBOOKS                               *  01360037
013700****************************************************************  01370037
013800     COPY MRRD120.                                                01380032
013900                                                                  01390037
014000     COPY MRRD121.                                                01400032
014100                                                                  01410037
014200****************************************************************  01420028
014300**                                                            **  01430028
014400**     M Q   S E R I E S    W O R K I N G   S T O R A G E     **  01440028
014500**                                                            **  01450028
014600**                  M  Q    C O P Y B O O K S                 **  01460028
014700**                                                            **  01470028
014800****************************************************************  01480028
014900 01  MQM-OBJECT-DESCRIPTOR.                                       01490028
015000     COPY CMQODV.                                                 01500028
015100 01  MQM-MESSAGE-DESCRIPTOR.                                      01510028
015200     COPY CMQMDV.                                                 01520028
015300 01  MQM-PUT-MESSAGE-OPTIONS.                                     01530028
015400     COPY CMQPMOV.                                                01540028
015500 01  MQM-GET-MESSAGE-OPTIONS.                                     01550028
015600     COPY CMQGMOV.                                                01560028
015700 01  MQM-CONSTANTS.                                               01570028
015800     COPY CMQV.                                                   01580028
015900*                                                                 01590028
016400******************************************************************01640029
016500*  LAYOUT FOR THE ABEND MODULE COMMUNICATION AREA.               *01650029
016600******************************************************************01660029
016700     COPY DPWS013.                                                01670032
016800******************************************************************01680029
016900*    STANDARD COMMAREA.                                          *01690029
017000******************************************************************01700029
017100     COPY DPWS020.                                                01710032
017200*    THE FOLLOWING LINE ALWAYS GETS A WARNING THAT IT REDEFINES   01720029
017300*    A LARGER ITEM.                                               01730029
017400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01740029
017500******************************************************************01750029
017600*    INTER-APPLICATION COMMAREA.                                 *01760029
017700******************************************************************01770029
017800         10  INTER-APPL-COMM-AREA PIC X(200).                     01780029
017900******************************************************************01790029
018000*  COMMAREA PASSED IN/OUT FOR ELIGIBILITY RULES.                 *01800037
018100******************************************************************01810029
018200     COPY RCRD826.                                                01820032
018300                                                                  01830029
018400******************************************************************01840038
018500* DB2 SQL COMMUNICATION AREA                                      01850038
018600******************************************************************01860038
018700     EXEC SQL                                                     01870038
018800         INCLUDE SQLCA                                            01880038
018900     END-EXEC.                                                    01890038
019000                                                                  01900038
019100******************************************************************01910038
019200* DB2 DCLGENS                                                     01920038
019300******************************************************************01930038
019400*COMPANY CONTROL TABLE                                            01940038
019500     EXEC SQL                                                     01950038
019600         INCLUDE TCOCNTL                                          01960038
019700     END-EXEC.                                                    01970038
019800                                                                  01980038
019810***************************************************************** 01981063
019820*    DB2 VIEW DECLARATION - WSV_PRVDR_QUE                         01982063
019840***************************************************************** 01984063
019850     EXEC SQL                                                     01985063
019860          INCLUDE WSV00005                                        01986063
019870     END-EXEC.                                                    01987063
019880                                                                  01988054
019900******************************************************************01990029
020000 LINKAGE SECTION.                                                 02000029
020100******************************************************************02010029
020200 01  DFHCOMMAREA.                                                 02020029
020300     05  FILLER              OCCURS 1 TO 100 TIMES                02030037
020400                             DEPENDING ON EIBCALEN.               02040029
020500       10  FILLER                         PIC X.                  02050029
020600******************************************************************02060029
020700 PROCEDURE DIVISION USING DFHCOMMAREA.                            02070029
020800******************************************************************02080029
020900     MOVE 'DFHCOMMAREA                   ' TO PV-PARAGRAPH-NAME.  02090029
021000                                                                  02100028
021010     PERFORM 0500-SELECT-GET-QUEUE-INFO.                          02101063
021110                                                                  02111063
021111     PERFORM 0750-SELECT-PUT-QUEUE-INFO.                          02111163
021112                                                                  02111263
021120     PERFORM 1000-INITIALIZE.                                     02112055
021200                                                                  02120037
021300     PERFORM 2000-OPEN-QUEUES.                                    02130037
021400                                                                  02140037
021500     PERFORM 3000-SET-MSG-BUFFER.                                 02150037
021600                                                                  02160037
021700     PERFORM 4000-MQPUT-DATA.                                     02170037
021800                                                                  02180037
021900     PERFORM 5000-MQGET-DATA.                                     02190037
022000                                                                  02200037
022100     PERFORM 7000-CLOSE-QUEUES.                                   02210037
022200                                                                  02220037
022300     MOVE RC826-COMMAREA TO DFHCOMMAREA.                          02230039
022400     GOBACK.                                                      02240037
022500                                                                  02250037
022600******************************************************************02260037
022700 1000-INITIALIZE.                                                 02270037
022800******************************************************************02280037
022900                                                                  02290037
023000     MOVE DFHCOMMAREA TO RC826-COMMAREA.                          02300037
023100                                                                  02310037
023110*    EXEC CICS                                                    02311063
023120*        ASSIGN APPLID (PV-CICS-REGION)                           02312063
023130*    END-EXEC.                                                    02313063
023140*                                                                 02314063
023150*    EVALUATE PV-CICS-REGION                                      02315063
023151*        WHEN 'CICST1  '                                          02315163
023152*            SET PC-TEST-QMGR-PUT TO TRUE                         02315263
023153*            SET PC-TEST-QMGR-GET TO TRUE                         02315363
023154*        WHEN 'CICSQA  '                                          02315463
023155*        WHEN 'CICSQT  '                                          02315563
023156*            SET PC-QA-QMGR-PUT   TO TRUE                         02315663
023157*            SET PC-QA-QMGR-GET   TO TRUE                         02315763
023158*        WHEN OTHER                                               02315863
023159*            SET PC-PROD-QMGR-PUT TO TRUE                         02315963
023160*            SET PC-PROD-QMGR-GET TO TRUE                         02316063
023161*    END-EVALUATE.                                                02316163
023170                                                                  02317051
023600*INITIALIZE THE RETURN COMMAREA TO "NOT AVAILABLE"                02360037
023700     SET RC826-RULES-NOT-AVAIL TO TRUE.                           02370028
023800                                                                  02380028
023810***************************************************************** 02381063
023820 0500-SELECT-GET-QUEUE-INFO.                                      02382063
023830***************************************************************** 02383063
023850*SELECT  QUEUE MANAGER AND INPUT QUEUE NAME                       02385063
023860                                                                  02386063
023870       INITIALIZE DCLWSV00005.                                    02387063
023880       MOVE 'LEGCYINBDQ'  TO WSV00005-APPL-FUNC-DESC.             02388063
023890       MOVE 'RCSTORRESP'  TO WSV00005-INTGRTN-TYP-CDE.            02389063
023891                                                                  02389163
023892       EXEC SQL                                                   02389263
023893           SELECT  LCL_QUE_MGR                                    02389363
023896                  ,QUE_NM                                         02389663
023897             INTO :WSV00005-LCL-QUE-MGR                           02389763
023900                 ,:WSV00005-QUE-NM                                02390063
023901             FROM WSV_PRVDR_QUE                                   02390163
023902            WHERE APPL_FUNC_DESC  = :WSV00005-APPL-FUNC-DESC      02390263
023903              AND INTGRTN_TYP_CDE = :WSV00005-INTGRTN-TYP-CDE     02390363
023904       END-EXEC.                                                  02390463
023914                                                                  02391463
023915       EVALUATE TRUE                                              02391563
023916           WHEN SQLCODE = +0                                      02391663
023917               INITIALIZE PV-GET-QMGR-NAME                        02391763
023918               MOVE WSV00005-LCL-QUE-MGR-TEXT TO PV-GET-QMGR-NAME 02391863
023920               INITIALIZE PV-GET-QUE-NAME                         02392063
023921               MOVE WSV00005-QUE-NM-TEXT      TO PV-GET-QUE-NAME  02392163
023922                                                                  02392263
023923           WHEN SQLCODE = +100                                    02392363
023924           WHEN SQLWARN0 NOT = SPACES                             02392463
023925           WHEN SQLCODE  NOT = ZERO                               02392563
023926              MOVE '0500-SELECT-GET-QUEUE-INFO'                   02392663
023927                               TO DP013-PARAGRAPH                 02392763
023928              MOVE 'SELECT QUEUE NAME FROM WSV-PRVDR-QUE'         02392863
023929                               TO DP013-MESSAGE-TEXT (1)          02392963
023930              MOVE SQLCA       TO DP013-SQLCA                     02393063
023931              SET DP013-DB2-ABEND                                 02393163
023932                               TO TRUE                            02393263
023933              PERFORM DP013-0000-PROCESS-ABEND                    02393363
023934       END-EVALUATE.                                              02393463
023935                                                                  02393563
023936***************************************************************** 02393663
023937 0750-SELECT-PUT-QUEUE-INFO.                                      02393763
023938***************************************************************** 02393863
023939*SELECT  QUEUE MANAGER AND INPUT QUEUE NAME                       02393963
023940                                                                  02394063
023941       INITIALIZE DCLWSV00005.                                    02394163
023942       MOVE 'LEGCYOTBDQ'      TO WSV00005-APPL-FUNC-DESC.         02394263
023943       MOVE 'RCSTRREQ'        TO WSV00005-INTGRTN-TYP-CDE.        02394363
023944                                                                  02394463
023945       EXEC SQL                                                   02394563
023946           SELECT  RMT_QUE_MGR                                    02394663
023948                  ,QUE_NM                                         02394863
023949             INTO :WSV00005-RMT-QUE-MGR                           02394963
023951                 ,:WSV00005-QUE-NM                                02395163
023955             FROM WSV_PRVDR_QUE                                   02395563
023956            WHERE APPL_FUNC_DESC  = :WSV00005-APPL-FUNC-DESC      02395663
023957              AND INTGRTN_TYP_CDE = :WSV00005-INTGRTN-TYP-CDE     02395763
023958       END-EXEC.                                                  02395863
023959                                                                  02395963
023960       EVALUATE TRUE                                              02396063
023961           WHEN SQLCODE = +0                                      02396163
023962               INITIALIZE PV-PUT-QMGR-NAME                        02396263
023963               MOVE WSV00005-RMT-QUE-MGR-TEXT TO PV-PUT-QMGR-NAME 02396363
023964               INITIALIZE PV-PUT-QUE-NAME                         02396463
023965               MOVE WSV00005-QUE-NM-TEXT      TO PV-PUT-QUE-NAME  02396563
023966                                                                  02396663
023967           WHEN SQLCODE = +100                                    02396763
023968           WHEN SQLWARN0 NOT = SPACES                             02396863
023969           WHEN SQLCODE  NOT = ZERO                               02396963
023970              MOVE '0750-SELECT-PUT-QUEUE-INFO'                   02397063
023971                               TO DP013-PARAGRAPH                 02397163
023972              MOVE 'SELECT QUEUE NAME FROM WSV-PRVDR-QUE'         02397263
023973                               TO DP013-MESSAGE-TEXT (1)          02397363
023974              MOVE SQLCA       TO DP013-SQLCA                     02397463
023975              SET DP013-DB2-ABEND                                 02397563
023976                               TO TRUE                            02397663
023977              PERFORM DP013-0000-PROCESS-ABEND                    02397763
023978       END-EVALUATE.                                              02397863
023979                                                                  02397957
023980******************************************************************02398037
024000 2000-OPEN-QUEUES.                                                02400037
024100******************************************************************02410037
024200                                                                  02420037
024300*OPEN A QUEUE FOR MQPUT                                           02430037
024400     COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT +                      02440028
024500                               MQOO-FAIL-IF-QUIESCING.            02450037
024600                                                                  02460028
024610     MOVE PV-PUT-QUE-NAME   TO MQOD-OBJECTNAME.                   02461063
024710*    MOVE PC-QNAME-PUT      TO MQOD-OBJECTNAME.                   02471063
024800     MOVE PV-PUT-QMGR-NAME  TO MQOD-OBJECTQMGRNAME.               02480063
024810*    MOVE PC-QMGR-NAME-PUT  TO MQOD-OBJECTQMGRNAME.               02481063
024900                                                                  02490028
025000     CALL PC-MQOPEN      USING PV-HCONN,                          02500037
025100                               MQM-OBJECT-DESCRIPTOR,             02510037
025200                               PV-OPEN-OPTIONS,                   02520037
025300                               PV-PUTQ-HANDLE,                    02530037
025400                               PV-COMPLETION-CODE,                02540037
025500                               PV-REASON.                         02550037
025600                                                                  02560028
025700     IF PV-COMPLETION-CODE = MQCC-OK                              02570028
025800         CONTINUE                                                 02580038
025900     ELSE                                                         02590028
026000         STRING 'MQOPEN FAILED - ' PV-PUT-QUE-NAME                02600063
026010*        STRING 'MQOPEN FAILED - ' PC-QNAME-PUT                   02601063
026100                 DELIMITED BY SIZE INTO PV-ACTION                 02610028
026200         PERFORM 8000-LOG-MESSAGE                                 02620037
026300     END-IF.                                                      02630028
026400                                                                  02640034
026500*OPEN A QUEUE FOR MQGET                                           02650037
026600     COMPUTE PV-OPEN-OPTIONS = MQOO-INPUT-SHARED +                02660028
026700                               MQOO-FAIL-IF-QUIESCING.            02670037
026800                                                                  02680028
026900     MOVE PV-GET-QUE-NAME   TO MQOD-OBJECTNAME.                   02690063
026910*    MOVE PC-QNAME-GET      TO MQOD-OBJECTNAME.                   02691063
027000     MOVE PV-GET-QMGR-NAME  TO MQOD-OBJECTQMGRNAME.               02700063
027010*    MOVE PC-QMGR-NAME-GET  TO MQOD-OBJECTQMGRNAME.               02701063
027100                                                                  02710028
027200     CALL PC-MQOPEN      USING PV-HCONN,                          02720037
027300                               MQM-OBJECT-DESCRIPTOR,             02730037
027400                               PV-OPEN-OPTIONS,                   02740037
027500                               PV-GETQ-HANDLE,                    02750037
027600                               PV-COMPLETION-CODE,                02760037
027700                               PV-REASON.                         02770037
027800                                                                  02780028
027900     IF PV-COMPLETION-CODE = MQCC-OK                              02790028
028000         CONTINUE                                                 02800038
028100     ELSE                                                         02810028
028200         STRING 'MQOPEN FAILED - ' PV-GET-QUE-NAME                02820063
028210*        STRING 'MQOPEN FAILED - ' PC-QNAME-GET                   02821063
028300                 DELIMITED BY SIZE INTO PV-ACTION                 02830028
028400         PERFORM 8000-LOG-MESSAGE                                 02840037
028500     END-IF.                                                      02850028
028600                                                                  02860028
028700******************************************************************02870037
028800 3000-SET-MSG-BUFFER.                                             02880037
028900******************************************************************02890037
029000                                                                  02900037
029100*SET THE UPC                                                      02910037
029200     MOVE RC826-INTERNAL-UPC-ID TO MR120-INTERNAL-UPC-ID.         02920030
029300                                                                  02930037
029400*SET THE DATE                                                     02940037
029500     STRING RC826-SHIP-MM,                                        02950030
029600            PC-DATE-SEPARATOR,                                    02960032
029700            RC826-SHIP-DD,                                        02970030
029800            PC-DATE-SEPARATOR,                                    02980032
029900            RC826-SHIP-CC,                                        02990030
030000            RC826-SHIP-YY                                         03000030
030100            DELIMITED BY SIZE                                     03010030
030200            INTO MR120-SHIP-DATE.                                 03020030
030300                                                                  03030037
030400*SET UP THE STORE LIST; ONLY ONE STORE WILL BE PUT ON THE LIST    03040037
030500     MOVE SPACES TO MR120-STORE-LIST.                             03050028
030600     MOVE SPACES TO PV-MSGBUFFER.                                 03060028
030700     STRING RC826-STORE-NBR,                                      03070030
030800            MR121-TRAILER                                         03080030
030900            DELIMITED BY SIZE                                     03090030
031000            INTO MR120-STORE-LIST.                                03100028
031100                                                                  03110037
031200*SET THE MESSAGE BUFFER                                           03120037
031300     MOVE MR120-ELIGIBILITY-INPUT-LAYOUT TO PV-MSGBUFFER.         03130028
031400                                                                  03140028
031500******************************************************************03150037
031600 4000-MQPUT-DATA.                                                 03160037
031700******************************************************************03170037
031800                                                                  03180037
031900     MOVE PC-ER-MSGLENGTH    TO PV-MSGLENGTH.                     03190032
032000     MOVE PV-PUT-QMGR-NAME   TO MQOD-OBJECTQMGRNAME.              03200063
032010*    MOVE PC-QMGR-NAME-PUT   TO MQOD-OBJECTQMGRNAME.              03201063
032100     MOVE PV-PUT-QUE-NAME    TO MQOD-OBJECTNAME.                  03210063
032110*    MOVE PC-QNAME-PUT       TO MQOD-OBJECTNAME.                  03211063
032200     MOVE PV-GET-QUE-NAME    TO MQMD-REPLYTOQ.                    03220063
032201*    MOVE PC-QNAME-GET       TO MQMD-REPLYTOQ.                    03220163
032300     MOVE PV-GET-QMGR-NAME   TO MQMD-REPLYTOQMGR.                 03230063
032310*    MOVE PC-QMGR-NAME-GET   TO MQMD-REPLYTOQMGR.                 03231063
032400     MOVE MQMI-NONE          TO MQMD-MSGID.                       03240028
032500     MOVE MQCI-NONE          TO MQMD-CORRELID.                    03250028
032600     MOVE MQPMO-NO-SYNCPOINT TO MQPMO-OPTIONS.                    03260028
032700     MOVE MQFMT-STRING       TO MQMD-FORMAT.                      03270028
032800*JPL MOVE PC-EXPIRY          TO MQMD-EXPIRY.                      03280038
032900     MOVE 300                TO MQMD-EXPIRY.                      03290039
033000                                                                  03300028
033100     CALL PC-MQPUT USING PV-HCONN,                                03310028
033200                         PV-PUTQ-HANDLE,                          03320028
033300                         MQM-MESSAGE-DESCRIPTOR,                  03330028
033400                         MQM-PUT-MESSAGE-OPTIONS,                 03340028
033500                         PV-MSGLENGTH,                            03350028
033600                         PV-MSGBUFFER,                            03360028
033700                         PV-COMPLETION-CODE,                      03370028
033800                         PV-REASON.                               03380028
033900                                                                  03390037
034000*IF PUT FAILED THEN ERROR MESSAGE                                 03400030
034100     IF  PV-COMPLETION-CODE = MQCC-OK                             03410028
034200         MOVE MQMD-MSGID TO PV-MESSAGE-ID                         03420039
034300     ELSE                                                         03430028
034400         STRING 'MQPUT FAILED - ' PV-PUT-QUE-NAME                 03440063
034410*        STRING 'MQPUT FAILED - ' PC-QNAME-PUT                    03441063
034500                 DELIMITED BY SIZE INTO PV-ACTION                 03450028
034600         PERFORM 8000-LOG-MESSAGE                                 03460037
034700     END-IF.                                                      03470028
034800                                                                  03480028
034900******************************************************************03490037
035000 5000-MQGET-DATA.                                                 03500037
035100******************************************************************03510037
035200                                                                  03520037
035300     MOVE PV-MESSAGE-ID         TO MQMD-CORRELID.                 03530039
035400                                                                  03540039
035500     MOVE MQMI-NONE             TO MQMD-MSGID.                    03550039
035600     COMPUTE MQGMO-WAITINTERVAL  = PC-WAIT-10-SECS.               03560044
035700     COMPUTE MQGMO-OPTIONS       = MQGMO-WAIT                     03570037
035800                                 + MQGMO-CONVERT                  03580037
035900                                 + MQGMO-FAIL-IF-QUIESCING.       03590037
036000     MOVE PV-GET-QMGR-NAME      TO MQOD-OBJECTQMGRNAME.           03600063
036010*    MOVE PC-QMGR-NAME-GET      TO MQOD-OBJECTQMGRNAME.           03601063
036100     MOVE PV-GET-QUE-NAME       TO MQOD-OBJECTNAME.               03610063
036110*    MOVE PC-QNAME-GET          TO MQOD-OBJECTNAME.               03611063
036200     MOVE PC-MAX-REQUEST-LENGTH TO PV-MSGLENGTH.                  03620028
036300                                                                  03630028
036400     CALL PC-MQGET           USING PV-HCONN,                      03640037
036500                                   PV-GETQ-HANDLE,                03650037
036600                                   MQM-MESSAGE-DESCRIPTOR,        03660037
036700                                   MQM-GET-MESSAGE-OPTIONS,       03670037
036800                                   PV-MSGLENGTH,                  03680037
036900                                   PV-MSGBUFFER,                  03690037
037000                                   PV-DATA-LENGTH,                03700037
037100                                   PV-COMPLETION-CODE,            03710037
037200                                   PV-REASON.                     03720037
037300                                                                  03730028
037400     IF PV-COMPLETION-CODE = MQCC-OK                              03740028
037500         PERFORM 6000-PROCESS-REPLY                               03750038
037600     ELSE                                                         03760028
037700     IF PV-COMPLETION-CODE = MQCC-FAILED                          03770038
037800***    AND PV-REASON = MQRC-NO-MSG-AVAILABLE                      03780043
037900         STRING 'MQGET FAILED - MSG NOT AVAIL - ' PV-GET-QUE-NAME 03790063
037910*        STRING 'MQGET FAILED - MSG NOT AVAIL - ' PC-QNAME-GET    03791063
038000                 DELIMITED BY SIZE INTO PV-ACTION                 03800038
038100         PERFORM 8000-LOG-MESSAGE                                 03810038
038200***  ELSE                                                         03820043
038300***      STRING 'MQGET FAILED - ' PV-GET-QUE-NAME                 03830063
038310***      STRING 'MQGET FAILED - ' PC-QNAME-GET                    03831063
038400***              DELIMITED BY SIZE INTO PV-ACTION                 03840043
038500***      PERFORM 9001-MQSERIES-ERROR                              03850043
038600     END-IF.                                                      03860028
038700                                                                  03870028
038800******************************************************************03880037
038900 6000-PROCESS-REPLY.                                              03890038
039000******************************************************************03900037
039100                                                                  03910037
039200* EXTRACT THE STORE ELIGIBILTY FROM THE XML                       03920037
039300     MOVE LENGTH OF PV-MSGBUFFER TO PV-XML-LENGTH.                03930028
039400     MOVE           PV-MSGBUFFER TO PV-XML-MESSAGE.               03940038
039500                                                                  03950041
039600     PERFORM                                                      03960041
039700       VARYING PV-XML-POSITION FROM 1 BY 1                        03970041
039800         UNTIL PV-XML-MSG-BYTE (PV-XML-POSITION) = PC-PIPE        03980042
039900            OR PV-XML-POSITION = PV-XML-LENGTH                    03990042
040000                                                                  04000041
040100     END-PERFORM.                                                 04010042
040200                                                                  04020042
040300     IF PV-XML-POSITION = PV-XML-LENGTH                           04030042
040400         STRING 'INVALID MSG - ' PV-MSGBUFFER                     04040042
040500                 DELIMITED BY SIZE INTO PV-ACTION                 04050042
040600***      PERFORM 9001-MQSERIES-ERROR                              04060043
040700         PERFORM 8000-LOG-MESSAGE                                 04070043
040800     ELSE                                                         04080042
040900         COMPUTE L = PV-XML-POSITION - 1                          04090042
041000         IF PV-XML-MSG-BYTE (L) = PC-STORE-IS-ELIGIBLE            04100042
041100             SET RC826-STR-ELIGIBLE     TO TRUE                   04110042
041200         ELSE                                                     04120042
041300         IF PV-XML-MSG-BYTE (L) = PC-STORE-NOT-ELIGIBLE           04130042
041400             SET RC826-STR-NOT-ELIGIBLE TO TRUE                   04140042
041500         ELSE                                                     04150042
041600             SET RC826-RULES-NOT-AVAIL  TO TRUE                   04160042
041700         END-IF                                                   04170042
041800         END-IF                                                   04180042
041900     END-IF.                                                      04190042
042000                                                                  04200042
042100*JPL - OUT - 10/15/03                                             04210041
042200*    LOOP UNTIL THE END OF THE XML HEADER TAG UNTIL THE           04220035
042300*    ELIGIBITY IS FOUND; THEN EXTRACT THE ELIGIBILITY             04230035
042400*    PERFORM                                                      04240041
042500*      VARYING PV-XML-POSITION FROM 1 BY 1                        04250041
042600*        UNTIL PV-XML-POSITION = PV-XML-LENGTH                    04260041
042700*                                                                 04270041
042800*    TAKE NOTE WITH PV-XML-MARKERS OF THE CURRENT LOCATION        04280035
042900*    IN THE XML                                                   04290035
043000*      IF PV-XML-MSG-BYTE(PV-XML-POSITION) = PC-END-OF-TAG        04300041
043100*        AND PV-XML-MARKERS = PC-NO-XML-TAGS                      04310041
043200*          ADD 1 TO PV-XML-MARKERS                                04320041
043300*      END-IF                                                     04330041
043400*                                                                 04340041
043500*      IF PV-XML-MSG-BYTE(PV-XML-POSITION) = PC-BEGINNING-OF-TAG  04350041
043600*        AND PV-XML-MARKERS = PC-ONE-XML-TAG                      04360041
043700*          ADD 1 TO PV-XML-MARKERS                                04370041
043800*      END-IF                                                     04380041
043900*                                                                 04390041
044000*      IF PV-XML-MSG-BYTE(PV-XML-POSITION) = PC-END-OF-TAG        04400041
044100*        AND PV-XML-MARKERS = PC-READING-THE-2ND-TAG              04410041
044200*          ADD 1 TO PV-XML-MARKERS                                04420041
044300*      END-IF                                                     04430041
044400*                                                                 04440041
044500*      IF PV-XML-MSG-BYTE(PV-XML-POSITION) = PC-BEGINNING-OF-TAG  04450041
044600*        AND PV-XML-MARKERS = PC-TWO-XML-TAGS                     04460041
044700*          ADD 1 TO PV-XML-MARKERS                                04470041
044800*      END-IF                                                     04480041
044900*                                                                 04490041
045000*      IF PV-XML-MSG-BYTE(PV-XML-POSITION) = PC-END-OF-TAG        04500041
045100*        AND PV-XML-MARKERS = PC-READING-THE-3RD-TAG              04510041
045200*          ADD 1 TO PV-XML-MARKERS                                04520041
045300*      END-IF                                                     04530041
045400*                                                                 04540041
045500*      IF PV-XML-MSG-BYTE(PV-XML-POSITION) = PC-BEGINNING-OF-TAG  04550041
045600*        AND PV-XML-MARKERS = PC-THREE-XML-TAGS                   04560041
045700*          ADD 1 TO PV-XML-MARKERS                                04570041
045800*      END-IF                                                     04580041
045900*                                                                 04590041
046000*EXTRACT THE ELIGIBILITY FROM THE XML                             04600037
046100*      IF PV-XML-MARKERS = PC-THREE-XML-TAGS                      04610041
046200*          IF PV-XML-MSG-BYTE(PV-XML-POSITION) =                  04620041
046300*                                        PC-STORE-IS-ELIGIBLE     04630041
046400*              SET RC826-STR-ELIGIBLE     TO TRUE                 04640041
046500*          END-IF                                                 04650041
046600*          IF PV-XML-MSG-BYTE(PV-XML-POSITION) =                  04660041
046700*                                        PC-STORE-NOT-ELIGIBLE    04670041
046800*              SET RC826-STR-NOT-ELIGIBLE TO TRUE                 04680041
046900*          END-IF                                                 04690041
047000*      END-IF                                                     04700041
047100*                                                                 04710041
047200*    END-PERFORM.                                                 04720041
047300*JPL - OUT - 10/15/03                                             04730041
047400                                                                  04740028
047500******************************************************************04750037
047600 7000-CLOSE-QUEUES.                                               04760037
047700******************************************************************04770037
047800                                                                  04780037
047900*CLOSE THE PUT QUEUE                                              04790037
048000     CALL PC-MQCLOSE   USING PV-HCONN,                            04800037
048100                             PV-PUTQ-HANDLE,                      04810037
048200                             MQCO-NONE,                           04820037
048300                             PV-COMPLETION-CODE,                  04830037
048400                             PV-REASON.                           04840037
048500                                                                  04850028
048600     IF PV-COMPLETION-CODE = MQCC-OK                              04860028
048700         CONTINUE                                                 04870038
048800     ELSE                                                         04880028
048900         STRING 'MQCLOSE FAILED - ' PV-PUT-QUE-NAME               04890063
048910*        STRING 'MQCLOSE FAILED - ' PC-QNAME-PUT                  04891063
049000                 DELIMITED BY SIZE INTO PV-ACTION                 04900028
049100***      PERFORM 9001-MQSERIES-ERROR                              04910043
049200         PERFORM 8000-LOG-MESSAGE                                 04920043
049300     END-IF.                                                      04930028
049400                                                                  04940028
049500*CLOSE THE GET QUEUE                                              04950037
049600     CALL PC-MQCLOSE   USING PV-HCONN,                            04960037
049700                             PV-GETQ-HANDLE,                      04970037
049800                             MQCO-NONE,                           04980037
049900                             PV-COMPLETION-CODE,                  04990037
050000                             PV-REASON.                           05000037
050100                                                                  05010028
050200     IF PV-COMPLETION-CODE = MQCC-OK                              05020028
050300         CONTINUE                                                 05030038
050400     ELSE                                                         05040028
050500         STRING 'MQCLOSE FAILED - ' PV-GET-QUE-NAME               05050063
050510*        STRING 'MQCLOSE FAILED - ' PC-QNAME-GET                  05051063
050600                 DELIMITED BY SIZE INTO PV-ACTION                 05060028
050700***      PERFORM 9001-MQSERIES-ERROR                              05070043
050800         PERFORM 8000-LOG-MESSAGE                                 05080043
050900     END-IF.                                                      05090028
051000                                                                  05100028
051100******************************************************************05110037
051200*                                                                *05120037
051300*        W R I T E   A B E N D S   T O   C I C S   L O G         *05130037
051400*                                                                *05140037
051500******************************************************************05150037
051600 8000-LOG-MESSAGE.                                                05160037
051700     MOVE '8000-LOG-MESSAGE              ' TO PV-PARAGRAPH-NAME.  05170037
051800                                                                  05180037
051900     EXEC CICS                                                    05190037
052000         ASSIGN                                                   05200037
052100         USERID (RC001-USERID)                                    05210037
052200     END-EXEC.                                                    05220037
052300                                                                  05230037
052400     EXEC SQL                                                     05240037
052500         SELECT CURRENT_DATE                                      05250037
052600              , CURRENT_TIME                                      05260037
052700         INTO  :RC001-DATE                                        05270037
052800             , :RC001-TIME                                        05280037
052900         FROM TCOCNTL                                             05290037
053000     END-EXEC.                                                    05300037
053100                                                                  05310037
053200*GET THE QUEUE.                                                   05320037
053300     EXEC CICS                                                    05330037
053400         ENQ                                                      05340037
053500         RESOURCE (RC001-LOG-QUEUE)                               05350037
053600     END-EXEC.                                                    05360037
053700                                                                  05370037
053800*WRITE RC001-LINE-01.                                             05380037
053900     MOVE RC001-LINE-01            TO RC001-LOG-LINE.             05390037
054000     PERFORM RC001-WRITE-CSSL.                                    05400037
054100                                                                  05410037
054200*WRITE RC001-LINE-02.                                             05420037
054300     MOVE PV-PARAGRAPH-NAME        TO RC001-PARAGRAPH.            05430038
054400     MOVE RC001-LINE-02            TO RC001-LOG-LINE.             05440037
054500     PERFORM RC001-WRITE-CSSL.                                    05450037
054600                                                                  05460038
054700*WRITE RC001-LINE-03.                                             05470038
054800     MOVE PV-ACTION                TO RC001-ACTION.               05480038
054900     MOVE RC001-LINE-03            TO RC001-LOG-LINE.             05490038
055000     PERFORM RC001-WRITE-CSSL.                                    05500038
055100                                                                  05510037
055200*RELEASE THE QUEUE.                                               05520037
055300     EXEC CICS                                                    05530037
055400         DEQ                                                      05540037
055500         RESOURCE (RC001-LOG-QUEUE)                               05550037
055600     END-EXEC.                                                    05560037
055700                                                                  05570037
055800*RETURN TO CALLING PROGRAM                                        05580037
055900     MOVE RC826-COMMAREA TO DFHCOMMAREA.                          05590039
056000     GOBACK.                                                      05600037
056100                                                                  05610037
056200******************************************************************05620037
056300 RC001-WRITE-CSSL.                                                05630037
056400                                                                  05640037
056500     EXEC CICS                                                    05650037
056600         WRITEQ TD                                                05660037
056700             QUEUE (RC001-LOG-QUEUE)                              05670037
056800             FROM  (RC001-LOG-LINE)                               05680037
056900             RESP  (RC001-CICS-RESPONSE)                          05690037
057000     END-EXEC.                                                    05700037
057100                                                                  05710037
057200     IF RC001-CICS-RESPONSE = DFHRESP(NORMAL)                     05720037
057300         CONTINUE                                                 05730037
057400     ELSE                                                         05740037
057500         EXEC CICS                                                05750037
057600              ABEND                                               05760037
057700              ABCODE (EIBTRMID)                                   05770037
057800         END-EXEC                                                 05780037
057900     END-IF.                                                      05790037
058000                                                                  05800037
058100******************************************************************05810037
058200* MQSERIES ABEND.                                                 05820037
058300     COPY ISPD005.                                                05830037
058400******************************************************************05840037
058800                                                                  05880061
058801******************************************************************05880163
058802* DB2 ABEND.                                                      05880263
058900     COPY DPPD013.                                                05890063
058910******************************************************************05891063
059000                                                                  05900061
