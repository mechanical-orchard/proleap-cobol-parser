000100******************************************************************00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000600******************************************************************00060004
000700 PROGRAM-ID.    CNKUT800.                                         00070011
000800 AUTHOR.        TKMA497.                                          00080007
000900 INSTALLATION.  KOHLS.                                            00090004
001000 DATE-WRITTEN   JULY, 2011.                                       00100007
001100 DATE-COMPILED.                                                   00110004
001200******************************************************************00120004
001300*  NEW DC - TKRPRPM EXTRACT                                       00130099
001310*  THIS PROGRAM EXTRACTS DATA FROM THE PROCESSING PARAMETER       00131099
001400*  TABLE AND IF THE NEW LOC_ID VALUE IN THE CONTROL CARD IS       00140010
001500*  DIFFERENT FROM THE VALUE USED IN THE MAIN CURSOR, REPLACES     00150008
001600*  THE VALUE USED IN THE MAIN CURSOR WITH THE NEW VALUE IN THE    00160009
001700*  CONTROL CARD BEFORE WRITING THE OUTPUT FILE.                   00170009
006600******************************************************************00660004
007000 ENVIRONMENT DIVISION.                                            00700004
007100******************************************************************00710004
007200 CONFIGURATION SECTION.                                           00720004
007300*                                                                 00730004
007400 SOURCE-COMPUTER.        IBM-3090.                                00740004
007500 OBJECT-COMPUTER.        IBM-3090.                                00750004
007600*                                                                 00760004
007700 INPUT-OUTPUT SECTION.                                            00770004
007800*                                                                 00780004
007900 FILE-CONTROL.                                                    00790004
008000*                                                                 00800099
008400     SELECT PARM-FILE-OUT                                         00840008
008500         ASSIGN TO OUT01.                                         00850004
008700*                                                                 00870004
008800******************************************************************00880004
008900 DATA DIVISION.                                                   00890004
009000******************************************************************00900004
009100 FILE SECTION.                                                    00910004
009200*                                                                 00920004
010000*                                                                 01000004
010100 FD  PARM-FILE-OUT                                                01010013
010200     RECORDING MODE IS F                                          01020004
010300     BLOCK CONTAINS 0 RECORDS                                     01030004
010400     LABEL RECORDS ARE STANDARD.                                  01040004
010500*                                                                 01050004
010600 01  PARM-RECORD-OUT                PIC  X(129).                  01060078
010800*                                                                 01080004
010900 WORKING-STORAGE SECTION.                                         01090004
010901 01  WS-TKRPRPM.                                                  01090199
010902     05  WS-KRPRPM-DATA.                                          01090299
010903         10  WS-KRPRPM-LOC-ID            PIC  S9(4) COMP.         01090399
010904         10  WS-KRPRPM-INTFC-SYS-CDE     PIC   X(3).              01090499
010905         10  WS-KRPRPM-SYS-PRC-FUNC-CDE  PIC   X(6).              01090599
010906         10  WS-KRPRPM-FUNC-PRC-STAT-CDE PIC   X(2).              01090699
010907         10  WS-FUNC-PRC-STAT-CDE-NULL   PIC  S9(04) COMP.        01090799
010908         10  WS-KRPRPM-FUNC-BEG-TMST     PIC   X(26).             01090899
010909         10  WS-FUNC-BEG-TMST-NULL       PIC  S9(04) COMP.        01090999
010910         10  WS-KRPRPM-FUNC-END-TMST     PIC   X(26).             01091099
010911         10  WS-FUNC-END-TMST-NULL       PIC  S9(04) COMP.        01091199
010912         10  WS-KRPRPM-FUNC-QTY          PIC  S9(9) COMP.         01091299
010913         10  WS-FUNC-QTY-NULL            PIC  S9(04) COMP.        01091399
010914         10  WS-KRPRPM-FUNC-PCT          PIC  S9(1)V9(4) COMP-3.  01091499
010915         10  WS-FUNC-PCT-NULL            PIC  S9(04) COMP.        01091599
010916         10  WS-KRPRPM-FUNC-TXT          PIC   X(25).             01091699
010917         10  WS-FUNC-TXT-NULL            PIC  S9(04) COMP.        01091799
010918         10  WS-KRPRPM-FUNC-WD-QTY       PIC  S9(5)V9(4) COMP-3.  01091899
010919         10  WS-KRPRPM-FUNC-DPTH-QTY     PIC  S9(5)V9(4) COMP-3.  01091999
010920         10  WS-KRPRPM-FUNC-HT-QTY       PIC  S9(5)V9(4) COMP-3.  01092099
010921         10  WS-KRPRPM-FUNC-WT-QTY       PIC  S9(5)V9(4) COMP-3.  01092199
010922                                                                  01092299
010923*** NULL INDICATORS                                               01092399
010924*                                                                 01092499
010925 01  DN-DB2-NULL-INDICATORS.                                      01092599
010926     05  DN-FUNC-PRC-STAT-CDE      PIC S9(04) COMP VALUE ZERO.    01092699
010927     05  DN-FUNC-BEG-TMST          PIC S9(04) COMP VALUE ZERO.    01092799
010928     05  DN-FUNC-END-TMST          PIC S9(04) COMP VALUE ZERO.    01092899
010929     05  DN-FUNC-QTY               PIC S9(04) COMP VALUE ZERO.    01092999
010930     05  DN-FUNC-PCT               PIC S9(04) COMP VALUE ZERO.    01093099
010940     05  DN-FUNC-TXT               PIC S9(04) COMP VALUE ZERO.    01094099
011000*                                                                 01100004
011100 01  PC-PROGRAM-CONSTANTS.                                        01110004
011200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)    VALUE            01120019
011300         'CNKUT800'.                                              01130011
011400                                                                  01140004
011500 01  DK-DB2-KEYS.                                                 01150099
011600     05  DK-LOC-ID                  PIC S9(04)  VALUE ZERO        01160099
011700                                                   COMP.          01170099
012600*                                                                 01260004
012700 01  CC-CONTROL-CARD.                                             01270004
012800     05  CC-LOC-ID-CURR1            PIC  9(04).                   01280011
012810     05  CC-LOC-ID-CURR1-X REDEFINES CC-LOC-ID-CURR1              01281099
012820                                    PIC  X(04).                   01282099
012900     05  FILLER                     PIC  X.                       01290011
013000     05  CC-LOC-ID-NEW1             PIC  9(04).                   01300011
013010     05  CC-LOC-ID-NEW1-X REDEFINES CC-LOC-ID-NEW1                01301088
013020                                    PIC  X(04).                   01302088
013100     05  FILLER                     PIC  X.                       01310011
013200     05  CC-LOC-ID-CURR2            PIC  9(04).                   01320011
013210     05  CC-LOC-ID-CURR2-X REDEFINES CC-LOC-ID-CURR2              01321088
013220                                    PIC  X(04).                   01322088
013300     05  FILLER                     PIC  X.                       01330011
013400     05  CC-LOC-ID-NEW2             PIC  9(04).                   01340011
013410     05  CC-LOC-ID-NEW2-X REDEFINES CC-LOC-ID-NEW2                01341088
013420                                    PIC  X(04).                   01342088
013500     05  FILLER                     PIC  X.                       01350011
013600     05  CC-LOC-ID-CURR3            PIC  9(04).                   01360011
013610     05  CC-LOC-ID-CURR3-X REDEFINES CC-LOC-ID-CURR3              01361088
013620                                    PIC  X(04).                   01362088
013700     05  FILLER                     PIC  X.                       01370011
013800     05  CC-LOC-ID-NEW3             PIC  9(04).                   01380011
013810     05  CC-LOC-ID-NEW3-X REDEFINES CC-LOC-ID-NEW3                01381088
013820                                    PIC  X(04).                   01382088
013900     05  FILLER                     PIC  X.                       01390011
014000     05  CC-LOC-ID-CURR4            PIC  9(04).                   01400011
014010     05  CC-LOC-ID-CURR4-X REDEFINES CC-LOC-ID-CURR4              01401088
014020                                    PIC  X(04).                   01402088
014100     05  FILLER                     PIC  X.                       01410011
014200     05  CC-LOC-ID-NEW4             PIC  9(04).                   01420011
014210     05  CC-LOC-ID-NEW4-X REDEFINES CC-LOC-ID-NEW4                01421088
014220                                    PIC  X(04).                   01422088
014300     05  FILLER                     PIC  X(41).                   01430011
014500*                                                                 01450004
014600*                                                                 01460004
014700 01  PS-PROGRAM-SWITCHES.                                         01470004
015000     05  PS-CONTROL-CARD-VALID-SW    PIC  X(01)    VALUE SPACE.   01500004
015100         88  PS-CONTROL-CARD-INVALID               VALUE 'N'.     01510004
015200         88  PS-CONTROL-CARD-VALID                 VALUE 'Y'.     01520004
015201     05  PS-END-OF-PARM-CSR-SW       PIC  X(01)    VALUE 'N'.     01520123
015210         88 PS-END-OF-PARM-CSR-NO                  VALUE 'N'.     01521023
015220         88 PS-END-OF-PARM-CSR-YES                 VALUE 'Y'.     01522042
015300*                                                                 01530004
015400*                                                                 01540004
015500 01  PV-PROGRAM-VARIABLES.                                        01550004
015510     05  PV-LOCATION                 PIC  X.                      01551097
015520         88  PV-LOC-1                VALUE '1'.                   01552097
015530         88  PV-LOC-2                VALUE '2'.                   01553097
015540         88  PV-LOC-3                VALUE '3'.                   01554097
015550         88  PV-LOC-4                VALUE '4'.                   01555097
015600     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01560004
015700                                                   COMP.          01570004
015800     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01580004
015810     05  PV-LOC-ID                   PIC S9(04)    VALUE ZERO     01581029
015820                                                   COMP.          01582029
015830     05  PV-DISP-LOC-ID              PIC  9(04)    VALUE ZERO.    01583099
015900     05  PV-TKRPRPM-CNT              PIC S9(05)    VALUE ZERO     01590033
016000                                                   COMP-3.        01600004
016100     05  PV-LOC-1-CNT                PIC S9(05)    VALUE ZERO     01610097
016200                                                   COMP-3.        01620004
016210     05  PV-LOC-2-CNT                PIC S9(05)    VALUE ZERO     01621097
016220                                                   COMP-3.        01622097
016230     05  PV-LOC-3-CNT                PIC S9(05)    VALUE ZERO     01623097
016240                                                   COMP-3.        01624097
016250     05  PV-LOC-4-CNT                PIC S9(05)    VALUE ZERO     01625097
016260                                                   COMP-3.        01626097
016300     05  PV-OUTPUT-CNT               PIC S9(05)    VALUE ZERO     01630090
016400                                                   COMP-3.        01640004
016410     05  PV-DISPLAY-CNT              PIC ZZZZ9.                   01641033
016500     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01650004
017200*                                                                 01720004
017300*                                                                 01730004
017400 01  PE-PROGRAM-ERROR-MESSAGES.                                   01740004
017500     05  PE-MSG-01                   PIC  X(30)    VALUE          01750004
017600         'OPEN OF PARM_CSR              '.                        01760022
017700     05  PE-MSG-02                   PIC  X(30)    VALUE          01770004
017800         'FETCH OF PARM_CSR             '.                        01780022
020100     05  PE-MSG-03                   PIC  X(30)    VALUE          02010022
020200         'CLOSE OF PARM_CSR             '.                        02020022
020300*                                                                 02030004
021300******************************************************************02130004
021400*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       02140004
021500******************************************************************02150004
021600     COPY DPWS004.                                                02160004
021700*                                                                 02170004
021800*                                                                 02180004
021900******************************************************************02190004
022000*  COMMUNICATIONS AREA FOR DB2                                    02200004
022100******************************************************************02210004
022200     EXEC SQL                                                     02220004
022300          INCLUDE SQLCA                                           02230004
022400     END-EXEC.                                                    02240004
022500*                                                                 02250004
022510*----------------------------------------------------------------*02251035
022520*    DB2 TABLE FOR PARAMETERS                                     02252035
022530*----------------------------------------------------------------*02253035
022540     EXEC SQL                                                     02254035
022550          INCLUDE TKRPRPM                                         02255035
022560     END-EXEC.                                                    02256035
024900*                                                                 02490004
025100******************************************************************02510004
025200**  CURSOR USED TO RETRIEVE TKRPRPM DATA                          02520035
025400******************************************************************02540004
025500     EXEC SQL                                                     02550004
025600          DECLARE PARM_CSR CURSOR FOR                             02560015
025710           SELECT LOC_ID                                          02571018
025720                 ,INTFC_SYS_CDE                                   02572018
025730                 ,SYS_PRC_FUNC_CDE                                02573018
025740                 ,FUNC_PRC_STAT_CDE                               02574018
025750                 ,FUNC_BEG_TMST                                   02575018
025760                 ,FUNC_END_TMST                                   02576018
025770                 ,FUNC_QTY                                        02577018
025780                 ,FUNC_PCT                                        02578018
025790                 ,FUNC_TXT                                        02579018
025791                 ,FUNC_WD_QTY                                     02579118
025792                 ,FUNC_DPTH_QTY                                   02579218
025793                 ,FUNC_HT_QTY                                     02579318
025794                 ,FUNC_WT_QTY                                     02579418
026600             FROM TKRPRPM                                         02660015
026800            WHERE LOC_ID = :DK-LOC-ID                             02680017
026900         WITH UR                                                  02690016
027000     END-EXEC                                                     02700036
029500*                                                                 02950004
045900*                                                                 04590004
046000*                                                                 04600004
046100******************************************************************04610004
046200 PROCEDURE DIVISION.                                              04620004
046300******************************************************************04630004
046400                                                                  04640004
046500******************************************************************04650004
046600*  CONTROLS THE MAIN PROCESSING OF THE PROGRAM.                   04660004
046700******************************************************************04670004
046800 0000-PROGRAM-MAINLINE.                                           04680004
046900     PERFORM 1000-INITIALIZE.                                     04690004
047000*                                                                 04700004
047001* NOTE:  IF LOC-ID-CURR  =  LOC-ID-NEW THIS IS VALID              04700199
047002*        THAT IS WHAT WILL BE USED TO LOAD THE FILE TO PROD       04700299
047003*                                                                 04700399
047004*                                                                 04700499
047010     IF  CC-LOC-ID-CURR1-X  NUMERIC  AND                          04701099
047011         CC-LOC-ID-NEW1-X   NUMERIC  AND                          04701199
047012         CC-LOC-ID-CURR1-X  > '0000' AND                          04701299
047013         CC-LOC-ID-NEW1-X   > '0000'                              04701399
047024         MOVE CC-LOC-ID-CURR1 TO DK-LOC-ID                        04702499
047025         MOVE CC-LOC-ID-NEW1  TO PV-LOC-ID                        04702599
047026         MOVE '1'             TO PV-LOCATION                      04702699
047027         PERFORM 7000-OPEN-PARM-CSR                               04702799
047028                                                                  04702899
047029         PERFORM 7010-FETCH-PARM-CSR                              04702999
047030         IF  PS-END-OF-PARM-CSR-NO                                04703099
047031             DISPLAY '** PROCESSING CC-LOC-ID-CURR1 '             04703199
047032                                    CC-LOC-ID-CURR1               04703299
047033             DISPLAY '** PROCESSING CC-LOC-ID-NEW1  '             04703399
047034                                    CC-LOC-ID-NEW1                04703499
047035             PERFORM 2000-PROCESS-TKRPRPM                         04703599
047036                UNTIL PS-END-OF-PARM-CSR-YES                      04703699
047037         ELSE                                                     04703799
047038             DISPLAY '** CC CURRENT LOCATION 1 NOT FOUND ==> '    04703899
047039                      CC-LOC-ID-CURR1-X                           04703999
047040         END-IF                                                   04704099
047041                                                                  04704199
047042         PERFORM 7020-CLOSE-PARM-CSR                              04704299
047043     ELSE                                                         04704325
047044* * *  JUST SKIP IF CURRENT AND NEW LOCATION ARE ZERO             04704489
047045         IF  CC-LOC-ID-CURR1-X  = '0000'  AND                     04704599
047046             CC-LOC-ID-NEW1-X   = '0000'                          04704699
047047             CONTINUE                                             04704789
047054         ELSE                                                     04705425
047055             DISPLAY '** CC LOCATION 1 DATA INVALID'              04705589
047056             DISPLAY CC-LOC-ID-CURR1-X ' ' CC-LOC-ID-NEW1-X       04705695
047059         END-IF                                                   04705986
047091     END-IF.                                                      04709125
047092*                                                                 04709292
047093     IF  CC-LOC-ID-CURR2-X  NUMERIC   AND                         04709399
047094         CC-LOC-ID-NEW2-X   NUMERIC   AND                         04709499
047095         CC-LOC-ID-CURR2-X  > '0000'  AND                         04709599
047096         CC-LOC-ID-NEW2-X   > '0000'                              04709699
047210         MOVE CC-LOC-ID-CURR2 TO DK-LOC-ID                        04721099
047220         MOVE CC-LOC-ID-NEW2  TO PV-LOC-ID                        04722099
047221         MOVE '2'             TO PV-LOCATION                      04722199
047222         SET PS-END-OF-PARM-CSR-NO TO TRUE                        04722299
047230         PERFORM 7000-OPEN-PARM-CSR                               04723099
047231                                                                  04723199
047240         PERFORM 7010-FETCH-PARM-CSR                              04724099
047241         IF  PS-END-OF-PARM-CSR-NO                                04724199
047242             DISPLAY '** PROCESSING CC-LOC-ID-CURR2 '             04724299
047243                                    CC-LOC-ID-CURR2               04724399
047244             DISPLAY '** PROCESSING CC-LOC-ID-NEW2  '             04724499
047245                                    CC-LOC-ID-NEW2                04724599
047250             PERFORM 2000-PROCESS-TKRPRPM                         04725099
047260               UNTIL PS-END-OF-PARM-CSR-YES                       04726099
047261         ELSE                                                     04726199
047262             DISPLAY '** CC CURRENT LOCATION 2 NOT FOUND ==> '    04726299
047264                      CC-LOC-ID-CURR2-X                           04726499
047265         END-IF                                                   04726599
047270         PERFORM 7020-CLOSE-PARM-CSR                              04727099
047280     ELSE                                                         04728092
047290* * *  JUST SKIP IF CURRENT AND NEW LOCATION ARE ZERO             04729092
047291         IF  CC-LOC-ID-CURR2-X  = '0000'  AND                     04729199
047292             CC-LOC-ID-NEW2-X   = '0000'                          04729299
047293             CONTINUE                                             04729392
047294         ELSE                                                     04729492
047295             DISPLAY '** CC LOCATION 2 DATA INVALID'              04729592
047296             DISPLAY CC-LOC-ID-CURR2-X ' ' CC-LOC-ID-NEW2-X       04729695
047297         END-IF                                                   04729792
047298     END-IF.                                                      04729892
047300*                                                                 04730004
047400     IF  CC-LOC-ID-CURR3-X  NUMERIC   AND                         04740099
047410         CC-LOC-ID-NEW3-X   NUMERIC   AND                         04741099
047420         CC-LOC-ID-CURR3-X  > '0000'  AND                         04742099
047430         CC-LOC-ID-NEW3-X   > '0000'                              04743099
047472         MOVE CC-LOC-ID-CURR3 TO DK-LOC-ID                        04747299
047473         MOVE CC-LOC-ID-NEW3  TO PV-LOC-ID                        04747399
047474         MOVE '3'             TO PV-LOCATION                      04747499
047475         SET PS-END-OF-PARM-CSR-NO TO TRUE                        04747599
047476                                                                  04747699
047477         PERFORM 7000-OPEN-PARM-CSR                               04747799
047478                                                                  04747899
047479         PERFORM 7010-FETCH-PARM-CSR                              04747999
047480         IF  PS-END-OF-PARM-CSR-NO                                04748099
047481             DISPLAY '** PROCESSING CC-LOC-ID-CURR3 '             04748199
047482                                    CC-LOC-ID-CURR3               04748299
047483             DISPLAY '** PROCESSING CC-LOC-ID-NEW3  '             04748399
047484                                    CC-LOC-ID-NEW3                04748499
047485             PERFORM 2000-PROCESS-TKRPRPM                         04748599
047486               UNTIL PS-END-OF-PARM-CSR-YES                       04748699
047487         ELSE                                                     04748799
047488             DISPLAY '** CC CURRENT LOCATION 3 NOT FOUND ==> '    04748899
047489                     CC-LOC-ID-CURR3-X                            04748999
047490         END-IF                                                   04749099
047491         PERFORM 7020-CLOSE-PARM-CSR                              04749199
047492     ELSE                                                         04749293
047493* * *  JUST SKIP IF CURRENT AND NEW LOCATION ARE ZERO             04749393
047494         IF  CC-LOC-ID-CURR3-X  = '0000'  AND                     04749499
047495             CC-LOC-ID-NEW3-X   = '0000'                          04749599
047496             CONTINUE                                             04749693
047497         ELSE                                                     04749793
047498             DISPLAY '** CC LOCATION 3 DATA INVALID'              04749899
047499             DISPLAY CC-LOC-ID-CURR3-X ' ' CC-LOC-ID-NEW3-X       04749995
047500         END-IF                                                   04750093
047501     END-IF.                                                      04750193
047502*                                                                 04750294
047503     IF  CC-LOC-ID-CURR4-X  NUMERIC   AND                         04750399
047504         CC-LOC-ID-NEW4-X   NUMERIC   AND                         04750499
047505         CC-LOC-ID-CURR4-X  > '0000'  AND                         04750599
047506         CC-LOC-ID-NEW4-X   > '0000'                              04750699
047510         MOVE CC-LOC-ID-CURR4 TO DK-LOC-ID                        04751099
047511         MOVE CC-LOC-ID-NEW4  TO PV-LOC-ID                        04751199
047512         MOVE '4'             TO PV-LOCATION                      04751299
047513         SET PS-END-OF-PARM-CSR-NO TO TRUE                        04751399
047514         PERFORM 7000-OPEN-PARM-CSR                               04751499
047515                                                                  04751599
047516         PERFORM 7010-FETCH-PARM-CSR                              04751699
047517         IF  PS-END-OF-PARM-CSR-NO                                04751799
047518             DISPLAY '** PROCESSING CC-LOC-ID-CURR4 '             04751899
047519                                    CC-LOC-ID-CURR4               04751999
047520             DISPLAY '** PROCESSING CC-LOC-ID-NEW4  '             04752099
047521                                    CC-LOC-ID-NEW4                04752199
047522             PERFORM 2000-PROCESS-TKRPRPM                         04752299
047523               UNTIL PS-END-OF-PARM-CSR-YES                       04752399
047524         ELSE                                                     04752499
047525             DISPLAY '** CC CURRENT LOCATION 4 NOT FOUND ==> '    04752599
047526                     CC-LOC-ID-CURR4-X                            04752699
047527         END-IF                                                   04752799
047528         PERFORM 7020-CLOSE-PARM-CSR                              04752899
047529     ELSE                                                         04752994
047530* * *  JUST SKIP IF CURRENT AND NEW LOCATION ARE ZERO             04753094
047531         IF     CC-LOC-ID-CURR4-X  = '0000'                       04753194
047532           AND  CC-LOC-ID-NEW4-X   = '0000'                       04753294
047533             CONTINUE                                             04753394
047534         ELSE                                                     04753494
047535             DISPLAY '** CC LOCATION 4 DATA INVALID'              04753594
047536             DISPLAY CC-LOC-ID-CURR4-X ' ' CC-LOC-ID-NEW4-X       04753695
047537         END-IF                                                   04753794
047538     END-IF.                                                      04753894
047539*                                                                 04753943
047540     PERFORM 9000-DISPLAY-COUNTS.                                 04754099
047541*                                                                 04754104
047550     CLOSE PARM-FILE-OUT.                                         04755033
047600     STOP RUN.                                                    04760004
047700*                                                                 04770004
048400******************************************************************04840004
048500 1000-INITIALIZE.                                                 04850004
048600     DISPLAY '**'.                                                04860099
048601     DISPLAY 'PROGRAM:  CNKUT800'.                                04860199
048602     DISPLAY '**'.                                                04860299
048610     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           04861013
048611     DISPLAY '** CONTROL CARD: '                                  04861199
048612             CC-CONTROL-CARD.                                     04861299
048613     DISPLAY '**'.                                                04861399
048620*                                                                 04862013
048700     OPEN OUTPUT PARM-FILE-OUT.                                   04870021
048800*                                                                 04880004
049600******************************************************************04960004
049700 2000-PROCESS-TKRPRPM.                                            04970027
058600*                                                                 05860004
059400     MOVE PV-LOC-ID          TO WS-KRPRPM-LOC-ID                  05940089
059800*                                                                 05980089
061800     WRITE PARM-RECORD-OUT                                        06180029
061900      FROM WS-TKRPRPM.                                            06190099
061910     ADD +1 TO PV-OUTPUT-CNT.                                     06191090
061920     EVALUATE TRUE                                                06192098
061930         WHEN PV-LOC-1                                            06193099
061940              ADD +1 TO PV-LOC-1-CNT                              06194099
061950         WHEN PV-LOC-2                                            06195099
061951              ADD +1 TO PV-LOC-2-CNT                              06195199
061952         WHEN PV-LOC-3                                            06195299
061953              ADD +1 TO PV-LOC-3-CNT                              06195399
061954         WHEN PV-LOC-4                                            06195499
061955              ADD +1 TO PV-LOC-4-CNT                              06195599
061960     END-EVALUATE.                                                06196099
062000*                                                                 06200004
062100     PERFORM 7010-FETCH-PARM-CSR.                                 06210037
062200*                                                                 06220004
111900*                                                                 11190004
112000******************************************************************11200004
112100*  OPEN THE PARM_CSR                                              11210021
112200******************************************************************11220004
112300 7000-OPEN-PARM-CSR.                                              11230022
112400     EXEC SQL                                                     11240004
112500          OPEN PARM_CSR                                           11250022
112600     END-EXEC.                                                    11260004
112700*                                                                 11270004
112800     EVALUATE TRUE                                                11280004
112900         WHEN SQLCODE = ZERO                                      11290004
113000              CONTINUE                                            11300004
113100         WHEN OTHER                                               11310004
113200              MOVE '7000-OPEN-PARM-CSR'                           11320022
113300                                 TO PV-ABEND-PARAGRAPH            11330022
113400              MOVE PE-MSG-01     TO PV-DB2-OPERATION-ATTEMPTED    11340004
113500              PERFORM 9200-SQL-ABEND                              11350004
113600     END-EVALUATE.                                                11360004
113700*                                                                 11370004
113800*                                                                 11380004
113900******************************************************************11390004
114000*  FETCH THE NEXT TKRPRPM                                         11400023
114100******************************************************************11410004
114200 7010-FETCH-PARM-CSR.                                             11420023
114220                                                                  11422058
114300     EXEC SQL                                                     11430004
114400          FETCH PARM_CSR                                          11440023
114512           INTO :WS-KRPRPM-LOC-ID                                 11451283
114520               ,:WS-KRPRPM-INTFC-SYS-CDE                          11452083
114530               ,:WS-KRPRPM-SYS-PRC-FUNC-CDE                       11453083
114540               ,:WS-KRPRPM-FUNC-PRC-STAT-CDE                      11454083
114541                    :WS-FUNC-PRC-STAT-CDE-NULL                    11454181
114550               ,:WS-KRPRPM-FUNC-BEG-TMST                          11455083
114551                    :WS-FUNC-BEG-TMST-NULL                        11455181
114560               ,:WS-KRPRPM-FUNC-END-TMST                          11456083
114561                    :WS-FUNC-END-TMST-NULL                        11456181
114570               ,:WS-KRPRPM-FUNC-QTY                               11457083
114571                    :WS-FUNC-QTY-NULL                             11457181
114580               ,:WS-KRPRPM-FUNC-PCT                               11458083
114581                    :WS-FUNC-PCT-NULL                             11458181
114590               ,:WS-KRPRPM-FUNC-TXT                               11459083
114591                    :WS-FUNC-TXT-NULL                             11459182
114592               ,:WS-KRPRPM-FUNC-WD-QTY                            11459283
114593               ,:WS-KRPRPM-FUNC-DPTH-QTY                          11459383
114594               ,:WS-KRPRPM-FUNC-HT-QTY                            11459483
114595               ,:WS-KRPRPM-FUNC-WT-QTY                            11459583
115400     END-EXEC.                                                    11540004
115500*                                                                 11550004
115600     EVALUATE TRUE                                                11560004
115700         WHEN SQLCODE = ZERO                                      11570004
115710              ADD +1 TO PV-TKRPRPM-CNT                            11571032
115800         WHEN SQLCODE = +100                                      11580004
115910              SET PS-END-OF-PARM-CSR-YES                          11591027
115920                                TO TRUE                           11592027
116000         WHEN OTHER                                               11600004
116020              PERFORM 9000-DISPLAY-COUNTS                         11602033
116030              EVALUATE TRUE                                       11603099
116040                  WHEN PV-LOC-1                                   11604099
116050                      DISPLAY '*** LOCATION ' CC-LOC-ID-CURR1-X   11605099
116060                  WHEN PV-LOC-2                                   11606099
116061                      DISPLAY '*** LOCATION ' CC-LOC-ID-CURR2-X   11606199
116080                  WHEN PV-LOC-3                                   11608099
116090                      DISPLAY '*** LOCATION ' CC-LOC-ID-CURR3-X   11609099
116091                  WHEN PV-LOC-4                                   11609199
116092                      DISPLAY '*** LOCATION ' CC-LOC-ID-CURR4-X   11609299
116095              END-EVALUATE                                        11609599
116098              DISPLAY '*** LAST GOOD FETCH: '                     11609899
116100                            WS-KRPRPM-INTFC-SYS-CDE ' '           11610099
116101                            WS-KRPRPM-SYS-PRC-FUNC-CDE            11610199
116110              MOVE '7010-FETCH-PARM-CSR'                          11611023
116200                                 TO PV-ABEND-PARAGRAPH            11620004
116300              MOVE PE-MSG-02     TO PV-DB2-OPERATION-ATTEMPTED    11630004
116400              PERFORM 9200-SQL-ABEND                              11640004
116500     END-EVALUATE.                                                11650004
116600*                                                                 11660004
116700*                                                                 11670004
141700******************************************************************14170004
141800*  CLOSE THE PARM_CSR                                             14180024
141900******************************************************************14190004
142000 7020-CLOSE-PARM-CSR.                                             14200026
142100     EXEC SQL                                                     14210004
142200          CLOSE PARM_CSR                                          14220026
142300     END-EXEC.                                                    14230004
142400*                                                                 14240004
142500     EVALUATE TRUE                                                14250004
142600         WHEN SQLCODE = ZERO                                      14260004
142700              CONTINUE                                            14270004
142800         WHEN OTHER                                               14280004
142900              MOVE '7020-CLOSE-PARM-CSR'                          14290024
143000                                 TO PV-ABEND-PARAGRAPH            14300004
143100              MOVE PE-MSG-03     TO PV-DB2-OPERATION-ATTEMPTED    14310024
143200              PERFORM 9200-SQL-ABEND                              14320004
143300     END-EVALUATE.                                                14330004
143400*                                                                 14340004
144700******************************************************************14470004
144800 9000-DISPLAY-COUNTS.                                             14480033
145100                                                                  14510004
145200     DISPLAY '********************************************'       14520033
145201     DISPLAY '*                                          *'       14520199
145210     MOVE PV-TKRPRPM-CNT     TO PV-DISPLAY-CNT                    14521034
145300     DISPLAY 'TKRPRPM FETCHED ------: ' PV-DISPLAY-CNT.           14530090
145310     MOVE PV-OUTPUT-CNT      TO PV-DISPLAY-CNT                    14531090
145400     DISPLAY 'OUTPUT RECORDS WRITTEN: ' PV-DISPLAY-CNT.           14540090
145500     MOVE PV-LOC-1-CNT       TO PV-DISPLAY-CNT                    14550099
145501     DISPLAY 'LOC 1 RECORDS WRITTEN-: ' PV-DISPLAY-CNT.           14550199
145502     MOVE PV-LOC-2-CNT       TO PV-DISPLAY-CNT                    14550299
145503     DISPLAY 'LOC 2 RECORDS WRITTEN-: ' PV-DISPLAY-CNT.           14550399
145504     MOVE PV-LOC-3-CNT       TO PV-DISPLAY-CNT                    14550499
145505     DISPLAY 'LOC 3 RECORDS WRITTEN-: ' PV-DISPLAY-CNT.           14550599
145506     MOVE PV-LOC-4-CNT       TO PV-DISPLAY-CNT                    14550699
145507     DISPLAY 'LOC 4 RECORDS WRITTEN-: ' PV-DISPLAY-CNT.           14550799
145508     DISPLAY '*                                          *'       14550899
145510     DISPLAY '********************************************'.      14551037
146600*                                                                 14660004
146700*                                                                 14670004
146800******************************************************************14680004
146900*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    14690004
147000*  ERROR OR WARNING CODE OCCURS.                                  14700004
147100******************************************************************14710004
147200 9200-SQL-ABEND.                                                  14720004
147300     DISPLAY '9200-SQL-ABEND'.                                    14730004
147400     DISPLAY '** ABEND     **'.                                   14740004
147500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        14750004
147600     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             14760004
147700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     14770004
147800*                                                                 14780004
147900*                                                                 14790004
148000******************************************************************14800004
148100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    14810004
148200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         14820004
148300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     14830004
148400* FORMAT.                                                         14840004
148500******************************************************************14850004
148600     COPY DPPD004.                                                14860004
148700                                                                  14870004
148800     IF  SQLCODE NOT = -911                                       14880004
148900         EXEC SQL                                                 14890004
149000              COMMIT                                              14900004
149100         END-EXEC                                                 14910004
149200     END-IF.                                                      14920004
149300                                                                  14930004
149400     MOVE +4013                  TO PV-ABEND-CODE.                14940004
149500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         14950004
