000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.    APKUT102.                                         00030000
000400                                                                  00040000
000500 AUTHOR.        MARILYN WILKINSON.                                00050000
000600                                                                  00060000
000700 DATE-WRITTEN.  OCT 1995.                                         00070000
000800                                                                  00080000
000900 DATE-COMPILED.                                                   00090000
001000******************************************************************00100000
001100*                                                                *00110000
001200* EXTRACT UNJOURNALIZED NON-INVOICED RECEIPTS FOR SPECIFIED DATES*00120000
001300*                                                                *00130000
001400******************************************************************00140000
001500*                                                                *00150000
001600*  DB2:                                                          *00160000
001700* 1) NON-INVOICED RECEIPT TABLE                      (TNINREC)   *00170000
001800* 2) PURCHASE TABLE                                  (TPURCHS)   *00180000
001900* 3) PURCHASE ITEM TABLE                             (TPURITM)   *00190000
002000* 4) EXTERNAL ENTERPRISE TABLE                       (TEXTENT)   *00200000
002100* 5) EXTERNAL ENTERPRISE NAME TABLE                  (TENTNME)   *00210000
002200*                                                                *00220000
002300* OUTPUT:                                                        *00230000
002400*  1. OVER-VERIFIED-EXTRACT                (APRD102)             *00240000
002500*  2. DATE-CONTROL               PV-CONTROL-DATE-AREA IN W/S     *00250000
002600*                                                                *00260000
002700******************************************************************00270000
002800* 02/03/98   ROBIN BERNOSKI                  WR/IR #: WR5703     *00280000
002900*            - MODIFIED THE MANNER IN WHICH THE STANDARD DATE    *00290000
003000*              ROUTINE, DPKUT500, IS TO BE CALLED WITHIN A       *00300000
003100*              PROGRAM SO THAT THE CALL IS DYNAMIC.              *00310000
003200*            - REPLACED ++INCLUDES WITH COPY STATEMENTS.         *00320000
003300*                                                                *00330000
003400* 12/08/1999 JILL JUEL                   WR/IR #: WR6041         *00340000
003500*            - MODIFIED THE CHECK ON THE DATE ROUTINE TO         *00350000
003600*              CONFORM WITH Y2K STANDARDS BY ADDING              *00360000
003700*              DPG54-WARNING-ERROR.                              *00370000
003800*                                                                *00380000
003900* 02/06/2003                                                     *00390000
004000*    CHANGE MADE: ARKPO PHASE3 PROJECT.                          *00400000
004100*    UPDATED THE PGM TITLE TO MATCH THE SPEC TITLE.              *00410000
004200*    ADDED PGM COMMENT BLOCK WITH THE FILENAMES. RECOMPILED TO   *00420000
004300*    PICK UP THE COPYBOOK UPDATES.                               *00430000
004400* MADE BY:  MIKE BESKE                          WR#: 23500       *00440000
004410*                                                                *00441000
004420* 03/11/2007                                                     *00442000
004430*    CHANGE MADE: MATCH BY DC PROJECT.                           *00443000
004440*    ADDED DC_NBR TO THE NINREC_CURSOR.                          *00444000
004450* MADE BY:  MICHELE RINDFLEISCH                 WR#: 21578       *00445000
004460*                                                                *00445100
004470* DATE  11/04/2014                                               *00445200
004480*     CHANGE MADE: PO EXTENDED DIGIT CHANGES.                    *00445300
004490*     EXTENDED PO# FROM 7 TO 9.                                  *00445400
004491*     MADE BY: COGNIZANT               WR/IR #: CHG0094517       *00445500
004492******************************************************************00446000
004493     EJECT                                                        00447000
004494 ENVIRONMENT DIVISION.                                            00448000
004495                                                                  00449000
004500 INPUT-OUTPUT SECTION.                                            00450000
004600                                                                  00460000
004700 FILE-CONTROL.                                                    00470000
004800                                                                  00480000
004900     SELECT OVER-VERIFIED-EXTRACT ASSIGN TO UT-S-OUT001.          00490000
005000     SELECT DATE-CONTROL          ASSIGN TO UT-S-OUT002.          00500000
005100                                                                  00510000
005200 DATA DIVISION.                                                   00520000
005300                                                                  00530000
005400 FILE SECTION.                                                    00540000
005500                                                                  00550000
005600 FD  OVER-VERIFIED-EXTRACT                                        00560000
005700     RECORDING MODE IS F                                          00570000
005800     LABEL RECORDS ARE STANDARD                                   00580000
005900     BLOCK CONTAINS 0 CHARACTERS.                                 00590000
006000                                                                  00600000
006100 01  OVER-VERIFIED-RECORD        PIC X(200).                      00610000
006200                                                                  00620000
006300 FD  DATE-CONTROL                                                 00630000
006400     RECORDING MODE IS F                                          00640000
006500     LABEL RECORDS ARE STANDARD                                   00650000
006600     BLOCK CONTAINS 0 CHARACTERS.                                 00660000
006700                                                                  00670000
006800 01  DATE-CONTROL-RECORD         PIC X(080).                      00680000
006900                                                                  00690000
007000 EJECT                                                            00700000
007100 WORKING-STORAGE SECTION.                                         00710000
007200                                                                  00720000
007300 01  ABEND-CODE                  PIC S9(04)  COMP SYNC            00730000
007400                                             VALUE +0.            00740000
007500     88 AP-DB2-ERROR               VALUE +4013.                   00750000
007600                                                                  00760000
007700 01  WORK-AREAS.                                                  00770000
007800     05  PV-TABLE-NAME           PIC X(7).                        00780000
007900     05  PV-PARAGRAPH-NAME       PIC X(30).                       00790000
008000                                                                  00800000
008100 01  PV-ABEND-FIELDS.                                             00810000
008200     05  PV-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUT102'. 00820000
008300     05  PV-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     00830000
008400     05  PV-ABEND-OPERATION           PIC X(50) VALUE SPACES.     00840000
008500     05  PV-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     00850000
008600     05  PV-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     00860000
008700     05  PV-ABEND-STRUCTURE-3         PIC X(8)  VALUE SPACES.     00870000
008800     05  PV-ABEND-STATUS              PIC XX    VALUE SPACES.     00880000
008900                                                                  00890000
009000 01  PV-CURRENT-DATE.                                             00900000
009100     05  PV-CURRENT-YR           PIC 9(02)   VALUE 0.             00910000
009200     05  PV-CURRENT-MM           PIC 9(02)   VALUE 0.             00920000
009300     05  PV-CURRENT-DD           PIC 9(02)   VALUE 0.             00930000
009400                                                                  00940000
009500 01  PV-COMP-BEG-DATE            PIC 9(08)   VALUE 0.             00950000
009600 01  PV-COMP-END-DATE            PIC 9(08)   VALUE 0.             00960000
009700                                                                  00970000
009800                                                                  00980000
009900 01  PV-DATE-AREA.                                                00990000
010000     05  PV-BEGIN-DATE           PIC X(10)   VALUE SPACES.        01000000
010100     05  PV-ENDING-DATE          PIC X(10)   VALUE SPACES.        01010000
010200                                                                  01020000
010300 01  PV-CONTROL-DATE-AREA.                                        01030000
010400     05  PV-CNTRL-BEGIN-DATE     PIC X(10)   VALUE SPACES.        01040000
010500     05  FILLER                  PIC X(02)   VALUE SPACES.        01050000
010600     05  PV-CNTRL-ENDING-DATE    PIC X(10)   VALUE SPACES.        01060000
010700     05  FILLER                  PIC X(58)   VALUE SPACES.        01070000
010800                                                                  01080000
010900 01  PV-DATE-IN-AREA.                                             01090000
011000     05  PV-DATE-IN-BEGIN        PIC X(10)   VALUE SPACES.        01100000
011100     05  FILLER                  PIC X(02)   VALUE SPACES.        01110000
011200     05  PV-DATE-IN-ENDING       PIC X(10)   VALUE SPACES.        01120000
011300     05  FILLER                  PIC X(58)   VALUE SPACES.        01130000
011400                                                                  01140000
011500                                                                  01150000
011600 01  PV-PROGRAM-VARIABLES.                                        01160000
011700     05  PV-EXTRACT-WRITTEN      PIC S9(9)   COMP-3 VALUE ZERO.   01170000
011800     05  PV-EDIT-MASK            PIC ZZZ,ZZZ,ZZ9.                 01180000
011900     05  PV-DIFF                 PIC S9(09)V99 COMP-3 VALUE 0.    01190000
012000                                                                  01200000
012100                                                                  01210000
012200     05  PV-DATE-YYYYMMDD-9             PIC 9(08)   VALUE ZEROS.  01220000
012300     05  PV-YYYYMMDD        REDEFINES   PV-DATE-YYYYMMDD-9.       01230000
012400         10  PV-DATE-YYYY               PIC  X(04).               01240000
012500         10  PV-DATE-MM                 PIC  X(02).               01250000
012600         10  PV-DATE-DD                 PIC  X(02).               01260000
012700                                                                  01270000
012800     05  PV-NINREC-RTL-PR-AMT           PIC S9(09)V99 COMP-3      01280000
012900                                                      VALUE +0.   01290000
013000     05  PV-NINREC-COST-AMT             PIC S9(09)V99 COMP-3      01300000
013100                                                      VALUE +0.   01310000
013200                                                                  01320000
013300 01  PS-PROGRAM-SWITCHES.                                         01330000
013400     05  PS-NINRECS-SWITCH              PIC  X(01)  VALUE 'Y'.    01340000
013500         88  PS-MORE-NINREC                         VALUE 'Y'.    01350000
013600         88  PS-NO-MORE-NINREC                      VALUE 'N'.    01360000
013700                                                                  01370000
013800     EJECT                                                        01380000
013900     COPY DPWS004.                                                01390000
014000     EJECT                                                        01400000
014100******************************************************************01410000
014200**                   EXTRACT RECORD LAYOUT                      **01420000
014300******************************************************************01430000
014400 01  AP102-RECORD.                                                01440000
014500     COPY APRD102.                                                01450000
014600     EJECT                                                        01460000
014700******************************************************************01470000
014800**                      DB2 WORK AREAS                          **01480000
014900******************************************************************01490000
015000******************************************************************01500000
015100**        NONINVOICED RECEIPTS         TABLE LAYOUT             **01510000
015200******************************************************************01520000
015300     EXEC SQL                                                     01530000
015400         INCLUDE TNINREC                                          01540000
015500     END-EXEC.                                                    01550000
015600     EJECT                                                        01560000
015700******************************************************************01570000
015800**                    PO ITEM      TABLE LAYOUT                 **01580000
015900******************************************************************01590000
016000     EXEC SQL                                                     01600000
016100         INCLUDE TPURITM                                          01610000
016200     END-EXEC.                                                    01620000
016300     EJECT                                                        01630000
016400******************************************************************01640000
016500**      PURCHASE ORDER TABLE LAYOUT                             **01650000
016600******************************************************************01660000
016700     EXEC SQL                                                     01670000
016800         INCLUDE TPURCHS                                          01680000
016900     END-EXEC.                                                    01690000
017000     EJECT                                                        01700000
017100******************************************************************01710000
017200**      EXTERNAL ENTITY TABLE LAYOUT                            **01720000
017300******************************************************************01730000
017400     EXEC SQL                                                     01740000
017500         INCLUDE TEXTENT                                          01750000
017600     END-EXEC.                                                    01760000
017700     EJECT                                                        01770000
017800******************************************************************01780000
017900**      EXTERNAL ENTITY NAME TABLE LAYOUT                       **01790000
018000******************************************************************01800000
018100     EXEC SQL                                                     01810000
018200         INCLUDE TENTNME                                          01820000
018300     END-EXEC.                                                    01830000
018400     EJECT                                                        01840000
018500******************************************************************01850000
018600**                  DB2 COMMUNICATION AREA                      **01860000
018700******************************************************************01870000
018800     EXEC SQL                                                     01880000
018900         INCLUDE SQLCA                                            01890000
019000     END-EXEC.                                                    01900000
019100******************************************************************01910000
019200**                  DB2 COMMUNICATION AREA  2                   **01920000
019300******************************************************************01930000
019400     COPY SQLCA2.                                                 01940000
019500     EJECT                                                        01950000
019600******************************************************************01960000
019700**   CURSOR USED TO FETCH THE APPROPRIATE NINREC DATA           **01970000
019800******************************************************************01980000
019900     EXEC SQL                                                     01990000
020000         DECLARE NINREC_CURSOR CURSOR FOR                         02000000
020100         SELECT   A.PO_NBR                                        02010000
020200                , A.STR_NBR                                       02020000
020300                , A.PO_LNE_NBR                                    02030000
020400                , A.NON_INVC_UNT_QTY                              02040000
020500                , A.UNT_COST_AMT                                  02050000
020600                , DATE(A.REC_TMST)                                02060000
020700                , A.DC_NBR                                        02070000
020800                , B.UNT_RTL_PR_AMT                                02080000
020900                , B.CL_NBR                                        02090000
021000                , B.GP_RTL_AMT                                    02100000
021100                , B.GP_QTY                                        02110000
021200                , B.UNT_RTL_PR_AMT                                02120000
021300         FROM     TNINREC A                                       02130000
021400                , TPURITM B                                       02140000
021500         WHERE A.PO_NBR         = B.PO_NBR                        02150000
021600           AND A.PO_LNE_NBR     = B.APP_PO_LNE_NBR                02160000
021700           AND A.STATUS_CDE     = ' '                             02170000
021800           AND B.VER_STATUS_CDE = 'A'                             02180000
021900           AND DATE(A.REC_TMST) <= :PV-ENDING-DATE                02190000
022000           AND DATE(A.REC_TMST) >= :PV-BEGIN-DATE                 02200000
022100         ORDER BY A.PO_NBR                                        02210000
022200     END-EXEC.                                                    02220000
022300     EJECT                                                        02230000
022400*** GREGORIAN/JULIAN DATE CONVERSION                              02240000
022500     COPY DPWS500.                                                02250000
022600                                                                  02260000
022700     EJECT                                                        02270000
022800 PROCEDURE DIVISION.                                              02280000
022850                                                                  02285000
022860     INITIALIZE DCLTPURITM                                        02286000
022870                DCLTNINREC                                        02287000
022880                DCLTPURCHS                                        02288000
022890                DCLTENTNME                                        02289000
022900                DCLTEXTENT.                                       02290000
023000                                                                  02300000
023100     ACCEPT PV-CURRENT-DATE  FROM DATE.                           02310000
023200                                                                  02320000
023300     ACCEPT PV-DATE-IN-AREA.                                      02330000
023400                                                                  02340000
023500     IF PV-DATE-IN-BEGIN   = '99-99-9999' AND                     02350000
023600        PV-DATE-IN-ENDING  = '99-99-9999'                         02360000
023700        PERFORM 2400-SETUP-DATES                                  02370000
023800        DISPLAY 'CALCULATED BEGINNING DATE = '                    02380000
023900                PV-BEGIN-DATE                                     02390000
024000        DISPLAY 'CALCULATED ENDING DATE =    '                    02400000
024100                PV-ENDING-DATE                                    02410000
024200     ELSE                                                         02420000
024300        PERFORM 2500-VALIDATE-DATES                               02430000
024400        DISPLAY 'ENTERED BEGINNING DATE = '                       02440000
024500                PV-BEGIN-DATE                                     02450000
024600        DISPLAY 'ENTERED ENDING DATE =    '                       02460000
024700                PV-ENDING-DATE                                    02470000
024800     END-IF.                                                      02480000
024900                                                                  02490000
025000     OPEN OUTPUT OVER-VERIFIED-EXTRACT                            02500000
025100                 DATE-CONTROL.                                    02510000
025200                                                                  02520000
025300     PERFORM 9000-OPEN-NINREC-CURSOR.                             02530000
025400     PERFORM 9100-FETCH-NINREC-CURSOR.                            02540000
025500                                                                  02550000
025600     PERFORM 2000-PROCESS-DATA                                    02560000
025700            UNTIL PS-NO-MORE-NINREC.                              02570000
025800                                                                  02580000
025900     PERFORM 9200-CLOSE-NINREC-CURSOR.                            02590000
026000                                                                  02600000
026100     MOVE PV-EXTRACT-WRITTEN     TO PV-EDIT-MASK.                 02610000
026200     INSPECT PV-EDIT-MASK REPLACING LEADING SPACES                02620000
026300         BY '.'.                                                  02630000
026400     DISPLAY 'EXTRACT RECORDS WRITTEN......'                      02640000
026500         PV-EDIT-MASK.                                            02650000
026600                                                                  02660000
026700     MOVE '  -  -    '         TO PV-CNTRL-BEGIN-DATE.            02670000
026800     MOVE PV-BEGIN-DATE(1:4)   TO PV-CNTRL-BEGIN-DATE(7:4).       02680000
026900     MOVE PV-BEGIN-DATE(6:2)   TO PV-CNTRL-BEGIN-DATE(1:2).       02690000
027000     MOVE PV-BEGIN-DATE(9:2)   TO PV-CNTRL-BEGIN-DATE(4:2).       02700000
027100     MOVE '  -  -    '         TO PV-CNTRL-ENDING-DATE.           02710000
027200     MOVE PV-ENDING-DATE(1:4)  TO PV-CNTRL-ENDING-DATE(7:4).      02720000
027300     MOVE PV-ENDING-DATE(6:2)  TO PV-CNTRL-ENDING-DATE(1:2).      02730000
027400     MOVE PV-ENDING-DATE(9:2)  TO PV-CNTRL-ENDING-DATE(4:2).      02740000
027500     WRITE DATE-CONTROL-RECORD FROM PV-CONTROL-DATE-AREA.         02750000
027600                                                                  02760000
027700     CLOSE OVER-VERIFIED-EXTRACT                                  02770000
027800           DATE-CONTROL.                                          02780000
027900                                                                  02790000
028000     GOBACK.                                                      02800000
028100     EJECT                                                        02810000
028200******************************************************************02820000
028300**                    2000-PROCESS-DATA                         **02830000
028400**  CONTROLS PROCESSING FOR EACH RECORD READ IN THE NINREC      **02840000
028500**  DATABASE.                                                   **02850000
028600******************************************************************02860000
028700                                                                  02870000
028800 2000-PROCESS-DATA.                                               02880000
028900                                                                  02890000
029000     PERFORM 2300-NINREC-ONLY.                                    02900000
029100     PERFORM 3000-WRITE-EXTRACT.                                  02910000
029200     PERFORM 9100-FETCH-NINREC-CURSOR.                            02920000
029300                                                                  02930000
029400 2300-NINREC-ONLY.                                                02940000
029500                                                                  02950000
029600     INITIALIZE AP102-RECORD.                                     02960000
029700     PERFORM 8000-GET-VEND-DEPT.                                  02970000
029800                                                                  02980000
029900     MOVE NINREC-PO-NBR            TO AP102-PO-NBR.               02990000
030000     MOVE PURCHS-DEPT-NBR          TO AP102-DEPT-NBR.             03000000
030100     MOVE EXTENT-DUN-NBR           TO AP102-DUN-NBR.              03010000
030200     MOVE ENTNME-ENT-NAME-DESC     TO AP102-ENT-NAME-DESC.        03020000
030300     MOVE NINREC-STR-NBR           TO AP102-STR-NBR.              03030000
030400     MOVE NINREC-PO-LNE-NBR        TO AP102-PO-LNE-NBR.           03040000
030500     MOVE PURITM-CL-NBR            TO AP102-CL-NBR.               03050000
030600     MOVE NINREC-DC-NBR            TO AP102-DC-NBR.               03060000
030700     SET AP102-NINREC-ONLY         TO TRUE.                       03070000
030800                                                                  03080000
030900     IF PURITM-GP-QTY > +1                                        03090000
031000     AND PURITM-GP-RTL-AMT > ZERO                                 03100000
031100         COMPUTE AP102-NINREC-RTL-PR-AMT =                        03110000
031200             NINREC-NON-INVC-UNT-QTY *                            03120000
031300            (PURITM-GP-RTL-AMT / PURITM-GP-QTY)                   03130000
031400     ELSE                                                         03140000
031500         COMPUTE AP102-NINREC-RTL-PR-AMT =                        03150000
031600             NINREC-NON-INVC-UNT-QTY * PURITM-UNT-RTL-PR-AMT      03160000
031700     END-IF.                                                      03170000
031800                                                                  03180000
031900     COMPUTE AP102-NINREC-COST-AMT =                              03190000
032000         NINREC-NON-INVC-UNT-QTY * NINREC-UNT-COST-AMT.           03200000
032100                                                                  03210000
032200     MOVE NINREC-REC-TMST(1:10)    TO AP102-NINREC-REC-DATE.      03220000
032300                                                                  03230000
032400     EJECT                                                        03240000
032500 2400-SETUP-DATES.                                                03250000
032600                                                                  03260000
032700     IF PV-CURRENT-YR < 80                                        03270000
032800        MOVE '20'                      TO PV-DATE-YYYY(1:2)       03280000
032900     ELSE                                                         03290000
033000        MOVE '19'                      TO PV-DATE-YYYY(1:2).      03300000
033100                                                                  03310000
033200     MOVE PV-CURRENT-YR                TO PV-DATE-YYYY(3:2).      03320000
033300     MOVE PV-CURRENT-MM                TO PV-DATE-MM.             03330000
033400     MOVE PV-CURRENT-DD                TO PV-DATE-DD.             03340000
033500     MOVE PV-DATE-YYYYMMDD-9           TO PV-COMP-BEG-DATE.       03350000
033600                                                                  03360000
033700     IF PV-YYYYMMDD                   > '19000000'                03370000
033800        SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                    03380000
033900        SET DPG52-LK-DTE-ISO           TO TRUE                    03390000
034000        SET DPG51-DECREMENT-DATE       TO TRUE                    03400000
034100        MOVE 100                       TO DPG51-INCR-DECR-DAYS-9  03410000
034200        MOVE PV-YYYYMMDD               TO DPG52-LK-DATE-INPUT     03420000
034300        CALL DP500-KOHLS-CALENDAR-ROUTINE                         03430000
034400                                  USING DPG51 DPG52 DPG53         03440000
034500                                        DPG54 DPG55 DPG56         03450000
034600        IF (DPG54-SEVERE-ERROR OR                                 03460000
034700            DPG54-WARNING-ERROR)                                  03470000
034800           DISPLAY 'LK-DATE         ' DPG52-LK-DATE-INPUT         03480000
034900           DISPLAY 'INCR-DECR-DAYS  ' DPG51-INCR-DECR-DAYS-9      03490000
035000           DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND     03500000
035100           DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND        03510000
035200           DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND   03520000
035300           DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND         03530000
035400           DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND             03540000
035500           DISPLAY                    DPG54-ERROR-MESSAGE         03550000
035600                                                                  03560000
035700           MOVE '2400-SETUP-DATES'   TO PV-ABEND-PARAGRAPH        03570000
035800           MOVE 'UNSUCCESSFUL DATE CONVERSION WITHIN APKUT102'    03580000
035900               TO PV-ABEND-OPERATION                              03590000
036000           PERFORM 9997-ABEND                                     03600000
036100        ELSE                                                      03610000
036200            MOVE '    -  -  '            TO PV-BEGIN-DATE         03620000
036300            MOVE DPG55-DB2-ISO-DATE(1:4) TO PV-BEGIN-DATE(1:4)    03630000
036400            MOVE DPG55-DB2-ISO-DATE(5:2) TO PV-BEGIN-DATE(6:2)    03640000
036500            MOVE DPG55-DB2-ISO-DATE(7:2) TO PV-BEGIN-DATE(9:2)    03650000
036600        END-IF                                                    03660000
036700     END-IF.                                                      03670000
036800                                                                  03680000
036900     IF PV-CURRENT-YR < 80                                        03690000
037000        MOVE '20'                      TO PV-DATE-YYYY(1:2)       03700000
037100     ELSE                                                         03710000
037200        MOVE '19'                      TO PV-DATE-YYYY(1:2).      03720000
037300                                                                  03730000
037400     MOVE PV-CURRENT-YR                TO PV-DATE-YYYY(3:2).      03740000
037500     MOVE PV-CURRENT-MM                TO PV-DATE-MM.             03750000
037600     MOVE PV-CURRENT-DD                TO PV-DATE-DD.             03760000
037700     MOVE PV-DATE-YYYYMMDD-9           TO PV-COMP-END-DATE.       03770000
037800                                                                  03780000
037900     IF PV-YYYYMMDD                   > '19000000'                03790000
038000        SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                    03800000
038100        SET DPG52-LK-DTE-ISO           TO TRUE                    03810000
038200        SET DPG51-DECREMENT-DATE       TO TRUE                    03820000
038300        MOVE 60                        TO DPG51-INCR-DECR-DAYS-9  03830000
038400        MOVE PV-YYYYMMDD               TO DPG52-LK-DATE-INPUT     03840000
038500        CALL DP500-KOHLS-CALENDAR-ROUTINE                         03850000
038600                                  USING DPG51 DPG52 DPG53         03860000
038700                                        DPG54 DPG55 DPG56         03870000
038800        IF (DPG54-SEVERE-ERROR OR                                 03880000
038900            DPG54-WARNING-ERROR)                                  03890000
039000           DISPLAY 'LK-DATE         ' DPG52-LK-DATE-INPUT         03900000
039100           DISPLAY 'INCR-DECR-DAYS  ' DPG51-INCR-DECR-DAYS-9      03910000
039200           DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND     03920000
039300           DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND        03930000
039400           DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND   03940000
039500           DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND         03950000
039600           DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND             03960000
039700           DISPLAY                    DPG54-ERROR-MESSAGE         03970000
039800                                                                  03980000
039900           MOVE '2400-SETUP-DATES'   TO PV-ABEND-PARAGRAPH        03990000
040000           MOVE 'UNSUCCESSFUL DATE CONVERSION WITHIN APKUT102'    04000000
040100               TO PV-ABEND-OPERATION                              04010000
040200           PERFORM 9997-ABEND                                     04020000
040300        ELSE                                                      04030000
040400            MOVE '    -  -  '            TO PV-ENDING-DATE        04040000
040500            MOVE DPG55-DB2-ISO-DATE(1:4) TO PV-ENDING-DATE(1:4)   04050000
040600            MOVE DPG55-DB2-ISO-DATE(5:2) TO PV-ENDING-DATE(6:2)   04060000
040700            MOVE DPG55-DB2-ISO-DATE(7:2) TO PV-ENDING-DATE(9:2)   04070000
040800        END-IF                                                    04080000
040900     END-IF.                                                      04090000
041000                                                                  04100000
041100     IF PV-COMP-BEG-DATE > PV-COMP-END-DATE                       04110000
041200        MOVE '2400-SETUP-DATES'   TO PV-ABEND-PARAGRAPH           04120000
041300        MOVE 'BEGINNING DATE NOT BEFORE ENDING DATE       '       04130000
041400            TO PV-ABEND-OPERATION                                 04140000
041500        PERFORM 9997-ABEND.                                       04150000
041600                                                                  04160000
041700     EJECT                                                        04170000
041800 2500-VALIDATE-DATES.                                             04180000
041900                                                                  04190000
042000     MOVE PV-DATE-IN-BEGIN(7:4)        TO PV-DATE-YYYY(1:4).      04200000
042100     MOVE PV-DATE-IN-BEGIN(1:2)        TO PV-DATE-MM.             04210000
042200     MOVE PV-DATE-IN-BEGIN(4:2)        TO PV-DATE-DD.             04220000
042300                                                                  04230000
042400     IF PV-YYYYMMDD                   > '19000000'                04240000
042500        SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                    04250000
042600        SET DPG52-LK-DTE-ISO           TO TRUE                    04260000
042700        MOVE PV-YYYYMMDD               TO DPG52-LK-DATE-INPUT     04270000
042800        CALL DP500-KOHLS-CALENDAR-ROUTINE                         04280000
042900                                  USING DPG51 DPG52 DPG53         04290000
043000                                        DPG54 DPG55 DPG56         04300000
043100        IF (DPG54-SEVERE-ERROR OR                                 04310000
043200            DPG54-WARNING-ERROR)                                  04320000
043300           DISPLAY 'LK-DATE         ' DPG52-LK-DATE-INPUT         04330000
043400           DISPLAY 'INCR-DECR-DAYS  ' DPG51-INCR-DECR-DAYS-9      04340000
043500           DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND     04350000
043600           DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND        04360000
043700           DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND   04370000
043800           DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND         04380000
043900           DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND             04390000
044000           DISPLAY                    DPG54-ERROR-MESSAGE         04400000
044100                                                                  04410000
044200           MOVE '2500-VALIDATE-'     TO PV-ABEND-PARAGRAPH        04420000
044300           MOVE 'UNSUCCESSFUL DATE CONVERSION WITHIN APKUT102'    04430000
044400               TO PV-ABEND-OPERATION                              04440000
044500           PERFORM 9997-ABEND                                     04450000
044600        ELSE                                                      04460000
044700            MOVE '    -  -  '            TO PV-BEGIN-DATE         04470000
044800            MOVE DPG55-DB2-ISO-DATE(1:4) TO PV-BEGIN-DATE(1:4)    04480000
044900            MOVE DPG55-DB2-ISO-DATE(5:2) TO PV-BEGIN-DATE(6:2)    04490000
045000            MOVE DPG55-DB2-ISO-DATE(7:2) TO PV-BEGIN-DATE(9:2)    04500000
045100        END-IF                                                    04510000
045200     END-IF.                                                      04520000
045300                                                                  04530000
045400     MOVE PV-DATE-IN-ENDING(7:4)       TO PV-DATE-YYYY(1:4).      04540000
045500     MOVE PV-DATE-IN-ENDING(1:2)       TO PV-DATE-MM.             04550000
045600     MOVE PV-DATE-IN-ENDING(4:2)       TO PV-DATE-DD.             04560000
045700                                                                  04570000
045800     IF PV-YYYYMMDD                   > '19000000'                04580000
045900        SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                    04590000
046000        SET DPG52-LK-DTE-ISO           TO TRUE                    04600000
046100        MOVE PV-YYYYMMDD               TO DPG52-LK-DATE-INPUT     04610000
046200        CALL DP500-KOHLS-CALENDAR-ROUTINE                         04620000
046300                                  USING DPG51 DPG52 DPG53         04630000
046400                                        DPG54 DPG55 DPG56         04640000
046500        IF (DPG54-SEVERE-ERROR OR                                 04650000
046600            DPG54-WARNING-ERROR)                                  04660000
046700           DISPLAY 'LK-DATE         ' DPG52-LK-DATE-INPUT         04670000
046800           DISPLAY 'INCR-DECR-DAYS  ' DPG51-INCR-DECR-DAYS-9      04680000
046900           DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND     04690000
047000           DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND        04700000
047100           DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND   04710000
047200           DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND         04720000
047300           DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND             04730000
047400           DISPLAY                    DPG54-ERROR-MESSAGE         04740000
047500                                                                  04750000
047600           MOVE '2500-VALIDATE-'     TO PV-ABEND-PARAGRAPH        04760000
047700           MOVE 'UNSUCCESSFUL DATE CONVERSION WITHIN APKUT102'    04770000
047800               TO PV-ABEND-OPERATION                              04780000
047900           PERFORM 9997-ABEND                                     04790000
048000        ELSE                                                      04800000
048100            MOVE '    -  -  '            TO PV-ENDING-DATE        04810000
048200            MOVE DPG55-DB2-ISO-DATE(1:4) TO PV-ENDING-DATE(1:4)   04820000
048300            MOVE DPG55-DB2-ISO-DATE(5:2) TO PV-ENDING-DATE(6:2)   04830000
048400            MOVE DPG55-DB2-ISO-DATE(7:2) TO PV-ENDING-DATE(9:2)   04840000
048500        END-IF                                                    04850000
048600     END-IF.                                                      04860000
048700                                                                  04870000
048800     EJECT                                                        04880000
048900 3000-WRITE-EXTRACT.                                              04890000
049000                                                                  04900000
049100     WRITE OVER-VERIFIED-RECORD FROM AP102-RECORD.                04910000
049200     ADD +1 TO PV-EXTRACT-WRITTEN.                                04920000
049300                                                                  04930000
049400     EJECT                                                        04940000
049500 8000-GET-VEND-DEPT.                                              04950000
049600                                                                  04960000
049700     EXEC SQL                                                     04970000
049800         SELECT                                                   04980000
049900             PU.DEPT_NBR                                          04990000
050000            ,EN.ENT_NAME_DESC                                     05000000
050100            ,EE.DUN_NBR                                           05010000
050200         INTO                                                     05020000
050300             :PURCHS-DEPT-NBR                                     05030000
050400            ,:ENTNME-ENT-NAME-DESC                                05040000
050500            ,:EXTENT-DUN-NBR                                      05050000
050600         FROM TENTNME EN                                          05060000
050700             ,TEXTENT EE                                          05070000
050800             ,TPURCHS PU                                          05080000
050900         WHERE PU.PO_NBR         = :NINREC-PO-NBR                 05090000
051000           AND PU.VER_STATUS_CDE = 'A'                            05100000
051100           AND EE.ENT_ID         = PU.ENT_ID                      05110000
051200           AND EN.ENT_ID         = PU.ENT_ID                      05120000
051300           AND EN.TYPE_CDE       = '01'                           05130000
051400     END-EXEC.                                                    05140000
051500                                                                  05150000
051600     EVALUATE TRUE                                                05160000
051700        WHEN SQLCODE = ZEROS                                      05170000
051800             CONTINUE                                             05180000
051900        WHEN OTHER                                                05190000
052000             MOVE '8000-GET-VEND-DEPT            ' TO             05200000
052100                                       PV-ABEND-PARAGRAPH         05210000
052200             MOVE 'UNSUCCESSFUL FETCH'                            05220000
052300                           TO PV-ABEND-OPERATION                  05230000
052400             MOVE 'TENTNME ' TO PV-ABEND-STRUCTURE-1              05240000
052500             MOVE 'TEXTENT ' TO PV-ABEND-STRUCTURE-2              05250000
052600             MOVE 'TPURCHS ' TO PV-ABEND-STRUCTURE-3              05260000
052700             PERFORM 9999-SQL-ERROR                               05270000
052800     END-EVALUATE.                                                05280000
052900     EJECT                                                        05290000
053000 9000-OPEN-NINREC-CURSOR.                                         05300000
053100                                                                  05310000
053200     EXEC SQL                                                     05320000
053300         OPEN NINREC_CURSOR                                       05330000
053400     END-EXEC                                                     05340000
053500                                                                  05350000
053600     EVALUATE TRUE                                                05360000
053700        WHEN SQLCODE = ZEROS                                      05370000
053800             CONTINUE                                             05380000
053900        WHEN OTHER                                                05390000
054000             MOVE '9000-OPEN-NINREC-CURSOR       ' TO             05400000
054100                                       PV-ABEND-PARAGRAPH         05410000
054200             MOVE 'UNSUCCESSFUL OPEN   NINREC'                    05420000
054300                           TO PV-ABEND-OPERATION                  05430000
054400             MOVE 'TNINREC ' TO PV-ABEND-STRUCTURE-1              05440000
054500             MOVE '        ' TO PV-ABEND-STRUCTURE-2              05450000
054600             MOVE '        ' TO PV-ABEND-STRUCTURE-3              05460000
054700             PERFORM 9999-SQL-ERROR                               05470000
054800     END-EVALUATE.                                                05480000
054900                                                                  05490000
055000 9100-FETCH-NINREC-CURSOR.                                        05500000
055100                                                                  05510000
055200     EXEC SQL                                                     05520000
055300        FETCH NINREC_CURSOR                                       05530000
055400            INTO   :NINREC-PO-NBR                                 05540000
055500                 , :NINREC-STR-NBR                                05550000
055600                 , :NINREC-PO-LNE-NBR                             05560000
055700                 , :NINREC-NON-INVC-UNT-QTY                       05570000
055800                 , :NINREC-UNT-COST-AMT                           05580000
055900                 , :NINREC-REC-TMST                               05590000
056000                 , :NINREC-DC-NBR                                 05600000
056100                 , :PURITM-UNT-RTL-PR-AMT                         05610000
056200                 , :PURITM-CL-NBR                                 05620000
056300                 , :PURITM-GP-RTL-AMT                             05630000
056400                 , :PURITM-GP-QTY                                 05640000
056500                 , :PURITM-UNT-RTL-PR-AMT                         05650000
056600     END-EXEC                                                     05660000
056700                                                                  05670000
056800     EVALUATE TRUE                                                05680000
056900        WHEN SQLCODE = ZEROS                                      05690000
057000             CONTINUE                                             05700000
057100        WHEN SQLCODE = +100                                       05710000
057200             SET PS-NO-MORE-NINREC TO TRUE                        05720000
057300             MOVE 999999999 TO NINREC-PO-NBR                      05730000
057400        WHEN OTHER                                                05740000
057500             MOVE '9100-FETCH-NINREC-CURSOR      ' TO             05750000
057600                                       PV-ABEND-PARAGRAPH         05760000
057700             MOVE 'UNSUCCESSFUL FETCH  NINREC'                    05770000
057800                           TO PV-ABEND-OPERATION                  05780000
057900             MOVE 'TNINREC ' TO PV-ABEND-STRUCTURE-1              05790000
058000             MOVE '        ' TO PV-ABEND-STRUCTURE-2              05800000
058100             MOVE '        ' TO PV-ABEND-STRUCTURE-3              05810000
058200             PERFORM 9999-SQL-ERROR                               05820000
058300     END-EVALUATE.                                                05830000
058400                                                                  05840000
058500 9200-CLOSE-NINREC-CURSOR.                                        05850000
058600                                                                  05860000
058700     EXEC SQL                                                     05870000
058800         CLOSE NINREC_CURSOR                                      05880000
058900     END-EXEC                                                     05890000
059000                                                                  05900000
059100     EVALUATE TRUE                                                05910000
059200        WHEN SQLCODE = ZEROS                                      05920000
059300             CONTINUE                                             05930000
059400        WHEN OTHER                                                05940000
059500             MOVE '9200-CLOSE-NINREC-CURSOR      ' TO             05950000
059600                                       PV-ABEND-PARAGRAPH         05960000
059700             MOVE 'UNSUCCESSFUL CLOSE  NINREC'                    05970000
059800                           TO PV-ABEND-OPERATION                  05980000
059900             MOVE 'TNINREC ' TO PV-ABEND-STRUCTURE-1              05990000
060000             MOVE '        ' TO PV-ABEND-STRUCTURE-2              06000000
060100             MOVE '        ' TO PV-ABEND-STRUCTURE-3              06010000
060200             PERFORM 9999-SQL-ERROR                               06020000
060300     END-EVALUATE.                                                06030000
060400                                                                  06040000
060500     EJECT                                                        06050000
060600                                                                  06060000
060700 9997-ABEND.                                                      06070000
060800                                                                  06080000
060900     MOVE '9997-ABEND' TO PV-ABEND-PARAGRAPH.                     06090000
061000                                                                  06100000
061100     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 06110000
061200     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               06120000
061300     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               06130000
061400     CALL 'ILBOABN0' USING ABEND-CODE.                            06140000
061500                                                                  06150000
061600 9999-SQL-ERROR.                                                  06160000
061700                                                                  06170000
061800     DISPLAY '*** DB2 ERROR '.                                    06180000
061900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 06190000
062000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               06200000
062100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               06210000
062200     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             06220000
062300     IF PV-ABEND-STRUCTURE-2 > SPACES                             06230000
062400         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2.         06240000
062500     IF PV-ABEND-STRUCTURE-3 > SPACES                             06250000
062600         DISPLAY '*** TABLE 3   = ' PV-ABEND-STRUCTURE-3.         06260000
062700                                                                  06270000
062800     MOVE +4013                    TO ABEND-CODE.                 06280000
062900     COPY DPPD004.                                                06290000
063000     CALL 'ILBOABN0' USING ABEND-CODE.                            06300000
063100                                                                  06310000
