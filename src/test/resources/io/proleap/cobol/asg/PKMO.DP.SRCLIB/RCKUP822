000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.    RCKUP822.                                         00030099
000400                                                                  00040000
000500 AUTHOR.        JOHN HUTCHINSON.                                  00050000
000600                                                                  00060000
000700 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00070000
000800                                                                  00080000
000900 DATE-WRITTEN.  12-22-04.                                         00090099
001000                                                                  00100000
001100 DATE-COMPILED.                                                   00110000
001200                                                                  00120000
001300                                                                  00130000
001400*----------------------------------------------------------------*00140000
001500*----------------------------------------------------------------*00150000
001600*  E822 - PRORATION SIMPLIFICATION - OPEN TO RECEIVE (OTR) MODULE 00160099
001700*                                                                 00170000
001800*  THIS PROGRAM IS A CLONE OF DPKCS277.                           00180000
001900*                                                                 00190000
002000*  CALLED FROM RCKUP821 USING RCWS822 COMMAREA.                   00200099
002100*                                                                 00210000
002200*                                                                 00220000
002300*  THE PURPOSE OF THE OTR MODULE IS TO CALCULATE UNITS OPEN TO    00230000
002400*  RECEIVE FOR A STORE.  MERCHANDISE ANALYSTS CREATE STORE        00240000
002500*  ALLOCATION (DISTRO) PLANS THAT CONTAIN BY PACK OR SKU/LINE     00250000
002600*  THE UNITS OR PACKS EACH STORE SHOULD RECEIVE OFF OF A PURCHASE 00260000
002700*  ORDER. AS THE DC PROCESES RECEIPTS, TRANSCRIPTION AND PRORATION00270000
002800*  PARTIALLY DISTRIBUTE UNITS AGAINST THIS PLAN. THE ORIGINAL PLAN00280000
002900*  MINUS ALL OF THE RECEIPTS (PARTIAL RECEIPTS) MAKES UP THE OTR. 00290000
003000*                                                                 00300000
003100*  IT IS NOT UNCOMMON FOR A VENDOR TO SEND MULTIPLE SHIPMENTS FOR 00310000
003200*  A PURCHASE ORDER. OTR ENSURES STORES ARE NOT DISTRIBUTED MORE  00320000
003300*  THAN IS PLANNED.                                               00330000
003400*----------------------------------------------------------------*00340000
003500*----------------------------------------------------------------*00350000
003600* AHP                                                             00360099
      * 02/03/2005  ADDED COPYBOOK TMWS500 TO CARRY RETURN FIELDS BACK  00361099
      *             TO THE CALLING PROGRAM (RCKUP821) FOR PROPER ERROR  00362099
003700*             DISPLAY HANDLING.                                   00370099
003500*----------------------------------------------------------------*00371099
001300*    CHANGES                                                     *00371399
001300*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)               *00371499
001300*     DATE:    10/15/2014                                        *00371599
001300*                                                                *00371699
001300*      CHANGES THRU OUT THE PROGRAM TO INCREASE THE SIZE OF PO#  *00371799
001300*      FROM 7 DIGITS TO 8 DIGITS. TAGGED WITH *PS 10/15/2014     *00371899
003500*----------------------------------------------------------------*00372099
003800 ENVIRONMENT DIVISION.                                            00380000
003900                                                                  00390000
004000 CONFIGURATION SECTION.                                           00400000
004100                                                                  00410000
004200 SOURCE-COMPUTER.        IBM-3090.                                00420000
004300 OBJECT-COMPUTER.        IBM-3090.                                00430000
004400                                                                  00440000
004500                                                                  00450000
004600*---------------------------*                                     00460000
004700 DATA DIVISION.                                                   00470000
004800*---------------------------*                                     00480000
004900                                                                  00490000
005000*---------------------------*                                     00500000
005100 WORKING-STORAGE SECTION.                                         00510000
005200*---------------------------*                                     00520000
005300                                                                  00530000
005400 01  COUNTERS-AND-STUFF.                                          00540000
005500     05  PV-APP-LINE-NBR         PIC S9(09) VALUE +0 COMP.        00550099
005600     05  PV-PURITM-RATO-QTY      PIC S9(04) VALUE +0 COMP.        00560000
005700     05  PV-RECITM-RATO-QTY      PIC S9(04) VALUE +0 COMP.        00570000
005800     05  PV-ALLPLN-SPLIT-QTY-PK  PIC S9(04) VALUE +0 COMP.        00580000
005900     05  PV-RECEIVED-QTY         PIC S9(09) VALUE +0 COMP.        00590000
006000     05  PV-TOT-RECEIVED-QTY     PIC S9(09) VALUE +0 COMP.        00600099
006100     05  PV-RECEIVED-QTY-PK      PIC S9(09) VALUE +0 COMP.        00610000
006200     05  PV-PO-LNE-NBR           PIC S9(09) VALUE +0 COMP.        00620099
006300     05  PV-STORE-COUNT          PIC S9(09) VALUE +0 COMP.        00630099
006400     05  PV-SUM-STR-DISTRO-QTY   PIC S9(09) VALUE +0 COMP.        00640096
006500     05  PV-SAVE-FIRST-COUNT     PIC S9(09) VALUE +0 COMP.        00650087
006600     05  PV-STR-DISTRO-QTY       PIC S9(09) VALUE +0 COMP.        00660087
006700     05  PV-SQLCODE              PIC S9(09) VALUE +0.             00670087
006800*PS 10/15/2014 CHANGE STARTS                                      00680099
006800     05  PV-DISP-PO-NBR          PIC  9(08) VALUE ZEROS.          00681099
006800*PS 10/15/2014 CHANGE ENDS                                        00682099
006900     05  PV-DISP-REC-SEQ-NBR     PIC  9(04) VALUE ZEROS.          00690087
007000     05  PV-DISP-PO-LNE-NBR      PIC  9(04) VALUE ZEROS.          00700087
007100     05  PV-DISP-OPER-UNT-ID     PIC  9(04) VALUE ZEROS.          00710087
007200     05  PV-DISP-FCLTY-ID        PIC  9(04) VALUE ZEROS.          00720087
007300     05  PV-DISP-STR-NBR         PIC  9(04) VALUE ZEROS.          00730087
007400     05  PV-RETURN-MSG           PIC  X(40) VALUE SPACES.         00740087
007500     05  PV-DISPLAY-SQLCODE      PIC -ZZZZZZZZ9.                  00750000
007600     05  PV-DISPLAY-QTY          PIC  ZZZ9-.                      00760066
007700     05  PV-DISPLAY-QTY1         PIC  ZZZ9-.                      00770087
007800     05  PV-DISPLAY-QTY2         PIC  ZZZ9-.                      00780087
007900     05  PV-DISPLAY-QTY3         PIC  ZZZ9-.                      00790087
008000                                                                  00800000
008100                                                                  00810000
008200 01  PROGRAM-SWITCHES.                                            00820000
008300                                                                  00830000
008400     05  PS-ERRORS-SW            PIC  X(01) VALUE 'N'.            00840000
008500         88  PS-ERRORS-NO                   VALUE 'N'.            00850000
008600         88  PS-ERRORS-YES                  VALUE 'Y'.            00860000
008700                                                                  00870000
008800     05  PS-EOF-PLAN-CSR-SW      PIC  X(01) VALUE 'N'.            00880000
008900         88  PS-PLAN-CSR-START              VALUE 'N'.            00890059
009000         88  PS-PLAN-CSR-EOF                VALUE 'Y'.            00900059
009100                                                                  00910000
009200     05  PS-EOF-BASE-CSR-SW      PIC  X(01) VALUE 'N'.            00920000
009300         88  PS-BASE-CSR-START              VALUE 'N'.            00930059
009400         88  PS-BASE-CSR-EOF                VALUE 'Y'.            00940059
009500                                                                  00950000
009600     05  PS-PRIOR-CURSOR-SW      PIC  X(01) VALUE 'N'.            00960000
009700         88  PS-PRIOR-CURSOR-START          VALUE 'N'.            00970000
009800         88  PS-PRIOR-CURSOR-EOF            VALUE 'Y'.            00980000
009900                                                                  00990000
010000     05  PS-CURSOR-SW            PIC  X(01) VALUE 'N'.            01000000
010100         88  PS-CURSOR-CLOSED               VALUE 'N'.            01010000
010200         88  PS-CURSOR-OPEN                 VALUE 'Y'.            01020000
010300                                                                  01030000
010400     05  PS-LINE-DISTRO-SW       PIC  X(01) VALUE 'Y'.            01040000
010500         88  PS-LINE-HAS-DISTRO-YES         VALUE 'Y'.            01050000
010600         88  PS-LINE-HAS-DISTRO-NO          VALUE 'N'.            01060000
010700                                                                  01070000
010800     05  PS-DRIVER-LINE-SW       PIC  X(01) VALUE 'N'.            01080000
010900         88  PS-DRIVER-LINE-NO              VALUE 'N'.            01090000
011000         88  PS-DRIVER-LINE-YES             VALUE 'Y'.            01100000
011100                                                                  01110000
011200                                                                  01120000
011300 01  PROGRAM-DB2-KEYS.                                            01130096
011400     05  DK-PO-NBR               PIC S9(09) VALUE +0 COMP.        01140000
011500     05  DK-PO-LNE-NBR           PIC S9(09) VALUE +0 COMP.        01150096
011600     05  DK-PO-LINE-NBR          PIC S9(09) VALUE +0 COMP.        01160096
011700     05  DK-DRIVER-LINE-NBR      PIC S9(09) VALUE +0 COMP.        01170000
011800     05  DK-PO-PREPK-ID          PIC S9(04) VALUE +0 COMP.        01180000
011900     05  DK-STORE-NBR            PIC S9(04) VALUE +0 COMP.        01190096
012000                                                                  01200000
012100                                                                  01210000
012200 01  PROGRAM-LITERALS.                                            01220000
012300     05  PC-CURRENT-PROGRAM-NAME PIC  X(08) VALUE 'RCKUP822'.     01230099
012400     05  PC-A                    PIC  X(01) VALUE 'A'.            01240000
012500     05  PC-B                    PIC  X(01) VALUE 'B'.            01250000
012600     05  PC-I                    PIC  X(01) VALUE 'I'.            01260000
012700     05  PC-M                    PIC  X(01) VALUE 'M'.            01270000
012800     05  PC-N                    PIC  X(01) VALUE 'N'.            01280000
012900     05  PC-Y                    PIC  X(01) VALUE 'Y'.            01290000
013000     05  PC-AC                   PIC  X(02) VALUE 'AC'.           01300000
013100     05  PC-AP                   PIC  X(02) VALUE 'AP'.           01310000
013200     05  PC-CM                   PIC  X(02) VALUE 'CM'.           01320000
013300     05  PC-IP                   PIC  X(02) VALUE 'IP'.           01330000
013400     05  PC-RV                   PIC  X(02) VALUE 'RV'.           01340000
013500     05  PC-VE                   PIC  X(02) VALUE 'VE'.           01350000
013600     05  PC-ONE                  PIC S9(04) VALUE +1   COMP.      01360000
013700     05  PC-MAX-ITEM-LINES       PIC S9(04) VALUE +100 COMP.      01370099
013800     05  PC-MAX-PACK-LINES       PIC S9(04) VALUE +100 COMP.      01380042
013900     05  PC-MAX-STORES           PIC S9(04) VALUE +300 COMP.      01390000
014000                                                                  01400000
014100                                                                  01410000
014200* -------------------------------------------------------------- *01420000
014300*    INPUT/INTERFACE DATA                                         01430000
014400* -------------------------------------------------------------- *01440000
014500                                                                  01450000
014600     COPY RCWS822.                                                01460099
014700                                                                  01470000
031200* ERROR DATA PASSED BACK UPSTREAM.                                01470199
           COPY TMRD007.                                                01471099
014800                                                                  01480000
014900* -------------------------------------------------------------- *01490000
015000*    ABEND AREA                                                   01500000
015100* -------------------------------------------------------------- *01510000
015200                                                                  01520000
015300     COPY DPWS013.                                                01530000
015400                                                                  01540000
015500                                                                  01550000
015600* -------------------------------------------------------------- *01560000
015700*    GLOBAL COMMAREA                                              01570000
015800* -------------------------------------------------------------- *01580000
015900                                                                  01590000
016000     COPY DPWS020.                                                01600000
016100                                                                  01610000
016200                                                                  01620000
016300* -------------------------------------------------------------- *01630000
016400*    DB2 SQL COMMUNICATION AREA                                   01640000
016500* -------------------------------------------------------------- *01650000
016600                                                                  01660000
016700     EXEC SQL                                                     01670000
016800          INCLUDE SQLCA                                           01680000
016900     END-EXEC.                                                    01690000
017000                                                                  01700000
017100                                                                  01710000
017200* -------------------------------------------------------------- *01720000
017300*    DB2 DCLGEN FOR MERCHANDISE STORE ALLOCATION PLAN TABLE       01730000
017400* -------------------------------------------------------------- *01740000
017500                                                                  01750000
017600     EXEC SQL                                                     01760000
017700          INCLUDE TALLPLN                                         01770000
017800     END-EXEC.                                                    01780000
017900                                                                  01790000
018000                                                                  01800000
018100* -------------------------------------------------------------- *01810000
018200*    DB2 DCLGEN FOR MERCHANDISE STORE DISTRIBUTION PLAN TABLE     01820000
018300* -------------------------------------------------------------- *01830000
018400                                                                  01840000
018500     EXEC SQL                                                     01850000
018600          INCLUDE TMESTDS                                         01860000
018700     END-EXEC.                                                    01870000
018800                                                                  01880000
018900                                                                  01890000
019000* -------------------------------------------------------------- *01900000
019100*    DB2 DCLGEN FOR PO PURCHASE ITEM TABLE (PO LINE ITEMS)        01910000
019200* -------------------------------------------------------------- *01920000
019300                                                                  01930000
019400     EXEC SQL                                                     01940000
019500          INCLUDE TPURITM                                         01950000
019600     END-EXEC.                                                    01960000
019700                                                                  01970000
019800                                                                  01980000
019900* -------------------------------------------------------------- *01990000
020000*    DB2 DCLGEN FOR RECEIVER TABLE                                02000000
020100* -------------------------------------------------------------- *02010000
020200                                                                  02020000
020300     EXEC SQL                                                     02030000
020400          INCLUDE TRECEIV                                         02040000
020500     END-EXEC.                                                    02050000
020600                                                                  02060000
020700                                                                  02070000
020800* -------------------------------------------------------------- *02080000
020900*    DB2 DCLGEN FOR RECEIVER ITEM                                 02090000
021000* -------------------------------------------------------------- *02100000
021100                                                                  02110000
021200     EXEC SQL                                                     02120000
021300          INCLUDE TRECITM                                         02130000
021400     END-EXEC.                                                    02140000
021500                                                                  02150000
021600                                                                  02160000
021700* -------------------------------------------------------------- *02170000
021800*    DB2 DCLGEN FOR RECEIVE DISTRIBUTION TABLE                    02180000
021900* -------------------------------------------------------------- *02190000
022000                                                                  02200000
022100     EXEC SQL                                                     02210000
022200          INCLUDE TRECDIS                                         02220000
022300     END-EXEC.                                                    02230000
022400                                                                  02240000
022500                                                                  02250000
022600* -------------------------------------------------------------- *02260000
022700*                   BASE NUMBER CURSORS                          *02270000
022800*                 -----------------------                        *02280000
022900*                                                                *02290000
023000*    THESE CURSORS ARE USED TO POPULATE RC822-STORE-NBR OR       *02300099
023100*    RC822-LINE-NBR AND RC822-STORE-DISTRO-QTY FOR EACH STORE    *02310099
023200*    OR LINE.                                                    *02320000
023300*                                                                *02330074
023400*    SUBTRACTING ALL RECEIPTS FROM THIS WILL GIVE THE OTR.       *02340000
023500* -------------------------------------------------------------- *02350000
023600                                                                  02360000
023700                                                                  02370000
023800* -------------------------------------------------------------- *02380000
023900*    THIS CURSOR IS THE BASIS FOR MASTER PLAN (STORE-LEVEL-OTR)  *02390000
024000* -------------------------------------------------------------- *02400000
024100                                                                  02410000
024200     EXEC SQL                                                     02420000
024300                                                                  02430000
024400         DECLARE STORE-TABLE-CSR CURSOR FOR                       02440000
024500                                                                  02450000
024600           SELECT STR_NBR                                         02460000
024700                , STR_DISTRO_QTY                                  02470000
024800                , ALLOC_SEQ_CDE                                   02480000
024900                , RNK_SEQ_NBR                                     02490000
025000                                                                  02500000
025100           FROM TMESTDS                                           02510097
025200                                                                  02520000
025300           WHERE PO_NBR      =  :RC822-PO-NBR                     02530099
025400             AND PO_LNE_NBR  =  :PURITM-PO-LNE-NBR                02540000
025500             AND PLAN_NBR    =  :ALLPLN-PLAN-NBR                  02550000
025600                                                                  02560000
025700           ORDER BY STR_NBR                                       02570000
025800                                                                  02580000
025900     END-EXEC.                                                    02590000
026000                                                                  02600000
026100                                                                  02610000
026200* -------------------------------------------------------------- *02620000
026300*    THIS CURSOR IS THE BASIS FOR                                *02630074
026400*    RC822-LINE-TABLE (LINE-LEVEL-OTR)                           *02640099
026500* -------------------------------------------------------------- *02650000
026600                                                                  02660000
026700     EXEC SQL                                                     02670000
026800                                                                  02680000
026900         DECLARE PLAN-CSR CURSOR FOR                              02690000
027000                                                                  02700000
027100           SELECT A.PO_LNE_NBR                                    02710000
027200                , A.APP_PO_LNE_NBR                                02720000
027300                , A.PREPK_RATO_QTY                                02730000
027400                                                                  02740000
027500           FROM TPURITM A                                         02750097
027600               ,TRECITM B                                         02760097
027700                                                                  02770000
027800           WHERE  A.PO_NBR           =  :RC822-PO-NBR             02780099
027900             AND  B.ORD_NBR          =   A.PO_NBR                 02790000
028000             AND  B.ORD_LNE_NBR      =   A.APP_PO_LNE_NBR         02800000
028100             AND  OPER_UNT_ID        =  :RC822-OPER-UNT-ID        02810099
028200             AND  REC_SEQ_NBR        =  :RC822-REC-SEQ-NBR        02820099
028300             AND  B.PREPK_ID         =  :DK-PO-PREPK-ID           02830000
028400             AND  A.VER_STATUS_CDE   =  :PC-A                     02840000
028500             AND  A.VER_STATUS_CDE   =   B.VER_STATUS_CDE         02850000
028600             AND  A.STATUS_CDE      IN (:PC-AC,                   02860000
028700                                        :PC-AP,                   02870000
028800                                        :PC-CM,                   02880000
028900                                        :PC-RV)                   02890000
029000                                                                  02900000
029100     END-EXEC.                                                    02910000
029200                                                                  02920000
029300                                                                  02930000
029400* -------------------------------------------------------------- *02940000
029500*    THIS CURSOR IS THE BASIS FOR                                *02950074
029600*    RC822-LINE-TABLE (LINE-LEVEL-OTR)                           *02960099
029700* -------------------------------------------------------------- *02970000
029800                                                                  02980000
029900     EXEC SQL                                                     02990000
030000                                                                  03000000
030100         DECLARE PLAN-LINE-CSR CURSOR FOR                         03010000
030200                                                                  03020000
030300           SELECT A.PO_LNE_NBR                                    03030000
030400                , A.APP_PO_LNE_NBR                                03040000
030500                , A.PREPK_RATO_QTY                                03050000
030600                                                                  03060000
030700           FROM TPURITM A                                         03070097
030800                                                                  03080000
030900           WHERE  A.PO_NBR           =  :RC822-PO-NBR             03090099
031000             AND  A.APP_PO_LNE_NBR   =  :RC822-APP-PO-LNE-NBR     03100099
031100             AND  A.VER_STATUS_CDE   =  :PC-A                     03110000
031200             AND  A.STATUS_CDE      IN (:PC-AC,                   03120000
031300                                        :PC-AP,                   03130000
031400                                        :PC-CM,                   03140000
031500                                        :PC-RV)                   03150000
031600                                                                  03160000
031700     END-EXEC.                                                    03170000
031800                                                                  03180000
031900                                                                  03190000
032000* -------------------------------------------------------------- *03200000
032100*                     RECEIPT CURSORS                            *03210000
032200*                 -----------------------                        *03220000
032300*                                                                *03230000
032400*    THESE CURSORS ARE USED TO RETRIEVE THE PRIOR RECEIPTS       *03240000
032500*    TO BE SUBTRACTED FROM RC822-STORE-OTR-QTY.                  *03250099
032600*                                                                *03260000
032700*    'RECEIVER-LEVEL' PRIOR RECEIPTS ARE DEFINED AS ANY 'VE'     *03270000
032800*    RECEIPT OR 'IP'/'CM' RECEIPT CREATED PRIOR TO THE GIVEN     *03280000
032900*    RECEIVER.                                                   *03290000
033000*                                                                *03300000
033100*    'PO-LEVEL' PRIOR RECEIPTS INCLUDE ALL RECEIPTS INCLUDING    *03310000
033200*    THE GIVEN RECEIVER.                                         *03320000
033300* -------------------------------------------------------------- *03330000
033400                                                                  03340000
033500                                                                  03350000
033600* -------------------------------------------------------------- *03360000
033700*    RECEIVER-LEVEL CURSOR                                       *03370000
033800*                                                                *03380000
033900*    THIS IS A LIST OF RECEIVERS FOR A PO, LINE, AND DC THAT ARE *03390000
034000*    EITHER VERIFIED OR HAD BEEN CREATED PRIOR TO THE CURRENT    *03400000
034100*    DATE AND TIME.  USED IN PARAGRAPH 1300-                     *03410000
034200* -------------------------------------------------------------- *03420000
034300                                                                  03430000
034400     EXEC SQL                                                     03440000
034500                                                                  03450000
034600         DECLARE REC-LVL-CSR CURSOR FOR                           03460000
034700                                                                  03470000
034800           SELECT REC_SEQ_NBR                                     03480000
034900                , STATUS_CDE                                      03490000
035000                , PREPK_RATO_QTY                                  03500099
035100                                                                  03510000
035200           FROM TRECITM                                           03520097
035300                                                                  03530000
035400           WHERE  ORD_NBR         =  :RC822-PO-NBR                03540099
035500             AND  ORD_LNE_NBR     =  :DK-PO-LNE-NBR               03550096
035600             AND  OPER_UNT_ID     =  :RC822-OPER-UNT-ID           03560099
035700             AND  REC_SEQ_NBR    ^=  :RC822-REC-SEQ-NBR           03570099
035800             AND  VER_STATUS_CDE  =  :PC-A                        03580033
035900             AND (CRE_TMST       <=  :RECITM-CRE-TMST             03590000
036000              OR  STATUS_CDE      =  :PC-VE)                      03600000
036100                                                                  03610000
036200           ORDER BY REC_SEQ_NBR                                   03620000
036300                                                                  03630000
036400     END-EXEC.                                                    03640000
036500                                                                  03650000
036600                                                                  03660000
036700* -------------------------------------------------------------- *03670000
036800*    PO-LEVEL CURSOR                                             *03680074
036900*                                                                *03690074
037000*    THIS IS A LIST OF RECEIVERS AND THEIR STATUSES FOR A PO,    *03700074
037100*    LINE AND DC REGARDLESS OF CREATION TIME.                    *03710074
037200* -------------------------------------------------------------- *03720000
037300                                                                  03730000
037400     EXEC SQL                                                     03740000
037500                                                                  03750000
037600         DECLARE PO-LVL-CSR CURSOR FOR                            03760000
037700                                                                  03770000
037800           SELECT REC_SEQ_NBR                                     03780000
037900                , STATUS_CDE                                      03790000
038000                , PREPK_RATO_QTY                                  03800000
038100                                                                  03810000
038200           FROM TRECITM                                           03820097
038300                                                                  03830000
038400           WHERE ORD_NBR          =  :RC822-PO-NBR                03840099
038500             AND ORD_LNE_NBR      =  :DK-PO-LNE-NBR               03850096
038600             AND OPER_UNT_ID      =  :RC822-OPER-UNT-ID           03860099
038700             AND VER_STATUS_CDE   =  :PC-A                        03870000
038800             AND STATUS_CDE      IN (:PC-IP,                      03880000
038900                                     :PC-CM,                      03890000
039000                                     :PC-VE)                      03900000
039100           ORDER BY REC_SEQ_NBR                                   03910000
039200                                                                  03920000
039300     END-EXEC.                                                    03930000
039400                                                                  03940000
039500                                                                  03950000
039600*------------------------*                                        03960000
039700 LINKAGE SECTION.                                                 03970000
039800*------------------------*                                        03980000
039900                                                                  03990000
040000 01  LINK-COMMAREA               PIC X(18000).                    04000099
       01  LINK-TM007-COMMAREA         PIC X(800).                      04010099
M40400                                                                  04040099
040500                                                                  04050000
040600*------------------------------------------*                      04060000
040700 PROCEDURE DIVISION  USING LINK-COMMAREA                          04070099
                                 LINK-TM007-COMMAREA.                   04071099
040800*------------------------------------------*                      04080000
040900                                                                  04090000
041000 0001-MAIN-LINE.                                                  04100074
                                                                        04100199
           MOVE 'RCKUP822'  TO TM007-CALLED-MODULE.                     04101099
                                                                        04102099
041200     MOVE LINK-COMMAREA TO RC822-COMMAREA.                        04120099
           MOVE LINK-TM007-COMMAREA TO TM007-COMMUNICATIONS-AREA.       04121099
041300                                                                  04130074
041400     SET PS-ERRORS-NO TO TRUE.                                    04140099
041400*KBW                                                              04141099
041500     SET PS-BASE-CSR-START   TO TRUE.                             04150099
041400*KBW                                                              04151099
041600     IF RC822-STORE-LEVEL-OTR AND RC822-PO-PREPK-ID > 0           04160099
041700         IF RC822-PREPACK-PACKAGE                                 04170099
041710             PERFORM 0100-VERIFY-STORE-OTR                        04171099
043000         END-IF                                                   04300099
043010     END-IF.                                                      04301099
043100                                                                  04310008
043110                                                                  04311099
043200     EVALUATE TRUE                                                04320000
043300                                                                  04330000
043400       WHEN RC822-STORE-LEVEL-OTR                                 04340099
043500           PERFORM 1000-STORE-LEVEL-OTR                           04350000
043600                                                                  04360000
043700       WHEN RC822-LINE-LEVEL-OTR                                  04370099
043800           PERFORM 2000-LINE-LEVEL-OTR                            04380000
043900                                                                  04390000
044000       WHEN OTHER                                                 04400000
044100           STRING ' INVALID OTR TYPE ' '(' RC822-OTR-TYPE ')'     04410099
044200               DELIMITED BY SIZE INTO PV-RETURN-MSG               04420032
044100           STRING ' INVALID OTR TYPE ' '(' RC822-OTR-TYPE ')'     04420199
044200               DELIMITED BY SIZE INTO TM007-RETURN-MSG            04420299
044300           MOVE 2 TO RC822-RETURN-CODE                            04430099
                 MOVE '02' TO TM007-RETURN-CODE                         04430199
      *          PERFORM DP013-0000-PROCESS-ABEND                       04431099
044400           PERFORM 9999-PROCESS-GOBACK                            04440099
044500                                                                  04450000
044600     END-EVALUATE.                                                04460000
044700                                                                  04470000
044800                                                                  04480099
044900     PERFORM 0200-STORE-OTR-ROUTINE                               04490099
045000       VARYING RC822-STORE-IDX FROM 1 BY 1                        04500099
045100         UNTIL RC822-STORE-NBR (RC822-STORE-IDX) EQUAL ZERO       04510099
045200          OR   RC822-STORE-IDX > PC-MAX-STORES.                   04520099
045300                                                                  04530099
045400     PERFORM 0300-LINE-OTR-ROUTINE                                04540099
045500       VARYING RC822-ITEM-IDX FROM 1 BY 1                         04550099
045600         UNTIL RC822-LINE-NBR (RC822-ITEM-IDX) EQUAL ZERO         04560099
045700          OR   RC822-ITEM-IDX > PC-MAX-ITEM-LINES.                04570099
049000                                                                  04900000
049100     IF RC822-LINE-LEVEL-OTR                                      04910099
049200         IF RC822-PREPACK-PACKAGE                                 04920099
049300             PERFORM 8020-VERIFY-PLAN-ALLOCATION                  04930099
049400         END-IF                                                   04940099
049410     END-IF.                                                      04941099
049500                                                                  04950000
049600     MOVE RC822-COMMAREA TO LINK-COMMAREA.                        04960099
049700                                                                  04970000
049800     GOBACK.                                                      04980000
049810                                                                  04981099
049820                                                                  04982099
049830* -------------------------------------------------------------- *04983099
049840* -------------------------------------------------------------- *04984099
049850                                                                  04985099
049860 0100-VERIFY-STORE-OTR.                                           04986099
049881                                                                  04988199
049890     PERFORM 8000-FETCH-DRIVER-LINE.                              04989099
049891                                                                  04989199
049892     IF RC822-APP-PO-LNE-NBR EQUAL RECITM-ORD-LNE-NBR             04989299
049893         CONTINUE                                                 04989399
049894     ELSE                                                         04989499
049895         MOVE RC822-APP-PO-LNE-NBR TO PV-DISP-PO-LNE-NBR          04989599
049897         STRING ' INVALID PO LINE NBR ' '(' PV-DISP-PO-LNE-NBR ')'04989799
049898           DELIMITED BY SIZE INTO PV-RETURN-MSG                   04989899
049897         STRING ' INVALID PO LINE NBR ' '(' PV-DISP-PO-LNE-NBR ')'04989999
049898           DELIMITED BY SIZE INTO TM007-RETURN-MSG                04990099
049899         MOVE 1 TO RC822-RETURN-CODE                              04990399
               MOVE '01' TO TM007-RETURN-CODE                           04990499
049900*        PERFORM DP013-0000-PROCESS-ABEND                         04990699
               PERFORM 9999-PROCESS-GOBACK                              04990799
049903     END-IF.                                                      04990899
049904                                                                  04990999
049905                                                                  04991099
049906* -------------------------------------------------------------- *04991199
049907* -------------------------------------------------------------- *04991299
049908                                                                  04991399
049909 0200-STORE-OTR-ROUTINE.                                          04991499
049910                                                                  04991599
049911     IF RC822-PREPACK-PACKAGE AND RC822-PO-PREPK-ID > 0           04991699
049912                                                                  04991799
049913         MOVE RC822-STORE-OTR-PK        (RC822-STORE-IDX)         04991899
049914           TO RC822-STORE-DISTRO-OTR-PK (RC822-STORE-IDX)         04991999
049915                                                                  04992099
049916         IF RC822-STORE-OTR-PK (RC822-STORE-IDX) < +0             04992199
049917             MOVE +0 TO RC822-STORE-OTR-PK (RC822-STORE-IDX)      04992299
049918         END-IF                                                   04992399
049919                                                                  04992499
049920     END-IF.                                                      04992599
049822                                                                  04992699
049922     MOVE RC822-STORE-OTR-QTY    (RC822-STORE-IDX)                04992799
049923       TO RC822-STORE-DISTRO-OTR (RC822-STORE-IDX)                04992899
049924          PV-DISPLAY-QTY.                                         04992999
049925                                                                  04993099
049926     IF RC822-STORE-OTR-QTY (RC822-STORE-IDX) < +0                04993199
049927         MOVE +0 TO RC822-STORE-OTR-QTY (RC822-STORE-IDX)         04993299
049928     END-IF.                                                      04993399
049929                                                                  04993499
049930     MOVE PV-DISPLAY-QTY TO RC822-STORE-DISTRO-OTR-X              04993599
049931                           (RC822-STORE-IDX).                     04993699
049932                                                                  04993799
049933                                                                  04993899
049934* -------------------------------------------------------------- *04993999
049935* -------------------------------------------------------------- *04994099
049936                                                                  04994199
049937 0300-LINE-OTR-ROUTINE.                                           04994299
049938                                                                  04994399
049939     MOVE RC822-LINE-OTR-QTY    (RC822-ITEM-IDX)                  04994499
049940       TO RC822-LINE-DISTRO-OTR (RC822-ITEM-IDX).                 04994599
049941                                                                  04994699
049942     IF RC822-LINE-OTR-QTY (RC822-ITEM-IDX) < +0                  04994799
049943         MOVE +0 TO RC822-LINE-OTR-QTY (RC822-ITEM-IDX)           04994899
049944     END-IF.                                                      04994999
049950                                                                  04995000
050000                                                                  05000000
050100* -------------------------------------------------------------- *05010000
050200* -------------------------------------------------------------- *05020000
050300                                                                  05030000
050400 1000-STORE-LEVEL-OTR.                                            05040000
050500                                                                  05050000
050600*    --------------------------                                   05060000
050700*    GET PURITM LINE NUMBER.                                      05070000
050800*    --------------------------                                   05080000
050900                                                                  05090082
051000     MOVE RC822-PO-NBR          TO DK-PO-NBR.                     05100099
051100     MOVE RC822-APP-PO-LNE-NBR  TO DK-PO-LNE-NBR.                 05110099
051200     MOVE RC822-PO-PREPK-ID     TO DK-PO-PREPK-ID.                05120099
051300                                                                  05130000
051400     PERFORM 1120-GET-TPURITM-RECORD.                             05140080
051500                                                                  05150000
051600                                                                  05160082
051700*    --------------------------                                   05170000
051800*    GET APPROVED LINE NUMBER.                                    05180000
051900*    --------------------------                                   05190000
052000                                                                  05200000
052100     MOVE PURITM-PO-LNE-NBR TO DK-PO-LNE-NBR.                     05210096
052200                                                                  05220082
052300     PERFORM 1100-GET-APP-LINE-NBR.                               05230000
052400                                                                  05240000
052500*    ----------                                                   05250000
052600*    GET PLAN.                                                    05260000
052700*    ----------                                                   05270000
052800                                                                  05280000
052900     IF PS-ERRORS-NO                                              05290000
053000         PERFORM 1110-GET-TALLPLN                                 05300000
053100         MOVE ALLPLN-PLAN-NBR           TO RC822-PLAN-NBR         05310099
053200         MOVE ALLPLN-CURR-SPLIT-QTY     TO RC822-CURR-SPLIT-QTY   05320099
053300         MOVE ALLPLN-ALLOC-OUTR-PK-QTY  TO RC822-ALLOC-OUTR-PK-QTY05330099
053400         MOVE ALLPLN-PK-SIZE-RND-CDE    TO RC822-PK-SIZE-RND-CDE  05340099
053500         MOVE ALLPLN-SHTG-PRRT-OPT-CDE  TO RC822-SHORT-PRORATE-CDE05350099
053600         MOVE ALLPLN-OVRG-PRRT-OPT-CDE  TO RC822-OVER-PRORATE-CDE 05360099
053700         MOVE ALLPLN-EXST-SHTG-THRS-IND TO RC822-USE-EX-RULES-IND 05370099
053800         IF RC822-PREPACK-PACKAGE AND RC822-PO-PREPK-ID > 0       05380099
                 IF PV-PURITM-RATO-QTY > +0                             05381099
053900             DIVIDE RC822-CURR-SPLIT-QTY  BY PV-PURITM-RATO-QTY   05390099
054000               GIVING RC822-CURR-SPLIT-PK                         05400099
                 END-IF                                                 05401099
054100         END-IF                                                   05410039
054200     ELSE                                                         05420000
054300         INITIALIZE DCLTALLPLN                                    05430000
054400                    PV-ALLPLN-SPLIT-QTY-PK                        05440000
054500     END-IF.                                                      05450000
054600                                                                  05460000
054700*    -----------------------------------------                    05470000
054800*    MOVE ORIGINAL LINE NUMBER BACK INTO KEY.                     05480000
054900*    -----------------------------------------                    05490000
055000                                                                  05500000
055100     MOVE RC822-APP-PO-LNE-NBR  TO DK-PO-LNE-NBR.                 05510099
055200                                                                  05520000
055300*    -----------------                                            05530000
055400*    LOAD STORE TABLE.                                            05540000
055500*    -----------------                                            05550000
055600                                                                  05560000
055700     IF PS-ERRORS-NO                                              05570000
055800         PERFORM 1200-FILL-BASE-NUMBERS                           05580000
055900     END-IF.                                                      05590000
056000                                                                  05600000
056100*    --------------                                               05610000
056200*    DETERMINE OTR.                                               05620000
056300*    --------------                                               05630000
056400                                                                  05640000
056500     IF PS-ERRORS-NO        AND                                   05650000
056600        PS-LINE-HAS-DISTRO-YES                                    05660000
056700                                                                  05670000
056800         EVALUATE TRUE                                            05680000
056900                                                                  05690000
057000           WHEN RC822-RECEIVER-OTR                                05700099
057100               PERFORM 1300-RCVR-OTR                              05710000
057200                                                                  05720000
057300           WHEN RC822-PO-OTR                                      05730099
057400               PERFORM 1400-PO-OTR                                05740000
057500                                                                  05750000
057600           WHEN OTHER                                             05760000
057700               STRING ' INVALID OTR SCOPE FLAG '                  05781099
057800                      '(' RC822-OTR-SCOPE ')'                     05782099
057900                   DELIMITED BY SIZE INTO PV-RETURN-MSG           05790032
057700               STRING ' INVALID OTR SCOPE FLAG '                  05790199
057800                      '(' RC822-OTR-SCOPE ')'                     05790299
057900                   DELIMITED BY SIZE INTO TM007-RETURN-MSG        05790399
058000               MOVE 3 TO RC822-RETURN-CODE                        05800099
                     MOVE '03' TO TM007-RETURN-CODE                     05801099
058100*              PERFORM DP013-0000-PROCESS-ABEND                   05810099
                     PERFORM 9999-PROCESS-GOBACK                        05811099
058200                                                                  05820000
058300         END-EVALUATE                                             05830000
058400     END-IF.                                                      05840000
058500                                                                  05850000
058600                                                                  05860000
058700* -------------------------------------------------------------- *05870000
058800*    THE APP LINE NUMBER MAY NOT BE THE SAME AS THE KEY LINE      05880000
058900*    NUMBER DUE TO PO LINES BEING DELETED. THE RECEIVING SYSTEM   05890000
059000*    IS KEYED BY THE APPROVED LINE NUMBER. THE PO SYSTEM IS       05900074
059100*    KEYED BY THE LINE NUMBER IN THE KEY.                         05910074
059200* -------------------------------------------------------------- *05920000
059300                                                                  05930000
059400 1100-GET-APP-LINE-NBR.                                           05940000
059500                                                                  05950000
           MOVE '1100-GET-APP-LINE-NBR'   TO TM007-RETURNED-PARA.       05951099
                                                                        05952099
059600     EXEC SQL                                                     05960000
059700                                                                  05970000
059800         SELECT A.APP_PO_LNE_NBR                                  05980000
059900              , A.PREPK_RATO_QTY                                  05990000
060000                                                                  06000000
060100           INTO :PV-APP-LINE-NBR                                  06010000
060200              , :PV-PURITM-RATO-QTY                               06020000
060300                                                                  06030000
060400         FROM TPURITM A                                           06040097
060500                                                                  06050000
060600         WHERE   A.PO_NBR          =  :DK-PO-NBR                  06060000
060700           AND   A.VER_STATUS_CDE  =  :PC-A                       06070000
060800                                                                  06080097
060900           AND ((A.PO_PREPK_ID     =  :DK-PO-PREPK-ID AND         06090000
061000                :DK-PO-PREPK-ID    >   0              AND         06100097
                      :DK-PO-PREPK-ID   <>  99              AND         06101099
061100                 A.PO_LNE_NBR      =  :DK-PO-LNE-NBR)             06110097
061200                                                                  06120097
061300             OR (A.PO_LNE_NBR      =  :DK-PO-LNE-NBR  AND         06130097
061400                :DK-PO-PREPK-ID    =   0)                         06140099
                   OR (A.PO_LNE_NBR      =  :DK-PO-LNE-NBR  AND         06141099
                      :DK-PO-PREPK-ID    =  99))                        06142099
061500                                                                  06150000
061600     END-EXEC.                                                    06160000
061700                                                                  06170000
061800                                                                  06180000
061900     EVALUATE SQLCODE                                             06190074
062000                                                                  06200000
062100       WHEN +0                                                    06210074
062200           IF DK-PO-PREPK-ID EQUAL ZERO                           06220096
062300               MOVE +1 TO PV-PURITM-RATO-QTY                      06230000
062400           END-IF                                                 06240000
062500                                                                  06250000
062600       WHEN -904                                                  06260074
062700       WHEN -911                                                  06270074
062800       WHEN -913                                                  06280074
                 MOVE SQLCODE    TO TM007-SQLCODE                       06281099
                 MOVE SQLCA      TO TM007-SQLCA                         06282099
062900           MOVE 4          TO RC822-RETURN-CODE                   06290099
                 MOVE '04'       TO TM007-RETURN-CODE                   06291099
063000           PERFORM 9900-SOFT-ABORT                                06300000
063100                                                                  06310000
063200       WHEN OTHER                                                 06320000
                 MOVE SQLCODE    TO TM007-SQLCODE                       06321099
                 MOVE SQLCA      TO TM007-SQLCA                         06322099
063300           MOVE 5          TO RC822-RETURN-CODE                   06330099
                 MOVE '05'       TO TM007-RETURN-CODE                   06331099
063400           PERFORM 9800-PGM-ABEND                                 06340000
063500                                                                  06350000
063600     END-EVALUATE.                                                06360000
063700                                                                  06370000
063800                                                                  06380000
063900* -------------------------------------------------------------- *06390000
064000* -------------------------------------------------------------- *06400000
064100                                                                  06410000
064200 1110-GET-TALLPLN.                                                06420000
064300                                                                  06430000
           MOVE '1110-GET-TALLPLN'  TO TM007-RETURNED-PARA.             06431099
064400     INITIALIZE DCLTALLPLN.                                       06440000
064500                                                                  06450000
064600     EXEC SQL                                                     06460000
064700                                                                  06470000
064800         SELECT PLAN_NBR                                          06480000
064900              , CURR_SPLIT_QTY                                    06490000
065000              , ALLOC_OUTR_PK_QTY                                 06500000
065100              , PK_SIZE_RND_CDE                                   06510000
065200              , SHTG_PRRT_OPT_CDE                                 06520012
065300              , OVRG_PRRT_OPT_CDE                                 06530012
065400              , EXST_SHTG_THRS_IND                                06540012
065500                                                                  06550000
065600           INTO :ALLPLN-PLAN-NBR                                  06560000
065700              , :ALLPLN-CURR-SPLIT-QTY                            06570000
065800              , :ALLPLN-ALLOC-OUTR-PK-QTY                         06580000
065900              , :ALLPLN-PK-SIZE-RND-CDE                           06590000
066000              , :ALLPLN-SHTG-PRRT-OPT-CDE                         06600012
066100              , :ALLPLN-OVRG-PRRT-OPT-CDE                         06610012
066200              , :ALLPLN-EXST-SHTG-THRS-IND                        06620012
066300                                                                  06630000
066400         FROM TALLPLN                                             06640097
066500                                                                  06650000
066600         WHERE PO_NBR      =  :DK-PO-NBR                          06660000
066700           AND PO_LNE_NBR  =  :DK-PO-LNE-NBR                      06670096
066800           AND DEST_NBR    =  :RC822-OPER-UNT-ID                  06680099
066900                                                                  06690000
067000     END-EXEC.                                                    06700000
067100                                                                  06710000
067200                                                                  06720000
067300     EVALUATE SQLCODE                                             06730074
067400                                                                  06740000
067500       WHEN +0                                                    06750074
067600           SET PS-LINE-HAS-DISTRO-YES TO TRUE                     06760000
067700                                                                  06770000
067800*          ---------------------------                            06780000
067900*          CALCULATE PACKS FROM UNITS.                            06790000
068000*          ---------------------------                            06800000
068100                                                                  06810000
068200           IF PV-PURITM-RATO-QTY > +0                             06820000
068300               DIVIDE ALLPLN-CURR-SPLIT-QTY BY PV-PURITM-RATO-QTY 06830025
068400                 GIVING PV-ALLPLN-SPLIT-QTY-PK                    06840025
068500           ELSE                                                   06850000
068600               MOVE ZERO TO PV-ALLPLN-SPLIT-QTY-PK                06860096
068700               SET  RC822-INVALID-DISTRO TO TRUE                  06870099
068800           END-IF                                                 06880000
068900                                                                  06890000
069000       WHEN +100                                                  06900074
                 MOVE SQLCODE              TO TM007-SQLCODE             06901099
                 MOVE SQLCA                TO TM007-SQLCA               06902099
069100           SET PS-LINE-HAS-DISTRO-NO TO TRUE                      06910000
069200           MOVE 6                    TO RC822-RETURN-CODE         06920099
                 MOVE '06'                 TO TM007-RETURN-CODE         06921099
069300           PERFORM 9000-NO-DISTRO-ERROR                           06930000
069400                                                                  06940000
069500       WHEN -904                                                  06950074
069600       WHEN -911                                                  06960074
069700       WHEN -913                                                  06970074
                 MOVE SQLCODE              TO TM007-SQLCODE             06971099
                 MOVE SQLCA                TO TM007-SQLCA               06972099
069800           MOVE 7                    TO RC822-RETURN-CODE         06980099
                 MOVE '07'                 TO TM007-RETURN-CODE         06981099
069900           PERFORM 9900-SOFT-ABORT                                06990000
070000                                                                  07000000
070100       WHEN OTHER                                                 07010000
070200           MOVE 8                    TO RC822-RETURN-CODE         07020099
                 MOVE '08'                 TO TM007-RETURN-CODE         07021099
070300           PERFORM 9800-PGM-ABEND                                 07030000
070400                                                                  07040000
070500     END-EVALUATE.                                                07050000
070600                                                                  07060000
070700                                                                  07070000
070800* -------------------------------------------------------------- *07080000
070900*    THIS PARAGRAPH RETRIEVES A RECORD FROM TABLE TPURITM.        07090000
071000* -------------------------------------------------------------- *07100000
071100                                                                  07110000
071200 1120-GET-TPURITM-RECORD.                                         07120000
071300                                                                  07130000
           MOVE '1120-GET-TPURITM-RECORD' TO TM007-RETURNED-PARA.       07131099
                                                                        07132099
071400     EXEC SQL                                                     07140098
071500                                                                  07150000
071600          SELECT PO_LNE_NBR                                       07160098
071700                                                                  07170000
071800            INTO :PURITM-PO-LNE-NBR                               07180098
071900                                                                  07190000
072000          FROM TPURITM                                            07200098
072100                                                                  07210000
072200          WHERE PO_NBR          =  :DK-PO-NBR                     07220098
072300            AND APP_PO_LNE_NBR  =  :DK-PO-LNE-NBR                 07230098
072400            AND VER_STATUS_CDE  =  :PC-A                          07240098
072500                                                                  07250000
072600     END-EXEC.                                                    07260098
072700                                                                  07270000
072800                                                                  07280000
072900     EVALUATE SQLCODE                                             07290098
073000                                                                  07300000
073100       WHEN +0                                                    07310098
073200           CONTINUE                                               07320098
073300                                                                  07330000
073400       WHEN -904                                                  07340098
073500       WHEN -911                                                  07350098
073600       WHEN -913                                                  07360098
                 MOVE SQLCODE    TO TM007-SQLCODE                       07361099
                 MOVE SQLCA      TO TM007-SQLCA                         07362099
073700           MOVE 9          TO RC822-RETURN-CODE                   07370099
                 MOVE '09'       TO TM007-RETURN-CODE                   07371099
073800           PERFORM 9900-SOFT-ABORT                                07380098
073900                                                                  07390000
074000       WHEN OTHER                                                 07400098
                 MOVE SQLCODE    TO TM007-SQLCODE                       07401099
                 MOVE SQLCA      TO TM007-SQLCA                         07402099
074100           MOVE 10         TO RC822-RETURN-CODE                   07410099
                 MOVE '10'       TO TM007-RETURN-CODE                   07411099
074200           PERFORM 9800-PGM-ABEND                                 07420098
074300                                                                  07430000
074400     END-EVALUATE.                                                07440098
074500                                                                  07450000
074600                                                                  07460000
074700* -------------------------------------------------------------- *07470000
074800* -------------------------------------------------------------- *07480000
074900                                                                  07490000
075000 1200-FILL-BASE-NUMBERS.                                          07500000
075100                                                                  07510000
075200     PERFORM 1210-OPEN-STORE-TABLE-CSR.                           07520000
075300                                                                  07530000
075400*    ----------------------------                                 07540000
075500*    GET FIRST STORE TABLE ENTRY.                                 07550000
075600*    ----------------------------                                 07560000
075700                                                                  07570000
075800     IF PS-ERRORS-NO      AND                                     07580000
075900        PS-LINE-HAS-DISTRO-YES                                    07590000
076000         PERFORM 1220-FETCH-STORE-TABLE-CSR                       07600000
076100         IF PS-BASE-CSR-EOF                                       07610060
076200             SET PS-ERRORS-YES                                    07620000
076300                 PS-LINE-HAS-DISTRO-NO TO TRUE                    07630000
076400             MOVE 11                   TO RC822-RETURN-CODE       07640099
                   MOVE '11'                 TO TM007-RETURN-CODE       07641099
076500             PERFORM 9000-NO-DISTRO-ERROR                         07650000
076600         END-IF                                                   07660000
076700     END-IF.                                                      07670000
076800                                                                  07680000
076900*    --------------------------------------                       07690000
077000*    LOOP THRU ALL MESTDS & LOAD TO TABLE.                        07700000
077100*    --------------------------------------                       07710000
077200                                                                  07720000
077300     IF PS-ERRORS-NO   AND                                        07730000
077400        PS-LINE-HAS-DISTRO-YES                                    07740000
077500         PERFORM 1230-LOAD-TO-STR-TABLE                           07750000
077600           VARYING RC822-STORE-IDX FROM 1 BY 1                    07760099
077700             UNTIL PS-BASE-CSR-EOF                                07770060
077800               OR  PS-ERRORS-YES                                  07780074
077900               OR  RC822-STORE-IDX > PC-MAX-STORES                07790099
078000     END-IF.                                                      07800000
078100                                                                  07810000
078200     IF PS-CURSOR-OPEN                                            07820000
078300         PERFORM 1240-CLOSE-STORE-TABLE-CSR                       07830000
078400     END-IF.                                                      07840000
078500                                                                  07850000
078600                                                                  07860000
078700* -------------------------------------------------------------- *07870000
078800* -------------------------------------------------------------- *07880000
078900                                                                  07890000
079000 1210-OPEN-STORE-TABLE-CSR.                                       07900000
079100                                                                  07910000
           MOVE '1210-OPEN-STORE-TABLE-CSR'  TO TM007-RETURNED-PARA.    07911099
                                                                        07912099
079200     EXEC SQL                                                     07920000
079300         OPEN STORE-TABLE-CSR                                     07930000
079400     END-EXEC.                                                    07940032
079500                                                                  07950000
079600                                                                  07960000
079700     EVALUATE SQLCODE                                             07970074
079800                                                                  07980000
079900       WHEN +0                                                    07990074
080000           SET PS-CURSOR-OPEN TO TRUE                             08000000
080100                                                                  08010000
080200       WHEN -904                                                  08020074
080300       WHEN -911                                                  08030074
080400       WHEN -913                                                  08040074
                 MOVE SQLCODE         TO TM007-SQLCODE                  08041099
                 MOVE SQLCA           TO TM007-SQLCA                    08042099
080500           SET PS-CURSOR-CLOSED TO TRUE                           08050000
080600           MOVE 12              TO RC822-RETURN-CODE              08060099
                 MOVE '12'            TO TM007-RETURN-CODE              08061099
080700           PERFORM 9900-SOFT-ABORT                                08070000
080800                                                                  08080000
080900       WHEN OTHER                                                 08090000
                 MOVE SQLCODE         TO TM007-SQLCODE                  08091099
                 MOVE SQLCA           TO TM007-SQLCA                    08092099
081000           SET PS-CURSOR-CLOSED                                   08100000
081100               PS-LINE-HAS-DISTRO-NO TO TRUE                      08110000
081200           MOVE 13              TO RC822-RETURN-CODE              08120099
                 MOVE '13'            TO TM007-RETURN-CODE              08121099
081300           PERFORM 9000-NO-DISTRO-ERROR                           08130000
081400                                                                  08140000
081500     END-EVALUATE.                                                08150000
081600                                                                  08160000
081700                                                                  08170000
081800* -------------------------------------------------------------- *08180000
081900* -------------------------------------------------------------- *08190000
082000                                                                  08200000
082100 1220-FETCH-STORE-TABLE-CSR.                                      08210000
082200                                                                  08220000
           MOVE '1220-FETCH-STORE-TABLE-CSR'  TO TM007-RETURNED-PARA.   08221099
                                                                        08222099
082300                                                                  08230000
082400     EXEC SQL                                                     08240000
082500                                                                  08250000
082600         FETCH STORE-TABLE-CSR                                    08260000
082700                                                                  08270000
082800          INTO :MESTDS-STR-NBR                                    08280000
082900             , :MESTDS-STR-DISTRO-QTY                             08290000
083000             , :MESTDS-ALLOC-SEQ-CDE                              08300000
083100             , :MESTDS-RNK-SEQ-NBR                                08310000
083200                                                                  08320000
083300     END-EXEC.                                                    08330032
083400                                                                  08340000
083500                                                                  08350000
083600     EVALUATE SQLCODE                                             08360074
083700                                                                  08370000
083800       WHEN +0                                                    08380074
083900           ADD MESTDS-STR-DISTRO-QTY TO RC822-SUM-STR-PLAN-QTY    08390099
084000                                        RC822-SUM-STR-OTR-QTY     08400099
084100                                                                  08410000
084200       WHEN +100                                                  08420074
084300           SET PS-BASE-CSR-EOF TO TRUE                            08430060
084400                                                                  08440000
084500       WHEN OTHER                                                 08450000
                 MOVE SQLCODE        TO TM007-SQLCODE                   08451099
                 MOVE SQLCA          TO TM007-SQLCA                     08452099
084600           MOVE 14             TO RC822-RETURN-CODE               08460099
                 MOVE '14'           TO TM007-RETURN-CODE               08461099
084700           PERFORM 9000-NO-DISTRO-ERROR                           08470000
084800                                                                  08480000
084900     END-EVALUATE.                                                08490000
085000                                                                  08500000
085100                                                                  08510000
085200* -------------------------------------------------------------- *08520000
085300* -------------------------------------------------------------- *08530000
085400                                                                  08540000
085500 1230-LOAD-TO-STR-TABLE.                                          08550000
085600                                                                  08560000
085700     MOVE MESTDS-STR-NBR                                          08570000
085800       TO RC822-STORE-NBR          (RC822-STORE-IDX).             08580099
085900                                                                  08590017
086000     MOVE MESTDS-RNK-SEQ-NBR                                      08600000
086100       TO RC822-STORE-RNK-SEQ-NBR  (RC822-STORE-IDX).             08610099
086200                                                                  08620000
086300     MOVE MESTDS-STR-DISTRO-QTY                                   08630000
086400       TO RC822-STORE-DISTRO-QTY   (RC822-STORE-IDX)              08640099
086500          RC822-STORE-OTR-QTY      (RC822-STORE-IDX)              08650099
086600          PV-DISPLAY-QTY.                                         08660000
086700                                                                  08670021
086800     MOVE PV-DISPLAY-QTY                                          08680000
086900       TO RC822-STORE-DISTRO-QTY-X (RC822-STORE-IDX)              08690099
087000          RC822-STORE-OTR-QTY-X    (RC822-STORE-IDX).             08700099
087100                                                                  08710000
087200*    -------------------------------------                        08720043
087300*    CALCULATE PACKS FROM UNITS IF PREPACK                        08730043
087400*    -------------------------------------                        08740043
087500                                                                  08750000
087600     IF RC822-PREPACK-PACKAGE AND RC822-PO-PREPK-ID > 0           08760099
087700         IF PV-PURITM-RATO-QTY > +0                               08770039
087800             DIVIDE MESTDS-STR-DISTRO-QTY  BY  PV-PURITM-RATO-QTY 08780039
087900               GIVING  RC822-STORE-DISTRO-PK (RC822-STORE-IDX)    08790099
088000             MOVE RC822-STORE-DISTRO-PK     (RC822-STORE-IDX)     08800099
088100               TO RC822-STORE-OTR-PK        (RC822-STORE-IDX)     08810099
088200             ADD  RC822-STORE-DISTRO-PK     (RC822-STORE-IDX)     08820099
088300              TO  RC822-SUM-STR-PLAN-PK                           08830099
088400             ADD  RC822-STORE-OTR-PK        (RC822-STORE-IDX)     08840099
088500              TO  RC822-SUM-STR-OTR-PK                            08850099
088600         ELSE                                                     08860039
088700             MOVE ALL '*'                                         08870039
088800               TO RC822-STORE-DISTRO-PK-X (RC822-STORE-IDX)       08880099
088900         END-IF                                                   08890039
089000     END-IF.                                                      08900039
089100                                                                  08910000
089200     PERFORM 1220-FETCH-STORE-TABLE-CSR.                          08920000
089300                                                                  08930000
089400                                                                  08940000
089500* -------------------------------------------------------------- *08950000
089600* -------------------------------------------------------------- *08960000
089700                                                                  08970000
089800 1240-CLOSE-STORE-TABLE-CSR.                                      08980000
089900                                                                  08990000
           MOVE '1240-CLOSE-STORE-TABLE-CSR'  TO TM007-RETURNED-PARA.   08991099
                                                                        08992099
090000     EXEC SQL                                                     09000000
090100         CLOSE STORE-TABLE-CSR                                    09010000
090200     END-EXEC.                                                    09020000
090300                                                                  09030000
090400                                                                  09040000
090500     EVALUATE SQLCODE                                             09050074
090600                                                                  09060000
090700       WHEN +0                                                    09070074
090800           SET PS-CURSOR-CLOSED TO TRUE                           09080000
090900                                                                  09090099
091000       WHEN OTHER                                                 09100000
                 MOVE SQLCODE         TO TM007-SQLCODE                  09101099
                 MOVE SQLCA           TO TM007-SQLCA                    09102099
091100           MOVE 15              TO RC822-RETURN-CODE              09110099
                 MOVE '15'            TO TM007-RETURN-CODE              09111099
091200           PERFORM 9000-NO-DISTRO-ERROR                           09120000
091300                                                                  09130000
091400     END-EVALUATE.                                                09140000
091500                                                                  09150000
091600                                                                  09160000
091700* -------------------------------------------------------------- *09170000
091800*    RECEIVER OTR AT THE STORE LEVEL                              09180000
091900* -------------------------------------------------------------- *09190000
092000                                                                  09200000
082200 1300-RCVR-OTR.                                                   09210099
092200                                                                  09220000
092300     MOVE PV-APP-LINE-NBR TO DK-PO-LNE-NBR.                       09230096
092400                                                                  09240000
092500     PERFORM 7000-GET-RECITM-TMST.                                09250000
092600                                                                  09260000
092700     IF PS-ERRORS-NO                                              09270000
092800         PERFORM 7100-OPEN-RECITM-CURSOR                          09280000
092900     END-IF.                                                      09290000
093000                                                                  09300000
093100     IF PS-ERRORS-NO                                              09310000
093200         PERFORM 7110-FETCH-RECITM-CURSOR                         09320000
093300     END-IF.                                                      09330000
093400                                                                  09340000
093500     IF PS-PRIOR-CURSOR-EOF                                       09350000
093600         SET PS-ERRORS-YES TO TRUE                                09360000
093700     END-IF.                                                      09370000
093800                                                                  09380000
093900     IF PS-ERRORS-NO                                              09390000
094000         PERFORM 4000-PROCESS-RECITM-CURSOR                       09400000
094100           UNTIL PS-PRIOR-CURSOR-EOF                              09410000
094200              OR PS-ERRORS-YES                                    09420000
094300     END-IF.                                                      09430000
094400                                                                  09440000
094500     IF PS-CURSOR-OPEN                                            09450000
094600         PERFORM 7120-CLOSE-RECITM-CURSOR                         09460000
094700     END-IF.                                                      09470000
094800                                                                  09480000
094900                                                                  09490000
095000* -------------------------------------------------------------- *09500000
095100*    PO OTR AT THE STORE LEVEL                                    09510000
095200* -------------------------------------------------------------- *09520000
095300                                                                  09530000
095400 1400-PO-OTR.                                                     09540000
095500                                                                  09550000
095600     IF PS-ERRORS-NO                                              09560000
095700         MOVE PV-APP-LINE-NBR TO DK-PO-LNE-NBR                    09570096
095800         PERFORM 7200-OPEN-RECITM-CURSOR                          09580000
095900     END-IF.                                                      09590000
096000                                                                  09600000
096100     IF PS-ERRORS-NO                                              09610000
096200         PERFORM 7210-FETCH-RECITM-CURSOR                         09620000
096300     END-IF.                                                      09630000
096400                                                                  09640000
096500     IF PS-ERRORS-NO                                              09650000
096600         PERFORM 4000-PROCESS-RECITM-CURSOR                       09660000
096700           UNTIL PS-PRIOR-CURSOR-EOF                              09670000
096800              OR PS-ERRORS-YES                                    09680000
096900     END-IF.                                                      09690000
097000                                                                  09700000
097100     IF PS-CURSOR-OPEN                                            09710000
097200         PERFORM 7220-CLOSE-RECITM-CURSOR                         09720000
097300     END-IF.                                                      09730000
097400                                                                  09740000
097500                                                                  09750000
097600* -------------------------------------------------------------- *09760000
097700* -------------------------------------------------------------- *09770000
097800                                                                  09780000
097900 2000-LINE-LEVEL-OTR.                                             09790000
098000                                                                  09800000
098100     MOVE RC822-PO-PREPK-ID TO DK-PO-PREPK-ID.                    09810099
098200                                                                  09820000
098300     IF PS-ERRORS-NO                                              09830000
098400         PERFORM 2100-FILL-BASE-NUMBERS                           09840000
098500     END-IF.                                                      09850000
098600                                                                  09860000
098700     IF PS-ERRORS-NO                                              09870000
098800                                                                  09880074
098900         EVALUATE TRUE                                            09890000
099000                                                                  09900000
099100           WHEN RC822-RECEIVER-OTR                                09910099
099200               PERFORM 2200-PROCESS-RCVR-OTR-RCPTS                09920000
099300                 VARYING RC822-ITEM-IDX FROM 1 BY 1               09930099
099400                   UNTIL RC822-LINE-NBR (RC822-ITEM-IDX) = ZERO   09940099
099500                      OR RC822-FATAL-ERROR                        09950099
099600                                                                  09960000
099700           WHEN RC822-PO-OTR                                      09970099
099800               PERFORM 2300-PROCESS-PO-OTR-RCPTS                  09980000
099900                 VARYING RC822-ITEM-IDX FROM 1 BY 1               09990099
100000                   UNTIL RC822-LINE-NBR (RC822-ITEM-IDX) = ZERO   10000099
100100                      OR RC822-FATAL-ERROR                        10010099
100200                                                                  10020000
100300           WHEN OTHER                                             10030000
100400               MOVE 'INVALID OTR SCOPE FLAG' TO PV-RETURN-MSG     10040000
                                                      TM007-RETURN-MSG  10041099
100500               MOVE 16             TO RC822-RETURN-CODE           10050099
                     MOVE '16'           TO TM007-RETURN-CODE           10051099
100600                                                                  10060000
100700         END-EVALUATE                                             10070000
100800                                                                  10080000
100900     END-IF.                                                      10090000
101000                                                                  10100000
101100                                                                  10110000
101200* -------------------------------------------------------------- *10120000
101300* -------------------------------------------------------------- *10130000
101400                                                                  10140000
101500 2100-FILL-BASE-NUMBERS.                                          10150000
101600                                                                  10160000
101700     PERFORM 2110-OPEN-PLAN-CURSOR.                               10170000
101800                                                                  10180000
101900     IF PS-ERRORS-NO                                              10190000
102000         PERFORM 2120-FETCH-PLAN-CURSOR                           10200000
102100     END-IF.                                                      10210000
102200                                                                  10220000
102300     IF PS-PLAN-CSR-EOF                                           10230059
102400         SET PS-ERRORS-YES TO TRUE                                10240000
102500     END-IF.                                                      10250000
102600                                                                  10260000
102700     IF PS-ERRORS-NO                                              10270000
102800         PERFORM 2130-LOAD-PLANS                                  10280000
102900           VARYING RC822-ITEM-IDX FROM 1 BY 1                     10290099
103000             UNTIL PS-PLAN-CSR-EOF                                10300059
103100                OR RC822-SOFT-ABORT                               10310099
103200                OR RC822-ITEM-IDX > PC-MAX-ITEM-LINES             10320099
103300     END-IF.                                                      10330000
103400                                                                  10340000
103500     IF PS-CURSOR-OPEN                                            10350000
103600         PERFORM 2140-CLOSE-PLAN-CURSOR                           10360000
103700     END-IF.                                                      10370000
103800                                                                  10380000
103900                                                                  10390000
104000* -------------------------------------------------------------- *10400000
104100* -------------------------------------------------------------- *10410000
104200                                                                  10420000
104300 2110-OPEN-PLAN-CURSOR.                                           10430000
104400                                                                  10440000
           MOVE '2110-OPEN-PLAN-CURSOR'  TO TM007-RETURNED-PARA.        10441099
                                                                        10442099
104500     EVALUATE RC822-PO-PREPK-ID                                   10450099
104600                                                                  10460000
104700       WHEN ZERO                                                  10470098
104800                                                                  10480074
104900           EXEC SQL                                               10490000
105000               OPEN PLAN-LINE-CSR                                 10500000
105100           END-EXEC                                               10510000
105200                                                                  10520000
105300       WHEN OTHER                                                 10530000
105400                                                                  10540000
105500           EXEC SQL                                               10550000
105600               OPEN PLAN-CSR                                      10560000
105700           END-EXEC                                               10570000
105800                                                                  10580000
105900     END-EVALUATE.                                                10590000
106000                                                                  10600000
106100                                                                  10610000
106200     EVALUATE SQLCODE                                             10620074
106300                                                                  10630000
106400       WHEN +0                                                    10640074
106500           SET PS-CURSOR-OPEN TO TRUE                             10650000
106600                                                                  10660000
106700       WHEN -904                                                  10670074
106800       WHEN -911                                                  10680074
106900       WHEN -913                                                  10690074
                 MOVE SQLCODE         TO TM007-SQLCODE                  10691099
                 MOVE SQLCA           TO TM007-SQLCODE                  10692099
107000           SET PS-CURSOR-CLOSED TO TRUE                           10700000
107100           MOVE 17              TO RC822-RETURN-CODE              10710099
                 MOVE '17'            TO TM007-RETURN-CODE              10711099
107200           PERFORM 9900-SOFT-ABORT                                10720000
107300                                                                  10730000
107400       WHEN OTHER                                                 10740000
                 MOVE SQLCODE         TO TM007-SQLCODE                  10741099
                 MOVE SQLCA           TO TM007-SQLCODE                  10742099
107500           SET PS-CURSOR-CLOSED TO TRUE                           10750000
107600           MOVE 18              TO RC822-RETURN-CODE              10760099
                 MOVE '18'            TO TM007-RETURN-CODE              10761099
107700           PERFORM 9800-PGM-ABEND                                 10770000
107800                                                                  10780000
107900     END-EVALUATE.                                                10790000
108000                                                                  10800000
108100                                                                  10810000
108200* -------------------------------------------------------------- *10820000
108300* -------------------------------------------------------------- *10830000
108400                                                                  10840000
108500 2120-FETCH-PLAN-CURSOR.                                          10850000
108600                                                                  10860000
           MOVE '2120-GET-TALLPLN'  TO TM007-RETURNED-PARA.             10861099
                                                                        10862099
108700     EVALUATE RC822-PO-PREPK-ID                                   10870099
108800                                                                  10880000
108900       WHEN ZERO                                                  10890098
109000                                                                  10900000
109100           EXEC SQL                                               10910000
109200                                                                  10920000
109300              FETCH PLAN-LINE-CSR                                 10930000
109400                                                                  10940000
109500               INTO :PURITM-PO-LNE-NBR                            10950000
109600                  , :PURITM-APP-PO-LNE-NBR                        10960000
109700                  , :PURITM-PREPK-RATO-QTY                        10970000
109800                                                                  10980000
109900           END-EXEC                                               10990000
110000                                                                  11000000
110100       WHEN OTHER                                                 11010000
110200                                                                  11020000
110300           EXEC SQL                                               11030000
110400                                                                  11040000
110500              FETCH PLAN-CSR                                      11050000
110600                                                                  11060000
110700               INTO :PURITM-PO-LNE-NBR                            11070000
110800                  , :PURITM-APP-PO-LNE-NBR                        11080000
110900                  , :PURITM-PREPK-RATO-QTY                        11090000
111000                                                                  11100000
111100           END-EXEC                                               11110000
111200                                                                  11120000
111300     END-EVALUATE.                                                11130000
111400                                                                  11140000
111500                                                                  11150000
111600     EVALUATE SQLCODE                                             11160074
111700                                                                  11170000
111800       WHEN +0                                                    11180074
111900           CONTINUE                                               11190000
112000                                                                  11200000
112100       WHEN +100                                                  11210074
112200           SET PS-PLAN-CSR-EOF TO TRUE                            11220059
112300                                                                  11230000
112400       WHEN OTHER                                                 11240000
                 MOVE SQLCODE        TO TM007-SQLCODE                   11241099
                 MOVE SQLCA          TO TM007-SQLCA                     11242099
112500           MOVE 19             TO RC822-RETURN-CODE               11250099
                 MOVE '19'           TO TM007-RETURN-CODE               11251099
112600           PERFORM 9800-PGM-ABEND                                 11260000
112700                                                                  11270000
112800     END-EVALUATE.                                                11280000
112900                                                                  11290000
113000                                                                  11300000
113100* -------------------------------------------------------------- *11310000
113200* -------------------------------------------------------------- *11320000
113300                                                                  11330000
113400 2130-LOAD-PLANS.                                                 11340000
113500                                                                  11350000
113600     MOVE RC822-PO-NBR          TO DK-PO-NBR.                     11360099
113700     MOVE PURITM-PO-LNE-NBR     TO DK-PO-LNE-NBR.                 11370096
113800     MOVE PURITM-APP-PO-LNE-NBR TO RC822-LINE-NBR (RC822-ITEM-IDX)11380099
113900                                                                  11390000
114000     IF RC822-BULK-PACKAGE                                        11400099
114100         MOVE +1 TO PV-PURITM-RATO-QTY                            11410000
114200     ELSE                                                         11420000
114300         MOVE PURITM-PREPK-RATO-QTY TO PV-PURITM-RATO-QTY         11430000
114400     END-IF.                                                      11440000
114500                                                                  11450099
114600     PERFORM 1110-GET-TALLPLN.                                    11460000
114700                                                                  11470000
114800     IF SQLCODE = +0                                              11480096
114900         PERFORM 2150-SUM-ALL-STORES                              11490000
115000                                                                  11500000
115100         EVALUATE TRUE                                            11510000
115200                                                                  11520000
115300           WHEN SQLCODE = +0                                      11530096
115400           WHEN SQLCODE = +100                                    11540096
115500           WHEN SQLCODE = -305                                    11550096
115600               MOVE MESTDS-STR-DISTRO-QTY                         11560000
115700                 TO RC822-LINE-DISTRO-QTY    (RC822-ITEM-IDX)     11570099
115800                    RC822-LINE-OTR-QTY       (RC822-ITEM-IDX)     11580099
115900                    PV-DISPLAY-QTY                                11590000
116000               MOVE PV-DISPLAY-QTY                                11600000
116100                 TO RC822-LINE-DISTRO-QTY-X  (RC822-ITEM-IDX)     11610099
116200                    RC822-LINE-OTR-QTY-X     (RC822-ITEM-IDX)     11620099
116300                                                                  11630000
116400           WHEN PS-LINE-HAS-DISTRO-NO                             11640000
116500               MOVE ALL '*'                                       11650002
116600                 TO RC822-LINE-OTR-QTY-X     (RC822-ITEM-IDX)     11660099
116700               MOVE +0                                            11670000
116800                 TO PV-DISPLAY-QTY                                11680000
116900                    RC822-LINE-OTR-QTY       (RC822-ITEM-IDX)     11690099
117000                    RC822-LINE-DISTRO-QTY    (RC822-ITEM-IDX)     11700099
117100               MOVE PV-DISPLAY-QTY                                11710000
117200                 TO RC822-LINE-DISTRO-QTY-X  (RC822-ITEM-IDX)     11720099
117300                                                                  11730000
117400           WHEN OTHER                                             11740000
117500               MOVE ALL '*'                                       11750099
117600                 TO RC822-LINE-OTR-QTY-X     (RC822-ITEM-IDX)     11760099
117700               MOVE +0                                            11770099
117800                 TO PV-DISPLAY-QTY                                11780099
117900                    RC822-LINE-OTR-QTY       (RC822-ITEM-IDX)     11790099
118000                    RC822-LINE-DISTRO-QTY    (RC822-ITEM-IDX)     11800099
118100               MOVE PV-DISPLAY-QTY                                11810099
118200                 TO RC822-LINE-DISTRO-QTY-X  (RC822-ITEM-IDX)     11820099
118300         END-EVALUATE                                             11830000
118400     END-IF.                                                      11840000
118500                                                                  11850000
118600     IF PS-ERRORS-NO AND (NOT RC822-SOFT-ABORT)                   11860099
118700         PERFORM 2120-FETCH-PLAN-CURSOR                           11870000
118800     END-IF.                                                      11880000
118900                                                                  11890000
119000                                                                  11900000
119100* -------------------------------------------------------------- *11910000
119200* -------------------------------------------------------------- *11920000
119300                                                                  11930000
119400 2140-CLOSE-PLAN-CURSOR.                                          11940000
119500                                                                  11950000
           MOVE '2140-CLOSE-PLAN-CURSOR'  TO TM007-RETURNED-PARA.       11951099
                                                                        11952099
119600     EVALUATE RC822-PO-PREPK-ID                                   11960099
119700                                                                  11970000
119800       WHEN ZERO                                                  11980098
119900                                                                  11990000
120000           EXEC SQL                                               12000000
120100              CLOSE PLAN-LINE-CSR                                 12010000
120200           END-EXEC                                               12020000
120300                                                                  12030000
120400       WHEN OTHER                                                 12040000
120500                                                                  12050000
120600           EXEC SQL                                               12060000
120700              CLOSE PLAN-CSR                                      12070000
120800           END-EXEC                                               12080000
120900                                                                  12090000
121000     END-EVALUATE.                                                12100000
121100                                                                  12110000
121200                                                                  12120000
121300     EVALUATE SQLCODE                                             12130074
121400                                                                  12140000
121500       WHEN +0                                                    12150074
121600           SET PS-CURSOR-CLOSED TO TRUE                           12160000
121700                                                                  12170000
121800       WHEN OTHER                                                 12180000
                 MOVE SQLCODE         TO TM007-SQLCODE                  12181099
                 MOVE SQLCA           TO TM007-SQLCA                    12182099
121900           MOVE 20              TO RC822-RETURN-CODE              12190099
                 MOVE '20'            TO TM007-RETURN-CODE              12191099
122000           PERFORM 9800-PGM-ABEND                                 12200000
122100                                                                  12210000
122200     END-EVALUATE.                                                12220000
122300                                                                  12230000
122400                                                                  12240000
122500* -------------------------------------------------------------- *12250000
122600* -------------------------------------------------------------- *12260000
122700                                                                  12270000
122800 2150-SUM-ALL-STORES.                                             12280000
                                                                        12280199
           MOVE '2150-SUM-ALL-STORES'  TO TM007-RETURNED-PARA.          12281099
122900                                                                  12290000
123000     MOVE +0 TO MESTDS-STR-DISTRO-QTY.                            12300000
123100                                                                  12310000
123200     IF RC822-STR-NBR EQUAL ZERO                                  12320099
123300                                                                  12330000
123400         EXEC SQL                                                 12340000
123500                                                                  12350000
123600             SELECT SUM(STR_DISTRO_QTY)                           12360000
123700                                                                  12370000
123800               INTO :MESTDS-STR-DISTRO-QTY                        12380000
123900                                                                  12390000
124000             FROM TMESTDS                                         12400097
124100                                                                  12410000
124200             WHERE PO_NBR      =  :DK-PO-NBR                      12420000
124300               AND PO_LNE_NBR  =  :DK-PO-LNE-NBR                  12430096
124400               AND PLAN_NBR    =  :ALLPLN-PLAN-NBR                12440000
124500                                                                  12450000
124600         END-EXEC                                                 12460000
124700     ELSE                                                         12470000
124800         EXEC SQL                                                 12480000
124900                                                                  12490000
125000             SELECT STR_DISTRO_QTY                                12500000
125100                                                                  12510000
125200               INTO :MESTDS-STR-DISTRO-QTY                        12520000
125300                                                                  12530000
125400             FROM TMESTDS                                         12540097
125500                                                                  12550000
125600             WHERE PO_NBR      =  :DK-PO-NBR                      12560000
125700               AND PO_LNE_NBR  =  :DK-PO-LNE-NBR                  12570096
125800               AND PLAN_NBR    =  :ALLPLN-PLAN-NBR                12580000
125900               AND STR_NBR     =  :RC822-STR-NBR                  12590099
126000                                                                  12600000
126100         END-EXEC                                                 12610000
126200                                                                  12620000
126300     END-IF.                                                      12630000
126400                                                                  12640000
126500                                                                  12650000
126600     EVALUATE SQLCODE                                             12660074
126700                                                                  12670000
126800       WHEN +0                                                    12680074
126900                                                                  12690099
127000           IF RC822-STR-NBR EQUAL ZERO AND                        12700099
127100             (MESTDS-STR-DISTRO-QTY NOT = ALLPLN-CURR-SPLIT-QTY)  12710098
127200               MOVE ALLPLN-CURR-SPLIT-QTY TO MESTDS-STR-DISTRO-QTY12720000
127300           END-IF                                                 12730000
127400                                                                  12740000
127500       WHEN +100                                                  12750074
127600       WHEN -305                                                  12760074
                 MOVE SQLCODE                   TO TM007-SQLCODE        12761099
                 MOVE SQLCA                     TO TM007-SQLCA          12762099
127700                                                                  12770000
127800           IF RC822-STR-NBR EQUAL ZERO                            12780099
127900               MOVE ALLPLN-CURR-SPLIT-QTY TO MESTDS-STR-DISTRO-QTY12790000
128000           ELSE                                                   12800000
128100               MOVE 21                   TO RC822-RETURN-CODE     12810099
                     MOVE '21'                 TO TM007-RETURN-CODE     12811099
128200               SET PS-LINE-HAS-DISTRO-NO TO TRUE                  12820000
128300               PERFORM 9000-NO-DISTRO-ERROR                       12830000
128400           END-IF                                                 12840000
128500                                                                  12850000
128600       WHEN -904                                                  12860074
128700       WHEN -911                                                  12870074
128800       WHEN -913                                                  12880074
                 MOVE SQLCODE             TO TM007-SQLCODE              12881099
                 MOVE SQLCA               TO TM007-SQLCA                12882099
128900           MOVE 22                  TO RC822-RETURN-CODE          12890099
                 MOVE '22'                TO TM007-RETURN-CODE          12891099
129000           PERFORM 9900-SOFT-ABORT                                12900000
129100                                                                  12910000
129200       WHEN OTHER                                                 12920000
                 MOVE SQLCODE             TO TM007-SQLCODE              12921099
                 MOVE SQLCA               TO TM007-SQLCA                12922099
129300           MOVE 23                  TO RC822-RETURN-CODE          12930099
                 MOVE '23'                TO TM007-RETURN-CODE          12931099
129400           SET PS-LINE-HAS-DISTRO-NO TO TRUE                      12940000
129500           PERFORM 9000-NO-DISTRO-ERROR                           12950000
129600                                                                  12960000
129700     END-EVALUATE.                                                12970000
129800                                                                  12980000
129900                                                                  12990000
130000* -------------------------------------------------------------- *13000000
130100*    RECEIVER OTR AT THE LINE LEVEL                               13010000
130200* -------------------------------------------------------------- *13020000
130300                                                                  13030000
130400 2200-PROCESS-RCVR-OTR-RCPTS.                                     13040000
130500                                                                  13050000
130600*    ---------------------------------------------------          13060000
130700*    ALL '*' INDICATES A 'NO DISTRO' ERROR FOR THE LINE           13070000
130800*    ---------------------------------------------------          13080000
130900                                                                  13090000
131000     IF RC822-LINE-OTR-QTY-X (RC822-ITEM-IDX) EQUAL ALL '*'       13100099
131100         SET PS-ERRORS-YES TO TRUE                                13110000
131200     ELSE                                                         13120000
131300         SET PS-ERRORS-NO                                         13130000
131400             PS-PRIOR-CURSOR-START TO TRUE                        13140000
131500         MOVE RC822-LINE-NBR (RC822-ITEM-IDX) TO DK-PO-LNE-NBR    13150099
131600         PERFORM 7000-GET-RECITM-TMST                             13160000
131700     END-IF                                                       13170000
131800                                                                  13180000
131900     IF PS-ERRORS-NO AND (NOT RC822-FATAL-ERROR)                  13190099
132000         PERFORM 7100-OPEN-RECITM-CURSOR                          13200000
132100     END-IF.                                                      13210000
132200                                                                  13220000
132300     IF PS-ERRORS-NO AND (NOT RC822-FATAL-ERROR)                  13230099
132400         PERFORM 7110-FETCH-RECITM-CURSOR                         13240000
132500     END-IF.                                                      13250000
132600                                                                  13260000
132700     IF PS-PRIOR-CURSOR-EOF                                       13270000
132800         SET PS-ERRORS-YES TO TRUE                                13280000
132900     END-IF.                                                      13290000
133000                                                                  13300000
133100     IF PS-ERRORS-NO                                              13310000
133200         PERFORM 6000-PROCESS-RECITM-CURSOR                       13320000
133300           UNTIL PS-PRIOR-CURSOR-EOF                              13330000
133400             OR  PS-ERRORS-YES                                    13340074
133500             OR  RC822-FATAL-ERROR                                13350099
133600     END-IF.                                                      13360000
133700                                                                  13370000
133800     IF PS-CURSOR-OPEN                                            13380000
133900         PERFORM 7120-CLOSE-RECITM-CURSOR                         13390000
134000     END-IF.                                                      13400000
134100                                                                  13410000
134200                                                                  13420000
134300* -------------------------------------------------------------- *13430000
134400*    PO OTR AT THE LINE LEVEL                                     13440000
134500* -------------------------------------------------------------- *13450000
134600                                                                  13460000
134700 2300-PROCESS-PO-OTR-RCPTS.                                       13470000
134800                                                                  13480000
134900*    ---------------------------------------------------          13490000
135000*    ALL '*' INDICATES A 'NO DISTRO' ERROR FOR THE LINE           13500000
135100*    ---------------------------------------------------          13510000
135200                                                                  13520000
135300     IF RC822-LINE-OTR-QTY-X (RC822-ITEM-IDX) EQUAL ALL '*'       13530099
135400         SET PS-ERRORS-YES TO TRUE                                13540000
135500     ELSE                                                         13550000
135600         SET PS-ERRORS-NO TO TRUE                                 13560000
135700         MOVE RC822-LINE-NBR (RC822-ITEM-IDX) TO DK-PO-LNE-NBR    13570099
135800         PERFORM 7200-OPEN-RECITM-CURSOR                          13580000
135900     END-IF.                                                      13590000
136000                                                                  13600000
136100     IF PS-ERRORS-NO                                              13610000
136200         SET PS-PRIOR-CURSOR-START TO TRUE                        13620000
136300         PERFORM 7210-FETCH-RECITM-CURSOR                         13630000
136400     END-IF.                                                      13640000
136500                                                                  13650000
136600     IF PS-ERRORS-NO                                              13660000
136700         PERFORM 6000-PROCESS-RECITM-CURSOR                       13670000
136800            UNTIL PS-PRIOR-CURSOR-EOF                             13680000
136900              OR  PS-ERRORS-YES                                   13690074
137000              OR  RC822-FATAL-ERROR                               13700099
137100     END-IF.                                                      13710000
137200                                                                  13720000
137300     IF PS-CURSOR-OPEN                                            13730000
137400         PERFORM 7220-CLOSE-RECITM-CURSOR                         13740000
137500     END-IF.                                                      13750000
137600                                                                  13760000
137700                                                                  13770000
137800* -------------------------------------------------------------- *13780000
137900* -------------------------------------------------------------- *13790000
138000                                                                  13800000
138100 4000-PROCESS-RECITM-CURSOR.                                      13810000
138200                                                                  13820000
138300     PERFORM 4100-APPLY-PRIOR-RECEIPTS                            13830000
138400       VARYING RC822-STORE-IDX FROM 1 BY 1                        13840099
138500         UNTIL RC822-STORE-NBR (RC822-STORE-IDX) EQUAL ZERO       13850099
138600            OR RC822-STORE-IDX > PC-MAX-STORES.                   13860099
138700                                                                  13870000
138800     IF PS-ERRORS-NO                                              13880000
138900         IF RC822-RECEIVER-OTR                                    13890099
139000             PERFORM 7110-FETCH-RECITM-CURSOR                     13900000
139100         ELSE                                                     13910000
139200             PERFORM 7210-FETCH-RECITM-CURSOR                     13920000
139300         END-IF                                                   13930000
139400     END-IF.                                                      13940000
139500                                                                  13950000
139600                                                                  13960000
139700* -------------------------------------------------------------- *13970000
139800*    THIS PARAGRAPH RETRIEVES THE RECDIS RECORD FOR A GIVEN STORE.13980000
139900*    IT THEN ADDS INTO THE STORE ARRAY THE CORRECT STORE RECEIPTS 13990000
140000*    DEPENDING UPON THE STATUS CODE OF THE RECITM.                14000000
140100* -------------------------------------------------------------- *14010000
140200                                                                  14020000
140300 4100-APPLY-PRIOR-RECEIPTS.                                       14030000
140400                                                                  14040000
           MOVE '4100-APPLY-PRIOR-RECEIPTS'  TO TM007-RETURNED-PARA.    14041099
                                                                        14042099
140500     MOVE RC822-STORE-NBR (RC822-STORE-IDX) TO RECDIS-STR-NBR.    14050099
140600                                                                  14060000
140700     IF RECITM-STATUS-CDE EQUAL PC-VE                             14070096
140800                                                                  14080000
140900         EXEC SQL                                                 14090000
141000                                                                  14100000
141100             SELECT AP_VERIFY_ITM_QTY                             14110000
141200                                                                  14120000
141300               INTO :PV-RECEIVED-QTY                              14130000
141400                                                                  14140000
141500             FROM TRECDIS                                         14150097
141600                                                                  14160000
141700             WHERE ORD_NBR         =  :RC822-PO-NBR               14170099
141800               AND ORD_LNE_NBR     =  :DK-PO-LNE-NBR              14180096
141900               AND REC_SEQ_NBR     =  :RECITM-REC-SEQ-NBR         14190000
142000               AND OPER_UNT_ID     =  :RC822-OPER-UNT-ID          14200099
142200               AND STR_NBR         =  :RECDIS-STR-NBR             14220000
142300               AND STR_FCLTY_ID    =  :PC-ONE                     14230000
142400                                                                  14240000
142500         END-EXEC                                                 14250000
142600     ELSE                                                         14260000
142700                                                                  14270000
142800         EXEC SQL                                                 14280000
142900                                                                  14290000
143000             SELECT EXPTED_ITM_QTY                                14300000
143100                                                                  14310000
143200               INTO :PV-RECEIVED-QTY                              14320000
143300                                                                  14330000
143400             FROM TRECDIS                                         14340097
143500                                                                  14350000
143600             WHERE ORD_NBR         =  :RC822-PO-NBR               14360099
143700               AND ORD_LNE_NBR     =  :DK-PO-LNE-NBR              14370096
143800               AND REC_SEQ_NBR     =  :RECITM-REC-SEQ-NBR         14380000
143900               AND OPER_UNT_ID     =  :RC822-OPER-UNT-ID          14390099
144100               AND STR_NBR         =  :RECDIS-STR-NBR             14410000
144200               AND STR_FCLTY_ID    =  :PC-ONE                     14420000
144300                                                                  14430000
144400         END-EXEC                                                 14440000
144500                                                                  14450000
144600     END-IF.                                                      14460032
144700                                                                  14470000
144800                                                                  14480000
144900     EVALUATE SQLCODE                                             14490074
145000                                                                  14500000
145100       WHEN +0                                                    14510074
145200                                                                  14520000
                 MOVE SQLCODE        TO TM007-SQLCODE                   14521099
                 MOVE SQLCA          TO TM007-SQLCA                     14522099
145300           ADD PV-RECEIVED-QTY TO PV-TOT-RECEIVED-QTY             14530021
145400                                                                  14540021
145500           SUBTRACT PV-RECEIVED-QTY                               14550000
145600             FROM   RC822-STORE-OTR-QTY (RC822-STORE-IDX)         14560099
145700                    RC822-SUM-STR-OTR-QTY                         14570099
145800                                                                  14580039
145900* -------------------------------------------------------------- *14590039
146000*    CALCULATE PACK QUANTITY.                                    *14600074
146100*                                                                *14610074
146200*    NOTE:                                                       *14620074
146300*                                                                *14630074
146400*    ON A NON DRIVER LINE RECEIVER RATIO QUANTITY IS DEFAULTED   *14640074
146500*    TO THE PURITM RATIO.                                        *14650074
146600* -------------------------------------------------------------- *14660039
146700                                                                  14670039
146800           IF RC822-PREPACK-PACKAGE AND RC822-PO-PREPK-ID > 0     14680099
146900               IF PV-RECITM-RATO-QTY > +0                         14690039
147000                                                                  14700041
147100                  DIVIDE PV-RECEIVED-QTY                          14710099
147200                    BY   PV-RECITM-RATO-QTY                       14720074
147300                    GIVING  PV-RECEIVED-QTY-PK                    14730074
147400                                                                  14740041
147500                   SUBTRACT PV-RECEIVED-QTY-PK                    14750039
147600                     FROM   RC822-STORE-OTR-PK (RC822-STORE-IDX)  14760099
147700                            RC822-SUM-STR-OTR-PK                  14770099
147800               ELSE                                               14780067
147900                   MOVE ALL '*'                                   14790067
148000                     TO RC822-STORE-OTR-PK-X (RC822-STORE-IDX)    14800099
148100                   MOVE +0 TO PV-RECEIVED-QTY-PK                  14810071
148200               END-IF                                             14820067
148300           END-IF                                                 14830067
148400                                                                  14840067
148500           IF RC822-STORE-OTR-QTY (RC822-STORE-IDX) > +0          14850099
148600               MOVE RC822-STORE-OTR-QTY (RC822-STORE-IDX)         14860099
148700                 TO PV-DISPLAY-QTY                                14870000
148800           ELSE                                                   14880000
148900               MOVE +0 TO PV-DISPLAY-QTY                          14890000
149000           END-IF                                                 14900000
149100                                                                  14910000
149200           MOVE PV-DISPLAY-QTY                                    14920000
149300             TO RC822-STORE-OTR-QTY-X (RC822-STORE-IDX)           14930099
149400                                                                  14940000
149500       WHEN +100                                                  14950074
149600           MOVE +0 TO PV-RECEIVED-QTY                             14960000
149700                                                                  14970000
149800       WHEN -904                                                  14980074
149900       WHEN -911                                                  14990074
150000       WHEN -913                                                  15000074
                 MOVE SQLCODE      TO TM007-SQLCODE                     15001099
                 MOVE SQLCA        TO TM007-SQLCA                       15002099
150100           MOVE 24           TO RC822-RETURN-CODE                 15010099
                 MOVE '24'         TO TM007-RETURN-CODE                 15011099
150200           PERFORM 9900-SOFT-ABORT                                15020000
150300                                                                  15030000
150400       WHEN OTHER                                                 15040000
                 MOVE SQLCODE      TO TM007-SQLCODE                     15041099
                 MOVE SQLCA        TO TM007-SQLCA                       15042099
150500           MOVE 25           TO RC822-RETURN-CODE                 15050099
                 MOVE '25'         TO TM007-RETURN-CODE                 15051099
150600           PERFORM 9800-PGM-ABEND                                 15060000
150700                                                                  15070000
150800     END-EVALUATE.                                                15080000
150900                                                                  15090000
151000                                                                  15100000
151100* -------------------------------------------------------------- *15110000
151200* -------------------------------------------------------------- *15120000
151300                                                                  15130000
151400 6000-PROCESS-RECITM-CURSOR.                                      15140000
151500                                                                  15150000
151600     PERFORM 6110-APPLY-PRIOR-RECEIPTS.                           15160099
151700                                                                  15170000
151800     IF PS-ERRORS-NO                                              15180000
151900         IF RC822-RECEIVER-OTR                                    15190099
152000             PERFORM 7110-FETCH-RECITM-CURSOR                     15200000
152100         ELSE                                                     15210000
152200             PERFORM 7210-FETCH-RECITM-CURSOR                     15220000
152300         END-IF                                                   15230000
152400     END-IF.                                                      15240000
152500                                                                  15250000
152600                                                                  15260000
152700* -------------------------------------------------------------- *15270000
152800* -------------------------------------------------------------- *15280000
152900                                                                  15290000
153000 6110-APPLY-PRIOR-RECEIPTS.                                       15300000
153100                                                                  15310000
           MOVE '6110-APPLY-PRIOR-RECEIPTS'  TO TM007-RETURNED-PARA.    15311099
                                                                        15312099
153200     MOVE RC822-LINE-NBR (RC822-ITEM-IDX) TO RECDIS-ORD-LNE-NBR.  15320099
153300                                                                  15330000
153400     EVALUATE TRUE                                                15340000
153500                                                                  15350000
153600       WHEN RECITM-STATUS-CDE EQUAL PC-VE                         15360096
153700                                                                  15370000
153800           IF RC822-STR-NBR EQUAL ZERO                            15380099
153900                                                                  15390000
154000               EXEC SQL                                           15400000
154100                                                                  15410000
154200                   SELECT SUM(AP_VERIFY_ITM_QTY)                  15420000
154300                                                                  15430000
154400                     INTO :PV-RECEIVED-QTY                        15440000
154500                                                                  15450000
154600                   FROM TRECDIS                                   15460097
154700                                                                  15470000
154800                   WHERE ORD_NBR         =  :RC822-PO-NBR         15480099
154900                     AND ORD_LNE_NBR     =  :RECDIS-ORD-LNE-NBR   15490000
155000                     AND REC_SEQ_NBR     =  :RECITM-REC-SEQ-NBR   15500000
155100                     AND OPER_UNT_ID     =  :RC822-OPER-UNT-ID    15510099
155300                     AND STR_FCLTY_ID    =  :PC-ONE               15530000
155400                                                                  15540000
155500               END-EXEC                                           15550000
155600           ELSE                                                   15560000
155700                                                                  15570000
155800               EXEC SQL                                           15580000
155900                                                                  15590000
156000                   SELECT AP_VERIFY_ITM_QTY                       15600000
156100                                                                  15610000
156200                     INTO :PV-RECEIVED-QTY                        15620000
156300                                                                  15630000
156400                   FROM TRECDIS                                   15640097
156500                                                                  15650000
156600                   WHERE ORD_NBR         =  :RC822-PO-NBR         15660099
156700                     AND ORD_LNE_NBR     =  :RECDIS-ORD-LNE-NBR   15670000
156800                     AND REC_SEQ_NBR     =  :RECITM-REC-SEQ-NBR   15680000
156900                     AND OPER_UNT_ID     =  :RC822-OPER-UNT-ID    15690099
157000                     AND FCLTY_ID        =  :RC822-FCLTY-ID       15700099
157100                     AND STR_NBR         =  :RC822-STR-NBR        15710099
157200                     AND STR_FCLTY_ID    =  :PC-ONE               15720000
157400                                                                  15740000
157500               END-EXEC                                           15750000
157600                                                                  15760000
157700           END-IF                                                 15770000
157800                                                                  15780000
157900       WHEN RECITM-STATUS-CDE EQUAL PC-IP OR PC-CM                15790096
158000                                                                  15800000
158100           IF RC822-STR-NBR EQUAL ZERO                            15810099
158200                                                                  15820000
158300               EXEC SQL                                           15830000
158400                                                                  15840000
158500                   SELECT SUM(EXPTED_ITM_QTY)                     15850000
158600                                                                  15860000
158700                     INTO :PV-RECEIVED-QTY                        15870000
158800                                                                  15880000
158900                   FROM TRECDIS                                   15890097
159000                                                                  15900000
159100                   WHERE ORD_NBR         =  :RC822-PO-NBR         15910099
159200                     AND ORD_LNE_NBR     =  :RECDIS-ORD-LNE-NBR   15920000
159300                     AND REC_SEQ_NBR     =  :RECITM-REC-SEQ-NBR   15930000
159400                     AND OPER_UNT_ID     =  :RC822-OPER-UNT-ID    15940099
159500                     AND FCLTY_ID        =  :RC822-FCLTY-ID       15950099
159700                     AND STR_FCLTY_ID    =  :PC-ONE               15970000
159800                                                                  15980000
159900               END-EXEC                                           15990000
160000                                                                  16000000
160100           ELSE                                                   16010000
160200                                                                  16020000
160300               EXEC SQL                                           16030000
160400                                                                  16040000
160500                   SELECT EXPTED_ITM_QTY                          16050000
160600                                                                  16060000
160700                     INTO :PV-RECEIVED-QTY                        16070000
160800                                                                  16080000
160900                   FROM TRECDIS                                   16090097
161000                                                                  16100000
161100                   WHERE ORD_NBR         =  :RC822-PO-NBR         16110099
161200                     AND ORD_LNE_NBR     =  :RECDIS-ORD-LNE-NBR   16120000
161300                     AND REC_SEQ_NBR     =  :RECITM-REC-SEQ-NBR   16130000
161400                     AND OPER_UNT_ID     =  :RC822-OPER-UNT-ID    16140099
161500                     AND FCLTY_ID        =  :RC822-FCLTY-ID       16150099
161600                     AND STR_NBR         =  :RC822-STR-NBR        16160099
161800                     AND STR_FCLTY_ID    =  :PC-ONE               16180000
161900                                                                  16190000
162000               END-EXEC                                           16200000
162100                                                                  16210000
162200           END-IF                                                 16220000
162300                                                                  16230000
162400     END-EVALUATE.                                                16240000
162500                                                                  16250000
162600                                                                  16260000
162700     EVALUATE SQLCODE                                             16270074
162800                                                                  16280000
162900       WHEN +0                                                    16290074
163000                                                                  16300000
163100           SUBTRACT PV-RECEIVED-QTY                               16310000
163200             FROM   RC822-LINE-OTR-QTY (RC822-ITEM-IDX)           16320099
163300                                                                  16330000
163400           IF RC822-LINE-OTR-QTY (RC822-ITEM-IDX) > +0            16340099
163500               MOVE RC822-LINE-OTR-QTY (RC822-ITEM-IDX)           16350099
163600                 TO PV-DISPLAY-QTY                                16360000
163700           ELSE                                                   16370000
163800               MOVE +0 TO PV-DISPLAY-QTY                          16380000
163900           END-IF                                                 16390000
164000                                                                  16400000
164100           MOVE PV-DISPLAY-QTY                                    16410000
164200             TO RC822-LINE-OTR-QTY-X (RC822-ITEM-IDX)             16420099
164300                                                                  16430000
164400       WHEN +100                                                  16440074
164500       WHEN -305                                                  16450074
164600           MOVE +0 TO PV-RECEIVED-QTY                             16460000
164700                                                                  16470000
164800       WHEN -904                                                  16480074
164900       WHEN -911                                                  16490074
165000       WHEN -913                                                  16500074
                 MOVE SQLCODE       TO TM007-SQLCODE                    16501099
                 MOVE SQLCA         TO TM007-SQLCA                      16502099
65100           MOVE 28            TO RC822-RETURN-CODE                16510099
                 MOVE '28'          TO TM007-RETURN-CODE                16511099
165200           PERFORM 9900-SOFT-ABORT                                16520000
165300                                                                  16530000
165400       WHEN OTHER                                                 16540000
                 MOVE SQLCODE       TO TM007-SQLCODE                    16541099
                 MOVE SQLCA         TO TM007-SQLCA                      16542099
165500           MOVE 29            TO RC822-RETURN-CODE                16550099
                 MOVE '29'          TO TM007-RETURN-CODE                16551099
165600           PERFORM 9800-PGM-ABEND                                 16560000
165700                                                                  16570000
165800     END-EVALUATE.                                                16580000
165900                                                                  16590000
166000                                                                  16600000
166100* -------------------------------------------------------------- *16610000
166200*    THIS PARAGRAPH RETRIEVES THE EARLIEST TIMESTAMP FOR A PO     16620000
166300*    AND RECEIVER WITHIN A DC.                                    16630000
166400* -------------------------------------------------------------- *16640000
166500                                                                  16650000
166600 7000-GET-RECITM-TMST.                                            16660000
166700                                                                  16670099
           MOVE '7000-GET-RECITM-TMST'  TO TM007-RETURNED-PARA.         16671099
                                                                        16672099
166800     EXEC SQL                                                     16680000
166900                                                                  16690000
167000         SELECT CRE_TMST                                          16700000
167100                                                                  16710000
167200           INTO :RECITM-CRE-TMST                                  16720000
167300                                                                  16730000
167400         FROM TRECITM                                             16740097
167500                                                                  16750000
167600         WHERE ORD_NBR      =  :RC822-PO-NBR                      16760099
167700           AND REC_SEQ_NBR  =  :RC822-REC-SEQ-NBR                 16770099
167800           AND ORD_LNE_NBR  =  :DK-PO-LNE-NBR                     16780096
167900           AND OPER_UNT_ID  =  :RC822-OPER-UNT-ID                 16790099
168000                                                                  16800000
168100     END-EXEC.                                                    16810000
168200                                                                  16820000
168300                                                                  16830000
168400     EVALUATE SQLCODE                                             16840074
168500                                                                  16850000
168600       WHEN +0                                                    16860074
168700           CONTINUE                                               16870000
168800                                                                  16880000
168900       WHEN +100                                                  16890074
169000                                                                  16900000
169100           EXEC SQL                                               16910000
169200               SET :RECITM-CRE-TMST = CURRENT TIMESTAMP           16920000
169300           END-EXEC                                               16930000
169400                                                                  16940000
169500       WHEN -904                                                  16950074
169600       WHEN -911                                                  16960074
169700       WHEN -913                                                  16970074
                 MOVE SQLCODE   TO TM007-SQLCODE                        16971099
                 MOVE SQLCA     TO TM007-SQLCA                          16972099
169800           MOVE 32        TO RC822-RETURN-CODE                    16980099
                 MOVE '32'      TO TM007-RETURN-CODE                    16981099
169900           PERFORM 9900-SOFT-ABORT                                16990000
170000                                                                  17000000
170100       WHEN OTHER                                                 17010000
                 MOVE SQLCODE   TO TM007-SQLCODE                        17011099
                 MOVE SQLCA     TO TM007-SQLCA                          17012099
170200           MOVE 33        TO RC822-RETURN-CODE                    17020099
                 MOVE '33'      TO TM007-RETURN-CODE                    17021099
170300           PERFORM 9800-PGM-ABEND                                 17030000
170400                                                                  17040000
170500     END-EVALUATE.                                                17050000
170600                                                                  17060000
170700                                                                  17070000
170800* -------------------------------------------------------------- *17080000
170900* -------------------------------------------------------------- *17090000
171000                                                                  17100000
171100 7100-OPEN-RECITM-CURSOR.                                         17110000
171200                                                                  17120000
           MOVE '7100-OPEN-RECITM-CURSOR'  TO TM007-RETURNED-PARA.      17121099
                                                                        17122099
171300     EXEC SQL                                                     17130000
171400         OPEN REC-LVL-CSR                                         17140000
171500     END-EXEC.                                                    17150000
171600                                                                  17160000
171700                                                                  17170000
171800     EVALUATE SQLCODE                                             17180074
171900                                                                  17190000
172000       WHEN +0                                                    17200074
172100           SET PS-CURSOR-OPEN TO TRUE                             17210000
172200                                                                  17220000
172300       WHEN -904                                                  17230074
172400       WHEN -911                                                  17240074
172500       WHEN -913                                                  17250074
                 MOVE SQLCODE         TO TM007-SQLCODE                  17251099
                 MOVE SQLCA           TO TM007-SQLCA                    17252099
172600           SET PS-CURSOR-CLOSED TO TRUE                           17260000
172700           MOVE 34              TO RC822-RETURN-CODE              17270099
                 MOVE '34'            TO TM007-RETURN-CODE              17271099
172800           PERFORM 9900-SOFT-ABORT                                17280000
172900                                                                  17290000
173000       WHEN OTHER                                                 17300000
                 MOVE SQLCODE         TO TM007-SQLCODE                  17301099
                 MOVE SQLCA           TO TM007-SQLCA                    17302099
173100           SET PS-CURSOR-CLOSED TO TRUE                           17310000
173200           MOVE 35              TO RC822-RETURN-CODE              17320099
                 MOVE '35'            TO TM007-RETURN-CODE              17321099
173300           PERFORM 9800-PGM-ABEND                                 17330000
173400                                                                  17340000
173500     END-EVALUATE.                                                17350000
173600                                                                  17360000
173700                                                                  17370000
173800* -------------------------------------------------------------- *17380000
173900* -------------------------------------------------------------- *17390000
174000                                                                  17400000
174100 7110-FETCH-RECITM-CURSOR.                                        17410000
174200                                                                  17420000
           MOVE '7110-FETCH-RECITM-CURSOR'  TO TM007-RETURNED-PARA.     17421099
                                                                        17422099
174300     EXEC SQL                                                     17430000
174400                                                                  17440000
174500         FETCH REC-LVL-CSR                                        17450000
174600                                                                  17460000
174700          INTO :RECITM-REC-SEQ-NBR                                17470000
174800             , :RECITM-STATUS-CDE                                 17480000
174900             , :RECITM-PREPK-RATO-QTY                             17490099
175000                                                                  17500000
175100     END-EXEC.                                                    17510000
175200                                                                  17520000
175300                                                                  17530000
175400     EVALUATE SQLCODE                                             17540074
175500                                                                  17550000
175600       WHEN +0                                                    17560074
175800           IF RECITM-PREPK-RATO-QTY = +0                          17580099
175810              PERFORM 8010-FETCH-PURITM-RATIO                     17581099
175820              MOVE PURITM-PREPK-RATO-QTY                          17582099
175830                                TO RECITM-PREPK-RATO-QTY          17583099
175900           END-IF                                                 17590099
175910           MOVE RECITM-PREPK-RATO-QTY TO PV-RECITM-RATO-QTY       17591099
176000                                                                  17600000
176100       WHEN +100                                                  17610074
176200           SET PS-PRIOR-CURSOR-EOF TO TRUE                        17620000
176300                                                                  17630000
176400       WHEN OTHER                                                 17640000
                 MOVE SQLCODE            TO TM007-SQLCODE               17641099
                 MOVE SQLCA              TO TM007-SQLCA                 17642099
276500           MOVE 36                 TO RC822-RETURN-CODE           17650099
                 MOVE '36'               TO TM007-RETURN-CODE           17651099
176600           PERFORM 9800-PGM-ABEND                                 17660000
176700                                                                  17670000
176800     END-EVALUATE.                                                17680000
176900                                                                  17690000
177000                                                                  17700000
177100* -------------------------------------------------------------- *17710000
177200* -------------------------------------------------------------- *17720000
177300                                                                  17730000
177400 7120-CLOSE-RECITM-CURSOR.                                        17740000
177500                                                                  17750000
           MOVE '7120-CLOSE-RECITM-CURSOR'  TO TM007-RETURNED-PARA.     17751099
                                                                        17752099
177600     EXEC SQL                                                     17760000
177700         CLOSE REC-LVL-CSR                                        17770000
177800     END-EXEC.                                                    17780000
177900                                                                  17790000
178000                                                                  17800000
178100     EVALUATE SQLCODE                                             17810074
178200                                                                  17820000
178300       WHEN +0                                                    17830074
178400           SET PS-CURSOR-CLOSED TO TRUE                           17840000
178500                                                                  17850000
178600       WHEN OTHER                                                 17860000
                 MOVE SQLCODE         TO TM007-SQLCODE                  17861099
                 MOVE SQLCA           TO TM007-SQLCA                    17862099
178700           MOVE 37              TO RC822-RETURN-CODE              17870099
                 MOVE '37'            TO TM007-RETURN-CODE              17871099
178800           PERFORM 9800-PGM-ABEND                                 17880000
178900                                                                  17890000
179000     END-EVALUATE.                                                17900000
179100                                                                  17910000
179200                                                                  17920000
179300* -------------------------------------------------------------- *17930000
179400* -------------------------------------------------------------- *17940000
179500                                                                  17950000
179600 7200-OPEN-RECITM-CURSOR.                                         17960000
179700                                                                  17970000
           MOVE '7200-OPEN-RECITM-CURSOR'  TO TM007-RETURNED-PARA.      17971099
                                                                        17972099
179800     EXEC SQL                                                     17980000
179900         OPEN PO-LVL-CSR                                          17990000
180000     END-EXEC.                                                    18000000
180100                                                                  18010000
180200                                                                  18020000
180300     EVALUATE SQLCODE                                             18030074
180400                                                                  18040000
180500       WHEN +0                                                    18050074
180600           SET PS-CURSOR-OPEN TO TRUE                             18060000
180700                                                                  18070000
180800       WHEN -904                                                  18080074
180900       WHEN -911                                                  18090074
181000       WHEN -913                                                  18100074
                 MOVE SQLCODE         TO TM007-SQLCODE                  18101099
                 MOVE SQLCA           TO TM007-SQLCA                    18102099
181100           SET PS-CURSOR-CLOSED TO TRUE                           18110000
181200           MOVE 38              TO RC822-RETURN-CODE              18120099
                 MOVE '38'            TO TM007-RETURN-CODE              18121099
181300           PERFORM 9900-SOFT-ABORT                                18130000
181400                                                                  18140000
181500       WHEN OTHER                                                 18150000
                 MOVE SQLCODE         TO TM007-SQLCODE                  18151099
                 MOVE SQLCA           TO TM007-SQLCA                    18152099
181600           SET PS-CURSOR-CLOSED TO TRUE                           18160000
181700           MOVE 39              TO RC822-RETURN-CODE              18170099
                 MOVE '39'            TO TM007-RETURN-CODE              18171099
181800           PERFORM 9800-PGM-ABEND                                 18180000
181900                                                                  18190000
182000     END-EVALUATE.                                                18200000
182100                                                                  18210000
182200                                                                  18220000
182300* -------------------------------------------------------------- *18230000
182400* -------------------------------------------------------------- *18240000
182500                                                                  18250000
182600 7210-FETCH-RECITM-CURSOR.                                        18260000
182700                                                                  18270000
           MOVE '7210-FETCH-RECITM-CURSOR'  TO TM007-RETURNED-PARA.     18271099
                                                                        18272099
182800     EXEC SQL                                                     18280000
182900                                                                  18290000
183000         FETCH PO-LVL-CSR                                         18300000
183100                                                                  18310000
183200          INTO :RECITM-REC-SEQ-NBR                                18320000
183300             , :RECITM-STATUS-CDE                                 18330000
183400             , :RECITM-PREPK-RATO-QTY                             18340000
183500                                                                  18350000
183600     END-EXEC.                                                    18360000
183700                                                                  18370000
183800                                                                  18380000
183900     EVALUATE SQLCODE                                             18390074
184000                                                                  18400000
184100       WHEN +0                                                    18410074
184110           IF RECITM-PREPK-RATO-QTY = +0                          18411099
184120              PERFORM 8010-FETCH-PURITM-RATIO                     18412099
184130              MOVE PURITM-PREPK-RATO-QTY                          18413099
184140                                TO RECITM-PREPK-RATO-QTY          18414099
184150           END-IF                                                 18415099
184160           MOVE RECITM-PREPK-RATO-QTY TO PV-RECITM-RATO-QTY       18416099
184300                                                                  18430000
184400       WHEN +100                                                  18440074
184500           SET PS-PRIOR-CURSOR-EOF TO TRUE                        18450000
184600                                                                  18460000
184700       WHEN OTHER                                                 18470000
                 MOVE SQLCODE            TO TM007-SQLCODE               18471099
                 MOVE SQLCA              TO TM007-SQLCA                 18472099
184800           MOVE 40                 TO RC822-RETURN-CODE           18480099
                 MOVE '40'               TO TM007-RETURN-CODE           18481099
184900           PERFORM 9800-PGM-ABEND                                 18490000
185000                                                                  18500000
185100     END-EVALUATE.                                                18510000
185200                                                                  18520000
185300                                                                  18530000
185400* -------------------------------------------------------------- *18540000
185500* -------------------------------------------------------------- *18550000
185600                                                                  18560000
185700 7220-CLOSE-RECITM-CURSOR.                                        18570000
185800                                                                  18580000
           MOVE '7220-CLOSE-RECITM-CURSOR'  TO TM007-RETURNED-PARA.     18581099
                                                                        18582099
185900     EXEC SQL                                                     18590000
186000         CLOSE PO-LVL-CSR                                         18600000
186100     END-EXEC.                                                    18610000
186200                                                                  18620000
186300                                                                  18630000
186400     EVALUATE SQLCODE                                             18640074
186500                                                                  18650000
186600       WHEN +0                                                    18660074
186700           SET PS-CURSOR-CLOSED TO TRUE                           18670000
186800                                                                  18680000
186900       WHEN OTHER                                                 18690000
                 MOVE SQLCODE         TO TM007-SQLCODE                  18691099
                 MOVE SQLCA           TO TM007-SQLCA                    18692099
187000           MOVE 41              TO RC822-RETURN-CODE              18700099
                 MOVE '41'            TO TM007-RETURN-CODE              18701099
187100           PERFORM 9800-PGM-ABEND                                 18710000
187200                                                                  18720000
187300     END-EVALUATE.                                                18730000
187400                                                                  18740000
187500                                                                  18750000
187600* -------------------------------------------------------------- *18760000
187700* -------------------------------------------------------------- *18770000
187800                                                                  18780000
187900 8000-FETCH-DRIVER-LINE.                                          18790000
188000                                                                  18800008
           MOVE '8000-FETCH-DRIVER-LINE'  TO TM007-RETURNED-PARA.       18801099
                                                                        18802099
188100     EXEC SQL                                                     18810000
188200                                                                  18820000
188300         SELECT DISTINCT                                          18830000
188400                PREPK_RATO_QTY                                    18840000
188500              , ORD_LNE_NBR                                       18850000
188600                                                                  18860000
188700           INTO :RECITM-PREPK-RATO-QTY                            18870097
188800              , :RECITM-ORD-LNE-NBR                               18880097
188900                                                                  18890000
189000         FROM TRECITM                                             18900097
189100                                                                  18910000
189200         WHERE ORD_NBR            =  :RC822-PO-NBR                18920099
189300           AND REC_SEQ_NBR        =  :RC822-REC-SEQ-NBR           18930099
189400           AND OPER_UNT_ID        =  :RC822-OPER-UNT-ID           18940099
189500           AND PREPK_ID           =  :RC822-PO-PREPK-ID           18950099
189600           AND PREPK_DRV_LNE_CDE  =  :PC-A                        18960000
189700                                                                  18970000
189800     END-EXEC.                                                    18980000
189900                                                                  18990000
190000                                                                  19000000
190100     EVALUATE SQLCODE                                             19010074
190200                                                                  19020000
190300       WHEN +0                                                    19030074
190400           SET PS-DRIVER-LINE-YES  TO TRUE                        19040047
190500           MOVE RECITM-ORD-LNE-NBR TO DK-DRIVER-LINE-NBR          19050047
190600                                                                  19060000
190700* -------------------------------------------------------------- *19070000
190800*    NO DRIVER LINE CAN OCCUR IF THE RECEIVER IS A NON PREPACK   *19080000
190900*    RECEIVER OR THE PREPACK LINE RECEIVER HAS BEEN DELETED.     *19090000
191000*    THE RATIO QTY IS DEFAULTED TO THE PURITM RATIO.             *19100000
191100* -------------------------------------------------------------- *19110000
191200                                                                  19120000
191300       WHEN +100                                                  19130074
191400           PERFORM 8010-FETCH-PURITM-RATIO                        19140000
191500           MOVE PURITM-PREPK-RATO-QTY  TO RECITM-PREPK-RATO-QTY   19150000
191600           MOVE +0                     TO RECITM-ORD-LNE-NBR      19160000
191700           SET PS-DRIVER-LINE-NO       TO TRUE                    19170096
191800                                                                  19180000
191900       WHEN -904                                                  19190074
192000       WHEN -911                                                  19200074
182200       WHEN -913                                                  19210099
                 MOVE SQLCODE        TO TM007-SQLCODE                   19211099
                 MOVE SQLCA          TO TM007-SQLCA                     19212099
192200           MOVE 42             TO RC822-RETURN-CODE               19220099
                 MOVE '42'           TO TM007-RETURN-CODE               19221099
192300           PERFORM 9900-SOFT-ABORT                                19230000
192400                                                                  19240000
192500       WHEN OTHER                                                 19250000
                 MOVE SQLCODE        TO TM007-SQLCODE                   19251099
                 MOVE SQLCA          TO TM007-SQLCA                     19252099
192600           MOVE 43             TO RC822-RETURN-CODE               19260099
                 MOVE '43'           TO TM007-RETURN-CODE               19261099
192700           PERFORM 9800-PGM-ABEND                                 19270000
192800                                                                  19280000
192900     END-EVALUATE.                                                19290000
193000                                                                  19300000
193100                                                                  19310000
193200* -------------------------------------------------------------- *19320000
193300* -------------------------------------------------------------- *19330000
193400                                                                  19340000
193500 8010-FETCH-PURITM-RATIO.                                         19350000
193600                                                                  19360000
           MOVE '8010-FETCH-PURITM-RATIO'  TO TM007-RETURNED-PARA.      19361099
                                                                        19362099
193700     EXEC SQL                                                     19370000
193800                                                                  19380000
193900         SELECT DISTINCT                                          19390000
194000                PREPK_RATO_QTY                                    19400000
194100                                                                  19410000
194200           INTO :PURITM-PREPK-RATO-QTY                            19420026
194300                                                                  19430000
194400         FROM TPURITM                                             19440097
194500                                                                  19450000
194600         WHERE PO_NBR          =  :RC822-PO-NBR                   19460099
194700           AND PO_LNE_NBR      =  :DK-PO-LNE-NBR                  19470096
194800           AND VER_STATUS_CDE  =  :PC-A                           19480000
194900           AND PO_PREPK_ID     =  :RC822-PO-PREPK-ID              19490099
195000                                                                  19500000
195100     END-EXEC.                                                    19510000
195200                                                                  19520000
195300                                                                  19530000
195400     EVALUATE SQLCODE                                             19540074
195500                                                                  19550000
195600       WHEN +0                                                    19560074
195700           CONTINUE                                               19570000
195800                                                                  19580000
195900       WHEN +100                                                  19590074
196000           MOVE ZERO  TO PURITM-PREPK-RATO-QTY                    19600096
196100                                                                  19610000
196200       WHEN -904                                                  19620074
196300       WHEN -911                                                  19630074
196400       WHEN -913                                                  19640074
                 MOVE SQLCODE      TO TM007-SQLCODE                     19641099
                 MOVE SQLCA        TO TM007-SQLCA                       19642099
196500           MOVE 44           TO RC822-RETURN-CODE                 19650099
                 MOVE '44'         TO TM007-RETURN-CODE                 19651099
196600           PERFORM 9900-SOFT-ABORT                                19660000
196700                                                                  19670000
196800       WHEN OTHER                                                 19680000
                 MOVE SQLCODE      TO TM007-SQLCODE                     19681099
                 MOVE SQLCA        TO TM007-SQLCA                       19682099
196900           MOVE 45           TO RC822-RETURN-CODE                 19690099
                 MOVE '45'         TO TM007-RETURN-CODE                 19691099
197000           PERFORM 9800-PGM-ABEND                                 19700000
197100                                                                  19710000
197200     END-EVALUATE.                                                19720000
197300                                                                  19730000
197400                                                                  19740000
197500* -------------------------------------------------------------- *19750000
197600* -------------------------------------------------------------- *19760000
197700                                                                  19770000
197800 8020-VERIFY-PLAN-ALLOCATION.                                     19780000
197900                                                                  19790030
198000     SET RC822-PACK-IDX TO RECITM-ORD-LNE-NBR.                    19800099
198100                                                                  19810086
198200     MOVE PC-Y TO RC822-STORE-VAL-OOR-IND.                        19820099
198300                                                                  19830043
198400     PERFORM                                                      19840094
198500       VARYING RC822-STORE-IDX FROM 1 BY 1                        19850099
198600         UNTIL RC822-STORE-NBR (RC822-STORE-IDX) EQUAL ZERO       19860099
198700            OR RC822-STORE-IDX > PC-MAX-STORES                    19870099
198800                                                                  19880096
198900         PERFORM 8030-VERIFY-PACK-COMPONENTS                      19890095
199000           VARYING RC822-PACK-IDX FROM 1 BY 1                     19900099
199100             UNTIL RC822-PACK-IDX > PC-MAX-PACK-LINES             19910099
199200                OR RC822-PO-LINE-NBR (RC822-PACK-IDX) EQUAL ZERO  19920099
199300                OR RC822-STORE-VAL-OOR-IND EQUAL PC-N             19930099
199400                                                                  19940096
199500     END-PERFORM.                                                 19950094
199600                                                                  19960093
199700     MOVE PC-Y TO RC822-STORE-GOOD-PLAN-IND.                      19970099
199800                                                                  19980093
199900     PERFORM 8040-SELECT-STORE-COUNT                              19990095
200000       VARYING RC822-PACK-IDX FROM 1 BY 1                         20000099
200100         UNTIL RC822-PO-LINE-NBR (RC822-PACK-IDX) EQUAL ZERO      20010099
200200            OR RC822-PACK-IDX > PC-MAX-PACK-LINES.                20020099
200300                                                                  20030023
200400                                                                  20040023
200500* -------------------------------------------------------------- *20050023
200600* -------------------------------------------------------------- *20060023
200700                                                                  20070023
200800 8030-VERIFY-PACK-COMPONENTS.                                     20080095
200900                                                                  20090093
201000     IF RC822-APP-PO-LINE-NBR (RC822-PACK-IDX) NOT EQUAL          20100099
201100        RC822-APP-PO-LNE-NBR                                      20110099
201200                                                                  20120093
201300         MOVE RC822-PO-LINE-NBR (RC822-PACK-IDX) TO DK-PO-LINE-NBR20130099
201400         MOVE RC822-STORE-NBR  (RC822-STORE-IDX) TO DK-STORE-NBR  20140099
201500                                                                  20150096
201600         PERFORM 8050-SUM-STORE-DISTRO-QTY                        20160095
201700                                                                  20170093
201800     END-IF.                                                      20180093
201900                                                                  20190093
           IF RC822-PO-PACK-RATO-QTY (RC822-PACK-IDX) > +0              20191099
202000      IF RC822-STORE-DISTRO-PK (RC822-STORE-IDX) NOT EQUAL        20200099
202100       (PV-SUM-STR-DISTRO-QTY /                                   20210096
202200        RC822-PO-PACK-RATO-QTY (RC822-PACK-IDX))                  20220099
202300         MOVE PC-N TO RC822-STORE-VAL-OOR-IND                     20230099
            END-IF                                                      20231099
202400     END-IF                                                       20240093
202500                                                                  20250093
202600     MOVE RC822-PO-PACK-RATO-QTY (RC822-PACK-IDX)                 20260099
202700       TO PV-DISPLAY-QTY1.                                        20270093
202800                                                                  20280093
202900     MOVE RC822-STORE-DISTRO-QTY (RC822-STORE-IDX)                20290099
203000       TO PV-DISPLAY-QTY2.                                        20300093
203100                                                                  20310093
203200     MOVE RC822-STORE-DISTRO-PK  (RC822-STORE-IDX)                20320099
203300       TO PV-DISPLAY-QTY3.                                        20330093
203400                                                                  20340093
203500*    DISPLAY ' '                                                  20350099
203600*    DISPLAY ' '                                                  20360099
203700*    DISPLAY '---------------------------------------------'.     20370099
203800*    DISPLAY ' RCKUP822  -  VERIFY PLAN ALLOCATION         '.     20380099
203900*    DISPLAY ' '                                                  20390099
204000*    DISPLAY ' RC822 PO LINE NBR      : ' RC822-PO-LINE-NBR       20400099
204100*                                        (RC822-PACK-IDX).        20410099
204200*    DISPLAY ' RC822 APP PO LINE NBR  : ' RC822-APP-PO-LNE-NBR.   20420099
204300*    DISPLAY ' RC822 PO PACK RATO QTY : ' PV-DISPLAY-QTY1.        20430099
204400*    DISPLAY ' '                                                  20440099
204500*    DISPLAY ' RC822 STORE NBR        : ' RC822-STORE-NBR         20450099
204600*                                        (RC822-STORE-IDX).       20460099
204700*    DISPLAY ' RC822 STORE DISTRO QTY : ' PV-DISPLAY-QTY2.        20470099
204800*    DISPLAY ' RC822 STORE DISTRO PK  : ' PV-DISPLAY-QTY3.        20480099
204900*    DISPLAY ' '                                                  20490099
205000*    DISPLAY ' PLAN NBR               : ' RC822-PLAN-NBR.         20500099
205100*    DISPLAY ' SUM STORE DISTRO QTY   : ' PV-SUM-STR-DISTRO-QTY.  20510099
205200*    DISPLAY ' '                                                  20520099
205300*    DISPLAY ' RC822 STORE VAL OOR    : ' RC822-STORE-VAL-OOR-IND.20530099
205400                                                                  20540093
205500                                                                  20550093
205600* -------------------------------------------------------------- *20560093
205700* -------------------------------------------------------------- *20570093
205800                                                                  20580093
205900 8040-SELECT-STORE-COUNT.                                         20590095
206000                                                                  20600093
           MOVE '8040-SELECT-STORE-COUNT'  TO TM007-RETURNED-PARA.      20601099
                                                                        20602099
206100     MOVE RC822-PO-LINE-NBR (RC822-PACK-IDX) TO DK-PO-LINE-NBR.   20610099
206200                                                                  20620093
206300     EXEC SQL                                                     20630093
206400                                                                  20640093
206500         SELECT COUNT(DISTINCT STR_NBR)                           20650093
206600                                                                  20660093
206700           INTO :PV-STORE-COUNT                                   20670093
206800                                                                  20680093
206900         FROM TMESTDS                                             20690097
207000                                                                  20700093
207100         WHERE PO_NBR      =  :RC822-PO-NBR                       20710099
207200           AND PO_LNE_NBR  =  :DK-PO-LINE-NBR                     20720096
207300           AND PLAN_NBR    =  :ALLPLN-PLAN-NBR                    20730093
207400                                                                  20740093
207500     END-EXEC.                                                    20750093
207600                                                                  20760093
207700                                                                  20770093
207800     EVALUATE SQLCODE                                             20780093
207900                                                                  20790093
208000       WHEN +0                                                    20800093
208100                                                                  20810093
208200           IF RC822-PACK-IDX EQUAL 1                              20820099
208300               MOVE PV-STORE-COUNT TO PV-SAVE-FIRST-COUNT         20830093
208400           END-IF                                                 20840093
208500                                                                  20850093
208600           IF PV-SAVE-FIRST-COUNT EQUAL PV-STORE-COUNT            20860096
208700               CONTINUE                                           20870093
208800           ELSE                                                   20880093
208900               MOVE PC-N TO RC822-STORE-GOOD-PLAN-IND             20890099
209000           END-IF                                                 20900093
209100                                                                  20910093
209200       WHEN +100                                                  20920093
209300           MOVE ZEROS TO PV-STORE-COUNT                           20930096
209400                                                                  20940093
209500       WHEN -904                                                  20950093
209600       WHEN -911                                                  20960093
209700       WHEN -913                                                  20970093
                 MOVE SQLCODE     TO TM007-SQLCODE                      20971099
                 MOVE SQLCA       TO TM007-SQLCA                        20972099
209800           MOVE 46          TO RC822-RETURN-CODE                  20980099
                 MOVE '46'        TO TM007-RETURN-CODE                  20981099
209900           PERFORM 9900-SOFT-ABORT                                20990093
210000                                                                  21000093
210100       WHEN OTHER                                                 21010093
                 MOVE SQLCODE     TO TM007-SQLCODE                      21011099
                 MOVE SQLCA       TO TM007-SQLCA                        21012099
210200           MOVE 47          TO RC822-RETURN-CODE                  21020099
                 MOVE '47'        TO TM007-RETURN-CODE                  21021099
210300           PERFORM 9800-PGM-ABEND                                 21030093
210400                                                                  21040093
210500     END-EVALUATE.                                                21050093
210600                                                                  21060093
210700                                                                  21070093
210800* -------------------------------------------------------------- *21080093
210900* -------------------------------------------------------------- *21090093
211000                                                                  21100093
211100 8050-SUM-STORE-DISTRO-QTY.                                       21110095
211200                                                                  21120093
           MOVE '8050-SUM-STORE-DISTRO-QTY'  TO TM007-RETURNED-PARA.    21121099
                                                                        21122099
211300     EXEC SQL                                                     21130093
211400                                                                  21140093
211500         SELECT SUM(STR_DISTRO_QTY)                               21150093
211600                                                                  21160093
211700           INTO :PV-SUM-STR-DISTRO-QTY                            21170096
211800                                                                  21180093
211900         FROM TMESTDS                                             21190097
212000                                                                  21200093
212100         WHERE PO_NBR      =  :RC822-PO-NBR                       21210099
212200           AND PO_LNE_NBR  =  :DK-PO-LINE-NBR                     21220096
212300           AND PLAN_NBR    =  :RC822-PLAN-NBR                     21230099
212400           AND STR_NBR     =  :DK-STORE-NBR                       21240096
212500                                                                  21250093
212600     END-EXEC.                                                    21260093
212700                                                                  21270093
212800                                                                  21280093
212900     EVALUATE SQLCODE                                             21290093
213000                                                                  21300093
213100       WHEN +0                                                    21310093
213200           CONTINUE                                               21320093
213300                                                                  21330093
213400       WHEN -904                                                  21340087
213500       WHEN -911                                                  21350087
213600       WHEN -913                                                  21360087
                 MOVE SQLCODE        TO TM007-SQLCODE                   21361099
                 MOVE SQLCA          TO TM007-SQLCA                     21362099
213700           MOVE 48             TO RC822-RETURN-CODE               21370099
                 MOVE '48'           TO TM007-RETURN-CODE               21371099
213800           PERFORM 9900-SOFT-ABORT                                21380087
213900                                                                  21390087
214000       WHEN OTHER                                                 21400087
                 MOVE SQLCODE        TO TM007-SQLCODE                   21401099
                 MOVE SQLCA          TO TM007-SQLCA                     21402099
214100           MOVE 49             TO RC822-RETURN-CODE               21410099
                 MOVE '49'           TO TM007-RETURN-CODE               21411099
214200           PERFORM 9800-PGM-ABEND                                 21420087
214300                                                                  21430087
214400     END-EVALUATE.                                                21440087
214500                                                                  21450087
214600                                                                  21460087
214700* -------------------------------------------------------------- *21470087
214800* -------------------------------------------------------------- *21480087
214900                                                                  21490087
215000 9000-NO-DISTRO-ERROR.                                            21500087
215100                                                                  21510000
215200     SET RC822-NO-DISTRO                                          21520099
215300         RC822-WARNING-ERROR TO TRUE.                             21530099
215400                                                                  21540000
215500     IF RC822-STORE-LEVEL-OTR                                     21550099
215600         PERFORM                                                  21560000
215700           VARYING RC822-STORE-IDX FROM 1 BY 1                    21570099
215800             UNTIL RC822-STORE-IDX > PC-MAX-STORES                21580099
215900                                                                  21590000
216000             MOVE ALL '*'                                         21600002
216100               TO RC822-STORE-OTR-QTY-X (RC822-STORE-IDX)         21610099
216200                                                                  21620000
216300         END-PERFORM                                              21630000
216400     ELSE                                                         21640000
216500         MOVE ALL '*' TO RC822-LINE-OTR-QTY-X (RC822-ITEM-IDX)    21650099
216600     END-IF.                                                      21660000
216700                                                                  21670000
216800                                                                  21680000
216900* -------------------------------------------------------------- *21690000
217000*    WHEN A FATAL ERROR OCCURS, PASS THE ERROR SWITCHES BACK TO   21700000
217100*    THE HOST PROGRAM AND WRITE TO THE CICS MESSAGE LOG.          21710000
217200* -------------------------------------------------------------- *21720000
217300                                                                  21730000
217400 9800-PGM-ABEND.                                                  21740000
217500                                                                  21750000
217600     PERFORM                                                      21760000
217700       VARYING RC822-ITEM-ERR-IDX FROM 1 BY 1                     21770099
217800         UNTIL RC822-ITEM-ERR-IDX > PC-MAX-ITEM-LINES             21780099
217900                                                                  21790000
218000         MOVE SPACES                                              21800000
218100           TO RC822-LINE-OTR-QTY-X    (RC822-ITEM-ERR-IDX)        21810099
218200              RC822-LINE-DISTRO-QTY-X (RC822-ITEM-ERR-IDX)        21820099
218300              RC822-LINE-DISTRO-OTR-X (RC822-ITEM-ERR-IDX)        21830099
218400         MOVE +0                                                  21840000
218500           TO RC822-LINE-OTR-QTY      (RC822-ITEM-ERR-IDX)        21850099
218600              RC822-LINE-DISTRO-QTY   (RC822-ITEM-ERR-IDX)        21860099
218700              RC822-LINE-DISTRO-OTR   (RC822-ITEM-ERR-IDX)        21870099
218800                                                                  21880000
218900     END-PERFORM.                                                 21890000
219000                                                                  21900000
219100     PERFORM                                                      21910000
219200       VARYING RC822-STORE-ERR-IDX FROM 1 BY 1                    21920099
219300         UNTIL RC822-STORE-ERR-IDX > PC-MAX-STORES                21930099
219400                                                                  21940000
219500          MOVE SPACES                                             21950000
219600            TO RC822-STORE-OTR-QTY-X       (RC822-STORE-ERR-IDX)  21960099
219700               RC822-STORE-OTR-PK-X        (RC822-STORE-ERR-IDX)  21970099
219800               RC822-STORE-DISTRO-PK-X     (RC822-STORE-ERR-IDX)  21980099
219900               RC822-STORE-DISTRO-QTY-X    (RC822-STORE-ERR-IDX)  21990099
220000               RC822-STORE-DISTRO-OTR-X    (RC822-STORE-ERR-IDX)  22000099
220100               RC822-STORE-DISTRO-OTR-PK-X (RC822-STORE-ERR-IDX)  22010099
220200          MOVE +0                                                 22020000
220300            TO RC822-STORE-OTR-QTY         (RC822-STORE-ERR-IDX)  22030099
220400               RC822-STORE-OTR-PK          (RC822-STORE-ERR-IDX)  22040099
220500               RC822-STORE-DISTRO-PK       (RC822-STORE-ERR-IDX)  22050099
220600               RC822-STORE-DISTRO-OTR      (RC822-STORE-ERR-IDX)  22060099
220700               RC822-STORE-DISTRO-OTR-PK   (RC822-STORE-ERR-IDX)  22070099
220800               RC822-STORE-RNK-SEQ-NBR     (RC822-STORE-ERR-IDX)  22080099
220900                                                                  22090000
221000     END-PERFORM.                                                 22100000
221100                                                                  22110000
221200     SET PS-ERRORS-YES                                            22120000
221300         RC822-FATAL-ERROR                                        22130099
221400         RC822-CROAK        TO TRUE.                              22140099
221500                                                                  22150000
221600     PERFORM 9950-FORMAT-ERROR-MSG.                               22150199
           PERFORM 9999-PROCESS-GOBACK.                                 22151099
                                                                        22152099
221700                                                                  22170000
221800*    SET DP013-LINK-RETURN                                        22180099
221900*        DP013-NO-ROLLBACK  TO TRUE.                              22190099
222000                                                                  22200000
222100*    PERFORM DP013-0000-PROCESS-ABEND.                            22210099
222200                                                                  22220000
222300                                                                  22230000
222400* -------------------------------------------------------------- *22240000
222500*    THE DB2 RESOURCE IS NOT AVAILABLE, PASS THE ERROR SWITCHES  *22250000
222600*    BACK TO THE HOST PROGRAM AND WRITE TO THE CICS MESSAGE LOG  *22260000
222700* -------------------------------------------------------------- *22270000
222800                                                                  22280000
222900 9900-SOFT-ABORT.                                                 22290000
223000                                                                  22300000
223100     SET PS-ERRORS-YES                                            22310000
223200         RC822-FATAL-ERROR                                        22320099
223300         RC822-SOFT-ABORT   TO TRUE.                              22330099
223400                                                                  22340000
223500     PERFORM 9950-FORMAT-ERROR-MSG.                               22350099
223600                                                                  22360000
223700*    SET DP013-LINK-RETURN                                        22370099
223800*        DP013-NO-ROLLBACK TO TRUE.                               22380099
223900                                                                  22390000
224000*    PERFORM DP013-0000-PROCESS-ABEND.                            22400099
224100                                                                  22410000
224200                                                                  22420000
224300* -------------------------------------------------------------- *22430000
224400* -------------------------------------------------------------- *22440000
224500                                                                  22450000
224600 9950-FORMAT-ERROR-MSG.                                           22460000
224700                                                                  22470000
224800     IF RC822-APP-PO-LNE-NBR EQUAL ZERO                           22480099
224900         MOVE DK-PO-LNE-NBR        TO PV-DISP-PO-LNE-NBR          22490096
225000     ELSE                                                         22500000
225100         MOVE RC822-APP-PO-LNE-NBR TO PV-DISP-PO-LNE-NBR          22510099
225200     END-IF.                                                      22520032
225300                                                                  22530000
225400     MOVE SQLCODE            TO  PV-SQLCODE.                      22540099
225500     MOVE PV-SQLCODE         TO  PV-DISPLAY-SQLCODE.              22550082
225600     MOVE RC822-PO-NBR       TO  PV-DISP-PO-NBR.                  22560099
225700     MOVE RC822-REC-SEQ-NBR  TO  PV-DISP-REC-SEQ-NBR.             22570099
225800     MOVE RC822-OPER-UNT-ID  TO  PV-DISP-OPER-UNT-ID.             22580099
225900     MOVE RC822-FCLTY-ID     TO  PV-DISP-FCLTY-ID.                22590099
226000     MOVE RC822-STR-NBR      TO  PV-DISP-STR-NBR.                 22600099
226100                                                                  22610000
226200     STRING '** RCKUP822 ** ERROR; '                              22620099
226300            PV-RETURN-MSG                                         22630099
226400         DELIMITED BY SIZE INTO DP013-MESSAGE-TEXT (1).           22640099
226500                                                                  22650000
226600     STRING  ' RC822-RC = ' RC822-RETURN-CODE                     22660099
226700             '; SQLCODE = ' PV-DISPLAY-SQLCODE                    22670000
226800         DELIMITED BY SIZE INTO DP013-MESSAGE-TEXT (2).           22680099
226900                                                                  22690000
227000     MOVE '  PO    REC  LNE OPER FCLTY STR'                       22700099
227100       TO DP013-MESSAGE-TEXT (3).                                 22710099
227200                                                                  22720099
227300     STRING                                                       22730099
227400         PV-DISP-PO-NBR      '-'                                  22740099
227500         PV-DISP-REC-SEQ-NBR '-'                                  22750099
227600         PV-DISP-PO-LNE-NBR  '-'                                  22760099
227700         PV-DISP-OPER-UNT-ID '-'                                  22770099
227800         PV-DISP-FCLTY-ID    '-'                                  22780099
227900         PV-DISP-STR-NBR                                          22790099
228000         DELIMITED BY SIZE INTO DP013-MESSAGE-TEXT (4).           22800099
228100                                                                  22810099
228200     DISPLAY ' RCKUP822 ERROR MESSAGES  '                         22820099
228300     DISPLAY '  ' DP013-MESSAGE-TEXT (1)                          22830099
228400     DISPLAY '  ' DP013-MESSAGE-TEXT (2)                          22840099
228500     DISPLAY '  ' DP013-MESSAGE-TEXT (3).                         22850099
228600     DISPLAY '  ' DP013-MESSAGE-TEXT (4).                         22860099
228700                                                                  22870003
224400* -------------------------------------------------------------- *22871099
224500                                                                  22872099
224600 9999-PROCESS-GOBACK.                                             22873099
224700                                                                  22874099
049600     MOVE RC822-COMMAREA TO LINK-COMMAREA.                        22874199
           MOVE TM007-COMMUNICATIONS-AREA TO LINK-TM007-COMMAREA.       22874299
049700                                                                  22874399
049800     GOBACK.                                                      22874499
228900                                                                  22890000
229000* -------------------------------------------------------------- *22900000
229100*    ABEND PROCESSOR MODULE                                      *22910000
229200* -------------------------------------------------------------- *22920000
229300                                                                  22930000
229400*COPY DPPD013.                                                    22940002
229500******************************************************************22950002
229600**     THIS PROCEDURE DIVISION COPY BOOK IS USED TO CALL THE    **22960002
229700** CICS ABEND PROCESSOR FROM AN ARCHITECTURE PROGRAM.           **22970002
229800** USE DPPD013 TO CALL THE ABEND PROCESSOR FROM AN ARCHITECTURE **22980002
229900** PROGRAM.                                                     **22990002
230000**                                                              **23000002
230100** OTHER COPYBOOKS TO INCLUDE:  DPWS013.                        **23010002
230200**                                                              **23020002
230300** USAGE:                                                       **23030002
230400**   FILL THE APPROPRIATE FIELDS IN DPWS013 AND PERFORM         **23040002
230500** DP013-0000-PROCESS-ABEND.  NOTE:  MAKE SURE                  **23050002
230600** PC-CURRENT-PROGRAM-NAME IS DEFINED IN THE APPLICATION PROGRAM**23060002
230700** AND HAS A VALUE EQUAL TO THE PROGRAM ID OF THE CURRENT       **23070002
230800** PROGRAM.                                                     **23080002
230900**                                                              **23090002
231000**                   *****  NOTE  *****                         **23100002
231100** THERE IS A VERSION OF THIS COPYBOOK TO BE USED BY NON-       **23110002
231200** ARCHITECTURE PROGRAMS CALLED DPPD014.                        **23120002
231300******************************************************************23130002
231400                                                                  23140002
231500*DP013-0000-PROCESS-ABEND.                                        23150099
231600*    MOVE PC-CURRENT-PROGRAM-NAME TO DP013-PROGRAM.               23160099
231700*    MOVE DFHEIBLK                TO DP013-DFHEIBLK.              23170002
231800*    INITIALIZE DP013-SRC-TASK-NUMBER                             23180099
231900*               DP013-STACK.                                      23190099
232000*                                                                 23200099
232100*    IF DP020-GOOD-COMMAREA                                       23210099
232200*        MOVE DP020-SRC-TASK-NUMBER TO DP013-SRC-TASK-NUMBER      23220099
232300*        PERFORM                                                  23230099
232400*          VARYING DP020-STACK-INDEX FROM 1 BY 1                  23240099
232500*            UNTIL DP020-STACK-INDEX > DP020-ENTRIES-IN-STACK     23250099
232600*            SET DP013-STACK-INDEX TO DP020-STACK-INDEX           23260099
232700*            MOVE DP020-STACK-TRAN-ID (DP020-STACK-INDEX)         23270099
232800*              TO DP013-STACK-TRAN-ID (DP013-STACK-INDEX)         23280099
232900*            MOVE DP020-STACK-TASK-NUMBER (DP020-STACK-INDEX)     23290099
233000*              TO DP013-STACK-TASK-NUMBER (DP013-STACK-INDEX)     23300099
233100*        END-PERFORM                                              23310099
233200*    END-IF.                                                      23320099
233300*                                                                 23330099
233400*    PERFORM 9950-FORMAT-ERROR-MSG.                               23340099
233500                                                                  23350009
233600*    IF  DP013-LINK-RETURN                                        23360002
233700*        EXEC CICS                                                23370002
233800*            LINK                                                 23380002
233900*                PROGRAM  (DP013-NAME)                            23390002
234000*                COMMAREA (DP013-PARAMETERS)                      23400002
234100*                LENGTH   (DP013-LENGTH)                          23410002
234200*        END-EXEC                                                 23420002
234300*    ELSE                                                         23430002
234400*        EXEC CICS                                                23440002
234500*            XCTL                                                 23450002
234600*                PROGRAM  (DP013-NAME)                            23460002
234700*                COMMAREA (DP013-PARAMETERS)                      23470002
234800*                LENGTH   (DP013-LENGTH)                          23480002
234900*        END-EXEC                                                 23490002
235000*    END-IF.                                                      23500002
235100                                                                  23510000
