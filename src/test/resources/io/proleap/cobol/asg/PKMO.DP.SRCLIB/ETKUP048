000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.              ETKUP048.                               00020099
000300 DATE-WRITTEN.            04/14/2000.                             00030099
000400 DATE-COMPILED.                                                   00040099
000500                                                                  00050099
000600******************************************************************00060099
000700*PURPOSE:                                                         00070099
000800*    THIS PROGRAM WILL CREATE AN AUTOMATED FOLLOWUP FILE FOR      00080099
000900* MISSING FUNCTIONAL ACKNOWLEDGEMENTS ON PURCHASE ORDERS.         00090099
001000* INFORMATION FOR THE EXTRACT FILE COMES FROM THE TRADING PARTNER 00100099
001100* TABLE TTRDPRT, THE ENT ID TABLE TENTNME, THE TRANSACTION STATUS 00110099
001200* TABLE TFGTRST, THE TRADING PARTNER FUNCTIONAL GROUP TBL TTRDFNC,00120099
001300* AND THE PURCHASE ORDER SHIPMENT STATUS TABLE TPLNSHP.           00130099
001400*                                                                 00140099
001500*    AUTOMATED FOLLOWUP MODE - TEXT MESSAGE (EDI DOCUMENT 864)    00150099
001600*    (CHANGES TO THIS MODULES MAY NEED TO BE MADE TO......        00160099
001700*                     ETKUP049, ETKUP050)                         00170099
001800******************************************************************00180099
001900* 03-05-2001 JON FIEDLER 0305JF                                   00190099
002000* ADDED VENDOR NAME TO SYSOUT ERROR MESSAGE.                      00200099
002100******************************************************************00210099
002110* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00211099
002120*            - CHANGE CALL OF DPKUT100 TO                       * 00212099
002130*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00213099
002140*              MAKING THE CALL DYNAMIC VS STATIC                * 00214099
002150*                                                               * 00215099
002160*---------------------------------------------------------------* 00216099
002200                                                                  00220099
002300 ENVIRONMENT DIVISION.                                            00230099
002400 CONFIGURATION SECTION.                                           00240099
002500 SOURCE-COMPUTER. IBM-S390.                                       00250099
002600 OBJECT-COMPUTER. IBM-S390.                                       00260099
002700 INPUT-OUTPUT SECTION.                                            00270099
002800 FILE-CONTROL.                                                    00280099
002900                                                                  00290099
003000     SELECT PO-OUTPUT-FILE                                        00300099
003100         ASSIGN TO OUT01                                          00310099
003200         FILE STATUS IS WS-FILE-STATUS.                           00320099
003300                                                                  00330099
003400 DATA DIVISION.                                                   00340099
003500 FILE SECTION.                                                    00350099
003600                                                                  00360099
003700 FD  PO-OUTPUT-FILE                                               00370099
003800     RECORDING MODE IS F                                          00380099
003900     LABEL RECORDS ARE STANDARD                                   00390099
004000     RECORD CONTAINS 250 CHARACTERS                               00400099
004100     DATA RECORD IS PO-OUTPUT-RECORD.                             00410099
004200                                                                  00420099
004300 01  PO-OUTPUT-RECORD         PIC X(250).                         00430099
004400                                                                  00440099
004500******************************************************************00450099
004600 WORKING-STORAGE SECTION.                                         00460099
004700******************************************************************00470099
004800                                                                  00480099
004900     COPY ETRD109.                                                00490099
005000                                                                  00500099
005100 01  EMAIL-LINE-1.                                                00510099
005200     05  EL1-VERBIAGE          PIC X(80)  VALUE SPACES.           00520099
005300                                                                  00530099
005400 01  WS-MESSAGE-TABLE.                                            00540099
005500     05  FILLER                PIC X(75)  VALUE                   00550099
005600     'KOHLs has transmitted the following EDI xxxs to your company00560099
005700-    '.             '.                                            00570099
005800     05  FILLER                PIC X(75)  VALUE                   00580099
005900     '   PO Numbers:   Date Transmitted:    GS Control #:   Ship D00590099
006000-    'ate           '.                                            00600099
006100     05  FILLER                PIC X(75)  VALUE                   00610099
006200     ' xxxxxxxxxxxxxxx     mm/dd/yyyy         yyyyyyyyy     mm/dd/00620099
006300-    'yyyy          '.                                            00630099
006400     05  FILLER                PIC X(75)  VALUE                   00640099
006500     'We have not received the 997 (Functional Acknowledgement). K00650099
006600-    'OHLs requires '.                                            00660099
006700     05  FILLER                PIC X(75)  VALUE                   00670099
006800     'that the Acknowledgement must be sent within 48 hours of tra00680099
006900-    'nsmission.    '.                                            00690099
007000     05  FILLER                PIC X(75)  VALUE                   00700099
007100     'Failure to respond may result in chargebacks. Thank you for 00710099
007200-    'your          '.                                            00720099
007300     05  FILLER                PIC X(75)  VALUE                   00730099
007400     'assistance in this matter.                                  00740099
007500-    '              '.                                            00750099
007600     05  FILLER                PIC X(75)  VALUE                   00760099
007700     'KOHLs Department Stores                                     00770099
007800-    '              '.                                            00780099
007900     05  FILLER                PIC X(75)  VALUE                   00790099
008000     'Merchandise Information Office - MIO                        00800099
008100-    '              '.                                            00810099
008200     05  FILLER                PIC X(75)  VALUE                   00820099
008300     'Email: EDIMIO@kohls.com                                     00830099
008400-    '              '.                                            00840099
008500 01  WS-MESSAGE-ELEMENTS REDEFINES WS-MESSAGE-TABLE.              00850099
008600     05  WS-MSG-ELEMENTS       OCCURS 10 TIMES.                   00860099
008700         10  WS-MSG-DETAIL     PIC X(75).                         00870099
008800                                                                  00880099
008900 01  WS-MSG-INVOICE.                                              00890099
009000     05  WS-MSG-VERB1  PIC X(01).                                 00900099
009100     05  WS-MSG-PO     PIC X(15).                                 00910099
009200     05  WS-MSG-VERB2  PIC X(05).                                 00920099
009300     05  WS-MSG-DATE.                                             00930099
009400         10  WS-DTE-MM PIC X(02).                                 00940099
009500         10  WS-DTE-P1 PIC X(01).                                 00950099
009600         10  WS-DTE-DD PIC X(02).                                 00960099
009700         10  WS-DTE-P2 PIC X(01).                                 00970099
009800         10  WS-DTE-YY PIC X(04).                                 00980099
009900     05  WS-MSG-VERB3  PIC X(09).                                 00990099
010000     05  WS-MSG-ISA    PIC X(09).                                 01000099
010100     05  WS-MSG-VERB4  PIC X(05).                                 01010099
010200     05  WS-MSG-SHPDTE.                                           01020099
010300         10  WS-SHPDTE-MM PIC X(02).                              01030099
010400         10  WS-SHPDTE-P1 PIC X(01).                              01040099
010500         10  WS-SHPDTE-DD PIC X(02).                              01050099
010600         10  WS-SHPDTE-P2 PIC X(01).                              01060099
010700         10  WS-SHPDTE-YY PIC X(04).                              01070099
010800     05  WS-MSG-VERB5  PIC X(11).                                 01080099
010900                                                                  01090099
011000 01  WS-MSG-HEADER.                                               01100099
011100     05  WS-MSGHDR-VERB1  PIC X(40).                              01110099
011200     05  WS-MSGHDR-DOC    PIC X(03).                              01120099
011300     05  WS-MSGHDR-VERB2  PIC X(32).                              01130099
011400                                                                  01140099
011500 01  WS-TIMESTAMP              PIC X(26)  VALUE SPACES.           01150099
011600                                                                  01160099
011700 01  WS-DB2-TIMESTAMP.                                            01170099
011800     05  WS-DB2-DATE.                                             01180099
011900         10  WS-DB2-CEN        PIC X(02).                         01190099
012000         10  WS-DB2-YEAR       PIC X(02).                         01200099
012100         10  FILLER            PIC X(01).                         01210099
012200         10  WS-DB2-MTH        PIC X(02).                         01220099
012300         10  FILLER            PIC X(01).                         01230099
012400         10  WS-DB2-DAY        PIC X(02).                         01240099
012500     05  WS-DB2-TIME.                                             01250099
012600         10  FILLER            PIC X(01).                         01260099
012700         10  WS-DB2-HR         PIC X(02).                         01270099
012800         10  FILLER            PIC X(01).                         01280099
012900         10  WS-DB2-MIN        PIC X(02).                         01290099
013000         10  FILLER            PIC X(01).                         01300099
013100         10  WS-DB2-SEC        PIC X(02).                         01310099
013200         10  FILLER            PIC X(01).                         01320099
013300         10  WS-DB2-MICRO      PIC X(06).                         01330099
013400                                                                  01340099
013500 01  WS-TIMESTAMP-REFORMAT.                                       01350099
013600     05  WS-DAY                PIC X(02) VALUE ZEROS.             01360099
013700     05  FILLER                PIC X(01) VALUE SPACE.             01370099
013800     05  WS-MONTH              PIC X(03) VALUE SPACES.            01380099
013900     05  FILLER                PIC X(01) VALUE SPACE.             01390099
014000     05  WS-YEAR               PIC X(02) VALUE ZEROS.             01400099
014100     05  FILLER                PIC X(01) VALUE SPACE.             01410099
014200     05  WS-HOUR               PIC X(02) VALUE SPACES.            01420099
014300     05  WS-VERB-P1            PIC X(01) VALUE ':'.               01430099
014400     05  WS-MINUTE             PIC X(02) VALUE SpACES.            01440099
014500     05  WS-VERB-P2            PIC X(01) VALUE ':'.               01450099
014600     05  WS-SECOND             PIC X(02) VALUE SPACES.            01460099
014700     05  FILLER                PIC X(01) VALUE SPACE.             01470099
014800     05  WS-ZONE               PIC X(03) VALUE 'CDT'.             01480099
014900                                                                  01490099
015000 01  WS-EDIT-ENTID             PIC 9(10)  VALUE ZEROS.            01500099
015100 01  WS-ENTID-REFORMAT REDEFINES                                  01510099
015200     WS-EDIT-ENTID             PIC X(10).                         01520099
015300                                                                  01530099
015400 01  PV-PARAGRAPH-NAME         PIC X(30)  VALUE SPACES.           01540099
015500 01  PV-DB2-OPER-ATTEMPTED     PIC X(30)  VALUE SPACES.           01550099
015600                                                                  01560099
015700 01  WS-FILE-STATUS            PIC X(02)  VALUE SPACE.            01570099
015800     88  SUCCESSFUL-COMPLETION            VALUE '00'.             01580099
015900     88  FILE-NOT-FOUND                   VALUE '23'.             01590099
016000                                                                  01600099
016100 01  WS-REFORMAT-DATE.                                            01610099
016200     05  WS-REFDTE-CCYY          PIC X(04) VALUE SPACES.          01620099
016300     05  WS-REFDTE-P1            PIC X(01) VALUE SPACES.          01630099
016400     05  WS-REFDTE-MM            PIC X(02) VALUE SPACES.          01640099
016500     05  WS-REFDTE-P2            PIC X(01) VALUE SPACES.          01650099
016600     05  WS-REFDTE-DD            PIC X(02) VALUE SPACES.          01660099
016700                                                                  01670099
016800 01  NUMERIC-FIELD-AREA.                                          01680099
016900     05  WS-GS-SEQ-NBR-COUNT   PIC S9(09) COMP VALUE ZEROS.       01690099
017000     05  WS-MSG-SEQ-NBR-COUNT  PIC S9(09) COMP VALUE ZEROS.       01700099
017100     05  WS-SUB                PIC S9(09) COMP VALUE ZEROS.       01710099
017200     05  WS-EDIT-PO-NUMBER     PIC S9(09) COMP VALUE ZEROS.       01720099
017300                                                                  01730099
017400 01  SAVE-AREA.                                                   01740099
017500     05  WS-ENTID-SAVE        PIC S9(09) COMP VALUE ZEROS.        01750099
017600     05  WS-GS-CNTL-NBR-SAVE  PIC S9(9)V COMP-3 VALUE ZEROS.      01760099
017700     05  WS-FUNC-CDE-SEQ-SAVE PIC S9(09) COMP VALUE ZEROS.        01770099
017800     05  WS-TRN-SET-SEQ-SAVE  PIC S9(09) COMP VALUE ZEROS.        01780099
017900     05  WS-TRN-SET-CDE-SAVE  PIC X(3)   VALUE SPACES.            01790099
018000     05  WS-TRN-DTL-TXT-SAVE  PIC X(30)  VALUE SPACES.            01800099
018100     05  WS-TRANS-DATE-SAVE   PIC X(10)  VALUE SPACES.            01810099
018200     05  WS-TP-DKEY-SAVE      PIC S9(09) COMP VALUE ZEROS.        01820099
018300     05  WS-TP-DKEY-TMST-SAVE PIC X(26)  VALUE SPACES.            01830099
018400                                                                  01840099
018500 01  PROGRAM-SWITCHES.                                            01850099
018600     05  END-OF-FILE-SW        PIC X(01)  VALUE 'N'.              01860099
018700         88  END-OF-FILE                  VALUE 'Y'.              01870099
018800     05  WS-FIRST-TIME-SW      PIC X(01)  VALUE 'N'.              01880099
018900         88  FIRST-TIME-THRU              VALUE 'N'.              01890099
019000         88  CONTINUED-PROCESSING         VALUE 'Y'.              01900099
019100     05  WS-PROCESSED-RECS-SW  PIC X(01)  VALUE 'N'.              01910099
019200         88  TEXT-PROCESSED               VALUE 'Y'.              01920099
019300     05  WS-ERROR-FOUND-SW     PIC X(01)  VALUE 'N'.              01930099
019400         88  ERRORS-FOUND                 VALUE 'Y'.              01940099
019500                                                                  01950099
019600 01  ABEND-CODE                PIC S9(04)  VALUE +0 COMP SYNC.    01960099
019700     88 ABEND-4013                         VALUE +4013.           01970099
019800     88 ABEND-4095                         VALUE +4095.           01980099
019900                                                                  01990099
020000******************************************************************02000099
020100* SQLCA MESSAGE MODULE DSNTIAR ARGUMENTS......                    02010099
020200******************************************************************02020099
020300     COPY DPWS004.                                                02030099
020400                                                                  02040099
020500******************************************************************02050099
020600* NUMERIC EDIT LAYOUT ARGUMENTS.....                              02060099
020700******************************************************************02070099
020800     COPY DPWS010I.                                               02080099
020900                                                                  02090099
021000******************************************************************02100099
021100* TRADING PARTNER TABLE ARGUMENTS.....                            02110099
021200******************************************************************02120099
021300     EXEC SQL                                                     02130099
021400        INCLUDE TTRDPRT                                           02140099
021500     END-EXEC.                                                    02150099
021600                                                                  02160099
021700******************************************************************02170099
021800* TRADING PARTNER ENTERPRISE NAME ARGUMENTS....                   02180099
021900******************************************************************02190099
022000     EXEC SQL                                                     02200099
022100        INCLUDE TENTNME                                           02210099
022200     END-EXEC.                                                    02220099
022300                                                                  02230099
022400******************************************************************02240099
022500* FUNCTIONAL GROUP TRANSACTION TABLE ARGUMENTS...                 02250099
022600******************************************************************02260099
022700     EXEC SQL                                                     02270099
022800        INCLUDE TFGTRST                                           02280099
022900     END-EXEC.                                                    02290099
023000                                                                  02300099
023100******************************************************************02310099
023200* TRADING PARTNER FUNCTION GROUP CONTROL TABLE ARGUMENTS......    02320099
023300******************************************************************02330099
023400     EXEC SQL                                                     02340099
023500        INCLUDE TTRDFNC                                           02350099
023600     END-EXEC.                                                    02360099
023700                                                                  02370099
023800******************************************************************02380099
023900* PURCHASE ORDER SHIPMENT INFORMATION ARGUMENTS......             02390099
024000******************************************************************02400099
024100     EXEC SQL                                                     02410099
024200        INCLUDE TPLNSHP                                           02420099
024300     END-EXEC.                                                    02430099
024400                                                                  02440099
024500******************************************************************02450099
024600* TRADING PARTNER DUPLICATE MASTER LISTING TABLE ARGUMENTS.       02460099
024700******************************************************************02470099
024800     EXEC SQL                                                     02480099
024900        INCLUDE TTRDMLT                                           02490099
025000     END-EXEC.                                                    02500099
025100                                                                  02510099
025200******************************************************************02520099
025300* TRADING PARTNER TRANSACTION SET TABLE ARGUMENTS.                02530099
025400******************************************************************02540099
025500     EXEC SQL                                                     02550099
025600        INCLUDE TTRDTRN                                           02560099
025700     END-EXEC.                                                    02570099
025800                                                                  02580099
025900******************************************************************02590099
026000* DB2 ERROR HANDLING ARGUMENTS....                                02600099
026100******************************************************************02610099
026200     EXEC SQL                                                     02620099
026300        INCLUDE SQLCA                                             02630099
026400     END-EXEC.                                                    02640099
026500                                                                  02650099
026600******************************************************************02660099
026700* TABLE CURSOR FOR THE TRADING PARTNER FUNCTIONAL CONTROL GROUP.  02670099
026800******************************************************************02680099
026900     EXEC SQL                                                     02690099
027000         DECLARE TRDFNC_CURSOR CURSOR FOR                         02700099
027100            SELECT DISTINCT                                       02710099
027200                 A.TP_DKEY,                                       02720099
027300                 A.FUNC_CDE,                                      02730099
027400                 TRAN_SET_CDE,                                    02740099
027500                 PROD_TEST_IND,                                   02750099
027600                 B.INACTV_DTE,                                    02760099
027700                 C.ENT_ID,                                        02770099
027800                 C.VEND_INCHG_ID,                                 02780099
027900                 C.VEND_INCHG_ID_DESC                             02790099
028000            FROM TTRDFNC A,                                       02800099
028100                 TTRDTRN B,                                       02810099
028200                 TTRDPRT C                                        02820099
028300            WHERE C.ENT_ID = :TRDPRT-ENT-ID                       02830099
028400              AND C.TP_DKEY = A.TP_DKEY                           02840099
028500              AND C.TP_DKEY = B.TP_DKEY                           02850099
028600              AND A.FUNC_CDE = 'TX'                               02860099
028700              AND TRAN_SET_CDE = '864'                            02870099
028800              AND PROD_TEST_IND = 'P'                             02880099
028900              AND B.INACTV_DTE = '9999-09-09'                     02890099
029000              AND C.INACTV_DTE = '9999-09-09'                     02900099
029100     END-EXEC.                                                    02910099
029200                                                                  02920099
029300******************************************************************02930099
029400* TABLE CURSOR FOR DOCUMENT 864 MESSAGE TEXT INFORMATION......    02940099
029500******************************************************************02950099
029600     EXEC SQL                                                     02960099
029700       DECLARE TRDPRT_CURSOR CURSOR FOR                           02970099
029800         SELECT DISTINCT                                          02980099
029900            A.ENT_NAME_DESC,                                      02990099
030000            B.ENT_ID,                                             03000099
030100            C.FUNC_CDE_CNTL_NBR,                                  03010099
030200            C.TRN_SET_CDE,                                        03020099
030300            C.VEND_ACK_IND,                                       03030099
030400            C.TP_DKEY,                                            03040099
030500            C.TP_DKEY_TMST,                                       03050099
030600            C.TRN_DTL_TXT,                                        03060099
030700            C.FUNC_CDE_SEQ_NBR,                                   03070099
030800            C.TRN_SET_SEQ_NBR,                                    03080099
030900            C.PO_ACKNL_STAT_CDE                                   03090099
031000         FROM TENTNME A,                                          03100099
031100              TTRDPRT B,                                          03110099
031200              TFGTRST C                                           03120099
031300        WHERE B.INACTV_DTE = '9999-09-09'                         03130099
031400           AND A.ENT_ID = B.ENT_ID                                03140099
031500           AND A.TYPE_CDE = '01'                                  03150099
031600           AND B.TP_DKEY = C.TP_DKEY                              03160099
031700           AND C.VEND_ACK_IND = 'N'                               03170099
031800           AND (C.TRN_SET_CDE = '850' OR                          03180099
031900                C.TRN_SET_CDE = '860')                            03190099
032000           AND C.TP_DKEY_TMST BETWEEN                             03200099
032100               TIMESTAMP(CHAR(CURRENT DATE - 5 DAYS) ||           03210099
032200                '-00.00.00.000000')  AND                          03220099
032300               TIMESTAMP(CHAR(CURRENT DATE - 4 DAYS) ||           03230099
032400                '-23.59.59.999999')                               03240099
032500           AND C.PO_ACKNL_STAT_CDE = ' '                          03250099
032600      ORDER BY 2, 4, 3, 8                                         03260099
032700     END-EXEC.                                                    03270099
032800                                                                  03280099
032900******************************************************************03290099
033000* SQL ERROR HANDLING ARGUMENTS.......                             03300099
033100******************************************************************03310099
033200     COPY SQLCA2.                                                 03320099
033300                                                                  03330099
033400******************************************************************03340099
033500*FLOW:    THE MODULE SEQUENTIALLY READS THE TRADING PARTNER CURSOR03350099
033600*      LOOKING FOR DISTINCT PURCHASE ORDERS WHERE A FUNCTIONAL    03360099
033700*      ACKNOWLEDGEMENT HAS NOT BEEN RECEIVED IN THE LAST 4 DAYS.  03370099
033800*      THE CURSOR INCLUDES THE FOLLOWING TABLES.                  03380099
033900*               TTRDPRT - TTRADING PARTNER TABLE.                 03390099
034000*               TENTNME - ENT ID NAME TABLE.                      03400099
034100*               TFGTRST - TRANSACTION STATUS TABLE.               03410099
034200*      INFORMATION IS SORTED BY ENT ID, GS CONTROL NUMBER, AND PO 03420099
034300*      NUMBER.                                                    03430099
034400*                                                                 03440099
034500*         GENERATE THE FUNCTIONAL ACKNOWLEDGEMENT EXTRACT RECORDS 03450099
034600*      FOR TRADING PARTNERS WHO ARE ABLE TO RECEIVE 864S. VERIFY  03460099
034700*      THE TRADING PARTNER IS ABLE TO RECEIVE TEXT MESSAGES BY    03470099
034800*      READING THE FUNCTIONAL GROUP TABLE CURSOR. CHECK FOR A TX  03480099
034900*      FOR THE TRADING PARTNER. THE CURSOR INCLUDES THE FOLLOWING 03490099
035000*      TABLES.                                                    03500099
035100*               TTRDFNC - TRADING PARTNER FUNCTIONAL GROUP TABLE. 03510099
035200*               TFGTRST - TRANSACTION STATUS TABLE.               03520099
035300*                                                                 03530099
035400*         CHECK FOR A PARENT/CHILD RELATIONSHIP BY COMPARING THE  03540099
035500*      INTERCHANGE ID ON THE TRADING PARTNER TABLE WITH THE ID    03550099
035600*      ON THE TRADING PARTNER DUPLICATE MASTER TABLE. THE CHECK   03560099
035700*      AIDS IN ELIMINATING MULTIPLE 864 DOCUMENTS GOING TO A      03570099
035800*      TRADING PARTNER WHICH SHARES THEIR ID WITH MULTIPLE VENDORS03580099
035900*               TTRDMLT - TRADING PARTNER DUPLICATE MASTER LIST.  03590099
036000*                                                                 03600099
036100*         HARD ERRORS OCCUR ON THE OPENS AND CLOSES OF THE TABLE  03610099
036200*      CURSORS. ABEND THE MODULE. (ERROR STATUS 4013)             03620099
036300*                                                                 03630099
036400******************************************************************03640099
036500 PROCEDURE DIVISION.                                              03650099
036600******************************************************************03660099
036700 0000-MAINLINE-DRIVER-SECTION.                                    03670099
036800                                                                  03680099
036900     PERFORM 0100-INITIALIZATION                                  03690099
037000        THRU 0100-INITIALIZATION-EXIT.                            03700099
037100                                                                  03710099
037200                                                                  03720099
037300     PERFORM 1000-PROCESS-FILE                                    03730099
037400        THRU 1000-PROCESS-FILE-EXIT                               03740099
037500           UNTIL END-OF-FILE.                                     03750099
037600                                                                  03760099
037700     PERFORM 9000-END-OF-JOB-TASKS                                03770099
037800        THRU 9000-END-OF-JOB-TASKS-EXIT.                          03780099
037900                                                                  03790099
038000 9999-EXIT-PROGRAM.                                               03800099
038100     STOP RUN.                                                    03810099
038200                                                                  03820099
038300******************************************************************03830099
038400* 0100-INITIALIZATION....                                         03840099
038500******************************************************************03850099
038600 0100-INITIALIZATION.                                             03860099
038700                                                                  03870099
038800     OPEN OUTPUT PO-OUTPUT-FILE.                                  03880099
038900                                                                  03890099
039000     EXEC SQL                                                     03900099
039100         OPEN TRDPRT_CURSOR                                       03910099
039200     END-EXEC.                                                    03920099
039300                                                                  03930099
039400     EVALUATE TRUE                                                03940099
039500       WHEN SQLCODE IS EQUAL TO ZERO                              03950099
039600         CONTINUE                                                 03960099
039700       WHEN SQLWARN IS NOT EQUAL TO SPACES                        03970099
039800       WHEN SQLCODE IS NOT EQUAL TO ZERO                          03980099
039900        MOVE '0100-INITIALZATION' TO PV-PARAGRAPH-NAME            03990099
040000        MOVE 'OPEN CURSOR' TO PV-DB2-OPER-ATTEMPTED               04000099
040100        PERFORM 9900-SQL-ERROR                                    04010099
040200     END-EVALUATE.                                                04020099
040300                                                                  04030099
040400     MOVE ZEROS            TO WS-SUB.                             04040099
040500     MOVE ZEROS            TO WS-GS-SEQ-NBR-COUNT.                04050099
040600     MOVE ZEROS            TO WS-MSG-SEQ-NBR-COUNT.               04060099
040700     MOVE 'N'              TO END-OF-FILE-SW.                     04070099
040800     MOVE 'N'              TO WS-FIRST-TIME-SW.                   04080099
040900     MOVE 'N'              TO WS-PROCESSED-RECS-SW.               04090099
041000                                                                  04100099
041100 0100-INITIALIZATION-EXIT.                                        04110099
041200     EXIT.                                                        04120099
041300                                                                  04130099
041400******************************************************************04140099
041500* 1000-PROCESS FILE...                                            04150099
041600*   THE ROUTINE OPENS THE CURSOR FOR TABLES TTRDPRT, TFGTRST, AND 04160099
041700*   TENTNME. THE CRITERIA FOR CONTINUED PROCESSING ICLUDE THE     04170099
041800*   FOLLOWING.                                                    04180099
041900*                                                                 04190099
042000*   1. ACTIVE TRADING PARTNER                                     04200099
042100*   2. TYPE CODE IS EQUAL TO '01'                                 04210099
042200*   3. NO FUNCTIONAL ACKNOWLEDGEMENT HAS BEEN SENT FOR THE PO     04220099
042300*   4. THE PO IS TWO DAYS OLD AND WE HAVE NOT RECEIVED THE FA YET.04230099
042400******************************************************************04240099
042500 1000-PROCESS-FILE.                                               04250099
042600                                                                  04260099
042700     EXEC SQL                                                     04270099
042800         FETCH TRDPRT_CURSOR                                      04280099
042900         INTO :ENTNME-ENT-NAME-DESC,                              04290099
043000              :TRDPRT-ENT-ID,                                     04300099
043100              :FGTRST-FUNC-CDE-CNTL-NBR,                          04310099
043200              :FGTRST-TRN-SET-CDE,                                04320099
043300              :FGTRST-VEND-ACK-IND,                               04330099
043400              :FGTRST-TP-DKEY,                                    04340099
043500              :FGTRST-TP-DKEY-TMST,                               04350099
043600              :FGTRST-TRN-DTL-TXT,                                04360099
043700              :FGTRST-FUNC-CDE-SEQ-NBR,                           04370099
043800              :FGTRST-TRN-SET-SEQ-NBR                             04380099
043900     END-EXEC.                                                    04390099
044000                                                                  04400099
044100     EVALUATE TRUE                                                04410099
044200       WHEN SQLCODE IS EQUAL TO ZERO                              04420099
044300         PERFORM 2000-GENERATE-864                                04430099
044400            THRU 2000-GENERATE-864-EXIT                           04440099
044500       WHEN SQLCODE IS EQUAL TO +100                              04450099
044600         MOVE 'Y' TO END-OF-FILE-SW                               04460099
044700       WHEN SQLWARN IS NOT EQUAL TO SPACES                        04470099
044800       WHEN SQLCODE IS NOT EQUAL TO ZERO                          04480099
044900         MOVE '1000-PROCESS-FILE' TO PV-PARAGRAPH-NAME            04490099
045000         MOVE 'FETCH TRDPRT' TO PV-DB2-OPER-ATTEMPTED             04500099
045100         MOVE 'Y' TO END-OF-FILE-SW                               04510099
045200         PERFORM 9900-SQL-ERROR                                   04520099
045300     END-EVALUATE.                                                04530099
045400                                                                  04540099
045500 1000-PROCESS-FILE-EXIT.                                          04550099
045600     EXIT.                                                        04560099
045700                                                                  04570099
045800******************************************************************04580099
045900* 2000-GENERATE THE 864.....                                      04590099
046000*   THE ROUTINE OPENS THE CURSOR FOR TABLE TTRDFNC AND CALL THE   04600099
046100*   CURSOR PROCESS MODULE 3000-PROCESS-CURSOR. THE ROUTINE CHECKS 04610099
046200*   TO SEE IF THE VENDOR IS ABLE TO ACCEPT AUTOMATED TEXT         04620099
046300*   MESSAGES. (DOCUMENT 864)                                      04630099
046400******************************************************************04640099
046500 2000-GENERATE-864.                                               04650099
046600                                                                  04660099
046700     EXEC SQL                                                     04670099
046800         OPEN TRDFNC_CURSOR                                       04680099
046900     END-EXEC.                                                    04690099
047000                                                                  04700099
047100     EVALUATE TRUE                                                04710099
047200       WHEN SQLCODE IS EQUAL TO ZERO                              04720099
047300         CONTINUE                                                 04730099
047400       WHEN SQLWARN IS NOT EQUAL TO SPACES                        04740099
047500       WHEN SQLCODE IS NOT EQUAL TO ZERO                          04750099
047600        MOVE '2000-GENERATE-864' TO PV-PARAGRAPH-NAME             04760099
047700        MOVE 'OPEN CURSOR' TO PV-DB2-OPER-ATTEMPTED               04770099
047800        MOVE 'Y' TO END-OF-FILE-SW                                04780099
047900        PERFORM 9900-SQL-ERROR                                    04790099
048000     END-EVALUATE.                                                04800099
048100                                                                  04810099
048200     PERFORM 3000-PROCESS-CURSOR                                  04820099
048300        THRU 3000-PROCESS-CURSOR-EXIT.                            04830099
048400                                                                  04840099
048500     EXEC SQL                                                     04850099
048600         CLOSE TRDFNC_CURSOR                                      04860099
048700     END-EXEC.                                                    04870099
048800                                                                  04880099
048900     EVALUATE TRUE                                                04890099
049000       WHEN SQLCODE IS EQUAL TO ZERO                              04900099
049100         CONTINUE                                                 04910099
049200       WHEN SQLWARN IS NOT EQUAL TO SPACES                        04920099
049300       WHEN SQLCODE IS NOT EQUAL TO ZERO                          04930099
049400        MOVE '2000-GENERATE-864' TO PV-PARAGRAPH-NAME             04940099
049500        MOVE 'CLOSE CURSOR' TO PV-DB2-OPER-ATTEMPTED              04950099
049600        MOVE 'Y' TO END-OF-FILE-SW                                04960099
049700        PERFORM 9900-SQL-ERROR                                    04970099
049800     END-EVALUATE.                                                04980099
049900                                                                  04990099
050000 2000-GENERATE-864-EXIT.                                          05000099
050100     EXIT.                                                        05010099
050200                                                                  05020099
050300******************************************************************05030099
050400* 3000-PROCESS THE CURSOR FOR TABLE TTRDFNC FOR THE ENT-ID.....   05040099
050500*   THE ROUTINE CHECKS THE TTRDFNC TABLE TO SEE IF THE VENDOR     05050099
050600*   SETUP TO ACCEPT DOCUMENT 864 - TEXT MESSAGES. THE FUNCTION    05060099
050700*   CODE MUST BE A "TX" AND A SUCCESS FETCH HAS TO BE PERFORMED   05070099
050800*   BEFORE THE EXTRACT IS PERFORMED.                              05080099
050900*                                                                 05090099
051000*   IF A ROW IS NOT FOUND, AN EMAIL IS TO BE SENT IN PLACE OF THE 05100099
051100*   864. THE EMAIL IS GENERATED AND SENT IN ETKUP049.             05110099
051200*                                                                 05120099
051300*   IF A PROBLEM OCCURS, ERROR THE SELECT AND END THE PROGRAM.    05130099
051400******************************************************************05140099
051500 3000-PROCESS-CURSOR.                                             05150099
051600                                                                  05160099
051700     EXEC SQL                                                     05170099
051800         FETCH TRDFNC_CURSOR                                      05180099
051900         INTO :TRDFNC-TP-DKEY,                                    05190099
052000              :TRDFNC-FUNC-CDE,                                   05200099
052100              :TRDTRN-TRAN-SET-CDE,                               05210099
052200              :TRDTRN-PROD-TEST-IND,                              05220099
052300              :TRDTRN-INACTV-DTE,                                 05230099
052400              :TRDPRT-ENT-ID,                                     05240099
052500              :TRDPRT-VEND-INCHG-ID,                              05250099
052600              :TRDPRT-VEND-INCHG-ID-DESC                          05260099
052700     END-EXEC.                                                    05270099
052800                                                                  05280099
052900     EVALUATE TRUE                                                05290099
053000       WHEN SQLCODE IS EQUAL TO ZERO                              05300099
053100         PERFORM 3100-GENERATE-FUNC-ACK                           05310099
053200            THRU 3100-GENERATE-FUNC-ACK-EXIT                      05320099
053300       WHEN SQLCODE IS EQUAL TO +100                              05330099
053400         CONTINUE                                                 05340099
053500       WHEN SQLWARN IS NOT EQUAL TO SPACES                        05350099
053600       WHEN SQLCODE IS NOT EQUAL TO ZERO                          05360099
053700         MOVE 'Y' TO END-OF-FILE-SW                               05370099
053800         MOVE '3000-PROCESS-CURSOR' TO PV-PARAGRAPH-NAME          05380099
053900         MOVE 'FETCH CURSOR' TO PV-DB2-OPER-ATTEMPTED             05390099
054000         PERFORM 9900-SQL-ERROR                                   05400099
054100     END-EVALUATE.                                                05410099
054200                                                                  05420099
054300 3000-PROCESS-CURSOR-EXIT.                                        05430099
054400     EXIT.                                                        05440099
054500                                                                  05450099
054600******************************************************************05460099
054700* 3100-GENERATE A FUNCTIONAL ACKNOWLEDGEMENT....                  05470099
054800******************************************************************05480099
054900 3100-GENERATE-FUNC-ACK.                                          05490099
055000***   TEST FOR A PARENT/CHILD RELATIONSHIP. WE ONLY WANT TO SEND  05500099
055100*** ONE EMAIL PER ENT ID. NO DUPLICATES OF THE SAME TO THE SAME   05510099
055200*** VENDOR. THE FOLLOWING SCENARIOS HOLD TO FOR 864 GENERATION.   05520099
055300***                                                               05530099
055400***   SCENARIOS.                                                  05540099
055500***   1.  IF THE INTERCHANGE ID IS NOT ON TTRDMLT, SEND THE 864 AS05550099
055600***       IS TO THE TRADING PARTNER.                              05560099
055700***   2.  IF THE INTERCHANGE ID IS ON TTRDMLT AND THE ENTIDS MATCH05570099
055800***       BETWEEN TTRDPRT AND TTRDMLT, SEND THE 864 AS IS TO THE  05580099
055900***       TRADING PARTNER.                                        05590099
056000***   3.  IF THE INTERCHANGE ID IS ON TTRDMLT AND THE ENTIDS DO   05600099
056100***       NOT MATCH BETWEEN TTRDPRT AND TTRDMLT, DO NOT SEND THE  05610099
056200***       864 TO THE TRADING PARTNER.                             05620099
056300***                                                               05630099
056400                                                                  05640099
056500     EXEC SQL                                                     05650099
056600       SELECT PRNT_ENT_ID                                         05660099
056700         INTO :TRDMLT-PRNT-ENT-ID                                 05670099
056800       FROM TTRDMLT                                               05680099
056900       WHERE VND_INCHG_ID = :TRDPRT-VEND-INCHG-ID                 05690099
057000         AND VND_INCHG_ID_DESC = :TRDPRT-VEND-INCHG-ID-DESC       05700099
057100     END-EXEC.                                                    05710099
057200                                                                  05720099
057300     EVALUATE TRUE                                                05730099
057400       WHEN SQLCODE IS EQUAL TO ZERO                              05740099
057500         CONTINUE                                                 05750099
057600       WHEN SQLCODE IS EQUAL TO +100                              05760099
057700         GO TO 3100-GEN-FUNC-ACK-CONTINUE                         05770099
057800       WHEN SQLWARN IS NOT EQUAL TO SPACES                        05780099
057900       WHEN SQLCODE IS NOT EQUAL TO ZERO                          05790099
058000         DISPLAY SPACES                                           05800099
058100         DISPLAY 'UNABLE TO LOCATE TTRDMLT TABLE ENTRY - ETKUP048'05810099
058200         DISPLAY 'VEND_INCHG_ID_DESC = ' TRDPRT-VEND-INCHG-ID-DESC05820099
058300         DISPLAY 'VEND_INCHG_ID = ' TRDPRT-VEND-INCHG-ID          05830099
058400         DISPLAY 'ENT_ID = ' TRDPRT-ENT-ID                        05840099
058500         DISPLAY 'SQLCODE = ' SQLCODE                             05850099
058600         MOVE '3100-GENERATE-FUN' TO PV-PARAGRAPH-NAME            05860099
058700         MOVE 'SLECT TRDMLT' TO PV-DB2-OPER-ATTEMPTED             05870099
058800         MOVE 'Y' TO END-OF-FILE-SW                               05880099
058900         PERFORM 9900-SQL-ERROR                                   05890099
059000         GO TO 3100-GENERATE-FUNC-ACK-EXIT                        05900099
059100     END-EVALUATE.                                                05910099
059200                                                                  05920099
059300     IF TRDMLT-PRNT-ENT-ID IS NOT EQUAL TO TRDPRT-ENT-ID          05930099
059400         PERFORM 5300-UPD-TFGTRST-STATUS                          05940099
059500            THRU 5300-UPD-TFGTRST-STATUS-EXIT                     05950099
059600         GO TO 3100-GENERATE-FUNC-ACK-EXIT.                       05960099
059700                                                                  05970099
059800 3100-GEN-FUNC-ACK-CONTINUE.                                      05980099
059900***   PRIME THE CONTROL BREAKS FOR TEXT MESSAGE PROCESSING AND    05990099
060000*** BEGIN TO GENERATE THE FIRST DOCUMENT....                      06000099
060100                                                                  06010099
060200     IF FIRST-TIME-THRU                                           06020099
060300       MOVE TRDPRT-ENT-ID            TO WS-ENTID-SAVE             06030099
060400       MOVE FGTRST-FUNC-CDE-CNTL-NBR TO WS-GS-CNTL-NBR-SAVE       06040099
060500       MOVE FGTRST-FUNC-CDE-SEQ-NBR  TO WS-FUNC-CDE-SEQ-SAVE      06050099
060600       MOVE FGTRST-TRN-SET-SEQ-NBR   TO WS-TRN-SET-SEQ-SAVE       06060099
060700       MOVE FGTRST-TRN-SET-CDE       TO WS-TRN-SET-CDE-SAVE       06070099
060800       MOVE FGTRST-TRN-DTL-TXT       TO WS-TRN-DTL-TXT-SAVE       06080099
060900       MOVE FGTRST-TP-DKEY-TMST      TO WS-TRANS-DATE-SAVE        06090099
061000       MOVE FGTRST-TP-DKEY           TO WS-TP-DKEY-SAVE           06100099
061100       MOVE FGTRST-TP-DKEY-TMST      TO WS-TP-DKEY-TMST-SAVE      06110099
061200       PERFORM 4000-RECORD-TYPE-01                                06120099
061300          THRU 4000-RECORD-TYPE-01-EXIT                           06130099
061400       MOVE ZEROS         TO WS-GS-SEQ-NBR-COUNT                  06140099
061500       PERFORM 4100-RECORD-TYPE-02                                06150099
061600          THRU 4100-RECORD-TYPE-02-EXIT                           06160099
061700       MOVE ZEROS         TO WS-SUB                               06170099
061800       MOVE ZEROS         TO WS-MSG-SEQ-NBR-COUNT                 06180099
061900       PERFORM 4200-RECORD-TYPE-03-VERB                           06190099
062000          THRU 4200-RECORD-TYPE-03-VERB-EXIT                      06200099
062100            VARYING WS-SUB FROM 1 BY 1                            06210099
062200            UNTIL WS-SUB IS GREATER THAN 2                        06220099
062300       PERFORM 4400-RECORD-TYPE-03-PO                             06230099
062400          THRU 4400-RECORD-TYPE-03-PO-EXIT                        06240099
062500       MOVE 'Y'                      TO WS-FIRST-TIME-SW.         06250099
062600                                                                  06260099
062700***   CONTROL BREAK PROCESSING...                                 06270099
062800*** 1.  TRDPRT-ENT-ID (TRADING PARTNER ENTITY ID)                 06280099
062900*** 2.  FGTRST-FUNC-CDE-CNTL-NBR (FUNCTIONAL GROUP)               06290099
063000*** 3.  FGTRST-TRN-DTL-TXT (PURCHASE ORDER NUMBER)                06300099
063100*** 4.  FGTRST-TP-DKEY (TP DKEY)                                  06310099
063200*** 5.  FGTRST-TP-DKEY-TMST (TP DKEY TIMESTAMP)                   06320099
063300                                                                  06330099
063400     IF (TRDPRT-ENT-ID EQUAL WS-ENTID-SAVE AND                    06340099
063500         FGTRST-TRN-SET-CDE = WS-TRN-SET-CDE-SAVE)                06350099
063600       IF FGTRST-FUNC-CDE-CNTL-NBR EQUAL WS-GS-CNTL-NBR-SAVE      06360099
063700         IF FGTRST-TRN-DTL-TXT EQUAL WS-TRN-DTL-TXT-SAVE          06370099
063800           IF FGTRST-TP-DKEY EQUAL WS-TP-DKEY-SAVE                06380099
063900             IF FGTRST-TP-DKEY-TMST EQUAL WS-TP-DKEY-TMST-SAVE    06390099
064000               NEXT SENTENCE                                      06400099
064100             ELSE                                                 06410099
064200               MOVE TRDPRT-ENT-ID TO WS-ENTID-SAVE                06420099
064300               MOVE FGTRST-FUNC-CDE-CNTL-NBR                      06430099
064400                            TO WS-GS-CNTL-NBR-SAVE                06440099
064500               MOVE FGTRST-FUNC-CDE-SEQ-NBR                       06450099
064600                            TO WS-FUNC-CDE-SEQ-SAVE               06460099
064700               MOVE FGTRST-TRN-SET-SEQ-NBR                        06470099
064800                            TO WS-TRN-SET-SEQ-SAVE                06480099
064900               MOVE FGTRST-TRN-SET-CDE TO WS-TRN-SET-CDE-SAVE     06490099
065000               MOVE FGTRST-TRN-DTL-TXT                            06500099
065100                            TO WS-TRN-DTL-TXT-SAVE                06510099
065200               MOVE FGTRST-TP-DKEY-TMST TO WS-TRANS-DATE-SAVE     06520099
065300               MOVE FGTRST-TP-DKEY TO WS-TP-DKEY-SAVE             06530099
065400               MOVE FGTRST-TP-DKEY-TMST TO WS-TP-DKEY-TMST-SAVE   06540099
065500               PERFORM 4400-RECORD-TYPE-03-PO                     06550099
065600                  THRU 4400-RECORD-TYPE-03-PO-EXIT                06560099
065700           ELSE                                                   06570099
065800             MOVE TRDPRT-ENT-ID TO WS-ENTID-SAVE                  06580099
065900             MOVE FGTRST-FUNC-CDE-CNTL-NBR                        06590099
066000                            TO WS-GS-CNTL-NBR-SAVE                06600099
066100             MOVE FGTRST-FUNC-CDE-SEQ-NBR                         06610099
066200                            TO WS-FUNC-CDE-SEQ-SAVE               06620099
066300             MOVE FGTRST-TRN-SET-SEQ-NBR                          06630099
066400                            TO WS-TRN-SET-SEQ-SAVE                06640099
066500             MOVE FGTRST-TRN-SET-CDE TO WS-TRN-SET-CDE-SAVE       06650099
066600             MOVE FGTRST-TRN-DTL-TXT                              06660099
066700                            TO WS-TRN-DTL-TXT-SAVE                06670099
066800             MOVE FGTRST-TP-DKEY-TMST TO WS-TRANS-DATE-SAVE       06680099
066900             MOVE FGTRST-TP-DKEY TO WS-TP-DKEY-SAVE               06690099
067000             MOVE FGTRST-TP-DKEY-TMST TO WS-TP-DKEY-TMST-SAVE     06700099
067100             PERFORM 4400-RECORD-TYPE-03-PO                       06710099
067200                THRU 4400-RECORD-TYPE-03-PO-EXIT                  06720099
067300         ELSE                                                     06730099
067400           MOVE TRDPRT-ENT-ID TO WS-ENTID-SAVE                    06740099
067500           MOVE FGTRST-FUNC-CDE-CNTL-NBR                          06750099
067600                            TO WS-GS-CNTL-NBR-SAVE                06760099
067700           MOVE FGTRST-FUNC-CDE-SEQ-NBR                           06770099
067800                            TO WS-FUNC-CDE-SEQ-SAVE               06780099
067900           MOVE FGTRST-TRN-SET-SEQ-NBR                            06790099
068000                            TO WS-TRN-SET-SEQ-SAVE                06800099
068100           MOVE FGTRST-TRN-SET-CDE TO WS-TRN-SET-CDE-SAVE         06810099
068200           MOVE FGTRST-TRN-DTL-TXT                                06820099
068300                            TO WS-TRN-DTL-TXT-SAVE                06830099
068400           MOVE FGTRST-TP-DKEY-TMST TO WS-TRANS-DATE-SAVE         06840099
068500           MOVE FGTRST-TP-DKEY TO WS-TP-DKEY-SAVE                 06850099
068600           MOVE FGTRST-TP-DKEY-TMST TO WS-TP-DKEY-TMST-SAVE       06860099
068700           PERFORM 4400-RECORD-TYPE-03-PO                         06870099
068800              THRU 4400-RECORD-TYPE-03-PO-EXIT                    06880099
068900       ELSE                                                       06890099
069000         MOVE ZEROS         TO WS-SUB                             06900099
069100         PERFORM 4200-RECORD-TYPE-03-VERB                         06910099
069200            THRU 4200-RECORD-TYPE-03-VERB-EXIT                    06920099
069300              VARYING WS-SUB FROM 4 BY 1                          06930099
069400              UNTIL WS-SUB IS GREATER THAN 10                     06940099
069500         MOVE TRDPRT-ENT-ID TO WS-ENTID-SAVE                      06950099
069600         MOVE FGTRST-FUNC-CDE-CNTL-NBR                            06960099
069700                            TO WS-GS-CNTL-NBR-SAVE                06970099
069800         MOVE FGTRST-FUNC-CDE-SEQ-NBR                             06980099
069900                            TO WS-FUNC-CDE-SEQ-SAVE               06990099
070000         MOVE FGTRST-TRN-SET-SEQ-NBR                              07000099
070100                            TO WS-TRN-SET-SEQ-SAVE                07010099
070200         MOVE FGTRST-TRN-SET-CDE TO WS-TRN-SET-CDE-SAVE           07020099
070300         MOVE FGTRST-TRN-DTL-TXT                                  07030099
070400                            TO WS-TRN-DTL-TXT-SAVE                07040099
070500         MOVE FGTRST-TP-DKEY-TMST TO WS-TRANS-DATE-SAVE           07050099
070600         MOVE FGTRST-TP-DKEY TO WS-TP-DKEY-SAVE                   07060099
070700         MOVE FGTRST-TP-DKEY-TMST TO WS-TP-DKEY-TMST-SAVE         07070099
070800         PERFORM 4100-RECORD-TYPE-02                              07080099
070900            THRU 4100-RECORD-TYPE-02-EXIT                         07090099
071000         MOVE ZEROS         TO WS-SUB                             07100099
071100         MOVE ZEROS         TO WS-MSG-SEQ-NBR-COUNT               07110099
071200         PERFORM 4200-RECORD-TYPE-03-VERB                         07120099
071300            THRU 4200-RECORD-TYPE-03-VERB-EXIT                    07130099
071400              VARYING WS-SUB FROM 1 BY 1                          07140099
071500              UNTIL WS-SUB IS GREATER THAN 2                      07150099
071600         PERFORM 4400-RECORD-TYPE-03-PO                           07160099
071700            THRU 4400-RECORD-TYPE-03-PO-EXIT                      07170099
071800     ELSE                                                         07180099
071900       MOVE ZEROS         TO WS-SUB                               07190099
072000       PERFORM 4200-RECORD-TYPE-03-VERB                           07200099
072100          THRU 4200-RECORD-TYPE-03-VERB-EXIT                      07210099
072200            VARYING WS-SUB FROM 4 BY 1                            07220099
072300            UNTIL WS-SUB IS GREATER THAN 10                       07230099
072400       MOVE TRDPRT-ENT-ID            TO WS-ENTID-SAVE             07240099
072500       MOVE FGTRST-FUNC-CDE-CNTL-NBR TO WS-GS-CNTL-NBR-SAVE       07250099
072600       MOVE FGTRST-FUNC-CDE-SEQ-NBR  TO WS-FUNC-CDE-SEQ-SAVE      07260099
072700       MOVE FGTRST-TRN-SET-SEQ-NBR   TO WS-TRN-SET-SEQ-SAVE       07270099
072800       MOVE FGTRST-TRN-SET-CDE       TO WS-TRN-SET-CDE-SAVE       07280099
072900       MOVE FGTRST-TRN-DTL-TXT       TO WS-TRN-DTL-TXT-SAVE       07290099
073000       MOVE FGTRST-TP-DKEY-TMST      TO WS-TRANS-DATE-SAVE        07300099
073100       MOVE FGTRST-TP-DKEY           TO WS-TP-DKEY-SAVE           07310099
073200       MOVE FGTRST-TP-DKEY-TMST      TO WS-TP-DKEY-TMST-SAVE      07320099
073300       PERFORM 4000-RECORD-TYPE-01                                07330099
073400          THRU 4000-RECORD-TYPE-01-EXIT                           07340099
073500       MOVE ZEROS         TO WS-GS-SEQ-NBR-COUNT                  07350099
073600       PERFORM 4100-RECORD-TYPE-02                                07360099
073700          THRU 4100-RECORD-TYPE-02-EXIT                           07370099
073800       MOVE ZEROS         TO WS-SUB                               07380099
073900       MOVE ZEROS         TO WS-MSG-SEQ-NBR-COUNT                 07390099
074000       PERFORM 4200-RECORD-TYPE-03-VERB                           07400099
074100          THRU 4200-RECORD-TYPE-03-VERB-EXIT                      07410099
074200            VARYING WS-SUB FROM 1 BY 1                            07420099
074300            UNTIL WS-SUB IS GREATER THAN 2                        07430099
074400       PERFORM 4400-RECORD-TYPE-03-PO                             07440099
074500          THRU 4400-RECORD-TYPE-03-PO-EXIT                        07450099
074600     END-IF.                                                      07460099
074700                                                                  07470099
074800     MOVE 'Y'                 TO WS-PROCESSED-RECS-SW.            07480099
074900                                                                  07490099
075000 3100-GENERATE-FUNC-ACK-EXIT.                                     07500099
075100     EXIT.                                                        07510099
075200                                                                  07520099
075300******************************************************************07530099
075400* 4000-RECORD TYPE 01 (THE MESSAGE HEADER SEGMENT)....            07540099
075500******************************************************************07550099
075600 4000-RECORD-TYPE-01.                                             07560099
075700                                                                  07570099
075800     INITIALIZE ET109-EDI-EXTRACT-RECORD.                         07580099
075900                                                                  07590099
076000     MOVE '01'                 TO ET109-RECORD-TYPE-IND.          07600099
076100     MOVE WS-ENTID-SAVE        TO WS-EDIT-ENTID.                  07610099
076200     MOVE WS-ENTID-REFORMAT    TO ET109-ENT-ID.                   07620099
076300     MOVE 'FA'                 TO ET109-MSG-TYPE.                 07630099
076400     MOVE ZEROS                TO ET109-ID-SEQ-NBR.               07640099
076500     MOVE ZEROS                TO ET109-MSG-SEQ-NBR.              07650099
076600                                                                  07660099
076700     WRITE PO-OUTPUT-RECORD FROM ET109-EDI-EXTRACT-RECORD.        07670099
076800                                                                  07680099
076900 4000-RECORD-TYPE-01-EXIT.                                        07690099
077000     EXIT.                                                        07700099
077100                                                                  07710099
077200******************************************************************07720099
077300* 4100-RECORD TYPE 02 (THE MESSAGE FUNCTIONAL GROUP SEGMENT)....  07730099
077400******************************************************************07740099
077500 4100-RECORD-TYPE-02.                                             07750099
077600                                                                  07760099
077700     INITIALIZE ET109-EDI-EXTRACT-RECORD.                         07770099
077800                                                                  07780099
077900     MOVE '02'                 TO ET109-RECORD-TYPE-IND.          07790099
078000     MOVE WS-ENTID-SAVE        TO WS-EDIT-ENTID.                  07800099
078100     MOVE WS-ENTID-REFORMAT    TO ET109-ENT-ID.                   07810099
078200     MOVE 'FA'                 TO ET109-MSG-TYPE.                 07820099
078300     ADD 1                     TO WS-GS-SEQ-NBR-COUNT.            07830099
078400     MOVE WS-GS-SEQ-NBR-COUNT  TO ET109-ID-SEQ-NBR.               07840099
078500     MOVE ZEROS                TO ET109-MSG-SEQ-NBR.              07850099
078600                                                                  07860099
078700     MOVE WS-GS-CNTL-NBR-SAVE  TO ET109-MSG-ID-NBR.               07870099
078800                                                                  07880099
078900     WRITE PO-OUTPUT-RECORD FROM ET109-EDI-EXTRACT-RECORD.        07890099
079000                                                                  07900099
079100 4100-RECORD-TYPE-02-EXIT.                                        07910099
079200     EXIT.                                                        07920099
079300                                                                  07930099
079400******************************************************************07940099
079500* 4200-RECORD TYPE 03 VERBIAGE (THE DETAIL VERBIAGE SEGMENT)..... 07950099
079600******************************************************************07960099
079700 4200-RECORD-TYPE-03-VERB.                                        07970099
079800                                                                  07980099
079900     INITIALIZE ET109-EDI-EXTRACT-RECORD.                         07990099
080000                                                                  08000099
080100     MOVE '03'                 TO ET109-RECORD-TYPE-IND.          08010099
080200     MOVE WS-ENTID-SAVE        TO WS-EDIT-ENTID.                  08020099
080300     MOVE WS-ENTID-REFORMAT    TO ET109-ENT-ID.                   08030099
080400     MOVE 'FA'                 TO ET109-MSG-TYPE.                 08040099
080500     MOVE WS-GS-SEQ-NBR-COUNT  TO ET109-ID-SEQ-NBR.               08050099
080600     ADD 1                     TO WS-MSG-SEQ-NBR-COUNT.           08060099
080700     MOVE WS-MSG-SEQ-NBR-COUNT TO ET109-MSG-SEQ-NBR.              08070099
080800                                                                  08080099
080900     IF WS-SUB = 1                                                08090099
081000        MOVE WS-MSG-DETAIL(WS-SUB) TO WS-MSG-HEADER               08100099
081100        MOVE WS-TRN-SET-CDE-SAVE TO WS-MSGHDR-DOC                 08110099
081200        MOVE WS-MSG-HEADER TO ET109-DTL-MSG-TEXT                  08120099
081300     ELSE                                                         08130099
081400        MOVE WS-MSG-DETAIL (WS-SUB) TO ET109-DTL-MSG-TEXT.        08140099
081500                                                                  08150099
081600     WRITE PO-OUTPUT-RECORD FROM ET109-EDI-EXTRACT-RECORD.        08160099
081700                                                                  08170099
081800 4200-RECORD-TYPE-03-VERB-EXIT.                                   08180099
081900     EXIT.                                                        08190099
082000                                                                  08200099
082100******************************************************************08210099
082200* 4400-RECORD TYPE 03 PURCHASE ORDER INFORMATION..                08220099
082300******************************************************************08230099
082400 4400-RECORD-TYPE-03-PO.                                          08240099
082500                                                                  08250099
082600     INITIALIZE ET109-EDI-EXTRACT-RECORD.                         08260099
082700                                                                  08270099
082800     MOVE '03'                 TO ET109-RECORD-TYPE-IND.          08280099
082900     MOVE WS-ENTID-SAVE        TO WS-EDIT-ENTID.                  08290099
083000     MOVE WS-ENTID-REFORMAT    TO ET109-ENT-ID.                   08300099
083100     MOVE 'FA'                 TO ET109-MSG-TYPE.                 08310099
083200     MOVE WS-GS-SEQ-NBR-COUNT  TO ET109-ID-SEQ-NBR.               08320099
083300     ADD 1                     TO WS-MSG-SEQ-NBR-COUNT.           08330099
083400     MOVE WS-MSG-SEQ-NBR-COUNT TO ET109-MSG-SEQ-NBR.              08340099
083500                                                                  08350099
083600     MOVE WS-MSG-DETAIL (3)    TO WS-MSG-INVOICE.                 08360099
083700     MOVE WS-TRN-DTL-TXT-SAVE (1:15) TO WS-MSG-PO.                08370099
083800                                                                  08380099
083900     MOVE WS-GS-CNTL-NBR-SAVE  TO WS-MSG-ISA.                     08390099
084000                                                                  08400099
084100     MOVE WS-TRANS-DATE-SAVE   TO WS-REFORMAT-DATE.               08410099
084200     MOVE WS-REFDTE-MM         TO WS-DTE-MM.                      08420099
084300     MOVE '/'                  TO WS-DTE-P1.                      08430099
084400     MOVE WS-REFDTE-DD         TO WS-DTE-DD.                      08440099
084500     MOVE '/'                  TO WS-DTE-P2.                      08450099
084600     MOVE WS-REFDTE-CCYY       TO WS-DTE-YY.                      08460099
084700                                                                  08470099
084800     PERFORM 5000-GET-PO-SHIP-DATE                                08480099
084900        THRU 5000-GET-PO-SHIP-DATE-EXIT.                          08490099
085000                                                                  08500099
085100     MOVE WS-MSG-INVOICE       TO ET109-DTL-MSG-TEXT.             08510099
085200                                                                  08520099
085300     WRITE PO-OUTPUT-RECORD FROM ET109-EDI-EXTRACT-RECORD.        08530099
085400                                                                  08540099
085500**** UPDATE TFGTRST WITH THE ACKNOWLEDGEMENT STATUS....           08550099
085600                                                                  08560099
085700     PERFORM 5200-UPD-TFGTRST-STATUS                              08570099
085800        THRU 5200-UPD-TFGTRST-STATUS-EXIT.                        08580099
085900                                                                  08590099
086000 4400-RECORD-TYPE-03-PO-EXIT.                                     08600099
086100     EXIT.                                                        08610099
086200                                                                  08620099
086300******************************************************************08630099
086400* 5000-GET THE PURCHASE ORDER SHIPMENT DATE....                   08640099
086500******************************************************************08650099
086600 5000-GET-PO-SHIP-DATE.                                           08660099
086700                                                                  08670099
086800     MOVE WS-TRN-DTL-TXT-SAVE(1:15) TO DP010I-UNEDITED-FIELD.     08680099
086900     MOVE 17                        TO DP010I-MAXIMUM-DIGITS.     08690099
087000     MOVE ZEROS                     TO DP010I-MAXIMUM-DECIMALS.   08700099
087100                                                                  08710099
087200     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     08720099
087300                                                                  08730099
087410     CALL DP010I-NUMERIC-EDIT-ROUTINE                             08741099
087420                         USING DP010I-NUMERIC-EDIT-AREA           08742099
087430                                                                  08743099
087500                                                                  08750099
087600     IF DP010I-ERROR-DETECTED                                     08760099
087700         MOVE ZEROS           TO WS-EDIT-PO-NUMBER                08770099
087800     ELSE                                                         08780099
087900         MOVE DP010I-NUM-FIELD-17-DIG-0-DEC TO WS-EDIT-PO-NUMBER. 08790099
088000                                                                  08800099
088100     EXEC SQL                                                     08810099
088200       SELECT DONT_SHIP_BEF_DTE                                   08820099
088300       INTO :PLNSHP-DONT-SHIP-BEF-DTE                             08830099
088400       FROM TPLNSHP                                               08840099
088500       WHERE PO_NBR = :WS-EDIT-PO-NUMBER                          08850099
088600         AND VER_STATUS_CDE = 'A'                                 08860099
088700     END-EXEC.                                                    08870099
088800                                                                  08880099
088900     EVALUATE TRUE                                                08890099
089000       WHEN SQLCODE IS EQUAL TO ZERO                              08900099
089100         MOVE PLNSHP-DONT-SHIP-BEF-DTE TO WS-REFORMAT-DATE        08910099
089200       WHEN SQLWARN IS NOT EQUAL TO SPACES                        08920099
089300       WHEN SQLCODE IS NOT EQUAL TO ZERO                          08930099
089400         MOVE '9999-09-09'    TO WS-REFORMAT-DATE                 08940099
089500     END-EVALUATE.                                                08950099
089600                                                                  08960099
089700     MOVE WS-REFDTE-MM         TO WS-SHPDTE-MM.                   08970099
089800     MOVE '/'                  TO WS-SHPDTE-P1.                   08980099
089900     MOVE WS-REFDTE-DD         TO WS-SHPDTE-DD.                   08990099
090000     MOVE '/'                  TO WS-SHPDTE-P2.                   09000099
090100     MOVE WS-REFDTE-CCYY       TO WS-SHPDTE-YY.                   09010099
090200                                                                  09020099
090300 5000-GET-PO-SHIP-DATE-EXIT.                                      09030099
090400     EXIT.                                                        09040099
090500                                                                  09050099
090600******************************************************************09060099
090700* 5200-UPDATE TFGTRST WITH THE ACKNOWLEDGEMENT STATUS CODE.       09070099
090800***   IF A CHANGE IS MADE TO THIS ROUTINE, VERIFY THAT THE CHANGE 09080099
090900*** IS NEEDED/NOT NEEDED TO THE 5300- ROUTINE.                    09090099
091000******************************************************************09100099
091100 5200-UPD-TFGTRST-STATUS.                                         09110099
091200                                                                  09120099
091300     EXEC SQL                                                     09130099
091400         UPDATE TFGTRST                                           09140099
091500           SET PO_ACKNL_STAT_CDE = 'T'                            09150099
091600         WHERE TP_DKEY          = :WS-TP-DKEY-SAVE                09160099
091700           AND TP_DKEY_TMST     = :WS-TP-DKEY-TMST-SAVE           09170099
091800           AND FUNC_CDE_SEQ_NBR = :WS-FUNC-CDE-SEQ-SAVE           09180099
091900           AND TRN_SET_SEQ_NBR  = :WS-TRN-SET-SEQ-SAVE            09190099
092000           AND TRN_SET_CDE      = :WS-TRN-SET-CDE-SAVE            09200099
092100     END-EXEC.                                                    09210099
092200                                                                  09220099
092300     EVALUATE TRUE                                                09230099
092400         WHEN SQLCODE IS EQUAL TO ZERO                            09240099
092500             CONTINUE                                             09250099
092600         WHEN SQLWARN0 IS NOT EQUAL TO SPACES                     09260099
092700         WHEN SQLCODE IS NOT EQUAL TO ZERO                        09270099
092800             DISPLAY SPACES                                       09280099
092900             DISPLAY '** ETKUP048 **'                             09290099
093000             DISPLAY '** 5200-UPDATE-TFGTRST-W-STATUS **'         09300099
093100             DISPLAY 'SQLCODE = ' SQLCODE                         09310099
093200             PERFORM 7000-GET-VENDOR-NAME                         09320099
093300             DISPLAY 'VENDOR = ' ENTNME-ENT-NAME-DESC             09330099
093400             DISPLAY 'TP_DKEY = ' WS-TP-DKEY-SAVE                 09340099
093500             DISPLAY 'TP_DKEY_TMST = ' WS-TP-DKEY-TMST-SAVE       09350099
093600             DISPLAY 'FUNC_CDE_SEQ_NBR = ' WS-FUNC-CDE-SEQ-SAVE   09360099
093700             DISPLAY 'TRN_SET_SEQ_NBR = ' WS-TRN-SET-SEQ-SAVE     09370099
093800             DISPLAY 'TRN_SET_CDE      = ' WS-TRN-SET-CDE-SAVE    09380099
093900             DISPLAY 'FUNC_CDE_CNTL_NBR = ' WS-GS-CNTL-NBR-SAVE   09390099
094000             MOVE 'Y' TO WS-ERROR-FOUND-SW                        09400099
094100     END-EVALUATE.                                                09410099
094200                                                                  09420099
094300 5200-UPD-TFGTRST-STATUS-EXIT.                                    09430099
094400     EXIT.                                                        09440099
094500                                                                  09450099
094600******************************************************************09460099
094700* 5300-UPDATE TFGTRST WITH THE ACKNOWLEDGEMENT STATUS CODE.       09470099
094800***   IF A CHANGE IS MADE TO THIS ROUTINE, VERIFY THAT THE CHANGE 09480099
094900*** IS NEEDED/NOT NEEDED TO THE 5200- ROUTINE.                    09490099
095000******************************************************************09500099
095100 5300-UPD-TFGTRST-STATUS.                                         09510099
095200                                                                  09520099
095300     EXEC SQL                                                     09530099
095400         UPDATE TFGTRST                                           09540099
095500           SET PO_ACKNL_STAT_CDE = 'T'                            09550099
095600         WHERE TP_DKEY          = :FGTRST-TP-DKEY                 09560099
095700           AND TP_DKEY_TMST     = :FGTRST-TP-DKEY-TMST            09570099
095800           AND FUNC_CDE_SEQ_NBR = :FGTRST-FUNC-CDE-SEQ-NBR        09580099
095900           AND TRN_SET_SEQ_NBR  = :FGTRST-TRN-SET-SEQ-NBR         09590099
096000           AND TRN_SET_CDE      = :FGTRST-TRN-SET-CDE             09600099
096100     END-EXEC.                                                    09610099
096200                                                                  09620099
096300     EVALUATE TRUE                                                09630099
096400         WHEN SQLCODE IS EQUAL TO ZERO                            09640099
096500             CONTINUE                                             09650099
096600         WHEN SQLWARN0 IS NOT EQUAL TO SPACES                     09660099
096700         WHEN SQLCODE IS NOT EQUAL TO ZERO                        09670099
096800             DISPLAY SPACES                                       09680099
096900             DISPLAY '** ETKUP048 **'                             09690099
097000             DISPLAY '** 5300-UPDATE-TFGTRST-W-STATUS **'         09700099
097100             DISPLAY 'SQLCODE = ' SQLCODE                         09710099
097200             PERFORM 7100-GET-VENDOR-NAME                         09720099
097300             DISPLAY 'VENDOR = ' ENTNME-ENT-NAME-DESC             09730099
097400             DISPLAY 'TP_DKEY = ' FGTRST-TP-DKEY                  09740099
097500             DISPLAY 'TP_DKEY_TMST = ' FGTRST-TP-DKEY-TMST        09750099
097600             DISPLAY 'FUNC_CDE_SEQ_NBR = ' FGTRST-FUNC-CDE-SEQ-NBR09760099
097700             DISPLAY 'TRN_SET_SEQ_NBR = ' FGTRST-TRN-SET-SEQ-NBR  09770099
097800             DISPLAY 'TRN_SET_CDE      = ' FGTRST-TRN-SET-CDE     09780099
097900             MOVE 'Y' TO WS-ERROR-FOUND-SW                        09790099
098000     END-EVALUATE.                                                09800099
098100                                                                  09810099
098200 5300-UPD-TFGTRST-STATUS-EXIT.                                    09820099
098300     EXIT.                                                        09830099
098400                                                                  09840099
098500                                                                  09850099
098600 7000-GET-VENDOR-NAME.                                            09860099
098700                                                                  09870099
098800     EXEC SQL                                                     09880099
098900        SELECT ENT_NAME_DESC                                      09890099
099000          INTO :ENTNME-ENT-NAME-DESC                              09900099
099100          FROM TENTNME E                                          09910099
099200              ,TTRDPRT T                                          09920099
099300         WHERE TP_DKEY = :WS-TP-DKEY-SAVE                         09930099
099400           AND T.ENT_ID = E.ENT_ID                                09940099
099500           AND TYPE_CDE = '01'                                    09950099
099600     END-EXEC.                                                    09960099
099700                                                                  09970099
099800     IF SQLCODE NOT = +000                                        09980099
099900        MOVE 'NOT FOUND' TO ENTNME-ENT-NAME-DESC                  09990099
100000     END-IF.                                                      10000099
100100                                                                  10010099
100200 7100-GET-VENDOR-NAME.                                            10020099
100300                                                                  10030099
100400     EXEC SQL                                                     10040099
100500        SELECT ENT_NAME_DESC                                      10050099
100600          INTO :ENTNME-ENT-NAME-DESC                              10060099
100700          FROM TENTNME E                                          10070099
100800              ,TTRDPRT T                                          10080099
100900         WHERE TP_DKEY = :FGTRST-TP-DKEY                          10090099
101000           AND T.ENT_ID = E.ENT_ID                                10100099
101100           AND TYPE_CDE = '01'                                    10110099
101200     END-EXEC.                                                    10120099
101300                                                                  10130099
101400     IF SQLCODE NOT = +000                                        10140099
101500        MOVE 'NOT FOUND' TO ENTNME-ENT-NAME-DESC                  10150099
101600     END-IF.                                                      10160099
101700                                                                  10170099
101800                                                                  10180099
101900******************************************************************10190099
102000* 9000-END OF JOB TASKS......                                     10200099
102100******************************************************************10210099
102200 9000-END-OF-JOB-TASKS.                                           10220099
102300*** GENERATE A FINAL CONTROL BREAK, IF NECESSARY. (DOCUMENT 864)  10230099
102400                                                                  10240099
102500     IF TEXT-PROCESSED                                            10250099
102600         MOVE ZEROS         TO WS-SUB                             10260099
102700         PERFORM 4200-RECORD-TYPE-03-VERB                         10270099
102800            THRU 4200-RECORD-TYPE-03-VERB-EXIT                    10280099
102900              VARYING WS-SUB FROM 4 BY 1                          10290099
103000              UNTIL WS-SUB IS GREATER THAN 10.                    10300099
103100                                                                  10310099
103200*** CLOSE THE FILES...                                            10320099
103300                                                                  10330099
103400     IF ERRORS-FOUND AND                                          10340099
103500        ABEND-CODE IS NOT EQUAL TO +4013                          10350099
103600         SET ABEND-4095 TO TRUE.                                  10360099
103700                                                                  10370099
103800     CLOSE PO-OUTPUT-FILE.                                        10380099
103900                                                                  10390099
104000     EXEC SQL                                                     10400099
104100         CLOSE TRDPRT_CURSOR                                      10410099
104200     END-EXEC.                                                    10420099
104300                                                                  10430099
104400     EVALUATE TRUE                                                10440099
104500       WHEN SQLCODE IS EQUAL TO ZERO                              10450099
104600         CONTINUE                                                 10460099
104700       WHEN SQLWARN IS NOT EQUAL TO SPACES                        10470099
104800       WHEN SQLCODE IS NOT EQUAL TO ZERO                          10480099
104900        MOVE '9000-END-OF-JOB-TASKS' TO PV-PARAGRAPH-NAME         10490099
105000        MOVE 'CLOSE CURSOR' TO PV-DB2-OPER-ATTEMPTED              10500099
105100        PERFORM 9900-SQL-ERROR                                    10510099
105200     END-EVALUATE.                                                10520099
105300 9000-END-OF-JOB-TASKS-EXIT.                                      10530099
105400     EXIT.                                                        10540099
105500                                                                  10550099
105600******************************************************************10560099
105700* 9900-SQL ERROR HANDLING...                                      10570099
105800******************************************************************10580099
105900 9900-SQL-ERROR.                                                  10590099
106000                                                                  10600099
106100     SET ABEND-4013 TO TRUE.                                      10610099
106200                                                                  10620099
106300     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            10630099
106400     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        10640099
106500                                                                  10650099
106600     COPY DPPD004.                                                10660099
106700                                                                  10670099
106800     CALL 'ILBOABN0'  USING ABEND-CODE.                           10680099
106900                                                                  10690099
