000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    XSKUP063.                                         00020000
000300 AUTHOR.        BARB ERTL.                                        00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  11/29/2002.                                       00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800**       ZONE STORE DATE  MESSAGE TO POPULATE XST_STR_GP_MBSHP    00080000
000900******************************************************************00090000
001000**THIS IS A CALLED MODULE FOR LOCATION TABLES.  THIS PROGRAM      00100000
001100**     WILL PERFORM UPDATES/INSERTS/DELETES FOR THE               00110000
001200**     XST_STR_GP_MBSHP TABLE.  IT DOES THE FOLLOWING WITH        00120000
001300**     THESE RETURN CODES:                                        00130000
001400**     0000 - END PROGRAM                                         00140000
001500**    -0530 - END PROGRAM                                         00150000
001600**    -0803 - END PROGRAM                                         00160000
001700**    -0911 - RETRY INSERT UP TO 5 TIMES AND THEN END PROGRAM     00170000
001800******************************************************************00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000 CONFIGURATION SECTION.                                           00200000
002100 SOURCE-COMPUTER.  IBM-3090.                                      00210000
002200 OBJECT-COMPUTER.  IBM-3090.                                      00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600******************************************************************00260000
002700**PROGRAM SWITCHES                                                00270000
002800******************************************************************00280000
002900 01  PS-PROGRAM-SWITCHES.                                         00290000
003000     05  PS-PROCESS-CONTINUE-SW      PIC X(01)  VALUE 'Y'.        00300000
003100         88  PS-PROCESS-CONTINUE                VALUE 'Y'.        00310000
003200         88  PS-PROCESS-COMPLETE                VALUE 'N'.        00320000
003300******************************************************************00330000
003400**PROGRAM CONSTANTS                                               00340000
003500******************************************************************00350000
003600 01  PC-PROGRAM-CONSTANTS.                                        00360000
003700     05  PC-RETRY-MAX                PIC 9(01)  VALUE 5.          00370000
003800******************************************************************00380000
003900**PROGRAM VARIABLES                                               00390000
004000******************************************************************00400000
004100 01  PV-PROGRAM-VARIABLES.                                        00410000
004200     05  PV-RETRY-COUNTER            PIC 9(01)  VALUE ZEROS.      00420000
004300     05  PV-RETURN-CODE              PIC S9(04) VALUE 0.          00430000
004400******************************************************************00440000
004500**COPYBOOKS                                                       00450000
004600******************************************************************00460000
004700***DB2 MESSAGE AREA                                               00470000
004800     COPY SQLCA2.                                                 00480007
004900***MESSAGE COPYBOOK                                               00490000
005000     COPY HORD100.                                                00500007
005100******************************************************************00510000
005200**TABLE INCLUSIONS                                                00520000
005300******************************************************************00530000
005400***DB2 COMMUNICATIONS AREA                                        00540000
005500     EXEC SQL                                                     00550000
005600          INCLUDE SQLCA                                           00560000
005700     END-EXEC.                                                    00570000
005800* ------------------------------------------------------------- * 00580000
005900*  SQL AND COBOL DECLARATIONS FOR STORE GROUP MEMBERSHIP TABLE    00590000
006000*  XST_STR_GP_MBSHP                                               00600000
006100* ------------------------------------------------------------- * 00610000
006200     EXEC SQL                                                     00620000
006300         INCLUDE XST00023                                         00630000
006400     END-EXEC.                                                    00640000
006500                                                                  00650000
006600 LINKAGE SECTION.                                                 00660000
006700******************************************************************00670000
006800**LINKAGE VARIABLES                                               00680000
006900******************************************************************00690000
007000 01  LV-LINKAGE-VARIABLES.                                        00700000
007100     05  LV-HORD100-RECORD               PIC X(500).              00710000
007200     05  LV-RETURN-CODE                  PIC S9(04).              00720000
007300                                                                  00730000
007400 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   00740000
007500******************************************************************00750000
007600 0000-MAINLINE.                                                   00760000
007700                                                                  00770000
007800      PERFORM 1000-INITIALIZATION.                                00780000
007900      PERFORM 2000-PROCESS-MESSAGE                                00790000
008000              UNTIL PS-PROCESS-COMPLETE.                          00800000
008100      PERFORM 9999-WRAPUP.                                        00810000
008200                                                                  00820000
008300***************************************************************** 00830000
008400**INITIALIZATION AREA - ALL MOVES TO UPDATE/INSERT                00840000
008500***************************************************************** 00850000
008600 1000-INITIALIZATION.                                             00860000
008700                                                                  00870000
008800     INITIALIZE PV-RETRY-COUNTER                                  00880000
008900                PV-RETURN-CODE.                                   00890000
009000                                                                  00900000
009100     SET PS-PROCESS-CONTINUE         TO TRUE.                     00910000
009200                                                                  00920000
009300     MOVE LV-HORD100-RECORD          TO HORD100-RECORD.           00930000
009400                                                                  00940000
009500     MOVE HO100-ZSD-STR-GP-TYP-CDE   TO XST00023-STR-GP-TYP-CDE.  00950000
009600     MOVE HO100-ZSD-GP-ID            TO XST00023-STR-GP-ID.       00960000
009700     MOVE HO100-ZSD-STR-NBR          TO XST00023-STR-NBR.         00970000
009800     MOVE HO100-ZSD-EFF-BEG-DTE      TO XST00023-EFF-BEG-DTE.     00980000
009900     MOVE HO100-ZSD-EFF-END-DTE      TO XST00023-EFF-END-DTE.     00990000
010000***************************************************************** 01000000
010100**MAIN PROGRAM LOGIC - READS ACTION TYPE ON HORD100 RECORD        01010000
010200***************************************************************** 01020000
010300 2000-PROCESS-MESSAGE.                                            01030000
010400                                                                  01040000
010500     EVALUATE TRUE                                                01050000
010600        WHEN HO100-ACTN-TYP-INSERT                                01060000
010700             IF HO100-ZSD-EFF-END-DTE > SPACES                    01070000
010800              AND HO100-ZSD-EFF-END-DTE NOT = '9999-09-09'        01080003
010900                 PERFORM 2100-INSERT-DATA                         01090000
011000             ELSE                                                 01100000
011100                 PERFORM 2400-INSERT-WO-END-DTE                   01110000
011200             END-IF                                               01120000
011300        WHEN HO100-ACTN-TYP-UPDATE                                01130000
011400             IF HO100-ZSD-EFF-END-DTE = '9999-09-09'              01140004
011500                 CONTINUE                                         01150004
011600             ELSE                                                 01160004
011700                 IF HO100-ZSD-EFF-END-DTE = SPACES                01170005
011800                     PERFORM 2500-UPDATE-AS-NULL                  01180005
011900                 ELSE                                             01190005
012000                     PERFORM 2200-UPDATE-DATA                     01200005
012100                 END-IF                                           01210005
012200             END-IF                                               01220005
012300        WHEN HO100-ACTN-TYP-DELETE                                01230000
012400             PERFORM 2300-DELETE-DATA                             01240000
012500     END-EVALUATE.                                                01250000
012600                                                                  01260000
012700     MOVE SQLCODE TO PV-RETURN-CODE.                              01270000
012800                                                                  01280000
012900***************************************************************** 01290000
013000**INSERT ACTION TYPE                                              01300000
013100***************************************************************** 01310000
013200 2100-INSERT-DATA.                                                01320000
013300                                                                  01330000
013400     PERFORM                                                      01340002
013500         WITH TEST AFTER                                          01350002
013600         VARYING PV-RETRY-COUNTER                                 01360002
013700         FROM 1 BY 1                                              01370002
013800         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    01380002
013900            OR SQLCODE = 0                                        01390002
014000            OR PS-PROCESS-COMPLETE                                01400002
014100                                                                  01410002
014200         EXEC SQL                                                 01420002
014300             INSERT INTO XST_STR_GP_MBSHP                         01430002
014400                 (STR_NBR                                         01440002
014500                , STR_GP_TYP_CDE                                  01450002
014600                , STR_GP_ID                                       01460002
014700                , EFF_BEG_DTE                                     01470002
014800                , EFF_END_DTE)                                    01480002
014900             VALUES (: XST00023-STR-NBR                           01490002
015000                    ,: XST00023-STR-GP-TYP-CDE                    01500002
015100                   , : XST00023-STR-GP-ID                         01510002
015200                   , : XST00023-EFF-BEG-DTE                       01520002
015300                   , : XST00023-EFF-END-DTE)                      01530002
015400         END-EXEC                                                 01540002
015500                                                                  01550000
015600         EVALUATE TRUE                                            01560002
015700             WHEN SQLCODE = -911                                  01570002
015800             WHEN SQLCODE = -913                                  01580002
015900             WHEN SQLCODE = 0                                     01590002
016000                 CONTINUE                                         01600002
016100             WHEN SQLWARN0 NOT = SPACE                            01610002
016200             WHEN SQLCODE NOT =  ZERO                             01620002
016300                 SET PS-PROCESS-COMPLETE TO TRUE                  01630002
016400         END-EVALUATE                                             01640002
016500     END-PERFORM.                                                 01650002
016600                                                                  01660002
016700     EVALUATE TRUE                                                01670000
016800        WHEN SQLCODE = -913                                       01680000
016900        WHEN SQLCODE = -911                                       01690000
017000             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 01700000
017100                 SET PS-PROCESS-COMPLETE TO TRUE                  01710000
017200             ELSE                                                 01720000
017300                 ADD +1                  TO PV-RETRY-COUNTER      01730000
017400             END-IF                                               01740000
017500        WHEN OTHER                                                01750000
017600             SET PS-PROCESS-COMPLETE     TO TRUE                  01760000
017700     END-EVALUATE.                                                01770000
017800                                                                  01780000
017900******************************************************************01790000
018000**UPDATE ACTION TYPE                                              01800000
018100******************************************************************01810000
018200 2200-UPDATE-DATA.                                                01820000
018300                                                                  01830000
018400     PERFORM                                                      01840002
018500         WITH TEST AFTER                                          01850002
018600         VARYING PV-RETRY-COUNTER                                 01860002
018700         FROM 1 BY 1                                              01870002
018800         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    01880002
018900            OR SQLCODE = 0                                        01890002
019000            OR PS-PROCESS-COMPLETE                                01900002
019100                                                                  01910002
019200         EXEC SQL                                                 01920002
019300             UPDATE XST_STR_GP_MBSHP                              01930002
019400                SET EFF_END_DTE = : XST00023-EFF-END-DTE          01940002
019500              WHERE STR_NBR        = : XST00023-STR-NBR           01950002
019600                AND STR_GP_TYP_CDE = : XST00023-STR-GP-TYP-CDE    01960002
019700                AND STR_GP_ID      = : XST00023-STR-GP-ID         01970002
019800                AND EFF_BEG_DTE    = : XST00023-EFF-BEG-DTE       01980002
019900         END-EXEC                                                 01990002
020000                                                                  02000000
020100         EVALUATE TRUE                                            02010002
020200             WHEN SQLCODE = -911                                  02020002
020300             WHEN SQLCODE = -913                                  02030002
020400             WHEN SQLCODE = 0                                     02040002
020500                 CONTINUE                                         02050002
020600             WHEN SQLWARN0 NOT = SPACE                            02060002
020700             WHEN SQLCODE NOT =  ZERO                             02070002
020800                 SET PS-PROCESS-COMPLETE TO TRUE                  02080002
020900         END-EVALUATE                                             02090002
021000     END-PERFORM.                                                 02100002
021100                                                                  02110002
021200     EVALUATE TRUE                                                02120000
021300        WHEN SQLCODE = -911                                       02130000
021400             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 02140000
021500                 SET PS-PROCESS-COMPLETE TO TRUE                  02150000
021600             ELSE                                                 02160000
021700                 ADD +1                  TO PV-RETRY-COUNTER      02170000
021800             END-IF                                               02180000
021900        WHEN OTHER                                                02190000
022000             SET PS-PROCESS-COMPLETE     TO TRUE                  02200000
022100     END-EVALUATE.                                                02210000
022200                                                                  02220000
022300******************************************************************02230000
022400**DELETE TYPE ACTION                                              02240000
022500******************************************************************02250000
022600 2300-DELETE-DATA.                                                02260000
022700                                                                  02270000
022800     PERFORM                                                      02280002
022900         WITH TEST AFTER                                          02290002
023000         VARYING PV-RETRY-COUNTER                                 02300002
023100         FROM 1 BY 1                                              02310002
023200         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    02320002
023300            OR SQLCODE = 0                                        02330002
023400            OR PS-PROCESS-COMPLETE                                02340002
023500                                                                  02350002
023600         EXEC SQL                                                 02360002
023700             DELETE FROM XST_STR_GP_MBSHP                         02370002
023800             WHERE STR_NBR        = : XST00023-STR-NBR            02380002
023900               AND STR_GP_TYP_CDE = : XST00023-STR-GP-TYP-CDE     02390002
024000               AND STR_GP_ID      = : XST00023-STR-GP-ID          02400002
024100               AND EFF_BEG_DTE    = : XST00023-EFF-BEG-DTE        02410002
024200         END-EXEC                                                 02420002
024300                                                                  02430000
024400         EVALUATE TRUE                                            02440002
024500             WHEN SQLCODE = -911                                  02450002
024600             WHEN SQLCODE = -913                                  02460002
024700             WHEN SQLCODE = 0                                     02470002
024800                 CONTINUE                                         02480002
024900             WHEN SQLWARN0 NOT = SPACE                            02490002
025000             WHEN SQLCODE NOT =  ZERO                             02500002
025100                 SET PS-PROCESS-COMPLETE TO TRUE                  02510002
025200         END-EVALUATE                                             02520002
025300     END-PERFORM.                                                 02530002
025400                                                                  02540002
025500     EVALUATE TRUE                                                02550000
025600        WHEN SQLCODE = -911                                       02560000
025700        WHEN SQLCODE = -913                                       02570000
025800             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 02580000
025900                 SET PS-PROCESS-COMPLETE TO TRUE                  02590000
026000             ELSE                                                 02600000
026100                 ADD +1                  TO PV-RETRY-COUNTER      02610000
026200             END-IF                                               02620000
026300        WHEN OTHER                                                02630000
026400             SET PS-PROCESS-COMPLETE     TO TRUE                  02640000
026500     END-EVALUATE.                                                02650000
026600                                                                  02660000
026700* ------------------------------------------------------------- * 02670000
026800* INSERT XST_STR_GP_MBSHP WITH NO END DATE                        02680000
026900* ------------------------------------------------------------- * 02690000
027000 2400-INSERT-WO-END-DTE.                                          02700001
027100                                                                  02710000
027200     EXEC SQL                                                     02720000
027300         INSERT INTO XST_STR_GP_MBSHP                             02730000
027400             (STR_NBR                                             02740000
027500            , STR_GP_TYP_CDE                                      02750000
027600            , STR_GP_ID                                           02760000
027700            , EFF_BEG_DTE)                                        02770000
027800         VALUES (: XST00023-STR-NBR                               02780000
027900                ,: XST00023-STR-GP-TYP-CDE                        02790000
028000               , : XST00023-STR-GP-ID                             02800000
028100               , : XST00023-EFF-BEG-DTE)                          02810000
028200     END-EXEC                                                     02820000
028300                                                                  02830000
028400     EVALUATE TRUE                                                02840000
028500        WHEN SQLCODE = -913                                       02850000
028600        WHEN SQLCODE = -911                                       02860000
028700             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 02870000
028800                 SET PS-PROCESS-COMPLETE TO TRUE                  02880000
028900             ELSE                                                 02890000
029000                 ADD +1                  TO PV-RETRY-COUNTER      02900000
029100             END-IF                                               02910000
029200        WHEN OTHER                                                02920000
029300             SET PS-PROCESS-COMPLETE     TO TRUE                  02930000
029400     END-EVALUATE.                                                02940000
029500                                                                  02950000
029600******************************************************************02960005
029700**UPDATE END DATE TO NULL                                         02970005
029800******************************************************************02980005
029900 2500-UPDATE-AS-NULL.                                             02990006
030000                                                                  03000005
030100     PERFORM                                                      03010005
030200         WITH TEST AFTER                                          03020005
030300         VARYING PV-RETRY-COUNTER                                 03030005
030400         FROM 1 BY 1                                              03040005
030500         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    03050005
030600            OR SQLCODE = 0                                        03060005
030700            OR PS-PROCESS-COMPLETE                                03070005
030800                                                                  03080005
030900         EXEC SQL                                                 03090005
031000             UPDATE XST_STR_GP_MBSHP                              03100005
031100                SET EFF_END_DTE = NULL                            03110005
031200              WHERE STR_NBR        = : XST00023-STR-NBR           03120005
031300                AND STR_GP_TYP_CDE = : XST00023-STR-GP-TYP-CDE    03130005
031400                AND STR_GP_ID      = : XST00023-STR-GP-ID         03140005
031500                AND EFF_BEG_DTE    = : XST00023-EFF-BEG-DTE       03150005
031600         END-EXEC                                                 03160005
031700                                                                  03170005
031800         EVALUATE TRUE                                            03180005
031900             WHEN SQLCODE = -911                                  03190005
032000             WHEN SQLCODE = -913                                  03200005
032100             WHEN SQLCODE = 0                                     03210005
032200                 CONTINUE                                         03220005
032300             WHEN SQLWARN0 NOT = SPACE                            03230005
032400             WHEN SQLCODE NOT =  ZERO                             03240005
032500                 SET PS-PROCESS-COMPLETE TO TRUE                  03250005
032600         END-EVALUATE                                             03260005
032700     END-PERFORM.                                                 03270005
032800                                                                  03280005
032900     EVALUATE TRUE                                                03290005
033000        WHEN SQLCODE = -911                                       03300005
033100             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 03310005
033200                 SET PS-PROCESS-COMPLETE TO TRUE                  03320005
033300             ELSE                                                 03330005
033400                 ADD +1                  TO PV-RETRY-COUNTER      03340005
033500             END-IF                                               03350005
033600        WHEN OTHER                                                03360005
033700             SET PS-PROCESS-COMPLETE     TO TRUE                  03370005
033800     END-EVALUATE.                                                03380005
033900                                                                  03390005
034000******************************************************************03400000
034100**PASS SQLCODE TO CALLING AND EXIT PROGRAM                        03410000
034200******************************************************************03420000
034300 9999-WRAPUP.                                                     03430000
034400                                                                  03440000
034500     MOVE PV-RETURN-CODE TO LV-RETURN-CODE.                       03450000
034600                                                                  03460000
034700     EXIT PROGRAM.                                                03470000
