000100******************************************************************00010000
000200 IDENTIFICATION     DIVISION.                                     00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             TFKUT100.                                00050000
000600 AUTHOR.                 JACK KRAMER.                             00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           DECEMBER 1996.                           00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*     TFKUT100 IS A CALLED SUBROUTINE THAT WILL CALCULATE THE     00120000
001300*     CHECK DIGIT FOR UCC128 BARCODE DATA (CHARACTER SETS A & B). 00130000
001400*     DATA TO BE PASSED TO THE SUBROUTINE IS:                     00140000
001500*       1. DATA TO BE DISPLAYED IN THE BARCODE.                   00150000
001600*       2. NUMBER OF CHARACTERS OF DATA.                          00160000
001700*       3. CHARACTER SET (A OR B)                                 00170000
001800*     THE CHECK DIGIT WILL BE CALCULATED AND THE DATA RETURNED IS:00180000
001900*       1. UCC128 BARCODE DATA INCLUDING START & STOP CHARACTERS  00190000
002000*          AND CHECK DIGIT. (LENGTH OF DATA WILL BE 3 CHARACTERS  00200000
002100*          LONGER THAN THE PASSED DATA)                           00210000
002200*       2. RETURN CODE                                            00220000
002300*          00 - SUCCESSFUL                                        00230000
002400*          01 - INVALID DATA PASSED                               00240000
002500*          02 - INVALID LENGTH PASSED                             00250000
002600*          03 - CHECK DIGIT NOT FOUND                             00260000
002700******************************************************************00270000
002800                                                                  00280000
002900******************************************************************00290000
003000 ENVIRONMENT DIVISION.                                            00300000
003100******************************************************************00310000
003200                                                                  00320000
003300 CONFIGURATION SECTION.                                           00330000
003400                                                                  00340000
003500 SOURCE-COMPUTER.        IBM-3090.                                00350000
003600 OBJECT-COMPUTER.        IBM-3090.                                00360000
003700                                                                  00370000
003800 INPUT-OUTPUT SECTION.                                            00380000
003900                                                                  00390000
004000 FILE-CONTROL.                                                    00400000
004100                                                                  00410000
004200******************************************************************00420000
004300 DATA DIVISION.                                                   00430000
004400******************************************************************00440000
004500                                                                  00450000
004600 WORKING-STORAGE SECTION.                                         00460000
004700                                                                  00470000
004000*                                                                 00400013
004100*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00410013
004200*                                                                 00420013
004300     COPY DPWS013.                                                00430013
004400                                                                  00440013
004800 01  PV-PROGRAM-CONSTANTS.                                        00480001
004900     05  PC-SET-A-START-CHARACTER        PIC X(01) VALUE '‡'.     00490001
005000     05  PC-SET-B-START-CHARACTER        PIC X(01) VALUE 'ˆ'.     00500001
005100     05  PC-SET-A-START-VALUE            PIC 9(03) VALUE 103.     00510002
005200     05  PC-SET-B-START-VALUE            PIC 9(03) VALUE 104.     00520002
005300     05  PC-STOP-CHARACTER               PIC X(01) VALUE ''.     00530001
005400                                                                  00540001
005500 01  PV-PROGRAM-VARIABLES.                                        00550000
005600     05  PV-START-CHARACTER              PIC X(01).               00560001
005700     05  PV-CHECK-DIGIT                  PIC X(01).               00570002
005800     05  PV-QUOTIENT                     PIC 9(05) VALUE ZERO.    00580002
005900     05  PV-REMAINDER                    PIC 9(03) VALUE ZERO.    00590002
006000     05  PV-ACCUM-TOTAL                  PIC 9(07) VALUE ZERO.    00600002
006100     05  PV-ENTRY-TOTAL                  PIC 9(07) VALUE ZERO.    00610002
006200     05  PV-NBR-OF-CHARS                 PIC 9(02) VALUE ZERO.    00620002
006300     05  PV-ENTRY                        PIC 9(02) VALUE ZERO.    00630002
006400     05  PV-IN-DATA.                                              00640001
006500         10  PV-IN-CHAR    OCCURS 20 TIMES INDEXED BY IN-INDX     00650002
006600                                         PIC X(01).               00660002
006700     05  PV-OUT-DATA                     PIC X(23) VALUE          00670001
006800                                                   LOW-VALUES.            
006900     05  FILLER       REDEFINES PV-OUT-DATA.                              
007000         10  PV-OUT-CHAR   OCCURS 23 TIMES INDEXED BY OUT-INDX    00680002
007100                                         PIC X(01).               00690002
007200                                                                  00700000
007300******************************************************************00310000
007400*  THE PROGRAM TABLE CONTAINS 107 ENTRIES. EACH ENTRY CONTAINS            
007500*  A CODE VALUE FROM 000 TO 106 AND THE EBCDIC HEX VALUE THAT             
007600*  CORRESPONDS TO THAT CODE VALUE.                                        
007700******************************************************************00310000
007800 01  PT-PROGRAM-TABLE.                                            00710000
007900     05                                  PIC X(40)   VALUE        00720000
008000         '000 001!002"003#004$005%006&007''008(009)'.             00730001
008100     05                                  PIC X(40)   VALUE        00740000
008200         '010*011+012,013-014.015/0160017101820193'.              00750001
008300     05                                  PIC X(40)   VALUE        00760000
008400         '020402150226023702480259026:027;028<029='.              00770001
008500     05                                  PIC X(40)   VALUE        00780000
008600         '030>031?032@033A034B035C036D037E038F039G'.              00790001
008700     05                                  PIC X(40)   VALUE        00800000
008800         '040H041I042J043K044L045M046N047O048P049Q'.              00810001
008900     05                                  PIC X(40)   VALUE        00820000
009000         '050R051S052T053U054V055W056X057Y058Z059['.              00830001
009100     05                                  PIC X(40)   VALUE        00840000
009200         '060\061]062^063_064`065a066b067c068d069e'.              00850001
009300     05                                  PIC X(40)   VALUE        00860000
009400         '070f071g072h073i074j075k076l077m078n079o'.              00870001
009500     05                                  PIC X(40)   VALUE        00880000
009600         '080p081q082r083s084t085u086v087w088x089y'.              00890001
009700     05                                  PIC X(40)   VALUE        00900000
009800         '090z091{092|093}094~095096€097098099'.              00910001
009900     05                                  PIC X(28)   VALUE        00920000
010000         '100101…102103‡104ˆ105106'.                          00930001
010100 01  PT-PROGRAM-TABLE-REDEF REDEFINES PT-PROGRAM-TABLE.           00940000
010200     05  PT-ENTRY          OCCURS 107 TIMES INDEXED BY PT-INDX.   00950000
010300         10  PT-VALUE                    PIC 9(03).               00960000
010400         10  PT-CHAR                     PIC X(01).               00970000
010500                                                                  00980000
010600 LINKAGE SECTION.                                                 00990000
010700     COPY TFWS100.                                                01000001
010800                                                                  01010000
010900******************************************************************01020000
011000 PROCEDURE DIVISION USING        TF100-PARAMETERS.                01030000
011100******************************************************************01040000
011200 0000-MAINLINE.                                                   01050000
011300*                                                                 01060000
011400     PERFORM 1000-VALIDATE-DATA.                                  01070000
011500                                                                  01080000
011600     IF TF100-SUCCESSFUL                                          01090001
011700         PERFORM 2000-CALC-CHECK-DIGIT                            01100001
011800     END-IF.                                                      01110001
011900                                                                  01120001
012000     IF TF100-SUCCESSFUL                                          01130001
012100         PERFORM 3000-MOVE-RETURN-DATA                            01140001
012200     END-IF.                                                      01150001
012300                                                                  01160001
012400     GOBACK.                                                      01170000
012500     EJECT                                                        01180000
012600*                                                                 01190000
012700***************************************************************** 01200000
012800* VALIDATE DATA PASSED FROM THE CALLING PROGRAM.                  01210001
012900***************************************************************** 01220000
013000 1000-VALIDATE-DATA.                                              01230000
013100     SET TF100-SUCCESSFUL                 TO TRUE.                01240000
013200     IF NOT TF100-VALID-SET                                       01250000
013300         SET TF100-INVALID-CHARACTER-SET  TO TRUE                 01260000
013400     END-IF.                                                      01270000
013500     IF TF100-SUCCESSFUL                                          01280000
013600         IF TF100-NUMBER-OF-CHARACTERS NOT NUMERIC                01290000
013700             SET TF100-INVALID-LENGTH     TO TRUE                 01300000
013800         ELSE                                                     01320000
013900             MOVE TF100-NUMBER-OF-CHARACTERS TO PV-NBR-OF-CHARS   01321004
014000             IF TF100-NUMBER-OF-CHARACTERS = ZERO OR              01330000
014100                TF100-NUMBER-OF-CHARACTERS > 20                   01340000
014200                 SET TF100-INVALID-LENGTH TO TRUE                 01350000
014300             END-IF                                               01360000
014400         END-IF                                                   01370000
014500     END-IF.                                                      01380000
014600     IF TF100-SUCCESSFUL                                          01390000
014700         MOVE TF100-PASSED-DATA           TO PV-IN-DATA                   
014800         IF TF100-PASSED-DATA NOT > SPACES                        01400000
014900             SET TF100-INVALID-DATA       TO TRUE                 01410000
015000         END-IF                                                   01420000
015100     END-IF.                                                      01430000
015200***************************************************************** 01440001
015300* VALIDATE DATA PASSED FROM THE CALLING PROGRAM.                  01450001
015400***************************************************************** 01460001
015500 2000-CALC-CHECK-DIGIT.                                           01470001
015600     IF TF100-SET-A                                               01480001
015700         MOVE PC-SET-A-START-VALUE         TO PV-ACCUM-TOTAL      01490001
015800         MOVE PC-SET-A-START-CHARACTER     TO PV-START-CHARACTER  01500002
015900     ELSE                                                         01510001
016000         MOVE PC-SET-B-START-VALUE         TO PV-ACCUM-TOTAL      01520001
016100         MOVE PC-SET-B-START-CHARACTER     TO PV-START-CHARACTER  01530002
016200     END-IF.                                                      01540001
016300     PERFORM                                                      01550001
016400       VARYING IN-INDX                                            01560001
016500         FROM 1 BY 1 UNTIL                                        01570001
016600         IN-INDX > PV-NBR-OF-CHARS                                01580001
016700           SET PT-INDX                     TO 1                   01590001
016800           SEARCH PT-ENTRY                                        01600001
016900             VARYING PT-INDX                                      01610001
017000               AT END                                             01620001
017100                 SET TF100-CHECK-DIGIT-NOT-FOUND   TO TRUE        01630002
017200               WHEN PV-IN-CHAR (IN-INDX) = PT-CHAR (PT-INDX)      01640001
017300                 SET PV-ENTRY              TO IN-INDX             01650001
017400                 COMPUTE PV-ENTRY-TOTAL = PV-ENTRY *              01660001
017500                           PT-VALUE (PT-INDX)                     01670001
017600                 ADD PV-ENTRY-TOTAL        TO PV-ACCUM-TOTAL      01680001
017700           END-SEARCH                                             01690001
017800     END-PERFORM.                                                 01700001
017900     DIVIDE PV-ACCUM-TOTAL BY 103                                 01710001
018000       GIVING PV-QUOTIENT  REMAINDER  PV-REMAINDER.               01720001
018100     SET PT-INDX                     TO 1.                        01730001
018200     SEARCH PT-ENTRY                                              01740001
018300       VARYING PT-INDX                                            01750001
018400         AT END                                                   01760001
018500           SET TF100-CHECK-DIGIT-NOT-FOUND   TO TRUE              01770002
018600         WHEN PV-REMAINDER = PT-VALUE (PT-INDX)                   01780001
018700           MOVE PT-CHAR (PT-INDX)    TO PV-CHECK-DIGIT            01790001
018800     END-SEARCH.                                                  01800001
018900*                                                                 01810001
019000***************************************************************** 01820001
019100* MOVE THE START CHARACTER, PASSED DATA, CHECK DIGIT, AND STOP    01830001
019200* CHARACTER TO THE DATA FIELD TO BE RETURNED TO THE CALLING       01840001
019300* PROGRAM.                                                        01850001
019400***************************************************************** 01860001
019500 3000-MOVE-RETURN-DATA.                                           01870001
019600     INITIALIZE PV-OUT-DATA.                                      01880001
019700     SET OUT-INDX                       TO 1.                     01890001
019800     MOVE PV-START-CHARACTER            TO PV-OUT-CHAR (OUT-INDX).01900001
019900     PERFORM                                                      01910001
020000       VARYING IN-INDX                                            01920001
020100         FROM 1 BY 1 UNTIL                                        01930001
020200         IN-INDX > PV-NBR-OF-CHARS                                01940003
020300           SET OUT-INDX UP BY 1                                   01950001
020400           MOVE PV-IN-CHAR (IN-INDX)    TO PV-OUT-CHAR (OUT-INDX) 01960001
020500     END-PERFORM.                                                 01970001
020600     SET OUT-INDX UP BY 1.                                        01980001
020700     MOVE PV-CHECK-DIGIT                TO PV-OUT-CHAR (OUT-INDX).01990001
020800     SET OUT-INDX UP BY 1.                                        02000001
020900     MOVE PC-STOP-CHARACTER             TO PV-OUT-CHAR (OUT-INDX).02010002
021000     MOVE PV-OUT-DATA                   TO TF100-RETURNED-DATA.   02020001
268700*                                                                 26870072
