000100 IDENTIFICATION DIVISION.                                         00010010
000200 PROGRAM-ID.      RCKUP919.                                       00020010
000300 AUTHOR.          RON KRIER.                                      00030010
000400 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040010
000500 DATE-WRITTEN.    APRIL 2020.                                     00050010
000600 DATE-COMPILED.                                                   00060010
000700******************************************************************00070010
000800*  THIS PROGRAM WAS STARTED FROM PROGRAM SUKUT923.               *00080010
000900*                                                                *00090010
001000*  THIS PROGRAM WAS WRITTEN IN EARLY 2020 FOR THE PURPOSE OF     *00100010
001100*  BEING ABLE TO TAKE RECEIVERS FOR A TRAILER THAT HAVE ALREADY  *00110010
001200*  BEEN TRANSCRIBED FOR THE BRICK AND MORTAR STORES AND CHANGE   *00120010
001300*  THE RECEIVERS SO THAT THEY CAN BE RECEIVED AT AN EFC.         *00130010
001400*                                                                *00140010
001500*  DURING THE CORONAVIRUS PANDEMIC, INBOUND TRAILERS WERE        *00150010
001600*  ARRIVED IN THE DC YARDS AND THE COC GROUP HAD ALREADY BUILT   *00160010
001700*  THE TRAILERS IN THE SYSTEM AND TRANSCRIBED THE RECEIVERS.     *00170010
001800*  BECAUSE THE STORES WERE CLOSED, THE BUSINESS WANTED TO        *00180010
001900*  REROUTE SOME OF THESE TRAILERS TO EFC'S FOR THEM TO RECEIVE   *00190010
002000*  AND USE FOR FULFILLMENT.                                      *00200010
002100*                                                                *00210010
002200*  BECAUSE OF THIS, WE NEEDED TO COME UP WITH A WAY TO CHANGE    *00220010
002300*  THE DATA FOR THE RECEIVERS AND THE TRIPS TO POINT TO A        *00230010
002400*  DIFFERENT DC LOCATION AND THEN ALSO CHANGE THE TRECDIS        *00240010
002500*  ENTRIES FROM THE BRICK AND MORTAR STORES TO THE EFC STORES    *00250010
002600*  SO THAT COC DID NOT HAVE TO DO THIS ALL MANUALLY.             *00260010
002700******************************************************************00270010
002800 ENVIRONMENT DIVISION.                                            00280010
002900 CONFIGURATION SECTION.                                           00290010
003000 SOURCE-COMPUTER. IBM-3090.                                       00300010
003100 OBJECT-COMPUTER. IBM-3090.                                       00310010
003200                                                                  00320010
003300 INPUT-OUTPUT SECTION.                                            00330010
003400 FILE-CONTROL.                                                    00340010
003500     SELECT INPUT-FILE                                            00350010
003600         ASSIGN TO INP01.                                         00360010
003700                                                                  00370010
003800                                                                  00380010
003900 DATA DIVISION.                                                   00390010
004000 FILE SECTION.                                                    00400010
004100 FD  INPUT-FILE                                                   00410010
004200     LABEL RECORDS ARE STANDARD                                   00420010
004300     RECORDING MODE IS F                                          00430010
004400     BLOCK CONTAINS 0 RECORDS                                     00440010
004500     RECORD CONTAINS 80 CHARACTERS.                               00450010
004600 01  INPUT-RECORD                    PIC X(80).                   00460010
004700                                                                  00470010
004800                                                                  00480010
004900 WORKING-STORAGE SECTION.                                         00490010
005000                                                                  00500010
005100 01  ABEND-CODE                       PIC S9(04)     VALUE +0     00510010
005200                                                     COMP SYNC.   00520010
005300     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00530010
005400                                                                  00540010
005500 01  PS-PROGRAM-SWITCHES.                                         00550010
005600     05  PS-END-OF-INPUT-SW           PIC X          VALUE 'N'.   00560010
005700         88  PS-NOT-END-OF-INPUT                     VALUE 'N'.   00570010
005800         88  PS-END-OF-INPUT                         VALUE 'Y'.   00580010
005900     05  PS-END-OF-CURSOR-SW          PIC X          VALUE 'N'.   00590010
006000         88  PS-NOT-END-OF-CURSOR                    VALUE 'N'.   00600010
006100         88  PS-END-OF-CURSOR                        VALUE 'Y'.   00610010
006200     05  PS-CHECK-CASEPACK-SW         PIC X          VALUE 'N'.   00620010
006300         88  PS-CASEPACK-NOT-RUN                     VALUE 'N'.   00630010
006400         88  PS-CASEPACK-RUN                         VALUE 'Y'.   00640010
006500     05  PS-DATA-ISSUE-SW             PIC X          VALUE 'N'.   00650010
006600         88  PS-DATA-ISSUE-FOUND                     VALUE 'Y'.   00660010
006700         88  PS-DATA-ISSUE-NOT-FOUND                 VALUE 'N'.   00670010
006800     05  PS-RCVR-ACTIVITY-SW          PIC X          VALUE 'N'.   00680010
006900         88  PS-RCVR-ACTIVITY-FOUND                  VALUE 'Y'.   00690010
007000         88  PS-NO-RCVR-ACTIVITY-FOUND               VALUE 'N'.   00700010
007100     05  PS-RCVR-CM-VE-STATUS-SW      PIC X          VALUE 'N'.   00710010
007200         88  PS-RCVR-CM-VE-STATUS-FOUND              VALUE 'Y'.   00720010
007300         88  PS-RCVR-NO-CM-VE-STATUS                 VALUE 'N'.   00730010
007400     05  PS-IB-CART-ACTIVITY-SW       PIC X          VALUE 'N'.   00740010
007500         88  PS-IB-CART-ACTIVITY-FOUND               VALUE 'Y'.   00750010
007600         88  PS-NO-IB-CART-ACTIVITY                  VALUE 'N'.   00760010
007700     05  PS-OB-CART-ACTIVITY-SW       PIC X          VALUE 'N'.   00770010
007800         88  PS-OB-CART-ACTIVITY-FOUND               VALUE 'Y'.   00780010
007900         88  PS-NO-OB-CART-ACTIVITY                  VALUE 'N'.   00790010
007910     05  PS-LOC-ORGN-FOUND-SW         PIC X          VALUE 'N'.   00791010
007920         88  PS-LOC-ORGN-FOUND                       VALUE 'Y'.   00792010
007930         88  PS-LOC-ORGN-NOT-FOUND                   VALUE 'N'.   00793010
007940     05  PS-LOC-DEST-FOUND-SW         PIC X          VALUE 'N'.   00794010
007950         88  PS-LOC-DEST-FOUND                       VALUE 'Y'.   00795010
007960         88  PS-LOC-DEST-NOT-FOUND                   VALUE 'N'.   00796010
007970     05  PS-LOC-FOUND-SW              PIC X          VALUE 'N'.   00797010
007980         88  PS-LOC-FOUND                            VALUE 'Y'.   00798010
007990         88  PS-LOC-NOT-FOUND                        VALUE 'N'.   00799010
007991     05  PS-TROUBLE-CREATE-ISSUE-SW   PIC X          VALUE 'N'.   00799110
007992         88  PS-TROUBLE-CREATE-ISSUE                 VALUE 'Y'.   00799210
007993         88  PS-TROUBLE-CREATE-NO-ISSUE              VALUE 'N'.   00799310
007994     05  PS-REPURPOSE-ISSUE-SW        PIC X          VALUE 'N'.   00799410
007995         88  PS-REPURPOSE-ISSUE                      VALUE 'Y'.   00799510
007996         88  PS-REPURPOSE-NO-ISSUE                   VALUE 'N'.   00799610
007997     05  PS-PACKAGE-CHECK-SW          PIC X          VALUE 'N'.   00799710
007998         88  PS-PACKAGE-TYPE-FOUND                   VALUE 'Y'.   00799810
007999         88  PS-PACKAGE-TYPE-NOT-FOUND               VALUE 'N'.   00799910
008000     05  PS-TRBL-379-CHECK-SW         PIC X          VALUE 'N'.   00800010
008001         88  PS-TRBL-379-FOUND                       VALUE 'Y'.   00800110
008002         88  PS-TRBL-379-NOT-FOUND                   VALUE 'N'.   00800210
008003     05  PS-TRBL-405-CHECK-SW         PIC X          VALUE 'N'.   00800310
008004         88  PS-TRBL-405-FOUND                       VALUE 'Y'.   00800410
008005         88  PS-TRBL-405-NOT-FOUND                   VALUE 'N'.   00800510
008006     05  PS-DONE-SW                   PIC  X         VALUE 'N'.   00800610
008007         88  PS-NOT-DONE                             VALUE 'N'.   00800710
008008         88  PS-DONE                                 VALUE 'Y'.   00800810
008009                                                                  00800910
008010 01  PV-PROGRAM-VARIABLES.                                        00801010
008020     05  PV-DB2-FUNCTION              PIC  X(30)     VALUE SPACES.00802010
008030     05  PV-PARAGRAPH                 PIC  X(30)     VALUE SPACES.00803010
008040     05  PV-READ-COUNT                PIC S9(09)     COMP-3       00804010
008050                                                     VALUE ZERO.  00805010
008060     05  PV-READ-PROCESS-COUNT        PIC S9(09)     COMP-3       00806010
008070                                                     VALUE ZERO.  00807010
008080     05  PV-READ-BYPASS-COUNT         PIC S9(09)     COMP-3       00808010
008090                                                     VALUE ZERO.  00809010
008100     05  PV-ROW-COUNT                 PIC S9(09)     COMP-3       00810010
008200                                                     VALUE ZERO.  00820010
008300     05  PV-PREV-SHPUNT-ORGN          PIC S9(04) VALUE +0         00830010
008400                                                 COMP.            00840010
008500     05  PV-PREV-SHPUNT-DEST          PIC S9(04) VALUE +0         00850010
008600                                                 COMP.            00860010
008700     05  PV-LOC-ORGN-TYPE-CDE         PIC  X(02)     VALUE SPACES.00870010
008800     05  PV-LOC-DEST-TYPE-CDE         PIC  X(02)     VALUE SPACES.00880010
008900     05  PV-FCLTY-AREA-ID-NULL        PIC S9(04) VALUE +0         00890010
009000                                                 COMP.            00900010
009100     05  PV-TKT-FMT-ID-NULL           PIC S9(04) VALUE +0         00910010
009200                                                 COMP.            00920010
009300     05  UPDATE-COUNT                 PIC S9(09)     COMP-3       00930010
009310                                                     VALUE ZERO.  00931010
009320     05  PV-COMMIT-COUNT              PIC S9(09)     COMP-3       00932010
009330                                                     VALUE ZERO.  00933010
009340     05  FETCH-COUNT                  PIC S9(09)     COMP-3       00934010
009350                                                     VALUE ZERO.  00935010
009360     05  PV-ROW-COUNT-DISPLAY         PIC ZZZ,ZZZ,ZZ9             00936010
009370                                                     VALUE ZERO.  00937010
009380     05  UPDATE-COUNT-DISPLAY         PIC ZZZ,ZZZ,ZZ9             00938010
009390                                                     VALUE ZERO.  00939010
009400     05  COMMIT-COUNT-DISPLAY         PIC ZZZ,ZZZ,ZZ9             00940010
009500                                                     VALUE ZERO.  00950010
009600     05  FETCH-COUNT-DISPLAY          PIC ZZZ,ZZZ,ZZ9             00960010
009700                                                     VALUE ZERO.  00970010
009800     05  PV-PREV-TRIP-ID              PIC 9(10)      VALUE ZERO.  00980010
009900     05  PV-PREV-SCAC                 PIC X(04)      VALUE SPACES.00990010
010000     05  PV-PREV-TRLR                 PIC X(10)      VALUE SPACES.01000010
010100     05  PV-DISPLAY-FIELD-5           PIC 99999      VALUE ZERO.  01010010
010200     05  PV-DISPLAY-FIELD-5A          PIC 99999      VALUE ZERO.  01020010
010300     05  PV-DISPLAY-FIELD-5B          PIC 99999      VALUE ZERO.  01030010
010400     05  PV-DISPLAY-SQLCODE           PIC 99999-     VALUE ZERO.  01040010
010500     05  PV-DISPLAY-CARTON            PIC 999999999999999999.     01050010
010510     05  PV-REPURP-COUNT              PIC S9(09)  VALUE +0        01051010
010520                                                     COMP-3.      01052010
010530     05  PV-RETRY-COUNTER             PIC S9(04) VALUE ZERO       01053010
010540                                                  COMP SYNC.      01054010
010550                                                                  01055010
010560 01  DK-DATABASE-KEYS.                                            01056010
010570     05  DK-LOC-NBR                   PIC S9(04) VALUE +0         01057010
010580                                                 COMP.            01058010
010590     05  DK-OPER-UNT-ID               PIC S9(04) VALUE +0         01059010
010600                                                 COMP.            01060010
010700     05  DK-CURR-OPER-UNT-ID          PIC S9(04) VALUE +0         01070010
010800                                                 COMP.            01080010
010900                                                                  01090010
011000 01  WS-INPUT-RECORD.                                             01100010
011100     05  WS-IR-PO-NBR                PIC 9(08).                   01110010
011200     05  FILLER                      PIC X(01).                   01120010
011300     05  WS-IR-RCVR-NBR              PIC 9(04).                   01130010
011400     05  FILLER                      PIC X(01).                   01140010
011500     05  WS-IR-OPER-CHG-TO           PIC 9(04).                   01150010
011600     05  FILLER                      PIC X(01).                   01160010
011700     05  WS-IR-CRE-OPER-CHG-TO       PIC 9(04).                   01170010
011800     05  FILLER                      PIC X(01).                   01180010
011900     05  WS-IR-CURR-OPER-CHG-TO      PIC 9(04).                   01190010
012000     05  FILLER                      PIC X(01).                   01200010
012100     05  WS-IR-STOR-CHG-TO           PIC 9(04).                   01210010
012200     05  FILLER                      PIC X(01).                   01220010
012300     05  WS-IR-OPER-SET              PIC 9(04).                   01230010
012400     05  FILLER                      PIC X(01).                   01240010
012500     05  WS-IR-SCAC                  PIC X(04).                   01250010
012600     05  FILLER                      PIC X(01).                   01260010
012700     05  WS-IR-TRLR                  PIC X(10).                   01270010
012800     05  FILLER                      PIC X(01).                   01280010
012900     05  WS-IR-TRIP-ID               PIC 9(10).                   01290010
013000     05  FILLER                      PIC X(01).                   01300010
013010     05  WS-IR-DC-REPURPOSE-IND      PIC X(01).                   01301010
013020         88  WS-DC-TO-REPURPOSE-YES                VALUE 'Y'.     01302010
013030         88  WS-DC-TO-REPURPOSE-NO                 VALUE 'N'.     01303010
013040     05  FILLER                      PIC X(13).                   01304010
013050                                                                  01305010
013060 01  PC-PROGRAM-CONSTANTS.                                        01306010
013070     05  PC-CURRENT-PROGRAM-NAME      PIC X(8)       VALUE        01307010
013080                                                     'RCKUP919'.  01308010
013090     05  PC-MAX-RETRIES               PIC S9(4) VALUE +3          01309010
013100                                                COMP SYNC.        01310010
013200     05  PC-RAND-PGM                  PIC X(8) VALUE 'DPKUT902'.  01320010
013300                                                                  01330010
013400*  RANDOM NUMBER AREA.                                            01340010
013500     COPY DPWS902.                                                01350010
013600                                                                  01360010
013700******************************************************************01370010
013800*  DB2 MESSAGE AREAS                                              01380010
013900******************************************************************01390010
014000     COPY DPWS004.                                                01400010
014100                                                                  01410010
014200     EXEC SQL                                                     01420010
014300         INCLUDE TSHPUNT                                          01430010
014400     END-EXEC.                                                    01440010
014500                                                                  01450010
014600     EXEC SQL                                                     01460010
014700         INCLUDE TINPKSU                                          01470010
014800     END-EXEC.                                                    01480010
014900                                                                  01490010
015000     EXEC SQL                                                     01500010
015100         INCLUDE TPKSLIP                                          01510010
015200     END-EXEC.                                                    01520010
015300                                                                  01530010
015400     EXEC SQL                                                     01540010
015500         INCLUDE TPURCHS                                          01550010
015600     END-EXEC.                                                    01560010
015610                                                                  01561010
015620     EXEC SQL                                                     01562010
015630         INCLUDE TRECEIV                                          01563010
015640     END-EXEC.                                                    01564010
015650                                                                  01565010
015660     EXEC SQL                                                     01566010
015670         INCLUDE TRECITM                                          01567010
015680     END-EXEC.                                                    01568010
015690                                                                  01569010
015700     EXEC SQL                                                     01570010
015800         INCLUDE TRECDIS                                          01580010
015900     END-EXEC.                                                    01590010
016000                                                                  01600010
016100     EXEC SQL                                                     01610010
016200         INCLUDE TWRKORD                                          01620010
016300     END-EXEC.                                                    01630010
016400                                                                  01640010
016500     EXEC SQL                                                     01650010
016600         INCLUDE TWKORIN                                          01660010
016700     END-EXEC.                                                    01670010
016800                                                                  01680010
016900     EXEC SQL                                                     01690010
017000         INCLUDE TTRIPST                                          01700010
017100     END-EXEC.                                                    01710010
017200                                                                  01720010
017300     EXEC SQL                                                     01730010
017400         INCLUDE TVEHICL                                          01740010
017500     END-EXEC.                                                    01750010
017600                                                                  01760010
017700     EXEC SQL                                                     01770010
017800         INCLUDE TTRBNTF                                          01780010
017900     END-EXEC.                                                    01790010
018000                                                                  01800010
018100     EXEC SQL                                                     01810010
018200         INCLUDE TDISTHD                                          01820010
018300     END-EXEC.                                                    01830010
018400                                                                  01840010
018500     EXEC SQL                                                     01850010
018600         INCLUDE TSHUNLO                                          01860010
018700     END-EXEC.                                                    01870010
018800                                                                  01880010
018900*    SUT_OTBND_CART OUTBOUND CARTON TABLE                         01890010
019000                                                                  01900010
019100     EXEC SQL                                                     01910010
019200          INCLUDE SUT00024                                        01920010
019300     END-EXEC.                                                    01930010
019400                                                                  01940010
019500*    SUT_OTBND_UPC OUTBOUND CARTON UPC TABLE                      01950010
019600                                                                  01960010
019700     EXEC SQL                                                     01970010
019800          INCLUDE SUT00028                                        01980010
019900     END-EXEC.                                                    01990010
020000                                                                  02000010
020100*    XLT_LOC TABLE                                                02010010
020200                                                                  02020010
020300     EXEC SQL                                                     02030010
020400         INCLUDE XLT00010                                         02040010
020500     END-EXEC.                                                    02050010
020600                                                                  02060010
020700*    DB2 DCLGEN FOR THE WST_INTGRTN_TYP TABLE                     02070010
020800                                                                  02080010
020900     EXEC SQL                                                     02090010
021000          INCLUDE WST00008                                        02100010
021100     END-EXEC.                                                    02110010
021110                                                                  02111010
021120*    DB2 DCLGEN FOR THE WST_ATTR_DEFN TABLE                       02112010
021130                                                                  02113010
021140     EXEC SQL                                                     02114010
021150          INCLUDE WST00009                                        02115010
021160     END-EXEC.                                                    02116010
021170                                                                  02117010
021180*    DB2 DCLGEN FOR THE WST_ATTR_ELEM TABLE                       02118010
021190                                                                  02119010
021191     EXEC SQL                                                     02119110
021192          INCLUDE WST00010                                        02119210
021193     END-EXEC.                                                    02119310
021194                                                                  02119410
021195******************************************************************02119510
021196*    DB2 COMMUNICATIONS AREA                                      02119610
021197******************************************************************02119710
021198                                                                  02119810
021199     EXEC SQL                                                     02119910
021200         INCLUDE SQLCA                                            02120010
021300     END-EXEC.                                                    02130010
021400                                                                  02140010
021500******************************************************************02150010
021600*    CURSOR TO GET INBOUND CARTON ENTRIES                         02160010
021700******************************************************************02170010
021800     EXEC SQL                                                     02180010
021900       DECLARE CARTON-CSR CURSOR FOR                              02190010
022000        SELECT A.PO_NBR                                           02200010
022100              ,A.REC_SEQ_NBR                                      02210010
022200              ,A.SEQ_NBR                                          02220010
022300              ,A.STR_DEST_NBR                                     02230010
022400              ,C.SHIPT_UNT_ID                                     02240010
022500              ,C.ORGN_OPER_UNT_ID                                 02250010
022600              ,C.DEST_OPER_UNT_ID                                 02260010
022700        FROM   TPKSLIP A                                          02270010
022800              ,TINPKSU B                                          02280010
022900              ,TSHPUNT C                                          02290010
023000        WHERE A.PO_NBR        = :PKSLIP-PO-NBR                    02300010
023100          AND A.REC_SEQ_NBR   = :PKSLIP-REC-SEQ-NBR               02310010
023200          AND A.VER_STAT_CDE  = 'A'                               02320010
023300          AND A.PKSL_STAT_CDE = 'AC'                              02330010
023400          AND B.PO_NBR        = A.PO_NBR                          02340010
023500          AND B.SEQ_NBR       = A.SEQ_NBR                         02350010
023600          AND C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                    02360010
023700        ORDER BY 3                                                02370010
023800     END-EXEC.                                                    02380010
023900                                                                  02390010
024000******************************************************************02400010
024100 PROCEDURE DIVISION.                                              02410010
024200******************************************************************02420010
024300                                                                  02430010
024400 0000-MAIN-MODULE.                                                02440010
024500                                                                  02450010
024600     DISPLAY '** START OF PROGRAM RCKUP919 **'.                   02460010
024700                                                                  02470010
024800     OPEN INPUT  INPUT-FILE.                                      02480010
024900                                                                  02490010
025000     INITIALIZE UPDATE-COUNT                                      02500010
025100                FETCH-COUNT.                                      02510010
025200                                                                  02520010
025300     PERFORM 2001-READ-INPUT-FILE.                                02530010
025400                                                                  02540010
025500     IF  PS-END-OF-INPUT                                          02550010
025600         DISPLAY ' '                                              02560010
025700         DISPLAY '***** INPUT FILE EMPTY *****'                   02570010
025800     END-IF.                                                      02580010
025900                                                                  02590010
026000     PERFORM 2000-PROCESS-INPUT-FILE                              02600010
026100       UNTIL PS-END-OF-INPUT.                                     02610010
026200                                                                  02620010
026300     DISPLAY ' '.                                                 02630010
026400     MOVE PV-READ-COUNT TO PV-DISPLAY-FIELD-5.                    02640010
026500     DISPLAY 'TOTAL INPUT RECORDS READ     :  '                   02650010
026600         PV-DISPLAY-FIELD-5.                                      02660010
026700     MOVE PV-READ-PROCESS-COUNT TO PV-DISPLAY-FIELD-5.            02670010
026800     DISPLAY 'TOTAL INPUT RECORDS PROCESSED:  '                   02680010
026900         PV-DISPLAY-FIELD-5.                                      02690010
027000     MOVE PV-READ-BYPASS-COUNT TO PV-DISPLAY-FIELD-5.             02700010
027100     DISPLAY 'TOTAL INPUT RECORDS BYPASSED :  '                   02710010
027200         PV-DISPLAY-FIELD-5.                                      02720010
027300     MOVE PV-COMMIT-COUNT TO PV-DISPLAY-FIELD-5.                  02730010
027400     DISPLAY 'TOTAL COMMITS EXECUTED       :  '                   02740010
027500         PV-DISPLAY-FIELD-5.                                      02750010
027600                                                                  02760010
027700     CLOSE INPUT-FILE.                                            02770010
027800                                                                  02780010
027900     IF  PS-DATA-ISSUE-FOUND                                      02790010
028000         MOVE 4008 TO RETURN-CODE                                 02800010
028100     END-IF.                                                      02810010
028200                                                                  02820010
028300     GOBACK.                                                      02830010
028400                                                                  02840010
028500 2000-PROCESS-INPUT-FILE.                                         02850010
028600                                                                  02860010
028700     DISPLAY ' '.                                                 02870010
028800     MOVE PV-READ-COUNT TO PV-DISPLAY-FIELD-5.                    02880010
028900     DISPLAY 'STARTING TO PROCESS RECORD NUMBER:  '               02890010
029000         PV-DISPLAY-FIELD-5.                                      02900010
029100     DISPLAY 'PO NBR       : ' WS-IR-PO-NBR.                      02910010
029200     DISPLAY 'RCVR NBR     : ' WS-IR-RCVR-NBR.                    02920010
029300     DISPLAY 'OPER NBR     : ' WS-IR-OPER-CHG-TO.                 02930010
029400     DISPLAY 'CRE OPER NBR : ' WS-IR-CRE-OPER-CHG-TO.             02940010
029500     DISPLAY 'CURR OPER NBR: ' WS-IR-CURR-OPER-CHG-TO.            02950010
029600     DISPLAY 'STOR NBR     : ' WS-IR-STOR-CHG-TO.                 02960010
029700     DISPLAY 'OPSET        : ' WS-IR-OPER-SET.                    02970010
029800     DISPLAY 'SCAC         : ' WS-IR-SCAC.                        02980010
029900     DISPLAY 'TRLR         : ' WS-IR-TRLR.                        02990010
030000     DISPLAY 'TRIP         : ' WS-IR-TRIP-ID.                     03000010
030100     DISPLAY 'REPURPOSE IND: ' WS-IR-DC-REPURPOSE-IND.            03010010
030200                                                                  03020010
030300     SET PS-NO-RCVR-ACTIVITY-FOUND TO TRUE.                       03030010
030400     PERFORM 5000-CHECK-RECEIVER-ACTIVITY.                        03040010
030500     SET PS-REPURPOSE-NO-ISSUE TO TRUE.                           03050010
030600     PERFORM 5500-CHECK-REPURPOSE-IND.                            03060010
030700                                                                  03070010
030800     IF  PS-RCVR-ACTIVITY-FOUND                                   03080010
030900         DISPLAY 'ACTIVITY FOUND FOR THIS '                       03090010
031000                 'PO ' WS-IR-PO-NBR ' RECEIVER '                  03100010
031100                 WS-IR-RCVR-NBR                                   03110010
031200         DISPLAY '** WILL NOT PROCESS THIS RECORD **'             03120010
031300         ADD +1 TO PV-READ-BYPASS-COUNT                           03130010
031400         IF  PS-REPURPOSE-ISSUE                                   03140010
031500             DISPLAY 'REPURPOSE IND ISSUE FOR THIS '              03150010
031600                     'PO ' WS-IR-PO-NBR ' RECEIVER '              03160010
031610                     WS-IR-RCVR-NBR                               03161010
031620             DISPLAY '** WILL NOT PROCESS THIS RECORD **'         03162010
031630         ELSE                                                     03163010
031640             DISPLAY 'REPURPOSE IND CHECK IS GOOD '               03164010
031650         END-IF                                                   03165010
031660     ELSE                                                         03166010
031670         IF  PS-REPURPOSE-ISSUE                                   03167010
031680             DISPLAY 'REPURPOSE CODE ISSUE FOR THIS '             03168010
031690                     'PO ' WS-IR-PO-NBR ' RECEIVER '              03169010
031700                     WS-IR-RCVR-NBR                               03170010
031710             DISPLAY '** WILL NOT PROCESS THIS RECORD **'         03171010
031711             ADD +1 TO PV-READ-BYPASS-COUNT                       03171110
031712         ELSE                                                     03171210
031713             DISPLAY 'REPURPOSE IND CHECK IS GOOD '               03171310
031714             ADD +1 TO PV-READ-PROCESS-COUNT                      03171410
031715             PERFORM 2020-PROCESS-RECORD                          03171510
031716             PERFORM 2030-COMMIT-DB2                              03171610
031717         END-IF                                                   03171710
031718     END-IF.                                                      03171810
031719                                                                  03171910
031720     PERFORM 2001-READ-INPUT-FILE.                                03172010
031730                                                                  03173010
031740 2001-READ-INPUT-FILE.                                            03174010
031750                                                                  03175010
031760     READ INPUT-FILE INTO WS-INPUT-RECORD                         03176010
031770        AT END                                                    03177010
031780           SET PS-END-OF-INPUT TO TRUE.                           03178010
031790                                                                  03179010
031800     IF  PS-END-OF-INPUT                                          03180010
031900         NEXT SENTENCE                                            03190010
032000     ELSE                                                         03200010
032100         ADD +1 TO PV-READ-COUNT                                  03210010
032200         MOVE ZEROS TO PV-PREV-SHPUNT-ORGN                        03220010
032300                       PV-PREV-SHPUNT-DEST                        03230010
032400         MOVE SPACES TO PV-LOC-ORGN-TYPE-CDE                      03240010
032500                        PV-LOC-DEST-TYPE-CDE                      03250010
032600     END-IF.                                                      03260010
032700                                                                  03270010
032800 2020-PROCESS-RECORD.                                             03280010
032900                                                                  03290010
033000     PERFORM 2300-PROCESS-TRECEIV.                                03300010
033100     PERFORM 2310-PROCESS-TRECITM.                                03310010
033200     PERFORM 2320-UPDATE-TRECDIS.                                 03320010
033300     PERFORM 2330-UPDATE-TPKSLIP.                                 03330010
033400     PERFORM 2340-UPDATE-TWRKORD.                                 03340010
033500     PERFORM 2350-UPDATE-TWKORIN.                                 03350010
033600                                                                  03360010
033700     IF  WS-IR-TRIP-ID = 0                                        03370010
033800         DISPLAY 'TTRIPST UPDATE BYPASSED DUE TO ZERO TRIP NBR'   03380010
033900     ELSE                                                         03390010
034000         IF  WS-IR-TRIP-ID = PV-PREV-TRIP-ID                      03400010
034100             DISPLAY 'TTRIPST UPDATED BY PREVIOUS RECORD'         03410010
034200         ELSE                                                     03420010
034300             PERFORM 2360-UPDATE-TTRIPST                          03430010
034400             MOVE WS-IR-TRIP-ID TO PV-PREV-TRIP-ID                03440010
034500         END-IF                                                   03450010
034600     END-IF.                                                      03460010
034700                                                                  03470010
034800     IF  WS-IR-SCAC = '    '                                      03480010
034900         DISPLAY 'TVEHICL UPDATE BYPASSED DUE TO SPACES FOR SCAC' 03490010
035000     ELSE                                                         03500010
035100         IF  WS-IR-SCAC = PV-PREV-SCAC                            03510010
035200         AND WS-IR-TRLR = PV-PREV-TRLR                            03520010
035300             DISPLAY 'TVEHICL UPDATED BY PREVIOUS RECORD'         03530010
035400         ELSE                                                     03540010
035500             PERFORM 2370-UPDATE-TVEHICL                          03550010
035600             MOVE WS-IR-SCAC TO PV-PREV-SCAC                      03560010
035700             MOVE WS-IR-TRLR TO PV-PREV-TRLR                      03570010
035800         END-IF                                                   03580010
035900     END-IF.                                                      03590010
036000                                                                  03600010
036100     PERFORM 2380-UPDATE-TTRBNTF.                                 03610010
036200     PERFORM 2390-UPDATE-TDISTHD.                                 03620010
036300                                                                  03630010
036400     SET PS-NOT-END-OF-CURSOR TO TRUE.                            03640010
036500     PERFORM 2400-OPEN-CURSOR.                                    03650010
036600     PERFORM 2500-FETCH-CURSOR.                                   03660010
036700                                                                  03670010
036800     PERFORM 2600-PROCESS-CARTONS                                 03680010
036900         UNTIL PS-END-OF-CURSOR.                                  03690010
037000     PERFORM 2700-CLOSE-CURSOR.                                   03700010
037100     MOVE UPDATE-COUNT TO UPDATE-COUNT-DISPLAY.                   03710010
037200     MOVE FETCH-COUNT TO FETCH-COUNT-DISPLAY.                     03720010
037300     DISPLAY 'CURSOR NBR OF CARTONS EXTRACTED:  ' FETCH-COUNT.    03730010
037400     DISPLAY 'CURSOR NBR OF CARTONS UPDATED  :  ' UPDATE-COUNT.   03740010
037500     INITIALIZE UPDATE-COUNT FETCH-COUNT.                         03750010
037600                                                                  03760010
037700     IF  WS-DC-TO-REPURPOSE-YES                                   03770010
037800         PERFORM 6000-PROCESS-REPURP-TROUBLE                      03780010
037900     END-IF.                                                      03790010
038000                                                                  03800010
038100 2030-COMMIT-DB2.                                                 03810010
038200                                                                  03820010
038300     EXEC SQL                                                     03830010
038400          COMMIT                                                  03840010
038500     END-EXEC.                                                    03850010
038600                                                                  03860010
038700     EVALUATE TRUE                                                03870010
038800         WHEN SQLCODE = ZEROS                                     03880010
038900              ADD +1 TO PV-COMMIT-COUNT                           03890010
039000         WHEN OTHER                                               03900010
039100             MOVE '2030-COMMIT-DB2          '                     03910010
039200                                    TO PV-PARAGRAPH               03920010
039300             MOVE 'COMMIT        ' TO PV-DB2-FUNCTION             03930010
039400             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   03940010
039500             DISPLAY '2030-COMMIT-DB2:  '                         03950010
039600                     PV-DISPLAY-SQLCODE                           03960010
039700             PERFORM 9900-DB2-ABEND                               03970010
039800     END-EVALUATE.                                                03980010
039900                                                                  03990010
040000******************************************************************04000010
040100*    PERFORMS UPDATE OF OPER UNIT ID'S ON TRECEIV                 04010010
040200******************************************************************04020010
040300 2300-PROCESS-TRECEIV.                                            04030010
040400                                                                  04040010
040500     MOVE WS-IR-OPER-CHG-TO      TO RECEIV-OPER-UNT-ID.           04050010
040600     MOVE WS-IR-CRE-OPER-CHG-TO  TO RECEIV-CRE-OPER-UNT-ID.       04060010
040700     MOVE WS-IR-CURR-OPER-CHG-TO TO RECEIV-CURR-OPER-UNT-ID.      04070010
040800                                                                  04080010
040900     MOVE WS-IR-PO-NBR           TO RECEIV-ORD-NBR.               04090010
041000     MOVE WS-IR-RCVR-NBR         TO RECEIV-REC-SEQ-NBR.           04100010
041010                                                                  04101010
041020     IF  WS-DC-TO-REPURPOSE-YES                                   04102010
041030         PERFORM 2302-UPDATE-TRECEIV-BULK                         04103010
041040     ELSE                                                         04104010
041050         PERFORM 2304-UPDATE-TRECEIV                              04105010
041060     END-IF.                                                      04106010
041070                                                                  04107010
041080                                                                  04108010
041090 2302-UPDATE-TRECEIV-BULK.                                        04109010
041100                                                                  04110010
041101     EXEC SQL                                                     04110110
041102        UPDATE TRECEIV                                            04110210
041103          SET  OPER_UNT_ID       = :RECEIV-OPER-UNT-ID            04110310
041104             , CRE_OPER_UNT_ID   = :RECEIV-CRE-OPER-UNT-ID        04110410
041105             , CURR_OPER_UNT_ID  = :RECEIV-CURR-OPER-UNT-ID       04110510
041106             , PKGNG_CDE         = 'B'                            04110610
041107        WHERE  ORD_NBR           = :RECEIV-ORD-NBR                04110710
041108          AND  REC_SEQ_NBR       = :RECEIV-REC-SEQ-NBR            04110810
041109     END-EXEC.                                                    04110910
041110                                                                  04111010
041111     EVALUATE TRUE                                                04111110
041112         WHEN SQLCODE = +0                                        04111210
041113              DISPLAY 'TRECEIV UPDATED - CHANGED TO BULK'         04111310
041114         WHEN SQLCODE = +100                                      04111410
041115              DISPLAY 'TRECEIV BULK +100 - DID NOT EXIST'         04111510
041116         WHEN OTHER                                               04111610
041117             MOVE '2302-UPDATE-TRECEIV-BULK '                     04111710
041118                                    TO PV-PARAGRAPH               04111810
041119             MOVE 'UPDATE TRECEIV' TO PV-DB2-FUNCTION             04111910
041120             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   04112010
041121             DISPLAY '2302-UPDATE-TRECEIV-BULK SQLCODE:  '        04112110
041122                     PV-DISPLAY-SQLCODE                           04112210
041123             PERFORM 9900-DB2-ABEND                               04112310
041124     END-EVALUATE.                                                04112410
041125                                                                  04112510
041126                                                                  04112610
041127 2304-UPDATE-TRECEIV.                                             04112710
041128                                                                  04112810
041129     EXEC SQL                                                     04112910
041130        UPDATE TRECEIV                                            04113010
041131          SET  OPER_UNT_ID       = :RECEIV-OPER-UNT-ID            04113110
041132             , CRE_OPER_UNT_ID   = :RECEIV-CRE-OPER-UNT-ID        04113210
041133             , CURR_OPER_UNT_ID  = :RECEIV-CURR-OPER-UNT-ID       04113310
041134        WHERE  ORD_NBR           = :RECEIV-ORD-NBR                04113410
041135          AND  REC_SEQ_NBR       = :RECEIV-REC-SEQ-NBR            04113510
041136     END-EXEC.                                                    04113610
041137                                                                  04113710
041138     EVALUATE TRUE                                                04113810
041139         WHEN SQLCODE = +0                                        04113910
041140              DISPLAY 'TRECEIV UPDATED'                           04114010
041150         WHEN SQLCODE = +100                                      04115010
041160              DISPLAY 'TRECEIV NOT UPDATED - DID NOT EXIST'       04116010
041170         WHEN OTHER                                               04117010
041180             MOVE '2304-UPDATE-TRECEIV      '                     04118010
041190                                    TO PV-PARAGRAPH               04119010
041200             MOVE 'UPDATE TRECEIV' TO PV-DB2-FUNCTION             04120010
041300             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   04130010
041400             DISPLAY '2304-UPDATE-TRECEIV SQLCODE:  '             04140010
041500                     PV-DISPLAY-SQLCODE                           04150010
041600             PERFORM 9900-DB2-ABEND                               04160010
041700     END-EVALUATE.                                                04170010
041800                                                                  04180010
041900******************************************************************04190010
042000*    PERFORMS UPDATE OF OPER UNIT ID'S ON TRECITM                 04200010
042100******************************************************************04210010
042200 2310-PROCESS-TRECITM.                                            04220010
042300                                                                  04230010
042400     MOVE WS-IR-OPER-CHG-TO TO RECITM-OPER-UNT-ID.                04240010
042500                                                                  04250010
042600     MOVE WS-IR-PO-NBR      TO RECITM-ORD-NBR.                    04260010
042700     MOVE WS-IR-RCVR-NBR    TO RECITM-REC-SEQ-NBR.                04270010
042800                                                                  04280010
042900     IF  WS-DC-TO-REPURPOSE-YES                                   04290010
043000         PERFORM 2312-UPDATE-TRECITM-BULK                         04300010
043100     ELSE                                                         04310010
043200         PERFORM 2314-UPDATE-TRECITM                              04320010
043300     END-IF.                                                      04330010
043400                                                                  04340010
043500                                                                  04350010
043600 2312-UPDATE-TRECITM-BULK.                                        04360010
043700                                                                  04370010
043800     EXEC SQL                                                     04380010
043900        UPDATE TRECITM                                            04390010
044000          SET  OPER_UNT_ID       = :RECITM-OPER-UNT-ID            04400010
044100            ,  PREPK_ID          = 0                              04410010
044200            ,  PREPK_RATO_QTY    = 0                              04420010
044300            ,  PREPK_ODD_UNT_QTY = 0                              04430010
044310            ,  PREPK_DRV_LNE_CDE = ' '                            04431010
044320        WHERE  ORD_NBR           = :RECITM-ORD-NBR                04432010
044330          AND  REC_SEQ_NBR       = :RECITM-REC-SEQ-NBR            04433010
044340     END-EXEC.                                                    04434010
044350                                                                  04435010
044360     EVALUATE TRUE                                                04436010
044370         WHEN SQLCODE = +0                                        04437010
044380              DISPLAY 'TRECITM UPDATED - CHANGED TO BULK'         04438010
044381         WHEN SQLCODE = +100                                      04438110
044382              DISPLAY 'TRECITM BULK +100 - DID NOT EXIST'         04438210
044383         WHEN OTHER                                               04438310
044384             MOVE '2312-UPDATE-TRECITM-BULK '                     04438410
044385                                    TO PV-PARAGRAPH               04438510
044386             MOVE 'UPDATE TRECITM' TO PV-DB2-FUNCTION             04438610
044387             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   04438710
044388             DISPLAY '2312-UPDATE-TRECITM-BULK SQLCODE:  '        04438810
044389                     PV-DISPLAY-SQLCODE                           04438910
044390             PERFORM 9900-DB2-ABEND                               04439010
044391     END-EVALUATE.                                                04439110
044392                                                                  04439210
044393                                                                  04439310
044394 2314-UPDATE-TRECITM.                                             04439410
044395                                                                  04439510
044396     EXEC SQL                                                     04439610
044397        UPDATE TRECITM                                            04439710
044398          SET  OPER_UNT_ID       = :RECITM-OPER-UNT-ID            04439810
044399        WHERE  ORD_NBR           = :RECITM-ORD-NBR                04439910
044400          AND  REC_SEQ_NBR       = :RECITM-REC-SEQ-NBR            04440010
044500     END-EXEC.                                                    04450010
044600                                                                  04460010
044700     EVALUATE TRUE                                                04470010
044800         WHEN SQLCODE = +0                                        04480010
044900              DISPLAY 'TRECITM UPDATED'                           04490010
045000         WHEN SQLCODE = +100                                      04500010
045100              DISPLAY 'TRECITM NOT UPDATED - DID NOT EXIST'       04510010
045200         WHEN OTHER                                               04520010
045300             MOVE '2314-UPDATE-TRECITM      '                     04530010
045400                                    TO PV-PARAGRAPH               04540010
045500             MOVE 'UPDATE TRECITM' TO PV-DB2-FUNCTION             04550010
045600             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   04560010
045700             DISPLAY '2314-UPDATE-TRECITM SQLCODE:  '             04570010
045800                     PV-DISPLAY-SQLCODE                           04580010
045900             PERFORM 9900-DB2-ABEND                               04590010
046000     END-EVALUATE.                                                04600010
046100                                                                  04610010
046200******************************************************************04620010
046300*    PERFORMS UPDATE OF OPER UNIT ID'S ON TRECDIS                 04630010
046400******************************************************************04640010
046500 2320-UPDATE-TRECDIS.                                             04650010
046600                                                                  04660010
046700     MOVE WS-IR-OPER-CHG-TO TO RECDIS-OPER-UNT-ID.                04670010
046800     MOVE WS-IR-PO-NBR      TO RECDIS-ORD-NBR.                    04680010
046900     MOVE WS-IR-RCVR-NBR    TO RECDIS-REC-SEQ-NBR.                04690010
047000                                                                  04700010
047100     EXEC SQL                                                     04710010
047200        UPDATE TRECDIS                                            04720010
047300          SET  OPER_UNT_ID       = :RECDIS-OPER-UNT-ID            04730010
047400        WHERE  ORD_NBR           = :RECDIS-ORD-NBR                04740010
047500          AND  REC_SEQ_NBR       = :RECDIS-REC-SEQ-NBR            04750010
047600     END-EXEC.                                                    04760010
047700                                                                  04770010
047800     EVALUATE TRUE                                                04780010
047900         WHEN SQLCODE = +0                                        04790010
048000              DISPLAY 'TRECDIS UPDATED'                           04800010
048100         WHEN SQLCODE = +100                                      04810010
048110              DISPLAY 'TRECDIS NOT UPDATED - DID NOT EXIST'       04811010
048120         WHEN OTHER                                               04812010
048130             MOVE '2320-UPDATE-TRECDIS      '                     04813010
048140                                    TO PV-PARAGRAPH               04814010
048150             MOVE 'UPDATE TRECDIS' TO PV-DB2-FUNCTION             04815010
048160             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   04816010
048170             DISPLAY '2320-UPDATE-TRECDIS SQLCODE:  '             04817010
048180                     PV-DISPLAY-SQLCODE                           04818010
048190             PERFORM 9900-DB2-ABEND                               04819010
048200     END-EVALUATE.                                                04820010
048300                                                                  04830010
048400                                                                  04840010
048500******************************************************************04850010
048600*    PERFORMS UPDATE OF OPER UNIT ID'S ON NON PACK-BY-STORE       04860010
048700*    PACKSLIPS                                                    04870010
048800******************************************************************04880010
048900 2330-UPDATE-TPKSLIP.                                             04890010
049000                                                                  04900010
049100     MOVE WS-IR-OPER-CHG-TO TO PKSLIP-OPER-UNT-ID.                04910010
049200     MOVE WS-IR-STOR-CHG-TO TO PKSLIP-STR-DEST-NBR.               04920010
049300                                                                  04930010
049400     MOVE WS-IR-PO-NBR      TO PKSLIP-PO-NBR.                     04940010
049500     MOVE WS-IR-RCVR-NBR    TO PKSLIP-REC-SEQ-NBR.                04950010
049600                                                                  04960010
049700     EXEC SQL                                                     04970010
049800        UPDATE TPKSLIP                                            04980010
049900          SET  OPER_UNT_ID       = :PKSLIP-OPER-UNT-ID            04990010
050000        WHERE  PO_NBR            = :PKSLIP-PO-NBR                 05000010
050100          AND  REC_SEQ_NBR       = :PKSLIP-REC-SEQ-NBR            05010010
050200     END-EXEC.                                                    05020010
050300                                                                  05030010
050400     EVALUATE TRUE                                                05040010
050500         WHEN SQLCODE = +0                                        05050010
050600              DISPLAY 'TPKSLIP UPDATED'                           05060010
050700         WHEN SQLCODE = +100                                      05070010
050800              DISPLAY 'TPKSLIP +100   '                           05080010
050900         WHEN OTHER                                               05090010
051000             MOVE '2330-UPDATE-TPKSLIP      '                     05100010
051100                                    TO PV-PARAGRAPH               05110010
051200             MOVE 'UPDATE TPKSLIP' TO PV-DB2-FUNCTION             05120010
051300             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   05130010
051400             DISPLAY '2330-UPDATE-TPKSLIP SQLCODE:  '             05140010
051500                     PV-DISPLAY-SQLCODE                           05150010
051600             PERFORM 9900-DB2-ABEND                               05160010
051700     END-EVALUATE.                                                05170010
051800                                                                  05180010
051900******************************************************************05190010
052000*    PERFORMS UPDATE OF OPER UNIT ID'S ON TWRKORD                 05200010
052100******************************************************************05210010
052200 2340-UPDATE-TWRKORD.                                             05220010
052300                                                                  05230010
052400     MOVE WS-IR-OPER-CHG-TO TO WRKORD-OPER-UNT-ID.                05240010
052500                                                                  05250010
052600     MOVE WS-IR-PO-NBR      TO WRKORD-ORD-NBR.                    05260010
052700     MOVE WS-IR-RCVR-NBR    TO WRKORD-RCVR-SEQ-NBR.               05270010
052800                                                                  05280010
052900     MOVE WS-IR-OPER-SET    TO WRKORD-OPER-SET-ID.                05290010
053000                                                                  05300010
053100     EXEC SQL                                                     05310010
053200        UPDATE TWRKORD                                            05320010
053300          SET  OPER_UNT_ID       = :WRKORD-OPER-UNT-ID            05330010
053400              ,OPER_SET_ID       = :WRKORD-OPER-SET-ID            05340010
053500        WHERE  ORD_NBR           = :WRKORD-ORD-NBR                05350010
053600          AND  RCVR_SEQ_NBR      = :WRKORD-RCVR-SEQ-NBR           05360010
053700     END-EXEC.                                                    05370010
053800                                                                  05380010
053900     EVALUATE TRUE                                                05390010
054000         WHEN SQLCODE = +0                                        05400010
054100              DISPLAY 'TWRKORD UPDATED'                           05410010
054200         WHEN SQLCODE = +100                                      05420010
054300              DISPLAY 'TWRKORD +100   '                           05430010
054400         WHEN OTHER                                               05440010
054500             MOVE '2340-UPDATE-TWRKORD      '                     05450010
054600                                    TO PV-PARAGRAPH               05460010
054700             MOVE 'UPDATE TWRKORD' TO PV-DB2-FUNCTION             05470010
054800             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   05480010
054900             DISPLAY '2340-UPDATE-TWRKORD SQLCODE:  '             05490010
055000                     PV-DISPLAY-SQLCODE                           05500010
055100             PERFORM 9900-DB2-ABEND                               05510010
055200     END-EVALUATE.                                                05520010
055300                                                                  05530010
055400******************************************************************05540010
055500*    PERFORMS UPDATE OF OPER UNIT ID'S ON TWKORIN                 05550010
055600******************************************************************05560010
055700 2350-UPDATE-TWKORIN.                                             05570010
055800                                                                  05580010
055900     MOVE WS-IR-OPER-CHG-TO TO WKORIN-OPER-UNT-ID.                05590010
056000                                                                  05600010
056100     MOVE  WS-IR-PO-NBR     TO WKORIN-ORD-NBR.                    05610010
056200     MOVE  WS-IR-RCVR-NBR   TO WKORIN-RCVR-SEQ-NBR.               05620010
056300                                                                  05630010
056400     EXEC SQL                                                     05640010
056500        UPDATE TWKORIN                                            05650010
056600          SET  OPER_UNT_ID       = :WKORIN-OPER-UNT-ID            05660010
056700        WHERE  ORD_NBR           = :WKORIN-ORD-NBR                05670010
056800          AND  RCVR_SEQ_NBR      = :WKORIN-RCVR-SEQ-NBR           05680010
056900     END-EXEC.                                                    05690010
057000                                                                  05700010
057100     EVALUATE TRUE                                                05710010
057200         WHEN SQLCODE = +0                                        05720010
057300              DISPLAY 'TWKORIN UPDATED'                           05730010
057400         WHEN SQLCODE = +100                                      05740010
057500              DISPLAY 'TWKORIN +100   '                           05750010
057600         WHEN OTHER                                               05760010
057700             MOVE '2350-UPDATE-TWKORIN      '                     05770010
057800                                    TO PV-PARAGRAPH               05780010
057900             MOVE 'UPDATE TWKORIN' TO PV-DB2-FUNCTION             05790010
058000             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   05800010
058100             DISPLAY '2350-UPDATE-TWKORIN SQLCODE:  '             05810010
058200                     PV-DISPLAY-SQLCODE                           05820010
058300             PERFORM 9900-DB2-ABEND                               05830010
058400     END-EVALUATE.                                                05840010
058500                                                                  05850010
058600******************************************************************05860010
058700*    PERFORMS UPDATE OF OPER UNIT ID'S ON TTRIPST                 05870010
058800******************************************************************05880010
058900 2360-UPDATE-TTRIPST.                                             05890010
059000                                                                  05900010
059100     MOVE WS-IR-OPER-CHG-TO TO TRIPST-OPER-UNT-ID.                05910010
059200                                                                  05920010
059300     MOVE WS-IR-TRIP-ID     TO TRIPST-TRIP-ID.                    05930010
059400                                                                  05940010
059500     EXEC SQL                                                     05950010
059600        UPDATE TTRIPST                                            05960010
059700          SET  OPER_UNT_ID       = :TRIPST-OPER-UNT-ID            05970010
059800        WHERE  TRIP_ID           = :TRIPST-TRIP-ID                05980010
059900     END-EXEC.                                                    05990010
060000                                                                  06000010
060100     EVALUATE TRUE                                                06010010
060200         WHEN SQLCODE = +0                                        06020010
060300              DISPLAY 'TTRIPST UPDATED'                           06030010
060400         WHEN SQLCODE = +100                                      06040010
060500              DISPLAY 'TTRIPST +100'                              06050010
060600         WHEN OTHER                                               06060010
060700             MOVE '2360-UPDATE-TTRIPST      '                     06070010
060800                                    TO PV-PARAGRAPH               06080010
060900             MOVE 'UPDATE TTRIPST' TO PV-DB2-FUNCTION             06090010
061000             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   06100010
061100             DISPLAY '2360-UPDATE-TTRIPST SQLCODE:  '             06110010
061200                     PV-DISPLAY-SQLCODE                           06120010
061300             PERFORM 9900-DB2-ABEND                               06130010
061400     END-EVALUATE.                                                06140010
061500                                                                  06150010
061600******************************************************************06160010
061700*    PERFORMS UPDATE OF OPER UNIT ID'S ON TVEHICL                 06170010
061800******************************************************************06180010
061900 2370-UPDATE-TVEHICL.                                             06190010
062000                                                                  06200010
062100     MOVE WS-IR-OPER-CHG-TO TO VEHICL-CURR-OPER-UNT-ID.           06210010
062200                                                                  06220010
062300     MOVE WS-IR-SCAC        TO VEHICL-OWNER-SCAC-ID.              06230010
062400     MOVE WS-IR-TRLR        TO VEHICL-VEH-NBR.                    06240010
062500                                                                  06250010
062600     EXEC SQL                                                     06260010
062700        UPDATE TVEHICL                                            06270010
062800          SET  CURR_OPER_UNT_ID  = :VEHICL-CURR-OPER-UNT-ID       06280010
062900        WHERE  OWNER_SCAC_ID     = :VEHICL-OWNER-SCAC-ID          06290010
063000          AND  VEH_NBR           = :VEHICL-VEH-NBR                06300010
063100     END-EXEC.                                                    06310010
063200                                                                  06320010
063300     EVALUATE TRUE                                                06330010
063400         WHEN SQLCODE = +0                                        06340010
063500              DISPLAY 'TVEHICL UPDATED'                           06350010
063600         WHEN SQLCODE = +100                                      06360010
063700              DISPLAY 'TVEHICL +100'                              06370010
063800         WHEN OTHER                                               06380010
063900             MOVE '2370-UPDATE-TVEHICL      '                     06390010
064000                                    TO PV-PARAGRAPH               06400010
064100             MOVE 'UPDATE TVEHICL' TO PV-DB2-FUNCTION             06410010
064200             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   06420010
064300             DISPLAY '2370-UPDATE-TVEHICL SQLCODE:  '             06430010
064400                     PV-DISPLAY-SQLCODE                           06440010
064500             PERFORM 9900-DB2-ABEND                               06450010
064600     END-EVALUATE.                                                06460010
064700                                                                  06470010
064800******************************************************************06480010
064900*    PERFORMS UPDATE OF OPER UNIT ID'S ON TTRBNTF                 06490010
065000******************************************************************06500010
065100 2380-UPDATE-TTRBNTF.                                             06510010
065200                                                                  06520010
065300     MOVE WS-IR-OPER-CHG-TO TO TRBNTF-OPER-UNT-ID.                06530010
065400                                                                  06540010
065500     MOVE WS-IR-PO-NBR      TO TRBNTF-PO-NBR.                     06550010
065600     MOVE WS-IR-RCVR-NBR    TO TRBNTF-REC-SEQ-NBR.                06560010
065700                                                                  06570010
065800     EXEC SQL                                                     06580010
065900        UPDATE TTRBNTF                                            06590010
066000          SET  OPER_UNT_ID       = :TRBNTF-OPER-UNT-ID            06600010
066100        WHERE  PO_NBR            = :TRBNTF-PO-NBR                 06610010
066200          AND  REC_SEQ_NBR       = :TRBNTF-REC-SEQ-NBR            06620010
066300     END-EXEC.                                                    06630010
066400                                                                  06640010
066500     EVALUATE TRUE                                                06650010
066600         WHEN SQLCODE = +0                                        06660010
066700              DISPLAY 'TTRBNTF UPDATED'                           06670010
066800         WHEN SQLCODE = +100                                      06680010
066900              DISPLAY 'TTRBNTF +100   '                           06690010
067000         WHEN OTHER                                               06700010
067100             MOVE '2380-UPDATE-TTRBNTF      '                     06710010
067200                                    TO PV-PARAGRAPH               06720010
067300             MOVE 'UPDATE TTRBNTF' TO PV-DB2-FUNCTION             06730010
067400             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   06740010
067500             DISPLAY '2380-UPDATE-TTRBNTF SQLCODE:  '             06750010
067600                     PV-DISPLAY-SQLCODE                           06760010
067700             PERFORM 9900-DB2-ABEND                               06770010
067800     END-EVALUATE.                                                06780010
067900                                                                  06790010
068000******************************************************************06800010
068100*    PERFORMS UPDATE OF OPER UNIT ID'S ON TDISTHD                 06810010
068200******************************************************************06820010
068300 2390-UPDATE-TDISTHD.                                             06830010
068400                                                                  06840010
068500     MOVE WS-IR-OPER-CHG-TO TO DISTHD-OPER-UNT-ID.                06850010
068600                                                                  06860010
068700     MOVE WS-IR-PO-NBR      TO DISTHD-ORD-NBR.                    06870010
068800     MOVE WS-IR-RCVR-NBR    TO DISTHD-RCVR-SEQ-NBR.               06880010
068900                                                                  06890010
069000     EXEC SQL                                                     06900010
069100        UPDATE TDISTHD                                            06910010
069200          SET  OPER_UNT_ID       = :DISTHD-OPER-UNT-ID            06920010
069300        WHERE  ORD_NBR           = :DISTHD-ORD-NBR                06930010
069400          AND  RCVR_SEQ_NBR      = :DISTHD-RCVR-SEQ-NBR           06940010
069500     END-EXEC.                                                    06950010
069600                                                                  06960010
069700     EVALUATE TRUE                                                06970010
069800         WHEN SQLCODE = +0                                        06980010
069900              DISPLAY 'TDISTHD UPDATED'                           06990010
070000         WHEN SQLCODE = +100                                      07000010
070100              DISPLAY 'TDISTHD +100   '                           07010010
070200         WHEN OTHER                                               07020010
070300             MOVE '2390-UPDATE-TDISTHD      '                     07030010
070400                                    TO PV-PARAGRAPH               07040010
070500             MOVE 'UPDATE TDISTHD' TO PV-DB2-FUNCTION             07050010
070600             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   07060010
070700             DISPLAY '2390-UPDATE-TDISTHD SQLCODE:  '             07070010
070800                     PV-DISPLAY-SQLCODE                           07080010
070900             PERFORM 9900-DB2-ABEND                               07090010
071000     END-EVALUATE.                                                07100010
071100                                                                  07110010
071200***************************************************************** 07120010
071300*    OPENS THE CURSOR TO GET ONE OR MORE ROWS FROM TRECDIS WHICH  07130010
071400*    CORRESPOND TO THE INPUT RECORD.                              07140010
071500***************************************************************** 07150010
071600 2400-OPEN-CURSOR.                                                07160010
071700                                                                  07170010
071800     MOVE WS-IR-PO-NBR   TO PKSLIP-PO-NBR.                        07180010
071900     MOVE WS-IR-RCVR-NBR TO PKSLIP-REC-SEQ-NBR.                   07190010
072000                                                                  07200010
072100     EXEC SQL                                                     07210010
072200         OPEN CARTON-CSR                                          07220010
072300     END-EXEC.                                                    07230010
072400                                                                  07240010
072500     EVALUATE TRUE                                                07250010
072600         WHEN SQLCODE = +0                                        07260010
072700             CONTINUE                                             07270010
072800         WHEN OTHER                                               07280010
072900             MOVE '2400-OPEN-CURSOR'                              07290010
073000                                    TO PV-PARAGRAPH               07300010
073100             MOVE 'OPEN CARTON-CSR' TO PV-DB2-FUNCTION            07310010
073200             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   07320010
073300             DISPLAY '2400-OPEN-CURSOR SQLCODE:  '                07330010
073400                     PV-DISPLAY-SQLCODE                           07340010
073500             PERFORM 9900-DB2-ABEND                               07350010
073600     END-EVALUATE.                                                07360010
073700                                                                  07370010
073800***************************************************************** 07380010
073900*    PROCESSES THE ROWS FROM TRECDIS WHICH CORRESPOND TO THE      07390010
074000*    INPUT RECORD.                                                07400010
074100***************************************************************** 07410010
074200 2500-FETCH-CURSOR.                                               07420010
074300                                                                  07430010
074400     EXEC SQL                                                     07440010
074500         FETCH CARTON-CSR                                         07450010
074600         INTO  :PKSLIP-PO-NBR                                     07460010
074700              ,:PKSLIP-REC-SEQ-NBR                                07470010
074800              ,:PKSLIP-SEQ-NBR                                    07480010
074900              ,:PKSLIP-STR-DEST-NBR                               07490010
075000              ,:SHPUNT-SHIPT-UNT-ID                               07500010
075100              ,:SHPUNT-ORGN-OPER-UNT-ID                           07510010
075200              ,:SHPUNT-DEST-OPER-UNT-ID                           07520010
075300     END-EXEC.                                                    07530010
075400                                                                  07540010
075500     EVALUATE TRUE                                                07550010
075600         WHEN SQLCODE = +0                                        07560010
075700             ADD +1 TO FETCH-COUNT                                07570010
075800         WHEN SQLCODE = +100                                      07580010
075900             SET PS-END-OF-CURSOR TO TRUE                         07590010
076000         WHEN OTHER                                               07600010
076100             MOVE '2500-FETCH-CURSOR'                             07610010
076200                                    TO PV-PARAGRAPH               07620010
076300             MOVE 'FETCH CARTON-CSR' TO PV-DB2-FUNCTION           07630010
076400             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   07640010
076500             DISPLAY '2500-FETCH-CURSOR SQLCODE:  '               07650010
076600                     PV-DISPLAY-SQLCODE                           07660010
076700             PERFORM 9900-DB2-ABEND                               07670010
076800     END-EVALUATE.                                                07680010
076900                                                                  07690010
077000                                                                  07700010
077100***************************************************************** 07710010
077200*    PROCESSES THE CARTONS FROM THE CARTON-CSR                    07720010
077300***************************************************************** 07730010
077400 2600-PROCESS-CARTONS.                                            07740010
077500                                                                  07750010
077600     IF  SHPUNT-ORGN-OPER-UNT-ID = 0                              07760010
077700     AND SHPUNT-DEST-OPER-UNT-ID = 0                              07770010
077800         MOVE WS-IR-OPER-CHG-TO TO SHPUNT-ORGN-OPER-UNT-ID        07780010
077900                                   SHPUNT-DEST-OPER-UNT-ID        07790010
078000         PERFORM 2650-UPDATE-TSHPUNT                              07800010
078100     ELSE                                                         07810010
078200         PERFORM 2610-CHECK-SHPUNT-LOC                            07820010
078300         IF  PV-LOC-ORGN-TYPE-CDE = 'DC'                          07830010
078400         AND PV-LOC-DEST-TYPE-CDE = 'DC'                          07840010
078500             MOVE WS-IR-OPER-CHG-TO TO SHPUNT-ORGN-OPER-UNT-ID    07850010
078600                                       SHPUNT-DEST-OPER-UNT-ID    07860010
078700             PERFORM 2650-UPDATE-TSHPUNT                          07870010
078800         ELSE                                                     07880010
078900             MOVE WS-IR-OPER-CHG-TO TO SHPUNT-ORGN-OPER-UNT-ID    07890010
079000             PERFORM 2650-UPDATE-TSHPUNT                          07900010
079100         END-IF                                                   07910010
079200     END-IF.                                                      07920010
079300                                                                  07930010
079400     PERFORM 2500-FETCH-CURSOR.                                   07940010
079500                                                                  07950010
079600 2610-CHECK-SHPUNT-LOC.                                           07960010
079700                                                                  07970010
079800     IF  SHPUNT-ORGN-OPER-UNT-ID = 0                              07980010
079900         MOVE 'DC' TO PV-LOC-ORGN-TYPE-CDE                        07990010
080000     ELSE                                                         08000010
080100         IF  SHPUNT-ORGN-OPER-UNT-ID = PV-PREV-SHPUNT-ORGN        08010010
080200             NEXT SENTENCE                                        08020010
080300         ELSE                                                     08030010
080400             SET PS-LOC-NOT-FOUND TO TRUE                         08040010
080500             MOVE SHPUNT-ORGN-OPER-UNT-ID TO DK-LOC-NBR           08050010
080600             PERFORM 2620-SELECT-XLT-LOC                          08060010
080700             IF  PS-LOC-FOUND                                     08070010
080800                 MOVE XLT00010-LOC-TYP-CDE TO                     08080010
080900                      PV-LOC-ORGN-TYPE-CDE                        08090010
081000                 MOVE SHPUNT-ORGN-OPER-UNT-ID TO                  08100010
081100                      PV-PREV-SHPUNT-ORGN                         08110010
081200             ELSE                                                 08120010
081300                 MOVE 'DC' TO PV-LOC-ORGN-TYPE-CDE                08130010
081400                 MOVE 0 TO PV-PREV-SHPUNT-ORGN                    08140010
081500             END-IF                                               08150010
081600         END-IF                                                   08160010
081700     END-IF.                                                      08170010
081800                                                                  08180010
081900     IF  SHPUNT-DEST-OPER-UNT-ID = 0                              08190010
082000         MOVE 'DC' TO PV-LOC-DEST-TYPE-CDE                        08200010
082100     ELSE                                                         08210010
082200         IF  SHPUNT-DEST-OPER-UNT-ID = PV-PREV-SHPUNT-DEST        08220010
082300             NEXT SENTENCE                                        08230010
082400         ELSE                                                     08240010
082500             SET PS-LOC-NOT-FOUND TO TRUE                         08250010
082600             MOVE SHPUNT-DEST-OPER-UNT-ID TO DK-LOC-NBR           08260010
082700             PERFORM 2620-SELECT-XLT-LOC                          08270010
082800             IF  PS-LOC-FOUND                                     08280010
082900                 MOVE XLT00010-LOC-TYP-CDE TO                     08290010
083000                      PV-LOC-DEST-TYPE-CDE                        08300010
083100                 MOVE SHPUNT-DEST-OPER-UNT-ID TO                  08310010
083200                      PV-PREV-SHPUNT-DEST                         08320010
083300             ELSE                                                 08330010
083400                 MOVE 'DC' TO PV-LOC-DEST-TYPE-CDE                08340010
083500                 MOVE 0 TO PV-PREV-SHPUNT-DEST                    08350010
083510             END-IF                                               08351010
083520         END-IF                                                   08352010
083530     END-IF.                                                      08353010
083540                                                                  08354010
083550 2620-SELECT-XLT-LOC.                                             08355010
083560                                                                  08356010
083561     EXEC SQL                                                     08356110
083562        SELECT LOC_TYP_CDE                                        08356210
083563             , E_BUS_IND                                          08356310
083564          INTO :XLT00010-LOC-TYP-CDE                              08356410
083565             , :XLT00010-E-BUS-IND                                08356510
083566        FROM   XLT_LOC                                            08356610
083567        WHERE  LOC_NBR           = :DK-LOC-NBR                    08356710
083568     END-EXEC.                                                    08356810
083569                                                                  08356910
083570     EVALUATE TRUE                                                08357010
083571         WHEN SQLCODE = +0                                        08357110
083572              SET PS-LOC-FOUND TO TRUE                            08357210
083573         WHEN SQLCODE = +100                                      08357310
083574              SET PS-LOC-NOT-FOUND TO TRUE                        08357410
083575         WHEN OTHER                                               08357510
083576             MOVE '2620-SELECT-XLT-LOC'                           08357610
083577                                    TO PV-PARAGRAPH               08357710
083578             MOVE DK-LOC-NBR TO PV-DISPLAY-FIELD-5                08357810
083579             DISPLAY 'LOC NUMBER BEING SELECTED:  '               08357910
083580                     PV-DISPLAY-FIELD-5                           08358010
083590             MOVE 'SELECT XLT_LOC' TO PV-DB2-FUNCTION             08359010
083600             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   08360010
083601             DISPLAY '2620-SELECT-XLT-LOC SQLCODE:  '             08360110
083602                     PV-DISPLAY-SQLCODE                           08360210
083603             PERFORM 9900-DB2-ABEND                               08360310
083604     END-EVALUATE.                                                08360410
083605                                                                  08360510
083606***************************************************************** 08360610
083607*    UPDATE THE OPER UNIT IT FOR THE CARTON                       08360710
083608***************************************************************** 08360810
083609 2650-UPDATE-TSHPUNT.                                             08360910
083610                                                                  08361010
083611     EXEC SQL                                                     08361110
083612        UPDATE TSHPUNT                                            08361210
083613          SET  ORGN_OPER_UNT_ID  = :SHPUNT-ORGN-OPER-UNT-ID       08361310
083614            ,  DEST_OPER_UNT_ID  = :SHPUNT-DEST-OPER-UNT-ID       08361410
083615        WHERE  SHIPT_UNT_ID      = :SHPUNT-SHIPT-UNT-ID           08361510
083616     END-EXEC.                                                    08361610
083617                                                                  08361710
083618     EVALUATE TRUE                                                08361810
083619         WHEN SQLCODE = +0                                        08361910
083620             ADD +1 TO UPDATE-COUNT                               08362010
083630         WHEN OTHER                                               08363010
083640             MOVE '2650-UPDATE-TSHPUNT      '                     08364010
083650                                    TO PV-PARAGRAPH               08365010
083660             MOVE 'UPDATE TSHPUNT' TO PV-DB2-FUNCTION             08366010
083670             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   08367010
083680             DISPLAY '2650-UPDATE-TSHPUNT SQLCODE:  '             08368010
083690                     PV-DISPLAY-SQLCODE                           08369010
083700             PERFORM 9900-DB2-ABEND                               08370010
083800     END-EVALUATE.                                                08380010
083900                                                                  08390010
084000***************************************************************** 08400010
084100*    CLOSES THE CURSOR.                                           08410010
084200***************************************************************** 08420010
084300 2700-CLOSE-CURSOR.                                               08430010
084400                                                                  08440010
084500     EXEC SQL                                                     08450010
084600         CLOSE CARTON-CSR                                         08460010
084700     END-EXEC.                                                    08470010
084800                                                                  08480010
084900     EVALUATE TRUE                                                08490010
085000         WHEN SQLCODE = +0                                        08500010
085100             CONTINUE                                             08510010
085200         WHEN OTHER                                               08520010
085300             MOVE '2700-CLOSE-CURSOR '                            08530010
085400                                    TO PV-PARAGRAPH               08540010
085500             MOVE 'CLOSE CARTON-CSR' TO PV-DB2-FUNCTION           08550010
085600             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   08560010
085700             DISPLAY '2700-CLOSE-CURSOR SQLCODE:  '               08570010
085800                     PV-DISPLAY-SQLCODE                           08580010
085900             PERFORM 9900-DB2-ABEND                               08590010
086000     END-EVALUATE.                                                08600010
086100                                                                  08610010
086200 5000-CHECK-RECEIVER-ACTIVITY.                                    08620010
086300                                                                  08630010
086400     SET PS-CASEPACK-NOT-RUN TO TRUE.                             08640010
086500     PERFORM 5100-CHECK-IF-CASEPACK-RUN.                          08650010
086600                                                                  08660010
086700     IF  PS-CASEPACK-RUN                                          08670010
086800         SET PS-RCVR-ACTIVITY-FOUND TO TRUE                       08680010
086900         DISPLAY 'CASEPACK SPLIT IS ACTIVE FOR THIS '             08690010
087000                 'PO ' WS-IR-PO-NBR ' RECEIVER '                  08700010
087100                 WS-IR-RCVR-NBR                                   08710010
087200         DISPLAY '** WILL NOT PROCESS THIS RECORD **'             08720010
087300     ELSE                                                         08730010
087400         DISPLAY 'CASEPACK SPLIT CHECK IS GOOD'                   08740010
087500     END-IF.                                                      08750010
087600                                                                  08760010
087700     SET PS-RCVR-NO-CM-VE-STATUS TO TRUE.                         08770010
087800     PERFORM 5200-CHECK-CM-VE-STATUS.                             08780010
087900                                                                  08790010
088000     IF  PS-RCVR-CM-VE-STATUS-FOUND                               08800010
088100         SET PS-RCVR-ACTIVITY-FOUND TO TRUE                       08810010
088200         DISPLAY 'RECEIVER ITEM ENTRIES WITH CM OR VE STATUS FOR '08820010
088300                 'PO ' WS-IR-PO-NBR ' RECEIVER '                  08830010
088400                 WS-IR-RCVR-NBR                                   08840010
088500         DISPLAY '** WILL NOT PROCESS THIS RECORD **'             08850010
088600     ELSE                                                         08860010
088700         DISPLAY 'RECITM STATUS CHECK IS GOOD'                    08870010
088800     END-IF.                                                      08880010
088900                                                                  08890010
089000     SET PS-NO-IB-CART-ACTIVITY TO TRUE.                          08900010
089100     PERFORM 5300-CHECK-INBOUND-ACTIVITY.                         08910010
089200                                                                  08920010
089300     IF  PS-IB-CART-ACTIVITY-FOUND                                08930010
089400         SET PS-RCVR-ACTIVITY-FOUND TO TRUE                       08940010
089500         DISPLAY 'INBOUND CARTON ACTIVE CHECK IN FOUND FOR '      08950010
089600                 'PO ' WS-IR-PO-NBR ' RECEIVER '                  08960010
089700                 WS-IR-RCVR-NBR                                   08970010
089800         DISPLAY '** WILL NOT PROCESS THIS RECORD **'             08980010
089900     ELSE                                                         08990010
090000         DISPLAY 'INBOUND CARTON CHECK IS GOOD'                   09000010
090100     END-IF.                                                      09010010
090200                                                                  09020010
090300     SET PS-NO-OB-CART-ACTIVITY TO TRUE.                          09030010
090400     PERFORM 5400-CHECK-OUTBOUND-ACTIVITY.                        09040010
090500                                                                  09050010
090600     IF  PS-OB-CART-ACTIVITY-FOUND                                09060010
090700         SET PS-RCVR-ACTIVITY-FOUND TO TRUE                       09070010
090800         DISPLAY 'ACTIVE OUTBOUND CARTON FOUND FOR '              09080010
090900                 'PO ' WS-IR-PO-NBR ' RECEIVER '                  09090010
091000                 WS-IR-RCVR-NBR                                   09100010
091100         DISPLAY '** WILL NOT PROCESS THIS RECORD **'             09110010
091200     ELSE                                                         09120010
091300         DISPLAY 'OUTBOUND CARTON CHECK IS GOOD'                  09130010
091400     END-IF.                                                      09140010
091500                                                                  09150010
091600 5100-CHECK-IF-CASEPACK-RUN.                                      09160010
091700                                                                  09170010
091800     MOVE  WS-IR-PO-NBR   TO DISTHD-ORD-NBR.                      09180010
091900     MOVE  WS-IR-RCVR-NBR TO DISTHD-RCVR-SEQ-NBR.                 09190010
092000                                                                  09200010
092100     EXEC SQL                                                     09210010
092200        SELECT TOT_CART_CNT                                       09220010
092300          INTO :DISTHD-TOT-CART-CNT                               09230010
092400        FROM   TDISTHD A                                          09240010
092500        WHERE  ORD_NBR           = :DISTHD-ORD-NBR                09250010
092600          AND  RCVR_SEQ_NBR      = :DISTHD-RCVR-SEQ-NBR           09260010
092700          AND  TOT_CART_CNT      > 0                              09270010
092800     END-EXEC.                                                    09280010
092900                                                                  09290010
093000     EVALUATE TRUE                                                09300010
093100         WHEN SQLCODE = +0                                        09310010
093200         WHEN SQLCODE = -811                                      09320010
093300              SET PS-CASEPACK-RUN TO TRUE                         09330010
093400              SET PS-DATA-ISSUE-FOUND TO TRUE                     09340010
093500         WHEN SQLCODE = +100                                      09350010
093600              SET PS-CASEPACK-NOT-RUN TO TRUE                     09360010
093700         WHEN OTHER                                               09370010
093800             MOVE '5100-CHECK-IF-CASEPACK-RUN'                    09380010
093900                                    TO PV-PARAGRAPH               09390010
094000             MOVE 'SELECT TDISTHD' TO PV-DB2-FUNCTION             09400010
094100             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   09410010
094200             DISPLAY '5100-CHECK-IF-CASEPACK-RUN SQLCODE:  '      09420010
094300                     PV-DISPLAY-SQLCODE                           09430010
094400             PERFORM 9900-DB2-ABEND                               09440010
094500     END-EVALUATE.                                                09450010
094600                                                                  09460010
094700 5200-CHECK-CM-VE-STATUS.                                         09470010
094800                                                                  09480010
094900     MOVE  WS-IR-PO-NBR   TO RECITM-ORD-NBR.                      09490010
095000     MOVE  WS-IR-RCVR-NBR TO RECITM-REC-SEQ-NBR.                  09500010
095100                                                                  09510010
095200     EXEC SQL                                                     09520010
095300        SELECT STATUS_CDE                                         09530010
095400          INTO :RECITM-STATUS-CDE                                 09540010
095500        FROM   TRECITM                                            09550010
095600        WHERE  ORD_NBR           = :RECITM-ORD-NBR                09560010
095700          AND  REC_SEQ_NBR       = :RECITM-REC-SEQ-NBR            09570010
095800          AND  STATUS_CDE        IN ('CM','VE')                   09580010
095900          AND  VER_STATUS_CDE    = 'A'                            09590010
096000     END-EXEC.                                                    09600010
096100                                                                  09610010
096200     EVALUATE TRUE                                                09620010
096300         WHEN SQLCODE = +0                                        09630010
096400         WHEN SQLCODE = -811                                      09640010
096500              SET PS-RCVR-CM-VE-STATUS-FOUND TO TRUE              09650010
096600              SET PS-DATA-ISSUE-FOUND TO TRUE                     09660010
096700         WHEN SQLCODE = +100                                      09670010
096800              SET PS-RCVR-NO-CM-VE-STATUS TO TRUE                 09680010
096900         WHEN OTHER                                               09690010
097000             MOVE '5200-CHECK-CM-VE-STATUS'                       09700010
097100                                    TO PV-PARAGRAPH               09710010
097200             MOVE 'SELECT TRECITM' TO PV-DB2-FUNCTION             09720010
097300             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   09730010
097400             DISPLAY '5200-CHECK-CM-VE-STATUS SQLCODE:  '         09740010
097500                     PV-DISPLAY-SQLCODE                           09750010
097600             PERFORM 9900-DB2-ABEND                               09760010
097700     END-EVALUATE.                                                09770010
097800                                                                  09780010
097900 5300-CHECK-INBOUND-ACTIVITY.                                     09790010
098000                                                                  09800010
098100     MOVE  WS-IR-PO-NBR   TO PKSLIP-PO-NBR.                       09810010
098200     MOVE  WS-IR-RCVR-NBR TO PKSLIP-REC-SEQ-NBR.                  09820010
098300                                                                  09830010
098400     EXEC SQL                                                     09840010
098500        SELECT C.SHIPT_UNT_ID                                     09850010
098600          INTO :SHPUNT-SHIPT-UNT-ID                               09860010
098700        FROM   TPKSLIP A                                          09870010
098800              ,TINPKSU B                                          09880010
098900              ,TSHPUNT C                                          09890010
099000              ,TSHUNLO D                                          09900010
099100        WHERE A.PO_NBR        = :PKSLIP-PO-NBR                    09910010
099200          AND A.REC_SEQ_NBR   = :PKSLIP-REC-SEQ-NBR               09920010
099300          AND A.VER_STAT_CDE  = 'A'                               09930010
099400          AND A.PKSL_STAT_CDE = 'AC'                              09940010
099500          AND B.PO_NBR        = A.PO_NBR                          09950010
099600          AND B.SEQ_NBR       = A.SEQ_NBR                         09960010
099700          AND C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                    09970010
099800          AND C.ACTV_IND      = 'A'                               09980010
099900          AND D.SHIPT_UNT_ID  = C.SHIPT_UNT_ID                    09990010
100000          AND D.ACTV_CDE      = 'A'                               10000010
100100     END-EXEC.                                                    10010010
100200                                                                  10020010
100300     EVALUATE TRUE                                                10030010
100400         WHEN SQLCODE = +0                                        10040010
100500         WHEN SQLCODE = -811                                      10050010
100600              MOVE SHPUNT-SHIPT-UNT-ID TO PV-DISPLAY-CARTON       10060010
100700              DISPLAY 'EXAMPLE INBOUND CARTON WITH ACTIVITY:  '   10070010
100800                      PV-DISPLAY-CARTON                           10080010
100900              SET PS-IB-CART-ACTIVITY-FOUND TO TRUE               10090010
101000              SET PS-DATA-ISSUE-FOUND TO TRUE                     10100010
101100         WHEN SQLCODE = +100                                      10110010
101200              SET PS-NO-IB-CART-ACTIVITY TO TRUE                  10120010
101300         WHEN OTHER                                               10130010
101400             MOVE '5300-CHECK-INBOUND-ACTIVITY'                   10140010
101500                                    TO PV-PARAGRAPH               10150010
101600             MOVE 'SELECT INBOUND CARTON' TO PV-DB2-FUNCTION      10160010
101700             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   10170010
101800             DISPLAY '5300-CHECK-INBOUND-ACTIVITY SQLCODE:  '     10180010
101900                     PV-DISPLAY-SQLCODE                           10190010
102000             PERFORM 9900-DB2-ABEND                               10200010
102100     END-EVALUATE.                                                10210010
102200                                                                  10220010
102300 5400-CHECK-OUTBOUND-ACTIVITY.                                    10230010
102400                                                                  10240010
102500     MOVE  WS-IR-PO-NBR   TO SUT00028-TRN-NBR.                    10250010
102600     MOVE  WS-IR-RCVR-NBR TO SUT00028-RCVR-SEQ-NBR.               10260010
102700                                                                  10270010
102800     EXEC SQL                                                     10280010
102900        SELECT A.SHIPT_UNT_ID                                     10290010
103000          INTO :SUT00028-SHIPT-UNT-ID                             10300010
103100        FROM   SUT_OTBND_UPC  A                                   10310010
103200              ,SUT_OTBND_CART B                                   10320010
103300        WHERE A.TRN_NBR       = :SUT00028-TRN-NBR                 10330010
103400          AND A.RCVR_SEQ_NBR  = :SUT00028-RCVR-SEQ-NBR            10340010
103500          AND B.SHIPT_UNT_ID  = A.SHIPT_UNT_ID                    10350010
103600          AND B.ACTV_IND      = 'Y'                               10360010
103700     END-EXEC.                                                    10370010
103800                                                                  10380010
103900     EVALUATE TRUE                                                10390010
104000         WHEN SQLCODE = +0                                        10400010
104100         WHEN SQLCODE = -811                                      10410010
104200              MOVE SUT00028-SHIPT-UNT-ID TO PV-DISPLAY-CARTON     10420010
104300              DISPLAY 'EXAMPLE OUTBOUND CARTON:  '                10430010
104400                      PV-DISPLAY-CARTON                           10440010
104500              SET PS-OB-CART-ACTIVITY-FOUND TO TRUE               10450010
104600              SET PS-DATA-ISSUE-FOUND TO TRUE                     10460010
104700         WHEN SQLCODE = +100                                      10470010
104800              SET PS-NO-OB-CART-ACTIVITY TO TRUE                  10480010
104900         WHEN OTHER                                               10490010
105000             MOVE '5400-CHECK-OUTBOUND-ACTIVITY'                  10500010
105100                                    TO PV-PARAGRAPH               10510010
105200             MOVE 'SELECT OUTBOUND CARTON' TO PV-DB2-FUNCTION     10520010
105300             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   10530010
105400             DISPLAY '5400-CHECK-OUTBOUND-ACTIVITY SQLCODE:  '    10540010
105500                     PV-DISPLAY-SQLCODE                           10550010
105600             PERFORM 9900-DB2-ABEND                               10560010
105700     END-EVALUATE.                                                10570010
105800                                                                  10580010
105900                                                                  10590010
106000 5500-CHECK-REPURPOSE-IND.                                        10600010
106100                                                                  10610010
106200     IF  WS-IR-DC-REPURPOSE-IND = 'Y'                             10620010
106300     OR  WS-IR-DC-REPURPOSE-IND = 'N'                             10630010
106400     OR  WS-IR-DC-REPURPOSE-IND = ' '                             10640010
106500         NEXT SENTENCE                                            10650010
106600     ELSE                                                         10660010
106700         DISPLAY 'INVALID DC REPURPOSE INDICATOR VALUE: '         10670010
106800                 WS-IR-DC-REPURPOSE-IND                           10680010
106900         SET PS-DATA-ISSUE-FOUND TO TRUE                          10690010
106910         SET PS-REPURPOSE-ISSUE TO TRUE                           10691010
106920     END-IF.                                                      10692010
106930                                                                  10693010
106940     IF  PS-REPURPOSE-ISSUE                                       10694010
106950         NEXT SENTENCE                                            10695010
106960     ELSE                                                         10696010
106970         IF  WS-IR-DC-REPURPOSE-IND = 'Y'                         10697010
106980             PERFORM 5600-CHECK-DC-REPURP                         10698010
106990         ELSE                                                     10699010
106991             NEXT SENTENCE                                        10699110
106992         END-IF                                                   10699210
106993     END-IF.                                                      10699310
106994                                                                  10699410
106995     IF  PS-REPURPOSE-ISSUE                                       10699510
106996         NEXT SENTENCE                                            10699610
106997     ELSE                                                         10699710
106998         IF  WS-IR-DC-REPURPOSE-IND = 'Y'                         10699810
106999             PERFORM 5700-CHECK-PACKAGE-TYPE                      10699910
107000             IF  PS-PACKAGE-TYPE-FOUND                            10700010
107001                 IF  RECEIV-PKGNG-CDE = 'M'                       10700110
107002                 OR  RECEIV-PKGNG-CDE = ' '                       10700210
107003                     NEXT SENTENCE                                10700310
107004                 ELSE                                             10700410
107005                     DISPLAY 'RECEIVER IS A BULK SO REPURPOSE'    10700510
107006                             ' WILL NOT BE DONE FOR PO/RCVR: '    10700610
107007                             WS-IR-PO-NBR '-' WS-IR-RCVR-NBR      10700710
107008                     SET PS-DATA-ISSUE-FOUND TO TRUE              10700810
107009                     SET PS-REPURPOSE-ISSUE TO TRUE               10700910
107010                 END-IF                                           10701010
107011             ELSE                                                 10701110
107012                 DISPLAY 'COULD NOT FIND PO/RECEIVER ON PO OR'    10701210
107013                         ' RECEIVER TABLE: '                      10701310
107014                         WS-IR-PO-NBR '-' WS-IR-RCVR-NBR          10701410
107015                 SET PS-DATA-ISSUE-FOUND TO TRUE                  10701510
107016                 SET PS-REPURPOSE-ISSUE TO TRUE                   10701610
107017             END-IF                                               10701710
107018         ELSE                                                     10701810
107019             NEXT SENTENCE                                        10701910
107020         END-IF                                                   10702010
107021     END-IF.                                                      10702110
107022                                                                  10702210
107023                                                                  10702310
107024 5600-CHECK-DC-REPURP.                                            10702410
107025                                                                  10702510
107026     SET PS-LOC-NOT-FOUND TO TRUE.                                10702610
107027     MOVE WS-IR-CURR-OPER-CHG-TO TO DK-LOC-NBR.                   10702710
107028     PERFORM 2620-SELECT-XLT-LOC.                                 10702810
107029                                                                  10702910
107030     IF  PS-LOC-FOUND                                             10703010
107031         IF  XLT00010-LOC-TYP-CDE = 'DC'                          10703110
107032         AND XLT00010-E-BUS-IND   = 'N'                           10703210
107033             NEXT SENTENCE                                        10703310
107034         ELSE                                                     10703410
107035             SET PS-DATA-ISSUE-FOUND TO TRUE                      10703510
107036             SET PS-REPURPOSE-ISSUE TO TRUE                       10703610
107037             DISPLAY '5600-CHECK-DC-REPURP - CURR OPER UNIT'      10703710
107038                     ' NOT A RETAIL DC: '                         10703810
107039                     WS-IR-CURR-OPER-CHG-TO                       10703910
107040             DISPLAY 'CURR OPER: '                                10704010
107041                     WS-IR-CURR-OPER-CHG-TO                       10704110
107042                     ' XLT_LOC TYPE CODE: '                       10704210
107043                     XLT00010-LOC-TYP-CDE                         10704310
107044                     ' XLT_LOC E BUS IND: '                       10704410
107045                     XLT00010-E-BUS-IND                           10704510
107046         END-IF                                                   10704610
107047     ELSE                                                         10704710
107048         SET PS-DATA-ISSUE-FOUND TO TRUE                          10704810
107049         SET PS-REPURPOSE-ISSUE TO TRUE                           10704910
107050         DISPLAY '5600-CHECK-DC-REPURP - CURR OPER UNIT'          10705010
107051                 ' NOT FOUND:  '                                  10705110
107052                 WS-IR-CURR-OPER-CHG-TO                           10705210
107053     END-IF.                                                      10705310
107054                                                                  10705410
107055     IF  PS-REPURPOSE-ISSUE                                       10705510
107056         NEXT SENTENCE                                            10705610
107057     ELSE                                                         10705710
107058         PERFORM 5610-CHECK-WST-EFCREPURP                         10705810
107059         IF  PV-REPURP-COUNT = 0                                  10705910
107060             SET PS-DATA-ISSUE-FOUND TO TRUE                      10706010
107061             SET PS-REPURPOSE-ISSUE TO TRUE                       10706110
107062             DISPLAY '5600-CHECK-DC-REPURP - DC/EFC COMBO'        10706210
107063                     ' NOT SET UP FOR REPURPOSE FOR'              10706310
107064                     ' WST PARM: EFCREPURP'                       10706410
107065             DISPLAY 'CURR DC OPER: '                             10706510
107066                     WS-IR-CURR-OPER-CHG-TO                       10706610
107067                     ' - EFC OPER: '                              10706710
107068                     WS-IR-OPER-CHG-TO                            10706810
107069         ELSE                                                     10706910
107070             NEXT SENTENCE                                        10707010
107071     END-IF.                                                      10707110
107072                                                                  10707210
107073                                                                  10707310
107074 5610-CHECK-WST-EFCREPURP.                                        10707410
107075                                                                  10707510
107076     MOVE WS-IR-OPER-CHG-TO       TO DK-OPER-UNT-ID.              10707610
107077     MOVE WS-IR-CURR-OPER-CHG-TO  TO DK-CURR-OPER-UNT-ID.         10707710
107078     MOVE ZERO                    TO PV-REPURP-COUNT.             10707810
107079                                                                  10707910
107080     EXEC SQL                                                     10708010
107081        SELECT   COUNT(*)                                         10708110
107082          INTO :PV-REPURP-COUNT                                   10708210
107083          FROM                                                    10708310
107084                wST_INTGRTN_TYP  A                                10708410
107085             ,  wST_ATTR_DEFN    B                                10708510
107086             ,  WST_ATTR_ELEM    C                                10708610
107087             ,  WST_ATTR_ELEM    D                                10708710
107088             ,  WST_ATTR_ELEM    E                                10708810
107089             ,  WST_ATTR_ELEM    F                                10708910
107090             ,  WST_ATTR_ELEM    G                                10709010
107091          WHERE                                                   10709110
107092                A.INTGRTN_TYP_CDE   = 'EFCREPURP'                 10709210
107093            AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE           10709310
107094            AND B.ATTR_DEFN_SEQ_NBR = 1                           10709410
107095            AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE           10709510
107096            AND C.ATTR_DEFN_SEQ_NBR = 1                           10709610
107097            AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE           10709710
107098            AND D.ATTR_DEFN_SEQ_NBR = 2                           10709810
107099            AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE           10709910
107100            AND E.ATTR_DEFN_SEQ_NBR = 3                           10710010
107101            AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE           10710110
107102            AND F.ATTR_DEFN_SEQ_NBR = 4                           10710210
107103            AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE           10710310
107104            AND G.ATTR_DEFN_SEQ_NBR = 5                           10710410
107105            AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR         10710510
107106            AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR         10710610
107107            AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR         10710710
107108            AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR         10710810
107109            AND C.ATTR_ELEM_NBR     = :DK-CURR-OPER-UNT-ID        10710910
107110            AND D.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID             10711010
107111            AND E.ATTR_ELEM_TXT     = 'Y'                         10711110
107112            AND F.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP           10711210
107113         AND G.ATTR_ELEM_TMST = '9999-09-09-23.59.59.999999'      10711310
107114        FETCH FIRST 1 ROW ONLY                                    10711410
107115         WITH UR                                                  10711510
107116     END-EXEC.                                                    10711610
107117                                                                  10711710
107118     EVALUATE TRUE                                                10711810
107119         WHEN SQLCODE = +0                                        10711910
107120         WHEN SQLCODE = -811                                      10712010
107121         WHEN SQLCODE = +100                                      10712110
107122              CONTINUE                                            10712210
107123         WHEN OTHER                                               10712310
107124             MOVE '5610-CHECK-WST-EFCREPURP'                      10712410
107125                                    TO PV-PARAGRAPH               10712510
107126             MOVE 'SELECT WST PARM EFCREPURP' TO PV-DB2-FUNCTION  10712610
107127             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   10712710
107128             DISPLAY '5610-CHECK-WST-EFCREPURP SQLCODE:  '        10712810
107129                     PV-DISPLAY-SQLCODE                           10712910
107130             PERFORM 9900-DB2-ABEND                               10713010
107131     END-EVALUATE.                                                10713110
107132                                                                  10713210
107133                                                                  10713310
107134 5700-CHECK-PACKAGE-TYPE.                                         10713410
107135                                                                  10713510
107136     SET PS-PACKAGE-TYPE-FOUND   TO TRUE.                         10713610
107137     MOVE WS-IR-PO-NBR           TO RECEIV-ORD-NBR.               10713710
107138     MOVE WS-IR-RCVR-NBR         TO RECEIV-REC-SEQ-NBR.           10713810
107139                                                                  10713910
107140     EXEC SQL                                                     10714010
107141        SELECT A.PKGNG_CDE                                        10714110
107142             , B.PKGNG_CDE                                        10714210
107143             , B.DEPT_NBR                                         10714310
107144             , B.ENT_ID                                           10714410
107145          INTO :RECEIV-PKGNG-CDE                                  10714510
107146             , :PURCHS-PKGNG-CDE                                  10714610
107147             , :PURCHS-DEPT-NBR                                   10714710
107148             , :PURCHS-ENT-ID                                     10714810
107149          FROM TRECEIV A                                          10714910
107150             , TPURCHS B                                          10715010
107151        WHERE A.ORD_NBR          = :RECEIV-ORD-NBR                10715110
107152          AND A.REC_SEQ_NBR      = :RECEIV-REC-SEQ-NBR            10715210
107153          AND NOT A.STATUS_CDE   = 'DE'                           10715310
107154          AND B.PO_NBR           = A.ORD_NBR                      10715410
107155          AND B.VER_STATUS_CDE   = 'A'                            10715510
107156     END-EXEC.                                                    10715610
107157                                                                  10715710
107158     EVALUATE TRUE                                                10715810
107159         WHEN SQLCODE = +0                                        10715910
107160         WHEN SQLCODE = -811                                      10716010
107161              SET PS-PACKAGE-TYPE-FOUND TO TRUE                   10716110
107162         WHEN SQLCODE = +100                                      10716210
107163              SET PS-PACKAGE-TYPE-NOT-FOUND TO TRUE               10716310
107164         WHEN OTHER                                               10716410
107165             MOVE '5700-CHECK-PACKAGE-TYPE'                       10716510
107166                                    TO PV-PARAGRAPH               10716610
107167             MOVE 'SELECT TRECEIV/TPURCHS' TO PV-DB2-FUNCTION     10716710
107168             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   10716810
107169             DISPLAY '5700-CHECK-PACKAGE-TYPE SQLCODE:  '         10716910
107170                     PV-DISPLAY-SQLCODE                           10717010
107171             PERFORM 9900-DB2-ABEND                               10717110
107172     END-EVALUATE.                                                10717210
107173                                                                  10717310
107174                                                                  10717410
107175 6000-PROCESS-REPURP-TROUBLE.                                     10717510
107176                                                                  10717610
107177     MOVE WS-IR-PO-NBR      TO TRBNTF-PO-NBR.                     10717710
107178     MOVE WS-IR-RCVR-NBR    TO TRBNTF-REC-SEQ-NBR.                10717810
107179                                                                  10717910
107180     SET PS-TRBL-379-NOT-FOUND TO TRUE.                           10718010
107181     PERFORM 6100-CHECK-379-TRBL.                                 10718110
107182                                                                  10718210
107183     SET PS-TRBL-405-NOT-FOUND TO TRUE.                           10718310
107184     PERFORM 6200-CHECK-405-TRBL.                                 10718410
107185                                                                  10718510
107186     IF  PS-TRBL-379-NOT-FOUND                                    10718610
107187     OR  PS-TRBL-405-NOT-FOUND                                    10718710
107188         PERFORM 6300-INSERT-TROUBLE                              10718810
107189     END-IF.                                                      10718910
107190                                                                  10719010
107200 6100-CHECK-379-TRBL.                                             10720010
107201                                                                  10720110
107202     EXEC SQL                                                     10720210
107203        SELECT RESOLVED_IND                                       10720310
107204             , RESOLVED_TMST                                      10720410
107205             , RESOLVED_UID                                       10720510
107206          INTO :TRBNTF-RESOLVED-IND                               10720610
107207             , :TRBNTF-RESOLVED-TMST                              10720710
107208             , :TRBNTF-RESOLVED-UID                               10720810
107209          FROM TTRBNTF                                            10720910
107210        WHERE PO_NBR             = :TRBNTF-PO-NBR                 10721010
107211          AND REC_SEQ_NBR        = :TRBNTF-REC-SEQ-NBR            10721110
107212          AND TRBL_RSN_CDE       = 379                            10721210
107213          AND RESOLVED_IND       = 'N'                            10721310
107214     END-EXEC.                                                    10721410
107215                                                                  10721510
107216     EVALUATE TRUE                                                10721610
107217         WHEN SQLCODE = +0                                        10721710
107218         WHEN SQLCODE = -811                                      10721810
107219              SET PS-TRBL-379-FOUND TO TRUE                       10721910
107220              DISPLAY 'ACTIVE 379 TROUBLE EXISTS FOR RECEIVER: '  10722010
107221                      WS-IR-PO-NBR '-' WS-IR-RCVR-NBR             10722110
107222         WHEN SQLCODE = +100                                      10722210
107223              SET PS-TRBL-379-NOT-FOUND TO TRUE                   10722310
107224         WHEN OTHER                                               10722410
107225             MOVE '6100-CHECK-379-TRBL'                           10722510
107226                                    TO PV-PARAGRAPH               10722610
107227             MOVE 'SELECT TTRBNTF 379' TO PV-DB2-FUNCTION         10722710
107228             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   10722810
107229             DISPLAY '6100-CHECK-379-TRBL SQLCODE:  '             10722910
107230                     PV-DISPLAY-SQLCODE                           10723010
107231             PERFORM 9900-DB2-ABEND                               10723110
107232     END-EVALUATE.                                                10723210
107233                                                                  10723310
107234                                                                  10723410
107235 6200-CHECK-405-TRBL.                                             10723510
107236                                                                  10723610
107237     EXEC SQL                                                     10723710
107238        SELECT RESOLVED_IND                                       10723810
107239             , RESOLVED_TMST                                      10723910
107240             , RESOLVED_UID                                       10724010
107241          INTO :TRBNTF-RESOLVED-IND                               10724110
107242             , :TRBNTF-RESOLVED-TMST                              10724210
107243             , :TRBNTF-RESOLVED-UID                               10724310
107244          FROM TTRBNTF                                            10724410
107245        WHERE PO_NBR             = :TRBNTF-PO-NBR                 10724510
107246          AND REC_SEQ_NBR        = :TRBNTF-REC-SEQ-NBR            10724610
107247          AND TRBL_RSN_CDE       = 405                            10724710
107248          AND RESOLVED_IND       = 'N'                            10724810
107249     END-EXEC.                                                    10724910
107250                                                                  10725010
107251     EVALUATE TRUE                                                10725110
107252         WHEN SQLCODE = +0                                        10725210
107253         WHEN SQLCODE = -811                                      10725310
107254              SET PS-TRBL-405-FOUND TO TRUE                       10725410
107255              DISPLAY 'ACTIVE 405 TROUBLE EXISTS FOR RECEIVER: '  10725510
107256                      WS-IR-PO-NBR '-' WS-IR-RCVR-NBR             10725610
107257         WHEN SQLCODE = +100                                      10725710
107258              SET PS-TRBL-405-NOT-FOUND TO TRUE                   10725810
107259         WHEN OTHER                                               10725910
107260             MOVE '6200-CHECK-405-TRBL'                           10726010
107261                                    TO PV-PARAGRAPH               10726110
107262             MOVE 'SELECT TTRBNTF 405' TO PV-DB2-FUNCTION         10726210
107263             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   10726310
107264             DISPLAY '6200-CHECK-405-TRBL SQLCODE:  '             10726410
107265                     PV-DISPLAY-SQLCODE                           10726510
107266             PERFORM 9900-DB2-ABEND                               10726610
107267     END-EVALUATE.                                                10726710
107268                                                                  10726810
107269                                                                  10726910
107270 6300-INSERT-TROUBLE.                                             10727010
107271                                                                  10727110
107272     IF  PS-TRBL-379-NOT-FOUND                                    10727210
107273         PERFORM 8000-GET-RANDOM-NBR                              10727310
107274         MOVE DP902-RANDOM-NUMBER   TO TRBNTF-NOTIF-NBR           10727410
107275         MOVE WS-IR-OPER-CHG-TO     TO TRBNTF-OPER-UNT-ID         10727510
107276         MOVE 1                     TO TRBNTF-FCLTY-ID            10727610
107277         MOVE WS-IR-PO-NBR          TO TRBNTF-PO-NBR              10727710
107278         MOVE WS-IR-RCVR-NBR        TO TRBNTF-REC-SEQ-NBR         10727810
107279         MOVE 379                   TO TRBNTF-TRBL-RSN-CDE        10727910
107280         MOVE PURCHS-DEPT-NBR       TO TRBNTF-DEPT-NBR            10728010
107281         MOVE PURCHS-ENT-ID         TO TRBNTF-ENT-ID              10728110
107282         MOVE PC-CURRENT-PROGRAM-NAME                             10728210
107283                                    TO TRBNTF-NOTIF-UID           10728310
107284         MOVE 'N'                   TO TRBNTF-RESOLVED-IND        10728410
107285         MOVE '9999-09-09-09.09.09.999999'                        10728510
107286                                    TO TRBNTF-RESOLVED-TMST       10728610
107287                                       TRBNTF-ACKNOWLG-TMST       10728710
107288                                       TRBNTF-LAST-DTL-CRE-TMST   10728810
107289                                       TRBNTF-RTV-RESPONSE-TMST   10728910
107290         MOVE ZEROS                 TO TRBNTF-PO-LNE-NBR          10729010
107291                                       TRBNTF-CNTCT-EXT           10729110
107292                                       TRBNTF-SHIPT-ID            10729210
107293                                       TRBNTF-PKSL-SEQ-NBR        10729310
107294                                       TRBNTF-PKSL-LNE-NBR        10729410
107295                                       TRBNTF-WORK-ORD-SEQ-NBR    10729510
107296                                       TRBNTF-WO-INSTR-SEQ-NBR    10729610
107297                                       TRBNTF-OVER-SHT-PCT        10729710
107298                                       TRBNTF-PO-VER-NBR          10729810
107299                                       TRBNTF-PO-LNE-VER-NBR      10729910
107300                                       TRBNTF-PLN-SHIP-VER-NBR    10730010
107301                                       TRBNTF-ERLY-LTE-DAY-QTY    10730110
107302                                       TRBNTF-INITR-ID            10730210
107303                                       TRBNTF-RSPNB-RSLU-ID       10730310
107304                                       TRBNTF-PFMC-TRKG-ID        10730410
107305                                       TRBNTF-INITR-ENT-ID        10730510
107306                                       TRBNTF-PREPK-ID            10730610
107307         MOVE SPACES                TO TRBNTF-RESOLVED-UID        10730710
107308                                       TRBNTF-ACKNOWLG-UID        10730810
107309                                       TRBNTF-FCLTY-AREA-ID       10730910
107310                                       TRBNTF-CRE-IND             10731010
107311                                       TRBNTF-PRORATE-IND         10731110
107312                                       TRBNTF-RTV-IND             10731210
107313                                       TRBNTF-ACTVY-RSLU-CDE      10731310
107314                                       TRBNTF-FOB-CDE             10731410
107315                                       TRBNTF-POE-CDE             10731510
107316         PERFORM 6400-INSERT-379-TRBL                             10731610
107317     END-IF.                                                      10731710
107318                                                                  10731810
107319     IF  PS-TRBL-405-NOT-FOUND                                    10731910
107320         PERFORM 8000-GET-RANDOM-NBR                              10732010
107321         MOVE DP902-RANDOM-NUMBER   TO TRBNTF-NOTIF-NBR           10732110
107322         MOVE WS-IR-OPER-CHG-TO     TO TRBNTF-OPER-UNT-ID         10732210
107323         MOVE 1                     TO TRBNTF-FCLTY-ID            10732310
107324         MOVE WS-IR-PO-NBR          TO TRBNTF-PO-NBR              10732410
107325         MOVE WS-IR-RCVR-NBR        TO TRBNTF-REC-SEQ-NBR         10732510
107326         MOVE 405                   TO TRBNTF-TRBL-RSN-CDE        10732610
107327         MOVE PURCHS-DEPT-NBR       TO TRBNTF-DEPT-NBR            10732710
107328         MOVE PURCHS-ENT-ID         TO TRBNTF-ENT-ID              10732810
107329         MOVE PC-CURRENT-PROGRAM-NAME                             10732910
107330                                    TO TRBNTF-NOTIF-UID           10733010
107331         MOVE 'N'                   TO TRBNTF-RESOLVED-IND        10733110
107332         MOVE '9999-09-09-09.09.09.999999'                        10733210
107333                                    TO TRBNTF-RESOLVED-TMST       10733310
107334                                       TRBNTF-ACKNOWLG-TMST       10733410
107335                                       TRBNTF-LAST-DTL-CRE-TMST   10733510
107336                                       TRBNTF-RTV-RESPONSE-TMST   10733610
107337         MOVE ZEROS                 TO TRBNTF-PO-LNE-NBR          10733710
107338                                       TRBNTF-CNTCT-EXT           10733810
107339                                       TRBNTF-SHIPT-ID            10733910
107340                                       TRBNTF-PKSL-SEQ-NBR        10734010
107341                                       TRBNTF-PKSL-LNE-NBR        10734110
107342                                       TRBNTF-WORK-ORD-SEQ-NBR    10734210
107343                                       TRBNTF-WO-INSTR-SEQ-NBR    10734310
107344                                       TRBNTF-OVER-SHT-PCT        10734410
107345                                       TRBNTF-PO-VER-NBR          10734510
107346                                       TRBNTF-PO-LNE-VER-NBR      10734610
107347                                       TRBNTF-PLN-SHIP-VER-NBR    10734710
107348                                       TRBNTF-ERLY-LTE-DAY-QTY    10734810
107349                                       TRBNTF-INITR-ID            10734910
107350                                       TRBNTF-RSPNB-RSLU-ID       10735010
107351                                       TRBNTF-PFMC-TRKG-ID        10735110
107352                                       TRBNTF-INITR-ENT-ID        10735210
107353                                       TRBNTF-PREPK-ID            10735310
107354         MOVE SPACES                TO TRBNTF-RESOLVED-UID        10735410
107355                                       TRBNTF-ACKNOWLG-UID        10735510
107356                                       TRBNTF-FCLTY-AREA-ID       10735610
107357                                       TRBNTF-CRE-IND             10735710
107358                                       TRBNTF-PRORATE-IND         10735810
107359                                       TRBNTF-RTV-IND             10735910
107360                                       TRBNTF-ACTVY-RSLU-CDE      10736010
107361                                       TRBNTF-FOB-CDE             10736110
107362                                       TRBNTF-POE-CDE             10736210
107363         PERFORM 6500-INSERT-405-TRBL                             10736310
107364     END-IF.                                                      10736410
107365                                                                  10736510
107366 6400-INSERT-379-TRBL.                                            10736610
107367                                                                  10736710
107368     PERFORM WITH TEST AFTER                                      10736810
107369         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     10736910
107370         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR               10737010
107371         SQLCODE = ZERO OR PS-DONE                                10737110
107372         EXEC SQL                                                 10737210
107373              INSERT INTO TTRBNTF                                 10737310
107374                     (NOTIF_NBR                                   10737410
107375                   ,  OPER_UNT_ID                                 10737510
107376                   ,  FCLTY_ID                                    10737610
107377                   ,  DEPT_NBR                                    10737710
107378                   ,  ENT_ID                                      10737810
107379                   ,  PO_NBR                                      10737910
107380                   ,  PO_LNE_NBR                                  10738010
107381                   ,  REC_SEQ_NBR                                 10738110
107382                   ,  TRBL_RSN_CDE                                10738210
107383                   ,  NOTIF_TMST                                  10738310
107384                   ,  NOTIF_UID                                   10738410
107385                   ,  RESOLVED_IND                                10738510
107386                   ,  RESOLVED_TMST                               10738610
107387                   ,  RESOLVED_UID                                10738710
107388                   ,  ACKNOWLG_TMST                               10738810
107389                   ,  ACKNOWLG_UID                                10738910
107390                   ,  CNTCT_EXT                                   10739010
107391                   ,  FCLTY_AREA_ID                               10739110
107392                   ,  SHIPT_ID                                    10739210
107393                   ,  PKSL_SEQ_NBR                                10739310
107394                   ,  PKSL_LNE_NBR                                10739410
107395                   ,  WORK_ORD_SEQ_NBR                            10739510
107396                   ,  WO_INSTR_SEQ_NBR                            10739610
107397                   ,  OVER_SHT_PCT                                10739710
107398                   ,  LAST_DTL_CRE_TMST                           10739810
107399                   ,  CRE_IND                                     10739910
107400                   ,  PRORATE_IND                                 10740010
107401                   ,  RTV_IND                                     10740110
107402                   ,  RTV_RESPONSE_TMST                           10740210
107403                   ,  PREPK_ID)                                   10740310
107404              VALUES (:TRBNTF-NOTIF-NBR                           10740410
107405                   ,  :TRBNTF-OPER-UNT-ID                         10740510
107406                   ,  :TRBNTF-FCLTY-ID                            10740610
107407                   ,  :TRBNTF-DEPT-NBR                            10740710
107408                   ,  :TRBNTF-ENT-ID                              10740810
107409                   ,  :TRBNTF-PO-NBR                              10740910
107410                   ,  :TRBNTF-PO-LNE-NBR                          10741010
107411                   ,  :TRBNTF-REC-SEQ-NBR                         10741110
107412                   ,  :TRBNTF-TRBL-RSN-CDE                        10741210
107413                   ,  CURRENT TIMESTAMP                           10741310
107414                   ,  :TRBNTF-NOTIF-UID                           10741410
107415                   ,  :TRBNTF-RESOLVED-IND                        10741510
107416                   ,  :TRBNTF-RESOLVED-TMST                       10741610
107417                   ,  :TRBNTF-RESOLVED-UID                        10741710
107418                   ,  :TRBNTF-ACKNOWLG-TMST                       10741810
107419                   ,  :TRBNTF-ACKNOWLG-UID                        10741910
107420                   ,  :TRBNTF-CNTCT-EXT                           10742010
107421                   ,  :TRBNTF-FCLTY-AREA-ID                       10742110
107422                   ,  :TRBNTF-SHIPT-ID                            10742210
107423                   ,  :TRBNTF-PKSL-SEQ-NBR                        10742310
107424                   ,  :TRBNTF-PKSL-LNE-NBR                        10742410
107425                   ,  :TRBNTF-WORK-ORD-SEQ-NBR                    10742510
107426                   ,  :TRBNTF-WO-INSTR-SEQ-NBR                    10742610
107427                   ,  :TRBNTF-OVER-SHT-PCT                        10742710
107428                   ,  :TRBNTF-LAST-DTL-CRE-TMST                   10742810
107429                   ,  :TRBNTF-CRE-IND                             10742910
107430                   ,  :TRBNTF-PRORATE-IND                         10743010
107431                   ,  :TRBNTF-RTV-IND                             10743110
107432                   ,  :TRBNTF-RTV-RESPONSE-TMST                   10743210
107433                   ,  :TRBNTF-PREPK-ID)                           10743310
107434         END-EXEC                                                 10743410
107435                                                                  10743510
107436     EVALUATE TRUE                                                10743610
107437         WHEN SQLCODE = ZERO                                      10743710
107438             DISPLAY '379 TROUBLE ADDED'                          10743810
107439         WHEN SQLCODE = -803                                      10743910
107440             PERFORM 8000-GET-RANDOM-NBR                          10744010
107441             MOVE DP902-RANDOM-NUMBER   TO TRBNTF-NOTIF-NBR       10744110
107442         WHEN OTHER                                               10744210
107443             SET  PS-DONE             TO TRUE                     10744310
107444             MOVE '6400-INSERT-379-TRBL'                          10744410
107445                                    TO PV-PARAGRAPH               10744510
107446             MOVE 'INSERT TTRBNTF 379' TO PV-DB2-FUNCTION         10744610
107447             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   10744710
107448             DISPLAY '6400-INSERT-379-TRBL SQLCODE:  '            10744810
107449                     PV-DISPLAY-SQLCODE                           10744910
107450             PERFORM 9900-DB2-ABEND                               10745010
107451     END-EVALUATE                                                 10745110
107452     END-PERFORM.                                                 10745210
107453                                                                  10745310
107454     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     10745410
107455               SQLCODE NOT = ZERO                                 10745510
107456         SET  PS-DONE             TO TRUE                         10745610
107457         MOVE '6400-INSERT-379-TRBL'                              10745710
107458                                 TO PV-PARAGRAPH                  10745810
107459         MOVE 'INSERT TTRBNTF 379 MAX RETRY' TO PV-DB2-FUNCTION   10745910
107460         MOVE SQLCODE TO PV-DISPLAY-SQLCODE                       10746010
107461         DISPLAY '** MAX RETRIES ON 379 TROUBLE INSERT **'        10746110
107462         DISPLAY '6400-INSERT-379-TRBL SQLCODE:  '                10746210
107463                 PV-DISPLAY-SQLCODE                               10746310
107464         PERFORM 9900-DB2-ABEND                                   10746410
107465     END-IF.                                                      10746510
107466                                                                  10746610
107467                                                                  10746710
107468 6500-INSERT-405-TRBL.                                            10746810
107469                                                                  10746910
107470     PERFORM WITH TEST AFTER                                      10747010
107471         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     10747110
107472         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR               10747210
107473         SQLCODE = ZERO OR PS-DONE                                10747310
107474         EXEC SQL                                                 10747410
107475              INSERT INTO TTRBNTF                                 10747510
107476                     (NOTIF_NBR                                   10747610
107477                   ,  OPER_UNT_ID                                 10747710
107478                   ,  FCLTY_ID                                    10747810
107479                   ,  DEPT_NBR                                    10747910
107480                   ,  ENT_ID                                      10748010
107481                   ,  PO_NBR                                      10748110
107482                   ,  PO_LNE_NBR                                  10748210
107483                   ,  REC_SEQ_NBR                                 10748310
107484                   ,  TRBL_RSN_CDE                                10748410
107485                   ,  NOTIF_TMST                                  10748510
107486                   ,  NOTIF_UID                                   10748610
107487                   ,  RESOLVED_IND                                10748710
107488                   ,  RESOLVED_TMST                               10748810
107489                   ,  RESOLVED_UID                                10748910
107490                   ,  ACKNOWLG_TMST                               10749010
107491                   ,  ACKNOWLG_UID                                10749110
107492                   ,  CNTCT_EXT                                   10749210
107493                   ,  FCLTY_AREA_ID                               10749310
107494                   ,  SHIPT_ID                                    10749410
107495                   ,  PKSL_SEQ_NBR                                10749510
107496                   ,  PKSL_LNE_NBR                                10749610
107497                   ,  WORK_ORD_SEQ_NBR                            10749710
107498                   ,  WO_INSTR_SEQ_NBR                            10749810
107499                   ,  OVER_SHT_PCT                                10749910
107500                   ,  LAST_DTL_CRE_TMST                           10750010
107501                   ,  CRE_IND                                     10750110
107502                   ,  PRORATE_IND                                 10750210
107503                   ,  RTV_IND                                     10750310
107504                   ,  RTV_RESPONSE_TMST                           10750410
107505                   ,  PREPK_ID)                                   10750510
107506              VALUES (:TRBNTF-NOTIF-NBR                           10750610
107507                   ,  :TRBNTF-OPER-UNT-ID                         10750710
107508                   ,  :TRBNTF-FCLTY-ID                            10750810
107509                   ,  :TRBNTF-DEPT-NBR                            10750910
107510                   ,  :TRBNTF-ENT-ID                              10751010
107511                   ,  :TRBNTF-PO-NBR                              10751110
107512                   ,  :TRBNTF-PO-LNE-NBR                          10751210
107513                   ,  :TRBNTF-REC-SEQ-NBR                         10751310
107514                   ,  :TRBNTF-TRBL-RSN-CDE                        10751410
107515                   ,  CURRENT TIMESTAMP                           10751510
107516                   ,  :TRBNTF-NOTIF-UID                           10751610
107517                   ,  :TRBNTF-RESOLVED-IND                        10751710
107518                   ,  :TRBNTF-RESOLVED-TMST                       10751810
107519                   ,  :TRBNTF-RESOLVED-UID                        10751910
107520                   ,  :TRBNTF-ACKNOWLG-TMST                       10752010
107521                   ,  :TRBNTF-ACKNOWLG-UID                        10752110
107522                   ,  :TRBNTF-CNTCT-EXT                           10752210
107523                   ,  :TRBNTF-FCLTY-AREA-ID                       10752310
107524                   ,  :TRBNTF-SHIPT-ID                            10752410
107525                   ,  :TRBNTF-PKSL-SEQ-NBR                        10752510
107526                   ,  :TRBNTF-PKSL-LNE-NBR                        10752610
107527                   ,  :TRBNTF-WORK-ORD-SEQ-NBR                    10752710
107528                   ,  :TRBNTF-WO-INSTR-SEQ-NBR                    10752810
107529                   ,  :TRBNTF-OVER-SHT-PCT                        10752910
107530                   ,  :TRBNTF-LAST-DTL-CRE-TMST                   10753010
107531                   ,  :TRBNTF-CRE-IND                             10753110
107532                   ,  :TRBNTF-PRORATE-IND                         10753210
107533                   ,  :TRBNTF-RTV-IND                             10753310
107534                   ,  :TRBNTF-RTV-RESPONSE-TMST                   10753410
107535                   ,  :TRBNTF-PREPK-ID)                           10753510
107536         END-EXEC                                                 10753610
107537                                                                  10753710
107538     EVALUATE TRUE                                                10753810
107539         WHEN SQLCODE = ZERO                                      10753910
107540             DISPLAY '405 TROUBLE ADDED'                          10754010
107541         WHEN SQLCODE = -803                                      10754110
107542             PERFORM 8000-GET-RANDOM-NBR                          10754210
107543             MOVE DP902-RANDOM-NUMBER   TO TRBNTF-NOTIF-NBR       10754310
107544         WHEN OTHER                                               10754410
107545             SET  PS-DONE             TO TRUE                     10754510
107546             MOVE '6500-INSERT-405-TRBL'                          10754610
107547                                    TO PV-PARAGRAPH               10754710
107548             MOVE 'INSERT TTRBNTF 405' TO PV-DB2-FUNCTION         10754810
107549             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   10754910
107550             DISPLAY '6500-INSERT-405-TRBL SQLCODE:  '            10755010
107551                     PV-DISPLAY-SQLCODE                           10755110
107552             PERFORM 9900-DB2-ABEND                               10755210
107553     END-EVALUATE                                                 10755310
107554     END-PERFORM.                                                 10755410
107555                                                                  10755510
107556     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     10755610
107557               SQLCODE NOT = ZERO                                 10755710
107558         SET  PS-DONE             TO TRUE                         10755810
107559         MOVE '6500-INSERT-405-TRBL'                              10755910
107560                                 TO PV-PARAGRAPH                  10756010
107561         MOVE 'INSERT TTRBNTF 405 MAX RETRY' TO PV-DB2-FUNCTION   10756110
107562         MOVE SQLCODE TO PV-DISPLAY-SQLCODE                       10756210
107563         DISPLAY '** MAX RETRIES ON 379 TROUBLE INSERT **'        10756310
107564         DISPLAY '6500-INSERT-405-TRBL SQLCODE:  '                10756410
107565                 PV-DISPLAY-SQLCODE                               10756510
107566         PERFORM 9900-DB2-ABEND                                   10756610
107567     END-IF.                                                      10756710
107568                                                                  10756810
107569                                                                  10756910
107570 8000-GET-RANDOM-NBR.                                             10757010
107571                                                                  10757110
107572     CALL PC-RAND-PGM USING DP902-RANDNBR-ROUTINE-FIELDS.         10757210
107573                                                                  10757310
107574     IF DP902-SUCCESSFUL                                          10757410
107575         CONTINUE                                                 10757510
107576     ELSE                                                         10757610
107577         SET PS-DONE      TO TRUE                                 10757710
107578         DISPLAY '**************************************'         10757810
107579         DISPLAY '** UNSUCCESSFUL CALL TO RAND NBR PGM**'         10757910
107580         DISPLAY '**************************************'         10758010
107581         DISPLAY '** ABEND                            **'         10758110
107582         DISPLAY '** PROGRAM = DPKUT902               **'         10758210
107583         DISPLAY '** PARA = 8000-GET-RANDOM-NBR       **'         10758310
107584         DISPLAY '**************************************'         10758410
107585     END-IF.                                                      10758510
107586                                                                  10758610
107587                                                                  10758710
107588******************************************************************10758810
107589*    PERFORMS ABEND AFTER UNEXPECTED SQLCODE.                     10758910
107590******************************************************************10759010
107591 9900-DB2-ABEND.                                                  10759110
107592                                                                  10759210
107593     DISPLAY '** ABEND **'.                                       10759310
107594     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        10759410
107595     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   10759510
107596     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                10759610
107597                                                                  10759710
107598* ROUTINE TO DISPLAY ABEND IN READABLE FORMAT                     10759810
107599     COPY DPPD004.                                                10759910
107600                                                                  10760010
107700     EXEC SQL                                                     10770010
107800         ROLLBACK                                                 10780010
107900     END-EXEC.                                                    10790010
108000                                                                  10800010
108100     SET ABEND-4013-DB2-ERROR TO TRUE.                            10810010
108200     CALL 'ILBOABN0' USING ABEND-CODE.                            10820010
108300                                                                  10830010
