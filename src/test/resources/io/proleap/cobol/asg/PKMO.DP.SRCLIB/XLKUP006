000100 IDENTIFICATION DIVISION.                                         00010051
000200 PROGRAM-ID.    XLKUP006.                                         00020051
000300 AUTHOR.        JOE LAROSA.                                       00030051
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040051
000500 DATE-WRITTEN.  03/03/2003.                                       00050051
000600 DATE-COMPILED.                                                   00060051
000700******************************************************************00070051
000800* THIS PGM IS PART OF THE INTERFACING BETWEEN RMS PO & LEGACY PO. 00080051
000900******************************************************************00090051
001000* THIS DB2 PROGRAM IS CALLED TO PROCESS CERTAIN TYPES OF PO DATA  00100051
001100* PASSED FROM RMS.  THE PROGRAM INSERTS, UPDATES OR DELETES ROWS  00110051
001200* ON THE LEGACY TPLNSHP TABLE.                                    00120051
001300******************************************************************00130051
001400 ENVIRONMENT DIVISION.                                            00140051
001500 CONFIGURATION SECTION.                                           00150051
001600 SOURCE-COMPUTER.  IBM-3090.                                      00160051
001700 OBJECT-COMPUTER.  IBM-3090.                                      00170051
001800 DATA DIVISION.                                                   00180051
001900                                                                  00190051
002000 WORKING-STORAGE SECTION.                                         00200051
002100******************************************************************00210051
002200**PROGRAM SWITCHES                                                00220051
002300******************************************************************00230051
002400 01  PS-PROGRAM-SWITCHES.                                         00240051
002500     05  PS-PROCESS-CONTINUE-SW      PIC X(01)  VALUE 'Y'.        00250051
002600         88  PS-PROCESS-CONTINUE                VALUE 'Y'.        00260051
002700         88  PS-PROCESS-COMPLETE                VALUE 'N'.        00270051
002800     05  PS-TPLNSHP-EXISTS-SW        PIC X(01)  VALUE 'Y'.        00280059
002900         88  PS-PLNSHP-EXISTS-YES               VALUE 'Y'.        00290059
003000         88  PS-PLNSHP-EXISTS-NO                VALUE 'N'.        00300059
003100                                                                  00310051
003200******************************************************************00320051
003300**PROGRAM CONSTANTS                                               00330051
003400******************************************************************00340051
003500 01  PC-PROGRAM-CONSTANTS.                                        00350051
003600     05  PC-DEFAULT-DTE              PIC X(10)  VALUE             00360051
003700                                                    '0001-01-01'. 00370051
003800     05  PC-RETRY-MAX                PIC 9(01)  VALUE 5.          00380051
003900******************************************************************00390051
004000** NULL INDICATORS                                                00400051
004100******************************************************************00410051
004200 01  DN-DB2-NULL-INDICATORS.                                      00420051
004300     05  DN-SHIPT-POINT-TXT          PIC S9(04) VALUE +0          00430051
004400                                                 COMP.            00440051
004500     05  DN-FOB-POINT-TXT            PIC S9(04) VALUE +0          00450051
004600                                                 COMP.            00460051
004700                                                                  00470051
004800******************************************************************00480051
004900**SQL DATABASE KEYS                                               00490051
005000******************************************************************00500051
005100 01  DK-DATABASE-KEYS.                                            00510051
005200     05  DK-ENT-ID                   PIC S9(9)  COMP.             00520051
005300     05  DK-TERM-ID                  PIC S9(4)  COMP.             00530051
005400     05  DK-PO-NBR                   PIC S9(9)  COMP.             00540051
005500     05  DK-VER-NBR                  PIC S9(9)  COMP.             00550051
005600     05  DK-DEPT-NBR-4-NUM           PIC  9(4).                   00560051
005700     05  FILLER REDEFINES DK-DEPT-NBR-4-NUM.                      00570051
005800         10  FILLER                  PIC  X.                      00580051
005900         10  DK-DEPT-NBR-3-CH        PIC  X(3).                   00590051
006000                                                                  00600051
006100******************************************************************00610051
006200**PROGRAM VARIABLES                                               00620051
006300******************************************************************00630051
006400 01  PV-PROGRAM-VARIABLES.                                        00640051
006500     05  PV-MAX-SHIPT-NBR            PIC S9(9)  COMP.             00650051
006600                                                                  00660051
006700     05  PV-CURRENT-TMST             PIC X(26).                   00670051
006800     05  FILLER REDEFINES PV-CURRENT-TMST.                        00680051
006900         10  PV-CURR-TMST-DATE       PIC X(10).                   00690051
007000         10  PV-CURR-TMST-TIME       PIC X(16).                   00700051
007100                                                                  00710051
007200     05  PV-DATE-X08                 PIC X(08).                   00720051
007300     05  FILLER REDEFINES PV-DATE-X08.                            00730051
007400         10  PV-X08-CC               PIC 9(02).                   00740051
007500         10  PV-X08-YY               PIC 9(02).                   00750051
007600         10  PV-X08-MM               PIC 9(02).                   00760051
007700         10  PV-X08-DD               PIC 9(02).                   00770051
007800                                                                  00780051
007900     05  PV-DATE-X10                 PIC X(10).                   00790051
008000     05  FILLER REDEFINES PV-DATE-X10.                            00800051
008100         10  PV-X10-CC               PIC 9(02).                   00810051
008200         10  PV-X10-YY               PIC 9(02).                   00820051
008300         10  PV-X10-H1               PIC X(01).                   00830051
008400         10  PV-X10-MM               PIC 9(02).                   00840051
008500         10  PV-X10-H2               PIC X(01).                   00850051
008600         10  PV-X10-DD               PIC 9(02).                   00860051
008700                                                                  00870051
008800     05  PV-TIME-X16                 PIC X(16).                   00880051
008900     05  FILLER REDEFINES PV-TIME-X16.                            00890051
009000         10  PV-X16-H1               PIC X(01).                   00900051
009100         10  PV-X16-HH               PIC 9(02).                   00910051
009200         10  PV-X16-P1               PIC X(01).                   00920051
009300         10  PV-X16-MI               PIC 9(02).                   00930051
009400         10  PV-X16-P2               PIC X(01).                   00940051
009500         10  PV-X16-SS               PIC 9(02).                   00950051
009600         10  PV-X16-P3               PIC X(01).                   00960051
009700         10  PV-X16-999999           PIC 9(06).                   00970051
009800                                                                  00980051
009900     05  PV-TMST-X26.                                             00990051
010000         10  PV-X26-DATE             PIC X(10).                   01000051
010100         10  PV-X26-TIME             PIC X(16).                   01010051
010200                                                                  01020051
010300     05  PV-PLNSHP-MSG.                                           01030051
010400         10  FILLER                   PIC X(13) VALUE             01040051
010500             ' SHIPT_NBR = '.                                     01050051
010600         10  PV-MSG-SHIPT-NBR         PIC 9(09) VALUE ZERO.       01060051
010700         10  FILLER                   PIC X(11) VALUE             01070051
010800             ' VER_NBR = '.                                       01080051
010900         10  PV-MSG-SHIPT-VER         PIC 9(09) VALUE ZERO.       01090051
011000                                                                  01100051
011100     05  PV-RETRY-COUNTER             PIC S9(03) COMP-3           01110051
011200                                        VALUE ZERO.               01120051
011300     05  PC-MAX-RETRIES               PIC S9(03) COMP-3           01130051
011400                                        VALUE 10.                 01140051
011500     05  PV-DONT-SHIP-BEF-DTE         PIC X(10).                  01150051
011600     05  PV-CAN-IFNOT-SHIP-DTE        PIC X(10).                  01160051
011700     05  PV-START-SHIP-DATE           PIC X(10)  VALUE SPACES.    01170060
011800     05  PV-CANCEL-DATE               PIC X(10)  VALUE SPACES.    01180060
011900     05  PV-EXT-CANCEL-DATE           PIC X(10)  VALUE SPACES.    01190060
012000******************************************************************01200051
012100**COPYBOOKS                                                       01210051
012200******************************************************************01220051
012300***DB2 MESSAGE AREA                                               01230051
012400     COPY SQLCA2.                                                 01240051
012500                                                                  01250051
012600                                                                  01260051
012700* ------------------------------------------------------------- * 01270051
012800*  SQL AND COBOL DECLARATIONS FOR PLAN SHIP TABLE                 01280051
012900* ------------------------------------------------------------- * 01290051
013000     EXEC SQL                                                     01300051
013100         INCLUDE TPLNSHP                                          01310051
013200     END-EXEC.                                                    01320051
013300                                                                  01330051
013400* ------------------------------------------------------------- * 01340051
013500*  SQL AND COBOL DECLARATIONS FOR VENDOR AGREEMENT TABLE          01350051
013600* ------------------------------------------------------------- * 01360051
013700     EXEC SQL                                                     01370051
013800         INCLUDE TVNDAGR                                          01380051
013900     END-EXEC.                                                    01390051
014000                                                                  01400051
014100* ------------------------------------------------------------- * 01410051
014200*  SQL AND COBOL DECLARATIONS FOR FREIGHT TERMS TABLE             01420051
014300* ------------------------------------------------------------- * 01430051
014400     EXEC SQL                                                     01440051
014500         INCLUDE TFRGTRM                                          01450051
014600     END-EXEC.                                                    01460051
014700                                                                  01470051
014800******************************************************************01480051
014900**TABLE INCLUSIONS                                                01490051
015000******************************************************************01500051
015100***DB2 COMMUNICATIONS AREA                                        01510051
015200     EXEC SQL                                                     01520051
015300         INCLUDE SQLCA                                            01530051
015400     END-EXEC.                                                    01540051
015500                                                                  01550051
015600 LINKAGE SECTION.                                                 01560051
015700 01  XLRD011-RECORD.                                              01570051
015800     COPY XLRD011.                                                01580051
015900******************************************************************01590051
016000**LINKAGE VARIABLES                                               01600051
016100******************************************************************01610051
016200*01  LV-LINKAGE-VARIABLES.                                        01620051
016300*    05  LV-XLRD011-RECORD               PIC X(1002).             01630051
016400*    05  LV-RETURN-CODE                  PIC S9(04).              01640051
016500                                                                  01650051
016600 PROCEDURE DIVISION USING XLRD011-RECORD.                         01660051
016700******************************************************************01670051
016800 0000-MAINLINE.                                                   01680051
016900                                                                  01690051
017000     PERFORM 1000-INITIALIZATION.                                 01700051
017100                                                                  01710051
017200     PERFORM 2000-PROCESS-MESSAGE                                 01720051
017300       UNTIL PS-PROCESS-COMPLETE.                                 01730051
017400                                                                  01740051
017500     PERFORM 9999-WRAPUP.                                         01750051
017600                                                                  01760051
017700     GOBACK.                                                      01770051
017800                                                                  01780051
017900***************************************************************** 01790051
018000**INITIALIZATION AREA - ALL MOVES TO UPDATE/INSERT                01800051
018100***************************************************************** 01810051
018200 1000-INITIALIZATION.                                             01820051
018300                                                                  01830051
018400     IF XL011-DEBUG-YES                                           01840051
018500         DISPLAY 'XLKUP006'                                       01850051
018600     END-IF                                                       01860051
018700                                                                  01870051
018800     SET PS-PROCESS-CONTINUE TO TRUE.                             01880051
018900                                                                  01890051
019000     INITIALIZE XL011-RETURN-AREA                                 01900051
019100     MOVE 'XLKUP006'                  TO XL011-ERROR-PROGRAM.     01910051
019200     MOVE '1000-INITIALIZATION'       TO XL011-ERROR-PARAGRAPH    01920051
019300                                                                  01930051
019400     EXEC SQL                                                     01940051
019500         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 01950051
019600     END-EXEC.                                                    01960051
019700                                                                  01970051
019800     MOVE SQLCODE                     TO XL011-SQLCODE            01980051
019900     EVALUATE TRUE                                                01990051
020000       WHEN SQLCODE EQUAL +0                                      02000051
020100           CONTINUE                                               02010051
020200       WHEN OTHER                                                 02020051
020300            SET XL011-SQL-ERROR      TO TRUE                      02030051
020400            SET PS-PROCESS-COMPLETE  TO TRUE                      02040051
020500     END-EVALUATE.                                                02050051
020600                                                                  02060051
020700***************************************************************** 02070051
020800**MAIN PROGRAM LOGIC - READS MESSAGE TYPE ON XLRD011-RECORD       02080051
020900***************************************************************** 02090051
021000 2000-PROCESS-MESSAGE.                                            02100051
021100     IF XL011-DEBUG-YES                                           02110051
021200         DISPLAY 'XLKUP006 - 2000-PROCESS-MESSAGE'                02120051
021300     END-IF                                                       02130051
021400                                                                  02140051
021500     MOVE 'TPLNSHP'                   TO XL011-DB2-TABLE-NAME (1) 02150051
021600                                                                  02160051
021700     EVALUATE XL011-MSG-ID                                        02170051
021800       WHEN 'HDR_ADD             '                                02180051
021900           PERFORM 2100-INSERT-DATA                               02190051
022000       WHEN 'HDR_CHANGE          '                                02200051
022100           PERFORM 2200-UPDATE-DATA                               02210051
022200       WHEN 'HDR_ATTR_CHANGE     '                                02220051
022300             SET PS-PROCESS-COMPLETE TO TRUE                      02230051
022400*GB 09/02/14 COMMENT OUT HDR_ATTR_CHANGE MESSAGE LOGIC AS         02240051
022500*GB 09/02/14 XL011-HAC-EXT-NOT-AFTER-DAT IS ALWAYS PASSED AS      02250051
022600*GB 09/02/14 DEFAULT DATE                                         02260051
022700*GB        PERFORM 2300-UPDATE-DATA                               02270051
022800       WHEN 'HDR_IMPRT_CHANGE    '                                02280051
022900           PERFORM 2400-UPDATE-DATA                               02290051
023000       WHEN 'HDR_IMPRT_ATT_CHANGE'                                02300051
023100           PERFORM 2500-UPDATE-DATA                               02310051
023200       WHEN 'HDR_DELETE          '                                02320051
023300           PERFORM 2800-DELETE-DATA                               02330051
023400     END-EVALUATE.                                                02340051
023500                                                                  02350051
023600***************************************************************** 02360051
023700**INSERT ACTION TYPE                                              02370051
023800***************************************************************** 02380051
023900 2100-INSERT-DATA.                                                02390051
024000                                                                  02400051
024100     IF XL011-DEBUG-YES                                           02410051
024200         DISPLAY 'XLKUP006 - 2100-INSERT-DATA'                    02420051
024300     END-IF                                                       02430051
024400                                                                  02440051
024500     MOVE '2100-INSERT-DATA'          TO XL011-ERROR-PARAGRAPH    02450051
024600*PRB0053662-START                                                 02460051
024700     MOVE  XL011-ORDER-NBR            TO DK-PO-NBR                02470051
024800     SET PS-PLNSHP-EXISTS-NO TO TRUE.                             02480060
024900     PERFORM 5000-VERSION-TPLNSHP.                                02490051
025000*PRB0053662-END                                                   02500051
025100     INITIALIZE DCLTPLNSHP.                                       02510051
025200                                                                  02520051
025300     MOVE 1                         TO PLNSHP-VER-NBR.            02530051
025400     MOVE 'A'                       TO PLNSHP-VER-STATUS-CDE.     02540051
025500     MOVE SPACES                    TO PLNSHP-SHIPT-TYP-CDE.      02550051
025600     MOVE ZEROES                    TO PLNSHP-SHIPT-DEST-NBR.     02560051
025700                                                                  02570051
025800     MOVE XL011-HA-ENT-ID           TO PLNSHP-ENT-ID.             02580051
025900     MOVE 'N'                       TO PLNSHP-LATE-SHIPT-IND.     02590051
026000     MOVE 'N'                       TO PLNSHP-EARLY-SHIPT-IND.    02600051
026100     MOVE 'N'                       TO PLNSHP-PARTIAL-SHIPT-IND.  02610051
026200     MOVE 'N'                       TO PLNSHP-BCKORDS-PERMTD-IND. 02620051
026300     MOVE SPACES                    TO PLNSHP-PORT-ENTR-DESC.     02630051
026400*PLNSHP-STRT-FCTRY-DTE.                                           02640051
026500     IF XL011-HA-FIRST-FACTORY-DATE NUMERIC                       02650051
026600         MOVE XL011-HA-FIRST-FACTORY-DATE  TO PV-DATE-X08         02660051
026700         MOVE PV-X08-CC                 TO PV-X10-CC              02670051
026800         MOVE PV-X08-YY                 TO PV-X10-YY              02680051
026900         MOVE PV-X08-MM                 TO PV-X10-MM              02690051
027000         MOVE PV-X08-DD                 TO PV-X10-DD              02700051
027100         MOVE '-'                       TO PV-X10-H1              02710051
027200                                           PV-X10-H2              02720051
027300         MOVE PV-DATE-X10               TO PLNSHP-STRT-FCTRY-DTE  02730051
027400     ELSE                                                         02740051
027500         MOVE PC-DEFAULT-DTE            TO PLNSHP-STRT-FCTRY-DTE  02750051
027600     END-IF.                                                      02760051
027700*PLNSHP-LAST-FCTRY-DTE.                                           02770051
027800     IF XL011-HA-LAST-FACTORY-DATE NUMERIC                        02780051
027900         MOVE XL011-HA-LAST-FACTORY-DATE TO PV-DATE-X08           02790051
028000         MOVE PV-X08-CC                 TO PV-X10-CC              02800051
028100         MOVE PV-X08-YY                 TO PV-X10-YY              02810051
028200         MOVE PV-X08-MM                 TO PV-X10-MM              02820051
028300         MOVE PV-X08-DD                 TO PV-X10-DD              02830051
028400         MOVE '-'                       TO PV-X10-H1              02840051
028500                                           PV-X10-H2              02850051
028600         MOVE PV-DATE-X10               TO PLNSHP-LAST-FCTRY-DTE  02860051
028700     ELSE                                                         02870051
028800         MOVE PC-DEFAULT-DTE            TO PLNSHP-LAST-FCTRY-DTE  02880051
028900     END-IF.                                                      02890051
029000*PLNSHP-DONT-SHIP-BEF-DTE                                         02900051
029100     IF XL011-HA-NOT-BEFORE-DATE NUMERIC                          02910051
029200         MOVE XL011-HA-NOT-BEFORE-DATE  TO PV-DATE-X08            02920051
029300         MOVE PV-X08-CC                 TO PV-X10-CC              02930051
029400         MOVE PV-X08-YY                 TO PV-X10-YY              02940051
029500         MOVE PV-X08-MM                 TO PV-X10-MM              02950051
029600         MOVE PV-X08-DD                 TO PV-X10-DD              02960051
029700         MOVE '-'                       TO PV-X10-H1              02970051
029800                                           PV-X10-H2              02980051
029900         MOVE PV-DATE-X10           TO PLNSHP-DONT-SHIP-BEF-DTE   02990051
030000     ELSE                                                         03000051
030100         MOVE PC-DEFAULT-DTE        TO PLNSHP-DONT-SHIP-BEF-DTE   03010051
030200     END-IF.                                                      03020051
030300*PLNSHP-CAN-IFNOT-SHIP-DTE                                        03030051
030400     IF XL011-HA-NOT-AFTER-DATE NUMERIC                           03040051
030500         MOVE XL011-HA-NOT-AFTER-DATE   TO PV-DATE-X08            03050051
030600         MOVE PV-X08-CC                 TO PV-X10-CC              03060051
030700         MOVE PV-X08-YY                 TO PV-X10-YY              03070051
030800         MOVE PV-X08-MM                 TO PV-X10-MM              03080051
030900         MOVE PV-X08-DD                 TO PV-X10-DD              03090051
031000         MOVE '-'                       TO PV-X10-H1              03100051
031100                                           PV-X10-H2              03110051
031200         MOVE PV-DATE-X10           TO PLNSHP-CAN-IFNOT-SHIP-DTE  03120051
031300     ELSE                                                         03130051
031400         MOVE PC-DEFAULT-DTE        TO PLNSHP-CAN-IFNOT-SHIP-DTE  03140051
031500     END-IF.                                                      03150051
031600*PLNSHP-EXT-CAN-DTE                                               03160051
031700     IF XL011-HA-EXT-NOT-AFTER-DAT NUMERIC                        03170051
031800         MOVE XL011-HA-EXT-NOT-AFTER-DAT                          03180051
031900                                    TO PV-DATE-X08                03190051
032000         MOVE PV-X08-CC             TO PV-X10-CC                  03200051
032100         MOVE PV-X08-YY             TO PV-X10-YY                  03210051
032200         MOVE PV-X08-MM             TO PV-X10-MM                  03220051
032300         MOVE PV-X08-DD             TO PV-X10-DD                  03230051
032400         MOVE '-'                   TO PV-X10-H1                  03240051
032500                                       PV-X10-H2                  03250051
032600         MOVE PV-DATE-X10           TO PLNSHP-EXT-CAN-DTE         03260051
032700     ELSE                                                         03270051
032800         MOVE PC-DEFAULT-DTE        TO PLNSHP-EXT-CAN-DTE         03280051
032900     END-IF.                                                      03290051
033000                                                                  03300051
033100     MOVE 'AC'                      TO PLNSHP-STATUS-CDE.         03310051
033200     MOVE XL011-ORDER-NBR           TO PLNSHP-PO-NBR.             03320051
033300     MOVE 'XLKUP006'                TO PLNSHP-LAST-UPD-BY-UID.    03330051
033400                                                                  03340051
033500     MOVE XL011-HA-FOB-CDE          TO PLNSHP-FOB-CDE.            03350051
033600     MOVE XL011-HA-POE-CDE          TO PLNSHP-POE-CDE.            03360051
033700                                                                  03370060
033800*    THE FOLLOWING SWITCH YES VALUE MEANS THAT THERE ARE          03380063
033900*    ALREADY ROWS IN THE TPLNSHP TABLE FOR THIS PO WHEN           03390063
034000*    A HDR_ADD MESSAGE WAS BEING PROCESSED WHICH MEANS A          03400063
034100*    PERFORM OF A PARAGRAPH TO SET THE SHIP DATE, CANCEL          03410063
034200*    DATE AND EXTENDED CANCEL DATES TO THE PROPER VALUE           03420063
034300*    BASED ON THE PREVIOUS ACTIVE ROW ON THE TABLE FOR THE        03430063
034400*    PO.                                                          03440063
034500                                                                  03450061
034600     IF  PS-PLNSHP-EXISTS-YES                                     03460063
034700         PERFORM 3000-FORMAT-TPLNSHP-DATES                        03470064
034800     END-IF.                                                      03480063
034900                                                                  03490061
035000*    GET THE NEXT AVAILABLE SHIPMENT NBR                          03500051
035100     IF PS-PROCESS-CONTINUE                                       03510051
035200         PERFORM 2110-GET-SHIPMENT-NBR                            03520051
035300     END-IF.                                                      03530051
035400                                                                  03540060
035500     IF PS-PROCESS-CONTINUE                                       03550051
035600         PERFORM 2120-TVNDAGR-DATA                                03560051
035700     END-IF.                                                      03570051
035800     IF PS-PROCESS-CONTINUE                                       03580051
035900         PERFORM 2130-TFRGTRM-DATA                                03590051
036000     END-IF.                                                      03600051
036100                                                                  03610051
036200     IF PS-PROCESS-CONTINUE                                       03620051
036300         PERFORM 7000-TPLNSHP-BRAND-NEW                           03630051
036400     END-IF.                                                      03640051
036500                                                                  03650051
036600******************************************************************03660051
036700 2110-GET-SHIPMENT-NBR.                                           03670051
036800                                                                  03680051
036900     MOVE '2110-GET-SHIPMENT-NBR'     TO XL011-ERROR-PARAGRAPH    03690051
037000     IF XL011-DEBUG-YES                                           03700051
037100         DISPLAY 'XLKUP006 - 2110-GET-SHIPMENT-NBR'               03710051
037200     END-IF                                                       03720051
037300                                                                  03730051
037400*PLNSHP-SHIPT-NBR                                                 03740051
037500     EXEC SQL                                                     03750051
037600         SELECT MAX(SHIPT_NBR)                                    03760051
037700           INTO :PV-MAX-SHIPT-NBR                                 03770051
037800           FROM TPLNSHP                                           03780051
037900     END-EXEC.                                                    03790051
038000     MOVE SQLCODE                    TO XL011-SQLCODE             03800051
038100     EVALUATE TRUE                                                03810051
038200       WHEN SQLCODE = 0                                           03820051
038300           COMPUTE PLNSHP-SHIPT-NBR  = PV-MAX-SHIPT-NBR + 1       03830051
038400       WHEN OTHER                                                 03840051
038500           SET PS-PROCESS-COMPLETE   TO TRUE                      03850051
038600           SET XL011-SQL-ERROR       TO TRUE                      03860051
038700     END-EVALUATE.                                                03870051
038800                                                                  03880051
038900 2120-TVNDAGR-DATA.                                               03890051
039000     IF XL011-DEBUG-YES                                           03900051
039100         DISPLAY 'XLKUP006 - 2120-TVNDAGR-DATA'                   03910051
039200     END-IF                                                       03920051
039300                                                                  03930051
039400     MOVE '2120-TVNDAGR-DATA'       TO XL011-ERROR-PARAGRAPH      03940051
039500     MOVE PLNSHP-ENT-ID             TO DK-ENT-ID.                 03950051
039600     MOVE XL011-HA-DEPT             TO DK-DEPT-NBR-4-NUM          03960051
039700                                                                  03970051
039800     EXEC SQL                                                     03980051
039900         SELECT FOB_POINT_TXT                                     03990051
040000              , SHIPT_POINT_TXT                                   04000051
040100           INTO :VNDAGR-FOB-POINT-TXT                             04010051
040200                  :DN-FOB-POINT-TXT                               04020051
040300              ,:VNDAGR-SHIPT-POINT-TXT                            04030051
040400                  :DN-SHIPT-POINT-TXT                             04040051
040500           FROM TVNDAGR                                           04050051
040600          WHERE ENT_ID          = :DK-ENT-ID                      04060051
040700            AND DEPT_NBR        = :DK-DEPT-NBR-3-CH               04070051
040800            AND AGRMT_TYP_ID    = '1'                             04080051
040900            AND EFFECTIVE_DATE <= :PV-CURR-TMST-DATE              04090051
041000            AND EXPIRATION_DATE > :PV-CURR-TMST-DATE              04100051
041100            AND SEQ_NBR         =                                 04110051
041200                 (SELECT MAX(SEQ_NBR)                             04120051
041300                    FROM TVNDAGR                                  04130051
041400                   WHERE ENT_ID       = :DK-ENT-ID                04140051
041500                     AND DEPT_NBR     = :DK-DEPT-NBR-3-CH         04150051
041600                     AND AGRMT_TYP_ID = '1')                      04160051
041700     END-EXEC.                                                    04170051
041800     MOVE SQLCODE                     TO XL011-SQLCODE            04180051
041900     EVALUATE TRUE                                                04190051
042000       WHEN SQLCODE = 0                                           04200051
042100           IF DN-SHIPT-POINT-TXT = -1                             04210051
042200               MOVE SPACES             TO VNDAGR-SHIPT-POINT-TXT  04220051
042300           ELSE                                                   04230051
042400               MOVE VNDAGR-SHIPT-POINT-TXT                        04240051
042500                                       TO PLNSHP-SHIPT-POINT-TXT  04250051
042600           END-IF                                                 04260051
042700           IF DN-FOB-POINT-TXT = -1                               04270051
042800               MOVE SPACES             TO VNDAGR-FOB-POINT-TXT    04280051
042900           ELSE                                                   04290051
043000               MOVE VNDAGR-FOB-POINT-TXT                          04300051
043100                                       TO PLNSHP-FOB-POINT-TXT    04310051
043200           END-IF                                                 04320051
043300       WHEN SQLCODE = +100                                        04330051
043400           MOVE SPACES                 TO VNDAGR-FOB-POINT-TXT    04340051
043500                                          VNDAGR-SHIPT-POINT-TXT  04350051
043600       WHEN OTHER                                                 04360051
043700           SET PS-PROCESS-COMPLETE     TO TRUE                    04370051
043800           SET XL011-SQL-ERROR         TO TRUE                    04380051
043900           MOVE 'TVNDAGR'              TO XL011-DB2-TABLE-NAME (1)04390051
044000     END-EVALUATE.                                                04400051
044100                                                                  04410051
044200 2130-TFRGTRM-DATA.                                               04420051
044300     IF XL011-DEBUG-YES                                           04430051
044400         DISPLAY 'XLKUP006 - 2130-TFRGTRM-DATA'                   04440051
044500     END-IF                                                       04450051
044600                                                                  04460051
044700     MOVE '2130-TFRGTRM-DATA'       TO XL011-ERROR-PARAGRAPH      04470051
044800     MOVE XL011-HA-FREIGHT-TERMS    TO DK-TERM-ID.                04480051
044900     EXEC SQL                                                     04490051
045000         SELECT KOHLS_FRGT_PCT                                    04500051
045100              , VND_FRGT_PCT                                      04510051
045200           INTO :FRGTRM-KOHLS-FRGT-PCT                            04520051
045300              , :FRGTRM-VND-FRGT-PCT                              04530051
045400           FROM TFRGTRM                                           04540051
045500          WHERE FRGT_TERM_ID = :DK-TERM-ID                        04550051
045600     END-EXEC.                                                    04560051
045700     MOVE SQLCODE                   TO XL011-SQLCODE              04570051
045800     EVALUATE TRUE                                                04580051
045900       WHEN SQLCODE = 0                                           04590051
046000           PERFORM 2132-CALC-FREIGHT-FIELDS                       04600051
046100       WHEN SQLCODE = +100                                        04610051
046200           MOVE ZEROES TO FRGTRM-KOHLS-FRGT-PCT                   04620051
046300                          FRGTRM-VND-FRGT-PCT                     04630051
046400           PERFORM 2132-CALC-FREIGHT-FIELDS                       04640051
046500       WHEN OTHER                                                 04650051
046600           SET PS-PROCESS-COMPLETE TO TRUE                        04660051
046700           SET XL011-SQL-ERROR     TO TRUE                        04670051
046800           MOVE 'TFRGTRM'          TO XL011-DB2-TABLE-NAME (1)    04680051
046900     END-EVALUATE.                                                04690051
047000                                                                  04700051
047100 2132-CALC-FREIGHT-FIELDS.                                        04710051
047200     IF FRGTRM-KOHLS-FRGT-PCT = 1.0000                            04720051
047300         MOVE ZEROES               TO PLNSHP-VEND-FRGT-PCT        04730051
047400                                      PLNSHP-KOHLS-FRGT-PCT       04740051
047500         MOVE 'K'                  TO PLNSHP-FRGT-PAYT-CDE        04750051
047600     ELSE                                                         04760051
047700         IF FRGTRM-VND-FRGT-PCT = 1.0000                          04770051
047800             MOVE ZEROES           TO PLNSHP-VEND-FRGT-PCT        04780051
047900                                      PLNSHP-KOHLS-FRGT-PCT       04790051
048000             MOVE 'V'              TO PLNSHP-FRGT-PAYT-CDE        04800051
048100         ELSE                                                     04810051
048200             MOVE FRGTRM-KOHLS-FRGT-PCT                           04820051
048300                                   TO PLNSHP-KOHLS-FRGT-PCT       04830051
048400             MOVE FRGTRM-VND-FRGT-PCT                             04840051
048500                                   TO PLNSHP-VEND-FRGT-PCT        04850051
048600             IF FRGTRM-KOHLS-FRGT-PCT = 0                         04860051
048700               AND FRGTRM-VND-FRGT-PCT = 0                        04870051
048800                  MOVE 'K'         TO PLNSHP-FRGT-PAYT-CDE        04880051
048900              ELSE                                                04890051
049000                  MOVE 'B'         TO PLNSHP-FRGT-PAYT-CDE        04900051
049100              END-IF                                              04910051
049200         END-IF                                                   04920051
049300     END-IF.                                                      04930051
049400                                                                  04940051
049500******************************************************************04950051
049600**UPDATE ACTION TYPE - "HDR_CHANGE"                               04960051
049700******************************************************************04970051
049800 2200-UPDATE-DATA.                                                04980051
049900     IF XL011-DEBUG-YES                                           04990051
050000         DISPLAY 'XLKUP006 - 2200-UPDATE-DATA'                    05000051
050100     END-IF                                                       05010051
050200                                                                  05020051
050300     MOVE '2200-UPDATE-DATA'        TO XL011-ERROR-PARAGRAPH      05030051
050400     MOVE XL011-ORDER-NBR           TO DK-PO-NBR.                 05040051
050500     PERFORM 5000-VERSION-TPLNSHP                                 05050051
050600     IF PS-PROCESS-CONTINUE                                       05060051
050700         PERFORM 2210-HDR-CHANGE                                  05070051
050800     END-IF.                                                      05080051
050900 2210-HDR-CHANGE.                                                 05090051
051000     IF XL011-DEBUG-YES                                           05100051
051100         DISPLAY 'XLKUP006 - 2210-HDR-CHANGE'                     05110051
051200     END-IF                                                       05120051
051300                                                                  05130051
051400     MOVE '2210-HDR-CHANGE'         TO XL011-ERROR-PARAGRAPH      05140051
051500                                                                  05150051
051600*SET FIELDS BEING UPDATED.                                        05160051
051700     IF XL011-HC-NOT-BEFORE-DATE NUMERIC                          05170051
051800         MOVE XL011-HC-NOT-BEFORE-DATE  TO PV-DATE-X08            05180051
051900         MOVE PV-X08-CC                 TO PV-X10-CC              05190051
052000         MOVE PV-X08-YY                 TO PV-X10-YY              05200051
052100         MOVE PV-X08-MM                 TO PV-X10-MM              05210051
052200         MOVE PV-X08-DD                 TO PV-X10-DD              05220051
052300         MOVE '-'                       TO PV-X10-H1              05230051
052400                                           PV-X10-H2              05240051
052500         MOVE PV-DATE-X10           TO PV-DONT-SHIP-BEF-DTE       05250051
052600     ELSE                                                         05260051
052700         MOVE PC-DEFAULT-DTE        TO PV-DONT-SHIP-BEF-DTE       05270051
052800     END-IF.                                                      05280051
052900                                                                  05290051
053000     IF XL011-HC-NOT-AFTER-DATE NUMERIC                           05300051
053100         MOVE XL011-HC-NOT-AFTER-DATE   TO PV-DATE-X08            05310051
053200         MOVE PV-X08-CC                 TO PV-X10-CC              05320051
053300         MOVE PV-X08-YY                 TO PV-X10-YY              05330051
053400         MOVE PV-X08-MM                 TO PV-X10-MM              05340051
053500         MOVE PV-X08-DD                 TO PV-X10-DD              05350051
053600         MOVE '-'                       TO PV-X10-H1              05360051
053700                                           PV-X10-H2              05370051
053800         MOVE PV-DATE-X10           TO PV-CAN-IFNOT-SHIP-DTE      05380051
053900     ELSE                                                         05390051
054000         MOVE PC-DEFAULT-DTE        TO PV-CAN-IFNOT-SHIP-DTE      05400051
054100     END-IF.                                                      05410051
054200                                                                  05420051
054300     MOVE PV-CURRENT-TMST           TO PLNSHP-LAST-UPD-TMST.      05430051
054400                                                                  05440051
054500     MOVE XL011-HC-FREIGHT-TERMS TO DK-TERM-ID.                   05450051
054600     EXEC SQL                                                     05460051
054700         SELECT KOHLS_FRGT_PCT                                    05470051
054800              , VND_FRGT_PCT                                      05480051
054900           INTO :FRGTRM-KOHLS-FRGT-PCT                            05490051
055000              , :FRGTRM-VND-FRGT-PCT                              05500051
055100           FROM TFRGTRM                                           05510051
055200          WHERE FRGT_TERM_ID = :DK-TERM-ID                        05520051
055300     END-EXEC.                                                    05530051
055400     MOVE SQLCODE                     TO XL011-SQLCODE            05540051
055500     EVALUATE TRUE                                                05550051
055600       WHEN SQLCODE = 0                                           05560051
055700           IF FRGTRM-KOHLS-FRGT-PCT = 1.0000                      05570051
055800               MOVE ZEROES      TO PLNSHP-VEND-FRGT-PCT           05580051
055900                                   PLNSHP-KOHLS-FRGT-PCT          05590051
056000               MOVE 'K'         TO PLNSHP-FRGT-PAYT-CDE           05600051
056100           ELSE                                                   05610051
056200               IF FRGTRM-VND-FRGT-PCT = 1.0000                    05620051
056300                   MOVE ZEROES  TO PLNSHP-VEND-FRGT-PCT           05630051
056400                                   PLNSHP-KOHLS-FRGT-PCT          05640051
056500                   MOVE 'V'     TO PLNSHP-FRGT-PAYT-CDE           05650051
056600               ELSE                                               05660051
056700                   MOVE FRGTRM-KOHLS-FRGT-PCT                     05670051
056800                     TO PLNSHP-KOHLS-FRGT-PCT                     05680051
056900                   MOVE FRGTRM-VND-FRGT-PCT                       05690051
057000                     TO PLNSHP-VEND-FRGT-PCT                      05700051
057100                   IF FRGTRM-KOHLS-FRGT-PCT = 0                   05710051
057200                     AND FRGTRM-VND-FRGT-PCT = 0                  05720051
057300                       MOVE 'K' TO PLNSHP-FRGT-PAYT-CDE           05730051
057400                   ELSE                                           05740051
057500                       MOVE 'B' TO PLNSHP-FRGT-PAYT-CDE           05750051
057600                   END-IF                                         05760051
057700               END-IF                                             05770051
057800           END-IF                                                 05780051
057900       WHEN OTHER                                                 05790051
058000           SET PS-PROCESS-COMPLETE TO TRUE                        05800051
058100           SET XL011-SQL-ERROR     TO TRUE                        05810051
058200           MOVE 'TFRGTRM'          TO XL011-DB2-TABLE-NAME (1)    05820051
058300     END-EVALUATE.                                                05830051
058400                                                                  05840051
058500     IF PS-PROCESS-CONTINUE                                       05850051
058600         ADD +1                       TO PLNSHP-VER-NBR           05860051
058700         MOVE 'A'                     TO PLNSHP-VER-STATUS-CDE    05870051
058800         MOVE 'XLKUP006'              TO PLNSHP-LAST-UPD-BY-UID   05880051
058900         PERFORM 5800-NOT-BEF-NOT-AFT-HDR-CHG                     05890051
059000         PERFORM 6000-INSERT-TPLNSHP                              05900051
059100     END-IF.                                                      05910051
059200                                                                  05920051
059300******************************************************************05930051
059400**UPDATE ACTION TYPE - "HDR_ATTR_CHANGE"                          05940051
059500******************************************************************05950051
059600 2300-UPDATE-DATA.                                                05960051
059700                                                                  05970051
059800     IF XL011-DEBUG-YES                                           05980051
059900         DISPLAY 'XLKUP006 - 2300-UPDATE-DATA'                    05990051
060000     END-IF                                                       06000051
060100                                                                  06010051
060200     MOVE '2300-UPDATE-DATA'        TO XL011-ERROR-PARAGRAPH      06020051
060300     MOVE XL011-ORDER-NBR           TO DK-PO-NBR.                 06030051
060400     PERFORM 5000-VERSION-TPLNSHP                                 06040051
060500     IF PS-PROCESS-CONTINUE                                       06050051
060600         PERFORM 2310-HDR-ATTR-CHANGE                             06060051
060700     END-IF.                                                      06070051
060800                                                                  06080051
060900 2310-HDR-ATTR-CHANGE.                                            06090051
061000     IF XL011-DEBUG-YES                                           06100051
061100         DISPLAY 'XLKUP006 - 2310-HDR-ATTR-CHANGE'                06110051
061200     END-IF                                                       06120051
061300                                                                  06130051
061400     MOVE '2310-HDR-ATTR-CHANGE'    TO XL011-ERROR-PARAGRAPH      06140051
061500*SET FIELDS BEING UPDATED.                                        06150051
061600     MOVE PV-CURRENT-TMST           TO PLNSHP-LAST-UPD-TMST.      06160051
061700                                                                  06170051
061800     IF XL011-HAC-EXT-NOT-AFTER-DAT NUMERIC                       06180051
061900         MOVE XL011-HAC-EXT-NOT-AFTER-DAT                         06190051
062000                                    TO PV-DATE-X08                06200051
062100         MOVE PV-X08-CC             TO PV-X10-CC                  06210051
062200         MOVE PV-X08-YY             TO PV-X10-YY                  06220051
062300         MOVE PV-X08-MM             TO PV-X10-MM                  06230051
062400         MOVE PV-X08-DD             TO PV-X10-DD                  06240051
062500         MOVE '-'                   TO PV-X10-H1                  06250051
062600                                       PV-X10-H2                  06260051
062700         MOVE PV-DATE-X10           TO PLNSHP-EXT-CAN-DTE         06270051
062800     ELSE                                                         06280051
062900         MOVE PC-DEFAULT-DTE        TO PLNSHP-EXT-CAN-DTE         06290051
063000     END-IF.                                                      06300051
063100                                                                  06310051
063200     ADD +1                        TO PLNSHP-VER-NBR              06320051
063300     MOVE 'A'                      TO PLNSHP-VER-STATUS-CDE       06330051
063400     MOVE 'XLKUP006'               TO PLNSHP-LAST-UPD-BY-UID      06340051
063500     PERFORM 6000-INSERT-TPLNSHP.                                 06350051
063600                                                                  06360051
063700******************************************************************06370051
063800**UPDATE ACTION TYPE - "HDR_IMPRT_CHANGE"                         06380051
063900******************************************************************06390051
064000 2400-UPDATE-DATA.                                                06400051
064100                                                                  06410051
064200     IF XL011-DEBUG-YES                                           06420051
064300         DISPLAY 'XLKUP006 - 2400-UPDATE-DATA'                    06430051
064400     END-IF                                                       06440051
064500                                                                  06450051
064600     MOVE '2400-UPDATE-DATA'        TO XL011-ERROR-PARAGRAPH      06460051
064700     MOVE XL011-ORDER-NBR           TO DK-PO-NBR.                 06470051
064800     PERFORM 5000-VERSION-TPLNSHP                                 06480051
064900     IF PS-PROCESS-CONTINUE                                       06490051
065000         PERFORM 2410-HDR-IMPRT-CHANGE                            06500051
065100     END-IF.                                                      06510051
065200                                                                  06520051
065300 2410-HDR-IMPRT-CHANGE.                                           06530051
065400     IF XL011-DEBUG-YES                                           06540051
065500         DISPLAY 'XLKUP006 - 2410-HDR-IMPRT-CHANGE'               06550051
065600     END-IF                                                       06560051
065700                                                                  06570051
065800     MOVE '2410-HDR-IMPRT-CHANGE'   TO XL011-ERROR-PARAGRAPH      06580051
065900*SET FIELDS BEING UPDATED.                                        06590051
066000     MOVE PV-CURRENT-TMST           TO PLNSHP-LAST-UPD-TMST.      06600051
066100     MOVE XL011-IC-FOB-CDE          TO PLNSHP-FOB-CDE.            06610051
066200     MOVE XL011-IC-POE-CDE          TO PLNSHP-POE-CDE.            06620051
066300                                                                  06630051
066400     ADD +1                           TO PLNSHP-VER-NBR           06640051
066500     MOVE 'A'                         TO PLNSHP-VER-STATUS-CDE    06650051
066600     MOVE 'XLKUP006'                  TO PLNSHP-LAST-UPD-BY-UID   06660051
066700     PERFORM 6000-INSERT-TPLNSHP.                                 06670051
066800                                                                  06680051
066900                                                                  06690051
067000******************************************************************06700051
067100**UPDATE ACTION TYPE - "HDR_IMPRT_ATT_CHANGE"                     06710051
067200******************************************************************06720051
067300 2500-UPDATE-DATA.                                                06730051
067400                                                                  06740051
067500     IF XL011-DEBUG-YES                                           06750051
067600         DISPLAY 'XLKUP006 - 2500-UPDATE-DATA'                    06760051
067700     END-IF                                                       06770051
067800                                                                  06780051
067900     MOVE '2500-UPDATE-DATA'          TO XL011-ERROR-PARAGRAPH    06790051
068000     MOVE XL011-ORDER-NBR             TO DK-PO-NBR.               06800051
068100     PERFORM 5000-VERSION-TPLNSHP                                 06810051
068200     IF PS-PROCESS-CONTINUE                                       06820051
068300         PERFORM 2510-HDR-IMPRT-ATT-CHANGE                        06830051
068400     END-IF.                                                      06840051
068500                                                                  06850051
068600 2510-HDR-IMPRT-ATT-CHANGE.                                       06860051
068700     IF XL011-DEBUG-YES                                           06870051
068800         DISPLAY 'XLKUP006 - 2510-HDR-IMPRT-ATT-CHANGE'           06880051
068900     END-IF                                                       06890051
069000                                                                  06900051
069100     MOVE '2510-HDR-IMPRT-ATT-CHANGE' TO XL011-ERROR-PARAGRAPH    06910051
069200*SET FIELDS BEING UPDATED.                                        06920051
069300     MOVE PV-CURRENT-TMST           TO PLNSHP-LAST-UPD-TMST.      06930051
069400                                                                  06940051
069500     IF XL011-IAC-FIRST-FACTORY-DATE NUMERIC                      06950051
069600         MOVE XL011-IAC-FIRST-FACTORY-DATE  TO PV-DATE-X08        06960051
069700         MOVE PV-X08-CC                 TO PV-X10-CC              06970051
069800         MOVE PV-X08-YY                 TO PV-X10-YY              06980051
069900         MOVE PV-X08-MM                 TO PV-X10-MM              06990051
070000         MOVE PV-X08-DD                 TO PV-X10-DD              07000051
070100         MOVE '-'                       TO PV-X10-H1              07010051
070200                                           PV-X10-H2              07020051
070300         MOVE PV-DATE-X10               TO PLNSHP-STRT-FCTRY-DTE  07030051
070400     ELSE                                                         07040051
070500         MOVE PC-DEFAULT-DTE            TO PLNSHP-STRT-FCTRY-DTE  07050051
070600     END-IF.                                                      07060051
070700                                                                  07070051
070800     IF XL011-IAC-LAST-FACTORY-DATE NUMERIC                       07080051
070900         MOVE XL011-IAC-LAST-FACTORY-DATE TO PV-DATE-X08          07090051
071000         MOVE PV-X08-CC                 TO PV-X10-CC              07100051
071100         MOVE PV-X08-YY                 TO PV-X10-YY              07110051
071200         MOVE PV-X08-MM                 TO PV-X10-MM              07120051
071300         MOVE PV-X08-DD                 TO PV-X10-DD              07130051
071400         MOVE '-'                       TO PV-X10-H1              07140051
071500                                           PV-X10-H2              07150051
071600         MOVE PV-DATE-X10               TO PLNSHP-LAST-FCTRY-DTE  07160051
071700     ELSE                                                         07170051
071800         MOVE PC-DEFAULT-DTE            TO PLNSHP-LAST-FCTRY-DTE  07180051
071900     END-IF.                                                      07190051
072000                                                                  07200051
072100     ADD +1                           TO PLNSHP-VER-NBR           07210051
072200     MOVE 'A'                         TO PLNSHP-VER-STATUS-CDE    07220051
072300     MOVE 'XLKUP006'                  TO PLNSHP-LAST-UPD-BY-UID   07230051
072400     PERFORM 6000-INSERT-TPLNSHP.                                 07240051
072500                                                                  07250051
072600******************************************************************07260051
072700**DELETE TYPE ACTION                                              07270051
072800******************************************************************07280051
072900 2800-DELETE-DATA.                                                07290051
073000                                                                  07300051
073100     IF XL011-DEBUG-YES                                           07310051
073200         DISPLAY 'XLKUP006 - 2800-DELETE-DATA'                    07320051
073300     END-IF                                                       07330051
073400                                                                  07340051
073500     MOVE '2800-DELETE-DATA'          TO XL011-ERROR-PARAGRAPH    07350051
073600     MOVE XL011-ORDER-NBR             TO DK-PO-NBR.               07360051
073700                                                                  07370051
073800         EXEC SQL                                                 07380051
073900             DELETE FROM TPLNSHP                                  07390051
074000             WHERE PO_NBR         = :DK-PO-NBR                    07400051
074100         END-EXEC                                                 07410051
074200                                                                  07420051
074300     MOVE SQLCODE                     TO XL011-SQLCODE            07430051
074400*CHECK SQL RETURN CODE FOR SUCCESS.                               07440051
074500     EVALUATE TRUE                                                07450051
074600         WHEN SQLCODE = 0                                         07460051
074700             SET PS-PROCESS-COMPLETE TO TRUE                      07470051
074800         WHEN OTHER                                               07480051
074900             SET PS-PROCESS-COMPLETE TO TRUE                      07490051
075000     END-EVALUATE.                                                07500051
075100                                                                  07510063
075200******************************************************************07520063
075300**  THIS PARAGRAPH WILL BE USED TO SET THE DONT SHIP BEFORE DATE, 07530063
075400**  CANCEL IF NOT SHIP DATE AND EXTENDED CANCEL DATE COLUMNS ON   07540063
075500**  THE TPLNSHP TABLE IF THERE WERE ALREADY ROWS ON THE TABLE FOR 07550063
075600**  THE PO BEING PROCESSED FOR A HDR_ADD MESSAGE.                 07560063
075700******************************************************************07570063
075800                                                                  07580063
075900 3000-FORMAT-TPLNSHP-DATES.                                       07590063
076000                                                                  07600063
076100     IF  PLNSHP-DONT-SHIP-BEF-DTE = PV-START-SHIP-DATE            07610063
076200         IF  PLNSHP-CAN-IFNOT-SHIP-DTE = PV-EXT-CANCEL-DATE       07620063
076300             MOVE PV-CANCEL-DATE TO                               07630063
076400                  PLNSHP-CAN-IFNOT-SHIP-DTE                       07640063
076500             MOVE PV-EXT-CANCEL-DATE TO                           07650063
076600                  PLNSHP-EXT-CAN-DTE                              07660063
076700         ELSE                                                     07670063
076800             IF  PV-EXT-CANCEL-DATE = '0001-01-01'                07680063
076900                 IF  PLNSHP-CAN-IFNOT-SHIP-DTE >                  07690063
077000                     PV-CANCEL-DATE                               07700063
077100                     MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO            07710063
077200                          PLNSHP-EXT-CAN-DTE                      07720063
077300                     MOVE PV-CANCEL-DATE TO                       07730063
077400                          PLNSHP-CAN-IFNOT-SHIP-DTE               07740063
077500                 ELSE                                             07750063
077600                     NEXT SENTENCE                                07760063
077700                 END-IF                                           07770063
077800             ELSE                                                 07780063
077900                 IF  PLNSHP-CAN-IFNOT-SHIP-DTE >                  07790063
078000                     PV-EXT-CANCEL-DATE                           07800063
078100                     MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO            07810063
078200                          PLNSHP-EXT-CAN-DTE                      07820063
078300                     MOVE PV-CANCEL-DATE TO                       07830063
078400                          PLNSHP-CAN-IFNOT-SHIP-DTE               07840063
078500                 ELSE                                             07850063
078600                     IF  PLNSHP-CAN-IFNOT-SHIP-DTE <              07860063
078700                         PV-EXT-CANCEL-DATE                       07870063
078800                         IF  PLNSHP-CAN-IFNOT-SHIP-DTE >          07880063
078900                             PV-CANCEL-DATE                       07890063
079000                             MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO    07900063
079100                                  PLNSHP-EXT-CAN-DTE              07910063
079200                             MOVE PV-CANCEL-DATE TO               07920063
079300                                  PLNSHP-CAN-IFNOT-SHIP-DTE       07930063
079400                         ELSE                                     07940063
079500                             MOVE '0001-01-01' TO                 07950065
079600                                  PLNSHP-EXT-CAN-DTE              07960065
079700                         END-IF                                   07970063
079800                     ELSE                                         07980063
079900                         MOVE PV-EXT-CANCEL-DATE TO               07990063
080000                              PLNSHP-EXT-CAN-DTE                  08000063
080100                     END-IF                                       08010063
080200                 END-IF                                           08020063
080300             END-IF                                               08030063
080400         END-IF                                                   08040063
080500     ELSE                                                         08050066
080600         IF  PLNSHP-DONT-SHIP-BEF-DTE > PV-START-SHIP-DATE        08060068
080910             MOVE '0001-01-01' TO                                 08091069
080920                  PLNSHP-EXT-CAN-DTE                              08092069
080921         ELSE                                                     08092169
080940             IF  PV-EXT-CANCEL-DATE = '0001-01-01'                08094070
080950                 NEXT SENTENCE                                    08095070
080960             ELSE                                                 08096070
081000                 IF  PLNSHP-CAN-IFNOT-SHIP-DTE =                  08100070
081010                     PV-EXT-CANCEL-DATE                           08101070
081100                     MOVE PV-CANCEL-DATE TO                       08110070
081200                          PLNSHP-CAN-IFNOT-SHIP-DTE               08120070
081300                     MOVE PV-EXT-CANCEL-DATE TO                   08130070
081400                          PLNSHP-EXT-CAN-DTE                      08140070
081410                 ELSE                                             08141070
081420                     IF  PLNSHP-CAN-IFNOT-SHIP-DTE >              08142070
081430                         PV-EXT-CANCEL-DATE                       08143070
081440                         MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO        08144070
081450                              PLNSHP-EXT-CAN-DTE                  08145070
081460                         MOVE PV-CANCEL-DATE TO                   08146070
081470                              PLNSHP-CAN-IFNOT-SHIP-DTE           08147070
081480                     ELSE                                         08148070
081490                         IF  PLNSHP-CAN-IFNOT-SHIP-DTE <          08149070
081491                             PV-EXT-CANCEL-DATE                   08149170
081492                         AND PLNSHP-CAN-IFNOT-SHIP-DTE >          08149270
081493                             PV-CANCEL-DATE                       08149370
081494                             MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO    08149470
081495                                  PLNSHP-EXT-CAN-DTE              08149570
081496                             MOVE PV-CANCEL-DATE TO               08149670
081497                                  PLNSHP-CAN-IFNOT-SHIP-DTE       08149770
081498                         ELSE                                     08149870
081499                             MOVE '0001-01-01' TO                 08149970
081500                                  PLNSHP-EXT-CAN-DTE              08150070
081510                         END-IF                                   08151070
081520                     END-IF                                       08152070
081530                 END-IF                                           08153070
081600             END-IF                                               08160070
081700         END-IF                                                   08170070
081800     END-IF.                                                      08180070
082300                                                                  08230063
082400                                                                  08240051
082500 5000-VERSION-TPLNSHP.                                            08250051
082600     IF XL011-DEBUG-YES                                           08260051
082700         DISPLAY 'XLKUP006 - 5000-VERSION-TPLNSHP'                08270051
082800     END-IF                                                       08280051
082900                                                                  08290051
083000     MOVE '5000-VERSION-TPLNSHP'      TO XL011-ERROR-PARAGRAPH    08300051
083100     EXEC SQL                                                     08310051
083200         SELECT SHIPT_NBR                                         08320051
083300               ,VER_NBR                                           08330051
083400               ,VER_STATUS_CDE                                    08340051
083500               ,SHIPT_TYP_CDE                                     08350051
083600               ,SHIPT_DEST_NBR                                    08360051
083700               ,SHIPT_POINT_TXT                                   08370051
083800               ,FOB_POINT_TXT                                     08380051
083900               ,FRGT_PAYT_CDE                                     08390051
084000               ,VEND_FRGT_PCT                                     08400051
084100               ,KOHLS_FRGT_PCT                                    08410051
084200               ,LATE_SHIPT_IND                                    08420051
084300               ,EARLY_SHIPT_IND                                   08430051
084400               ,PARTIAL_SHIPT_IND                                 08440051
084500               ,BCKORDS_PERMTD_IND                                08450051
084600               ,PORT_ENTR_DESC                                    08460051
084700               ,STRT_FCTRY_DTE                                    08470051
084800               ,LAST_FCTRY_DTE                                    08480051
084900               ,DONT_SHIP_BEF_DTE                                 08490051
085000               ,CAN_IFNOT_SHIP_DTE                                08500051
085100               ,EXT_CAN_DTE                                       08510051
085200               ,LAST_UPD_TMST                                     08520051
085300               ,STATUS_CDE                                        08530051
085400               ,ENT_ID                                            08540051
085500               ,PO_NBR                                            08550051
085600               ,LAST_UPD_BY_UID                                   08560051
085700               ,FOB_CDE                                           08570051
085800               ,POE_CDE                                           08580051
085900           INTO :PLNSHP-SHIPT-NBR                                 08590051
086000               ,:PLNSHP-VER-NBR                                   08600051
086100               ,:PLNSHP-VER-STATUS-CDE                            08610051
086200               ,:PLNSHP-SHIPT-TYP-CDE                             08620051
086300               ,:PLNSHP-SHIPT-DEST-NBR                            08630051
086400               ,:PLNSHP-SHIPT-POINT-TXT                           08640051
086500               ,:PLNSHP-FOB-POINT-TXT                             08650051
086600               ,:PLNSHP-FRGT-PAYT-CDE                             08660051
086700               ,:PLNSHP-VEND-FRGT-PCT                             08670051
086800               ,:PLNSHP-KOHLS-FRGT-PCT                            08680051
086900               ,:PLNSHP-LATE-SHIPT-IND                            08690051
087000               ,:PLNSHP-EARLY-SHIPT-IND                           08700051
087100               ,:PLNSHP-PARTIAL-SHIPT-IND                         08710051
087200               ,:PLNSHP-BCKORDS-PERMTD-IND                        08720051
087300               ,:PLNSHP-PORT-ENTR-DESC                            08730051
087400               ,:PLNSHP-STRT-FCTRY-DTE                            08740051
087500               ,:PLNSHP-LAST-FCTRY-DTE                            08750051
087600               ,:PLNSHP-DONT-SHIP-BEF-DTE                         08760051
087700               ,:PLNSHP-CAN-IFNOT-SHIP-DTE                        08770051
087800               ,:PLNSHP-EXT-CAN-DTE                               08780051
087900               ,:PLNSHP-LAST-UPD-TMST                             08790051
088000               ,:PLNSHP-STATUS-CDE                                08800051
088100               ,:PLNSHP-ENT-ID                                    08810051
088200               ,:PLNSHP-PO-NBR                                    08820051
088300               ,:PLNSHP-LAST-UPD-BY-UID                           08830051
088400               ,:PLNSHP-FOB-CDE                                   08840051
088500               ,:PLNSHP-POE-CDE                                   08850051
088600           FROM TPLNSHP                                           08860051
088700           WHERE PO_NBR         = :DK-PO-NBR                      08870051
088800             AND VER_STATUS_CDE = 'A'                             08880051
088900     END-EXEC.                                                    08890051
089000     MOVE SQLCODE                   TO XL011-SQLCODE              08900051
089100     EVALUATE TRUE                                                08910051
089200       WHEN SQLCODE = 0                                           08920051
089300           SET PS-PLNSHP-EXISTS-YES TO TRUE                       08930060
089400           MOVE PLNSHP-DONT-SHIP-BEF-DTE  TO PV-START-SHIP-DATE   08940060
089500           MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO PV-CANCEL-DATE       08950060
089600           MOVE PLNSHP-EXT-CAN-DTE        TO PV-EXT-CANCEL-DATE   08960060
089700           PERFORM 5010-UPDATE-VER-STATUS-CDE                     08970051
089800*PRB0053662-START                                                 08980051
089900       WHEN SQLCODE = +100                                        08990051
090000           IF XL011-MSG-ID = 'HDR_ADD             '               09000051
090100            CONTINUE                                              09010051
090200           ELSE                                                   09020051
090300            SET PS-PROCESS-COMPLETE TO TRUE                       09030051
090400            SET XL011-SQL-ERROR     TO TRUE                       09040051
090500           END-IF                                                 09050051
090600*PRB0053662-END                                                   09060051
090700       WHEN OTHER                                                 09070051
090800           SET PS-PROCESS-COMPLETE TO TRUE                        09080051
090900           SET XL011-SQL-ERROR     TO TRUE                        09090051
091000     END-EVALUATE.                                                09100051
091100 5010-UPDATE-VER-STATUS-CDE.                                      09110051
091200     IF XL011-DEBUG-YES                                           09120051
091300         DISPLAY 'XLKUP006 - 5010-UPDATE-VER-STATUS-CDE'          09130051
091400     END-IF                                                       09140051
091500                                                                  09150051
091600     MOVE '5010-UPDATE-VER-STATUS-CDE' TO XL011-ERROR-PARAGRAPH   09160051
091700     EXEC SQL                                                     09170051
091800         UPDATE TPLNSHP                                           09180051
091900            SET VER_STATUS_CDE = 'I'                              09190051
092000         WHERE PO_NBR          = :DK-PO-NBR                       09200051
092100           AND VER_STATUS_CDE  = 'A'                              09210051
092200     END-EXEC.                                                    09220051
092300     MOVE SQLCODE                   TO XL011-SQLCODE              09230051
092400     EVALUATE TRUE                                                09240051
092500         WHEN SQLCODE = 0                                         09250051
092600             CONTINUE                                             09260051
092700         WHEN OTHER                                               09270051
092800             SET PS-PROCESS-COMPLETE TO TRUE                      09280051
092900             SET XL011-SQL-ERROR     TO TRUE                      09290051
093000     END-EVALUATE.                                                09300051
093100                                                                  09310051
093200 5800-NOT-BEF-NOT-AFT-HDR-CHG.                                    09320051
093300** PLNSHP-*** FIELDS CURRENT FROM TPLNSHP                         09330051
093400** PV-    *** NEW FROM RMS MESSAGE                                09340051
093500                                                                  09350051
093600**NO EXTENDED DATE                                                09360051
093700**  BEFORE & AFTER CHG, THEN NO CHANGE                            09370051
093800** OTHERWISE IF ONLY AFTER DATE CHANGES POPULATE EXTENDED         09380051
093900** WITH NEW AFTER DATE                                            09390051
094000                                                                  09400051
094100     IF PLNSHP-EXT-CAN-DTE  =  PC-DEFAULT-DTE                     09410051
094200        IF PV-CAN-IFNOT-SHIP-DTE > PLNSHP-CAN-IFNOT-SHIP-DTE      09420051
094300          IF PV-DONT-SHIP-BEF-DTE = PLNSHP-DONT-SHIP-BEF-DTE      09430051
094400*PRB0051752-START                                                 09440055
094500            IF PLNSHP-CAN-IFNOT-SHIP-DTE = PC-DEFAULT-DTE         09450056
094600             MOVE PV-CAN-IFNOT-SHIP-DTE TO                        09460056
094700                               PLNSHP-CAN-IFNOT-SHIP-DTE          09470056
094800            ELSE                                                  09480056
094900             MOVE PV-CAN-IFNOT-SHIP-DTE TO PLNSHP-EXT-CAN-DTE     09490056
095000            END-IF                                                09500053
095100*PRB0051752-END                                                   09510055
095200          ELSE                                                    09520051
095300            MOVE PV-CAN-IFNOT-SHIP-DTE TO                         09530051
095400                               PLNSHP-CAN-IFNOT-SHIP-DTE          09540051
095500            MOVE PV-DONT-SHIP-BEF-DTE TO                          09550051
095600                               PLNSHP-DONT-SHIP-BEF-DTE           09560051
095700          END-IF                                                  09570051
095800        ELSE                                                      09580051
095900** GB 06/02/14                                                    09590051
096000** IF NOT BEFORE DATE MESSAGE IS LESS THAN CURRENT VALUES         09600051
096100           MOVE PV-DONT-SHIP-BEF-DTE  TO PLNSHP-DONT-SHIP-BEF-DTE 09610051
096200           MOVE PV-CAN-IFNOT-SHIP-DTE TO                          09620051
096300                                         PLNSHP-CAN-IFNOT-SHIP-DTE09630051
096400        END-IF                                                    09640051
096500     ELSE                                                         09650051
096600**EXTENDED DATE POPULATED CHANGE IN NOT AFTER AND NOT BEFORE DATES09660051
096700** MOVE DEFAULT DATE                                              09670051
096800        IF PV-DONT-SHIP-BEF-DTE > PLNSHP-DONT-SHIP-BEF-DTE        09680051
096900          IF  PV-CAN-IFNOT-SHIP-DTE > PLNSHP-CAN-IFNOT-SHIP-DTE   09690051
097000            MOVE PC-DEFAULT-DTE   TO PLNSHP-EXT-CAN-DTE           09700051
097100            MOVE PV-CAN-IFNOT-SHIP-DTE TO                         09710051
097200                                    PLNSHP-CAN-IFNOT-SHIP-DTE     09720051
097300            MOVE PV-DONT-SHIP-BEF-DTE TO PLNSHP-DONT-SHIP-BEF-DTE 09730051
097400          ELSE                                                    09740051
097500** GB 06/02/14                                                    09750051
097600** IF NOT BEFORE DATE MESSAGE IS LESS THAN CURRENT VALUES         09760051
097700            MOVE PV-DONT-SHIP-BEF-DTE  TO                         09770051
097800                                   PLNSHP-DONT-SHIP-BEF-DTE       09780051
097900            MOVE PV-CAN-IFNOT-SHIP-DTE TO                         09790051
098000                                   PLNSHP-CAN-IFNOT-SHIP-DTE      09800051
098100          END-IF                                                  09810051
098200        ELSE                                                      09820051
098300**EXTENDED DATE POPULATED CHANGE TO NOT AFTER DATE ONLY           09830051
098400*PRB0051752-START                                                 09840055
098500            MOVE PV-DONT-SHIP-BEF-DTE TO PLNSHP-DONT-SHIP-BEF-DTE 09850054
098600*PRB0051752-END                                                   09860055
098700          EVALUATE TRUE                                           09870051
098800           WHEN PV-CAN-IFNOT-SHIP-DTE = PLNSHP-CAN-IFNOT-SHIP-DTE 09880051
098900             MOVE PC-DEFAULT-DTE   TO PLNSHP-EXT-CAN-DTE          09890051
099000           WHEN PV-CAN-IFNOT-SHIP-DTE > PLNSHP-CAN-IFNOT-SHIP-DTE 09900051
099100             MOVE PV-CAN-IFNOT-SHIP-DTE TO PLNSHP-EXT-CAN-DTE     09910051
099200           WHEN PV-CAN-IFNOT-SHIP-DTE < PLNSHP-CAN-IFNOT-SHIP-DTE 09920051
099300             MOVE PV-CAN-IFNOT-SHIP-DTE TO                        09930051
099400                                    PLNSHP-CAN-IFNOT-SHIP-DTE     09940051
099500             MOVE PC-DEFAULT-DTE  TO PLNSHP-EXT-CAN-DTE           09950051
099600          END-EVALUATE                                            09960051
099700        END-IF                                                    09970051
099800     END-IF.                                                      09980051
099900                                                                  09990051
100000                                                                  10000051
100100                                                                  10010051
100200 6000-INSERT-TPLNSHP.                                             10020051
100300     IF XL011-DEBUG-YES                                           10030051
100400         DISPLAY 'XLKUP006 - 6000-INSERT-TPLNSHP'                 10040051
100500     END-IF                                                       10050051
100600                                                                  10060051
100700      EXEC SQL                                                    10070051
100800          INSERT INTO TPLNSHP                                     10080051
100900                (SHIPT_NBR                                        10090051
101000                ,VER_NBR                                          10100051
101100                ,VER_STATUS_CDE                                   10110051
101200                ,SHIPT_TYP_CDE                                    10120051
101300                ,SHIPT_DEST_NBR                                   10130051
101400                ,SHIPT_POINT_TXT                                  10140051
101500                ,FOB_POINT_TXT                                    10150051
101600                ,FRGT_PAYT_CDE                                    10160051
101700                ,VEND_FRGT_PCT                                    10170051
101800                ,KOHLS_FRGT_PCT                                   10180051
101900                ,LATE_SHIPT_IND                                   10190051
102000                ,EARLY_SHIPT_IND                                  10200051
102100                ,PARTIAL_SHIPT_IND                                10210051
102200                ,BCKORDS_PERMTD_IND                               10220051
102300                ,PORT_ENTR_DESC                                   10230051
102400                ,STRT_FCTRY_DTE                                   10240051
102500                ,LAST_FCTRY_DTE                                   10250051
102600                ,DONT_SHIP_BEF_DTE                                10260051
102700                ,CAN_IFNOT_SHIP_DTE                               10270051
102800                ,EXT_CAN_DTE                                      10280051
102900                ,LAST_UPD_TMST                                    10290051
103000                ,STATUS_CDE                                       10300051
103100                ,ENT_ID                                           10310051
103200                ,PO_NBR                                           10320051
103300                ,LAST_UPD_BY_UID                                  10330051
103400                ,FOB_CDE                                          10340051
103500                ,POE_CDE)                                         10350051
103600          VALUES (:PLNSHP-SHIPT-NBR                               10360051
103700                , :PLNSHP-VER-NBR                                 10370051
103800                , :PLNSHP-VER-STATUS-CDE                          10380051
103900                , :PLNSHP-SHIPT-TYP-CDE                           10390051
104000                , :PLNSHP-SHIPT-DEST-NBR                          10400051
104100                , :PLNSHP-SHIPT-POINT-TXT                         10410051
104200                , :PLNSHP-FOB-POINT-TXT                           10420051
104300                , :PLNSHP-FRGT-PAYT-CDE                           10430051
104400                , :PLNSHP-VEND-FRGT-PCT                           10440051
104500                , :PLNSHP-KOHLS-FRGT-PCT                          10450051
104600                , :PLNSHP-LATE-SHIPT-IND                          10460051
104700                , :PLNSHP-EARLY-SHIPT-IND                         10470051
104800                , :PLNSHP-PARTIAL-SHIPT-IND                       10480051
104900                , :PLNSHP-BCKORDS-PERMTD-IND                      10490051
105000                , :PLNSHP-PORT-ENTR-DESC                          10500051
105100                , :PLNSHP-STRT-FCTRY-DTE                          10510051
105200                , :PLNSHP-LAST-FCTRY-DTE                          10520051
105300                , :PLNSHP-DONT-SHIP-BEF-DTE                       10530051
105400                , :PLNSHP-CAN-IFNOT-SHIP-DTE                      10540051
105500                , :PLNSHP-EXT-CAN-DTE                             10550051
105600                , :PLNSHP-LAST-UPD-TMST                           10560051
105700                , :PLNSHP-STATUS-CDE                              10570051
105800                , :PLNSHP-ENT-ID                                  10580051
105900                , :PLNSHP-PO-NBR                                  10590051
106000                , :PLNSHP-LAST-UPD-BY-UID                         10600051
106100                , :PLNSHP-FOB-CDE                                 10610051
106200                , :PLNSHP-POE-CDE)                                10620051
106300     END-EXEC.                                                    10630051
106400                                                                  10640051
106500     MOVE SQLCODE                     TO XL011-SQLCODE            10650051
106600*CHECK SQL RETURN CODE FOR SUCCESS.                               10660051
106700     EVALUATE TRUE                                                10670051
106800         WHEN SQLCODE = 0                                         10680051
106900             SET PS-PROCESS-COMPLETE TO TRUE                      10690051
107000         WHEN OTHER                                               10700051
107100             SET XL011-SQL-ERROR      TO TRUE                     10710051
107200             SET PS-PROCESS-COMPLETE  TO TRUE                     10720051
107300         END-EVALUATE.                                            10730051
107400                                                                  10740051
107500 7000-TPLNSHP-BRAND-NEW.                                          10750051
107600                                                                  10760051
107700     IF XL011-DEBUG-YES                                           10770051
107800         DISPLAY 'XLKUP006 - 7000-TPLNSHP-BRAND-NEW'              10780051
107900     END-IF                                                       10790051
108000                                                                  10800051
108100     PERFORM                                                      10810051
108200         WITH TEST AFTER                                          10820051
108300         VARYING PV-RETRY-COUNTER                                 10830051
108400         FROM 1 BY 1                                              10840051
108500               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)         10850051
108600                  OR  (SQLCODE = -904)                            10860051
108700                  OR  (SQLCODE = -911)                            10870051
108800                  OR  (SQLCODE = -913)                            10880051
108900                  OR  (SQLCODE = +0))                             10890051
109000                                                                  10900051
109100         EXEC SQL                                                 10910051
109200             INSERT INTO TPLNSHP                                  10920051
109300                   (SHIPT_NBR                                     10930051
109400                   ,VER_NBR                                       10940051
109500                   ,VER_STATUS_CDE                                10950051
109600                   ,SHIPT_TYP_CDE                                 10960051
109700                   ,SHIPT_DEST_NBR                                10970051
109800                   ,SHIPT_POINT_TXT                               10980051
109900                   ,FOB_POINT_TXT                                 10990051
110000                   ,FRGT_PAYT_CDE                                 11000051
110100                   ,VEND_FRGT_PCT                                 11010051
110200                   ,KOHLS_FRGT_PCT                                11020051
110300                   ,LATE_SHIPT_IND                                11030051
110400                   ,EARLY_SHIPT_IND                               11040051
110500                   ,PARTIAL_SHIPT_IND                             11050051
110600                   ,BCKORDS_PERMTD_IND                            11060051
110700                   ,PORT_ENTR_DESC                                11070051
110800                   ,STRT_FCTRY_DTE                                11080051
110900                   ,LAST_FCTRY_DTE                                11090051
111000                   ,DONT_SHIP_BEF_DTE                             11100051
111100                   ,CAN_IFNOT_SHIP_DTE                            11110051
111200                   ,EXT_CAN_DTE                                   11120051
111300                   ,LAST_UPD_TMST                                 11130051
111400                   ,STATUS_CDE                                    11140051
111500                   ,ENT_ID                                        11150051
111600                   ,PO_NBR                                        11160051
111700                   ,LAST_UPD_BY_UID                               11170051
111800                   ,FOB_CDE                                       11180051
111900                   ,POE_CDE)                                      11190051
112000             VALUES (                                             11200051
112100                                                                  11210051
112200*  WILL WORK IN     (SELECT (MAX(SHIPT_NBR) + 1)                  11220051
112300*  VERSION 8 ONLY    FROM TPLNSHP)                                11230051
112400                                                                  11240051
112500                     :PLNSHP-SHIPT-NBR                            11250051
112600                   , :PLNSHP-VER-NBR                              11260051
112700                   , :PLNSHP-VER-STATUS-CDE                       11270051
112800                   , :PLNSHP-SHIPT-TYP-CDE                        11280051
112900                   , :PLNSHP-SHIPT-DEST-NBR                       11290051
113000                   , :PLNSHP-SHIPT-POINT-TXT                      11300051
113100                   , :PLNSHP-FOB-POINT-TXT                        11310051
113200                   , :PLNSHP-FRGT-PAYT-CDE                        11320051
113300                   , :PLNSHP-VEND-FRGT-PCT                        11330051
113400                   , :PLNSHP-KOHLS-FRGT-PCT                       11340051
113500                   , :PLNSHP-LATE-SHIPT-IND                       11350051
113600                   , :PLNSHP-EARLY-SHIPT-IND                      11360051
113700                   , :PLNSHP-PARTIAL-SHIPT-IND                    11370051
113800                   , :PLNSHP-BCKORDS-PERMTD-IND                   11380051
113900                   , :PLNSHP-PORT-ENTR-DESC                       11390051
114000                   , :PLNSHP-STRT-FCTRY-DTE                       11400051
114100                   , :PLNSHP-LAST-FCTRY-DTE                       11410051
114200                   , :PLNSHP-DONT-SHIP-BEF-DTE                    11420051
114300                   , :PLNSHP-CAN-IFNOT-SHIP-DTE                   11430051
114400                   , :PLNSHP-EXT-CAN-DTE                          11440051
114500                   , CURRENT TIMESTAMP                            11450051
114600                   , :PLNSHP-STATUS-CDE                           11460051
114700                   , :PLNSHP-ENT-ID                               11470051
114800                   , :PLNSHP-PO-NBR                               11480051
114900                   , :PLNSHP-LAST-UPD-BY-UID                      11490051
115000                   , :PLNSHP-FOB-CDE                              11500051
115100                   , :PLNSHP-POE-CDE)                             11510051
115200         END-EXEC                                                 11520051
115300                                                                  11530051
115400         MOVE SQLCODE                     TO XL011-SQLCODE        11540051
115500*                                                                 11550051
115600         EVALUATE TRUE                                            11560051
115700           WHEN SQLCODE = ZERO                                    11570051
115800               SET PS-PROCESS-COMPLETE TO TRUE                    11580051
115900           WHEN SQLCODE = -803                                    11590051
116000*              TRY TO GET ANOTHER UNIQUE KEY                      11600051
116100               PERFORM 2110-GET-SHIPMENT-NBR                      11610051
116200           WHEN SQLCODE = -904                                    11620051
116300           WHEN SQLCODE = -911                                    11630051
116400           WHEN SQLCODE = -913                                    11640051
116500                 CONTINUE                                         11650051
116600           WHEN OTHER                                             11660051
116700             MOVE '7000-TPLNSHP-BRAND-NEW'                        11670051
116800                                      TO XL011-ERROR-PARAGRAPH    11680051
116900             MOVE PLNSHP-SHIPT-NBR    TO PV-MSG-SHIPT-NBR         11690051
117000             MOVE PLNSHP-VER-NBR      TO PV-MSG-SHIPT-VER         11700051
117100             MOVE PV-PLNSHP-MSG       TO XL011-ERROR-TEXT         11710051
117200             SET XL011-SQL-ERROR      TO TRUE                     11720051
117300               SET PS-PROCESS-COMPLETE TO TRUE                    11730051
117400         END-EVALUATE                                             11740051
117500     END-PERFORM.                                                 11750051
117600                                                                  11760051
117700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     11770051
117800                            SQLCODE NOT = ZERO                    11780051
117900         MOVE '7000-TPLNSHP-BRAND-NEW'                            11790051
118000                                      TO XL011-ERROR-PARAGRAPH    11800051
118100         MOVE PLNSHP-SHIPT-NBR        TO PV-MSG-SHIPT-NBR         11810051
118200         MOVE PLNSHP-VER-NBR          TO PV-MSG-SHIPT-VER         11820051
118300         MOVE PV-PLNSHP-MSG           TO XL011-ERROR-TEXT         11830051
118400         SET XL011-SQL-ERROR          TO TRUE                     11840051
118500         SET PS-PROCESS-COMPLETE      TO TRUE                     11850051
118600     END-IF.                                                      11860051
118700                                                                  11870051
118800******************************************************************11880051
118900**PASS SQLCODE TO CALLING AND EXIT PROGRAM                        11890051
119000******************************************************************11900051
119100 9999-WRAPUP.                                                     11910051
119200                                                                  11920051
119300     IF XL011-DEBUG-YES                                           11930051
119400         DISPLAY 'XLKUP006 - 9999-WRAPUP'                         11940051
119500     END-IF                                                       11950051
119600                                                                  11960051
119700     MOVE SQLCA                       TO XL011-SQLCA.             11970051
119800                                                                  11980051
119900*    EXIT PROGRAM.                                                11990051
