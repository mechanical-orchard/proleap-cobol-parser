000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    SVKCS106.                                         00040000
000500 AUTHOR.        JIM LEIKNESS.                                     00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  04-15-04.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    U106 - ADD/UPDATE/DELETE SV CARD STOCK                     * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM ADDS, UPDATES, OR DELETES STORED VALUE CARD   * 00130000
001400*    STOCK ID'S.                                                * 00140000
001500*---------------------------------------------------------------* 00150000
001501* CHANGE LOG:                                                     00150100
001502*                                                                 00150200
001510* 09/01/2021 GERMAN BANDA                    WR/IR #: CHG0261091  00151000
001520*            - CHANGE CALL OF DPKUT100 TO                       * 00152000
001530*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00153000
001540*              MAKING THE CALL DYNAMIC VS STATIC                * 00154000
001550*                                                               * 00155000
001560*---------------------------------------------------------------* 00155100
092821* 09/28/2021 - DAN PAYNTER                                      * 00155200
092821* CHANGE#    - CHG0261461                                       * 00155300
092821*              ADDED CODE TO SUPPORT THE ENTRY OF TWO NEW       * 00155400
092821*              VIRTUAL KMC TYPES (KMCVIR AND KMCVRINT)          * 00155500
092821*---------------------------------------------------------------* 00156000
CICS  *  11/28/2022 - RONNA MCDONALD               WR/IR #: CHG0278721  00157001
CICS  *                                                                 00158000
CICS  *  ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL       00159000
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00159100
CICS  *-----------------------------------------------------------------00159200
001600                                                                  00160000
001700 ENVIRONMENT DIVISION.                                            00170000
001800                                                                  00180000
001900 DATA DIVISION.                                                   00190000
002000                                                                  00200000
002100 WORKING-STORAGE SECTION.                                         00210000
002200                                                                  00220000
002300 01  DK-DB2-KEYS.                                                 00230000
002400     05  DK-CRD-TYP-CDE           PIC S9(01)     COMP-3           00240000
002500                                              VALUE ZERO.         00250000
002600     05  DK-CRD-STK-TYP-ID        PIC  X(08)  VALUE SPACE.        00260000
002700     05  DK-PRE-DNNTD-CRD-AMT     PIC S9(04)V99  COMP-3           00270000
002800                                              VALUE ZERO.         00280000
002900     05  DK-UPC-NBR               PIC S9(15)  VALUE  0 COMP-3.    00290000
003000*                                                                 00300000
003100 01  PC-PROGRAM-CONSTANTS.                                        00310000
003200     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'SVKCS106'.  00320000
003300     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'SV106A  '.  00330000
003400     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'SVKM106 '.  00340000
003500     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00350000
003600                                              COMP.               00360000
003700     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00370000
003800                                              COMP.               00380000
003900     05  PC-MAX-ITEMS             PIC S9(04)  VALUE  +15          00390000
004000                                              COMP.               00400000
004100     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE  +1           00410000
004200                                              COMP.               00420000
004300     05  PC-DEPT-NBR              PIC S9(04)  VALUE  +0983        00430000
004400                                              COMP-3.             00440000
004500     05  PC-INTER-APPL-CODES.                                     00450000
004600         10  PC-INTER-APPL-ADD    PIC  X(01)  VALUE 'A'.          00460000
004700         10  PC-INTER-APPL-UPD    PIC  X(01)  VALUE 'U'.          00470000
004800         10  PC-INTER-APPL-DEL    PIC  X(01)  VALUE 'D'.          00480000
004900     05  PC-INQ                   PIC  X(01)  VALUE 'I'.          00490000
005000     05  PC-KMRC-DEFAULT          PIC  X(01)  VALUE 'K'.          00500000
005100     05  PC-NO                    PIC  X(01)  VALUE 'N'.          00510000
005200                                                                  00520000
005300     05  PC-TSYMSG-NUMBERS.                                       00530000
005400         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       00540000
005500         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00550000
005600         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00560000
005700         10  PC-TSYMSG-00010      PIC  9(05)  VALUE  00010.       00570000
005800         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.       00580000
005900         10  PC-TSYMSG-00045      PIC  9(05)  VALUE  00045.       00590000
006000         10  PC-TSYMSG-00046      PIC  9(05)  VALUE  00046.       00600000
006100         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00610000
006200         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00620000
006300         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00630000
006400         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       00640000
006500         10  PC-TSYMSG-00113      PIC  9(05)  VALUE  00113.       00650000
006600         10  PC-TSYMSG-00115      PIC  9(05)  VALUE  00115.       00660000
006700         10  PC-TSYMSG-00117      PIC  9(05)  VALUE  00117.       00670000
006800         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       00680000
006900         10  PC-TSYMSG-00149      PIC  9(05)  VALUE  00149.       00690000
007000         10  PC-TSYMSG-00302      PIC  9(05)  VALUE  00302.       00700000
007100         10  PC-TSYMSG-00349      PIC  9(05)  VALUE  00349.       00710000
007200         10  PC-TSYMSG-01607      PIC  9(05)  VALUE  01607.       00720000
007300         10  PC-TSYMSG-01964      PIC  9(05)  VALUE  01964.       00730000
007400         10  PC-TSYMSG-03256      PIC  9(05)  VALUE  03256.       00740000
007500         10  PC-TSYMSG-03257      PIC  9(05)  VALUE  03257.       00750000
007600         10  PC-TSYMSG-03271      PIC  9(05)  VALUE  03271.       00760000
007700*                                                                 00770000
007800 01  PS-PROGRAM-SWITCHES.                                         00780000
007900     05  PS-ERROR-SW                    PIC  X(01)  VALUE  'N'.   00790000
008000         88  PS-ERROR                               VALUE  'Y'.   00800000
008100         88  PS-NO-ERROR                            VALUE  'N'.   00810000
008200     05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.   00820000
008300         88  PS-LIST-END                             VALUE 'Y'.   00830000
008400         88  PS-NO-LIST-END                          VALUE 'N'.   00840000
008500                                                                  00850000
008600*                                                                 00860000
008700 01  PV-PROGRAM-VARIABLES.                                        00870000
008800     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00880000
008900                                              COMP SYNC.          00890000
009000     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            00900000
009100                                              COMP SYNC.          00910000
009200     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0            00920000
009300                                              COMP SYNC.          00930000
009400     05  PV-UPC-NBR.                                              00940000
009500         10 PV-UPC-NBR-ONLY           PIC  9(11).                 00950000
009600         10 FILLER                    PIC  9(01).                 00960000
009700                                                                  00970000
009800 01  IV-INDICATOR-VARIABLES.                                      00980000
009900     05  IV-CMNT-TXT              PIC S9(04)  VALUE +0            00990000
010000                                              COMP SYNC.          01000000
010100                                                                  01010000
010200**--------------------------------------------------------------**01020000
010300** THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING        **01030000
010400** SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.         **01040000
010500**--------------------------------------------------------------**01050000
010600     COPY SVWS009.                                                01060000
010700                                                                  01070000
010800*----------------------------------------------------------------*01080000
010900*    MAP LAYOUT                                                  *01090000
011000*----------------------------------------------------------------*01100000
011100     COPY SVKM106.                                                01110000
011200                                                                  01120000
011300*----------------------------------------------------------------*01130000
011400*    ATTRIBUTE SETTINGS COPYBOOK.                                *01140000
011500*----------------------------------------------------------------*01150000
011600     COPY DPWS015.                                                01160000
011700                                                                  01170000
011800*----------------------------------------------------------------*01180000
011900*    FUNCTION KEYS COPYBOOK                                      *01190000
012000*----------------------------------------------------------------*01200000
012100     COPY DPWS016.                                                01210000
012200                                                                  01220000
012300*----------------------------------------------------------------*01230000
012400* STORED VALUE CONSTANTS COPYBOOK                                *01240000
012500*----------------------------------------------------------------*01250000
012600     COPY SVWS004.                                                01260000
012700                                                                  01270000
012800**--------------------------------------------------------------**01280000
012900** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01290000
013000** SUB-ROUTINE (DPKUT100).                                      **01300000
013100**--------------------------------------------------------------**01310000
013200     COPY DPWS010I.                                               01320000
013300                                                                  01330000
013400**--------------------------------------------------------------**01340000
013500** THE CALLING PARAMETER LIST FOR THE CICS ARCHITECTURE         * 01350000
013600** APPLICATION PROGRAMMING INTERFACE MODULE                     **01360000
013700**--------------------------------------------------------------**01370000
013800     COPY DPWS030.                                                01380000
CICS       COPY DPWS930.                                                01381000
013900                                                                  01390000
014000**--------------------------------------------------------------**01400000
014100*    STANDARD COMMAREA.                                           01410000
014200**--------------------------------------------------------------**01420000
014300     COPY DPWS020.                                                01430000
014400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01440000
014500                                                                  01450000
014600***************************************************************** 01460000
014700*    INTER-APPLICATION COMMAREA.                                  01470000
014800***************************************************************** 01480000
014900                                                                  01490000
015000         10  INTER-APPL-COMM-AREA PIC X(200).                     01500000
015100     COPY SVWS008.                                                01510000
015200***************************************************************** 01520000
015300*    SPECIFIC COMMMAREA FOR SVKCS106.                             01530000
015400***************************************************************** 01540000
015500         10  ASC-SPECIFIC-COMMAREA.                               01550000
015600             15  ASC-INT-APPL-FORMAT-IND    PIC  X(01).           01560000
015700             15  ASC-CRD-TYP-CDE            PIC S9(04) COMP.      01570000
015800             15  ASC-STK-TYP-ID             PIC  X(08).           01580000
015900             15  ASC-PRE-DNNTD-CRD-AMT      PIC  X(07).           01590000
016000             15  ASC-PRE-DNNTD-CRD-9        PIC  9(04)V99.        01600000
016100             15  ASC-CMMT                   PIC  X(30).           01610000
016200             15  ASC-DESC                   PIC  X(25).           01620000
016300             15  ASC-REPLENISH              PIC  X(01).           01630000
016400             15  ASC-USE-SELECTION-QUEUE-IND                      01640000
016500                                            PIC  X(01).           01650000
016600                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 01660000
016700             15  ASC-SEL-QUEUE-NAME         PIC  X(08).           01670000
016800             15  ASC-NUMBER-OF-TS-ITEMS     PIC S9(05)  COMP-3.   01680000
016900             15  ASC-NUMBER-OF-SELECTED-ITEMS                     01690000
017000                                            PIC S9(09)  COMP-3.   01700000
017100             15  ASC-SEL-SUB                PIC S9(04)  COMP.     01710000
017200             15  ASC-SEL-ITEM               PIC S9(04)  COMP.     01720000
017300             15  ASC-ERROR-SW               PIC  X(01).           01730000
017400                 88  ASC-ERROR                         VALUE 'Y'. 01740000
017500                 88  ASC-NO-ERROR                      VALUE 'N'. 01750000
017600             15  ASC-CHANGE-MADE-SW         PIC  X(01).           01760000
017700                 88  ASC-CHANGE-MADE                   VALUE 'Y'. 01770000
017800                 88  ASC-NO-CHANGE-MADE                VALUE 'N'. 01780000
017900             15  ASC-FUNC-SW                PIC  X(01).           01790000
018000                 88  ASC-ADD                           VALUE 'A'. 01800000
018100                 88  ASC-DELETE                        VALUE 'D'. 01810000
018200                 88  ASC-UPDATE                        VALUE 'U'. 01820000
018300             15  ASC-UPC-NBR                PIC  9(12).           01830000
018400         10  FILLER                         PIC  X(2749).         01840000
018500                                                                  01850000
018600                                                                  01860000
018700*----------------------------------------------------------------*01870000
018800*    ABEND PROCESSING COPYBOOK.                                  *01880000
018900*----------------------------------------------------------------*01890000
019000     COPY DPWS013.                                                01900000
019100                                                                  01910000
019200                                                                  01920000
019300*    DB2 AREA FOR SVT_CRD_STK_DNMNTN                              01930000
019400                                                                  01940000
019500     EXEC SQL                                                     01950000
019600          INCLUDE SVT00008                                        01960000
019700     END-EXEC.                                                    01970000
019800                                                                  01980000
019900*    DB2 AREA FOR SVT_CRD_PROD                                    01990000
020000                                                                  02000000
020100     EXEC SQL                                                     02010000
020200          INCLUDE SVT00000                                        02020000
020300     END-EXEC.                                                    02030000
020400                                                                  02040000
020500*    DB2 AREA FOR COMMUNICATIONS                                  02050000
020600                                                                  02060000
020700     EXEC SQL                                                     02070000
020800          INCLUDE SQLCA                                           02080000
020900     END-EXEC.                                                    02090000
021000                                                                  02100000
021100                                                                  02110000
021200                                                                  02120000
021300 LINKAGE SECTION.                                                 02130000
021400                                                                  02140000
021500 01  DFHCOMMAREA.                                                 02150000
021600     05  FILLER                         OCCURS  1 TO 2865 TIMES   02160000
021700                                        DEPENDING ON EIBCALEN.    02170000
021800         10  FILLER                     PIC X.                    02180000
021900                                                                  02190000
022000                                                                  02200000
022100 PROCEDURE DIVISION.                                              02210000
022200***************************************************************** 02220000
022300** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02230000
022400** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02240000
022500** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02250000
022600**                                                             ** 02260000
022700***************************************************************** 02270000
022800 0000-MAIN-MODULE.                                                02280000
022900     INITIALIZE DP030-CICS-API-FIELDS.                            02290000
023000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02300000
023100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02310000
023200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02320000
023300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02330000
023400     MOVE LENGTH OF SV106AI        TO DP030-MAP-LENGTH (1).       02340000
023500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02350000
023600     PERFORM 0001-CALL-CICS-ARCH-API.                             02360000
023700*                                                                 02370000
023800     PERFORM 1000-CONTROL-PROCESSING                              02380000
023900*                                                                 02390000
024000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02400000
024100     PERFORM 0001-CALL-CICS-ARCH-API.                             02410000
024200                                                                  02420000
024300 0001-CALL-CICS-ARCH-API.                                         02430000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02440000
024500                                    DFHCOMMAREA                   02450000
024600                                    DP030-CICS-API-FIELDS         02460000
024700                                    DP020-STANDARD-COMMAREA       02470000
024800                                    SV106AI.                      02480000
024900*                                                                 02490000
025000     IF  DP030-RC-CALL-SUCCESSFUL                                 02500000
025100         CONTINUE                                                 02510000
025200     ELSE                                                         02520000
025300         SET DP013-NO-ROLLBACK                                    02530000
025400             DP013-XCTL-DISPLAY-RESTART                           02540000
025500             DP013-CICS-ABEND      TO TRUE                        02550000
025600         MOVE 'BEFORE 0000-MAIN-MODULE'                           02560000
025700                                   TO DP013-PARAGRAPH             02570000
CICS           MOVE 'CALL TO CICS ARCH APIL NOT SUCCESSFUL, RETURN CODE 02580000
CICS  -             'ON NEXT LINE'       TO DP013-MESSAGE-TEXT (2)      02590000
026000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02600000
026100         PERFORM DP013-0000-PROCESS-ABEND                         02610000
026200     END-IF.                                                      02620000
026300                                                                  02630000
026400*----------------------------------------------------------------*02640000
026500*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02650000
026600*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02660000
026700*----------------------------------------------------------------*02670000
026800                                                                  02680000
026900 1000-CONTROL-PROCESSING.                                         02690000
027000                                                                  02700000
027100     EVALUATE TRUE                                                02710000
027200         WHEN DP020-NEXT-ACT-INITIAL                              02720000
027300             PERFORM 1100-PREPARE-INTER-APPL-COMM                 02730000
027400             PERFORM 3200-RESET-ATTRIBUTES                        02740000
027500             PERFORM 4000-BUILD-INITIAL-PANEL                     02750000
027600             IF  SQLCODE = +100                                   02760000
027700                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            02770000
027800*                -- DATA DOES NOT EXIST --                        02780000
027900                 MOVE PC-TSYMSG-00148                             02790000
028000                                  TO DP020-MSG-NUMBER             02800000
028100                 SET DP020-MSG-INFORMATIONAL TO TRUE              02810000
028200             END-IF                                               02820000
028300                                                                  02830000
028400         WHEN DP020-NEXT-ACT-READ-MAP                             02840000
028500             SET ASC-NO-CHANGE-MADE TO TRUE                       02850000
028600             PERFORM 2000-PROCESS-PANEL                           02860000
028700                                                                  02870000
028800         WHEN DP020-NEXT-ACT-RETURN                               02880000
028900             MOVE PC-MAX-ITEMS TO SV009-MAX-ITEMS                 02890000
029000             PERFORM 4000-BUILD-INITIAL-PANEL                     02900000
029100                                                                  02910000
029200         WHEN OTHER                                               02920000
029300             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             02930000
029400             SET DP020-MSG-FATAL TO TRUE                          02940000
029500             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                02950000
029600     END-EVALUATE.                                                02960000
029700                                                                  02970000
029800******************************************************************02980000
029900** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **02990000
030000** INTER-APPLICATION FORMAT CODE.                               **03000000
030100******************************************************************03010000
030200 1100-PREPARE-INTER-APPL-COMM.                                    03020000
030300     INITIALIZE ASC-SPECIFIC-COMMAREA.                            03030000
030400     MOVE DP020-INT-APPL-FORMAT-IND                               03040000
030500                                TO ASC-INT-APPL-FORMAT-IND.       03050000
030600     EVALUATE DP020-INT-APPL-FORMAT-IND                           03060000
030700         WHEN PC-INTER-APPL-ADD                                   03070000
030800             SET ASC-ADD TO TRUE                                  03080000
030900             MOVE PC-KMRC-DEFAULT TO ASC-CRD-TYP-CDE              03090000
031000             MOVE PC-NO           TO ASC-REPLENISH                03100000
031100             PERFORM 3200-RESET-ATTRIBUTES                        03110000
031200                                                                  03120000
031300         WHEN PC-INTER-APPL-UPD                                   03130000
031400             SET ASC-UPDATE        TO TRUE                        03140000
031500             SET ASC-USE-SELECTION-QUEUE                          03150000
031600                                   TO TRUE                        03160000
031700             MOVE SV008-NUMBER-OF-SELECTED-ITEMS                  03170000
031800                                   TO ASC-NUMBER-OF-SELECTED-ITEMS03180000
031900             MOVE SV008-NUMBER-OF-TS-ITEMS                        03190000
032000                                   TO ASC-NUMBER-OF-TS-ITEMS      03200000
032100             MOVE SV008-SEL-QUEUE-NAME                            03210000
032200                                   TO ASC-SEL-QUEUE-NAME          03220000
032300             PERFORM 1120-PREPARE-LIST-ENTRY                      03230000
032400                                                                  03240000
032500         WHEN PC-INTER-APPL-DEL                                   03250000
032600             SET ASC-DELETE        TO TRUE                        03260000
032700             SET ASC-USE-SELECTION-QUEUE                          03270000
032800                                   TO TRUE                        03280000
032900             MOVE SV008-NUMBER-OF-SELECTED-ITEMS                  03290000
033000                                   TO ASC-NUMBER-OF-SELECTED-ITEMS03300000
033100             MOVE SV008-NUMBER-OF-TS-ITEMS                        03310000
033200                                   TO ASC-NUMBER-OF-TS-ITEMS      03320000
033300             MOVE SV008-SEL-QUEUE-NAME                            03330000
033400                                   TO ASC-SEL-QUEUE-NAME          03340000
033500             PERFORM 1120-PREPARE-LIST-ENTRY                      03350000
033600                                                                  03360000
033700         WHEN OTHER                                               03370000
033800             IF  DP020-NAV-KEY-DATA > SPACE                       03380000
033900                 PERFORM 1110-EDIT-NAV-KEY                        03390000
034000             ELSE                                                 03400000
034100                 MOVE PC-TSYMSG-00148                             03410000
034200                                   TO DP020-MSG-NUMBER            03420000
034300                 SET DP020-MSG-FATAL                              03430000
034400                     DP020-NEXT-ACT-APPL-ERROR                    03440000
034500                                   TO TRUE                        03450000
034600             END-IF                                               03460000
034700     END-EVALUATE.                                                03470000
034800                                                                  03480000
034900******************************************************************03490000
035000** EDIT THE KEY ENTERED BY THE USER INTO THE KEY FIELD OF THE   **03500000
035100** COMMAND LINE.  A VALID MESSAGE NUMBER IS THE ONLY KEY        **03510000
035200** ACCEPTED.                                                    **03520000
035300******************************************************************03530000
035400 1110-EDIT-NAV-KEY.                                               03540000
035500     IF  ASC-CRD-TYP-CDE > 0                                      03550000
035600         MOVE DP020-NAV-KEY-DATA   TO DP010I-UNEDITED-FIELD       03560000
035700         MOVE LENGTH OF ASC-CRD-TYP-CDE                           03570000
035800                                   TO DP010I-MAXIMUM-DIGITS       03580000
035900         MOVE 2                    TO DP010I-MAXIMUM-DECIMALS     03590000
036000         SET DP010I-NEGATIVE-NOT-ALLOWED                          03600000
036100                                   TO TRUE                        03610000
036210         CALL DP010I-NUMERIC-EDIT-ROUTINE                         03621000
036220                         USING DP010I-NUMERIC-EDIT-AREA           03622000
036300         IF  DP010I-ERROR-DETECTED                                03630000
036400             SET PS-ERROR                                         03640000
036500                 DP020-MSG-FATAL   TO TRUE                        03650000
036600*            -- INVALID DATA IN KEY FIELD ---                     03660000
036700             MOVE PC-TSYMSG-00302  TO DP020-MSG-NUMBER            03670000
036800             SET DP020-NEXT-ACT-APPL-ERROR                        03680000
036900                                   TO TRUE                        03690000
037000         ELSE                                                     03700000
037100             MOVE DP010I-NUMERIC-FIELD                            03710000
037200                                   TO ASC-CRD-TYP-CDE             03720000
037300         END-IF                                                   03730000
037400     END-IF.                                                      03740000
037500*----------------------------------------------------------------*03750000
037600* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *03760000
037700* STORAGE QUEUE PASSED FROM THE LIST.                            *03770000
037800*----------------------------------------------------------------*03780000
037900 1120-PREPARE-LIST-ENTRY.                                         03790000
038000     MOVE SV009-MAX-ITEMS  TO  ASC-SEL-SUB.                       03800000
038100     MOVE ZERO             TO  ASC-SEL-ITEM.                      03810000
038200     PERFORM 2140-GET-NEXT-SELECTION.                             03820000
038300*----------------------------------------------------------------*03830000
038400* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *03840000
038500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *03850000
038600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *03860000
038700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *03870000
038800* FUNCTION KEYS CAN GET THIS FAR.                                *03880000
038900*----------------------------------------------------------------*03890000
039000                                                                  03900000
039100 2000-PROCESS-PANEL.                                              03910000
039200                                                                  03920000
039300     EVALUATE TRUE                                                03930000
039400         WHEN DP020-SRC-AID = DP016-CLEAR                         03940000
039500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03950000
039600                                                                  03960000
039700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    03970000
039800             SET DP030-DONT-ERASE                                 03980000
039900                 DP030-SEND-DATAONLY (PC-APPL-MAP)                03990000
040000                                     TO TRUE                      04000000
040100             PERFORM 4000-BUILD-INITIAL-PANEL                     04010000
040200                                                                  04020000
040300         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             04030000
040400            IF ASC-UPDATE OR ASC-DELETE                           04040000
040500               PERFORM 2140-GET-NEXT-SELECTION                    04050000
040600               IF PS-LIST-END                                     04060000
040700                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            04070000
040800                  SET PS-NO-LIST-END  TO TRUE                     04080000
040900               ELSE                                               04090000
041000                  PERFORM 4000-BUILD-INITIAL-PANEL                04100000
041100               END-IF                                             04110000
041200            ELSE                                                  04120000
041300               SET ASC-ERROR                                      04130000
041400                   DP020-MSG-FATAL   TO TRUE                      04140000
041500*------------- INVALID KEY -----                                  04150000
041600               MOVE PC-TSYMSG-00045  TO DP020-MSG-NUMBER          04160000
041700               SET DP030-SET-CURSOR-APPL-1 TO TRUE                04170000
041800            END-IF                                                04180000
041900                                                                  04190000
042000         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             04200000
042100            IF ASC-UPDATE OR ASC-DELETE                           04210000
042200               PERFORM 2120-GET-PREV-ITEM                         04220000
042300               IF PS-LIST-END                                     04230000
042400                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           04240000
042500                   SET PS-NO-LIST-END  TO TRUE                    04250000
042600               ELSE                                               04260000
042700                   PERFORM 4000-BUILD-INITIAL-PANEL               04270000
042800               END-IF                                             04280000
042900            ELSE                                                  04290000
043000               SET ASC-ERROR                                      04300000
043100                   DP020-MSG-FATAL   TO TRUE                      04310000
043200*------------- INVALID KEY -----                                  04320000
043300               MOVE PC-TSYMSG-00045  TO DP020-MSG-NUMBER          04330000
043400               SET DP030-SET-CURSOR-APPL-1 TO TRUE                04340000
043500            END-IF                                                04350000
043600                                                                  04360000
043700         WHEN OTHER                                               04370000
043800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04380000
043900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04390000
044000             IF  ASC-NO-ERROR                                     04400000
044100                 SET DP030-CONTINUE-GO TO TRUE                    04410000
044200                 PERFORM 2100-CHECK-FUNCTION-KEY                  04420000
044300             ELSE                                                 04430000
044400                 SET DP030-OVERRIDE-GO TO TRUE                    04440000
044500             END-IF                                               04450000
044600     END-EVALUATE.                                                04460000
044700                                                                  04470000
044800*----------------------------------------------------------------*04480000
044900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *04490000
045000* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *04500000
045100* FROM THE CICS ARCHITECTURE API.                                *04510000
045200*----------------------------------------------------------------*04520000
045300                                                                  04530000
045400 2100-CHECK-FUNCTION-KEY.                                         04540000
045500     EVALUATE TRUE                                                04550000
045600         WHEN DP020-SRC-AID = DP016-ENTER                         04560000
045700             CONTINUE                                             04570000
045800                                                                  04580000
045900*            -- F13 ADD      --                                   04590000
046000         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04600000
046100             IF ASC-ADD                                           04610000
046200                 SET DP030-CONTINUE-GO                            04620000
046300                     DP020-MSG-INFORMATIONAL                      04630000
046400                                       TO TRUE                    04640000
046500                 PERFORM 5000-INSERT-CARD-STOCK                   04650000
046600             ELSE                                                 04660000
046700                 SET ASC-ERROR                                    04670000
046800                     DP020-MSG-FATAL   TO TRUE                    04680000
046900* -------------- INVALID KEY -----                                04690000
047000                 MOVE PC-TSYMSG-00045  TO DP020-MSG-NUMBER        04700000
047100                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              04710000
047200             END-IF                                               04720000
047300                                                                  04730000
047400*            -- F15 UPDATE   --                                   04740000
047500         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              04750000
047600             IF ASC-UPDATE                                        04760000
047700                 SET DP030-CONTINUE-GO                            04770000
047800                     DP020-MSG-INFORMATIONAL TO TRUE              04780000
047900                 IF ASC-CHANGE-MADE                               04790000
048000                     PERFORM 5025-UPDATE-CARD-STOCK               04800000
048100                 ELSE                                             04810000
048200                     MOVE PC-TSYMSG-00046  TO DP020-MSG-NUMBER    04820000
048300                     MOVE -1               TO ADESC01L            04830000
048400                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          04840000
048500                 END-IF                                           04850000
048600             ELSE                                                 04860000
048700                 SET ASC-ERROR                                    04870000
048800                     DP020-MSG-FATAL  TO TRUE                     04880000
048900* -------------- INVALID KEY -----                                04890000
049000                 MOVE PC-TSYMSG-00045  TO DP020-MSG-NUMBER        04900000
049100                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              04910000
049200             END-IF                                               04920000
049300                                                                  04930000
049400*            -- F16 DELETE   --                                   04940000
049500         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              04950000
049600             IF ASC-DELETE                                        04960000
049700                 SET DP030-CONTINUE-GO TO TRUE                    04970000
049800                 SET DP020-MSG-INFORMATIONAL TO TRUE              04980000
049900                 PERFORM 4100-SELECT                              04990000
050000                 PERFORM 5075-DELETE-CARD-STOCK                   05000000
050100             ELSE                                                 05010000
050200                 SET ASC-ERROR                                    05020000
050300                     DP020-MSG-FATAL  TO TRUE                     05030000
050400* -------------- INVALID KEY -----                                05040000
050500                 MOVE PC-TSYMSG-00045  TO DP020-MSG-NUMBER        05050000
050600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              05060000
050700             END-IF                                               05070000
050800*                                                                 05080000
050900         WHEN OTHER                                               05090000
051000             SET DP013-NO-ROLLBACK                                05100000
051100                 DP013-XCTL-DISPLAY-RESTART                       05110000
051200                 DP013-CICS-ABEND  TO TRUE                        05120000
051300             MOVE '2100-CHECK-FUNCTION-KEY'                       05130000
051400                                   TO DP013-PARAGRAPH             05140000
051500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05150000
051600                                   TO DP013-MESSAGE-TEXT (1)      05160000
051700             PERFORM DP013-0000-PROCESS-ABEND                     05170000
051800     END-EVALUATE.                                                05180000
051900*----------------------------------------------------------------*05190000
052000*  GET THE KEY OF THE PREVIOUS SELECTED OBJECT FROM THE          *05200000
052100*  SELECTED ITEMS TEMP STORAGE QUEUE.                            *05210000
052200*----------------------------------------------------------------*05220000
052300 2120-GET-PREV-ITEM.                                              05230000
052400     SUBTRACT +1 FROM ASC-SEL-SUB.                                05240000
052500     IF  ASC-SEL-SUB < +1                                         05250000
052600         SUBTRACT +1 FROM ASC-SEL-ITEM                            05260000
052700         MOVE SV009-MAX-ITEMS      TO ASC-SEL-SUB                 05270000
052800     END-IF.                                                      05280000
052900*                                                                 05290000
053000     IF  ASC-SEL-ITEM > ZERO                                      05300000
053100         PERFORM 9100-READ-SEL-QUEUE                              05310000
053200         MOVE SV009-CRD-TYPE-CDE(ASC-SEL-SUB)                     05320000
053300                                     TO ASC-CRD-TYP-CDE           05330000
053400         MOVE SV009-STK-TYP-ID(ASC-SEL-SUB)                       05340000
053500                                    TO ASC-STK-TYP-ID             05350000
053600         MOVE SV009-PRE-DNNTD-AMT-9(ASC-SEL-SUB)                  05360000
053700                                     TO ASC-PRE-DNNTD-CRD-9       05370000
053800         MOVE SV009-COMMENT(ASC-SEL-SUB)                          05380000
053900                                     TO ASC-CMMT                  05390000
054000     ELSE                                                         05400000
054100         MOVE +1                   TO ASC-SEL-ITEM                05410000
054200                                      ASC-SEL-SUB                 05420000
054300*        --- TOP OF LIST ---                                      05430000
054400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            05440000
054500         SET DP020-MSG-INFORMATIONAL                              05450000
054600                                   TO TRUE                        05460000
054700     END-IF.                                                      05470000
054800                                                                  05480000
054900*----------------------------------------------------------------*05490000
055000*  GET THE KEY OF THE NEXT SELECTED OBJECT FROM THE              *05500000
055100*  SELECTED ITEMS TEMP STORAGE QUEUE.                            *05510000
055200*----------------------------------------------------------------*05520000
055300 2140-GET-NEXT-SELECTION.                                         05530000
055400                                                                  05540000
055500     ADD +1                       TO ASC-SEL-SUB.                 05550000
055600     IF  ASC-SEL-SUB > SV009-MAX-ITEMS                            05560000
055700         ADD +1                   TO ASC-SEL-ITEM                 05570000
055800         MOVE +1                  TO ASC-SEL-SUB                  05580000
055900     END-IF.                                                      05590000
056000     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                05600000
056100         PERFORM 9100-READ-SEL-QUEUE                              05610000
056200         IF  SV009-ITEM (ASC-SEL-SUB) > ZERO                      05620000
056300             MOVE SV009-CRD-TYPE-CDE (ASC-SEL-SUB)                05630000
056400                                     TO ASC-CRD-TYP-CDE           05640000
056500             MOVE SV009-STK-TYP-ID (ASC-SEL-SUB)                  05650000
056600                                     TO ASC-STK-TYP-ID            05660000
056700             MOVE SV009-PRE-DNNTD-AMT-9 (ASC-SEL-SUB)             05670000
056800                                     TO ASC-PRE-DNNTD-CRD-9       05680000
056900             MOVE SV009-COMMENT (ASC-SEL-SUB)                     05690000
057000                                     TO ASC-CMMT                  05700000
057100             MOVE PC-INQ TO SV009-ACTION-SW (ASC-SEL-SUB)         05710000
057200             PERFORM 9200-REWRITE-SEL-QUEUE                       05720000
057300         ELSE                                                     05730000
057400             SUBTRACT +1 FROM ASC-SEL-SUB                         05740000
057500*            --- BOTTOM OF LIST ---                               05750000
057600             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             05760000
057700             SET DP020-MSG-INFORMATIONAL TO TRUE                  05770000
057800             SET PS-LIST-END             TO TRUE                  05780000
057900         END-IF                                                   05790000
058000     ELSE                                                         05800000
058100         SUBTRACT +1 FROM ASC-SEL-ITEM                            05810000
058200         MOVE SV009-MAX-ITEMS     TO ASC-SEL-SUB                  05820000
058300*        --- BOTTOM OF LIST ---                                   05830000
058400         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             05840000
058500         SET DP020-MSG-INFORMATIONAL TO TRUE                      05850000
058600         SET PS-LIST-END             TO TRUE                      05860000
058700     END-IF.                                                      05870000
058800                                                                  05880000
058900*----------------------------------------------------------------*05890000
059000* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *05900000
059100* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *05910000
059200* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *05920000
059300*----------------------------------------------------------------*05930000
059400                                                                  05940000
059500 2200-MOVE-SCREEN-TO-COMMAREA.                                    05950000
059600     IF  ATYP01L > ZERO                                           05960000
059700         MOVE ATYP01I             TO ASC-CRD-TYP-CDE              05970000
059800     ELSE                                                         05980000
059900         IF  ATYP01F = DP015-ERASE-EOF                            05990000
060000             MOVE ZERO            TO ASC-CRD-TYP-CDE              06000000
060100         END-IF                                                   06010000
060200     END-IF.                                                      06020000
060300                                                                  06030000
060400     IF  ASTK01L > ZERO                                           06040000
060500         MOVE ASTK01I             TO ASC-STK-TYP-ID               06050000
060600     ELSE                                                         06060000
060700         IF  ASTK01F = DP015-ERASE-EOF                            06070000
060800             MOVE SPACE           TO ASC-STK-TYP-ID               06080000
060900         END-IF                                                   06090000
061000     END-IF.                                                      06100000
061100                                                                  06110000
061200     IF  ADNM01L > ZERO                                           06120000
061300         MOVE ADNM01I             TO ASC-PRE-DNNTD-CRD-AMT        06130000
061400     ELSE                                                         06140000
061500         IF  ADNM01F = DP015-ERASE-EOF                            06150000
061600             MOVE ZERO            TO ASC-PRE-DNNTD-CRD-AMT        06160000
061700         END-IF                                                   06170000
061800     END-IF.                                                      06180000
061900                                                                  06190000
062000     IF  ADESC01L > ZERO                                          06200000
062100         MOVE ADESC01I            TO ASC-DESC                     06210000
062200         SET ASC-CHANGE-MADE      TO TRUE                         06220000
062300     ELSE                                                         06230000
062400         IF  ADESC01F = DP015-ERASE-EOF                           06240000
062500             MOVE  SPACE          TO ASC-DESC                     06250000
062600         END-IF                                                   06260000
062700     END-IF.                                                      06270000
062800                                                                  06280000
062900                                                                  06290000
063000     IF  AINST01L > ZERO                                          06300000
063100         MOVE AINST01I             TO ASC-CMMT                    06310000
063200         SET ASC-CHANGE-MADE      TO TRUE                         06320000
063300     ELSE                                                         06330000
063400         IF  AINST01F = DP015-ERASE-EOF                           06340000
063500             MOVE SPACE            TO ASC-CMMT                    06350000
063600         END-IF                                                   06360000
063700     END-IF.                                                      06370000
063800                                                                  06380000
063900     IF  AREPL01L > ZERO                                          06390000
064000         MOVE AREPL01I            TO ASC-REPLENISH                06400000
064100         SET ASC-CHANGE-MADE      TO TRUE                         06410000
064200     ELSE                                                         06420000
064300         IF  AREPL01F = DP015-ERASE-EOF                           06430000
064400             MOVE SPACE           TO ASC-REPLENISH                06440000
064500         END-IF                                                   06450000
064600     END-IF.                                                      06460000
064700                                                                  06470000
064800     IF  AUPC01L > ZERO                                           06480000
064900         MOVE AUPC01I             TO ASC-UPC-NBR                  06490000
065000                                     PV-UPC-NBR                   06500000
065100                                     DK-UPC-NBR                   06510000
065200         SET ASC-CHANGE-MADE      TO TRUE                         06520000
065300     ELSE                                                         06530000
065400         IF  AUPC01F = DP015-ERASE-EOF                            06540000
065500             MOVE ZEROES          TO ASC-UPC-NBR                  06550000
065600                                     PV-UPC-NBR                   06560000
065700                                     DK-UPC-NBR                   06570000
065800         END-IF                                                   06580000
065900     END-IF.                                                      06590000
066000                                                                  06600000
066100*----------------------------------------------------------------*06610000
066200* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *06620000
066300* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *06630000
066400* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *06640000
066500*----------------------------------------------------------------*06650000
066600                                                                  06660000
066700 3000-EDIT-DATA-IN-COMMAREA.                                      06670000
066800     PERFORM 3200-RESET-ATTRIBUTES.                               06680000
066900                                                                  06690000
067000     SET ASC-NO-ERROR TO TRUE.                                    06700000
067100                                                                  06710000
067200     IF ASC-CRD-TYP-CDE =(SV004-KMRC-CRD-TYP                      06720000
067300                          OR SV004-GIFT-CRD-TYP)                  06730000
067400        MOVE ASC-CRD-TYP-CDE TO  ATYP01O                          06740000
067500     ELSE                                                         06750000
067600        SET ASC-ERROR                                             06760000
067700            DP020-MSG-FATAL  TO TRUE                              06770000
067800*       --- INVALID VALUE ---                                     06780000
067900        MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER                 06790000
068000        MOVE DP015-UNP-ALP-BRT-OFF  TO ATYP01A                    06800000
068100        MOVE DP015-RED              TO ATYP01C                    06810000
068200        MOVE DP015-REVERSE          TO ATYP01H                    06820000
068300        MOVE -1                     TO ATYP01L                    06830000
068400        SET DP030-SET-CURSOR-APPL-1 TO TRUE                       06840000
068500     END-IF.                                                      06850000
068600                                                                  06860000
068700     IF ASC-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                      06870000
092821         IF ASC-STK-TYP-ID = SV004-VIR-KMC OR                     06871000
092821            ASC-STK-TYP-ID = SV004-VIR-INT-KMC                    06872000
092821             IF ASC-STK-TYP-ID = SV004-VIR-KMC                    06873000
092821                 MOVE SV004-VIRT-KMC-DESC       TO ASC-DESC       06873100
092821             ELSE                                                 06873200
092821                 MOVE SV004-VINT-KMC-DESC       TO ASC-DESC       06873300
092821             END-IF                                               06873400
092821         ELSE                                                     06874000
092821            MOVE SV004-STK-DESC-SHRT-KMRC-CRD TO ASC-STK-TYP-ID   06874100
092821            MOVE SV004-STK-DESC-LONG-KMRC-CRD TO ASC-DESC         06874200
092821         END-IF                                                   06875000
069000     END-IF.                                                      06901000
069100*                                                                 06910000
069200     IF (ASC-ERROR OR ASC-DELETE)                                 06920000
069300        CONTINUE                                                  06930000
069400     ELSE                                                         06940000
069500        IF ASC-PRE-DNNTD-CRD-AMT > SPACE                          06950000
069600            MOVE ASC-PRE-DNNTD-CRD-AMT TO DP010I-UNEDITED-FIELD   06960000
069700            MOVE LENGTH OF ASC-PRE-DNNTD-CRD-AMT                  06970000
069800                                       TO DP010I-MAXIMUM-DIGITS   06980000
069900            MOVE 2            TO DP010I-MAXIMUM-DECIMALS          06990000
070000            SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE               07000000
070100            CALL DP010I-NUMERIC-EDIT-ROUTINE                      07010000
070200                                USING DP010I-NUMERIC-EDIT-AREA    07020000
070300            IF DP010I-ERROR-DETECTED                              07030000
070400                SET ASC-ERROR  TO TRUE                            07040000
070500                MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER          07050000
070600                MOVE DP015-UNP-ALP-BRT-OFF                        07060000
070700                                      TO ADNM01A                  07070000
070800                MOVE DP015-RED     TO ADNM01C                     07080000
070900                MOVE DP015-REVERSE TO ADNM01H                     07090000
071000                MOVE -1            TO ADNM01L                     07100000
071100                SET DP030-SET-CURSOR-APPL-1                       07110000
071200                                      TO TRUE                     07120000
071300            ELSE                                                  07130000
071400                MOVE DP010I-NUMERIC-FIELD                         07140000
071500                                      TO ASC-PRE-DNNTD-CRD-9      07150000
071600            END-IF                                                07160000
071700        ELSE                                                      07170000
071800           IF ASC-ADD                                             07180000
071900              MOVE ZEROS              TO ADNM01O                  07190000
072000                                         ASC-PRE-DNNTD-CRD-9      07200000
072100           END-IF                                                 07210000
072200        END-IF                                                    07220000
072300     END-IF.                                                      07230000
072400                                                                  07240000
072500     IF (ASC-ERROR OR ASC-DELETE)                                 07250000
072600         CONTINUE                                                 07260000
072700     ELSE                                                         07270000
072800         IF ASC-PRE-DNNTD-CRD-9 = SV004-DENOM-0                   07280000
072900                                   OR SV004-DENOM-10              07290000
073000                                   OR SV004-DENOM-15              07300000
073100                                   OR SV004-DENOM-20              07310000
073200                                   OR SV004-DENOM-25              07320000
073300                                   OR SV004-DENOM-30              07330000
073400                                   OR SV004-DENOM-45              07340000
073500                                   OR SV004-DENOM-50              07350000
073600                                   OR SV004-DENOM-100             07360000
073700                                   OR SV004-DENOM-500             07370000
073800            MOVE ASC-PRE-DNNTD-CRD-9 TO ADNM01O                   07380000
073900         ELSE                                                     07390000
074000            SET ASC-ERROR                                         07400000
074100                DP020-MSG-FATAL  TO TRUE                          07410000
074200*------------NOT A VALID PRE-DENOMINATION                         07420000
074300            MOVE PC-TSYMSG-03257 TO DP020-MSG-NUMBER              07430000
074400            MOVE DP015-UNP-ALP-BRT-OFF TO ADNM01A                 07440000
074500            MOVE DP015-RED       TO ADNM01C                       07450000
074600            MOVE DP015-REVERSE   TO ADNM01H                       07460000
074700            MOVE -1              TO ADNM01L                       07470000
074800            SET DP030-SET-CURSOR-APPL-1  TO TRUE                  07480000
074900         END-IF                                                   07490000
075000     END-IF.                                                      07500000
075100                                                                  07510000
075200     IF ASC-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                      07520000
092821         IF ASC-STK-TYP-ID = SV004-VIR-KMC OR                     07521000
092821            ASC-STK-TYP-ID = SV004-VIR-INT-KMC                    07522000
092821             IF ASC-STK-TYP-ID = SV004-VIR-KMC                    07523000
092821                 MOVE SV004-VIRT-KMC-DESC       TO ASC-DESC       07524000
092821             ELSE                                                 07525000
092821                 MOVE SV004-VINT-KMC-DESC       TO ASC-DESC       07526000
092821             END-IF                                               07527000
092821         ELSE                                                     07528000
092821             MOVE SV004-STK-DESC-LONG-KMRC-CRD TO ASC-DESC        07530000
092821         END-IF                                                   07531000
075400     END-IF.                                                      07540000
075500                                                                  07550000
075600     IF ASC-DESC > SPACE                                          07560000
075700         MOVE ASC-DESC                     TO ADESC01O            07570000
075800     ELSE                                                         07580000
075900         MOVE SV004-STK-DESC-SHRT-GIFT-CRD TO ASC-DESC            07590000
076000     END-IF                                                       07600000
076100                                                                  07610000
076200     MOVE ASC-CMMT   TO AINST01O.                                 07620000
076300                                                                  07630000
076400*----REPLENISH IND LOGIC                                          07640000
076500     IF (ASC-ERROR OR ASC-DELETE)                                 07650000
076600        CONTINUE                                                  07660000
076700     ELSE                                                         07670000
076800        IF ((ASC-ADD OR ASC-UPDATE)                               07680000
076900          AND (ASC-REPLENISH = 'Y' OR 'N'))                       07690000
077000           IF ASC-PRE-DNNTD-CRD-9 = SV004-DENOM-0                 07700000
077100             AND ASC-REPLENISH = 'Y' OR 'N'                       07710000
077200              MOVE ASC-REPLENISH TO AREPL01O                      07720000
077300           ELSE                                                   07730000
077400              IF ASC-PRE-DNNTD-CRD-9  NOT = SV004-DENOM-0         07740000
077500                AND ASC-REPLENISH = 'N' OR 'Y'                    07750000
077600                  MOVE ASC-REPLENISH TO AREPL01O                  07760000
077700              ELSE                                                07770000
077800                 SET ASC-ERROR                                    07780000
077900                     DP020-MSG-FATAL TO TRUE                      07790000
078000*-------PRE DENOMINATED ARE NOT REPLENISHABLE ----------          07800000
078100                 MOVE PC-TSYMSG-03271 TO DP020-MSG-NUMBER         07810000
078200                 MOVE DP015-UNP-ALP-BRT-OFF TO AREPL01A           07820000
078300                 MOVE DP015-RED TO AREPL01C                       07830000
078400                 MOVE DP015-REVERSE TO AREPL01H                   07840000
078500                 MOVE -1   TO AREPL01L                            07850000
078600                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             07860000
078700              END-IF                                              07870000
078800           END-IF                                                 07880000
078900        ELSE                                                      07890000
079000           SET ASC-ERROR                                          07900000
079100               DP020-MSG-FATAL TO TRUE                            07910000
079200*------------MUST    BE Y OR N                                    07920000
079300           MOVE PC-TSYMSG-00349 TO DP020-MSG-NUMBER               07930000
079400           MOVE DP015-UNP-ALP-BRT-OFF TO AREPL01A                 07940000
079500           MOVE DP015-RED    TO AREPL01C                          07950000
079600           MOVE DP015-REVERSE TO AREPL01H                         07960000
079700           MOVE -1           TO AREPL01L                          07970000
079800           SET DP030-SET-CURSOR-APPL-1  TO TRUE                   07980000
079900        END-IF                                                    07990000
080000     END-IF.                                                      08000000
080100                                                                  08010000
080200     IF (ASC-ERROR OR ASC-DELETE OR ASC-UPDATE)                   08020000
080300        CONTINUE                                                  08030000
080400     ELSE                                                         08040000
080500        IF ASC-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                   08050000
080600           MOVE SV004-KMRC-CARD-UPC-NBR TO PV-UPC-NBR             08060000
080700           MOVE PV-UPC-NBR-ONLY TO AUPC01O                        08070000
080800        ELSE                                                      08080000
080900           MOVE ASC-UPC-NBR  TO PV-UPC-NBR                        08090000
081000           MOVE PV-UPC-NBR-ONLY TO AUPC01O                        08100000
081100        END-IF                                                    08110000
081200     END-IF.                                                      08120000
081300                                                                  08130000
081400                                                                  08140000
081500*----------------------------------------------------------------*08150000
081600* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *08160000
081700* MAP.                                                           *08170000
081800*----------------------------------------------------------------*08180000
081900 3200-RESET-ATTRIBUTES.                                           08190000
082000     EVALUATE DP020-INT-APPL-FORMAT-IND                           08200000
082100         WHEN PC-INTER-APPL-ADD                                   08210000
082200             MOVE DP015-UNP-ALP-NOR-OFF  TO ATYP01A               08220000
082300                                            ASTK01A               08230000
082400                                            ADNM01A               08240000
082500                                            ASTK01A               08250000
082600                                            ADESC01A              08260000
082700                                            AINST01A              08270000
082800                                            AREPL01A              08280000
082900                                            AUPC01A               08290000
083000             MOVE DP015-GREEN            TO ATYP01C               08300000
083100                                            ASTK01C               08310000
083200                                            ADNM01C               08320000
083300                                            ASTK01C               08330000
083400                                            ADESC01C              08340000
083500                                            AINST01C              08350000
083600                                            AREPL01C              08360000
083700                                            AUPC01C               08370000
083800             MOVE DP015-UNDERLINE        TO ATYP01H               08380000
083900                                            ASTK01H               08390000
084000                                            ADNM01H               08400000
084100                                            ASTK01H               08410000
084200                                            ADESC01H              08420000
084300                                            AINST01H              08430000
084400                                            AREPL01H              08440000
084500                                            AUPC01H               08450000
084600         WHEN PC-INTER-APPL-UPD                                   08460000
084700             MOVE DP015-PRO-NOR-OFF      TO ATYP01A               08470000
084800                                            ASTK01A               08480000
084900                                            ADNM01A               08490000
085000                                            AUPC01A               08500000
085100             MOVE DP015-UNP-ALP-BRT-OFF  TO ADESC01A              08510000
085200                                            AREPL01A              08520000
085300                                            AINST01A              08530000
085400             MOVE DP015-BLUE             TO ATYP01C               08540000
085500                                            ASTK01C               08550000
085600                                            ADNM01C               08560000
085700                                            AUPC01C               08570000
085800             MOVE DP015-GREEN            TO ADESC01C              08580000
085900                                            AREPL01C              08590000
086000                                            AINST01C              08600000
086100             MOVE DP015-UNDERLINE        TO ADESC01H              08610000
086200                                            AREPL01H              08620000
086300                                            AINST01H              08630000
086400*            MOVE -1                     TO ADESC01L              08640000
086500         WHEN PC-INTER-APPL-DEL                                   08650000
086600             MOVE DP015-PRO-NOR-OFF      TO ATYP01A               08660000
086700                                            ASTK01A               08670000
086800                                            ADNM01A               08680000
086900                                            ASTK01A               08690000
087000                                            ADESC01A              08700000
087100                                            AINST01A              08710000
087200                                            AREPL01A              08720000
087300                                            AUPC01A               08730000
087400             MOVE DP015-BLUE             TO ATYP01C               08740000
087500                                            ASTK01C               08750000
087600                                            ADNM01C               08760000
087700                                            ASTK01C               08770000
087800                                            ADESC01C              08780000
087900                                            AINST01C              08790000
088000                                            AREPL01C              08800000
088100                                            AUPC01C               08810000
088200     END-EVALUATE.                                                08820000
088300*                                                                 08830000
088400*----------------------------------------------------------------*08840000
088500* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *08850000
088600* MAP.                                                           *08860000
088700*----------------------------------------------------------------*08870000
088800 3300-UNPROTECT-ATTRIBUTES.                                       08880000
088900     MOVE DP015-UNP-ALP-NOR-OFF    TO ATYP01A                     08890000
089000                                      ASTK01A                     08900000
089100                                      ADNM01A                     08910000
089200                                      ASTK01A                     08920000
089300                                      ADESC01A                    08930000
089400                                      AINST01A                    08940000
089500                                      AREPL01A                    08950000
089600                                      AUPC01A.                    08960000
089700     MOVE DP015-GREEN              TO ATYP01C                     08970000
089800                                      ASTK01C                     08980000
089900                                      ADNM01C                     08990000
090000                                      ASTK01C                     09000000
090100                                      ADESC01C                    09010000
090200                                      AINST01C                    09020000
090300                                      AREPL01C                    09030000
090400                                      AUPC01C.                    09040000
090500     MOVE DP015-UNDERLINE          TO ATYP01H                     09050000
090600                                      ASTK01H                     09060000
090700                                      ADNM01H                     09070000
090800                                      ASTK01H                     09080000
090900                                      ADESC01H                    09090000
091000                                      AINST01H                    09100000
091100                                      AREPL01H                    09110000
091200                                      AUPC01H.                    09120000
091300*                                                                 09130000
091400*----------------------------------------------------------------*09140000
091500*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *09150000
091600*    ENTRY.                                                      *09160000
091700*----------------------------------------------------------------*09170000
091800                                                                  09180000
091900 4000-BUILD-INITIAL-PANEL.                                        09190000
092000     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        09200000
092100                                                                  09210000
092200     IF ASC-ADD                                                   09220000
092300        MOVE -1                    TO ATYP01L                     09230000
092400     END-IF.                                                      09240000
092500                                                                  09250000
092600     IF ASC-UPDATE                                                09260000
092700        MOVE -1                    TO ADESC01L                    09270000
092800     END-IF.                                                      09280000
092900                                                                  09290000
093000     IF ASC-INT-APPL-FORMAT-IND = PC-INTER-APPL-ADD               09300000
093100        PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                      09310000
093200     ELSE                                                         09320000
093300        MOVE ASC-CRD-TYP-CDE          TO DK-CRD-TYP-CDE           09330000
093400        MOVE ASC-STK-TYP-ID           TO DK-CRD-STK-TYP-ID        09340000
093500        MOVE ASC-PRE-DNNTD-CRD-9      TO DK-PRE-DNNTD-CRD-AMT     09350000
093600                                                                  09360000
093700        PERFORM 4100-SELECT                                       09370000
093800                                                                  09380000
093900        MOVE SVT00008-CRD-TYP-CDE       TO ASC-CRD-TYP-CDE        09390000
094000        MOVE SVT00008-CRD-STK-TYP-ID    TO ASC-STK-TYP-ID         09400000
094100        MOVE SVT00008-PRE-DNNTD-CRD-AMT TO ASC-PRE-DNNTD-CRD-9    09410000
094200        MOVE SVT00008-CRD-STK-TYP-DESC  TO ASC-DESC               09420000
094300        MOVE SVT00008-CRD-RPLNT-IND     TO ASC-REPLENISH          09430000
094400        MOVE SVT00008-UPC-NBR           TO ASC-UPC-NBR            09440000
094500        IF IV-CMNT-TXT = 0                                        09450000
094600            MOVE SVT00008-CMNT-TXT      TO ASC-CMMT               09460000
094700        ELSE                                                      09470000
094800            MOVE SPACES                 TO ASC-CMMT               09480000
094900        END-IF                                                    09490000
095000                                                                  09500000
095100        PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                      09510000
095200     END-IF.                                                      09520000
095300                                                                  09530000
095400*----------------------------------------------------------------*09540000
095500* SELECT A ROW FROM THE DB2 SYSTEM MESSAGE TABLE.                *09550000
095600*----------------------------------------------------------------*09560000
095700 4100-SELECT.                                                     09570000
095800     PERFORM                                                      09580000
095900         WITH TEST AFTER                                          09590000
096000         VARYING PV-RETRY-COUNTER                                 09600000
096100         FROM 1 BY 1                                              09610000
096200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09620000
096300                   OR (SQLCODE = ZERO)                            09630000
096400                   OR (SQLCODE = +100))                           09640000
096500                                                                  09650000
096600         MOVE 0 TO IV-CMNT-TXT                                    09660000
096700*                                                                 09670000
096800         EXEC SQL                                                 09680000
096900             SELECT CRD_TYP_CDE                                   09690000
097000                   ,CRD_STK_TYP_ID                                09700000
097100                   ,PRE_DNNTD_CRD_AMT                             09710000
097200                   ,CRD_STK_TYP_DESC                              09720000
097300                   ,CMNT_TXT                                      09730000
097400                   ,CRD_RPLNT_IND                                 09740000
097500                   ,UPC_NBR                                       09750000
097600             INTO   :SVT00008-CRD-TYP-CDE,                        09760000
097700                    :SVT00008-CRD-STK-TYP-ID,                     09770000
097800                    :SVT00008-PRE-DNNTD-CRD-AMT,                  09780000
097900                    :SVT00008-CRD-STK-TYP-DESC,                   09790000
098000                    :SVT00008-CMNT-TXT                            09800000
098100                    :IV-CMNT-TXT,                                 09810000
098200                    :SVT00008-CRD-RPLNT-IND,                      09820000
098300                    :SVT00008-UPC-NBR                             09830000
098400             FROM   SVT_CRD_STK_DNMNTN                            09840000
098500             WHERE  CRD_TYP_CDE       = :DK-CRD-TYP-CDE           09850000
098600               AND  CRD_STK_TYP_ID    = :DK-CRD-STK-TYP-ID        09860000
098700               AND  PRE_DNNTD_CRD_AMT = :DK-PRE-DNNTD-CRD-AMT     09870000
098800         END-EXEC                                                 09880000
098900                                                                  09890000
099000         EVALUATE TRUE                                            09900000
099100             WHEN SQLCODE = ZERO                                  09910000
099200             WHEN SQLCODE = +100                                  09920000
099300             WHEN SQLCODE = -904                                  09930000
099400             WHEN SQLCODE = -913                                  09940000
099500                 CONTINUE                                         09950000
099600             WHEN SQLWARN0 NOT = SPACES                           09960000
099700             WHEN SQLCODE < ZERO                                  09970000
099800             WHEN SQLCODE > ZERO                                  09980000
099900                 MOVE '4100-SELECT'                               09990000
100000                                   TO DP013-PARAGRAPH             10000000
100100                 MOVE 'SELECT MESSAGE NUMBER'                     10010000
100200                                   TO DP013-MESSAGE-TEXT (1)      10020000
100300                 MOVE SQLCA        TO DP013-SQLCA                 10030000
100400                 MOVE 'SVT_CRD'    TO DP013-DB2-TABLE-NAME (1)    10040000
100500                 SET DP013-DB2-ABEND                              10050000
100600                     DP013-XCTL-DISPLAY-RESTART                   10060000
100700                                   TO TRUE                        10070000
100800                 PERFORM DP013-0000-PROCESS-ABEND                 10080000
100900         END-EVALUATE                                             10090000
101000     END-PERFORM.                                                 10100000
101100*                                                                 10110000
101200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10120000
101300         MOVE '4100-SELECT '       TO DP013-PARAGRAPH             10130000
101400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     10140000
101500                                   TO DP013-MESSAGE-TEXT (1)      10150000
101600         MOVE 'CARD STOCK  '       TO DP013-MESSAGE-TEXT (2)      10160000
101700         MOVE SQLCA                TO DP013-SQLCA                 10170000
101800         MOVE 'SVT_CRD'            TO DP013-DB2-TABLE-NAME (1)    10180000
101900         SET DP013-DB2-ABEND                                      10190000
102000             DP013-XCTL-DISPLAY-RESTART                           10200000
102100                                   TO TRUE                        10210000
102200         PERFORM DP013-0000-PROCESS-ABEND                         10220000
102300     END-IF.                                                      10230000
102400                                                                  10240000
102500*----------------------------------------------------------------*10250000
102600*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *10260000
102700*----------------------------------------------------------------*10270000
102800                                                                  10280000
102900 4400-MOVE-COMMAREA-TO-SCREEN.                                    10290000
103000     MOVE ASC-CRD-TYP-CDE          TO ATYP01O.                    10300000
103100     MOVE ASC-STK-TYP-ID           TO ASTK01O.                    10310000
103200     MOVE ASC-PRE-DNNTD-CRD-9      TO ADNM01O.                    10320000
103300     MOVE ASC-DESC                 TO ADESC01O.                   10330000
103400     MOVE ASC-CMMT                 TO AINST01O.                   10340000
103500     MOVE ASC-REPLENISH            TO AREPL01O.                   10350000
103600     MOVE ASC-UPC-NBR              TO AUPC01O.                    10360000
103700                                                                  10370000
103800                                                                  10380000
103900*----------------------------------------------------------------*10390000
104000* INSERT FOR THE ADD                                             *10400000
104100*----------------------------------------------------------------*10410000
104200 5000-INSERT-CARD-STOCK.                                          10420000
104300                                                                  10430000
104400         MOVE ASC-CRD-TYP-CDE       TO SVT00008-CRD-TYP-CDE       10440000
104500         MOVE ASC-STK-TYP-ID        TO SVT00008-CRD-STK-TYP-ID    10450000
104600         MOVE ASC-PRE-DNNTD-CRD-9   TO SVT00008-PRE-DNNTD-CRD-AMT 10460000
104700         MOVE ASC-DESC              TO SVT00008-CRD-STK-TYP-DESC  10470000
104800         IF ASC-CMMT  = SPACE                                     10480000
104900            MOVE -1                 TO IV-CMNT-TXT                10490000
105000         ELSE                                                     10500000
105100            MOVE ASC-CMMT           TO SVT00008-CMNT-TXT          10510000
105200         END-IF                                                   10520000
105300         MOVE ASC-REPLENISH         TO SVT00008-CRD-RPLNT-IND     10530000
105400         MOVE  0                    TO SVT00008-CRD-INV-PARM-ID   10540000
105500         MOVE PV-UPC-NBR-ONLY       TO SVT00008-UPC-NBR.          10550000
105600                                                                  10560000
105700         PERFORM                                                  10570000
105800            WITH TEST AFTER                                       10580000
105900              VARYING PV-RETRY-COUNTER                            10590000
106000                FROM 1 BY 1                                       10600000
106100                  UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)      10610000
106200                    OR (SQLCODE = ZERO)                           10620000
106300                    OR (SQLCODE = -803))                          10630000
106400                                                                  10640000
106500            EXEC SQL                                              10650000
106600               INSERT INTO SVT_CRD_STK_DNMNTN                     10660000
106700                  ( CRD_TYP_CDE                                   10670000
106800                   ,CRD_STK_TYP_ID                                10680000
106900                   ,PRE_DNNTD_CRD_AMT                             10690000
107000                   ,CRD_INV_PARM_ID                               10700000
107100                   ,CRD_STK_TYP_DESC                              10710000
107200                   ,CMNT_TXT                                      10720000
107300                   ,CRD_RPLNT_IND                                 10730000
107400                   ,UPC_NBR)                                      10740000
107500               VALUES                                             10750000
107600                  (:SVT00008-CRD-TYP-CDE,                         10760000
107700                   :SVT00008-CRD-STK-TYP-ID,                      10770000
107800                   :SVT00008-PRE-DNNTD-CRD-AMT,                   10780000
107900                   :SVT00008-CRD-INV-PARM-ID,                     10790000
108000                   :SVT00008-CRD-STK-TYP-DESC,                    10800000
108100                   :SVT00008-CMNT-TXT                             10810000
108200                   :IV-CMNT-TXT,                                  10820000
108300                   :SVT00008-CRD-RPLNT-IND,                       10830000
108400                   :SVT00008-UPC-NBR)                             10840000
108500            END-EXEC                                              10850000
108600                                                                  10860000
108700            EVALUATE TRUE                                         10870000
108800               WHEN SQLCODE = ZERO                                10880000
108900*                -- UPDATE SUCCESSFUL --                          10890000
109000                 MOVE PC-TSYMSG-00034 TO DP020-MSG-NUMBER         10900000
109100                 MOVE DP015-PRO-NOR-OFF       TO ATYP01A          10910000
109200                                                 ASTK01A          10920000
109300                                                 ADNM01A          10930000
109400                                                 ASTK01A          10940000
109500                                                 ADESC01A         10950000
109600                                                 AINST01A         10960000
109700                                                 AREPL01A         10970000
109800                                                 AUPC01A          10980000
109900                 MOVE DP015-BLUE              TO ATYP01C          10990000
110000                                                 ASTK01C          11000000
110100                                                 ADNM01C          11010000
110200                                                 ASTK01C          11020000
110300                                                 ADESC01C         11030000
110400                                                 AINST01C         11040000
110500                                                 AREPL01C         11050000
110600                                                 AUPC01C          11060000
110700                 MOVE DP015-HL-OFF            TO ATYP01H          11070000
110800                                                 ASTK01H          11080000
110900                                                 ADNM01H          11090000
111000                                                 ASTK01H          11100000
111100                                                 ADESC01H         11110000
111200                                                 AINST01H         11120000
111300                                                 AREPL01H         11130000
111400                                                 AUPC01H          11140000
111500                 SET DP020-MSG-INFORMATIONAL  TO TRUE             11150000
111600                 MOVE -1    TO  ATYP01L                           11160000
111700                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             11170000
111800               WHEN SQLCODE = -904                                11180000
111900               WHEN SQLCODE = -913                                11190000
112000                   CONTINUE                                       11200000
112100               WHEN SQLCODE = -803                                11210000
112200                 MOVE PC-TSYMSG-00117 TO DP020-MSG-NUMBER         11220000
112300*----------------RECORD ALREADY EXISTS ---------------            11230000
112400                 SET DP020-MSG-FATAL          TO TRUE             11240000
112500                 MOVE -1    TO  ATYP01L                           11250000
112600                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             11260000
112700               WHEN SQLWARN0 NOT = SPACES                         11270000
112800               WHEN SQLCODE < ZERO                                11280000
112900               WHEN SQLCODE > ZERO                                11290000
113000                   MOVE '5000-INSERT-CARD-STOCK'                  11300000
113100                                  TO DP013-PARAGRAPH              11310000
113200                   MOVE 'INSERT CRD STOCK'                        11320000
113300                                  TO DP013-MESSAGE-TEXT(1)        11330000
113400                   MOVE SQLCA       TO DP013-SQLCA                11340000
113500                   MOVE 'SVT_CRD_STK_DNMNTN'                      11350000
113600                                  TO DP013-DB2-TABLE-NAME(1)      11360000
113700                   SET DP013-DB2-ABEND                            11370000
113800                       DP013-XCTL-DISPLAY-RESTART TO TRUE         11380000
113900                   PERFORM DP013-0000-PROCESS-ABEND               11390000
114000             END-EVALUATE                                         11400000
114100         END-PERFORM.                                             11410000
114200                                                                  11420000
114300           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                  11430000
114400               MOVE '5000-INSERT-CARD-STOCK'                      11440000
114500                                       TO DP013-PARAGRAPH         11450000
114600               MOVE 'MAX RETRIES EXCEEDED INSERTING CRD STK'      11460000
114700                                     TO DP013-MESSAGE-TEXT (1)    11470000
114800               MOVE SQLCA              TO DP013-SQLCA             11480000
114900               MOVE 'SVT_CRD_STK_DNMNTN'                          11490000
115000                                    TO DP013-DB2-TABLE-NAME (1)   11500000
115100               SET DP013-DB2-ABEND                                11510000
115200                   DP013-XCTL-DISPLAY-RESTART                     11520000
115300                                         TO TRUE                  11530000
115400               PERFORM DP013-0000-PROCESS-ABEND                   11540000
115500           END-IF.                                                11550000
115600*----------------------------------------------------------------*11560000
115700* UPDATE FOR THE UPDATE                                          *11570000
115800*----------------------------------------------------------------*11580000
115900 5025-UPDATE-CARD-STOCK.                                          11590000
116000     MOVE ASC-CRD-TYP-CDE        TO DK-CRD-TYP-CDE                11600000
116100     MOVE ASC-STK-TYP-ID         TO DK-CRD-STK-TYP-ID             11610000
116200     MOVE ASC-PRE-DNNTD-CRD-9    TO DK-PRE-DNNTD-CRD-AMT          11620000
116300     MOVE ASC-DESC               TO SVT00008-CRD-STK-TYP-DESC     11630000
116400     IF ASC-CMMT = SPACE                                          11640000
116500        MOVE -1                  TO IV-CMNT-TXT                   11650000
116600     ELSE                                                         11660000
116700        MOVE ASC-CMMT            TO SVT00008-CMNT-TXT             11670000
116800     END-IF                                                       11680000
116900     MOVE ASC-REPLENISH          TO SVT00008-CRD-RPLNT-IND        11690000
117000     MOVE ASC-UPC-NBR            TO SVT00008-UPC-NBR.             11700000
117100                                                                  11710000
117200     PERFORM 5050-UPDATE-RECORD.                                  11720000
117300                                                                  11730000
117400     IF  ASC-USE-SELECTION-QUEUE                                  11740000
117500         PERFORM 5200-UPDATE-SELECTION-QUEUE                      11750000
117600     END-IF.                                                      11760000
117700******************************************************************11770000
117800** UPDATE THE ROW ON THE DB2 TABLE.                             **11780000
117900******************************************************************11790000
118000 5050-UPDATE-RECORD.                                              11800000
118100     PERFORM                                                      11810000
118200         WITH TEST AFTER                                          11820000
118300         VARYING PV-RETRY-COUNTER                                 11830000
118400         FROM 1 BY 1                                              11840000
118500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11850000
118600                   OR (SQLCODE = ZERO))                           11860000
118700         EXEC SQL                                                 11870000
118800             UPDATE SVT_CRD_STK_DNMNTN                            11880000
118900                SET CRD_STK_TYP_DESC =:SVT00008-CRD-STK-TYP-DESC, 11890000
119000                    CMNT_TXT         =:SVT00008-CMNT-TXT          11900000
119100                                      :IV-CMNT-TXT,               11910000
119200                    CRD_RPLNT_IND    =:SVT00008-CRD-RPLNT-IND,    11920000
119300                    UPC_NBR          =:SVT00008-UPC-NBR           11930000
119400             WHERE CRD_TYP_CDE       = :DK-CRD-TYP-CDE            11940000
119500               AND CRD_STK_TYP_ID    = :DK-CRD-STK-TYP-ID         11950000
119600               AND PRE_DNNTD_CRD_AMT = :DK-PRE-DNNTD-CRD-AMT      11960000
119700         END-EXEC                                                 11970000
119800                                                                  11980000
119900         EVALUATE TRUE                                            11990000
120000             WHEN SQLCODE = ZERO                                  12000000
120100*                -- UPDATE SUCCESSFUL --                          12010000
120200                 MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER         12020000
120300                 SET DP020-MSG-INFORMATIONAL TO TRUE              12030000
120400                 MOVE -1    TO  ADESC01L                          12040000
120500                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              12050000
120600             WHEN SQLCODE = -904                                  12060000
120700             WHEN SQLCODE = -913                                  12070000
120800                 CONTINUE                                         12080000
120900             WHEN SQLWARN0 NOT = SPACES                           12090000
121000             WHEN SQLCODE < ZERO                                  12100000
121100             WHEN SQLCODE > ZERO                                  12110000
121200                 MOVE '5050-UPDATE-RECORD'                        12120000
121300                                   TO DP013-PARAGRAPH             12130000
121400                 MOVE 'UPDATE A ROW ON THE CARD STOCK DNMNTN'     12140000
121500                                   TO DP013-MESSAGE-TEXT(1)       12150000
121600                 MOVE SQLCA        TO DP013-SQLCA                 12160000
121700                 MOVE 'SVT_CRD_STK_DNMNTN'                        12170000
121800                                   TO DP013-DB2-TABLE-NAME (1)    12180000
121900                 SET DP013-DB2-ABEND                              12190000
122000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12200000
122100                 PERFORM DP013-0000-PROCESS-ABEND                 12210000
122200         END-EVALUATE                                             12220000
122300     END-PERFORM.                                                 12230000
122400*                                                                 12240000
122500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12250000
122600         MOVE '5050-UPDATE-RECORD'                                12260000
122700                                   TO DP013-PARAGRAPH             12270000
122800         MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO UPDATE A RECORD'12280000
122900                                   TO DP013-MESSAGE-TEXT (1)      12290000
123000         MOVE SQLCA                TO DP013-SQLCA                 12300000
123100         MOVE 'SVT_CRD_STK_DNMNTN'                                12310000
123200                                   TO DP013-DB2-TABLE-NAME (1)    12320000
123300         SET DP013-DB2-ABEND                                      12330000
123400             DP013-XCTL-DISPLAY-RESTART                           12340000
123500                                   TO TRUE                        12350000
123600         PERFORM DP013-0000-PROCESS-ABEND                         12360000
123700     END-IF.                                                      12370000
123800                                                                  12380000
123900*----------------------------------------------------------------*12390000
124000* DELETE                                                         *12400000
124100*----------------------------------------------------------------*12410000
124200 5075-DELETE-CARD-STOCK.                                          12420000
124300     MOVE ASC-CRD-TYP-CDE       TO DK-CRD-TYP-CDE                 12430000
124400     MOVE ASC-STK-TYP-ID        TO DK-CRD-STK-TYP-ID              12440000
124500     MOVE ASC-PRE-DNNTD-CRD-9   TO DK-PRE-DNNTD-CRD-AMT           12450000
124600                                                                  12460000
124700     PERFORM 5100-SELECT-FROM-SVT-CRD-PROD                        12470000
124800                                                                  12480000
124900     IF SQLCODE = +100                                            12490000
125000         PERFORM                                                  12500000
125100             WITH TEST AFTER                                      12510000
125200             VARYING PV-RETRY-COUNTER                             12520000
125300             FROM 1 BY 1                                          12530000
125400             UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)           12540000
125500                  OR (SQLCODE = ZERO))                            12550000
125600             EXEC SQL                                             12560000
125700                 DELETE  FROM  SVT_CRD_STK_DNMNTN                 12570000
125800                  WHERE CRD_TYP_CDE       = :DK-CRD-TYP-CDE       12580000
125900                    AND CRD_STK_TYP_ID    = :DK-CRD-STK-TYP-ID    12590000
126000                    AND PRE_DNNTD_CRD_AMT = :DK-PRE-DNNTD-CRD-AMT 12600000
126100             END-EXEC                                             12610000
126200                                                                  12620000
126300             EVALUATE TRUE                                        12630000
126400                 WHEN SQLCODE = ZERO                              12640000
126500                     MOVE DP015-PRO-NOR-OFF TO ATYP01A            12650000
126600                                               ASTK01A            12660000
126700                                               ADNM01A            12670000
126800                                               ASTK01A            12680000
126900                                              ADESC01A            12690000
127000                                              AREPL01A            12700000
127100                                              AINST01A            12710000
127200                                               AUPC01A            12720000
127300                      MOVE PC-TSYMSG-00115                        12730000
127400                                 TO DP020-MSG-NUMBER              12740000
127500                      SET DP020-MSG-INFORMATIONAL TO TRUE         12750000
127600                      MOVE -1    TO  ATYP01L                      12760000
127700                      SET DP030-SET-CURSOR-APPL-1 TO TRUE         12770000
127800                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        12780000
127900                 WHEN SQLCODE = -904                              12790000
128000                 WHEN SQLCODE = -913                              12800000
128100                     CONTINUE                                     12810000
128200                 WHEN SQLWARN0 NOT = SPACES                       12820000
128300                 WHEN SQLCODE < ZERO                              12830000
128400                 WHEN SQLCODE > ZERO                              12840000
128500                     MOVE '5075-DELETE-RECORD'                    12850000
128600                                   TO DP013-PARAGRAPH             12860000
128700                     MOVE 'DELETE ROW ON THE CARD STOCK DNMNTN'   12870000
128800                                   TO DP013-MESSAGE-TEXT(1)       12880000
128900                     MOVE SQLCA        TO DP013-SQLCA             12890000
129000                     MOVE 'SVT_CRD_STK_DNMNTN'                    12900000
129100                                   TO DP013-DB2-TABLE-NAME (1)    12910000
129200                     SET DP013-DB2-ABEND                          12920000
129300                         DP013-XCTL-DISPLAY-RESTART TO TRUE       12930000
129400                     PERFORM DP013-0000-PROCESS-ABEND             12940000
129500             END-EVALUATE                                         12950000
129600         END-PERFORM                                              12960000
129700     ELSE                                                         12970000
129800*       -- CANNOT DELETE --                                       12980000
129900         MOVE DP015-PRO-NOR-OFF    TO ATYP01A                     12990000
130000                                      ASTK01A                     13000000
130100                                      ADNM01A                     13010000
130200                                      ASTK01A                     13020000
130300                                      ADESC01A                    13030000
130400                                      AREPL01A                    13040000
130500                                      AINST01A                    13050000
130600                                      AUPC01A                     13060000
130700         MOVE PC-TSYMSG-03256 TO DP020-MSG-NUMBER                 13070000
130800         SET DP020-MSG-INFORMATIONAL TO TRUE                      13080000
130900         MOVE -1    TO  ATYP01L                                   13090000
131000         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      13100000
131100     END-IF.                                                      13110000
131200*                                                                 13120000
131300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13130000
131400         MOVE '5075-DELETE-RECORD'                                13140000
131500                                   TO DP013-PARAGRAPH             13150000
131600         MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO DELETE A RECORD'13160000
131700                                   TO DP013-MESSAGE-TEXT (1)      13170000
131800         MOVE SQLCA                TO DP013-SQLCA                 13180000
131900         MOVE 'SVT_CRD_STK_DNMNTN'                                13190000
132000                                   TO DP013-DB2-TABLE-NAME (1)    13200000
132100         SET DP013-DB2-ABEND                                      13210000
132200             DP013-XCTL-DISPLAY-RESTART                           13220000
132300                                   TO TRUE                        13230000
132400         PERFORM DP013-0000-PROCESS-ABEND                         13240000
132500     END-IF.                                                      13250000
132600                                                                  13260000
132700     IF  ASC-USE-SELECTION-QUEUE                                  13270000
132800         PERFORM 5200-UPDATE-SELECTION-QUEUE                      13280000
132900     END-IF.                                                      13290000
133000*-----------------------------------------------------------------13300000
133100* SELECT TO SEE IF CARD STOCK IS ON THE SVT_CRD_PROD TABLE -      13310000
133200*  IF IT IS, THE STOCK CANNONT BE DELETED.                        13320000
133300*-----------------------------------------------------------------13330000
133400 5100-SELECT-FROM-SVT-CRD-PROD.                                   13340000
133500     PERFORM                                                      13350000
133600         WITH TEST AFTER                                          13360000
133700         VARYING PV-RETRY-COUNTER                                 13370000
133800         FROM 1 BY 1                                              13380000
133900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13390000
134000                   OR (SQLCODE = ZERO)                            13400000
134100                   OR (SQLCODE = -811)                            13410000
134200                   OR (SQLCODE = +100))                           13420000
134300                                                                  13430000
134400         MOVE 0 TO IV-CMNT-TXT                                    13440000
134500*                                                                 13450000
134600         EXEC SQL                                                 13460000
134700             SELECT CRD_TYP_CDE                                   13470000
134800                   ,CRD_STK_TYP_ID                                13480000
134900                   ,PRE_DNNTD_CRD_AMT                             13490000
135000             INTO   :SVT00000-CRD-TYP-CDE,                        13500000
135100                    :SVT00000-CRD-STK-TYP-ID,                     13510000
135200                    :SVT00000-PRE-DNNTD-CRD-AMT                   13520000
135300             FROM   SVT_CRD_PROD                                  13530000
135400             WHERE  CRD_TYP_CDE       = :DK-CRD-TYP-CDE           13540000
135500               AND  CRD_STK_TYP_ID    = :DK-CRD-STK-TYP-ID        13550000
135600               AND  PRE_DNNTD_CRD_AMT = :DK-PRE-DNNTD-CRD-AMT     13560000
135700         END-EXEC                                                 13570000
135800                                                                  13580000
135900         EVALUATE TRUE                                            13590000
136000             WHEN SQLCODE = ZERO                                  13600000
136100             WHEN SQLCODE = +100                                  13610000
136200             WHEN SQLCODE = -811                                  13620000
136300             WHEN SQLCODE = -904                                  13630000
136400             WHEN SQLCODE = -913                                  13640000
136500                 CONTINUE                                         13650000
136600             WHEN SQLWARN0 NOT = SPACES                           13660000
136700             WHEN SQLCODE < ZERO                                  13670000
136800             WHEN SQLCODE > ZERO                                  13680000
136900                 MOVE '5100-SELECT-FROM-CARD-PROD'                13690000
137000                                   TO DP013-PARAGRAPH             13700000
137100                 MOVE 'SELECT CRD PROD   '                        13710000
137200                                   TO DP013-MESSAGE-TEXT (1)      13720000
137300                 MOVE SQLCA        TO DP013-SQLCA                 13730000
137400                 MOVE 'SVT_CRD_PROD' TO DP013-DB2-TABLE-NAME (1)  13740000
137500                 SET DP013-DB2-ABEND                              13750000
137600                     DP013-XCTL-DISPLAY-RESTART                   13760000
137700                                   TO TRUE                        13770000
137800                 PERFORM DP013-0000-PROCESS-ABEND                 13780000
137900         END-EVALUATE                                             13790000
138000     END-PERFORM.                                                 13800000
138100*                                                                 13810000
138200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13820000
138300         MOVE '5100-SELECT-FROM-SVT-CRD-PROD'                     13830000
138400                                   TO DP013-PARAGRAPH             13840000
138500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     13850000
138600                                   TO DP013-MESSAGE-TEXT (1)      13860000
138700         MOVE 'CARD STOCK  '       TO DP013-MESSAGE-TEXT (2)      13870000
138800         MOVE SQLCA                TO DP013-SQLCA                 13880000
138900         MOVE 'SVT_CRD'            TO DP013-DB2-TABLE-NAME (1)    13890000
139000         SET DP013-DB2-ABEND                                      13900000
139100             DP013-XCTL-DISPLAY-RESTART                           13910000
139200                                   TO TRUE                        13920000
139300         PERFORM DP013-0000-PROCESS-ABEND                         13930000
139400     END-IF.                                                      13940000
139500                                                                  13950000
139600*-----------------------------------------------------------------13960000
139700* RECORD IN THE SELECTION TEMP STORAGE                            13970000
139800* OBJECT WAS UDPATED.                                             13980000
139900*-----------------------------------------------------------------13990000
140000 5200-UPDATE-SELECTION-QUEUE.                                     14000000
140100     PERFORM 9100-READ-SEL-QUEUE.                                 14010000
140200     SET SV009-UPD (ASC-SEL-SUB) TO TRUE.                         14020000
140300     PERFORM 9200-REWRITE-SEL-QUEUE.                              14030000
140400                                                                  14040000
140500*----------------------------------------------------------------*14050000
140600* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *14060000
140700*----------------------------------------------------------------*14070000
140800                                                                  14080000
140900 9100-READ-SEL-QUEUE.                                             14090000
141000     EXEC CICS                                                    14100000
141100         READQ TS                                                 14110000
141200             QUEUE (ASC-SEL-QUEUE-NAME)                           14120000
141300             INTO  (SV009-SEL-REC)                                14130000
141400             ITEM  (ASC-SEL-ITEM)                                 14140000
141500             RESP  (PV-CICS-RESPONSE)                             14150000
141600     END-EXEC.                                                    14160000
141700                                                                  14170000
141800     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   14180000
141900         CONTINUE                                                 14190000
142000     ELSE                                                         14200000
142100         SET DP013-LOGIC-ABEND                                    14210000
142200             DP013-NO-ROLLBACK     TO TRUE                        14220000
142300         MOVE '9100-READ-SEL-QUEUE'                               14230000
142400                                   TO DP013-PARAGRAPH             14240000
142500         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   14250000
142600                                   TO DP013-MESSAGE-TEXT (1)      14260000
142700         PERFORM DP013-0000-PROCESS-ABEND                         14270000
142800     END-IF.                                                      14280000
142900*----------------------------------------------------------------*14290000
143000* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *14300000
143100*----------------------------------------------------------------*14310000
143200 9200-REWRITE-SEL-QUEUE.                                          14320000
143300     EXEC CICS                                                    14330000
143400          WRITEQ TS                                               14340000
143500              QUEUE  (ASC-SEL-QUEUE-NAME)                         14350000
143600              FROM   (SV009-SEL-REC)                              14360000
143700              ITEM   (ASC-SEL-ITEM)                               14370000
143800              RESP   (PV-CICS-RESPONSE)                           14380000
143900              REWRITE                                             14390000
144000     END-EXEC.                                                    14400000
144100                                                                  14410000
144200     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               14420000
144300         SET DP013-CICS-ABEND                                     14430000
144400             DP013-NO-ROLLBACK     TO TRUE                        14440000
144500         MOVE '9200-REWRITE-SEL-QUEUE'                            14450000
144600                                   TO DP013-PARAGRAPH             14460000
144700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   14470000
144800                                   TO DP013-MESSAGE-TEXT (1)      14480000
144900         PERFORM DP013-0000-PROCESS-ABEND                         14490000
145000     END-IF.                                                      14500000
145100                                                                  14510000
145200                                                                  14520000
145300*----------------------------------------------------------------*14530000
145400*    ABEND PROCESSOR MODULE                                      *14540000
145500*----------------------------------------------------------------*14550000
145600                                                                  14560000
145700     COPY DPPD013.                                                14570000
