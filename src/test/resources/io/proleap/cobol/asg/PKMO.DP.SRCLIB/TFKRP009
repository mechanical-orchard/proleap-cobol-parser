      ******************************************************************00010001
       IDENTIFICATION DIVISION.                                         00020001
      ******************************************************************00030001
                                                                        00040001
       PROGRAM-ID.              TFKRP009.                               00050001
       AUTHOR.                  C PARMLEY.                              00060001
       INSTALLATION.            KOHLS DEPARTMENT STORES.                00070001
       DATE-WRITTEN.            07/25/2011.                             00080001
       DATE-COMPILED.                                                   00090001
                                                                        00100001
      ******************************************************************00110001
      * PROGRAM DESCRIPTION:                                            00120001
      * --------------------                                            00130001
      * GENCO DAILY TRANSFER MIS-DIRECTED REPORT                        00140001
      *                                                                 00150001
      * PROGRAM OBJECTIVE:                                              00160001
      * ------------------                                              00170001
      * SEQUENTIALLY READ DATA CREATED IN PROGRAM TFKUT008 AND CREATE   00180001
      * A REPORT OF ALL MIS-DRECTED RECEIVED TRANSFERS.                 00190001
      *                                                                 00200001
      *                                                                 00210001
      ******************************************************************00220001
      * CHANGE LOG:                                                     00230001
      * -----------                                                     00240001
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES           00250001
      * ------- ---------- ----------- -------------------------------- 00260001
      * 40189   07-25-2011 C PARMLEY   ORIGINAL IMPLEMENTATION          00270001
      ******************************************************************00280001
                                                                        00290001
      ******************************************************************00300001
       ENVIRONMENT DIVISION.                                            00310001
      ******************************************************************00320001
                                                                        00330001
      ******************************************************************00340001
       CONFIGURATION SECTION.                                           00350001
                                                                        00360001
      ******************************************************************00370001
       INPUT-OUTPUT SECTION.                                            00380001
                                                                        00390001
      ******************************************************************00400001
       FILE-CONTROL.                                                    00410001
                                                                        00420001
           SELECT MISDIRECT-XFER-DTL                                    00430001
               ASSIGN TO INP01.                                         00440001
                                                                        00450001
           SELECT CONTROL-CARD-DTE                                      00460001
                  ASSIGN TO INP02.                                      00470001
                                                                        00480001
           SELECT MISDIRECT-XFER-RPT                                    00490001
               ASSIGN TO RPT01.                                         00500001
                                                                        00510001
      /*****************************************************************00520001
       DATA DIVISION.                                                   00530001
      ******************************************************************00540001
                                                                        00550001
      ******************************************************************00560001
       FILE SECTION.                                                    00570001
                                                                        00580001
       FD  MISDIRECT-XFER-DTL                                           00590001
           RECORDING MODE IS F                                          00600001
           BLOCK CONTAINS 0 RECORDS.                                    00610001
                                                                        00620001
       01  MISDIRECT-XFER-DTL-RCD      PIC  X(200).                     00630001
                                                                        00640001
       FD  CONTROL-CARD-DTE                                             00650001
           RECORDING MODE F                                             00660001
           LABEL RECORDS ARE STANDARD                                   00670001
           RECORD CONTAINS 80 CHARACTERS                                00680001
           BLOCK CONTAINS 0 RECORDS                                     00690001
           DATA RECORD IS CNTRL-CARD-DTE-REC.                           00700001
                                                                        00710001
       01  CNTRL-CARD-DTE-REC          PIC  X(80).                      00720001
                                                                        00730001
       FD  MISDIRECT-XFER-RPT                                           00740001
           RECORDING MODE IS F                                          00750001
           BLOCK CONTAINS 0 RECORDS.                                    00760001
                                                                        00770001
       01  MISDIRECT-XFER-RPT-RCD      PIC  X(133).                     00780001
                                                                        00790001
      ******************************************************************00800001
       WORKING-STORAGE SECTION.                                         00810001
                                                                        00820001
      ******************************************************************00830001
       01  PS-PROGRAM-SWITCHES.                                         00840001
           05  PS-MISDIRECT-XFER-DTL-EOF-SW                             00850001
                                       PIC  X(01)          VALUE 'N'.   00860001
               88  PS-MISDIRECT-XFER-DTL-EOF               VALUE 'Y'.   00870001
               88  PS-NOT-MISDIRECT-XFER-DTL-EOF           VALUE 'N'.   00880023
           05  PS-END-OF-CNTL-CRD-SW       PIC X(01).                   00890001
               88  PS-END-OF-CNTL-CRD-FILE              VALUE 'Y'.      00900001
               88  PS-NOT-END-OF-CNTL-CRD-FILE          VALUE 'N'.      00910001
           05  PS-IS-RTV-LOCS-SW           PIC X(01).                   00920025
               88  PS-RTV-LOCS-AT-END                   VALUE 'Y'.      00930025
               88  PS-NOT-RTV-LOCS-AT-END               VALUE 'N'.      00940025
                                                                        00950001
      ******************************************************************00960001
       01  PC-PROGRAM-CONSTANTS.                                        00970001
           05  PC-PROGRAM-NAME         PIC  X(08)          VALUE        00980001
               'TFKRP009'.                                              00990001
           05  PC-LINE-MAX             PIC S9(03)          VALUE +66    01000001
                                                           COMP-3.      01010001
           05  PC-ALL                  PIC  X(04)          VALUE 'ALL'. 01020001
           05  PC-MINUS                PIC  X(01)          VALUE '-'.   01030001
                                                                        01040001
      ******************************************************************01050001
       01  PT-PROGRAM-TOTALS.                                           01060001
           05  PT-FIRSTXFER-RCD-FND    PIC S9(09)          VALUE ZEROS  01070001
                                                           COMP-3.      01080001
           05  PT-RCD-WRTTN            PIC S9(09)          VALUE ZEROS  01090001
                                                           COMP-3.      01100001
           05  PT-DISPLAY-CNTR         PIC S9(09)          VALUE +0     01110001
                                                           COMP-3.      01120001
               88  PT-DISPLAY-CNTR-CNT                     VALUE        01130001
                   5000000.                                             01140001
      *            5000.                                                01150001
                                                                        01160001
      ******************************************************************01170001
       01  CC-DATES.                                                    01180001
           05  CC-PROCESS-DATE         PIC X(10)           VALUE SPACE. 01190001
                                                                        01200001
      ******************************************************************01210001
       01  PV-PROGRAM-VARIABLES.                                        01220001
           05  PV-PARAGRAPH-NAME       PIC  X(25)          VALUE SPACE. 01230001
           05  PV-ABEND-MESSAGE        PIC  X(50)          VALUE SPACE. 01240001
           05  PV-OPER-ATTEMPTED       PIC  X(30)          VALUE SPACE. 01250001
           05  PV-PREV-FR-LOC-NBR      PIC S9(04)          VALUE +0     01260001
                                                           COMP.        01270001
           05  PV-PREV-TO-LOC-NBR      PIC S9(04)          VALUE +0     01280001
                                                           COMP.        01290001
           05  PV-PREV-XFER-QTY-TOTAL  PIC S9(09)          VALUE +0     01300001
                                                           COMP.        01310001
           05  PV-PREV-XFER-RTL-TOTAL  PIC S9(09)V99       VALUE +0     01320001
                                                           COMP-3.      01330001
                                                                        01340001
           05  PV-LINE-COUNT           PIC S9(03)          VALUE +67    01350001
                                                           COMP-3.      01360001
           05  PV-PAGE-COUNT           PIC S9(05)          VALUE +0     01370001
                                                           COMP-3.      01380001
           05  PV-TOTAL-TRANS          PIC S9(09)          VALUE +0     01390001
                                                           COMP.        01400001
           05  PV-TOTAL-QTY            PIC S9(09)V99       VALUE +0     01410001
                                                           COMP-3.      01420001
           05  PV-TOTAL-RETAIL         PIC S9(09)V99       VALUE +0     01430013
                                                           COMP-3.      01440013
           05  PV-TOTAL-RTL            PIC S9(09)V99       VALUE +0     01450001
                                                           COMP-3.      01460001
           05  PV-TOTAL-EXT-RTL        PIC S9(09)V99       VALUE +0     01470013
                                                           COMP-3.      01480013
           05  PV-TOTAL-TTL-RTL        PIC S9(09)V99       VALUE +0     01490019
                                                           COMP-3.      01500019
           05  PV-TOTAL-TRANS-ALL      PIC S9(09)          VALUE +0     01510001
                                                           COMP.        01520001
           05  PV-TOTAL-QTY-ALL        PIC S9(09)V99       VALUE +0     01530001
                                                           COMP-3.      01540001
           05  PV-TOTAL-RTL-ALL        PIC S9(09)V99       VALUE +0     01550001
                                                           COMP-3.      01560001
                                                                        01570001
      ******************************************************************01580001
       01  ABEND-CODE                   PIC S9(04)  VALUE +0  COMP SYNC.01590001
           88  AC-DB2-ERROR                         VALUE +4013.        01600001
           88  AC-NON-DB2-ERROR                     VALUE +4003.        01610001
           88  AC-DATE-ROUTINE-ERROR                VALUE +4019.        01620001
      ******************************************************************01630001
                                                                        01640001
       01  SDT-SYSTEM-DATE-TIME.                                        01650001
           05  SDT-YYYYMMDD            PIC  9(08)          VALUE ZEROS. 01660001
           05  FILLER REDEFINES SDT-YYYYMMDD.                           01670001
               10  SDT-YYYYMMDD-CCYY.                                   01680001
                   15  SDT-YYYYMMDD-CC PIC  X(02).                      01690001
                   15  SDT-YYYYMMDD-YY PIC  X(02).                      01700001
               10  SDT-YYYYMMDD-MM     PIC  X(02).                      01710001
               10  SDT-YYYYMMDD-DD     PIC  X(02).                      01720001
           05  SDT-HHMMSS              PIC  9(08)          VALUE ZEROS. 01730001
           05  FILLER REDEFINES SDT-HHMMSS.                             01740001
               10  SDT-HHMMSS-HH       PIC  X(02).                      01750001
               10  SDT-HHMMSS-MM       PIC  X(02).                      01760001
               10  SDT-HHMMSS-SS       PIC  X(02).                      01770001
               10  FILLER              PIC  X(02).                      01780001
                                                                        01790001
      ******************************************************************01800001
      **DATE LAYOUT                                                     01810001
      ******************************************************************01820001
       01  DB2-DATE.                                                    01830001
           05  DB2-DATE-CCYY           PIC X(04).                       01840001
           05  FILLER                  PIC X(01) VALUE '-'.             01850001
           05  DB2-DATE-MM             PIC X(02).                       01860001
           05  FILLER                  PIC X(01) VALUE '-'.             01870001
           05  DB2-DATE-DD             PIC X(02).                       01880001
                                                                        01890001
      *----------------------------------------------------------------*01900001
      *    COPYBOOK LAYOUT FOR THE CALENDAR ROUTINE                    *01910001
      *----------------------------------------------------------------*01920001
           COPY DPWS500.                                                01930001
                                                                        01940001
      *----------------------------------------------------------------*01950001
      *    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *01960001
      *----------------------------------------------------------------*01970001
           COPY DPWS004.                                                01980001
                                                                        01990001
      *----------------------------------------------------------------*02000001
      *  MISDIRECT XFER DETAIL                                          02010001
      *----------------------------------------------------------------*02020001
           COPY TFRD067.                                                02030001
                                                                        02040001
      *----------------------------------------------------------------*02050001
      *    COPYBOOK LAYOUT FOR THE CONTROL CARD                        *02060001
      *----------------------------------------------------------------*02070001
           COPY TFRD069.                                                02080001
                                                                        02090001
      *----------------------------------------------------------------*02100001
      * DB2 MESSAGE AREA                                                02110001
      *----------------------------------------------------------------*02120001
           COPY SQLCA2.                                                 02130001
                                                                        02140001
      *----------------------------------------------------------------*02150001
      * STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                 02160001
      *----------------------------------------------------------------*02170001
           EXEC SQL                                                     02180001
               INCLUDE SQLCA                                            02190001
           END-EXEC.                                                    02200001
                                                                        02210001
      *----------------------------------------------------------------*02220001
      * XST_LOC                                                         02230001
      *----------------------------------------------------------------*02240001
           EXEC SQL                                                     02250001
               INCLUDE XST00001                                         02260001
           END-EXEC.                                                    02270001
                                                                        02280001
      *----------------------------------------------------------------*02290026
      * XST_RTV_LOC_RLTNSHP                                             02300026
      *----------------------------------------------------------------*02310026
           EXEC SQL                                                     02320026
               INCLUDE XST00135                                         02330026
           END-EXEC.                                                    02340026
                                                                        02350026
      *----------------------------------------------------------------*02360025
      * CURSOR FOR GETTING RTV LOCATIONS FROM XST_RTV_LOC_RLTNSHP       02370025
      *----------------------------------------------------------------*02380025
                                                                        02390025
           EXEC SQL                                                     02400025
                DECLARE RTV-LOCS-CSR CURSOR FOR                         02410025
                   SELECT DISTINCT A.RTV_LOC_NBR                        02420025
                       FROM  XST_RTV_LOC_RLTNSHP A                      02430025
                        WHERE A.EFF_BEG_DTE = (SELECT MAX(EFF_BEG_DTE)  02440025
                        FROM  XST_RTV_LOC_RLTNSHP B                     02450025
                          WHERE A.RTV_LOC_NBR = B.RTV_LOC_NBR)          02460025
                        WITH UR                                         02470025
           END-EXEC.                                                    02480025
                                                                        02490025
      ******************************************************************02500025
       01  PV-RTV-LOC-TBL.                                              02510025
           10  PV-RTV-LOC-ENTRIES OCCURS 10 TIMES.                      02520025
               15  PV-RTV-LOC             PIC 9(04).                    02530025
               15  PV-RTV-TRANS           PIC 9(09).                    02540025
               15  PV-RTV-QTY             PIC 9(09).                    02550025
               15  PV-RTV-TOT-RTL         PIC 9(09)V99.                 02560025
       01  SUB                            PIC 9(02) VALUE ZERO.         02570025
       01  MAX-SUB                        PIC 9(02) VALUE 10.           02580025
       01  NO-RTVS                        PIC 9(02) VALUE ZERO.         02590025
                                                                        02600025
      ******************************************************************02610001
      * COPY FOR STANDARD HEADING                                       02620001
      ******************************************************************02630001
           COPY DPWS132O.                                               02640001
                                                                        02650001
      ******************************************************************02660001
       01  RHL1-RPT-HEAD-LINE1.                                         02670001
           05  FILLER                  PIC  X(43)          VALUE SPACE. 02680001
           05  FILLER                  PIC  X(54)          VALUE        02690001
               'GENCO DAILY TRANSFER MIS-DIRECTED RECEIPT REPORT FOR '. 02700001
           05  RHL1-RTV-LOC            PIC  X(04)          VALUE SPACE. 02710001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 02720001
           05  RHL1-RTV-NM             PIC  X(20)          VALUE SPACE. 02730001
                                                                        02740001
      ******************************************************************02750001
       01  RHL2-RPT-HEAD-LINE2.                                         02760001
           05  FILLER                  PIC  X(49)          VALUE SPACE. 02770001
           05  FILLER                  PIC  X(11)          VALUE        02780001
               'FOR DATE  '.                                            02790001
           05  RHL2-DTE-BEGIN          PIC  X(10)          VALUE SPACE. 02800001
                                                                        02810001
      ******************************************************************02820001
       01  RHL3-RPT-HEAD-LINE3.                                         02830001
           05  FILLER                  PIC  X(10)          VALUE        02840001
               '  TRANSFER'.                                            02850001
           05  FILLER                  PIC  X(04)          VALUE SPACE. 02860001
           05  FILLER                  PIC  X(04)          VALUE        02870001
               'ORIG'.                                                  02880001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 02890001
           05  FILLER                  PIC  X(06)          VALUE        02900001
               'ACTUAL'.                                                02910001
           05  FILLER                  PIC  X(43)          VALUE SPACE. 02920006
           05  FILLER                  PIC  X(05)          VALUE        02930001
               'TOTAL'.                                                 02940001
           05  FILLER                  PIC  X(08)          VALUE SPACE. 02950008
           05  FILLER                  PIC  X(05)          VALUE        02960001
               'TOTAL'.                                                 02970001
           05  FILLER                  PIC  X(07)          VALUE SPACE. 02980036
           05  FILLER                  PIC  X(08)          VALUE        02990002
               'EXTENDED'.                                              03000001
           05  FILLER                  PIC  X(04)          VALUE SPACE. 03010012
           05  FILLER                  PIC  X(06)          VALUE        03020001
               'CREATE'.                                                03030001
           05  FILLER                  PIC  X(08)          VALUE SPACE. 03040031
           05  FILLER                  PIC  X(08)          VALUE        03050001
               'RECEIVED'.                                              03060001
                                                                        03070001
      ******************************************************************03080001
       01  RHL4-RPT-HEAD-LINE4.                                         03090001
           05  FILLER                  PIC  X(05)          VALUE SPACE. 03100001
           05  FILLER                  PIC  X(02)          VALUE        03110001
               'NO'.                                                    03120001
           05  FILLER                  PIC  X(07)          VALUE SPACE. 03130001
           05  FILLER                  PIC  X(06)          VALUE        03140001
               'TO LOC'.                                                03150001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03160001
           05  FILLER                  PIC  X(06)          VALUE        03170001
               'TO LOC'.                                                03180001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03190001
           05  FILLER                  PIC  X(13)          VALUE        03200001
               'TRANSFER TYPE'.                                         03210001
           05  FILLER                  PIC  X(10)          VALUE SPACE. 03220005
           05  FILLER                  PIC  X(04)          VALUE        03230001
               'DEPT'.                                                  03240001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03250001
           05  FILLER                  PIC  X(03)          VALUE        03260001
               'SUB'.                                                   03270001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 03280004
           05  FILLER                  PIC  X(03)          VALUE        03290001
               'SKU'.                                                   03300001
           05  FILLER                  PIC  X(07)          VALUE SPACE. 03310034
           05  FILLER                  PIC  X(03)          VALUE        03320001
               'QTY'.                                                   03330001
           05  FILLER                  PIC  X(09)          VALUE SPACE. 03340034
           05  FILLER                  PIC  X(06)          VALUE        03350001
               'RETAIL'.                                                03360001
           05  FILLER                  PIC  X(08)          VALUE SPACE. 03370035
           05  FILLER                  PIC  X(06)          VALUE        03380001
               'RETAIL'.                                                03390001
           05  FILLER                  PIC  X(06)          VALUE SPACE. 03400001
           05  FILLER                  PIC  X(04)          VALUE        03410001
               'DATE'.                                                  03420001
           05  FILLER                  PIC  X(11)          VALUE SPACE. 03430031
           05  FILLER                  PIC  X(04)          VALUE        03440001
               'DATE'.                                                  03450001
                                                                        03460001
      ******************************************************************03470001
       01  RHL5-RPT-HEAD-LINE5.                                         03480001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 03490001
           05  FILLER                  PIC  X(11)          VALUE        03500001
               '-----------'.                                           03510001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03520001
           05  FILLER                  PIC  X(06)          VALUE        03530001
               '------'.                                                03540001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03550001
           05  FILLER                  PIC  X(06)          VALUE        03560001
               '------'.                                                03570001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03580001
           05  FILLER                  PIC  X(18)          VALUE        03590031
               '------------------'.                                    03600031
           05  FILLER                  PIC  X(05)          VALUE SPACE. 03610031
           05  FILLER                  PIC  X(04)          VALUE        03620001
               '----'.                                                  03630001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03640001
           05  FILLER                  PIC  X(03)          VALUE        03650001
               '---'.                                                   03660001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 03670001
           05  FILLER                  PIC  X(08)          VALUE        03680001
               '--------'.                                              03690001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03700001
           05  FILLER                  PIC  X(07)          VALUE        03710001
               '-------'.                                               03720001
           05  FILLER                  PIC  X(06)          VALUE SPACE. 03730007
           05  FILLER                  PIC  X(06)          VALUE        03740001
               '------'.                                                03750001
           05  FILLER                  PIC  X(06)          VALUE SPACE. 03760035
           05  FILLER                  PIC  X(08)          VALUE        03770001
               '--------'.                                              03780001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 03790001
           05  FILLER                  PIC  X(10)          VALUE        03800001
               '----------'.                                            03810001
           05  FILLER                  PIC  X(04)          VALUE SPACE. 03820032
           05  FILLER                  PIC  X(10)          VALUE        03830001
               '----------'.                                            03840001
                                                                        03850001
      ******************************************************************03860001
      *  REPORT DETAIL                                                  03870001
      ******************************************************************03880001
       01  XRDL-XFER-RPT-DTL-LINE.                                      03890001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 03900004
           05  XRDL-STR-NBR            PIC  9(04)          VALUE ZEROS. 03910001
           05  FILLER                  PIC  X(01)          VALUE '-'.   03920001
           05  XRDL-SEQ-NBR            PIC  9(06)          VALUE ZEROS. 03930001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 03940001
           05  XRDL-ORIG-TO-LOC-NBR    PIC  9(04)          VALUE ZEROS. 03950001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 03960001
           05  XRDL-ACTL-TO-LOC-NBR    PIC  9(04)          VALUE ZEROS. 03970001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 03980001
           05  XRDL-TRANS-TYPE         PIC  X(20)          VALUE SPACE. 03990001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 04000004
           05  XRDL-DEPT-NBR           PIC  X(04)          VALUE SPACE. 04010001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 04020001
           05  XRDL-SUB-NBR            PIC  X(02)          VALUE SPACE. 04030001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 04040006
           05  XRDL-SKU-NBR            PIC  X(08)          VALUE SPACE. 04050001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 04060006
           05  XRDL-TOTAL-QTY          PIC  Z(06)9(01)     VALUE ZEROS. 04070001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 04080001
           05  XRDL-TOTAL-RTL          PIC  Z(06)9(01).99  VALUE ZEROS. 04090001
           05  XRDL-MINUS              PIC  X(01)          VALUE SPACE. 04100002
           05  FILLER                  PIC  X(01)          VALUE SPACE. 04110001
           05  XRDL-EXT-TOT-RTL        PIC  Z(08)9(01).99- VALUE ZEROS. 04120035
           05  FILLER                  PIC  X(02)          VALUE SPACE. 04130012
           05  XRDL-DTE-CMPLT-XFER     PIC  X(10)          VALUE SPACE. 04140001
           05  FILLER                  PIC  X(04)          VALUE SPACE. 04150031
           05  XRDL-XFER-DTE-RCVD      PIC  X(10)          VALUE SPACE. 04160001
      ******************************************************************04170001
      *  REPORT TOTALS                                                  04180001
      ******************************************************************04190001
       01  XRDL-XFER-RPT-TTL-LINE.                                      04200001
           05  FILLER                  PIC  X(10)          VALUE SPACE. 04210001
           05  XRDL-TTL-TO-LOC         PIC  9(04)          VALUE ZEROS. 04220001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 04230001
           05  FILLER                  PIC  X(08)          VALUE        04240001
               'TOTALS: '.                                              04250001
           05  XRDL-TTL-TOTAL-TRANS    PIC  Z(06)9(01)     VALUE ZEROS. 04260001
           05  FILLER                  PIC  X(40)          VALUE SPACE. 04270011
           05  XRDL-TTL-TOTAL-QTY      PIC  Z(06)9(01)     VALUE ZEROS. 04280001
           05  FILLER                  PIC  X(14)          VALUE SPACE. 04290017
           05  XRDL-TTL-TOTAL-RTL      PIC  Z(08)9(01).99- VALUE ZEROS. 04300035
                                                                        04310001
       01  RHL1-RPT-SUM-LINE1.                                          04320001
           05  FILLER                  PIC  X(43)          VALUE SPACE. 04330001
           05  FILLER                  PIC  X(51)          VALUE        04340001
               'GENCO DAILY TRANSFER MIS-DIRECTED RECEIPT REPORT - '.   04350001
           05  FILLER                  PIC  X(15)          VALUE        04360022
               '   SUMMARY PAGE'.                                       04370022
                                                                        04380001
      ******************************************************************04390001
       01  RHL1-RPT-SUM-LINE2.                                          04400001
           05  FILLER                  PIC  X(17)          VALUE SPACE. 04410001
           05  FILLER                  PIC  X(05)          VALUE        04420001
               'TOTAL'.                                                 04430001
           05  FILLER                  PIC  X(05)          VALUE SPACE. 04440001
           05  FILLER                  PIC  X(05)          VALUE        04450001
               'TOTAL'.                                                 04460001
           05  FILLER                  PIC  X(06)          VALUE SPACE. 04470001
           05  FILLER                  PIC  X(05)          VALUE        04480001
               'TOTAL'.                                                 04490001
      ******************************************************************04500001
       01  RHL1-RPT-SUM-LINE3.                                          04510001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 04520001
           05  FILLER                  PIC  X(12)          VALUE        04530001
               'RTV LOCATION'.                                          04540001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 04550001
           05  FILLER                  PIC  X(09)          VALUE        04560001
               'TRANSFERS'.                                             04570001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 04580001
           05  FILLER                  PIC  X(08)          VALUE        04590001
               'QUANTITY'.                                              04600001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 04610001
           05  FILLER                  PIC  X(15)          VALUE        04620001
               'EXTENDED RETAIL'.                                       04630001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 04640001
      ******************************************************************04650001
       01  RHL1-RPT-SUM-LINE4.                                          04660001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 04670001
           05  FILLER                  PIC  X(12)          VALUE        04680001
               '------------'.                                          04690001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 04700001
           05  FILLER                  PIC  X(09)          VALUE        04710001
               '---------'.                                             04720001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 04730001
           05  FILLER                  PIC  X(08)          VALUE        04740001
               '--------'.                                              04750001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 04760001
           05  FILLER                  PIC  X(15)          VALUE        04770002
               '---------------'.                                       04780001
           05  FILLER                  PIC  X(02)          VALUE SPACE. 04790001
                                                                        04800001
       01  XRDL-XFER-SUM-DTL-LINE.                                      04810001
           05  FILLER                  PIC  X(01)          VALUE SPACE. 04820001
           05  XRDL-SUM-TO-LOC-NBR     PIC  X(04)          VALUE SPACE. 04830001
           05  FILLER                  PIC  X(12)          VALUE SPACE. 04840035
           05  XRDL-SUM-TOTAL-TRANS    PIC  Z(06)9(01)     VALUE ZEROS. 04850001
           05  FILLER                  PIC  X(03)          VALUE SPACE. 04860001
           05  XRDL-SUM-TOTAL-QTY      PIC  Z(06)9(01)     VALUE ZEROS. 04870001
           05  FILLER                  PIC  X(07)          VALUE SPACE. 04880035
           05  XRDL-SUM-TOTAL-RTL      PIC  Z(06)9(01).99- VALUE ZEROS. 04890001
      ******************************************************************04900001
       LINKAGE SECTION.                                                 04910001
                                                                        04920001
      /*****************************************************************04930001
       PROCEDURE DIVISION.                                              04940001
      ******************************************************************04950001
                                                                        04960001
      ******************************************************************04970001
      *  MAIN PROCESSING.                                               04980001
      ******************************************************************04990001
       0000-MAIN-MODULE.                                                05000001
                                                                        05010001
           DISPLAY '**********************************'.                05020001
           DISPLAY '* START OF TFKRP009               '.                05030001
           DISPLAY '**********************************'.                05040001
                                                                        05050001
           PERFORM 0100-INITIALIZE.                                     05060001
                                                                        05070001
                                                                        05080001
           PERFORM 1000-PROCESS-XFER-DTL                                05090001
             UNTIL PS-MISDIRECT-XFER-DTL-EOF.                           05100001
                                                                        05110001
           PERFORM 8240-WRITE-TOTAL-LINE.                               05120001
                                                                        05130001
           PERFORM 8250-WRITE-SUMMARY-PAGE.                             05140001
                                                                        05150001
           PERFORM 8900-CLOSE-FILES.                                    05160001
                                                                        05170001
           PERFORM 0900-DISPLAY-PROGRAM-TOTALS.                         05180001
                                                                        05190001
           GOBACK.                                                      05200001
                                                                        05210001
      ******************************************************************05220001
      *                                                                 05230001
      ******************************************************************05240001
       0100-INITIALIZE.                                                 05250001
                                                                        05260001
           ACCEPT SDT-YYYYMMDD         FROM DATE YYYYMMDD.              05270001
           ACCEPT SDT-HHMMSS           FROM TIME.                       05280001
                                                                        05290001
           DISPLAY 'TFKRP009 RUN DATE: ' SDT-YYYYMMDD ' - '             05300001
              SDT-HHMMSS.                                               05310001
                                                                        05320001
           MOVE SDT-YYYYMMDD-YY        TO DP132O-RUN-YEAR.              05330001
           MOVE SDT-YYYYMMDD-MM        TO DP132O-RUN-MONTH.             05340001
           MOVE SDT-YYYYMMDD-DD        TO DP132O-RUN-DAY.               05350001
           MOVE SDT-HHMMSS-HH          TO DP132O-RUN-HOUR.              05360001
           MOVE SDT-HHMMSS-MM          TO DP132O-RUN-MINUTE.            05370001
           MOVE 'TFKRP009'             TO DP132O-PROGRAM-NAME.          05380001
           MOVE 1                      TO DP132O-REPORT-NUMBER.         05390001
                                                                        05400001
           PERFORM 2100-OPEN-FILES.                                     05410026
                                                                        05420025
           PERFORM 2200-READ-MISDIRECT-XFER-DTL.                        05430025
                                                                        05440025
           IF NOT PS-MISDIRECT-XFER-DTL-EOF                             05450025
               INITIALIZE DB2-DATE                                      05460025
               MOVE TF067-TRANSFER-DATE(1:4) TO DB2-DATE-CCYY           05470025
               MOVE TF067-TRANSFER-DATE(5:2) TO DB2-DATE-MM             05480025
               MOVE TF067-TRANSFER-DATE(7:2) TO DB2-DATE-DD             05490025
               MOVE DB2-DATE                 TO RHL2-DTE-BEGIN          05500025
           ELSE                                                         05510025
               PERFORM 8300-READ-CURR-DTE-CARD                          05520025
           END-IF.                                                      05530025
                                                                        05540025
           PERFORM 2300-INITIALIZE-TABLE VARYING SUB                    05550025
               FROM 1 BY 1 UNTIL SUB > MAX-SUB.                         05560025
                                                                        05570025
           MOVE ZERO TO SUB.                                            05580025
                                                                        05590025
           PERFORM 3000-OPEN-RTV-CURSOR.                                05600025
           PERFORM 3100-FETCH-RTV-LOCS                                  05610025
                   UNTIL PS-RTV-LOCS-AT-END OR SUB > MAX-SUB.           05620025
           PERFORM 3200-CLOSE-RTV-CURSOR.                               05630025
      ******************************************************************05640001
       0900-DISPLAY-PROGRAM-TOTALS.                                     05650001
                                                                        05660001
           DISPLAY '**********************************'.                05670001
           DISPLAY '* TFKRP009 PROGRAM STATISTICS:    '.                05680001
           DISPLAY '**********************************'.                05690001
           DISPLAY '* TOTAL XFERS READ: ' PT-FIRSTXFER-RCD-FND.         05700001
           DISPLAY '* REPORT DETAIL WRITTEN: ' PT-RCD-WRTTN.            05710001
           DISPLAY '**********************************'.                05720001
           DISPLAY '**********************************'.                05730001
           DISPLAY '* END OF TFKRP009                 '.                05740001
           DISPLAY '**********************************'.                05750001
                                                                        05760001
      /*****************************************************************05770001
      *                                                                 05780001
      ******************************************************************05790001
       1000-PROCESS-XFER-DTL.                                           05800001
                                                                        05810001
           IF TF067-ORIG-TO-LOC NOT = PV-PREV-TO-LOC-NBR                05820003
               PERFORM 8210-WRITE-DTL-BREAK-LINE                        05830001
               MOVE TF067-ORIG-TO-LOC   TO PV-PREV-TO-LOC-NBR           05840003
           END-IF.                                                      05850001
                                                                        05860001
           PERFORM 2000-FMT-XFER-RPT-RCD.                               05870001
                                                                        05880001
           PERFORM 2200-READ-MISDIRECT-XFER-DTL.                        05890025
                                                                        05900001
      ******************************************************************05910001
       2000-FMT-XFER-RPT-RCD.                                           05920001
                                                                        05930001
           INITIALIZE                  XRDL-XFER-RPT-DTL-LINE.          05940001
           MOVE TF067-ORIG-TO-LOC        TO XRDL-ORIG-TO-LOC-NBR.       05950001
           MOVE TF067-ACTUAL-TO-LOC      TO XRDL-ACTL-TO-LOC-NBR.       05960001
           MOVE TF067-TRANSFER-TYPE-DESC TO XRDL-TRANS-TYPE.            05970001
           MOVE TF067-TRANSFER-NBR-STR   TO XRDL-STR-NBR.               05980001
           MOVE TF067-TRANSFER-NBR-SEQ   TO XRDL-SEQ-NBR.               05990001
           MOVE TF067-DEPT-NBR         TO XRDL-DEPT-NBR.                06000001
           MOVE TF067-SUB              TO XRDL-SUB-NBR.                 06010001
           MOVE TF067-SKU              TO XRDL-SKU-NBR.                 06020001
           MOVE TF067-CREATE-DTE       TO XRDL-DTE-CMPLT-XFER.          06030001
           MOVE TF067-RCVD-DTE         TO XRDL-XFER-DTE-RCVD.           06040002
           MOVE TF067-TOTAL-QTY        TO XRDL-TOTAL-QTY.               06050001
           MOVE TF067-TOTAL-RETAIL     TO XRDL-TOTAL-RTL.               06060001
           ADD +1                       TO PV-TOTAL-TRANS               06070001
                                           PV-TOTAL-TRANS-ALL.          06080001
           ADD TF067-TOTAL-QTY          TO PV-TOTAL-QTY                 06090001
                                           PV-TOTAL-QTY-ALL.            06100001
           IF TF067-AMT-SIGN = PC-MINUS                                 06110013
               MOVE PC-MINUS            TO XRDL-MINUS                   06120016
               MULTIPLY TF067-TOTAL-RETAIL BY -1 GIVING PV-TOTAL-RETAIL 06130013
           ELSE                                                         06140014
               MOVE TF067-TOTAL-RETAIL TO PV-TOTAL-RETAIL               06150014
           END-IF.                                                      06160013
                                                                        06170013
           COMPUTE PV-TOTAL-EXT-RTL = PV-TOTAL-RETAIL * TF067-TOTAL-QTY.06180014
           MOVE PV-TOTAL-EXT-RTL TO XRDL-EXT-TOT-RTL.                   06190014
           ADD PV-TOTAL-EXT-RTL  TO PV-TOTAL-TTL-RTL                    06200020
                                    PV-TOTAL-RTL-ALL.                   06210019
                                                                        06220017
           PERFORM 3300-ACCUM-TOTALS VARYING SUB                        06230025
               FROM 1 BY 1                                              06240025
               UNTIL SUB > NO-RTVS.                                     06250025
                                                                        06260025
           PERFORM 8200-WRITE-XFER-RPT-DTL.                             06270025
                                                                        06280025
      /*****************************************************************06290025
      *                                                                 06300025
      ******************************************************************06310025
       2100-OPEN-FILES.                                                 06320025
                                                                        06330025
           OPEN INPUT MISDIRECT-XFER-DTL.                               06340025
           OPEN OUTPUT MISDIRECT-XFER-RPT.                              06350025
                                                                        06360025
      ******************************************************************06370025
      *  READ INPUT DATA                                                06380025
      ******************************************************************06390025
       2200-READ-MISDIRECT-XFER-DTL.                                    06400025
                                                                        06410025
           READ MISDIRECT-XFER-DTL                                      06420025
             INTO TF067-TRANS-MISDIRECT-REC                             06430025
               AT END                                                   06440025
                 SET PS-MISDIRECT-XFER-DTL-EOF                          06450025
                                       TO TRUE.                         06460025
                                                                        06470025
           IF PS-NOT-MISDIRECT-XFER-DTL-EOF                             06480025
              ADD +1 TO PT-FIRSTXFER-RCD-FND                            06490025
           END-IF.                                                      06500025
                                                                        06510025
      ******************************************************************06520025
      *  INITIALIZE RTV TABLE                                           06530025
      ******************************************************************06540025
       2300-INITIALIZE-TABLE.                                           06550025
                                                                        06560025
           MOVE ZERO TO PV-RTV-LOC    (SUB)                             06570025
                        PV-RTV-TRANS  (SUB)                             06580025
                        PV-RTV-QTY    (SUB)                             06590025
                        PV-RTV-TOT-RTL(SUB).                            06600025
                                                                        06610025
      ******************************************************************06620025
      *  OPEN RTV TABLE                                                 06630025
      ******************************************************************06640025
       3000-OPEN-RTV-CURSOR.                                            06650025
                                                                        06660025
           EXEC SQL                                                     06670025
              OPEN RTV-LOCS-CSR                                         06680025
           END-EXEC.                                                    06690025
                                                                        06700025
           EVALUATE TRUE                                                06710025
               WHEN SQLCODE = +0                                        06720025
                   CONTINUE                                             06730025
               WHEN SQLCODE = +100                                      06740025
                   CONTINUE                                             06750025
               WHEN OTHER                                               06760025
                   MOVE '3000-OPEN-RTV-CURSOR' TO PV-PARAGRAPH-NAME     06770025
                   PERFORM 8800-DB2-ERROR-ROUTINE                       06780025
           END-EVALUATE.                                                06790025
                                                                        06800025
      ******************************************************************06810025
      *  GET THE RTV LOCATIONS LOAD TO A TABLE                          06820025
      ******************************************************************06830025
       3100-FETCH-RTV-LOCS.                                             06840025
                                                                        06850025
           ADD +1 TO SUB.                                               06860025
                                                                        06870025
           EXEC SQL                                                     06880025
               FETCH RTV-LOCS-CSR                                       06890025
               INTO   :XST00135-RTV-LOC-NBR                             06900025
           END-EXEC                                                     06910025
                                                                        06920025
           EVALUATE TRUE                                                06930025
               WHEN SQLCODE = +0                                        06940025
                   MOVE XST00135-RTV-LOC-NBR TO PV-RTV-LOC(SUB)         06950025
                   MOVE SUB                  TO NO-RTVS                 06960025
               WHEN SQLCODE = +100                                      06970025
                   SET PS-RTV-LOCS-AT-END TO TRUE                       06980025
               WHEN OTHER                                               06990025
                   MOVE '3100-FETCH-RTV-LOCS' TO PV-PARAGRAPH-NAME      07000025
                   PERFORM 8800-DB2-ERROR-ROUTINE                       07010025
           END-EVALUATE.                                                07020025
                                                                        07030025
      ******************************************************************07040025
      * CLOSE RTV CURSOR                                                07050025
      ******************************************************************07060025
       3200-CLOSE-RTV-CURSOR.                                           07070025
                                                                        07080025
           EXEC SQL                                                     07090025
               CLOSE RTV-LOCS-CSR                                       07100025
           END-EXEC.                                                    07110025
                                                                        07120025
           EVALUATE TRUE                                                07130025
               WHEN SQLCODE = +0                                        07140025
                   CONTINUE                                             07150025
               WHEN OTHER                                               07160025
                   MOVE '3200-CLOSE-RTV-CURSOR' TO PV-PARAGRAPH-NAME    07170025
                   PERFORM 8800-DB2-ERROR-ROUTINE                       07180025
           END-EVALUATE.                                                07190025
                                                                        07200025
      ******************************************************************07210025
      * ACCUMULATE THE RTV LOCATIONS TOTALS                             07220025
      ******************************************************************07230025
                                                                        07240025
       3300-ACCUM-TOTALS.                                               07250025
                                                                        07260025
           IF TF067-ORIG-TO-LOC = PV-RTV-LOC (SUB)                      07270025
               ADD +1                       TO PV-RTV-TRANS (SUB)       07280025
               ADD TF067-TOTAL-QTY          TO PV-RTV-QTY   (SUB)       07290025
               ADD PV-TOTAL-EXT-RTL         TO PV-RTV-TOT-RTL(SUB)      07330029
           END-IF.                                                      07350025
                                                                        07360025
      ******************************************************************07370001
      * 8200-WRITE-XFER-RPT-DTL                                         07380001
      ******************************************************************07390001
       8200-WRITE-XFER-RPT-DTL.                                         07400001
                                                                        07410001
           IF PV-LINE-COUNT >= PC-LINE-MAX                              07420001
           OR TF067-ORIG-TO-LOC NOT = PV-PREV-TO-LOC-NBR                07430001
               PERFORM 8220-WRITE-XFER-RPT-HDR                          07440001
           END-IF.                                                      07450001
                                                                        07460001
           WRITE MISDIRECT-XFER-RPT-RCD                                 07470001
             FROM XRDL-XFER-RPT-DTL-LINE.                               07480001
                                                                        07490001
           ADD +1                      TO PT-RCD-WRTTN                  07500001
                                          PV-LINE-COUNT.                07510001
                                                                        07520001
      ******************************************************************07530001
      *                                                                 07540001
      ******************************************************************07550001
       8210-WRITE-DTL-BREAK-LINE.                                       07560001
                                                                        07570001
           IF PV-LINE-COUNT >= PC-LINE-MAX                              07580001
           OR TF067-ORIG-TO-LOC NOT = PV-PREV-TO-LOC-NBR                07590001
               PERFORM 8220-WRITE-XFER-RPT-HDR                          07600001
           ELSE                                                         07610001
               MOVE SPACE              TO MISDIRECT-XFER-RPT-RCD        07620001
               WRITE MISDIRECT-XFER-RPT-RCD                             07630001
                 AFTER ADVANCING 1 LINE                                 07640001
                                                                        07650001
               ADD +1                  TO PV-LINE-COUNT                 07660001
           END-IF.                                                      07670001
                                                                        07680001
      ******************************************************************07690001
      * CHECK FOR NEW RTV LOCATION BREAK                                07700001
      ******************************************************************07710001
       8220-WRITE-XFER-RPT-HDR.                                         07720001
                                                                        07730001
           IF TF067-ORIG-TO-LOC NOT = PV-PREV-TO-LOC-NBR                07740001
               PERFORM 8240-WRITE-TOTAL-LINE                            07750024
               MOVE ZERO               TO PV-PAGE-COUNT                 07760001
               MOVE TF067-ORIG-TO-LOC   TO XST00001-LOC-NBR             07770003
                                          RHL1-RTV-LOC                  07780001
               PERFORM 8230-GET-RTV-NAME                                07790001
               MOVE XST00001-LOC-NM    TO RHL1-RTV-NM                   07800001
           END-IF.                                                      07810001
                                                                        07820001
           ADD +1                      TO PV-PAGE-COUNT.                07830001
           MOVE PV-PAGE-COUNT          TO DP132O-PAGE-NUMBER.           07840001
                                                                        07850001
           WRITE MISDIRECT-XFER-RPT-RCD                                 07860001
             FROM DP132O-STANDRD-HEADER-132-COLS                        07870001
             AFTER ADVANCING PAGE.                                      07880001
                                                                        07890001
           WRITE MISDIRECT-XFER-RPT-RCD                                 07900001
             FROM RHL1-RPT-HEAD-LINE1                                   07910001
             AFTER ADVANCING 1 LINE.                                    07920001
                                                                        07930001
           WRITE MISDIRECT-XFER-RPT-RCD                                 07940001
             FROM RHL2-RPT-HEAD-LINE2                                   07950001
             AFTER ADVANCING 1 LINE.                                    07960001
                                                                        07970001
           WRITE MISDIRECT-XFER-RPT-RCD                                 07980001
             FROM RHL3-RPT-HEAD-LINE3                                   07990001
             AFTER ADVANCING 2 LINE.                                    08000001
                                                                        08010001
           WRITE MISDIRECT-XFER-RPT-RCD                                 08020001
             FROM RHL4-RPT-HEAD-LINE4                                   08030001
             AFTER ADVANCING 1 LINE.                                    08040001
                                                                        08050001
           WRITE MISDIRECT-XFER-RPT-RCD                                 08060001
             FROM RHL5-RPT-HEAD-LINE5                                   08070001
             AFTER ADVANCING 1 LINE.                                    08080001
                                                                        08090001
           MOVE SPACE                  TO MISDIRECT-XFER-RPT-RCD.       08100001
           WRITE MISDIRECT-XFER-RPT-RCD                                 08110001
             AFTER ADVANCING 1 LINE.                                    08120001
                                                                        08130001
           MOVE +8                     TO PV-LINE-COUNT.                08140001
                                                                        08150001
      ******************************************************************08160001
      *  THIS ROUTINE GETS THE RTV LOCATION NAME                        08170001
      ******************************************************************08180001
       8230-GET-RTV-NAME.                                               08190001
                                                                        08200001
           EXEC SQL                                                     08210001
             SELECT LOC_NM                                              08220001
             INTO :XST00001-LOC-NM                                      08230001
             FROM XST_LOC                                               08240001
             WHERE LOC_NBR = :XST00001-LOC-NBR                          08250001
           END-EXEC.                                                    08260001
                                                                        08270001
           EVALUATE TRUE                                                08280001
               WHEN SQLCODE = +0                                        08290001
                   CONTINUE                                             08300001
               WHEN SQLCODE = +100                                      08310001
                   CONTINUE                                             08320001
               WHEN OTHER                                               08330001
                   MOVE 'SELECT-LOC-NAME' TO PV-PARAGRAPH-NAME          08340001
                   PERFORM 8800-DB2-ERROR-ROUTINE                       08350025
           END-EVALUATE.                                                08360001
                                                                        08370001
      *-----------------------------------------------------------------08380001
      * PRINTS THE TOTAL TRANSFERS, QTY AND RETAIL FOR RTV              08390001
      *-----------------------------------------------------------------08400001
       8240-WRITE-TOTAL-LINE.                                           08410001
           IF PV-PREV-TO-LOC-NBR NOT = ZERO                             08420001
               MOVE SPACE                  TO MISDIRECT-XFER-RPT-RCD    08430001
               WRITE MISDIRECT-XFER-RPT-RCD                             08440001
                 AFTER ADVANCING 1 LINE                                 08450001
               MOVE PV-PREV-TO-LOC-NBR     TO XRDL-TTL-TO-LOC           08460001
               MOVE PV-TOTAL-TRANS         TO XRDL-TTL-TOTAL-TRANS      08470001
               MOVE PV-TOTAL-QTY           TO XRDL-TTL-TOTAL-QTY        08480001
               MOVE PV-TOTAL-TTL-RTL       TO XRDL-TTL-TOTAL-RTL        08490019
               WRITE MISDIRECT-XFER-RPT-RCD                             08500001
               FROM XRDL-XFER-RPT-TTL-LINE                              08510001
                  AFTER ADVANCING 1 LINE                                08520001
               MOVE ZERO                   TO PV-TOTAL-TRANS            08530001
                                              PV-TOTAL-QTY              08540001
                                              PV-TOTAL-RTL              08550001
                                              PV-TOTAL-EXT-RTL          08560013
                                              PV-TOTAL-TTL-RTL          08570033
      **********************                  PV-TOTAL-TTL-RTL          08571033
           END-IF.                                                      08580001
                                                                        08590001
      *-----------------------------------------------------------------08600001
      * PRINTS SUMMARY OF ALL RTV LOCATIONS                             08610001
      *-----------------------------------------------------------------08620001
       8250-WRITE-SUMMARY-PAGE.                                         08630001
                                                                        08640001
           MOVE 1                      TO DP132O-PAGE-NUMBER.           08650001
                                                                        08660001
           WRITE MISDIRECT-XFER-RPT-RCD                                 08670001
             FROM DP132O-STANDRD-HEADER-132-COLS                        08680001
             AFTER ADVANCING PAGE.                                      08690001
                                                                        08700001
           WRITE MISDIRECT-XFER-RPT-RCD                                 08710001
             FROM RHL1-RPT-SUM-LINE1                                    08720001
             AFTER ADVANCING 1 LINE.                                    08730001
                                                                        08740001
           WRITE MISDIRECT-XFER-RPT-RCD                                 08750001
             FROM RHL2-RPT-HEAD-LINE2                                   08760001
             AFTER ADVANCING 1 LINE.                                    08770001
                                                                        08780001
           WRITE MISDIRECT-XFER-RPT-RCD                                 08790001
             FROM RHL1-RPT-SUM-LINE2                                    08800001
             AFTER ADVANCING 2 LINE.                                    08810030
                                                                        08820001
           WRITE MISDIRECT-XFER-RPT-RCD                                 08830001
             FROM RHL1-RPT-SUM-LINE3                                    08840001
             AFTER ADVANCING 1 LINE.                                    08850001
                                                                        08860001
           WRITE MISDIRECT-XFER-RPT-RCD                                 08870001
             FROM RHL1-RPT-SUM-LINE4                                    08880001
             AFTER ADVANCING 1 LINE.                                    08890001
                                                                        08900001
           PERFORM 8260-MOVE-TOTALS                                     08910025
               VARYING SUB FROM 1 BY 1                                  08920025
               UNTIL SUB > NO-RTVS.                                     08930025
                                                                        08940025
           MOVE PC-ALL                 TO XRDL-SUM-TO-LOC-NBR.          08950001
           MOVE PV-TOTAL-TRANS-ALL     TO XRDL-SUM-TOTAL-TRANS.         08960001
           MOVE PV-TOTAL-QTY-ALL       TO XRDL-SUM-TOTAL-QTY.           08970001
           MOVE PV-TOTAL-RTL-ALL       TO XRDL-SUM-TOTAL-RTL.           08980001
           WRITE MISDIRECT-XFER-RPT-RCD                                 08990001
             FROM XRDL-XFER-SUM-DTL-LINE                                09000001
             AFTER ADVANCING 1 LINE.                                    09010001
                                                                        09020001
      *-----------------------------------------------------------------09030025
      * PRINTS TOTALS FOR ALL RTV LOCATIONS                             09040025
      *-----------------------------------------------------------------09050025
       8260-MOVE-TOTALS.                                                09060025
                                                                        09070025
           MOVE PV-RTV-LOC(SUB)        TO XRDL-SUM-TO-LOC-NBR.          09080025
           MOVE PV-RTV-TRANS(SUB)      TO XRDL-SUM-TOTAL-TRANS.         09090025
           MOVE PV-RTV-QTY(SUB)        TO XRDL-SUM-TOTAL-QTY.           09100025
           MOVE PV-RTV-TOT-RTL(SUB)    TO XRDL-SUM-TOTAL-RTL.           09110025
           WRITE MISDIRECT-XFER-RPT-RCD                                 09120025
             FROM XRDL-XFER-SUM-DTL-LINE                                09130025
             AFTER ADVANCING 1 LINE.                                    09140025
                                                                        09150025
072500*----------------------------------------------------------       09160001
072700*     READ CONTROL CARD TFRD069.                                  09170001
072900*----------------------------------------------------------       09180001
073000 8300-READ-CURR-DTE-CARD.                                         09190001
073100                                                                  09200001
           OPEN INPUT CONTROL-CARD-DTE.                                 09210001
                                                                        09220001
073200     READ CONTROL-CARD-DTE                                        09230001
073300                          INTO TF069-CC-CONTROL-CARD              09240001
073400       AT END                                                     09250001
073500          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    09260001
073600                                                                  09270001
073700     IF PS-END-OF-CNTL-CRD-FILE                                   09280001
073800       DISPLAY ' '                                                09290001
073900       DISPLAY '** ABEND     **'                                  09300001
074000       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              09310001
074100       DISPLAY '** PARAGRAPH **  = 8300-READ-CURR-DTE-CARD'       09320001
074200       DISPLAY '** CONTROL FILE IS EMPTY  '                       09330001
074300       DISPLAY ' '                                                09340001
074400       MOVE +4003 TO ABEND-CODE                                   09350001
074500       CALL 'ILBOABN0' USING ABEND-CODE                           09360001
074600     ELSE                                                         09370001
074700       DISPLAY '** CURRENT TRANSFER DATE CONTROL CARD  **'        09380001
074800       DISPLAY '** TFCC011       **  = ' TF069-CC-CRNT-DTE        09390001
074900       DISPLAY ' '                                                09400001
075000     END-IF.                                                      09410001
075100                                                                  09420001
           INITIALIZE DB2-DATE.                                         09430001
           MOVE TF069-CC-CRNT-DTE(1:4)     TO DB2-DATE-CCYY.            09440001
           MOVE TF069-CC-CRNT-DTE(5:2)     TO DB2-DATE-MM.              09450001
           MOVE TF069-CC-CRNT-DTE(7:2)     TO DB2-DATE-DD.              09460001
                                                                        09470001
           CLOSE CONTROL-CARD-DTE.                                      09480001
                                                                        09490001
           PERFORM 8310-DATE-ROUTINE.                                   09500001
           MOVE DB2-DATE                   TO RHL2-DTE-BEGIN.           09510024
                                                                        09520001
268140*----------------------------------------------------------       09530001
268200* DATE ROUTINE TO SET UP THE PROCESS DATE IN                      09540001
268300* CCYYMMDD FORMAT.                                                09550001
268400*----------------------------------------------------------       09560001
268500 8310-DATE-ROUTINE.                                               09570001
268600                                                                  09580001
268700     INITIALIZE DPG51 DPG52 DPG53                                 09590001
268800                DPG54 DPG55 DPG56.                                09600001
268900                                                                  09610001
269000     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      09620001
269100     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      09630001
269200     MOVE DB2-DATE                   TO DPG52-DB2-ISO-DATE-FMT.   09640001
           DISPLAY 'DB2-DATE = ' DB2-DATE.                              09650001
269300                                                                  09660001
269400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    09670001
269500                                             DPG54 DPG55 DPG56.   09680001
269600                                                                  09690001
269700     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  09700001
269800       DISPLAY '** ABEND **'                                      09710001
269900       DISPLAY '** PROGRAM = TFKRP009'                            09720001
270000       DISPLAY 'DATE = ' TF069-CC-CRNT-DTE                        09730001
270100       DISPLAY DPG54-ERROR-MESSAGE                                09740001
270200       MOVE 4019 TO ABEND-CODE                                    09750001
270300       CALL 'ILBOABN0' USING ABEND-CODE                           09760001
270400     END-IF.                                                      09770001
                                                                        09780001
      *-----------------------------------------------------------------09790001
      *8800-DB2-ERROR-ROUTINE.                                          09800025
      *-----------------------------------------------------------------09810001
       8800-DB2-ERROR-ROUTINE.                                          09820025
                                                                        09830001
           PERFORM 8900-CLOSE-FILES.                                    09840001
           MOVE SQLCODE TO SQLCODE2.                                    09850001
           MOVE SQLERRD(3) TO SQLERRD3.                                 09860001
                                                                        09870001
           DISPLAY '** ERROR **        = SQL ERROR'.                    09880001
           DISPLAY '** PROGRAM **      = '  PC-PROGRAM-NAME.            09890001
           DISPLAY '** PARAGRAPH **    = '  PV-PARAGRAPH-NAME.          09900001
           DISPLAY '** SQL ERROR **    = '  SQLCODE2.                   09910001
           DISPLAY '** SQLERRM  **     = '  SQLERRM.                    09920001
                                                                        09930001
      *----------------------------------------------------------------*09940001
      *  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   09950001
      *  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        09960001
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     09970001
      *  FORMAT.                                                        09980001
      *----------------------------------------------------------------*09990001
           COPY DPPD004.                                                10000001
                                                                        10010001
           CALL 'DSNTIAR' USING SQLCA                                   10020001
                                DP004-FORMATTED-MESSAGE                 10030001
                                DP004-ERROR-LINE-LENGTH.                10040001
                                                                        10050001
           DISPLAY DP004-ASTERISK-LINE.                                 10060001
                                                                        10070001
           PERFORM                                                      10080001
              VARYING DP004-MSG-IDX                                     10090001
              FROM 1 BY 1                                               10100001
              UNTIL DP004-MSG-IDX > DP004-MAX-MESSAGE-LINES             10110001
                  DISPLAY '**'                                          10120001
                          DP004-MESSAGE-LINE (DP004-MSG-IDX)            10130001
                          ' **'                                         10140001
           END-PERFORM.                                                 10150001
                                                                        10160001
           DISPLAY DP004-ASTERISK-LINE.                                 10170001
                                                                        10180001
           IF SQLCODE NOT = -911                                        10190001
               EXEC SQL                                                 10200001
                   COMMIT                                               10210001
               END-EXEC                                                 10220001
           END-IF.                                                      10230001
                                                                        10240001
           SET AC-DB2-ERROR TO TRUE.                                    10250001
                                                                        10260001
           CALL 'ILBOABN0' USING ABEND-CODE.                            10270001
                                                                        10280001
      ******************************************************************10290001
      *    CLOSE THE FILES.                                             10300001
      ******************************************************************10310001
       8900-CLOSE-FILES.                                                10320001
                                                                        10330001
           CLOSE MISDIRECT-XFER-DTL                                     10340001
                 MISDIRECT-XFER-RPT.                                    10350001
                                                                        10360001
      ******************************************************************10370001
      *  THIS ROUTINE FORCES AN ABEND DUE TO A NON-DB2 RELATED PROBLEM. 10380001
      ******************************************************************10390001
       9999-ABEND.                                                      10400001
                                                                        10410001
           DISPLAY '**********************************'.                10420001
           DISPLAY '**  ABEND     **'.                                  10430001
           DISPLAY '**  PROGRAM   **  = ' PC-PROGRAM-NAME.              10440001
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            10450001
           DISPLAY '**  OPERATION **  = ' PV-OPER-ATTEMPTED.            10460001
           DISPLAY '**********************************'.                10470001
           SET AC-NON-DB2-ERROR TO TRUE.                                10480001
           CALL 'ILBOABN0'  USING ABEND-CODE.                           10490001
                                                                        10500001
