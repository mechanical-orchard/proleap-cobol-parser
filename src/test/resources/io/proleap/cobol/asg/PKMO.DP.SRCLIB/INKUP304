       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.     INKUP304.                                        00020000
       INSTALLATION.   KOHLS DEPARTMENT STORES.                         00030000
       DATE-WRITTEN.   08/22/2005.                                      00040000
       DATE-COMPILED.                                                   00050000
                                                                        00060000
      ******************************************************************00070000
      *PURPOSE:  THE MODULE TAKES IN THE FAST TRANSFER SYSTEM INVENTORY 00080000
      *          SNAPSHOT FILE FOR STORES PERFORMING AN INVENTORY. THE  00090000
      *          TO-LOCATION TRANSACTIONS ARE FORMATTED TO REFLECT A    00100000
      *          TRANSFER SHEET, PRICE IS CALCULATED, AND THE RECORD IS 00110000
      *          WRITTEN TO THE SHEET INVENTORY TABLE - TINENTY.        00120000
      *                 (SEE THE FLOW SECTION FOR MORE DETAILS)         00130000
      *                                                                 00140000
      *CHG ID/                                                          00150000
      *WR/PROJ DATE       PGMR        DESCRIPTION                       00160000
      *------- ---------- ----------- ----------------------------------00170000
W28545*W28545  08-22-2005 ROD JANSSEN THE NEW TRANSFER PROCESS          00180000
W28545*                               (CREATION)                        00190000
P28545*W28545  03-24-2006 ROD JANSSEN CYCLE INVENTORY PRICE MODULE SETUP00191000
D28545*W28545  04-11-2006 ROD JANSSEN DUMMY SKU & RETURN CODES.         00192000
W30692*W30692* 06-23-2006 ROD JANSSEN RTV SNAPSHOT ISSUE AND VOLUME     00193000
X28545*P28545  09-25-2006 ROD JANSSEN REPORT TOTAL DOES NOT BALANCE.    00194000
974649*974649  01-24-2007 ROD JANSSEN REPORT GENERATION ISSUE....       00195000
004819*004819  06-05-2008 TAISA KONTAROVICH  IF RTV TRANSFER, USE THE   00195105
004819*004819             PRICE FROM THE INPUT FILE                     00195205
W33304*W33304  09-15-2008 VINOD       HOLDING INVENTORY LEDGER OPEN -   00195307
W33304*W33304                         HILO CHANGES                      00195407
PM3403*PM3403  04-20-2012 S.JACKSON LG RETAIL RECOMPILE ONLY(TFRD053)      CL**6
      ******************************************************************00196000
                                                                        00197000
       ENVIRONMENT DIVISION.                                            00198000
       CONFIGURATION SECTION.                                           00199000
       INPUT-OUTPUT SECTION.                                            00200000
       FILE-CONTROL.                                                    00210000
                                                                        00220000
           SELECT TRANSFER-DATA-FILE                                    00230000
               ASSIGN TO INP01.                                         00240000
                                                                        00250000
           SELECT TRANSFER-DATA-ERROR-FILE                              00260000
               ASSIGN TO OUT01.                                         00270000
                                                                        00280000
W33304     SELECT TRANSFER-INPUT-ERROR-FILE                                     
W33304         ASSIGN TO OUT02.                                                 
W33304                                                                          
           SELECT TRANSFER-REPORT                                       00290000
               ASSIGN TO RPT01.                                         00300000
                                                                        00310000
       DATA DIVISION.                                                   00320000
       FILE SECTION.                                                    00330000
                                                                        00340000
       FD  TRANSFER-DATA-FILE                                           00350000
           RECORDING MODE IS F                                          00360000
           LABEL RECORDS ARE STANDARD                                   00370000
           BLOCK CONTAINS 0 RECORDS.                                    00380000
       01  TRANSFER-DATA-RECORD     PIC X(97).                          00390000
                                                                        00400000
       FD  TRANSFER-DATA-ERROR-FILE                                     00410000
           LABEL RECORDS ARE OMITTED                                    00420000
           RECORDING MODE IS F                                          00430000
           BLOCK CONTAINS 0 RECORDS.                                    00440000
       01  TFR-DATA-ERROR-RECORD    PIC X(97).                          00450000
                                                                        00460000
W33304 FD  TRANSFER-INPUT-ERROR-FILE                                            
W33304     LABEL RECORDS ARE OMITTED                                            
W33304     RECORDING MODE IS F                                                  
W33304     BLOCK CONTAINS 0 RECORDS.                                            
W33304 01  TFR-INPUT-ERROR-RECD     PIC X(97).                                  
W33304                                                                          
       FD  TRANSFER-REPORT                                              00470000
           LABEL RECORDS ARE OMITTED                                    00480000
           RECORD CONTAINS 132 CHARACTERS                               00490000
           RECORDING MODE IS F                                          00500000
           DATA RECORD IS REPORT-LINE.                                  00510000
       01  REPORT-LINE              PIC X(132).                         00520000
                                                                        00530000
      /*****************************************************************00540000
       WORKING-STORAGE SECTION.                                         00550000
      ******************************************************************00560000
                                                                        00570000
       01  PA-PROGRAM-ACCUMULATORS.                                     00580000
           05  PA-COMMIT-COUNT         PIC 9(09) VALUE ZEROES.          00590000
           05  PA-INSERT-COUNT         PIC 9(09) VALUE ZEROES.          00600000
           05  PA-UPDATE-COUNT         PIC 9(09) VALUE ZEROES.          00610000
           05  PA-EXTRACT-RECS-READ    PIC 9(09) VALUE ZEROES.          00620000
           05  PA-ZERO-REC-DROPPED     PIC 9(09) VALUE ZEROES.          00630000
           05  PA-DUPLICATE-REC        PIC 9(09) VALUE ZEROES.          00640000
           05  PA-ITEM-QTY             PIC S9(15)    COMP-3 VALUE ZEROS.00650000
           05  PA-EXTD-RTL-AMT         PIC S9(15)V99 COMP-3 VALUE ZEROS.00660000
           05  PA-TFR-ITEM-QTY         PIC S9(15)    COMP-3 VALUE ZEROS.00670000
           05  PA-TFR-EXTD-RTL-AMT     PIC S9(15)V99 COMP-3 VALUE ZEROS.00680000
           05  PA-DFF-EXTD-RTL-AMT     PIC S9(15)V99 COMP-3 VALUE ZEROS.00690000
           05  PA-LOC-ITEM-QTY         PIC S9(15)    COMP-3 VALUE ZEROS.00700000
           05  PA-LOC-EXTD-RTL-AMT     PIC S9(15)V99 COMP-3 VALUE ZEROS.00710000
           05  PA-LOC-TFR-ITEM-QTY     PIC S9(15)    COMP-3 VALUE ZEROS.00720000
           05  PA-LOC-TFR-EXTD-RTL-AMT PIC S9(15)V99 COMP-3 VALUE ZEROS.00730000
           05  PA-LOC-DFF-EXTD-RTL-AMT PIC S9(15)V99 COMP-3 VALUE ZEROS.00740000
           05  PA-TOT-ITEM-QTY         PIC S9(15)    COMP-3 VALUE ZEROS.00750000
           05  PA-TOT-EXTD-RTL-AMT     PIC S9(15)V99 COMP-3 VALUE ZEROS.00760000
           05  PA-TOT-TFR-ITEM-QTY     PIC S9(15)    COMP-3 VALUE ZEROS.00770000
           05  PA-TOT-TFR-EXTD-RTL-AMT PIC S9(15)V99 COMP-3 VALUE ZEROS.00780000
           05  PA-TOT-DFF-EXTD-RTL-AMT PIC S9(15)V99 COMP-3 VALUE ZEROS.00790000
                                                                        00800000
       01  PC-PROGRAM-CONSTANTS-AREA.                                   00810000
           05  PC-PROGRAM-NAME         PIC X(08)  VALUE 'INKUP304'.     00820000
           05  PC-JOB-NAME             PIC X(08)  VALUE 'INK321  '.     00830000
           05  PC-PRINT-LINE-MAX       PIC S9(04) VALUE +60 COMP.       00840000
           05  PC-MAX-RETRIES          PIC S9(04) VALUE +3 COMP SYNC.   00850000
           05  PC-OPERCO-NBR           PIC X(02)  VALUE '03'.           00860000
           05  PC-SUB-CL-CDE           PIC X(03)  VALUE '000'.          00870000
           05  PC-APLSYS-CDE           PIC X(02)  VALUE 'IN'.           00880000
           05  PC-MDSELV-CDE           PIC X(03)  VALUE 'SCL'.          00890000
                                                                        00900000
       01  PE-PROGRAM-ERROR-MESSAGES.                                   00910000
           05  PE-MSG-07                       PIC X(30) VALUE          00920000
                'ERROR IN SELECT - TCKRSTCNTL '.                        00930000
           05  PE-MSG-08                       PIC X(30) VALUE          00940000
                'UPDATE WORK_STRG - TCKRSTINF '.                        00950000
           05  PE-MSG-09                       PIC X(30) VALUE          00960000
                'PGM ABEND DURING A COMMIT    '.                        00970000
           05  PE-MSG-10                       PIC X(30) VALUE          00980000
                'UPDATE OF TCKRSTCNTL FAILED  '.                        00990000
           05  PE-MSG-11                       PIC X(30) VALUE          01000000
                'ERROR IN SELECT - TCKRSTINF  '.                        01010000
           05  PE-MSG-12                       PIC X(30) VALUE          01020000
                'UNABLE TO OBTAIN TIMESTAMP   '.                        01030000
                                                                        01040000
       01  PV-PROGRAM-VARIABLES-AREA.                                   01050000
P28545     05  PV-COUNT                 PIC S9(04) COMP VALUE ZEROS.    01060000
           05  PV-EDIT-SKU-NBR          PIC 9(08).                      01070000
           05  FILLER REDEFINES PV-EDIT-SKU-NBR.                        01080000
               10  PV-EDIT-SKU-NBR-DPT  PIC 9(03).                      01090000
               10  PV-EDIT-SKU-NBR-CLS  PIC 9(02).                      01100000
               10  PV-EDIT-REMAINDER    PIC 9(03).                      01110000
           05  FILLER REDEFINES PV-EDIT-SKU-NBR.                        01120000
               10  PV-EDIT-SKU-NBR-P1   PIC X(05).                      01130000
               10  PV-EDIT-SKU-NBR-P2   PIC X(03).                      01140000
                   88  PV-ZERO-SEQUENCE-SKU  VALUES '000' '999'.        01150000
           05  PV-MAJ-CL-NBR.                                           01160000
               10 PV-MAJ-CL-NBR-1      PIC X(01)  VALUE SPACES.         01170000
               10 PV-MAJ-CL-NBR-2      PIC X(01)  VALUE SPACES.         01180000
           05  PV-MAJ-CL-NBR-9 REDEFINES                                01190000
               PV-MAJ-CL-NBR           PIC 9(02).                       01200000
           05  PV-SUB-CL-NBR.                                           01210000
               10 PV-SUB-CL-NBR-1      PIC X(01)  VALUE SPACES.         01220000
               10 PV-SUB-CL-NBR-2-3    PIC X(02)    VALUE SPACES.       01230000
           05  PV-PAGE-COUNT           PIC S9(05) COMP-3 VALUE 0.       01240000
           05  PV-LINE-COUNT           PIC S9(05) COMP-3 VALUE 0.       01250000
           05  PV-CURRENT-TIME.                                         01260000
               10  PV-CT-HH            PIC XX.                          01270000
               10  PV-CT-MM            PIC XX.                          01280000
           05  PV-DEFAULT-CURRENT-DATE.                                 01290000
               10  PV-DF-CC            PIC XX       VALUE '20'.         01300000
               10  PV-DF-YY            PIC XX.                          01310000
               10  FILLER              PIC X        VALUE '-'.          01320000
               10  PV-DF-MM            PIC XX.                          01330000
               10  FILLER              PIC X        VALUE '-'.          01340000
               10  PV-DF-DD            PIC XX.                          01350000
           05  PV-CURRENT-DATE.                                         01360000
               10  PV-CD-YY            PIC XX.                          01370000
               10  PV-CD-MM            PIC XX.                          01380000
               10  PV-CD-DD            PIC XX.                          01390000
           05  PV-CURRENT-TIMESTAMP        PIC  X(26)      VALUE SPACES.01400000
           05  PV-COMMIT-TIMESTAMP         PIC  X(26)      VALUE SPACES.01410000
           05  PV-PARAGRAPH-NAME           PIC  X(30)      VALUE SPACES.01420000
           05  PV-ABEND-MESSAGE            PIC  X(75)      VALUE SPACES.01430000
           05  PV-OPERATION-ATTEMPTED      PIC  X(30)      VALUE SPACES.01440000
           05  PV-STR-NBR-SAVE             PIC S9(04) COMP VALUE ZEROS. 01450000
P28545     05  PV-INV-ID-SAVE              PIC S9(09) COMP VALUE ZEROS. 01460000
           05  PV-DOC-NBR-SAVE.                                         01470000
               10  PV-DOC-DOC-FROM-LOC-NBR PIC S9(04) COMP VALUE ZEROS. 01480000
               10  PV-DOC-DOC-SEQ-NBR      PIC S9(09) COMP VALUE ZEROS. 01490000
           05  PV-SKU-NBR-SAVE             PIC S9(09) COMP VALUE ZEROS. 01500000
           05  PV-EXTD-AMOUNT       PIC S9(09)V99 COMP-3 VALUE ZEROS.   01510000
           05  PV-SHEET-NBR         PIC 9(06) VALUE ZEROS.              01520000
           05  PV-SHEET-LINE-NBR    PIC S9(04) COMP VALUE ZEROS.        01530000
           05  PV-RETRY-COUNT       PIC S9(04) COMP VALUE ZEROS.        01540000
           05  PV-OPER-ATTEMPTED    PIC X(25)  VALUE SPACES.            01550000
           05  PV-RECORDS-READ      PIC S9(15) COMP-3 VALUE ZEROS.      01560000
           05  PV-STORE-ISSUE-COUNT PIC S9(15) COMP-3 VALUE ZEROS.      01570000
           05  PV-NO-UNIT-COUNT     PIC S9(15) COMP-3 VALUE ZEROS.      01580000
           05  PV-NO-PRICE-COUNT    PIC S9(15) COMP-3 VALUE ZEROS.      01590000
           05  PV-NO-UPC-NBR-COUNT  PIC S9(15) COMP-3 VALUE ZEROS.      01600000
           05  PV-CLEARANCE-COUNT   PIC S9(15) COMP-3 VALUE ZEROS.      01610000
           05  PV-RED-COUNT         PIC S9(15) COMP-3 VALUE ZEROS.      01620000
           05  PV-GROUP-PRICE-COUNT PIC S9(15) COMP-3 VALUE ZEROS.      01630000
           05  PV-RECORDS-ACCEPTED  PIC S9(15) COMP-3 VALUE ZEROS.      01640000
           05  PV-UNT-RTL-AMT-HOLD  PIC S9(15)V99 COMP-3 VALUE ZEROS.   01650000
           05  PV-UPC-STAT-CHG-DTE  PIC X(10)  VALUE SPACES.            01660000
           05  PV-UNT-RTL-CHG-DTE   PIC X(10)  VALUE SPACES.            01670000
           05  PV-UNT-QTY-COUNT     PIC S9(15) COMP-3 VALUE ZEROS.      01680000
           05  PV-UNT-RTL-AMT-COUNT PIC S9(15)V99 COMP-3 VALUE ZEROS.   01690000
           05  PV-TFR-QTY-COUNT     PIC S9(15) COMP-3 VALUE ZEROS.      01700000
           05  PV-TFR-RTL-AMT-COUNT PIC S9(15)V99 COMP-3 VALUE ZEROS.   01710000
           05  PV-STR-QTY-COUNT     PIC S9(15) COMP-3 VALUE ZEROS.      01720000
           05  PV-STR-RTL-AMT-COUNT PIC S9(15)V99 COMP-3 VALUE ZEROS.   01730000
           05  PV-TOT-QTY-COUNT     PIC S9(15) COMP-3 VALUE ZEROS.      01740000
           05  PV-TOT-RTL-AMT-COUNT PIC S9(15)V99 COMP-3 VALUE ZEROS.   01750000
           05  PV-DISPLAY      PIC ZZZZZZZZZZZZZZZZZ9.99  VALUE ZEROS.  01760000
           05  PV-DISPLAY-2    PIC ZZZZZZZZZZZZZZ  VALUE ZEROS.         01770000
           05  PV-EDIT-DOC-NBR.                                         01780000
               10  PV-EDIT-DOC-FROM-LOC-NBR  PIC 9(05) VALUE ZEROS.     01790000
               10  PV-EDIT-DOC-SEQ-NBR       PIC 9(09) VALUE ZEROS.     01800000
               10  PV-EDIT-DOC-SEQ-NBR-RED REDEFINES                    01810000
                   PV-EDIT-DOC-SEQ-NBR.                                 01820000
                   15  PV-EDIT-DOC-1ST-3     PIC 9(03).                 01830000
                   15  PV-EDIT-DOC-LAST-6.                              01840000
                       20  PV-EDIT-DOC-PART1     PIC 9(01).             01850000
                       20  PV-EDIT-DOC-PART2     PIC 9(05).             01860000
           05  PV-PLND-INV-TMST            PIC  X(26) VALUE SPACES.     01870000
           05  PV-PLND-INV-TIMESTAMP.                                   01880000
               10  PV-PLND-INV-DTE         PIC  X(10)  VALUE SPACES.    01890000
               10  PV-DASH                 PIC  X(01)  VALUE '-'.       01900000
               10  PV-PLND-DTE-HOUR        PIC  X(02)  VALUE '23'.      01910000
               10  PV-SEPARATOR            PIC  X(01)  VALUE '.'.       01920000
               10  PV-PLND-DTE-MINUTE      PIC  X(02)  VALUE '59'.      01930000
               10  PV-SEPARATOR            PIC  X(01)  VALUE '.'.       01940000
               10  PV-PLND-DTE-SECOND      PIC  X(02)  VALUE '59'.      01950000
               10  PV-SEPARATOR            PIC  X(01)  VALUE '.'.       01960000
               10  PV-PLND-DTE-MSEC        PIC  X(06)  VALUE '999999'.  01970000
004819     05  PV-LOC-TYP-CDE              PIC  X(02)  VALUE SPACES.    01980004
W33304     05  PV-TEMP-LOC-NBR             PIC S9(04) COMP VALUE ZEROS.         
                                                                        01990000
       01  PS-SWITCHES-AREA.                                            02000000
           05  PS-END-OF-TRANSFER-DATA     PIC X           VALUE 'N'.   02010000
               88  END-OF-TRANSFER-DATA                    VALUE 'Y'.   02020000
           05  PS-PRICE-FOUND-STATUS       PIC X           VALUE 'N'.   02030000
               88  PS-PRICE-NOT-FOUND                      VALUE 'N'.   02040000
               88  PS-PRICE-FOUND                          VALUE 'Y'.   02050000
           05  PS-UPC-NBR-FOUND-STATUS     PIC X           VALUE 'N'.   02060000
               88  PS-UPC-NBR-NOT-FOUND                    VALUE 'N'.   02070000
               88  PS-UPC-NBR-FOUND                        VALUE 'Y'.   02080000
           05  PS-FIRST-COMMIT-SW          PIC X           VALUE 'N'.   02090000
               88  PS-FIRST-COMMIT                         VALUE 'Y'.   02100000
           05  PS-COMMIT-TAKEN-SW          PIC X           VALUE 'N'.   02110000
               88  PS-COMMIT-TAKEN                         VALUE 'Y'.   02120000
W33304     05  PS-VALID-STORE-SWITCH       PIC X           VALUE 'N'.           
W33304         88  PS-VALID-STORE-YES                      VALUE 'Y'.           
W33304         88  PS-VALID-STORE-NO                       VALUE 'N'.           
                                                                        02130000
       01  ABEND-CODE                      PIC S9(04)      VALUE ZEROES 02140000
                               COMP SYNC.                               02150000
           88  ABEND-4004                                  VALUE +4004. 02160000
           88  ABEND-4013                                  VALUE +4013. 02170000
                                                                        02180000
       01  HL1-HEADING-LINE-1.                                          02190000
           05  FILLER                  PIC X(44) VALUE SPACES.          02200000
           05  FILLER                  PIC X(45) VALUE                  02210000
               '    PHYSICAL INVENTORY FROM FAST TRANSFER    '.         02220000
                                                                        02230000
       01  HL2-HEADING-LINE-2.                                          02240000
           05  FILLER                  PIC X(02) VALUE SPACES.          02250000
           05  FILLER                  PIC X(07) VALUE 'STORE: '.       02260000
           05  HL2-LOC-NBR             PIC 99999.                       02270000
           05  FILLER                  PIC X(03) VALUE ' - '.           02280000
           05  HL2-LOC-DESCRIPTION     PIC X(30).                       02290000
                                                                        02300000
       01  HL3-HEADING-LINE-3.                                          02310000
           05  FILLER                  PIC X(02) VALUE SPACES.          02320000
           05  FILLER                  PIC X(25) VALUE                  02330000
               'PLANNED INVENTORY DATE: '.                              02340000
           05  HL3-PLND-INV-DTE        PIC X(10).                       02350000
                                                                        02360000
       01  HL4-HEADING-LINE-4.                                          02370000
           05  FILLER                  PIC X(02) VALUE SPACES.          02380000
           05  FILLER                  PIC X(09) VALUE 'TRANSFER/'.     02390000
           05  FILLER                  PIC X(08) VALUE SPACES.          02400000
           05  FILLER                  PIC X(04) VALUE 'SUB-'.          02410000
           05  FILLER                  PIC X(33) VALUE SPACES.          02420000
           05  FILLER                  PIC X(04) VALUE 'UNIT'.          02430000
           05  FILLER                  PIC X(11) VALUE SPACES.          02440000
           05  FILLER                  PIC X(08) VALUE 'EXTENDED'.      02450000
           05  FILLER                  PIC X(09) VALUE SPACES.          02460000
           05  FILLER                  PIC X(08) VALUE 'TRANSFER'.      02470000
           05  FILLER                  PIC X(05) VALUE SPACES.          02480000
           05  FILLER                  PIC X(08) VALUE 'EXTENDED'.      02490000
           05  FILLER                  PIC X(09) VALUE SPACES.          02500000
           05  FILLER                  PIC X(08) VALUE 'EXTENDED'.      02510000
                                                                        02520000
       01  HL5-HEADING-LINE-5.                                          02530000
           05  FILLER                  PIC X(02) VALUE SPACES.          02540000
           05  FILLER                  PIC X(09) VALUE 'SHEET NBR'.     02550000
           05  FILLER                  PIC X(02) VALUE SPACES.          02560000
           05  FILLER                  PIC X(04) VALUE 'DEPT'.          02570000
           05  FILLER                  PIC X(02) VALUE SPACES.          02580000
           05  FILLER                  PIC X(05) VALUE 'CLASS'.         02590000
           05  FILLER                  PIC X(02) VALUE SPACES.          02600000
           05  FILLER                  PIC X(08) VALUE 'SKU     '.      02610000
           05  FILLER                  PIC X(05) VALUE SPACES.          02620000
           05  FILLER                  PIC X(03) VALUE 'QTY'.           02630000
           05  FILLER                  PIC X(14) VALUE SPACES.          02640000
           05  FILLER                  PIC X(06) VALUE 'RETAIL'.        02650000
           05  FILLER                  PIC X(09) VALUE SPACES.          02660000
           05  FILLER                  PIC X(06) VALUE 'RETAIL'.        02670000
           05  FILLER                  PIC X(11) VALUE SPACES.          02680000
           05  FILLER                  PIC X(06) VALUE 'RETAIL'.        02690000
           05  FILLER                  PIC X(07) VALUE SPACES.          02700000
           05  FILLER                  PIC X(11) VALUE 'XFER RETAIL'.   02710000
           05  FILLER                  PIC X(06) VALUE SPACES.          02720000
           05  FILLER                  PIC X(11) VALUE 'RETAIL DIFF'.   02730000
                                                                        02740000
       01  DL-DETAIL-LINE.                                              02750000
           05  FILLER                  PIC X(02) VALUE SPACES.          02760000
           05  DL-SHEET-NBR            PIC ZZZ999999.                   02770000
           05  FILLER                  PIC X(02) VALUE SPACES.          02780000
           05  DL-DEPT-NBR             PIC 9(04).                       02790000
           05  FILLER                  PIC X(02) VALUE SPACES.          02800000
           05  DL-SUBCLASS-NBR         PIC 9(04).                       02810000
           05  FILLER                  PIC X(03) VALUE SPACES.          02820000
           05  DL-SKU-NBR              PIC 99999999.                    02830000
           05  FILLER                  PIC X(05) VALUE SPACES.          02840000
           05  DL-UNIT-QTY             PIC Z,ZZZ,ZZ9-.                  02850000
           05  FILLER                  PIC X(03) VALUE SPACES.          02860000
           05  DL-UNIT-RTL-AMT         PIC Z,ZZZ,ZZ9.99-.               02870000
           05  FILLER                  PIC X(02) VALUE SPACES.          02880000
           05  DL-EXTD-RTL-AMT         PIC ZZ,ZZZ,ZZ9.99-.              02890000
           05  FILLER                  PIC X(03) VALUE SPACES.          02900000
           05  DL-TFR-RTL-AMT          PIC Z,ZZZ,ZZ9.99-.               02910000
           05  FILLER                  PIC X(03) VALUE SPACES.          02920000
           05  DL-EXTD-TFR-RTL-AMT     PIC ZZ,ZZZ,ZZ9.99-.              02930000
           05  FILLER                  PIC X(03) VALUE SPACES.          02940000
           05  DL-DIFF-RTL-AMT         PIC ZZ,ZZZ,ZZ9.99-.              02950000
                                                                        02960000
       01  TL-TOTAL-LINE.                                               02970000
           05  FILLER                  PIC X(04) VALUE SPACES.          02980000
           05  TL-VERBIAGE             PIC X(22).                       02990000
           05  FILLER                  PIC X(12) VALUE SPACES.          03000000
           05  TL-UNIT-QTY             PIC ZZ,ZZZ,ZZ9-.                 03010000
           05  FILLER                  PIC X(17) VALUE SPACES.          03020000
           05  TL-EXTD-RTL-AMT         PIC ZZZ,ZZZ,ZZ9.99-.             03030000
           05  FILLER                  PIC X(18) VALUE SPACES.          03040000
           05  TL-EXTD-TFR-RTL-AMT     PIC ZZZ,ZZZ,ZZ9.99-.             03050000
           05  FILLER                  PIC X(02) VALUE SPACES.          03060000
           05  TL-DIFF-RTL-AMT         PIC ZZZ,ZZZ,ZZ9.99-.             03070000
                                                                        03080000
       01  NL-NO-REPORT-LINE.                                           03090000
           05  FILLER                  PIC X(02) VALUE SPACES.          03100000
           05  FILLER                  PIC X(26)                        03110000
               VALUE 'NOTHING TO REPORT'.                               03120000
                                                                        03130000
      ******************************************************************03140000
      * COPYBOOK - KOHLS STANDARD REPORT HEADINGS, DETAIL FOR 132 BYTES 03150000
      ******************************************************************03160000
           COPY DPWS132O.                                               03170000
                                                                        03180000
      ******************************************************************03190000
      * COPYBOOK - INVENTORY SNAPSHOT TO ML FILE FORMAT                 03200000
      ******************************************************************03210000
           COPY TFRD053.                                                03220000
                                                                        03230000
      ******************************************************************03240000
      * COPYBOOK -                                                      03250000
      *    DPWS004 CONTAINS THE FIELDS NECESSARY TO CALL THE SQLCA      03260000
      * MESSAGE MODULE 'DSNTIAR' AND DISPLAY THE FORMATTED RESULTS.     03270000
      ******************************************************************03280000
           COPY DPWS004.                                                03290000
                                                                        03300000
      ******************************************************************03310000
           EXEC SQL                                                     03320000
               INCLUDE SQLCA                                            03330000
           END-EXEC.                                                    03340000
                                                                        03350000
P28545******************************************************************03360000
P28545*    TUPC    - UPC FOUNDATION TABLE                               03370000
P28545******************************************************************03380000
P28545*    EXEC SQL                                                     03390000
P28545*        INCLUDE TUPC                                             03400000
P28545*    END-EXEC.                                                    03410000
P28545*                                                                 03420000
P28545******************************************************************03430000
P28545*    TUPCPLS - PRICE LISTING FOR STORE TABLE                      03440000
P28545******************************************************************03450000
P28545*    EXEC SQL                                                     03460000
P28545*        INCLUDE TUPCPLS                                          03470000
P28545*    END-EXEC.                                                    03480000
P28545*                                                                 03490000
P28545******************************************************************03500000
P28545*    TSKXREF - THE SKU CROSS REFERENCE TABLE                      03510000
P28545******************************************************************03520000
P28545*    EXEC SQL                                                     03530000
P28545*        INCLUDE TSKXREF                                          03540000
P28545*    END-EXEC.                                                    03550000
P28545*                                                                 03560000
      ******************************************************************03570000
      *    TINENTY - SHEET INVENTORY ENTRY TABLE.                       03580000
      ******************************************************************03590000
           EXEC SQL                                                     03600000
               INCLUDE TINENTY                                          03610000
           END-EXEC.                                                    03620000
                                                                        03630000
P28545******************************************************************03640000
P28545*    TMITGPL - GROUP PRICE LISTING TABLE                          03650000
P28545******************************************************************03660000
P28545*    EXEC SQL                                                     03670000
P28545*        INCLUDE TMITGPL                                          03680000
P28545*    END-EXEC.                                                    03690000
P28545*                                                                 03700000
      ******************************************************************03710000
      *    TINVPAR - INVENTORY PARAMATERS TABLE                         03720000
      ******************************************************************03730000
           EXEC SQL                                                     03740000
               INCLUDE TINVPAR                                          03750000
           END-EXEC.                                                    03760000
                                                                        03770000
P28545******************************************************************03780000
P28545*    TINCNTL - INVENTORY CONTROL MASTER TABLE                     03781000
P28545******************************************************************03782000
P28545     EXEC SQL                                                     03783000
P28545         INCLUDE TINCNTL                                          03784000
P28545     END-EXEC.                                                    03785000
P28545                                                                  03785100
P28545******************************************************************03785200
P28545*    TMDSEAR - DB2 MERCHANDISE AREA TABLE DCLGEN                  03785300
P28545******************************************************************03785400
P28545*    EXEC SQL                                                     03785500
P28545*        INCLUDE TMDSEAR                                          03785600
P28545*    END-EXEC.                                                    03785700
P28545*                                                                 03785800
D28545******************************************************************03785900
D28545*    TAPLAVL - DB2 APPLICATION AVAILABILITY TABLE DCLGEN          03786000
D28545******************************************************************03787000
D28545*    EXEC SQL                                                     03788000
D28545*        INCLUDE TAPLAVL                                          03789000
D28545*    END-EXEC.                                                    03790000
D28545*                                                                 03800000
      ******************************************************************03810000
      *    XMT_LOC - XM DOMAIN LOCATION TABLE                           03820000
      ******************************************************************03830000
           EXEC SQL                                                     03840000
               INCLUDE XMT00001                                         03850000
           END-EXEC.                                                    03860000
                                                                        03870000
      ******************************************************************03880000
      *CHECKPOINT RESTART CONTROL AND INFORMATION TABLES *              03890000
      ******************************************************************03900000
           EXEC SQL                                                     03910000
               INCLUDE TCKRSTCN                                         03920000
           END-EXEC.                                                    03930000
                                                                        03940000
           EXEC SQL                                                     03950000
               INCLUDE TCKRSTIN                                         03960000
           END-EXEC.                                                    03970000
                                                                        03980000
P28545******************************************************************03990000
P28545* COPYBOOK - PRICING MODULE                                       04000000
P28545******************************************************************04010000
P28545     COPY INWS400.                                                04020000
P28545                                                                  04030000
      ******************************************************************04040000
      * CHECKPOINT RESTART VARIABLES                                   *04050000
      ******************************************************************04060000
       01  CR-CHECKPOINT-RESTART-AREA.                                  04070000
           05  CR-AREA-LEN                 PIC S9(04) VALUE +87 COMP.   04080000
           05  CR-CHECKPOINT-RESTART-VAR.                               04090000
               10  CR-PREV-DTL-KEY         PIC X(26)      VALUE SPACES. 04100000
               10  FILLER REDEFINES CR-PREV-DTL-KEY.                    04110000
                   15  CR-KEY.                                          04120000
                       20  CR-BATCH-NBR                PIC S9(04) COMP. 04130000
                       20  CR-TRANSFER-DOC-INFO.                        04140000
                           25  CR-TO-LOC-NBR           PIC S9(04) COMP. 04150000
                           25  CR-DOC-NBR.                              04160000
                               30  CR-DOC-FROM-LOC-NBR PIC S9(04) COMP. 04170000
                               30  CR-DOC-SEQ-NBR      PIC S9(09) COMP. 04180000
                           25  CR-CREATE-DATE.                          04190000
                               30  CR-CREATE-DATE-YY   PIC 9(04).       04200000
                               30  CR-FILLER1          PIC X(01).       04210000
                               30  CR-CREATE-DATE-MM   PIC 9(02).       04220000
                               30  CR-FILLER2          PIC X(01).       04230000
                               30  CR-CREATE-DATE-DD   PIC 9(02).       04240000
                       20  CR-TRANSFER-ITEM-INFO.                       04250000
                           25  CR-LNE-NBR          PIC S9(04) COMP-4.   04260000
                           25  CR-SKU-NBR          PIC S9(09) COMP.     04270000
               10  FILLER                   PIC  X(01) VALUE SPACES.    04280000
               10  CR-UPDATE-COUNT          PIC  9(09) VALUE ZEROES.    04290000
               10  FILLER                   PIC  X(01) VALUE SPACES.    04300000
               10  CR-INSERT-COUNT          PIC  9(09) VALUE ZEROES.    04310000
               10  FILLER                   PIC  X(01) VALUE SPACES.    04320000
               10  CR-COMMIT-COUNT          PIC  9(09) VALUE ZEROES.    04330000
               10  FILLER                   PIC  X(01) VALUE SPACES.    04340000
               10  CR-INPUT-COUNT           PIC  9(09) VALUE ZEROES.    04350000
               10  FILLER                   PIC  X(01) VALUE SPACES.    04360000
               10  CR-ZERO-REC-DROPPED      PIC  9(09) VALUE ZEROES.    04370000
               10  FILLER                   PIC  X(01) VALUE SPACES.    04380000
               10  CR-DUPLICATE-REC         PIC  9(09) VALUE ZEROES.    04390000
               10  FILLER                   PIC  X(01) VALUE SPACES.    04400000
                                                                        04410000
      ******************************************************************04420000
      *FLOW:    THE MODULE SEQUENTIALLY READS THE FAST TRANSFER         04430000
      *      INVENTORY SNAPHOT FILE(S) FOR ASSUMPTIVE RECEIVE TRANSFERS.04440000
      *      THE FILE CONTAINS DATA BASED ON THE DAY'S INVENTORYING     04450000
      *      STORES (PLANNED INVENTORY DATE IS USED)                    04460000
      *                                                                 04470000
      *      CHECKPOINT RESTART LOGIC IS PRESENT.                       04480000
      *                                                                 04490000
      *         BREAKS OCCUR AT THE LOCATION, DOCUMENT, AND SKU LEVELS. 04500000
      *      ACCUMULATE TOTALS AND INTERNAL CONTROLS AT THESE LEVELS.   04510000
      *      WRITE REPORT DETAIL, SUBTOTALS, AND TOTALS ACCORDINGLY.    04520000
      *                                                                 04530000
      *         DEVELOP PRICE BASED ON THE SKU USING TUPC AND TUPCPLS   04540000
      *      FIRST AT THE CORPROATE LEVEL, THEN AT STORE LEVEL BASED ON 04550000
      *      THE SKU STATUS. SPECIAL CONSIDERATIONS FOR ITEMS IN A RED  04560000
      *      STATUS HAVE BEEN MADE TO USE THE LAST YELLOW PRICE.        04570000
      *                                                                 04580000
      *         FORMAT A SHEET INVENTORY TABLE RECORD AND INSERT INTO   04590000
      *      THE TABLE TINENTY. UPDATE TINVPAR SHEETS REQUIRED IND TO   04600000
      *      'Y' TO FORCE UNIT BOOKING TO NOT PROCESS UNTIL THE STORE   04610000
      *      SHEETS HAVE BEEN RESOLVED.                                 04620000
      *                                                                 04630000
      *      OUTPUT:                                                    04640000
      *         TINVPAR - UPDATE THE SHEETS REQUIRED INDICATOR ON THE   04650000
      *                   INVENTORY PARMS TABLE.                        04660000
      *         TINENTY - INSERT TRANSFER SHEETS                        04670000
      *         OUT01 - FAST TRANSFER TRANSACTION(S) ERRORED            04680000
      *                 1.  NO UNIT COUNTS                              04690000
      *                 2.  PRICE CANNOT BE DETERMINED.                 04700000
      *                 3.  THE ITEM IS NOT FOUND IN VSM                04710000
      *         RPT01 - PHYSICAL INVENTPRY FROM FAST TRANSFER DETAIL RPT04720000
      *                                                                 04730000
      *      TABLES USED:                                               04740000
      *         TINENTY    - INVENTORY SHEET ENTRY                      04750000
      *         TUPC       - VSM UPC TABLE (PRICING)                    04760000
      *         TUPCPLS    - VSM UPCPLS TABLE (PRICING)                 04770000
      *         TMITGPL    - GROUP PRICING TABLE                        04780000
      *         TSKXREF    - CROSS REFERENCE TABLE.                     04790000
      *         TINVPAR    - INVENTORY PARM TABLE.                      04800000
P28545*         TINCNTL    - INVENTORY CONTROL TABLE.                   04810000
      *         XMT_LOC    - XM DOMAIN LOCATION TABLE.                  04820000
      *         TMDSEAR    - MERCHANDISE AREA TABLE DCLGEN              04830000
      *         TAPLAVL    - APPLICATION AVAILABILITY TABLE DCLGEN      04840000
      *         TCKRSTINF  - CHECKPOINT/RESTART INFORMATION TABLE       04850000
      *         TCKRSTCNTL - CHECKPOINT/RESTART CONTROL TABLE           04860000
      *                                                                 04870000
      ******************************************************************04880000
       PROCEDURE DIVISION.                                              04890000
      ******************************************************************04900000
       0000-MAINLINE-DRIVER-SECTION.                                    04910000
                                                                        04920000
           PERFORM 1000-INITIALIZATION.                                 04930000
                                                                        04940000
           PERFORM 2000-PROCESS-TRANSFER-STORE                          04950000
               UNTIL END-OF-TRANSFER-DATA.                              04960000
                                                                        04970000
           PERFORM 9000-END-OF-JOB-TASKS.                               04980000
                                                                        04990000
       9999-EXIT-PROGRAM.                                               05000000
           STOP RUN.                                                    05010000
                                                                        05020000
      /*****************************************************************05030000
      * 1000-INITIALIZATION.                                            05040000
      ******************************************************************05050000
       1000-INITIALIZATION.                                             05060000
                                                                        05070000
           OPEN  INPUT TRANSFER-DATA-FILE                               05080000
                OUTPUT TRANSFER-DATA-ERROR-FILE                         05090000
W33304          OUTPUT TRANSFER-INPUT-ERROR-FILE                                
                OUTPUT TRANSFER-REPORT.                                 05100000
                                                                        05110000
           ACCEPT PV-CURRENT-DATE   FROM DATE.                          05120000
           ACCEPT PV-CURRENT-TIME   FROM TIME.                          05130000
                                                                        05140000
           MOVE PV-CD-MM            TO DP132O-RUN-MONTH.                05150000
           MOVE PV-CD-DD            TO DP132O-RUN-DAY.                  05160000
           MOVE PV-CD-YY            TO DP132O-RUN-YEAR.                 05170000
           MOVE PV-CT-HH            TO DP132O-RUN-HOUR.                 05180000
           MOVE PV-CT-MM            TO DP132O-RUN-MINUTE.               05190000
           MOVE PC-PROGRAM-NAME     TO DP132O-PROGRAM-NAME.             05200000
           MOVE 1                   TO DP132O-REPORT-NUMBER.            05210000
           MOVE ZEROS               TO PV-PAGE-COUNT.                   05220000
                                                                        05230000
           MOVE ZEROS          TO PV-RECORDS-READ                       05240000
                                  PV-STR-NBR-SAVE                       05250000
P28545                            PV-INV-ID-SAVE                        05260000
                                  PV-STORE-ISSUE-COUNT                  05270000
                                  PV-NO-UNIT-COUNT                      05280000
                                  PV-NO-PRICE-COUNT                     05290000
                                  PV-NO-UPC-NBR-COUNT                   05300000
                                  PV-CLEARANCE-COUNT                    05310000
                                  PV-GROUP-PRICE-COUNT                  05320000
                                  PV-RECORDS-ACCEPTED.                  05330000
                                                                        05340000
      *** TEST FOR A RESTART OF THIS PROGRAM....                        05350000
           PERFORM 7650-INIT-CHECKPOINT-SELECT.                         05360000
           IF TCKRSTCNTL-CKPT-STAT-CODE = '9'                           05370000
                PERFORM 7700-SELECT-RESTART-INFO                        05380000
                MOVE TCKRSTINF-WORK-STRG-DESC-TEXT                      05390000
                                    TO CR-CHECKPOINT-RESTART-VAR        05400000
                DISPLAY ' '                                             05410000
                DISPLAY '--------------------------------------------'  05420000
                DISPLAY 'RESTART-LAST INKUP304 FILE COMMIT: ',          05430000
                         'CR-BATCH-NBR       : ' CR-BATCH-NBR           05440000
                         ' CR-TO-LOC-NBR      : ' CR-TO-LOC-NBR         05450000
                         ' CR-DOC-FROM-LOC-NBR: ' CR-DOC-FROM-LOC-NBR   05460000
                         ' CR-DOC-SEQ-NBR     : ' CR-DOC-SEQ-NBR        05470000
                         ' CR-CREATE-DATE     : ' CR-CREATE-DATE        05480000
                         ' CR-LNE-NBR         : ' CR-LNE-NBR            05490000
                         ' CR-SKU-NBR         : ' CR-SKU-NBR            05500000
                DISPLAY '--------------------------------------------'  05510000
                DISPLAY ' '                                             05520000
                MOVE CR-INPUT-COUNT            TO PA-EXTRACT-RECS-READ  05530000
                MOVE CR-UPDATE-COUNT           TO PA-UPDATE-COUNT       05540000
                MOVE CR-INSERT-COUNT           TO PA-INSERT-COUNT       05550000
                MOVE CR-COMMIT-COUNT           TO PA-COMMIT-COUNT       05560000
                MOVE CR-ZERO-REC-DROPPED       TO PA-ZERO-REC-DROPPED   05570000
                MOVE CR-DUPLICATE-REC          TO PA-DUPLICATE-REC      05580000
           ELSE                                                         05590000
               SET PS-FIRST-COMMIT TO TRUE                              05600000
               INITIALIZE CR-CHECKPOINT-RESTART-VAR                     05610000
               DISPLAY 'COMMITS WILL BE TAKEN EVERY ',                  05620000
                                 TCKRSTCNTL-CKPT-FRQNCY-QTY, ' SECONDS.'05630000
               PERFORM 7600-GET-COMMIT-TIMESTAMP                        05640000
           END-IF.                                                      05650000
                                                                        05660000
      *** READ THE RECALC EXTRACT FILE...                               05670000
           INITIALIZE PA-PROGRAM-ACCUMULATORS.                          05680000
                                                                        05690000
           IF TCKRSTCNTL-CKPT-STAT-CODE = '9'                           05700000
             PERFORM 8100-READ-TRANSFER-DATA                            05710000
               UNTIL (TFRD053-BATCH-NBR        = CR-BATCH-NBR           05720000
                 AND  TFRD053-TO-LOC-NBR       = CR-TO-LOC-NBR          05730000
                 AND  TFRD053-DOC-FROM-LOC-NBR = CR-DOC-FROM-LOC-NBR    05740000
                 AND  TFRD053-DOC-SEQ-NBR      = CR-DOC-SEQ-NBR         05750000
                 AND  TFRD053-CREATE-DATE      = CR-CREATE-DATE         05760000
                 AND  TFRD053-LNE-NBR          = CR-LNE-NBR             05770000
                 AND  TFRD053-SKU-NBR          = CR-SKU-NBR)            05780000
                  OR (END-OF-TRANSFER-DATA)                             05790000
           END-IF.                                                      05800000
                                                                        05810000
      *** END OF FILE PROCESSING...                                     05820000
           IF END-OF-TRANSFER-DATA                                      05830000
             IF TCKRSTCNTL-CKPT-STAT-CODE = '9'                         05840000
               DISPLAY 'NO RECORDS TO PROCESS AFTER RESTART'            05850000
             ELSE                                                       05860000
               IF TCKRSTCNTL-CKPT-STAT-CODE = '0'                       05870000
                 DISPLAY 'NO RECORDS TO PROCESS,            '           05880000
                 DISPLAY 'CHECK IF INPUT FILE IS EMPTY      '           05890000
               END-IF                                                   05900000
             END-IF                                                     05910000
           ELSE                                                         05920000
      *** GET THE NEXT RECORD...                                        05930000
      * FOR RESTARTING, THIS WILL CONTINUE AFTER THE LAST COMMITED REC  05940000
      * THIS IS IMPORTANT WHEN RUNNING UNDER ADJUSTMENT MODE, SEE CNTL  05950000
             PERFORM 8100-READ-TRANSFER-DATA                            05960000
             IF (NOT END-OF-TRANSFER-DATA)                              05970000
               PERFORM 8300-READ-TINVPAR                                05980000
W33304         IF  PS-VALID-STORE-YES                                           
W33304             MOVE TFRD053-TO-LOC-NBR TO PV-STR-NBR-SAVE           05990000
W33304             MOVE INVPAR-INV-ID      TO PV-INV-ID-SAVE            06000000
W33304             MOVE TFRD053-DOC-NBR    TO PV-DOC-NBR-SAVE           06010000
W33304             MOVE TFRD053-SKU-NBR    TO PV-SKU-NBR-SAVE           06020000
W33304         END-IF                                                           
             END-IF                                                     06030000
           END-IF.                                                      06040000
                                                                        06050000
W33304     IF  PS-VALID-STORE-YES                                               
W33304         PERFORM 7000-PRINT-HEADINGS                                      
W33304     END-IF.                                                              
                                                                        06070000
      /*****************************************************************06080000
      * 2000-PROCESS-TRANSFER-STORE.                                    06090000
      ******************************************************************06100000
       2000-PROCESS-TRANSFER-STORE.                                     06110000
                                                                        06120000
           ADD 1               TO PV-RECORDS-READ.                      06130000
           ADD 1               TO PA-EXTRACT-RECS-READ.                 06140000
                                                                        06150000
W33304     IF  PS-VALID-STORE-YES                                               
W33304         PERFORM 2100-PROCESS-VALID-STORES                                
W33304     END-IF.                                                              
W33304                                                                          
W33304     MOVE TFRD053-TO-LOC-NBR          TO PV-TEMP-LOC-NBR.                 
W33304     PERFORM 8100-READ-TRANSFER-DATA.                                     
W33304                                                                          
W33304     IF  TFRD053-TO-LOC-NBR NOT = PV-TEMP-LOC-NBR                         
W33304         PERFORM 8300-READ-TINVPAR                                        
W33304     END-IF.                                                              
W33304                                                                          
W33304/*****************************************************************        
W33304* 2100-PROCESS-VALID-STORES.                                              
W33304******************************************************************        
W33304 2100-PROCESS-VALID-STORES.                                               
W33304                                                                          
      *** BREAK LOGIC PERFORMED AT LOCATION, DOCUMENT, AND SKU LEVEL....06160000
           IF TFRD053-TO-LOC-NBR EQUAL PV-STR-NBR-SAVE                  06170000
             IF TFRD053-DOC-NBR EQUAL PV-DOC-NBR-SAVE                   06180000
               IF TFRD053-SKU-NBR EQUAL PV-SKU-NBR-SAVE                 06190000
                 NEXT SENTENCE                                          06200000
               ELSE                                                     06210000
      *** SKU BREAK....                                                 06220000
                 MOVE TFRD053-SKU-NBR   TO PV-SKU-NBR-SAVE              06230000
                 MOVE ZEROS             TO PV-UNT-QTY-COUNT             06240000
                 MOVE ZEROS             TO PV-UNT-RTL-AMT-COUNT         06250000
             ELSE                                                       06260000
      *** TRANSFER DOCUMENT BREAK.....                                  06270000
               PERFORM 5100-FORMAT-TRANSFER-TOTALS                      06280000
               MOVE ZEROS               TO PV-SHEET-LINE-NBR            06290000
               MOVE TFRD053-DOC-NBR     TO PV-DOC-NBR-SAVE              06300000
               MOVE TFRD053-SKU-NBR     TO PV-SKU-NBR-SAVE              06310000
               MOVE ZEROS               TO PV-UNT-QTY-COUNT             06320000
               MOVE ZEROS               TO PV-UNT-RTL-AMT-COUNT         06330000
               MOVE ZEROS               TO PV-TFR-QTY-COUNT             06340000
               MOVE ZEROS               TO PV-TFR-RTL-AMT-COUNT         06350000
           ELSE                                                         06360000
      *** LOCATION BREAK....                                            06370000
             PERFORM 5100-FORMAT-TRANSFER-TOTALS                        06380000
             PERFORM 5200-FORMAT-STORE-TOTALS                           06390000
             PERFORM 8700-UPDATE-TINVPAR                                06400000
             MOVE TFRD053-TO-LOC-NBR  TO PV-STR-NBR-SAVE                06420000
P28545       MOVE INVPAR-INV-ID       TO PV-INV-ID-SAVE                 06430000
             MOVE TFRD053-DOC-NBR     TO PV-DOC-NBR-SAVE                06440000
             MOVE TFRD053-SKU-NBR     TO PV-SKU-NBR-SAVE                06450000
             PERFORM 7000-PRINT-HEADINGS                                06460000
             MOVE ZEROS               TO PV-SHEET-LINE-NBR              06470000
             MOVE ZEROS               TO PV-UNT-QTY-COUNT               06480000
             MOVE ZEROS               TO PV-UNT-RTL-AMT-COUNT           06490000
             MOVE ZEROS               TO PV-TFR-QTY-COUNT               06500000
             MOVE ZEROS               TO PV-TFR-RTL-AMT-COUNT           06510000
             MOVE ZEROS               TO PV-STR-QTY-COUNT               06520000
             MOVE ZEROS               TO PV-STR-RTL-AMT-COUNT           06530000
           END-IF.                                                      06540000
                                                                        06550000
           PERFORM 3000-GATHER-VSM-INFORMATION.                         06560000
                                                                        06570000
           PERFORM 7800-COMMIT-PROCESSING.                              06580000
                                                                        06590000
                                                                                
      /*****************************************************************06620000
      * 3000-GATHER-VSM-INFORMATION.                                    06630000
      *     EDIT AND GATHER UPC INFORMATION FOR PRICING & UPDATES TO    06640000
      * TINENTY (BASED ON THE TRANSFER SKU NBR)                         06650000
      ******************************************************************06660000
       3000-GATHER-VSM-INFORMATION.                                     06670000
D28545                                                                  06680000
D28545     INITIALIZE IN400-PV-INPUT-AREA.                              06690000
D28545                                                                  06700000
D28545     SET IN400-PV-SKU-LOOKUP  TO TRUE.                            06710000
D28545                                                                  06711000
D28545     MOVE TFRD053-TO-LOC-NBR  TO IN400-CONVERT-LOC.               06712000
D28545     MOVE IN400-CONVERT-LOC   TO IN400-PV-LOC-IN.                 06713000
D28545                                                                  06714000
D28545     MOVE PV-PLND-INV-DTE     TO IN400-PV-EFF-DTE-IN.             06715000
D28545                                                                  06716000
D28545     MOVE TFRD053-SKU-NBR     TO PV-EDIT-SKU-NBR.                 06717000
D28545     MOVE PV-EDIT-SKU-NBR     TO IN400-PV-SKU-IN.                 06718000
D28545                                                                  06719000
D28545     PERFORM IN400-LOOKUP-RETAIL.                                 06719100
D28545                                                                  06719200
D28545*** A.  INVALID KEY CONDITION..                                   06719300
D28545     IF IN400-PV-INVALID-KEY-INPUT                                06719400
D28545         DISPLAY 'INVALID - ', PV-EDIT-SKU-NBR,                   06719500
D28545                 ' PRC RTN - ', IN400-PV-RETURN-CDE,              06719600
D28545                 ' ATT RTN - ', IN400-PV-ATT-RTNCDE,              06719700
D28545                 ' PRC SQL - ', IN400-PV-PRC-SQLCDE,              06719800
D28545                 ' ATT SQL - ', IN400-PV-ATT-SQLCDE,              06719900
D28545                 '  ', IN400-PV-RETURN-RSN                        06720000
D28545         DISPLAY IN400-PV-PARAGRAPH                               06720100
D28545         PERFORM 4100-BUILD-ERROR-TRANSFER                        06720200
D28545         ADD 1                TO PV-NO-UNIT-COUNT                 06720300
D28545*** B.  ZERO SEQUENCE SKU EDITS.                                  06720400
D28545     ELSE                                                         06720500
D28545     IF IN400-PS-DUMMY-SKU                                        06720600
D28545         IF TFRD053-ITEM-QTY GREATER ZERO                         06720700
D28545             MOVE ZEROS               TO IN400-PRC-UPC-OUT        06720800
D28545             MOVE TFRD053-ITEM-PRICE  TO PV-UNT-RTL-AMT-HOLD      06720900
D28545*            MOVE PV-EDIT-SKU-NBR-DPT TO SKXREF-DEPT              06721000
D28545*            MOVE PV-EDIT-SKU-NBR-CLS TO SKXREF-SUBCLASS          06722000
D28545             PERFORM 4000-BUILD-SHEET-TINENTY                     06723000
D28545         ELSE                                                     06724000
D28545             PERFORM 4100-BUILD-ERROR-TRANSFER                    06725000
D28545             ADD 1        TO PV-NO-UNIT-COUNT                     06726000
D28545         END-IF                                                   06727000
D28545*** C.  REGULAR SKU EDITS.                                        06728000
D28545     ELSE                                                         06729000
D28545     IF IN400-PS-RTL-FOUND                                        06730000
D28545         MOVE IN400-PRC-UNIT-RTL-OUT     TO PV-UNT-RTL-AMT-HOLD   06740000
D28545         MOVE IN400-PRC-UPC-CHG-DTE-OUT  TO PV-UNT-RTL-CHG-DTE    06760000
D28545         MOVE IN400-PRC-STAT-CHG-DTE-OUT TO PV-UPC-STAT-CHG-DTE   06770000
D28545         SET PS-PRICE-FOUND              TO TRUE                  06780000
P28545                                                                  06790000
P28545***      CLEARANCE...                                             06800000
P28545         IF IN400-PRC-STATUS-OUT = '25' OR                        06810000
P28545            IN400-PRC-STATUS-OUT = '30'                           06820000
P28545             ADD 1                       TO PV-CLEARANCE-COUNT    06830000
P28545         END-IF                                                   06840000
P28545                                                                  06850000
P28545***      RED TICKET CLEARANCE (RTL DTE GREATER CHG DTE)           06860000
P28545***        USE THE TRANSFER ITEM PRICE                            06870000
P28545         IF IN400-PRC-STATUS-OUT = '30'                           06880000
P28545           IF PV-UNT-RTL-CHG-DTE GREATER PV-UPC-STAT-CHG-DTE      06890000
P28545             ADD 1                   TO PV-RED-COUNT              06900000
P28545             MOVE TFRD053-ITEM-PRICE TO PV-UNT-RTL-AMT-HOLD       06910000
P28545           END-IF                                                 06911100
P28545         END-IF                                                   06911200
P28545                                                                  06911300
004819***      RTV TRANSFER (LOC_TYP_CDE = 'RV')                        06911404
004819         IF PV-LOC-TYP-CDE = 'RV'                                 06911604
004819             MOVE TFRD053-ITEM-PRICE TO PV-UNT-RTL-AMT-HOLD       06911704
004819         END-IF                                                   06911904
D28545         IF TFRD053-ITEM-QTY GREATER ZERO                         06912000
D28545             PERFORM 4000-BUILD-SHEET-TINENTY                     06912100
D28545         ELSE                                                     06912200
D28545             PERFORM 4100-BUILD-ERROR-TRANSFER                    06912300
D28545             ADD 1        TO PV-NO-UNIT-COUNT                     06912400
D28545         END-IF                                                   06912500
D28545     ELSE                                                         06912600
D28545         PERFORM 4100-BUILD-ERROR-TRANSFER                        06912700
D28545         ADD 1            TO PV-NO-UNIT-COUNT                     06912800
D28545     END-IF.                                                      06912900
D28545                                                                  06913000
P28545*** A.  ZERO SEQUENCE SKU EDITS.                                  06913100
P28545*    MOVE TFRD053-SKU-NBR     TO PV-EDIT-SKU-NBR.                 06914000
P28545*                                                                 06915000
P28545*    IF PV-ZERO-SEQUENCE-SKU                                      06916000
P28545*      PERFORM 8900-GET-MBS-STRUCTURE                             06917000
P28545*                                                                 06918000
P28545*      IF PS-PRICE-FOUND                                          06919000
P28545*          IF TFRD053-ITEM-QTY GREATER ZERO                       06920000
P28545*            MOVE ZEROS               TO UPC-UPC-NBR              06930000
P28545*            MOVE TFRD053-ITEM-PRICE  TO PV-UNT-RTL-AMT-HOLD      06940000
P28545*            MOVE PV-EDIT-SKU-NBR-DPT TO SKXREF-DEPT              06950000
P28545*            MOVE PV-EDIT-SKU-NBR-CLS TO SKXREF-SUBCLASS          06960000
P28545*            PERFORM 4000-BUILD-SHEET-TINENTY                     06970000
P28545*          ELSE                                                   06980000
P28545*            PERFORM 4100-BUILD-ERROR-TRANSFER                    06990000
P28545*            ADD 1        TO PV-NO-UNIT-COUNT                     07000000
P28545*          END-IF                                                 07010000
P28545*      ELSE                                                       07020000
P28545*        PERFORM 4100-BUILD-ERROR-TRANSFER                        07030000
P28545*        ADD 1            TO PV-NO-PRICE-COUNT                    07040000
P28545*      END-IF                                                     07050000
P28545*                                                                 07060000
P28545*    ELSE                                                         07070000
P28545*** B.  REGULAR SKU EDITS.                                        07080000
P28545***     GET THE CORPORATE PRICE AND STATUS....                    07090000
P28545*      PERFORM 8000-GET-INTR-UPC-ID                               07100000
P28545*                                                                 07110000
P28545*      PERFORM 8400-GET-UPC-NBR                                   07120000
P28545*      IF PS-UPC-NBR-FOUND                                        07130000
P28545*          MOVE ZEROES                 TO UPCPLS-STR-NBR          07140000
P28545*          PERFORM 8500-GET-PRICE                                 07150000
P28545***      CLEARANCE...                                             07160000
P28545*          IF UPCPLS-UPC-STAT-CDE = '25' OR                       07170000
P28545*             UPCPLS-UPC-STAT-CDE = '30'                          07180000
P28545*              ADD 1                   TO PV-CLEARANCE-COUNT      07190000
P28545*              MOVE TFRD053-TO-LOC-NBR TO UPCPLS-STR-NBR          07200000
P28545*              PERFORM 8500-GET-PRICE                             07210000
P28545*              IF PS-PRICE-NOT-FOUND                              07220000
P28545*                  SET PS-PRICE-FOUND  TO TRUE                    07230000
P28545*              END-IF                                             07240000
P28545*          END-IF                                                 07250000
P28545*                                                                 07260000
P28545***      RED TICKET CLEARANCE (RTL DTE GREATER CHG DTE)           07270000
P28545***        USE THE TRANSFER ITEM PRICE                            07280000
P28545*          IF UPCPLS-UPC-STAT-CDE = '30'                          07290000
P28545*            IF PV-UNT-RTL-CHG-DTE GREATER PV-UPC-STAT-CHG-DTE    07300000
P28545*              ADD 1                   TO PV-RED-COUNT            07310000
P28545*              MOVE TFRD053-ITEM-PRICE TO PV-UNT-RTL-AMT-HOLD     07320000
P28545*              IF PS-PRICE-NOT-FOUND                              07330000
P28545*                  SET PS-PRICE-FOUND  TO TRUE                    07340000
P28545*              END-IF                                             07350000
P28545*            END-IF                                               07360000
P28545*          END-IF                                                 07370000
P28545*                                                                 07380000
P28545***      BUILD THE SHEET TABLE ENTRY.....                         07390000
P28545*          IF PS-PRICE-FOUND                                      07391000
P28545*              IF TFRD053-ITEM-QTY GREATER ZERO                   07392000
P28545*                  PERFORM 4000-BUILD-SHEET-TINENTY               07393000
P28545*              ELSE                                               07394000
P28545*                  PERFORM 4100-BUILD-ERROR-TRANSFER              07394100
P28545*                  ADD 1        TO PV-NO-UNIT-COUNT               07394200
P28545*              END-IF                                             07394300
P28545*          ELSE                                                   07394400
P28545*              PERFORM 4100-BUILD-ERROR-TRANSFER                  07394500
P28545*              ADD 1            TO PV-NO-PRICE-COUNT              07394600
P28545*          END-IF                                                 07394700
P28545*      ELSE                                                       07394800
P28545*          PERFORM 4100-BUILD-ERROR-TRANSFER                      07394900
P28545*          ADD 1                TO PV-NO-UPC-NBR-COUNT            07395000
P28545*      END-IF                                                     07395100
P28545*    END-IF.                                                      07395200
P28545*                                                                 07395300
      /*****************************************************************07395400
      * 4000-BUILD-SHEET-TINENTY.                                       07395500
      ******************************************************************07395600
       4000-BUILD-SHEET-TINENTY.                                        07395700
                                                                        07395800
      *** FORMAT THE TRANSFER FOR ENTRY INTO THE SHEET TABLE...         07395900
           MOVE TFRD053-TO-LOC-NBR  TO INENTY-STR-NBR.                  07396000
                                                                        07397000
           MOVE TFRD053-DOC-FROM-LOC-NBR  TO PV-EDIT-DOC-FROM-LOC-NBR.  07398000
           MOVE TFRD053-DOC-SEQ-NBR TO PV-EDIT-DOC-SEQ-NBR.             07399000
           MOVE 7                   TO PV-EDIT-DOC-PART1.               07400000
           MOVE PV-EDIT-DOC-LAST-6  TO PV-SHEET-NBR.                    07410000
                                                                        07420000
           ADD 1                    TO PV-SHEET-LINE-NBR.               07430000
W30692*    IF PV-SHEET-LINE-NBR IS GREATER THAN 25                      07440000
W30692*        MOVE 1               TO PV-SHEET-LINE-NBR                07450000
W30692*        ADD 900000           TO PV-SHEET-NBR                     07460000
W30692*        IF PV-SHEET-NBR IS LESS THAN 100000                      07470000
W30692*            ADD 100000       TO PV-SHEET-NBR                     07480000
W30692*        END-IF                                                   07490000
W30692*    END-IF.                                                      07500000
W30692*                                                                 07510000
           MOVE PV-SHEET-NBR        TO INENTY-SHEET-NBR.                07520000
           MOVE PV-SHEET-LINE-NBR   TO INENTY-LNE-NBR.                  07530000
                                                                        07540000
P28545     IF IN400-PS-RENUMBER-SKU                                     07550000
P28545         MOVE IN400-PRC-SKU-OUT   TO INENTY-SKU-NBR               07560000
P28545         MOVE IN400-PRC-UPC-OUT   TO INENTY-UPC-NBR               07570000
P28545     ELSE                                                         07580000
               MOVE TFRD053-SKU-NBR     TO INENTY-SKU-NBR               07590000
P28545         MOVE IN400-PRC-UPC-OUT   TO INENTY-UPC-NBR               07600000
P28545     END-IF.                                                      07610000
P28545                                                                  07620000
           MOVE TFRD053-ITEM-QTY    TO INENTY-INV-QTY.                  07630000
           MOVE PV-UNT-RTL-AMT-HOLD TO INENTY-UNT-RTL-AMT.              07640000
                                                                        07650000
           COMPUTE PV-EXTD-AMOUNT   = INENTY-UNT-RTL-AMT                07660000
                                    * INENTY-INV-QTY.                   07670000
           MOVE PV-EXTD-AMOUNT      TO INENTY-EXTD-RTL-AMT.             07680000
                                                                        07690000
           MOVE PC-PROGRAM-NAME     TO INENTY-LAST-UPD-BY-USR-ID.       07700000
                                                                        07710000
      *** ADD TRANSFER UNITS TO THE SHEET TABLE...                      07720000
           PERFORM 8200-INSERT-INTO-TINENTY.                            07730000
           IF SQLCODE IS EQUAL TO -803                                  07740000
             PERFORM                                                    07750000
               UNTIL SQLCODE = 0                                        07760000
                  OR SQLCODE = +100                                     07770000
                                                                        07780000
                 MOVE ZEROS              TO SQLCODE                     07790000
                                                                        07800000
                 ADD 1                   TO PV-SHEET-LINE-NBR           07810000
W30692*          IF PV-SHEET-LINE-NBR IS GREATER THAN 25                07820000
W30692*            MOVE 1                TO PV-SHEET-LINE-NBR           07830000
W30692*            ADD 900000            TO PV-SHEET-NBR                07840000
W30692*            IF PV-SHEET-NBR IS LESS THAN 100000                  07850000
W30692*                ADD 100000        TO PV-SHEET-NBR                07860000
W30692*            END-IF                                               07870000
W30692*          END-IF                                                 07880000
                                                                        07890000
                 MOVE PV-SHEET-NBR       TO INENTY-SHEET-NBR            07900000
                 MOVE PV-SHEET-LINE-NBR  TO INENTY-LNE-NBR              07910000
                                                                        07920000
                 PERFORM 8200-INSERT-INTO-TINENTY                       07930000
                                                                        07940000
             END-PERFORM                                                07950000
           END-IF.                                                      07960000
                                                                        07970000
      *** WRITE DETAIL REPORT INFORMATION....                           07980000
           PERFORM 5000-FORMAT-DETAIL-LINE.                             07990000
                                                                        08000000
           ADD TFRD053-ITEM-QTY     TO PV-UNT-QTY-COUNT.                08010000
           ADD TFRD053-ITEM-QTY     TO PV-TFR-QTY-COUNT.                08020000
           ADD TFRD053-ITEM-QTY     TO PV-STR-QTY-COUNT.                08030000
           ADD TFRD053-ITEM-QTY     TO PV-TOT-QTY-COUNT.                08040000
                                                                        08050000
           ADD PV-EXTD-AMOUNT       TO PV-UNT-RTL-AMT-COUNT.            08060000
           ADD PV-EXTD-AMOUNT       TO PV-TFR-RTL-AMT-COUNT.            08070000
           ADD PV-EXTD-AMOUNT       TO PV-STR-RTL-AMT-COUNT.            08080000
           ADD PV-EXTD-AMOUNT       TO PV-TOT-RTL-AMT-COUNT.            08090000
                                                                        08100000
      ******************************************************************08110000
      * 4100-BUILD-ERROR-TRANSFER.                                      08120000
      ******************************************************************08130000
       4100-BUILD-ERROR-TRANSFER.                                       08140000
                                                                        08150000
           WRITE TFR-DATA-ERROR-RECORD FROM TRANSFER-DATA-RECORD.       08160000
                                                                        08170000
W33304******************************************************************        
W33304* 4200-WRITE ERROR INPUT TO ERROR FILE                                    
W33304******************************************************************        
W33304 4200-WRITE-ERROR-RECORD.                                                 
W33304                                                                          
W33304     WRITE TFR-INPUT-ERROR-RECD  FROM TRANSFER-DATA-RECORD.               
W33304                                                                          
      ******************************************************************08180000
      * 5000-FORMAT-DETAIL-LINE.                                        08190000
      ******************************************************************08200000
       5000-FORMAT-DETAIL-LINE.                                         08210000
                                                                        08220000
           IF PV-LINE-COUNT IS GREATER THAN PC-PRINT-LINE-MAX           08230000
               PERFORM 7000-PRINT-HEADINGS                              08240000
           END-IF.                                                      08250000
                                                                        08260000
           MOVE PV-SHEET-NBR        TO DL-SHEET-NBR.                    08270000
P28545                                                                  08280000
P28545     MOVE IN400-ATT-DEPT-OUT    TO DL-DEPT-NBR.                   08290000
P28545     MOVE IN400-ATT-SCL-OUT     TO DL-SUBCLASS-NBR.               08300000
P28545*    MOVE SKXREF-DEPT           TO DL-DEPT-NBR.                   08310000
P28545*    MOVE SKXREF-SUBCLASS       TO DL-SUBCLASS-NBR.               08320000
P28545                                                                  08321000
           MOVE TFRD053-SKU-NBR     TO DL-SKU-NBR.                      08322000
                                                                        08323000
           MOVE TFRD053-ITEM-QTY    TO DL-UNIT-QTY.                     08324000
           MOVE PV-UNT-RTL-AMT-HOLD TO DL-UNIT-RTL-AMT.                 08325000
                                                                        08326000
           COMPUTE PV-EXTD-AMOUNT   = PV-UNT-RTL-AMT-HOLD               08327000
                                    * TFRD053-ITEM-QTY.                 08328000
           MOVE PV-EXTD-AMOUNT      TO DL-EXTD-RTL-AMT.                 08329000
                                                                        08330000
           ADD TFRD053-ITEM-QTY     TO PA-ITEM-QTY.                     08340000
           ADD TFRD053-ITEM-QTY     TO PA-LOC-ITEM-QTY.                 08350000
           ADD TFRD053-ITEM-QTY     TO PA-TOT-ITEM-QTY.                 08360000
           ADD PV-EXTD-AMOUNT       TO PA-EXTD-RTL-AMT.                 08370000
           ADD PV-EXTD-AMOUNT       TO PA-LOC-EXTD-RTL-AMT.             08380000
           ADD PV-EXTD-AMOUNT       TO PA-TOT-EXTD-RTL-AMT.             08390000
                                                                        08400000
           MOVE TFRD053-ITEM-PRICE  TO DL-TFR-RTL-AMT.                  08410000
                                                                        08420000
           COMPUTE PV-EXTD-AMOUNT   = TFRD053-ITEM-PRICE                08430000
                                    * TFRD053-ITEM-QTY.                 08440000
           MOVE PV-EXTD-AMOUNT      TO DL-EXTD-TFR-RTL-AMT.             08450000
                                                                        08460000
           ADD TFRD053-ITEM-QTY     TO PA-TFR-ITEM-QTY.                 08470000
           ADD TFRD053-ITEM-QTY     TO PA-LOC-TFR-ITEM-QTY.             08480000
           ADD TFRD053-ITEM-QTY     TO PA-TOT-TFR-ITEM-QTY.             08490000
           ADD PV-EXTD-AMOUNT       TO PA-TFR-EXTD-RTL-AMT.             08500000
           ADD PV-EXTD-AMOUNT       TO PA-LOC-TFR-EXTD-RTL-AMT.         08510000
           ADD PV-EXTD-AMOUNT       TO PA-TOT-TFR-EXTD-RTL-AMT.         08520000
                                                                        08530000
           COMPUTE PV-EXTD-AMOUNT   = (TFRD053-ITEM-PRICE               08540000
                                    *  TFRD053-ITEM-QTY)                08550000
                                    - (PV-UNT-RTL-AMT-HOLD              08560000
                                    *  TFRD053-ITEM-QTY).               08570000
                                                                        08580000
           MOVE PV-EXTD-AMOUNT      TO DL-DIFF-RTL-AMT.                 08590000
           ADD PV-EXTD-AMOUNT       TO PA-DFF-EXTD-RTL-AMT.             08600000
           ADD PV-EXTD-AMOUNT       TO PA-LOC-DFF-EXTD-RTL-AMT.         08610000
X28545     ADD PV-EXTD-AMOUNT       TO PA-TOT-DFF-EXTD-RTL-AMT.         08620000
                                                                        08630000
           WRITE REPORT-LINE FROM DL-DETAIL-LINE AFTER ADVANCING 1 LINE.08640000
                                                                        08650000
           ADD 1                    TO PV-LINE-COUNT.                   08660000
                                                                        08670000
      ******************************************************************08680000
      * 5100-FORMAT-TRANSFER-TOTALS.                                    08690000
      ******************************************************************08700000
       5100-FORMAT-TRANSFER-TOTALS.                                     08710000
                                                                        08720000
           IF PV-TFR-QTY-COUNT NOT EQUAL ZEROS     OR                   08730000
              PV-TFR-RTL-AMT-COUNT NOT EQUAL ZEROS                      08740000
                                                                        08750000
             IF PV-LINE-COUNT IS GREATER THAN (PC-PRINT-LINE-MAX - 3)   08760000
                 PERFORM 7000-PRINT-HEADINGS                            08770000
             END-IF                                                     08780000
                                                                        08790000
             MOVE '    TRANSFER TOTAL' TO TL-VERBIAGE                   08800000
             MOVE PA-ITEM-QTY          TO TL-UNIT-QTY                   08810000
             MOVE PA-EXTD-RTL-AMT      TO TL-EXTD-RTL-AMT               08820000
             MOVE PA-TFR-EXTD-RTL-AMT  TO TL-EXTD-TFR-RTL-AMT           08830000
             MOVE PA-DFF-EXTD-RTL-AMT  TO TL-DIFF-RTL-AMT               08840000
                                                                        08850000
             WRITE REPORT-LINE FROM TL-TOTAL-LINE AFTER ADVANCING 2 LINE08860000
                                                                        08870000
             MOVE SPACES               TO REPORT-LINE                   08880000
             WRITE REPORT-LINE         AFTER ADVANCING 1 LINE           08890000
                                                                        08900000
             ADD 2                     TO PV-LINE-COUNT                 08910000
                                                                        08920000
             MOVE ZEROS               TO PA-ITEM-QTY                    08930000
             MOVE ZEROS               TO PA-EXTD-RTL-AMT                08940000
             MOVE ZEROS               TO PA-TFR-ITEM-QTY                08950000
             MOVE ZEROS               TO PA-TFR-EXTD-RTL-AMT            08960000
             MOVE ZEROS               TO PA-DFF-EXTD-RTL-AMT            08970000
                                                                        08980000
           END-IF.                                                      08990000
                                                                        09000000
      ******************************************************************09010000
      * 5200-FORMAT-STORE-TOTALS.                                       09020000
      ******************************************************************09030000
       5200-FORMAT-STORE-TOTALS.                                        09040000
                                                                        09050000
           IF PV-LINE-COUNT IS GREATER THAN (PC-PRINT-LINE-MAX - 2)     09060000
               PERFORM 7000-PRINT-HEADINGS                              09070000
           END-IF.                                                      09080000
                                                                        09090000
           MOVE '  STORE TOTAL   '      TO TL-VERBIAGE.                 09100000
           MOVE PA-LOC-ITEM-QTY         TO TL-UNIT-QTY.                 09110000
           MOVE PA-LOC-EXTD-RTL-AMT     TO TL-EXTD-RTL-AMT.             09120000
           MOVE PA-LOC-TFR-EXTD-RTL-AMT TO TL-EXTD-TFR-RTL-AMT.         09130000
           MOVE PA-LOC-DFF-EXTD-RTL-AMT TO TL-DIFF-RTL-AMT.             09140000
                                                                        09150000
           WRITE REPORT-LINE FROM TL-TOTAL-LINE                         09160000
                                    AFTER ADVANCING 2 LINE.             09170000
                                                                        09180000
           ADD 2                    TO PV-LINE-COUNT.                   09190000
                                                                        09200000
           MOVE ZEROS               TO PA-ITEM-QTY.                     09210000
           MOVE ZEROS               TO PA-EXTD-RTL-AMT.                 09220000
           MOVE ZEROS               TO PA-TFR-ITEM-QTY.                 09230000
           MOVE ZEROS               TO PA-TFR-EXTD-RTL-AMT.             09240000
           MOVE ZEROS               TO PA-DFF-EXTD-RTL-AMT.             09250000
           MOVE ZEROS               TO PA-LOC-ITEM-QTY.                 09260000
           MOVE ZEROS               TO PA-LOC-EXTD-RTL-AMT.             09270000
           MOVE ZEROS               TO PA-LOC-TFR-ITEM-QTY.             09280000
           MOVE ZEROS               TO PA-LOC-TFR-EXTD-RTL-AMT.         09290000
           MOVE ZEROS               TO PA-LOC-DFF-EXTD-RTL-AMT.         09300000
                                                                        09310000
      ******************************************************************09320000
      * 5300-FORMAT-GRAND-TOTALS.                                       09330000
      ******************************************************************09340000
       5300-FORMAT-GRAND-TOTALS.                                        09350000
                                                                        09360000
           PERFORM 7000-PRINT-HEADINGS.                                 09370000
                                                                        09380000
           MOVE 'GRAND TOTAL     '      TO TL-VERBIAGE.                 09390000
           MOVE PA-TOT-ITEM-QTY         TO TL-UNIT-QTY.                 09400000
           MOVE PA-TOT-EXTD-RTL-AMT     TO TL-EXTD-RTL-AMT.             09410000
           MOVE PA-TOT-TFR-EXTD-RTL-AMT TO TL-EXTD-TFR-RTL-AMT.         09420000
           MOVE PA-TOT-DFF-EXTD-RTL-AMT TO TL-DIFF-RTL-AMT.             09430000
                                                                        09440000
           WRITE REPORT-LINE FROM TL-TOTAL-LINE AFTER ADVANCING 2 LINES.09450000
                                                                        09460000
      ******************************************************************09470000
      * 5400-NOTHING-TO-REPORT.                                         09480000
      ******************************************************************09490000
       5400-NOTHING-TO-REPORT.                                          09500000
                                                                        09510000
W33304     PERFORM 7000-PRINT-HEADINGS.                                 09530000
                                                                        09550000
           WRITE REPORT-LINE                                            09560000
               FROM NL-NO-REPORT-LINE AFTER ADVANCING 2 LINE.           09570000
                                                                        09580000
      ******************************************************************09590000
      * 7000-PRINT-HEADINGS.                                            09600000
      ******************************************************************09610000
       7000-PRINT-HEADINGS.                                             09620000
                                                                        09630000
           ADD 1                    TO PV-PAGE-COUNT.                   09640000
           MOVE PV-PAGE-COUNT       TO DP132O-PAGE-NUMBER.              09650000
                                                                        09660000
           WRITE REPORT-LINE                                            09670000
             FROM DP132O-STANDRD-HEADER-132-COLS AFTER ADVANCING PAGE.  09680000
                                                                        09690000
           WRITE REPORT-LINE                                            09700000
             FROM HL1-HEADING-LINE-1 AFTER ADVANCING 1 LINE.            09710000
                                                                        09720000
           PERFORM 8800-GET-LOCATION-INFO.                              09730000
                                                                        09740000
           WRITE REPORT-LINE                                            09750000
             FROM HL2-HEADING-LINE-2 AFTER ADVANCING 1 LINE.            09760000
                                                                        09770000
           MOVE INVPAR-PLND-INV-DTE  TO HL3-PLND-INV-DTE.               09780000
                                                                        09790000
           WRITE REPORT-LINE                                            09800000
             FROM HL3-HEADING-LINE-3 AFTER ADVANCING 1 LINE.            09810000
                                                                        09820000
           WRITE REPORT-LINE                                            09830000
             FROM HL4-HEADING-LINE-4 AFTER ADVANCING 2 LINE.            09840000
                                                                        09850000
           WRITE REPORT-LINE                                            09860000
             FROM HL5-HEADING-LINE-5 AFTER ADVANCING 1 LINE.            09870000
                                                                        09880000
           MOVE 6                   TO PV-LINE-COUNT.                   09890000
                                                                        09900000
      ******************************************************************09910000
      * 7600-GET-COMMIT-TIMESTAMP.                                     *09920000
      *   GET THE TIMESTAMP FROM THE CHECKPOINT TABLE FOR NEXT COMMIT  *09930000
      ******************************************************************09940000
       7600-GET-COMMIT-TIMESTAMP.                                       09950000
                                                                        09960000
           EXEC SQL                                                     09970000
             SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)       09980000
               INTO :PV-COMMIT-TIMESTAMP                                09990000
               FROM TCKRSTCNTL                                          10000000
              WHERE JOB_NAME  = :PC-JOB-NAME                            10010000
                AND PLAN_NAME = :PC-PROGRAM-NAME                        10020000
           END-EXEC.                                                    10030000
                                                                        10040000
           EVALUATE TRUE                                                10050000
               WHEN SQLCODE = 0                                         10060000
                   CONTINUE                                             10070000
               WHEN SQLCODE NOT EQUAL ZERO                              10080000
                   DISPLAY ' JOB:     ' PC-JOB-NAME                     10090000
                           ' PROGRAM: ' PC-PROGRAM-NAME                 10100000
                   MOVE '7600-GET-COMMIT-TIMESTAMP' TO PV-PARAGRAPH-NAME10110000
                   MOVE PE-MSG-07             TO PV-OPERATION-ATTEMPTED 10120000
                   PERFORM 9900-SQL-ERROR                               10130000
           END-EVALUATE.                                                10140000
      *                                                                 10150000
      ******************************************************************10160000
      * 7650-INIT-CHECKPOINT-SELECT                                    *10170000
      * CHECK STATUS CODE TO SEE IF THIS IS A RESTART CONDITION        *10180000
      ******************************************************************10190000
       7650-INIT-CHECKPOINT-SELECT.                                     10200000
                                                                        10210000
           EXEC SQL                                                     10220000
             SELECT  CKPT_STAT_CODE                                     10230000
                    ,CKPT_FRQNCY_QTY                                    10240000
               INTO  :TCKRSTCNTL-CKPT-STAT-CODE                         10250000
                    ,:TCKRSTCNTL-CKPT-FRQNCY-QTY                        10260000
               FROM  TCKRSTCNTL                                         10270000
              WHERE  JOB_NAME  = :PC-JOB-NAME                           10280000
                AND  PLAN_NAME = :PC-PROGRAM-NAME                       10290000
           END-EXEC.                                                    10300000
                                                                        10310000
           IF SQLCODE = 0                                               10320000
               CONTINUE                                                 10330000
           ELSE                                                         10340000
               DISPLAY ' JOB: ' PC-JOB-NAME                             10350000
                       ' PROGRAM: ' PC-PROGRAM-NAME                     10360000
               MOVE '7650-INIT-CHECKPOINT-SELECT' TO PV-PARAGRAPH-NAME  10370000
               MOVE PE-MSG-07             TO PV-OPERATION-ATTEMPTED     10380000
               PERFORM 9900-SQL-ERROR                                   10390000
           END-IF.                                                      10400000
                                                                        10410000
      ******************************************************************10420000
      * 7700-SELECT-RESTART-INFO                                       *10430000
      * OBTAIN INFORMATION REGARDING WHERE TO RESTART TABLE PROCESSING *10440000
      ******************************************************************10450000
       7700-SELECT-RESTART-INFO.                                        10460000
                                                                        10470000
           EXEC SQL                                                     10480000
             SELECT  WORK_STRG_DESC                                     10490000
               INTO  :TCKRSTINF-WORK-STRG-DESC                          10500000
               FROM  TCKRSTINF                                          10510000
              WHERE  JOB_NAME  = :PC-JOB-NAME                           10520000
                AND  PLAN_NAME = :PC-PROGRAM-NAME                       10530000
           END-EXEC.                                                    10540000
                                                                        10550000
           IF SQLCODE = 0                                               10560000
               CONTINUE                                                 10570000
           ELSE                                                         10580000
               DISPLAY ' JOB:     ' PC-JOB-NAME                         10590000
                       ' PROGRAM: ' PC-PROGRAM-NAME                     10600000
               MOVE '*7700-SELECT-RESTART-INFO*' TO PV-PARAGRAPH-NAME   10610000
               MOVE PE-MSG-11             TO PV-OPERATION-ATTEMPTED     10620000
               PERFORM 9900-SQL-ERROR                                   10630000
           END-IF.                                                      10640000
                                                                        10650000
      ******************************************************************10660000
      * 7750-SET-CURRENT-TIMESTAMP.                                    *10670000
      * CURRENT TIMESTAMP SET TO BE COMPARED TO COMMIT TIMESTAMP       *10680000
      ******************************************************************10690000
       7750-SET-CURRENT-TIMESTAMP.                                      10700000
                                                                        10710000
           EXEC SQL                                                     10720000
                SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP           10730000
           END-EXEC.                                                    10740000
                                                                        10750000
           IF SQLCODE = 0                                               10760000
               CONTINUE                                                 10770000
           ELSE                                                         10780000
               MOVE PE-MSG-12             TO PV-OPERATION-ATTEMPTED     10790000
               MOVE '*7750-SET-CURRENT-TIMESTAMP*' TO PV-PARAGRAPH-NAME 10800000
               PERFORM 9900-SQL-ERROR                                   10810000
           END-IF.                                                      10820000
                                                                        10830000
      ******************************************************************10840000
      * 7800-COMMIT-PROCESSING.                                        *10850000
      * COMPARE COMMIT TIMESTAMP TO CURRENT TO DETERMINE IF COMMIT REQD*10860000
      ******************************************************************10870000
       7800-COMMIT-PROCESSING.                                          10880000
           MOVE '*7800-COMMIT-PROCESSING*'    TO PV-PARAGRAPH-NAME.     10890000
                                                                        10900000
           PERFORM 7750-SET-CURRENT-TIMESTAMP.                          10910000
                                                                        10920000
           IF (PV-CURRENT-TIMESTAMP > PV-COMMIT-TIMESTAMP)  OR          10930000
              (END-OF-TRANSFER-DATA)                                    10940000
      * PREPARE COMMIT RECORD FOR UPDATE                                10950000
               ADD 1                          TO PA-COMMIT-COUNT        10960000
               MOVE TFRD053-BATCH-NBR         TO CR-BATCH-NBR           10970000
               MOVE TFRD053-TO-LOC-NBR        TO CR-TO-LOC-NBR          10980000
               MOVE TFRD053-DOC-FROM-LOC-NBR  TO CR-DOC-FROM-LOC-NBR    10990000
               MOVE TFRD053-DOC-SEQ-NBR       TO CR-DOC-SEQ-NBR         11000000
               MOVE TFRD053-CREATE-DATE       TO CR-CREATE-DATE         11010000
               MOVE TFRD053-LNE-NBR           TO CR-LNE-NBR             11020000
               MOVE TFRD053-SKU-NBR           TO CR-SKU-NBR             11030000
               MOVE PA-EXTRACT-RECS-READ      TO CR-INPUT-COUNT         11040000
               MOVE PA-UPDATE-COUNT           TO CR-UPDATE-COUNT        11050000
               MOVE PA-INSERT-COUNT           TO CR-INSERT-COUNT        11060000
               MOVE PA-COMMIT-COUNT           TO CR-COMMIT-COUNT        11070000
               MOVE PA-ZERO-REC-DROPPED       TO CR-ZERO-REC-DROPPED    11080000
               MOVE PA-DUPLICATE-REC          TO CR-DUPLICATE-REC       11090000
      * MOVE COMMIT INFO TO WORKING STORAGE ROW                         11100000
               MOVE CR-CHECKPOINT-RESTART-AREA TO                       11110000
                                                TCKRSTINF-WORK-STRG-DESC11120000
               MOVE 'Y' TO PS-COMMIT-TAKEN-SW                           11130000
               IF PS-FIRST-COMMIT                                       11140000
                   MOVE '9' TO TCKRSTCNTL-CKPT-STAT-CODE                11150000
                   PERFORM 7900-UPDATE-CHECKPOINT-STATUS                11160000
                   MOVE 'N' TO PS-FIRST-COMMIT-SW                       11170000
               END-IF                                                   11180000
                                                                        11190000
               PERFORM 7850-COMMIT-CHANGES                              11200000
                                                                        11210000
               PERFORM 7600-GET-COMMIT-TIMESTAMP                        11220000
                                                                        11230000
           END-IF.                                                      11240000
                                                                        11250000
      ******************************************************************11260000
      * 7850-COMMIT-CHANGES.                                            11270000
      * UPDATE CHECKPOINT INFORMATION TABLE. TAKE A COMMIT.             11280000
      ******************************************************************11290000
       7850-COMMIT-CHANGES.                                             11300000
                                                                        11310000
           EXEC SQL                                                     11320000
             UPDATE TCKRSTINF                                           11330000
                SET WORK_STRG_DESC = :TCKRSTINF-WORK-STRG-DESC          11340000
              WHERE JOB_NAME       = :PC-JOB-NAME                       11350000
                AND PLAN_NAME      = :PC-PROGRAM-NAME                   11360000
           END-EXEC.                                                    11370000
                                                                        11380000
           IF SQLCODE = 0                                               11390000
               CONTINUE                                                 11400000
           ELSE                                                         11410000
               DISPLAY ' JOB:     ' PC-JOB-NAME                         11420000
                       ' PROGRAM: ' PC-PROGRAM-NAME                     11430000
               MOVE PE-MSG-08                  TO PV-OPERATION-ATTEMPTED11440000
               MOVE  '* 7850-COMMIT-CHANGES *' TO PV-PARAGRAPH-NAME     11450000
               PERFORM 9900-SQL-ERROR                                   11460000
           END-IF.                                                      11470000
                                                                        11480000
           EXEC SQL                                                     11490000
               COMMIT                                                   11500000
           END-EXEC.                                                    11510000
                                                                        11520000
           IF SQLCODE = 0                                               11530000
               CONTINUE                                                 11540000
           ELSE                                                         11550000
               MOVE PE-MSG-09                  TO PV-OPERATION-ATTEMPTED11560000
               MOVE  '* 7850-COMMIT-CHANGES *' TO PV-PARAGRAPH-NAME     11570000
               PERFORM 9900-SQL-ERROR                                   11580000
           END-IF.                                                      11590000
                                                                        11600000
      ******************************************************************11610000
      * UPDATE CHECKPOINT STATUS                                        11620000
      ******************************************************************11630000
       7900-UPDATE-CHECKPOINT-STATUS.                                   11640000
                                                                        11650000
           EXEC SQL                                                     11660000
             UPDATE  TCKRSTCNTL                                         11670000
                SET  CKPT_STAT_CODE = :TCKRSTCNTL-CKPT-STAT-CODE        11680000
              WHERE  JOB_NAME  = :PC-JOB-NAME                           11690000
                AND  PLAN_NAME = :PC-PROGRAM-NAME                       11700000
           END-EXEC.                                                    11710000
                                                                        11720000
           IF SQLCODE = 0                                               11730000
               CONTINUE                                                 11740000
           ELSE                                                         11750000
               DISPLAY ' JOB:     ' PC-JOB-NAME                         11760000
                       ' PROGRAM: ' PC-PROGRAM-NAME                     11770000
               MOVE '7900-UPDATE-CHECKPOINT-STATUS' TO PV-PARAGRAPH-NAME11780000
               MOVE PE-MSG-10                  TO PV-OPERATION-ATTEMPTED11790000
               PERFORM 9900-SQL-ERROR                                   11800000
           END-IF.                                                      11810000
                                                                        11820000
      /*****************************************************************11830000
      * 8000-GET-INTR-UPC-ID.                                           11840000
      *     USED TO GET THE SKU NUMBER OF THE ACTIVE ROW FOR THE        11850000
      * INTERNAL UPC PASSED FROM RECEIVING.                             11860000
      ******************************************************************11870000
P28545*8000-GET-INTR-UPC-ID.                                            11880000
P28545*                                                                 11890000
P28545*    MOVE TFRD053-SKU-NBR   TO SKXREF-SKU.                        11900000
P28545*                                                                 11910000
P28545*    PERFORM                                                      11920000
P28545*        WITH TEST AFTER                                          11930000
P28545*        VARYING PV-RETRY-COUNT FROM 1 BY 1                       11940000
P28545*        UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  11950000
P28545*            OR (SQLCODE = 0)                                     11960000
P28545*            OR (SQLCODE = +100)                                  11970000
P28545*                                                                 11980000
P28545*        EXEC SQL                                                 11990000
P28545*            SELECT INTR_UPC_ID                                   12000000
P28545*                  ,DEPT                                          12010000
P28545*                  ,SUBCLASS                                      12020000
P28545*            INTO :SKXREF-INTR-UPC-ID                             12030000
P28545*                ,:SKXREF-DEPT                                    12040000
P28545*                ,:SKXREF-SUBCLASS                                12050000
P28545*            FROM TSKXREF                                         12060000
P28545*            WHERE SKU = :SKXREF-SKU                              12070000
P28545*              AND SKU_STAT_CDE <> '98'                           12080000
P28545*            WITH UR                                              12090000
P28545*        END-EXEC                                                 12100000
P28545*                                                                 12110000
P28545*        EVALUATE TRUE                                            12120000
P28545*            WHEN SQLCODE = 0                                     12130000
P28545*                CONTINUE                                         12140000
P28545*            WHEN SQLCODE = -904                                  12150000
P28545*            WHEN SQLCODE = -911                                  12160000
P28545*            WHEN SQLCODE = +100                                  12170000
P28545*                DISPLAY '*** NOT FOUND  8000-GET-INTR-UPC-ID ***'12180000
P28545*                DISPLAY ' STORE  :     ' TFRD053-TO-LOC-NBR      12190000
P28545*                DISPLAY ' TFR DOC:   ' TFRD053-DOC-FROM-LOC-NBR  12200000
P28545*                ' ' TFRD053-DOC-SEQ-NBR                          12210000
P28545*                DISPLAY ' SKU    :     ' TFRD053-SKU-NBR         12220000
P28545*                DISPLAY ' INTR-UPC-ID: ' SKXREF-INTR-UPC-ID      12230000
P28545*                PERFORM 9900-SQL-ERROR                           12240000
P28545*            WHEN OTHER                                           12250000
P28545*                DISPLAY '*** OTHER - 8000-GET-INTR-UPC-ID ***'   12260000
P28545*                DISPLAY ' STORE  :     ' TFRD053-TO-LOC-NBR      12270000
P28545*                DISPLAY ' TFR DOC:   ' TFRD053-DOC-FROM-LOC-NBR  12280000
P28545*                ' ' TFRD053-DOC-SEQ-NBR                          12290000
P28545*                DISPLAY ' SKU    :     ' TFRD053-SKU-NBR         12300000
P28545*                DISPLAY ' INTR-UPC-ID: ' SKXREF-INTR-UPC-ID      12310000
P28545*                PERFORM 9900-SQL-ERROR                           12320000
P28545*        END-EVALUATE                                             12330000
P28545*    END-PERFORM.                                                 12340000
P28545*                                                                 12350000
P28545*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          12360000
P28545*        DISPLAY '*** MAX RETRIES - 8000-GET-INTR-UPC-ID ***'     12370000
P28545*        DISPLAY ' STORE  :     ' TFRD053-TO-LOC-NBR              12380000
P28545*        DISPLAY ' TFR DOC:   ' TFRD053-DOC-FROM-LOC-NBR          12390000
P28545*                ' ' TFRD053-DOC-SEQ-NBR                          12400000
P28545*        DISPLAY ' SKU    :     ' TFRD053-SKU-NBR                 12410000
P28545*        DISPLAY ' INTR-UPC-ID: ' SKXREF-INTR-UPC-ID              12420000
P28545*        PERFORM 9900-SQL-ERROR                                   12430000
P28545*    END-IF.                                                      12440000
P28545*                                                                 12450000
      ******************************************************************12460000
      * 8100-READ-TRANSFER-DATA.                                        12470000
      *     READ THE INTRANSIT FILE PASSED FROM THE RECEIVING TEAM.     12480000
      ******************************************************************12490000
       8100-READ-TRANSFER-DATA.                                         12500000
                                                                        12510000
           READ TRANSFER-DATA-FILE NEXT                                 12520000
               INTO TFRD053-INV-SNAPSHOT-FILE                           12530000
               AT END  SET END-OF-TRANSFER-DATA TO TRUE.                12540000
                                                                        12550000
      ******************************************************************12560000
      * 8200-INSERT-INTO-TINENTY.                                       12570000
      ******************************************************************12580000
       8200-INSERT-INTO-TINENTY.                                        12590000
                                                                        12600000
           PERFORM WITH TEST AFTER                                      12610000
              VARYING PV-RETRY-COUNT FROM 1 BY 1                        12620000
               UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  12630000
                   OR (SQLCODE = 0)                                     12640000
                   OR (SQLCODE = +100)                                  12650000
                   OR (SQLCODE = -803)                                  12660000
                                                                        12670000
             EXEC SQL                                                   12680000
               INSERT INTO TINENTY                                      12690000
                    (STR_NBR                                            12700000
                  ,  SHEET_TYP_CDE                                      12710000
                  ,  SHEET_NBR                                          12720000
                  ,  LNE_NBR                                            12730000
                  ,  SKU_NBR                                            12740000
                  ,  UPC_NBR                                            12750000
                  ,  INV_QTY                                            12760000
                  ,  UNT_RTL_AMT                                        12770000
                  ,  EXTD_RTL_AMT                                       12780000
                  ,  LAST_UPD_TMST                                      12790000
                  ,  LAST_UPD_BY_USR_ID)                                12800000
               VALUES                                                   12810000
                   (:INENTY-STR-NBR                                     12820000
                  , 'T'                                                 12830000
                  , :INENTY-SHEET-NBR                                   12840000
                  , :INENTY-LNE-NBR                                     12850000
                  , :INENTY-SKU-NBR                                     12860000
                  , :INENTY-UPC-NBR                                     12870000
                  , :INENTY-INV-QTY                                     12880000
                  , :INENTY-UNT-RTL-AMT                                 12890000
                  , :INENTY-EXTD-RTL-AMT                                12900000
                  , CURRENT TIMESTAMP                                   12910000
                  , :INENTY-LAST-UPD-BY-USR-ID)                         12920000
             END-EXEC                                                   12930000
                                                                        12940000
             EVALUATE TRUE                                              12950000
               WHEN SQLCODE = ZERO                                      12960000
                   ADD 1            TO PV-RECORDS-ACCEPTED              12970000
                   ADD 1            TO PA-INSERT-COUNT                  12980000
               WHEN SQLCODE = -803                                      12990000
                   ADD 1            TO PA-DUPLICATE-REC                 13000000
               WHEN SQLCODE = -904                                      13010000
               WHEN SQLCODE = -911                                      13020000
                   CONTINUE                                             13030000
               WHEN OTHER                                               13040000
                       DISPLAY '***PARAGRAPH - 8200-INSERT-INTO ***'    13050000
                       DISPLAY ' STORE  : ' TFRD053-TO-LOC-NBR          13060000
                       DISPLAY ' TFR DOC: ' TFRD053-DOC-FROM-LOC-NBR    13070000
                       ' ' TFRD053-DOC-SEQ-NBR                          13080000
                       DISPLAY ' SKU    : ' TFRD053-SKU-NBR             13090000
                       DISPLAY 'SHEET   : ' INENTY-SHEET-NBR            13100000
                       DISPLAY 'LINE    : ' INENTY-LNE-NBR              13110000
                       PERFORM 9900-SQL-ERROR                           13120000
               END-EVALUATE                                             13130000
           END-PERFORM.                                                 13140000
                                                                        13150000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          13160000
               DISPLAY '*** MAX RETRIES - 8200-INSERT-INTO ***'         13170000
               DISPLAY ' STORE  :     ' TFRD053-TO-LOC-NBR              13180000
               DISPLAY ' TFR DOC: ' TFRD053-DOC-FROM-LOC-NBR            13190000
                       ' ' TFRD053-DOC-SEQ-NBR                          13200000
               DISPLAY ' SKU    :     ' TFRD053-SKU-NBR                 13210000
               DISPLAY 'SHEET   : ' INENTY-SHEET-NBR                    13220000
               DISPLAY 'LINE    : ' INENTY-LNE-NBR                      13230000
               PERFORM 9900-SQL-ERROR                                   13240000
           END-IF.                                                      13250000
                                                                        13260000
      ******************************************************************13270000
      * 8300-READ-TINVPAR.                                              13280000
      ******************************************************************13290000
       8300-READ-TINVPAR.                                               13300000
                                                                        13310000
           MOVE TFRD053-TO-LOC-NBR   TO INVPAR-LOC-NBR.                 13320000
                                                                        13330000
           PERFORM                                                      13340000
               WITH TEST AFTER                                          13350000
               VARYING PV-RETRY-COUNT FROM 1 BY 1                       13360000
               UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  13370000
                   OR (SQLCODE = 0)                                     13380000
                   OR (SQLCODE = +100)                                  13390000
                                                                        13400000
               EXEC SQL                                                 13410000
                   SELECT PLND_INV_DTE                                  13420000
P28545                   ,A.INV_ID                                      13430000
                   INTO :INVPAR-PLND-INV-DTE                            13440000
P28545                 ,:INVPAR-INV-ID                                  13450000
P28545             FROM TINVPAR A,                                      13460000
P28545                  TINCNTL B                                       13470000
P28545             WHERE B.ACTV_IND = 'Y'                               13480000
P28545               AND A.INV_ID = B.INV_ID                            13490000
P28545               AND LOC_NBR = :INVPAR-LOC-NBR                      13500000
                     AND ACTL_FIN_BK_DTE = '9999-09-09'                 13510000
W33304               AND LOC_INV_STAT_CDE = 'IN'                        13511006
                   WITH UR                                              13520000
               END-EXEC                                                 13530000
                                                                        13540000
               EVALUATE TRUE                                            13550000
               WHEN SQLCODE = 0                                         13560000
                   MOVE INVPAR-PLND-INV-DTE   TO PV-PLND-INV-DTE        13570000
                   MOVE PV-PLND-INV-TIMESTAMP TO PV-PLND-INV-TMST       13580000
W33304             SET PS-VALID-STORE-YES     TO TRUE                           
               WHEN SQLCODE = -913                                      13590000
               WHEN SQLCODE = -904                                      13600000
               WHEN SQLCODE = -911                                      13610000
W33304             CONTINUE                                                     
               WHEN SQLCODE = +100                                      13620000
W33304             SET PS-VALID-STORE-NO      TO TRUE                           
W33304             PERFORM 4200-WRITE-ERROR-RECORD                              
               WHEN SQLWARN NOT = SPACE                                 13680000
               WHEN SQLCODE NOT = ZERO                                  13690000
                   DISPLAY '** PARAGRAPH - 8300-READ-TINVPAR **'        13700000
                   DISPLAY ' STORE  :     ' TFRD053-TO-LOC-NBR          13710000
                   PERFORM 9900-SQL-ERROR                               13720000
               END-EVALUATE                                             13730000
           END-PERFORM.                                                 13740000
                                                                        13750000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          13760000
               DISPLAY '** MAX RETRIES - 8300-READ-TINVPAR **'          13770000
               DISPLAY ' STORE  :     ' TFRD053-TO-LOC-NBR              13780000
               PERFORM 9900-SQL-ERROR                                   13790000
           END-IF.                                                      13800000
                                                                        13810000
      ******************************************************************13820000
      * 8400-GET-UPC-NBR.                                               13830000
      *     GET THE UPC NUMBER TO AID IN DEVELOPING THE PRICE.          13840000
      ******************************************************************13850000
P28545*8400-GET-UPC-NBR.                                                13860000
P28545*                                                                 13870000
P28545*    SET PS-UPC-NBR-NOT-FOUND TO TRUE.                            13880000
P28545*                                                                 13890000
P28545*    MOVE SKXREF-INTR-UPC-ID  TO UPC-UPC-ID.                      13900000
P28545*    MOVE PV-PLND-INV-TMST    TO UPC-EFF-BEG-DTE.                 13910000
P28545*                                                                 13920000
P28545*    PERFORM                                                      13930000
P28545*        WITH TEST AFTER                                          13940000
P28545*        VARYING PV-RETRY-COUNT FROM 1 BY 1                       13950000
P28545*        UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  13960000
P28545*            OR (SQLCODE = 0)                                     13970000
P28545*            OR (SQLCODE = +100)                                  13980000
P28545*                                                                 13990000
P28545*        EXEC SQL                                                 14000000
P28545*            SELECT UPC_NBR                                       14010000
P28545*            INTO :UPC-UPC-NBR                                    14020000
P28545*            FROM TUPC                                            14030000
P28545*            WHERE UPC_ID             = :UPC-UPC-ID               14040000
P28545*              AND EFF_BEG_DTE       <= :UPC-EFF-BEG-DTE          14050000
P28545*              AND (EFF_END_DTE      >= :UPC-EFF-BEG-DTE          14060000
P28545*                   OR EFF_END_DTE IS NULL)                       14070000
P28545*            WITH UR                                              14080000
P28545*        END-EXEC                                                 14090000
P28545*                                                                 14100000
P28545*        EVALUATE TRUE                                            14110000
P28545*            WHEN SQLCODE = 0                                     14120000
P28545*                 SET PS-UPC-NBR-FOUND  TO TRUE                   14130000
P28545*            WHEN SQLCODE = -904                                  14140000
P28545*            WHEN SQLCODE = -911                                  14150000
P28545*            WHEN SQLCODE = +100                                  14160000
P28545*                CONTINUE                                         14170000
P28545*            WHEN OTHER                                           14180000
P28545*                DISPLAY '***PARAGRAPH - 8400-GET-UPC-NBR ***'    14190000
P28545*                DISPLAY ' STORE  :     ' TFRD053-TO-LOC-NBR      14200000
P28545*                DISPLAY ' TFR DOC: ' TFRD053-DOC-FROM-LOC-NBR    14210000
P28545*                ' ' TFRD053-DOC-SEQ-NBR                          14220000
P28545*                DISPLAY ' SKU    :     ' TFRD053-SKU-NBR         14230000
P28545*                DISPLAY ' UPC-ID: ' UPC-UPC-ID                   14240000
P28545*                        ' EFF DATE: ' UPC-EFF-BEG-DTE            14250000
P28545*                PERFORM 9900-SQL-ERROR                           14260000
P28545*        END-EVALUATE                                             14270000
P28545*    END-PERFORM.                                                 14280000
P28545*                                                                 14290000
P28545*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          14300000
P28545*        DISPLAY '*** MAX RETRIES - 8400-GET-UPC-NBR ***'         14310000
P28545*        DISPLAY ' STORE  :     ' TFRD053-TO-LOC-NBR              14320000
P28545*        DISPLAY ' TFR DOC: ' TFRD053-DOC-FROM-LOC-NBR            14330000
P28545*                ' ' TFRD053-DOC-SEQ-NBR                          14340000
P28545*        DISPLAY ' SKU    :     ' TFRD053-SKU-NBR                 14350000
P28545*        DISPLAY ' UPC-ID: ' UPC-UPC-ID                           14360000
P28545*                ' EFF DATE: ' UPC-EFF-BEG-DTE                    14370000
P28545*        PERFORM 9900-SQL-ERROR                                   14380000
P28545*    END-IF.                                                      14390000
P28545*                                                                 14400000
      ******************************************************************14410000
      * 8500-GET-PRICE.                                                 14420000
      ******************************************************************14430000
P28545*8500-GET-PRICE.                                                  14440000
P28545*                                                                 14450000
P28545*    SET PS-PRICE-NOT-FOUND  TO TRUE.                             14460000
P28545*    MOVE SKXREF-INTR-UPC-ID TO UPCPLS-UPC-ID.                    14470000
P28545*    MOVE PV-PLND-INV-TMST   TO UPCPLS-EFF-BEG-TMST.              14480000
P28545*                                                                 14490000
P28545*    PERFORM                                                      14500000
P28545*        WITH TEST AFTER                                          14510000
P28545*        VARYING PV-RETRY-COUNT FROM 1 BY 1                       14520000
P28545*        UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  14530000
P28545*            OR (SQLCODE = 0)                                     14540000
P28545*            OR (SQLCODE = +100)                                  14550000
P28545*                                                                 14560000
P28545*        EXEC SQL                                                 14570000
P28545*            SELECT  UNT_RTL_AMT                                  14580000
P28545*                   ,UPC_STAT_CDE                                 14590000
P28545*                   ,MEITGP_NBR                                   14600000
P28545*                   ,UPC_STAT_CHG_DTE                             14610000
P28545*                   ,UNT_RTL_CHG_DTE                              14620000
P28545*            INTO   :UPCPLS-UNT-RTL-AMT                           14630000
P28545*                  ,:UPCPLS-UPC-STAT-CDE                          14640000
P28545*                  ,:UPCPLS-MEITGP-NBR                            14650000
P28545*                  ,:UPCPLS-UPC-STAT-CHG-DTE                      14660000
P28545*                  ,:UPCPLS-UNT-RTL-CHG-DTE                       14670000
P28545*            FROM  TUPCPLS                                        14680000
P28545*            WHERE UPC_ID = :UPCPLS-UPC-ID                        14690000
P28545*              AND OPERCO_NBR = :PC-OPERCO-NBR                    14700000
P28545*              AND STR_NBR = :UPCPLS-STR-NBR                      14710000
P28545*              AND EFF_BEG_TMST <= :UPCPLS-EFF-BEG-TMST           14720000
P28545*              AND (EFF_END_TMST >= :UPCPLS-EFF-BEG-TMST          14730000
P28545*                   OR EFF_END_TMST IS NULL)                      14740000
P28545*            WITH UR                                              14750000
P28545*        END-EXEC                                                 14760000
P28545*                                                                 14770000
P28545*        EVALUATE TRUE                                            14780000
P28545*          WHEN SQLCODE = 0                                       14790000
P28545*            SET PS-PRICE-FOUND    TO TRUE                        14800000
P28545*            IF UPCPLS-MEITGP-NBR NOT = ZEROES                    14810000
P28545*              PERFORM 8600-GET-GROUP-PRICE                       14820000
P28545*              ADD 1 TO PV-GROUP-PRICE-COUNT                      14830000
P28545*            END-IF                                               14840000
P28545*            MOVE UPCPLS-UNT-RTL-AMT      TO PV-UNT-RTL-AMT-HOLD  14850000
P28545*            MOVE UPCPLS-UPC-STAT-CHG-DTE TO PV-UPC-STAT-CHG-DTE  14860000
P28545*            MOVE UPCPLS-UNT-RTL-CHG-DTE  TO PV-UNT-RTL-CHG-DTE   14870000
P28545*          WHEN SQLCODE = -904                                    14880000
P28545*          WHEN SQLCODE = -911                                    14890000
P28545*          WHEN SQLCODE = +100                                    14900000
P28545*            CONTINUE                                             14910000
P28545*          WHEN OTHER                                             14920000
P28545*                DISPLAY '***PARAGRAPH - 8500-GET-PRICE ***'      14930000
P28545*                DISPLAY ' STORE  :     ' TFRD053-TO-LOC-NBR      14940000
P28545*                DISPLAY ' TFR DOC: ' TFRD053-DOC-FROM-LOC-NBR    14950000
P28545*                ' ' TFRD053-DOC-SEQ-NBR                          14960000
P28545*                DISPLAY ' SKU    :     ' TFRD053-SKU-NBR         14970000
P28545*                DISPLAY ' UPC-ID: ' UPCPLS-UPC-ID                14980000
P28545*                        ' EFF TIMESTAMP: ' UPCPLS-EFF-BEG-TMST   14990000
P28545*                PERFORM 9900-SQL-ERROR                           15000000
P28545*        END-EVALUATE                                             15010000
P28545*    END-PERFORM.                                                 15020000
P28545*                                                                 15030000
P28545*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          15040000
P28545*        DISPLAY '*** MAX RETRIES - 8500-GET-PRICE ***'           15050000
P28545*        DISPLAY ' STORE  :     ' TFRD053-TO-LOC-NBR              15060000
P28545*        DISPLAY ' TFR DOC: ' TFRD053-DOC-FROM-LOC-NBR            15070000
P28545*                ' ' TFRD053-DOC-SEQ-NBR                          15080000
P28545*        DISPLAY ' SKU    :     ' TFRD053-SKU-NBR                 15090000
P28545*        DISPLAY ' UPC-ID: ' UPCPLS-UPC-ID                        15100000
P28545*                ' EFF TIMESTAMP: ' UPCPLS-EFF-BEG-TMST           15110000
P28545*        PERFORM 9900-SQL-ERROR                                   15120000
P28545*    END-IF.                                                      15130000
P28545*                                                                 15140000
      ******************************************************************15150000
      * 8600-GET-GROUP-PRICE.                                           15160000
      ******************************************************************15170000
P28545*8600-GET-GROUP-PRICE.                                            15180000
P28545*                                                                 15190000
P28545*    PERFORM                                                      15200000
P28545*        WITH TEST AFTER                                          15210000
P28545*        VARYING PV-RETRY-COUNT FROM 1 BY 1                       15220000
P28545*        UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  15230000
P28545*            OR (SQLCODE = 0)                                     15240000
P28545*            OR (SQLCODE = +100)                                  15250000
P28545*                                                                 15260000
P28545*        EXEC SQL                                                 15270000
P28545*            SELECT  MITGPL_QTY                                   15280000
P28545*                   ,GP_AMT                                       15290000
P28545*            INTO    :MITGPL-MITGPL-QTY                           15300000
P28545*                   ,:MITGPL-GP-AMT                               15310000
P28545*            FROM   TMITGPL                                       15320000
P28545*            WHERE  OPERCO_NBR    = :PC-OPERCO-NBR                15330000
P28545*              AND  MEITGP_NBR    = :UPCPLS-MEITGP-NBR            15340000
P28545*              AND  ADLOC_ID      = '   '                         15350000
P28545*              AND  (CURRENT DATE BETWEEN BEG_DTE AND END_DTE)    15360000
P28545*            WITH UR                                              15370000
P28545*        END-EXEC                                                 15380000
P28545*                                                                 15390000
P28545*        EVALUATE TRUE                                            15400000
P28545*            WHEN SQLCODE = 0                                     15410000
P28545*                 COMPUTE UPCPLS-UNT-RTL-AMT ROUNDED =            15420000
P28545*                       (MITGPL-GP-AMT /                          15430000
P28545*                        MITGPL-MITGPL-QTY )                      15440000
P28545*            WHEN SQLCODE = -904                                  15450000
P28545*            WHEN SQLCODE = -911                                  15460000
P28545*            WHEN SQLCODE = +100                                  15470000
P28545*                CONTINUE                                         15480000
P28545*            WHEN OTHER                                           15490000
P28545*                DISPLAY '***PARAGRAPH - 8600-GET-GROUP-PRICE ***'15500000
P28545*                DISPLAY ' STORE  :     ' TFRD053-TO-LOC-NBR      15510000
P28545*                DISPLAY ' TFR DOC: ' TFRD053-DOC-FROM-LOC-NBR    15520000
P28545*                ' ' TFRD053-DOC-SEQ-NBR                          15530000
P28545*                DISPLAY ' SKU    :     ' TFRD053-SKU-NBR         15540000
P28545*                DISPLAY ' UPC-ID: ' UPCPLS-UPC-ID                15550000
P28545*                        ' STORE:  ' UPCPLS-STR-NBR               15560000
P28545*                        ' GROUP PRICE ID: ' UPCPLS-MEITGP-NBR    15570000
P28545*                PERFORM 9900-SQL-ERROR                           15580000
P28545*        END-EVALUATE                                             15590000
P28545*    END-PERFORM.                                                 15600000
P28545*                                                                 15610000
P28545*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          15620000
P28545*        DISPLAY '*** MAX RETRIES - 8600-GET-GROUP-PRICE ***'     15630000
P28545*        DISPLAY ' STORE  :     ' TFRD053-TO-LOC-NBR              15640000
P28545*        DISPLAY ' TFR DOC: ' TFRD053-DOC-FROM-LOC-NBR            15650000
P28545*                ' ' TFRD053-DOC-SEQ-NBR                          15660000
P28545*        DISPLAY ' SKU    :     ' TFRD053-SKU-NBR                 15670000
P28545*        DISPLAY ' UPC-ID: ' UPCPLS-UPC-ID                        15680000
P28545*                ' STORE:  ' UPCPLS-STR-NBR                       15690000
P28545*                ' GROUP PRICE ID: ' UPCPLS-MEITGP-NBR            15700000
P28545*        PERFORM 9900-SQL-ERROR                                   15710000
P28545*    END-IF.                                                      15720000
P28545*                                                                 15730000
      ***************************************************************** 15740000
      * 8700-UPDATE-TINVPAR.                                            15750000
      *    UPDATE THE INVENTORY PARAMETER DATABASE FOR EACH STORE       15760000
      * FOR TRANSFER SHEETS IF WE HAVE WRITTEN TRANSFER SHEETS TO       15770000
      * TINENTY.....                                                    15780000
      ***************************************************************** 15790000
       8700-UPDATE-TINVPAR.                                             15800000
                                                                        15810000
           IF PV-STR-QTY-COUNT NOT EQUAL ZEROS     OR                   15820000
              PV-STR-RTL-AMT-COUNT NOT EQUAL ZEROS                      15830000
                                                                        15840000
             MOVE PV-STR-NBR-SAVE  TO INVPAR-LOC-NBR                    15850000
P28545       MOVE PV-INV-ID-SAVE   TO INVPAR-INV-ID                     15860000
             MOVE 'Y'              TO INVPAR-SHEET-INV-REQR-IND         15870000
                                                                        15880000
             PERFORM                                                    15890000
               WITH TEST AFTER                                          15900000
               VARYING PV-RETRY-COUNT                                   15910000
               FROM 1 BY 1                                              15920000
               UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES                   15930000
                         OR SQLCODE = 0 OR +100)                        15940000
                                                                        15950000
               EXEC SQL                                                 15960000
                   UPDATE TINVPAR                                       15970000
                   SET SHEET_INV_REQR_IND = :INVPAR-SHEET-INV-REQR-IND  15980000
                   WHERE LOC_NBR = :INVPAR-LOC-NBR                      15990000
P28545               AND INV_ID = :INVPAR-INV-ID                        16000000
                     AND ACTL_FIN_BK_DTE = '9999-09-09'                 16010000
               END-EXEC                                                 16020000
                                                                        16030000
               EVALUATE TRUE                                            16040000
                   WHEN SQLCODE = -904                                  16050000
                   WHEN SQLCODE = -914                                  16060000
                   WHEN SQLCODE = 0                                     16070000
                   WHEN SQLCODE = +100                                  16080000
                       CONTINUE                                         16090000
                   WHEN SQLWARN NOT = SPACES                            16100000
                   WHEN SQLCODE NOT = ZERO                              16110000
                     DISPLAY '***PARAGRAPH - 8700-UPDATE-TINVPAR ***'   16120000
                     DISPLAY '*** MAX RETRIES - 8700-UPDATE',           16130000
                                '-TINVPAR ***'                          16140000
                     DISPLAY ' SKU  : ' PV-SKU-NBR-SAVE                 16150000
                                ' STORE:  ' PV-STR-NBR-SAVE             16160000
P28545                          ' INVID:  ' PV-INV-ID-SAVE              16170000
                     PERFORM 9900-SQL-ERROR                             16180000
               END-EVALUATE                                             16190000
             END-PERFORM                                                16200000
                                                                        16210000
             IF PV-RETRY-COUNT > PC-MAX-RETRIES                         16220000
                 DISPLAY '*** MAX RETRIES - 8700-UPDATE-TINVPAR ***'    16230000
                 DISPLAY ' SKU  : ' PV-SKU-NBR-SAVE                     16240000
                         ' STORE:  ' PV-STR-NBR-SAVE                    16250000
P28545                   ' INVID:  ' PV-INV-ID-SAVE                     16251000
                 PERFORM 9900-SQL-ERROR                                 16252000
             END-IF                                                     16253000
                                                                        16254000
           END-IF.                                                      16255000
                                                                        16256000
      ***************************************************************   16257000
      * 8800-GET-LOCATION-INFO.                                         16258000
      ***************************************************************   16259000
       8800-GET-LOCATION-INFO.                                          16260000
                                                                        16270000
           INITIALIZE DCLXMT00001.                                      16280000
           MOVE TFRD053-TO-LOC-NBR  TO XMT00001-LOC-NBR                 16290000
                                       HL2-LOC-NBR.                     16300000
                                                                        16310000
           EXEC SQL                                                     16320000
               SELECT LOC_NM                                            16330000
004819               ,LOC_TYP_CDE                                       16340004
               INTO :XMT00001-LOC-NM                                    16350000
004819             ,:XMT00001-LOC-TYP-CDE                               16360004
               FROM XMT_LOC                                             16370000
               WHERE LOC_NBR = :XMT00001-LOC-NBR                        16380000
               WITH UR                                                  16390000
           END-EXEC.                                                    16400000
                                                                        16410000
           EVALUATE TRUE                                                16420000
               WHEN SQLCODE = +0                                        16430000
                   MOVE XMT00001-LOC-NM  TO HL2-LOC-DESCRIPTION         16440000
004819             MOVE XMT00001-LOC-TYP-CDE TO PV-LOC-TYP-CDE          16450004
               WHEN OTHER                                               16470000
                   MOVE SPACES           TO HL2-LOC-DESCRIPTION         16480000
004819                                      PV-LOC-TYP-CDE              16490004
           END-EVALUATE.                                                16500000
                                                                        16510000
D28545******************************************************************16520000
D28545* 8900-GET-MBS-STRUCTURE.                                         16530000
D28545******************************************************************16540000
D28545*8900-GET-MBS-STRUCTURE.                                          16550000
D28545*                                                                 16560000
D28545*    SET PS-PRICE-NOT-FOUND  TO TRUE.                             16570000
D28545*                                                                 16580000
D28545*    PERFORM                                                      16590000
D28545*      WITH TEST AFTER                                            16600000
D28545*      VARYING PV-RETRY-COUNT FROM 1 BY 1                         16610000
D28545*      UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES                     16620000
D28545*             OR SQLCODE = 0 OR +100)                             16630000
D28545*                                                                 16640000
D28545*        MOVE ZEROS             TO PV-COUNT                       16650000
D28545*                                                                 16660000
D28545*        MOVE PC-OPERCO-NBR     TO MDSEAR-OPERCO-NBR              16670000
D28545*        MOVE PC-MDSELV-CDE     TO MDSEAR-MDSELV-CDE              16680000
D28545*        MOVE PC-APLSYS-CDE     TO APLAVL-APLSYS-CDE              16690000
D28545*                                                                 16700000
D28545*        MOVE PV-EDIT-SKU-NBR-DPT TO MDSEAR-DEPT-NBR              16710000
D28545*        MOVE PV-EDIT-SKU-NBR-CLS TO PV-MAJ-CL-NBR                16720000
D28545*                                    PV-SUB-CL-NBR-2-3            16730000
D28545*        MOVE '0'               TO PV-MAJ-CL-NBR-2                16740000
D28545*                                  PV-SUB-CL-NBR-1                16750000
D28545*        MOVE PV-SUB-CL-NBR     TO MDSEAR-SUB-CL-NBR              16760000
D28545*        MOVE PV-MAJ-CL-NBR     TO MDSEAR-MAJ-CL-NBR              16770000
D28545*                                                                 16780000
D28545*        EXEC SQL                                                 16790000
D28545*           SELECT 1                                              16800000
D28545*           INTO :PV-COUNT                                        16810000
D28545*           FROM   TMDSEAR A,                                     16820000
D28545*                  TAPLAVL B                                      16830000
D28545*           WHERE  (A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR)   AND     16840000
D28545*                  (A.DEPT_NBR    = :MDSEAR-DEPT-NBR)     AND     16850000
D28545*                  (A.MAJ_CL_NBR  = :MDSEAR-MAJ-CL-NBR)   AND     16860000
D28545*                  (A.SUB_CL_NBR  = :MDSEAR-SUB-CL-NBR)   AND     16870000
D28545*                  (A.MDSEAR_DKEY = B.MDSEAR_DKEY)        AND     16880000
D28545*                  (MDSELV_CDE    = :MDSEAR-MDSELV-CDE)   AND     16890000
D28545*                  (APLSYS_CDE    = :APLAVL-APLSYS-CDE)   AND     16900000
D28545*                  (DATE(CURRENT_TIMESTAMP) BETWEEN               16910000
D28545*                                     STRT_DTE AND END_DTE) AND   16920000
D28545*                  (DATE(CURRENT_TIMESTAMP) BETWEEN               16930000
D28545*                      MDSEAR_STRT_DTE AND MDSEAR_END_DTE)        16940000
D28545*           WITH UR                                               16950000
D28545*        END-EXEC                                                 16960000
D28545*                                                                 16970000
D28545*        EVALUATE TRUE                                            16980000
D28545*          WHEN SQLCODE = 0                                       16990000
D28545*            IF PV-COUNT IS GREATER THAN ZEROS                    17000000
D28545*                SET PS-PRICE-FOUND    TO TRUE                    17010000
D28545*            END-IF                                               17020000
D28545*          WHEN SQLCODE = +100                                    17030000
D28545*          WHEN SQLCODE = -904                                    17040000
D28545*          WHEN SQLCODE = -911                                    17050000
D28545*              CONTINUE                                           17060000
D28545*          WHEN OTHER                                             17070000
D28545*            MOVE '8900-GET-MBS-STRUCTURE' TO PV-PARAGRAPH-NAME   17080000
D28545*            DISPLAY ' STORE  :     ' TFRD053-TO-LOC-NBR          17090000
D28545*            DISPLAY ' TFR DOC: ' TFRD053-DOC-FROM-LOC-NBR        17100000
D28545*                    ' ' TFRD053-DOC-SEQ-NBR                      17110000
D28545*            DISPLAY ' SKU    :     ' TFRD053-SKU-NBR             17120000
D28545*            DISPLAY ' UPC-ID: ' UPCPLS-UPC-ID                    17130000
D28545*                    ' STORE:  ' UPCPLS-STR-NBR                   17140000
D28545*            DISPLAY ' SQLCODE:     ' SQLCODE                     17150000
D28545*            PERFORM 9900-SQL-ERROR                               17160000
D28545*        END-EVALUATE                                             17170000
D28545*                                                                 17180000
D28545*    END-PERFORM.                                                 17190000
D28545*                                                                 17200000
D28545*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          17210000
D28545*        MOVE '8900-GET-MBS-STRUCTURE' TO PV-PARAGRAPH-NAME       17220000
D28545*        DISPLAY '*** MAX RETRIES - 8900-GET-MBS-STRUCTURE ***'   17230000
D28545*        DISPLAY ' STORE  :     ' TFRD053-TO-LOC-NBR              17240000
D28545*        DISPLAY ' TFR DOC: ' TFRD053-DOC-FROM-LOC-NBR            17250000
D28545*                ' ' TFRD053-DOC-SEQ-NBR                          17260000
D28545*        DISPLAY ' SKU    :     ' TFRD053-SKU-NBR                 17270000
D28545*        DISPLAY ' UPC-ID: ' UPCPLS-UPC-ID                        17280000
D28545*                ' STORE:  ' UPCPLS-STR-NBR                       17290000
D28545*        PERFORM 9900-SQL-ERROR                                   17300000
D28545*    END-IF.                                                      17310000
D28545*                                                                 17320000
      /*****************************************************************17330000
      * 9000-END-OF-JOB-TASKS.                                          17340000
      ******************************************************************17350000
       9000-END-OF-JOB-TASKS.                                           17360000
                                                                        17370000
      *** THE FINAL COMMIT...                                           17380000
           PERFORM 7800-COMMIT-PROCESSING                               17390000
                                                                        17400000
           MOVE '0' TO TCKRSTCNTL-CKPT-STAT-CODE.                       17410000
           PERFORM 7900-UPDATE-CHECKPOINT-STATUS.                       17420000
                                                                        17430000
      *** STORE TOTALS.....                                             17440000
974649*    IF PV-TOT-QTY-COUNT IS EQUAL TO ZEROS     AND                17450000
974649*       PV-TOT-RTL-AMT-COUNT IS EQUAL TO ZEROS                    17460000
974649     IF PV-RECORDS-ACCEPTED IS EQUAL TO ZEROS                     17470000
               MOVE ZEROS  TO TFRD053-TO-LOC-NBR                        17480000
               PERFORM 5400-NOTHING-TO-REPORT                           17490000
           ELSE                                                         17500000
               PERFORM 5100-FORMAT-TRANSFER-TOTALS                      17510000
               PERFORM 5200-FORMAT-STORE-TOTALS                         17520000
               PERFORM 8700-UPDATE-TINVPAR                              17530000
               MOVE ZEROS  TO TFRD053-TO-LOC-NBR                        17540000
               PERFORM 5300-FORMAT-GRAND-TOTALS                         17550000
           END-IF.                                                      17560000
                                                                        17570000
      *** FINAL TOTALS.....                                             17580000
           DISPLAY '***********************'.                           17590000
           DISPLAY '* ' PC-PROGRAM-NAME ' SUMMARY    *'.                17600000
           DISPLAY '***********************'.                           17610000
           DISPLAY ' '.                                                 17620000
           DISPLAY ' RECORDS READ:       ' PV-RECORDS-READ.             17630000
           DISPLAY '   NO UNIT COUNT:      ' PV-NO-UNIT-COUNT.          17640000
           DISPLAY '   NO PRICE COUNT:     ' PV-NO-PRICE-COUNT.         17650000
           DISPLAY '   NO UPC NBR COUNT:   ' PV-NO-UPC-NBR-COUNT.       17660000
           DISPLAY ' RECORDS ACCEPTED:   ' PV-RECORDS-ACCEPTED.         17670000
           DISPLAY '   CLEARANCE COUNT:    ' PV-CLEARANCE-COUNT.        17680000
           DISPLAY '   TFR PRICE COUNT:    ' PV-RED-COUNT.              17690000
           DISPLAY '   GROUP PRICE COUNT:  ' PV-GROUP-PRICE-COUNT.      17700000
           DISPLAY ' '.                                                 17710000
           DISPLAY '***********************'.                           17720000
           DISPLAY '*** TABLE COMMIT STATISTICS      ***'.              17730000
           DISPLAY '                                             '.     17740000
           DISPLAY 'INPUT EXTRACT RECORDS READ ' PA-EXTRACT-RECS-READ.  17750000
           DISPLAY '  ROWS UPDATED   ', PA-UPDATE-COUNT.                17760000
           DISPLAY '  ROWS INSERTED  ', PA-INSERT-COUNT.                17770000
           DISPLAY '  DROP(S)        ', PA-ZERO-REC-DROPPED.            17780000
           DISPLAY '  DUPLICATE(S)   ', PA-DUPLICATE-REC.               17790000
           DISPLAY '                                             '.     17800000
           DISPLAY '  COMMITS TAKEN  ', PA-COMMIT-COUNT.                17810000
           DISPLAY '                                             '.     17820000
           DISPLAY '***********************'.                           17830000
                                                                        17840000
           CLOSE TRANSFER-DATA-FILE                                     17850000
                 TRANSFER-DATA-ERROR-FILE                               17860000
W33304           TRANSFER-INPUT-ERROR-FILE                                      
                 TRANSFER-REPORT.                                       17870000
                                                                        17880000
      ******************************************************************17890000
      * 9900-SQL-ERROR.                                                 17900000
      ******************************************************************17910000
       9900-SQL-ERROR.                                                  17920000
                                                                        17930000
           SET ABEND-4013            TO TRUE.                           17940000
           DISPLAY '**  ABEND     **'.                                  17950000
           DISPLAY '**  PROGRAM   **  =  ' PC-PROGRAM-NAME              17960000
           DISPLAY '**  OPERATION **  = '  PV-OPER-ATTEMPTED            17970000
                                                                        17980000
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         17990000
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        18000000
                                                                        18010000
           COPY DPPD004.                                                18020000
                                                                        18030000
           PERFORM 9990-ABEND.                                          18040000
                                                                        18050000
       9990-ABEND.                                                      18060000
                                                                        18070000
           DISPLAY '**  PROGRAM   ** => ' PC-PROGRAM-NAME.              18080000
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            18090000
           CALL 'ILBOABN0'  USING ABEND-CODE.                           18100000
                                                                        18110000
P28545******************************************************************18120000
P28545*  PRICING MODULE.                                                18130000
P28545******************************************************************18140000
P28545     COPY INPD400.                                                18150000
P28545                                                                  18160000
