      ******************************************************************00010000
       IDENTIFICATION DIVISION.                                         00020000
      ******************************************************************00030000
      *                                                                 00040000
       PROGRAM-ID.   PXKUT087.                                          00050000
       AUTHOR.       RICH KELLEN.                                       00060000
       INSTALLATION. KOHLS DEPARTMENT STORES.                           00070000
       DATE-WRITTEN. APRIL 2007.                                        00080000
       DATE-COMPILED.                                                   00090000
      *                                                                 00100000
      ***************************************************************** 00110000
      * WR30069 - MOS ML/FS UOW EVENT FILE MERGE.                     * 00120017
      * THIS PROGRAM MERGES A FILE OF MOS EVENT DATA WITH A FILE OF   * 00121017
      * STORE UNIT OF WORK DATA INTO A MERGED FILE USED BY JOB PXK088.* 00122017
      * WHEN THERE IS EVENT DATA RECORDS WITH NO MATCHING UNIT OF WORK* 00123017
      * DATA, THE EVENT DATA IS PUT ON THE MERGED FILE RECORD AND THE * 00124017
      * EVENT DATA IS LEFT BLANK, OR ZERO FOR NUMERIC DATA. FOR UNIT  * 00125017
      * OF WORK RECORDS FOR WHICH THERE IS NO MATCHING EVENT DATA, THE* 00126017
      * UNIT OF WORK DATA IS PUT ON THE MERGED RECORD AND WRITTEN AND * 00127017
      * A RECORD IS WRITTEN ON A REPORT TO TRACK THIS SITUATION AS    * 00128017
      * THIS CONDITION SHOULD NOT HAPPEN.                             * 00129017
      *                                                               * 00129117
      ***************************************************************** 00130000
      ******************** HISTORY OF CHANGES **************************00140000
      * CHG ID/                                                        *00150000
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *00160000
      * -------  ----------  ----------------------------------------  *00170000
      * WR30069  07/31/2007  INITIAL IMPLEMENTATION                    *00180013
      ******************************************************************00190000
      ******************************************************************00200000
       ENVIRONMENT DIVISION.                                            00210000
      ******************************************************************00220000
      *                                                                 00230000
       CONFIGURATION SECTION.                                           00240000
       SOURCE-COMPUTER.   IBM-3090.                                     00250000
       OBJECT-COMPUTER.   IBM-3090.                                     00260000
      *                                                                 00270000
       INPUT-OUTPUT SECTION.                                            00280000
       FILE-CONTROL.                                                    00290000
           SELECT UOW-FILE                                              00300001
               ASSIGN                       TO INP01.                   00310000
      *                                                                 00320000
           SELECT EVENT-FILE                                            00330000
               ASSIGN                       TO INP02.                   00340000
      *                                                                 00350000
            SELECT MERGE-FILE                                           00360000
              ASSIGN                        TO OUT01.                   00370000
      *                                                                 00371026
            SELECT COMPL-FILE                                           00372026
              ASSIGN                        TO OUT02.                   00373026
      *                                                                 00380003
            SELECT REPORT-FILE                                          00390005
              ASSIGN                        TO RPT01.                   00400005
                                                                        00410000
      ******************************************************************00420000
       DATA DIVISION.                                                   00430000
      ******************************************************************00440000
      *                                                                 00450000
       FILE SECTION.                                                    00460000
       FD  UOW-FILE                                                     00470001
           RECORDING MODE F                                             00480000
           BLOCK CONTAINS 0 RECORDS                                     00490000
           RECORD CONTAINS 140 CHARACTERS                               00500012
           LABEL RECORDS ARE STANDARD                                   00510000
           DATA RECORD IS UOW-RECORD.                                   00520001
       01  UOW-RECORD                             PIC X(140).           00530012
      *                                                                 00540000
       FD EVENT-FILE                                                    00550000
           RECORDING MODE IS F                                          00560000
           BLOCK CONTAINS 0 RECORDS                                     00570000
           RECORD CONTAINS 043 CHARACTERS                               00580021
           DATA RECORD IS EVENT-RECORD.                                 00590001
                                                                        00600000
       01 EVENT-RECORD                            PIC X(043).           00610021
      *                                                                 00620000
       FD MERGE-FILE                                                    00630000
           RECORDING MODE IS F                                          00640000
           BLOCK CONTAINS 0 RECORDS                                     00650000
           RECORD CONTAINS 118 CHARACTERS                               00660010
           DATA RECORD IS MERGE-RECORD.                                 00670001
                                                                        00680000
       01 MERGE-RECORD                           PIC X(118).            00690010
      *                                                                 00691026
       FD COMPL-FILE                                                    00692026
           RECORDING MODE IS F                                          00693026
           BLOCK CONTAINS 0 RECORDS                                     00694026
           RECORD CONTAINS 034 CHARACTERS                               00695026
           DATA RECORD IS COMPL-RECORD.                                 00696026
                                                                        00697026
       01 COMPL-RECORD                           PIC X(034).            00698026
      *                                                                 00700003
       FD REPORT-FILE                                                   00710005
           RECORDING MODE IS F                                          00720005
           BLOCK CONTAINS 0 RECORDS                                     00730005
           DATA RECORD IS REPORT-RECORD.                                00740005
      *                                                                 00750005
       01 REPORT-RECORD                          PIC X(132).            00760005
      *                                                                 00770000
       WORKING-STORAGE SECTION.                                         00780000
                                                                        00820000
       01 ABEND-CODE                      PIC S9(04)    VALUE ZERO      00830000
                                                        COMP SYNC.      00840000
           88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 00850000
           88  ABEND-4002-READ-ERROR                       VALUE +4002. 00860000
           88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 00870000
           88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 00880000
           88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 00890000
           88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 00900000
           88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 00910000
           88  ABEND-4008-DATS-ERROR                       VALUE +4008. 00920000
           88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009. 00930000
           88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00940000
      *                                                                 00950000
       01 SD-SYSTEM-DATE.                                               00960000
          05  SD-SYSTEM-YEAR              PIC  9(02)  VALUE ZEROS.      00970000
          05  SD-SYSTEM-MONTH             PIC  9(02)  VALUE ZEROS.      00980000
          05  SD-SYSTEM-DAY               PIC  9(02)  VALUE ZEROS.      00990000
                                                                        01000000
       01 ST-SYSTEM-TIME.                                               01010000
          05  ST-SYSTEM-HOUR              PIC  9(02)  VALUE ZEROS.      01020000
          05  ST-SYSTEM-MINUTE            PIC  9(02)  VALUE ZEROS.      01030000
      *                                                                 01040000
       01 SA-SAVE-AREAS.                                                01050000
          05  SA-OUT-RECORD               PIC X(201)   VALUE SPACES.    01060000
          05  SA-PAGE-COUNT               PIC 9(05)    VALUE ZEROS.     01070000
          05  SA-CURRENT-DATE             PIC  X(10)  VALUE SPACES.     01080000
          05  SA-CURR-DATE REDEFINES SA-CURRENT-DATE.                   01090000
              10 SA-CURR-CENTURY          PIC  X(02).                   01100000
              10 SA-CURR-YEAR             PIC  X(02).                   01110000
              10 FILLER                   PIC  X(01).                   01120000
              10 SA-CURR-MONTH            PIC  X(02).                   01130000
              10 FILLER                   PIC  X(01).                   01140000
              10 SA-CURR-DAY              PIC  X(02).                   01150000
          05  SA-CURRENT-TIME             PIC  X(08)  VALUE SPACES.     01160000
          05  SA-CURR-TIME REDEFINES SA-CURRENT-TIME.                   01170000
              10 SA-CURR-HOUR             PIC  X(02).                   01180000
              10 FILLER                   PIC  X(01).                   01190000
              10 SA-CURR-MINUTE           PIC  X(02).                   01200000
              10 FILLER                   PIC  X(01).                   01210000
              10 SA-CURR-SECOND           PIC  X(02).                   01220000
      *                                                                 01230000
       01 PC-PROGRAM-CONSTANTS.                                         01240000
          05  PC-PXKUT087                 PIC X(10)      VALUE          01250004
              'PXKUT087  '.                                             01260004
           05  PC-CURRENT-PROGRAM-NAME    PIC X(08)                     01270004
               VALUE 'PXKUT087'.                                        01280004
          05  PC-ADV-PAGE-SYMBOL          PIC X      VALUE '1'.         01290000
          05  PC-TYPE-CDE                 PIC X(02)  VALUE '01'.        01300000
          05  PC-PROGRAM-NAME             PIC X(08)  VALUE              01310000
              'PXKUT087'.                                               01320000
          05  PC-YES                      PIC X(1)   VALUE 'Y'.         01330000
          05  PC-NO                       PIC X(1)   VALUE 'N'.         01340000
          05  PC-MAX-ROLLUP-TBL-ENTRIES   PIC S9(04) VALUE +300         01350000
                                                     COMP-3.            01360000
          05  PC-MAX-OPN-STORES           PIC S9(04) VALUE +1500        01390000
                                                     COMP-3.            01400000
          05  PC-MAX-PAGE-LINES           PIC S9(03) VALUE +60          01410000
                                                     COMP-3.            01420000
          05  PC-MAX-RETRY-CNT            PIC S9(04) VALUE 3            01430000
                                                     COMP SYNC.         01440000
          05  PC-MORE-THAN-MAX-RETRY      PIC S9(04) VALUE 4            01450000
                                                     COMP SYNC.         01460000
          05  PC-REPORT-LINE-COUNTER          PIC 9(03) VALUE 100.      01470006
          05  PC-PAGE-COUNTER                 PIC 9(03) VALUE ZEROS.    01480004
      *                                                                 01490000
       01 PV-PROGRAM-VARIABLES.                                         01500000
          05  PV-DATE-IN                  PIC X(10)    VALUE SPACE.     01510000
          05  PV-SQLCODE                  PIC +9(04).                   01520003
          05  PV-RECORDS-BYPASSED         PIC  9(09) VALUE ZERO.        01530000
          05  PV-OPERATION-MSG            PIC X(60)  VALUE SPACES.      01540000
          05  PV-CURS-CNT                 PIC 9(7)   VALUE ZERO.        01550000
          05  PV-WRITE-CNT                PIC 9(7)   VALUE ZERO         01560000
                                                     COMP-3.            01570000
          05  PV-READ-CNT                 PIC 9(7)      VALUE ZERO      01580000
                                                        COMP-3.         01590000
          05  PV-RETRY-CNT                PIC S9(04)    VALUE +0        01600000
                                                        COMP SYNC.      01610000
          05  PV-NBR-OF-UOW-RECS          PIC  9(09)    VALUE  0.       01620005
          05  PV-NBR-OF-EVENT-RECS        PIC  9(09)    VALUE  0.       01630005
          05  PV-NBR-OF-MERGE-RECS        PIC  9(09)    VALUE  0.       01640005
          05  PV-NBR-OF-COMPL-RECS        PIC  9(09)    VALUE  0.       01641026
          05  PV-CURRENT-DATE             PIC X(08)     VALUE SPACE.    01650000
          05  PV-CURRENT-DATE-RED REDEFINES PV-CURRENT-DATE.            01660000
            10  PV-CURRENT-DATE-RED-CC     PIC 99.                      01670000
            10  PV-CURRENT-DATE-RED-YYMMDD PIC 9(6).                    01680000
          05  PV-DATE-6-MONTHS.                                         01690000
            10  PV-DATE-6-MONTHS-CC        PIC 9(02).                   01700000
            10  PV-DATE-6-MONTHS-YYMMDD    PIC 9(06).                   01710000
          05  PV-DATE-6-MONTHS-RED REDEFINES PV-DATE-6-MONTHS           01720000
                                           PIC 9(8).                    01730000
          05  PV-SCND-UNT-QTY             PIC 9(8).99.                  01731026
          05  PV-DATE-6-MONTHS-CHECK       PIC S9(07)V   COMP-3.        01740000
          05  PV-FIRST-DAY-OF-WEEK        PIC X(10)    VALUE SPACE.     01940002
          05  PV-DATE-FIRST-DAY-1-YEAR    PIC X(10)    VALUE SPACE.     01950002
          05  PV-DATE-LAST-DAY-1-YEAR     PIC X(10)    VALUE SPACE.     01960002
          05  PV-LAST-DAY-OF-WEEK         PIC X(10)    VALUE SPACE.     01970002
          05  PV-FISCAL-WEEK-TY           PIC 9(02)    VALUE ZERO.      01980002
          05  PV-FISCAL-WEEK-LY           PIC 9(02)    VALUE ZERO.      01990002
          05  PV-FISCAL-YEAR-TY           PIC 9(04)    VALUE ZERO.      02000002
          05  PV-FISCAL-YEAR-LY           PIC 9(04)    VALUE ZERO.      02010002
          05  PV-CURRENT-DATE-YYMMDD-SQL  PIC S9(07)V   COMP-3.         02020000
          05  PV-CALL-DEPT         PIC X(03)      VALUE SPACES.         02030000
          05  PV-CALL-MANAGER      PIC X(02)      VALUE SPACES.         02040000
          05  PV-ABEND-CODE        PIC S9(04)     VALUE +0              02080000
                                                  COMP SYNC.            02090000
          05  PV-PARA-NAME         PIC X(35).                           02100000
          05  PV-PAGE-CNT          PIC S9(05)     VALUE ZERO.           02140000
                                                                        02190000
      *                                                                 02310000
          05  PV-DB2-OUT-DATE          PIC X(10)      VALUE SPACES.     02320000
          05  PV-CURRENT-WEEKDAY       PIC X(09)      VALUE SPACES.     02330000
          05  PV-DECREMENT-1ST         PIC 9(02)      VALUE ZERO.       02340000
      *                                                                 02380000
       01 PS-PROGRAM-SWITCHES.                                          02390000
          05  END-OF-UOW-FILE-SW       PIC X(1)    VALUE 'N'.           02400001
              88  PS-END-OF-UOW-FILE               VALUE 'Y'.           02410001
              88  PS-NOT-END-OF-UOW-FILE           VALUE 'N'.           02420001
          05  END-OF-EVENT-FILE-SW     PIC X(1)    VALUE 'N'.           02430000
              88  PS-END-OF-EVENT-FILE             VALUE 'Y'.           02440000
              88  PS-NOT-END-OF-EVENT-FILE         VALUE 'N'.           02450000
          05  PS-END-OF-CTL-FILE-SW    PIC X(1)    VALUE 'N'.           02460000
              88  PS-END-OF-CTL-FILE               VALUE 'Y'.           02470000
      *                                                                 02480000
      ******************************************************************02490004
      **TIMESTAMP VARIABLES                                             02500004
      ******************************************************************02510004
       01 DF-DATE-TIME-FIELDS.                                          02520004
          05 DF-ACCEPT-DATE.                                            02530004
             10  DF-ACCEPT-YR                  PIC 9(02) VALUE ZEROS.   02540004
             10  DF-ACCEPT-MO                  PIC 9(02) VALUE ZEROS.   02550004
             10  DF-ACCEPT-DY                  PIC 9(02) VALUE ZEROS.   02560004
          05 DF-ACCEPT-TIME.                                            02570004
             10  DF-ACCEPT-HR                  PIC 9(02) VALUE ZEROS.   02580004
             10  DF-ACCEPT-MN                  PIC 9(02) VALUE ZEROS.   02590004
             10  DF-ACCEPT-SS                  PIC 9(04) VALUE ZEROS.   02600004
          05 DF-FORMAT-DATE.                                            02610004
             10  DF-FORMAT-DATE-MM             PIC 9(02) VALUE ZEROS.   02620004
             10  FILLER                        PIC X(01) VALUE '/'.     02630004
             10  DF-FORMAT-DATE-DD             PIC 9(02) VALUE ZEROS.   02640004
             10  FILLER                        PIC X(01) VALUE '/'.     02650004
             10  DF-FORMAT-DATE-YY             PIC 9(02) VALUE ZEROS.   02660004
      ******************************************************************02670000
      * DB2 ERROR MESSAGES FORMAT AREA.                                 02680000
      ******************************************************************02690000
           COPY DPWS004.                                                02700000
                                                                        02710000
      ******************************************************************02720000
      * CALENDAR ROUTINE WORK AREA.                                     02730000
      ******************************************************************02740000
           COPY DPWS500.                                                02750000
      *                                                                 02760000
      ******************************************************************02770000
      * COPY MEMBER FOR THE MOS UNIT OF WORK FILE                       02780000
      ******************************************************************02790000
      *                                                                 02800000
           COPY PXRD087.                                                02810000
      *                                                                 02820000
      ******************************************************************02830000
      * COPY MEMBER FOR THE MOS EVENT FILE                              02840000
      ******************************************************************02850000
      *                                                                 02860000
           COPY PXRD083.                                                02870000
      ******************************************************************02880001
      * COPY MEMBER FOR THE MERGED MOS UOW/EVENT FILE                   02890001
      ******************************************************************02900001
      *                                                                 02910001
           COPY PXRD088.                                                02920001
      ******************************************************************02921026
      * COPY MEMBER FOR THE UPDATE OF THE COMPLIANCE ORACLE TABLE       02922026
      ******************************************************************02923026
      *                                                                 02924026
           COPY PXRD097.                                                02925026
      ******************************************************            02930004
      ** STANDARD HEADER LINE - KOHLS 132 COL                           02940004
      ******************************************************            02950004
           COPY DPWS132.                                                02960004
      ******************************************************            02970005
      ** STANDARD HEADER LINE - KOHLS 132 COL                           02980005
      ******************************************************            02990005
           COPY DPWS132O.                                               03000005
      ******************************************************************03010000
      * REPORT HEADINGS                                                 03020006
      ******************************************************************03030000
       01  HEADER-LINE1.                                                03040005
           05 FILLER                           PIC X(47)   VALUE SPACE. 03050006
           05 FILLER                           PIC X(39)   VALUE        03060006
              'MOS ML/FS INVALID UNITS OF WORK REPORT'.                 03070006
           05 FILLER                           PIC X(48)   VALUE SPACE. 03080006
                                                                        03090006
       01  HEADER-LINE2.                                                03100006
           05 HDR2-STR-NBR                     PIC X(9)    VALUE        03110006
              'STORE NBR'.                                              03120006
           05 FILLER                           PIC XX      VALUE SPACE. 03130006
           05 HDR2-SKU-NBR                     PIC X(7)    VALUE        03140006
              'SKU NBR'.                                                03150006
           05 FILLER                           PIC XXX     VALUE SPACE. 03160006
           05 HDR2-UNT-OF-WRK-DEV-ID           PIC X(20)   VALUE        03170006
              'DEVICE ID          '.                                    03180006
           05 FILLER                           PIC XX      VALUE SPACE. 03190006
           05 HDR2-ASSOC-ID                    PIC X(9)    VALUE        03200006
              'ASSOC ID'.                                               03210006
           05 FILLER                           PIC X       VALUE SPACE. 03220006
           05 HDR2-UOW-BEG-TMST                PIC X(9)    VALUE        03230006
              'BEG TMST'.                                               03240006
           05 FILLER                           PIC XX      VALUE SPACE. 03250006
           05 HDR2-UOW-TYP-CDE                 PIC X(10)   VALUE        03260006
              'TYPE CODE'.                                              03270006
           05 FILLER                           PIC XXXX    VALUE SPACE. 03280007
           05 HDR2-SCND-UNT-QTY                PIC X(09)   VALUE        03290006
              'UNIT QTY '.                                              03300006
           05 FILLER                           PIC X(10)   VALUE SPACE. 03310007
           05 HDR2-OLD-UNT-RTL-AMT             PIC X(11)   VALUE        03320006
              'OLD RTL AMT'.                                            03330006
           05 FILLER                           PIC X(8)    VALUE SPACE. 03340007
           05 HDR2-NEW-UNT-RTL-AMT             PIC X(11)   VALUE        03350007
              'NEW RTL AMT'.                                            03360006
           05 FILLER                           PIC X(42)   VALUE SPACE. 03370006
      ******************************************************************03380006
      * REPORT DETAIL                                                   03390006
      ******************************************************************03400006
       01  REPORT-LINE1.                                                03410006
           05 FILLER                           PIC X(2)     VALUE SPACE.03411007
           05 RPT-STR-NBR                      PIC Z(5)     VALUE SPACE.03420006
           05 FILLER                           PIC X(4)     VALUE SPACE.03430007
           05 RPT-SKU-NBR                      PIC X(8)     VALUE SPACE.03440006
           05 FILLER                           PIC XX       VALUE SPACE.03450006
           05 RPT-UNT-OF-WRK-DEV-ID            PIC X(20)    VALUE SPACE.03460006
           05 FILLER                           PIC XX       VALUE SPACE.03470006
           05 RPT-ASSOC-ID                     PIC X(7)     VALUE SPACE.03480006
           05 FILLER                           PIC XX       VALUE SPACE.03490006
           05 RPT-UOW-BEG-TMST                 PIC X(10)    VALUE SPACE.03500006
           05 FILLER                           PIC X(6)     VALUE SPACE.03510006
           05 RPT-UOW-TYP-CDE                  PIC X(2)     VALUE SPACE.03520006
           05 FILLER                           PIC X(4)     VALUE SPACE.03530006
           05 RPT-SCND-UNT-QTY                 PIC Z(8)9.99 VALUE ZERO. 03540006
           05 FILLER                           PIC X(8)     VALUE SPACE.03550006
           05 RPT-OLD-UNT-RTL-AMT              PIC Z(8)9.99 VALUE ZERO. 03560006
           05 FILLER                           PIC X(8)     VALUE SPACE.03570006
           05 RPT-NEW-UNT-RTL-AMT              PIC Z(8)9.99 VALUE ZERO. 03580006
           05 FILLER                           PIC X(47)   VALUE SPACE. 03590006
                                                                        04140000
                                                                        04150000
      ******************************************************************04160000
       PROCEDURE DIVISION.                                              04170000
      ******************************************************************04180000
      *                                                                 04190000
          EJECT                                                         04200000
       0000-MAINLINE-PROCESSING.                                        04210000
      ******************************************************************04220000
      * MAIN PROCESSING ROUTINE                                       * 04230000
      ******************************************************************04240000
                                                                        04250000
            PERFORM 1000-INIT.                                          04260000
            PERFORM 2000-PROCESS-FILE-MERGE                             04270000
              UNTIL PS-END-OF-UOW-FILE                                  04280001
                AND PS-END-OF-EVENT-FILE.                               04290001
                                                                        04300000
            PERFORM 9000-END-OF-JOB.                                    04310000
                                                                        04320000
            GOBACK.                                                     04330000
                                                                        04340000
      ******************************************************************04350000
      * OPEN FILES AND GET CURRENT DATE AND TIME FROM DB2.             *04360017
      ******************************************************************04370000
      *                                                                 04380000
       1000-INIT.                                                       04390000
            MOVE '*1000-INIT.              *' TO PV-PARA-NAME.          04400000
            OPEN INPUT  UOW-FILE                                        04410001
                        EVENT-FILE                                      04420001
                 OUTPUT MERGE-FILE                                      04430003
                        COMPL-FILE                                      04431026
                        REPORT-FILE.                                    04440003
      **RETRIEVE DATE FROM SYSTEM                                       04450004
           ACCEPT DF-ACCEPT-TIME FROM TIME.                             04460004
           ACCEPT DF-ACCEPT-DATE FROM DATE.                             04470004
                                                                        04480004
           MOVE DF-ACCEPT-YR          TO DF-FORMAT-DATE-YY.             04490004
           MOVE DF-ACCEPT-MO          TO DF-FORMAT-DATE-MM.             04500004
           MOVE DF-ACCEPT-DY          TO DF-FORMAT-DATE-DD.             04510004
           PERFORM 2500-HEADING-PREP.                                   04520004
                                                                        04530000
            PERFORM 8000-READ-UOW-FILE.                                 04540001
            PERFORM 8050-READ-EVENT-FILE.                               04550000
                                                                        04560000
                                                                        04570000
      ******************************************************************04760000
      * PROCESS MERGE EOW AND EVENT FILES                               04770000
      ******************************************************************04780000
       2000-PROCESS-FILE-MERGE.                                         04790000
           IF PXRD087-STR-NBR = PXRD083-STR-NBR                         04800000
             IF PXRD087-SKU-NBR = PXRD083-SKU-NBR                       04810000
               PERFORM 2200-MOVE-EVENT-FIELDS                           04820000
               PERFORM                                                  04830000
                 UNTIL PXRD087-SKU-NBR NOT = PXRD083-SKU-NBR            04840000
                   OR PXRD087-STR-NBR NOT = PXRD083-STR-NBR             04850000
                   PERFORM 2100-MOVE-UOW-FIELDS                         04860001
                   SET PXRD088-REPROCESS-NO TO TRUE                     04861022
                   PERFORM 8100-WRITE-MERGE-FILE                        04870000
                   IF PXRD087-UOW-TYP-CDE = '01'                        04880026
                     AND PXRD083-DAYS-SINCE-EVENT < 31                  04890126
                     PERFORM 2300-MOVE-COMPL-FIELDS                     04891026
                     PERFORM 8110-WRITE-COMPL-FILE                      04892028
                   END-IF                                               04893026
                   PERFORM 8000-READ-UOW-FILE                           04900001
               END-PERFORM                                              04910000
               PERFORM 8050-READ-EVENT-FILE                             04920000
             ELSE                                                       04930000
             IF PXRD087-SKU-NBR < PXRD083-SKU-NBR                       04940000
               PERFORM 2250-CLEAR-EVENT-FIELDS                          04950000
               PERFORM 2100-MOVE-UOW-FIELDS                             04960001
               SET PXRD088-REPROCESS-NO TO TRUE                         04961022
               PERFORM 8100-WRITE-MERGE-FILE                            04970000
               IF PXRD088-UOW-TYP-CDE = '01'                            04970125
                 PERFORM 2700-WRITE-REPORT-LINE                         04971025
               END-IF                                                   04972025
               PERFORM 8000-READ-UOW-FILE                               04980001
             ELSE                                                       04990000
               PERFORM 2200-MOVE-EVENT-FIELDS                           05000000
               PERFORM 2150-CLEAR-UOW-FIELDS                            05010001
               SET PXRD088-REPROCESS-NO TO TRUE                         05011022
               PERFORM 8100-WRITE-MERGE-FILE                            05020000
               PERFORM 8050-READ-EVENT-FILE                             05040005
             END-IF                                                     05050005
           ELSE                                                         05060000
           IF PXRD087-STR-NBR < PXRD083-STR-NBR                         05070000
             PERFORM 2250-CLEAR-EVENT-FIELDS                            05080000
             PERFORM 2100-MOVE-UOW-FIELDS                               05090001
             SET PXRD088-REPROCESS-NO TO TRUE                           05091022
             PERFORM 8100-WRITE-MERGE-FILE                              05100000
             IF PXRD088-UOW-TYP-CDE = '01'                              05101025
               PERFORM 2700-WRITE-REPORT-LINE                           05102025
             END-IF                                                     05103025
             PERFORM 8000-READ-UOW-FILE                                 05120001
           ELSE                                                         05130000
             PERFORM 2200-MOVE-EVENT-FIELDS                             05140000
             PERFORM 2150-CLEAR-UOW-FIELDS                              05150001
             SET PXRD088-REPROCESS-NO TO TRUE                           05151022
             PERFORM 8100-WRITE-MERGE-FILE                              05160005
             PERFORM 8050-READ-EVENT-FILE.                              05170005
                                                                        05180000
      ******************************************************************05190000
      * MOVE UNIT OF WORK DATA TO MERGE FILE LAYOUT.                    05200001
      ******************************************************************05210000
       2100-MOVE-UOW-FIELDS.                                            05220001
           MOVE PXRD087-STR-NBR           TO PXRD088-STR-NBR.           05230001
           MOVE PXRD087-SKU-NBR           TO PXRD088-SKU-NBR.           05240001
           MOVE PXRD087-UNT-OF-WRK-DEV-ID TO PXRD088-UNT-OF-WRK-DEV-ID. 05250001
           MOVE PXRD087-ASSOC-ID          TO PXRD088-ASSOC-ID.          05260001
           MOVE PXRD087-UOW-BEG-TMST      TO PXRD088-UOW-BEG-TMST.      05270001
           MOVE PXRD087-UOW-TYP-CDE       TO PXRD088-UOW-TYP-CDE.       05280001
           MOVE PXRD087-SCND-UNT-QTY      TO PXRD088-SCND-UNT-QTY.      05290001
           MOVE PXRD087-OLD-UNT-RTL-AMT   TO PXRD088-OLD-UNT-RTL-AMT.   05300001
           MOVE PXRD087-NEW-UNT-RTL-AMT   TO PXRD088-NEW-UNT-RTL-AMT.   05310001
           MOVE PXRD087-UOW-STAT-CDE      TO PXRD088-UOW-STAT-CDE.      05311008
           MOVE PXRD087-ML-TRN-CDE        TO PXRD088-ML-TRN-CDE.        05320001
           MOVE PXRD087-MOS-TRN-SCN-SEQ-NBR                             05321011
             TO PXRD088-MOS-TRN-SCN-SEQ-NBR.                            05322011
                                                                        05330001
      ******************************************************************05340001
      * CLEAR UNIT OF WORK DATA IN MERGE FILE LAYOUT.                   05350001
      ******************************************************************05360001
       2150-CLEAR-UOW-FIELDS.                                           05370001
           MOVE SPACE                     TO PXRD088-UNT-OF-WRK-DEV-ID  05380001
                                             PXRD088-ASSOC-ID           05390001
                                             PXRD088-UOW-BEG-TMST       05400001
                                             PXRD088-UOW-TYP-CDE        05410001
                                             PXRD088-ML-TRN-CDE         05420018
                                             PXRD088-UOW-STAT-CDE.      05421018
           MOVE ZERO                      TO PXRD088-SCND-UNT-QTY       05430001
                                             PXRD088-OLD-UNT-RTL-AMT    05440001
                                             PXRD088-NEW-UNT-RTL-AMT.   05450001
                                                                        05460001
      ******************************************************************05470001
      * MOVE EVENT DATA TO MERGE FILE LAYOUT.                           05480001
      ******************************************************************05490001
       2200-MOVE-EVENT-FIELDS.                                          05500002
           SET PXRD088-MOS-EVENT-FOUND TO TRUE.                         05501020
           MOVE PXRD083-STR-NBR             TO PXRD088-STR-NBR.         05510001
           MOVE PXRD083-SKU-NBR             TO PXRD088-SKU-NBR.         05520001
           MOVE PXRD083-MOS-BEG-DATE        TO PXRD088-MOS-BEG-DATE.    05530027
           MOVE PXRD083-DAYS-SINCE-EVENT    TO PXRD088-DAYS-SINCE-EVENT 05540001
           MOVE PXRD083-DAYS-SINCE-INV-STRT TO                          05550001
             PXRD088-DAYS-SINCE-INV-STRT.                               05560001
           MOVE PXRD083-DAYS-SINCE-INV-END  TO                          05570001
             PXRD088-DAYS-SINCE-INV-END.                                05580001
                                                                        05590001
      ******************************************************************05600001
      * CLEAR EVENT DATA IN MERGE FILE LAYOUT.                          05610001
      ******************************************************************05620001
       2250-CLEAR-EVENT-FIELDS.                                         05630001
           INITIALIZE PXRD088-MERGED-EVENT-UOW-FILE.                    05631014
           SET PXRD088-MOS-EVENT-NOT-FOUND TO TRUE.                     05632020
           MOVE SPACE                    TO PXRD088-MOS-BEG-DATE.       05640027
           MOVE ZERO                     TO PXRD088-DAYS-SINCE-EVENT    05650001
                                            PXRD088-DAYS-SINCE-INV-STRT 05660001
                                            PXRD088-DAYS-SINCE-INV-END. 05670001
                                                                        05680001
      ******************************************************************05690004
      **MOVE DATA TO FIELDS TO COMPLIANCE UPDATE RECORD                 05700026
      ******************************************************************05710004
       2300-MOVE-COMPL-FIELDS.                                          05710126
           INITIALIZE PXRD097-DATA-RECORD.                              05710226
           MOVE '008'                  TO    PXRD097-EVNT-CDE.          05710326
           MOVE PXRD087-STR-NBR        TO    PXRD097-STR-NBR.           05710426
           MOVE PXRD083-MOS-BEG-DATE   TO    PXRD097-EFF-DATE.          05710528
           MOVE PXRD087-SKU-NBR        TO    PXRD097-SKU-NBR.           05710626
           MOVE PXRD087-SCND-UNT-QTY(1:8) TO PXRD097-SCND-UNT-QTY.      05710726
      ******************************************************************05711026
      **MOVE DATA TO FIELDS IN HEADING FOR REPORT                       05712026
      ******************************************************************05713026
       2500-HEADING-PREP.                                               05720004
                                                                        05730004
      ***PREPS KOHLS STANDARD HEADING                                   05740004
           MOVE PC-CURRENT-PROGRAM-NAME                                 05750005
                                     TO DP132O-PROGRAM-NAME.            05760005
           MOVE DF-FORMAT-DATE       TO DP132O-RUN-DATE.                05770005
           MOVE DF-ACCEPT-HR         TO DP132O-RUN-HOUR.                05780005
           MOVE DF-ACCEPT-MN         TO DP132O-RUN-MINUTE.              05790005
           MOVE  1                   TO DP132O-REPORT-NUMBER.           05800005
                                                                        05810004
      ***************************************************************** 05820004
      **WRITE REPORT HEADERS                                            05830004
      ***************************************************************** 05840004
       2600-WRITE-HEADINGS.                                             05850004
                                                                        05860004
           INITIALIZE PC-REPORT-LINE-COUNTER.                           05870006
                                                                        05880004
           ADD +1                      TO PC-PAGE-COUNTER.              05890004
           MOVE PC-PAGE-COUNTER        TO DP132O-PAGE-NUMBER.           05900005
           WRITE REPORT-RECORD FROM DP132O-STANDRD-HEADER-132-COLS      05910005
                               AFTER ADVANCING PAGE.                    05920005
           WRITE REPORT-RECORD FROM HEADER-LINE1                        05930005
                               AFTER ADVANCING 2 LINES.                 05940005
           WRITE REPORT-RECORD FROM HEADER-LINE2                        05950006
                               AFTER ADVANCING 2 LINES.                 05960007
           ADD 6 TO PC-REPORT-LINE-COUNTER.                             05970006
      ***************************************************************** 05980005
      **WRITE REPORT LINE                                               05990005
      ***************************************************************** 06000005
       2700-WRITE-REPORT-LINE.                                          06010005
           ADD 1 TO PC-REPORT-LINE-COUNTER.                             06020005
           IF PC-REPORT-LINE-COUNTER > 65                               06030005
             PERFORM 2600-WRITE-HEADINGS.                               06040005
                                                                        06050005
           MOVE PXRD087-STR-NBR           TO RPT-STR-NBR.               06060005
           MOVE PXRD087-SKU-NBR           TO RPT-SKU-NBR.               06070005
           MOVE PXRD087-UNT-OF-WRK-DEV-ID TO RPT-UNT-OF-WRK-DEV-ID.     06080005
           MOVE PXRD087-ASSOC-ID          TO RPT-ASSOC-ID.              06090005
           MOVE PXRD087-UOW-BEG-TMST      TO RPT-UOW-BEG-TMST.          06100005
           MOVE PXRD087-UOW-TYP-CDE       TO RPT-UOW-TYP-CDE.           06110005
           MOVE PXRD087-SCND-UNT-QTY      TO RPT-SCND-UNT-QTY.          06120005
           MOVE PXRD087-OLD-UNT-RTL-AMT   TO RPT-OLD-UNT-RTL-AMT.       06130006
           MOVE PXRD087-NEW-UNT-RTL-AMT   TO RPT-NEW-UNT-RTL-AMT.       06140006
           WRITE REPORT-RECORD FROM REPORT-LINE1                        06150005
                               AFTER ADVANCING 1 LINES.                 06160007
      ******************************************************************07560000
      *  READ INPUT EOW FILE                                           *07570000
      ******************************************************************07580000
       8000-READ-UOW-FILE.                                              07590001
           ADD 1 TO PV-NBR-OF-UOW-RECS.                                 07600001
           READ UOW-FILE INTO PXRD087-UOW-FILE                          07610001
             AT END                                                     07620000
               SET PS-END-OF-UOW-FILE TO TRUE.                          07630001
           IF PS-END-OF-UOW-FILE                                        07640005
             DISPLAY 'END OF UOW'                                       07650005
             SUBTRACT 1 FROM PV-NBR-OF-UOW-RECS                         07651023
             MOVE ALL '9' TO PXRD087-STR-NBR                            07660005
                             PXRD087-SKU-NBR.                           07670005
                                                                        07680000
      ******************************************************************07690000
      *  READ INPUT EVENT FILE                                         *07700000
      ******************************************************************07710000
       8050-READ-EVENT-FILE.                                            07720000
           ADD 1 TO PV-NBR-OF-EVENT-RECS.                               07730000
           READ EVENT-FILE INTO PXRD083-EVENT-FILE                      07740002
             AT END                                                     07750000
               SET PS-END-OF-EVENT-FILE TO TRUE.                        07760000
           IF PS-END-OF-EVENT-FILE                                      07770005
             DISPLAY 'END OF EVENT'                                     07780005
             MOVE ALL '9' TO PXRD083-STR-NBR                            07790005
                             PXRD083-SKU-NBR.                           07800005
                                                                        07810000
      ******************************************************************07820000
      *  WRITE MERGED OUTPUT FILE                                     * 07830000
      ******************************************************************07840000
       8100-WRITE-MERGE-FILE.                                           07850000
           ADD 1 TO PV-NBR-OF-MERGE-RECS.                               07860000
           WRITE MERGE-RECORD FROM                                      07870002
             PXRD088-MERGED-EVENT-UOW-FILE.                             07880001
                                                                        07890000
      ******************************************************************07891026
      *  WRITE COMPLIANCE OUTPUT FILE                                 * 07892026
      ******************************************************************07893026
       8110-WRITE-COMPL-FILE.                                           07894026
           ADD 1 TO PV-NBR-OF-COMPL-RECS.                               07895026
           WRITE COMPL-RECORD FROM                                      07896026
             PXRD097-DATA-RECORD.                                       07897028
                                                                        07898026
      ******************************************************************07900000
      *  CLOSE CURSORS, CLOSE FILES, DISPLAY COUNTERS                 * 07910000
      ******************************************************************07920000
       9000-END-OF-JOB.                                                 07930000
           DISPLAY 'NBR OF EOW RECS READ -      '                       07940000
                   PV-NBR-OF-UOW-RECS.                                  07950001
           DISPLAY 'NBR OF EVENT RECS READ  -   '                       07960000
                   PV-NBR-OF-EVENT-RECS                                 07970000
           DISPLAY 'NBR OF MERGE RECS WRITTEN - '                       07980000
                   PV-NBR-OF-MERGE-RECS                                 07990000
           DISPLAY 'NBR OF COMPL RECS WRITTEN - '                       07991026
                   PV-NBR-OF-COMPL-RECS.                                07992026
           CLOSE UOW-FILE                                               08000001
                 EVENT-FILE                                             08010000
                 MERGE-FILE                                             08020003
                 COMPL-FILE                                             08021026
                 REPORT-FILE.                                           08030003
                                                                        08040000
      *                                                                 08050000
