000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.             PCKCS759.                                00040000
000500 AUTHOR.                 GERMAN BANDA.                            00050000
000600 INSTALLATION.           KOHLS DEPARTMENT STORE.                  00060000
000700 DATE-WRITTEN            MAY, 2003.                               00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000* THIS PROGRAM IS A MODULE WHICH WILL CREATE ROWS IN              00100000
001100* THE REPOSITORY TABLES  (WFT_LOD_CNTL AND WFT_LOD_XFER) FOR      00110000
001200* RECEIPTS AND ADJUSTMENTS WHICH WILL BE SENT TO RMS THROUGH MQ   00120000
001300* SERIES.                                                         00130000
001400******************************************************************00140000
P5207 * 12/4/2013 CHANGE MADE: THE PROGRAM WAS MODIFIED AS TO MOVE THE *00141007
P5207 * OPER_UNT_ID VALUE OF TRECEIV TABLE TO RD024-DC FIELD IF THE    *00142007
P5207 * PO NUMBER IS NOT OF DIRECT STORE. SO THAT A CORRECT DC NUMBER  *00143007
P5207 * WILL BE SENT TO RMS.  - SHEBENA    CHG # : CHG0081355          *00144009
001400******************************************************************00145007
001500 ENVIRONMENT DIVISION.                                            00150000
001600 DATA DIVISION.                                                   00160000
001700******************************************************************00170000
001800 WORKING-STORAGE SECTION.                                         00180000
001900                                                                  00190000
002000 01  DK-DB2-KEYS.                                                 00200000
002100     05  DK-PO-NBR                PIC S9(09)  COMP.               00210000
002200     05  DK-PO-LINE-NBR           PIC S9(09)  COMP.               00220000
002300     05  DK-OPER-UNT-ID           PIC S9(04)  COMP.               00230000
002400     05  DK-RCVR-SEQ-NBR          PIC S9(09)  COMP.               00240000
002500                                                                  00250000
002600*----------------------------------------------------------------*00260000
002700* COMMAREA USED WHEN LINKING FROM A CALLING PROGRAM               00270000
002800*----------------------------------------------------------------*00280000
002900     COPY PCWS238.                                                00290000
003000                                                                  00300000
003100******************************************************************00310000
003200* TEMPORARY STORAGE QUEUE LAYOUT FOR ADJUSTMENTS                  00320000
003300     COPY PCWS241.                                                00330000
003400******************************************************************00340000
003500* REPOSITORY LAYOUT                                               00350000
003600******************************************************************00360000
003700     COPY XLRD024.                                                00370000
003800******************************************************************00380000
003900*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00390000
004000******************************************************************00400000
004100     COPY DPWS013.                                                00410000
004200                                                                  00420000
004300*----------------------------------------------------------------*00430000
004400*  PROGRAM CONSTANTS                                             *00440000
004500*----------------------------------------------------------------*00450000
004600 01  PC-PROGRAM-CONSTANTS.                                        00460000
004700     05  PC-V                     PIC  X(01)  VALUE 'V'.          00470000
004800     05  PC-X                     PIC  X(01)  VALUE 'X'.          00480000
004900     05  PC-B                     PIC  X(01)  VALUE 'B'.          00490000
005000     05  PC-D                     PIC  X(01)  VALUE 'D'.          00500000
005100     05  PC-Q                     PIC  X(01)  VALUE 'Q'.          00510000
005200     05  PC-W                     PIC  X(01)  VALUE 'W'.          00520000
005300                                                                  00530000
005400     05  PC-PCKADJ                PIC  X(06)  VALUE 'PCKADJ'.     00540000
005500     05  PC-SKUADJ                PIC  X(06)  VALUE 'SKUADJ'.     00550000
005600     05  PC-SKUVER                PIC  X(06)  VALUE 'SKUVER'.     00560000
005700     05  PC-PCKVER                PIC  X(06)  VALUE 'PCKVER'.     00570000
005800     05  PC-READY                 PIC  X(06)  VALUE 'READY '.     00580000
005900     05  PC-REPOSITORY-DEF-TMST   PIC  X(26)  VALUE               00590000
006000                                  '0001-01-01-00.00.00.000000'.   00600000
006100                                                                  00610000
006200     05  PC-999                   PIC  S9(4) COMP  VALUE 999.     00620000
006300     05  PC-DEFAULT-DATE          PIC  X(26)  VALUE               00630000
006400                                  '9999-09-09-09.09.09.999999'.   00640000
006500     05  PC-LOG-QUEUE             PIC  X(04)  VALUE 'CSSL'.       00650000
006600     05  PC-MSG-TABLE-SIZE        PIC S9(03) COMP-3 VALUE 200.    00660000
006700     05  PC-END-TM                PIC  X(08) VALUE '24.00.00'.    00670000
006800     05  PC-PROCESS-AREA-PGM      PIC  X(08) VALUE 'RCKUT061'.    00680000
006900     05  PC-VERIFY-ADJUST-PGM     PIC  X(08) VALUE 'PCKCS759'.    00690000
007000     05  PC-DISPLAY-PO                PIC 9(8)   VALUE ZEROS.     00700000
007100     05  PC-DISPLAY-RCVR              PIC 9(8)   VALUE ZEROS.     00710000
007200     05  PC-DISPLAY-LINE              PIC 9(8)   VALUE ZEROS.     00720000
007300     05  PC-DISPLAY-OPER              PIC 9(4)   VALUE ZEROS.     00730000
007400     05  PC-DISPLAY-CICS-RESPONSE     PIC 9(8)-  VALUE ZEROS.     00740000
007500                                                                  00750000
007600*----------------------------------------------------------------*00760000
007700*  PROGRAM SWITCHES                                              *00770000
007800*----------------------------------------------------------------*00780000
007900 01  PS-PROGRAM-SWITCHES.                                         00790000
008000     05  PS-ERROR-SW                     PIC  X(01)  VALUE 'N'.   00800000
008100         88  PS-ERROR                                VALUE 'Y'.   00810000
008200         88  PS-ERROR-NO                             VALUE 'N'.   00820000
008300     05  PS-FIRST-FETCH-SW               PIC  X(01)  VALUE 'Y'.   00830000
008400         88  PS-FIRST-FETCH                          VALUE 'Y'.   00840000
008500         88  PS-NOT-FIRST-FETCH                      VALUE 'N'.   00850000
008600     05  PS-END-ADJUSTMENTS-TSQ-SW       PIC  X(01)  VALUE 'N'.   00860000
008700         88  PS-END-ADJUSTMENTS-TSQ                  VALUE 'Y'.   00870000
008800         88  PS-NOT-END-ADJUSTMENTS-TSQ              VALUE 'N'.   00880000
008900     05  PS-SHOW-DEBUG-SW                PIC  X(01)  VALUE 'N'.   00890000
009000         88  PS-DONT-SHOW-DEBUG-INFO                 VALUE 'N'.   00900000
009100         88  PS-SHOW-DEBUG-INFO                      VALUE 'Y'.   00910000
009200     05  PS-PREPK-PO-FOUND-SW            PIC  X(01)  VALUE 'N'.   00920000
009300         88  PS-PREPK-PO-FOUND                       VALUE 'Y'.   00930000
009400         88  PS-PREPK-PO-NOT-FOUND                   VALUE 'N'.   00940000
009500     05  PS-END-OF-LINE-STORE-CSR-SW     PIC  X(01)  VALUE 'N'.   00950000
009600         88  PS-NOT-END-OF-LINE-STORE-CSR            VALUE 'N'.   00960000
009700         88  PS-END-OF-LINE-STORE-CSR                VALUE 'Y'.   00970000
009800     05  PS-END-OF-PREPK-LINE-CSR-SW     PIC  X(01)  VALUE 'N'.   00980000
009900         88  PS-NOT-END-OF-PREPK-LINE-CSR            VALUE 'N'.   00990000
010000         88  PS-END-OF-PREPK-LINE-CSR                VALUE 'Y'.   01000000
010100     05  PS-NEW-LINE-FOUND-SW            PIC  X(01)  VALUE 'N'.   01010000
010200         88  PS-NEW-LINE-FOUND                       VALUE 'Y'.   01020000
010300         88  PS-NO-NEW-LINE-FOUND                    VALUE 'N'.   01030000
010400     05  PS-END-OF-PREPK-STORE-SW        PIC  X(01)  VALUE 'N'.   01040000
010500         88  PS-END-OF-PREPK-STORE                   VALUE 'Y'.   01050000
010600         88  PS-NOT-END-OF-PREPK-STORE               VALUE 'N'.   01060000
010700     05  PS-END-OF-ODD-UNITS-CSR-SW      PIC  X(01)  VALUE 'N'.   01070000
010800         88  PS-END-OF-ODD-UNITS-CSR                 VALUE 'Y'.   01080000
010900         88  PS-NOT-END-OF-ODD-UNITS-CSR             VALUE 'N'.   01090000
011000     05  PS-AT-LEAST-ONE-STORE           PIC  X(01)  VALUE 'N'.   01100000
011100         88  AT-LEAST-ONE-STORE                      VALUE 'Y'.   01110000
011200     05  PS-END-OF-TABLE-SW              PIC X(01)   VALUE 'N'.   01120000
011300         88  PS-END-OF-TABLE                         VALUE 'Y'.   01130000
011400         88  PS-NOT-END-OF-TABLE                     VALUE 'N'.   01140000
011500     05  PS-ODD-UNITS-TRANS-SW           PIC X(01)   VALUE 'N'.   01150000
011600         88  PS-ODD-UNITS-TRANSACTION                VALUE 'Y'.   01160000
011700         88  PS-ODD-UNITS-TRANSACTION-NO             VALUE 'N'.   01170000
011800     05  PS-END-OF-PREPK-RATIO-CSR-SW    PIC X(01)   VALUE 'N'.   01180000
011900         88  PS-END-OF-PREPK-RATIO-CSR               VALUE 'Y'.   01190000
012000         88  PS-NOT-END-OF-PREPK-RATIO-CSR           VALUE 'N'.   01200000
012100     05  PS-RATO-QTY-MISMATCH-SW         PIC X(01)   VALUE 'N'.   01210000
012200         88  PS-RATO-QTY-MISMATCH                    VALUE 'Y'.   01220000
012300         88  PS-NO-RATO-QTY-MISMATCH                 VALUE 'N'.   01230000
012400     05  PS-END-OF-PREPK-BY-LNE-SW       PIC X(01)   VALUE 'N'.   01240000
012500         88  PS-END-OF-PREPK-BY-LNE                  VALUE 'Y'.   01250000
012600         88  PS-NOT-END-OF-PREPK-BY-LNE              VALUE 'N'.   01260000
012601* RPK - ADDED CODE FOR PRB42963 - START                           01270000
012602*       SWITCH ADDED TO KNOW IF A WRITE HAS BEEN DONE ONLY TO     01280000
012603*       THE WFT_LOD_XFER TABLE AND NOT THE WFT_LOD_CNTL TABLE     01290000
012604*       DUE TO THEIR BEING 100 STORES WITH VERIFIED UNITS BUT     01300000
012605*       NO MORE STORES TO FOLLOW.                                 01310000
012610     05  PS-WROTE-TO-XFER-ONLY-SW        PIC X(01)   VALUE 'N'.   01320000
012620         88  PS-WROTE-TO-XFER-ONLY                   VALUE 'Y'.   01330000
012630         88  PS-DID-NOT-WRITE-TO-XFER-ONLY           VALUE 'N'.   01340000
012640* RPK - ADDED CODE FOR PRB42963 - END                             01350000
012700                                                                  01360000
012800*----------------------------------------------------------------*01370000
012900*  PROGRAM VARIABLES                                             *01380000
013000*----------------------------------------------------------------*01390000
013100 01  PV-PROGRAM-VARIABLES.                                        01400000
013200                                                                  01410000
013300     05  PV-DISPLAY-PO-NBR               PIC 999999999-.          01420000
013400     05  PV-DISPLAY-PO-LINE-NBR          PIC 999999999-.          01430000
013500     05  PV-DISPLAY-PREPK-ID             PIC 9999-.               01440000
013600     05  PV-DISPLAY-OPER-UNT-ID          PIC 9999-.               01450000
013700     05  PV-DISPLAY-INBND-TRIP-ID        PIC 999999999-.          01460000
013800     05  PV-DISPLAY-RCVR-SEQ-NBR         PIC 999999999-.          01470000
013900     05  PV-DISPLAY-SHIPT-UNT-ID         PIC 999999999999999999-. 01480000
014000     05  PV-DISPLAY-ITEM-NBR             PIC 999999999999999999-. 01490000
014100                                                                  01500000
014200     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACES.01510000
014300                                                                  01520000
014400     05  PV-CICS-MSG-AREA3               PIC  X(100) VALUE SPACES.01530000
014500                                                                  01540000
014600     05  PV-LOD-DAT-TXT-LEN              PIC S9(4)  COMP.         01550000
014700                                                                  01560000
014800     05  PV-MAX-ITEMS                    PIC S9(4)  VALUE +0      01570000
014900                                                    COMP.         01580000
015000     05  PV-INDEX-COUNTER                PIC S9(4)  VALUE +0      01590000
015100                                                    COMP.         01600000
015200     05  PV-SEL-ITEM                     PIC S9(4) COMP.          01610000
015300     05  PV-VALID-IDX                   PIC S9(04)  VALUE +0      01620000
015400                                                    COMP SYNC.    01630000
015500     05  PV-PACK-QTY                     PIC S9(7).               01640000
015600     05  PV-SKU-NBR                      PIC  9(8).               01650000
015700                                                                  01660000
015800     05  PV-KEY-DATE                     PIC  X(10) VALUE SPACES. 01670000
015900     05  PV-KEY-DATE-R REDEFINES PV-KEY-DATE.                     01680000
016000         10  PV-KEY-CC                   PIC  9(02).              01690000
016100         10  PV-KEY-YY                   PIC  9(02).              01700000
016200         10  PV-DASH-1                   PIC  X(01).              01710000
016300         10  PV-KEY-MM                   PIC  9(02).              01720000
016400         10  PV-DASH-2                   PIC  X(01).              01730000
016500         10  PV-KEY-DD                   PIC  9(02).              01740000
016600                                                                  01750000
016700     05  PV-BTCH-LOD-SEQ-ID              PIC S9(09) COMP.         01760000
016800     05  PV-LIMIT-DAYS                   PIC S9(09) COMP.         01770000
016900     05  PV-SHPD-QTY-SUM                 PIC S9(09) COMP-3.       01780000
017000     05  PV-CARTON-COUNT                 PIC S9(09) COMP.         01790000
017100     05  PV-STORE-COUNT                  PIC S9(4)  COMP.         01800000
017200     05  PV-LINE-COUNT                   PIC S9(4)  COMP.         01810000
017300*                                                                 01820000
017400     05  PV-PREPK-LNE                    PIC S9(09) COMP.         01830000
017500     05  PV-PREPK-RATO-QTY               PIC S9(04) COMP.         01840000
017600     05  PV-STR-ADJ-QTY                  PIC S9(07).              01850000
017700*                                                                 01860000
017800     05  PV-PO-LNE-HOLD                  PIC S9(09) COMP.         01870000
017900     05  PV-HOLD-STORE                   PIC S9(04) COMP.         01880000
018000                                                                  01890000
018100     05  PV-UNION-TYPE                   PIC  X(01).              01900000
018200     05  PV-PREV-UNION-TYPE              PIC  X(01).              01910000
018300     05  PV-PREV-PREPK-RATO-QTY          PIC  S9(4) COMP.         01920000
018400                                                                  01930000
018500     05  PV-CICS-MSG-AREA                PIC  X(80) VALUE SPACE.  01940000
018600     05  PV-CICS-RESPONSE                PIC S9(08) VALUE ZEROS   01950000
018700                                                    COMP SYNC.    01960000
018800     05  PV-EIBTASKN                     PIC Z(06)9.              01970000
018900     05  PV-PREV-SEQUENCE                PIC S9(05) COMP-3        01980000
019000                                                     VALUE ZERO.  01990000
019100     05  PV-NEXT-SEQUENCE                PIC S9(05) COMP-3        02000000
019200                                                     VALUE ZERO.  02010000
019300     05  PV-CURRENT-TMST                 PIC  X(26)  VALUE SPACES.02020000
019400     05  PV-CURRENT-TMST-R REDEFINES PV-CURRENT-TMST.             02030000
019500         10  PV-CURR-YYYY                PIC  9(04).              02040000
019600         10  FILLER                      PIC  X(01).              02050000
019700         10  PV-CURR-MM                  PIC  9(02).              02060000
019800         10  FILLER                      PIC  X(01).              02070000
019900         10  PV-CURR-DD                  PIC  9(02).              02080000
020000         10  FILLER                      PIC  X(01).              02090000
020100         10  PV-CURR-HH                  PIC  9(02).              02100000
020200         10  FILLER                      PIC  X(01).              02110000
020300         10  PV-CURR-MN                  PIC  9(02).              02120000
020400         10  FILLER                      PIC  X(01).              02130000
020500         10  PV-CURR-SS                  PIC  9(02).              02140000
020600         10  FILLER                      PIC  X(07).              02150000
020700     05  PV-VERFIED-TMST.                                         02160000
020800         10  PV-CURR-YYYY-VRFD           PIC  9(04).              02170000
020900         10  PV-CURR-MM-VRFD             PIC  9(02).              02180000
021000         10  PV-CURR-DD-VRFD             PIC  9(02).              02190000
021100         10  PV-CURR-HH-VRFD             PIC  9(02).              02200000
021200         10  PV-CURR-MN-VRFD             PIC  9(02).              02210000
021300         10  PV-CURR-SS-VRFD             PIC  9(02).              02220000
021400     05  PV-PRC-CNTL-TMST                PIC  X(26)  VALUE SPACES.02230000
021500/                                                                 02240000
021600 01  PT-MSG-TABLE.                                                02250000
021700     05  PT-MSG-LINES OCCURS 200 TIMES                            02260000
021800                              INDEXED BY PT-MSG-IDX.              02270000
021900         10  PT-MSG-SEQ                  PIC S9(05) COMP-3.       02280000
022000         10  PT-MSG-LINE                 PIC X(69).               02290000
022100                                                                  02300000
022200     05  PV-COMMAREA-LENGTH              PIC S9(04)  COMP         02310000
022300                                                     VALUE ZERO.  02320000
022400     05  PV-CICS-RESP                    PIC S9(08)  VALUE ZEROS  02330000
022500                                                     COMP SYNC.   02340000
022600                                                                  02350000
022700*---------------------------------------------------------------* 02360000
022800*    DB2 AREA FOR THE PURCHASE ITEM TABLE                       * 02370000
022900*---------------------------------------------------------------* 02380000
023000     EXEC SQL                                                     02390000
023100          INCLUDE TPURITM                                         02400000
023200     END-EXEC.                                                    02410000
023300*---------------------------------------------------------------* 02420000
023400*    DB2 AREA FOR THE RECEIVER DISTRO TABLE                     * 02430000
023500*---------------------------------------------------------------* 02440000
023600     EXEC SQL                                                     02450000
023700          INCLUDE TRECDIS                                         02460000
023800     END-EXEC.                                                    02470000
023900*---------------------------------------------------------------* 02480000
024000*    DB2 AREA FOR RECEIVER ITEM TABLE                           * 02490000
024100*---------------------------------------------------------------* 02500000
024200     EXEC SQL                                                     02510000
024300          INCLUDE TRECITM                                         02520000
024400     END-EXEC.                                                    02530000
024500*---------------------------------------------------------------* 02540000
024600*  DB2 AREA FOR THE PO PREPK TABLE                                02550000
024700*---------------------------------------------------------------* 02560000
024800     EXEC SQL                                                     02570000
024900         INCLUDE TPOPRPK                                          02580000
025000     END-EXEC.                                                    02590000
P5207 *---------------------------------------------------------------* 02591007
P5207 *    DB2 AREA FOR RECEIPT HEADER TABLE                          * 02592007
P5207 *---------------------------------------------------------------* 02593007
P5207      EXEC SQL                                                     02594007
P5207           INCLUDE TRECEIV                                         02595007
P5207      END-EXEC.                                                    02596007
025100*---------------------------------------------------------------* 02600000
025200*  DB2 AREA FOR (WFT_LOD_CNTL)                                    02610000
025300*---------------------------------------------------------------* 02620000
025400     EXEC SQL                                                     02630000
025500         INCLUDE WFT00001                                         02640000
025600     END-EXEC.                                                    02650000
025700*---------------------------------------------------------------* 02660000
025800*  DB2 AREA FOR (WFT_LOD_XFER)                                    02670000
025900*---------------------------------------------------------------* 02680000
026000     EXEC SQL                                                     02690000
026100         INCLUDE WFT00002                                         02700000
026200     END-EXEC.                                                    02710000
026300*---------------------------------------------------------------* 02720000
026400*  DB2 AREA FOR (XLT_SKU)                                         02730000
026500*---------------------------------------------------------------* 02740000
026600     EXEC SQL                                                     02750000
026700         INCLUDE XLT00003                                         02760000
026800     END-EXEC.                                                    02770000
026900*---------------------------------------------------------------* 02780000
027000*  DB2 AREA FOR (RCT_VRFD_ODD_UNT)                                02790000
027100*---------------------------------------------------------------* 02800000
027200     EXEC SQL                                                     02810000
027300         INCLUDE RCT00009                                         02820000
027400     END-EXEC.                                                    02830000
027500*---------------------------------------------------------------* 02840000
027600*    RECVG SYSTEMS PARM TABLE                                     02850000
027700*---------------------------------------------------------------* 02860000
027800     EXEC SQL                                                     02870000
027900         INCLUDE TKRPRPM                                          02880000
028000     END-EXEC.                                                    02890000
028100                                                                  02900000
028200*----------------------------------------------------------------*02910000
028300*  COMMUNICATIONS AREA FOR DB2                                   *02920000
028400*----------------------------------------------------------------*02930000
028500     EXEC SQL                                                     02940000
028600         INCLUDE SQLCA                                            02950000
028700     END-EXEC.                                                    02960000
028800                                                                  02970000
028900***************************************************************** 02980000
029000*  LINE STORE CURSOR                                              02990000
029100***************************************************************** 03000000
029200     EXEC SQL                                                     03010000
029300       DECLARE LINE-STORE-CSR CURSOR FOR                          03020000
029400         SELECT A.ORD_LNE_NBR                                     03030000
029500              , B.STR_NBR                                         03040000
029600              , B.AP_VERIFY_ITM_QTY                               03050000
029700              , B.VERIFY_ITM_QTY                                  03060000
029800              , A.ITM_NBR                                         03070000
029900              , A.VERFYD_TMST                                     03080000
030000          FROM    TRECITM A                                       03090000
030100                , TRECDIS B                                       03100000
030200          WHERE     A.ORD_NBR        = :DK-PO-NBR                 03110000
030300             AND    A.REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR           03120000
030400             AND    A.ORD_LNE_NBR    = :DK-PO-LINE-NBR            03130000
030500             AND    A.ORD_NBR        =  B.ORD_NBR                 03140000
030600             AND    A.ORD_LNE_NBR    =  B.ORD_LNE_NBR             03150000
030700             AND    A.REC_SEQ_NBR    =  B.REC_SEQ_NBR             03160000
030800             AND    A.VER_STATUS_CDE = 'A'                        03170000
030900          ORDER BY A.ORD_LNE_NBR,B.STR_NBR                        03180000
031000     END-EXEC                                                     03190000
031100                                                                  03200000
031200***************************************************************** 03210000
031300*  PREPACK LINE CURSOR                                            03220000
031400***************************************************************** 03230000
031500     EXEC SQL                                                     03240000
031600       DECLARE PREPK-LINE-CSR CURSOR FOR                          03250000
031700          SELECT DISTINCT                                         03260000
031800                 T1.STR_NBR                                       03270000
031900               , T1.PREPK_RATO_QTY                                03280000
032000               , T1.AP_VERIFY_ITM_QTY                             03290000
032100               , T1.VERIFY_ITM_QTY                                03300000
032200               , T1.VERFYD_TMST                                   03310000
032300               , COALESCE(T2.DC_VRFY_ODU_QTY,0)                   03320000
032400               , COALESCE(T2.AP_VRFY_ODU_QTY,0)                   03330000
032500          FROM                                                    03340000
032600          ( SELECT DISTINCT                                       03350000
032700                   A.STR_NBR                                      03360000
032800                 , A.AP_VERIFY_ITM_QTY                            03370000
032900                 , A.VERIFY_ITM_QTY                               03380000
033000                 , B.ORD_LNE_NBR                                  03390000
033100                 , B.PREPK_RATO_QTY                               03400000
033200                 , B.PREPK_ID                                     03410000
033300                 , B.VERFYD_TMST                                  03420000
033400              FROM TRECDIS A                                      03430000
033500                 , TRECITM B                                      03440000
033600             WHERE B.ORD_NBR      = :DK-PO-NBR                    03450000
033700               AND B.REC_SEQ_NBR  = :DK-RCVR-SEQ-NBR              03460000
033800               AND B.PREPK_ID     = :RECITM-PREPK-ID              03470000
033900               AND A.ORD_NBR      = B.ORD_NBR                     03480000
034000               AND A.ORD_LNE_NBR  = B.ORD_LNE_NBR                 03490000
034100               AND A.REC_SEQ_NBR  = B.REC_SEQ_NBR                 03500000
034200               AND B.VER_STATUS_CDE = 'A'                         03510000
034300               AND B.PREPK_DRV_LNE_CDE = 'A') AS T1               03520000
034400         LEFT OUTER JOIN                                          03530000
034500                                                                  03540000
034600           (SELECT A.STR_NBR                                      03550000
034700                 , PO_LNE_NBR                                     03560000
034800                 , DC_VRFY_ODU_QTY                                03570000
034900                 , AP_VRFY_ODU_QTY                                03580000
035000             FROM  RCT_VRFD_ODD_UNT A                             03590000
035100             WHERE PO_NBR         = :DK-PO-NBR                    03600000
035200               AND RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR) AS T2       03610000
035300         ON  T1.STR_NBR    = T2.STR_NBR                           03620000
035400          AND T1.ORD_LNE_NBR   =   T2.PO_LNE_NBR                  03630000
035500         ORDER BY T1.STR_NBR                                      03640000
035600     END-EXEC                                                     03650000
035700***************************************************************** 03660000
035800*  ODD UNITS CURSOR                                               03670000
035900***************************************************************** 03680000
036000     EXEC SQL                                                     03690000
036100       DECLARE ODD-UNITS-CSR CURSOR FOR                           03700000
036200          SELECT DISTINCT                                         03710000
036300                 STR_NBR                                          03720000
036400               , PO_LNE_NBR                                       03730000
036500               , DC_VRFY_ODU_QTY                                  03740000
036600               , AP_VRFY_ODU_QTY                                  03750000
036700           FROM RCT_VRFD_ODD_UNT A                                03760000
036800              , TRECITM B                                         03770000
036900           WHERE A.PO_NBR         = :DK-PO-NBR                    03780000
037000             AND A.RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR              03790000
037100             AND A.PO_NBR         = B.ORD_NBR                     03800000
037200             AND A.RCVR_SEQ_NBR   = B.REC_SEQ_NBR                 03810000
037300             AND B.PREPK_ID       = :RECITM-PREPK-ID              03820000
037400             AND A.PO_LNE_NBR     = B.ORD_LNE_NBR                 03830000
037500         ORDER BY PO_LNE_NBR,STR_NBR                              03840000
037600     END-EXEC                                                     03850000
037700******************************************************************03860000
037800*  CURSOR TO COMPARE PURITM AND RECITM FOR PREPACKS               03870000
037900***************************************************************** 03880000
038000     EXEC SQL                                                     03890000
038100       DECLARE PREPK-RATIO-CSR CURSOR FOR                         03900000
038200            SELECT 'A'                                            03910000
038300                ,  A.PREPK_RATO_QTY                               03920000
038400                ,  A.ORD_LNE_NBR                                  03930000
038500              FROM TRECITM A                                      03940000
038600             WHERE A.ORD_NBR           = :DK-PO-NBR               03950000
038700               AND A.REC_SEQ_NBR       = :DK-RCVR-SEQ-NBR         03960000
038800               AND A.PREPK_ID          = :RECITM-PREPK-ID         03970000
038900               AND A.VER_STATUS_CDE    = 'A'                      03980000
039000            UNION                                                 03990000
039100              SELECT 'B'                                          04000000
039200                  ,  C.PREPK_RATO_QTY                             04010000
039300                  ,  C.APP_PO_LNE_NBR                             04020000
039400                FROM TPURITM C                                    04030000
039500               WHERE C.PO_NBR            = :DK-PO-NBR             04040000
039600                 AND C.PO_PREPK_ID       = :RECITM-PREPK-ID       04050000
039700                 AND C.VER_STATUS_CDE    = 'A'                    04060000
039800           ORDER BY 3                                             04070000
039900     END-EXEC                                                     04080000
040000******************************************************************04090000
040100*  RETURN ALL THE LINES OF A PREPACK                              04100000
040200***************************************************************** 04110000
040300     EXEC SQL                                                     04120000
040400       DECLARE PREPK-BY-LNE-CSR CURSOR FOR                        04130000
040500          SELECT DISTINCT                                         04140000
040600                 B.ORD_LNE_NBR                                    04150000
040700               , B.PREPK_RATO_QTY                                 04160000
040800               , B.ITM_NBR                                        04170000
040900            FROM TRECDIS A                                        04180000
041000               , TRECITM B                                        04190000
041100           WHERE B.ORD_NBR      = :DK-PO-NBR                      04200000
041200             AND B.REC_SEQ_NBR  = :DK-RCVR-SEQ-NBR                04210000
041300             AND B.PREPK_ID     = :RECITM-PREPK-ID                04220000
041400             AND A.ORD_NBR      = B.ORD_NBR                       04230000
041500             AND A.ORD_LNE_NBR  = B.ORD_LNE_NBR                   04240000
041600             AND A.REC_SEQ_NBR  = B.REC_SEQ_NBR                   04250000
041700             AND B.VER_STATUS_CDE = 'A'                           04260000
041800         ORDER BY ORD_LNE_NBR                                     04270000
041900     END-EXEC                                                     04280000
042000******************************************************************04290000
042100 LINKAGE SECTION.                                                 04300000
042200******************************************************************04310000
042300 01  DFHCOMMAREA.                                                 04320000
042400     05  FILLER                         OCCURS  1 TO 4072 TIMES   04330000
042500                                      DEPENDING ON EIBCALEN.      04340000
042600         10  FILLER                   PIC X.                      04350000
042700                                                                  04360000
042800******************************************************************04370000
042900 PROCEDURE DIVISION.                                              04380000
043000******************************************************************04390000
043100 0000-PROGRAM-MAINLINE.                                           04400000
043200     MOVE EIBTASKN                 TO PV-EIBTASKN                 04410000
043300     INITIALIZE                        PC238-COMM-AREA.           04420000
043400     MOVE DFHCOMMAREA              TO  PC238-COMM-AREA.           04430000
043500                                                                  04440000
043600                                                                  04450000
043700*    STRING ' PS-SHOW-DEBUG-SW= ' PS-SHOW-DEBUG-SW                04460000
043800*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  04470000
043900*    PERFORM 9990-WRITE-CICS.                                     04480000
044000                                                                  04490000
044100* RESERVE THE LOG QUEUE FOR THE EXCLUSIVE USE OF THIS TRANSACTION 04500000
044200* TO KEEP OTHER TRANSACTIONS FROM INTERUPTING THE DISPLAY.        04510000
044300* THIS IS DONE ONLY IF THE DEBUGGING FLAG FOR THE DC IS           04520000
044400* SWITCHED ON.  IF AN ERROR OCCURS WHEN THE FLAG IS OFF,          04530000
044500* WE WILL ENQ THE LOG BEFORE DUMPING THE MESSAGE TABLE.           04540000
044600                                                                  04550000
044700*    IF PS-SHOW-DEBUG-INFO                                        04560000
044800*        EXEC CICS ENQ                                            04570000
044900*            RESOURCE(PC-LOG-QUEUE)                               04580000
045000*        END-EXEC                                                 04590000
045100*    END-IF                                                       04600000
045200                                                                  04610000
045300     INITIALIZE PT-MSG-TABLE.                                     04620000
045400                                                                  04630000
045500* THE FOLLOWING COMMENTED CODE CAN BE USED TO DETERMINE IF        04640000
045600* THE ROUTINE IS IN FACT GETTING CALLED.                          04650000
045700*                                                                 04660000
045800*    MOVE PC238-PO-NBR       TO PC-DISPLAY-PO.                    04670000
045900*    MOVE PC238-RCVR-SEQ-NBR TO PC-DISPLAY-RCVR.                  04680000
046000*    MOVE PC238-PO-LNE-NBR   TO PC-DISPLAY-LINE.                  04690000
046100*    MOVE PC238-WRKD-OPER-UNT-ID                                  04700000
046200*                            TO PC-DISPLAY-OPER.                  04710000
046300*    STRING ' PCKCS759 - '      DELIMITED BY SIZE                 04720000
046400*           ' PC238 DATA RECEIVED - '                             04730000
046500*                               DELIMITED BY SIZE                 04740000
046600*           PC-DISPLAY-PO       DELIMITED BY SIZE                 04750000
046700*           ' - '               DELIMITED BY SIZE                 04760000
046800*           PC-DISPLAY-RCVR     DELIMITED BY SIZE                 04770000
046900*           ' - '               DELIMITED BY SIZE                 04780000
047000*           PC-DISPLAY-LINE     DELIMITED BY SIZE                 04790000
047100*           ' - '               DELIMITED BY SIZE                 04800000
047200*           PC-DISPLAY-OPER     DELIMITED BY SIZE                 04810000
047300*                        INTO PV-CICS-MSG-AREA3.                  04820000
047400*    MOVE LENGTH OF PV-CICS-MSG-AREA3                             04830000
047500*                          TO PV-COMMAREA-LENGTH.                 04840000
047600*    PERFORM 9200-WRITE-TO-CICS-LOG.                              04850000
047700                                                                  04860000
047800                                                                  04870000
047900     IF  PC238-MOD-UNSUCCESSFUL                                   04880000
048000         CONTINUE                                                 04890000
048100     ELSE                                                         04900000
048200         SET  PC238-MOD-SUCCESSFUL   TO TRUE                      04910000
048300         MOVE PC238-PO-NBR           TO DK-PO-NBR                 04920000
048400         MOVE PC238-RCVR-SEQ-NBR     TO DK-RCVR-SEQ-NBR           04930000
048500         MOVE PC238-PO-LNE-NBR       TO DK-PO-LINE-NBR            04940000
048600                                                                  04950000
048700         PERFORM 1000-SELECT-CONTROL-TMST                         04960000
048800                                                                  04970000
048900         EVALUATE TRUE                                            04980000
049000             WHEN PC238-TRANS-TYPE-CDE = PC-B                     04990000
049100             WHEN PC238-TRANS-TYPE-CDE = PC-D                     05000000
049200             WHEN PC238-TRANS-TYPE-CDE = PC-Q                     05010000
049300                 SET PS-NO-RATO-QTY-MISMATCH TO TRUE              05020000
049400                 PERFORM 6000-GET-RECITM                          05030000
049500                 PERFORM 6100-GET-SKU                             05040000
049600                 IF PC238-MOD-SUCCESSFUL                          05050000
049700                    IF PS-RATO-QTY-MISMATCH                       05060000
049800                       MOVE SPACE TO PC238-VRFY-ADJ-DRIVE-LNE     05070000
049900                       PERFORM 4500-PROCESS-PREPK-BY-LNE          05080000
050000                    ELSE                                          05090000
050100                       PERFORM 2000-PROCESS-ADJUSTMENTS           05100000
050200                    END-IF                                        05110000
050300                 END-IF                                           05120000
050400             WHEN PC238-TRANS-TYPE-CDE = PC-V                     05130000
050500             WHEN PC238-TRANS-TYPE-CDE = PC-X                     05140000
050600                 PERFORM 6400-CHECK-FOR-PREPK                     05150000
050700                 IF PC238-MOD-SUCCESSFUL                          05160000
050800                    IF PS-PREPK-PO-FOUND                          05170000
050900                       PERFORM 4000-CHECK-PREPK-RATIO             05180000
051000                                                                  05190000
051100                       IF PS-RATO-QTY-MISMATCH                    05200000
051200                          MOVE SPACES TO PC238-VRFY-ADJ-DRIVE-LNE 05210000
051300                          PERFORM 4500-PROCESS-PREPK-BY-LNE       05220000
051400                       ELSE                                       05230000
051500                          SET PS-ODD-UNITS-TRANSACTION-NO TO TRUE 05240000
051600                          PERFORM 8290-PROCESS-PREPK-LINE-CSR     05250000
051700                          PERFORM 8610-PROCESS-ODD-UNT-LINES      05260000
051800                       END-IF                                     05270000
051900                    ELSE                                          05280000
052000                       PERFORM 7800-PROCESS-VERIFY-LINES          05290000
052100                    END-IF                                        05300000
052200                 END-IF                                           05310000
052300         END-EVALUATE.                                            05320000
052400                                                                  05330000
052500     PERFORM 9998-RETURN.                                         05340000
052600                                                                  05350000
052700 1000-SELECT-CONTROL-TMST.                                        05360000
052800     STRING ' 1000-SELECT-CONTROL-TMST'                           05370000
052900         DELIMITED BY SIZE                                        05380000
053000         INTO PV-CICS-MSG-AREA.                                   05390000
053100     PERFORM 9990-WRITE-CICS.                                     05400000
053200     EXEC SQL                                                     05410000
053300          SET :PV-PRC-CNTL-TMST  = CURRENT TIMESTAMP              05420000
053400     END-EXEC.                                                    05430000
053500                                                                  05440000
053600     EVALUATE TRUE                                                05450000
053700         WHEN SQLCODE = ZERO                                      05460000
053800             CONTINUE                                             05470000
053900         WHEN SQLWARN0 NOT = SPACES                               05480000
054000         WHEN SQLCODE NOT EQUAL ZERO                              05490000
054100             MOVE '1000-SELECT-CONTROL-TMST'                      05500000
054200                             TO DP013-PARAGRAPH                   05510000
054300             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        05520000
054400             STRING 'PO NBR: '         DELIMITED BY SIZE          05530000
054500                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          05540000
054600                           INTO DP013-MESSAGE-TEXT(1)             05550000
054700             MOVE DK-RCVR-SEQ-NBR                                 05560000
054800                             TO PV-DISPLAY-RCVR-SEQ-NBR           05570000
054900             STRING 'RECV SEQ: '       DELIMITED BY SIZE          05580000
055000                 PV-DISPLAY-RCVR-SEQ-NBR                          05590000
055100                                       DELIMITED BY SIZE          05600000
055200                           INTO DP013-MESSAGE-TEXT(2)             05610000
055300             MOVE DK-PO-LINE-NBR      TO PV-DISPLAY-PO-LINE-NBR   05620000
055400             STRING 'PO LINE NBR: '    DELIMITED BY SIZE          05630000
055500                PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE          05640000
055600                           INTO DP013-MESSAGE-TEXT(3)             05650000
055700             MOVE SQLCA      TO DP013-SQLCA                       05660000
055800             SET PC238-DB2-FUNCTION-SELECT TO TRUE                05670000
055900             SET PC238-MOD-UNSUCCESSFUL    TO TRUE                05680000
056000             SET DP013-DB2-ABEND                                  05690000
056100                             TO TRUE                              05700000
056200             SET DP013-ROLLBACK                                   05710000
056300                             TO TRUE                              05720000
056400             PERFORM 9999-WRITE-CICS-LOG-MSG                      05730000
056500     END-EVALUATE.                                                05740000
056600                                                                  05750000
056700 2000-PROCESS-ADJUSTMENTS.                                        05760000
056800     STRING ' 2000-PROCESS-ADJUSTMENTS'                           05770000
056900         DELIMITED BY SIZE                                        05780000
057000         INTO PV-CICS-MSG-AREA.                                   05790000
057100     PERFORM 9990-WRITE-CICS.                                     05800000
057200     SET PC238-MOD-SUCCESSFUL TO TRUE.                            05810000
057300                                                                  05820000
057400     IF PC238-MOD-SUCCESSFUL                                      05830000
057500        SET PS-NOT-END-ADJUSTMENTS-TSQ   TO TRUE                  05840000
057600        MOVE +100                        TO PV-MAX-ITEMS          05850000
057700        MOVE +1                          TO PV-SEL-ITEM           05860000
057710* RPK - ADDED CODE FOR PRB42963 - START                           05870000
057720        SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE                 05880000
057730* RPK - ADDED CODE FOR PRB42963 - END                             05890000
057800        PERFORM 2200-READ-TS-QUEUE                                05900000
057900           UNTIL PS-END-ADJUSTMENTS-TSQ OR                        05910000
058000                 PC238-MOD-UNSUCCESSFUL                           05920000
058100     END-IF.                                                      05930000
058200                                                                  05940000
058300******************************************************************05950000
058400 2200-READ-TS-QUEUE.                                              05960000
058500     IF PC238-MOD-SUCCESSFUL                                      05970000
058600       PERFORM 9100-READ-ADJUST-QUEUE                             05980000
058700                                                                  05990000
058800****LOAD AND INSERT 100 STORES AT A TIME                          06000000
058900       PERFORM VARYING RD024-IDX FROM 1 BY 1                      06010000
059000                    UNTIL PS-END-ADJUSTMENTS-TSQ OR               06020000
059100                    RD024-IDX   > PV-MAX-ITEMS                    06030000
059200           MOVE PC241-STR-NBR           TO RD024-STORE            06040000
059300                                          (RD024-IDX)             06050000
059400           IF PS-RATO-QTY-MISMATCH                                06060000
059500               MOVE PC241-STR-ADJ-QTY       TO PV-STR-ADJ-QTY     06070000
059600               COMPUTE PV-STR-ADJ-QTY =                           06080000
059700                          (PV-PREPK-RATO-QTY * PV-STR-ADJ-QTY )   06090000
059800               MOVE PV-STR-ADJ-QTY          TO RD024-STORE-QTY    06100000
059900                                               (RD024-IDX)        06110000
060000           ELSE                                                   06120000
060100               MOVE PC241-STR-ADJ-QTY       TO RD024-STORE-QTY    06130000
060200                                               (RD024-IDX)        06140000
060300           END-IF                                                 06150000
060400                                                                  06160000
060500           IF PC241-STR-ADJ-QTY > 0                               06170000
060600              MOVE   'P'   TO RD024-STORE-QTY-SIGN                06180000
060700                                          (RD024-IDX)             06190000
060800           ELSE                                                   06200000
060900              MOVE   'N'   TO RD024-STORE-QTY-SIGN                06210000
061000                                          (RD024-IDX)             06220000
061100           END-IF                                                 06230000
061200                                                                  06240000
061300           IF RD024-STORE-QTY (RD024-IDX) = 0                     06250000
061400               SET RD024-IDX DOWN BY 1                            06260000
061500               SUBTRACT +1 FROM PV-STORE-COUNT                    06270000
061600           ELSE                                                   06280000
061700               MOVE 'Y' TO PS-AT-LEAST-ONE-STORE                  06290000
061800           END-IF                                                 06300000
061900           ADD +1                       TO PV-SEL-ITEM            06310000
062000                                           PV-STORE-COUNT         06320000
062100           PERFORM 9100-READ-ADJUST-QUEUE                         06330000
062200       END-PERFORM                                                06340000
062300                                                                  06350000
062400       IF AT-LEAST-ONE-STORE                                      06360000
062500         IF PS-END-ADJUSTMENTS-TSQ                                06370000
062600            PERFORM 3200-LOAD-WFT-LOD-XFER                        06380000
062700            PERFORM 3300-INSERT-WFT-LOD-XFER                      06390000
062800            PERFORM 3000-LOAD-WFT-LOD-CNTL                        06400000
062900            PERFORM 3100-INSERT-WFT-LOD-CNTL                      06410000
063000         ELSE                                                     06420000
063060* RPK - ADDED CODE FOR PRB42963 - START                           06430000
063070            SET PS-WROTE-TO-XFER-ONLY TO TRUE                     06440000
063080* RPK - ADDED CODE FOR PRB42963 - END                             06450000
063100            PERFORM 3200-LOAD-WFT-LOD-XFER                        06460000
063200            PERFORM 3300-INSERT-WFT-LOD-XFER                      06470000
063300         END-IF                                                   06480000
063400         MOVE +0 TO PV-STORE-COUNT                                06490000
063401* RPK - ADDED CODE FOR PRB42963 - START                           06500000
063410       ELSE                                                       06510000
063440         IF PS-WROTE-TO-XFER-ONLY                                 06520000
063491            PERFORM 3000-LOAD-WFT-LOD-CNTL                        06530000
063492            PERFORM 3100-INSERT-WFT-LOD-CNTL                      06540000
063493            SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE             06550000
063494         END-IF                                                   06560000
063495* RPK - ADDED CODE FOR PRB42963 - END                             06570000
063500       END-IF                                                     06580000
063600     END-IF.                                                      06590000
063700                                                                  06600000
063800 3000-LOAD-WFT-LOD-CNTL.                                          06610000
063900      MOVE PV-PRC-CNTL-TMST         TO WFT00001-PRC-CNTL-TMST     06620000
064000      EVALUATE TRUE                                               06630000
064100          WHEN PC238-TRANS-TYPE-CDE = PC-B                        06640000
064200          WHEN PC238-TRANS-TYPE-CDE = PC-D                        06650000
064300          WHEN PC238-TRANS-TYPE-CDE = PC-Q                        06660000
064400            IF PC238-VRFY-ADJ-DRIVE-LNE = 'A'                     06670000
064500               MOVE PC-PCKADJ             TO WFT00001-TRN-TYP-CDE 06680000
064600            ELSE                                                  06690000
064700               MOVE PC-SKUADJ             TO WFT00001-TRN-TYP-CDE 06700000
064800            END-IF                                                06710000
064900          WHEN PC238-TRANS-TYPE-CDE = PC-V                        06720000
065000          WHEN PC238-TRANS-TYPE-CDE = PC-X                        06730000
065100            IF PC238-VRFY-ADJ-DRIVE-LNE = 'A'                     06740000
065200               IF PS-ODD-UNITS-TRANSACTION                        06750000
065300                  MOVE PC-SKUVER  TO WFT00001-TRN-TYP-CDE         06760000
065400               ELSE                                               06770000
065500                  MOVE PC-PCKVER  TO WFT00001-TRN-TYP-CDE         06780000
065600               END-IF                                             06790000
065700            ELSE                                                  06800000
065800               MOVE PC-SKUVER             TO WFT00001-TRN-TYP-CDE 06810000
065900            END-IF                                                06820000
066000      END-EVALUATE                                                06830000
066100                                                                  06840000
066200      MOVE PC-READY                 TO WFT00001-STAT-CDE          06850000
066300      MOVE PC-REPOSITORY-DEF-TMST   TO WFT00001-INIT-PRCG-BEG-TMST06860000
066400                                       WFT00001-END-TMST          06870000
066500      MOVE SPACES                   TO WFT00001-ARCH-DAT-IND      06880000
066600      MOVE ZEROES                   TO WFT00001-DAT-LOD-VER-NBR   06890000
066700      MOVE PC-999                   TO WFT00001-STR-NBR.          06900000
066800                                                                  06910000
066900 3100-INSERT-WFT-LOD-CNTL.                                        06920000
067000     STRING '3100-INSERT-WFT-LOD-CNTL'                            06930000
067100         DELIMITED BY SIZE                                        06940000
067200         INTO PV-CICS-MSG-AREA.                                   06950000
067300     PERFORM 9990-WRITE-CICS.                                     06960000
067400     EXEC SQL                                                     06970000
067500        INSERT INTO WFT_LOD_CNTL                                  06980000
067600               ( PRC_CNTL_TMST                                    06990000
067700                ,TRN_TYP_CDE                                      07000000
067800                ,STAT_CDE                                         07010000
067900                ,INIT_PRCG_BEG_TMST                               07020000
068000                ,END_TMST                                         07030000
068100                ,ARCH_DAT_IND                                     07040000
068200                ,DAT_LOD_VER_NBR                                  07050000
068300                ,STR_NBR)                                         07060000
068400        VALUES (:WFT00001-PRC-CNTL-TMST                           07070000
068500              , :WFT00001-TRN-TYP-CDE                             07080000
068600              , :WFT00001-STAT-CDE                                07090000
068700              , :WFT00001-INIT-PRCG-BEG-TMST                      07100000
068800              , :WFT00001-END-TMST                                07110000
068900              , :WFT00001-ARCH-DAT-IND                            07120000
069000              , :WFT00001-DAT-LOD-VER-NBR                         07130000
069100              , :WFT00001-STR-NBR)                                07140000
069200     END-EXEC.                                                    07150000
069300                                                                  07160000
069400     EVALUATE TRUE                                                07170000
069500         WHEN SQLCODE = ZERO                                      07180000
069600             CONTINUE                                             07190000
069700         WHEN SQLWARN0 NOT = SPACES                               07200000
069800         WHEN SQLCODE NOT EQUAL ZERO                              07210000
069900             MOVE '3100-INSERT-WFT-LOD-CNTL'                      07220000
070000                             TO DP013-PARAGRAPH                   07230000
070100             MOVE DK-PO-NBR     TO PV-DISPLAY-PO-NBR              07240000
070200             MOVE DK-RCVR-SEQ-NBR                                 07250000
070300                             TO PV-DISPLAY-RCVR-SEQ-NBR           07260000
070400             MOVE WFT00001-STR-NBR    TO PV-DISPLAY-OPER-UNT-ID   07270000
070500             STRING 'PO NBR: '         DELIMITED BY SIZE          07280000
070600                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          07290000
070700                    ' - RECV SEQ: '    DELIMITED BY SIZE          07300000
070800                 PV-DISPLAY-RCVR-SEQ-NBR                          07310000
070900                                       DELIMITED BY SIZE          07320000
071000                           INTO DP013-MESSAGE-TEXT(1)             07330000
071100             STRING 'WFT STORE  : '    DELIMITED BY SIZE          07340000
071200               PV-DISPLAY-OPER-UNT-ID  DELIMITED BY SIZE          07350000
071300                           INTO DP013-MESSAGE-TEXT(2)             07360000
071400             MOVE SQLCA      TO DP013-SQLCA                       07370000
071500             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 07380000
071600             MOVE 'WFT00001' TO DP013-DB2-TABLE-NAME(1)           07390000
071700                                PC238-BAD-TABLE-NAME              07400000
071800             SET PC238-DB2-FUNCTION-INSERT TO TRUE                07410000
071900             SET PC238-MOD-UNSUCCESSFUL    TO TRUE                07420000
072000             SET DP013-DB2-ABEND                                  07430000
072100                             TO TRUE                              07440000
072200             SET DP013-ROLLBACK                                   07450000
072300                             TO TRUE                              07460000
072400             PERFORM 9999-WRITE-CICS-LOG-MSG                      07470000
072500     END-EVALUATE.                                                07480000
072600                                                                  07490000
072700 3200-LOAD-WFT-LOD-XFER.                                          07500000
072800      MOVE PV-PRC-CNTL-TMST         TO WFT00002-PRC-CNTL-TMST     07510000
072900      EVALUATE TRUE                                               07520000
073000          WHEN PC238-TRANS-TYPE-CDE = PC-B                        07530000
073100          WHEN PC238-TRANS-TYPE-CDE = PC-D                        07540000
073200          WHEN PC238-TRANS-TYPE-CDE = PC-Q                        07550000
073300            IF PC238-VRFY-ADJ-DRIVE-LNE = 'A'                     07560000
073400               MOVE PC-PCKADJ             TO WFT00002-TRN-TYP-CDE 07570000
073500            ELSE                                                  07580000
073600               MOVE PC-SKUADJ             TO WFT00002-TRN-TYP-CDE 07590000
073700            END-IF                                                07600000
073800          WHEN PC238-TRANS-TYPE-CDE = PC-V                        07610000
073900          WHEN PC238-TRANS-TYPE-CDE = PC-X                        07620000
074000            IF PC238-VRFY-ADJ-DRIVE-LNE = 'A'                     07630000
074100               IF PS-ODD-UNITS-TRANSACTION                        07640000
074200                  MOVE PC-SKUVER  TO WFT00002-TRN-TYP-CDE         07650000
074300               ELSE                                               07660000
074400                  MOVE PC-PCKVER  TO WFT00002-TRN-TYP-CDE         07670000
074500               END-IF                                             07680000
074600            ELSE                                                  07690000
074700               MOVE PC-SKUVER             TO WFT00002-TRN-TYP-CDE 07700000
074800            END-IF                                                07710000
074900      END-EVALUATE                                                07720000
075000         MOVE PV-PRC-CNTL-TMST  TO PV-CURRENT-TMST                07730000
075100         MOVE PV-CURR-YYYY      TO PV-CURR-YYYY-VRFD              07740000
075200         MOVE PV-CURR-MM        TO PV-CURR-MM-VRFD                07750000
075300         MOVE PV-CURR-DD        TO PV-CURR-DD-VRFD                07760000
075400         MOVE PV-CURR-HH        TO PV-CURR-HH-VRFD                07770000
075500         MOVE PV-CURR-MN        TO PV-CURR-MN-VRFD                07780000
075600         MOVE PV-CURR-SS        TO PV-CURR-SS-VRFD                07790000
075700                                                                  07800000
075800         MOVE PV-VERFIED-TMST   TO RD024-VRFY-DATE                07810000
075900                                                                  07820000
076000      MOVE PC238-PO-NBR             TO RD024-ORDER-NUMBER         07830000
076100      MOVE PC238-RCVR-SEQ-NBR       TO RD024-RCVR-ID              07840000
076200      IF PC238-DIRECT-STORE-YES                                   07850000
076300          IF PC238-TRANS-TYPE-CDE = PC-B OR PC-D OR PC-Q          07860000
076400              MOVE PC241-STR-NBR        TO RD024-DC               07870000
076500          ELSE                                                    07880000
076600              MOVE RECDIS-STR-NBR       TO RD024-DC               07890000
076700      ELSE                                                        07900000
P5207 *         MOVE PC238-WRKD-OPER-UNT-ID   TO RD024-DC               07910007
P5207           PERFORM 9300-GET-TRECEIV-OPER-UNT-ID                    07911007
P5207           MOVE RECEIV-OPER-UNT-ID       TO RD024-DC               07912007
076900      END-IF                                                      07920000
077000      MOVE PV-SKU-NBR               TO RD024-SKU                  07930000
077100      MOVE PV-STORE-COUNT           TO RD024-STORE-COUNT          07940000
077200                                                                  07950000
077300      ADD +1                        TO PV-BTCH-LOD-SEQ-ID.        07960000
077400      MOVE PV-BTCH-LOD-SEQ-ID       TO WFT00002-BTCH-LOD-SEQ-ID.  07970000
077500                                                                  07980000
077600      COMPUTE PV-LOD-DAT-TXT-LEN = (100 + (14 * PV-STORE-COUNT)). 07990000
077700      MOVE PV-LOD-DAT-TXT-LEN TO WFT00002-LOD-DAT-TXT-LEN.        08000000
077800                                                                  08010000
077900      MOVE RD024-RECEIPT-ADJUSTMENT-REC                           08020000
078000                                TO WFT00002-LOD-DAT-TXT-TEXT.     08030000
078100                                                                  08040000
078200 3300-INSERT-WFT-LOD-XFER.                                        08050000
078300     STRING '3100-INSERT-WFT-LOD-CNTL'                            08060000
078400         DELIMITED BY SIZE                                        08070000
078500         INTO PV-CICS-MSG-AREA.                                   08080000
078600     PERFORM 9990-WRITE-CICS.                                     08090000
078700     EXEC SQL                                                     08100000
078800        INSERT INTO WFT_LOD_XFER                                  08110000
078900               ( PRC_CNTL_TMST                                    08120000
079000                ,TRN_TYP_CDE                                      08130000
079100                ,BTCH_LOD_SEQ_ID                                  08140000
079200                ,LOD_DAT_TXT )                                    08150000
079300        VALUES (:WFT00002-PRC-CNTL-TMST                           08160000
079400               ,:WFT00002-TRN-TYP-CDE                             08170000
079500               ,:WFT00002-BTCH-LOD-SEQ-ID                         08180000
079600               ,:WFT00002-LOD-DAT-TXT)                            08190000
079700     END-EXEC.                                                    08200000
079800                                                                  08210000
079900     EVALUATE TRUE                                                08220000
080000         WHEN SQLCODE = ZERO                                      08230000
080100             CONTINUE                                             08240000
080200         WHEN SQLWARN0 NOT = SPACES                               08250000
080300         WHEN SQLCODE NOT EQUAL ZERO                              08260000
080400             MOVE '3300-INSERT-WFT-LOD-XFER'                      08270000
080500                             TO DP013-PARAGRAPH                   08280000
080600             MOVE DK-PO-NBR     TO PV-DISPLAY-PO-NBR              08290000
080700             MOVE DK-RCVR-SEQ-NBR                                 08300000
080800                             TO PV-DISPLAY-RCVR-SEQ-NBR           08310000
080900             STRING 'PO NBR: '         DELIMITED BY SIZE          08320000
081000                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          08330000
081100                    ' - RECV SEQ: '    DELIMITED BY SIZE          08340000
081200                 PV-DISPLAY-RCVR-SEQ-NBR                          08350000
081300                                       DELIMITED BY SIZE          08360000
081400                           INTO DP013-MESSAGE-TEXT(1)             08370000
081500             STRING 'TRANS TYPE : '    DELIMITED BY SIZE          08380000
081600               WFT00002-TRN-TYP-CDE    DELIMITED BY SIZE          08390000
081700                           INTO DP013-MESSAGE-TEXT(2)             08400000
081800             MOVE SQLCA      TO DP013-SQLCA                       08410000
081900             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 08420000
082000             MOVE 'WFT00002' TO DP013-DB2-TABLE-NAME(1)           08430000
082100                                PC238-BAD-TABLE-NAME              08440000
082200             SET PC238-DB2-FUNCTION-INSERT TO TRUE                08450000
082300             SET PC238-MOD-UNSUCCESSFUL    TO TRUE                08460000
082400             SET DP013-DB2-ABEND                                  08470000
082500                             TO TRUE                              08480000
082600             SET DP013-ROLLBACK                                   08490000
082700                             TO TRUE                              08500000
082800             PERFORM 9999-WRITE-CICS-LOG-MSG                      08510000
082900     END-EVALUATE.                                                08520000
083000                                                                  08530000
083100 4000-CHECK-PREPK-RATIO.                                          08540000
083200     STRING ' 4000-CHECK-PREPK-RATIO'                             08550000
083300         DELIMITED BY SIZE                                        08560000
083400         INTO PV-CICS-MSG-AREA.                                   08570000
083500     PERFORM 9990-WRITE-CICS.                                     08580000
083600     SET PC238-MOD-SUCCESSFUL TO TRUE.                            08590000
083700                                                                  08600000
083800     SET PS-NOT-END-OF-PREPK-RATIO-CSR                            08610000
083900         PS-NO-RATO-QTY-MISMATCH       TO TRUE.                   08620000
084000     PERFORM 4100-OPEN-PREPK-RATIO-CSR                            08630000
084100     PERFORM 4200-FETCH-PREPK-RATIO-CSR                           08640000
084200             UNTIL PS-END-OF-PREPK-RATIO-CSR OR                   08650000
084300                   PS-RATO-QTY-MISMATCH  OR                       08660000
084400                   PC238-MOD-UNSUCCESSFUL                         08670000
084500     PERFORM 4300-CLOSE-PREPK-RATIO-CSR.                          08680000
084600                                                                  08690000
084700                                                                  08700000
084800                                                                  08710000
084900 4100-OPEN-PREPK-RATIO-CSR.                                       08720000
085000     STRING ' 4100-OPEN-PREPK-RATIO-CSR'                          08730000
085100         DELIMITED BY SIZE                                        08740000
085200         INTO PV-CICS-MSG-AREA.                                   08750000
085300     PERFORM 9990-WRITE-CICS.                                     08760000
085400                                                                  08770000
085500     EXEC SQL                                                     08780000
085600          OPEN PREPK-RATIO-CSR                                    08790000
085700     END-EXEC.                                                    08800000
085800                                                                  08810000
085900     EVALUATE TRUE                                                08820000
086000         WHEN SQLCODE = ZERO                                      08830000
086100              CONTINUE                                            08840000
086200         WHEN SQLWARN0 NOT = SPACES                               08850000
086300         WHEN SQLCODE  < ZERO                                     08860000
086400         WHEN SQLCODE  > ZERO                                     08870000
086500              MOVE '4100-OPEN-PREPK-RATIO-CSR'                    08880000
086600                              TO DP013-PARAGRAPH                  08890000
086700              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       08900000
086800              STRING 'PO NBR: '         DELIMITED BY SIZE         08910000
086900                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         08920000
087000                            INTO DP013-MESSAGE-TEXT(1)            08930000
087100              MOVE DK-RCVR-SEQ-NBR                                08940000
087200                              TO PV-DISPLAY-RCVR-SEQ-NBR          08950000
087300              STRING 'RECV SEQ: '       DELIMITED BY SIZE         08960000
087400                  PV-DISPLAY-RCVR-SEQ-NBR                         08970000
087500                                        DELIMITED BY SIZE         08980000
087600                            INTO DP013-MESSAGE-TEXT(2)            08990000
087700              MOVE SQLCA      TO DP013-SQLCA                      09000000
087800             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 09010000
087900              MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)          09020000
088000                                 PC238-BAD-TABLE-NAME             09030000
088100              MOVE 'TPURITM'  TO DP013-DB2-TABLE-NAME(2)          09040000
088200              SET PC238-DB2-FUNCTION-OPEN   TO TRUE               09050000
088300              SET PC238-MOD-UNSUCCESSFUL    TO TRUE               09060000
088400              SET DP013-DB2-ABEND                                 09070000
088500                              TO TRUE                             09080000
088600              SET DP013-ROLLBACK                                  09090000
088700                              TO TRUE                             09100000
088800              PERFORM 9999-WRITE-CICS-LOG-MSG                     09110000
088900     END-EVALUATE.                                                09120000
089000                                                                  09130000
089100 EJECT                                                            09140000
089200                                                                  09150000
089300                                                                  09160000
089400 4200-FETCH-PREPK-RATIO-CSR.                                      09170000
089500     STRING ' 4200-FETCH-PREPK-RATIO-CSR'                         09180000
089600         DELIMITED BY SIZE                                        09190000
089700         INTO PV-CICS-MSG-AREA.                                   09200000
089800     PERFORM 9990-WRITE-CICS.                                     09210000
089900                                                                  09220000
090000     EXEC SQL                                                     09230000
090100          FETCH PREPK-RATIO-CSR                                   09240000
090200           INTO :PV-UNION-TYPE                                    09250000
090300             ,  :PURITM-PREPK-RATO-QTY                            09260000
090400             ,  :PURITM-APP-PO-LNE-NBR                            09270000
090500     END-EXEC.                                                    09280000
090600                                                                  09290000
090700     EVALUATE TRUE                                                09300000
090800         WHEN SQLCODE = ZERO                                      09310000
090900            IF PS-FIRST-FETCH                                     09320000
091000* FIRST LINE CANNOT BE A 'B'                                      09330000
091100               IF PV-UNION-TYPE = 'B'                             09340000
091200                  SET PS-RATO-QTY-MISMATCH  TO TRUE               09350000
091300               ELSE                                               09360000
091400                  MOVE PURITM-PREPK-RATO-QTY TO                   09370000
091500                           PV-PREV-PREPK-RATO-QTY                 09380000
091600                  MOVE PV-UNION-TYPE TO PV-PREV-UNION-TYPE        09390000
091700                  SET PS-NOT-FIRST-FETCH TO TRUE                  09400000
091800               END-IF                                             09410000
091900            ELSE                                                  09420000
092000              IF PV-UNION-TYPE = PV-PREV-UNION-TYPE               09430000
092100                  SET PS-RATO-QTY-MISMATCH  TO TRUE               09440000
092200              ELSE                                                09450000
092300                IF PV-UNION-TYPE = 'B'                            09460000
092400                  IF PURITM-PREPK-RATO-QTY  =                     09470000
092500                                      PV-PREV-PREPK-RATO-QTY      09480000
092600                      MOVE PV-UNION-TYPE  TO PV-PREV-UNION-TYPE   09490000
092700                  ELSE                                            09500000
092800                      SET PS-RATO-QTY-MISMATCH  TO TRUE           09510000
092900                  END-IF                                          09520000
093000                ELSE                                              09530000
093100                  MOVE PV-UNION-TYPE  TO PV-PREV-UNION-TYPE       09540000
093200                  MOVE PURITM-PREPK-RATO-QTY TO                   09550000
093300                                          PV-PREV-PREPK-RATO-QTY  09560000
093400                END-IF                                            09570000
093500              END-IF                                              09580000
093600            END-IF                                                09590000
093700                                                                  09600000
093800         WHEN SQLCODE = +100                                      09610000
093900             IF PV-PREV-UNION-TYPE  = 'A'                         09620000
094000                SET PS-RATO-QTY-MISMATCH  TO TRUE                 09630000
094100             END-IF                                               09640000
094200             SET PS-END-OF-PREPK-RATIO-CSR TO TRUE                09650000
094300         WHEN SQLWARN0 NOT = SPACES                               09660000
094400         WHEN SQLCODE NOT EQUAL ZERO                              09670000
094500             MOVE '4200-FETCH-PREPK-RATIO-CSR'                    09680000
094600                             TO DP013-PARAGRAPH                   09690000
094700             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        09700000
094800             STRING 'PO NBR: '         DELIMITED BY SIZE          09710000
094900                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          09720000
095000                           INTO DP013-MESSAGE-TEXT(1)             09730000
095100             MOVE DK-RCVR-SEQ-NBR                                 09740000
095200                             TO PV-DISPLAY-RCVR-SEQ-NBR           09750000
095300             STRING 'RECV SEQ: '       DELIMITED BY SIZE          09760000
095400                 PV-DISPLAY-RCVR-SEQ-NBR                          09770000
095500                                       DELIMITED BY SIZE          09780000
095600                           INTO DP013-MESSAGE-TEXT(2)             09790000
095700             MOVE DK-PO-LINE-NBR      TO PV-DISPLAY-PO-LINE-NBR   09800000
095800             STRING 'PO LINE NBR: '    DELIMITED BY SIZE          09810000
095900                PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE          09820000
096000                           INTO DP013-MESSAGE-TEXT(3)             09830000
096100             MOVE SQLCA      TO DP013-SQLCA                       09840000
096200             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 09850000
096300             MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME(1)           09860000
096400                                PC238-BAD-TABLE-NAME              09870000
096500             SET PC238-DB2-FUNCTION-FETCH  TO TRUE                09880000
096600             SET PC238-MOD-UNSUCCESSFUL    TO TRUE                09890000
096700             SET DP013-DB2-ABEND                                  09900000
096800                             TO TRUE                              09910000
096900             SET DP013-ROLLBACK                                   09920000
097000                             TO TRUE                              09930000
097100             PERFORM 9999-WRITE-CICS-LOG-MSG                      09940000
097200     END-EVALUATE.                                                09950000
097300                                                                  09960000
097400*----------------------------------------------------------------*09970000
097500* CLOSE THE LINE STORE CURSOR                                  *  09980000
097600*----------------------------------------------------------------*09990000
097700 4300-CLOSE-PREPK-RATIO-CSR.                                      10000000
097800     STRING ' 4300-CLOSE-PREPK-RATIO-CSR'                         10010000
097900         DELIMITED BY SIZE                                        10020000
098000         INTO PV-CICS-MSG-AREA.                                   10030000
098100     PERFORM 9990-WRITE-CICS.                                     10040000
098200                                                                  10050000
098300     EXEC SQL                                                     10060000
098400          CLOSE PREPK-RATIO-CSR                                   10070000
098500     END-EXEC.                                                    10080000
098600                                                                  10090000
098700     EVALUATE TRUE                                                10100000
098800         WHEN SQLCODE = ZERO                                      10110000
098900              CONTINUE                                            10120000
099000         WHEN SQLWARN0 NOT = SPACES                               10130000
099100         WHEN SQLCODE  < ZERO                                     10140000
099200         WHEN SQLCODE  > ZERO                                     10150000
099300              MOVE '4300-CLOSE-PREPK-RATIO-CSR'                   10160000
099400                             TO DP013-PARAGRAPH                   10170000
099500              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       10180000
099600              STRING 'PO NBR: '         DELIMITED BY SIZE         10190000
099700                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         10200000
099800                            INTO DP013-MESSAGE-TEXT(1)            10210000
099900              MOVE DK-RCVR-SEQ-NBR                                10220000
100000                              TO PV-DISPLAY-RCVR-SEQ-NBR          10230000
100100              STRING 'RECV SEQ: '       DELIMITED BY SIZE         10240000
100200                  PV-DISPLAY-RCVR-SEQ-NBR                         10250000
100300                                        DELIMITED BY SIZE         10260000
100400                            INTO DP013-MESSAGE-TEXT(2)            10270000
100500              MOVE DK-PO-LINE-NBR      TO PV-DISPLAY-PO-LINE-NBR  10280000
100600              STRING 'PO LINE NBR: '    DELIMITED BY SIZE         10290000
100700                 PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE         10300000
100800                            INTO DP013-MESSAGE-TEXT(3)            10310000
100900              MOVE SQLCA      TO DP013-SQLCA                      10320000
101000              MOVE SQLCODE    TO PC238-BAD-SQL-CDE                10330000
101100              MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME(1)          10340000
101200                                 PC238-BAD-TABLE-NAME             10350000
101300              SET PC238-DB2-FUNCTION-CLOSE  TO TRUE               10360000
101400              SET PC238-MOD-UNSUCCESSFUL    TO TRUE               10370000
101500              SET DP013-DB2-ABEND                                 10380000
101600                              TO TRUE                             10390000
101700              SET DP013-ROLLBACK                                  10400000
101800                              TO TRUE                             10410000
101900              PERFORM 9999-WRITE-CICS-LOG-MSG                     10420000
102000     END-EVALUATE.                                                10430000
102100                                                                  10440000
102200                                                                  10450000
102300 4500-PROCESS-PREPK-BY-LNE.                                       10460000
102400     STRING ' 4500-PROCESS-PREPK-BY-LNE'                          10470000
102500         DELIMITED BY SIZE                                        10480000
102600         INTO PV-CICS-MSG-AREA.                                   10490000
102700     PERFORM 9990-WRITE-CICS.                                     10500000
102800     SET PC238-MOD-SUCCESSFUL TO TRUE.                            10510000
102900                                                                  10520000
103000     SET PS-NOT-END-OF-PREPK-BY-LNE TO TRUE                       10530000
103100     PERFORM 4600-OPEN-PREPK-BY-LNE                               10540000
103200     PERFORM 4700-FETCH-PREPK-BY-LNE                              10550000
103300             UNTIL PS-END-OF-PREPK-BY-LNE OR                      10560000
103400                   PC238-MOD-UNSUCCESSFUL                         10570000
103500     PERFORM 4800-CLOSE-PREPK-BY-LNE.                             10580000
103600                                                                  10590000
103700                                                                  10600000
103800                                                                  10610000
103900 4600-OPEN-PREPK-BY-LNE.                                          10620000
104000     STRING ' 4600-OPEN-PREPK-BY-LNE'                             10630000
104100         DELIMITED BY SIZE                                        10640000
104200         INTO PV-CICS-MSG-AREA.                                   10650000
104300     PERFORM 9990-WRITE-CICS.                                     10660000
104400                                                                  10670000
104500     EXEC SQL                                                     10680000
104600          OPEN PREPK-BY-LNE-CSR                                   10690000
104700     END-EXEC.                                                    10700000
104800                                                                  10710000
104900     EVALUATE TRUE                                                10720000
105000         WHEN SQLCODE = ZERO                                      10730000
105100              CONTINUE                                            10740000
105200         WHEN SQLWARN0 NOT = SPACES                               10750000
105300         WHEN SQLCODE  < ZERO                                     10760000
105400         WHEN SQLCODE  > ZERO                                     10770000
105500              MOVE '4600-OPEN-PREPK-BY-LNE'                       10780000
105600                              TO DP013-PARAGRAPH                  10790000
105700              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       10800000
105800              STRING 'PO NBR: '         DELIMITED BY SIZE         10810000
105900                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         10820000
106000                            INTO DP013-MESSAGE-TEXT(1)            10830000
106100              MOVE DK-RCVR-SEQ-NBR                                10840000
106200                              TO PV-DISPLAY-RCVR-SEQ-NBR          10850000
106300              STRING 'RECV SEQ: '       DELIMITED BY SIZE         10860000
106400                  PV-DISPLAY-RCVR-SEQ-NBR                         10870000
106500                                        DELIMITED BY SIZE         10880000
106600                            INTO DP013-MESSAGE-TEXT(2)            10890000
106700              MOVE SQLCA      TO DP013-SQLCA                      10900000
106800             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 10910000
106900              MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)          10920000
107000                                 PC238-BAD-TABLE-NAME             10930000
107100              MOVE 'TPURITM'  TO DP013-DB2-TABLE-NAME(2)          10940000
107200              SET PC238-DB2-FUNCTION-OPEN   TO TRUE               10950000
107300              SET PC238-MOD-UNSUCCESSFUL    TO TRUE               10960000
107400              SET DP013-DB2-ABEND                                 10970000
107500                              TO TRUE                             10980000
107600              SET DP013-ROLLBACK                                  10990000
107700                              TO TRUE                             11000000
107800              PERFORM 9999-WRITE-CICS-LOG-MSG                     11010000
107900     END-EVALUATE.                                                11020000
108000                                                                  11030000
108100 EJECT                                                            11040000
108200                                                                  11050000
108300                                                                  11060000
108400 4700-FETCH-PREPK-BY-LNE.                                         11070000
108500     STRING ' 4700-FETCH-PREPK-BY-LNE'                            11080000
108600         DELIMITED BY SIZE                                        11090000
108700         INTO PV-CICS-MSG-AREA.                                   11100000
108800     PERFORM 9990-WRITE-CICS.                                     11110000
108900                                                                  11120000
109000     EXEC SQL                                                     11130000
109100          FETCH PREPK-BY-LNE-CSR                                  11140000
109200           INTO :PV-PREPK-LNE                                     11150000
109300              , :PV-PREPK-RATO-QTY                                11160000
109400              , :RECITM-ITM-NBR                                   11170000
109500     END-EXEC.                                                    11180000
109600                                                                  11190000
109700     EVALUATE TRUE                                                11200000
109800         WHEN SQLCODE = ZERO                                      11210000
109900              MOVE PV-PREPK-LNE TO DK-PO-LINE-NBR                 11220000
110000              IF PC238-TRANS-TYPE-CDE = (PC-V OR PC-X)            11230000
110100                 PERFORM 7800-PROCESS-VERIFY-LINES                11240000
110200              ELSE                                                11250000
110300                 MOVE +0 TO PV-BTCH-LOD-SEQ-ID                    11260000
110400                 PERFORM 1000-SELECT-CONTROL-TMST                 11270000
110500                 PERFORM 6300-SELECT-XLT-SKU                      11280000
110600                 PERFORM 2000-PROCESS-ADJUSTMENTS                 11290000
110700              END-IF                                              11300000
110800         WHEN SQLCODE = +100                                      11310000
110900             SET PS-END-OF-PREPK-BY-LNE TO TRUE                   11320000
111000         WHEN SQLWARN0 NOT = SPACES                               11330000
111100         WHEN SQLCODE NOT EQUAL ZERO                              11340000
111200             MOVE '4700-FETCH-PREPK-BY-LNE'                       11350000
111300                             TO DP013-PARAGRAPH                   11360000
111400             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        11370000
111500             STRING 'PO NBR: '         DELIMITED BY SIZE          11380000
111600                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          11390000
111700                           INTO DP013-MESSAGE-TEXT(1)             11400000
111800             MOVE DK-RCVR-SEQ-NBR                                 11410000
111900                             TO PV-DISPLAY-RCVR-SEQ-NBR           11420000
112000             STRING 'RECV SEQ: '       DELIMITED BY SIZE          11430000
112100                 PV-DISPLAY-RCVR-SEQ-NBR                          11440000
112200                                       DELIMITED BY SIZE          11450000
112300                           INTO DP013-MESSAGE-TEXT(2)             11460000
112400             MOVE DK-PO-LINE-NBR      TO PV-DISPLAY-PO-LINE-NBR   11470000
112500             STRING 'PO LINE NBR: '    DELIMITED BY SIZE          11480000
112600                PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE          11490000
112700                           INTO DP013-MESSAGE-TEXT(3)             11500000
112800             MOVE SQLCA      TO DP013-SQLCA                       11510000
112900             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 11520000
113000             MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME(1)           11530000
113100                                PC238-BAD-TABLE-NAME              11540000
113200             SET PC238-DB2-FUNCTION-FETCH  TO TRUE                11550000
113300             SET PC238-MOD-UNSUCCESSFUL    TO TRUE                11560000
113400             SET DP013-DB2-ABEND                                  11570000
113500                             TO TRUE                              11580000
113600             SET DP013-ROLLBACK                                   11590000
113700                             TO TRUE                              11600000
113800             PERFORM 9999-WRITE-CICS-LOG-MSG                      11610000
113900     END-EVALUATE.                                                11620000
114000                                                                  11630000
114100*----------------------------------------------------------------*11640000
114200* CLOSE THE LINE STORE CURSOR                                  *  11650000
114300*----------------------------------------------------------------*11660000
114400 4800-CLOSE-PREPK-BY-LNE.                                         11670000
114500     STRING ' 4800-CLOSE-PREPK-BY-LNE'                            11680000
114600         DELIMITED BY SIZE                                        11690000
114700         INTO PV-CICS-MSG-AREA.                                   11700000
114800     PERFORM 9990-WRITE-CICS.                                     11710000
114900                                                                  11720000
115000     EXEC SQL                                                     11730000
115100          CLOSE PREPK-BY-LNE-CSR                                  11740000
115200     END-EXEC.                                                    11750000
115300                                                                  11760000
115400     EVALUATE TRUE                                                11770000
115500         WHEN SQLCODE = ZERO                                      11780000
115600              CONTINUE                                            11790000
115700         WHEN SQLWARN0 NOT = SPACES                               11800000
115800         WHEN SQLCODE  < ZERO                                     11810000
115900         WHEN SQLCODE  > ZERO                                     11820000
116000              MOVE '4800-CLOSE-PREPK-BY-LNE'                      11830000
116100                             TO DP013-PARAGRAPH                   11840000
116200              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       11850000
116300              STRING 'PO NBR: '         DELIMITED BY SIZE         11860000
116400                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         11870000
116500                            INTO DP013-MESSAGE-TEXT(1)            11880000
116600              MOVE DK-RCVR-SEQ-NBR                                11890000
116700                              TO PV-DISPLAY-RCVR-SEQ-NBR          11900000
116800              STRING 'RECV SEQ: '       DELIMITED BY SIZE         11910000
116900                  PV-DISPLAY-RCVR-SEQ-NBR                         11920000
117000                                        DELIMITED BY SIZE         11930000
117100                            INTO DP013-MESSAGE-TEXT(2)            11940000
117200              MOVE DK-PO-LINE-NBR      TO PV-DISPLAY-PO-LINE-NBR  11950000
117300              STRING 'PO LINE NBR: '    DELIMITED BY SIZE         11960000
117400                 PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE         11970000
117500                            INTO DP013-MESSAGE-TEXT(3)            11980000
117600              MOVE SQLCA      TO DP013-SQLCA                      11990000
117700              MOVE SQLCODE    TO PC238-BAD-SQL-CDE                12000000
117800              MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME(1)          12010000
117900                                 PC238-BAD-TABLE-NAME             12020000
118000              SET PC238-DB2-FUNCTION-CLOSE  TO TRUE               12030000
118100              SET PC238-MOD-UNSUCCESSFUL    TO TRUE               12040000
118200              SET DP013-DB2-ABEND                                 12050000
118300                              TO TRUE                             12060000
118400              SET DP013-ROLLBACK                                  12070000
118500                              TO TRUE                             12080000
118600              PERFORM 9999-WRITE-CICS-LOG-MSG                     12090000
118700     END-EVALUATE.                                                12100000
118800                                                                  12110000
118900                                                                  12120000
119000 6000-GET-RECITM.                                                 12130000
119100     STRING ' 6000-GET-RECITM '                                   12140000
119200         DELIMITED BY SIZE                                        12150000
119300         INTO PV-CICS-MSG-AREA.                                   12160000
119400     PERFORM 9990-WRITE-CICS.                                     12170000
119500                                                                  12180000
119600     MOVE PC238-PO-NBR        TO DK-PO-NBR                        12190000
119700     MOVE PC238-RCVR-SEQ-NBR  TO DK-RCVR-SEQ-NBR                  12200000
119800     MOVE PC238-PO-LNE-NBR    TO DK-PO-LINE-NBR                   12210000
119900                                                                  12220000
120000     EXEC SQL                                                     12230000
120100          SELECT PREPK_ID                                         12240000
120200                ,ITM_NBR                                          12250000
120300                ,PREPK_DRV_LNE_CDE                                12260000
120400           INTO  :RECITM-PREPK-ID                                 12270000
120500                ,:RECITM-ITM-NBR                                  12280000
120600                ,:RECITM-PREPK-DRV-LNE-CDE                        12290000
120700            FROM TRECITM                                          12300000
120800           WHERE ORD_NBR             = :DK-PO-NBR                 12310000
120900             AND REC_SEQ_NBR         = :DK-RCVR-SEQ-NBR           12320000
121000             AND ORD_LNE_NBR         = :DK-PO-LINE-NBR            12330000
121100     END-EXEC.                                                    12340000
121200                                                                  12350000
121300     EVALUATE TRUE                                                12360000
121400         WHEN SQLCODE = ZERO                                      12370000
121500             CONTINUE                                             12380000
121600         WHEN SQLWARN0 NOT = SPACES                               12390000
121700         WHEN SQLCODE NOT EQUAL ZERO                              12400000
121800             MOVE '6000-GET-RECITM'                               12410000
121900                             TO DP013-PARAGRAPH                   12420000
122000             MOVE DK-PO-NBR        TO PV-DISPLAY-PO-NBR           12430000
122100             MOVE DK-RCVR-SEQ-NBR  TO PV-DISPLAY-RCVR-SEQ-NBR     12440000
122200             MOVE DK-PO-LINE-NBR   TO PV-DISPLAY-PO-LINE-NBR      12450000
122300             STRING 'PO NBR: '                                    12460000
122400                 PV-DISPLAY-PO-NBR    DELIMITED BY SIZE           12470000
122500                                 INTO DP013-MESSAGE-TEXT(1)       12480000
122600             STRING 'RECV SEQ: '                                  12490000
122700                 PV-DISPLAY-RCVR-SEQ-NBR                          12500000
122800                                      DELIMITED BY SIZE           12510000
122900                                 INTO DP013-MESSAGE-TEXT(2)       12520000
123000             STRING 'PO LINE NBR: '   DELIMITED BY SIZE           12530000
123100                PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE          12540000
123200                                 INTO DP013-MESSAGE-TEXT(3)       12550000
123300             MOVE SQLCA      TO DP013-SQLCA                       12560000
123400             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 12570000
123500             MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME(1)           12580000
123600                                PC238-BAD-TABLE-NAME              12590000
123700             SET PC238-DB2-FUNCTION-SELECT TO TRUE                12600000
123800             SET PC238-MOD-UNSUCCESSFUL    TO TRUE                12610000
123900             SET DP013-DB2-ABEND           TO TRUE                12620000
124000             SET DP013-ROLLBACK            TO TRUE                12630000
124100             PERFORM 9999-WRITE-CICS-LOG-MSG                      12640000
124200     END-EVALUATE.                                                12650000
124300                                                                  12660000
124400 6100-GET-SKU.                                                    12670000
124500                                                                  12680000
124600      IF PC238-VRFY-ADJ-DRIVE-LNE = 'A'                           12690000
124700         PERFORM 4000-CHECK-PREPK-RATIO                           12700000
124800         IF PS-RATO-QTY-MISMATCH                                  12710000
124900            CONTINUE                                              12720000
125000         ELSE                                                     12730000
125100            PERFORM 6200-SELECT-TPOPRPK                           12740000
125200         END-IF                                                   12750000
125300      ELSE                                                        12760000
125400         PERFORM 6300-SELECT-XLT-SKU                              12770000
125500      END-IF.                                                     12780000
125600                                                                  12790000
125700                                                                  12800000
125800 6200-SELECT-TPOPRPK.                                             12810000
125900     STRING ' 6200-SELECT-TPOPRPK'                                12820000
126000         DELIMITED BY SIZE                                        12830000
126100         INTO PV-CICS-MSG-AREA.                                   12840000
126200     PERFORM 9990-WRITE-CICS.                                     12850000
126300                                                                  12860000
126400     EXEC SQL                                                     12870000
126500          SELECT PK_SKU_NBR                                       12880000
126600           INTO  :POPRPK-PK-SKU-NBR                               12890000
126700            FROM TPOPRPK                                          12900000
126800           WHERE PO_NBR              = :DK-PO-NBR                 12910000
126900             AND PO_PREPK_ID         = :RECITM-PREPK-ID           12920000
127000     END-EXEC.                                                    12930000
127100                                                                  12940000
127200     EVALUATE TRUE                                                12950000
127300         WHEN SQLCODE = ZERO                                      12960000
127400             MOVE POPRPK-PK-SKU-NBR  TO PV-SKU-NBR                12970000
127500         WHEN SQLWARN0 NOT = SPACES                               12980000
127600         WHEN SQLCODE NOT EQUAL ZERO                              12990000
127700             MOVE '6200-SELECT-TPOPRPK'                           13000000
127800                             TO DP013-PARAGRAPH                   13010000
127900             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        13020000
128000             STRING 'PO NBR: '         DELIMITED BY SIZE          13030000
128100                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          13040000
128200                           INTO DP013-MESSAGE-TEXT(1)             13050000
128300             MOVE RECITM-PREPK-ID                                 13060000
128400                             TO PV-DISPLAY-PREPK-ID               13070000
128500             STRING 'PREPK ID: '       DELIMITED BY SIZE          13080000
128600                 PV-DISPLAY-PREPK-ID                              13090000
128700                                       DELIMITED BY SIZE          13100000
128800                           INTO DP013-MESSAGE-TEXT(2)             13110000
128900             MOVE SQLCA      TO DP013-SQLCA                       13120000
129000             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 13130000
129100             MOVE 'TPOPRPK ' TO DP013-DB2-TABLE-NAME(1)           13140000
129200                                PC238-BAD-TABLE-NAME              13150000
129300             SET PC238-DB2-FUNCTION-SELECT TO TRUE                13160000
129400             SET PC238-MOD-UNSUCCESSFUL    TO TRUE                13170000
129500             SET DP013-DB2-ABEND                                  13180000
129600                             TO TRUE                              13190000
129700             SET DP013-ROLLBACK                                   13200000
129800                             TO TRUE                              13210000
129900             PERFORM 9999-WRITE-CICS-LOG-MSG                      13220000
130000     END-EVALUATE.                                                13230000
130100                                                                  13240000
130200 6300-SELECT-XLT-SKU.                                             13250000
130300     STRING ' 6300-SELECT-XLT-SKU'                                13260000
130400         DELIMITED BY SIZE                                        13270000
130500         INTO PV-CICS-MSG-AREA.                                   13280000
130600     PERFORM 9990-WRITE-CICS.                                     13290000
130700                                                                  13300000
130800     EXEC SQL                                                     13310000
130900          SELECT SKU_NBR                                          13320000
131000           INTO  :XLT00003-SKU-NBR                                13330000
131100            FROM XLT_SKU                                          13340000
131200           WHERE ITM_NBR             = :RECITM-ITM-NBR            13350000
131300     END-EXEC.                                                    13360000
131400                                                                  13370000
131500     EVALUATE TRUE                                                13380000
131600         WHEN SQLCODE = ZERO                                      13390000
131700             MOVE XLT00003-SKU-NBR  TO PV-SKU-NBR                 13400000
131800         WHEN SQLWARN0 NOT = SPACES                               13410000
131900         WHEN SQLCODE NOT EQUAL ZERO                              13420000
132000             MOVE '6300-SELECT-XLT-SKU'                           13430000
132100                             TO DP013-PARAGRAPH                   13440000
132200             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        13450000
132300             STRING 'PO NBR: '         DELIMITED BY SIZE          13460000
132400                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          13470000
132500                           INTO DP013-MESSAGE-TEXT(1)             13480000
132600             MOVE RECITM-ITM-NBR                                  13490000
132700                             TO PV-DISPLAY-ITEM-NBR               13500000
132800             STRING 'ITEM NBR: '       DELIMITED BY SIZE          13510000
132900                 PV-DISPLAY-ITEM-NBR                              13520000
133000                                       DELIMITED BY SIZE          13530000
133100                           INTO DP013-MESSAGE-TEXT(2)             13540000
133200             MOVE SQLCA      TO DP013-SQLCA                       13550000
133300             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 13560000
133400             MOVE 'XLT_SKU ' TO DP013-DB2-TABLE-NAME(1)           13570000
133500                                PC238-BAD-TABLE-NAME              13580000
133600             SET PC238-DB2-FUNCTION-SELECT TO TRUE                13590000
133700             SET PC238-MOD-UNSUCCESSFUL    TO TRUE                13600000
133800             SET DP013-DB2-ABEND                                  13610000
133900                             TO TRUE                              13620000
134000             SET DP013-ROLLBACK                                   13630000
134100                             TO TRUE                              13640000
134200             PERFORM 9999-WRITE-CICS-LOG-MSG                      13650000
134300     END-EVALUATE.                                                13660000
134400                                                                  13670000
134500 6350-SELECT-LINE-SKU.                                            13680000
134600     STRING '6350-SELECT-LINE-SKU'                                13690000
134700         DELIMITED BY SIZE                                        13700000
134800         INTO PV-CICS-MSG-AREA.                                   13710000
134900     PERFORM 9990-WRITE-CICS.                                     13720000
135000                                                                  13730000
135100     EXEC SQL                                                     13740000
135200          SELECT SKU_NBR                                          13750000
135300           INTO  :XLT00003-SKU-NBR                                13760000
135400           FROM  TRECITM A                                        13770000
135500              ,  XLT_SKU C                                        13780000
135600           WHERE A.ORD_NBR        = :DK-PO-NBR                    13790000
135700             AND A.REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR              13800000
135800             AND A.ORD_LNE_NBR    = :DK-PO-LINE-NBR               13810000
135900             AND A.ITM_NBR        = C.ITM_NBR                     13820000
136000     END-EXEC                                                     13830000
136100                                                                  13840000
136200     EVALUATE TRUE                                                13850000
136300         WHEN SQLCODE = ZERO                                      13860000
136400             MOVE XLT00003-SKU-NBR  TO PV-SKU-NBR                 13870000
136500         WHEN SQLWARN0 NOT = SPACES                               13880000
136600         WHEN SQLCODE NOT EQUAL ZERO                              13890000
136700             MOVE '6350-SELECT-LINE-SKU'                          13900000
136800                             TO DP013-PARAGRAPH                   13910000
136900             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        13920000
137000             STRING 'PO NBR: '         DELIMITED BY SIZE          13930000
137100                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          13940000
137200                           INTO DP013-MESSAGE-TEXT(1)             13950000
137300             MOVE RECITM-ITM-NBR                                  13960000
137400                             TO PV-DISPLAY-ITEM-NBR               13970000
137500             STRING 'ITEM NBR: '       DELIMITED BY SIZE          13980000
137600                 PV-DISPLAY-ITEM-NBR                              13990000
137700                                       DELIMITED BY SIZE          14000000
137800                           INTO DP013-MESSAGE-TEXT(2)             14010000
137900             MOVE SQLCA      TO DP013-SQLCA                       14020000
138000             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 14030000
138100             MOVE 'XLT_SKU ' TO DP013-DB2-TABLE-NAME(1)           14040000
138200                                PC238-BAD-TABLE-NAME              14050000
138300             SET PC238-DB2-FUNCTION-SELECT TO TRUE                14060000
138400             SET PC238-MOD-UNSUCCESSFUL    TO TRUE                14070000
138500             SET DP013-DB2-ABEND                                  14080000
138600                             TO TRUE                              14090000
138700             SET DP013-ROLLBACK                                   14100000
138800                             TO TRUE                              14110000
138900             PERFORM 9999-WRITE-CICS-LOG-MSG                      14120000
139000     END-EVALUATE.                                                14130000
139100                                                                  14140000
139200 6400-CHECK-FOR-PREPK.                                            14150000
139300     STRING ' 6400-CHECK-FOR-PREPK'                               14160000
139400         DELIMITED BY SIZE                                        14170000
139500         INTO PV-CICS-MSG-AREA.                                   14180000
139600     PERFORM 9990-WRITE-CICS.                                     14190000
139700                                                                  14200000
139800     EXEC SQL                                                     14210000
139900        SELECT A.PREPK_ID                                         14220000
140000        INTO   :RECITM-PREPK-ID                                   14230000
140100        FROM   TRECITM A                                          14240000
140200            ,  TPURITM B                                          14250000
140300         WHERE A.ORD_NBR     = :DK-PO-NBR                         14260000
140400           AND A.REC_SEQ_NBR = :DK-RCVR-SEQ-NBR                   14270000
140500           AND A.ORD_LNE_NBR = :DK-PO-LINE-NBR                    14280000
140600           AND A.ORD_NBR     = B.PO_NBR                           14290000
140700           AND A.ORD_LNE_NBR = B.APP_PO_LNE_NBR                   14300000
140800           AND A.PO_VER_NBR  = B.VER_NBR                          14310000
140900           AND A.VER_STATUS_CDE = 'A'                             14320000
141000     END-EXEC.                                                    14330000
141100                                                                  14340000
141200     EVALUATE TRUE                                                14350000
141300         WHEN SQLCODE = ZERO                                      14360000
141400         WHEN SQLCODE = -811                                      14370000
141500              IF RECITM-PREPK-ID > 0                              14380000
141600                 SET PS-PREPK-PO-FOUND TO TRUE                    14390000
141700              ELSE                                                14400000
141800                 SET PS-PREPK-PO-NOT-FOUND TO TRUE                14410000
141900              END-IF                                              14420000
142000         WHEN SQLWARN0 NOT = SPACES                               14430000
142100         WHEN SQLCODE NOT EQUAL ZERO                              14440000
142200             MOVE '6400-CHECK-FOR-PREPK'                          14450000
142300                             TO DP013-PARAGRAPH                   14460000
142400             MOVE DK-PO-NBR        TO PV-DISPLAY-PO-NBR           14470000
142500             MOVE DK-RCVR-SEQ-NBR  TO PV-DISPLAY-RCVR-SEQ-NBR     14480000
142600             MOVE DK-PO-LINE-NBR   TO PV-DISPLAY-PO-LINE-NBR      14490000
142700             STRING 'PO NBR: '                                    14500000
142800                 PV-DISPLAY-PO-NBR    DELIMITED BY SIZE           14510000
142900                                 INTO DP013-MESSAGE-TEXT(1)       14520000
143000             STRING 'RECV SEQ: '                                  14530000
143100                 PV-DISPLAY-RCVR-SEQ-NBR                          14540000
143200                                      DELIMITED BY SIZE           14550000
143300                                 INTO DP013-MESSAGE-TEXT(2)       14560000
143400             STRING 'PO LINE NBR: '   DELIMITED BY SIZE           14570000
143500                PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE          14580000
143600                                 INTO DP013-MESSAGE-TEXT(3)       14590000
143700             MOVE SQLCA      TO DP013-SQLCA                       14600000
143800             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 14610000
143900             MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME(1)           14620000
144000                                PC238-BAD-TABLE-NAME              14630000
144100             SET PC238-DB2-FUNCTION-SELECT TO TRUE                14640000
144200             SET PC238-MOD-UNSUCCESSFUL    TO TRUE                14650000
144300             SET DP013-DB2-ABEND           TO TRUE                14660000
144400             SET DP013-ROLLBACK            TO TRUE                14670000
144500             PERFORM 9999-WRITE-CICS-LOG-MSG                      14680000
144600     END-EVALUATE.                                                14690000
144700                                                                  14700000
144800 7800-PROCESS-VERIFY-LINES.                                       14710000
144900     STRING ' 7800-PROCESS-VERIFY '                               14720000
145000         DELIMITED BY SIZE                                        14730000
145100         INTO PV-CICS-MSG-AREA.                                   14740000
145200     PERFORM 9990-WRITE-CICS.                                     14750000
145300     SET PC238-MOD-SUCCESSFUL TO TRUE.                            14760000
145400                                                                  14770000
145500     SET PS-NOT-END-OF-LINE-STORE-CSR                             14780000
145600         PS-FIRST-FETCH                TO TRUE                    14790000
145610* RPK - ADDED CODE FOR PRB42963 - START                           14800000
145620     SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE                    14810000
145630* RPK - ADDED CODE FOR PRB42963 - END                             14820000
145700     PERFORM 7900-OPEN-LINE-STORE-CSR                             14830000
145800     PERFORM 8000-FETCH-LINE-STORE-CSR                            14840000
145900     PERFORM 8200-LOAD-VERIFIED-RECEIPTS                          14850000
146000             UNTIL PS-END-OF-LINE-STORE-CSR OR                    14860000
146100                   PC238-MOD-UNSUCCESSFUL                         14870000
146200     PERFORM 8100-CLOSE-LINE-STORE-CSR.                           14880000
146300                                                                  14890000
146400                                                                  14900000
146500                                                                  14910000
146600 7900-OPEN-LINE-STORE-CSR.                                        14920000
146700     STRING ' 7900-OPEN-LINE-STORE-CSR'                           14930000
146800         DELIMITED BY SIZE                                        14940000
146900         INTO PV-CICS-MSG-AREA.                                   14950000
147000     PERFORM 9990-WRITE-CICS.                                     14960000
147100                                                                  14970000
147200     EXEC SQL                                                     14980000
147300          OPEN LINE-STORE-CSR                                     14990000
147400     END-EXEC.                                                    15000000
147500                                                                  15010000
147600     EVALUATE TRUE                                                15020000
147700         WHEN SQLCODE = ZERO                                      15030000
147800              CONTINUE                                            15040000
147900         WHEN SQLWARN0 NOT = SPACES                               15050000
148000         WHEN SQLCODE  < ZERO                                     15060000
148100         WHEN SQLCODE  > ZERO                                     15070000
148200              MOVE '7900-OPEN-LINE-STORE-CSR'                     15080000
148300                              TO DP013-PARAGRAPH                  15090000
148400              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       15100000
148500              STRING 'PO NBR: '         DELIMITED BY SIZE         15110000
148600                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         15120000
148700                            INTO DP013-MESSAGE-TEXT(1)            15130000
148800              MOVE DK-RCVR-SEQ-NBR                                15140000
148900                              TO PV-DISPLAY-RCVR-SEQ-NBR          15150000
149000              STRING 'RECV SEQ: '       DELIMITED BY SIZE         15160000
149100                  PV-DISPLAY-RCVR-SEQ-NBR                         15170000
149200                                        DELIMITED BY SIZE         15180000
149300                            INTO DP013-MESSAGE-TEXT(2)            15190000
149400              MOVE SQLCA      TO DP013-SQLCA                      15200000
149500             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 15210000
149600              MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)          15220000
149700                                 PC238-BAD-TABLE-NAME             15230000
149800              MOVE 'TPURITM'  TO DP013-DB2-TABLE-NAME(2)          15240000
149900              SET PC238-DB2-FUNCTION-OPEN   TO TRUE               15250000
150000              SET PC238-MOD-UNSUCCESSFUL    TO TRUE               15260000
150100              SET DP013-DB2-ABEND                                 15270000
150200                              TO TRUE                             15280000
150300              SET DP013-ROLLBACK                                  15290000
150400                              TO TRUE                             15300000
150500              PERFORM 9999-WRITE-CICS-LOG-MSG                     15310000
150600     END-EVALUATE.                                                15320000
150700                                                                  15330000
150800 EJECT                                                            15340000
150900                                                                  15350000
151000                                                                  15360000
151100 8000-FETCH-LINE-STORE-CSR.                                       15370000
151200     STRING ' 8000-FETCH-LINE-STORE-CSR'                          15380000
151300         DELIMITED BY SIZE                                        15390000
151400         INTO PV-CICS-MSG-AREA.                                   15400000
151500     PERFORM 9990-WRITE-CICS.                                     15410000
151600                                                                  15420000
151700     EXEC SQL                                                     15430000
151800          FETCH LINE-STORE-CSR                                    15440000
151900           INTO :RECITM-ORD-LNE-NBR                               15450000
152000             ,  :RECDIS-STR-NBR                                   15460000
152100             ,  :RECDIS-AP-VERIFY-ITM-QTY                         15470000
152200             ,  :RECDIS-VERIFY-ITM-QTY                            15480000
152300             ,  :RECITM-ITM-NBR                                   15490000
152400             ,  :RECITM-VERFYD-TMST                               15500000
152500     END-EXEC.                                                    15510000
152600                                                                  15520000
152700     EVALUATE TRUE                                                15530000
152800         WHEN SQLCODE = ZERO                                      15540000
152900             IF PS-FIRST-FETCH                                    15550000
153000                SET PS-NOT-FIRST-FETCH TO TRUE                    15560000
153100                MOVE RECITM-ORD-LNE-NBR TO PV-PO-LNE-HOLD         15570000
153200                MOVE RECITM-VERFYD-TMST  TO PV-CURRENT-TMST       15580000
153300                PERFORM 1000-SELECT-CONTROL-TMST                  15590000
153400                PERFORM 6300-SELECT-XLT-SKU                       15600000
153500             END-IF                                               15610000
153600         WHEN SQLCODE = +100                                      15620000
153700             SET PS-END-OF-LINE-STORE-CSR TO TRUE                 15630000
153800             IF PS-NOT-FIRST-FETCH                                15640000
153900                MOVE ZEROES TO PV-PO-LNE-HOLD                     15650000
154000             END-IF                                               15660000
154100         WHEN SQLWARN0 NOT = SPACES                               15670000
154200         WHEN SQLCODE NOT EQUAL ZERO                              15680000
154300             MOVE '8000-FETCH-LINE-STORE-CSR'                     15690000
154400                             TO DP013-PARAGRAPH                   15700000
154500             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        15710000
154600             STRING 'PO NBR: '         DELIMITED BY SIZE          15720000
154700                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          15730000
154800                           INTO DP013-MESSAGE-TEXT(1)             15740000
154900             MOVE DK-RCVR-SEQ-NBR                                 15750000
155000                             TO PV-DISPLAY-RCVR-SEQ-NBR           15760000
155100             STRING 'RECV SEQ: '       DELIMITED BY SIZE          15770000
155200                 PV-DISPLAY-RCVR-SEQ-NBR                          15780000
155300                                       DELIMITED BY SIZE          15790000
155400                           INTO DP013-MESSAGE-TEXT(2)             15800000
155500             MOVE DK-PO-LINE-NBR      TO PV-DISPLAY-PO-LINE-NBR   15810000
155600             STRING 'PO LINE NBR: '    DELIMITED BY SIZE          15820000
155700                PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE          15830000
155800                           INTO DP013-MESSAGE-TEXT(3)             15840000
155900             MOVE SQLCA      TO DP013-SQLCA                       15850000
156000             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 15860000
156100             MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME(1)           15870000
156200                                PC238-BAD-TABLE-NAME              15880000
156300             SET PC238-DB2-FUNCTION-FETCH  TO TRUE                15890000
156400             SET PC238-MOD-UNSUCCESSFUL    TO TRUE                15900000
156500             SET DP013-DB2-ABEND                                  15910000
156600                             TO TRUE                              15920000
156700             SET DP013-ROLLBACK                                   15930000
156800                             TO TRUE                              15940000
156900             PERFORM 9999-WRITE-CICS-LOG-MSG                      15950000
157000     END-EVALUATE.                                                15960000
157100                                                                  15970000
157200*----------------------------------------------------------------*15980000
157300* CLOSE THE LINE STORE CURSOR                                  *  15990000
157400*----------------------------------------------------------------*16000000
157500 8100-CLOSE-LINE-STORE-CSR.                                       16010000
157600     STRING ' 8100-CLOSE-LINE-STORE-CSR'                          16020000
157700         DELIMITED BY SIZE                                        16030000
157800         INTO PV-CICS-MSG-AREA.                                   16040000
157900     PERFORM 9990-WRITE-CICS.                                     16050000
158000                                                                  16060000
158100     EXEC SQL                                                     16070000
158200          CLOSE LINE-STORE-CSR                                    16080000
158300     END-EXEC.                                                    16090000
158400                                                                  16100000
158500     EVALUATE TRUE                                                16110000
158600         WHEN SQLCODE = ZERO                                      16120000
158700              CONTINUE                                            16130000
158800         WHEN SQLWARN0 NOT = SPACES                               16140000
158900         WHEN SQLCODE  < ZERO                                     16150000
159000         WHEN SQLCODE  > ZERO                                     16160000
159100              MOVE '8100-CLOSE-LINE-STORE-CSR'                    16170000
159200                             TO DP013-PARAGRAPH                   16180000
159300              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       16190000
159400              STRING 'PO NBR: '         DELIMITED BY SIZE         16200000
159500                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         16210000
159600                            INTO DP013-MESSAGE-TEXT(1)            16220000
159700              MOVE DK-RCVR-SEQ-NBR                                16230000
159800                              TO PV-DISPLAY-RCVR-SEQ-NBR          16240000
159900              STRING 'RECV SEQ: '       DELIMITED BY SIZE         16250000
160000                  PV-DISPLAY-RCVR-SEQ-NBR                         16260000
160100                                        DELIMITED BY SIZE         16270000
160200                            INTO DP013-MESSAGE-TEXT(2)            16280000
160300              MOVE DK-PO-LINE-NBR      TO PV-DISPLAY-PO-LINE-NBR  16290000
160400              STRING 'PO LINE NBR: '    DELIMITED BY SIZE         16300000
160500                 PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE         16310000
160600                            INTO DP013-MESSAGE-TEXT(3)            16320000
160700              MOVE SQLCA      TO DP013-SQLCA                      16330000
160800              MOVE SQLCODE    TO PC238-BAD-SQL-CDE                16340000
160900              MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME(1)          16350000
161000                                 PC238-BAD-TABLE-NAME             16360000
161100              SET PC238-DB2-FUNCTION-CLOSE  TO TRUE               16370000
161200              SET PC238-MOD-UNSUCCESSFUL    TO TRUE               16380000
161300              SET DP013-DB2-ABEND                                 16390000
161400                              TO TRUE                             16400000
161500              SET DP013-ROLLBACK                                  16410000
161600                              TO TRUE                             16420000
161700              PERFORM 9999-WRITE-CICS-LOG-MSG                     16430000
161800     END-EVALUATE.                                                16440000
161900                                                                  16450000
162000                                                                  16460000
162100 8200-LOAD-VERIFIED-RECEIPTS.                                     16470000
162200       MOVE +100 TO PV-MAX-ITEMS                                  16480000
162300       PERFORM VARYING RD024-IDX FROM 1 BY 1                      16490000
162400                    UNTIL RD024-IDX > PV-MAX-ITEMS OR             16500000
162500                    PS-NEW-LINE-FOUND                             16510000
162600           MOVE RECDIS-STR-NBR  TO       RD024-STORE              16520000
162700                                          (RD024-IDX)             16530000
162800           IF PC238-TRANS-LINE-VERIFY                             16540000
162900               MOVE RECDIS-AP-VERIFY-ITM-QTY TO RD024-STORE-QTY   16550000
163000                                          (RD024-IDX)             16560000
163100              MOVE   'P'   TO RD024-STORE-QTY-SIGN                16570000
163200                                          (RD024-IDX)             16580000
163300           ELSE                                                   16590000
163400               MOVE RECDIS-VERIFY-ITM-QTY TO RD024-STORE-QTY      16600000
163500                                          (RD024-IDX)             16610000
163600              MOVE   'N'   TO RD024-STORE-QTY-SIGN                16620000
163700                                          (RD024-IDX)             16630000
163800           END-IF                                                 16640000
163900           IF RD024-STORE-QTY (RD024-IDX) = 0                     16650000
164000               SET RD024-IDX DOWN BY 1                            16660000
164100               SUBTRACT +1 FROM PV-STORE-COUNT                    16670000
164200           ELSE                                                   16680000
164300               MOVE 'Y' TO PS-AT-LEAST-ONE-STORE                  16690000
164400           END-IF                                                 16700000
164500           PERFORM 8000-FETCH-LINE-STORE-CSR                      16710000
164600           IF RECITM-ORD-LNE-NBR  > PV-PO-LNE-HOLD                16720000
164700              SET PS-NEW-LINE-FOUND TO TRUE                       16730000
164800           END-IF                                                 16740000
164900           ADD +1    TO PV-STORE-COUNT                            16750000
165000       END-PERFORM.                                               16760000
165100                                                                  16770000
165200     IF AT-LEAST-ONE-STORE                                        16780000
165300       IF PS-NEW-LINE-FOUND                                       16790000
165400          PERFORM 3200-LOAD-WFT-LOD-XFER                          16800000
165500          PERFORM 3300-INSERT-WFT-LOD-XFER                        16810000
165600          PERFORM 3000-LOAD-WFT-LOD-CNTL                          16820000
165700          PERFORM 3100-INSERT-WFT-LOD-CNTL                        16830000
165800                                                                  16840000
165900                                                                  16850000
166000          MOVE +0 TO PV-BTCH-LOD-SEQ-ID                           16860000
166100          PERFORM 1000-SELECT-CONTROL-TMST                        16870000
166200          PERFORM 6300-SELECT-XLT-SKU                             16880000
166300          SET PS-NO-NEW-LINE-FOUND TO TRUE                        16890000
166400          MOVE RECITM-ORD-LNE-NBR TO PV-PO-LNE-HOLD               16900000
166500       ELSE                                                       16910000
166551* RPK - ADDED CODE FOR PRB42963 - START                           16920000
166560          SET PS-WROTE-TO-XFER-ONLY TO TRUE                       16930000
166570* RPK - ADDED CODE FOR PRB42963 - END                             16940000
166600          PERFORM 3200-LOAD-WFT-LOD-XFER                          16950000
166700          PERFORM 3300-INSERT-WFT-LOD-XFER                        16960000
166800       END-IF                                                     16970000
166900                                                                  16980000
167000       MOVE +0    TO PV-STORE-COUNT                               16990000
167100       SET RD024-IDX  TO +1                                       17000000
167200       MOVE 'N' TO PS-AT-LEAST-ONE-STORE                          17010000
167300     ELSE                                                         17020000
167400       IF PS-NEW-LINE-FOUND                                       17030000
167500          SET PS-NO-NEW-LINE-FOUND TO TRUE                        17040000
167501* RPK - ADDED CODE FOR PRB42963 - START                           17050000
167510          IF PS-WROTE-TO-XFER-ONLY                                17060000
167516             PERFORM 3000-LOAD-WFT-LOD-CNTL                       17070000
167517             PERFORM 3100-INSERT-WFT-LOD-CNTL                     17080000
167518             SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE            17090000
167600          END-IF                                                  17100000
167601* RPK - ADDED CODE FOR PRB42963 - END                             17110000
167610       END-IF                                                     17120000
167700     END-IF.                                                      17130000
167800                                                                  17140000
167900 8290-PROCESS-PREPK-LINE-CSR.                                     17150000
168000     STRING '8290-PROCESS-PREPK-LINE-CSR'                         17160000
168100         DELIMITED BY SIZE                                        17170000
168200         INTO PV-CICS-MSG-AREA.                                   17180000
168300     PERFORM 9990-WRITE-CICS.                                     17190000
168400     SET PC238-MOD-SUCCESSFUL TO TRUE.                            17200000
168500                                                                  17210000
168600     SET PS-NOT-END-OF-PREPK-LINE-CSR                             17220000
168700         PS-FIRST-FETCH               TO TRUE                     17230000
168800     MOVE 'N' TO PS-AT-LEAST-ONE-STORE                            17240000
168900     PERFORM 8300-OPEN-PREPK-LINE-CSR                             17250000
169000     PERFORM 8400-FETCH-PREPK-LINE-CSR                            17260000
169100             UNTIL PS-END-OF-PREPK-LINE-CSR OR                    17270000
169200             PC238-MOD-UNSUCCESSFUL                               17280000
169300     PERFORM 8500-CLOSE-PREPK-LINE-CSR.                           17290000
169400                                                                  17300000
169500 8300-OPEN-PREPK-LINE-CSR.                                        17310000
169600     STRING ' 8300-OPEN-PREPK-LINE-CSR'                           17320000
169700         DELIMITED BY SIZE                                        17330000
169800         INTO PV-CICS-MSG-AREA.                                   17340000
169900     PERFORM 9990-WRITE-CICS.                                     17350000
170000                                                                  17360000
170100     EXEC SQL                                                     17370000
170200          OPEN PREPK-LINE-CSR                                     17380000
170300     END-EXEC.                                                    17390000
170400                                                                  17400000
170500     EVALUATE TRUE                                                17410000
170600         WHEN SQLCODE = ZERO                                      17420000
170700              CONTINUE                                            17430000
170800         WHEN SQLWARN0 NOT = SPACES                               17440000
170900         WHEN SQLCODE  < ZERO                                     17450000
171000         WHEN SQLCODE  > ZERO                                     17460000
171100              MOVE '8300-OPEN-PREPK-LINE-CSR'                     17470000
171200                              TO DP013-PARAGRAPH                  17480000
171300              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       17490000
171400              STRING 'PO NBR: '         DELIMITED BY SIZE         17500000
171500                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         17510000
171600                            INTO DP013-MESSAGE-TEXT(1)            17520000
171700              MOVE DK-RCVR-SEQ-NBR                                17530000
171800                              TO PV-DISPLAY-RCVR-SEQ-NBR          17540000
171900              STRING 'RECV SEQ: '       DELIMITED BY SIZE         17550000
172000                  PV-DISPLAY-RCVR-SEQ-NBR                         17560000
172100                                        DELIMITED BY SIZE         17570000
172200                            INTO DP013-MESSAGE-TEXT(2)            17580000
172300              MOVE SQLCA      TO DP013-SQLCA                      17590000
172400             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 17600000
172500              MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)          17610000
172600                                 PC238-BAD-TABLE-NAME             17620000
172700              SET PC238-DB2-FUNCTION-OPEN   TO TRUE               17630000
172800              SET PC238-MOD-UNSUCCESSFUL    TO TRUE               17640000
172900              SET DP013-DB2-ABEND                                 17650000
173000                              TO TRUE                             17660000
173100              SET DP013-ROLLBACK                                  17670000
173200                              TO TRUE                             17680000
173300              PERFORM 9999-WRITE-CICS-LOG-MSG                     17690000
173400     END-EVALUATE.                                                17700000
173500                                                                  17710000
173600 EJECT                                                            17720000
173700                                                                  17730000
173800                                                                  17740000
173900 8400-FETCH-PREPK-LINE-CSR.                                       17750000
174000     STRING ' 8400-FETCH-PREPK-LINE-CSR'                          17760000
174100         DELIMITED BY SIZE                                        17770000
174200         INTO PV-CICS-MSG-AREA.                                   17780000
174300     PERFORM 9990-WRITE-CICS.                                     17790000
174400                                                                  17800000
174500     EXEC SQL                                                     17810000
174600          FETCH PREPK-LINE-CSR                                    17820000
174700           INTO :RECDIS-STR-NBR                                   17830000
174800              , :RECITM-PREPK-RATO-QTY                            17840000
174900              , :RECDIS-AP-VERIFY-ITM-QTY                         17850000
175000              , :RECDIS-VERIFY-ITM-QTY                            17860000
175100              , :RECITM-VERFYD-TMST                               17870000
175200              , :RCT00009-DC-VRFY-ODU-QTY                         17880000
175300              , :RCT00009-AP-VRFY-ODU-QTY                         17890000
175400     END-EXEC.                                                    17900000
175500                                                                  17910000
175600     EVALUATE TRUE                                                17920000
175700         WHEN SQLCODE = ZERO                                      17930000
175800             IF PS-FIRST-FETCH                                    17940000
175900                SET PS-NOT-FIRST-FETCH TO TRUE                    17950000
176000                MOVE +1 TO PV-INDEX-COUNTER                       17960000
176100                MOVE RECITM-VERFYD-TMST  TO PV-CURRENT-TMST       17970000
176110* RPK - ADDED CODE FOR PRB42963 - START                           17980000
176120                SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE         17990000
176130* RPK - ADDED CODE FOR PRB42963 - END                             18000000
176200                PERFORM 1000-SELECT-CONTROL-TMST                  18010000
176300                PERFORM 6200-SELECT-TPOPRPK                       18020000
176400             END-IF                                               18030000
176500             PERFORM 8580-PROCESS-VALIDATION-RES                  18040000
176600         WHEN SQLCODE = +100                                      18050000
176700              SET PS-END-OF-PREPK-LINE-CSR  TO TRUE               18060000
176710* RPK - ADDED CODE FOR PRB42963 - START                           18070000
176720              SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE           18080000
176730* RPK - ADDED CODE FOR PRB42963 - END                             18090000
176800              PERFORM 8580-PROCESS-VALIDATION-RES                 18100000
176900         WHEN SQLWARN0 NOT = SPACES                               18110000
177000         WHEN SQLCODE NOT EQUAL ZERO                              18120000
177100             MOVE '8400-FETCH-PREPK-LINE-CSR'                     18130000
177200                             TO DP013-PARAGRAPH                   18140000
177300             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        18150000
177400             STRING 'PO NBR: '         DELIMITED BY SIZE          18160000
177500                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          18170000
177600                           INTO DP013-MESSAGE-TEXT(1)             18180000
177700             MOVE DK-RCVR-SEQ-NBR                                 18190000
177800                             TO PV-DISPLAY-RCVR-SEQ-NBR           18200000
177900             STRING 'RECV SEQ: '       DELIMITED BY SIZE          18210000
178000                 PV-DISPLAY-RCVR-SEQ-NBR                          18220000
178100                                       DELIMITED BY SIZE          18230000
178200                           INTO DP013-MESSAGE-TEXT(2)             18240000
178300             MOVE DK-PO-LINE-NBR      TO PV-DISPLAY-PO-LINE-NBR   18250000
178400             STRING 'PO LINE NBR: '    DELIMITED BY SIZE          18260000
178500                PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE          18270000
178600                           INTO DP013-MESSAGE-TEXT(3)             18280000
178700             MOVE SQLCA      TO DP013-SQLCA                       18290000
178800             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 18300000
178900             MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME(1)           18310000
179000                                PC238-BAD-TABLE-NAME              18320000
179100             SET PC238-DB2-FUNCTION-FETCH  TO TRUE                18330000
179200             SET PC238-MOD-UNSUCCESSFUL    TO TRUE                18340000
179300             SET DP013-DB2-ABEND                                  18350000
179400                             TO TRUE                              18360000
179500             SET DP013-ROLLBACK                                   18370000
179600                             TO TRUE                              18380000
179700             PERFORM 9999-WRITE-CICS-LOG-MSG                      18390000
179800     END-EVALUATE.                                                18400000
179900                                                                  18410000
180000*----------------------------------------------------------------*18420000
180100* CLOSE THE LINE STORE CURSOR                                  *  18430000
180200*----------------------------------------------------------------*18440000
180300                                                                  18450000
180400 8500-CLOSE-PREPK-LINE-CSR.                                       18460000
180500     STRING ' 8500-CLOSE-PREPK-LINE-CSR'                          18470000
180600         DELIMITED BY SIZE                                        18480000
180700         INTO PV-CICS-MSG-AREA.                                   18490000
180800     PERFORM 9990-WRITE-CICS.                                     18500000
180900                                                                  18510000
181000     EXEC SQL                                                     18520000
181100          CLOSE PREPK-LINE-CSR                                    18530000
181200     END-EXEC.                                                    18540000
181300                                                                  18550000
181400     EVALUATE TRUE                                                18560000
181500         WHEN SQLCODE = ZERO                                      18570000
181600              CONTINUE                                            18580000
181700         WHEN SQLWARN0 NOT = SPACES                               18590000
181800         WHEN SQLCODE  < ZERO                                     18600000
181900         WHEN SQLCODE  > ZERO                                     18610000
182000              MOVE '8500-CLOSE-PREPK-LINE-CSR'                    18620000
182100                             TO DP013-PARAGRAPH                   18630000
182200              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       18640000
182300              STRING 'PO NBR: '         DELIMITED BY SIZE         18650000
182400                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         18660000
182500                            INTO DP013-MESSAGE-TEXT(1)            18670000
182600              MOVE DK-RCVR-SEQ-NBR                                18680000
182700                              TO PV-DISPLAY-RCVR-SEQ-NBR          18690000
182800              STRING 'RECV SEQ: '       DELIMITED BY SIZE         18700000
182900                  PV-DISPLAY-RCVR-SEQ-NBR                         18710000
183000                                        DELIMITED BY SIZE         18720000
183100                            INTO DP013-MESSAGE-TEXT(2)            18730000
183200              MOVE DK-PO-LINE-NBR      TO PV-DISPLAY-PO-LINE-NBR  18740000
183300              STRING 'PO LINE NBR: '    DELIMITED BY SIZE         18750000
183400                 PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE         18760000
183500                            INTO DP013-MESSAGE-TEXT(3)            18770000
183600              MOVE SQLCA      TO DP013-SQLCA                      18780000
183700              MOVE SQLCODE    TO PC238-BAD-SQL-CDE                18790000
183800              MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME(1)          18800000
183900                                 PC238-BAD-TABLE-NAME             18810000
184000              SET PC238-DB2-FUNCTION-CLOSE  TO TRUE               18820000
184100              SET PC238-MOD-UNSUCCESSFUL    TO TRUE               18830000
184200              SET DP013-DB2-ABEND                                 18840000
184300                              TO TRUE                             18850000
184400              SET DP013-ROLLBACK                                  18860000
184500                              TO TRUE                             18870000
184600              PERFORM 9999-WRITE-CICS-LOG-MSG                     18880000
184700     END-EVALUATE.                                                18890000
184800                                                                  18900000
184900                                                                  18910000
185000 8580-PROCESS-VALIDATION-RES.                                     18920000
185100                                                                  18930000
185200        SET PS-NOT-END-OF-PREPK-STORE TO TRUE                     18940000
185300        MOVE +100 TO PV-MAX-ITEMS                                 18950000
185400        PERFORM VARYING RD024-IDX FROM PV-INDEX-COUNTER BY 1      18960000
185500                     UNTIL RD024-IDX > PV-MAX-ITEMS OR            18970000
185600                     PS-END-OF-PREPK-STORE OR                     18980000
185700                     PS-END-OF-PREPK-LINE-CSR                     18990000
185800            MOVE RECDIS-STR-NBR  TO       RD024-STORE             19000000
185900                                           (RD024-IDX)            19010000
186000            IF PC238-TRANS-LINE-VERIFY                            19020000
186100               MOVE   'P'   TO RD024-STORE-QTY-SIGN               19030000
186200                                           (RD024-IDX)            19040000
186300               COMPUTE PV-PACK-QTY =                              19050000
186400                          (RECDIS-AP-VERIFY-ITM-QTY -             19060000
186500                           RCT00009-AP-VRFY-ODU-QTY) /            19070000
186600                           RECITM-PREPK-RATO-QTY                  19080000
186700            ELSE                                                  19090000
186800               MOVE   'N'   TO RD024-STORE-QTY-SIGN               19100000
186900                                           (RD024-IDX)            19110000
187000               COMPUTE PV-PACK-QTY =                              19120000
187100                          (RECDIS-VERIFY-ITM-QTY    -             19130000
187200                           RCT00009-DC-VRFY-ODU-QTY) /            19140000
187300                           RECITM-PREPK-RATO-QTY                  19150000
187400            END-IF                                                19160000
187500            MOVE PV-PACK-QTY     TO RD024-STORE-QTY               19170000
187600                                           (RD024-IDX)            19180000
187700            IF RD024-STORE-QTY (RD024-IDX) = 0                    19190000
187800                SET RD024-IDX DOWN BY 1                           19200000
187900                SUBTRACT +1 FROM PV-STORE-COUNT                   19210000
188000                SUBTRACT +1 FROM PV-INDEX-COUNTER                 19220000
188100            ELSE                                                  19230000
188200                MOVE 'Y' TO PS-AT-LEAST-ONE-STORE                 19240000
188300            END-IF                                                19250000
188400            ADD +1    TO PV-STORE-COUNT                           19260000
188500                         PV-INDEX-COUNTER                         19270000
188600            SET PS-END-OF-PREPK-STORE TO TRUE                     19280000
188700      END-PERFORM                                                 19290000
188800                                                                  19300000
188900      IF AT-LEAST-ONE-STORE                                       19310000
189000          IF RD024-IDX > PV-MAX-ITEMS                             19320000
189100             PERFORM 3200-LOAD-WFT-LOD-XFER                       19330000
189200             PERFORM 3300-INSERT-WFT-LOD-XFER                     19340000
189210* RPK - ADDED CODE FOR PRB42963 - START                           19350000
189220             SET PS-WROTE-TO-XFER-ONLY TO TRUE                    19360000
189230* RPK - ADDED CODE FOR PRB42963 - END                             19370000
189300             SET RD024-IDX TO +1                                  19380000
189400             SET PS-END-OF-PREPK-STORE TO TRUE                    19390000
189500             MOVE +0  TO  PV-STORE-COUNT                          19400000
189600             MOVE +1 TO PV-INDEX-COUNTER                          19410000
189700          ELSE                                                    19420000
189800          IF PS-END-OF-PREPK-LINE-CSR                             19430000
189900             PERFORM 3200-LOAD-WFT-LOD-XFER                       19440000
190000             PERFORM 3300-INSERT-WFT-LOD-XFER                     19450000
190100             PERFORM 3000-LOAD-WFT-LOD-CNTL                       19460000
190200             PERFORM 3100-INSERT-WFT-LOD-CNTL                     19470000
190300          END-IF                                                  19480000
190400        END-IF                                                    19490000
190420* RPK - ADDED CODE FOR PRB42963 - START                           19500000
190421      ELSE                                                        19510000
190430        IF PS-WROTE-TO-XFER-ONLY                                  19520000
190490           PERFORM 3000-LOAD-WFT-LOD-CNTL                         19530000
190491           PERFORM 3100-INSERT-WFT-LOD-CNTL                       19540000
190492           SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE              19550000
190493        END-IF                                                    19560000
190494* RPK - ADDED CODE FOR PRB42963 - END                             19570000
190500      END-IF.                                                     19580000
190600                                                                  19590000
190700 8610-PROCESS-ODD-UNT-LINES.                                      19600000
190800     STRING ' 8610-PROCESS-ODD-UNT '                              19610000
190900         DELIMITED BY SIZE                                        19620000
191000         INTO PV-CICS-MSG-AREA.                                   19630000
191100     PERFORM 9990-WRITE-CICS.                                     19640000
191200     SET PC238-MOD-SUCCESSFUL TO TRUE.                            19650000
191300                                                                  19660000
191400     SET PS-NOT-END-OF-ODD-UNITS-CSR                              19670000
191500         PS-FIRST-FETCH           TO TRUE                         19680000
191600     MOVE 'N'                     TO PS-AT-LEAST-ONE-STORE        19690000
191610* RPK - ADDED CODE FOR PRB42963 - START                           19700000
191620     SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE                    19710000
191630* RPK - ADDED CODE FOR PRB42963 - END                             19720000
191700     PERFORM 8620-OPEN-ODD-UNITS-CSR                              19730000
191800     PERFORM 8630-FETCH-ODD-UNITS-CSR                             19740000
191900     PERFORM 8650-LOAD-VERIFIED-RECEIPTS                          19750000
192000             UNTIL PS-END-OF-ODD-UNITS-CSR OR                     19760000
192100             PC238-MOD-UNSUCCESSFUL.                              19770000
192200     PERFORM 8700-CLOSE-ODD-UNITS-CSR.                            19780000
192300                                                                  19790000
192400                                                                  19800000
192500                                                                  19810000
192600 8620-OPEN-ODD-UNITS-CSR.                                         19820000
192700     STRING ' 8620-OPEN-ODD-UNITS-CSR'                            19830000
192800         DELIMITED BY SIZE                                        19840000
192900         INTO PV-CICS-MSG-AREA.                                   19850000
193000     PERFORM 9990-WRITE-CICS.                                     19860000
193100                                                                  19870000
193200     EXEC SQL                                                     19880000
193300          OPEN ODD-UNITS-CSR                                      19890000
193400     END-EXEC.                                                    19900000
193500                                                                  19910000
193600     EVALUATE TRUE                                                19920000
193700         WHEN SQLCODE = ZERO                                      19930000
193800              CONTINUE                                            19940000
193900         WHEN SQLWARN0 NOT = SPACES                               19950000
194000         WHEN SQLCODE  < ZERO                                     19960000
194100         WHEN SQLCODE  > ZERO                                     19970000
194200              MOVE '8620-OPEN-ODD-UNITS-CSR'                      19980000
194300                              TO DP013-PARAGRAPH                  19990000
194400              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       20000000
194500              STRING 'PO NBR: '         DELIMITED BY SIZE         20010000
194600                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         20020000
194700                            INTO DP013-MESSAGE-TEXT(1)            20030000
194800              MOVE DK-RCVR-SEQ-NBR                                20040000
194900                              TO PV-DISPLAY-RCVR-SEQ-NBR          20050000
195000              STRING 'RECV SEQ: '       DELIMITED BY SIZE         20060000
195100                  PV-DISPLAY-RCVR-SEQ-NBR                         20070000
195200                                        DELIMITED BY SIZE         20080000
195300                            INTO DP013-MESSAGE-TEXT(2)            20090000
195400              MOVE SQLCA      TO DP013-SQLCA                      20100000
195500             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 20110000
195600              MOVE 'RCT00009' TO DP013-DB2-TABLE-NAME(1)          20120000
195700                                 PC238-BAD-TABLE-NAME             20130000
195800              SET PC238-DB2-FUNCTION-OPEN   TO TRUE               20140000
195900              SET PC238-MOD-UNSUCCESSFUL    TO TRUE               20150000
196000              SET DP013-DB2-ABEND                                 20160000
196100                              TO TRUE                             20170000
196200              SET DP013-ROLLBACK                                  20180000
196300                              TO TRUE                             20190000
196400              PERFORM 9999-WRITE-CICS-LOG-MSG                     20200000
196500     END-EVALUATE.                                                20210000
196600                                                                  20220000
196700 EJECT                                                            20230000
196800                                                                  20240000
196900                                                                  20250000
197000 8630-FETCH-ODD-UNITS-CSR.                                        20260000
197100     STRING ' 8630-FETCH-ODD-UNITS-CSR'                           20270000
197200         DELIMITED BY SIZE                                        20280000
197300         INTO PV-CICS-MSG-AREA.                                   20290000
197400     PERFORM 9990-WRITE-CICS.                                     20300000
197500                                                                  20310000
197600     EXEC SQL                                                     20320000
197700          FETCH ODD-UNITS-CSR                                     20330000
197800           INTO :RCT00009-STR-NBR                                 20340000
197900             ,  :RCT00009-PO-LNE-NBR                              20350000
198000             ,  :RCT00009-DC-VRFY-ODU-QTY                         20360000
198100             ,  :RCT00009-AP-VRFY-ODU-QTY                         20370000
198200     END-EXEC.                                                    20380000
198300                                                                  20390000
198400     EVALUATE TRUE                                                20400000
198500         WHEN SQLCODE = ZERO                                      20410000
198600             IF PS-FIRST-FETCH                                    20420000
198700                SET PS-ODD-UNITS-TRANSACTION TO TRUE              20430000
198800                MOVE +0  TO PV-STORE-COUNT                        20440000
198900                            PV-BTCH-LOD-SEQ-ID                    20450000
199000                SET PS-NOT-FIRST-FETCH TO TRUE                    20460000
199100                PERFORM 1000-SELECT-CONTROL-TMST                  20470000
199200                MOVE RCT00009-PO-LNE-NBR TO PV-PO-LNE-HOLD        20480000
199300                                            DK-PO-LINE-NBR        20490000
199400                PERFORM 6350-SELECT-LINE-SKU                      20500000
199500             END-IF                                               20510000
199600         WHEN SQLCODE = +100                                      20520000
199700             SET PS-END-OF-ODD-UNITS-CSR TO TRUE                  20530000
199800             IF PS-NOT-FIRST-FETCH                                20540000
199900                MOVE ZEROES TO PV-PO-LNE-HOLD                     20550000
200000             END-IF                                               20560000
200100         WHEN SQLWARN0 NOT = SPACES                               20570000
200200         WHEN SQLCODE NOT EQUAL ZERO                              20580000
200300             MOVE '8630-FETCH-ODD-UNITS-CSR'                      20590000
200400                             TO DP013-PARAGRAPH                   20600000
200500             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        20610000
200600             STRING 'PO NBR: '         DELIMITED BY SIZE          20620000
200700                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          20630000
200800                           INTO DP013-MESSAGE-TEXT(1)             20640000
200900             MOVE DK-RCVR-SEQ-NBR                                 20650000
201000                             TO PV-DISPLAY-RCVR-SEQ-NBR           20660000
201100             STRING 'RECV SEQ: '       DELIMITED BY SIZE          20670000
201200                 PV-DISPLAY-RCVR-SEQ-NBR                          20680000
201300                                       DELIMITED BY SIZE          20690000
201400                           INTO DP013-MESSAGE-TEXT(2)             20700000
201500             MOVE DK-PO-LINE-NBR      TO PV-DISPLAY-PO-LINE-NBR   20710000
201600             STRING 'PO LINE NBR: '    DELIMITED BY SIZE          20720000
201700                PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE          20730000
201800                           INTO DP013-MESSAGE-TEXT(3)             20740000
201900             MOVE SQLCA      TO DP013-SQLCA                       20750000
202000             MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 20760000
202100             MOVE 'RCT00009' TO DP013-DB2-TABLE-NAME(1)           20770000
202200                                PC238-BAD-TABLE-NAME              20780000
202300             SET PC238-DB2-FUNCTION-FETCH  TO TRUE                20790000
202400             SET PC238-MOD-UNSUCCESSFUL    TO TRUE                20800000
202500             SET DP013-DB2-ABEND                                  20810000
202600                             TO TRUE                              20820000
202700             SET DP013-ROLLBACK                                   20830000
202800                             TO TRUE                              20840000
202900             PERFORM 9999-WRITE-CICS-LOG-MSG                      20850000
203000     END-EVALUATE.                                                20860000
203100                                                                  20870000
203200*----------------------------------------------------------------*20880000
203300* CLOSE THE LINE STORE CURSOR                                  *  20890000
203400*----------------------------------------------------------------*20900000
203500 8700-CLOSE-ODD-UNITS-CSR.                                        20910000
203600     STRING ' 8700-CLOSE-ODD-UNITS-CSR'                           20920000
203700         DELIMITED BY SIZE                                        20930000
203800         INTO PV-CICS-MSG-AREA.                                   20940000
203900     PERFORM 9990-WRITE-CICS.                                     20950000
204000                                                                  20960000
204100     EXEC SQL                                                     20970000
204200          CLOSE ODD-UNITS-CSR                                     20980000
204300     END-EXEC.                                                    20990000
204400                                                                  21000000
204500     EVALUATE TRUE                                                21010000
204600         WHEN SQLCODE = ZERO                                      21020000
204700              CONTINUE                                            21030000
204800         WHEN SQLWARN0 NOT = SPACES                               21040000
204900         WHEN SQLCODE  < ZERO                                     21050000
205000         WHEN SQLCODE  > ZERO                                     21060000
205100              MOVE '8700-CLOSE-ODD-UNITS-CSR'                     21070000
205200                             TO DP013-PARAGRAPH                   21080000
205300              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       21090000
205400              STRING 'PO NBR: '         DELIMITED BY SIZE         21100000
205500                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         21110000
205600                            INTO DP013-MESSAGE-TEXT(1)            21120000
205700              MOVE DK-RCVR-SEQ-NBR                                21130000
205800                              TO PV-DISPLAY-RCVR-SEQ-NBR          21140000
205900              STRING 'RECV SEQ: '       DELIMITED BY SIZE         21150000
206000                  PV-DISPLAY-RCVR-SEQ-NBR                         21160000
206100                                        DELIMITED BY SIZE         21170000
206200                            INTO DP013-MESSAGE-TEXT(2)            21180000
206300              MOVE DK-PO-LINE-NBR      TO PV-DISPLAY-PO-LINE-NBR  21190000
206400              STRING 'PO LINE NBR: '    DELIMITED BY SIZE         21200000
206500                 PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE         21210000
206600                            INTO DP013-MESSAGE-TEXT(3)            21220000
206700              MOVE SQLCA      TO DP013-SQLCA                      21230000
206800              MOVE SQLCODE    TO PC238-BAD-SQL-CDE                21240000
206900              MOVE 'RCT00009' TO DP013-DB2-TABLE-NAME(1)          21250000
207000                                 PC238-BAD-TABLE-NAME             21260000
207100              SET PC238-DB2-FUNCTION-CLOSE  TO TRUE               21270000
207200              SET PC238-MOD-UNSUCCESSFUL    TO TRUE               21280000
207300              SET DP013-DB2-ABEND                                 21290000
207400                              TO TRUE                             21300000
207500              SET DP013-ROLLBACK                                  21310000
207600                              TO TRUE                             21320000
207700              PERFORM 9999-WRITE-CICS-LOG-MSG                     21330000
207800     END-EVALUATE.                                                21340000
207900                                                                  21350000
208000                                                                  21360000
208100 8650-LOAD-VERIFIED-RECEIPTS.                                     21370000
208200       MOVE +100 TO PV-MAX-ITEMS                                  21380000
208300       PERFORM VARYING RD024-IDX FROM 1 BY 1                      21390000
208400                    UNTIL RD024-IDX > PV-MAX-ITEMS OR             21400000
208500                    PS-NEW-LINE-FOUND                             21410000
208600           MOVE RCT00009-STR-NBR TO      RD024-STORE              21420000
208700                                          (RD024-IDX)             21430000
208800           IF PC238-TRANS-LINE-VERIFY                             21440000
208900              MOVE   'P'   TO RD024-STORE-QTY-SIGN                21450000
209000                                          (RD024-IDX)             21460000
209100           ELSE                                                   21470000
209200              MOVE   'N'   TO RD024-STORE-QTY-SIGN                21480000
209300                                          (RD024-IDX)             21490000
209400           END-IF                                                 21500000
209500           MOVE RCT00009-DC-VRFY-ODU-QTY TO RD024-STORE-QTY       21510000
209600                                          (RD024-IDX)             21520000
209700           IF RD024-STORE-QTY (RD024-IDX) = 0                     21530000
209800               SET RD024-IDX DOWN BY 1                            21540000
209900               SUBTRACT +1 FROM PV-STORE-COUNT                    21550000
210000           ELSE                                                   21560000
210100               MOVE 'Y' TO PS-AT-LEAST-ONE-STORE                  21570000
210200           END-IF                                                 21580000
210300           PERFORM 8630-FETCH-ODD-UNITS-CSR                       21590000
210400           IF RCT00009-PO-LNE-NBR > PV-PO-LNE-HOLD                21600000
210500              SET PS-NEW-LINE-FOUND TO TRUE                       21610000
210600           END-IF                                                 21620000
210700           ADD +1    TO PV-STORE-COUNT                            21630000
210800       END-PERFORM.                                               21640000
210900                                                                  21650000
211000     IF AT-LEAST-ONE-STORE                                        21660000
211100       IF PS-NEW-LINE-FOUND                                       21670000
211200          PERFORM 3200-LOAD-WFT-LOD-XFER                          21680000
211300          PERFORM 3300-INSERT-WFT-LOD-XFER                        21690000
211400          PERFORM 3000-LOAD-WFT-LOD-CNTL                          21700000
211500          PERFORM 3100-INSERT-WFT-LOD-CNTL                        21710000
211600                                                                  21720000
211700          PERFORM 1000-SELECT-CONTROL-TMST                        21730000
211800          MOVE +0 TO PV-BTCH-LOD-SEQ-ID                           21740000
211900          SET PS-NO-NEW-LINE-FOUND TO TRUE                        21750000
212000          MOVE 'N' TO PS-AT-LEAST-ONE-STORE                       21760000
212100          MOVE RCT00009-PO-LNE-NBR TO PV-PO-LNE-HOLD              21770000
212200                                      DK-PO-LINE-NBR              21780000
212300          PERFORM 6350-SELECT-LINE-SKU                            21790000
212400       ELSE                                                       21800000
212460* RPK - ADDED CODE FOR PRB42963 - START                           21810000
212470          SET PS-WROTE-TO-XFER-ONLY TO TRUE                       21820000
212480* RPK - ADDED CODE FOR PRB42963 - END                             21830000
212500          PERFORM 3200-LOAD-WFT-LOD-XFER                          21840000
212600          PERFORM 3300-INSERT-WFT-LOD-XFER                        21850000
212700       END-IF                                                     21860000
212800                                                                  21870000
212900       MOVE +0    TO PV-STORE-COUNT                               21880000
213000       SET RD024-IDX  TO +1                                       21890000
213100     ELSE                                                         21900000
213200       IF PS-NEW-LINE-FOUND                                       21910000
213300          SET PS-NO-NEW-LINE-FOUND TO TRUE                        21920000
213400          MOVE RCT00009-PO-LNE-NBR TO PV-PO-LNE-HOLD              21930000
213500                                      DK-PO-LINE-NBR              21940000
213600       END-IF                                                     21950000
213610* RPK - ADDED CODE FOR PRB42963 - START                           21960000
213620       IF PS-WROTE-TO-XFER-ONLY                                   21970000
213680          PERFORM 3000-LOAD-WFT-LOD-CNTL                          21980000
213690          PERFORM 3100-INSERT-WFT-LOD-CNTL                        21990000
213691          SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE               22000000
213692       END-IF                                                     22010000
213693* RPK - ADDED CODE FOR PRB42963 - END                             22020000
213700     END-IF.                                                      22030000
213800                                                                  22040000
213900***************************************************************** 22050000
214000 9100-READ-ADJUST-QUEUE.                                          22060000
214100     EXEC CICS                                                    22070000
214200         READQ TS                                                 22080000
214300             QUEUE (PC238-VRFY-ADJ-QUEUE-NAME)                    22090000
214400             INTO  (PC241-FIELDS)                                 22100000
214500             ITEM  (PV-SEL-ITEM)                                  22110000
214600             RESP  (PV-CICS-RESPONSE)                             22120000
214700     END-EXEC.                                                    22130000
214800*                                                                 22140000
214900     EVALUATE PV-CICS-RESPONSE                                    22150000
215000         WHEN DFHRESP(NORMAL)                                     22160000
215100             CONTINUE                                             22170000
215200         WHEN DFHRESP(ITEMERR)                                    22180000
215300             SET PS-END-ADJUSTMENTS-TSQ TO TRUE                   22190000
215400         WHEN OTHER                                               22200000
215500*            CONTINUE                                             22210000
215600             MOVE PC238-PO-NBR       TO PC-DISPLAY-PO             22220000
215700             MOVE PC238-RCVR-SEQ-NBR TO PC-DISPLAY-RCVR           22230000
215800             MOVE PC238-PO-LNE-NBR   TO PC-DISPLAY-LINE           22240000
215900             MOVE PC238-WRKD-OPER-UNT-ID                          22250000
216000                                     TO PC-DISPLAY-OPER           22260000
216100             MOVE PV-CICS-RESPONSE   TO PC-DISPLAY-CICS-RESPONSE  22270000
216200             STRING ' PCKCS759 - '      DELIMITED BY SIZE         22280000
216300                    PC-DISPLAY-CICS-RESPONSE                      22290000
216400                                        DELIMITED BY SIZE         22300000
216500                    ' - '               DELIMITED BY SIZE         22310000
216600                    PC-DISPLAY-PO       DELIMITED BY SIZE         22320000
216700                    ' - '               DELIMITED BY SIZE         22330000
216800                    PC-DISPLAY-RCVR     DELIMITED BY SIZE         22340000
216900                    ' - '               DELIMITED BY SIZE         22350000
217000                    PC-DISPLAY-LINE     DELIMITED BY SIZE         22360000
217100                    ' - '               DELIMITED BY SIZE         22370000
217200                    PC-DISPLAY-OPER     DELIMITED BY SIZE         22380000
217300                                 INTO PV-CICS-MSG-AREA3           22390000
217400             MOVE LENGTH OF PV-CICS-MSG-AREA3                     22400000
217500                                   TO PV-COMMAREA-LENGTH          22410000
217600             PERFORM 9200-WRITE-TO-CICS-LOG                       22420000
217700*           PERFORM 9000-RETURN-CALL                             22430000
217800     END-EVALUATE.                                                22440000
217900                                                                  22450000
218000 9200-WRITE-TO-CICS-LOG.                                          22460000
218100                                                                  22470000
218200     EXEC CICS                                                    22480000
218300          WRITEQ TD                                               22490000
218400          QUEUE  ('CSSL')                                         22500000
218500          FROM  (PV-CICS-MSG-AREA3)                               22510000
218600          LENGTH  (PV-COMMAREA-LENGTH)                            22520000
218700          RESP  (PV-CICS-RESP)                                    22530000
218800     END-EXEC.                                                    22540000
218900                                                                  22550000
219000     MOVE SPACES TO PV-CICS-MSG-AREA3.                            22560000
P5207                                                                   22560107
P5207  9300-GET-TRECEIV-OPER-UNT-ID.                                    22561007
P5207      INITIALIZE DCLTRECEIV.                                       22562007
P5207                                                                   22563007
P5207          EXEC SQL                                                 22564007
P5207               SELECT                                              22565007
P5207                  OPER_UNT_ID                                      22566007
P5207             INTO                                                  22569107
P5207                  :RECEIV-OPER-UNT-ID                              22569207
P5207               FROM  TRECEIV                                       22569607
P5207               WHERE                                               22569707
P5207                      ORD_NBR          =  :DK-PO-NBR               22569807
P5207               AND    REC_SEQ_NBR      =  :DK-RCVR-SEQ-NBR         22569907
P5207               AND    VER_STATUS_CDE   =  'A'                      22570007
P5207               WITH UR                                             22570107
P5207          END-EXEC.                                                22570207
P5207                                                                   22570307
P5207      EVALUATE TRUE                                                22570407
P5207          WHEN SQLCODE = ZERO                                      22570507
P5207              CONTINUE                                             22570607
P5207          WHEN SQLWARN0 NOT = SPACES                               22570707
P5207          WHEN SQLCODE NOT EQUAL ZERO                              22570807
P5207              MOVE '9300-GET-TRECEIV-OPER-UNT-ID'                  22570907
P5207                              TO DP013-PARAGRAPH                   22571007
P5207              MOVE DK-PO-NBR        TO PV-DISPLAY-PO-NBR           22571107
P5207              MOVE DK-RCVR-SEQ-NBR  TO PV-DISPLAY-RCVR-SEQ-NBR     22571207
P5207              STRING 'PO NBR: '                                    22571407
P5207                  PV-DISPLAY-PO-NBR    DELIMITED BY SIZE           22571507
P5207                                  INTO DP013-MESSAGE-TEXT(1)       22571607
P5207              STRING 'RECV SEQ: '                                  22571707
P5207                  PV-DISPLAY-RCVR-SEQ-NBR                          22571807
P5207                                       DELIMITED BY SIZE           22571907
P5207                                  INTO DP013-MESSAGE-TEXT(2)       22572007
P5207              MOVE SQLCA      TO DP013-SQLCA                       22572407
P5207              MOVE SQLCODE    TO PC238-BAD-SQL-CDE                 22572507
P5207              MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME(1)           22572607
P5207                                 PC238-BAD-TABLE-NAME              22572707
P5207              SET PC238-DB2-FUNCTION-SELECT TO TRUE                22572807
P5207              SET PC238-MOD-UNSUCCESSFUL    TO TRUE                22572907
P5207              SET DP013-DB2-ABEND           TO TRUE                22573007
P5207              SET DP013-ROLLBACK            TO TRUE                22573107
P5207              PERFORM 9999-WRITE-CICS-LOG-MSG                      22573207
P5207      END-EVALUATE.                                                22573307
219200                                                                  22580000
219300 9990-WRITE-CICS.                                                 22590000
219400                                                                  22600000
219500* IF YOU'RE AT THE LAST OCCURRENCE OF THE TABLE,                  22610000
219600* THE NEXT MESSAGE WILL GO INTO THE FIRST OCCURRENCE.  KEEP       22620000
219700* INCREMENTING THE SEQUENCE SO THAT IF THE TABLE IS DUMPED TO THE 22630000
219800* LOG YOU WILL BE ABLE TO SEE THE LAST 200 LINES AND HOW THEY     22640000
219900* WRAPPED AROUND.                                                 22650000
220000                                                                  22660000
220100     EVALUATE TRUE                                                22670000
220200     WHEN PT-MSG-IDX < PC-MSG-TABLE-SIZE                          22680000
220300         MOVE PV-CICS-MSG-AREA        TO PT-MSG-LINE (PT-MSG-IDX) 22690000
220400         MOVE PT-MSG-SEQ (PT-MSG-IDX) TO PV-PREV-SEQUENCE         22700000
220500         SET PT-MSG-IDX UP BY 1                                   22710000
220600     WHEN PT-MSG-IDX = PC-MSG-TABLE-SIZE                          22720000
220700         MOVE PV-CICS-MSG-AREA        TO PT-MSG-LINE (PT-MSG-IDX) 22730000
220800         MOVE PT-MSG-SEQ (PT-MSG-IDX) TO PV-PREV-SEQUENCE         22740000
220900         SET PT-MSG-IDX               TO 1                        22750000
221000     END-EVALUATE                                                 22760000
221100                                                                  22770000
221200     COMPUTE PV-NEXT-SEQUENCE = PV-PREV-SEQUENCE + 1              22780000
221300     MOVE PV-NEXT-SEQUENCE            TO PT-MSG-SEQ (PT-MSG-IDX)  22790000
221400                                                                  22800000
221500                                                                  22810000
221600*  IF THE DC HAS TRACE PROCESSING TURNED ON, ALL MESSAGES WILL    22820000
221700*  BE DISPLAYED AS THEY OCCUR.  DUMPING THE MESSAGE TABLE WILL    22830000
221800*  BE UNNECESSARY BECAUSE OF THE REAL-TIME DISPLAYS.              22840000
221900*                                                                 22850000
222000     IF PS-SHOW-DEBUG-INFO                                        22860000
222100         PERFORM 9991-WRITEQ                                      22870000
222200     END-IF                                                       22880000
222300     MOVE SPACES                      TO PV-CICS-MSG-AREA.        22890000
222400                                                                  22900000
222500                                                                  22910000
222600 9991-WRITEQ.                                                     22920000
222700     EXEC CICS                                                    22930000
222800         WRITEQ TD                                                22940000
222900         QUEUE(PC-LOG-QUEUE)                                      22950000
223000         FROM(PV-CICS-MSG-AREA)                                   22960000
223100         RESP(PV-CICS-RESPONSE)                                   22970000
223200     END-EXEC.                                                    22980000
223300                                                                  22990000
223400*-----------------------------------------------------------------23000000
223500*  RETURN TO CALLING PROGRAM                                      23010000
223600*-----------------------------------------------------------------23020000
223700 9998-RETURN.                                                     23030000
223800                                                                  23040000
223900     STRING ' 9998-RETURN'                                        23050000
224000         DELIMITED BY SIZE                                        23060000
224100         INTO PV-CICS-MSG-AREA.                                   23070000
224200     PERFORM 9990-WRITE-CICS.                                     23080000
224300                                                                  23090000
224400* THE FOLLOWING COMMENTED CODE CAN BE USED TO DETERMINE IF        23100000
224500* THE ROUTINE IS IN FACT GETTING CALLED.                          23110000
224600*                                                                 23120000
224700*    INITIALIZE                    PV-CICS-MSG-AREA2.             23130000
224800*    STRING ' PCKCS759 ENDED - TASK = '                           23140000
224900*             PV-EIBTASKN                                         23150000
225000*             DELIMITED BY SIZE                                   23160000
225100*                             INTO PV-CICS-MSG-AREA2              23170000
225200*    PERFORM 9999-WRITE-TO-CSSL.                                  23180000
225300                                                                  23190000
225400     MOVE PC238-COMM-AREA               TO DFHCOMMAREA.           23200000
225500*                                                                 23210000
225600**********************************************************        23220000
225700     EXEC CICS                                                    23230000
225800         DELETEQ TS                                               23240000
225900             QUEUE (PC238-VRFY-ADJ-QUEUE-NAME)                    23250000
226000             RESP  (PV-CICS-RESP)                                 23260000
226100     END-EXEC.                                                    23270000
226200                                                                  23280000
226300     EVALUATE PV-CICS-RESP                                        23290000
226400         WHEN DFHRESP(NORMAL)                                     23300000
226500             CONTINUE                                             23310000
226600         WHEN DFHRESP(QIDERR)                                     23320000
226700             CONTINUE                                             23330000
226800         WHEN OTHER                                               23340000
226900             CONTINUE                                             23350000
227000     END-EVALUATE.                                                23360000
227100************************************************************      23370000
227200                                                                  23380000
227300     EXEC CICS                                                    23390000
227400          RETURN                                                  23400000
227500     END-EXEC.                                                    23410000
227600                                                                  23420000
227700                                                                  23430000
227800 9999-WRITE-TO-CSSL.                                              23440000
227900     STRING ' 9999-WRITE-TO-CSSL'                                 23450000
228000         DELIMITED BY SIZE                                        23460000
228100         INTO PV-CICS-MSG-AREA.                                   23470000
228200     PERFORM 9990-WRITE-CICS.                                     23480000
228300     MOVE LENGTH OF PV-CICS-MSG-AREA2                             23490000
228400       TO PV-COMMAREA-LENGTH                                      23500000
228500     EXEC CICS                                                    23510000
228600          WRITEQ TD                                               23520000
228700           QUEUE   ('CSSL')                                       23530000
228800            FROM   (PV-CICS-MSG-AREA2)                            23540000
228900          LENGTH   (PV-COMMAREA-LENGTH)                           23550000
229000            RESP   (PV-CICS-RESP)                                 23560000
229100     END-EXEC.                                                    23570000
229200                                                                  23580000
229300*                                                                 23590000
229400 9999-WRITE-CICS-LOG-MSG.                                         23600000
229500     STRING ' 9999-WRITE-CICS-LOG-MSG'                            23610000
229600         DELIMITED BY SIZE                                        23620000
229700         INTO PV-CICS-MSG-AREA.                                   23630000
229800     PERFORM 9990-WRITE-CICS.                                     23640000
229900     MOVE 'PCKCS759'                 TO DP013-PROGRAM.            23650000
230000     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           23660000
230100     INITIALIZE DP013-SRC-TASK-NUMBER                             23670000
230200                DP013-STACK.                                      23680000
230300     SET DP013-LINK-RETURN           TO TRUE.                     23690000
230400                                                                  23700000
230500     EXEC CICS                                                    23710000
230600         LINK                                                     23720000
230700             PROGRAM   (DP013-NAME)                               23730000
230800             COMMAREA  (DP013-PARAMETERS)                         23740000
230900             LENGTH    (DP013-LENGTH)                             23750000
231000     END-EXEC.                                                    23760000
231100                                                                  23770000
