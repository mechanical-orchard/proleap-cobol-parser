000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    TMKUP520.                                         00020012
000300 AUTHOR.        LOUIE CRISOSTOMO.                                 00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  04-05-94.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000610                                                                  00061099
000700******************************************************************00070000
000800*    BATCH TROUBLE CENTRAL PROCESSING                             00080012
000810*                                                                 00081099
000900*    THIS WAS COPIED FROM TMKCS520 TO BE USED IN BATCH PROCESSING.00090012
000910*    IF EITHER THIS PROGRAM OR TMKCS520 CHANGE, THE OTHER WILL    00091099
000920*    NEED TO BE EXAMINED TO SEE IF THE IDENTICAL CHANGE SHOULD    00092012
000930*    BE APPLIED TO IT.                                            00093012
000931*    1/18/05  ALMOST ALL OF THE FUNCTIONALITY OF THIS PROGRAM     00093157
000932*    HAS BEEN COMMENTED OUT BECAUSE IT WILL NOT BE USED           00093257
000933*    INITIALLY.  THE POSSIBILITY THAT IS THAT SOME OF IT WILL     00093357
000934*    BE RESTORED IN THE FUTURE IS THE REASON IT IS BEING KEPT     00093457
000935*    AS COMMENTS                                                  00093557
000940*                                                                 00094012
001000*    THIS IS A CALLED ROUTINE USED TO DETERMINE                   00100000
001100*    HOW A TROUBLE WILL BE PROCESSED                              00110000
001200*                                                                 00120000
001300******************************************************************00130000
001400 ENVIRONMENT DIVISION.                                            00140000
001500 CONFIGURATION SECTION.                                           00150000
001600 SOURCE-COMPUTER.        IBM-3090.                                00160000
001700 OBJECT-COMPUTER.        IBM-3090.                                00170000
001800 DATA DIVISION.                                                   00180000
001900 WORKING-STORAGE SECTION.                                         00190000
002000                                                                  00200000
002100 01  PC-PROGRAM-CONSTANTS.                                        00210000
002200     05  PC-N                         PIC X(01) VALUE 'N'.        00220000
002300     05  PC-Y                         PIC X(01) VALUE 'Y'.        00230000
002400     05  PC-I                         PIC X(01) VALUE 'I'.        00240000
002500     05  PC-R                         PIC X(01) VALUE 'R'.        00250000
002600     05  PC-A                         PIC X(01) VALUE 'A'.        00260000
002700     05  PC-C                         PIC X(01) VALUE 'C'.        00270000
002800     05  PC-U                         PIC X(01) VALUE 'U'.        00280000
002900     05  PC-600                       PIC S9(4) VALUE +600        00290000
003000                                                COMP.             00300000
003100     05  PC-502                       PIC S9(4) VALUE +502        00310000
003200                                                COMP.             00320000
003300     05  PC-509                       PIC S9(4) VALUE +509        00330000
003400                                                COMP.             00340000
003500     05  PC-543                       PIC S9(4) VALUE +543        00350000
003600                                                COMP.             00360000
003700     05  PC-MAX-RETRIES               PIC S9(4) VALUE +3          00370000
003800                                                COMP SYNC.        00380000
004500     05  PC-RCKUP821                  PIC X(08) VALUE             00450099
004600                                                'RCKUP821'.       00460099
004700     05  PC-TMKUP521                  PIC X(08) VALUE             00470099
004800                                                'TMKUP521'.       00480099
004900     05  PC-WSKUP305                  PIC X(08) VALUE             00490099
004910                                                'WSKUP305'.       00491099
005000                                                                  00500000
005100 01  PS-PROGRAM-SWITCHES.                                         00510000
005200     05  PS-DONE-SW                   PIC  X    VALUE 'N'.        00520000
005300         88  PS-NOT-DONE                        VALUE 'N'.        00530000
005400         88  PS-DONE                            VALUE 'Y'.        00540000
005500     05  PS-RECORD-SW                 PIC  X    VALUE 'N'.        00550000
005600         88  PS-NO-MORE-RECORD                  VALUE 'N'.        00560000
005700         88  PS-MORE-RECORD                     VALUE 'Y'.        00570000
005800     05  PS-RECORD-FOUND-SW           PIC  X    VALUE 'N'.        00580000
005900         88  PS-RECORD-NOT-FOUND                VALUE 'N'.        00590000
006000         88  PS-RECORD-FOUND                    VALUE 'Y'.        00600000
006100     05  PS-ACK-SW                    PIC  X    VALUE 'N'.        00610000
006200         88  PS-ACK                             VALUE 'Y'.        00620000
006300         88  PS-NOT-ACK                         VALUE 'N'.        00630000
006500     05  PS-ASNS-TO-WMS-SW            PIC X(01) VALUE 'N'.        00650099
006600         88  PS-ASNS-TO-WMS-YES                 VALUE 'Y'.        00660099
006610         88  PS-ASNS-TO-WMS-NO                  VALUE 'N'.        00661099
006620     05  PS-DISTRO-TRBL-SW            PIC X(01) VALUE 'N'.        00662099
006630         88  PS-DISTRO-TRBL-YES                 VALUE 'Y'.        00663099
006640         88  PS-DISTRO-TRBL-NO                  VALUE 'N'.        00664099
006700                                                                  00670000
006800 01  PV-PROGRAM-VARIABLES.                                        00680000
006900     05  PV-RETRY-COUNTER             PIC S9(4) VALUE ZERO        00690000
007000                                                COMP SYNC.        00700000
007100     05  PV-TEMP-COMP-X4.                                         00710000
007200         10  PV-TEMP-COMP             PIC S9(9) COMP.             00720000
007600     05  PV-DB2-COUNT                 PIC S9(09)  VALUE ZERO      00760000
007700                                              COMP-3.             00770000
007800     05  PV-DB2-ACK-COUNT             PIC S9(09)  VALUE ZERO      00780000
007900                                              COMP-3.             00790000
008000     05  PV-NULL-IND                  PIC S9(4) VALUE ZERO        00800000
008100                                                COMP SYNC.        00810000
008200     05  PV-COUNT                     PIC S9(9) VALUE +0 COMP.    00820000
008210     05  PV-TM500-FIELDS              PIC X(600).                 00821099
008250     05  PV-SQL-CNT                     PIC S9(04)   VALUE +0     00825099
008260                                                    COMP.         00826099
008300                                                                  00830000
008400 01  PRV-PROGRAM-RETURN-VARIABLES.                                00840000
008500     05  PRV-00                       PIC X(42) VALUE             00850000
008600         '00PROGRAM CALL WAS SUCCESSFUL             '.            00860000
009300     05  PRV-42                       PIC X(42) VALUE             00930000
009400         '42TROUBLE RECORD ALREADY ACKNOWLEDGED     '.            00940000
009500     05  PRV-43                       PIC X(42) VALUE             00950000
009600         '43TROUBLE RECORD NOT YET RESOLVED         '.            00960000
010900     05  PRV-4A                       PIC X(42) VALUE             01090000
011000         '4AINVALID TM500-PROCESS-IND               '.            01100000
011100     05  PRV-4B                       PIC X(42) VALUE             01110000
011200         '4BINVALID TM500-LEVEL-IND                 '.            01120000
014100     05  PRV-4Q                       PIC X(42) VALUE             01410000
014200         '4QDB2-ERROR - ACKNWLG-CSR CLOSE           '.            01420000
014300     05  PRV-4R                       PIC X(42) VALUE             01430000
014400         '4RDB2-ERROR - ACKNWLG-LINE/PACK-CSR OPEN  '.            01440000
014500     05  PRV-4S                       PIC X(42) VALUE             01450000
014600         '4SDB2-ERROR - ACKNWLG-LINE/PACK-CSR FETCH '.            01460000
014700     05  PRV-4T                       PIC X(42) VALUE             01470000
014800         '4TDB2-ERROR - ACKNWLG-LINE/PACK-CSR CLOSE '.            01480000
015500     05  PRV-4X                       PIC X(42) VALUE             01550000
015510         '4XDB2-ERROR - RESOLVE-LINE/PACK-CSR       '.            01551075
016001     05  PRV-70                       PIC X(42) VALUE             01600165
016010         '70DB2-ERROR - UNSUCCESSFUL RECDIS DELETE  '.            01601065
016020     05  PRV-71                       PIC X(42) VALUE             01602075
016030         '71DB2-ERROR - AUTO-ALL-CSR OPEN ERROR     '.            01603075
016040     05  PRV-72                       PIC X(42) VALUE             01604083
016050         '72DB2-ERROR - AUTO-ALL-CSR FETCH ERROR    '.            01605078
016060     05  PRV-73                       PIC X(42) VALUE             01606084
016070         '73ERROR - LINE TROUBLE TRECITM NOT FOUND  '.            01607084
016080     05  PRV-74                       PIC X(42) VALUE             01608086
016090         '74ERROR - PACK TROUBLE TRECITM NOT FOUND  '.            01609086
016091     05  PRV-75                       PIC X(42) VALUE             01609188
016092         '75DB2-ERROR - AUTO-PACK-CSR OPEN ERROR    '.            01609288
016093     05  PRV-76                       PIC X(42) VALUE             01609389
016094         '76DB2-ERROR - AUTO-PACK-CSR FETCH ERROR   '.            01609489
016100                                                                  01610000
016200******************************************************************01620000
016300*    COPYBOOK AREA                                                01630000
016400******************************************************************01640000
016500     COPY TMWS500.                                                01650000
016600                                                                  01660000
016610* ERROR DATA PASSED BACK UPSTREAM.                                01661099
016620     COPY TMRD007.                                                01662099
016621                                                                  01662199
016630* COPYBOOK FOR SHIPPING CONTROL MODULE                            01663099
016640     COPY WSWS001.                                                01664099
016650                                                                  01665099
016700******************************************************************01670000
016800*    DB2 SQL COMMUNICATION AREA                                   01680000
016900******************************************************************01690000
017000     EXEC SQL                                                     01700000
017100          INCLUDE SQLCA                                           01710000
017200     END-EXEC.                                                    01720000
017300                                                                  01730000
017400******************************************************************01740000
017500*    DB2 DCLGEN FOR PARM TABLE                                    01750000
017600******************************************************************01760000
017700     EXEC SQL                                                     01770000
017800          INCLUDE TKRPRPM                                         01780000
017900     END-EXEC.                                                    01790000
018000                                                                  01800000
018100******************************************************************01810000
018200*    DB2 DCLGEN FOR ALLOCATION TABLE                              01820000
018300******************************************************************01830000
018400     EXEC SQL                                                     01840000
018500          INCLUDE TALLPLN                                         01850000
018600     END-EXEC.                                                    01860000
018700                                                                  01870000
018800******************************************************************01880002
018900*    DB2 DCLGEN FOR PURCHASE ORDER TABLE                          01890003
019000******************************************************************01900003
019100     EXEC SQL                                                     01910003
019200          INCLUDE TPURCHS                                         01920003
019300     END-EXEC.                                                    01930003
019400                                                                  01940003
019500******************************************************************01950000
019600*    DB2 DCLGEN FOR TROUBLE NOTIFY TABLE                          01960000
019700******************************************************************01970000
019800     EXEC SQL                                                     01980000
019900          INCLUDE TTRBNTF                                         01990000
020000     END-EXEC.                                                    02000000
020100                                                                  02010000
020200******************************************************************02020000
020300*    DB2 DCLGEN FOR RECEIPT ITEM TABLE                            02030000
020400******************************************************************02040000
020500     EXEC SQL                                                     02050000
020600          INCLUDE TRECITM                                         02060000
020700     END-EXEC.                                                    02070000
020800                                                                  02080000
020810*---------------------------------------------------------------* 02081068
020820*    DB2 AREA FOR THE TRECDIS TABLE                             * 02082068
020830*---------------------------------------------------------------* 02083068
020840     EXEC SQL                                                     02084071
020850          INCLUDE TRECDIS                                         02085071
020860     END-EXEC.                                                    02086071
020870                                                                  02087068
020890***************************************************************   02089099
020891*    DB2 DCLGEN FOR SHIPMENT TABLE                                02089199
020892***************************************************************   02089299
020893     EXEC SQL                                                     02089399
020894          INCLUDE TSHIPMT                                         02089499
020895     END-EXEC.                                                    02089599
020896                                                                  02089699
020897***************************************************************   02089799
020898*    DB2 DCLGEN FOR SHIPMENT PO TABLE                             02089899
020899***************************************************************   02089999
020900     EXEC SQL                                                     02090099
020901          INCLUDE TSHPTPO                                         02090199
020902     END-EXEC.                                                    02090299
020903                                                                  02090399
020904***************************************************************   02090499
020905*    DB2 DCLGEN FOR RECEIVER TABLE                                02090599
020906***************************************************************   02090699
020907     EXEC SQL                                                     02090799
020908          INCLUDE TRECEIV                                         02090899
020909     END-EXEC.                                                    02090999
024600                                                                  02460000
032100******************************************************************03210000
032200*    RESOLVE AUTO MULTIPLE TROUBLE CURSOR                         03220000
032300******************************************************************03230000
032400     EXEC SQL                                                     03240000
032500          DECLARE AUTO-ALL-CSR CURSOR FOR                         03250000
032600          SELECT ORD_LNE_NBR                                      03260000
032620                ,PKSL_ITM_QTY                                     03262094
032630                ,DTL_CK_ITM_QTY                                   03263060
032700                ,PREPK_ID                                         03270000
032800            FROM TRECITM                                          03280000
032900           WHERE OPER_UNT_ID     = :TM500-OPER-UNT-ID             03290000
033000             AND FCLTY_ID        = :TM500-FCLTY-ID                03300000
033100             AND ORD_NBR         = :TM500-PO-NBR                  03310000
033200             AND REC_SEQ_NBR     = :TM500-REC-SEQ-NBR             03320000
033300             AND VER_STATUS_CDE  = :PC-A                          03330000
033400           ORDER BY ORD_LNE_NBR                                   03340000
033500     END-EXEC.                                                    03350000
033600                                                                  03360000
033700                                                                  03370000
033800******************************************************************03380000
033900*    RESOLVE AUTO PACK TROUBLE CURSOR                             03390000
034000******************************************************************03400000
034100     EXEC SQL                                                     03410000
034200          DECLARE AUTO-PACK-CSR CURSOR FOR                        03420000
034210          SELECT DISTINCT                                         03421062
034220                 ORD_LNE_NBR                                      03422062
034300                ,PREPK_ID                                         03430059
034400            FROM TRECITM                                          03440000
034500           WHERE OPER_UNT_ID        = :TM500-OPER-UNT-ID          03450059
034600             AND FCLTY_ID           = :TM500-FCLTY-ID             03460059
034700             AND ORD_NBR            = :TM500-PO-NBR               03470059
034800             AND REC_SEQ_NBR        = :TM500-REC-SEQ-NBR          03480059
034900             AND VER_STATUS_CDE     = :PC-A                       03490059
034910             AND  PREPK_DRV_LNE_CDE = 'A'                         03491059
035000           ORDER BY PREPK_ID                                      03500060
035100     END-EXEC.                                                    03510000
039000                                                                  03900000
041200******************************************************************04120000
041300*    ACKNWLG MULTIPLE TROUBLE NOTIFY CURSOR                       04130000
041400******************************************************************04140000
041500     EXEC SQL                                                     04150000
041600          DECLARE ACKNWLG-ALL-CSR CURSOR FOR                      04160000
041700          SELECT PO_LNE_NBR                                       04170000
041800               , PREPK_ID                                         04180000
041900               , NOTIF_NBR                                        04190000
042000               , RESOLVED_IND                                     04200000
042100               , RTV_IND                                          04210000
042200            FROM TTRBNTF                                          04220000
042300           WHERE OPER_UNT_ID  =  :TM500-OPER-UNT-ID               04230099
042400             AND FCLTY_ID     =  :TM500-FCLTY-ID                  04240099
042500             AND PO_NBR       =  :TM500-PO-NBR                    04250099
042600             AND REC_SEQ_NBR  =  :TM500-REC-SEQ-NBR               04260099
042700             AND TRBL_RSN_CDE =  :TM500-TRBL-RSN-CDE              04270099
042800             AND RESOLVED_IND IN (:PC-A, :PC-R)                   04280099
042900           ORDER BY PO_LNE_NBR                                    04290000
043000     END-EXEC.                                                    04300000
043100                                                                  04310000
043200 LINKAGE SECTION.                                                 04320000
043300                                                                  04330000
043310 01  TM500-COMMAREA              PIC X(600).                      04331015
043320 01  LINK-TM007-COMMAREA         PIC X(800).                      04332099
043900                                                                  04390000
044000 PROCEDURE DIVISION USING TM500-COMMAREA                          04400099
044010                          LINK-TM007-COMMAREA.                    04401099
044100                                                                  04410000
044200 0000-MAIN-MODULE.                                                04420000
044300                                                                  04430000
044400     PERFORM 1000-INITIAL-PROCESS.                                04440000
044500                                                                  04450000
044600     IF PS-NOT-DONE                                               04460000
044700         PERFORM 2000-MAIN-PROCESS                                04470000
044800     END-IF.                                                      04480000
044900                                                                  04490000
044920     SET TM500-ASN-SENT-TO-WMS-NO     TO TRUE                     04492099
044930         IF TM500-CALL-SUCCESSFUL                                 04493099
044940         OR TM500-DUPLICATE-TROUBLE                               04494099
044960         OR TM500-TTRBNTF-UPDATE-NOT-FND                          04496099
044970         OR TM500-PREPACK-ERROR                                   04497099
044980             PERFORM 6050-SELECT-TRECEIV                          04498099
044981             PERFORM 6000-CHECK-ASNDWN                            04498199
044990             IF PS-ASNS-TO-WMS-YES                                04499099
044991                AND PS-NOT-DONE                                   04499199
044992                 PERFORM 6020-CHECK-TRECDIS                       04499299
044993                 IF PS-DISTRO-TRBL-NO                             04499399
044994                     PERFORM 6030-GET-TRIP-ID                     04499499
044995                     IF PS-NOT-DONE                               04499599
045002                         PERFORM 6040-CALL-WMS-MODULE             04500299
045003                     END-IF                                       04500399
045004                 END-IF                                           04500499
045005             END-IF                                               04500599
045006         END-IF.                                                  04500699
045009                                                                  04500999
045010     MOVE TM500-FIELDS TO TM500-COMMAREA.                         04501099
045020     MOVE TM007-COMMUNICATIONS-AREA TO LINK-TM007-COMMAREA.       04502099
045100                                                                  04510000
045200     GOBACK.                                                      04520000
045300                                                                  04530000
045400                                                                  04540000
045500 1000-INITIAL-PROCESS.                                            04550000
045600                                                                  04560000
045700     INITIALIZE TM500-FIELDS                                      04570099
045800                TM007-COMMUNICATIONS-AREA.                        04580099
045810     SET PS-NOT-DONE                                              04581099
045820         PS-NO-MORE-RECORD    TO TRUE.                            04582099
045900                                                                  04590099
046000     MOVE LINK-TM007-COMMAREA TO TM007-COMMUNICATIONS-AREA.       04600099
046200     MOVE TM500-COMMAREA      TO TM500-FIELDS.                    04620099
046300     MOVE PRV-00              TO TM500-RETURN-DATA.               04630099
046400                                                                  04640000
059300                                                                  05930003
059400******************************************************************05940003
059500 2000-MAIN-PROCESS.                                               05950000
059600******************************************************************05960000
059800                                                                  05980000
059900     EVALUATE TRUE                                                05990000
060000         WHEN TM500-CREATE-AUTO                                   06000000
060010              PERFORM 8000-CLEANUP-RECDIS                         06001064
060020              IF PS-NOT-DONE                                      06002067
060100                  PERFORM 2100-CREATE-AUTO                        06010067
060110              END-IF                                              06011067
060200                                                                  06020000
062600         WHEN TM500-ACKNOWLEDGE                                   06260098
062700              PERFORM 2700-ACKNOWLEDGE                            06270098
062800                                                                  06280000
063200         WHEN OTHER                                               06320000
063300              SET  PS-DONE TO TRUE                                06330000
063400              MOVE SPACES  TO TM500-SQLCA                         06340000
063410                              TM007-SQLCA                         06341099
063500              MOVE ZEROES  TO TM500-SQLCODE                       06350000
063510                              TM007-SQLCODE                       06351099
063600              MOVE PRV-4A  TO TM500-RETURN-DATA                   06360000
063610                              TM007-RETURN-DATA                   06361099
063700     END-EVALUATE.                                                06370000
063800                                                                  06380000
063900******************************************************************06390000
064000 2100-CREATE-AUTO.                                                06400000
064100******************************************************************06410000
064200                                                                  06420000
064300     EVALUATE TRUE                                                06430000
064600         WHEN TM500-LINE-LEVEL                                    06460000
064800             PERFORM 4001-CHECK-LINE-TROUBLE                      06480017
065200         WHEN TM500-PACK-LEVEL                                    06520000
065400             PERFORM 5001-CHECK-PACK-TROUBLE                      06540017
065800         WHEN OTHER                                               06580000
065900              SET  PS-DONE TO TRUE                                06590000
066000              MOVE SPACES  TO TM500-SQLCA                         06600000
066010                              TM007-SQLCA                         06601099
066100              MOVE ZEROES  TO TM500-SQLCODE                       06610000
066110                              TM007-SQLCODE                       06611099
066200              MOVE PRV-4B  TO TM500-RETURN-DATA                   06620000
066210                              TM007-RETURN-DATA                   06621099
066300     END-EVALUATE.                                                06630000
066400                                                                  06640000
184500 2700-ACKNOWLEDGE.                                                18450098
184600                                                                  18460000
184633* * * WE ALWAYS WANT TO PROCESS EVERYTHING FOR THE RECEIVER       18463399
184634* * * FOR THE AUTO-ACKNLOWLEDGE PROJECT, SO....                   18463499
184635     MOVE ZERO               TO TM500-PO-LNE-NBR                  18463599
184636                                TM500-PREPK-ID.                   18463699
184640                                                                  18464099
184700     IF TM500-LINE-LEVEL OR TM500-PO-LEVEL                        18470098
184800     IF TM500-PO-LNE-NBR > ZEROES                                 18480098
184900         PERFORM 2705-COUNT-TROUBLES                              18490099
185000             IF PV-DB2-COUNT > ZERO                               18500099
185100                 PERFORM 2707-COUNT-TRBL-AGAIN                    18510099
185200                 IF PV-DB2-ACK-COUNT > ZERO                       18520099
185300*********TROUBLE RECORD ALREADY ACKNOWLEDGED                      18530000
185400                     SET PS-DONE TO TRUE                          18540099
185410* * * FOR THE AUTO-ACKNOLEDGE PROJECT THIS IS NOT AN ERROR        18541099
185500*                    MOVE PRV-42 TO TM500-RETURN-DATA             18550099
185600                 ELSE                                             18560099
185700                     PERFORM 2710-ACKNWLG-ONE-ONLY                18570098
185800             ELSE                                                 18580099
185900*********TROUBLE RECORD NOT YET RESOLVED                          18590000
186000                 SET PS-DONE TO TRUE                              18600099
186100                 MOVE PRV-43 TO TM500-RETURN-DATA                 18610099
186110                                TM007-RETURN-DATA                 18611099
186120                 MOVE '2700-ACKNOWLEDGE'                          18612099
186130                             TO TM007-RETURNED-PARA               18613099
186200     ELSE                                                         18620098
186300         PERFORM 2720-ACKNWLG-ALL-CSR                             18630098
186400     END-IF                                                       18640098
186500     END-IF.                                                      18650098
186600                                                                  18660000
186700     IF TM500-PACK-LEVEL                                          18670098
186800     IF TM500-PREPK-ID > ZEROES                                   18680098
186900         PERFORM 2705-COUNT-TROUBLES                              18690099
187000             IF PV-DB2-COUNT > ZERO                               18700099
187100                 PERFORM 2707-COUNT-TRBL-AGAIN                    18710099
187200                 IF PV-DB2-ACK-COUNT > ZERO                       18720099
187300*********TROUBLE RECORD ALREADY ACKNOWLEDGED                      18730000
187400                     SET PS-DONE TO TRUE                          18740099
187450* * * FOR THE AUTO-ACKNOLEDGE PROJECT THIS IS NOT AN ERROR        18745099
187500*                    MOVE PRV-42 TO TM500-RETURN-DATA             18750099
187600                 ELSE                                             18760099
187700                     PERFORM 2710-ACKNWLG-ONE-ONLY                18770098
187800             ELSE                                                 18780099
187900*********TROUBLE RECORD NOT YET RESOLVED                          18790000
188000                 SET PS-DONE TO TRUE                              18800099
188100                 MOVE PRV-43 TO TM500-RETURN-DATA                 18810099
188110                                TM007-RETURN-DATA                 18811099
188120                 MOVE '2700-ACKNOWLEDGE'                          18812099
188130                             TO TM007-RETURNED-PARA               18813099
188200     ELSE                                                         18820098
188300         PERFORM 2720-ACKNWLG-ALL-CSR                             18830098
188400     END-IF                                                       18840098
188500     END-IF.                                                      18850098
188600                                                                  18860000
188700 2705-COUNT-TROUBLES.                                             18870098
188710     MOVE '2705-COUNT-TROUBLES' TO TM007-RETURNED-PARA.           18871099
188720                                                                  18872099
188800     MOVE ZERO                TO PV-DB2-COUNT                     18880098
188900     EXEC SQL                                                     18890098
189000          SELECT COUNT(*)                                         18900098
189100            INTO :PV-DB2-COUNT                                    18910098
189200            FROM TTRBNTF                                          18920098
189300           WHERE NOTIF_NBR    = :TM500-NOTIF-NBR                  18930098
189400             AND RESOLVED_IND IN (:PC-R, :PC-A)                   18940099
189500     END-EXEC.                                                    18950098
189600                                                                  18960000
189700     IF SQLCODE = ZERO OR +100 OR -305                            18970098
189800         CONTINUE                                                 18980098
189900     ELSE                                                         18990098
190000        IF SQLCODE NOT = +0                                       19000098
190100            SET PS-DONE TO TRUE                                   19010098
190200            MOVE SQLCA TO TM500-SQLCA                             19020098
190210                          TM007-SQLCA                             19021099
190300            MOVE SQLCODE TO TM500-SQLCODE                         19030098
190310                            TM007-SQLCODE                         19031099
190400            MOVE PRV-4Q TO TM500-RETURN-DATA                      19040098
190410                           TM007-RETURN-DATA                      19041099
190500        END-IF.                                                   19050098
190600                                                                  19060000
190700                                                                  19070000
190800 2707-COUNT-TRBL-AGAIN.                                           19080098
190810     MOVE '2707-COUNT-TRBL-AGAIN'   TO TM007-RETURNED-PARA.       19081099
190820                                                                  19082099
190900     MOVE ZERO                TO PV-DB2-ACK-COUNT                 19090098
191000     EXEC SQL                                                     19100098
191100          SELECT COUNT(*)                                         19110098
191200            INTO :PV-DB2-ACK-COUNT                                19120098
191300            FROM TTRBNTF                                          19130098
191400           WHERE NOTIF_NBR    = :TM500-NOTIF-NBR                  19140098
191500             AND RESOLVED_IND = :PC-A                             19150098
191600     END-EXEC.                                                    19160098
191700                                                                  19170000
191800     EVALUATE SQLCODE                                             19180098
191900        WHEN +0                                                   19190098
192000        WHEN +100                                                 19200098
192100        WHEN -305                                                 19210098
192200            CONTINUE                                              19220098
192300        WHEN OTHER                                                19230098
192400            SET PS-DONE TO TRUE                                   19240098
192500            MOVE SQLCA TO TM500-SQLCA                             19250098
192510                          TM007-SQLCA                             19251099
192600            MOVE SQLCODE TO TM500-SQLCODE                         19260098
192610                            TM007-SQLCODE                         19261099
192700            MOVE PRV-4Q TO TM500-RETURN-DATA                      19270098
192710                           TM007-RETURN-DATA                      19271099
192800     END-EVALUATE.                                                19280098
192900                                                                  19290000
193000                                                                  19300000
193100 2710-ACKNWLG-ONE-ONLY.                                           19310098
193200******************************************************************19320000
193300******************************************************************19330000
193400                                                                  19340000
193410     MOVE '2710-ACKNWLG-ONE-ONLY' TO TM007-RETURNED-PARA.         19341099
193420                                                                  19342099
193500     MOVE PC-U                    TO TM500-CRUD-IND               19350098
193600     MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND               19360098
193700     PERFORM 9000-CREATE-TROUBLE-RECORD.                          19370098
193800                                                                  19380000
193900                                                                  19390000
194000 2720-ACKNWLG-ALL-CSR.                                            19400098
194100******************************************************************19410000
194200******************************************************************19420000
194300                                                                  19430000
194310     MOVE '2720-ACKNWLG-ALL-CSR'  TO TM007-RETURNED-PARA.         19431099
194320                                                                  19432099
194400     SET PS-MORE-RECORD TO TRUE.                                  19440098
194500                                                                  19450000
194600     PERFORM 2721-OPEN-ACKNWLG-ALL-CSR.                           19460098
194700                                                                  19470000
194800     IF PS-NOT-DONE                                               19480098
194900         PERFORM 2722-FETCH-ACKNWLG-ALL-CSR                       19490098
195000     END-IF.                                                      19500098
195100                                                                  19510000
195200     IF PS-NO-MORE-RECORD                                         19520098
195300         SET PS-DONE  TO TRUE                                     19530099
195400         MOVE PRV-43  TO TM500-RETURN-DATA                        19540099
195410                         TM007-RETURN-DATA                        19541099
195420         MOVE SQLCODE TO TM007-SQLCODE                            19542099
195430         MOVE SQLCA   TO TM007-SQLCA                              19543099
195500     ELSE                                                         19550098
195600         PERFORM 2723-PROCESS-ACKNWLG-ALL-CSR                     19560098
195700           UNTIL PS-NO-MORE-RECORD OR PS-DONE                     19570098
195800     END-IF.                                                      19580098
195900                                                                  19590000
196000     PERFORM 2724-CLOSE-ACKNWLG-ALL-CSR.                          19600098
196100                                                                  19610000
196200                                                                  19620000
196300 2721-OPEN-ACKNWLG-ALL-CSR.                                       19630098
196400******************************************************************19640000
196500******************************************************************19650000
196600                                                                  19660000
196620                                                                  19662099
196700     EXEC SQL                                                     19670098
196800          OPEN ACKNWLG-ALL-CSR                                    19680098
196900     END-EXEC.                                                    19690098
197000                                                                  19700000
197100     IF SQLCODE NOT = +0                                          19710098
197110         MOVE '2721-OPEN-ACKNWLG-ALL-CSR'                         19711099
197120                      TO TM007-RETURNED-PARA                      19712099
197200         SET PS-DONE  TO TRUE                                     19720098
197300         MOVE SQLCA   TO TM500-SQLCA                              19730098
197310                         TM007-SQLCA                              19731099
197400         MOVE SQLCODE TO TM500-SQLCODE                            19740098
197410                         TM007-SQLCODE                            19741099
197500         MOVE PRV-4R  TO TM500-RETURN-DATA                        19750098
197510                         TM007-RETURN-DATA                        19751099
197600     END-IF.                                                      19760098
197700                                                                  19770000
197800                                                                  19780000
197900 2722-FETCH-ACKNWLG-ALL-CSR.                                      19790098
198000******************************************************************19800000
198100******************************************************************19810000
198200                                                                  19820000
198300     EXEC SQL                                                     19830098
198400          FETCH ACKNWLG-ALL-CSR                                   19840098
198500           INTO :TRBNTF-PO-LNE-NBR                                19850098
198600              , :TRBNTF-PREPK-ID                                  19860098
198700              , :TRBNTF-NOTIF-NBR                                 19870098
198800              , :TRBNTF-RESOLVED-IND                              19880098
198900              , :TRBNTF-RTV-IND                                   19890098
199000     END-EXEC.                                                    19900098
199100                                                                  19910000
199200     EVALUATE TRUE                                                19920098
199300         WHEN SQLCODE = +0                                        19930098
199400             CONTINUE                                             19940098
199500                                                                  19950000
199600         WHEN SQLCODE = +100                                      19960098
199700              SET PS-NO-MORE-RECORD TO TRUE                       19970098
199800                                                                  19980000
199900         WHEN OTHER                                               19990098
199910              MOVE '2722-FETCH-ACKNWLG-ALL-CSR'                   19991099
199920                           TO TM007-RETURNED-PARA                 19992099
200000              SET PS-DONE  TO TRUE                                20000098
200100              MOVE SQLCA   TO TM500-SQLCA                         20010098
200110                              TM007-SQLCA                         20011099
200200              MOVE SQLCODE TO TM500-SQLCODE                       20020098
200210                              TM007-SQLCODE                       20021099
200300              MOVE PRV-4S  TO TM500-RETURN-DATA                   20030098
200310                              TM007-RETURN-DATA                   20031099
200400     END-EVALUATE.                                                20040098
200500                                                                  20050000
200600                                                                  20060000
200610******************************************************************20061099
200620*  THE FETCH OF THE CURSOR WILL RETURN ALL RESOLVED AND          *20062099
200621*  ACKNOWLEDGED ROWS, HOWEVER, IN THE FOLLOWING IF THE ROW IS    *20062199
200622*  ALREADY ACKNOWLEDGED, THEN THERE IS NO FURTHER PROCESSING TO  *20062299
200623*  BE DONE FOR THE ROW FROM THE CURSOR SO IT DOES NOT CALL THE   *20062399
200624*  9000 PARAPRAPH SINCE THE LINE IS ALREADY ACKNOWLEDGED AND     *20062499
200625*  THUS WILL FALL THRU TO FETCH THE NEXT ROW FROM THE CURSOR.    *20062599
200626*                                                                *20062699
200627*  THE CURSOR FETCHES ALL RESOLVED AND ACKNOWLEDGED ROWS SINCE   *20062799
200628*  WE ARE PROCESSING DATA FROM THE RCT_AUTOACKNL_TRBL TABLE AND  *20062899
200629*  SOMETIMES BOTH THE RESOLVE AND ACKNOWLEDGED TIMESTAMPS MAY    *20062999
200630*  BE SET FOR THE TROUBLE BUT THE REDISTRO STILL NEEDS TO BE     *20063099
200631*  PROCESSED.  THE RETURN OF BOTH FROM THE CURSOR WILL KEEP THE  *20063199
200632*  MODULE FROM GETTING A +100 ERROR ON THE FIRST FETCH AFTER THE *20063299
200633*  OPEN WHICH WAS CAUSING THE JOB TO NOT PROCESS ALL OF THE      *20063399
200634*                                                                *20063499
200635*  FYI - THE FOLLOWING CODE WILL BE USED TO UPDATE THE TROUBLE   *20063599
200636*  ROW TO ACKNOWLEDGE THE TROUBLE - THE PC-U INTO THE            *20063699
200637*  TM500-CRUD-IND TELLS THE CALLED MODULE TO DO AN UPDATE, NOT   *20063799
200638*  AN INSERT.  COMING INTO THIS PROGRAM AND GETTING INTO THIS    *20063899
200639*  LOGIC HAPPENS BECAUSE THIS 88 LEVEL IS SET WHICH IS TELLING   *20063999
200640*  THE MODULES TO DO THE ACKNOWLDEGMENT PROCESS FOR THE TROUBLE  *20064099
200641*  BEING PROCESSED:  TM500-ACKNOWLEDGE                           *20064199
200650******************************************************************20065099
200700 2723-PROCESS-ACKNWLG-ALL-CSR.                                    20070098
201000                                                                  20100000
201010     IF  TRBNTF-RESOLVED-IND = PC-R                               20101099
201100         MOVE PC-U                TO TM500-CRUD-IND               20110099
201200         MOVE TRBNTF-NOTIF-NBR    TO TM500-NOTIF-NBR              20120099
201300         MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND           20130099
201400         MOVE TRBNTF-RTV-IND      TO TM500-RTV-SW                 20140099
201500         PERFORM 9000-CREATE-TROUBLE-RECORD                       20150099
201510     END-IF.                                                      20151099
201600                                                                  20160000
201700     IF PS-NOT-DONE                                               20170098
201800         PERFORM 2722-FETCH-ACKNWLG-ALL-CSR                       20180098
201900     END-IF.                                                      20190098
202000                                                                  20200000
202100 2724-CLOSE-ACKNWLG-ALL-CSR.                                      20210096
202200******************************************************************20220000
202420                                                                  20242099
202500     EXEC SQL                                                     20250096
202600          CLOSE ACKNWLG-ALL-CSR                                   20260096
202700     END-EXEC.                                                    20270096
202800                                                                  20280000
202900     IF SQLCODE = +100                                            20290096
203000         CONTINUE                                                 20300096
203100     ELSE                                                         20310096
203200        IF SQLCODE NOT = +0                                       20320096
203300            SET PS-DONE  TO TRUE                                  20330099
203310            MOVE '2724-CLOSE-ACKNWLG-ALL-CSR'                     20331099
203320                         TO TM007-RETURNED-PARA                   20332099
203400            MOVE SQLCA   TO TM500-SQLCA                           20340099
203410                            TM007-SQLCA                           20341099
203500            MOVE SQLCODE TO TM500-SQLCODE                         20350096
203510                            TM007-SQLCODE                         20351099
203600            MOVE PRV-4T TO TM500-RETURN-DATA                      20360096
203610                           TM007-RETURN-DATA                      20361099
203700        END-IF.                                                   20370096
203800                                                                  20380099
209800******************************************************************20980000
209900 4001-CHECK-LINE-TROUBLE.                                         20990000
209901     MOVE '4001-CHECK-LINE-TROUBLE'   TO TM007-RETURNED-PARA.     20990199
209902                                                                  20990299
209903     PERFORM 4010-OPEN-AUTO-ALL-CSR.                              20990369
209904     IF PS-NOT-DONE                                               20990471
209905         SET PS-MORE-RECORD TO TRUE                               20990580
209906         PERFORM 4030-FETCH-AUTO-ALL-CSR                          20990671
209907     END-IF.                                                      20990771
209908     IF PS-NO-MORE-RECORD                                         20990871
209909         SET PS-DONE  TO TRUE                                     20990999
209910         MOVE PRV-73  TO TM500-RETURN-DATA                        20991099
209911                        TM007-RETURN-DATA                         20991199
209912         MOVE SQLCODE TO TM007-SQLCODE                            20991299
209913         MOVE SQLCA   TO TM007-SQLCA                              20991399
209914     ELSE                                                         20991471
209915         MOVE TM500-FIELDS   TO PV-TM500-FIELDS                   20991599
209916         PERFORM 4020-PROCESS-AUTO-ALL-CSR                        20991671
209917           UNTIL PS-NO-MORE-RECORD                                20991772
209918              OR PS-DONE                                          20991872
209919         EXEC SQL                                                 20991982
209920             CLOSE AUTO-ALL-CSR                                   20992082
209921         END-EXEC                                                 20992182
209922     END-IF.                                                      20992272
209923                                                                  20992382
209924 4010-OPEN-AUTO-ALL-CSR.                                          20992472
209925     MOVE '4010-OPEN-AUTO-ALL-CSR'   TO TM007-RETURNED-PARA.      20992599
209926                                                                  20992699
209927     EXEC SQL                                                     20992772
209928          OPEN AUTO-ALL-CSR                                       20992872
209929     END-EXEC.                                                    20992972
209930                                                                  20993072
209931     IF SQLCODE NOT = +0                                          20993172
209932         SET PS-DONE  TO TRUE                                     20993272
209933         MOVE SQLCA   TO TM500-SQLCA                              20993372
209934                         TM007-SQLCA                              20993499
209935         MOVE SQLCODE TO TM500-SQLCODE                            20993572
209936                         TM007-SQLCODE                            20993699
209937         MOVE PRV-71  TO TM500-RETURN-DATA                        20993775
209938                         TM007-RETURN-DATA                        20993899
209939     END-IF.                                                      20993972
209959                                                                  20995972
209960 4020-PROCESS-AUTO-ALL-CSR.                                       20996080
209962     MOVE RECITM-ORD-LNE-NBR        TO TM500-PO-LNE-NBR           20996281
209963     IF RECITM-DTL-CK-ITM-QTY > ZEROS                             20996372
209964         MOVE RECITM-DTL-CK-ITM-QTY TO TM500-UNITS-TO-ALLOC       20996463
209965     ELSE                                                         20996563
209966         MOVE RECITM-PKSL-ITM-QTY   TO TM500-UNITS-TO-ALLOC       20996663
209970     END-IF.                                                      20997063
210000                                                                  21000000
210300     CALL PC-RCKUP821 USING TM500-FIELDS                          21030099
210400                            TM007-COMMUNICATIONS-AREA             21040099
210600                                                                  21060000
210700     EVALUATE TRUE                                                21070000
210800       WHEN TM500-CALL-SUCCESSFUL                                 21080000
210900       WHEN TM500-DUPLICATE-TROUBLE                               21090000
211000       WHEN TM500-TTRBNTF-UPDATE-NOT-FND                          21100000
211100       WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                         21110000
211110           PERFORM 4030-FETCH-AUTO-ALL-CSR                        21111099
211120           MOVE PV-TM500-FIELDS     TO TM500-FIELDS               21112099
211300                                                                  21130000
211400       WHEN OTHER                                                 21140000
211500           SET PS-DONE TO TRUE                                    21150000
211600     END-EVALUATE.                                                21160000
211700                                                                  21170000
211710 4030-FETCH-AUTO-ALL-CSR.                                         21171080
211712                                                                  21171299
211720     EXEC SQL                                                     21172080
211730          FETCH AUTO-ALL-CSR                                      21173080
211740           INTO :RECITM-ORD-LNE-NBR                               21174080
211750               ,:RECITM-PKSL-ITM-QTY                              21175080
211760               ,:RECITM-DTL-CK-ITM-QTY                            21176094
211770               ,:RECITM-PREPK-ID                                  21177080
211780     END-EXEC.                                                    21178080
211790     EVALUATE TRUE                                                21179080
211791         WHEN SQLCODE = +0                                        21179180
211792              CONTINUE                                            21179281
211794         WHEN SQLCODE = +100                                      21179480
211795              SET PS-NO-MORE-RECORD TO TRUE                       21179580
211798         WHEN OTHER                                               21179880
211799              SET PS-DONE  TO TRUE                                21179980
211800              MOVE SQLCA   TO TM500-SQLCA                         21180080
211801                              TM007-SQLCA                         21180199
211802              MOVE SQLCODE TO TM500-SQLCODE                       21180280
211803                              TM007-SQLCODE                       21180399
211804              MOVE PRV-72  TO TM500-RETURN-DATA                   21180480
211805                              TM007-RETURN-DATA                   21180599
211806     END-EVALUATE.                                                21180680
211810                                                                  21181000
213900******************************************************************21390000
214000 5001-CHECK-PACK-TROUBLE.                                         21400000
214001     MOVE '5001-CHECK-PACK-TROUBLE'   TO TM007-RETURNED-PARA.     21400199
214002                                                                  21400299
214010     PERFORM 5010-OPEN-AUTO-PACK-CSR.                             21401085
214020     IF PS-NOT-DONE                                               21402085
214030         SET PS-MORE-RECORD TO TRUE                               21403085
214040         PERFORM 5030-FETCH-AUTO-PACK-CSR                         21404085
214050     END-IF.                                                      21405085
214060     IF PS-NO-MORE-RECORD                                         21406085
214070         SET PS-DONE  TO TRUE                                     21407099
214080         MOVE PRV-74  TO TM500-RETURN-DATA                        21408099
214090                         TM007-RETURN-DATA                        21409099
214091         MOVE SQLCODE TO TM007-SQLCODE                            21409199
214092         MOVE SQLCA   TO TM007-SQLCA                              21409299
214093     ELSE                                                         21409385
214094         MOVE TM500-FIELDS       TO PV-TM500-FIELDS               21409499
214095         PERFORM 5020-PROCESS-AUTO-PACK-CSR                       21409585
214096           UNTIL PS-NO-MORE-RECORD                                21409685
214097              OR PS-DONE                                          21409785
214098         EXEC SQL                                                 21409885
214099             CLOSE AUTO-PACK-CSR                                  21409985
214100         END-EXEC                                                 21410085
214101     END-IF.                                                      21410185
214102                                                                  21410287
214103 5010-OPEN-AUTO-PACK-CSR.                                         21410387
214104     MOVE '5010-AUTO-PACK-CSR'   TO TM007-RETURNED-PARA.          21410499
214105                                                                  21410599
214106     EXEC SQL                                                     21410687
214107          OPEN AUTO-PACK-CSR                                      21410787
214108     END-EXEC.                                                    21410887
214109                                                                  21410987
214110     IF SQLCODE NOT = +0                                          21411087
214111         SET PS-DONE  TO TRUE                                     21411187
214112         MOVE SQLCA   TO TM500-SQLCA                              21411287
214113                         TM007-SQLCA                              21411399
214114         MOVE SQLCODE TO TM500-SQLCODE                            21411487
214115                         TM007-SQLCODE                            21411599
214116         MOVE PRV-75  TO TM500-RETURN-DATA                        21411688
214117                         TM007-RETURN-DATA                        21411799
214118     END-IF.                                                      21411887
214119                                                                  21411900
214120 5020-PROCESS-AUTO-PACK-CSR.                                      21412093
214121     MOVE '5020-PROCESS-AUTO-PACK-CSR'  TO TM007-RETURNED-PARA.   21412199
214122                                                                  21412299
214123     MOVE RECITM-ORD-LNE-NBR        TO TM500-PO-LNE-NBR           21412390
214124     MOVE RECITM-PREPK-ID           TO TM500-PREPK-ID             21412490
214126     CALL PC-RCKUP821 USING TM500-FIELDS                          21412699
214130                            TM007-COMMUNICATIONS-AREA             21413099
214700                                                                  21470000
214800     EVALUATE TRUE                                                21480000
214900       WHEN TM500-CALL-SUCCESSFUL                                 21490000
215000       WHEN TM500-DUPLICATE-TROUBLE                               21500000
215100       WHEN TM500-TTRBNTF-UPDATE-NOT-FND                          21510000
215200       WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                         21520000
215300       WHEN TM500-PREPACK-ERROR                                   21530000
215310           PERFORM 5030-FETCH-AUTO-PACK-CSR                       21531099
215320           MOVE PV-TM500-FIELDS     TO TM500-FIELDS               21532099
215500                                                                  21550000
215600       WHEN OTHER                                                 21560000
215700           SET PS-DONE TO TRUE                                    21570000
215800     END-EVALUATE.                                                21580000
215802                                                                  21580291
215810 5030-FETCH-AUTO-PACK-CSR.                                        21581093
215812                                                                  21581299
215820     EXEC SQL                                                     21582089
215830          FETCH AUTO-PACK-CSR                                     21583092
215840           INTO :RECITM-ORD-LNE-NBR                               21584089
215870               ,:RECITM-PREPK-ID                                  21587089
215880     END-EXEC.                                                    21588089
215890     EVALUATE TRUE                                                21589089
215891         WHEN SQLCODE = +0                                        21589189
215892              CONTINUE                                            21589289
215893         WHEN SQLCODE = +100                                      21589389
215894              SET PS-NO-MORE-RECORD TO TRUE                       21589489
215897         WHEN OTHER                                               21589789
215898              SET PS-DONE  TO TRUE                                21589889
215899              MOVE SQLCA   TO TM500-SQLCA                         21589989
215900                              TM007-SQLCA                         21590099
215901              MOVE SQLCODE TO TM500-SQLCODE                       21590189
215902                              TM007-SQLCODE                       21590299
215903              MOVE PRV-76  TO TM500-RETURN-DATA                   21590389
215904                              TM007-RETURN-DATA                   21590499
215905     END-EVALUATE.                                                21590589
215906                                                                  21590600
215908******************************************************************21590899
215909*  THIS PARAGRAPH CHECKS TO SEE IF THE DC IS DOWNLOADING TO WMS   21590999
215910******************************************************************21591099
215911 6000-CHECK-ASNDWN.                                               21591199
215912                                                                  21591299
215913     MOVE RECEIV-OPER-UNT-ID  TO KRPRPM-LOC-ID.                   21591399
215914                                                                  21591499
215915     EXEC SQL                                                     21591599
215916          SELECT   FUNC_TXT                                       21591699
215917            INTO  :KRPRPM-FUNC-TXT                                21591799
215918            FROM                                                  21591899
215919                  TKRPRPM                                         21591999
215920            WHERE                                                 21592099
215921                  LOC_ID            = :KRPRPM-LOC-ID              21592199
215922              AND SYS_PRC_FUNC_CDE  = 'ASNDWN'                    21592299
215923              AND FUNC_PRC_STAT_CDE = 'AC'                        21592399
215924              AND INTFC_SYS_CDE     = 'KHL'                       21592499
215925              AND FUNC_TXT          = 'Y'                         21592599
215926              AND FUNC_BEG_TMST    < CURRENT TIMESTAMP            21592699
215927     END-EXEC.                                                    21592799
215928                                                                  21592899
215929     EVALUATE TRUE                                                21592999
215930         WHEN SQLCODE = ZERO                                      21593099
215931              SET PS-ASNS-TO-WMS-YES    TO TRUE                   21593199
215932         WHEN SQLCODE = +100                                      21593299
215933              SET PS-ASNS-TO-WMS-NO     TO TRUE                   21593399
215934         WHEN SQLWARN0 NOT = SPACES                               21593499
215935         WHEN SQLCODE  NOT = ZERO                                 21593599
215936             SET  PS-DONE TO TRUE                                 21593699
215937             MOVE SQLCA   TO TM500-SQLCA                          21593799
215938                             TM007-SQLCA                          21593899
215939             MOVE SQLCODE TO TM500-SQLCODE                        21593999
215940                             TM007-SQLCODE                        21594099
215941             MOVE PRV-4X  TO TM500-RETURN-DATA                    21594199
215942                             TM007-RETURN-DATA                    21594299
215947     END-EVALUATE.                                                21594799
215948                                                                  21594899
215949******************************************************************21594999
215950*  THIS PARAGRAPH CHECKS TO SEE IF THE TRECDIS ROWS EXIST.        21595099
215951******************************************************************21595199
215952 6020-CHECK-TRECDIS.                                              21595299
215953                                                                  21595399
215954     MOVE 0 TO PV-SQL-CNT.                                        21595499
215955                                                                  21595599
215956     EXEC SQL                                                     21595699
215957         SELECT COUNT(*)                                          21595799
215958           INTO :PV-SQL-CNT                                       21595899
215959           FROM TRECDIS                                           21595999
215960          WHERE ORD_NBR        = :TM500-PO-NBR                    21596099
215961            AND ORD_LNE_NBR    = :TM500-PO-LNE-NBR                21596199
215962            AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR               21596299
215963            AND OPER_UNT_ID    = :TM500-OPER-UNT-ID               21596399
215964            AND FCLTY_ID       = :TM500-FCLTY-ID                  21596499
215966     END-EXEC.                                                    21596699
215967                                                                  21596799
215968     EVALUATE TRUE                                                21596899
215969         WHEN SQLCODE = ZERO                                      21596999
215970             IF PV-SQL-CNT = 0                                    21597099
215971                 SET PS-DISTRO-TRBL-YES TO TRUE                   21597199
215972             ELSE                                                 21597299
215973                 SET PS-DISTRO-TRBL-NO  TO TRUE                   21597399
215974             END-IF                                               21597499
215975         WHEN SQLCODE = +100                                      21597599
215976                 SET PS-DISTRO-TRBL-YES TO TRUE                   21597699
215977                                                                  21597799
215978         WHEN SQLCODE = -904                                      21597899
215979         WHEN SQLCODE = -911                                      21597999
215980         WHEN SQLCODE = -913                                      21598099
215981             CONTINUE                                             21598199
215982                                                                  21598299
215983         WHEN SQLWARN0 NOT = SPACES                               21598399
215984         WHEN SQLCODE  NOT = ZERO                                 21598499
215985             SET  PS-DONE TO TRUE                                 21598599
215986             MOVE SQLCA   TO TM500-SQLCA                          21598699
215987                             TM007-SQLCA                          21598799
215988             MOVE SQLCODE TO TM500-SQLCODE                        21598899
215989                             TM007-SQLCODE                        21598999
215990             MOVE PRV-4X  TO TM500-RETURN-DATA                    21599099
215991                             TM007-RETURN-DATA                    21599199
215992     END-EVALUATE.                                                21599299
215993                                                                  21599399
215994******************************************************************21599499
215995*  THIS PARAGRAPH GETS THE TRIP-ID FROM THE PO/RCVR.              21599599
215996******************************************************************21599699
215997 6030-GET-TRIP-ID.                                                21599799
215998                                                                  21599899
215999     EXEC SQL                                                     21599999
216000         SELECT A.TRIP_ID                                         21600099
216001           INTO :SHIPMT-TRIP-ID                                   21600199
216002           FROM TSHIPMT   A                                       21600299
216003              , TSHPTPO   B                                       21600399
216004          WHERE B.PO_NBR         = :TM500-PO-NBR                  21600499
216005            AND B.REC_SEQ_NBR    = :TM500-REC-SEQ-NBR             21600599
216006            AND A.SHIPT_ID       = B.SHIPT_ID                     21600699
216007            AND B.PRIM_SHIPT_IND = 'Y'                            21600799
216008     END-EXEC.                                                    21600899
216009                                                                  21600999
216010     EVALUATE TRUE                                                21601099
216011         WHEN SQLCODE = ZERO                                      21601199
216012             CONTINUE                                             21601299
216013         WHEN SQLCODE = -904                                      21601399
216014         WHEN SQLCODE = -911                                      21601499
216015         WHEN SQLCODE = -913                                      21601599
216016             CONTINUE                                             21601699
216017                                                                  21601799
216018         WHEN SQLWARN0 NOT = SPACES                               21601899
216019         WHEN SQLCODE  NOT = ZERO                                 21601999
216020             SET  PS-DONE TO TRUE                                 21602099
216021             MOVE SQLCA   TO TM500-SQLCA                          21602199
216022                             TM007-SQLCA                          21602299
216023             MOVE SQLCODE TO TM500-SQLCODE                        21602399
216024                             TM007-SQLCODE                        21602499
216025             MOVE PRV-4X  TO TM500-RETURN-DATA                    21602599
216026                             TM007-RETURN-DATA                    21602699
216027     END-EVALUATE.                                                21602799
216028                                                                  21602899
216029*----------------------------------------------------------       21602999
216030* LINK TO WMS VENDOR SHIPMENT CONTROL MODULE (WSKCS305) USING     21603099
216031*  COPYBOOK WSWS001.                                              21603199
216032*----------------------------------------------------------------*21603299
216033 6040-CALL-WMS-MODULE.                                            21603399
216034                                                                  21603499
216035     IF TM500-CALL-SUCCESSFUL                                     21603599
216036         SET WS001-INSERT           TO TRUE                       21603699
216037     ELSE                                                         21603799
216038         SET WS001-PKSLIP-INACTIVE  TO TRUE                       21603899
216039     END-IF.                                                      21603999
216040     MOVE SHIPMT-TRIP-ID            TO WS001-TRIP-ID.             21604099
216041     MOVE TM500-OPER-UNT-ID         TO WS001-OPER-UNT-ID.         21604199
216042     MOVE 'TMKUP520'                TO WS001-USER-ID.             21604299
216043     MOVE TM500-PO-NBR              TO WS001-PO-NBR.              21604399
216044     MOVE TM500-PO-LNE-NBR          TO WS001-PO-LNE-NBR.          21604499
216045     MOVE TM500-REC-SEQ-NBR         TO WS001-RCVR-NBR.            21604599
216046     MOVE TM500-PREPK-ID            TO WS001-PREPK-ID.            21604699
216047     MOVE ZEROS                     TO WS001-SKU-NBR.             21604799
216048     MOVE ZEROS                     TO WS001-KOHLS-SHIPT-ID.      21604899
216049     MOVE 'RC'                      TO WS001-SHIPMENT-SOURCE.     21604999
216050     MOVE SPACES                    TO WS001-DTL-ASN-LEVEL-IND.   21605099
216051     MOVE ZEROS                     TO WS001-SRC-TASK-NUMBER.     21605199
216052     MOVE 'TMKUP520'                TO WS001-CALLING-PROGRAM-NAME.21605299
216053                                                                  21605399
216055     CALL PC-WSKUP305               USING WS001-FIELDS.           21605599
216060                                                                  21606099
216061     EVALUATE TRUE                                                21606199
216062         WHEN WS001-SUCCESSFUL                                    21606299
216063             SET TM500-ASN-SENT-TO-WMS-YES    TO TRUE             21606399
216065                                                                  21606599
216066         WHEN OTHER                                               21606699
216067             SET  PS-DONE TO TRUE                                 21606799
216068             MOVE SQLCA   TO TM500-SQLCA                          21606899
216069                             TM007-SQLCA                          21606999
216070             MOVE SQLCODE TO TM500-SQLCODE                        21607099
216071                             TM007-SQLCODE                        21607199
216072             MOVE PRV-4X  TO TM500-RETURN-DATA                    21607299
216073                             TM007-RETURN-DATA                    21607399
216074                                                                  21607499
216075     END-EVALUATE.                                                21607599
216076                                                                  21607699
216077******************************************************************21607799
216078*  THIS PARAGRAPH GETS THE CURRENT OPER ID FOR THE PO/RCVR        21607899
216079******************************************************************21607999
216080 6050-SELECT-TRECEIV.                                             21608099
216081                                                                  21608199
216082     MOVE TM500-PO-NBR        TO RECEIV-ORD-NBR.                  21608299
216083     MOVE TM500-REC-SEQ-NBR   TO RECEIV-REC-SEQ-NBR.              21608399
216084                                                                  21608499
216085     EXEC SQL                                                     21608599
216086         SELECT OPER_UNT_ID                                       21608699
216087           INTO :RECEIV-OPER-UNT-ID                               21608799
216088           FROM TRECEIV                                           21608899
216089          WHERE ORD_NBR         = :RECEIV-ORD-NBR                 21608999
216090            AND REC_SEQ_NBR     = :RECEIV-REC-SEQ-NBR             21609099
216091            AND VER_STATUS_CDE  = 'A'                             21609199
216092     END-EXEC.                                                    21609299
216093                                                                  21609399
216094     EVALUATE TRUE                                                21609499
216095         WHEN SQLCODE = ZERO                                      21609599
216096         WHEN SQLCODE = -811                                      21609699
216097             CONTINUE                                             21609799
216098         WHEN SQLCODE = +100                                      21609899
216099              MOVE ZERO           TO RECEIV-OPER-UNT-ID           21609999
216100         WHEN SQLCODE = -904                                      21610099
216101         WHEN SQLCODE = -911                                      21610199
216102         WHEN SQLCODE = -913                                      21610299
216103             CONTINUE                                             21610399
216104                                                                  21610499
216105         WHEN SQLWARN0 NOT = SPACES                               21610599
216106         WHEN SQLCODE  NOT = ZERO                                 21610699
216107             SET  PS-DONE TO TRUE                                 21610799
216108             MOVE SQLCA   TO TM500-SQLCA                          21610899
216109                             TM007-SQLCA                          21610999
216110             MOVE SQLCODE TO TM500-SQLCODE                        21611099
216111                             TM007-SQLCODE                        21611199
216112             MOVE PRV-4X  TO TM500-RETURN-DATA                    21611299
216113                             TM007-RETURN-DATA                    21611399
216114     END-EVALUATE.                                                21611499
216115                                                                  21611599
216118*----------------------------------------------------------------*21611899
216119*    DELETE LINE LEVEL RECDIS.                                   *21611999
216120*----------------------------------------------------------------*21612099
216121 8000-CLEANUP-RECDIS.                                             21612199
216122     MOVE '8000-CLEANUP-RECDIS'   TO TM007-RETURNED-PARA.         21612299
216123                                                                  21612399
216124                                                                  21612499
216125     EXEC SQL                                                     21612599
216126           DELETE                                                 21612699
216127             FROM TRECDIS                                         21612799
216128            WHERE OPER_UNT_ID      = :TM500-OPER-UNT-ID           21612899
216129              AND FCLTY_ID         = :TM500-FCLTY-ID              21612999
216130              AND ORD_NBR          = :TM500-PO-NBR                21613099
216131              AND REC_SEQ_NBR      = :TM500-REC-SEQ-NBR           21613199
216132     END-EXEC                                                     21613299
216133                                                                  21613399
216134     EVALUATE TRUE                                                21613499
216135         WHEN SQLCODE = ZERO                                      21613599
216136         WHEN SQLCODE = +100                                      21613699
216137              CONTINUE                                            21613799
216138         WHEN OTHER                                               21613899
216139              SET PS-DONE  TO TRUE                                21613999
216140              MOVE SQLCA   TO TM500-SQLCA                         21614099
216141                              TM007-SQLCA                         21614199
216142              MOVE SQLCODE TO TM500-SQLCODE                       21614299
216143                              TM007-SQLCODE                       21614399
216144              MOVE PRV-70  TO TM500-RETURN-DATA                   21614499
216145                              TM007-RETURN-DATA                   21614599
216146     END-EVALUATE.                                                21614699
216147                                                                  21614799
216148 9000-CREATE-TROUBLE-RECORD.                                      21614899
216150******************************************************************21615099
216200*    THIS PARAGRAPH CALLS PROGRAM TMKCS521 THAT CREATES TROUBLE   21620000
216300*    RECORDS IN TABLE TTRBNTF.                                    21630000
216400******************************************************************21640000
216410     MOVE '9000-CREATE-TROUBLE-RECORD'  TO TM007-RETURNED-PARA.   21641099
216420                                                                  21642099
216500                                                                  21650000
216800     CALL PC-TMKUP521 USING TM500-FIELDS                          21680099
216900                            TM007-COMMUNICATIONS-AREA             21690099
217100                                                                  21710000
217200     EVALUATE TRUE                                                21720097
217300         WHEN TM500-CALL-SUCCESSFUL                               21730097
217400         WHEN TM500-DUPLICATE-TROUBLE                             21740097
217500         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        21750097
217600         WHEN TM500-TPURCHS-SELECT-NOT-FND                        21760097
217700              CONTINUE                                            21770097
217800                                                                  21780000
217900         WHEN OTHER                                               21790097
218000              SET PS-DONE TO TRUE                                 21800097
218100     END-EVALUATE.                                                21810097
