000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400 PROGRAM-ID.    RCKUT106.                                         00040001
000500 AUTHOR.        JOE LAROSA.                                       00050001
000600 INSTALLATION.  KOHLS.                                            00060001
000700 DATE-WRITTEN.  MARCH 2000.                                       00070001
000800 DATE-COMPILED.                                                   00080001
000900***************************************************************** 00090001
001000*  THIS PROGRAM READS IN THE WEEKLY STORE RECEIPT EXTRACT FILE  * 00100001
001100*  (STOREEXT), REPLACES THE EXPECTED & VERIFIED ITEM QUANTITIES * 00110001
001200*  WITH ACTUAL QUANTITY COUNTS FROM (TRECDIS), AND REWRITES THE * 00120001
001300*  FILE BACK OUT AGAIN (SAME FORMAT).                           * 00130001
001400***************************************************************** 00140001
001500*  CHANGED MM/DD/YY BY XXXXXXXXXXX                              * 00150001
001600*   WR# XXXX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX * 00160001
001700*                                                               * 00170001
001800***************************************************************** 00180001
001900***************************************************************** 00190001
002000 ENVIRONMENT DIVISION.                                            00200001
002100***************************************************************** 00210001
002200 INPUT-OUTPUT SECTION.                                            00220001
002300                                                                  00230001
002400 FILE-CONTROL.                                                    00240001
002500                                                                  00250001
002600     SELECT INP-STOREEXT-FILE ASSIGN TO UT-S-INP01.               00260001
002700     SELECT OUT-STOREEXT-FILE ASSIGN TO UT-S-OUT01.               00270001
002800                                                                  00280001
002900***************************************************************** 00290001
003000 DATA DIVISION.                                                   00300001
003100***************************************************************** 00310001
003200 FILE SECTION.                                                    00320001
003300                                                                  00330001
003400 FD  INP-STOREEXT-FILE                                            00340001
003500     RECORDING MODE IS F                                          00350001
003600     LABEL RECORDS ARE STANDARD                                   00360001
003700     RECORD CONTAINS 300                                          00370001
003800     BLOCK CONTAINS 0 RECORDS                                     00380001
003900     DATA RECORD IS INPUT-RECORD.                                 00390001
004000 01  INPUT-RECORD                PIC X(300).                      00400001
004100                                                                  00410001
004200 FD  OUT-STOREEXT-FILE                                            00420001
004300     RECORDING MODE IS F                                          00430001
004400     LABEL RECORDS ARE STANDARD                                   00440001
004500     RECORD CONTAINS 300                                          00450001
004600     BLOCK CONTAINS 0 RECORDS                                     00460001
004700     DATA RECORD IS OUTPUT-RECORD.                                00470001
004800 01  OUTPUT-RECORD               PIC X(300).                      00480001
004900                                                                  00490001
005000***************************************************************** 00500001
005100 WORKING-STORAGE SECTION.                                         00510001
005200                                                                  00520001
005300 01  PS-PROGRAM-SWITCHES.                                         00530001
005400     05  PS-END-OF-INPUT-SW           PIC  X(01) VALUE 'N'.       00540001
005500         88  PS-END-OF-INPUT                     VALUE 'Y'.       00550001
005600         88  PS-NOT-END-OF-INPUT                 VALUE 'N'.       00560001
005700     05  PS-END-OF-CURSOR-SW          PIC  X(01) VALUE 'N'.       00570001
005800         88  PS-END-OF-CURSOR-YES                VALUE 'Y'.       00580001
005900         88  PS-END-OF-CURSOR-NO                 VALUE 'N'.       00590001
006000                                                                  00600001
006100 01  DK-DB2-KEY-FIELDS.                                           00610001
006200     05  DK-ORD-NBR                   PIC S9(09) COMP.            00620001
006300     05  DK-REC-SEQ-NBR               PIC S9(09) COMP.            00630001
006400     05  DK-ORD-LNE-NBR               PIC S9(09) COMP.            00640001
006500                                                                  00650001
006600 01  PV-PROGRAM-VARIABLES.                                        00660001
006700     05  PV-SQLCODE                   PIC  9(09) VALUE ZERO.      00670001
006800     05  PV-SUM-UNITS-EXPTD           PIC S9(09) COMP.            00680001
006900     05  PV-SUM-UNITS-VRFYD           PIC S9(09) COMP.            00690001
007000                                                                  00700001
007100     05  PV-RECORDS-READ              PIC S9(08) VALUE ZERO.      00710001
007200     05  PV-RECORDS-WRITTEN           PIC S9(08) VALUE ZERO.      00720001
007300     05  PV-DISPLAY-RECORD            PIC ZZ,ZZZ,ZZ9-.            00730001
028700     05  PV-NULL-IND-1                PIC S9(04) VALUE +0 COMP.   00731002
028700     05  PV-NULL-IND-2                PIC S9(04) VALUE +0 COMP.   00732002
007400                                                                  00740001
007500 01 PC-PROGRAM-CONSTANTS.                                         00750001
007600     05 PC-PROGRAM-NAME               PIC  X(08) VALUE 'RCKUT106'.00760001
007700                                                                  00770001
007800 01  PV-ABEND-FIELDS.                                             00780001
007900     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         00790001
008000                                                 COMP SYNC.       00800001
008100     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'RCKUT106'.00810001
008200     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00820001
008300     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00830001
008400     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    00840001
008500     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    00850001
008600     05  PV-ABEND-STRUCTURE-3         PIC  X(08) VALUE SPACES.    00860001
008700     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00870001
008800     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00880001
008900     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00890001
009000     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    00900001
009100     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    00910001
009200                                                                  00920001
009300******************************************************************00930001
009400*  USED FOR DB2 ERROR MESSAGE BUILDING                            00940001
009500******************************************************************00950001
009600     COPY DPWS004.                                                00960004
009700                                                                  00970001
009800******************************************************************00980001
009900*   DB2 SQL COMMUNICATION AREA                                    00990001
010000******************************************************************01000001
010100     EXEC SQL                                                     01010001
010200          INCLUDE SQLCA                                           01020001
010300     END-EXEC.                                                    01030001
010400                                                                  01040001
010500******************************************************************01050001
010600*   DB2 DCLGEN FOR THE RECEIVING DISTRIBUTION TABLE               01060001
010700******************************************************************01070001
010800     EXEC SQL                                                     01080001
010900          INCLUDE TRECDIS                                         01090001
011000     END-EXEC.                                                    01100001
011100                                                                  01110001
011200***********************************************************       01120001
011300*  COPYBOOK USED BY INPUT/OUTPUT FILE                     *       01130001
011400***********************************************************       01140001
011500     COPY STOREEXT.                                               01150004
011600                                                                  01160001
011700/**********************************************************       01170001
011800 PROCEDURE DIVISION.                                              01180001
011900***********************************************************       01190001
012000     DISPLAY '*** BEGINNING RCKUT106 ***'.                        01200001
012100                                                                  01210001
012200     OPEN INPUT  INP-STOREEXT-FILE                                01220001
012300          OUTPUT OUT-STOREEXT-FILE.                               01230001
012400                                                                  01240001
012500*READ FIRST INPUT RECORD.                                         01250001
012600     SET PS-NOT-END-OF-INPUT TO TRUE.                             01260001
012700     READ INP-STOREEXT-FILE                                       01270001
012800       INTO STORE-EXTRACT-LINE                                    01280001
012900         AT END                                                   01290001
013000           SET PS-END-OF-INPUT TO TRUE.                           01300001
013100                                                                  01310001
013200*PROCESS INPUT FILE.                                              01320001
013300     IF PS-END-OF-INPUT                                           01330001
013400         DISPLAY '**** NO INPUT FILE FOUND FOR RCKUT106 ****'     01340001
013500     ELSE                                                         01350001
013600         PERFORM 1000-PROCESS-INPUT                               01360001
013700           UNTIL PS-END-OF-INPUT                                  01370001
013800     END-IF.                                                      01380001
013900                                                                  01390001
014000     DISPLAY '****************************************'.          01400001
014100     MOVE PV-RECORDS-READ        TO PV-DISPLAY-RECORD.            01410001
014200     DISPLAY '*** RECORDS READ        ==> ' PV-DISPLAY-RECORD.    01420001
014300     MOVE PV-RECORDS-WRITTEN     TO PV-DISPLAY-RECORD.            01430001
014400     DISPLAY '*** RECORDS WRITTEN     ==> ' PV-DISPLAY-RECORD.    01440001
014500     DISPLAY '****************************************'.          01450001
014600                                                                  01460001
014700*CLOSE FILES.                                                     01470001
014800     CLOSE INP-STOREEXT-FILE                                      01480001
014900           OUT-STOREEXT-FILE.                                     01490001
015000                                                                  01500001
015100     GOBACK.                                                      01510001
015200                                                                  01520001
015300                                                                  01530001
015400***************************************************************** 01540001
015500 1000-PROCESS-INPUT.                                              01550001
015600***************************************************************** 01560001
015700     MOVE '1000-PROCESS-INPUT         ' TO PV-ABEND-PARAGRAPH.    01570001
015800                                                                  01580001
015900     ADD +1      TO PV-RECORDS-READ.                              01590001
016000                                                                  01600001
016100     MOVE ZEROES TO PV-SUM-UNITS-EXPTD                            01610001
016200                    PV-SUM-UNITS-VRFYD.                           01620001
016300                                                                  01630001
016400*SUM ITEM QUANTITIES.                                             01640001
016500     MOVE SE-PO          TO DK-ORD-NBR.                           01650001
016600     MOVE SE-REC-SEQ-NBR TO DK-REC-SEQ-NBR.                       01660001
016700     MOVE SE-POLINENO    TO DK-ORD-LNE-NBR.                       01670001
016800                                                                  01680001
016900     EXEC SQL                                                     01690001
017000         SELECT SUM (EXPTED_ITM_QTY)                              01700001
017100              , SUM (AP_VERIFY_ITM_QTY)                           01710001
017200           INTO :PV-SUM-UNITS-EXPTD :PV-NULL-IND-1                01720002
017300              , :PV-SUM-UNITS-VRFYD :PV-NULL-IND-2                01730002
017400           FROM TRECDIS                                           01740001
017500          WHERE ORD_NBR      = :DK-ORD-NBR                        01750001
017600            AND REC_SEQ_NBR  = :DK-REC-SEQ-NBR                    01760001
017700            AND ORD_LNE_NBR  = :DK-ORD-LNE-NBR                    01770001
017800     END-EXEC.                                                    01780001
017900                                                                  01790001
018000     EVALUATE TRUE                                                01800001
018100       WHEN SQLCODE = ZERO                                        01810001
018200           IF PV-NULL-IND-1 < 0                                   01820003
018300               MOVE ZEROES TO PV-SUM-UNITS-EXPTD                  01830003
018200           END-IF                                                 01831003
018200           IF PV-NULL-IND-2 < 0                                   01831103
018300               MOVE ZEROES TO PV-SUM-UNITS-VRFYD                  01832003
018200           END-IF                                                 01833003
018400       WHEN OTHER                                                 01840001
018500           MOVE '1000-PROCESS-INPUT' TO PV-ABEND-PARAGRAPH        01850001
018600           MOVE 'SUM ITM QTYS' TO PV-DB2-OPERATION-MESSAGE-1      01860001
018700           MOVE 'TRECDIS'      TO PV-DB2-TABLE-NAME               01870001
018800           PERFORM 9900-DB2-ABEND                                 01880001
018900     END-EVALUATE.                                                01890001
019000                                                                  01900001
019100*WRITE EXTRACT RECORD.                                            01910001
019200     MOVE PV-SUM-UNITS-EXPTD TO SE-RETAIL-UNITS-RECVD.            01920001
019300     MOVE PV-SUM-UNITS-VRFYD TO SE-RETAIL-UNITS-MARK.             01930001
019400                                                                  01940001
019500     WRITE OUTPUT-RECORD                                          01950001
019600      FROM STORE-EXTRACT-LINE.                                    01960001
019700                                                                  01970001
019800     ADD +1 TO PV-RECORDS-WRITTEN.                                01980001
019900                                                                  01990001
020000*READ NEXT INPUT RECORD.                                          02000001
020100     PERFORM 2000-READ-INPUT-FILE.                                02010001
020200                                                                  02020001
020300***************************************************************** 02030001
020400 2000-READ-INPUT-FILE.                                            02040001
020500***************************************************************** 02050001
020600     MOVE '2000-READ-INPUT-FILE       ' TO PV-ABEND-PARAGRAPH.    02060001
020700                                                                  02070001
020800     READ INP-STOREEXT-FILE                                       02080001
020900       INTO STORE-EXTRACT-LINE                                    02090001
021000         AT END                                                   02100001
021100           SET PS-END-OF-INPUT TO TRUE.                           02110001
021200                                                                  02120001
021300******************************************************************02130001
021400 9900-DB2-ABEND.                                                  02140001
021500******************************************************************02150001
021600     MOVE '9900-DB2-ABEND             ' TO PV-ABEND-PARAGRAPH.    02160001
021700                                                                  02170001
021800     MOVE SQLCODE TO PV-SQLCODE.                                  02180001
021900     DISPLAY '*** DB2 ERROR '.                                    02190001
022000     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02200001
022100     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02210001
022200     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02220001
022300     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02230001
022400     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02240001
022500     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02250001
022600     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             02260001
022700                                                                  02270001
022800     COPY DPPD004.                                                02280001
022900                                                                  02290001
023000     MOVE +4013 TO PV-ABEND-CODE.                                 02300001
023100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02310001
023200                                                                  02320001
023300******************************************************************02330001
023400******************************************************************02340001
