       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.       XSKUT100.                                      00020000
       AUTHOR.           KOHLS DEPARTMENT STORES.                       00030000
       INSTALLATION.     KOHLS DEPARTMENT STORES.                       00040000
       DATE-WRITTEN      JUNE 2004.                                     00050000
       DATE-COMPILED.                                                   00060000
      ******************************************************************00070000
      *  PROGRAM REQUESTS FOR FASHION SALES ONHAND, STORE ONHAND AND    00080000
      *      INTRANSIT QUANTITIES:                                      00081000
      *      PROGRAMS WILL CALL THIS DRIVER MODULE WHEN REQUESTING      00090000
      *      ONE OR MORE OF THESE THREE FIELDS. THIS MODULE WILL THEN   00100000
      *      CALL THE APPROPRIATE MODULE(S) TO ACQUIRE THE DATA.        00110000
      ******************************************************************00120000
      **DATE:05/21/2004  CHANGED BY: DAVID WELLER INITIAL WRITE         00130014
      ******************************************************************00140000
      **DATE:06/14/2004  CHANGED BY: DAVID WELLER                       00141014
      *     USE XS DOMAIN TABLES WHERE POSSIBLE                         00141114
      ******************************************************************00142004
      **DATE:06/16/2004  CHANGED BY: DAVID WELLER                       00143016
      *     USE XLKUT074 INSTEAD OF RFKUT003                            00144016
      ******************************************************************00145016
      **DATE:06/16/2004  CHANGED BY: DAVID WELLER                       00146019
      *     ACCESS XLKUT074 BY UPC-NBR INSTEAD OF INTR-UPC-ID           00147019
      ******************************************************************00148019
      **DATE:07/29/2004  CHANGED BY: DAVID WELLER                       00149019
      *     ACCESS XMKUT001 INSTEAD OF XSKUT101 FOR ONHAND              00149119
      ******************************************************************00149219
      **DATE:08/03/2004  CHANGED BY: DAVID WELLER                       00149330
      *     IMPROVE ERROR HANDLING                                      00149430
      ******************************************************************00149530
091504**DATE:09/15/2004  CHANGED BY: RAY GRAF                           00149641
091504*     WHEN A SELECT AGAINST TSKST FOR OH YIELDS A NOT FOUND IN    00149741
091504*     XMKUT001, DO NOT FLAG THIS AS AN ERROR.                     00149841
      ******************************************************************00149941
       ENVIRONMENT DIVISION.                                            00150000
       DATA DIVISION.                                                   00160000
       WORKING-STORAGE SECTION.                                         00170000
      ****                                                              00170116
      * COPY BOOK NEEDED TO CALL XLKUT074                               00170216
      ***                                                               00170316
           COPY XLWS074.                                                00171016
      ****                                                              00171128
      * COPY BOOK NEEDED TO CALL XMKUT001                               00171228
      ***                                                               00171328
           COPY XMWS004.                                                00171428
                                                                        00172015
      ******************************************************************00180000
      **PROGRAM SWITCHES                                                00190000
      ******************************************************************00200000
       01  PS-PROGRAM-SWITCHES.                                         00210000
           05  PS-RETRIEVE-KEYS-SW     PIC X(01)  VALUE 'Y'.            00220000
               88  PS-RETRIEVE-KEYS-YES           VALUE 'Y'.            00230000
               88  PS-RETRIEVE-KEYS-NO            VALUE 'N'.            00240000
      ******************************************************************00250000
      **PROGRAM CONSTANTS                                               00260000
      ******************************************************************00270000
       01  PC-PROGRAM-CONSTANTS.                                        00280000
           05  PC-ONHAND-PROGRAM       PIC  X(08) VALUE 'XMKUT001'.     00310019
      ******************************************************************00320000
      **PROGRAM VARIABLES                                               00330000
      ******************************************************************00340000
       01  PV-PROGRAM-VARIABLES.                                        00350000
           05  PV-SKU-NBR              PIC 9(08).                       00360000
           05  PV-INTR-UPC-ID          PIC S9(09)  COMP.                00370000
           05  PV-ITM-NBR              PIC S9(15)V COMP-3.              00380000
           05  PV-STORE-NBR            PIC 9(04).                       00390000
           05  PV-RETURN-CODE          PIC X(01).                       00400000
               88  PV-RETURN-CODE-FOUND             VALUE 'Y'.          00410000
               88  PV-RETURN-CODE-NOT-FOUND         VALUE 'N'.          00420000
           05  PV-QUANTITY             PIC S9(05).                      00430000
      ******************************************************************00440000
      **TABLE INCLUSIONS                                                00450000
      ******************************************************************00460000
      **SKU XS DOMAIN TABLE                                             00501019
           EXEC SQL                                                     00502014
                INCLUDE XST00010                                        00503019
           END-EXEC.                                                    00504014
      **UPC XS DOMAIN TABLE                                             00505019
           EXEC SQL                                                     00506019
                INCLUDE XST00012                                        00507019
           END-EXEC.                                                    00508019
      **COMMUNICATIONS AREA FOR DB2                                     00590000
           EXEC SQL                                                     00600000
                INCLUDE SQLCA                                           00610000
           END-EXEC.                                                    00620000
                                                                        00630000
       LINKAGE SECTION.                                                 00640000
      ******************************************************************00650000
           COPY XSWS004.                                                00661000
                                                                        00670000
       PROCEDURE DIVISION USING XSWS004-DATA.                           00680000
      ******************************************************************00690000
       0000-MAINLINE.                                                   00700000
                                                                        00710000
           INITIALIZE DCLXST00010.                                      00720019
           INITIALIZE DCLXST00012.                                      00730014
           INITIALIZE XSWS004-DATA-RETURNED.                            00740000
                                                                        00750000
           PERFORM 1000-SELECT-KEYS.                                    00760000
                                                                        00770000
           IF  PS-RETRIEVE-KEYS-YES                                     00780000
      * SKU RETRIEVED SUCCESSFULLY                                      00780130
               SET XSWS004-STR-OH-ERROR-N                               00781012
                                       TO TRUE                          00782012
               SET XSWS004-FS-OH-ERROR-N                                00783019
                                       TO TRUE                          00784019
               SET XSWS004-INTRANSIT-ERROR-N                            00785033
                                       TO TRUE                          00786033
               SET XSWS004-STR-EXPCTD-ERROR-N                           00787033
                                       TO TRUE                          00788033
               PERFORM 3000-CALL-INTRANSIT-MODULE                       00870000
               PERFORM 4000-CALL-ONHAND-MODULE                          00930000
               IF XSWS004-STR-OH-ERROR-N                                00972031
                   COMPUTE XSWS004-STR-OH =                             00973030
                           XSWS004-FS-OH - XSWS004-STR-EXPCTD           00974030
               ELSE                                                     00975030
                   MOVE ZEROS          TO XSWS004-STR-OH                00976030
               END-IF                                                   00977030
           ELSE                                                         00978030
      * WITHOUT SKU, NOTHING CAN BE RETRIEVED                           00978130
               MOVE -3                 TO XSWS004-RETURN-SQLCODE        00979030
               MOVE 'XSKUT100'         TO XSWS004-ERROR-PROGRAM         00980030
               MOVE 'ERROR RETRIEVING SKU'                              00990030
                                       TO XSWS004-ERROR-MESSAGE         01000030
               SET XSWS004-INTRANSIT-ERROR-Y                            01010030
                                       TO TRUE                          01011030
               SET XSWS004-STR-EXPCTD-ERROR-Y                           01012030
                                       TO TRUE                          01013030
               SET XSWS004-FS-OH-ERROR-Y                                01014030
                                       TO TRUE                          01015030
               SET XSWS004-STR-OH-ERROR-Y                               01016030
                                       TO TRUE                          01017030
           END-IF.                                                      01020000
                                                                        01030000
           GOBACK.                                                      01040000
                                                                        01050000
       EJECT.                                                           01060000
      ******************************************************************01070000
      **SELECT SKU NUMBER FROM TABLE XST_UPC AND XST_SKU                01080030
      ******************************************************************01090000
       1000-SELECT-KEYS.                                                01100000
                                                                        01110000
           EXEC SQL                                                     01130019
               SELECT  SKU_NBR                                          01140019
                 INTO  :XST00010-SKU-NBR                                01150019
                 FROM  XST_SKU B                                        01160019
                     , XST_UPC A                                        01170019
                WHERE  A.UPC_NBR     =  :XSWS004-KEY-UPC-NBR            01180019
                  AND  B.INTR_UPC_ID =  A.INTR_UPC_ID                   01190019
                 WITH  UR                                               01191034
           END-EXEC.                                                    01200019
                                                                        01270000
           EVALUATE TRUE                                                01280000
              WHEN SQLCODE = ZERO                                       01290000
                   SET PS-RETRIEVE-KEYS-YES                             01300001
                                       TO TRUE                          01301001
              WHEN OTHER                                                01310000
                   DISPLAY 'UPC_NBR:      ' XSWS004-KEY-UPC-NBR         01312019
                   DISPLAY 'SQLCODE:      ' SQLCODE                     01313024
                   SET PS-RETRIEVE-KEYS-NO                              01320001
                                       TO TRUE                          01321001
           END-EVALUATE.                                                01330000
                                                                        01340000
       EJECT.                                                           01570000
      ***************************************************************** 01580000
      **CALL INTRANSIT CALLED PROGRAM                                   01590000
      ***************************************************************** 01600000
       3000-CALL-INTRANSIT-MODULE.                                      01610000
                                                                        01620000
           INITIALIZE XL074-ITEM-COMMAREA.                              01621016
           SET XL074-BY-UPC-NBR        TO TRUE.                         01622119
           SET XL074-BY-STORE          TO TRUE.                         01623016
           MOVE XSWS004-KEY-UPC-NBR    TO XL074-KEY-UPC-NBR.            01625019
           MOVE XSWS004-KEY-STR-NBR    TO XL074-KEY-LOC-NBR.            01630016
                                                                        01640000
           CALL XL074-BATCH-PGM USING XL074-ITEM-COMMAREA.              01682016
                                                                        01690000
           IF XL074-SQL-ERROR                                           01691035
               MOVE +0                 TO XSWS004-STR-EXPCTD            01691235
               MOVE +0                 TO XSWS004-INTRANSIT             01691335
               MOVE XL074-SQLCODE      TO XSWS004-RETURN-SQLCODE        01691435
               MOVE XL074-BATCH-PGM                                     01691535
                                       TO XSWS004-ERROR-PROGRAM         01691635
               STRING XL074-ERROR-PARAGRAPH-NBR                         01691735
                       ' '                                              01691835
                       XL074-CALLED-PROGRAM-PARA                        01691935
                       DELIMITED BY SIZE                                01692036
                                       INTO XSWS004-ERROR-MESSAGE       01692135
               SET XSWS004-INTRANSIT-ERROR-Y                            01692235
                                       TO TRUE                          01692335
               SET XSWS004-STR-EXPCTD-ERROR-Y                           01692435
                                       TO TRUE                          01692535
               SET XSWS004-STR-OH-ERROR-Y                               01692635
                                       TO TRUE                          01692735
           ELSE                                                         01692835
               MOVE XL074-SE-QTY       TO XSWS004-STR-EXPCTD            01692935
               MOVE XL074-IT-QTY       TO XSWS004-INTRANSIT             01693035
               MOVE XL074-SQLCODE      TO XSWS004-RETURN-SQLCODE        01693135
               SET XSWS004-INTRANSIT-ERROR-N                            01693235
                                       TO TRUE                          01693316
               SET XSWS004-STR-EXPCTD-ERROR-N                           01693435
                                       TO TRUE                          01693516
           END-IF.                                                      01695035
                                                                        01760000
       EJECT.                                                           01770000
      ******************************************************************01780000
      **CALL ONHAND PROGRAM                                             01790000
      ******************************************************************01800000
       4000-CALL-ONHAND-MODULE.                                         01810000
           INITIALIZE XM004-CURR-POSITION-DATA.                         01811029
                                                                        01820000
           MOVE XST00010-SKU-NBR       TO XM004-KEY-SKU.                01821027
           MOVE XSWS004-KEY-STR-NBR    TO XM004-KEY-STR-NBR.            01830019
           SET XM004-ONORDER-NO        TO TRUE.                         01831019
           SET XM004-ONHAND-YES        TO TRUE.                         01832019
                                                                        01840000
           CALL PC-ONHAND-PROGRAM USING XM004-CURR-POSITION-DATA.       01850019
           EVALUATE XM004-RETURN-SQLCODE                                01851030
               WHEN +0                                                  01851130
                   MOVE XM004-ONHAND   TO XSWS004-FS-OH                 01851230
                   MOVE XM004-RETURN-SQLCODE                            01851330
                                       TO XSWS004-RETURN-SQLCODE        01851430
                   SET XSWS004-FS-OH-ERROR-N                            01851530
                                       TO TRUE                          01851630
               WHEN +100                                                01851730
                   MOVE +0             TO XSWS004-FS-OH                 01851830
                   MOVE XM004-RETURN-SQLCODE                            01851930
                                       TO XSWS004-RETURN-SQLCODE        01852030
091504             SET XSWS004-FS-OH-ERROR-N                            01852141
091504                                 TO TRUE                          01852241
091504**           MOVE PC-ONHAND-PROGRAM                               01852341
091504**                               TO XSWS004-ERROR-PROGRAM         01852441
091504**           MOVE 'FASHION SALES ONHAND INFORMATION NOT FOUND'    01852541
091504**                               TO XSWS004-ERROR-MESSAGE         01852641
091504**           SET XSWS004-STR-OH-ERROR-Y                           01852841
091504**                               TO TRUE                          01852941
               WHEN OTHER                                               01853030
                   MOVE +0             TO XSWS004-FS-OH                 01853130
                   MOVE XM004-RETURN-SQLCODE                            01853230
                                       TO XSWS004-RETURN-SQLCODE        01853330
                   MOVE PC-ONHAND-PROGRAM                               01853430
                                       TO XSWS004-ERROR-PROGRAM         01853530
                   MOVE 'ERROR RETRIEVING FASHION SALES ONHAND INFO'    01853630
                                       TO XSWS004-ERROR-MESSAGE         01853730
                   SET XSWS004-FS-OH-ERROR-Y                            01853830
                                       TO TRUE                          01853930
                   SET XSWS004-STR-OH-ERROR-Y                           01854030
                                       TO TRUE                          01854130
           END-EVALUATE.                                                01854230
                                                                        01960000
       EJECT.                                                           01970000
