000100 TITLE 'ECOMMERCE CUSTOMER DIRECT SHIP RECEIPT ERRORS RPT'.       00010064
000200 IDENTIFICATION DIVISION.                                         00020064
000300 PROGRAM-ID.             RCKRP042.                                00030064
000400 AUTHOR.                 LYNN MCADAMS.                            00040064
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050064
000600 DATE-WRITTEN            MAY, 2005.                               00060064
000700 DATE-COMPILED.                                                   00070064
000800*                                                                 00080064
000900***************************************************************** 00090064
001000*  THIS PROGRAM DISPLAYS DIRECT SHIP ERRORS THAT NEED TO BE     * 00100064
001100*  RESEARCHED.                                                  * 00110064
001200*                                                               * 00120064
001300*  THE INPUT FILE IS FROM THE RCRD074 RECORD LAYOUT,            * 00130064
001400*                                                               * 00140064
001500*  THE REPORT IS SEQUENCED BY ERROR DATE, PO NBR AND SKU.       * 00150064
001600*                                                               * 00160064
001700***************************************************************** 00170064
001800*  CHANGED 09/14/16 BY DAN HINTZ                                * 00180064
001900*   WR# XXXX ADDED VENDOR NAME AND DEPARTMENT TO THE DETAIL     * 00190064
001910*            LINES ON THE REPORT.                               * 00191064
001920***************************************************************** 00192064
001930***************************************************************** 00193064
001940 ENVIRONMENT DIVISION.                                            00194064
001950***************************************************************** 00195064
001960 CONFIGURATION SECTION.                                           00196064
001970 SOURCE-COMPUTER.        IBM-3090.                                00197064
001980 OBJECT-COMPUTER.        IBM-3090.                                00198064
001990                                                                  00199064
002000 INPUT-OUTPUT SECTION.                                            00200064
002100 FILE-CONTROL.                                                    00210064
002200                                                                  00220064
002300     SELECT INPUT-FILE                                            00230064
002400         ASSIGN TO INP01.                                         00240064
002500                                                                  00250064
002600     SELECT REPORT-FILE                                           00260064
002700         ASSIGN TO RPT01.                                         00270064
002800                                                                  00280064
002900***************************************************************** 00290064
003000 DATA DIVISION.                                                   00300064
003100***************************************************************** 00310064
003200 FILE SECTION.                                                    00320064
003300                                                                  00330064
003400 FD  INPUT-FILE                                                   00340064
003500     RECORDING MODE IS F                                          00350064
003600     LABEL RECORDS ARE STANDARD                                   00360064
003700     BLOCK CONTAINS 0 RECORDS.                                    00370064
003800 01  INPUT-RECORD                    PIC  X(100).                 00380064
003900                                                                  00390064
004000 FD  REPORT-FILE                                                  00400064
004100     RECORDING MODE IS F                                          00410064
004200     BLOCK CONTAINS 0  RECORDS.                                   00420064
004300 01  REPORT-RECORD                   PIC  X(132).                 00430064
004400                                                                  00440064
004500***************************************************************** 00450064
004600 WORKING-STORAGE SECTION.                                         00460064
004700                                                                  00470064
004800 01  PROGRAM-SWITCHES.                                            00480064
004900     05  PS-END-OF-INPUT-FILE-SW     PIC X(01) VALUE 'N'.         00490064
005000         88  PS-END-OF-INPUT                   VALUE 'Y'.         00500064
005100         88  PS-NOT-END-OF-INPUT               VALUE 'N'.         00510064
005200     05  PS-SKU-FOUND-SW             PIC X(01) VALUE 'N'.         00520064
005300         88  PS-SKU-FOUND-YES                  VALUE 'Y'.         00530064
005400         88  PS-SKU-FOUND-NO                   VALUE 'N'.         00540064
005500                                                                  00550064
005600 01  DK-DB-KEYS.                                                  00560064
005700     05  DK-SKU-NBR                  PIC  S9(8)V COMP-3.          00570064
005800     05  DK-PO-NBR                   PIC  S9(9)  COMP.            00580064
005900                                                                  00590064
006000 01  PC-PROGRAM-CONSTANTS.                                        00600064
006100     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00610064
006200         'RCKRP042'.                                              00620064
006300     05  PC-REPORT-NBR               PIC X(02) VALUE '-1'.        00630064
006400     05  PC-AST                      PIC X(01) VALUE '*'.         00640064
006500     05  PC-1                        PIC X(01) VALUE '1'.         00650064
006600     05  PC-D                        PIC X(01) VALUE 'D'.         00660064
006700     05  PC-ERROR-01                 PIC X(25)                    00670064
006800                            VALUE 'PO NOT ON FILE           '.    00680064
006900     05  PC-ERROR-02                 PIC X(25)                    00690064
007000                            VALUE 'ITEM NOT ON PO           '.    00700064
007100     05  PC-ERROR-04                 PIC X(25)                    00710064
007200                            VALUE 'STORE IN INVENTORY CYCLE '.    00720064
007300     05  PC-ERROR-05                 PIC X(25)                    00730064
007400                            VALUE 'RCV QTY > ORDERED QTY    '.    00740064
007410     05  PC-ERROR-06                 PIC X(25)                    00741066
007420                            VALUE 'NO DC SPLIT              '.    00742066
007430     05  PC-ERROR-07                 PIC X(25)                    00743066
007440                            VALUE 'NO STORE ALLOCATION      '.    00744066
007500     05  PC-UNKNOWN-ERROR            PIC X(25)                    00750064
007600                            VALUE 'UNKNOWN ERROR            '.    00760064
007700                                                                  00770064
007800 01  PV-PROGRAM-VARIABLES.                                        00780064
007900     05  PV-READ-COUNT                PIC S9(7) COMP-3            00790064
008000                                                VALUE ZERO.       00800064
008100     05  PV-WRITE-COUNT               PIC S9(7) COMP-3            00810064
008200                                                VALUE ZERO.       00820064
008300     05  PV-PAGE-COUNT               PIC S9(4) VALUE ZERO         00830064
008400                                                   COMP-3.        00840064
008500     05  PV-LINE-COUNT               PIC S9(3) VALUE ZERO         00850064
008600                                                   COMP-3.        00860064
008700     05  PV-MAX-LINE-COUNT           PIC S9(3) VALUE +60          00870064
008800                                                   COMP-3.        00880064
008900*    05  PV-UNT-RTL-AMT              PIC S9(09)    VALUE ZERO     00890064
009000*                                                  COMP SYNC.     00900064
009100     05  PV-UNT-RTL-AMT              PIC S9(7)V9(2) VALUE ZERO    00910064
009200                                                   COMP-3.        00920064
009300*    05  PV-ACCUM-RETAIL-COUNT       PIC S9(09)    VALUE ZERO     00930064
009400*                                                  COMP SYNC.     00940064
009500     05  PV-ACCUM-RETAIL-COUNT       PIC S9(7)V9(2) VALUE ZERO    00950064
009600                                                   COMP-3.        00960064
009700     05  PV-SQLCODE                  PIC 9(09) VALUE ZERO.        00970064
009800     05  PV-DB2-FUNCTION             PIC X(30) VALUE SPACE.       00980064
009900     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00990064
010000     05  PV-ABEND-OPERATION1         PIC  X(51) VALUE SPACES.     01000064
010100     05  PV-ABEND-OPERATION2         PIC  X(51) VALUE SPACES.     01010064
010200     05  PV-DB2-TABLE-NAME           PIC  X(11) VALUE SPACES.     01020064
010300     05  PV-DB2-TABLE-NAME1          PIC  X(11) VALUE SPACES.     01030064
010400                                                                  01040064
010500     05  PV-DISPLAY-READ-COUNT       PIC ZZZ,ZZZ,ZZ9.             01050064
010600     05  PV-DISPLAY-WRITE-COUNT      PIC ZZZ,ZZZ,ZZ9.             01060064
010700                                                                  01070064
010800     05  PV-DISPLAY-PO-NBR-X.                                     01080064
010900         10  PV-DISPLAY-PO-NBR-N     PIC 9(08)  VALUE ZEROS.      01090064
011000                                                                  01100064
011100 01  SD-DATE-TIME.                                                01110064
011200     05  SD-SYSTEM-DATE.                                          01120064
011300         10  SD-SYSTEM-DATE-YY       PIC 9(02) VALUE ZERO.        01130064
011400         10  SD-SYSTEM-DATE-MM       PIC 9(02) VALUE ZERO.        01140064
011500         10  SD-SYSTEM-DATE-DD       PIC 9(02) VALUE ZERO.        01150064
011600     05  SD-SYSTEM-TIME.                                          01160064
011700         10  SD-SYSTEM-TIME-HH       PIC 9(02) VALUE ZERO.        01170064
011800         10  SD-SYSTEM-TIME-MM       PIC 9(02) VALUE ZERO.        01180064
011900         10  SD-SYSTEM-TIME-SS       PIC 9(02) VALUE ZERO.        01190064
012000         10  FILLER                  PIC 9(02) VALUE ZERO.        01200064
012100                                                                  01210064
012200*MM-DD-CCYY                                                       01220064
012300 01  PV-DATE-REFORMAT.                                            01230064
012400     05  PV-ERROR-DATE.                                           01240064
012500         10  PV-ERROR-DATE-MM        PIC 9(02) VALUE ZERO.        01250064
012600         10  PV-SLASH1               PIC X(01) VALUE '/'.         01260064
012700         10  PV-ERROR-DATE-DD        PIC 9(02) VALUE ZERO.        01270064
012800         10  PV-SLASH2               PIC X(01) VALUE '/'.         01280064
012900         10  PV-ERROR-DATE-CCYY      PIC 9(04) VALUE ZERO.        01290064
013000                                                                  01300064
013100 01  ABEND-CODE                       PIC S9(4)  VALUE +0         01310064
013200                                                 COMP SYNC.       01320064
013300                                                                  01330064
013400******************************************************************01340064
013500* RECORD LAYOUT FOR THE INPUT FILE.                               01350064
013600******************************************************************01360064
013700     COPY RCRD074.                                                01370064
013800                                                                  01380064
013900******************************************************************01390064
014000*  DB2 FORMATTED MESSAGE AREA                                     01400064
014100******************************************************************01410064
014200     COPY DPWS004.                                                01420064
014300                                                                  01430064
014400******************************************************************01440064
014500*  WORK FIELDS FOR PRINTING A 132 CHARACTER REPORT.               01450064
014600******************************************************************01460064
014700     COPY DPWS132O.                                               01470064
014800                                                                  01480064
014900******************************************************************01490064
015000*  COPY BOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE            * 01500064
015100******************************************************************01510064
015200                                                                  01520064
015300     COPY XLWS001.                                                01530064
015400                                                                  01540064
015500******************************************************************01550064
015600*  COMMUNICATIONS AREA FOR DB2                                    01560064
015700******************************************************************01570064
015800     EXEC SQL                                                     01580064
015900          INCLUDE SQLCA                                           01590064
016000     END-EXEC.                                                    01600064
016100                                                                  01610064
016200*  DCLGEN FOR THE PURCHASE ORDER TABLE                            01620064
016300*  TPURCHS                                                        01630064
016400     EXEC SQL                                                     01640064
016500          INCLUDE TPURCHS                                         01650064
016600     END-EXEC.                                                    01660064
016700*                                                                 01670064
016800*  DCLGEN FOR THE ENTITY NAME TABLE                               01680064
016801*  TENTNME                                                        01680164
016802     EXEC SQL                                                     01680264
016803          INCLUDE TENTNME                                         01680364
016804     END-EXEC.                                                    01680464
016805*                                                                 01680564
016806*  DCLGEN FOR THE LOGISTICS-SKU TABLE                             01680664
016807*  XLT_SKU                                                        01680764
016808     EXEC SQL                                                     01680864
016809          INCLUDE XLT00003                                        01680964
016810     END-EXEC.                                                    01681064
016820*                                                                 01682064
016830******************************************************************01683064
016840*                                                                 01684064
016850 01  HEADING-LINES.                                               01685064
016860     05  HEADING-LINE-1.                                          01686064
016870         10  FILLER                  PIC  X(44)    VALUE SPACES.  01687064
016880         10  FILLER                  PIC  X(45)    VALUE          01688064
016890             'ECOMMERCE CUSTOMER DIRECT SHIP RECEIPT ERRORS'.     01689064
016900         10  FILLER                  PIC  X(43)    VALUE SPACES.  01690064
017000                                                                  01700064
017100     05  HEADING-LINE-2.                                          01710064
017200         10  FILLER                  PIC  X(03)    VALUE SPACES.  01720064
017300         10  FILLER                  PIC  X(10)    VALUE          01730064
017400             'ERROR DATE'.                                        01740064
017500         10  FILLER                  PIC  X(05)    VALUE SPACES.  01750064
017600         10  FILLER                  PIC  X(09)    VALUE          01760064
017700             'PO NUMBER'.                                         01770064
017800         10  FILLER                  PIC  X(03)    VALUE SPACES.  01780064
017900         10  FILLER                  PIC  X(11)    VALUE          01790064
018000             'VENDOR NAME'.                                       01800064
018100         10  FILLER                  PIC  X(21)    VALUE SPACES.  01810064
018200         10  FILLER                  PIC  X(04)    VALUE          01820064
018300             'DEPT'.                                              01830064
018400         10  FILLER                  PIC  X(02)    VALUE SPACES.  01840065
018500         10  FILLER                  PIC  X(04)    VALUE          01850065
018600             'LINE'.                                              01860065
018610         10  FILLER                  PIC  X(06)    VALUE SPACES.  01861065
018620         10  FILLER                  PIC  X(03)    VALUE          01862065
018630             'SKU'.                                               01863065
018700         10  FILLER                  PIC  X(06)    VALUE SPACES.  01870064
018800         10  FILLER                  PIC  X(03)    VALUE          01880064
018900             'QTY'.                                               01890064
019000         10  FILLER                  PIC  X(05)    VALUE SPACES.  01900064
019100         10  FILLER                  PIC  X(06)    VALUE          01910064
019200             'RETAIL'.                                            01920064
019300         10  FILLER                  PIC  X(13)    VALUE SPACES.  01930064
019400         10  FILLER                  PIC  X(10)    VALUE          01940064
019500             'ERROR TYPE'.                                        01950064
019600         10  FILLER                  PIC  X(11)    VALUE SPACES.  01960065
019700                                                                  01970064
019800     05  HEADING-LINE-3.                                          01980064
019900         10  FILLER                  PIC  X(03)    VALUE SPACES.  01990064
020000         10  FILLER                  PIC  X(10)    VALUE          02000064
020100             '----------'.                                        02010064
020200         10  FILLER                  PIC  X(05)    VALUE SPACES.  02020064
020300         10  FILLER                  PIC  X(09)    VALUE          02030064
020400             '---------'.                                         02040064
020500         10  FILLER                  PIC  X(03)    VALUE SPACES.  02050064
020600         10  FILLER                  PIC  X(11)    VALUE          02060064
020700             '-----------'.                                       02070064
020800         10  FILLER                  PIC  X(21)    VALUE SPACES.  02080064
020801         10  FILLER                  PIC  X(04)    VALUE          02080164
020802             '----'.                                              02080265
020803         10  FILLER                  PIC  X(02)    VALUE SPACES.  02080364
020804         10  FILLER                  PIC  X(04)    VALUE          02080465
020805             '----'.                                              02080565
020806         10  FILLER                  PIC  X(03)    VALUE SPACES.  02080665
020807         10  FILLER                  PIC  X(09)    VALUE          02080765
020808             '---------'.                                         02080865
020809         10  FILLER                  PIC  X(03)    VALUE SPACES.  02080965
020810         10  FILLER                  PIC  X(04)    VALUE          02081065
020811             '----'.                                              02081165
020812         10  FILLER                  PIC  X(02)    VALUE SPACES.  02081265
020813         10  FILLER                  PIC  X(14)    VALUE          02081365
020820             '--------------'.                                    02082064
020830         10  FILLER                  PIC  X(04)    VALUE SPACES.  02083064
020840         10  FILLER                  PIC  X(25)    VALUE          02084064
020850             '-------------------------'.                         02085064
020860         10  FILLER                  PIC  X(03)    VALUE SPACES.  02086064
020870                                                                  02087064
020880 01  DETAIL-LINES.                                                02088064
020890     05  DETAIL-LINE1.                                            02089064
020900         10  FILLER                 PIC  X(03)     VALUE SPACES.  02090064
021000         10  DL1-ERROR-DATE         PIC  X(10)     VALUE SPACES.  02100064
021100         10  FILLER                 PIC  X(06)     VALUE SPACES.  02110064
021200         10  DL1-PO-NBR             PIC  Z(08)     VALUE SPACES.  02120064
021300         10  FILLER                 PIC  X(03)     VALUE SPACES.  02130064
021400         10  DL1-VENDOR-NAME        PIC  X(30)     VALUE SPACES.  02140064
021500         10  FILLER                 PIC  X(02)     VALUE SPACES.  02150064
021600         10  DL1-DEPT-NBR           PIC  X(03)     VALUE SPACES.  02160064
021700         10  FILLER                 PIC  X(02)     VALUE SPACES.  02170065
021800         10  DL1-LNE-NBR            PIC  ZZZ9      VALUE ZEROES.  02180065
021810         10  FILLER                 PIC  X(03)     VALUE SPACES.  02181065
021820         10  DL1-SKU-NBR            PIC  X(09)     VALUE SPACES.  02182065
021900         10  FILLER                 PIC  X(03)     VALUE SPACES.  02190064
022000         10  DL1-QTY-RCVD           PIC  Z(04)     VALUE ZEROES.  02200064
022100         10  FILLER                 PIC  X(02)     VALUE SPACES.  02210064
022200         10  DL1-RETAIL             PIC ZZZ,ZZZ,ZZ9.99            02220064
022300                                                   VALUE ZEROES.  02230064
022400         10  FILLER                 PIC  X(05)     VALUE SPACES.  02240067
022500         10  DL1-ERROR-TYPE         PIC  X(25)     VALUE SPACES.  02250064
022600                                                                  02260064
022700 01  TOTAL-LINE.                                                  02270064
022800     05  TL-TOT-LINE.                                             02280064
022900         10  FILLER                  PIC  X(09)    VALUE SPACES.  02290064
023000         10  FILLER                  PIC  X(13)    VALUE          02300064
023100             'TOTAL RETAIL:'.                                     02310064
023200         10  FILLER                  PIC  X(03)    VALUE SPACES.  02320064
023300         10  TL1-TOTAL-RETAIL        PIC ZZZ,ZZZ,ZZ9.99           02330064
023400                                                   VALUE ZEROES.  02340064
023500         10  FILLER                  PIC  X(93)    VALUE SPACES.  02350064
023600                                                                  02360064
023700 01  MISCELLANEOUS-LINES.                                         02370064
023800     05  BLANK-LINE.                                              02380064
023900         10  FILLER                  PIC  X(132)   VALUE SPACES.  02390064
024000     05  NO-DATA-LINE.                                            02400064
024100         10  FILLER                  PIC  X(42)    VALUE SPACES.  02410064
024200         10  FILLER                  PIC  X(47)    VALUE          02420064
024300             '**** NO INFORMATION EXISTS FOR THIS REPORT ****'.   02430064
024400         10  FILLER                  PIC  X(43)    VALUE SPACES.  02440064
024500     05  END-OF-REPORT-LINE.                                      02450064
024600         10  FILLER                  PIC  X(54)    VALUE SPACES.  02460064
024700         10  FILLER                  PIC  X(44)    VALUE          02470064
024800             '  ** END OF REPORT **                       '.      02480064
024900         10  FILLER                  PIC  X(34)    VALUE SPACES.  02490064
025000                                                                  02500064
025100                                                                  02510064
025200***************************************************************** 02520064
025300 PROCEDURE DIVISION.                                              02530064
025400                                                                  02540064
025500 0000-MAINLINE-PROCESSING.                                        02550064
025600******************************************************************02560064
025700**  THIS IS THE MAIN DRIVER FOR THE PROGRAM.                      02570064
025800******************************************************************02580064
025900     DISPLAY '****** STARTING RCKRP042 ******'.                   02590064
026000                                                                  02600064
026100*OPEN FILES.                                                      02610064
026200     OPEN INPUT INPUT-FILE                                        02620064
026300          OUTPUT REPORT-FILE.                                     02630064
026400                                                                  02640064
026500*PREPARE REPORT.                                                  02650064
026600     PERFORM 1000-INITIALIZATION.                                 02660064
026700                                                                  02670064
026800*READ FIRST RECORD.                                               02680064
026900     PERFORM 1100-READ-EXTRACT-FILE                               02690064
027000                                                                  02700064
027100*PROCESS INPUT FILE.                                              02710064
027200     IF PS-END-OF-INPUT                                           02720064
027300        ADD +1                  TO PV-PAGE-COUNT                  02730064
027400        MOVE PV-PAGE-COUNT      TO DP132O-PAGE-NUMBER             02740064
027500        WRITE REPORT-RECORD                                       02750064
027600          FROM DP132O-STANDRD-HEADER-132-COLS                     02760064
027700            AFTER ADVANCING PAGE                                  02770064
027800        WRITE REPORT-RECORD                                       02780064
027900          FROM HEADING-LINE-1                                     02790064
028000            AFTER ADVANCING 2 LINES                               02800064
028100                                                                  02810064
028200        WRITE REPORT-RECORD                                       02820064
028300          FROM BLANK-LINE                                         02830064
028400            AFTER ADVANCING 1 LINE                                02840064
028500                                                                  02850064
028600        WRITE REPORT-RECORD                                       02860064
028700          FROM NO-DATA-LINE                                       02870064
028800            AFTER ADVANCING 2 LINES                               02880064
028900     ELSE                                                         02890064
029000         PERFORM 1200-PRINT-HEADINGS                              02900064
029100         PERFORM 2000-PROCESS-INPUT UNTIL PS-END-OF-INPUT         02910064
029200     END-IF.                                                      02920064
029300                                                                  02930064
029400     PERFORM 2500-PRINT-TOTAL-LINE                                02940064
029500     PERFORM 2600-PRINT-BLANK-LINE                                02950064
029600                                                                  02960064
029700*FINISH REPORT.                                                   02970064
029800     WRITE REPORT-RECORD                                          02980064
029900       FROM END-OF-REPORT-LINE                                    02990064
030000         AFTER ADVANCING 2 LINES.                                 03000064
030100                                                                  03010064
030200*CLOSE FILES.                                                     03020064
030300     CLOSE INPUT-FILE                                             03030064
030400           REPORT-FILE.                                           03040064
030500                                                                  03050064
030600     MOVE PV-READ-COUNT TO PV-DISPLAY-READ-COUNT.                 03060064
030700     DISPLAY 'TOTAL RECS READ ' PV-DISPLAY-READ-COUNT.            03070064
030800                                                                  03080064
030900     MOVE PV-WRITE-COUNT TO PV-DISPLAY-WRITE-COUNT.               03090064
031000     DISPLAY 'TOTAL RECS WRITTEN ' PV-DISPLAY-WRITE-COUNT.        03100064
031100                                                                  03110064
031200     GOBACK.                                                      03120064
031300                                                                  03130064
031400******************************************************************03140064
031500 1000-INITIALIZATION.                                             03150064
031600******************************************************************03160064
031700**  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               03170064
031800******************************************************************03180064
031900     ACCEPT SD-SYSTEM-DATE                                        03190064
032000       FROM DATE.                                                 03200064
032100                                                                  03210064
032200     ACCEPT SD-SYSTEM-TIME                                        03220064
032300       FROM TIME.                                                 03230064
032400                                                                  03240064
032500     MOVE SD-SYSTEM-DATE-MM  TO DP132O-RUN-MONTH.                 03250064
032600     MOVE SD-SYSTEM-DATE-DD  TO DP132O-RUN-DAY.                   03260064
032700     MOVE SD-SYSTEM-DATE-YY  TO DP132O-RUN-YEAR.                  03270064
032800     MOVE SD-SYSTEM-TIME-HH  TO DP132O-RUN-HOUR.                  03280064
032900     MOVE SD-SYSTEM-TIME-MM  TO DP132O-RUN-MINUTE.                03290064
033000                                                                  03300064
033100     MOVE PC-REPORT-NBR TO DP132O-REPORT-NUMBER.                  03310064
033200                                                                  03320064
033300     MOVE PC-CURRENT-PROGRAM-NAME TO DP132O-PROGRAM-NAME.         03330064
033400                                                                  03340064
033500     MOVE +0                      TO PV-PAGE-COUNT.               03350064
033600                                                                  03360064
033700******************************************************************03370064
033800*  READ A RECORD FROM THE ERROR REPORT FILE.                     *03380064
033900******************************************************************03390064
034000 1100-READ-EXTRACT-FILE.                                          03400064
034100     READ INPUT-FILE INTO RC074-ITEM-REC                          03410064
034200         AT END                                                   03420064
034300             SET PS-END-OF-INPUT TO TRUE                          03430064
034400         NOT AT END                                               03440064
034500             ADD +1 TO PV-READ-COUNT                              03450064
034600     END-READ.                                                    03460064
034700                                                                  03470064
034800******************************************************************03480064
034900**  WRITES REPORT HEADER LINES FOR FIRST PAGE.                    03490064
035000******************************************************************03500064
035100 1200-PRINT-HEADINGS.                                             03510064
035200     ADD +1                  TO PV-PAGE-COUNT.                    03520064
035300     MOVE PV-PAGE-COUNT      TO DP132O-PAGE-NUMBER.               03530064
035400                                                                  03540064
035500     WRITE REPORT-RECORD                                          03550064
035600       FROM DP132O-STANDRD-HEADER-132-COLS                        03560064
035700         AFTER ADVANCING PAGE.                                    03570064
035800                                                                  03580064
035900     WRITE REPORT-RECORD                                          03590064
036000       FROM HEADING-LINE-1                                        03600064
036100         AFTER ADVANCING 2 LINES.                                 03610064
036200                                                                  03620064
036300     WRITE REPORT-RECORD                                          03630064
036400       FROM BLANK-LINE                                            03640064
036500         AFTER ADVANCING 1 LINE.                                  03650064
036600                                                                  03660064
036700     WRITE REPORT-RECORD                                          03670064
036800       FROM HEADING-LINE-2                                        03680064
036900         AFTER ADVANCING 1 LINE.                                  03690064
037000                                                                  03700064
037100     WRITE REPORT-RECORD                                          03710064
037200       FROM HEADING-LINE-3                                        03720064
037300         AFTER ADVANCING 1 LINE.                                  03730064
037400                                                                  03740064
037500     WRITE REPORT-RECORD                                          03750064
037600       FROM BLANK-LINE                                            03760064
037700         AFTER ADVANCING 1 LINE.                                  03770064
037800                                                                  03780064
037900     MOVE +10                TO PV-LINE-COUNT.                    03790064
038000                                                                  03800064
038100******************************************************************03810064
038200**  WRITES REPORT HEADER LINES FOR SUBSEQUENT PAGES AS NEEDED.    03820064
038300******************************************************************03830064
038400 1500-PAGE-BREAK.                                                 03840064
038500     ADD +1                  TO PV-PAGE-COUNT.                    03850064
038600     MOVE PV-PAGE-COUNT      TO DP132O-PAGE-NUMBER.               03860064
038700                                                                  03870064
038800     WRITE REPORT-RECORD                                          03880064
038900       FROM DP132O-STANDRD-HEADER-132-COLS                        03890064
039000         AFTER ADVANCING PAGE.                                    03900064
039100                                                                  03910064
039200     WRITE REPORT-RECORD                                          03920064
039300       FROM HEADING-LINE-1                                        03930064
039400         AFTER ADVANCING 2 LINES.                                 03940064
039500                                                                  03950064
039600     WRITE REPORT-RECORD                                          03960064
039700       FROM HEADING-LINE-2                                        03970064
039800         AFTER ADVANCING 1 LINE.                                  03980064
039900                                                                  03990064
040000     WRITE REPORT-RECORD                                          04000064
040100       FROM HEADING-LINE-3                                        04010064
040200         AFTER ADVANCING 1 LINE.                                  04020064
040300                                                                  04030064
040400     WRITE REPORT-RECORD                                          04040064
040500       FROM BLANK-LINE                                            04050064
040600         AFTER ADVANCING 1 LINE.                                  04060064
040700                                                                  04070064
040800     MOVE +10                TO PV-LINE-COUNT.                    04080064
040900                                                                  04090064
041000******************************************************************04100064
041100** PROCESS INPUT FILE.                                            04110064
041200******************************************************************04120064
041300 2000-PROCESS-INPUT.                                              04130064
041400                                                                  04140064
041500      MOVE RC074-PO-NUMBER TO DK-PO-NBR.                          04150064
041600      PERFORM 2050-SELECT-VENDOR-DEPT.                            04160064
041700                                                                  04170064
041800      MOVE RC074-SKU       TO DK-SKU-NBR.                         04180064
041900      PERFORM 2100-SELECT-XLT-SKU.                                04190064
042000                                                                  04200064
042100      IF PS-SKU-FOUND-YES                                         04210064
042200         PERFORM 2200-GET-RETAIL-DATA                             04220064
042300      ELSE                                                        04230064
042400         MOVE ZEROES       TO PV-UNT-RTL-AMT                      04240064
042500      END-IF.                                                     04250064
042600                                                                  04260064
042700      PERFORM 2300-ACCUM-FIELDS.                                  04270064
042800                                                                  04280064
042900      PERFORM 2400-PRINT-DETAIL-LINE.                             04290064
043000      IF PS-END-OF-INPUT                                          04300064
043100         CONTINUE                                                 04310064
043200      ELSE                                                        04320064
043300         PERFORM 1100-READ-EXTRACT-FILE                           04330064
043400      END-IF.                                                     04340064
043500                                                                  04350064
043600******************************************************************04360064
043700 2050-SELECT-VENDOR-DEPT.                                         04370064
043800*     GET THE VENDOR NAME AND DEPARTMENT NUMBER ASSOCIATED WITH   04380064
043900*     THE PO.                                                     04390064
044000******************************************************************04400064
044100                                                                  04410064
044200     EXEC SQL                                                     04420064
044300         SELECT A.DEPT_NBR                                        04430064
044400              , B.ENT_NAME_DESC                                   04440064
044500           INTO :PURCHS-DEPT-NBR                                  04450064
044600              , :ENTNME-ENT-NAME-DESC                             04460064
044700           FROM TPURCHS A                                         04470064
044800              , TENTNME B                                         04480064
044900          WHERE A.PO_NBR           =  :DK-PO-NBR                  04490064
045000            AND A.VER_STATUS_CDE   =  'A'                         04500064
045100            AND B.ENT_ID           =  A.ENT_ID                    04510064
045200            AND B.SEQ_NBR          =  1                           04520064
045300     END-EXEC.                                                    04530064
045400                                                                  04540064
045500     EVALUATE TRUE                                                04550064
045600         WHEN SQLCODE = +0                                        04560064
045700              CONTINUE                                            04570064
045800         WHEN SQLCODE = +100                                      04580064
045900              MOVE 'XXX'             TO PURCHS-DEPT-NBR           04590064
045910              MOVE '** NOT FOUND **' TO ENTNME-ENT-NAME-DESC      04591064
045920         WHEN SQLWARN0 NOT = SPACE                                04592064
045930         WHEN SQLCODE  NOT = +0                                   04593064
045940              MOVE '2050-SELECT-VENDOR-DEPT'                      04594064
045950                                   TO PV-ABEND-PARAGRAPH          04595064
045960              MOVE 'TPURCHS'       TO PV-DB2-TABLE-NAME           04596064
045970              MOVE 'TENTNME'       TO PV-DB2-TABLE-NAME1          04597064
045980              MOVE 'ATTEMPTING TO SELECT VENDOR AND DEPARTMENT'   04598064
045990                                   TO PV-ABEND-OPERATION1         04599064
046000              MOVE RC074-PO-NUMBER TO PV-DISPLAY-PO-NBR-N         04600064
046100              STRING 'PO NUMBER: '       DELIMITED BY SIZE        04610064
046200                     PV-DISPLAY-PO-NBR-X DELIMITED BY SIZE        04620064
046300                                 INTO PV-ABEND-OPERATION2         04630064
046400              PERFORM Z999-SQL-ERROR                              04640064
046500     END-EVALUATE.                                                04650064
046600                                                                  04660064
046700******************************************************************04670064
046800 2100-SELECT-XLT-SKU.                                             04680064
046810*     GET THE INTR_UPC_ID USED IN XLKUT001 CALL                   04681064
046820******************************************************************04682064
046830                                                                  04683064
046840     EXEC SQL                                                     04684064
046850         SELECT INTR_UPC_ID                                       04685064
046860           INTO   :XLT00003-INTR-UPC-ID                           04686064
046870           FROM   XLT_SKU                                         04687064
046880          WHERE   SKU_NBR          =  :DK-SKU-NBR                 04688064
046890     END-EXEC.                                                    04689064
046891                                                                  04689164
046892     EVALUATE TRUE                                                04689264
046893         WHEN SQLCODE = +0                                        04689364
046894              SET PS-SKU-FOUND-YES TO TRUE                        04689464
046895         WHEN SQLCODE = +100                                      04689564
046896              SET PS-SKU-FOUND-NO  TO TRUE                        04689664
046897         WHEN SQLWARN0 NOT = SPACE                                04689764
046898         WHEN SQLCODE  NOT = +0                                   04689864
046899              MOVE '2100-SELECT-XLT-SKU'                          04689964
046900                                   TO PV-ABEND-PARAGRAPH          04690064
046901              MOVE 'XLT_SKU'       TO PV-DB2-TABLE-NAME           04690164
046902              MOVE 'ATTEMPTING TO SELECT XLT_SKU '                04690264
046903                                   TO PV-ABEND-OPERATION1         04690364
046904              PERFORM Z999-SQL-ERROR                              04690464
046905     END-EVALUATE.                                                04690564
046906                                                                  04690664
046907******************************************************************04690764
046908 2200-GET-RETAIL-DATA.                                            04690864
046909******************************************************************04690964
046910                                                                  04691064
046920     INITIALIZE XL001-ITEM-COMMAREA.                              04692064
046930                                                                  04693064
046940     SET XL001-BY-INTR-UPC-ID                                     04694064
046950         XL001-SELECT-SKU-STR        TO TRUE.                     04695064
046960                                                                  04696064
046970      MOVE XLT00003-INTR-UPC-ID      TO XL001-KEY-INTR-UPC-ID.    04697064
046980      CALL 'XLKUT001'   USING XL001-ITEM-COMMAREA.                04698064
046990                                                                  04699064
047000     EVALUATE TRUE                                                04700064
047100       WHEN XL001-SKU-STR-SQLCODE = 0                             04710064
047200           MOVE XL001-UNT-RTL-AMT       TO PV-UNT-RTL-AMT         04720064
047300                                                                  04730064
047400       WHEN XL001-SKU-STR-NOT-FOUND                               04740064
047500           MOVE 0                       TO PV-UNT-RTL-AMT         04750064
047600                                                                  04760064
047700       WHEN XL001-SKU-STR-CONTENTION                              04770064
047800           MOVE '2200-GET-RETAIL-DATA'  TO PV-ABEND-PARAGRAPH     04780064
047900           MOVE 'XLV-SKU-STR '          TO PV-DB2-TABLE-NAME      04790064
048000           MOVE 'SKU STR CONTENTION'    TO PV-ABEND-OPERATION1    04800064
048100           MOVE XL001-SKU-STR-SQLCODE   TO SQLCODE                04810064
048200           PERFORM Z999-SQL-ERROR                                 04820064
048300                                                                  04830064
048400       WHEN OTHER                                                 04840064
048500           MOVE '2200-GET-RETAIL-DATA'  TO PV-ABEND-PARAGRAPH     04850064
048600           MOVE 'XLV-SKU-STR '          TO PV-DB2-TABLE-NAME      04860064
048700           MOVE 'INVALID XLV-SKU-STR ACCESS'                      04870064
048800                                        TO PV-ABEND-OPERATION1    04880064
048900           MOVE XL001-SKU-STR-SQLCODE   TO SQLCODE                04890064
049000           PERFORM Z999-SQL-ERROR                                 04900064
049100     END-EVALUATE.                                                04910064
049200                                                                  04920064
049300************************************************************      04930064
049400 2300-ACCUM-FIELDS.                                               04940064
049500*  THIS PARAGRAPH ADDS THE CURRENT QUANTITIES TO THE TOTAL.       04950064
049600************************************************************      04960064
049700                                                                  04970064
049800     ADD PV-UNT-RTL-AMT TO PV-ACCUM-RETAIL-COUNT.                 04980064
049900                                                                  04990064
050000******************************************************************05000064
050100**  PRINT REPORT DETAIL LINES.                                    05010064
050200******************************************************************05020064
050300 2400-PRINT-DETAIL-LINE.                                          05030064
050400                                                                  05040064
050500* SINCE REPORT IS EXPORTED TO EXCEL, THE DETAIL NEEDS TO APPEAR   05050064
050600* ON ALL LINES SO THAT SORTING WILL WORK CORRECTLY.               05060064
050700                                                                  05070064
050800     MOVE RC074-DATE-ADD-WRAP(6:2)     TO PV-ERROR-DATE-MM.       05080064
050900     MOVE RC074-DATE-ADD-WRAP(9:2)     TO PV-ERROR-DATE-DD.       05090064
051000     MOVE RC074-DATE-ADD-WRAP(1:4)     TO PV-ERROR-DATE-CCYY.     05100064
051100     MOVE PV-ERROR-DATE                TO DL1-ERROR-DATE.         05110064
051200                                                                  05120064
051300     MOVE ENTNME-ENT-NAME-DESC         TO DL1-VENDOR-NAME.        05130064
051400     MOVE PURCHS-DEPT-NBR              TO DL1-DEPT-NBR.           05140064
051410     MOVE RC074-PO-LNE-NBR             TO DL1-LNE-NBR.            05141066
051500     MOVE RC074-PO-NUMBER              TO DL1-PO-NBR.             05150064
051600     MOVE RC074-SKU                    TO DL1-SKU-NBR.            05160064
051700     MOVE RC074-QTY-RCVD               TO DL1-QTY-RCVD.           05170064
051800                                                                  05180064
051900     MOVE PV-UNT-RTL-AMT               TO DL1-RETAIL.             05190064
052000                                                                  05200064
052100     EVALUATE TRUE                                                05210064
052200        WHEN RC074-ERROR-TYPE = '01'                              05220064
052300           MOVE PC-ERROR-01               TO DL1-ERROR-TYPE       05230064
052400        WHEN RC074-ERROR-TYPE = '02'                              05240064
052500           MOVE PC-ERROR-02               TO DL1-ERROR-TYPE       05250064
052600        WHEN RC074-ERROR-TYPE = '04'                              05260064
052700           MOVE PC-ERROR-04               TO DL1-ERROR-TYPE       05270064
052800        WHEN RC074-ERROR-TYPE = '05'                              05280064
052900           MOVE PC-ERROR-05               TO DL1-ERROR-TYPE       05290064
052910        WHEN RC074-ERROR-TYPE = '06'                              05291066
052920           MOVE PC-ERROR-06               TO DL1-ERROR-TYPE       05292066
052930        WHEN RC074-ERROR-TYPE = '07'                              05293066
052940           MOVE PC-ERROR-07               TO DL1-ERROR-TYPE       05294066
053000        WHEN OTHER                                                05300064
053100           MOVE PC-UNKNOWN-ERROR          TO DL1-ERROR-TYPE       05310064
053200     END-EVALUATE.                                                05320064
053300                                                                  05330064
053400     ADD +1 TO PV-LINE-COUNT.                                     05340064
053500     IF PV-LINE-COUNT > PV-MAX-LINE-COUNT                         05350064
053600         PERFORM 1500-PAGE-BREAK                                  05360064
053700     END-IF.                                                      05370064
053800                                                                  05380064
053900     WRITE REPORT-RECORD                                          05390064
054000       FROM DETAIL-LINE1                                          05400064
054100         AFTER ADVANCING 1 LINE.                                  05410064
054200     ADD +1 TO PV-WRITE-COUNT.                                    05420064
054300                                                                  05430064
054400******************************************************************05440064
054500**  PRINT TOTAL RETAIL.                                           05450064
054600******************************************************************05460064
054700 2500-PRINT-TOTAL-LINE.                                           05470064
054800                                                                  05480064
054900     MOVE PV-ACCUM-RETAIL-COUNT       TO TL1-TOTAL-RETAIL.        05490064
055000     INITIALIZE PV-ACCUM-RETAIL-COUNT                             05500064
055100                                                                  05510064
055200     ADD +1 TO PV-LINE-COUNT.                                     05520064
055300     IF PV-LINE-COUNT > PV-MAX-LINE-COUNT                         05530064
055400         PERFORM 1500-PAGE-BREAK                                  05540064
055500     END-IF.                                                      05550064
055600                                                                  05560064
055700     WRITE REPORT-RECORD                                          05570064
055800       FROM BLANK-LINE                                            05580064
055900         AFTER ADVANCING 1 LINE.                                  05590064
056000                                                                  05600064
056100     WRITE REPORT-RECORD                                          05610064
056200       FROM TL-TOT-LINE                                           05620064
056300         AFTER ADVANCING 1 LINE.                                  05630064
056400                                                                  05640064
056500****************************************************************  05650064
056600* PRINTS A BLANK LINE                                          *  05660064
056700****************************************************************  05670064
056800 2600-PRINT-BLANK-LINE.                                           05680064
056900                                                                  05690064
057000        WRITE REPORT-RECORD                                       05700064
057100          FROM BLANK-LINE                                         05710064
057200            AFTER ADVANCING 1 LINE                                05720064
057300                                                                  05730064
057400     ADD +1 TO PV-LINE-COUNT.                                     05740064
057500                                                                  05750064
057600                                                                  05760064
057700******************************************************************05770064
057800 Z999-SQL-ERROR.                                                  05780064
057900******************************************************************05790064
058000*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    05800064
058100*  ERROR OR WARNING CODE OCCURS.                                  05810064
058200******************************************************************05820064
058300     DISPLAY 'Z999-SQL-ERROR'.                                    05830064
058400     MOVE SQLCODE TO PV-SQLCODE.                                  05840064
058500     DISPLAY '*** DB2 ERROR '.                                    05850064
058600     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       05860064
058700     DISPLAY '** ABEND     **'.                                   05870064
058800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05880064
058900     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             05890064
059000     DISPLAY '** TABLE(S)  ** = ' PV-DB2-TABLE-NAME.              05900064
059100     DISPLAY '**           ** = ' PV-DB2-TABLE-NAME1.             05910064
059200     DISPLAY '** OPERATION ** = ' PV-ABEND-OPERATION1.            05920064
059300     DISPLAY '**           ** = ' PV-ABEND-OPERATION2.            05930064
059400                                                                  05940064
059500                                                                  05950064
059600******************************************************************05960064
059700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    05970064
059800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05980064
059900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05990064
060000* FORMAT.                                                         06000064
060100******************************************************************06010064
060200     COPY DPPD004.                                                06020064
060300                                                                  06030064
060400     MOVE +4013                  TO ABEND-CODE.                   06040064
060500     CALL 'ILBOABN0' USING ABEND-CODE.                            06050064
060600                                                                  06060064
