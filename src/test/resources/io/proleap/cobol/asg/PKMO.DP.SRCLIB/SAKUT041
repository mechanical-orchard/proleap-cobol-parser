000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SAKUT041.                                00050000
000600 AUTHOR.                 TOM HANSON.                              00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            05-31-2006.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS IS A PRE EDIT CHECK VERSION OF SAKUT006.                 *00120000
001300*    ALL DB2 AND CTLCD UPDATES HAVE BEEN REMOVED.                *00130000
001400*    PROCESSING IS LIMITED TO THE INPUT CTLCD PARAMETERS:        *00140000
001500*     - WEEK ENDING DATE SPECIFIED IN THE CONTROL CARD IN THE    *00150000
001600*       DB2 FORMAT - YYYY-MM-DD.                                 *00160000
001700*                                                                *00170000
001800*  THIS PROGRAM WILL CREATE AN EMAIL TO DISPLAY THE AMOUNT OF    *00180000
001900*  DEBITS AND CREDITS FOR STORES WITH OUT OF BALANCES, IT WILL   *00190000
002000*  SHOW BY STORE BY DATE.                                        *00200000
002100*                                                                *00210000
002200*  IT WILL ALSO PRODUCE AN OUTPUT FILE THAT CONTAINS A LIST OF   *00220000
002300*  ALL STORES BY DATE FOR THE WEEK BEING PROCESSED AND WILL HAVE *00230000
002400*  OUT OF BALANCE AMOUNTS. THE FOLLOWING FORMAT APPLIES.         *00240000
002500*                                   TIMESTAMP WHEN PROCESSED     *00250000
002600*     - Weekending Date: CCYY-MM-DD|CCYY-MM-DD-hh-mm.ss.nnnnnn   *00260000
002700*     - CCYY-MM-DD|9999|          0.00                           *00270000
002800*     - CCYY-MM-DD|9999|          0.00                           *00280000
002900*     - CCYY-MM-DD|9999|          0.00                           *00290000
003000*     - CCYY-MM-DD|9999|          0.00                           *00300000
003100*     - CCYY-MM-DD|9999|          0.00                           *00310000
003200*     - CCYY-MM-DD|9999|          0.00                           *00320000
003300*     - CCYY-MM-DD|9999|          0.00                           *00330000
003400*                                                                *00340000
003500*  THIS OUTPUT FILE WILL BE FTP'D TO A UNIX SERVER FOR USE IN    *00350000
003600*  THE SALES AUDIT GL SCREENS.                                   *00360000
003700*                                                                *00370000
003800******************************************************************00380000
003900******************************************************************00390000
004000*  CHANGED 03/05/2008   BY THOMAS HANSON   WR #33714              00400000
004100*                                                                 00410000
004200*  ADDED 'TPC' AND 'TCC' TO GL FILE WRITES AS PART OF BLACKHAWK.  00420000
004300*  THIRD PARTY GIFT CARD SALES.  TPC = THIRD PARTY CARDS SOLD     00430000
004400*                                TCC = THIRD PARTY COMMISSIONS    00440000
004500******************************************************************00450000
004600*  CHANGED 05/19/2008   BY DAN PAYNTER     INC000000367880        00460000
004700*                                                                 00470000
004800*  ALLOW FOR POSSIBILITY OF NO THIRD PARTY CARD TOTALS ON TSASUM. 00480000
004900******************************************************************00490000
005000*  CHANGED 08/24/2010   BY CHERI PARMLEY   WR38834                00500000
005100*                                                                 00510000
005200*  ADD 'BRC' TO GL FILE FOR BREAST CANCER AWARENESS SALES         00520000
005300******************************************************************00530000
005400*  CHANGED 03/17/2011   BY JACKIE HELING   WR39649                00540000
005500*  REMOVE LOCATION 873 HARDCODING                                 00550000
005600******************************************************************00560000
005700*  CHANGED 07/30/2013   BY DAVID WELLER    CHG 53632              00570000
005800*  INCLUDE NEW CATEGORY 'SFS' FOR SHIP FROM STORE SALES           00580000
005900******************************************************************00590000
006000*  CHANGED 02/20/2014   BY BARB SCHULTZ    CHG 8446E              00600000
006100*  INCLUDE NEW CATEGORY 'BPS' FOR BOPUS                           00610000
006200******************************************************************00620000
006300*  CHANGED 09/29/2014   BY COGNIZANT       CHG0092405             00630000
006400*  INCLUDE NEW CODES 'WFC' AND 'WRC' TO WRITE THAT IN GL FILE     00640000
006500*                                (Market Places)                  00650000
006600******************************************************************00660000
006700*  CHANGED 02/20/2015   BY BARB SCHULTZ    CHG0105300             00670000
006800*  CHANGED THE DUE TO WAYFAIR LOGIC BY REARRANGING THE IF         00680000
006900*  STATEMENT.                                                     00690000
007000******************************************************************00700000
007100*  CHANGE CHG0160001 - FIND 'STCFEE'                              00710000
007200*  CHANGED 10/20/2016   BY JIM HUNTER                             00720000
007300*  ADD 'FEE' CATEGORY FOR SALES TAX COMPLIANCE                    00730000
007400*  INCLUDE 'AFE' FEE ADJUSTMENTS CATEGORY IN FEE CALCULATION.     00740000
007500******************************************************************00750000
BOSS  *  CHANGED 02/20/2018   BY BARB SCHULTZ    CHG0188487             00751000
BOSS  *  INCLUDE NEW CATEGORY 'BOS' FOR BOSS PROJECT                    00752000
BOSS  *  ADDED 'BSR' AND 'BPR' FOR BOSS AND BOPUS RETURNS.              00752100
007500******************************************************************00752200
12386a*  CHANGED 12/03/2018   BY COGNIZANT                              00752300
12386a*  INCLUDE NEW CATEGORY 'DON' FOR CHARITABLE DONATIONS AND        00752400
12386a*  OFFSETTING CREDIT TO STM                                       00752500
255393******************************************************************00752600
255393*  CHANGED 03/26/2021   BY Jim Hunter      CHG0255393             00752700
255393*  Add new Sephora categories (TSAADSU TABLE / SAWS006 COPYBOOK)  00752800
255393*  'SCN' - SEPHORA CHARGE NET        (SA006-SEPHORA-CHARGE)       00752900
255393*  'SGS' - SEPHORA GIFT CARD SALES   (SA006-SEPHORA-GC-SALES)     00753000
255393*  'SGT' - SEPHORA GIFT CARD TENDERS (SA006-SEPHORA-GC-TENDERED)  00753100
255393******************************************************************00753200
MKTPLC*  CHANGED 02/08/2022   BY Jim Hunter   CHG0267963                00753300
MKTPLC*  Add new MARKETPLACE categories (TSASUM / SAWS006 COPYBOOK)     00753400
MKTPLC*  for the long-term Sales Hub solution.  The short term SAK131   00753500
MKTPLC*  solution will not requires changes to this program.            00753600
MKTPLC*  'MSS' - Marketplace Seller Sale                                00753700
MKTPLC*  'MSR' - Marketplace Seller Return                              00753800
MKTPLC*  'MCS' - Marketplace Commissions Sale                           00753900
MKTPLC*  'MCR' - Marketplace Commissions Return                         00754000
MKTPLC*  'MMS' - Marketplace Mirakl Sale                                00754100
MKTPLC*  'MMR' - Marketplace Mirakl Return                              00754200
MKTPLC*                                                                 00754300
MKTPLC*  Also, remove the Sephora Gift Card categories.  They will not  00754400
MKTPLC*  be on TSAADSU (except for being included in the Kohl's Gift    00754500
MKTPLC*  Card categories) and Rob does not want them broken out here.   00754600
MKTPLC******************************************************************00754700
MKTPL2*  CHANGED 07/13/2022   BY Jim Hunter   CHG0272489                00754800
MKTPL2*  Remove Marketplace categories MMS and MMR as well as the old   00754900
MKTPL2*  Wayfair categories DWF, WFC and WRC which are all obsolete.    00755000
MKTPL2*  Also, KEEP the subtraction of the marketplace categories       00755100
MKTPL2*  from the sales and returns categories as the Sales Hub         00755200
MKTPL2*  will STILL be including them in those categories.              00755300
007700******************************************************************00755400
ZX    *  CHANGED 07/17/2022   BY DAN PAYNTER  CHG0272489                00755500
ZX    *  FIX ISSUE IGNORING LATES FOR THE TCC (THIRD PARTY GIFT CARD    00755600
ZX    *  COMMISSIONS)                                                   00755700
ZX    ******************************************************************00755800
TPCFIX*  CHANGED 11/30/2022   BY JIM HUNTER    CHG0278871               00755900
TPCFIX*  POC AND THE SALES HUB ADD SEPHORA GIFT CARD DOLLARS INTO THE   00756000
TPCFIX*  TSAADSU AND TSASUM TPC BUCKETS AND THEY NEED TO BE SUBTRACTED  00756100
TPCFIX*  OUT BEFORE THE THIRD PARTY CARD NUMBERS GO TO GL.              00756200
TPCFIX*  THE ORIGINAL SEPHORA CHANGES PUT INTO SAKUT006 WERE NOT        00756300
TPCFIX*  PUT IN SAKUT041 BECAUSE THE SALES AUDIT TEAM DID NOT USE THEM  00756400
TPCFIX*  TO BALANCE.  THEY ARE BEING ADDED NOW TO SUPPORT THE TPCFIX    00756500
TPCFIX*  CHANGES, ALONG WITH THE STRFNT CHANGES BLOCKING STORE 6666.    00756600
TPCFIX******************************************************************00756700
COBRND*  CHANGED 02/23/2023   BY JIM HUNTER    CHG0286246               00756800
COBRND*  THESE CHANGES ARE FOR THE NEW COBRAND VISA CHARGE CARDS.       00756900
COBRND*  2 NEW CATEGORIES WILL BE NEEDED FOR GL:                        00757000
COBRND*  COBRAND VISA NET (CVN)                                         00757100
COBRND*  COBRAND VISA Payments (CVP)                                    00757200
COBRND*  THEY WILL COME FROM THE TSASUM TABLE.                          00757300
COBRND*  IN THE TSAADSU CASH OFFICE TABLE THEY WILL BE INCLUDED IN THE  00757400
COBRND*  BCN (BANK CARD NET) AND KCP (KOHL'S CHARGE PAYMENTS)           00757500
COBRND*  CATEGORIES.                                                    00757600
COBRND*  CVN WILL BE SUBTRACTED FROM BCN BEFORE THEY ARE SENT TO GL.    00757700
COBRND*  CVP WILL BE SUBTRACTED FROM KCP BEFORE THEY ARE SENT TO GL.    00757800
COBRND*  Remove EPT_DR_CRD_TNDR and TEPCRD DCLGEN's which were not used.00757900
COBRND******************************************************************00758000
PAYVEN*  CHANGED 08/23/2023   BY JIM HUNTER    CHG0289055               00759000
PAYVEN*  THESE CHANGES ARE FOR THE NEW PAYPAL AND VENMO CARDS.          00760000
PAYVEN*  2 NEW CATEGORIES WILL BE NEEDED FOR GL:                        00760100
PAYVEN*  PAYPAL NET (PPN)                                               00760200
PAYVEN*  VENMO NET (vmn)                                                00760300
PAYVEN******************************************************************00760400
COBTRL*  CHANGED 10/23/2023   BY JIM HUNTER    CHG0295722               00760500
COBTRL*  ADDING LOGIC TO ADJUST CATEGORIES FOR COBRAND TRAILING         00760600
COBTRL*  TRANSACTIONS.  THESE TRANSACTIONS ARE THOSE MADE AGAINST       00760700
COBTRL*  KOHL'S CHARGE ACCOUNTS FOR CUSTOMERS WHO NOW HAVE COBRAND      00760800
COBTRL*  ACCOUNTS INSTEAD.                                              00760900
COBTRL*  THEY WILL COME FROM THE TSASUM TABLE, REGISTER ZERO, CATEGORIES00761000
COBTRL*  TTN (COBRAND TRAILING NET) AND TTP (COBRAND TRAILING PAYMENTS).00761100
COBTRL*  TTN WILL BE SUBTRACTED FROM KCN BEFORE KCN IS SENT TO GL.      00761200
COBTRL*  TTN WILL BE ADDED TO CVN BEFORE CVN IS SENT TO GL.             00761300
COBTRL*  TTP WILL BE SUBTRACTED FROM KCP BEFORE KCP IS SENT TO GL.      00761400
COBTRL*  TTP WILL BE ADDED TO CVP BEFORE CVP IS SENT TO GL.             00761500
COBTR2*  ADDED LOGIC TO DETERMINE IF THERE ARE COBRAND TRAILING         00761600
COBTR2*  TRANSACTIONS (TTN OR TTP) THAT WEREN'T PICKED UP IN THE TSASUM 00761700
COBTR2** PARAGRAPH BECAUSE THE STORE HAD NO COBRAND SALES (CVN) OR      00761800
COBTR2** PAYMENTS (CVP) FOR THE WEEK.                                   00761900
COBTR2** THE KCN AND KCP PARAGRAPHS WOULD THEN READ THE TRAILING TRANS, 00762000
COBTR2** CREATE THE CVN OR CVP GL RECORDS AND INCREMENT THE             00762100
COBTR2** KCN OR KCP GL RECORDS.                                         00762200
COBTRF** NEEDED TO INCREMENT A SIGNED FIELD AND THEN MOVE IT TO         00762300
COBTRF** GL002-MONETARY-AMT, WHICH ISN'T SIGNED, TO AVOID A PROBLEM     00762400
COBTRF** WHEN IT IS NEGATIVE.                                           00762500
COBTRL******************************************************************00762600
SPNFIX*  CHANGED 02/23/2024   BY JIM HUNTER    CHG0301955               00762803
SPNFIX*  ADD PARA 8110-WRITE-GL-SPN-RECORD FOR THE SCANNING PENALTIES. *00762901
SPNFIX*  USING PARA 8100- FOR THE SCANNING PENALTIES RESULTS IN THEM   *00763101
SPNFIX*  ALL BEING WRITTEN TO THE 7TH DAY OF THE WEEK, (DUE TO THEM    *00763202
SPNFIX*  ALL BEING WRITTEN AT THE SAME TIME), RESULTING IN $5          *00763302
SPNFIX*  DIFFERENCES IN CREDITS AND DEBITS ON THE DAY THEY OCCUR       *00763402
SPNFIX*  AND DAY 7 IF THEY DIDN'T OCCUR ON DAY 7.  BALANCING IS BY     *00763502
SPNFIX*  WEEK SO IT STILL BALANCES, BUT THE AUDITORS HAVE QUESTIONED   *00763602
SPNFIX*  THE $5 DIFFERENCES ON THE 2 DAYS.                             *00763702
SPNFIX*----------------------------------------------------------------*00763802
007800 ENVIRONMENT DIVISION.                                            00763902
008000                                                                  00764002
008100 CONFIGURATION SECTION.                                           00764102
008200                                                                  00764202
008300 SOURCE-COMPUTER.        IBM-3090.                                00764302
008400 OBJECT-COMPUTER.        IBM-3090.                                00765000
008500                                                                  00766000
008600 INPUT-OUTPUT SECTION.                                            00767000
008700                                                                  00768000
008800 FILE-CONTROL.                                                    00769000
008900                                                                  00770000
009000     SELECT GENERAL-LEDGER-FILE                                   00780000
009100         ASSIGN TO OUT01.                                         00790000
009200                                                                  00800000
009300     SELECT EMAIL-FILE                                            00810000
009400         ASSIGN TO OUT02.                                         00820000
009500                                                                  00830000
009600     SELECT DAILY-BALANCE-IND-FILE                                00840000
009700         ASSIGN TO OUT03.                                         00850000
009800                                                                  00860000
009900******************************************************************00870000
010000 DATA DIVISION.                                                   00880000
010100******************************************************************00890000
010200                                                                  00900000
010300 FILE SECTION.                                                    00910000
010400                                                                  00920000
010500 FD  GENERAL-LEDGER-FILE                                          00930000
010600     RECORDING MODE IS F                                          00940000
010700     LABEL RECORDS ARE STANDARD                                   00950000
010800     BLOCK CONTAINS 0 RECORDS.                                    00960000
010900                                                                  00970000
011000 01  GENERAL-LEDGER-RECORD       PIC X(180).                      00980000
011100                                                                  00990000
011200 FD  EMAIL-FILE                                                   01000000
011300     RECORDING MODE IS F                                          01010000
011400     LABEL RECORDS ARE STANDARD                                   01020000
011500     BLOCK CONTAINS 0 RECORDS.                                    01030000
011600                                                                  01040000
011700 01  EMAIL-RECORD                PIC X(80).                       01050000
011800                                                                  01060000
011900 FD  DAILY-BALANCE-IND-FILE                                       01070000
012000     RECORDING MODE IS F                                          01080000
012100     LABEL RECORDS ARE STANDARD                                   01090000
012200     BLOCK CONTAINS 0 RECORDS.                                    01100000
012300                                                                  01110000
012400 01  DAILY-BALANCE-IND-RECORD    PIC X(80).                       01120000
012500                                                                  01130000
012600 WORKING-STORAGE SECTION.                                         01140000
012700                                                                  01150000
012800*                                                                 01160000
012900*  GENERAL LEDGER OUTPUT FILE                                     01170000
013000*                                                                 01180000
013100                                                                  01190000
013200     COPY GLRD002.                                                01200000
013300                                                                  01210000
013400                                                                  01220000
013500 01  ABEND-CODE                  PIC S9(4)    VALUE ZEROS         01230000
013600                                 COMP SYNC.                       01240000
013700     88  ABEND-4003-CC-ERROR                       VALUE +4003.   01250000
013800     88  ABEND-4013-DB2-ERROR                      VALUE +4013.   01260000
013900     88  ABEND-4019-CAL-ERROR                      VALUE +4019.   01270000
014000                                                                  01280000
014100 01  DK-DB2-KEYS.                                                 01290000
014200     05  DK-BEGIN-DATE-ISO       PIC X(10)    VALUE SPACES.       01300000
014300     05  DK-END-DATE-ISO         PIC X(10)    VALUE SPACES.       01310000
014300     05  DK-DATE-ISO             PIC X(10)    VALUE SPACES.       01320000
014400     05  DK-BEGIN-PARTITION      PIC S9(04)   COMP                01330000
014500                                              VALUE ZERO.         01340000
014600     05  DK-END-PARTITION        PIC S9(04)   COMP                01350000
014700                                              VALUE ZERO.         01360000
014800                                                                  01370000
014900 01  PS-PROGRAM-SWITCHES.                                         01380000
015000     05  PS-END-OF-CURSOR-SW     PIC X(01)    VALUE 'N'.          01390000
015100         88  PS-END-OF-CURSOR                 VALUE 'Y'.          01400000
015200         88  PS-NOT-END-OF-CURSOR             VALUE 'N'.          01410000
015300     05  PS-END-OF-DEBIT-CURSOR-SW PIC X(01)  VALUE 'N'.          01420000
015400         88  PS-END-OF-DEBIT-CURSOR           VALUE 'Y'.          01430000
015500         88  PS-NOT-END-OF-DEBIT-CURSOR       VALUE 'N'.          01440000
015600     05  PS-FIRST-TIME-THRU-SW   PIC X(01)    VALUE 'N'.          01450000
015700         88  PS-FIRST-TIME-THRU-YES           VALUE 'Y'.          01460000
015800         88  PS-FIRST-TIME-THRU-NO            VALUE 'N'.          01470000
015900     05  PS-SCAN-PENALTY-SW      PIC X(01)    VALUE 'N'.          01480000
016000         88  PS-SCAN-PENALTY-YES              VALUE 'Y'.          01490000
016100         88  PS-SCAN-PENALTY-NO               VALUE 'N'.          01500000
016200                                                                  01510000
016300 01  PC-PROGRAM-CONSTANTS.                                        01520000
016400     05  PC-CURRENT-PROGRAM-NAME PIC X(08)    VALUE 'SAKUT041'.   01530000
016500     05  PC-BUSINESS-UNIT        PIC X(03)    VALUE 'KDS'.        01540000
016600     05  PC-OPERATIONAL-TABLES   PIC X(01)    VALUE 'O'.          01550000
016700     05  PC-STORE-GROUP-CODE     PIC X(01)    VALUE 'A'.          01560000
016800*    05  PC-WEBSTORE             PIC 9(03)    VALUE 873.          01570000
016900     05  PC-CASH-CHECK-DEPOSIT   PIC X(03)    VALUE 'CCD'.        01580000
017000     05  PC-REGISTER-OVER-SHORT-MSG PIC X(20)                     01590000
017100                     VALUE 'RGSTR (OVR)SHORT WE:'.                01600000
017200     05  PC-SAFE-OVER-SHORT-MSG     PIC X(20)                     01610000
017300                     VALUE 'SAFE (OVR) SHORT WE:'.                01620000
017400     05  PC-SUM-CTG-CDE          PIC  X(03).                      01630000
017500         88  PC-SUM-CTG-CDE-SHS               VALUE 'SHS'.        01640000
017600         88  PC-SUM-CTG-CDE-SHR               VALUE 'SHR'.        01650000
017700         88  PC-SUM-CTG-CDE-GWS               VALUE 'GWS'.        01660000
017800         88  PC-SUM-CTG-CDE-GWR               VALUE 'GWR'.        01670000
017900         88  PC-SUM-CTG-CDE-ECR               VALUE 'ECR'.        01680000
018000         88  PC-SUM-CTG-CDE-KKB               VALUE 'KKB'.        01690000
018100         88  PC-SUM-CTG-CDE-BRC               VALUE 'BRC'.        01700000
018200         88  PC-SUM-CTG-CDE-KKH               VALUE 'KKH'.        01710000
018300         88  PC-SUM-CTG-CDE-KKU               VALUE 'KKU'.        01720000
018400         88  PC-SUM-CTG-CDE-KKS               VALUE 'KKS'.        01730000
018500         88  PC-SUM-CTG-CDE-KKT               VALUE 'KKT'.        01740000
018600         88  PC-SUM-CTG-CDE-MAN               VALUE 'MAN'.        01750000
018700         88  PC-SUM-CTG-CDE-PTG               VALUE 'PTG'.        01760000
018800         88  PC-SUM-CTG-CDE-SFS               VALUE 'SFS'.        01770000
018900         88  PC-SUM-CTG-CDE-BPS               VALUE 'BPS'.        01780000
019000         88  PC-SUM-CTG-CDE-SPN               VALUE 'SPN'.        01790000
019400         88  PC-SUM-CTG-CDE-FEE               VALUE 'FEE'.        01800000
019500         88  PC-SUM-CTG-CDE-AFE               VALUE 'AFE'.        01810000
BOSS           88  PC-SUM-CTG-CDE-BOS               VALUE 'BOS'.        01820000
BOSS           88  PC-SUM-CTG-CDE-BSR               VALUE 'BSR'.        01830000
BOSS           88  PC-SUM-CTG-CDE-BPR               VALUE 'BPR'.        01840000
12386a         88  PC-SUM-CTG-CDE-DON               VALUE 'DON'.        01850000
MKTPLC         88  PC-SUM-CTG-CDE-MSS               VALUE 'MSS'.        01860000
MKTPLC         88  PC-SUM-CTG-CDE-MSR               VALUE 'MSR'.        01870000
MKTPLC         88  PC-SUM-CTG-CDE-MCS               VALUE 'MCS'.        01880000
MKTPLC         88  PC-SUM-CTG-CDE-MCR               VALUE 'MCR'.        01890000
MKTPL2*        88  PC-SUM-CTG-CDE-MMS               VALUE 'MMS'.        01891000
MKTPL2*        88  PC-SUM-CTG-CDE-MMR               VALUE 'MMR'.        01892000
SEPHOR         88  PC-SUM-CTG-CDE-SGS               VALUE 'SGS'.        01893000
SEPHOR         88  PC-SUM-CTG-CDE-SGT               VALUE 'SGT'.        01894000
COBRND         88  PC-SUM-CTG-CDE-CVN               VALUE 'CVN'.        01895000
COBRND         88  PC-SUM-CTG-CDE-CVP               VALUE 'CVP'.        01896000
019600                                                                  01897000
019700 01  PT-PROGRAM-TOTALS.                                           01898000
019800     05  PT-DEBITS               PIC S9(11)V99  VALUE ZEROS       01899000
019900                                 COMP-3.                          01900000
020000     05  PT-CREDITS              PIC S9(11)V99  VALUE ZEROS       01910000
020100                                 COMP-3.                          01920000
020200     05  PT-GL-RECORDS-WRITTEN   PIC S9(11)   VALUE ZEROS         01930000
020300                                 COMP-3.                          01940000
020400                                                                  01950000
020500 01  PV-PROGRAM-VARIABLES.                                        01960000
020600     05  PV-SUM-TPC-NULL-IND        PIC S9(4) COMP VALUE +0.      01970000
020700     05  PV-DB2-FUNCTION         PIC X(30)    VALUE SPACES.       01980000
020800     05  PV-PARAGRAPH-NAME       PIC X(30)    VALUE SPACES.       01990000
020900     05  PV-STORE-NUMBER-X.                                       02000000
021000         10  PV-STORE-NUMBER     PIC 9(04).                       02010000
021100     05  PV-STORE-BALANCE        PIC 9(04).                       02020000
021200     05  PV-STORE-SLS-DTE        PIC X(10).                       02030000
021300     05  PV-CUR-SYS-TMST         PIC X(26) VALUE SPACES.          02040000
021400     05  PV-DEBIT-HOLD-AMT       PIC S9(13)V99 COMP-3 VALUE ZERO. 02050000
021500     05  PV-SUM-CTG-AMT          PIC S9(13)V99                    02060000
021600                                              COMP-3 VALUE ZERO.  02070000
COBTR2     05  PV-TBL-STORE            PIC S9(04)  COMP  VALUE ZEROES.  02080000
COBTR2     05  PV-TRAIL-AMOUNT         PIC ---,---,--9.99  VALUE ZERO.  02090000
COBTRL     05  PV-TTN-ADJUSTMENTS      PIC S9(9)V99 COMP-3 VALUE ZERO.  02100000
COBTRL     05  PV-TTP-ADJUSTMENTS      PIC S9(9)V99 COMP-3 VALUE ZERO.  02101000
COBTRL     05  PV-TTN-TOTAL            PIC S9(9)V99 COMP-3 VALUE ZERO.  02102000
COBTRL     05  PV-TTP-TOTAL            PIC S9(9)V99 COMP-3 VALUE ZERO.  02103000
021700     05  PV-FEE-ADJUSTMENTS      PIC S9(9)V99 COMP-3 VALUE ZERO.  02104000
021800     05  PV-HOLD-GL-AMT          PIC S9(13)V99                    02105000
021900                                              COMP-3 VALUE ZERO.  02106000
022000     05  PV-COMMISSIONS-AMT      PIC S9(13)V99                    02107000
022100                                              COMP-3 VALUE ZERO.  02108000
022200     05  PV-TTL-TMR-ECOM-AMT     PIC S9(13)V99                    02109000
022300                                              COMP-3 VALUE ZERO.  02110000
022400     05  PV-TBL-SUB              PIC S9(05)   COMP VALUE ZERO.    02120000
022500     05  PV-SUB                  PIC S9(05)   COMP VALUE ZERO.    02130000
022600     05  PV-BAL-DTE-SUB          PIC 9             VALUE ZERO.    02140000
022700     05  PV-BAL-DTE-SUB-SPN      PIC 9             VALUE ZERO.    02150000
022800     05  PV-BAL-DTE-SUB-TSAADSU  PIC 9             VALUE ZERO.    02160000
022900     05  PV-NULL-IND1            PIC S9(4)    VALUE ZERO COMP.    02170000
023000     05  PV-CURRENT-DATE.                                         02180000
023100         10  PV-CURRENT-CCYY     PIC X(04).                       02190000
023200         10  PV-CURRENT-MM       PIC X(02).                       02200000
023300         10  PV-CURRENT-DD       PIC X(02).                       02210000
023400     05  PV-CURRENT-DATE-ISO.                                     02220000
023500         10  PV-CURRENT-CCYY-ISO PIC X(04).                       02230000
023600         10  FILLER              PIC X(01)    VALUE '-'.          02240000
023700         10  PV-CURRENT-MM-ISO   PIC X(02).                       02250000
023800         10  FILLER              PIC X(01)    VALUE '-'.          02260000
023900         10  PV-CURRENT-DD-ISO   PIC X(02).                       02270000
024000     05  PV-STORE-DEBIT-CREDIT-DIFF PIC S9(11)V99 COMP-3 VALUE 0. 02280000
024100     05  PV-DISPLAY-DIFF            PIC -(10)9.99.                02290000
024200                                                                  02300000
024300 01  PV-DLY-HOLD-AMTS-TABLE.                                      02310000
024400     05  PV-DLY-STR-ROW       OCCURS 9999 TIMES.                  02320000
024500         10  PV-DLY-SLS-DTE-COL  OCCURS 7 TIMES.                  02330000
024600             15  PV-DLY-STORE-DEBITS     PIC S9(11)V99 COMP-3.    02340000
024700             15  PV-DLY-STORE-CREDITS    PIC S9(11)V99 COMP-3.    02350000
024800             15  PV-HOLD-DLY-STM-AMT     PIC S9(11)V99 COMP-3.    02360000
024900             15  PV-HOLD-DLY-TMR-AMT     PIC S9(11)V99 COMP-3.    02370000
TPCFIX             15  PV-HOLD-DLY-TPC-AMT     PIC S9(11)V99 COMP-3.    02380000
025000             15  PV-HOLD-DLY-GDT-AMT     PIC S9(11)V99 COMP-3.    02390000
025100             15  PV-HOLD-DLY-SSE-AMT     PIC S9(11)V99 COMP-3.    02400000
COBRND             15  PV-HOLD-DLY-BCN-AMT     PIC S9(11)V99 COMP-3.    02410000
COBRND             15  PV-HOLD-DLY-KCP-AMT     PIC S9(11)V99 COMP-3.    02420000
COBTRL             15  PV-HOLD-DLY-KCN-AMT     PIC S9(11)V99 COMP-3.    02430000
025500             15  PV-TSAADSU-FOUND-IND    PIC X(1).                02440000
COBTR2             15  PV-HOLD-DLY-CVN-FOUND   PIC X.                   02450000
COBTR2             15  PV-HOLD-DLY-CVP-FOUND   PIC X.                   02460000
025600                                                                  02470000
025700 01  PV-DLY-DATE-VALUES.                                          02480000
025800     05  PV-DLY-BAL-DTE-1        PIC X(10)    VALUE SPACES.       02490000
025900     05  PV-DLY-BAL-DTE-2        PIC X(10)    VALUE SPACES.       02500000
026000     05  PV-DLY-BAL-DTE-3        PIC X(10)    VALUE SPACES.       02510000
026100     05  PV-DLY-BAL-DTE-4        PIC X(10)    VALUE SPACES.       02520000
026200     05  PV-DLY-BAL-DTE-5        PIC X(10)    VALUE SPACES.       02530000
026300     05  PV-DLY-BAL-DTE-6        PIC X(10)    VALUE SPACES.       02540000
026400     05  PV-DLY-BAL-DTE-7        PIC X(10)    VALUE SPACES.       02550000
026500                                                                  02560000
026600 01  CC-CONTROL-CARD.                                             02570000
026700     05  CC-CONTROL-CARD-DISPLAY.                                 02580000
026800         10  CC-START-DATE       PIC X(10)    VALUE SPACES.       02590000
026900         10  FILLER              PIC X        VALUE SPACE.        02600000
027000         10  CC-END-DATE         PIC X(10)    VALUE SPACES.       02610000
027100         10  FILLER              PIC X(59)    VALUE SPACE.        02620000
027200                                                                  02630000
027300 01  DATE-CONTROL-CARD.                                           02640000
027400     05  CC-WEEK-ENDING-DATE-ISO.                                 02650000
027500         10  CC-WEEK-ENDING-CC   PIC X(02).                       02660000
027600         10  CC-WEEK-ENDING-YY   PIC X(02).                       02670000
027700         10  FILLER              PIC X(01).                       02680000
027800         10  CC-WEEK-ENDING-MM   PIC X(02).                       02690000
027900         10  FILLER              PIC X(01).                       02700000
028000         10  CC-WEEK-ENDING-DD   PIC X(02).                       02710000
028100     05  FILLER                  PIC X(70).                       02720000
028200                                                                  02730000
028300 01  TD-TOTAL-DISPLAY-MESSAGE.                                    02740000
028400     05  TD-TOTAL-ID             PIC X(45)    VALUE SPACES.       02750000
028500         88  TD-DEBITS                        VALUE               02760000
028600             'DEBITS . . . . . . . . . . . . . . . . . . . '.     02770000
028700         88  TD-CREDITS                       VALUE               02780000
028800             'CREDITS. . . . . . . . . . . . . . . . . . . '.     02790000
028900         88  TD-GL-RECORDS-WRITTEN            VALUE               02800000
029000             'GL RECORDS WRITTEN . . . . . . . . . . . . . '.     02810000
029100     05  TD-TOTAL-AMOUNT         PIC ZZ,ZZZ,ZZZ,ZZZ.ZZ            02820000
029200                                              VALUE ZEROS.        02830000
029300                                                                  02840000
029400 01  EM-EMAIL-LINE1.                                              02850000
029500     05  FILLER                  PIC X(50)    VALUE               02860000
029600         'General Ledger file was successfully created for: '.    02870000
029700     05  EM-LINE1-DATE           PIC X(10)    VALUE SPACES.       02880000
029800     05  FILLER                  PIC X(14)    VALUE SPACES.       02890000
029900     05  FILLER                  PIC X(06)    VALUE SPACES.       02900000
030000                                                                  02910000
030100 01  EM-EMAIL-LINE2A.                                             02920000
030200     05  FILLER                  PIC X(41)    VALUE               02930000
030300         'General Ledger file was NOT created for: '.             02940000
030400     05  EM-LINE2A-DATE          PIC X(10)    VALUE SPACES.       02950000
030500     05  FILLER                  PIC X(23)    VALUE SPACES.       02960000
030600     05  FILLER                  PIC X(06)    VALUE SPACES.       02970000
030700                                                                  02980000
030800 01  EM-EMAIL-LINE2B.                                             02990000
030900     05  FILLER                  PIC X(33)    VALUE               03000000
031000         'DEBITS AND CREDITS ARE NOT EQUAL.'.                     03010000
031100     05  FILLER                  PIC X(41)    VALUE SPACES.       03020000
031200     05  FILLER                  PIC X(06)    VALUE SPACES.       03030000
031300                                                                  03040000
031400 01  EM-EMAIL-LINE3.                                              03050000
031500     05  FILLER                  PIC X(09)    VALUE               03060000
031600         'Debits:  '.                                             03070000
031700     05  EM-LINE3-DEBITS         PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.99       03080000
031800                                              VALUE ZERO.         03090000
031900     05  FILLER                  PIC X(43)    VALUE SPACES.       03100000
032000     05  FILLER                  PIC X(06)    VALUE SPACES.       03110000
032100                                                                  03120000
032200 01  EM-EMAIL-LINE4.                                              03130000
032300     05  FILLER                  PIC X(09)    VALUE               03140000
032400         'Credits: '.                                             03150000
032500     05  EM-LINE4-CREDITS        PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.99       03160000
032600                                              VALUE ZERO.         03170000
032700     05  FILLER                  PIC X(43)    VALUE SPACES.       03180000
032800     05  FILLER                  PIC X(06)    VALUE SPACES.       03190000
032900                                                                  03200000
033000 01  EM-EMAIL-LINE5.                                              03210000
033100     05  FILLER                  PIC X(45)    VALUE               03220000
033200         'THE FOLLOWING STORES HAVE OUT OF BALANCES:   '.         03230000
033300     05  FILLER                  PIC X(35)    VALUE SPACES.       03240000
033400                                                                  03250000
033500 01  EM-EMAIL-LINE6.                                              03260000
033600     05  FILLER                  PIC X(43)    VALUE               03270000
033700         'STORE     SALES DATE             DEBITS    '.           03280000
033800     05  FILLER                  PIC X(37)    VALUE               03290000
033900         '        CREDITS         DIFFERENCE  '.                  03300000
034000 01  EM-EMAIL-LINE7.                                              03310000
034100     05  FILLER                  PIC X        VALUE SPACE.        03320000
034200     05  EM-LINE7-STORE          PIC 9(4)     VALUE ZEROES.       03330000
034300     05  FILLER                  PIC X(5)     VALUE SPACES.       03340000
034400     05  EM-LINE7-SLS-DTE        PIC X(10)    VALUE SPACES.       03350000
034500     05  FILLER                  PIC XX       VALUE SPACES.       03360000
034600     05  EM-LINE7-STR-DEBITS     PIC ZZ,ZZZ,ZZZ,ZZ9.99            03370000
034700                                              VALUE ZERO.         03380000
034800     05  FILLER                  PIC XX       VALUE SPACES.       03390000
034900     05  EM-LINE7-STR-CREDITS    PIC ZZ,ZZZ,ZZZ,ZZ9.99            03400000
035000                                              VALUE ZERO.         03410000
035100     05  FILLER                  PIC XX       VALUE SPACES.       03420000
035200     05  EM-LINE7-STR-DIFF       PIC --,---,---,--9.99            03430000
035300                                              VALUE ZERO.         03440000
035400     05  FILLER                  PIC X(3)     VALUE SPACES.       03450000
035500                                                                  03460000
035600                                                                  03470000
035700 01  EM-EMAIL-LINE8.                                              03480000
035800     05  FILLER                  PIC X(32)    VALUE               03490000
035900         'E-COMMERCE TMR CREDIT GENERATED '.                      03500000
036000     05  EM-LINE8-E-COM-CR       PIC ---,---,---,---,--9.99       03510000
036100                                              VALUE ZEROS.        03520000
036200 01  EM-EMAIL-LINE9.                                              03530000
036300*    05  FILLER                  PIC X(12)    VALUE               03540000
036400*        'ATTN: Store '.                                          03550000
036500*    05  EM-LINE9-STORE          PIC 9(4)     VALUE ZEROES.       03560000
036600*    05  FILLER                  PIC X(45)    VALUE               03570000
036700*        ' needs to be re-sent to Corp for Sales Date: '.         03580000
036800*    05  EM-LINE9-SLS-DTE        PIC X(10)    VALUE SPACES.       03590000
036900*    05  FILLER                  PIC X(09)    VALUE SPACES.       03600000
037000     05  FILLER                  PIC X(38)    VALUE               03610000
037100         'Data has not been received from Store '.                03620000
037200     05  EM-LINE9-STORE          PIC 9(4)     VALUE ZEROES.       03630000
037300     05  FILLER                  PIC X(5)     VALUE               03640000
037400         ' for '.                                                 03650000
037500     05  EM-LINE9-SLS-DTE        PIC X(10)    VALUE SPACES.       03660000
037600     05  FILLER                  PIC X(23)    VALUE SPACES.       03670000
037700                                                                  03680000
037800 01  EM-EMAIL-BLANK-LINE         PIC X(80)    VALUE SPACES.       03690000
037900                                                                  03700000
038000                                                                  03710000
038100*** BALANCE INDICATOR FILE BY DAY - LINE 1                        03720000
038200 01  BF-BALANCE-LINE1.                                            03730000
038300     05  FILLER                  PIC X(17)                        03740000
038400         VALUE 'Weekending Date: '.                               03750000
038500     05  BF-LINE1-WKND-DTE       PIC X(10)    VALUE SPACES.       03760000
038600     05  FILLER                  PIC X        VALUE '|'.          03770000
038700     05  BF-CUR-SYS-TMST         PIC X(26)    VALUE SPACES.       03780000
038800     05  FILLER                  PIC X(26)    VALUE SPACES.       03790000
038900                                                                  03800000
039000*** BALANCE INDICATOR FILE BY DAY - DETAIL LINE                   03810000
039100 01  BF-BALANCE-DETAIL-LINE.                                      03820000
039200     05  BF-BAL-DTE              PIC X(10)    VALUE SPACES.       03830000
039300     05  FILLER                  PIC X        VALUE '|'.          03840000
039400     05  BF-BAL-STR-NBR          PIC 9(04)    VALUE ZEROES.       03850000
039500     05  FILLER                  PIC X        VALUE '|'.          03860000
039600*    05  BF-BAL-IND              PIC X        VALUE SPACE.        03870000
039700     05  BR-BAL-DIFF-AMT         PIC -(10)9.99.                   03880000
039800     05  FILLER                  PIC X(50)    VALUE SPACES.       03890000
039900                                                                  03900000
040000 01  ML-CONTROL-AREA.                                             03910000
040100     05  ML-CONTROL-DATE         PIC X(10)    VALUE SPACES.       03920000
040200     05  ML-CURRENT-DATE         PIC X(10)    VALUE SPACES.       03930000
040300     05  ML-LAST-WEEK-IND        PIC X(01)    VALUE SPACES.       03940000
040400         88  ML-LAST-FISCAL-WEEK              VALUE 'Y'.          03950000
040500         88  ML-NOT-LAST-FISCAL-WEEK          VALUE 'N'.          03960000
040600     05  FILLER                  PIC X(59)    VALUE SPACES.       03970000
040700                                                                  03980000
040800*---------------------------------------------------------------* 03990000
040900*    DATE ROUTINE WORKING STORAGE                               * 04000000
041000*---------------------------------------------------------------* 04010000
041100     COPY DPWS500.                                                04020000
041200*---------------------------------------------------------------* 04030000
041300*    SA CONSTANTS                                               * 04040000
041400*---------------------------------------------------------------* 04050000
041500     COPY SAWS006.                                                04060000
041600     COPY SAWS007.                                                04070000
041700*---------------------------------------------------------------* 04080000
041800*    DB2 ABEND AREA                                             * 04090000
041900*---------------------------------------------------------------* 04100000
042000     COPY DPWS004.                                                04110000
042100*---------------------------------------------------------------* 04120000
042200*    DB2 AREA FOR COSA DEPOSIT AMOUNT TABLE                     * 04130000
042300*---------------------------------------------------------------* 04140000
042400     EXEC SQL                                                     04150000
042500          INCLUDE TSAADDP                                         04160000
042600     END-EXEC.                                                    04170000
042700*---------------------------------------------------------------* 04180000
042800*    DB2 AREA FOR COSA PAID OUT/CASH RECEIVED TABLE             * 04190000
042900*---------------------------------------------------------------* 04200000
043000     EXEC SQL                                                     04210000
043100          INCLUDE TSAADPC                                         04220000
043200     END-EXEC.                                                    04230000
043300*---------------------------------------------------------------* 04240000
043400*    DB2 AREA FOR COSA SUMMARY TABLE                            * 04250000
043500*---------------------------------------------------------------* 04260000
043600     EXEC SQL                                                     04270000
043700          INCLUDE TSAADSU                                         04280000
043800     END-EXEC.                                                    04290000
043900*---------------------------------------------------------------* 04300000
044000*    DB2 AREA FOR COSA SUMMARY TOTAL TABLE                      * 04310000
044100*---------------------------------------------------------------* 04320000
044200     EXEC SQL                                                     04330000
044300          INCLUDE TSASUM                                          04340000
044400     END-EXEC.                                                    04350000
044500*---------------------------------------------------------------* 04360000
044600*    DB2 AREA FOR GENERAL LEDGER DATE TABLE                     * 04370000
044700*---------------------------------------------------------------* 04380000
044800     EXEC SQL                                                     04390000
044900          INCLUDE TSAGLDT                                         04400000
045000     END-EXEC.                                                    04410000
045100*---------------------------------------------------------------* 04420000
045200*    DB2 AREA FOR PARTITION TABLE                               * 04430000
045300*---------------------------------------------------------------* 04440000
045400     EXEC SQL                                                     04450000
045500          INCLUDE TEPPART                                         04460000
045600     END-EXEC.                                                    04470000
045700*---------------------------------------------------------------* 04480000
045800*    DB2 AREA FOR XST_LOC                                         04490000
045900*---------------------------------------------------------------* 04500000
046000     EXEC SQL                                                     04510000
046100          INCLUDE XST00001                                        04520000
046200     END-EXEC.                                                    04530000
046900******************************************************************04540000
047000*  DB2 TABLE DB2PDBA.TEPDKEY - PROCESSING DAY KEY TABLE           04550000
047100******************************************************************04560000
047200     EXEC SQL                                                     04570000
047300          INCLUDE TEPDKEY                                         04580000
047400     END-EXEC.                                                    04590000
048700******************************************************************04600000
048800*  DB2 TABLE DB2PDBA.TEPTRN  - TRANSACTION TABLE                  04610000
048900******************************************************************04620000
049000     EXEC SQL                                                     04630000
049100          INCLUDE TEPTRN                                          04640000
049200     END-EXEC.                                                    04650000
049300*    DB2 AREA FOR COMMUNICATIONS                                * 04660000
049400*---------------------------------------------------------------* 04670000
049500     EXEC SQL                                                     04680000
049600          INCLUDE SQLCA                                           04690000
049700     END-EXEC.                                                    04700000
049800                                                                  04710000
049900*---------------------------------------------------------------* 04720000
050000*    TSAADDP CURSOR - FOR DEPOSIT TABLE                         * 04730000
050100*---------------------------------------------------------------* 04740000
050200     EXEC SQL                                                     04750000
050300         DECLARE TSAADDP-CSR CURSOR FOR                           04760000
050400             SELECT  D.STR_NBR,                                   04770000
050500                     D.SLS_DTE,                                   04780000
050600                     SUM (D.TNDR_AMT)                             04790000
050700               FROM  TSAADDP D                                    04800000
050800               WHERE D.SLS_DTE BETWEEN :DK-BEGIN-DATE-ISO         04810000
050900                                 AND   :DK-END-DATE-ISO           04820000
STRFNT                                 AND STR_NBR <> 6666              04830000
051000               GROUP BY D.STR_NBR,                                04840000
051100                        D.SLS_DTE                                 04850000
051200             WITH UR                                              04860000
051300     END-EXEC.                                                    04870000
051400                                                                  04880000
051500*---------------------------------------------------------------* 04890000
051600*    TSAADPC CURSOR - FOR PAID OUT/CASH RECEIVED TABLE          * 04900000
051700*---------------------------------------------------------------* 04910000
051800     EXEC SQL                                                     04920000
051900         DECLARE TSAADPC-CSR CURSOR FOR                           04930000
052000             SELECT  P.STR_NBR,                                   04940000
052100                     P.SLS_DTE,                                   04950000
052200                     P.TYP_CDE,                                   04960000
052300                     P.STR_CHRGD_NBR,                             04970000
052400                     P.RSN_CDE,                                   04980000
052500                     P.ADJ_CSH_AMT,                               04990000
052600                     P.CMNT_TXT                                   05000000
052700               FROM  TSAADPC P                                    05010000
052800               WHERE P.SLS_DTE BETWEEN :DK-BEGIN-DATE-ISO         05020000
052900                                 AND   :DK-END-DATE-ISO           05030000
STRFNT                                 AND STR_NBR <> 6666              05040000
053000             WITH UR                                              05050000
053100     END-EXEC.                                                    05060000
053200                                                                  05070000
053300*---------------------------------------------------------------* 05080000
053400*    TSAADSU CURSOR - FOR TOTALS TABLE                          * 05090000
053500*---------------------------------------------------------------* 05100000
053600     EXEC SQL                                                     05110000
053700         DECLARE TSAADSU-CSR CURSOR FOR                           05120000
053800             SELECT  S.STR_NBR,                                   05130000
053900                     S.SLS_DTE,                                   05140000
054000                     S.SUM_CTG_CDE,                               05150000
054100                     L.E_BUS_IND,                                 05160000
054200                     SUM (S.ADJ_AMT)                              05170000
054300               FROM  TSAADSU S                                    05180000
054400                    ,XST_LOC L                                    05190000
054500               WHERE S.SLS_DTE BETWEEN :DK-BEGIN-DATE-ISO         05200000
054600                                 AND   :DK-END-DATE-ISO           05210000
054700                 AND S.STR_NBR = L.LOC_NBR                        05220000
STRFNT                 AND S.STR_NBR <> 6666                            05230000
054800                 AND S.SUM_CTG_CDE IN ('KMT','POS','GTT',         05240000
054900                                       'TMR','GDT','BCN',         05250000
055000                                       'NCN','AEN','KCN',         05260000
055100                                       'ROS','SOS','COH',         05270000
055200                                       'STM','TAX','GTS',         05280000
055300                                       'GDS','CRI','KMI',         05290000
055400                                       'POR','KCP','NSF',         05300000
055500                                       'CUD','DBN','TPC',         05310000
PAYVEN                                       'PPN','VMN')               05320000
055700               GROUP BY S.STR_NBR,                                05330000
055800                        S.SLS_DTE,                                05340000
055900                        S.SUM_CTG_CDE,                            05350000
056000                        L.E_BUS_IND                               05360000
056100             WITH UR                                              05370000
056200     END-EXEC.                                                    05380000
056300                                                                  05390000
056400*---------------------------------------------------------------* 05400000
056500*    TSASUM CURSOR - FOR SUMMARY TOTAL TABLE - TO GET EMPLOYEE  * 05410000
056600*    CASH DISCOUNT.                                             * 05420000
056700*    WITH AUTO POST GL, NEW CATEGORIES WILL BE SUMMED USING     * 05430000
056800*    TSASUM.  THE NEW CATEGORIES ARE:  GWR, GWS, ECR, SHR, SHS, * 05440000
056900*    KKB, KKH, KKS, KKT, MAN, PTG, SPN, BRC.                    * 05450000
057000*    5/8/2002 - CHANGE MADE TO INCLUDE TWO TSASUM CURSORS; ONE  * 05460000
057100*    THAT USES NON-ZERO REGISTER ROWS (TSASUM-CSR) AND ONE THAT * 05470000
057200*    USES ZERO REGISTER ROWS (ZEROROW-CSR).                     * 05480000
057300*    7/30/2013 - add category SFS to the ZEROROW-CSR            * 05490000
057400*    2/20/2014 - add category BPS to the ZEROROW-CSR            * 05500000
MKTPLC*    March, 2022 - ADD CATEGORIES MSS, MSR, MCS, MCR, MMS, MMR. * 05510000
COBRND*    FEB,2023 ADD COBRAND CATEGORIES CVN AND CVP.               * 05520000
057600*---------------------------------------------------------------* 05530000
057700     EXEC SQL                                                     05540000
057800         DECLARE TSASUM-CSR CURSOR FOR                            05550000
057900             SELECT  STR_NBR,                                     05560000
058000                     PRT.SLS_DTE,                                 05570000
058100                     SUM_CTG_CDE,                                 05580000
058200                     SUM (CTG_AMT) AS PV-SUM-CTG-AMT              05590000
058300               FROM  TSASUM  SUM                                  05600000
058400                    ,TEPPART PRT                                  05610000
058500               WHERE PRT.SLS_DTE                                  05620000
058600                            BETWEEN :DK-BEGIN-DATE-ISO            05630000
058700                                AND :DK-END-DATE-ISO              05640000
058800                 AND SUM.PARTN_NBR                                05650000
058900                                  =  PRT.PARTN_NBR                05660000
059000                 AND DB_STRUC_CDE = :PC-OPERATIONAL-TABLES        05670000
059100                 AND STR_GP_CDE   = :PC-STORE-GROUP-CODE          05680000
059200                 AND SUM_TYP_CDE IN ('D', 'S')                    05690000
059300                 AND SUM_CTG_CDE IN ('ECR', 'GWR', 'GWS', 'SHR',  05700000
SEPHOR                                     'SHS', 'FEE', 'SGS', 'SGT',  05710000
MKTPL2                                     'MSS', 'MSR', 'MCS', 'MCR',  05720000
COBRND                                     'CVN', 'CVP')                05730000
MKTPL2**                                   'MMS', 'MMR')                05740000
STRFNT                 AND STR_NBR     <> 6666                          05750000
059500                 AND RGST_ID     <> 0                             05760000
059600               GROUP BY STR_NBR, SUM_CTG_CDE, PRT.SLS_DTE         05770000
059700             WITH UR                                              05780000
059800     END-EXEC.                                                    05790000
059900                                                                  05800000
060000*---------------------------------------------------------------* 05810000
060100*    ZEROROW-CSR - PICKS UP CATEGORIES IN TSASUM THAT ONLY HAVE * 05820000
060200*    ZERO REGISTER ROWS.                                        * 05830000
BOSS  *    ADD CATEGORY BOS TO THE ZERO REGISTER ROW.                 * 05840000
BOSS  *    ADD CATEGORY BSR TO THE ZERO REGISTER ROW.                 * 05850000
BOSS  *    ADD CATEGORY BPR TO THE ZERO REGISTER ROW.                 * 05860000
060300*---------------------------------------------------------------* 05870000
060400     EXEC SQL                                                     05880000
060500         DECLARE ZEROROW-CSR CURSOR FOR                           05890000
060600             SELECT  STR_NBR,                                     05900000
060700                     PRT.SLS_DTE,                                 05910000
060800                     SUM_CTG_CDE,                                 05920000
060900                     SUM (CTG_AMT) AS PV-SUM-CTG-AMT              05930000
061000               FROM  TSASUM   SUM                                 05940000
061100                    ,TEPPART  PRT                                 05950000
061200               WHERE PRT.SLS_DTE                                  05960000
061300                            BETWEEN :DK-BEGIN-DATE-ISO            05970000
061400                                AND :DK-END-DATE-ISO              05980000
061500                 AND SUM.PARTN_NBR                                05990000
061600                                  =  PRT.PARTN_NBR                06000000
061700                 AND DB_STRUC_CDE = :PC-OPERATIONAL-TABLES        06010000
061800                 AND STR_GP_CDE   = :PC-STORE-GROUP-CODE          06020000
061900                 AND SUM_TYP_CDE IN ('D', 'S')                    06030000
062000                 AND SUM_CTG_CDE IN ('KKB', 'KKH', 'KKS', 'KKT',  06040000
062100                                     'MAN', 'PTG', 'SPN', 'KKU',  06050000
BOSS                                       'BRC', 'SFS', 'BPS', 'BOS',  06060000
12386a                                     'BSR', 'BPR', 'DON')         06070000
STRFNT                 AND STR_NBR     <> 6666                          06080000
062300                 AND RGST_ID      = 0                             06090000
062400               GROUP BY STR_NBR, SUM_CTG_CDE, PRT.SLS_DTE         06100000
062500             WITH UR                                              06110000
062600     END-EXEC.                                                    06120000
062700                                                                  06130000
062800******************************************************************06140000
062900 PROCEDURE DIVISION.                                              06150000
063000******************************************************************06160000
063100 0000-MAINLINE.                                                   06170000
063200                                                                  06180000
063300     PERFORM 1000-INITIALIZE.                                     06190000
063400                                                                  06200000
063500     PERFORM 1100-PROCESS-CONTROL-CARD.                           06210000
063600                                                                  06220000
063700     PERFORM 1200-PROCESS-DLY-BAL-DTES.                           06230000
063800                                                                  06240000
063900     PERFORM 2000-PROCESS.                                        06250000
064000                                                                  06260000
064100     PERFORM 9000-EOJ-ROUTINE.                                    06270000
064200                                                                  06280000
064300     STOP RUN.                                                    06290000
064400                                                                  06300000
064500*----------------------------------------------------------------*06310000
064600*  OPEN FILES. GET DATE FROM CONTROL CARD. CHECK IF DATE IS      *06320000
064700*  VALID, AND FIND OUT MONTH-ENDING DATE, TO SEE IF WE ARE AT    *06330000
064800*  THE END OF THE FISCAL MONTH.  PREPARE OUTPUT RECORD.          *06340000
064900*----------------------------------------------------------------*06350000
065000 1000-INITIALIZE.                                                 06360000
065100                                                                  06370000
065200     OPEN OUTPUT GENERAL-LEDGER-FILE                              06380000
065300                 EMAIL-FILE                                       06390000
065400                 DAILY-BALANCE-IND-FILE.                          06400000
065500                                                                  06410000
065600     ACCEPT DATE-CONTROL-CARD FROM SYSIN.                         06420000
065700                                                                  06430000
065800*    //RETRIEVE CURRENT SYSTEM TIMESTAMP                          06440000
065900     EXEC SQL                                                     06450000
066000       SET :PV-CUR-SYS-TMST = CURRENT TIMESTAMP                   06460000
066100     END-EXEC.                                                    06470000
066200                                                                  06480000
066300     INITIALIZE PV-DLY-HOLD-AMTS-TABLE.                           06490000
066400                                                                  06500000
066500     MOVE ZERO                TO PV-STORE-NUMBER.                 06510000
066600     SET PS-FIRST-TIME-THRU-YES                                   06520000
066700         PS-SCAN-PENALTY-NO   TO TRUE.                            06530000
066800                                                                  06540000
066900     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              06550000
067000     MOVE CC-WEEK-ENDING-DATE-ISO                                 06560000
067100                               TO DPG52-LK-DATE-INPUT.            06570000
067200     SET DPG52-LK-DTE-ISO-FMT  TO TRUE.                           06580000
067300     SET DPG51-FISCAL-454-CALENDAR                                06590000
067400                               TO TRUE.                           06600000
067500     SET DPG51-DO-NOT-INCR-DECR-DATE                              06610000
067600                               TO TRUE.                           06620000
067700     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          06630000
067800                                             DPG53 DPG54          06640000
067900                                             DPG55 DPG56.         06650000
068000     EVALUATE TRUE                                                06660000
068100         WHEN DPG54-NO-ERROR                                      06670000
068200             IF DPG56-LAST-FP-DB2-ISO-FMT                         06680000
068300                               = CC-WEEK-ENDING-DATE-ISO          06690000
068400                 SET ML-LAST-FISCAL-WEEK     TO TRUE              06700000
068500             ELSE                                                 06710000
068600                 SET ML-NOT-LAST-FISCAL-WEEK TO TRUE              06720000
068700             END-IF                                               06730000
068800         WHEN DPG54-SEVERE-ERROR                                  06740000
068900         WHEN DPG54-WARNING-ERROR                                 06750000
069000             DISPLAY '** ABEND **'                                06760000
069100             DISPLAY '** PROGRAM   ** = SAKUT041'                 06770000
069200             DISPLAY '** PARAGRAPH ** = 1000-INITIALIZE'          06780000
069300             DISPLAY 'BAD INPUT DATE: '                           06790000
069400                            CC-WEEK-ENDING-DATE-ISO               06800000
069500             DISPLAY DPG54-ERROR-MESSAGE                          06810000
069600             SET ABEND-4003-CC-ERROR TO TRUE                      06820000
069700             CALL 'ILBOABN0' USING ABEND-CODE                     06830000
069800     END-EVALUATE.                                                06840000
069900                                                                  06850000
070000     IF DPG55-ALPHA-WEEK-DAY-SATURDAY                             06860000
070100         CONTINUE                                                 06870000
070200     ELSE                                                         06880000
070300         DISPLAY '** ABEND **'                                    06890000
070400         DISPLAY '** PROGRAM   ** = SAKUT041'                     06900000
070500         DISPLAY '** PARAGRAPH ** = 1000-INITIALIZE'              06910000
070600         DISPLAY 'BAD INPUT DATE: '                               06920000
070700                            CC-WEEK-ENDING-DATE-ISO               06930000
070800         DISPLAY 'INPUT DATE IS NOT A WEEK ENDING DATE'           06940000
070900         SET ABEND-4003-CC-ERROR TO TRUE                          06950000
071000         CALL 'ILBOABN0' USING ABEND-CODE                         06960000
071100     END-IF.                                                      06970000
071200                                                                  06980000
071300     INITIALIZE GL002-GL-INTERFACE-TRN.                           06990000
071400     MOVE PC-BUSINESS-UNIT  TO GL002-BUSINESS-UNIT.               07000000
071500     MOVE CC-WEEK-ENDING-CC TO GL002-TRN-EFF-CC.                  07010000
071600     MOVE CC-WEEK-ENDING-YY TO GL002-TRN-EFF-YY.                  07020000
071700     MOVE CC-WEEK-ENDING-MM TO GL002-TRN-EFF-MM.                  07030000
071800     MOVE CC-WEEK-ENDING-DD TO GL002-TRN-EFF-DD.                  07040000
071900                                                                  07050000
072000*----------------------------------------------------------------*07060000
072100*  READ DATE CONTROL CARD                                         07070000
072200*----------------------------------------------------------------*07080000
072300 1100-PROCESS-CONTROL-CARD.                                       07090000
072400** when not provided in cc, must calc given week ending date - 6  07100000
072500     DISPLAY 'CALCULATING WEEK DATES... BASED ON '                07110000
072600             CC-WEEK-ENDING-DATE-ISO.                             07120000
072700     MOVE CC-WEEK-ENDING-DATE-ISO TO DK-END-DATE-ISO.             07130000
072800     PERFORM 1400-CALC-WEEK-BEG-DTE.                              07140000
072900                                                                  07150000
073000     DISPLAY 'START DATE      = ' DK-BEGIN-DATE-ISO.              07160000
073100     DISPLAY 'END   DATE      = ' DK-END-DATE-ISO.                07170000
073200                                                                  07180000
073300*----------------------------------------------------------------*07190000
073400*  GET THE DAILY BALANCE DATE VALUES                              07200000
073500*----------------------------------------------------------------*07210000
073600 1200-PROCESS-DLY-BAL-DTES.                                       07220000
073700** find day 1 date value (SUN)                                    07230000
073800     MOVE DK-BEGIN-DATE-ISO    TO PV-DLY-BAL-DTE-1.               07240000
073900** find day 2 date value (MON)                                    07250000
074000     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              07260000
074100     MOVE PV-DLY-BAL-DTE-1             TO DPG52-LK-DATE-INPUT.    07270000
074200     PERFORM 1300-CALC-NEXT-BAL-DTE.                              07280000
074300     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-DLY-BAL-DTE-2.       07290000
074400** find day 3 date value (TUE)                                    07300000
074500     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              07310000
074600     MOVE PV-DLY-BAL-DTE-2             TO DPG52-LK-DATE-INPUT.    07320000
074700     PERFORM 1300-CALC-NEXT-BAL-DTE.                              07330000
074800     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-DLY-BAL-DTE-3.       07340000
074900** find day 4 date value (WED)                                    07350000
075000     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              07360000
075100     MOVE PV-DLY-BAL-DTE-3             TO DPG52-LK-DATE-INPUT.    07370000
075200     PERFORM 1300-CALC-NEXT-BAL-DTE.                              07380000
075300     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-DLY-BAL-DTE-4.       07390000
075400** find day 5 date value (THU)                                    07400000
075500     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              07410000
075600     MOVE PV-DLY-BAL-DTE-4             TO DPG52-LK-DATE-INPUT.    07420000
075700     PERFORM 1300-CALC-NEXT-BAL-DTE.                              07430000
075800     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-DLY-BAL-DTE-5.       07440000
075900** find day 6 date value (FRI)                                    07450000
076000     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              07460000
076100     MOVE PV-DLY-BAL-DTE-5             TO DPG52-LK-DATE-INPUT.    07470000
076200     PERFORM 1300-CALC-NEXT-BAL-DTE.                              07480000
076300     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-DLY-BAL-DTE-6.       07490000
076400** find day 7 date value (SAT)                                    07500000
076500     MOVE DK-END-DATE-ISO      TO PV-DLY-BAL-DTE-7.               07510000
076600                                                                  07520000
076700     DISPLAY 'Day 1= ' PV-DLY-BAL-DTE-1.                          07530000
076800     DISPLAY 'Day 2= ' PV-DLY-BAL-DTE-2.                          07540000
076900     DISPLAY 'Day 3= ' PV-DLY-BAL-DTE-3.                          07550000
077000     DISPLAY 'Day 4= ' PV-DLY-BAL-DTE-4.                          07560000
077100     DISPLAY 'Day 5= ' PV-DLY-BAL-DTE-5.                          07570000
077200     DISPLAY 'Day 6= ' PV-DLY-BAL-DTE-6.                          07580000
077300     DISPLAY 'Day 7= ' PV-DLY-BAL-DTE-7.                          07590000
077400                                                                  07600000
077500*----------------------------------------------------------       07610000
077600*  CALC THE BAL DATE FOR USE IN TABLE SUBSCRIPTS LATER            07620000
077700*----------------------------------------------------------       07630000
077800 1300-CALC-NEXT-BAL-DTE.                                          07640000
077900                                                                  07650000
078000     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   07660000
078100     SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   07670000
078200     SET  DPG51-INCREMENT-DATE         TO TRUE.                   07680000
078300     MOVE 1                            TO DPG51-INCR-DECR-DAYS-9. 07690000
078400                                                                  07700000
078500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    07710000
078600                                             DPG54 DPG55 DPG56.   07720000
078700                                                                  07730000
078800     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  07740000
078900         DISPLAY '** ABEND **'                                    07750000
079000         DISPLAY '** PROGRAM   ** = SAKUT041'                     07760000
079100         DISPLAY '** PARAGRAPH ** = 1300-CALC-NEXT-BAL-DTE'       07770000
079200         DISPLAY 'BAD INPUT DATE: '  DPG52-LK-DATE-INPUT          07780000
079300         SET ABEND-4003-CC-ERROR TO TRUE                          07790000
079400         CALL 'ILBOABN0' USING ABEND-CODE                         07800000
079500     END-IF.                                                      07810000
079600                                                                  07820000
079700*1300-EXIT.                                                       07830000
079800                                                                  07840000
079900*----------------------------------------------------------       07850000
080000*  WHEN THE DATE RANGE CONTROL CARD IS EMPTY CALCULATE            07860000
080100*  THE RANGE BASED ON THE WEEKENDING DATE PROVIDED.               07870000
080200*----------------------------------------------------------       07880000
080300 1400-CALC-WEEK-BEG-DTE.                                          07890000
080400                                                                  07900000
080500     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              07910000
080600     MOVE CC-WEEK-ENDING-DATE-ISO      TO DPG52-LK-DATE-INPUT.    07920000
080700     DISPLAY 'DPG52 INPUT VALUE: ' DPG52-LK-DATE-INPUT.           07930000
080800     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   07940000
080900     SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   07950000
081000     SET  DPG51-DECREMENT-DATE         TO TRUE.                   07960000
081100     MOVE 6                            TO DPG51-INCR-DECR-DAYS-9. 07970000
081200                                                                  07980000
081300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    07990000
081400                                             DPG54 DPG55 DPG56.   08000000
081500                                                                  08010000
081600     MOVE DPG55-DB2-ISO-DATE-FMT       TO DK-BEGIN-DATE-ISO.      08020000
081700     DISPLAY 'DPG55 VALUE: ' DPG55-DB2-ISO-DATE-FMT.              08030000
081800     DISPLAY 'MOVED TO PV: ' DK-BEGIN-DATE-ISO.                   08040000
081900     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  08050000
082000         DISPLAY '** ABEND **'                                    08060000
082100         DISPLAY '** PROGRAM   ** = SAKUT041'                     08070000
082200         DISPLAY '** PARAGRAPH ** = 1400-CALC-NEXT-BAL-DTE'       08080000
082300         DISPLAY 'BAD INPUT DATE: '  DPG52-LK-DATE-INPUT          08090000
082400         SET ABEND-4003-CC-ERROR TO TRUE                          08100000
082500         CALL 'ILBOABN0' USING ABEND-CODE                         08110000
082600     END-IF.                                                      08120000
082700                                                                  08130000
082800*1400-EXIT.                                                       08140000
082900                                                                  08150000
083000*----------------------------------------------------------------*08160000
083100*                                                                *08170000
083200*----------------------------------------------------------------*08180000
083300 2000-PROCESS.                                                    08190000
083400                                                                  08200000
083500     PERFORM 2200-PROCESS-TSAADDP-TABLE.                          08210000
083600                                                                  08220000
083700**  AUTO POST GL PROJECT:  THE TSASUM TABLE MUST BE PROCESSED     08230000
083800**  PRIOR TO THE TSAADPC AND TSAADSU TABLES BECAUSE TSASUM        08240000
083900**  WILL INCLUDE CATEGORIES WHOSE DEBITS/CREDITS MAY NEED TO      08250000
084000**  BE ADDED TO TOTAL RETURNS (TMR), SALES (STM), GIFT CARDS      08260000
084100**  (GDT) OR STORE SUNDRY EXPENSE (SSE).  THE AMOUNTS ARE         08270000
084200**  KEPT IN THE PV-HOLD-AMTS-TABLE SUBSCRIPTED BY THE STORE       08280000
084300**  NUMBER.                                                       08290000
084400     PERFORM 2500-PROCESS-TSASUM-TABLE.                           08300000
084500                                                                  08310000
084600     PERFORM 2300-PROCESS-TSAADPC-TABLE.                          08320000
084700                                                                  08330000
084800     PERFORM 2400-PROCESS-TSAADSU-TABLE.                          08340000
084900                                                                  08350000
085000     PERFORM 2600-CHECK-IF-BALANCED.                              08360000
085100                                                                  08370000
085200*----------------------------------------------------------------*08380000
085300*    PROCESS THE TSAADDP (DEPOSIT AMOUNTS) TABLE                 *08390000
085400*----------------------------------------------------------------*08400000
085500 2200-PROCESS-TSAADDP-TABLE.                                      08410000
085600                                                                  08420000
085700     SET PS-NOT-END-OF-CURSOR TO TRUE.                            08430000
085800     PERFORM 2210-OPEN-TSAADDP-CURSOR.                            08440000
085900     PERFORM 2220-FETCH-TSAADDP-CURSOR.                           08450000
086000     PERFORM UNTIL PS-END-OF-CURSOR                               08460000
086100         PERFORM 2230-PROCESS-TSAADDP                             08470000
086200         PERFORM 2220-FETCH-TSAADDP-CURSOR                        08480000
086300     END-PERFORM.                                                 08490000
086400     PERFORM 2240-CLOSE-TSAADDP-CURSOR.                           08500000
086500                                                                  08510000
086600*----------------------------------------------------------------*08520000
086700*    OPEN THE TSAADDP CURSOR.                                    *08530000
086800*----------------------------------------------------------------*08540000
086900 2210-OPEN-TSAADDP-CURSOR.                                        08550000
087000                                                                  08560000
087100     EXEC SQL                                                     08570000
087200          OPEN TSAADDP-CSR                                        08580000
087300     END-EXEC.                                                    08590000
087400     EVALUATE TRUE                                                08600000
087500         WHEN SQLCODE = ZERO                                      08610000
087600             CONTINUE                                             08620000
087700         WHEN OTHER                                               08630000
087800             MOVE '2210-OPEN-TSAADDP-CURSOR'                      08640000
087900                              TO PV-PARAGRAPH-NAME                08650000
088000             MOVE 'OPEN CURSOR FOR TABLE TSAADDP'                 08660000
088100                              TO PV-DB2-FUNCTION                  08670000
088200             PERFORM 9990-DB2-ABEND                               08680000
088300     END-EVALUATE.                                                08690000
088400                                                                  08700000
088500*----------------------------------------------------------------*08710000
088600*   FETCH THE TSAADDP CURSOR.                                    *08720000
088700*----------------------------------------------------------------*08730000
088800 2220-FETCH-TSAADDP-CURSOR.                                       08740000
088900                                                                  08750000
089000     EXEC SQL                                                     08760000
089100         FETCH TSAADDP-CSR                                        08770000
089200         INTO  :SAADDP-STR-NBR,                                   08780000
089300               :SAADDP-SLS-DTE,                                   08790000
089400               :SAADDP-TNDR-AMT                                   08800000
089500     END-EXEC.                                                    08810000
089600     EVALUATE TRUE                                                08820000
089700         WHEN SQLCODE = ZERO                                      08830000
089800             CONTINUE                                             08840000
089900         WHEN SQLCODE = +100                                      08850000
090000             SET PS-END-OF-CURSOR TO TRUE                         08860000
090100         WHEN OTHER                                               08870000
090200             MOVE '2220-FETCH-TSAADDP-CURSOR'                     08880000
090300                              TO PV-PARAGRAPH-NAME                08890000
090400             MOVE 'FETCH CURSOR FOR TABLE TSAADDP'                08900000
090500                              TO PV-DB2-FUNCTION                  08910000
090600             PERFORM 9990-DB2-ABEND                               08920000
090700     END-EVALUATE.                                                08930000
090800                                                                  08940000
090900*----------------------------------------------------------------*08950000
091000*    CREATE THE OUTPUT RECORD FOR THE ROW.                       *08960000
091100*----------------------------------------------------------------*08970000
091200 2230-PROCESS-TSAADDP.                                            08980000
091300                                                                  08990000
091400     MOVE SAADDP-STR-NBR      TO PV-STORE-NUMBER                  09000000
091500                                 PV-STORE-BALANCE.                09010000
091600     MOVE SAADDP-SLS-DTE      TO PV-STORE-SLS-DTE.                09020000
091700     MOVE PV-STORE-NUMBER-X   TO GL002-LOCATION                   09030000
091800                                 GL002-JRNL-LN-REF                09040000
091900                                 GL002-JRNL-LINE-DESC.            09050000
092000     MOVE SAADDP-TNDR-AMT     TO GL002-MONETARY-AMT.              09060000
092100     SET  GL002-MONETARY-AMT-DR                                   09070000
092200                              TO TRUE.                            09080000
092300     MOVE PC-CASH-CHECK-DEPOSIT                                   09090000
092400                              TO GL002-EXPENSE-TYPE-CDE.          09100000
092500     PERFORM 8100-WRITE-GL-RECORD.                                09110000
092600                                                                  09120000
092700*----------------------------------------------------------------*09130000
092800*   CLOSE THE TSAADDP CURSOR.                                    *09140000
092900*----------------------------------------------------------------*09150000
093000 2240-CLOSE-TSAADDP-CURSOR.                                       09160000
093100     EXEC SQL                                                     09170000
093200          CLOSE TSAADDP-CSR                                       09180000
093300     END-EXEC.                                                    09190000
093400     EVALUATE TRUE                                                09200000
093500         WHEN SQLCODE = ZERO                                      09210000
093600             CONTINUE                                             09220000
093700         WHEN OTHER                                               09230000
093800             MOVE '2240-CLOSE-TSAADDP-CURSOR'                     09240000
093900                              TO PV-PARAGRAPH-NAME                09250000
094000             MOVE 'CLOSE CURSOR FOR TABLE TSAADDP'                09260000
094100                              TO PV-DB2-FUNCTION                  09270000
094200             PERFORM 9990-DB2-ABEND                               09280000
094300     END-EVALUATE.                                                09290000
094400                                                                  09300000
094500*----------------------------------------------------------------*09310000
094600*    PROCESS THE TSAADPC (PAID OUT/CASH RECEIVED) TABLE          *09320000
094700*----------------------------------------------------------------*09330000
094800                                                                  09340000
094900 2300-PROCESS-TSAADPC-TABLE.                                      09350000
095000                                                                  09360000
095100     SET PS-NOT-END-OF-CURSOR TO TRUE.                            09370000
095200     PERFORM 2310-OPEN-TSAADPC-CURSOR.                            09380000
095300     PERFORM 2320-FETCH-TSAADPC-CURSOR.                           09390000
095400     PERFORM UNTIL PS-END-OF-CURSOR                               09400000
095500         PERFORM 2330-PROCESS-TSAADPC                             09410000
095600         PERFORM 2320-FETCH-TSAADPC-CURSOR                        09420000
095700     END-PERFORM.                                                 09430000
095800     PERFORM 2340-CLOSE-TSAADPC-CURSOR.                           09440000
095900**  AUTO POST GL:  A RECORD WILL NEED TO BE INSERTED INTO         09450000
096000**  THE FILE FOR THE SCANNING PENALTY DEBIT (DEBITED TO STORE     09460000
096100**  SUNDRY EXPENSE--SSE).                                         09470000
096200     IF PS-END-OF-CURSOR  AND  PS-SCAN-PENALTY-YES                09480000
096300         PERFORM 2350-INSERT-SPN-TOTAL                            09490000
096400          VARYING PV-TBL-SUB FROM 1 BY 1                          09500000
096500           UNTIL  PV-TBL-SUB > 9999                               09510000
096600     END-IF.                                                      09520000
096700     SET PS-SCAN-PENALTY-NO    TO TRUE.                           09530000
096800                                                                  09540000
096900*----------------------------------------------------------------*09550000
097000*    OPEN THE TSAADPC CURSOR.                                    *09560000
097100*----------------------------------------------------------------*09570000
097200 2310-OPEN-TSAADPC-CURSOR.                                        09580000
097300                                                                  09590000
097400     EXEC SQL                                                     09600000
097500          OPEN TSAADPC-CSR                                        09610000
097600     END-EXEC.                                                    09620000
097700     EVALUATE TRUE                                                09630000
097800         WHEN SQLCODE = ZERO                                      09640000
097900             CONTINUE                                             09650000
098000         WHEN OTHER                                               09660000
098100             MOVE '2310-OPEN-TSAADPC-CURSOR'                      09670000
098200                              TO PV-PARAGRAPH-NAME                09680000
098300             MOVE 'OPEN CURSOR FOR TABLE TSAADPC'                 09690000
098400                              TO PV-DB2-FUNCTION                  09700000
098500             PERFORM 9990-DB2-ABEND                               09710000
098600     END-EVALUATE.                                                09720000
098700                                                                  09730000
098800*----------------------------------------------------------------*09740000
098900*   FETCH THE TSAADPC CURSOR.                                    *09750000
099000*----------------------------------------------------------------*09760000
099100 2320-FETCH-TSAADPC-CURSOR.                                       09770000
099200                                                                  09780000
099300     EXEC SQL                                                     09790000
099400         FETCH TSAADPC-CSR                                        09800000
099500         INTO  :SAADPC-STR-NBR,                                   09810000
099600               :SAADPC-SLS-DTE,                                   09820000
099700               :SAADPC-TYP-CDE,                                   09830000
099800               :SAADPC-STR-CHRGD-NBR,                             09840000
099900               :SAADPC-RSN-CDE,                                   09850000
100000               :SAADPC-ADJ-CSH-AMT,                               09860000
100100               :SAADPC-CMNT-TXT                                   09870000
100200     END-EXEC.                                                    09880000
100300     EVALUATE TRUE                                                09890000
100400         WHEN SQLCODE = ZERO                                      09900000
100500             CONTINUE                                             09910000
100600         WHEN SQLCODE = +100                                      09920000
100700             SET PS-END-OF-CURSOR TO TRUE                         09930000
100800         WHEN OTHER                                               09940000
100900             MOVE '2320-FETCH-TSAADPC-CURSOR'                     09950000
101000                              TO PV-PARAGRAPH-NAME                09960000
101100             MOVE 'FETCH CURSOR FOR TABLE TSAADPC'                09970000
101200                              TO PV-DB2-FUNCTION                  09980000
101300             PERFORM 9990-DB2-ABEND                               09990000
101400     END-EVALUATE.                                                10000000
101500                                                                  10010000
101600*----------------------------------------------------------------*10020000
101700*    CREATE THE OUTPUT RECORD FOR THE ROW.                       *10030000
101800*----------------------------------------------------------------*10040000
101900 2330-PROCESS-TSAADPC.                                            10050000
102000                                                                  10060000
102100     MOVE SAADPC-STR-NBR      TO PV-STORE-NUMBER                  10070000
102200                                 PV-STORE-BALANCE.                10080000
102300     MOVE SAADPC-SLS-DTE      TO PV-STORE-SLS-DTE.                10090000
102400     MOVE PV-STORE-NUMBER-X   TO GL002-JRNL-LN-REF.               10100000
102500     MOVE SAADPC-ADJ-CSH-AMT  TO GL002-MONETARY-AMT.              10110000
102600     MOVE SAADPC-TYP-CDE      TO SA007-TYP-CDE.                   10120000
102700     IF SA007-PAID-OUT                                            10130000
102800         IF SAADPC-ADJ-CSH-AMT < 0                                10140000
102900             SET  GL002-MONETARY-AMT-DR                           10150000
103000                              TO TRUE                             10160000
103100         ELSE                                                     10170000
103200             SET  GL002-MONETARY-AMT-CR                           10180000
103300                              TO TRUE                             10190000
103400         END-IF                                                   10200000
103500     ELSE                                                         10210000
103600         IF SAADPC-ADJ-CSH-AMT >= 0                               10220000
103700             SET  GL002-MONETARY-AMT-CR                           10230000
103800                              TO TRUE                             10240000
103900         ELSE                                                     10250000
104000             SET  GL002-MONETARY-AMT-DR                           10260000
104100                              TO TRUE                             10270000
104200         END-IF                                                   10280000
104300     END-IF.                                                      10290000
104400     MOVE SAADPC-RSN-CDE      TO GL002-EXPENSE-TYPE-CDE.          10300000
104500     MOVE SAADPC-STR-CHRGD-NBR                                    10310000
104600                              TO PV-STORE-NUMBER.                 10320000
104700     MOVE PV-STORE-NUMBER-X   TO GL002-LOCATION.                  10330000
104800     MOVE SAADPC-CMNT-TXT     TO GL002-JRNL-LINE-DESC.            10340000
104900     PERFORM 8100-WRITE-GL-RECORD.                                10350000
105000                                                                  10360000
105100*----------------------------------------------------------------*10370000
105200*   CLOSE THE TSAADPC CURSOR.                                    *10380000
105300*----------------------------------------------------------------*10390000
105400 2340-CLOSE-TSAADPC-CURSOR.                                       10400000
105500     EXEC SQL                                                     10410000
105600          CLOSE TSAADPC-CSR                                       10420000
105700     END-EXEC.                                                    10430000
105800     EVALUATE TRUE                                                10440000
105900         WHEN SQLCODE = ZERO                                      10450000
106000             CONTINUE                                             10460000
106100         WHEN OTHER                                               10470000
106200             MOVE '2340-CLOSE-TSAADPC-CURSOR'                     10480000
106300                              TO PV-PARAGRAPH-NAME                10490000
106400             MOVE 'CLOSE CURSOR FOR TABLE TSAADPC'                10500000
106500                              TO PV-DB2-FUNCTION                  10510000
106600             PERFORM 9990-DB2-ABEND                               10520000
106700     END-EVALUATE.                                                10530000
106800                                                                  10540000
106900*----------------------------------------------------------------*10550000
107000*    INSERT THE DEBIT TO THE STORE SUNDRY EXPENSE HERE FOR ANY   *10560000
107100*    AND ALL SCANNING PENALTIES.                                 *10570000
107200*----------------------------------------------------------------*10580000
107300 2350-INSERT-SPN-TOTAL.                                           10590000
107400                                                                  10600000
107500     PERFORM VARYING PV-BAL-DTE-SUB-SPN FROM 1 BY 1               10610000
107600               UNTIL PV-BAL-DTE-SUB-SPN > 7                       10620000
107700                                                                  10630000
107800         MOVE PV-TBL-SUB          TO PV-STORE-NUMBER              10640000
107900                                     PV-STORE-BALANCE             10650000
108000                                                                  10660000
108100         IF (PV-HOLD-DLY-SSE-AMT (PV-TBL-SUB , PV-BAL-DTE-SUB-SPN)10670000
108200                           NOT EQUAL ZERO)                        10680000
108300             MOVE PV-STORE-NUMBER-X                               10690000
108400                                   TO GL002-JRNL-LN-REF           10700000
108500                                      GL002-LOCATION              10710000
108600             MOVE 'SSE'           TO GL002-EXPENSE-TYPE-CDE       10720000
108700             MOVE 'Scan Penalty'  TO GL002-JRNL-LINE-DESC         10730000
109000          IF PV-HOLD-DLY-SSE-AMT (PV-TBL-SUB , PV-BAL-DTE-SUB-SPN)10740000
109100                                   > ZERO                         10750000
109200                 MOVE 'C'         TO SA007-TYP-CDE                10760000
109210                 SET  GL002-MONETARY-AMT-DR                       10770000
109220                                  TO TRUE                         10780000
109300             ELSE                                                 10790000
109400                 MOVE 'P'         TO SA007-TYP-CDE                10800000
109410                 SET  GL002-MONETARY-AMT-CR                       10810000
109420                                  TO TRUE                         10820000
109500             END-IF                                               10830000
109600        MOVE PV-HOLD-DLY-SSE-AMT (PV-TBL-SUB , PV-BAL-DTE-SUB-SPN)10840000
109700                                  TO GL002-MONETARY-AMT           10850000
SPNFIX             PERFORM 8110-WRITE-GL-SPN-RECORD                     10860001
109900         END-IF                                                   10870000
110000     END-PERFORM.                                                 10880000
110100                                                                  10890000
110200*----------------------------------------------------------------*10900000
110300*    PROCESS THE TSAADSU (SUMMARY AMOUNTS) TABLE                 *10910000
110400*----------------------------------------------------------------*10920000
110500                                                                  10930000
110600 2400-PROCESS-TSAADSU-TABLE.                                      10940000
110700                                                                  10950000
110800     SET PS-NOT-END-OF-CURSOR TO TRUE.                            10960000
110900     PERFORM 2410-OPEN-TSAADSU-CURSOR.                            10970000
111000     PERFORM 2420-FETCH-TSAADSU-CURSOR.                           10980000
111100     PERFORM UNTIL PS-END-OF-CURSOR                               10990000
111200         PERFORM 2430-PROCESS-TSAADSU                             11000000
111300         PERFORM 2420-FETCH-TSAADSU-CURSOR                        11010000
111400     END-PERFORM.                                                 11020000
111500     PERFORM 2440-CLOSE-TSAADSU-CURSOR.                           11030000
111600     PERFORM 2450-CHECK-TSAADSU-STORES                            11040000
111700         VARYING PV-TBL-SUB FROM 1 BY 1                           11050000
111800           UNTIL  PV-TBL-SUB > 9999.                              11060000
111900                                                                  11070000
112000*----------------------------------------------------------------*11080000
112100*    OPEN THE TSAADSU CURSOR.                                    *11090000
112200*----------------------------------------------------------------*11100000
112300 2410-OPEN-TSAADSU-CURSOR.                                        11110000
112400                                                                  11120000
112500     EXEC SQL                                                     11130000
112600          OPEN TSAADSU-CSR                                        11140000
112700     END-EXEC.                                                    11150000
112800     EVALUATE TRUE                                                11160000
112900         WHEN SQLCODE = ZERO                                      11170000
113000             CONTINUE                                             11180000
113100         WHEN OTHER                                               11190000
113200             MOVE '2410-OPEN-TSAADSU-CURSOR'                      11200000
113300                              TO PV-PARAGRAPH-NAME                11210000
113400             MOVE 'OPEN CURSOR FOR TABLE TSAADSU'                 11220000
113500                              TO PV-DB2-FUNCTION                  11230000
113600             PERFORM 9990-DB2-ABEND                               11240000
113700     END-EVALUATE.                                                11250000
113800                                                                  11260000
113900*----------------------------------------------------------------*11270000
114000*   FETCH THE TSAADSU CURSOR.                                    *11280000
114100*----------------------------------------------------------------*11290000
114200 2420-FETCH-TSAADSU-CURSOR.                                       11300000
114300                                                                  11310000
114400     EXEC SQL                                                     11320000
114500         FETCH TSAADSU-CSR                                        11330000
114600         INTO  :SAADSU-STR-NBR,                                   11340000
114700               :SAADSU-SLS-DTE,                                   11350000
114800               :SAADSU-SUM-CTG-CDE,                               11360000
114900               :XST00001-E-BUS-IND,                               11370000
115000               :SAADSU-ADJ-AMT                                    11380000
115100     END-EXEC.                                                    11390000
115200     EVALUATE TRUE                                                11400000
115300         WHEN SQLCODE = ZERO                                      11410000
115400             CONTINUE                                             11420000
115500         WHEN SQLCODE = +100                                      11430000
115600             SET PS-END-OF-CURSOR TO TRUE                         11440000
115700         WHEN OTHER                                               11450000
115800             MOVE '2420-FETCH-TSAADSU-CURSOR'                     11460000
115900                              TO PV-PARAGRAPH-NAME                11470000
116000             MOVE 'FETCH CURSOR FOR TABLE TSAADSU'                11480000
116100                              TO PV-DB2-FUNCTION                  11490000
116200             PERFORM 9990-DB2-ABEND                               11500000
116300     END-EVALUATE.                                                11510000
116400                                                                  11520000
116500*----------------------------------------------------------------*11530000
116600*    CREATE THE OUTPUT RECORD FOR THE ROW.                       *11540000
116700*----------------------------------------------------------------*11550000
116800 2430-PROCESS-TSAADSU.                                            11560000
116900                                                                  11570000
117000     MOVE SAADSU-STR-NBR      TO PV-STORE-NUMBER                  11580000
117100                                 PV-STORE-BALANCE                 11590000
117200                                 PV-TBL-SUB.                      11600000
117300     MOVE SAADSU-SLS-DTE      TO PV-STORE-SLS-DTE.                11610000
117400                                                                  11620000
117500        INITIALIZE PV-BAL-DTE-SUB.                                11630000
117600        EVALUATE PV-STORE-SLS-DTE                                 11640000
117700           WHEN PV-DLY-BAL-DTE-1                                  11650000
117800                MOVE 1                TO PV-BAL-DTE-SUB           11660000
117900           WHEN PV-DLY-BAL-DTE-2                                  11670000
118000                MOVE 2                TO PV-BAL-DTE-SUB           11680000
118100           WHEN PV-DLY-BAL-DTE-3                                  11690000
118200                MOVE 3                TO PV-BAL-DTE-SUB           11700000
118300           WHEN PV-DLY-BAL-DTE-4                                  11710000
118400                MOVE 4                TO PV-BAL-DTE-SUB           11720000
118500           WHEN PV-DLY-BAL-DTE-5                                  11730000
118600                MOVE 5                TO PV-BAL-DTE-SUB           11740000
118700           WHEN PV-DLY-BAL-DTE-6                                  11750000
118800                MOVE 6                TO PV-BAL-DTE-SUB           11760000
118900           WHEN PV-DLY-BAL-DTE-7                                  11770000
119000                MOVE 7                TO PV-BAL-DTE-SUB           11780000
119100         END-EVALUATE                                             11790000
119200                                                                  11800000
119300     MOVE 'Y' TO PV-TSAADSU-FOUND-IND(PV-TBL-SUB , PV-BAL-DTE-SUB)11810000
119400                                                                  11820000
119500     MOVE PV-STORE-NUMBER-X   TO GL002-JRNL-LN-REF                11830000
119600                                 GL002-LOCATION                   11840000
119700                                 GL002-JRNL-LINE-DESC.            11850000
119800     MOVE SAADSU-SUM-CTG-CDE  TO GL002-EXPENSE-TYPE-CDE           11860000
119900                                 SA006-SUM-CTG-CDE.               11870000
120000     IF SA006-REGISTER-OVER-SHORT                                 11880000
120100       STRING PC-REGISTER-OVER-SHORT-MSG,                         11890000
120200              CC-WEEK-ENDING-CC, CC-WEEK-ENDING-YY,               11900000
120300              '-', CC-WEEK-ENDING-MM,                             11910000
120400              '-', CC-WEEK-ENDING-DD                              11920000
120500              DELIMITED BY SIZE INTO GL002-JRNL-LINE-DESC         11930000
120600       END-STRING                                                 11940000
120700     END-IF.                                                      11950000
120800     IF SA006-SAFE-OVER-SHORT                                     11960000
120900       STRING PC-SAFE-OVER-SHORT-MSG,                             11970000
121000              CC-WEEK-ENDING-CC, CC-WEEK-ENDING-YY,               11980000
121100              '-', CC-WEEK-ENDING-MM,                             11990000
121200              '-', CC-WEEK-ENDING-DD                              12000000
121300              DELIMITED BY SIZE INTO GL002-JRNL-LINE-DESC         12010000
121400       END-STRING                                                 12020000
121500     END-IF.                                                      12030000
121600                                                                  12040000
121700     IF SA006-DEBIT-CARDS                                         12050000
121800         MOVE PV-DEBIT-HOLD-AMT        TO GL002-MONETARY-AMT      12060000
121900         SET SA006-KOHLS-DEBIT-CARD    TO TRUE                    12070000
122000         MOVE SA006-SUM-CTG-CDE        to GL002-EXPENSE-TYPE-CDE  12080000
122100         SET GL002-MONETARY-AMT-DR TO TRUE                        12090000
122200         PERFORM 8100-WRITE-GL-RECORD                             12100000
122300         SET SA006-DEBIT-CARDS TO TRUE                            12110000
122400         MOVE SA006-SUM-CTG-CDE        to GL002-EXPENSE-TYPE-CDE  12120000
122500         COMPUTE SAADSU-ADJ-AMT = SAADSU-ADJ-AMT -                12130000
122600                                               PV-DEBIT-HOLD-AMT  12140000
122700     END-IF.                                                      12150000
122800                                                                  12160000
122900     MOVE SAADSU-ADJ-AMT      TO GL002-MONETARY-AMT.              12170000
123000                                                                  12180000
123100     EVALUATE TRUE                                                12190000
123200         WHEN SA006-KMRC-TENDERED                                 12200000
123300         WHEN SA006-PO-RECEIVABLE                                 12210000
123400         WHEN SA006-GIFT-CERT-TENDERED                            12220000
123500             SET GL002-MONETARY-AMT-DR   TO TRUE                  12230000
123600             PERFORM 8100-WRITE-GL-RECORD                         12240000
123700         WHEN SA006-TOTAL-MDSE-RETURNS                            12250000
123800             MOVE SAADSU-ADJ-AMT                                  12260000
123900                              TO PV-HOLD-GL-AMT                   12270000
124000             SUBTRACT PV-HOLD-DLY-TMR-AMT (PV-TBL-SUB ,           12280000
124100                                              PV-BAL-DTE-SUB)     12290000
124200                 FROM PV-HOLD-GL-AMT                              12300000
124300                                                                  12310000
124400*            IF SAADSU-STR-NBR = PC-WEBSTORE                      12320000
124500             IF XST00001-E-BUS-IND = 'Y'                          12330000
124600                ADD PV-HOLD-GL-AMT TO PV-TTL-TMR-ECOM-AMT         12340000
124700             END-IF                                               12350000
124800                                                                  12360000
124900             IF PV-HOLD-GL-AMT < 0                                12370000
125000                SET GL002-MONETARY-AMT-DR TO TRUE                 12380000
125100             ELSE                                                 12390000
125200                SET GL002-MONETARY-AMT-CR TO TRUE                 12400000
125300             END-IF                                               12410000
125400                                                                  12420000
125500             MOVE PV-HOLD-GL-AMT                                  12430000
125600                              TO GL002-MONETARY-AMT               12440000
125700             PERFORM 8100-WRITE-GL-RECORD                         12450000
125800         WHEN SA006-GIFT-CARD-TENDERED                            12460000
SEPHOR**           KKT AND SEPHORA GC TENDERS ARE SUBTRACTED FROM       12470000
SEPHOR**           THE KOHL'S GIFT CARDS TENDERED.                      12480000
115600             MOVE SAADSU-ADJ-AMT    TO PV-HOLD-GL-AMT             12490000
126100             SUBTRACT PV-HOLD-DLY-GDT-AMT (PV-TBL-SUB ,           12500000
126200                                              PV-BAL-DTE-SUB)     12510000
126300                 FROM PV-HOLD-GL-AMT                              12520000
115900             MOVE PV-HOLD-GL-AMT    TO GL002-MONETARY-AMT         12530000
126400             IF PV-HOLD-GL-AMT >= ZERO                            12540000
126500                 SET GL002-MONETARY-AMT-DR   TO TRUE              12550000
126600             ELSE                                                 12560000
126700                 SET GL002-MONETARY-AMT-CR   TO TRUE              12570000
126800             END-IF                                               12580000
127100             PERFORM 8100-WRITE-GL-RECORD                         12590000
127200         WHEN SA006-BANK-CHARGE                                   12600000
COBRND**           CVN (COBRAND VISA NET) IS SUBTRACTED FROM            12610000
COBRND**           BCN (BANK CHARGE NET).                               12620000
COBRND             MOVE SAADSU-ADJ-AMT    TO PV-HOLD-GL-AMT             12630000
COBRND             SUBTRACT PV-HOLD-DLY-BCN-AMT (PV-TBL-SUB ,           12640000
COBRND                                              PV-BAL-DTE-SUB)     12650000
COBRND                            FROM PV-HOLD-GL-AMT                   12660000
COBRND             MOVE PV-HOLD-GL-AMT    TO GL002-MONETARY-AMT         12670000
COBRND             IF PV-HOLD-GL-AMT >= ZERO                            12680000
COBRND                 SET GL002-MONETARY-AMT-DR   TO  TRUE             12690000
COBRND             ELSE                                                 12700000
COBRND                 SET GL002-MONETARY-AMT-CR   TO  TRUE             12701000
COBRND             END-IF                                               12702000
COBRND             PERFORM 8100-WRITE-GL-RECORD                         12703000
127300         WHEN SA006-NOVUS-CHARGE                                  12704000
127400         WHEN SA006-AMERICAN-EXPRESS                              12705000
127600         WHEN SA006-DEBIT-CARDS                                   12706000
127700         WHEN SA006-REGISTER-OVER-SHORT                           12707000
127800         WHEN SA006-SAFE-OVER-SHORT                               12708000
127900         WHEN SA006-CHANGE-IN-CASH-ON-HAND                        12709000
PAYVEN         WHEN SA006-PAYPAL                                        12710000
PAYVEN         WHEN SA006-VENMO                                         12720000
128000             IF SAADSU-ADJ-AMT >= ZERO                            12730000
128100                 SET GL002-MONETARY-AMT-DR                        12740000
128200                              TO TRUE                             12750000
128300             ELSE                                                 12760000
128400                 SET GL002-MONETARY-AMT-CR                        12770000
128500                              TO TRUE                             12780000
128600             END-IF                                               12790000
128700             PERFORM 8100-WRITE-GL-RECORD                         12800000
127500         WHEN SA006-KOHLS-CHARGE                                  12810000
COBTRL**           TTN (COBRAND TRAILING NET) IS SUBTRACTED FROM        12820000
COBTRL**           KCN (KOHLS CHARGE NET).                              12830000
COBTR2**           NEED TO DETERMINE IF THERE ARE COBRAND TRAILING      12840000
COBTR2**           TRANSACTIONS THAT WEREN'T PICKED UP IN THE TSASUM    12850000
COBTR2**           PARAGRAPH BECAUSE THE STORE HAD NO COBRAND SALES OR  12850100
COBTR2**           RETURNS (CVN) FOR THE WEEK.                          12850200
COBTR2**           THE CVN LOGIC WILL SET THE CVN INDICATOR TO 'Y'      12850300
COBTR2**           WHEN IT IS EXECUTED.                                 12850400
COBTR2**           IF CVN INDICATOR = 'N', CALL TO GET TRAILING TRANS.  12850500
COBTR2**           IF FOUND AND IT IS NOT ZERO, WRITE A CVN RECORD      12850600
COBTR2**           WITH THE TTN AMT AND ADD TTN AMT TO THE HOLD KCN AMT.12850700
COBTR2**           THEN CONTINUE TO WRITE THE KCN RECORD.               12850800
COBTR2**                                                                12850900
COBTR2             IF PV-HOLD-DLY-CVN-FOUND (PV-TBL-SUB ,               12851000
COBTR2                                       PV-BAL-DTE-SUB) NOT = 'Y'  12851100
COBTR2                 MOVE SAADSU-STR-NBR TO PV-TBL-STORE              12851200
COBTR2                 PERFORM 2547-GET-TTN-ADJUSTMENTS                 12851300
COBTR2                 IF PV-TTN-ADJUSTMENTS NOT = 0                    12851400
COBTR2                     MOVE 'CVN'      TO GL002-EXPENSE-TYPE-CDE    12851500
COBTR2                     ADD PV-TTN-ADJUSTMENTS  TO                   12851600
COBTR2                         PV-HOLD-DLY-KCN-AMT (PV-TBL-SUB ,        12851700
COBTR2                                              PV-BAL-DTE-SUB)     12851800
COBTR2                         PV-TTN-TOTAL                             12851900
COBTR2                     MOVE PV-TTN-ADJUSTMENTS TO GL002-MONETARY-AMT12852000
COBTR2                     IF PV-TTN-ADJUSTMENTS >= 0                   12852100
COBTR2                         SET GL002-MONETARY-AMT-DR  TO TRUE       12852200
COBTR2                     ELSE                                         12852300
COBTR2                         SET GL002-MONETARY-AMT-CR  TO TRUE       12852400
COBTR2                     END-IF                                       12852500
COBTR2                     PERFORM 8100-WRITE-GL-RECORD                 12852600
COBTR2**                   RESET ORIG EXPENSE TYPE CODE (KCN)           12852700
COBTR2                     MOVE SAADSU-SUM-CTG-CDE                      12852800
COBTR2                                     TO GL002-EXPENSE-TYPE-CDE    12852900
COBTR2                 END-IF                                           12853000
COBTR2             END-IF                                               12853100
COBTR2**           PROCESS KCN                                          12853200
COBTRL             MOVE SAADSU-ADJ-AMT    TO PV-HOLD-GL-AMT             12853300
COBTRL             SUBTRACT PV-HOLD-DLY-KCN-AMT (PV-TBL-SUB ,           12853400
COBTRL                                              PV-BAL-DTE-SUB)     12853500
COBTRL                 FROM PV-HOLD-GL-AMT                              12853600
COBTRL             MOVE PV-HOLD-GL-AMT    TO GL002-MONETARY-AMT         12853700
COBTRL             IF PV-HOLD-GL-AMT >= ZERO                            12853800
COBTRL                 SET GL002-MONETARY-AMT-DR   TO  TRUE             12853900
COBTRL             ELSE                                                 12854000
COBTRL                 SET GL002-MONETARY-AMT-CR   TO  TRUE             12854100
COBTRL             END-IF                                               12854200
COBTRL             PERFORM 8100-WRITE-GL-RECORD                         12854300
129400         WHEN SA006-KOHLS-PAYMENTS                                12854400
COBTRL**           CVP (COBRAND VISA PAYMENTS) AND TTP (COBRAND         12854500
COBTRL**           TRAILING PAYMENTS) ARE SUBTRACTED FROM               12854600
COBRND**           KCP (KOHLS CHARGE PAYMENTS).                         12854700
COBTR2**           NEED TO DETERMINE IF THERE ARE COBRAND TRAILING      12854800
COBTR2**           TRANSACTIONS THAT WEREN'T PICKED UP IN THE TSASUM    12854900
COBTR2**           PARAGRAPH BECAUSE THE STORE HAD NO COBRAND PAYMENTS  12855000
COBTR2**           (CVP) FOR THE WEEK.                                  12855100
COBTR2**           THE CVP LOGIC WILL SET THE CVP INDICATOR TO 'Y'      12855200
COBTR2**           WHEN IT IS EXECUTED.                                 12855300
COBTR2**           IF CVP INDICATOR = 'N', CALL TO GET TRAILING TRANS.  12855400
COBTR2**           IF FOUND AND IT IS NOT ZERO, WRITE A CVP RECORD      12855500
COBTR2**           WITH THE TTP AMT AND ADD TTP AMT TO THE HOLD KCP AMT.12855600
COBTR2**           THEN CONTINUE TO WRITE THE KCP RECORD.               12855700
COBTR2**                                                                12855800
COBTR2             IF PV-HOLD-DLY-CVP-FOUND (PV-TBL-SUB ,               12855900
COBTR2                                       PV-BAL-DTE-SUB) NOT = 'Y'  12856000
COBTR2                 MOVE SAADSU-STR-NBR TO PV-TBL-STORE              12856100
COBTR2                 PERFORM 2546-GET-TTP-ADJUSTMENTS                 12856200
COBTR2                 IF PV-TTP-ADJUSTMENTS NOT = 0                    12856300
COBTR2                     MOVE 'CVP'      TO GL002-EXPENSE-TYPE-CDE    12856400
COBTR2                     ADD PV-TTP-ADJUSTMENTS  TO                   12856500
COBTR2                         PV-HOLD-DLY-KCP-AMT (PV-TBL-SUB ,        12856600
COBTR2                                              PV-BAL-DTE-SUB)     12856700
COBTR2                         PV-TTP-TOTAL                             12856800
COBTR2                     MOVE PV-TTP-ADJUSTMENTS TO GL002-MONETARY-AMT12856900
COBTR2                     IF PV-TTP-ADJUSTMENTS >= 0                   12857000
COBTR2                         SET GL002-MONETARY-AMT-CR  TO TRUE       12858000
COBTR2                     ELSE                                         12858100
COBTR2                         SET GL002-MONETARY-AMT-DR  TO TRUE       12858200
COBTR2                     END-IF                                       12858300
COBTR2                     PERFORM 8100-WRITE-GL-RECORD                 12858400
COBTR2**                   RESET ORIG EXPENSE TYPE CODE (KCP)           12858500
COBTR2                     MOVE SAADSU-SUM-CTG-CDE                      12858600
COBTR2                                     TO GL002-EXPENSE-TYPE-CDE    12858700
COBTR2                 END-IF                                           12858800
COBTR2             END-IF                                               12858900
COBTR2**           PROCESS KCP                                          12859000
COBRND             MOVE SAADSU-ADJ-AMT    TO PV-HOLD-GL-AMT             12859100
COBRND             SUBTRACT PV-HOLD-DLY-KCP-AMT (PV-TBL-SUB ,           12859200
COBRND                                              PV-BAL-DTE-SUB)     12859300
COBRND                            FROM PV-HOLD-GL-AMT                   12859400
COBRND             MOVE PV-HOLD-GL-AMT    TO GL002-MONETARY-AMT         12859500
COBRND             IF PV-HOLD-GL-AMT >= ZERO                            12859600
COBRND                 SET GL002-MONETARY-AMT-CR   TO  TRUE             12859700
COBRND             ELSE                                                 12859800
COBRND                 SET GL002-MONETARY-AMT-DR   TO  TRUE             12859900
COBRND             END-IF                                               12860000
COBRND             PERFORM 8100-WRITE-GL-RECORD                         12860100
128800         WHEN SA006-CORPORATE-REFUNDS-ISSUED                      12860200
128900** CORP REFNDS ISSUED CAN NOT DO > 0 CHECK ; CAUSES BAL ISSUE     12860300
129000         WHEN SA006-KMRC-ISSUED                                   12860400
129100** KRMC ISSUED CAN NOT DO > 0 CHECK ; CAUSES BAL ISSUE            12860500
129200         WHEN SA006-PO-RETURNS                                    12860600
129300** PO RETURNS CAN NOT DO > 0 CHECK ; CAUSES BAL ISSUE             12860700
129600         WHEN SA006-NSF-PAYMENTS                                  12860800
129700** CORP REFNDS ISSUED CAN NOT DO > 0 CHECK ; CAUSES BAL ISSUE     12860900
129800             SET GL002-MONETARY-AMT-CR                            12861000
129900                              TO TRUE                             12862000
130000             PERFORM 8100-WRITE-GL-RECORD                         12863000
130100         WHEN SA006-CURRENCY-DELIVERY                             12864000
130200             IF SAADSU-ADJ-AMT >= ZERO                            12865000
130300                 SET GL002-MONETARY-AMT-CR   TO TRUE              12866000
130400             ELSE                                                 12867000
130500                 SET GL002-MONETARY-AMT-DR   TO TRUE              12868000
130600             END-IF                                               12869000
130700             PERFORM 8100-WRITE-GL-RECORD                         12870000
130800         WHEN SA006-STATE-TAXABLE-MDSE                            12880000
130900             MOVE SAADSU-ADJ-AMT                                  12890000
131000                              TO PV-HOLD-GL-AMT                   12900000
131100             SUBTRACT PV-HOLD-DLY-STM-AMT (PV-TBL-SUB ,           12910000
131200                                              PV-BAL-DTE-SUB)     12920000
131300                            FROM PV-HOLD-GL-AMT                   12930000
131400             MOVE PV-HOLD-GL-AMT                                  12940000
131500                              TO GL002-MONETARY-AMT               12950000
131600             IF PV-HOLD-GL-AMT >= ZERO                            12960000
131700                 SET GL002-MONETARY-AMT-CR                        12970000
131800                              TO TRUE                             12980000
131900             ELSE                                                 12990000
132000                 SET GL002-MONETARY-AMT-DR                        13000000
132100                              TO TRUE                             13010000
132200             END-IF                                               13020000
132300             PERFORM 8100-WRITE-GL-RECORD                         13030000
132400         WHEN SA006-STATE-TAX                                     13040000
132500         WHEN SA006-GIFT-CERT-SALES                               13050000
132600         WHEN SA006-GIFT-CARD-SALES                               13060000
132700             IF SAADSU-ADJ-AMT >= ZERO                            13070000
132800                 SET GL002-MONETARY-AMT-CR                        13080000
132900                              TO TRUE                             13090000
133000             ELSE                                                 13100000
133100                 SET GL002-MONETARY-AMT-DR                        13110000
133200                              TO TRUE                             13120000
133300             END-IF                                               13130000
133400             PERFORM 8100-WRITE-GL-RECORD                         13140000
133500         WHEN SA006-THIRD-PARTY-CARD-SALES                        13150000
TPCFIX             MOVE SAADSU-ADJ-AMT    TO PV-HOLD-GL-AMT             13160000
133600             PERFORM 2435-GET-COMMISSIONS                         13170000
TPCFIX             SUBTRACT PV-COMMISSIONS-AMT FROM PV-HOLD-GL-AMT      13180000
TPCFIX**           POC AND THE SALES HUB ADD SEPHORA GIFT CARDS INTO    13190000
TPCFIX**           THE TPC BUCKETS AND THEY NEED TO BE SUBTRACTED       13200000
TPCFIX**           OUT BEFORE GOING TO GL.                              13210000
TPCFIX             SUBTRACT PV-HOLD-DLY-TPC-AMT (PV-TBL-SUB,            13220000
TPCFIX                                           PV-BAL-DTE-SUB)        13230000
TPCFIX                 FROM PV-HOLD-GL-AMT                              13240000
TPCFIX             MOVE PV-HOLD-GL-AMT    TO GL002-MONETARY-AMT         13250000
TPCFIX             IF PV-HOLD-GL-AMT >= ZERO                            13260000
133900                 SET GL002-MONETARY-AMT-CR TO TRUE                13270000
134000             ELSE                                                 13280000
134100                 SET GL002-MONETARY-AMT-DR TO TRUE                13290000
134200             END-IF                                               13300000
134300             PERFORM 8100-WRITE-GL-RECORD                         13310000
134400                                                                  13320000
134500***          SEND THIRD PARTY CARD COMMISSIONS TO GL              13330000
134600             MOVE 'TCC' TO GL002-EXPENSE-TYPE-CDE                 13340000
134700             MOVE PV-COMMISSIONS-AMT TO GL002-MONETARY-AMT        13350000
134800             SET GL002-MONETARY-AMT-CR TO TRUE                    13360000
134900             PERFORM 8100-WRITE-GL-RECORD                         13370000
136500         WHEN OTHER                                               13380000
136600             CONTINUE                                             13390000
136700     END-EVALUATE.                                                13400000
136800                                                                  13410000
136900*----------------------------------------------------------------*13420000
137000*    COMMISSIONS NEED TO BE SUBTRACTED FROM SALES BEFORE THEY ARE 13430000
137100*    PASSED ON TO GL. THESE COMMISSIONS WOULD BE FROM KOHLS       13440000
137200*    SELLING 3RD PARTY GIFT CARDS.                                13450000
137300*----------------------------------------------------------------*13460000
137400 2435-GET-COMMISSIONS.                                            13470000
137500                                                                  13480000
137600     EXEC SQL                                                     13490000
137700         SELECT SUM (CTG_AMT)                                     13500000
137800         INTO  :PV-COMMISSIONS-AMT :PV-SUM-TPC-NULL-IND           13510000
137900         FROM   TSASUM   SUM                                      13520000
138000               ,TEPPART  PRT                                      13530000
138100         WHERE PRT.SLS_DTE =   :SAADSU-SLS-DTE                    13540000
138200           AND SUM.PARTN_NBR =  PRT.PARTN_NBR                     13550000
138300           AND STR_NBR       = :SAADSU-STR-NBR                    13560000
138400           AND STR_GP_CDE    = :PC-STORE-GROUP-CODE               13570000
ZX               AND SUM_TYP_CDE   IN ('D','S')                         13580000
138600           AND SUM_CTG_CDE   = 'TCC'                              13590000
138700           AND RGST_ID       = 0                                  13600000
138800     END-EXEC.                                                    13610000
138900                                                                  13620000
139000     EVALUATE TRUE                                                13630000
139100         WHEN SQLCODE = ZERO                                      13640000
139200             IF PV-SUM-TPC-NULL-IND = -1                          13650000
139300                 MOVE ZEROES             TO PV-COMMISSIONS-AMT    13660000
139400             END-IF                                               13670000
139500         WHEN SQLCODE = +100                                      13680000
139600             MOVE ZEROES                 TO PV-COMMISSIONS-AMT    13690000
139700         WHEN OTHER                                               13700000
139800             MOVE '2435-GET-COMMISSIONS' TO PV-PARAGRAPH-NAME     13710000
139900             MOVE 'SELECT FROM TSASUM'   TO PV-DB2-FUNCTION       13720000
140000             DISPLAY 'SAADSU-STR-NBR ' SAADSU-STR-NBR             13730000
140100             DISPLAY 'PC-STORE-GROUP-CODE ' PC-STORE-GROUP-CODE   13740000
140200             PERFORM 9990-DB2-ABEND                               13750000
140300     END-EVALUATE.                                                13760000
140400                                                                  13770000
140500*----------------------------------------------------------------*13780000
140600*   CLOSE THE TSAADSU CURSOR.                                    *13790000
140700*----------------------------------------------------------------*13800000
140800 2440-CLOSE-TSAADSU-CURSOR.                                       13810000
140900     EXEC SQL                                                     13820000
141000          CLOSE TSAADSU-CSR                                       13830000
141100     END-EXEC.                                                    13840000
141200     EVALUATE TRUE                                                13850000
141300         WHEN SQLCODE = ZERO                                      13860000
141400             CONTINUE                                             13870000
141500         WHEN OTHER                                               13880000
141600             MOVE '2440-CLOSE-TSAADSU-CURSOR'                     13890000
141700                              TO PV-PARAGRAPH-NAME                13900000
141800             MOVE 'CLOSE CURSOR FOR TABLE TSAADSU'                13910000
141900                              TO PV-DB2-FUNCTION                  13920000
142000             PERFORM 9990-DB2-ABEND                               13930000
142100     END-EVALUATE.                                                13940000
142200                                                                  13950000
142300*----------------------------------------------------------------*13960000
142400*    CHECK THE TSAADSU STORE FOUND INDICATORS                     13970000
142500*    NEEDED TO ALERT SALES AUDIT TO RE-SEND A STORE IF NOT FOUND  13980000
142600*----------------------------------------------------------------*13990000
142700 2450-CHECK-TSAADSU-STORES.                                       14000000
142800                                                                  14010000
142900     PERFORM VARYING PV-BAL-DTE-SUB-TSAADSU FROM 1 BY 1           14020000
143000               UNTIL PV-BAL-DTE-SUB-TSAADSU > 7                   14030000
143100                                                                  14040000
143200*    MOVE 'Y' TO PV-TSAADSU-FOUND-IND(PV-TBL-SUB ,                14050000
143300*                                     PV-BAL-DTE-SUB-TSAADSU)     14060000
143400                                                                  14070000
143500     IF PV-DLY-STORE-DEBITS  (PV-TBL-SUB , PV-BAL-DTE-SUB-TSAADSU)14080000
143600                              NOT EQUAL ZERO AND                  14090000
143700        PV-DLY-STORE-CREDITS (PV-TBL-SUB , PV-BAL-DTE-SUB-TSAADSU)14100000
143800                              NOT EQUAL ZERO AND                  14110000
143900        PV-TSAADSU-FOUND-IND (PV-TBL-SUB , PV-BAL-DTE-SUB-TSAADSU)14120000
144000                              NOT EQUAL 'Y'                       14130000
144100        EVALUATE PV-BAL-DTE-SUB-TSAADSU                           14140000
144200           WHEN 1                                                 14150000
144300                MOVE PV-DLY-BAL-DTE-1 TO EM-LINE9-SLS-DTE         14160000
144400           WHEN 2                                                 14170000
144500                MOVE PV-DLY-BAL-DTE-2 TO EM-LINE9-SLS-DTE         14180000
144600           WHEN 3                                                 14190000
144700                MOVE PV-DLY-BAL-DTE-3 TO EM-LINE9-SLS-DTE         14200000
144800           WHEN 4                                                 14210000
144900                MOVE PV-DLY-BAL-DTE-4 TO EM-LINE9-SLS-DTE         14220000
145000           WHEN 5                                                 14230000
145100                MOVE PV-DLY-BAL-DTE-5 TO EM-LINE9-SLS-DTE         14240000
145200           WHEN 6                                                 14250000
145300                MOVE PV-DLY-BAL-DTE-6 TO EM-LINE9-SLS-DTE         14260000
145400           WHEN 7                                                 14270000
145500                MOVE PV-DLY-BAL-DTE-7 TO EM-LINE9-SLS-DTE         14280000
145600        END-EVALUATE                                              14290000
145700        MOVE PV-TBL-SUB    TO EM-LINE9-STORE                      14300000
145800        WRITE EMAIL-RECORD FROM EM-EMAIL-BLANK-LINE               14310000
145900        WRITE EMAIL-RECORD FROM EM-EMAIL-LINE9                    14320000
146000     END-IF                                                       14330000
146100     END-PERFORM.                                                 14340000
146200*----------------------------------------------------------------*14350000
146300*  RETRIEVE DATA FROM THE TSASUM TABLE.                          *14360000
146400*----------------------------------------------------------------*14370000
146500                                                                  14380000
146600 2500-PROCESS-TSASUM-TABLE.                                       14390000
146700                                                                  14400000
146800     SET PS-NOT-END-OF-CURSOR TO TRUE.                            14410000
146900     PERFORM 2520-OPEN-TSASUM-CURSOR.                             14420000
147000     PERFORM 2530-FETCH-TSASUM-CURSOR.                            14430000
147100     PERFORM UNTIL PS-END-OF-CURSOR                               14440000
147200         PERFORM 2540-PROCESS-TSASUM                              14450000
147300         PERFORM 2530-FETCH-TSASUM-CURSOR                         14460000
147400     END-PERFORM.                                                 14470000
147500     PERFORM 2550-CLOSE-TSASUM-CURSOR.                            14480000
147600**  5/8/2002  ADDITIONAL ZEROROW-CSR ADDED TO PICK UP ZERO        14490000
147700**  REGISTER ROWS FOR CATEGORIES THAT DO NOT HAVE NON-ZERO        14500000
147800**  REGISTER ROWS.                                                14510000
147900     SET PS-NOT-END-OF-CURSOR TO TRUE.                            14520000
148000     PERFORM 2560-OPEN-ZEROROW-CURSOR.                            14530000
148100     PERFORM 2570-FETCH-ZEROROW-CURSOR.                           14540000
148200     PERFORM UNTIL PS-END-OF-CURSOR                               14550000
148300         PERFORM 2540-PROCESS-TSASUM                              14560000
148400         PERFORM 2570-FETCH-ZEROROW-CURSOR                        14570000
148500     END-PERFORM                                                  14580000
148600     PERFORM 2580-CLOSE-ZEROROW-CURSOR.                           14590000
148700                                                                  14600000
148800*----------------------------------------------------------------*14610000
148900*    OPEN THE TSASUM CURSOR.                                     *14620000
149000*----------------------------------------------------------------*14630000
149100 2520-OPEN-TSASUM-CURSOR.                                         14640000
149200                                                                  14650000
149300     EXEC SQL                                                     14660000
149400          OPEN TSASUM-CSR                                         14670000
149500     END-EXEC.                                                    14680000
149600     EVALUATE TRUE                                                14690000
149700         WHEN SQLCODE = ZERO                                      14700000
149800             CONTINUE                                             14710000
149900         WHEN OTHER                                               14720000
150000             MOVE '2520-OPEN-TSASUM-CURSOR'                       14730000
150100                              TO PV-PARAGRAPH-NAME                14740000
150200             MOVE 'OPEN CURSOR FOR TABLE TSASUM'                  14750000
150300                              TO PV-DB2-FUNCTION                  14760000
150400             PERFORM 9990-DB2-ABEND                               14770000
150500     END-EVALUATE.                                                14780000
150600                                                                  14790000
150700*----------------------------------------------------------------*14800000
150800*   FETCH THE TSASUM CURSOR.                                     *14810000
150900*----------------------------------------------------------------*14820000
151000 2530-FETCH-TSASUM-CURSOR.                                        14830000
151100                                                                  14840000
151200     EXEC SQL                                                     14850000
151300         FETCH TSASUM-CSR                                         14860000
151400         INTO  :SASUM-STR-NBR,                                    14870000
151500               :EPPART-SLS-DTE,                                   14880000
151600               :SASUM-SUM-CTG-CDE,                                14890000
151700               :PV-SUM-CTG-AMT                                    14900000
151800     END-EXEC.                                                    14910000
151900     EVALUATE TRUE                                                14920000
152000         WHEN SQLCODE = ZERO                                      14930000
152100             MOVE SASUM-SUM-CTG-CDE  TO PC-SUM-CTG-CDE            14940000
152200         WHEN SQLCODE = +100                                      14950000
152300             SET PS-END-OF-CURSOR TO TRUE                         14960000
152400         WHEN OTHER                                               14970000
152500             MOVE '2530-FETCH-TSASUM-CURSOR'                      14980000
152600                              TO PV-PARAGRAPH-NAME                14990000
152700             MOVE 'FETCH CURSOR FOR TABLE TSASUM'                 15000000
152800                              TO PV-DB2-FUNCTION                  15010000
152900             PERFORM 9990-DB2-ABEND                               15020000
153000     END-EVALUATE.                                                15030000
153100                                                                  15040000
153200*----------------------------------------------------------------*15050000
153300*    CREATE TWO OUTPUT RECORDS FOR THE ROW, ONE DEBIT AND ONE    *15060000
153400*    CREDIT.                                                     *15070000
153500*----------------------------------------------------------------*15080000
153600 2540-PROCESS-TSASUM.                                             15090000
153700                                                                  15100000
153800     MOVE SASUM-STR-NBR       TO PV-STORE-NUMBER                  15110000
153900                                 PV-STORE-BALANCE                 15120000
154000                                 PV-TBL-SUB.                      15130000
154100     MOVE EPPART-SLS-DTE      TO PV-STORE-SLS-DTE.                15140000
154200                                                                  15150000
154300        INITIALIZE PV-BAL-DTE-SUB.                                15160000
154400        EVALUATE PV-STORE-SLS-DTE                                 15170000
154500           WHEN PV-DLY-BAL-DTE-1                                  15180000
154600                MOVE 1                TO PV-BAL-DTE-SUB           15190000
154700           WHEN PV-DLY-BAL-DTE-2                                  15200000
154800                MOVE 2                TO PV-BAL-DTE-SUB           15210000
154900           WHEN PV-DLY-BAL-DTE-3                                  15220000
155000                MOVE 3                TO PV-BAL-DTE-SUB           15230000
155100           WHEN PV-DLY-BAL-DTE-4                                  15240000
155200                MOVE 4                TO PV-BAL-DTE-SUB           15250000
155300           WHEN PV-DLY-BAL-DTE-5                                  15260000
155400                MOVE 5                TO PV-BAL-DTE-SUB           15270000
155500           WHEN PV-DLY-BAL-DTE-6                                  15280000
155600                MOVE 6                TO PV-BAL-DTE-SUB           15290000
155700           WHEN PV-DLY-BAL-DTE-7                                  15300000
155800                MOVE 7                TO PV-BAL-DTE-SUB           15310000
155900         END-EVALUATE                                             15320000
156000                                                                  15330000
156100     MOVE PV-STORE-NUMBER-X   TO GL002-JRNL-LN-REF                15340000
156200                                 GL002-LOCATION                   15350000
156300                                 GL002-JRNL-LINE-DESC.            15360000
156400     MOVE PV-SUM-CTG-AMT      TO GL002-MONETARY-AMT.              15370000
156500                                                                  15380000
156600     EVALUATE TRUE                                                15390000
156700**  FEES WILL BE SENT THROUGH AS A CREDIT IF THE AMOUNT IS        15400000
156800**  POSITIVE (WITH AN OFFSETTING DEBIT TO STM); OR A DEBIT IF THE 15410000
156900**  AMOUNT IS NEGATIVE (WITH AN OFFSETTING CREDIT TO TMR)         15420000
157000**  NEED TO RESET GL002-MONETARY-AMT AFTER FEE ADJUSTMENTS ARE    15430000
157100**  SUBTRACTED FROM FEES.                                         15440000
157200         WHEN PC-SUM-CTG-CDE-FEE                                  15450000
157300             PERFORM 2545-GET-FEE-ADJUSTMENTS                     15460000
157400             SUBTRACT PV-FEE-ADJUSTMENTS FROM PV-SUM-CTG-AMT      15470000
157500             MOVE PV-SUM-CTG-AMT           TO GL002-MONETARY-AMT  15480000
157600             IF PV-SUM-CTG-AMT < 0                                15490000
157700                 ADD PV-SUM-CTG-AMT                               15500000
157800                         TO PV-HOLD-DLY-TMR-AMT (PV-TBL-SUB ,     15510000
157900                                                 PV-BAL-DTE-SUB)  15520000
158000                 SET GL002-MONETARY-AMT-DR TO TRUE                15530000
158100             ELSE                                                 15540000
158200                 ADD PV-SUM-CTG-AMT                               15550000
158300                         TO PV-HOLD-DLY-STM-AMT (PV-TBL-SUB ,     15560000
158400                                                 PV-BAL-DTE-SUB)  15570000
158500                 SET GL002-MONETARY-AMT-CR TO TRUE                15580000
158600             END-IF                                               15590000
158700             MOVE PC-SUM-CTG-CDE                                  15600000
158800                              TO GL002-EXPENSE-TYPE-CDE           15610000
158900             PERFORM 8100-WRITE-GL-RECORD                         15620000
159000**  SHIPPING SALES WILL BE SENT THROUGH AS A CREDIT; AN           15630000
159100**  OFFSETTING DEBIT WILL BE TO THE STM (STATE TAXABLE            15640000
159200**  MERCHANDISE) ACCOUNT                                          15650000
159300         WHEN PC-SUM-CTG-CDE-SHS                                  15660000
159400             ADD PV-SUM-CTG-AMT                                   15670000
159500                         TO PV-HOLD-DLY-STM-AMT (PV-TBL-SUB ,     15680000
159600                                                 PV-BAL-DTE-SUB)  15690000
159700             MOVE PC-SUM-CTG-CDE                                  15700000
159800                              TO GL002-EXPENSE-TYPE-CDE           15710000
159900             IF PV-SUM-CTG-AMT >= ZERO                            15720000
160000                 SET GL002-MONETARY-AMT-CR   TO TRUE              15730000
160100             ELSE                                                 15740000
160200                 SET GL002-MONETARY-AMT-DR   TO TRUE              15750000
160300             END-IF                                               15760000
160400             PERFORM 8100-WRITE-GL-RECORD                         15770000
160500**  SHIPPING RETURNS WILL BE SENT THROUGH AS A DEBIT; AN          15780000
160600**  OFSETTING CREDIT WILL BE TO THE TMR (TOTAL MERCHANDISE        15790000
160700**  RETURNS) ACCOUNT                                              15800000
160800         WHEN PC-SUM-CTG-CDE-SHR                                  15810000
160900             ADD PV-SUM-CTG-AMT                                   15820000
161000                      TO PV-HOLD-DLY-TMR-AMT (PV-TBL-SUB ,        15830000
161100                                              PV-BAL-DTE-SUB)     15840000
161200             MOVE PC-SUM-CTG-CDE                                  15850000
161300                              TO GL002-EXPENSE-TYPE-CDE           15860000
161400**  CAN NOT ADD > 0 LOGIC HERE ; CAUSES BAL ISSUES                15870000
161500             SET GL002-MONETARY-AMT-DR                            15880000
161600                              TO TRUE                             15890000
161700             PERFORM 8100-WRITE-GL-RECORD                         15900000
164200                                                                  15910000
164300**  GIFT WRAPPING SALES WILL BE SENT THROUGH AS A CREDIT; AN      15920000
164400**  OFFSETTING DEBIT WILL BE TO THE STM (STATE TAXABLE            15930000
164500**  MERCHANDISE) ACCOUNT                                          15940000
164600         WHEN PC-SUM-CTG-CDE-GWS                                  15950000
164700             ADD PV-SUM-CTG-AMT                                   15960000
164800                         TO PV-HOLD-DLY-STM-AMT (PV-TBL-SUB ,     15970000
164900                                                 PV-BAL-DTE-SUB)  15980000
165000             MOVE PC-SUM-CTG-CDE                                  15990000
165100                              TO GL002-EXPENSE-TYPE-CDE           16000000
165200             IF PV-SUM-CTG-AMT >= ZERO                            16010000
165300                 SET GL002-MONETARY-AMT-CR   TO TRUE              16020000
165400             ELSE                                                 16030000
165500                 SET GL002-MONETARY-AMT-DR   TO TRUE              16040000
165600             END-IF                                               16050000
165700             PERFORM 8100-WRITE-GL-RECORD                         16060000
165800**  GIFT WRAPPING RETURNS WILL BE SENT THROUGH AS A DEBIT; AN     16070000
165900**  OFFSETTING CREDIT WILL BE TO THE TMR (TOTAL MERCHANDISE       16080000
166000**  RETURNS) ACCOUNT                                              16090000
166100         WHEN PC-SUM-CTG-CDE-GWR                                  16100000
166200             ADD PV-SUM-CTG-AMT                                   16110000
166300                       TO PV-HOLD-DLY-TMR-AMT (PV-TBL-SUB ,       16120000
166400                                               PV-BAL-DTE-SUB)    16130000
166500             MOVE PC-SUM-CTG-CDE                                  16140000
166600                              TO GL002-EXPENSE-TYPE-CDE           16150000
166700** CAN'T USE > 0, CAUSES BAL ISSUE FOR SOME WEEKS WHEN FOUND      16160000
166800             SET GL002-MONETARY-AMT-DR                            16170000
166900                              TO TRUE                             16180000
167000             PERFORM 8100-WRITE-GL-RECORD                         16190000
167100**  E-COMMERCE RETURNS WILL BE SENT THROUGH AS A DEBIT; AN        16200000
167200**  OFFSETTING CREDIT WILL BE TO THE TMR (TOTAL MERCHANDISE       16210000
167300**  RETURNS) ACCOUNT                                              16220000
167400         WHEN PC-SUM-CTG-CDE-ECR                                  16230000
167500             ADD PV-SUM-CTG-AMT                                   16240000
167600                      TO PV-HOLD-DLY-TMR-AMT (PV-TBL-SUB ,        16250000
167700                                              PV-BAL-DTE-SUB)     16260000
167800             MOVE PC-SUM-CTG-CDE                                  16270000
167900                              TO GL002-EXPENSE-TYPE-CDE           16280000
168000** DOES NOT WORK WITH > 0 LOGIC ; CAUSES BAL ISSUES               16290000
168100             SET GL002-MONETARY-AMT-DR                            16300000
168200                              TO TRUE                             16310000
168300             PERFORM 8100-WRITE-GL-RECORD                         16320000
168400**  NON-MERCHANDISE AND POSTAGE SALES, AND MANIFESTO TAX RETURNS  16330000
168500**  WILL BE SENT THROUGH AS A CREDIT IF THE AMOUNT IS POSITIVE    16340000
168600**  (WITH AN OFFSETTING DEBIT TO STM); OR A DEBIT IF THE AMOUNT   16350000
168700**  IS POSITIVE (WITH AN OFFSETTING CREDIT TO TMR)                16360000
168800         WHEN PC-SUM-CTG-CDE-KKB                                  16370000
168900         WHEN PC-SUM-CTG-CDE-BRC                                  16380000
169000         WHEN PC-SUM-CTG-CDE-KKH                                  16390000
169100         WHEN PC-SUM-CTG-CDE-KKU                                  16400000
169200         WHEN PC-SUM-CTG-CDE-KKS                                  16410000
169300         WHEN PC-SUM-CTG-CDE-PTG                                  16420000
169400         WHEN PC-SUM-CTG-CDE-MAN                                  16430000
169500         WHEN PC-SUM-CTG-CDE-SFS                                  16440000
169600         WHEN PC-SUM-CTG-CDE-BPS                                  16450000
BOSS           WHEN PC-SUM-CTG-CDE-BPR                                  16460000
BOSS           WHEN PC-SUM-CTG-CDE-BOS                                  16470000
BOSS           WHEN PC-SUM-CTG-CDE-BSR                                  16480000
MKTPL2         WHEN PC-SUM-CTG-CDE-MSS                                  16490000
MKTPL2         WHEN PC-SUM-CTG-CDE-MSR                                  16500000
MKTPL2         WHEN PC-SUM-CTG-CDE-MCS                                  16510000
MKTPL2         WHEN PC-SUM-CTG-CDE-MCR                                  16520000
MKTPL2**       WHEN PC-SUM-CTG-CDE-MMS                                  16530000
MKTPL2**       WHEN PC-SUM-CTG-CDE-MMR                                  16540000
169700             IF PV-SUM-CTG-AMT < 0                                16550000
169800                ADD PV-SUM-CTG-AMT                                16560000
169900                        TO PV-HOLD-DLY-TMR-AMT (PV-TBL-SUB ,      16570000
170000                                                PV-BAL-DTE-SUB)   16580000
170100                SET GL002-MONETARY-AMT-DR                         16590000
170200                              TO TRUE                             16600000
170300             ELSE                                                 16610000
170400                ADD PV-SUM-CTG-AMT                                16620000
170500                        TO PV-HOLD-DLY-STM-AMT (PV-TBL-SUB ,      16630000
170600                                                PV-BAL-DTE-SUB)   16640000
170700                SET GL002-MONETARY-AMT-CR                         16650000
170800                              TO TRUE                             16660000
170900             END-IF                                               16670000
171000             MOVE PC-SUM-CTG-CDE                                  16680000
171100                              TO GL002-EXPENSE-TYPE-CDE           16690000
171200             PERFORM 8100-WRITE-GL-RECORD                         16700000
MKTPL2**************************************************************    16710000
MKTPL2***  7/19/22 - It was decided that for now the Sales Hub will     16720000
MKTPL2***            include the Marketplace dollars in the Sales       16730000
MKTPL2***            and Returns categories, so this code may be        16740000
MKTPL2***            needed in the future, but not now!!!!              16750000
MKTPL2**************************************************************    16760000
MKTPL2**       WHEN PC-SUM-CTG-CDE-MSS                                  16770000
MKTPL2**       WHEN PC-SUM-CTG-CDE-MSR                                  16780000
MKTPL2**       WHEN PC-SUM-CTG-CDE-MCS                                  16790000
MKTPL2**       WHEN PC-SUM-CTG-CDE-MCR                                  16800000
MKTPL2***  The Sales Hub will not include marketplace categories        16810000
MKTPL2***  in the Sales (SAL/STM) and Returns (RET/TMR) buckets so      16820000
MKTPL2***  they should not be subtracted from them here.                16830000
MKTPL2**           IF PV-SUM-CTG-AMT < 0                                16840000
MKTPL2**              SET GL002-MONETARY-AMT-DR   TO TRUE               16850000
MKTPL2**           ELSE                                                 16860000
MKTPL2**              SET GL002-MONETARY-AMT-CR   TO TRUE               16870000
MKTPL2**           END-IF                                               16880000
MKTPL2**           MOVE PC-SUM-CTG-CDE                                  16890000
MKTPL2**                            TO GL002-EXPENSE-TYPE-CDE           16900000
MKTPL2**           PERFORM 8100-WRITE-GL-RECORD                         16910000
12386a         WHEN PC-SUM-CTG-CDE-DON                                  16920000
12386a             ADD PV-SUM-CTG-AMT                                   16930000
12386a                     TO PV-HOLD-DLY-STM-AMT (PV-TBL-SUB ,         16940000
12386a                                             PV-BAL-DTE-SUB)      16950000
12386a             MOVE PC-SUM-CTG-CDE TO GL002-EXPENSE-TYPE-CDE        16960000
12386a             IF PV-SUM-CTG-AMT >= ZERO                            16970000
12386a                SET GL002-MONETARY-AMT-CR TO TRUE                 16980000
12386a             ELSE                                                 16990000
12386a                SET GL002-MONETARY-AMT-DR TO TRUE                 17000000
12386a             END-IF                                               17010000
12386a             PERFORM 8100-WRITE-GL-RECORD                         17020000
171300**  KCK CARDS TENDERED WILL BE SENT THROUGH AS A DEBIT; AN        17030000
171400**  OFFSETTING CREDIT WILL BE TO THE GDT (GIFT CARDS TENDERED)    17040000
171500**  ACCOUNT                                                       17050000
171600         WHEN PC-SUM-CTG-CDE-KKT                                  17060000
171700             ADD PV-SUM-CTG-AMT                                   17070000
171800                   TO PV-HOLD-DLY-GDT-AMT (PV-TBL-SUB ,           17080000
171900                                           PV-BAL-DTE-SUB)        17090000
172000             MOVE PC-SUM-CTG-CDE                                  17100000
172100                              TO GL002-EXPENSE-TYPE-CDE           17110000
172200             IF PV-SUM-CTG-AMT >= 0                               17120000
172300                 SET GL002-MONETARY-AMT-DR  TO TRUE               17130000
172400             ELSE                                                 17140000
172500                 SET GL002-MONETARY-AMT-CR  TO TRUE               17150000
172600             END-IF                                               17160000
172700             PERFORM 8100-WRITE-GL-RECORD                         17170000
172800**  SCANNING PENALTIES WILL BE CREDITED TO STM.                   17180000
172900**  STORE SUNDRY EXPENSE (SSE) WILL BE DEBITED.                   17190000
173000**  PV-HOLD-TMR-AMT, PV-HOLD-STM-AMT AND PV-HOLD-SSE-AMT ARE      17200000
173100**  SIGNED FIELDS.                                                17210000
173200**  8100-WRITE-GL-RECORD IS NOT PERFORMED HERE AS THE TOTALS      17220000
173300**  WILL BE INSERTED WHEN THE TSAADPC CURSOR IS PROCESSED.        17230000
173400         WHEN PC-SUM-CTG-CDE-SPN                                  17240000
173500             SET PS-SCAN-PENALTY-YES                              17250000
173600                              TO TRUE                             17260000
173700             ADD PV-SUM-CTG-AMT                                   17270000
173800                    TO PV-HOLD-DLY-STM-AMT (PV-TBL-SUB ,          17280000
173900                                            PV-BAL-DTE-SUB)       17290000
174000             MOVE PV-SUM-CTG-AMT                                  17300000
174100                              TO PV-HOLD-GL-AMT                   17310000
174200             COMPUTE PV-HOLD-GL-AMT = PV-HOLD-GL-AMT * -1         17320000
174300             ADD PV-HOLD-GL-AMT                                   17330000
174400                    TO PV-HOLD-DLY-SSE-AMT (PV-TBL-SUB ,          17340000
174500                                            PV-BAL-DTE-SUB)       17350000
SEPHOR**  SEPHORA GIFT CARD SALES WILL BE SENT THROUGH AS A CREDIT.     17360000
TPCFIX**  AN OFFSETTING DEBIT WILL BE MADE TO THE TPC (THIRD PARTY      17370000
TPCFIX**  GIFT CARD SALES), WHICH IS UPDATED BY POC (TSAADSU) AND       17380000
TPCFIX**  THE SALES HUB (TSASUM).                                       17390000
SEPHOR         WHEN PC-SUM-CTG-CDE-SGS                                  17400000
TPCFIX             ADD PV-SUM-CTG-AMT                                   17410000
TPCFIX                    TO PV-HOLD-DLY-TPC-AMT (PV-TBL-SUB,           17420000
TPCFIX                                            PV-BAL-DTE-SUB)       17430000
SEPHOR             MOVE PC-SUM-CTG-CDE                                  17440000
SEPHOR                              TO GL002-EXPENSE-TYPE-CDE           17441000
SEPHOR             IF PV-SUM-CTG-AMT >= 0                               17442000
SEPHOR                 SET GL002-MONETARY-AMT-CR  TO TRUE               17443000
SEPHOR             ELSE                                                 17444000
SEPHOR                 SET GL002-MONETARY-AMT-DR  TO TRUE               17445000
SEPHOR             END-IF                                               17446000
SEPHOR             PERFORM 8100-WRITE-GL-RECORD                         17447000
SEPHOR**  SEPHORA GIFT CARDS TENDERED WILL BE SENT THROUGH AS A DEBIT.  17448000
SEPHOR**  AN OFFSETTING CREDIT WILL BE TO THE GDT (GIFT CARDS TENDERED) 17449000
SEPHOR**  ACCOUNT.                                                      17449100
SEPHOR         WHEN PC-SUM-CTG-CDE-SGT                                  17449200
SEPHOR             ADD PV-SUM-CTG-AMT                                   17449300
171800                         TO PV-HOLD-DLY-GDT-AMT (PV-TBL-SUB,      17449400
SEPHOR                                                 PV-BAL-DTE-SUB)  17449500
SEPHOR             MOVE PC-SUM-CTG-CDE                                  17449600
SEPHOR                              TO GL002-EXPENSE-TYPE-CDE           17449700
SEPHOR             IF PV-SUM-CTG-AMT >= 0                               17449800
SEPHOR                 SET GL002-MONETARY-AMT-DR  TO TRUE               17449900
SEPHOR             ELSE                                                 17450000
SEPHOR                 SET GL002-MONETARY-AMT-CR  TO TRUE               17451000
SEPHOR             END-IF                                               17451100
SEPHOR             PERFORM 8100-WRITE-GL-RECORD                         17451200
COBRND**  COBRAND VISA PAYMENTS (CVP) WILL BE SENT THROUGH AS A CREDIT. 17451300
COBRND**  AN OFFSETTING DEBIT WILL BE MADE TO THE KCP (KOHLS CHARGE     17451400
COBRND**  PAYMENTS) ACCOUNT, WHICH IS UPDATED BY POC (TSAADSU).         17451500
COBTRL**  COBRAND TRAILING PAYMENTS (TTP) NEED TO BE ADDED TO THE       17451600
COBTRL**  COBRAND VISA PAYMENTS (CVP) AND THE HOLD-KCP-AMT SO THAT      17451700
COBTRL**  THEY CAN BE SUBTRACTED FROM KCP.                              17451800
COBRND         WHEN PC-SUM-CTG-CDE-CVP                                  17451900
COBTR2             MOVE SASUM-STR-NBR  TO PV-TBL-STORE                  17452000
COBTRL             PERFORM 2546-GET-TTP-ADJUSTMENTS                     17452100
COBTRL             ADD PV-TTP-ADJUSTMENTS TO PV-SUM-CTG-AMT             17452200
COBTRL                                       PV-TTP-TOTAL               17452300
COBRND             ADD PV-SUM-CTG-AMT                                   17452400
COBRND                         TO PV-HOLD-DLY-KCP-AMT (PV-TBL-SUB,      17452500
COBRND                                                 PV-BAL-DTE-SUB)  17452600
COBTRF             MOVE PV-SUM-CTG-AMT TO GL002-MONETARY-AMT            17452700
COBRND             MOVE PC-SUM-CTG-CDE TO GL002-EXPENSE-TYPE-CDE        17452800
COBRND             IF PV-SUM-CTG-AMT >= 0                               17452900
COBRND                 SET GL002-MONETARY-AMT-CR  TO TRUE               17453000
COBRND             ELSE                                                 17453100
COBRND                 SET GL002-MONETARY-AMT-DR  TO TRUE               17453200
COBRND             END-IF                                               17453300
COBRND             PERFORM 8100-WRITE-GL-RECORD                         17453400
COBTR2**           SET PV-HOLD-CVP-FOUND TO TELL KCP THAT CVP PROCESSED 17453500
COBTR2**           THE TRAILING TRANSACTIONS AND KCP DOESN'T NEED TO.   17453600
COBTR2             MOVE 'Y' TO PV-HOLD-DLY-CVP-FOUND (PV-TBL-SUB,       17453700
COBTR2                                                PV-BAL-DTE-SUB)   17453800
COBTRL                                                                  17453900
COBRND**  COBRAND VISA NET TENDERED WILL BE SENT THROUGH AS A DEBIT.    17454000
COBRND**  AN OFFSETTING CREDIT WILL BE TO THE BCN (BANK CHARGE NET)     17454100
COBRND**  ACCOUNT, WHICH IS UPDATED BY POC (TSAADSU).                   17454200
COBTRL**  COBRAND TRAILING NET (TTN) NEEDS TO BE ADDED TO THE           17454300
COBTRL**  COBRAND VISA NET (CVN) AND THE HOLD-KCN-AMT SO THAT           17454400
COBTRL**  THEY CAN BE SUBTRACTED FROM KCN.  THEY SHOULD NOT IMPACT      17454500
COBTRL**  BCN, SO THEY SHOULDN'T BE ADDED TO CVN UNTIL AFTER CVN IS     17454600
COBTRL**  MOVED TO THE HOLD-BCN-AMT BUCKET.                             17454700
COBRND         WHEN PC-SUM-CTG-CDE-CVN                                  17454800
COBRND             ADD PV-SUM-CTG-AMT                                   17454900
COBRND                         TO PV-HOLD-DLY-BCN-AMT (PV-TBL-SUB,      17455000
COBRND                                                 PV-BAL-DTE-SUB)  17455100
COBTR2             MOVE SASUM-STR-NBR  TO PV-TBL-STORE                  17455200
COBTRL             PERFORM 2547-GET-TTN-ADJUSTMENTS                     17455300
COBTRL             ADD PV-TTN-ADJUSTMENTS TO PV-SUM-CTG-AMT             17455400
COBTRL                 PV-HOLD-DLY-KCN-AMT (PV-TBL-SUB, PV-BAL-DTE-SUB) 17455500
COBTRL                                       PV-TTN-TOTAL               17455600
COBTRF             MOVE PV-SUM-CTG-AMT TO GL002-MONETARY-AMT            17455700
COBRND             MOVE PC-SUM-CTG-CDE TO GL002-EXPENSE-TYPE-CDE        17455800
COBRND             IF PV-SUM-CTG-AMT >= 0                               17455900
COBRND                 SET GL002-MONETARY-AMT-DR  TO TRUE               17456000
COBRND             ELSE                                                 17456100
COBRND                 SET GL002-MONETARY-AMT-CR  TO TRUE               17456200
COBRND             END-IF                                               17456300
COBRND             PERFORM 8100-WRITE-GL-RECORD                         17456400
COBTR2**           SET PV-HOLD-CVN-FOUND TO TELL KCN THAT CVN PROCESSED 17456500
COBTR2**           THE TRAILING TRANSACTIONS AND KCN DOESN'T NEED TO.   17456600
COBTR2             MOVE 'Y' TO PV-HOLD-DLY-CVN-FOUND (PV-TBL-SUB,       17456700
COBTR2                                                PV-BAL-DTE-SUB)   17456800
174600     END-EVALUATE.                                                17456900
174700                                                                  17457000
174700                                                                  17458000
174800*----------------------------------------------------------------*17459000
174900*    EMPLOYEE DISCOUNTS CALCULATED BY THE SALES HUB CAN RESULT    17460000
175000*    IN ADJUSTMENTS WHICH WILL REDUCE THE FEES.                   17470000
175100*----------------------------------------------------------------*17480000
175200 2545-GET-FEE-ADJUSTMENTS.                                        17490000
175300                                                                  17500000
175400     EXEC SQL                                                     17510000
175500         SELECT SUM (CTG_AMT)                                     17520000
175600         INTO  :PV-FEE-ADJUSTMENTS                                17530000
175700         FROM   TSASUM   SUM                                      17540000
175800               ,TEPPART  PRT                                      17550000
175900         WHERE PRT.SLS_DTE BETWEEN :DK-BEGIN-DATE-ISO             17560000
176000                               AND :DK-END-DATE-ISO               17570000
176100           AND SUM.PARTN_NBR =  PRT.PARTN_NBR                     17580000
176200           AND STR_GP_CDE    = :PC-STORE-GROUP-CODE               17590000
176300           AND SUM_TYP_CDE  IN ('D','S')                          17600000
176400           AND STR_NBR       = :SASUM-STR-NBR                     17610000
176500           AND SUM_CTG_CDE   = 'AFE'                              17620000
176600           AND RGST_ID      <> 0                                  17630000
176700         WITH UR                                                  17640000
176800     END-EXEC.                                                    17650000
176900                                                                  17660000
177000     EVALUATE TRUE                                                17670000
177100         WHEN SQLCODE = ZERO                                      17680000
177200             CONTINUE                                             17690000
177300         WHEN SQLCODE = +100 OR -305                              17700000
177400             MOVE ZEROES                 TO PV-FEE-ADJUSTMENTS    17710000
177500         WHEN OTHER                                               17720000
177600             MOVE '2545-GET-FEE-ADJUSTMENTS'                      17730000
177700                                         TO PV-PARAGRAPH-NAME     17740000
177800             MOVE 'SELECT FROM TSASUM'   TO PV-DB2-FUNCTION       17750000
177900             DISPLAY 'SAADSU-STR-NBR ' SAADSU-STR-NBR             17760000
178000             DISPLAY 'PC-STORE-GROUP-CODE ' PC-STORE-GROUP-CODE   17770000
178100             PERFORM 9990-DB2-ABEND                               17780000
178200     END-EVALUATE.                                                17790000
178300                                                                  17800000
COBTRL                                                                  17810000
COBTRL*----------------------------------------------------------------*17820000
COBTRL*    COBRAND TRAILING PAYMENTS (TTP) NEED TO BE SUBTRACTED        17821000
COBTRL*    FROM KCP AND ADDED TO CVP.                                   17822000
COBTRL*----------------------------------------------------------------*17823000
COBTRL 2546-GET-TTP-ADJUSTMENTS.                                        17824000
COBTRL                                                                  17825000
COBTR2     EVALUATE PV-BAL-DTE-SUB                                      17826000
COBTR2         WHEN 1                                                   17827000
COBTR2              MOVE PV-DLY-BAL-DTE-1 TO DK-DATE-ISO                17827100
COBTR2         WHEN 2                                                   17827200
COBTR2              MOVE PV-DLY-BAL-DTE-2 TO DK-DATE-ISO                17827300
COBTR2         WHEN 3                                                   17827400
COBTR2              MOVE PV-DLY-BAL-DTE-3 TO DK-DATE-ISO                17827500
COBTR2         WHEN 4                                                   17827600
COBTR2              MOVE PV-DLY-BAL-DTE-4 TO DK-DATE-ISO                17827700
COBTR2         WHEN 5                                                   17827800
COBTR2              MOVE PV-DLY-BAL-DTE-5 TO DK-DATE-ISO                17827900
COBTR2         WHEN 6                                                   17828000
COBTR2              MOVE PV-DLY-BAL-DTE-6 TO DK-DATE-ISO                17828100
COBTR2         WHEN 7                                                   17828200
COBTR2              MOVE PV-DLY-BAL-DTE-7 TO DK-DATE-ISO                17828300
COBTR2     END-EVALUATE                                                 17828400
COBTR2                                                                  17828500
COBTRL     EXEC SQL                                                     17828600
COBTRL         SELECT SUM (CTG_AMT)                                     17828700
COBTRL         INTO  :PV-TTP-ADJUSTMENTS                                17828800
COBTRL         FROM   TSASUM   SUM                                      17828900
COBTRL               ,TEPPART  PRT                                      17829000
COBTR2         WHERE PRT.SLS_DTE   = :DK-DATE-ISO                       17829100
COBTRL           AND SUM.PARTN_NBR =  PRT.PARTN_NBR                     17829200
COBTRL           AND STR_GP_CDE    = :PC-STORE-GROUP-CODE               17829300
COBTRL           AND SUM_TYP_CDE  IN ('D','S')                          17829400
COBTR2           AND STR_NBR       = :PV-TBL-STORE                      17829500
COBTRL           AND SUM_CTG_CDE   = 'TTP'                              17829600
COBTRL           AND RGST_ID       = 0                                  17829700
COBTRL         WITH UR                                                  17829800
COBTRL     END-EXEC.                                                    17829900
COBTRL                                                                  17830000
COBTRL     EVALUATE TRUE                                                17830100
COBTRL         WHEN SQLCODE = ZERO                                      17830200
COBTRL             CONTINUE                                             17830300
COBTRL         WHEN SQLCODE = +100 OR -305                              17830400
COBTRL             MOVE ZEROES                 TO PV-TTP-ADJUSTMENTS    17830500
COBTRL         WHEN OTHER                                               17830600
COBTRL             MOVE '2546-GET-TTP-ADJUSTMENTS'                      17830700
COBTRL                                         TO PV-PARAGRAPH-NAME     17830800
COBTRL             MOVE 'SELECT FROM TSASUM'   TO PV-DB2-FUNCTION       17830900
COBTRL             DISPLAY 'SASUM-STR-NBR  ' SASUM-STR-NBR              17831000
COBTRL             DISPLAY 'PC-STORE-GROUP-CODE ' PC-STORE-GROUP-CODE   17831100
COBTRL             PERFORM 9990-DB2-ABEND                               17831200
COBTRL     END-EVALUATE.                                                17831300
COBTRL                                                                  17831400
COBTRL                                                                  17831500
COBTRL*----------------------------------------------------------------*17831600
COBTRL*    COBRAND TRAILING NET (TTN) NEEDS TO BE SUBTRACTED            17831700
COBTRL*    FROM BCN AND ADDED TO CVN.                                   17831800
COBTRL*----------------------------------------------------------------*17831900
COBTRL 2547-GET-TTN-ADJUSTMENTS.                                        17832000
COBTRL                                                                  17832100
COBTR2     EVALUATE PV-BAL-DTE-SUB                                      17832200
COBTR2         WHEN 1                                                   17832300
COBTR2              MOVE PV-DLY-BAL-DTE-1 TO DK-DATE-ISO                17832400
COBTR2         WHEN 2                                                   17832500
COBTR2              MOVE PV-DLY-BAL-DTE-2 TO DK-DATE-ISO                17832600
COBTR2         WHEN 3                                                   17832700
COBTR2              MOVE PV-DLY-BAL-DTE-3 TO DK-DATE-ISO                17832800
COBTR2         WHEN 4                                                   17832900
COBTR2              MOVE PV-DLY-BAL-DTE-4 TO DK-DATE-ISO                17833000
COBTR2         WHEN 5                                                   17833100
COBTR2              MOVE PV-DLY-BAL-DTE-5 TO DK-DATE-ISO                17833200
COBTR2         WHEN 6                                                   17833300
COBTR2              MOVE PV-DLY-BAL-DTE-6 TO DK-DATE-ISO                17833400
COBTR2         WHEN 7                                                   17833500
COBTR2              MOVE PV-DLY-BAL-DTE-7 TO DK-DATE-ISO                17833600
COBTR2     END-EVALUATE                                                 17833700
COBTR2                                                                  17833800
COBTRL     EXEC SQL                                                     17833900
COBTRL         SELECT SUM (CTG_AMT)                                     17834000
COBTRL         INTO  :PV-TTN-ADJUSTMENTS                                17834100
COBTRL         FROM   TSASUM   SUM                                      17834200
COBTRL               ,TEPPART  PRT                                      17834300
COBTR2         WHERE PRT.SLS_DTE   = :DK-DATE-ISO                       17834400
COBTRL           AND SUM.PARTN_NBR =  PRT.PARTN_NBR                     17834500
COBTRL           AND STR_GP_CDE    = :PC-STORE-GROUP-CODE               17834600
COBTRL           AND SUM_TYP_CDE  IN ('D','S')                          17834700
COBTR2           AND STR_NBR       = :PV-TBL-STORE                      17834800
COBTRL           AND SUM_CTG_CDE   = 'TTN'                              17834900
COBTRL           AND RGST_ID       = 0                                  17835000
COBTRL         WITH UR                                                  17835100
COBTRL     END-EXEC.                                                    17835200
COBTRL                                                                  17835300
COBTRL     EVALUATE TRUE                                                17835400
COBTRL         WHEN SQLCODE = ZERO                                      17835500
COBTRL             CONTINUE                                             17835600
COBTRL         WHEN SQLCODE = +100 OR -305                              17835700
COBTRL             MOVE ZEROES                 TO PV-TTN-ADJUSTMENTS    17835800
COBTRL         WHEN OTHER                                               17835900
COBTRL             MOVE '2547-GET-TTN-ADJUSTMENTS'                      17836000
COBTRL                                         TO PV-PARAGRAPH-NAME     17836100
COBTRL             MOVE 'SELECT FROM TSASUM'   TO PV-DB2-FUNCTION       17836200
COBTRL             DISPLAY 'SASUM-STR-NBR  ' SASUM-STR-NBR              17836300
COBTRL             DISPLAY 'PC-STORE-GROUP-CODE ' PC-STORE-GROUP-CODE   17836400
COBTRL             PERFORM 9990-DB2-ABEND                               17836500
COBTRL     END-EVALUATE.                                                17836600
COBTRL                                                                  17836700
178400*----------------------------------------------------------------*17836800
178500*   CLOSE THE TSASUM CURSOR.                                     *17836900
178600*----------------------------------------------------------------*17837000
178700 2550-CLOSE-TSASUM-CURSOR.                                        17838000
178800     EXEC SQL                                                     17839000
178900          CLOSE TSASUM-CSR                                        17840000
179000     END-EXEC.                                                    17850000
179100     EVALUATE TRUE                                                17860000
179200         WHEN SQLCODE = ZERO                                      17870000
179300             CONTINUE                                             17880000
179400         WHEN OTHER                                               17890000
179500             MOVE '2550-CLOSE-TSASUM-CURSOR'                      17900000
179600                              TO PV-PARAGRAPH-NAME                17910000
179700             MOVE 'CLOSE CURSOR FOR TABLE TSASUM'                 17920000
179800                              TO PV-DB2-FUNCTION                  17930000
179900             PERFORM 9990-DB2-ABEND                               17940000
180000     END-EVALUATE.                                                17950000
180100                                                                  17960000
180200*----------------------------------------------------------------*17970000
180300*    OPEN THE ZEROROW CURSOR.                                    *17980000
180400*----------------------------------------------------------------*17990000
180500 2560-OPEN-ZEROROW-CURSOR.                                        18000000
180600                                                                  18010000
180700     EXEC SQL                                                     18020000
180800          OPEN ZEROROW-CSR                                        18030000
180900     END-EXEC.                                                    18040000
181000     EVALUATE TRUE                                                18050000
181100         WHEN SQLCODE = ZERO                                      18060000
181200             CONTINUE                                             18070000
181300         WHEN OTHER                                               18080000
181400             MOVE '2560-OPEN-ZEROROW-CURSOR'                      18090000
181500                              TO PV-PARAGRAPH-NAME                18100000
181600             MOVE 'OPEN CURSOR FOR ZERO ROWS'                     18110000
181700                              TO PV-DB2-FUNCTION                  18120000
181800             PERFORM 9990-DB2-ABEND                               18130000
181900     END-EVALUATE.                                                18140000
182000                                                                  18150000
182100*----------------------------------------------------------------*18160000
182200*   FETCH THE ZEROROW CURSOR.                                    *18170000
182300*----------------------------------------------------------------*18180000
182400 2570-FETCH-ZEROROW-CURSOR.                                       18190000
182500                                                                  18200000
182600     EXEC SQL                                                     18210000
182700         FETCH ZEROROW-CSR                                        18220000
182800         INTO  :SASUM-STR-NBR,                                    18230000
182900               :EPPART-SLS-DTE,                                   18240000
183000               :SASUM-SUM-CTG-CDE,                                18250000
183100               :PV-SUM-CTG-AMT                                    18260000
183200     END-EXEC.                                                    18270000
183300     EVALUATE TRUE                                                18280000
183400         WHEN SQLCODE = ZERO                                      18290000
183500             MOVE SASUM-SUM-CTG-CDE  TO PC-SUM-CTG-CDE            18300000
183600         WHEN SQLCODE = +100                                      18310000
183700             SET PS-END-OF-CURSOR TO TRUE                         18320000
183800         WHEN OTHER                                               18330000
183900             MOVE '2570-FETCH-ZEROROW-CURSOR'                     18340000
184000                              TO PV-PARAGRAPH-NAME                18350000
184100             MOVE 'FETCH CURSOR FOR ZERO ROWS'                    18360000
184200                              TO PV-DB2-FUNCTION                  18370000
184300             PERFORM 9990-DB2-ABEND                               18380000
184400     END-EVALUATE.                                                18390000
184500                                                                  18400000
184600*----------------------------------------------------------------*18410000
184700*   CLOSE THE ZEROROW CURSOR.                                    *18420000
184800*----------------------------------------------------------------*18430000
184900 2580-CLOSE-ZEROROW-CURSOR.                                       18440000
185000     EXEC SQL                                                     18450000
185100          CLOSE ZEROROW-CSR                                       18460000
185200     END-EXEC.                                                    18470000
185300     EVALUATE TRUE                                                18480000
185400         WHEN SQLCODE = ZERO                                      18490000
185500             CONTINUE                                             18500000
185600         WHEN OTHER                                               18510000
185700             MOVE '2580-CLOSE-ZEROROW-CURSOR'                     18520000
185800                              TO PV-PARAGRAPH-NAME                18530000
185900             MOVE 'CLOSE CURSOR FOR ZERO ROWS'                    18540000
186000                              TO PV-DB2-FUNCTION                  18550000
186100             PERFORM 9990-DB2-ABEND                               18560000
186200     END-EVALUATE.                                                18570000
186300                                                                  18580000
186400*----------------------------------------------------------------*18590000
186500*  CHECK IF THE DEBITS AND CREDITS BALANCE.                      *18600000
186600*----------------------------------------------------------------*18610000
186700                                                                  18620000
186800 2600-CHECK-IF-BALANCED.                                          18630000
186900                                                                  18640000
187000     WRITE EMAIL-RECORD       FROM EM-EMAIL-BLANK-LINE.           18650000
187100     IF PT-DEBITS = PT-CREDITS                                    18660000
187200         MOVE ZERO            TO RETURN-CODE                      18670000
187300         MOVE CC-WEEK-ENDING-DATE-ISO                             18680000
187400                              TO EM-LINE1-DATE                    18690000
187500         WRITE EMAIL-RECORD   FROM EM-EMAIL-LINE1                 18700000
187600     ELSE                                                         18710000
187700*        THIS VERSION OF THE PROGRAM SHOULD NOT STOP THE          18720000
187800*        GENERAL LEDGER FILE FROM BEING CREATED WHEN THERE IS AN  18730000
187900*        OUT OF BALANCE - SET THE RETURN CODE TO ZERO.            18740000
188000*        MOVE 4090            TO RETURN-CODE                      18750000
188100         MOVE ZERO            TO RETURN-CODE                      18760000
188200         MOVE CC-WEEK-ENDING-DATE-ISO                             18770000
188300                              TO EM-LINE1-DATE                    18780000
188400         WRITE EMAIL-RECORD   FROM EM-EMAIL-LINE1                 18790000
188500         WRITE EMAIL-RECORD   FROM EM-EMAIL-BLANK-LINE            18800000
188600         WRITE EMAIL-RECORD   FROM EM-EMAIL-LINE2B                18810000
188700     END-IF.                                                      18820000
188800     WRITE EMAIL-RECORD       FROM EM-EMAIL-BLANK-LINE.           18830000
188900     MOVE PT-DEBITS           TO   EM-LINE3-DEBITS.               18840000
189000     MOVE PT-CREDITS          TO   EM-LINE4-CREDITS.              18850000
189100     WRITE EMAIL-RECORD       FROM EM-EMAIL-LINE3.                18860000
189200     WRITE EMAIL-RECORD       FROM EM-EMAIL-LINE4.                18870000
189300     MOVE PV-TTL-TMR-ECOM-AMT TO EM-LINE8-E-COM-CR                18880000
189400     DISPLAY 'ECOM TMR TTL AMT FOR THE WEEK: '                    18890000
189500              EM-LINE8-E-COM-CR                                   18900000
189600     IF PV-TTL-TMR-ECOM-AMT > 0                                   18910000
189700       MOVE  PV-TTL-TMR-ECOM-AMT TO EM-LINE8-E-COM-CR             18920000
189800       WRITE EMAIL-RECORD   FROM EM-EMAIL-BLANK-LINE              18930000
189900       WRITE EMAIL-RECORD   FROM EM-EMAIL-LINE8                   18940000
190000     END-IF.                                                      18950000
190100                                                                  18960000
190200*----------------------------------------------------------------*18970000
190300*  WRITE GENERAL LEDGER RECORD.                                  *18980000
190400*----------------------------------------------------------------*18990000
190500                                                                  19000000
190600 8100-WRITE-GL-RECORD.                                            19010000
190700                                                                  19020000
190800     INITIALIZE PV-BAL-DTE-SUB.                                   19030000
190900     EVALUATE PV-STORE-SLS-DTE                                    19040000
191000        WHEN PV-DLY-BAL-DTE-1                                     19050000
191100             MOVE 1 TO PV-BAL-DTE-SUB                             19060000
191200        WHEN PV-DLY-BAL-DTE-2                                     19070000
191300             MOVE 2 TO PV-BAL-DTE-SUB                             19080000
191400        WHEN PV-DLY-BAL-DTE-3                                     19090000
191500             MOVE 3 TO PV-BAL-DTE-SUB                             19100000
191600        WHEN PV-DLY-BAL-DTE-4                                     19110000
191700             MOVE 4 TO PV-BAL-DTE-SUB                             19120000
191800        WHEN PV-DLY-BAL-DTE-5                                     19130000
191900             MOVE 5 TO PV-BAL-DTE-SUB                             19140000
192000        WHEN PV-DLY-BAL-DTE-6                                     19150000
192100             MOVE 6 TO PV-BAL-DTE-SUB                             19160000
192200        WHEN PV-DLY-BAL-DTE-7                                     19170000
192300             MOVE 7 TO PV-BAL-DTE-SUB                             19180000
192400     END-EVALUATE.                                                19190000
192500                                                                  19200000
192600     IF GL002-MONETARY-AMT = 0                                    19210000
192700         CONTINUE                                                 19220000
192800     ELSE                                                         19230000
192900         WRITE GENERAL-LEDGER-RECORD                              19240000
193000                           FROM GL002-GL-INTERFACE-TRN            19250000
193100         IF GL002-MONETARY-AMT-DR                                 19260000
193200**           DISPLAY 'STORE = ' PV-STORE-BALANCE                  19270000
193300**                   ' DATE = ' GL002-MONETARY-AMT                19280000
193400**                   '  DEBIT AMT = ' GL002-MONETARY-AMT          19290000
193500             ADD GL002-MONETARY-AMT                               19300000
193600                           TO PT-DEBITS                           19310000
193700**  ** ADD TO DEBITS BY STORE BY DAY                              19320000
193800         PV-DLY-STORE-DEBITS (PV-STORE-BALANCE, PV-BAL-DTE-SUB)   19330000
193900         ELSE                                                     19340000
194000**           DISPLAY 'STORE = ' PV-STORE-BALANCE                  19350000
194100**           DISPLAY ' DATE = ' PV-STORE-BALANCE                  19360000
194200**                   '  CREDIT AMT = ' GL002-MONETARY-AMT         19370000
194300             ADD GL002-MONETARY-AMT                               19380000
194400                           TO PT-CREDITS                          19390000
194500**  ** ADD TO CREDITS BY STORE BY DAY                             19400000
194600         PV-DLY-STORE-CREDITS (PV-STORE-BALANCE, PV-BAL-DTE-SUB)  19410000
194700         END-IF                                                   19420000
194800         ADD 1             TO PT-GL-RECORDS-WRITTEN               19430000
194900     END-IF.                                                      19440000
195000                                                                  19450000
SPNFIX                                                                  19451001
SPNFIX*----------------------------------------------------------------*19452001
SPNFIX*  WRITE GENERAL LEDGER RECORD FOR SCANNING PENALTIES.           *19453001
SPNFIX*  USING PARA 8100- FOR THE SCANNING PENALTIES RESULTS IN THEM   *19453101
SPNFIX*  ALL BEING WRITTEN TO THE 7TH DAY OF THE WEEK, RESULTING IN    *19453201
SPNFIX*  $5 DIFFERENCES IN CREDITS AND DEBITS ON THE DAY THEY OCCUR    *19453301
SPNFIX*  AND DAY 7 IF THEY DIDN'T OCCUR ON DAY 7.  BALANCING IS BY     *19453401
SPNFIX*  WEEK SO IT STILL BALANCES, BUT THE AUDITORS HAVE QUESTIONED   *19453501
SPNFIX*  THE $5 DIFFERENCES ON THE 2 DAYS.                             *19453601
SPNFIX*----------------------------------------------------------------*19454001
SPNFIX                                                                  19455001
SPNFIX 8110-WRITE-GL-SPN-RECORD.                                        19456001
SPNFIX                                                                  19457001
SPNFIX**   THE FOLLOWING LINE REPLACES THE DATE EVALUATE LOGIC IN       19458001
SPNFIX**   PARA 8100-.  THE REMAINDER OF THE PARAGRAPH IS THE SAME.     19459001
SPNFIX     MOVE PV-BAL-DTE-SUB-SPN    TO PV-BAL-DTE-SUB.                19459201
SPNFIX                                                                  19460601
SPNFIX     IF GL002-MONETARY-AMT = 0                                    19460701
SPNFIX         CONTINUE                                                 19460801
SPNFIX     ELSE                                                         19460901
SPNFIX         WRITE GENERAL-LEDGER-RECORD                              19461001
SPNFIX                           FROM GL002-GL-INTERFACE-TRN            19461101
SPNFIX         IF GL002-MONETARY-AMT-DR                                 19461201
SPNFIX**           DISPLAY 'STORE = ' PV-STORE-BALANCE                  19461301
SPNFIX**                   ' DATE = ' GL002-MONETARY-AMT                19461401
SPNFIX**                   '  DEBIT AMT = ' GL002-MONETARY-AMT          19461501
SPNFIX             ADD GL002-MONETARY-AMT                               19461601
SPNFIX                           TO PT-DEBITS                           19461701
SPNFIX**  ** ADD TO DEBITS BY STORE BY DAY                              19461801
SPNFIX         PV-DLY-STORE-DEBITS (PV-STORE-BALANCE, PV-BAL-DTE-SUB)   19461901
SPNFIX         ELSE                                                     19462001
SPNFIX**           DISPLAY 'STORE = ' PV-STORE-BALANCE                  19462101
SPNFIX**           DISPLAY ' DATE = ' PV-STORE-BALANCE                  19462201
SPNFIX**                   '  CREDIT AMT = ' GL002-MONETARY-AMT         19462301
SPNFIX             ADD GL002-MONETARY-AMT                               19462401
SPNFIX                           TO PT-CREDITS                          19462501
SPNFIX**  ** ADD TO CREDITS BY STORE BY DAY                             19462601
SPNFIX         PV-DLY-STORE-CREDITS (PV-STORE-BALANCE, PV-BAL-DTE-SUB)  19462701
SPNFIX         END-IF                                                   19462801
SPNFIX         ADD 1             TO PT-GL-RECORDS-WRITTEN               19462901
SPNFIX     END-IF.                                                      19463001
SPNFIX                                                                  19463101
195100*----------------------------------------------------------------*19464001
195200*  CLOSE ALL FILES.                                              *19470000
195300*----------------------------------------------------------------*19480000
195400 9000-EOJ-ROUTINE.                                                19490000
195500                                                                  19500000
195600     SET TD-DEBITS                 TO TRUE.                       19510000
195700     MOVE PT-DEBITS                TO TD-TOTAL-AMOUNT.            19520000
195800     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       19530000
195900               TD-TOTAL-DISPLAY-MESSAGE.                          19540000
196000                                                                  19550000
196100     SET TD-CREDITS                TO TRUE.                       19560000
196200     MOVE PT-CREDITS               TO TD-TOTAL-AMOUNT.            19570000
196300     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       19580000
196400               TD-TOTAL-DISPLAY-MESSAGE.                          19590000
196500                                                                  19600000
196600     SET TD-GL-RECORDS-WRITTEN     TO TRUE.                       19610000
196700     MOVE PT-GL-RECORDS-WRITTEN    TO TD-TOTAL-AMOUNT.            19620000
196800     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       19630000
196900               TD-TOTAL-DISPLAY-MESSAGE.                          19640000
197000                                                                  19650000
COBTRL     DISPLAY '     '.                                             19660000
COBTR2     MOVE PV-TTN-TOTAL              TO PV-TRAIL-AMOUNT.           19670000
COBTRL     DISPLAY 'TOTAL TRAILING TENDER  TRANSACTION DOLLARS = '      19680000
COBTR2              PV-TRAIL-AMOUNT.                                    19690000
COBTR2     MOVE PV-TTP-TOTAL              TO PV-TRAIL-AMOUNT.           19691000
COBTRL     DISPLAY 'TOTAL TRAILING PAYMENT TRANSACTION DOLLARS = '      19692000
COBTR2              PV-TRAIL-AMOUNT.                                    19693000
COBTRL     DISPLAY '     '.                                             19694000
COBTRL                                                                  19695000
197100     DISPLAY 'STORE         DEBITS        CREDITS     DIFFERENCE'.19696000
197200                                                                  19697000
197300     IF PT-DEBITS = PT-CREDITS                                    19698000
197400         CONTINUE                                                 19699000
197500     ELSE                                                         19700000
197600         WRITE EMAIL-RECORD   FROM EM-EMAIL-BLANK-LINE            19710000
197700         WRITE EMAIL-RECORD   FROM EM-EMAIL-LINE5                 19720000
197800         WRITE EMAIL-RECORD   FROM EM-EMAIL-LINE6                 19730000
197900     END-IF.                                                      19740000
198000                                                                  19750000
198100     MOVE CC-WEEK-ENDING-DATE-ISO TO BF-LINE1-WKND-DTE            19760000
198200     MOVE PV-CUR-SYS-TMST         TO BF-CUR-SYS-TMST              19770000
198300     WRITE DAILY-BALANCE-IND-RECORD                               19780000
198400           FROM BF-BALANCE-LINE1                                  19790000
198500                                                                  19800000
198600     PERFORM 9200-DISPLAY-STORE-TOTALS                            19810000
198700         VARYING PV-TBL-SUB FROM 1 BY 1                           19820000
198800           UNTIL PV-TBL-SUB > 9999.                               19830000
198900                                                                  19840000
199000     CLOSE GENERAL-LEDGER-FILE                                    19850000
199100           EMAIL-FILE                                             19860000
199200           DAILY-BALANCE-IND-FILE.                                19870000
199300                                                                  19880000
199400*----------------------------------------------------------------*19890000
199500*  DISPLAY STORE TOTALS AND PROCESS TO FILES                     *19900000
199600*----------------------------------------------------------------*19910000
199700 9200-DISPLAY-STORE-TOTALS.                                       19920000
199800                                                                  19930000
199900** if no values.. not a valid store, continue and ignore entry    19940000
200000     IF PV-DLY-STORE-DEBITS  (PV-TBL-SUB , 1) = 0 AND             19950000
200100        PV-DLY-STORE-CREDITS (PV-TBL-SUB , 1) = 0 AND             19960000
200200        PV-DLY-STORE-DEBITS  (PV-TBL-SUB , 2) = 0 AND             19970000
200300        PV-DLY-STORE-CREDITS (PV-TBL-SUB , 2) = 0 AND             19980000
200400        PV-DLY-STORE-DEBITS  (PV-TBL-SUB , 3) = 0 AND             19990000
200500        PV-DLY-STORE-CREDITS (PV-TBL-SUB , 3) = 0 AND             20000000
200600        PV-DLY-STORE-DEBITS  (PV-TBL-SUB , 4) = 0 AND             20010000
200700        PV-DLY-STORE-CREDITS (PV-TBL-SUB , 4) = 0 AND             20020000
200800        PV-DLY-STORE-DEBITS  (PV-TBL-SUB , 5) = 0 AND             20030000
200900        PV-DLY-STORE-CREDITS (PV-TBL-SUB , 5) = 0 AND             20040000
201000        PV-DLY-STORE-DEBITS  (PV-TBL-SUB , 6) = 0 AND             20050000
201100        PV-DLY-STORE-CREDITS (PV-TBL-SUB , 6) = 0 AND             20060000
201200        PV-DLY-STORE-DEBITS  (PV-TBL-SUB , 7) = 0 AND             20070000
201300        PV-DLY-STORE-CREDITS (PV-TBL-SUB , 7) = 0                 20080000
201400         CONTINUE                                                 20090000
201500** otherwise, process the legitimate store entry                  20100000
201600     ELSE                                                         20110000
201700         PERFORM 9300-PROCESS-DLY-BAL-TO-FILE                     20120000
201800             VARYING PV-BAL-DTE-SUB FROM 1 BY 1                   20130000
201900               UNTIL PV-BAL-DTE-SUB > 7                           20140000
202000     END-IF.                                                      20150000
202100                                                                  20160000
202200 9300-PROCESS-DLY-BAL-TO-FILE.                                    20170000
202300                                                                  20180000
202400     COMPUTE PV-STORE-DEBIT-CREDIT-DIFF =                         20190000
202500             PV-DLY-STORE-DEBITS  (PV-TBL-SUB , PV-BAL-DTE-SUB) - 20200000
202600             PV-DLY-STORE-CREDITS (PV-TBL-SUB , PV-BAL-DTE-SUB)   20210000
202700     MOVE PV-STORE-DEBIT-CREDIT-DIFF TO PV-DISPLAY-DIFF           20220000
202800** no difference in credits / debits -- balanced okay             20230000
202900     IF PV-STORE-DEBIT-CREDIT-DIFF = 0                            20240000
203000        EVALUATE PV-BAL-DTE-SUB                                   20250000
203100           WHEN 1                                                 20260000
203200                MOVE PV-DLY-BAL-DTE-1 TO BF-BAL-DTE               20270000
203300           WHEN 2                                                 20280000
203400                MOVE PV-DLY-BAL-DTE-2 TO BF-BAL-DTE               20290000
203500           WHEN 3                                                 20300000
203600                MOVE PV-DLY-BAL-DTE-3 TO BF-BAL-DTE               20310000
203700           WHEN 4                                                 20320000
203800                MOVE PV-DLY-BAL-DTE-4 TO BF-BAL-DTE               20330000
203900           WHEN 5                                                 20340000
204000                MOVE PV-DLY-BAL-DTE-5 TO BF-BAL-DTE               20350000
204100           WHEN 6                                                 20360000
204200                MOVE PV-DLY-BAL-DTE-6 TO BF-BAL-DTE               20370000
204300           WHEN 7                                                 20380000
204400                MOVE PV-DLY-BAL-DTE-7 TO BF-BAL-DTE               20390000
204500         END-EVALUATE                                             20400000
204600         MOVE PV-TBL-SUB   TO BF-BAL-STR-NBR                      20410000
204700         MOVE PV-STORE-DEBIT-CREDIT-DIFF TO BR-BAL-DIFF-AMT       20420000
204800         WRITE DAILY-BALANCE-IND-RECORD                           20430000
204900               FROM BF-BALANCE-DETAIL-LINE                        20440000
205000         DISPLAY PV-TBL-SUB '  '                                  20450000
205100               PV-BAL-DTE-SUB ' '                                 20460000
205200               PV-DLY-STORE-DEBITS  (PV-TBL-SUB , PV-BAL-DTE-SUB) 20470000
205300           ' ' PV-DLY-STORE-CREDITS (PV-TBL-SUB , PV-BAL-DTE-SUB) 20480000
205400           ' ' PV-DISPLAY-DIFF                                    20490000
205500** difference in credits / debits -- did not balance !            20500000
205600     ELSE                                                         20510000
205700        EVALUATE PV-BAL-DTE-SUB                                   20520000
205800           WHEN 1                                                 20530000
205900                MOVE PV-DLY-BAL-DTE-1 TO BF-BAL-DTE               20540000
206000           WHEN 2                                                 20550000
206100                MOVE PV-DLY-BAL-DTE-2 TO BF-BAL-DTE               20560000
206200           WHEN 3                                                 20570000
206300                MOVE PV-DLY-BAL-DTE-3 TO BF-BAL-DTE               20580000
206400           WHEN 4                                                 20590000
206500                MOVE PV-DLY-BAL-DTE-4 TO BF-BAL-DTE               20600000
206600           WHEN 5                                                 20610000
206700                MOVE PV-DLY-BAL-DTE-5 TO BF-BAL-DTE               20620000
206800           WHEN 6                                                 20630000
206900                MOVE PV-DLY-BAL-DTE-6 TO BF-BAL-DTE               20640000
207000           WHEN 7                                                 20650000
207100                MOVE PV-DLY-BAL-DTE-7 TO BF-BAL-DTE               20660000
207200         END-EVALUATE                                             20670000
207300         MOVE PV-TBL-SUB   TO BF-BAL-STR-NBR                      20680000
207400         MOVE PV-STORE-DEBIT-CREDIT-DIFF TO BR-BAL-DIFF-AMT       20690000
207500         WRITE DAILY-BALANCE-IND-RECORD                           20700000
207600               FROM BF-BALANCE-DETAIL-LINE                        20710000
207700         DISPLAY PV-TBL-SUB '  '                                  20720000
207800               PV-BAL-DTE-SUB ' '                                 20730000
207900               PV-DLY-STORE-DEBITS  (PV-TBL-SUB , PV-BAL-DTE-SUB) 20740000
208000           ' ' PV-DLY-STORE-CREDITS (PV-TBL-SUB , PV-BAL-DTE-SUB) 20750000
208100           ' ' PV-DISPLAY-DIFF ' '                                20760000
208200           ' *** OUT OF BALANCE ***'                              20770000
208300         MOVE PV-TBL-SUB            TO EM-LINE7-STORE             20780000
208400         MOVE BF-BAL-DTE            TO EM-LINE7-SLS-DTE           20790000
208500         MOVE PV-DLY-STORE-DEBITS  (PV-TBL-SUB , PV-BAL-DTE-SUB)  20800000
208600                                    TO EM-LINE7-STR-DEBITS        20810000
208700         MOVE PV-DLY-STORE-CREDITS (PV-TBL-SUB , PV-BAL-DTE-SUB)  20820000
208800                                    TO EM-LINE7-STR-CREDITS       20830000
208900         MOVE PV-DISPLAY-DIFF       TO EM-LINE7-STR-DIFF          20840000
209000         WRITE EMAIL-RECORD       FROM EM-EMAIL-LINE7             20850000
209100     END-IF.                                                      20860000
209200                                                                  20870000
209300*----------------------------------------------------------------*20880000
209400*      PERFORMS ABENDS AFTER UNEXPECTED SQLCODE                  *20890000
209500*----------------------------------------------------------------*20900000
209600 9990-DB2-ABEND.                                                  20910000
209700                                                                  20920000
209800     DISPLAY '** ABEND **'.                                       20930000
209900     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        20940000
210000     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              20950000
210100     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                20960000
210200                                                                  20970000
210300* ROUTINE TO DISPLAY ABEND IN READABLE FORMAT                     20980000
210400     COPY DPPD004.                                                20990000
210500                                                                  21000000
210600     SET ABEND-4013-DB2-ERROR TO TRUE.                            21010000
210700     CALL 'ILBOABN0' USING ABEND-CODE.                            21020000
