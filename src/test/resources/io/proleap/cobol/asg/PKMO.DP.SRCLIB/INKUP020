000100 IDENTIFICATION DIVISION.                                         00010061
000200                                                                  00020061
000300 PROGRAM-ID.    INKUP020.                                         00030061
000400 AUTHOR.        BRUCE GRAHAM - STRATAGEM                          00040061
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050061
000600 DATE-WRITTEN.  2006-09-01.                                       00060061
000700 DATE-COMPILED.                                                   00070061
000800                                                                  00080061
000900******************************************************************00090061
001000*           INKUP020 - CUTOFF DATABASE UPDATE PROGRAM            *00100061
001100******************************************************************00110061
001200* THIS PROGRAM WILL READ CONTROL FILE TO DETERMINE HOW INCOMING  *00120000
001300* CUT-OFF RECORDS ARE TO BE PROCESSED. THE CONTROL FILE CAN      *00130000
001400* CONTAIN ONE OF TWO VALUES ACTION TYPE VALUES                   *00140072
001500*                                                                *00150072
001600* 1.  'UPDATE' WILL CAUSE THE VALUES FROM INPUT CUT-OFF FILE TO  *00160000
001700* ADDED TO THE STR_EXPTED_OH_QTY FOR THE GIVEN LOC AND SKU ON    *00170000
001800* INPUT RECORD. IF THE STORE/SKU IS NOT ON THE TABLE, A NEW ROW  *00180000
001900* WILL BE INSERTED WITH ALL OF THE NECESSARY INFORMATION.        *00190000
002000* AN AUDIT REPORT DETAIL LINE WILL BE PRINTED.                   *00200000
002100* 2.  'REPLACE' WILL CAUSE EACH TABLE ROW WITH A STORE NUMBER    *00210000
002200* EQUAL TO THE INCOMING STORE NUMBER ON THE CTOFF FILE TO BE     *00220072
002300* REPLACED WITH ZERO IF THE STR_EXPTED_OH_QTY IS NOT EQUAL TO    *00230072
002400* ZEROS. EACH ONE UPDATED WILL BE PLACED ON THE AUDIT REPORT     *00240072
002500* AND A COMMIT TAKEN AT THE END OF THE CURSOR.                   *00250000
002600* THE CUT-OFF FILE WILL THEN BE USED AS A DRIVER TO UPDATE       *00260000
002700* ROWS WITH THE INCOMING  STR_EXPTED_OH_QTY.                     *00270000
002800* IF THE STORE/SKU IS NOT ON THE TABLE, A NEW ROW WILL BE        *00280000
002900* INSERTED.                                                       00290000
003000******************************************************************00300000
003100******************** HISTORY OF CHANGES **************************00310061
003200* WR/PROJ  DATE        DESCRIPTION OF CHANGES                     00320027
003300* -------  ----------  ----------------------------------------   00330027
003400* WR28545  08-11-2004  B. GRAHAM, STRATAGEM  - INITIAL INSTALL.   00340027
003500******************************************************************00350000
003600******************************************************************00360000
003700                                                                  00370000
003800 ENVIRONMENT DIVISION.                                            00380000
003900                                                                  00390000
004000 CONFIGURATION SECTION.                                           00400000
004100 SOURCE-COMPUTER.        IBM-3090.                                00410000
004200 OBJECT-COMPUTER.        IBM-3090.                                00420000
004300                                                                  00430061
004400 INPUT-OUTPUT SECTION.                                            00440000
004500 FILE-CONTROL.                                                    00450000
004600                                                                  00460000
004700     SELECT CC-ACTION-TYPE-CNTL-FILE                              00470061
004800         ASSIGN TO INP01.                                         00480061
004900                                                                  00490061
005000     SELECT CUTOFF-UPDATES-FILE                                   00500000
005100         ASSIGN TO INP02.                                         00510000
005200                                                                  00520061
005300     SELECT REPORT-AUDIT-FILE                                     00530000
005400         ASSIGN TO RPT01.                                         00540062
005500                                                                  00550000
005600                                                                  00560061
005700 DATA DIVISION.                                                   00570000
005800                                                                  00580061
005900 FILE SECTION.                                                    00590000
006000                                                                  00600000
006100 FD  CC-ACTION-TYPE-CNTL-FILE                                     00610061
006200     RECORDING MODE IS F                                          00620061
006300     LABEL RECORDS ARE STANDARD                                   00630061
006400     BLOCK CONTAINS 0 RECORDS.                                    00640061
006500 01  CC-ACTION-TYPE-RECORD       PIC X(80).                       00650061
006600                                                                  00660061
006700 FD  CUTOFF-UPDATES-FILE                                          00670000
006800     LABEL RECORDS ARE STANDARD                                   00680000
006900     RECORDING MODE IS F                                          00690000
007000     BLOCK CONTAINS 0 RECORDS.                                    00700000
007100 01  CUTOFF-UPDATES-RECORD       PIC X(56).                       00710026
007200                                                                  00720000
007300 FD  REPORT-AUDIT-FILE                                            00730061
007400     LABEL RECORDS ARE STANDARD                                   00740000
007500     RECORDING MODE IS F                                          00750000
007600     BLOCK CONTAINS 0 RECORDS.                                    00760000
007700 01  REPORT-AUDIT-RECORD         PIC X(075).                      00770092
007800                                                                  00780000
007900 WORKING-STORAGE SECTION.                                         00790000
008000                                                                  00800000
008100 01  FILLER                      PIC X(28)   VALUE                00810000
008200          'BEGINNING OF WORKING STORAGE'.                         00820000
008300 01  ABEND-CODE                  PIC S9(04)  VALUE ZERO COMP SYNC.00830000
008400                                                                  00840000
008500 01  PC-PROGRAM-CONSTANTS.                                        00850000
008600     05  PC-PROGRAM-NAME         PIC  X(08)  VALUE 'INKUP020'.    00860061
008700     05  PC-MAX-DEADLOCKS        PIC S9(03)  VALUE +3.            00870000
008800     05  PC-LINE-MAX             PIC S9(4)   VALUE +80 COMP SYNC. 00880061
008900     05  PC-4050                 PIC S9(4)   VALUE +4050          00890061
009000                                                       COMP SYNC. 00900061
009100     05  PC-ZEROS                PIC S9(9)   VALUE +0  COMP SYNC. 00910061
009200     05  PE-MSG-01                       PIC X(50) VALUE          00920000
009300          'CTOFF CURSOR OPEN FAILED                         '.    00930000
009400     05  PE-MSG-02                       PIC X(50) VALUE          00940061
009500          'CTOFF CURSOR CLOSE FAILED                        '.    00950000
009600     05  PE-MSG-03                       PIC X(50) VALUE          00960000
009700          'CTOFF CURSOR FETCH FAILED                        '.    00970000
009800     05  PE-MSG-04                       PIC X(50) VALUE          00980000
009900          'CTOFF INSERT FAILED                              '.    00990000
010000     05  PE-MSG-05                       PIC X(50) VALUE          01000000
010100          'CTOFF GET FAILED                                 '.    01010000
010200     05  PE-MSG-06                       PIC X(50) VALUE          01020000
010300          'CTOFF UPDATE FAILED                              '.    01030000
010400     05  PE-MSG-07                       PIC X(50) VALUE          01040000
010500          'CTOFF COMMIT FAILED                              '.    01050000
010600                                                                  01060000
010700 01  PS-PROGRAM-SWITCHES.                                         01070000
010800     05  PS-AT-END-CTOFF-FILE-SW         PIC X(01) VALUE 'N'.     01080000
010900         88  PS-AT-END-CTOFF-FILE-NO               VALUE 'N'.     01090000
011000         88  PS-AT-END-CTOFF-FILE-YES              VALUE 'Y'.     01100061
011100     05  PS-FIRST-CTOFF-READ-SW          PIC X(01) VALUE 'N'.     01110000
011200         88  PS-FIRST-CTOFF-READ-NO                VALUE 'N'.     01120000
011300         88  PS-FIRST-CTOFF-READ-YES               VALUE 'Y'.     01130061
011400     05  PS-VALID-CNTL-SW                PIC X(01) VALUE 'N'.     01140000
011500         88  PS-VALID-CNTL-NO                      VALUE 'N'.     01150000
011600         88  PS-VALID-CNTL-YES                     VALUE 'Y'.     01160061
011700     05  PS-CTOFF-ROW-FOUND-SW           PIC X(01) VALUE 'N'.     01170061
011800         88  PS-CTOFF-ROW-FOUND-NO                 VALUE 'N'.     01180061
011900         88  PS-CTOFF-ROW-FOUND-YES                VALUE 'Y'.     01190061
012000     05  PS-CTOFF-CSR-AT-END-SW          PIC X(01) VALUE 'N'.     01200061
012100         88  PS-CTOFF-CSR-AT-END-NO                VALUE 'N'.     01210061
012200         88  PS-CTOFF-CSR-AT-END-YES               VALUE 'Y'.     01220061
012300                                                                  01230000
012400 01  PROGRAM-VARIABLES.                                           01240000
012500     05  PV-SAVE-LOC-NBR                 PIC S9(04) VALUE +0 COMP.01250075
012600     05  PV-LOC-NBR                      PIC  X(04).              01260075
012700     05  PV-LOC-NBR-R REDEFINES PV-LOC-NBR                        01270075
012800                                         PIC  9(04).              01280075
012900     05  PV-RETRY-COUNT                  PIC S9(04) VALUE +0.     01290000
013000     05  PV-DEADLOCK-COUNT               PIC S9(04) VALUE +0.     01300000
013100                                                                  01310000
013200     05  PV-PARAGRAPH-NAME               PIC  X(30) VALUE SPACES. 01320000
013300     05  PV-ABEND-MESSAGE                PIC  X(75) VALUE SPACES. 01330000
013400     05  PV-OPERATION-ATTEMPTED          PIC  X(50) VALUE SPACES. 01340000
013500     05  PV-PAGE-COUNTER                 PIC S9(4)  VALUE ZEROES  01350061
013600                                                     COMP SYNC.   01360061
013700     05  PV-LINE-COUNTER                 PIC S9(4)  VALUE 99      01370061
013800                                                     COMP SYNC.   01380061
013900     05  PV-SQL-SUB                   PIC  9(03) VALUE ZERO.      01390061
014000     05  PV-NEW-STR-EXPTED-OH-QTY     PIC S9(09)     COMP.        01400061
014100     05  PV-SAVE-EXPTED-OH-QTY        PIC S9(09)     COMP.        01410084
014200                                                                  01420061
014300 01  PV-CC-ACTION-TYPE-REC.                                       01430061
014400     05  PV-CC-ACTION-TYPE               PIC X(08)   VALUE SPACES.01440061
014500         88  PV-CC-ACTION-TYPE-UPDATE      VALUE 'UPDATE  '.      01450061
014600         88  PV-CC-ACTION-TYPE-REPLACE     VALUE 'REPLACE '.      01460061
014700                                                                  01470061
014800 01  PA-PROGRAM-ACCUMULATORS.                                     01480000
014900     05  PA-RECORD-COUNTS.                                        01490000
015000         10  PA-INPUT-COUNT        PIC  9(09)  VALUE ZEROES.      01500000
015100         10  PA-UPDATE-COUNT       PIC  9(09)  VALUE ZEROES.      01510000
015200         10  PA-INSERT-COUNT       PIC  9(09)  VALUE ZEROES.      01520000
015300         10  PA-ZERO-COUNT         PIC  9(09)  VALUE ZEROES.      01530000
015400                                                                  01540000
015500     05  PA-STR-TOTAL-EXPTED-OH-QTY   PIC S9(09)     COMP.        01550084
015600     05  PA-FNL-TOTAL-EXPTED-OH-QTY   PIC S9(09)     COMP.        01560084
015700                                                                  01570084
015800                                                                  01580084
015900                                                                  01590084
016000                                                                  01600084
016100******************************************************************01610061
016200*   STANDARD REPORT HEADER FOR A 075 COLUMN REPORT.               01620092
016300******************************************************************01630061
016400     COPY DPWS075.                                                01640092
016500                                                                  01650061
016600 01  HL-HEADING-LINE1.                                            01660061
016800     05  FILLER                        PIC X(22)   VALUE SPACES.  01680099
016900     05  FILLER                        PIC X(25)   VALUE          01690097
017000         'CUTOFF STR-EXPTED-OH-QTY '.                             01700097
017100     05  HL1-ACTION-TYPE               PIC X(08)   VALUE SPACES.  01710082
017200     05  FILLER                        PIC X(78)   VALUE SPACES.  01720099
017300                                                                  01730061
017400 01  HL-HEADING-LINE2.                                            01740061
017500     05  FILLER                        PIC X(31)   VALUE SPACES.  01750097
017600     05  FILLER                        PIC X(08)   VALUE          01760089
017700         'FOR LOC '.                                              01770061
017800     05  HL2-LOC-NBR                   PIC X(04)   VALUE SPACES.  01780061
017900     05  FILLER                        PIC X(90)   VALUE SPACES.  01790097
018000                                                                  01800061
018100 01  HL-HEADING-LINE3.                                            01810061
018200     05  FILLER                        PIC X(41)   VALUE          01820075
018300         '                       OLD STR    NEW STR'.             01830077
018400     05  FILLER                        PIC X(12)   VALUE          01840084
018500         '     INP STR'.                                          01850084
018600     05  FILLER                        PIC X(92)   VALUE SPACES.  01860075
018700                                                                  01870061
018800 01  HL-HEADING-LINE4.                                            01880061
018900     05  FILLER                        PIC X(41)   VALUE          01890075
019000         '                        EXPTED     EXPTED'.             01900077
019100     05  FILLER                        PIC X(12)   VALUE          01910084
019200         '      EXPTED'.                                          01920084
019300     05  FILLER                        PIC X(80)   VALUE SPACES.  01930084
019400                                                                  01940061
019500 01  HL-HEADING-LINE5.                                            01950061
019600     05  FILLER                        PIC X(41)   VALUE          01960075
019700         '  ACTION   SKU          OH QTY     OH QTY'.             01970077
019800     05  FILLER                        PIC X(12)   VALUE          01980084
019900         '      OH QTY'.                                          01990084
020000     05  FILLER                        PIC X(80)   VALUE SPACES.  02000084
020100                                                                  02010061
020200 01  HL-HEADING-LINE6.                                            02020061
020300     05  FILLER                        PIC X(41)   VALUE          02030075
020400         '  ______   ________   ________   ________'.             02040077
020500     05  FILLER                        PIC X(12)   VALUE          02050087
020600         '    ________'.                                          02060087
020700     05  FILLER                        PIC X(80)   VALUE SPACES.  02070087
020800                                                                  02080061
020900 01  SL-SPACE-LINE                     PIC X(075)  VALUE SPACES.  02090092
021000                                                                  02100061
021100 01  DL-DETAIL-LINE.                                              02110061
021200     05  FILLER                        PIC X(02)   VALUE SPACE.   02120061
021300     05  DL-ACTION                     PIC X(07)   VALUE SPACES.  02130061
021400     05  FILLER                        PIC X(02)   VALUE SPACE.   02140061
021500     05  DL-SKU                        PIC X(08)   VALUE ZEROES.  02150061
021600     05  FILLER                        PIC X(04)   VALUE SPACE.   02160091
021700     05  DL-OLD-STR-EXPTED-OH-QTY      PIC ZZZZZZ9- VALUE ZEROS.  02170082
021800     05  FILLER                        PIC X(03)   VALUE SPACE.   02180091
021900     05  DL-NEW-STR-EXPTED-OH-QTY      PIC ZZZZZZ9- VALUE ZEROS.  02190082
022000     05  FILLER                        PIC X(04)   VALUE SPACE.   02200084
022100     05  DL-IN050-STR-EXPTED-OH-QTY    PIC ZZZZZZ9- VALUE ZEROS.  02210084
022200     05  FILLER                        PIC X(69)   VALUE SPACE.   02220086
022300                                                                  02230086
022400 01  DL-STR-TOTAL-LINE.                                           02240086
022500     05  FILLER                        PIC X(33)   VALUE SPACE.   02250096
022600     05  FILLER                        PIC X(06)   VALUE          02260089
022700         'TOTAL '.                                                02270095
022600     05  FILLER                        PIC X(07)   VALUE          02271098
022700         'RECV   '.                                               02272098
022800     05  DL-TOTAL-STR-EXPTED-OH-QTY    PIC ZZZZZZ9- VALUE ZEROS.  02280086
022900     05  FILLER                        PIC X(85)   VALUE SPACE.   02290097
023000                                                                  02300086
023100                                                                  02310087
023200 01  DL-FNL-TOTAL-LINE.                                           02320087
023300     05  FILLER                        PIC X(33)   VALUE SPACE.   02330096
023400     05  FILLER                        PIC X(06)   VALUE          02340089
023500         'TOTAL '.                                                02350095
023400     05  FILLER                        PIC X(07)   VALUE          02351098
023500         'RECV   '.                                               02352098
023600     05  DL-TOTAL-FNL-EXPTED-OH-QTY    PIC ZZZZZZ9- VALUE ZEROS.  02360087
023700     05  FILLER                        PIC X(85)   VALUE SPACE.   02370096
023800                                                                  02380087
023900 01  DL-STR-DASH-LINE.                                            02390087
024000     05  FILLER                        PIC X(45)   VALUE SPACE.   02400088
024100     05  FILLER                        PIC X(08)   VALUE          02410087
024200         '________'.                                              02420087
024300     05  FILLER                        PIC X(80)   VALUE SPACE.   02430088
024400                                                                  02440086
024500 01  RUN-TIME.                                                    02450061
024600     05  R-HR                          PIC 99.                    02460061
024700     05  R-MIN                         PIC 99.                    02470061
024800     05  R-SEC                         PIC 99.                    02480061
024900     05  R-TH                          PIC 99.                    02490061
025000                                                                  02500061
025100 01  DATE-IN.                                                     02510061
025200     05 DATE-IN-YY                     PIC XX.                    02520061
025300     05 DATE-IN-MM                     PIC XX.                    02530061
025400     05 DATE-IN-DD                     PIC XX.                    02540061
025500                                                                  02550061
025600******************************************************************02560000
025700* INDR050 - CUTOFF DATABASE CONSOLIDATED EXTRACT COPYBOOK         02570000
025800******************************************************************02580000
025900     COPY INRD050.                                                02590000
026000                                                                  02600000
026100******************************************************************02610000
026200*  DB2 ERROR MESSAGES FORMAT AREA.                                02620000
026300******************************************************************02630000
026400     COPY DPWS004.                                                02640000
026500                                                                  02650000
026600******************************************************************02660000
026700*  USED FOR DB2 ERRORS                                            02670000
026800******************************************************************02680000
026900     EXEC SQL                                                     02690000
027000         INCLUDE SQLCA                                            02700000
027100     END-EXEC.                                                    02710000
027200                                                                  02720000
027300******************************************************************02730000
027400*  INVENTORY CUTOFF TABLE                                         02740000
027500******************************************************************02750000
027600     EXEC SQL                                                     02760000
027700         INCLUDE INT00000                                         02770000
027800     END-EXEC.                                                    02780000
027900                                                                  02790000
028000******************************************************************02800061
028100*  SQL DB2 INT_INV_CTOFF                                          02810061
028200******************************************************************02820061
028300     EXEC SQL                                                     02830061
028400         DECLARE CTOFF_CSR  CURSOR FOR                            02840061
028500             SELECT LOC_NBR                                       02850061
028600                   ,SKU_NBR                                       02860061
028700                   ,STR_EXPTED_OH_QTY                             02870061
028800             FROM INT_INV_CTOFF                                   02880061
028900             WHERE LOC_NBR           =  :IN050-LOC-NBR            02890073
029000               AND STR_EXPTED_OH_QTY <> :PC-ZEROS                 02900061
029100             ORDER BY SKU_NBR                                     02910061
029200     END-EXEC.                                                    02920061
029300                                                                  02930061
029400*-------------------*                                             02940000
029500 PROCEDURE DIVISION.                                              02950000
029600*-------------------*                                             02960000
029700                                                                  02970000
029800 0000-INKUP010.                                                   02980000
029900                                                                  02990000
030000     PERFORM 1000-INITIALIZATION.                                 03000000
030100                                                                  03010000
030200     IF PS-VALID-CNTL-YES                                         03020000
030300         PERFORM 2000-PROCESS-INPUT                               03030000
030400              UNTIL PS-AT-END-CTOFF-FILE-YES                      03040000
030500     END-IF.                                                      03050000
030600                                                                  03060000
030700     PERFORM 8000-EOJ-ROUTINE.                                    03070000
030800                                                                  03080000
030900     STOP RUN.                                                    03090000
031000                                                                  03100000
031100******************************************************************03110000
031200* OPEN INPUT FILE , INITIALIZE COUNTERS , READ FIRST INPUT RECORD 03120000
031300******************************************************************03130000
031400                                                                  03140000
031500 1000-INITIALIZATION.                                             03150000
031600                                                                  03160000
031700     OPEN INPUT CC-ACTION-TYPE-CNTL-FILE                          03170000
031800                CUTOFF-UPDATES-FILE.                              03180000
031900     OPEN OUTPUT REPORT-AUDIT-FILE.                               03190061
032000                                                                  03200000
032100     PERFORM 1100-INITIALIZE-HEADER.                              03210061
032200     PERFORM 1200-READ-CNTL-FILE.                                 03220061
032300                                                                  03230000
032400     SET PS-FIRST-CTOFF-READ-YES TO TRUE.                         03240000
032500     SET PS-AT-END-CTOFF-FILE-NO TO TRUE.                         03250000
032600                                                                  03260061
032700 1100-INITIALIZE-HEADER.                                          03270061
032800                                                                  03280061
032900****************************************************************  03290061
033000*    SET UP THE STANDARD PAGE HEADER.                             03300061
033100*    ACCEPT THE RUN DATE AND RUN TIME FROM THE SYSTEM.            03310061
033200****************************************************************  03320061
033300     ACCEPT DATE-IN  FROM DATE.                                   03330061
033400     ACCEPT RUN-TIME FROM TIME.                                   03340061
033500     MOVE DATE-IN-MM TO DP075-RUN-MONTH.                          03350092
033600     MOVE DATE-IN-DD TO DP075-RUN-DAY.                            03360092
033700     MOVE DATE-IN-YY TO DP075-RUN-YEAR.                           03370092
033800     MOVE R-HR       TO DP075-RUN-HOUR.                           03380092
033900     MOVE R-MIN      TO DP075-RUN-MINUTE.                         03390092
034000     MOVE PC-PROGRAM-NAME TO DP075-PROGRAM-NAME.                  03400092
034100     MOVE 1               TO DP075-REPORT-NUMBER.                 03410092
034200                                                                  03420061
034300******************************************************************03430000
034400* READS THE CONTROL CARD FILE                                     03440000
034500******************************************************************03450000
034600                                                                  03460061
034700 1200-READ-CNTL-FILE.                                             03470000
034800                                                                  03480000
034900     SET PS-VALID-CNTL-YES  TO TRUE.                              03490061
035000                                                                  03500061
035100     READ CC-ACTION-TYPE-CNTL-FILE INTO                           03510000
035200                        PV-CC-ACTION-TYPE-REC                     03520000
035300         AT END                                                   03530000
035400             MOVE +4003                 TO ABEND-CODE             03540061
035500             DISPLAY '**  ABEND     **'                           03550061
035600             DISPLAY '**  PROGRAM   **  =  INKUP020'              03560061
035700             DISPLAY '**  EMPTY CONTROL CARD FILE '               03570061
035800             SET PS-VALID-CNTL-NO TO TRUE                         03580061
035900             CALL 'ILBOABN0'  USING ABEND-CODE                    03590061
036000     END-READ.                                                    03600000
036100                                                                  03610061
036200     DISPLAY '1200 ACTION TYPE =' PV-CC-ACTION-TYPE.              03620064
036300     IF (PV-CC-ACTION-TYPE-UPDATE OR                              03630061
036400        PV-CC-ACTION-TYPE-REPLACE)                                03640061
036500         MOVE PV-CC-ACTION-TYPE     TO HL1-ACTION-TYPE            03650082
036600     ELSE                                                         03660072
036700         MOVE +4004                 TO ABEND-CODE                 03670072
036800         DISPLAY '**  ABEND     **'                               03680072
036900         DISPLAY '**  PROGRAM   **  =  INKUP020'                  03690072
037000         DISPLAY '**  BAD TYPE IN CONTROL CARD '                  03700073
037100         DISPLAY '**  PV-CC-ACTION-TYPE=' PV-CC-ACTION-TYPE       03710073
037200         DISPLAY '**  SHOULD BE UPDATE OR REPLACE '               03720073
037300         SET PS-VALID-CNTL-NO TO TRUE                             03730072
037400         CALL 'ILBOABN0'  USING ABEND-CODE                        03740073
037500                                                                  03750073
037600     END-IF.                                                      03760072
037700                                                                  03770061
037800                                                                  03780061
037900******************************************************************03790000
038000* PROCESS THE SORTED/CONDENSED FILE - UPDATE OR INSERT AS NEEDED  03800000
038100******************************************************************03810000
038200 2000-PROCESS-INPUT.                                              03820000
038300                                                                  03830000
038400     PERFORM 2100-READ-CTOFF-FILE.                                03840000
038500                                                                  03850000
038800     IF PS-AT-END-CTOFF-FILE-YES                                  03880000
038900         IF PS-FIRST-CTOFF-READ-YES                               03890000
039000             MOVE PC-4050 TO RETURN-CODE                          03900000
039100             DISPLAY 'INKUP020 NOTHING TO PROCESS '               03910061
039200         END-IF                                                   03920061
039300     ELSE                                                         03930061
039400         SET PS-FIRST-CTOFF-READ-NO TO TRUE                       03940072
039500         PERFORM 2200-PROCESS-BY-TYPE                             03950061
039600         ADD +1 TO PA-INPUT-COUNT                                 03960069
039700     END-IF.                                                      03970000
039800                                                                  03980000
039900******************************************************************03990000
040000* READS THE CUTOFF UPDATES FILE INTO THE INRD050 LAYOUT           04000000
040100******************************************************************04010000
040200                                                                  04020000
040300 2100-READ-CTOFF-FILE.                                            04030000
040400                                                                  04040099
040500     READ CUTOFF-UPDATES-FILE INTO IN050-CTOFF-CON-EXTR-RECORD    04050000
040600        AT END                                                    04060000
040700          SET PS-AT-END-CTOFF-FILE-YES TO TRUE                    04070000
040800     END-READ.                                                    04080000
040900                                                                  04090000
041000                                                                  04100000
041100******************************************************************04110000
041200* PROCESSES CUTOFF UPDATES FILE BASED UPON THE TYPE SPECIFIED     04120072
041300* IN THE CONTROL FILE RECORD. TYPE HAS ALREADY BEEN VALIDATED.    04130000
041400* PV-SAVE-LOC-NBR OF ZEROS IS THE FIRST TIME PROCESS FOR THE      04140072
041500* PROGRAM. PV-SAVE-LOC-NBR NOT EQUAL INPUT LOC NBR IS THE FIRST   04150072
041600* TIME FOR THE INCOMING STORE. FOR THE 'REPLACE' TYPE, THE FIRST  04160072
041700* TIME PROCESS TO ZERO OUT THE TABLE ROWS FOR THAT STORE MUST BE  04170072
041800* DONE.                                                           04180072
041900******************************************************************04190000
042000                                                                  04200000
042100 2200-PROCESS-BY-TYPE.                                            04210061
042200                                                                  04220072
042300                                                                  04230099
042400     IF IN050-LOC-NBR NOT = PV-SAVE-LOC-NBR                       04240082
042500         AND PV-SAVE-LOC-NBR NOT = ZEROS                          04250082
042600             PERFORM 6500-PRINT-STORE-TOTALS                      04260084
042700             ADD PA-STR-TOTAL-EXPTED-OH-QTY TO                    04270084
042800                            PA-FNL-TOTAL-EXPTED-OH-QTY            04280084
042900             MOVE ZEROS TO PA-STR-TOTAL-EXPTED-OH-QTY             04290087
043000             COMPUTE PV-LINE-COUNTER = PC-LINE-MAX + 1            04300083
043100     END-IF.                                                      04310082
043200                                                                  04320082
043300     ADD IN050-STR-EXPTED-OH-QTY TO PA-STR-TOTAL-EXPTED-OH-QTY.   04330084
043400                                                                  04340084
043500     IF PV-CC-ACTION-TYPE-UPDATE                                  04350082
044000         MOVE IN050-LOC-NBR TO PV-SAVE-LOC-NBR                    04351091
043600         PERFORM 2300-APPLY-CHANGE                                04360061
043700     ELSE                                                         04370061
043800         IF PV-SAVE-LOC-NBR = ZEROS OR                            04380072
043900            PV-SAVE-LOC-NBR NOT EQUAL IN050-LOC-NBR               04390072
044000             MOVE IN050-LOC-NBR TO PV-SAVE-LOC-NBR                04400073
044100             PERFORM 2400-SET-EXPTED-TO-ZERO                      04410000
044200             PERFORM 2300-APPLY-CHANGE                            04420000
044300         ELSE                                                     04430000
044400             PERFORM 2300-APPLY-CHANGE                            04440000
044500         END-IF                                                   04450000
044600     END-IF.                                                      04460000
044700                                                                  04470000
044800                                                                  04480000
044900******************************************************************04490000
045000* APPLIES CHANGE TO STR_EXPTED_OH_QTY.                            04500000
045100* WILL INSERT NEW ROW IF NONE EXISTS.                             04510000
045200* IF PROCESS TYPE IS REPLACE, STR_EXPTED_OH_QTY HAS ALREADY       04520061
045300* BEEN ZEROED OUT SO COMPUTE BELOW IS REALLY A REPLACE OF THE QTY 04530061
045400******************************************************************04540000
045500                                                                  04550000
045600 2300-APPLY-CHANGE.                                               04560061
045700                                                                  04570000
045800     SET PS-CTOFF-ROW-FOUND-NO TO TRUE.                           04580000
045900                                                                  04590000
046000     PERFORM 4000-GET-CTOFF-ROW.                                  04600000
046100                                                                  04610000
046200     IF PS-CTOFF-ROW-FOUND-YES                                    04620000
046300         COMPUTE PV-NEW-STR-EXPTED-OH-QTY                         04630000
046400                               = INT00000-STR-EXPTED-OH-QTY +     04640000
046500                                 IN050-STR-EXPTED-OH-QTY          04650061
046600         PERFORM 4100-REPLACE-CTOFF                               04660000
046700         PERFORM 6210-AUDIT-UPDATE                                04670080
046800         ADD +1 TO PA-UPDATE-COUNT                                04680069
046900     ELSE                                                         04690000
047000         PERFORM 4200-INSERT-CTOFF                                04700000
047100     END-IF.                                                      04710000
047200                                                                  04720000
047300                                                                  04730000
047400******************************************************************04740000
047500* ZEROS OUT EXISTING STR_EXPTED_OH_QTY FOR PARTICULAR LOC         04750000
047600* AND THEN DOES A COMMIT. THIS IS DONE AS A FETCH AND             04760000
047700* INDIVIDUAL UPDATE SO THAT AN AUDIT REPORT CAN BE PRODUCED.      04770061
047800******************************************************************04780000
047900                                                                  04790000
048000 2400-SET-EXPTED-TO-ZERO.                                         04800000
048100                                                                  04810000
048200     PERFORM 2410-OPEN-CTOFF-CUR.                                 04820000
048300                                                                  04830000
048400     SET PS-CTOFF-CSR-AT-END-NO TO TRUE.                          04840000
048500                                                                  04850000
048600     PERFORM 2420-FETCH-AND-UPDATE-CTOFF                          04860000
048700         UNTIL PS-CTOFF-CSR-AT-END-YES.                           04870000
048800                                                                  04880000
048900     PERFORM 2475-CLOSE-CTOFF-CUR.                                04890000
049000                                                                  04900000
049100     PERFORM 2490-COMMIT-CTOFF-UPD.                               04910000
049200                                                                  04920000
049300 2410-OPEN-CTOFF-CUR.                                             04930000
049400                                                                  04940061
049500     EXEC SQL                                                     04950061
049600         OPEN CTOFF_CSR                                           04960061
049700     END-EXEC.                                                    04970061
049800                                                                  04980061
049900     EVALUATE SQLCODE                                             04990061
050000         WHEN +0                                                  05000061
050100             CONTINUE                                             05010061
050200         WHEN OTHER                                               05020061
050300             MOVE '2410-OPEN-CTOFF-CSR  ' TO PV-PARAGRAPH-NAME    05030000
050400             MOVE PE-MSG-01 TO PV-OPERATION-ATTEMPTED             05040000
050500             PERFORM 9999-SQL-ABEND                               05050000
050600     END-EVALUATE.                                                05060061
050700                                                                  05070061
050800 2420-FETCH-AND-UPDATE-CTOFF.                                     05080000
050900                                                                  05090000
051000     PERFORM WITH TEST AFTER                                      05100000
051100         VARYING PV-SQL-SUB FROM 1 BY 1                           05110000
051200         UNTIL  (PV-SQL-SUB > PC-MAX-DEADLOCKS                    05120000
051300            OR   SQLCODE = 0                                      05130000
051400            OR   SQLCODE = +100)                                  05140000
051500          EXEC SQL                                                05150061
051600              FETCH CTOFF_CSR                                     05160061
051700              INTO :INT00000-LOC-NBR                              05170061
051800                  ,:INT00000-SKU-NBR                              05180061
051900                  ,:INT00000-STR-EXPTED-OH-QTY                    05190061
052000          END-EXEC                                                05200061
052100     END-PERFORM.                                                 05210061
052200                                                                  05220061
052300     EVALUATE SQLCODE                                             05230000
052400         WHEN 0                                                   05240000
052500             PERFORM 6220-AUDIT-ZERO                              05250061
052600             ADD +1 TO PA-ZERO-COUNT                              05260069
052700             MOVE ZEROS TO PV-NEW-STR-EXPTED-OH-QTY               05270000
052800             PERFORM 4100-REPLACE-CTOFF                           05280061
052900         WHEN +100                                                05290000
053000             SET PS-CTOFF-CSR-AT-END-YES TO TRUE                  05300000
053100         WHEN OTHER                                               05310061
053200             MOVE '2420-FETCH-AND-UPDATE-CTOFF '                  05320000
053300                                TO PV-PARAGRAPH-NAME              05330000
053400             MOVE PE-MSG-03     TO PV-OPERATION-ATTEMPTED         05340000
053500             PERFORM 9999-SQL-ABEND                               05350000
053600     END-EVALUATE.                                                05360000
053700                                                                  05370061
053800                                                                  05380061
053900 2475-CLOSE-CTOFF-CUR.                                            05390000
054000                                                                  05400061
054100     EXEC SQL                                                     05410061
054200         CLOSE CTOFF_CSR                                          05420061
054300     END-EXEC.                                                    05430061
054400                                                                  05440061
054500     EVALUATE SQLCODE                                             05450061
054600         WHEN +0                                                  05460061
054700             CONTINUE                                             05470061
054800         WHEN OTHER                                               05480061
054900             MOVE '2490-CLOSE-CTOFF-CSR  ' TO PV-PARAGRAPH-NAME   05490000
055000             MOVE PE-MSG-02 TO PV-OPERATION-ATTEMPTED             05500000
055100             PERFORM 9999-SQL-ABEND                               05510000
055200     END-EVALUATE.                                                05520061
055300                                                                  05530000
055400                                                                  05540000
055500 2490-COMMIT-CTOFF-UPD.                                           05550000
055600                                                                  05560000
055700     EXEC SQL                                                     05570000
055800         COMMIT                                                   05580000
055900     END-EXEC.                                                    05590000
056000                                                                  05600000
056100     IF SQLCODE = 0                                               05610000
056200         CONTINUE                                                 05620061
056300     ELSE                                                         05630000
056400         MOVE PE-MSG-07                  TO PV-OPERATION-ATTEMPTED05640000
056500         MOVE  '* 2490-COMMIT-CTOFF-UPD' TO PV-PARAGRAPH-NAME     05650000
056600         PERFORM 9999-SQL-ABEND                                   05660000
056700     END-IF.                                                      05670000
056800                                                                  05680061
056900******************************************************************05690000
057000* THE 4000 SERIES PARAGRAPHS DO THE GET AND UPDATE OR INSERT      05700000
057100* FO THE CTOFF TABLE.                                             05710000
057200******************************************************************05720000
057300                                                                  05730000
057400 4000-GET-CTOFF-ROW.                                              05740000
057500                                                                  05750000
057600     PERFORM WITH TEST AFTER                                      05760000
057700         VARYING PV-SQL-SUB FROM 1 BY 1                           05770000
057800         UNTIL  (PV-SQL-SUB > PC-MAX-DEADLOCKS                    05780000
057900            OR   SQLCODE = 0                                      05790000
058000            OR   SQLCODE = +100)                                  05800000
058100         EXEC SQL                                                 05810000
058200             SELECT LOC_NBR                                       05820079
058300                   ,SKU_NBR                                       05830079
058400                   ,STR_EXPTED_OH_QTY                             05840079
058500               INTO :INT00000-LOC-NBR                             05850079
058600                   ,:INT00000-SKU-NBR                             05860079
058700                   ,:INT00000-STR-EXPTED-OH-QTY                   05870079
058800             FROM INT_INV_CTOFF                                   05880000
058900             WHERE LOC_NBR = :IN050-LOC-NBR                       05890000
059000               AND SKU_NBR = :IN050-SKU-NBR                       05900000
059100                                                                  05910000
059200         END-EXEC                                                 05920000
059300     END-PERFORM.                                                 05930000
059400                                                                  05940000
059500     EVALUATE TRUE                                                05950061
059600         WHEN SQLCODE = +100                                      05960061
059700             SET PS-CTOFF-ROW-FOUND-NO TO TRUE                    05970000
059800         WHEN SQLCODE = 0                                         05980061
059900             MOVE INT00000-STR-EXPTED-OH-QTY                      05990061
060000                                        TO PV-SAVE-EXPTED-OH-QTY  06000061
060100             SET PS-CTOFF-ROW-FOUND-YES TO TRUE                   06010000
060200         WHEN SQLWARN NOT = SPACES                                06020061
060300         WHEN SQLCODE NOT = ZERO                                  06030061
060400             MOVE '4000-GET-CTOFF-ROW '                           06040061
060500                            TO PV-PARAGRAPH-NAME                  06050061
060600             MOVE PE-MSG-05 TO PV-OPERATION-ATTEMPTED             06060061
060700             PERFORM 9999-SQL-ABEND                               06070061
060800     END-EVALUATE.                                                06080061
060900                                                                  06090000
061000                                                                  06100000
061100 4100-REPLACE-CTOFF.                                              06110000
061200                                                                  06120000
061300     PERFORM WITH TEST AFTER                                      06130000
061400         VARYING PV-SQL-SUB FROM 1 BY 1                           06140000
061500         UNTIL  (PV-SQL-SUB > PC-MAX-DEADLOCKS                    06150000
061600            OR   SQLCODE = 0)                                     06160000
061700         EXEC SQL                                                 06170000
061800             UPDATE INT_INV_CTOFF                                 06180000
061900             SET STR_EXPTED_OH_QTY = :PV-NEW-STR-EXPTED-OH-QTY    06190061
062000             WHERE LOC_NBR = :INT00000-LOC-NBR                    06200079
062100               AND SKU_NBR = :INT00000-SKU-NBR                    06210079
062200                                                                  06220000
062300         END-EXEC                                                 06230000
062400     END-PERFORM.                                                 06240000
062500                                                                  06250000
062600     EVALUATE TRUE                                                06260061
062700         WHEN SQLCODE = 0                                         06270061
062800             CONTINUE                                             06280080
062900         WHEN SQLWARN NOT = SPACES                                06290061
063000         WHEN SQLCODE NOT = ZERO                                  06300061
063100             MOVE '4100-REPLACE-CTOFF '                           06310061
063200                            TO PV-PARAGRAPH-NAME                  06320061
063300             MOVE PE-MSG-06 TO PV-OPERATION-ATTEMPTED             06330061
063400             PERFORM 9999-SQL-ABEND                               06340061
063500     END-EVALUATE.                                                06350061
063600                                                                  06360000
063700                                                                  06370000
063800 4200-INSERT-CTOFF.                                               06380000
063900                                                                  06390000
064000     MOVE ZEROS                    TO INT00000-CTOFF-OH-QTY       06400076
064100                                      INT00000-IN-TRNST-CTOFF-QTY 06410076
064200                                      INT00000-POST-FSH-RCPT-QTY. 06420076
064300     MOVE IN050-LOC-NBR            TO INT00000-LOC-NBR.           06430000
064400     MOVE IN050-SKU-NBR            TO INT00000-SKU-NBR.           06440000
064500     MOVE IN050-PROCESS-DATE       TO INT00000-LAST-UPD-DTE.      06450000
064600     MOVE PC-PROGRAM-NAME          TO INT00000-LAST-UPD-BY-USR-ID.06460000
064700     MOVE IN050-STR-EXPTED-OH-QTY  TO INT00000-STR-EXPTED-OH-QTY. 06470000
064800                                                                  06480000
064900     PERFORM WITH TEST AFTER                                      06490000
065000         VARYING PV-SQL-SUB FROM 1 BY 1                           06500000
065100         UNTIL  (PV-SQL-SUB > PC-MAX-DEADLOCKS                    06510000
065200            OR   SQLCODE = 0)                                     06520000
065300         EXEC SQL                                                 06530000
065400             INSERT INTO INT_INV_CTOFF                            06540000
065500                (LOC_NBR                                          06550061
065600                ,SKU_NBR                                          06560061
065700                ,CTOFF_OH_QTY                                     06570061
065800                ,IN_TRNST_CTOFF_QTY                               06580061
065900                ,POST_FSH_RCPT_QTY                                06590061
066000                ,LAST_UPD_DTE                                     06600061
066100                ,LAST_UPD_BY_USR_ID                               06610061
066200                ,STR_EXPTED_OH_QTY)                               06620061
066300                 VALUES (:INT00000-LOC-NBR                        06630000
066400                        ,:INT00000-SKU-NBR                        06640000
066500                        ,:INT00000-CTOFF-OH-QTY                   06650000
066600                        ,:INT00000-IN-TRNST-CTOFF-QTY             06660000
066700                        ,:INT00000-POST-FSH-RCPT-QTY              06670061
066800                        ,:INT00000-LAST-UPD-DTE                   06680061
066900                        ,:INT00000-LAST-UPD-BY-USR-ID             06690000
067000                        ,:INT00000-STR-EXPTED-OH-QTY)             06700061
067100         END-EXEC                                                 06710000
067200     END-PERFORM.                                                 06720000
067300                                                                  06730000
067400                                                                  06740000
067500     EVALUATE TRUE                                                06750061
067600         WHEN SQLCODE = +0                                        06760061
067700             ADD +1 TO PA-INSERT-COUNT                            06770069
067800             PERFORM 6200-AUDIT-INSERT                            06780000
067900         WHEN SQLWARN NOT = SPACES                                06790061
068000         WHEN SQLCODE NOT = ZERO                                  06800061
068100             MOVE '4200-INSERT-CTOFF '                            06810061
068200                            TO PV-PARAGRAPH-NAME                  06820061
068300             MOVE PE-MSG-04 TO PV-OPERATION-ATTEMPTED             06830061
068400             PERFORM 9999-SQL-ABEND                               06840061
068500     END-EVALUATE.                                                06850061
068600                                                                  06860000
068700                                                                  06870000
068800                                                                  06880000
068900 6000-PRINT-DETAIL-LINE.                                          06890061
069000****************************************************************  06900061
069100*    PRINT DETAIL LINE.                                           06910061
069200*                                                                 06920061
069300*    PERFORMED BY 2000-PROCESS.                                   06930061
069400****************************************************************  06940061
069500                                                                  06950061
069600     IF PV-LINE-COUNTER >= PC-LINE-MAX                            06960061
069700        PERFORM 6010-PRINT-HEADERS.                               06970061
069800     WRITE REPORT-AUDIT-RECORD                                    06980061
069900         FROM DL-DETAIL-LINE                                      06990061
070000         AFTER ADVANCING 1 LINE.                                  07000061
070100     ADD 1 TO PV-LINE-COUNTER.                                    07010061
070200                                                                  07020061
070300     EJECT                                                        07030061
070400                                                                  07040061
070500 6010-PRINT-HEADERS.                                              07050061
070600                                                                  07060061
070700****************************************************************  07070061
070800*    PRINT THE PAGE HEADERS.                                      07080061
070900*                                                                 07090061
071000*    PERFORMED BY 6000-DETAIL-PRINT-LINE                          07100061
071100****************************************************************  07110061
071200                                                                  07120061
071300     ADD  1               TO PV-PAGE-COUNTER.                     07130061
071400                                                                  07140061
071500     MOVE PV-PAGE-COUNTER TO DP075-PAGE-NUMBER.                   07150092
071600                                                                  07160061
071700     WRITE REPORT-AUDIT-RECORD                                    07170061
071800         FROM DP075-STANDARD-HEADER-75-COLS                       07180094
071900         AFTER ADVANCING PAGE.                                    07190061
072000                                                                  07200061
072100     WRITE REPORT-AUDIT-RECORD                                    07210061
072200         FROM HL-HEADING-LINE1                                    07220061
072300         AFTER ADVANCING 2 LINE.                                  07230061
072400                                                                  07240061
072500     WRITE REPORT-AUDIT-RECORD                                    07250061
072600         FROM HL-HEADING-LINE2                                    07260061
072700         AFTER ADVANCING 1 LINE.                                  07270061
072800                                                                  07280061
072900     WRITE REPORT-AUDIT-RECORD                                    07290061
073000         FROM HL-HEADING-LINE3                                    07300061
073100         AFTER ADVANCING 2 LINE.                                  07310099
073200                                                                  07320061
073300     WRITE REPORT-AUDIT-RECORD                                    07330061
073400         FROM HL-HEADING-LINE4                                    07340061
073500         AFTER ADVANCING 1 LINE.                                  07350061
073600                                                                  07360061
073700     WRITE REPORT-AUDIT-RECORD                                    07370061
073800         FROM HL-HEADING-LINE5                                    07380061
073900         AFTER ADVANCING 1 LINE.                                  07390061
074000                                                                  07400061
074100     WRITE REPORT-AUDIT-RECORD                                    07410061
074200         FROM HL-HEADING-LINE6                                    07420061
074300         AFTER ADVANCING 1 LINE.                                  07430061
074400                                                                  07440061
074500     WRITE REPORT-AUDIT-RECORD                                    07450061
074600         FROM SL-SPACE-LINE                                       07460061
074700         AFTER ADVANCING 1 LINE.                                  07470061
074800                                                                  07480061
074900     MOVE 11 TO PV-LINE-COUNTER.                                  07490099
075000                                                                  07500061
075100     EJECT                                                        07510061
075200                                                                  07520061
075300                                                                  07530061
075400******************************************************************07540000
075500* PROCESS THE SORTED/CONDENSED FILE - INSERT                      07550000
075600******************************************************************07560000
075700 6200-AUDIT-INSERT.                                               07570085
075800                                                                  07580000
075900     MOVE IN050-LOC-NBR               TO PV-LOC-NBR-R.            07590075
076000     MOVE PV-LOC-NBR                  TO HL2-LOC-NBR.             07600075
076100     MOVE 'INSERT'                    TO DL-ACTION.               07610061
076200     MOVE IN050-SKU-NBR               TO DL-SKU.                  07620061
076300     MOVE ZEROS                       TO                          07630078
076400                                      DL-OLD-STR-EXPTED-OH-QTY.   07640078
076500     MOVE IN050-STR-EXPTED-OH-QTY     TO                          07650078
076600                                      DL-NEW-STR-EXPTED-OH-QTY.   07660078
076700     MOVE IN050-STR-EXPTED-OH-QTY     TO                          07670086
076800                                      DL-IN050-STR-EXPTED-OH-QTY. 07680085
076900                                                                  07690061
077000     PERFORM 6000-PRINT-DETAIL-LINE.                              07700061
077100                                                                  07710061
077200                                                                  07720061
077300******************************************************************07730000
077400* PROCESS THE SORTED/CONDENSED FILE - UPDATE OR REPLACE           07740000
077500******************************************************************07750000
077600 6210-AUDIT-UPDATE.                                               07760000
077700                                                                  07770000
077800     MOVE IN050-LOC-NBR               TO PV-LOC-NBR-R.            07780075
077900     MOVE PV-LOC-NBR                  TO HL2-LOC-NBR.             07790075
078000     MOVE PV-CC-ACTION-TYPE           TO DL-ACTION.               07800061
078100     MOVE IN050-SKU-NBR               TO DL-SKU.                  07810061
078200     MOVE PV-SAVE-EXPTED-OH-QTY       TO                          07820061
078300                                      DL-OLD-STR-EXPTED-OH-QTY.   07830061
078400     MOVE PV-NEW-STR-EXPTED-OH-QTY    TO                          07840061
078500                                      DL-NEW-STR-EXPTED-OH-QTY.   07850061
078600     MOVE IN050-STR-EXPTED-OH-QTY     TO                          07860086
078700                                      DL-IN050-STR-EXPTED-OH-QTY. 07870084
078800                                                                  07880061
078900     PERFORM 6000-PRINT-DETAIL-LINE.                              07890061
079000                                                                  07900061
079100******************************************************************07910000
079200* ZERO OUT ALL OF THE STR-EXPTED-OH-QTY                           07920000
079300******************************************************************07930000
079400 6220-AUDIT-ZERO.                                                 07940000
079500                                                                  07950000
079600     MOVE IN050-LOC-NBR               TO PV-LOC-NBR-R.            07960075
079700     MOVE PV-LOC-NBR                  TO HL2-LOC-NBR.             07970075
079800     MOVE 'ZERO   '                   TO DL-ACTION.               07980061
079900     MOVE INT00000-SKU-NBR            TO DL-SKU.                  07990061
080000     MOVE INT00000-STR-EXPTED-OH-QTY  TO                          08000061
080100                                      DL-OLD-STR-EXPTED-OH-QTY.   08010061
080200     MOVE ZEROS                       TO                          08020081
080300                                      DL-NEW-STR-EXPTED-OH-QTY.   08030061
080400     MOVE ZEROS                       TO                          08040084
080500                                      DL-IN050-STR-EXPTED-OH-QTY. 08050084
080600                                                                  08060061
080700     PERFORM 6000-PRINT-DETAIL-LINE.                              08070061
080800                                                                  08080061
080900 6500-PRINT-STORE-TOTALS.                                         08090086
081000                                                                  08100086
081100     IF PV-LINE-COUNTER >= (PC-LINE-MAX - 3)                      08110086
081200        PERFORM 6010-PRINT-HEADERS.                               08120086
081300                                                                  08130086
081400     WRITE REPORT-AUDIT-RECORD                                    08140086
081500         FROM DL-STR-DASH-LINE                                    08150086
081600         AFTER ADVANCING 1 LINE.                                  08160086
081700                                                                  08170086
081800     MOVE PA-STR-TOTAL-EXPTED-OH-QTY TO                           08180086
081900                                  DL-TOTAL-STR-EXPTED-OH-QTY.     08190086
082000                                                                  08200086
082100     WRITE REPORT-AUDIT-RECORD                                    08210086
082200         FROM DL-STR-TOTAL-LINE                                   08220086
082300         AFTER ADVANCING 2 LINE.                                  08230099
082400                                                                  08240086
082500                                                                  08250087
082600 6600-PRINT-FINAL-TOTALS.                                         08260087
082700                                                                  08270087
082800     MOVE 'ALL ' TO HL2-LOC-NBR.                                  08280087
082900                                                                  08290087
083000     PERFORM 6010-PRINT-HEADERS.                                  08300087
083100                                                                  08310087
083200     WRITE REPORT-AUDIT-RECORD                                    08320087
083300         FROM DL-STR-DASH-LINE                                    08330087
083400         AFTER ADVANCING 1 LINE.                                  08340087
083500                                                                  08350087
083600     MOVE PA-FNL-TOTAL-EXPTED-OH-QTY TO                           08360087
083700                                  DL-TOTAL-FNL-EXPTED-OH-QTY.     08370087
083800                                                                  08380087
083900     WRITE REPORT-AUDIT-RECORD                                    08390087
084000         FROM DL-FNL-TOTAL-LINE                                   08400087
084100         AFTER ADVANCING 2 LINE.                                  08410099
084200                                                                  08420087
084300                                                                  08430087
084400******************************************************************08440000
084500*  RESET STATUS CODE, DISPLAY FINAL COUNTS , CLOSE INPUT FILE    *08450000
084600******************************************************************08460000
084700 8000-EOJ-ROUTINE.                                                08470000
084800                                                                  08480000
084900     PERFORM 6500-PRINT-STORE-TOTALS.                             08490087
085000     ADD PA-STR-TOTAL-EXPTED-OH-QTY TO                            08500087
085100                            PA-FNL-TOTAL-EXPTED-OH-QTY.           08510087
085200     PERFORM 6600-PRINT-FINAL-TOTALS.                             08520087
085300                                                                  08530087
085400     DISPLAY '**********************************'.                08540000
085500     DISPLAY '******* INKUP020 RUN STATS *******'.                08550061
085600     DISPLAY '**********************************'.                08560000
085700     DISPLAY 'INPUT RECORDS PROCESSED: ' PA-INPUT-COUNT.          08570000
085800     DISPLAY 'INSERTS PROCESSED:       ' PA-INSERT-COUNT.         08580000
085900     DISPLAY 'UPDATES PROCESSED:       ' PA-UPDATE-COUNT.         08590000
086000     DISPLAY 'CTOFF ZEROED     :       ' PA-ZERO-COUNT.           08600000
086100                                                                  08610000
086200     CLOSE CUTOFF-UPDATES-FILE                                    08620000
086300           REPORT-AUDIT-FILE.                                     08630061
086400                                                                  08640000
086500******************************************************************08650000
086600*  THIS ROUTINE FORCES AN ABEND DUE TO A SQLCODE -911 (3 TIMES)   08660000
086700******************************************************************08670000
086800 9000-DEADLOCK-ERROR.                                             08680000
086900                                                                  08690000
087000         MOVE PE-MSG-06             TO PV-OPERATION-ATTEMPTED     08700000
087100         PERFORM 9999-SQL-ABEND.                                  08710000
087200                                                                  08720000
087300******************************************************************08730000
087400*  STANDARD DB2 ERROR ABEND ROUTINE                               08740000
087500*  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.             08750000
087600******************************************************************08760000
087700 9999-SQL-ABEND.                                                  08770000
087800                                                                  08780000
087900     MOVE +4013                 TO ABEND-CODE.                    08790000
088000     DISPLAY '**  ABEND     **'.                                  08800000
088100     DISPLAY '**  PROGRAM   ** => ' PC-PROGRAM-NAME.              08810000
088200     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            08820000
088300     DISPLAY '**  OPERATION **  = ' PV-OPERATION-ATTEMPTED.       08830000
088400                                                                  08840000
088500*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         08850000
088600*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        08860000
088700                                                                  08870000
088800     COPY DPPD004.                                                08880000
088900     CALL 'ILBOABN0'  USING ABEND-CODE.                           08890000
