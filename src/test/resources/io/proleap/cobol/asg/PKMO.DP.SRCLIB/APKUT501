000100 IDENTIFICATION DIVISION.                                         00010024
000200 PROGRAM-ID.     APKUT501.                                        00020024
000300 AUTHOR.         KARI HAAK.                                       00030024
000400*DATE-WRITTEN.   JANUARY 2011.                                    00040024
000500*DATE-COMPILED.                                                   00050024
000600*************************************************************     00060024
000700*    COBOL 2                                                *     00070024
000800*                                                           *     00080024
000900*    PREPARE THE APRD040 FILE TO SEND TO TERADATA STAGE     *     00090024
001000*                                                           *     00100024
001010*    THE PURPOSE OF THIS PROGRAM IS TO REFORMAT THE PACKED  *     00101024
001020*    FIELDS IN APRD040 TO NON-PACKED.  THIS PROGRAM WILL    *     00102024
001030*    ALSO FILTER THE FILE TO ONLY INCLUDE TRANSACTION CODES *     00103024
001040*    SPECIFIC TO PEOPLESOFT ONLY ADJUSTMENTS.               *     00104024
008207* 02/25/2019                                                *     00104124
      *  CHANGE MADE:                                                   00104224
      *  AS PART OF PREPARTION FOR CONVERSION FROM PEOPLESOFT TO        00104324
      *  ORACLE, NEW DISCOUNT FIELDS COOP,ALW AND MSC HAVE BEEN         00104424
      *  ADDED TO APRD040 COPYBOOK. ADDED THE 3 NEW DISCOUNT            00104524
      *  AMOUNT FIELDS TO TERM-DISC-AMT AND ADDED THE 3 NEW             00104624
      *  DISCOUNT PERCENTS TO TERM-DISC-PCT                             00104724
      *  MADE BY: SURIYA                  WR/IR #: CHG0220043           00104824
001050*************************************************************     00104924
001060*                                                           *     00105024
001070* INPUT:                                                    *     00106024
001080* 1.  AP-TRANS-FILE                      (APRD040)          *     00107024
001090*                                                           *     00108024
001100* OUTPUT                                                    *     00109024
001200* 1.  AP-REFMT-TRANS-FILE                (APRD525)          *     00110024
001300* 2.  #RECS IN AP-REFMT-TRANS FILE                          *     00120024
001400*************************************************************     00130024
001500                                                                  00140024
001600 ENVIRONMENT DIVISION.                                            00150024
001700                                                                  00160024
001800 INPUT-OUTPUT SECTION.                                            00170024
001900                                                                  00180024
002000 FILE-CONTROL.                                                    00190024
002100                                                                  00200024
002200     SELECT AP-TRANS-FILE             ASSIGN TO INP01.            00210024
002300                                                                  00220024
002400     SELECT AP-REFMT-TRANS-FILE       ASSIGN TO OUT01.            00230024
002500                                                                  00240024
002600     SELECT AP-REFMT-TRANS-COUNT-FILE ASSIGN TO OUT02.            00250024
002700                                                                  00260024
002800 DATA DIVISION.                                                   00270024
002900                                                                  00280024
003000 FILE SECTION.                                                    00290024
003100                                                                  00300024
003200 FD  AP-TRANS-FILE                                                00310024
003300     LABEL RECORDS  ARE STANDARD                                  00320024
003400     RECORDING MODE IS  F                                         00330024
003500     DATA RECORD    IS  AP-TRANS-RECORD.                          00340024
003600                                                                  00350024
003700 01  AP-TRANS-RECORD               PIC X(500).                    00360024
003800                                                                  00370024
003900 FD  AP-REFMT-TRANS-FILE                                          00380024
004000     RECORDING MODE IS F                                          00390024
004100     LABEL RECORDS ARE STANDARD                                   00400024
004200     BLOCK CONTAINS 0 RECORDS                                     00410024
004300     DATA RECORD IS AP-REFMT-TRANS-RECORD.                        00420024
004400                                                                  00430024
004500 01  AP-REFMT-TRANS-RECORD         PIC X(770).                    00440024
004600                                                                  00450024
004700 FD  AP-REFMT-TRANS-COUNT-FILE                                    00460024
004800     RECORDING MODE IS F                                          00470024
004900     LABEL RECORDS ARE STANDARD                                   00480024
005000     DATA RECORD IS AP-REFMT-NBR-OF-REC.                          00490024
005100 01  AP-REFMT-NBR-OF-REC               PIC X(09).                 00500024
005200                                                                  00510024
005300 WORKING-STORAGE SECTION.                                         00520024
005400                                                                  00530024
005500 01  FILLER                        PIC X(25) VALUE                00540024
005600                             'WS FOR APKUT501 BEGINS==>'.         00550024
005700                                                                  00560024
005800 01  PV-PROGRAM-VARIABLES.                                        00570024
005900     05  PV-DISC-PCT                  PIC S9V9(4) VALUE ZEROES.   00580024
006000     05  PV-TEMP-AMT                  PIC S9(9)V99                00590024
006100                                                  VALUE ZEROES.   00600024
006200     05  PV-PS-BTCH-NBR.                                          00610024
006300         10  PV-PS-BTCH-DTE           PIC X(10).                  00620024
006400         10  PV-PS-BTCH-SRC-CDE       PIC X(3).                   00630024
006500         10  PV-PS-BTCH-SEQ-NBR       PIC X(2).                   00640024
006600     05  PV-RSN-TXT.                                              00650024
006700         10  PV-RSN-1ST-LNE-TXT       PIC X(50).                  00660024
006800         10  PV-RSN-2ND-LNE-TXT       PIC X(50).                  00670024
006900*                                                                 00680024
007000 01  PV-PROGRAM-COUNTERS.                                         00690024
007100     05  PV-INPUT-COUNT               PIC 9(9)  VALUE ZEROS.      00700024
007200     05  PV-WRITTEN-OUT-REC-CNT       PIC 9(9) VALUE ZEROS.       00710024
007300                                                                  00720024
007400 01  PS-SWITCHES.                                                 00730024
007500     05  PS-END-OF-FILE-SW             PIC X(01) VALUE 'N'.       00740024
007600         88  END-OF-FILE                        VALUE 'Y'.        00750024
007700         88  NOT-END-OF-FILE                    VALUE 'N'.        00760024
007800     05  PS-VALID-TRANS-SW             PIC X(02) VALUE '  '.      00770024
007900         88  VALID-TRANS                        VALUE             00780024
008000              '10', '12', '13', '15', '16'.                       00790024
008100                                                                  00800024
008200*----------------------------------------------------------------*00810024
008300*  ACCOUNTS PAYABLE TRANSACTION COPYBOOK                         *00820024
008400*----------------------------------------------------------------*00830024
008500     COPY APRD040.                                                00840024
008600                                                                  00850024
008700*----------------------------------------------------------------*00860024
008800*  ACCOUNTS PAYABLE REFORMATTED TRANSACTION COPYBOOK             *00870024
008900*----------------------------------------------------------------*00880024
009000     COPY APRD525.                                                00890024
009100                                                                  00900024
009200 PROCEDURE DIVISION.                                              00910024
009300                                                                  00920024
009400 A100-MAINLINE.                                                   00930024
009500                                                                  00940024
009600     PERFORM B100-INITIALIZATION.                                 00950024
009700                                                                  00960024
009800     PERFORM B200-PROCESSING                                      00970024
009900        UNTIL END-OF-FILE.                                        00980024
010000                                                                  00990024
010100     PERFORM B300-END-OF-JOB.                                     01000024
010200                                                                  01010024
010300     GOBACK.                                                      01020024
010400*---------------------------------------------------------------* 01030024
010500*    OPEN FILES AND PERFORM INITIAL READ                          01040024
010600*                                                                 01050024
010700*---------------------------------------------------------------* 01060024
010800 B100-INITIALIZATION.                                             01070024
010900                                                                  01080024
011000     DISPLAY '**********************************'                 01090024
011100     DISPLAY '*   STARTING PROGRAM APKUT501    *'                 01100024
011200     DISPLAY '**********************************'                 01110024
011300                                                                  01120024
011400     OPEN  INPUT AP-TRANS-FILE                                    01130024
011500          OUTPUT AP-REFMT-TRANS-FILE                              01140024
011600                 AP-REFMT-TRANS-COUNT-FILE.                       01150024
011700                                                                  01160024
011800     PERFORM R100-READ-AP-TRANS-FILE.                             01170024
011900                                                                  01180024
012000     IF END-OF-FILE                                               01190024
012100        DISPLAY '**********************************'              01200024
012200        DISPLAY '* ACCOUNTS PAYABLE TRANSACTION   *'              01210024
012300        DISPLAY '* INPUT FILE IS EMPTY.           *'              01220024
012400        DISPLAY '**********************************'              01230024
012500     END-IF.                                                      01240024
012600                                                                  01250024
012700*---------------------------------------------------------------* 01260024
012800*  PROCESS AP TRANS RECORDS AND CALCULATE DUE DATE AND          * 01270024
012900*  OTP DATES BASED ON THE RECEIVING DATE.                       * 01280024
013000*---------------------------------------------------------------* 01290024
013100 B200-PROCESSING.                                                 01300024
013200                                                                  01310024
013300     MOVE AP040-AP-TRN-CDE          TO PS-VALID-TRANS-SW.         01320024
013400                                                                  01330024
013500     EVALUATE TRUE                                                01340024
013600         WHEN VALID-TRANS                                         01350024
013700             PERFORM C100-POPULATE-OUTPUT-REC                     01360024
013800             PERFORM W100-WRITE-OUTPUT-REC                        01370024
013900         WHEN OTHER                                               01380024
014000             CONTINUE                                             01390024
014100     END-EVALUATE.                                                01400024
014200                                                                  01410024
014300     PERFORM R100-READ-AP-TRANS-FILE.                             01420024
014400                                                                  01430024
014500 B300-END-OF-JOB.                                                 01440024
014600                                                                  01450024
014700     PERFORM W200-WRITE-OUTPUT-REC-COUNT.                         01460024
014800                                                                  01470024
014900     DISPLAY '*----------------------------------------------*'.  01480024
015000     DISPLAY 'PROGRAM APKUT501 RECORD COUNTS '                    01490024
015100     DISPLAY 'TOTAL AP TRANS RECORDS READ    = '                  01500024
015200              PV-INPUT-COUNT                                      01510024
015300     DISPLAY 'TOTAL AP REFORMATTED TRANS RECORDS WRITTEN   = '    01520024
015400              PV-WRITTEN-OUT-REC-CNT                              01530024
015500     DISPLAY '*----------------------------------------------*'.  01540024
015600     DISPLAY ' PROGRAM APKUT501 ENDS NORMALLY '.                  01550024
015700                                                                  01560024
015800     CLOSE AP-TRANS-FILE                                          01570024
015900           AP-REFMT-TRANS-FILE                                    01580024
016000           AP-REFMT-TRANS-COUNT-FILE.                             01590024
016100                                                                  01600024
016200*---------------------------------------------------------------* 01610024
016300*     POPULATE THE APRD003 FIELDS AND WRITE OUT THE RECORD.     * 01620024
016400*---------------------------------------------------------------* 01630024
016500 C100-POPULATE-OUTPUT-REC.                                        01640024
016600                                                                  01650024
016700     INITIALIZE AP525-REFMT-TRANS-FILE                            01660024
016800                PV-PROGRAM-VARIABLES.                             01670024
016900                                                                  01680024
017000     MOVE AP040-VND-NBR             TO AP525-VND-NBR.             01690024
017100     MOVE AP040-DOC-NBR             TO AP525-DOC-NBR.             01700024
017200     MOVE AP040-DOC-DTE             TO AP525-DOC-DTE.             01710024
017300     MOVE AP040-AP-TRN-CDE          TO AP525-AP-TRN-CDE.          01720024
017400     MOVE AP040-PO-NBR              TO AP525-PO-NBR.              01730024
017500     MOVE AP040-DEPT-NBR            TO AP525-DEPT-NBR.            01740024
017600     MOVE AP040-GL-ACCT-NBR         TO AP525-GL-ACCT-NBR.         01750024
017700     MOVE AP040-PSTG-TYP-CDE        TO AP525-PSTG-TYP-CDE.        01760024
017800     MOVE AP040-TRN-TYP-CDE         TO AP525-TRN-TYP-CDE.         01770024
017900     MOVE AP040-ENTR-TMST           TO AP525-ENTR-TMST.           01780024
018000     MOVE AP040-ENTR-ID             TO AP525-ENTR-ID.             01790024
018100     MOVE AP040-ORGN-CDE            TO AP525-ORGN-CDE.            01800024
018200     MOVE AP040-INV-CUTOFF-DTE      TO AP525-INV-CUTOFF-DTE.      01810024
018300     MOVE AP040-BAR-CDE             TO AP525-BAR-CDE.             01820024
018400     MOVE AP040-PS-BTCH-NBR         TO PV-PS-BTCH-NBR.            01830024
018500     MOVE PV-PS-BTCH-DTE            TO AP525-PS-BTCH-DTE.         01840024
018600     MOVE PV-PS-BTCH-SRC-CDE        TO AP525-PS-BTCH-SRC-CDE.     01850024
018700     MOVE PV-PS-BTCH-SEQ-NBR        TO AP525-PS-BTCH-SEQ-NBR.     01860024
018800     MOVE AP040-ENT-ID              TO AP525-ENT-ID.              01870024
018900     MOVE AP040-ENT-NME-DESC        TO AP525-ENT-NME-DESC.        01880024
019000     MOVE AP040-RSN-TXT             TO PV-RSN-TXT.                01890024
019100     MOVE PV-RSN-1ST-LNE-TXT        TO AP525-RSN-1ST-LNE-TXT.     01900024
019200     MOVE PV-RSN-2ND-LNE-TXT        TO AP525-RSN-2ND-LNE-TXT.     01910024
                                                                        01920024
           ADD  AP040-COOP-DISC-PCT,                                    01921024
                AP040-ALW-DISC-PCT,                                     01922024
                AP040-MSC-DISC-PCT        TO AP040-TERM-DISC-PCT        01923024
                                                                        01924024
019400     MOVE AP040-TERM-DISC-PCT       TO PV-DISC-PCT.               01925024
019500     MOVE PV-DISC-PCT               TO AP525-TERM-DISC-PCT.       01926024
019600                                                                  01927024
019700     MOVE AP040-NW-STR-DISC-PCT     TO PV-DISC-PCT.               01928024
019800     MOVE PV-DISC-PCT               TO AP525-NW-STR-DISC-PCT.     01929024
019900                                                                  01930024
020000     MOVE AP040-TRD-DISC-PCT        TO PV-DISC-PCT.               01940024
020100     MOVE PV-DISC-PCT               TO AP525-TRD-DISC-PCT.        01950024
020200                                                                  01960024
020300     MOVE AP040-PSTG-FYR-NBR        TO AP525-PSTG-FYR-NBR.        01970024
020400     MOVE AP040-PSTG-FMN-NBR        TO AP525-PSTG-FMN-NBR.        01980024
020500     MOVE AP040-PSTG-FWK-NBR        TO AP525-PSTG-FWK-NBR.        01990024
020600                                                                  02000024
020700     MOVE AP040-MOS-DISC-PCT        TO PV-DISC-PCT.               02010024
020800     MOVE PV-DISC-PCT               TO AP525-MOS-DISC-PCT.        02020024
020900                                                                  02030024
021000     MOVE AP040-ADV-DISC-PCT        TO PV-DISC-PCT.               02040024
021100     MOVE PV-DISC-PCT               TO AP525-ADV-DISC-PCT.        02050024
021200                                                                  02060024
021300     MOVE AP040-STR-NBR             TO AP525-STR-NBR.             02070024
021400                                                                  02080024
021500     MOVE AP040-GRO-COST-AMT        TO PV-TEMP-AMT.               02090024
021600     MOVE PV-TEMP-AMT               TO AP525-GRO-COST-AMT.        02100024
021700                                                                  02110024
021800     MOVE AP040-RETL-AMT            TO PV-TEMP-AMT.               02120024
021900     MOVE PV-TEMP-AMT               TO AP525-RETL-AMT.            02130024
022000                                                                  02140024
022100     MOVE AP040-FRGT-AMT            TO PV-TEMP-AMT.               02150024
022200     MOVE PV-TEMP-AMT               TO AP525-FRGT-AMT.            02160024
022300                                                                  02170024
022400     MOVE AP040-MISC-CHRG-AMT       TO PV-TEMP-AMT.               02180024
022500     MOVE PV-TEMP-AMT               TO AP525-MISC-CHRG-AMT.       02190024
022600                                                                  02200024
022700     MOVE AP040-NET-COST-AMT        TO PV-TEMP-AMT.               02210024
022800     MOVE PV-TEMP-AMT               TO AP525-NET-COST-AMT.        02220024
022900                                                                  02230024
           ADD  AP040-COOP-DISC-AMT,                                    02240024
                AP040-ALW-DISC-AMT,                                     02250024
                AP040-MSC-DISC-AMT        TO AP040-TERM-DISC-AMT        02260024
                                                                        02270024
023000     MOVE AP040-TERM-DISC-AMT       TO PV-TEMP-AMT.               02280024
023100     MOVE PV-TEMP-AMT               TO AP525-TERM-DISC-AMT.       02290024
023200                                                                  02300024
023300     MOVE AP040-NW-STR-DISC-AMT     TO PV-TEMP-AMT.               02310024
023400     MOVE PV-TEMP-AMT               TO AP525-NW-STR-DISC-AMT.     02320024
023500                                                                  02330024
023600     MOVE AP040-TRD-DISC-AMT        TO PV-TEMP-AMT.               02340024
023700     MOVE PV-TEMP-AMT               TO AP525-TRD-DISC-AMT.        02350024
023800                                                                  02360024
023900     MOVE AP040-MOS-DISC-AMT        TO PV-TEMP-AMT.               02370024
024000     MOVE PV-TEMP-AMT               TO AP525-MOS-DISC-AMT.        02380024
024100                                                                  02390024
024200     MOVE AP040-ADV-DISC-AMT        TO PV-TEMP-AMT.               02400024
024300     MOVE PV-TEMP-AMT               TO AP525-ADV-DISC-AMT.        02410024
024400                                                                  02420024
024500     MOVE AP040-PYMT-DUE-DTE        TO AP525-PYMT-DUE-DTE.        02430024
024600     MOVE AP040-ADJRNL-PS-PSTG-IND  TO AP525-ADJRNL-PS-PSTG-IND.  02440024
024700     MOVE AP040-AUTH-NBR            TO AP525-AUTH-NBR.            02450024
024800     MOVE AP040-AUTO-OTP-PSTG-IND   TO AP525-AUTO-OTP-PSTG-IND.   02460024
024810     MOVE AP040-AP-PSTG-IND         TO AP525-AP-PSTG-IND.         02470024
024811                                                                  02480024
024812     MOVE AP040-SALES-TAX-AMT       TO PV-TEMP-AMT.               02481024
024813     MOVE PV-TEMP-AMT               TO AP525-SALES-TAX-AMT.       02481124
024814                                                                  02481224
024815     MOVE AP040-DOC-HLD-CDE         TO AP525-DOC-HLD-CDE.         02481324
024816     MOVE AP040-DEPTID              TO AP525-DEPTID.              02481424
024817     MOVE AP040-PRD-CDE             TO AP525-PRD-CDE.             02481524
024818     MOVE AP040-PROJ-ID             TO AP525-PROJ-ID.             02481624
024819     MOVE AP040-SEPARATE-CHCK       TO AP525-SEPARATE-CHCK.       02481724
024820     MOVE AP040-WTHD-SETID          TO AP525-WTHD-SETID.          02481824
024821     MOVE AP040-WTHD-SW             TO AP525-WTHD-SW.             02481924
024822     MOVE AP040-WTHD-CD             TO AP525-WTHD-CD.             02482024
024823                                                                  02482124
024824*---------------------------------------------------------------* 02482224
024825*     READ THE AP TRANS EXTRACT FILE                            * 02482324
024826*---------------------------------------------------------------* 02482424
024827 R100-READ-AP-TRANS-FILE.                                         02482524
024828                                                                  02482624
024829     READ AP-TRANS-FILE INTO AP040-TRANSACTION-FILE               02482724
024830         AT END  SET END-OF-FILE TO TRUE.                         02482824
024840                                                                  02482924
024850     IF NOT-END-OF-FILE                                           02483024
024860        ADD 1 TO PV-INPUT-COUNT                                   02484024
024870     END-IF.                                                      02485024
024880                                                                  02486024
024890*---------------------------------------------------------------* 02487024
024900*  WRITE THE UNJOUNRALIZED AGED RECORD TO THE OUTPUT FILE.      * 02488024
025000*---------------------------------------------------------------* 02489024
025100 W100-WRITE-OUTPUT-REC.                                           02490024
025200                                                                  02500024
025300     WRITE AP-REFMT-TRANS-RECORD                                  02510024
025400         FROM AP525-REFMT-TRANS-FILE.                             02520024
025500                                                                  02530024
025600     ADD 1 TO PV-WRITTEN-OUT-REC-CNT.                             02540024
025700                                                                  02550024
025800*----------------------------------------------------------------*02560024
025900*  WRITE THE RECORD COUNT OF AP_40 REFMT TRANSACTION FILE         02570024
026000*----------------------------------------------------------------*02580024
026100 W200-WRITE-OUTPUT-REC-COUNT.                                     02590024
026200                                                                  02600024
026300     WRITE AP-REFMT-NBR-OF-REC FROM PV-WRITTEN-OUT-REC-CNT.       02610024
026400                                                                  02620024
