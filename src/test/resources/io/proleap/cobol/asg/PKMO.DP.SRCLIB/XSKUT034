000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.      XSKUT034.                                       00020000
000300 AUTHOR.          ALEXIS KEIKER.                                  00030000
000400 DATE-WRITTEN.    OCTOBER 21, 2002.                               00040000
000500                                                                  00050000
000600*-----------------------------------------------------------      00060000
000700*                PROMO DATA QUEUE READER                          00070000
000800*-----------------------------------------------------------      00080000
000810* THIS PROGRAM WILL READ A MESSAGE FROM A QUEUE AND CALL          00090000
000820* THE NECESSARY PROGRAM THAT IT RELATES TO.  THIS PROGRAM         00100000
000830* IS A COBOL MQ SERIES PROGRAM THAT READS FROM A QUEUE            00110000
000840* INCOMING MESSAGES. THE FIRST THING THIS PROGRAM DOES IS         00120000
000850* READS IN THE CONTROL CARDS AND VALIDATES THEM. IT THEN          00130000
000860* CALCULATES THE FUTURE OFFSET DATE BY GETTING THE FUTURE         00140000
000870* OFFSET NUMBER FROM THE XST_INTFC_CNTL AND ADDING IT TO THE      00150000
000880* CURRENT DATE AND ADDING THE BUSINESS DAYS FROM CONTROL CARD     00160000
000890* 4. THIS PROGRAM THEN CONNECTS TO THE QUEUE MANAGER, OPENS       00170000
000891* THE BUSINESS EVENT QUEUE AND THE ERROR QUEUE, AND THEN          00180000
000892* READS A MESSAGE FROM THE BUSINESS EVENT QUEUE.  IT WILL         00190000
000893* THEN EVALUATE THE MESSAGE TYPE AND CALL THE NECESSARY           00200000
000894* PROGRAM THAT WILL LOAD THIS RECORD TO A XS DOMAIN PROMO         00210000
000895* TABLE.  IT WILL THEN EVALUATE THE PROGRAM STATUS CODE           00220000
000896* AND ERROR CODE THAT IS SENT BACK.  IF THE MESSAGE WAS           00230000
000897* SUCCESSFUL IT WILL WRITE THE MESSAGE OUT TO A BACKUP            00240000
000898* MESSAGE LOG.  IF THE MESSAGE WAS NOT SUCCESSFUL IT WILL         00250000
000899* WRITE THE MESSAGE OUT TO THE ERROR QUEUE AND CALL THE           00260000
000900* SERVICE CENTER PROGRAM.  ONCE ALL THE MESSAGES ARE READ         00270000
000901* THE PROGRAM WILL CLOSE ALL QUEUES, DISCONNECT FROM THE          00280000
000902* QUEUE MANAGER, AND DISPLAY ALL COUNTS OF EVERYTHING THAT        00290000
000903* HAPPENED.                                                       00300000
000904*                                                                 00310000
000905*       MESSAGE TYPES - MESSAGES COMING THROUGH                   00320000
000906*               010 - AD EVENT MESSAGE                            00330000
000907*               020 - PROMOTION MESSAGE                           00340000
000908*               030 - PRICE VERSION MESSAGE                       00350000
000909*               040 - ADHOC STORE GROUP MESSAGE                   00360000
000910*               050 - ADHOC STORE LIST MESSAGE                    00370000
000911*               090 - PRICING MESSAGE                             00380000
000912*               100 - BENEFIT WITH PURCHASE 'GET' MESSAGE         00390000
000913*               110 - EXCLUSION MESSAGE                           00400000
000914*               120 - STORE GROUP MESSAGE                         00410000
000915*                                                                 00420000
000916*       THIS IS WHAT IS BEING SENT BACK FROM THE CALLED PROGRAM.  00430000
000917*       THERE IS A PROGRAM STATUS CODE SENT BACK, SQL RETURN CODE,00440000
000918*       AND A LOAD SEVERITY ERROR CODE.                           00450000
000919*                                                                 00460000
000920*          SQL CODES - LOAD SQL RETURN CODE                       00470000
000921*             - THIS IS THE LAST SQL RETURN CODE RECEIVED         00480000
000922*               FROM A DATABASE ACTION.                           00490000
000923*                                                                 00500000
000924*          PROGRAM CODES - PROGRAM STATUS CODE                    00510000
000925*           - 00 - ALL DATABASE ACTION WAS SUCCESSFUL AND         00520000
000926*                  WORKED ACCORDING TO THE MESSAGE TYPE.          00530000
000927*           - 01 - AN 'ADD' RECORD WAS TURNED INTO AN             00540000
000928*                  UPDATE AND THE BUSINESS EVENT WAS FOUND        00550000
000929*                  TO BE THE ONE NEEDED ON THE DATABASE.          00560000
000930*           - 02 - AN 'ADD' RECORD WAS TURNED INTO AN UPDATE      00570000
000931*                  AND THE BUSINESS EVENT WAS FOUND TO BE         00580000
000932*                  THE ONE NOT NEEDED ON THE DATABASE.            00590000
000933*           - 03 - AN 'UPDATE' RECORD WAS TURNED INTO AN ADD.     00600000
000934*           - 04 - AN 'UPDATE' RECORD WAS BYPASSED BECAUSE THE    00610000
000935*                  RECORD CURRENTLY ON THE DATABASE WAS THE       00620000
000936*                  MOST RECENT DATA.                              00630000
000937*           - 05 - THE DATABASE ACTION WAS NOT SUCCESSFUL DUE     00640000
000938*                  TO THE RETURNED SQL CODE.                      00650000
000939*           - 06 - UNEXPECTED ACTION CODE RECEIVED.               00660000
000940*                                                                 00670000
000941*          ERROR CODES - LOAD SEVERITY LEVEL                      00680000
000947*           - 00 - THE LOAD OF THE DATA WAS SUCCESSFUL AND        00690000
000948*                  THEREFORE THE SEVERITY OF THE LOAD DID         00700000
000949*                  NOT NEED TO BE DETERMINED.                     00710000
000950*           - 01 - THE LOAD IS CRITICAL TO A SYSTEM AND           00720000
000951*                  THEREFORE MUST BE RESOLVED ASAP.               00730000
000952*           - 02 - THE LOAD IS NOT CRITICAL AND THEREFORE CAN     00740000
000953*                  WAIT UNTIL A LATER TIME TO BE RESOLVED.        00750000
000954*                                                                 00760000
000960*-----------------------------------------------------------      00770000
001000* HISTORY LOG:                                                    00780000
001100*-----------------------------------------------------------      00790000
001200* DATE: 08/12/2003                                                00800000
001300* WR/IR#: IR#574795                                               00810000
001400* PROGRAMMER: SCOTT BARTELT                                       00820000
001500* DESCRIPTION: ADDED LOGIC SO THAT THE CONSOLE MESSAGE WILL       00830000
001510*              ONLY BE WRITTEN OUT WHEN THE PROGRAM IS USING      00840000
001520*              THE PRODUCTION QUEUE MANAGER(QKSP).                00850000
001600*                                                                 00860000
0410  * DATE:        04/10/2010                                         00870000
0410  * WR/IR#:      WR38306                                            00880000
0410  * PROGRAMMER:  JIM ARENDT                                         00890000
0410  * DESCRIPTION: AS PART OF THE E-SIGN CORPORATE PROJECT, CHANGED   00900000
0410  *      THE PROGRAM TO GENERATE A NOTIFICATION EMAIL TO THE        00910000
0410  *      SUPPORT TEAM IF THE CALL TO XSKUP031 RESULTED IN A ROW     00920000
0410  *      BEING INSERTED INTO DB2 TABLE XST_PROMO_TYP.               00930000
001600*                                                                 00940000
101310* DATE: 10/13/2010                                                00950000
101310* WR/IR#: PKE#0000005286                                          00960000
101310* PROGRAMMER: CHERI PARMLEY                                       00970000
101310* DESCRIPTION: ADD COMMIT REGARDLESS WHETHER INSERT/UPDATE        00980000
101310* WAS SUCCESSFUL. RECOMMENDED BY RICH RIAMOND TO AVOID            00990000
101310* LOCKING DB2 RESOURCES.                                          01000000
593144*                                                                 01010000
PK6955* DATE:02/15/2011                                                 01020000
PK6955* PROGRAMMER:COGNIZANT                                            01030000
PK6955* DESCRIPTION:ADDED A SEPERATE EVALUATE CONDITION FOR CHECKING    01040000
PK6955* THE PV-NO-SUCCESS INDICTOR. WHEN IT IS SET THEN PGM SHOULD NOT  01050000
PK6955* CALL THE 2800-CALL-DISPLAY-CONSOLE-MSG PARA FOR CREATING INCIDT 01060000
PK6955* AS THE MESSAGE QUEUE IS CLEARED TIMELY BY THE JOB XSK325.       01070000
PK6955* MADE BY: COGNIZANT               WR/IR #: PKE000000006955       01080000
0211  *                                                                 01090000
0211  * DATE:        02/16/2011                                         01100000
0211  * WR/IR#:      WR37916                                            01110000
0211  * PROGRAMMER:  JIM ARENDT                                         01120000
0211  * DESCRIPTION: AS PART OF THE E-SIGN POST PILOT PROJECT CR1958    01130000
0211  *      CHANGED THE NOTIFICATION GROUP OF THE AUTOMATICALLY        01140000
0211  *      GENERATED EMAIL.  ALSO, CHANGED THE TEXT OF THE MESSAGE    01150000
0211  *      TO INCLUDE THE PROMO NAME AND PROMO DATES.                 01160000
C52736*                                                                 01170000
C52736* DATE:        05/14/2013                                         01180000
C52736* WR/IR#:      CHG0052736                                         01190000
C52736* PROGRAMMER:  JOHN SELWITSCHKA                                   01200000
C52736* DESCRIPTION: MQPROMO PERFORMANCE IMPROVEMENT. REDUCE FREQUENCY  01210000
C52736*      OF COMMITS TO IMPROVE PERFORMANCE.                         01220000
C52736*                                                                 01230000
C58015* DATE:        08/28/2013                                         01240005
C58015* WR/IR#:      CHG0058015                                         01250005
C58015* PROGRAMMER:  COGNIZANT                                          01260005
C58015* DESCRIPTION: DISPLAY STATEMENT ADDED TO THE PROGRAM TO DISPLAY  01270005
C58015*       FIRST 1000 ERROR RECORD.                                  01280005
C58015*                                                                 01290005
229232* DATE:        08/09/2019                                         01300011
229232* WR/IR#:      CHG0229232                                         01310011
229232* PROGRAMMER:  JIM HUNTER                                         01320011
229232* DESCRIPTION: MAINFRAME REFACTORING - THE CALL TO DPKUT175 IS    01330011
229232*              BEING REMOVED BECAUSE IT IS AN ASSEMBLER PROGRAM   01340011
229232*              AND CAN'T BE REFACTORED.  DPKUT175 SENT UP TO      01350011
229232*              5 ERROR MESSAGES TO THE OPERATOR CONSOLE WHEN      01360011
229232*              RECORDS WITH INVALID BUSINESS EVENTS WERE READ.    01370011
229232*              THE SERVICE DELIVERY TEAM CONFIRMED THAT           01380011
229232*              OPERATIONS HAS NOT NOTIFIED THEM ABOUT MESSAGES    01390011
229232*              RECEIVED ON THE CONSOLE IN THE PAST.               01400011
229232*                                                                 01410011
001700*----------------------------------------------------------       01420000
001800 ENVIRONMENT DIVISION.                                            01430000
001900*----------------------------------------------------------       01440000
002000 CONFIGURATION SECTION.                                           01450000
002100 SOURCE-COMPUTER.        IBM-3090.                                01460000
002200 OBJECT-COMPUTER.        IBM-3090.                                01470000
002210                                                                  01480000
002220 INPUT-OUTPUT SECTION.                                            01490000
002230                                                                  01500000
002240 FILE-CONTROL.                                                    01510000
002250                                                                  01520000
002260     SELECT CONTROL-CARD-1                                        01530000
002270            ASSIGN TO INP01.                                      01540000
002280     SELECT CONTROL-CARD-2                                        01550000
002290            ASSIGN TO INP02.                                      01560000
002300     SELECT CONTROL-CARD-3                                        01570000
002400            ASSIGN TO INP03.                                      01580000
002500     SELECT CONTROL-CARD-4                                        01590000
002600            ASSIGN TO INP04.                                      01600000
002700     SELECT MESSAGE-LOG                                           01610000
002800            ASSIGN TO OUT01.                                      01620000
0410       SELECT EMAIL-MSG-FILE                                        01630000
0410              ASSIGN TO OUT02.                                      01640000
002900                                                                  01650000
003000 DATA DIVISION.                                                   01660000
003100 FILE SECTION.                                                    01670000
003200                                                                  01680000
003300 FD  CONTROL-CARD-1                                               01690000
003400     RECORDING MODE F                                             01700000
003500     BLOCK CONTAINS 0 RECORDS                                     01710000
003600     LABEL RECORDS ARE OMITTED                                    01720000
003700     DATA RECORD IS CONTROL-CARD-1-RECORD.                        01730000
003800 01  CONTROL-CARD-1-RECORD        PIC  X(80).                     01740000
003900                                                                  01750000
004000 FD  CONTROL-CARD-2                                               01760000
004100     RECORDING MODE F                                             01770000
004200     BLOCK CONTAINS 0 RECORDS                                     01780000
004300     LABEL RECORDS ARE OMITTED                                    01790000
004400     DATA RECORD IS CONTROL-CARD-2-RECORD.                        01800000
004500 01  CONTROL-CARD-2-RECORD        PIC  X(80).                     01810000
004600                                                                  01820000
004700 FD  CONTROL-CARD-3                                               01830000
004800     RECORDING MODE F                                             01840000
004900     BLOCK CONTAINS 0 RECORDS                                     01850000
005000     LABEL RECORDS ARE OMITTED                                    01860000
005100     DATA RECORD IS CONTROL-CARD-3-RECORD.                        01870000
005200 01  CONTROL-CARD-3-RECORD        PIC  X(80).                     01880000
005300                                                                  01890000
005400 FD  CONTROL-CARD-4                                               01900000
005500     RECORDING MODE F                                             01910000
005600     BLOCK CONTAINS 0 RECORDS                                     01920000
005700     LABEL RECORDS ARE OMITTED                                    01930000
005800     DATA RECORD IS CONTROL-CARD-4-RECORD.                        01940000
005810 01  CONTROL-CARD-4-RECORD        PIC  X(80).                     01950000
005820                                                                  01960000
005830 FD  MESSAGE-LOG                                                  01970000
005840     RECORDING MODE F                                             01980000
005850     BLOCK CONTAINS 0 RECORDS                                     01990000
005860     LABEL RECORDS ARE OMITTED                                    02000000
005870     DATA RECORD IS MESSAGE-LOG-RECORD.                           02010000
005880 01  MESSAGE-LOG-RECORD           PIC  X(300).                    02020000
005890                                                                  02030000
0410   FD  EMAIL-MSG-FILE                                               02040000
0410       RECORDING MODE F                                             02050000
0410       BLOCK CONTAINS 0 RECORDS                                     02060000
0410       LABEL RECORDS ARE STANDARD                                   02070000
0410       DATA RECORD IS EMAIL-MSG-FILE-RECORD.                        02080000
0410   01  EMAIL-MSG-FILE-RECORD        PIC  X(80).                     02090000
0410                                                                    02100000
005900 WORKING-STORAGE SECTION.                                         02110000
006000*-----------------------------------------------------------      02120000
006100* PS- PROGRAM SWITCHES                                            02130000
006200*-----------------------------------------------------------      02140000
006300 01  PS-PROGRAM-SWITCHES.                                         02150000
006400     05  PS-PROCESS-INDICATOR-SW  PIC  X(01) VALUE 'Y'.           02160000
006500         88  PS-PROCESS-COMPLETE             VALUE 'N'.           02170000
006600         88  PS-PROCESS-CONTINUE             VALUE 'Y'.           02180000
                                                                        02190003
0410       05  PS-SEND-EMAIL-SW         PIC  X(01) VALUE 'N'.           02200000
0410           88  PS-SEND-EMAIL-NO                VALUE 'N'.           02210000
0410           88  PS-SEND-EMAIL-YES               VALUE 'Y'.           02220000
                                                                        02230003
C52736     05  PS-MQ-TIME-OUT-SW        PIC  X(01) VALUE 'N'.           02240003
C52736         88  PS-NOT-MQ-TIME-OUT              VALUE 'N'.           02250003
C52736         88  PS-MQ-TIME-OUT                  VALUE 'Y'.           02260003
006700                                                                  02270000
006800*-----------------------------------------------------------      02280000
006900* CONTROL CARD 1 RECORD LAYOUT - QUEUE MANAGER NAME               02290000
007000*-----------------------------------------------------------      02300000
007100 01  CC-CONTROL-CARD-1-LAYOUT.                                    02310000
007200     05  CC-QUEUE-MANAGER-NAME    PIC  X(48) VALUE SPACES.        02320000
007300     05  FILLER                   PIC  X(32) VALUE SPACES.        02330000
007400                                                                  02340000
007500*-----------------------------------------------------------      02350000
007600* CONTROL CARD 2 RECORD LAYOUT - BUSINESS EVENT QUEUE NAME        02360000
007700*-----------------------------------------------------------      02370000
007800 01  CC-CONTROL-CARD-2-LAYOUT.                                    02380000
007900     05  CC-BUS-EVNT-QUEUE-NAME   PIC  X(48) VALUE SPACES.        02390000
008000     05  FILLER                   PIC  X(32) VALUE SPACES.        02400000
008100                                                                  02410000
008200*-----------------------------------------------------------      02420000
008300* CONTROL CARD 3 RECORD LAYOUT - BUSINESS EVENT ERROR QUEUE NAME  02430000
008400*-----------------------------------------------------------      02440000
008500 01  CC-CONTROL-CARD-3-LAYOUT.                                    02450000
008600     05  CC-ERROR-QUEUE-NAME      PIC  X(48) VALUE SPACES.        02460000
008700     05  FILLER                   PIC  X(32) VALUE SPACES.        02470000
008800                                                                  02480000
008900*-----------------------------------------------------------      02490000
009000* CONTROL CARD 4 RECORD LAYOUT - BUSINESS OFFSET DAYS             02500000
009100*-----------------------------------------------------------      02510000
009110 01  CC-CONTROL-CARD-4-LAYOUT.                                    02520000
009120     05  FILLER                   PIC  X(30) VALUE SPACES.        02530000
009130     05  CC-BUS-DAYS-NBR          PIC  X(03) VALUE SPACES.        02540000
009140     05  FILLER                   PIC  X(47) VALUE SPACES.        02550000
009150                                                                  02560000
009160*-----------------------------------------------------------      02570000
009170* PROGRAM CONSTANTS                                               02580000
009180*-----------------------------------------------------------      02590000
009190 01  PC-PROGRAM-CONSTANTS.                                        02600000
009100     05  PC-PROD-QUEUE            PIC  X(04) VALUE 'QKSP'.        02610000
009200     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08) VALUE 'XSKUT034'.    02620000
009300     05  PC-MAX-RETRIES           PIC S9(04) VALUE +5 COMP.       02630000
009310     05  PC-RI-ERROR-530          PIC S9(04) VALUE -530.          02640000
 52736     05  PC-COMMIT-FREQ           PIC S9(04) VALUE +1000 COMP.    02650000
009360     05  PC-BAD-MESSAGE           PIC  X(19) VALUE                02660000
009370                                  'BAD BUS EVENT ID   '.          02670000
009380     05  PC-MSG-NOT-LOAD          PIC  X(19) VALUE                02680000
009390                                  'MSG DID NOT LOAD   '.          02690000
009400     05  PC-CALLED-PROGRAM        PIC  X(08).                     02700000
009500         88  PC-CALLED-XSKUP028              VALUE 'XSKUP028'.    02710000
009600         88  PC-CALLED-XSKUP031              VALUE 'XSKUP031'.    02720000
009700         88  PC-CALLED-XSKUP032              VALUE 'XSKUP032'.    02730000
009800         88  PC-CALLED-XSKUP033              VALUE 'XSKUP033'.    02740000
009900         88  PC-CALLED-XSKUP034              VALUE 'XSKUP034'.    02750000
010000         88  PC-CALLED-XSKUP035              VALUE 'XSKUP035'.    02760000
010100         88  PC-CALLED-XSKUP036              VALUE 'XSKUP036'.    02770000
010200         88  PC-CALLED-XSKUP037              VALUE 'XSKUP037'.    02780000
010300         88  PC-CALLED-XSKUP038              VALUE 'XSKUP038'.    02790000
010400                                                                  02800000
010500*-----------------------------------------------------------      02810000
010600* PV- PROGRAM VARIABLES                                           02820000
010700*-----------------------------------------------------------      02830000
010800 01  PV-PROGRAM-VARIABLES.                                        02840000
010900     05  PV-SQL-SUB               PIC S9(04) VALUE +0 COMP.       02850000
C52736     05  PV-COMMIT-COUNT          PIC S9(04) VALUE +0 COMP.       02860000
010910     05  PV-MQ-ERROR-COUNT        PIC  9(04) VALUE 0.             02870000
011000     05  PV-CURRENT-DATE          PIC  X(10) VALUE SPACES.        02880000
011100     05  PV-FUT-OFFST-NBR         PIC S9(05) VALUE +0.            02890000
011200     05  PV-SAVE-DAYS-AHEAD       PIC  X(05) VALUE SPACES.        02900000
011300     05  PV-FUTURE-OFFSET-DTE     PIC  X(10) VALUE SPACES.        02910000
011400     05  PV-BUS-DAYS              PIC  9(03) VALUE 0.             02920000
011500     05  PV-BUS-DAYS-NBR          PIC  9(05) VALUE 0.             02930000
011510     05  PV-BUS-DAYS-AHEAD        PIC  X(05) VALUE SPACES.        02940000
0211       05  PV-COMPARE-DATE          PIC  X(10) VALUE SPACES.        02950000
011511     05  PV-SQL-ERR-CDE           PIC  9(04) VALUE 0.             02960000
011512     05  PV-FORMAT-CORR-ID.                                       02970000
011513         10  PV-FORMAT-MQ-CORR-ID PIC  X(03).                     02980000
011514         10  PV-NULL-VALUE        PIC  X(21).                     02990000
011515     05  PV-MQ-CORR-ID            PIC S9(04) VALUE +0 COMP-3.     03000000
011516     05  PV-MQ-CORR-ID-CHAR REDEFINES                             03010000
011517        PV-MQ-CORR-ID             PIC  X(03).                     03020000
011520     05  PV-SAVE-CCYY-MM-DD.                                      03030000
011530         10  PV-SAVE-CCYY         PIC  X(04).                     03040000
011540         10  FILLER               PIC  X(01).                     03050000
011550         10  PV-SAVE-MM           PIC  X(02).                     03060000
011560         10  FILLER               PIC  X(01).                     03070000
011570         10  PV-SAVE-DD           PIC  X(02).                     03080000
011571     05  PV-PRCS-BUS-DTE.                                         03090000
011572         10  PV-PRCS-BUS-CCYY     PIC  X(04).                     03100000
011573         10  FILLER               PIC  X(01).                     03110000
011574         10  PV-PRCS-BUS-MM       PIC  X(02).                     03120000
011575         10  FILLER               PIC  X(01).                     03130000
011576         10  PV-PRCS-BUS-DD       PIC  X(02).                     03140000
011577     05  PV-FUT-OFFST-BUS-DTE.                                    03150000
011578         10  PV-FUT-BUS-CCYY      PIC  X(04).                     03160000
011579         10  PV-FUT-BUS-MM        PIC  X(02).                     03170000
011580         10  PV-FUT-BUS-DD        PIC  X(02).                     03180000
0211       05  PV-TIMESTAMP-FIELD.                                      03190000
0211           10  PV-TIMESTAMP-DATE    PIC  X(10).                     03200000
0211           10  FILLER               PIC  X(16).                     03210000
011581     05  PV-MESSAGE-RECORD.                                       03220000
011582         10  PV-BUS-EVNT-ID       PIC  X(03)  VALUE SPACES.       03230000
011583         10  FILLER               PIC  X(297) VALUE SPACES.       03240000
011584     05  PV-SAVE-BUS-EVNT-ID      PIC 9(03).                      03250000
011585         88  PV-AD-EVENT                     VALUE 010.           03260000
011586         88  PV-PROMOTION                    VALUE 020.           03270000
011587         88  PV-PRICE-VERSION                VALUE 030.           03280000
011588         88  PV-ADHOC-STR-GRP                VALUE 040.           03290000
011589         88  PV-ADHOC-STR-LIST               VALUE 050.           03300000
011590         88  PV-PROMOTION-ITEM               VALUE 060.           03310000
011600         88  PV-PROMOTION-ITEM-STR-GRP       VALUE 070.           03320000
011601         88  PV-FORECAST                     VALUE 080.           03330000
011602         88  PV-PRICING                      VALUE 090.           03340000
011603         88  PV-BENEFIT-W-PURCHASE           VALUE 100.           03350000
011604         88  PV-PRICING-EXCLUSIONS           VALUE 110.           03360000
011605         88  PV-PRICING-STR-GRP              VALUE 120.           03370000
011606         88  PV-END-OF-DAY                   VALUE 999.           03380000
011607     05  PV-PRGM-STAT-CDE         PIC  X(02).                     03390000
011608         88  PV-SUCCESS                      VALUE '00'.          03400000
011609         88  PV-UPDATE-NEEDED                VALUE '01'.          03410000
011610         88  PV-UPDATE-NOT-NEEDED            VALUE '02'.          03420000
011611         88  PV-INSERT                       VALUE '03'.          03430000
011612         88  PV-UPDATE-BYPASS                VALUE '04'.          03440000
011613         88  PV-NO-SUCCESS                   VALUE '05'.          03450000
011614         88  PV-UNEXPECTED                   VALUE '06'.          03460000
011615     05  PV-SEVERITY-ERR-CDE      PIC  X(02).                     03470000
011616         88  PV-CRITICAL-ERROR               VALUE '01'.          03480000
011617         88  PV-UNCRITICAL-ERROR             VALUE '02'.          03490000
011618     05  PV-REFER-INTEGRITY-ERR   PIC S9(04).                     03500000
011619         88  PV-RI-ERROR                     VALUES -530,         03510000
011620                                        -531, -532, -543.         03520000
C58015     05  PV-MQ-ERR-DISP-CNT       PIC  9(04) VALUE 0.             03530005
C58015     05  PV-ERROR-MSG-DISP        PIC  X(50) VALUE SPACES.        03540005
C58015     05  PV-MQ-CORR-ID-EDIT       PIC  -Z(4).                     03550005
011621                                                                  03560000
0410  *----------------------------------------------------------       03570000
0410  * EM - EMAIL MESSAGE DATA LINES                                   03580000
0410  *----------------------------------------------------------       03590000
0410   01  EM-EMAIL-MESSAGE-DATA-LINES.                                 03600000
0410       05  EM-DATA-LINE-1           PIC  X(80)  VALUE               03610000
0410           'HELO KOHLS@KOHLS.COM'.                                  03620000
0211                                                                    03630000
0410       05  EM-DATA-LINE-2           PIC  X(80)  VALUE               03640000
0410           'MAIL FROM: <KOHLSBATCHMAIL@KOHLS.COM>'.                 03650000
0211                                                                    03660000
0410       05  EM-DATA-LINE-3           PIC  X(80)  VALUE               03670000
0410           'RCPT TO: <MIO-CPS.COORDINATORS@KOHLS.COM>'.             03680000
0211                                                                    03690000
0410       05  EM-DATA-LINE-4           PIC  X(80)  VALUE               03700000
0410           'DATA'.                                                  03710000
0211                                                                    03720000
0211       05  EM-DATA-LINE-5           PIC  X(80)  VALUE               03730000
0211           'TO: MIO-CPS.COORDINATORS'.                              03740000
0211                                                                    03750000
0410       05  EM-DATA-LINE-6.                                          03760000
0410           10  EM-DATA-LINE-6-TXT   PIC  X(38)  VALUE               03770000
0410         'SUBJECT: CRITICAL PROMO TYPE ID CHANGE'.                  03780000
0410           10  EM-DATA-LINE-6-QM    PIC  X(04)  VALUE SPACES.       03790000
0410           10  FILLER               PIC  X(20)  VALUE SPACES.       03800000
0211                                                                    03810000
0211       05  EM-DATA-LINE-7.                                          03820000
0211           10  FILLER               PIC  X(04)  VALUE               03830000
0211           'TYPE'.                                                  03840000
0211           10  FILLER               PIC  X(03)  VALUE SPACES.       03850000
0211           10  FILLER               PIC  X(14)  VALUE               03860000
0211           'PROMOTION NAME'.                                        03870000
0211           10  FILLER               PIC  X(29)  VALUE SPACES.       03880000
0211           10  FILLER               PIC  X(10)  VALUE               03890000
0211           'START DATE'.                                            03900000
0211           10  FILLER               PIC  X(04)  VALUE SPACES.       03910000
0211           10  FILLER               PIC  X(08)  VALUE               03920000
0211           'END DATE'.                                              03930000
0211                                                                    03940000
0211       05  EM-DATA-LINE-8.                                          03950000
0211           10  FILLER               PIC  X(01)  VALUE SPACES.       03960000
0211           10  EM8-TYPE             PIC  X(01)  VALUE SPACES.       03970000
0211           10  FILLER               PIC  X(05)  VALUE SPACES.       03980000
0211           10  EM8-PROMO-NAME       PIC  X(40)  VALUE SPACES.       03990000
0211           10  FILLER               PIC  X(03)  VALUE SPACES.       04000000
0211           10  EM8-START-DATE       PIC  X(10)  VALUE SPACES.       04010000
0211           10  FILLER               PIC  X(03)  VALUE SPACES.       04020000
0211           10  EM8-END-DATE         PIC  X(10)  VALUE SPACES.       04030000
0211                                                                    04040000
0211       05  EM-DATA-LINE-9.                                          04050000
0211           10  FILLER               PIC  X(01)  VALUE SPACES.       04060000
0211           10  EM9-TYPE             PIC  X(01)  VALUE SPACES.       04070000
0211           10  FILLER               PIC  X(05)  VALUE SPACES.       04080000
0211           10  EM9-PROMO-NAME       PIC  X(40)  VALUE SPACES.       04090000
0211           10  FILLER               PIC  X(03)  VALUE SPACES.       04100000
0211           10  EM9-START-DATE       PIC  X(10)  VALUE SPACES.       04110000
0211           10  FILLER               PIC  X(03)  VALUE SPACES.       04120000
0211           10  EM9-END-DATE         PIC  X(10)  VALUE SPACES.       04130000
0211                                                                    04140000
0211       05  EM-DATA-LINE-10.                                         04150000
0211           10  FILLER               PIC  X(01)  VALUE SPACES.       04160000
0211           10  EM10-TYPE            PIC  X(01)  VALUE SPACES.       04170000
0211           10  FILLER               PIC  X(05)  VALUE SPACES.       04180000
0211           10  EM10-PROMO-NAME      PIC  X(40)  VALUE SPACES.       04190000
0211           10  FILLER               PIC  X(03)  VALUE SPACES.       04200000
0211           10  EM10-START-DATE      PIC  X(10)  VALUE SPACES.       04210000
0211           10  FILLER               PIC  X(03)  VALUE SPACES.       04220000
0211           10  EM10-END-DATE        PIC  X(10)  VALUE SPACES.       04230000
0211                                                                    04240000
0211       05  EM-DATA-LINE-11.                                         04250000
0211           10  FILLER               PIC  X(01)  VALUE SPACES.       04260000
0211           10  EM11-TYPE            PIC  X(01)  VALUE SPACES.       04270000
0211           10  FILLER               PIC  X(05)  VALUE SPACES.       04280000
0211           10  EM11-PROMO-NAME      PIC  X(40)  VALUE SPACES.       04290000
0211           10  FILLER               PIC  X(03)  VALUE SPACES.       04300000
0211           10  EM11-START-DATE      PIC  X(10)  VALUE SPACES.       04310000
0211           10  FILLER               PIC  X(03)  VALUE SPACES.       04320000
0211           10  EM11-END-DATE        PIC  X(10)  VALUE SPACES.       04330000
0211                                                                    04340000
0211       05  EM-DATA-LINE-12.                                         04350000
0211           10  FILLER               PIC  X(01)  VALUE SPACES.       04360000
0211           10  EM12-TYPE            PIC  X(01)  VALUE SPACES.       04370000
0211           10  FILLER               PIC  X(05)  VALUE SPACES.       04380000
0211           10  EM12-PROMO-NAME      PIC  X(40)  VALUE SPACES.       04390000
0211           10  FILLER               PIC  X(03)  VALUE SPACES.       04400000
0211           10  EM12-START-DATE      PIC  X(10)  VALUE SPACES.       04410000
0211           10  FILLER               PIC  X(03)  VALUE SPACES.       04420000
0211           10  EM12-END-DATE        PIC  X(10)  VALUE SPACES.       04430000
0211                                                                    04440000
0211       05  EM-DATA-LINE-13          PIC  X(80)  VALUE SPACES.       04450000
0211                                                                    04460000
0211       05  EM-DATA-LINE-14          PIC  X(80)  VALUE               04470000
0211           '*MISSING PRECEDENCE VALUE'.                             04480000
0211                                                                    04490000
0211       05  EM-DATA-LINE-15          PIC  X(80)  VALUE               04500000
0211           '*MISSING TOPPER CODE'.                                  04510000
0211                                                                    04520000
011644*----------------------------------------------------------       04530000
011645* MQ WORKING STORAGE                                              04540000
011646*----------------------------------------------------------       04550000
011647 01  MQV-WORKING-STORAGE.                                         04560000
011648     05  MQV-MQCONN               PIC  X(08) VALUE 'CSQBCONN'.    04570000
011650     05  MQV-MQOPEN               PIC  X(08) VALUE 'CSQBOPEN'.    04580000
011660     05  MQV-MQPUT                PIC  X(08) VALUE 'CSQBPUT '.    04590000
011670     05  MQV-MQGET                PIC  X(08) VALUE 'CSQBGET '.    04600000
011680     05  MQV-MQCMIT               PIC  X(08) VALUE 'CSQBCOMM'.    04610000
011690     05  MQV-MQBACK               PIC  X(08) VALUE 'CSQBBACK'.    04620000
011700     05  MQV-MQCLOSE              PIC  X(08) VALUE 'CSQBCLOS'.    04630000
011800     05  MQV-MQDISC               PIC  X(08) VALUE 'CSQBDISC'.    04640000
011900     05  MQV-MQCHECK              PIC  X(08) VALUE 'MQR2C'.       04650000
012000     05  MQV-HCONN                PIC S9(09) BINARY VALUE 0.      04660000
012100     05  MQV-COMPLETION-CODE      PIC S9(09) BINARY.              04670000
012200     05  MQV-REASON               PIC S9(09) BINARY.              04680000
012300     05  MQV-OPEN-OPTIONS         PIC S9(09) BINARY.              04690000
012400     05  MQV-PROMO-HANDLE         PIC S9(09) BINARY VALUE 0.      04700000
012500     05  MQV-ERROR-HANDLE         PIC S9(09) BINARY VALUE 0.      04710000
012600     05  MQV-REASON-TEXT          PIC  X(30) VALUE SPACES.        04720000
012700     05  MQV-MSGBUFFER            PIC  X(300) VALUE SPACES.       04730000
012800     05  MQV-ERRMSGBUF            PIC  X(300) VALUE SPACES.       04740000
012900     05  MQV-MSG-LENGTH           PIC S9(09) BINARY VALUE         04750000
013000                                              +300.               04760000
013100     05  MQV-DATA-LENGTH          PIC S9(09) BINARY.              04770000
013200                                                                  04780000
014056*----------------------------------------------------------       04790000
014057* DATE ROUTINE COPY MEMBERS                                       04800000
014058*----------------------------------------------------------       04810000
014059     COPY DPWS500.                                                04820000
014060                                                                  04830000
0410  *----------------------------------------------------------       04840000
0410  *  PARAMETER LIST FOR THE DYNAMIC ALLOCATION ROUTINE              04850000
0410  *----------------------------------------------------------       04860000
0410       COPY DPWS023.                                                04870000
0410                                                                    04880000
0211  *--------------------------------------------------------------   04890000
0211  * PROMOTION BUSINESS EVENT RECORD LAYOUT                          04900000
0211  *--------------------------------------------------------------   04910000
0211       COPY XSRD016.                                                04920000
0211                                                                    04930000
014070*-----------------------------------------------------------      04940000
014080* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         04950000
014090*-----------------------------------------------------------      04960000
014100     COPY DPWS004.                                                04970000
014200                                                                  04980000
014300*-----------------------------------------------------------      04990000
014400* DB2 ABEND COPYBOOK                                              05000000
014500*-----------------------------------------------------------      05010000
014600     COPY DPWS900.                                                05020000
014700                                                                  05030000
014710*-----------------------------------------------------------      05040000
014720* DB2 MESSAGE AREA                                                05050000
014730*-----------------------------------------------------------      05060000
014740     COPY SQLCA2.                                                 05070000
014750                                                                  05080000
014760*-----------------------------------------------------------      05090000
014770* OBJECT-DESCRIPTOR - MQ SERIES                                   05100000
014780*-----------------------------------------------------------      05110000
014790 01  MQM-OBJECT-DESCRIPTOR.                                       05120000
014800     COPY CMQODV.                                                 05130000
014900                                                                  05140000
015000*-----------------------------------------------------------      05150000
015100* MESSAGE-DESCRIPTOR - MQ SERIES                                  05160000
015200*-----------------------------------------------------------      05170000
015300 01  MQM-MESSAGE-DESCRIPTOR.                                      05180000
015400     COPY CMQMDV.                                                 05190000
015500                                                                  05200000
015600*-----------------------------------------------------------      05210000
015700* GET-MESSAGE-OPTIONS - MQ SERIES                                 05220000
015800*-----------------------------------------------------------      05230000
015900 01  MQM-GET-MESSAGE-OPTIONS.                                     05240000
016000     COPY CMQGMOV.                                                05250000
016010                                                                  05260000
016020*-----------------------------------------------------------      05270000
016030* PUT-MESSAGE-OPTIONS - MQ SERIES                                 05280000
016040*-----------------------------------------------------------      05290000
016050 01  MQM-PUT-MESSAGE-OPTIONS.                                     05300000
016060     COPY CMQPMOV.                                                05310000
016070                                                                  05320000
016080*-----------------------------------------------------------      05330000
016090* CONSTANTS - MQ SERIES                                           05340000
016100*-----------------------------------------------------------      05350000
016200 01  MQM-CONSTANTS.                                               05360000
016300     COPY CMQV.                                                   05370000
016400                                                                  05380000
016500*-----------------------------------------------------------      05390000
016600* PROGRAM COUNTERS                                                05400000
016700*-----------------------------------------------------------      05410000
016800 01  PC-PROGRAM-COUNTERS.                                         05420000
016900     05  PC-MESSAGE-FROM-QUEUE        PIC 9(09) VALUE ZEROS.      05430000
017000     05  PC-MESSAGES-WRITTEN-TO-FILE  PIC 9(09) VALUE ZEROS.      05440000
017100     05  PC-MESSAGES-TO-ERR-QUEUE     PIC 9(09) VALUE ZEROS.      05450000
017200     05  PC-MESSAGE-ALL               PIC 9(09) VALUE ZEROS.      05460000
017300     05  PC-MESSAGE-010               PIC 9(09) VALUE ZEROS.      05470000
017400     05  PC-MESSAGE-020               PIC 9(09) VALUE ZEROS.      05480000
017500     05  PC-MESSAGE-030               PIC 9(09) VALUE ZEROS.      05490000
017600     05  PC-MESSAGE-040               PIC 9(09) VALUE ZEROS.      05500000
017700     05  PC-MESSAGE-050               PIC 9(09) VALUE ZEROS.      05510000
017800     05  PC-MESSAGE-060               PIC 9(09) VALUE ZEROS.      05520000
017900     05  PC-MESSAGE-070               PIC 9(09) VALUE ZEROS.      05530000
018000     05  PC-MESSAGE-080               PIC 9(09) VALUE ZEROS.      05540000
018100     05  PC-MESSAGE-090               PIC 9(09) VALUE ZEROS.      05550000
018200     05  PC-MESSAGE-100               PIC 9(09) VALUE ZEROS.      05560000
018300     05  PC-MESSAGE-110               PIC 9(09) VALUE ZEROS.      05570000
018400     05  PC-MESSAGE-120               PIC 9(09) VALUE ZEROS.      05580000
018500     05  PC-STAT-00                   PIC 9(09) VALUE ZEROS.      05590000
018600     05  PC-STAT-01                   PIC 9(09) VALUE ZEROS.      05600000
018700     05  PC-STAT-02                   PIC 9(09) VALUE ZEROS.      05610000
018800     05  PC-STAT-03                   PIC 9(09) VALUE ZEROS.      05620000
018810     05  PC-STAT-04                   PIC 9(09) VALUE ZEROS.      05630000
018900     05  PC-STAT-05-01                PIC 9(09) VALUE ZEROS.      05640000
019000     05  PC-STAT-05-02                PIC 9(09) VALUE ZEROS.      05650000
019100     05  PC-STAT-06-01                PIC 9(09) VALUE ZEROS.      05660000
019200     05  PC-STAT-06-02                PIC 9(09) VALUE ZEROS.      05670000
101310     05  PC-ACTUAL-COMMITS            PIC 9(09) VALUE ZEROS.      05680000
019300                                                                  05690000
019400*-----------------------------------------------------------      05700000
019500* ERROR HANDLING                                                  05710000
019600*-----------------------------------------------------------      05720000
019700 01  PV-MISC-ABEND-FIELDS.                                        05730000
019800     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACE.      05740000
019900     05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACE.      05750000
020000     05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACE.      05760000
020100     05  PV-DB2-OPERATION             PIC X(30) VALUE SPACE.      05770000
020110     05  PV-COMPLETION-CODE           PIC S9(09) BINARY.          05780000
020120     05  PV-REASON                    PIC S9(09) BINARY.          05790000
020130     05  PV-REASON-TEXT               PIC X(30)  VALUE SPACES.    05800000
020200 01  ABEND-CODE                  PIC S9(4) VALUE ZEROS COMP SYNC. 05810000
020300     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           05820000
020400     88  ABEND-4013-DB2-ERROR              VALUE +4013.           05830000
020500     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           05840000
020600     88  ABEND-4020-MQ-ERROR               VALUE +4020.           05850000
020700     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           05860000
020800                                                                  05870000
020900*-----------------------------------------------------------      05880000
021000* DB2 COMMUNICATIONS AREA                                         05890000
021100*-----------------------------------------------------------      05900000
021200     EXEC SQL                                                     05910000
021300          INCLUDE SQLCA                                           05920000
021400     END-EXEC.                                                    05930000
021500                                                                  05940000
021600*-----------------------------------------------------------      05950000
021700* DB2 TABLE XST00037(XST_INFC_CNTL) - PROMO INTERFACE CONTROL     05960000
021800*                                             TABLE               05970000
021900*-----------------------------------------------------------      05980000
022000     EXEC SQL                                                     05990000
022100          INCLUDE XST00037                                        06000000
022200     END-EXEC.                                                    06010000
022300                                                                  06020000
022600*-----------------------------------------------------------      06030000
022700* LV- LINKAGE VARIABLES                                           06040000
022800*-----------------------------------------------------------      06050000
022900 01 LV-LINKAGE-VARIABLES.                                         06060000
023000    05  LV-BUS-EVENT-RECORD        PIC X(300) VALUE SPACES.       06070000
023100    05  LV-MAX-OFFSET-DTE          PIC X(08) VALUE SPACES.        06080000
023200    05  LV-LD-SQL-RETURN-CDE       PIC S9(4) VALUE +0.            06090000
023300    05  LV-PGM-STATUS-CDE          PIC X(02) VALUE SPACES.        06100000
023400    05  LV-LD-SEVERITY-LVL         PIC X(02) VALUE SPACES.        06110000
023500                                                                  06120000
023600*----------------------------------------------------------       06130000
023700 PROCEDURE DIVISION.                                              06140000
023800*----------------------------------------------------------       06150000
023900 0000-MAINLINE.                                                   06160000
024000                                                                  06170000
024100     PERFORM 1000-INITIALIZATION.                                 06180000
024200                                                                  06190000
024300     PERFORM 2000-PROCESS-RECORDS                                 06200000
024400             UNTIL PS-PROCESS-COMPLETE.                           06210000
024500                                                                  06220000
0410       IF PS-SEND-EMAIL-YES                                         06230000
0410          PERFORM 2950-SEND-EMAIL-MSG                               06240000
0410       END-IF.                                                      06250000
0410                                                                    06260000
024600     PERFORM 9000-WRAPUP.                                         06270000
024900                                                                  06280000
024910     GOBACK.                                                      06290000
024920                                                                  06300000
025000*0000-EXIT.                                                       06310000
025100 EJECT.                                                           06320000
025200                                                                  06330000
025300*----------------------------------------------------------       06340000
025400* 1000-INITIALIZATION.                                            06350000
025500*     INITIALIZATION AREA - GETS THE CURRENT DATE, INITIALIZES    06360000
025510*     PROGRAM COUNTERS, READS CONTROL CARDS, GETS THE OFFSET DATE 06370000
025520*     AND SETS UP QUEUES FOR PROCESSING.                          06380000
025530*----------------------------------------------------------       06390000
025540 1000-INITIALIZATION.                                             06400000
025550                                                                  06410000
025560     EXEC SQL                                                     06420000
025570         SET :PV-CURRENT-DATE = CURRENT DATE                      06430000
025580     END-EXEC.                                                    06440000
025590                                                                  06450000
025600     MOVE PV-CURRENT-DATE TO PV-SAVE-CCYY-MM-DD.                  06460000
025700     DISPLAY 'CURRENT DATE: ' PV-SAVE-CCYY-MM-DD.                 06470000
025710                                                                  06480000
025800     INITIALIZE PC-PROGRAM-COUNTERS.                              06490000
025900                                                                  06500000
026000     OPEN INPUT  CONTROL-CARD-1                                   06510000
026100                 CONTROL-CARD-2                                   06520000
026200                 CONTROL-CARD-3                                   06530000
026300                 CONTROL-CARD-4                                   06540000
026400          OUTPUT MESSAGE-LOG.                                     06550000
026500                                                                  06560000
026600     PERFORM 1010-READ-CONTROL-CARD-1.                            06570000
026700     PERFORM 1020-READ-CONTROL-CARD-2.                            06580000
026800     PERFORM 1030-READ-CONTROL-CARD-3.                            06590000
026810     PERFORM 1040-READ-CONTROL-CARD-4.                            06600000
026820                                                                  06610000
026830     IF  CC-QUEUE-MANAGER-NAME    =  SPACES                       06620000
026840      OR CC-BUS-EVNT-QUEUE-NAME   =  SPACES                       06630000
026850      OR CC-ERROR-QUEUE-NAME      =  SPACES                       06640000
026860      OR CC-BUS-DAYS-NBR          =  SPACES                       06650000
026870         DISPLAY 'EMPTY CONTROL CARD'                             06660000
026880         DISPLAY 'QUEUE MANAGER NAME: ' CC-QUEUE-MANAGER-NAME     06670000
026890         DISPLAY 'BUS EVENT QUEUE NAME: ' CC-BUS-EVNT-QUEUE-NAME  06680000
026900         DISPLAY 'ERROR QUEUE NAME: ' CC-ERROR-QUEUE-NAME         06690000
027000         DISPLAY 'BUSINESS DAYS #: ' CC-BUS-DAYS-NBR              06700000
027100         MOVE '1000-INITIALIZATION' TO PV-PARAGRAPH-NAME          06710000
027200         MOVE 'CONTROL CARD IS EMPTY' TO PV-OPERATION-MSG-1       06720000
027300         SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                   06730000
027400         PERFORM 9300-ABEND                                       06740000
027500     END-IF.                                                      06750000
027600                                                                  06760000
027700     MOVE CC-BUS-DAYS-NBR TO PV-BUS-DAYS.                         06770000
027800     MOVE PV-BUS-DAYS     TO PV-BUS-DAYS-NBR.                     06780000
027900     MOVE PV-BUS-DAYS-NBR TO PV-BUS-DAYS-AHEAD.                   06790000
027910     PERFORM 1400-SELECT-DATA.                                    06800000
027920     PERFORM 1500-FUTURE-OFFSET-DTE.                              06810000
027930     PERFORM 1600-GET-BUS-DAYS.                                   06820000
027940     PERFORM 1700-FORMAT-OFFST-DTE.                               06830000
027950     MOVE PV-FUT-OFFST-BUS-DTE TO LV-MAX-OFFSET-DTE.              06840000
027960                                                                  06850000
027970     PERFORM 1100-CONNECT-TO-QMGR.                                06860000
027980     PERFORM 1200-OPEN-BUS-EVNT-QUEUE.                            06870000
027990     PERFORM 1300-OPEN-ERROR-QUEUE.                               06880000
028000                                                                  06890000
028100     PERFORM 3000-RETRIEVE-MESSAGE.                               06900000
028200                                                                  06910000
028300*1000-EXIT.                                                       06920000
028400 EJECT.                                                           06930000
028500                                                                  06940000
028510*----------------------------------------------------------       06950000
028520* 1010-READ-CONTROL-CARD-1.                                       06960000
028530*     READ CONTROL CARD 1.  THIS GETS THE QUEUE MANAGER NAME.     06970000
028540*----------------------------------------------------------       06980000
028550 1010-READ-CONTROL-CARD-1.                                        06990000
028560                                                                  07000000
028570     READ CONTROL-CARD-1 INTO CC-CONTROL-CARD-1-LAYOUT.           07010000
028580                                                                  07020000
028590*1010-EXIT.                                                       07030000
028591 EJECT.                                                           07040000
028592                                                                  07050000
028593*----------------------------------------------------------       07060000
028594* 1020-READ-CONTROL-CARD-2.                                       07070000
028595*     READ CONTROL CARD 2.  THIS GETS THE BUSINESS EVENT QUEUE    07080000
028596*     NAME.                                                       07090000
028597*----------------------------------------------------------       07100000
028598 1020-READ-CONTROL-CARD-2.                                        07110000
028599                                                                  07120000
028600     READ CONTROL-CARD-2 INTO CC-CONTROL-CARD-2-LAYOUT.           07130000
028601                                                                  07140000
028602*1020-EXIT.                                                       07150000
028603 EJECT.                                                           07160000
028604                                                                  07170000
028605*----------------------------------------------------------       07180000
028606* 1030-READ-CONTROL-CARD-3.                                       07190000
028607*     READ CONTROL CARD 3.  THIS GETS THE ERROR QUEUE NAME.       07200000
028608*----------------------------------------------------------       07210000
028609 1030-READ-CONTROL-CARD-3.                                        07220000
028610                                                                  07230000
028611     READ CONTROL-CARD-3 INTO CC-CONTROL-CARD-3-LAYOUT.           07240000
028612                                                                  07250000
028613*1030-EXIT.                                                       07260000
028614 EJECT.                                                           07270000
028615                                                                  07280000
028616*----------------------------------------------------------       07290000
028617* 1040-READ-CONTROL-CARD-4.                                       07300000
028618*     READ CONTROL CARD 4.  THIS GETS THE NUMBER OF BUSINESS DAYS.07310000
028619*----------------------------------------------------------       07320000
028620 1040-READ-CONTROL-CARD-4.                                        07330000
028621                                                                  07340000
028622     READ CONTROL-CARD-4 INTO CC-CONTROL-CARD-4-LAYOUT.           07350000
028623                                                                  07360000
028624*1040-EXIT.                                                       07370000
028625 EJECT.                                                           07380000
028626                                                                  07390000
028630*----------------------------------------------------------       07400000
028700* 1100-CONNECT-TO-QMGR.                                           07410000
028800*     CONNECT TO THE QUEUE MANAGER.                               07420000
028900*----------------------------------------------------------       07430000
029000 1100-CONNECT-TO-QMGR.                                            07440000
029100                                                                  07450000
029200     CALL MQV-MQCONN USING CC-QUEUE-MANAGER-NAME                  07460000
029300                           MQV-HCONN                              07470000
029400                           MQV-COMPLETION-CODE                    07480000
029500                           MQV-REASON.                            07490000
029600                                                                  07500000
029700     EVALUATE TRUE                                                07510000
029800        WHEN MQV-COMPLETION-CODE = MQCC-OK                        07520000
029810             DISPLAY ' '                                          07530000
029900             DISPLAY 'SUCCESSFULLY CONNECTED TO: '                07540000
030000                                            CC-QUEUE-MANAGER-NAME 07550000
030100        WHEN OTHER                                                07560000
030200             CALL MQV-MQCHECK USING MQV-REASON                    07570000
030300                                    MQV-REASON-TEXT               07580000
030400             DISPLAY 'QUEUE CONNECTING TO ' CC-QUEUE-MANAGER-NAME 07590000
030500             MOVE '1100-CONNECT-TO-QMGR' TO PV-PARAGRAPH-NAME     07600000
030600             MOVE 'UNABLE TO CONNECT'  TO PV-OPERATION-MSG-1      07610000
030610             MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    07620000
030620             MOVE MQV-REASON             TO PV-REASON             07630000
030630             MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        07640000
030700             PERFORM 9400-MQ-ABEND                                07650000
030800     END-EVALUATE.                                                07660000
030900                                                                  07670000
031000*1100-EXIT.                                                       07680000
031100 EJECT.                                                           07690000
031110                                                                  07700000
031120*----------------------------------------------------------       07710000
031130* 1200-OPEN-BUS-EVNT-QUEUE.                                       07720000
031140*     OPEN THE BUSINESS EVENT QUEUE.                              07730000
031150*----------------------------------------------------------       07740000
031160 1200-OPEN-BUS-EVNT-QUEUE.                                        07750000
031170                                                                  07760000
031180     MOVE CC-BUS-EVNT-QUEUE-NAME   TO MQOD-OBJECTNAME             07770000
031190     MOVE CC-QUEUE-MANAGER-NAME    TO MQOD-OBJECTQMGRNAME.        07780000
031200                                                                  07790000
031300     COMPUTE MQV-OPEN-OPTIONS      = MQOO-INPUT-SHARED            07800000
031500                                   + MQOO-SAVE-ALL-CONTEXT        07810000
031600                                   + MQOO-FAIL-IF-QUIESCING.      07820000
031700                                                                  07830000
031800     CALL MQV-MQOPEN USING MQV-HCONN                              07840000
031900                           MQM-OBJECT-DESCRIPTOR                  07850000
032000                           MQV-OPEN-OPTIONS                       07860000
032100                           MQV-PROMO-HANDLE                       07870000
032200                           MQV-COMPLETION-CODE                    07880000
032300                           MQV-REASON.                            07890000
032400                                                                  07900000
032500     EVALUATE TRUE                                                07910000
032600        WHEN MQV-COMPLETION-CODE = MQCC-OK                        07920000
032700             DISPLAY 'SUCCESSFULLY OPENED QUEUE: '                07930000
032800                                           CC-BUS-EVNT-QUEUE-NAME 07940000
032900        WHEN OTHER                                                07950000
033000             CALL MQV-MQCHECK USING MQV-REASON                    07960000
033100                                   MQV-REASON-TEXT                07970000
033200             DISPLAY 'CANNOT OPEN QUEUE ' CC-BUS-EVNT-QUEUE-NAME  07980000
033300             MOVE '1200-OPEN-BUS-EVNT-QUEUE' TO PV-PARAGRAPH-NAME 07990000
033400             MOVE 'CANNOT OPEN QUEUE'  TO PV-OPERATION-MSG-1      08000000
033410             MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    08010000
033420             MOVE MQV-REASON             TO PV-REASON             08020000
033430             MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        08030000
033500             PERFORM 9200-DISCONNECT-QMGR                         08040000
033600             PERFORM 9400-MQ-ABEND                                08050000
033700     END-EVALUATE.                                                08060000
033800                                                                  08070000
033900*1200-EXIT.                                                       08080000
034000 EJECT.                                                           08090000
034100                                                                  08100000
034200*----------------------------------------------------------       08110000
034300* 1300-OPEN-ERROR-QUEUE.                                          08120000
034400*     OPEN THE ERROR QUEUE.                                       08130000
034500*----------------------------------------------------------       08140000
034600 1300-OPEN-ERROR-QUEUE.                                           08150000
034700                                                                  08160000
034800     MOVE CC-ERROR-QUEUE-NAME          TO MQOD-OBJECTNAME         08170000
034900     MOVE CC-QUEUE-MANAGER-NAME        TO MQOD-OBJECTQMGRNAME.    08180000
035000                                                                  08190000
035100     COMPUTE MQV-OPEN-OPTIONS      = MQOO-OUTPUT                  08200000
035300                                   + MQOO-SET-ALL-CONTEXT         08210000
035400                                   + MQOO-FAIL-IF-QUIESCING.      08220000
035500                                                                  08230000
035600     CALL MQV-MQOPEN USING MQV-HCONN                              08240000
035700                           MQM-OBJECT-DESCRIPTOR                  08250000
035800                           MQV-OPEN-OPTIONS                       08260000
035900                           MQV-ERROR-HANDLE                       08270000
036000                           MQV-COMPLETION-CODE                    08280000
036100                           MQV-REASON.                            08290000
036200                                                                  08300000
036300     EVALUATE TRUE                                                08310000
036400        WHEN MQV-COMPLETION-CODE = MQCC-OK                        08320000
036500             DISPLAY 'SUCCESSFULLY OPENED QUEUE: '                08330000
036600                                          CC-ERROR-QUEUE-NAME     08340000
036700        WHEN OTHER                                                08350000
036800             CALL MQV-MQCHECK USING MQV-REASON                    08360000
036900                                    MQV-REASON-TEXT               08370000
037000             MOVE '1300-OPEN-ERROR-QUEUE' TO PV-PARAGRAPH-NAME    08380000
037100             MOVE 'CANNOT OPEN QUEUE'  TO PV-OPERATION-MSG-1      08390000
037110             MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    08400000
037120             MOVE MQV-REASON             TO PV-REASON             08410000
037130             MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        08420000
037200             PERFORM 9200-DISCONNECT-QMGR                         08430000
037300             PERFORM 9400-MQ-ABEND                                08440000
037400     END-EVALUATE.                                                08450000
037500                                                                  08460000
037600*1300-EXIT.                                                       08470000
037700 EJECT.                                                           08480000
037800                                                                  08490000
037900*------------------------------------------------------           08500000
038000* 1400-SELECT-DATA.                                               08510000
038100*     SELECT THE FUTURE DAY OFFSET NUMBER FROM THE                08520000
038200*     XST_INTFC_CNTL TABLE.                                       08530000
038210*------------------------------------------------------           08540000
038220 1400-SELECT-DATA.                                                08550000
038230                                                                  08560000
038240     PERFORM                                                      08570000
038250         WITH TEST AFTER                                          08580000
038260         VARYING PV-SQL-SUB                                       08590000
038270         FROM 1 BY 1                                              08600000
038280         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08610000
038290                   OR  SQLCODE = 0)                               08620000
038293                                                                  08630000
038294         EXEC SQL                                                 08640000
038295             SELECT  MAX(FUT_DAY_OFFST_NBR)                       08650000
038296               INTO :XST00037-FUT-DAY-OFFST-NBR                   08660000
038297               FROM  XST_INTFC_CNTL                               08670000
038298               WITH UR                                            08680000
038299         END-EXEC                                                 08690000
038300                                                                  08700000
038301         EVALUATE TRUE                                            08710000
038302             WHEN SQLCODE = -904                                  08720000
038303             WHEN SQLCODE = -911                                  08730000
038304             WHEN SQLCODE = -913                                  08740000
038305                  CONTINUE                                        08750000
038306             WHEN SQLCODE = 0                                     08760000
038307                  MOVE XST00037-FUT-DAY-OFFST-NBR TO              08770000
038308                                     PV-FUT-OFFST-NBR             08780000
038309                  MOVE PV-FUT-OFFST-NBR TO PV-SAVE-DAYS-AHEAD     08790000
038310             WHEN OTHER                                           08800000
038311                  MOVE '1400-SELECT-DATA'                         08810000
038312                                TO  PV-PARAGRAPH-NAME             08820000
038313                  MOVE 'SELECT MAX OFFSET NBR'                    08830000
038314                                TO  PV-DB2-OPERATION              08840000
038315                  PERFORM 9500-SQL-ABEND-ROUTINE                  08850000
038316         END-EVALUATE                                             08860000
038317     END-PERFORM.                                                 08870000
038318                                                                  08880000
038319     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08890000
038320        MOVE '1400-SELECT-DATA'                                   08900000
038321                              TO  PV-PARAGRAPH-NAME               08910000
038322        MOVE 'SELECT RETRIES EXCEEDED'                            08920000
038323                              TO  PV-DB2-OPERATION                08930000
038324        PERFORM 9500-SQL-ABEND-ROUTINE                            08940000
038325     END-IF.                                                      08950000
038326                                                                  08960000
038327*1400-EXIT.                                                       08970000
038328 EJECT.                                                           08980000
038329                                                                  08990000
038330*----------------------------------------------------------       09000000
038331* 1500-FUTURE-OFFSET-DTE.                                         09010000
038340*     GETS THE FUTURE OFFSET DATE BASED ON THE NUMBER FOUND       09020000
038341*     IN THE XST_INTFC_CNTL TABLE.                                09030000
038342*----------------------------------------------------------       09040000
038343 1500-FUTURE-OFFSET-DTE.                                          09050000
038344                                                                  09060000
038345     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              09070000
038346     MOVE PV-SAVE-CCYY-MM-DD           TO DPG52-LK-DATE-INPUT.    09080000
038347     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   09090000
038348     SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   09100000
038349     SET  DPG51-INCREMENT-DATE         TO TRUE.                   09110000
038350     MOVE PV-SAVE-DAYS-AHEAD           TO DPG51-INCR-DECR-DAYS-X. 09120000
038351                                                                  09130000
038352     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    09140000
038353                                             DPG54 DPG55 DPG56.   09150000
038354     EVALUATE TRUE                                                09160000
038355         WHEN DPG54-NO-ERROR                                      09170000
038357             DISPLAY 'DAYS AHEAD NEEDED: ' PV-SAVE-DAYS-AHEAD     09180000
038358             DISPLAY 'RETRIEVING FUTURE OFFSET DATE'              09190000
038361         WHEN DPG54-SEVERE-ERROR                                  09200000
038362             DISPLAY ' '                                          09210000
038363             DISPLAY '** ABEND ** IN XSKUT034'                    09220000
038364             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    09230000
038365             DISPLAY '** CALLED BY 1500-FUTURE-OFFSET-DTE'        09240000
038366             DISPLAY '** ERROR MESSAGE = '                        09250000
038367                               DPG54-ERROR-MESSAGE                09260000
038368             DISPLAY '** DPG51 = ' DPG51                          09270000
038369             DISPLAY '** DPG52 = ' DPG52                          09280000
038370             DISPLAY '** DPG53 = ' DPG53                          09290000
038371             DISPLAY '** DPG54 = ' DPG54                          09300000
038372             DISPLAY '** DPG55 = ' DPG55                          09310000
038373             DISPLAY '** DPG56 = ' DPG56                          09320000
038374             MOVE '1500-FUTURE-OFFSET-DTE'                        09330000
038375                                           TO PV-PARAGRAPH-NAME   09340000
038376             MOVE 'ERROR VALIDATING INPUT DATE'                   09350000
038377                                           TO PV-OPERATION-MSG-1  09360000
038378             SET ABEND-4019-CAL-SUB-ERROR  TO TRUE                09370000
038379             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  09380000
038380             PERFORM 9300-ABEND                                   09390000
038381     END-EVALUATE.                                                09400000
038382                                                                  09410000
038383     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-FUTURE-OFFSET-DTE.         09420000
038384     DISPLAY 'NEW FUTURE OFFSET DATE: ' PV-FUTURE-OFFSET-DTE.     09430000
038385                                                                  09440000
038386*1500-EXIT.                                                       09450000
038387 EJECT.                                                           09460000
038388                                                                  09470000
038389*----------------------------------------------------------       09480000
038390* 1600-GET-BUS-DAYS.                                              09490000
038391*     INCREASES THE FUTURE OFFSET DATE BY THE AMOUNT OF BUSINESS  09500000
038400*     DAYS FOUND IN CONTROL CARD 4.                               09510000
038410*----------------------------------------------------------       09520000
038420 1600-GET-BUS-DAYS.                                               09530000
038421                                                                  09540000
038422     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              09550000
038423     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     09560000
038424     SET DPG51-INCREMENT-DATE      TO TRUE.                       09570000
038425     MOVE PV-BUS-DAYS-AHEAD        TO DPG51-INCR-DECR-BUS-DAYS-9. 09580000
038426     SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       09590000
038427     MOVE PV-FUTURE-OFFSET-DTE     TO DPG52-LK-DATE-INPUT.        09600000
038428                                                                  09610000
038429     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          09620000
038430                                             DPG53 DPG54          09630000
038440                                             DPG55 DPG56.         09640000
038450                                                                  09650000
038460     EVALUATE TRUE                                                09660000
038461         WHEN DPG54-NO-ERROR                                      09670000
038464             DISPLAY 'BUSINESS DAYS AHEAD: ' PV-BUS-DAYS-AHEAD    09680000
038465             DISPLAY 'RETRIEVING FUTURE OFFSET BUSINESS DATE'     09690000
038466         WHEN DPG54-SEVERE-ERROR                                  09700000
038467              DISPLAY '** ABEND - PROGRAM '                       09710000
038468                       PC-CURRENT-PROGRAM-NAME ' **'              09720000
038469              DISPLAY '** 1600-GET-BUS-DAYS'                      09730000
038470              DISPLAY '** CALL TO DPKUT500 RETURNED SEVERE ERROR' 09740000
038471              IF DPG54-CALENDAR-TYPE-INVALID                      09750000
038472                 DISPLAY '** DPG54-CALENDAR-TYPE-INVALID'         09760000
038473                 DISPLAY '** DPG51-CALENDAR-TYPE: '               09770000
038480                          DPG51-CALENDAR-TYPE                     09780000
038481              END-IF                                              09790000
038482              IF DPG54-DATE-INVALID                               09800000
038483                 DISPLAY '** DPG54-DATE-INVALID'                  09810000
038484                 DISPLAY '** DPG52-LK-DATE-INPUT: '               09820000
038485                          DPG52-LK-DATE-INPUT                     09830000
038486              END-IF                                              09840000
038487              IF DPG54-INCR-DECR-INVALID                          09850000
038488                 DISPLAY '** DPG54-INCR-DECR-INVALID'             09860000
038489                 DISPLAY '** DPG51-INCREMENT-DECREMENT-FLAG: '    09870000
038490                          DPG51-INCREMENT-DECREMENT-FLAG          09880000
038491              END-IF                                              09890000
038492              MOVE '1500-GET-DATE'                                09900000
038493                                            TO PV-PARAGRAPH-NAME  09910000
038494              MOVE 'ERROR VALIDATING INPUT DATE'                  09920000
038495                                            TO PV-OPERATION-MSG-1 09930000
038496              MOVE DPG54-ERROR-MESSAGE TO PV-OPERATION-MSG-2      09940000
038497              SET ABEND-4019-CAL-SUB-ERROR TO TRUE                09950000
038498              PERFORM 9300-ABEND                                  09960000
038499     END-EVALUATE.                                                09970000
038500                                                                  09980000
038501     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-PRCS-BUS-DTE.              09990000
038502     DISPLAY 'NEW FUTURE OFFSET BUSINESS DATE: ' PV-PRCS-BUS-DTE. 10000000
038503                                                                  10010000
038504*1600-EXIT.                                                       10020000
038505 EJECT.                                                           10030000
038506                                                                  10040000
038507*----------------------------------------------------------       10050000
038508* 1700-FORMAT-OFFST-DTE.                                          10060000
038509*     FORMATS THE DATE SO IT CAN BE SENT TO THE CALLED            10070000
038510*     PROGRAM.                                                    10080000
038511*----------------------------------------------------------       10090000
038512 1700-FORMAT-OFFST-DTE.                                           10100000
038513                                                                  10110000
038514     MOVE PV-PRCS-BUS-CCYY   TO PV-FUT-BUS-CCYY.                  10120000
038515     MOVE PV-PRCS-BUS-MM     TO PV-FUT-BUS-MM.                    10130000
038516     MOVE PV-PRCS-BUS-DD     TO PV-FUT-BUS-DD.                    10140000
038517                                                                  10150000
038518*1700-EXIT.                                                       10160000
038519 EJECT.                                                           10170000
038520                                                                  10180000
038521*----------------------------------------------------------       10190000
038530* 2000-PROCESS-RECORDS.                                           10200000
038540*     READ BUSINESS EVENT MESSAGE AND BASED ON THE CORRECT        10210000
038550*     BUSINESS EVENT; CALL THE CORRECT PROGRAM TO EXECUTE THE     10220000
038560*     BUSINESS LOGIC.                                             10230000
C52736*                                                                 10240002
C52736* -- ADDED CHECK FOR MQ TIME OUT.  IF NOT TIME OUT, PROCESS       10250002
C52736*    MESSAGE.                                                     10260002
C52736*                                                                 10270000
C52736* -- ADDED IF STATEMENTS TO CHECK COMMIT FREQUENCY BEFORE         10280000
C52736*    EVERY COMMIT                                                 10290000
038570*----------------------------------------------------------       10300000
038580 2000-PROCESS-RECORDS.                                            10310000
038590                                                                  10320000
C52736     IF PS-NOT-MQ-TIME-OUT                                        10330002
                                                                        10340002
038600*INITIALIZE VARIABLES FOR EACH MESSAGE RETRIEVED                  10350000
038700       INITIALIZE MESSAGE-LOG-RECORD                              10360002
038800       INITIALIZE LV-BUS-EVENT-RECORD                             10370002
038900                  LV-LD-SQL-RETURN-CDE                            10380002
039000                  LV-PGM-STATUS-CDE                               10390002
039100                  LV-LD-SEVERITY-LVL                              10400002
039200                                                                  10410000
039300       MOVE PV-BUS-EVNT-ID  TO PV-SAVE-BUS-EVNT-ID                10420002
039400                                                                  10430000
039500       EVALUATE TRUE                                              10440002
039600                                                                  10450000
039700**010 - AD EVENT                                                  10460000
039800        WHEN PV-AD-EVENT                                          10470000
040100             ADD +1                      TO PC-MESSAGE-010        10480000
040200                                            PC-MESSAGE-ALL        10490000
040300             SET PC-CALLED-XSKUP028      TO TRUE                  10500000
040400             PERFORM 2100-CALL-PROGRAM                            10510000
040500                                                                  10520000
040600**020 - PROMOTION                                                 10530000
040700        WHEN PV-PROMOTION                                         10540000
040730             ADD +1                      TO PC-MESSAGE-020        10550000
040740                                            PC-MESSAGE-ALL        10560000
040750             SET PC-CALLED-XSKUP031      TO TRUE                  10570000
040760             PERFORM 2100-CALL-PROGRAM                            10580000
040770                                                                  10590000
040780**030 - PRICE VERSION                                             10600000
040790        WHEN PV-PRICE-VERSION                                     10610000
041000             ADD +1                      TO PC-MESSAGE-030        10620000
041100                                            PC-MESSAGE-ALL        10630000
041200             SET PC-CALLED-XSKUP032      TO TRUE                  10640000
041300             PERFORM 2100-CALL-PROGRAM                            10650000
041400                                                                  10660000
041500**040 - ADHOC STORE GROUP                                         10670000
041600        WHEN PV-ADHOC-STR-GRP                                     10680000
041900             ADD +1                      TO PC-MESSAGE-040        10690000
042000                                            PC-MESSAGE-ALL        10700000
042100             SET PC-CALLED-XSKUP033      TO TRUE                  10710000
042200             PERFORM 2100-CALL-PROGRAM                            10720000
042300                                                                  10730000
042400**050 - ADHOC STORE LIST                                          10740000
042500        WHEN PV-ADHOC-STR-LIST                                    10750000
042530             ADD +1                      TO PC-MESSAGE-050        10760000
042540                                            PC-MESSAGE-ALL        10770000
042550             SET PC-CALLED-XSKUP034      TO TRUE                  10780000
042560             PERFORM 2100-CALL-PROGRAM                            10790000
042570                                                                  10800000
044500**090 - PRICING                                                   10810000
044600        WHEN PV-PRICING                                           10820000
044900             ADD +1                      TO PC-MESSAGE-090        10830000
045000                                            PC-MESSAGE-ALL        10840000
045100             SET PC-CALLED-XSKUP035      TO TRUE                  10850000
045200             PERFORM 2100-CALL-PROGRAM                            10860000
045300                                                                  10870000
045400**100 - BENEFIT WITH PURCHASE 'GET'                               10880000
045500*       WHEN PV-BENEFIT-W-PURCHASE                                10890000
045530*            ADD +1                      TO PC-MESSAGE-100        10900000
045540*                                           PC-MESSAGE-ALL        10910000
045550*            SET PC-CALLED-XSKUP036      TO TRUE                  10920000
045560*            PERFORM 2100-CALL-PROGRAM                            10930000
045570*                                                                 10940000
045580**110 - PRICING EXCLUSIONS                                        10950000
045590        WHEN PV-PRICING-EXCLUSIONS                                10960000
045900             ADD +1                      TO PC-MESSAGE-110        10970000
046000                                            PC-MESSAGE-ALL        10980000
046100             SET PC-CALLED-XSKUP037      TO TRUE                  10990000
046200             PERFORM 2100-CALL-PROGRAM                            11000000
046300                                                                  11010000
046400**120 - PRICING STORE GROUP                                       11020000
046500        WHEN PV-PRICING-STR-GRP                                   11030000
046720             ADD +1                      TO PC-MESSAGE-120        11040000
046730                                            PC-MESSAGE-ALL        11050000
046740             SET PC-CALLED-XSKUP038      TO TRUE                  11060000
046750             PERFORM 2100-CALL-PROGRAM                            11070000
046760                                                                  11080000
046770**999 - END OF DAY                                                11090000
046780        WHEN PV-END-OF-DAY                                        11100000
046790             SET PS-PROCESS-COMPLETE     TO TRUE                  11110000
046800                                                                  11120000
046801***NOT A LEGIT BUSINESS EVENT                                     11130000
046810        WHEN OTHER                                                11140000
046820             MOVE '06' TO LV-PGM-STATUS-CDE                       11150000
046830             MOVE '01' TO LV-LD-SEVERITY-LVL                      11160000
046831             MOVE 'XSKUT034'      TO PC-CALLED-PROGRAM            11170000
046900       END-EVALUATE                                               11180002
047000                                                                  11190000
047100       MOVE LV-PGM-STATUS-CDE  TO PV-PRGM-STAT-CDE                11200002
047200                                                                  11210000
047300       EVALUATE TRUE                                              11220002
047400        WHEN PV-SUCCESS OR PV-UPDATE-NEEDED OR PV-INSERT          11230000
C52736             IF PV-COMMIT-COUNT > PC-COMMIT-FREQ                  11240000
C52736                PERFORM 2200-COMMIT-DATA                          11250000
C52736                PERFORM 2300-COMMIT-MESSAGE                       11260000
C52736                MOVE +0 TO PV-COMMIT-COUNT                        11270000
C52736             END-IF                                               11280000
047700             PERFORM 2400-BACKUP-MESSAGE                          11290000
047800             PERFORM 2600-PROGRAM-STAT-CNT                        11300000
                                                                        11310000
047900        WHEN PV-UPDATE-NOT-NEEDED OR PV-UPDATE-BYPASS             11320000
C52736             IF PV-COMMIT-COUNT > PC-COMMIT-FREQ                  11330000
C52736                PERFORM 2200-COMMIT-DATA                          11340000
C52736                PERFORM 2300-COMMIT-MESSAGE                       11350000
C52736                MOVE +0 TO PV-COMMIT-COUNT                        11360000
C52736             END-IF                                               11370000
048100             PERFORM 2400-BACKUP-MESSAGE                          11380000
048200             PERFORM 2600-PROGRAM-STAT-CNT                        11390000
                                                                        11400000
PK6955        WHEN  PV-UNEXPECTED                                       11410000
048400             PERFORM 2500-PUT-ON-ERROR-QUEUE                      11420000
C52736             IF PV-COMMIT-COUNT > PC-COMMIT-FREQ                  11430000
C52736                PERFORM 2200-COMMIT-DATA                          11440000
C52736                PERFORM 2300-COMMIT-MESSAGE                       11450000
C52736                MOVE +0 TO PV-COMMIT-COUNT                        11460000
C52736             END-IF                                               11470000
048600             MOVE LV-LD-SEVERITY-LVL TO PV-SEVERITY-ERR-CDE       11480000
048700             PERFORM 2700-PROGRAM-ERROR-CNT                       11490000
                                                                        11500000
PK6955        WHEN PV-NO-SUCCESS                                        11510000
PK6955             PERFORM 2500-PUT-ON-ERROR-QUEUE                      11520000
C52736             IF PV-COMMIT-COUNT > PC-COMMIT-FREQ                  11530000
C52736                PERFORM 2200-COMMIT-DATA                          11540000
C52736                PERFORM 2300-COMMIT-MESSAGE                       11550000
C52736                MOVE +0 TO PV-COMMIT-COUNT                        11560000
C52736             END-IF                                               11570000
PK6955             MOVE LV-LD-SEVERITY-LVL TO PV-SEVERITY-ERR-CDE       11580000
PK6955             PERFORM 2700-PROGRAM-ERROR-CNT                       11590000
048900       END-EVALUATE                                               11600002
049000                                                                  11610000
0410         IF LV-LD-SQL-RETURN-CDE EQUAL 4051                         11620002
0211            PERFORM 2020-EMAIL-DATE-CHECK                           11630002
0410         END-IF                                                     11640002
C52736     END-IF.                                                      11650002
049100                                                                  11660000
049100     IF PS-PROCESS-CONTINUE                                       11670000
049200        PERFORM 3000-RETRIEVE-MESSAGE                             11680000
049300     END-IF.                                                      11690000
049400                                                                  11700000
049500*2000-EXIT.                                                       11710000
049600 EJECT.                                                           11720000
049700                                                                  11730000
0211  *----------------------------------------------------------       11740000
0211  * 2020-EMAIL-DATE-CHECK.                                          11750000
0211  *     WHEN PROCESSING A PROMOTION UPDATE RECORD, ONLY INCLUDE     11760000
0211  *     THE PROMOTION IN THE EMAIL IF THE PROMOTION START DATE      11770000
0211  *     IS WITHIN 14 DAYS OF THE CURRENT DATE.                      11780000
0211  *----------------------------------------------------------       11790000
0211   2020-EMAIL-DATE-CHECK.                                           11800000
0211                                                                    11810000
0211       IF XS016-ACTION-CDE = 'U'                                    11820000
0211          PERFORM 2030-CALC-CURRENT-PLUS-14                         11830000
0211          MOVE XS016-STRT-TMST      TO PV-TIMESTAMP-FIELD           11840000
0211          IF PV-TIMESTAMP-DATE <= PV-COMPARE-DATE                   11850000
0211              SET PS-SEND-EMAIL-YES TO TRUE                         11860000
0211              PERFORM 2050-POPULATE-EMAIL-MSG                       11870000
0211           END-IF                                                   11880000
0211       ELSE                                                         11890000
0211           SET PS-SEND-EMAIL-YES    TO TRUE                         11900000
0211           PERFORM 2050-POPULATE-EMAIL-MSG                          11910000
0211       END-IF.                                                      11920000
0211                                                                    11930000
0211  *2020-EXIT.                                                       11940000
0211   EJECT.                                                           11950000
0211                                                                    11960000
0211  *----------------------------------------------------------       11970000
0211  * 2030-CALC-CURRENT-PLUS-14.                                      11980000
0211  *     ADDS 14 DAYS TO THE CURRENT DATE. PROMOTION SHOULD ONLY     11990000
0211  *     BE LISTED IN THE EMAIL IF IT IS WITHIN 14 DAYS OF THE       12000000
0211  *     CURRENT DATE.                                               12010000
0211  *----------------------------------------------------------       12020000
0211   2030-CALC-CURRENT-PLUS-14.                                       12030000
0211                                                                    12040000
0211       INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              12050000
0211       MOVE PV-SAVE-CCYY-MM-DD           TO DPG52-LK-DATE-INPUT.    12060000
0211       SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   12070000
0211       SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   12080000
0211       SET  DPG51-INCREMENT-DATE         TO TRUE.                   12090000
0211       MOVE 14                           TO DPG51-INCR-DECR-DAYS-9. 12100000
0211                                                                    12110000
0211       CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    12120000
0211                                               DPG54 DPG55 DPG56.   12130000
0211                                                                    12140000
0211       EVALUATE TRUE                                                12150000
0211           WHEN DPG54-NO-ERROR                                      12160000
0211               MOVE DPG55-DB2-ISO-DATE-FMT TO PV-COMPARE-DATE       12170000
0211           WHEN DPG54-SEVERE-ERROR                                  12180000
0211               DISPLAY ' '                                          12190000
0211               DISPLAY '** ABEND ** IN XSKUT034'                    12200000
0211               DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    12210000
0211               DISPLAY '** CALLED BY 2030-CALC-CURRENT-PLUS-14'     12220000
0211               DISPLAY '** ERROR MESSAGE = '                        12230000
0211                                 DPG54-ERROR-MESSAGE                12240000
0211               DISPLAY '** DPG51 = ' DPG51                          12250000
0211               DISPLAY '** DPG52 = ' DPG52                          12260000
0211               DISPLAY '** DPG53 = ' DPG53                          12270000
0211               DISPLAY '** DPG54 = ' DPG54                          12280000
0211               DISPLAY '** DPG55 = ' DPG55                          12290000
0211               DISPLAY '** DPG56 = ' DPG56                          12300000
0211               MOVE '2030-CALC-CURRENT-PLUS-14'                     12310000
0211                                             TO PV-PARAGRAPH-NAME   12320000
0211               MOVE 'ERROR ADDING 14 DAYS TO CURRENT DATE'          12330000
0211                                             TO PV-OPERATION-MSG-1  12340000
0211               SET ABEND-4019-CAL-SUB-ERROR  TO TRUE                12350000
0211               MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  12360000
0211               PERFORM 9300-ABEND                                   12370000
0211       END-EVALUATE.                                                12380000
0211                                                                    12390000
0211  *2030-EXIT.                                                       12400000
0211   EJECT.                                                           12410000
0211                                                                    12420000
0211  *----------------------------------------------------------       12430000
0211  * 2050-POPULATE-EMAIL-MSG.                                        12440000
0211  *     CAN DISPLAY THE TEXT FOR UP TO 5 PROMOTIONS.                12450000
0211  *----------------------------------------------------------       12460000
0211   2050-POPULATE-EMAIL-MSG.                                         12470000
0211                                                                    12480000
0211       IF EM8-PROMO-NAME = SPACES                                   12490000
0211          MOVE XS016-ACTION-CDE       TO EM8-TYPE                   12500000
0211          MOVE XS016-CPLT-NM          TO EM8-PROMO-NAME             12510000
0211          MOVE XS016-STRT-TMST        TO PV-TIMESTAMP-FIELD         12520000
0211          MOVE PV-TIMESTAMP-DATE      TO EM8-START-DATE             12530000
0211          MOVE XS016-END-TMST         TO PV-TIMESTAMP-FIELD         12540000
0211          MOVE PV-TIMESTAMP-DATE      TO EM8-END-DATE               12550000
0211       ELSE                                                         12560000
0211       IF EM9-PROMO-NAME = SPACES                                   12570000
0211          MOVE XS016-ACTION-CDE       TO EM9-TYPE                   12580000
0211          MOVE XS016-CPLT-NM          TO EM9-PROMO-NAME             12590000
0211          MOVE XS016-STRT-TMST        TO PV-TIMESTAMP-FIELD         12600000
0211          MOVE PV-TIMESTAMP-DATE      TO EM9-START-DATE             12610000
0211          MOVE XS016-END-TMST         TO PV-TIMESTAMP-FIELD         12620000
0211          MOVE PV-TIMESTAMP-DATE      TO EM9-END-DATE               12630000
0211       ELSE                                                         12640000
0211       IF EM10-PROMO-NAME = SPACES                                  12650000
0211          MOVE XS016-ACTION-CDE       TO EM10-TYPE                  12660000
0211          MOVE XS016-CPLT-NM          TO EM10-PROMO-NAME            12670000
0211          MOVE XS016-STRT-TMST        TO PV-TIMESTAMP-FIELD         12680000
0211          MOVE PV-TIMESTAMP-DATE      TO EM10-START-DATE            12690000
0211          MOVE XS016-END-TMST         TO PV-TIMESTAMP-FIELD         12700000
0211          MOVE PV-TIMESTAMP-DATE      TO EM10-END-DATE              12710000
0211       ELSE                                                         12720000
0211       IF EM11-PROMO-NAME = SPACES                                  12730000
0211          MOVE XS016-ACTION-CDE       TO EM11-TYPE                  12740000
0211          MOVE XS016-CPLT-NM          TO EM11-PROMO-NAME            12750000
0211          MOVE XS016-STRT-TMST        TO PV-TIMESTAMP-FIELD         12760000
0211          MOVE PV-TIMESTAMP-DATE      TO EM11-START-DATE            12770000
0211          MOVE XS016-END-TMST         TO PV-TIMESTAMP-FIELD         12780000
0211          MOVE PV-TIMESTAMP-DATE      TO EM11-END-DATE              12790000
0211       ELSE                                                         12800000
0211       IF EM12-PROMO-NAME = SPACES                                  12810000
0211          MOVE XS016-ACTION-CDE       TO EM12-TYPE                  12820000
0211          MOVE XS016-CPLT-NM          TO EM12-PROMO-NAME            12830000
0211          MOVE XS016-STRT-TMST        TO PV-TIMESTAMP-FIELD         12840000
0211          MOVE PV-TIMESTAMP-DATE      TO EM12-START-DATE            12850000
0211          MOVE XS016-END-TMST         TO PV-TIMESTAMP-FIELD         12860000
0211          MOVE PV-TIMESTAMP-DATE      TO EM12-END-DATE              12870000
0211       END-IF.                                                      12880000
0211                                                                    12890000
0211  *2050-EXIT.                                                       12900000
0211   EJECT.                                                           12910000
0211                                                                    12920000
049800*----------------------------------------------------------       12930000
049900* 2100-CALL-PROGRAM.                                              12940000
050000*     CALL THE CORRECT PROGRAM TO EXECUTE MESSAGE.                12950000
050100*----------------------------------------------------------       12960000
050200 2100-CALL-PROGRAM.                                               12970000
050300                                                                  12980000
050400     MOVE PV-MESSAGE-RECORD   TO LV-BUS-EVENT-RECORD.             12990000
0410       MOVE ZEROES              TO LV-LD-SQL-RETURN-CDE.            13000000
050500                                                                  13010000
050600     CALL PC-CALLED-PROGRAM USING LV-LINKAGE-VARIABLES.           13020000
050700                                                                  13030000
050800*2100-EXIT.                                                       13040000
050900 EJECT.                                                           13050000
051000                                                                  13060000
051100*----------------------------------------------------------       13070000
051200* 2200-COMMIT-DATA.                                               13080000
051300*     COMMIT DATA TO THE DATABASE.                                13090000
051400*----------------------------------------------------------       13100000
051500 2200-COMMIT-DATA.                                                13110000
051600                                                                  13120000
051700     PERFORM                                                      13130000
051800         WITH TEST AFTER                                          13140000
051900         VARYING PV-SQL-SUB                                       13150000
052000         FROM 1 BY 1                                              13160000
052100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 13170000
052200                   OR  SQLCODE = 0)                               13180000
052300                                                                  13190000
052400         EXEC SQL                                                 13200000
052500             COMMIT                                               13210000
052600         END-EXEC                                                 13220000
052700                                                                  13230000
052800         EVALUATE TRUE                                            13240000
052900             WHEN SQLCODE = -904                                  13250000
053000             WHEN SQLCODE = -911                                  13260000
053100             WHEN SQLCODE = -913                                  13270000
053300                  CONTINUE                                        13280000
053200             WHEN SQLCODE = 0                                     13290000
053300                  ADD 1 TO PC-ACTUAL-COMMITS                      13300000
053400             WHEN OTHER                                           13310000
053500                  DISPLAY 'UNABLE TO COMMIT DATA'                 13320000
053600                  PERFORM 3100-BACK-OUT-MQV-CHANGES               13330000
053700                  PERFORM 9200-DISCONNECT-QMGR                    13340000
053800                  MOVE '2200-COMMIT-DATA' TO PV-PARAGRAPH-NAME    13350000
053900                  MOVE 'COMMIT DID NOT WORK' TO PV-DB2-OPERATION  13360000
054000                  PERFORM 9500-SQL-ABEND-ROUTINE                  13370000
054100         END-EVALUATE                                             13380000
054200     END-PERFORM.                                                 13390000
054300                                                                  13400000
054400     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        13410000
054500         PERFORM 3100-BACK-OUT-MQV-CHANGES                        13420000
054600         PERFORM 9200-DISCONNECT-QMGR                             13430000
054700         MOVE '2200-UPDATE-COMMIT'                                13440000
054800                               TO  PV-PARAGRAPH-NAME              13450000
054900         MOVE 'COMMIT RETRIES EXCEEDED'                           13460000
055000                               TO  PV-DB2-OPERATION               13470000
055100         PERFORM 9500-SQL-ABEND-ROUTINE                           13480000
055200     END-IF.                                                      13490000
055300                                                                  13500000
055400*2200-EXIT.                                                       13510000
055500 EJECT.                                                           13520000
055600                                                                  13530000
055700*----------------------------------------------------------       13540000
055800* 2300-COMMIT-MESSAGE.                                            13550000
055900*     REMOVES THE MESSAGE FROM THE QUEUE.                         13560000
056000*----------------------------------------------------------       13570000
056100 2300-COMMIT-MESSAGE.                                             13580000
056200                                                                  13590000
056300     CALL MQV-MQCMIT USING MQV-HCONN                              13600000
056400                           MQV-COMPLETION-CODE                    13610000
056500                           MQV-REASON.                            13620000
056600                                                                  13630000
056700     EVALUATE TRUE                                                13640000
056800        WHEN MQV-COMPLETION-CODE = MQCC-OK                        13650000
056900             CONTINUE                                             13660000
057000        WHEN OTHER                                                13670000
057100             CALL MQV-MQCHECK USING MQV-REASON                    13680000
057200                                    MQV-REASON-TEXT               13690000
057300             MOVE '2300-COMMIT-MESSAGE'  TO PV-PARAGRAPH-NAME     13700000
057400             MOVE 'ERROR COMMITING DATA' TO PV-OPERATION-MSG-1    13710000
057410             MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    13720000
057420             MOVE MQV-REASON             TO PV-REASON             13730000
057430             MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        13740000
057500             PERFORM 3100-BACK-OUT-MQV-CHANGES                    13750000
057600             PERFORM 9200-DISCONNECT-QMGR                         13760000
057700             PERFORM 9400-MQ-ABEND                                13770000
057800     END-EVALUATE.                                                13780000
057900                                                                  13790000
058000*2300-EXIT.                                                       13800000
058100 EJECT.                                                           13810000
058200                                                                  13820000
058300*----------------------------------------------------------       13830000
058400* 2400-BACKUP-MESSAGE.                                            13840000
058500*     WRITES THE MESSAGE TO A LOG IN CASE RECOVERY IS NEEDED.     13850000
058600*----------------------------------------------------------       13860000
058700 2400-BACKUP-MESSAGE.                                             13870000
058800                                                                  13880000
058900     MOVE MQV-MSGBUFFER TO MESSAGE-LOG-RECORD.                    13890000
059000     WRITE MESSAGE-LOG-RECORD.                                    13900000
059100                                                                  13910000
059200     ADD +1 TO PC-MESSAGES-WRITTEN-TO-FILE.                       13920000
059300                                                                  13930000
059400*2400-EXIT.                                                       13940000
059500 EJECT.                                                           13950000
059600                                                                  13960000
059700*----------------------------------------------------------       13970000
059800* 2500-PUT-ON-ERROR-QUEUE.                                        13980000
059900*     PUTS THE MESSAGE THAT HAD AN ERROR ON ERROR QUEUE.          13990000
060000*----------------------------------------------------------       14000000
060100 2500-PUT-ON-ERROR-QUEUE.                                         14010000
060200                                                                  14020000
060210     MOVE LV-LD-SQL-RETURN-CDE      TO PV-REFER-INTEGRITY-ERR.    14030000
060300     MOVE CC-ERROR-QUEUE-NAME       TO MQOD-OBJECTNAME.           14040000
060400     MOVE CC-QUEUE-MANAGER-NAME     TO MQOD-OBJECTQMGRNAME.       14050000
060500                                                                  14060000
060600     MOVE PV-MESSAGE-RECORD         TO MQV-ERRMSGBUF.             14070000
060700                                                                  14080000
060800     MOVE MQMI-NONE                 TO MQMD-MSGID.                14090000
060900     MOVE MQCI-NONE                 TO MQMD-CORRELID              14100000
060901                                       PV-NULL-VALUE.             14110000
060907                                                                  14120000
060910     IF PV-RI-ERROR                                               14130000
060920        MOVE PC-RI-ERROR-530        TO PV-MQ-CORR-ID              14140000
060921                                       PV-SQL-ERR-CDE             14150000
060930     ELSE                                                         14160000
060940        MOVE LV-LD-SQL-RETURN-CDE   TO PV-MQ-CORR-ID              14170000
060941                                       PV-SQL-ERR-CDE             14180000
060950     END-IF.                                                      14190000
060960                                                                  14200000
C58015     IF PV-MQ-ERR-DISP-CNT  < 1000                                14210005
C58015        ADD +1                      TO PV-MQ-ERR-DISP-CNT         14220005
C58015        MOVE PV-MQ-CORR-ID          TO PV-MQ-CORR-ID-EDIT         14230005
C58015        MOVE SPACES                 TO PV-ERROR-MSG-DISP          14240005
C58015        MOVE MQV-ERRMSGBUF(1:50)    TO PV-ERROR-MSG-DISP          14250005
C58015        DISPLAY 'SQL CODE = '          PV-MQ-CORR-ID-EDIT         14260006
C58015        DISPLAY PV-ERROR-MSG-DISP                                 14270005
C58015     END-IF                                                       14280005
C58015                                                                  14290005
060970     MOVE PV-MQ-CORR-ID-CHAR        TO PV-FORMAT-MQ-CORR-ID.      14300000
060971     MOVE PV-FORMAT-CORR-ID         TO MQMD-CORRELID.             14310000
061000     MOVE +300                      TO MQV-MSG-LENGTH.            14320000
061100     MOVE MQFMT-STRING              TO MQMD-FORMAT.               14330000
061101     ADD 1                          TO PV-MQ-ERROR-COUNT.         14340000
061103     MOVE PV-MQ-ERROR-COUNT         TO MQMD-APPLORIGINDATA.       14350000
061200     COMPUTE MQPMO-OPTIONS  =  MQPMO-SYNCPOINT +                  14360000
061300                               MQPMO-SET-ALL-CONTEXT.             14370000
061400                                                                  14380000
061500     CALL MQV-MQPUT USING MQV-HCONN                               14390000
061600                          MQV-ERROR-HANDLE                        14400000
061700                          MQM-MESSAGE-DESCRIPTOR                  14410000
061800                          MQM-PUT-MESSAGE-OPTIONS                 14420000
061900                          MQV-MSG-LENGTH                          14430000
062000                          MQV-ERRMSGBUF                           14440000
062100                          MQV-COMPLETION-CODE                     14450000
062200                          MQV-REASON.                             14460000
062300                                                                  14470000
062400     EVALUATE TRUE                                                14480000
062500        WHEN MQV-COMPLETION-CODE = MQCC-OK                        14490000
062600             ADD +1        TO PC-MESSAGES-TO-ERR-QUEUE            14500000
062700        WHEN OTHER                                                14510000
062800             DISPLAY 'UNABLE TO WRITE TO ERROR QUEUE'             14520000
062900             CALL MQV-MQCHECK USING MQV-REASON                    14530000
063000                                    MQV-REASON-TEXT               14540000
063100             MOVE '2500-PUT-ON-ERROR-QUEUE' TO PV-PARAGRAPH-NAME  14550000
063200             MOVE 'MQBACK ERROR'      TO PV-OPERATION-MSG-1       14560000
063210             MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    14570000
063220             MOVE MQV-REASON             TO PV-REASON             14580000
063230             MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        14590000
063300             PERFORM 9200-DISCONNECT-QMGR                         14600000
063400             PERFORM 9400-MQ-ABEND                                14610000
063500     END-EVALUATE.                                                14620000
063600                                                                  14630000
063700*2500-EXIT.                                                       14640000
063800 EJECT.                                                           14650000
063900                                                                  14660000
064000*----------------------------------------------------------       14670000
064100* 2600-PROGRAM-STAT-CNT.                                          14680000
064200*     COUNTS ALL THE SUCCESSFUL STATUS CODES PROCESSED.           14690000
064300*----------------------------------------------------------       14700000
064400 2600-PROGRAM-STAT-CNT.                                           14710000
064500                                                                  14720000
064600     EVALUATE TRUE                                                14730000
064700         WHEN PV-SUCCESS                                          14740000
064800              ADD +1 TO PC-STAT-00                                14750000
064900         WHEN PV-UPDATE-NEEDED                                    14760000
065000              ADD +1 TO PC-STAT-01                                14770000
065010         WHEN PV-UPDATE-NOT-NEEDED                                14780000
065011              ADD +1 TO PC-STAT-02                                14790000
065012         WHEN PV-INSERT                                           14800000
065013              ADD +1 TO PC-STAT-03                                14810000
065014         WHEN PV-UPDATE-BYPASS                                    14820000
065015              ADD +1 TO PC-STAT-04                                14830000
065016     END-EVALUATE.                                                14840000
065017                                                                  14850000
065018*2600-EXIT.                                                       14860000
065019 EJECT.                                                           14870000
065020                                                                  14880000
065021*----------------------------------------------------------       14890000
065022* 2700-PROGRAM-ERROR-CNT.                                         14900000
065023*     COUNTS ALL THE UNSUCCESSFUL STATUS CODES PROCESSED.         14910000
065024*----------------------------------------------------------       14920000
065025 2700-PROGRAM-ERROR-CNT.                                          14930000
065026                                                                  14940000
065027     EVALUATE TRUE                                                14950000
065028         WHEN PV-NO-SUCCESS                                       14960000
065029              IF PV-CRITICAL-ERROR                                14970000
065030                 ADD +1 TO PC-STAT-05-01                          14980000
065031              ELSE                                                14990000
065032                 ADD +1 TO PC-STAT-05-02                          15000000
065033              END-IF                                              15010000
065034         WHEN PV-UNEXPECTED                                       15020000
065035              IF PV-CRITICAL-ERROR                                15030000
065036                 ADD +1 TO PC-STAT-06-01                          15040000
065037              ELSE                                                15050000
065038                 ADD +1 TO PC-STAT-06-02                          15060000
065039              END-IF                                              15070000
065040     END-EVALUATE.                                                15080000
065041                                                                  15090000
065042*2700-EXIT.                                                       15100000
065043 EJECT.                                                           15110000
065066                                                                  15120000
0410  *----------------------------------------------------------       15130000
0410  * 2950-SEND-EMAIL-MSG.                                            15140000
0410  *     SEND AN E-MAIL TO MIO-CPS.COORDINATORS                      15150000
0410  *----------------------------------------------------------       15160000
0410   2950-SEND-EMAIL-MSG.                                             15170000
0410                                                                    15180000
0410       INITIALIZE DP023-DYNALC-PARMS.                               15190000
0410       MOVE 'OUT02'                TO DP023-DDNAME.                 15200000
0410       SET DP023-DSNAME-SYSOUT     TO TRUE.                         15210000
0410       SET DP023-FREE-CLOSE-YES    TO TRUE.                         15220000
0410       SET DP023-RECFM-FIXED-BLOCK TO TRUE.                         15230000
0410       MOVE 80     TO DP023-RECSZ.                                  15240000
0211       MOVE 15     TO DP023-RECOUNT.                                15250000
0410       MOVE 'B'    TO DP023-PRINT-CLASS.                            15260000
0410       MOVE 'SMTP' TO DP023-PRINT-WRITER.                           15270000
0410       PERFORM DP023-0000-DYNALC.                                   15280000
0410                                                                    15290000
0410       OPEN OUTPUT EMAIL-MSG-FILE.                                  15300000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-1.             15310000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-2.             15320000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-3.             15330000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-4.             15340000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-5.             15350000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-6.             15360000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-7.             15370000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-8              15380000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-9.             15390000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-10.            15400000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-11.            15410000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-12.            15420000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-13.            15430000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-14.            15440000
0410       WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-15.            15450000
0410       CLOSE EMAIL-MSG-FILE.                                        15460000
0410                                                                    15470000
065067*----------------------------------------------------------       15480000
065068* 3000-RETRIEVE-MESSAGE.                                          15490000
065069*     RETRIEVES THE NEXT MESSAGE FROM THE BUSINESS EVENT QUEUE.   15500000
C52736*                                                                 15510002
C52736*  -- CHANGED WAIT INTERVAL TO 3 SECONDS AND ADDED COMMIT         15520002
C52736*     AFTER A TIME OUT.  THIS WILL CAUSE A TIMED COMMIT (IF       15530002
C52736*     NEEDED) EVERY 3 SECONDS.                                    15540002
C52736*                                                                 15550002
065070*----------------------------------------------------------       15560000
065071 3000-RETRIEVE-MESSAGE.                                           15570000
065072                                                                  15580000
065073     INITIALIZE MQV-MSGBUFFER                                     15590000
065074                MQV-ERRMSGBUF.                                    15600000
C52736     SET PS-NOT-MQ-TIME-OUT TO TRUE.                              15610002
065075                                                                  15620000
065076     MOVE +300                 TO MQV-MSG-LENGTH.                 15630000
065077     MOVE MQMI-NONE            TO MQMD-MSGID.                     15640000
065078     MOVE MQCI-NONE            TO MQMD-CORRELID.                  15650000
065079     MOVE CC-BUS-EVNT-QUEUE-NAME   TO MQOD-OBJECTNAME.            15660000
065080     MOVE MQFMT-STRING         TO MQMD-FORMAT.                    15670000
C52736     MOVE 3000                 TO MQGMO-WAITINTERVAL.             15680002
065082                                                                  15690000
065083     COMPUTE MQGMO-OPTIONS  =  MQGMO-SYNCPOINT +                  15700000
065084                               MQGMO-CONVERT   +                  15710000
065085                               MQGMO-ACCEPT-TRUNCATED-MSG +       15720000
065086                               MQGMO-WAIT.                        15730000
065087                                                                  15740000
065088     CALL MQV-MQGET USING MQV-HCONN                               15750000
065089                          MQV-PROMO-HANDLE                        15760000
065090                          MQM-MESSAGE-DESCRIPTOR                  15770000
065091                          MQM-GET-MESSAGE-OPTIONS                 15780000
065092                          MQV-MSG-LENGTH                          15790000
065093                          MQV-MSGBUFFER                           15800000
065094                          MQV-DATA-LENGTH                         15810000
065095                          MQV-COMPLETION-CODE                     15820000
065096                          MQV-REASON.                             15830000
065097                                                                  15840000
065098     IF  MQV-COMPLETION-CODE = MQCC-OK                            15850000
065099         ADD +1             TO PC-MESSAGE-FROM-QUEUE              15860000
C52736         ADD +1             TO PV-COMMIT-COUNT                    15870000
065100         MOVE SPACES TO PV-MESSAGE-RECORD                         15880000
065101         MOVE MQV-MSGBUFFER TO PV-MESSAGE-RECORD                  15890000
0211                                 XS016-PROMOTION-RECORD             15900000
065102         IF MQMD-APPLORIGINDATA = SPACES                          15910000
065103            INITIALIZE PV-MQ-ERROR-COUNT                          15920000
065104         ELSE                                                     15930000
065105            MOVE MQMD-APPLORIGINDATA TO PV-MQ-ERROR-COUNT         15940000
065106         END-IF                                                   15950000
065107     ELSE                                                         15960000
065108         EVALUATE TRUE                                            15970000
065109            WHEN MQV-REASON = MQRC-Q-MGR-QUIESCING                15980000
065110            WHEN MQV-REASON = MQRC-Q-MGR-STOPPING                 15990000
065111                 CONTINUE                                         16000000
                                                                        16010002
065112            WHEN MQV-REASON = MQRC-NO-MSG-AVAILABLE               16020000
                                                                        16030002
C52736*                --- CHECK IF COMMIT NEEDED AFTER TIME OUT ---    16040002
C52736                 IF PV-COMMIT-COUNT > ZERO                        16050002
C52736                    PERFORM 2200-COMMIT-DATA                      16060002
C52736                    PERFORM 2300-COMMIT-MESSAGE                   16070002
C52736                    MOVE +0 TO PV-COMMIT-COUNT                    16080002
C52736                 END-IF                                           16090002
C52736                 SET PS-MQ-TIME-OUT TO TRUE                       16100002
                                                                        16110002
065114            WHEN OTHER                                            16120000
065115                 CALL MQV-MQCHECK USING MQV-REASON                16130000
065116                                        MQV-REASON-TEXT           16140000
065117                 MOVE '3000-RETRIEVE-MESSAGE' TO PV-PARAGRAPH-NAME16150000
065118                 MOVE 'ERROR RETRIEVING MESSAGE'                  16160000
065119                                       TO PV-OPERATION-MSG-1      16170000
065120                 MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE16180000
065121                 MOVE MQV-REASON             TO PV-REASON         16190000
065122                 MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT    16200000
065123                 PERFORM 3100-BACK-OUT-MQV-CHANGES                16210000
065124                 PERFORM 9200-DISCONNECT-QMGR                     16220000
065125                 PERFORM 9400-MQ-ABEND                            16230000
065126         END-EVALUATE                                             16240000
065127     END-IF.                                                      16250000
065128                                                                  16260000
065129*3000-EXIT.                                                       16270000
065130 EJECT.                                                           16280000
065131                                                                  16290000
065132*----------------------------------------------------------       16300000
065133* 3100-BACK-OUT-MQV-CHANGES.                                      16310000
065134*     ROLLBACK MQ CHANGES.                                        16320000
065135*----------------------------------------------------------       16330000
065136 3100-BACK-OUT-MQV-CHANGES.                                       16340000
065137                                                                  16350000
065138     CALL MQV-MQBACK USING MQV-HCONN                              16360000
065139                           MQV-COMPLETION-CODE                    16370000
065140                           MQV-REASON.                            16380000
065141                                                                  16390000
065142     EVALUATE TRUE                                                16400000
065143        WHEN MQV-COMPLETION-CODE = MQCC-OK                        16410000
065144             CONTINUE                                             16420000
065145        WHEN OTHER                                                16430000
065146             CALL MQV-MQCHECK USING MQV-REASON                    16440000
065147                                    MQV-REASON-TEXT               16450000
065148             MOVE '3100-BACK-OUT-MQV-CHANGES' TO PV-PARAGRAPH-NAME16460000
065149             MOVE 'MQBACK ERROR'  TO PV-OPERATION-MSG-1           16470000
065150             MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    16480000
065151             MOVE MQV-REASON             TO PV-REASON             16490000
065152             MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        16500000
065153             PERFORM 9200-DISCONNECT-QMGR                         16510000
065154             PERFORM 9400-MQ-ABEND                                16520000
065155     END-EVALUATE.                                                16530000
065156                                                                  16540000
065157*3100-EXIT.                                                       16550000
065158 EJECT.                                                           16560000
065189*----------------------------------------------------------       16570000
065190* 9000-WRAPUP.                                                    16580000
065200*     END OF PROGRAM ROUTINE.  CLOSES ALL QUEUES, DISCONNECTS     16590000
065300*     FROM THE QUEUE MANAGER, CLOSES ALL FILES, AND               16600000
065400*     DISPLAYS ALL DATA.                                          16610000
      *                                                                 16620004
C52736*  -- ADDED A FINAL COMMIT                                        16630004
C52736*                                                                 16640004
065500*----------------------------------------------------------       16650000
065600 9000-WRAPUP.                                                     16660000
065700                                                                  16670000
C52736     IF PV-COMMIT-COUNT > ZERO                                    16680004
C52736        PERFORM 2200-COMMIT-DATA                                  16690004
C52736        PERFORM 2300-COMMIT-MESSAGE                               16700004
C52736     END-IF.                                                      16710004
                                                                        16720004
065800     PERFORM 9100-CLOSE-QUEUES.                                   16730000
065900     PERFORM 9200-DISCONNECT-QMGR.                                16740000
065900                                                                  16750000
066100     CLOSE CONTROL-CARD-1                                         16760000
066200           CONTROL-CARD-2                                         16770000
066300           CONTROL-CARD-3                                         16780000
066310           CONTROL-CARD-4                                         16790000
066400           MESSAGE-LOG.                                           16800000
066500                                                                  16810000
066510     DISPLAY ' '.                                                 16820000
066600     DISPLAY '**********************************************'.    16830000
066700     DISPLAY '   PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.         16840000
066800     DISPLAY '**********************************************'.    16850000
066900     DISPLAY 'MESSAGES FROM QUEUE ............: '                 16860000
066900                                           PC-MESSAGE-FROM-QUEUE. 16870000
067100     DISPLAY '010  AD EVENT ...................: ' PC-MESSAGE-010.16880000
067200     DISPLAY '020  PROMOTION ..................: ' PC-MESSAGE-020.16890000
067300     DISPLAY '030  PRICE VERSION ..............: ' PC-MESSAGE-030.16900000
067400     DISPLAY '040  ADHOC STORE GROUP ..........: ' PC-MESSAGE-040.16910000
067500     DISPLAY '050  ADHOC STORE LIST ...........: ' PC-MESSAGE-050.16920000
067600     DISPLAY '060  PROMOTIONAL ITEM ...........: ' PC-MESSAGE-060.16930000
067700     DISPLAY '070  PROMOTIONAL ITEM STORE GROUP: ' PC-MESSAGE-070.16940000
067800     DISPLAY '080  FORECAST ...................: ' PC-MESSAGE-080.16950000
067900     DISPLAY '090  PRICING ....................: ' PC-MESSAGE-090.16960000
068000     DISPLAY '100  BENEFIT WITH PURCHASE ......: ' PC-MESSAGE-100.16970000
068100     DISPLAY '110  PRICING EXCLUSIONS .........: ' PC-MESSAGE-110.16980000
068200     DISPLAY '120  PRICING STORE GROUP ........: ' PC-MESSAGE-120.16990000
067000     DISPLAY '      ALL LOADING PROGRAMS CALLED ..: '             17000000
067000                                                   PC-MESSAGE-ALL.17010000
068200     DISPLAY ' '.                                                 17020000
068300     DISPLAY '************* RESULTS FROM LOADS ****************'. 17030000
068400     DISPLAY 'MESSAGES BACKED UP ..............: '                17040000
068400                                     PC-MESSAGES-WRITTEN-TO-FILE. 17050000
101310     DISPLAY 'ACTUAL COMMITS TAKEN ............: '                17060000
101310                                        PC-ACTUAL-COMMITS.        17070000
068500     DISPLAY 'LOADS WITH 00 STAT CDE ..........: ' PC-STAT-00.    17080000
068600     DISPLAY 'LOADS WITH 01 STAT CDE ..........: ' PC-STAT-01.    17090000
068700     DISPLAY 'LOADS WITH 02 STAT CDE ..........: ' PC-STAT-02.    17100000
068800     DISPLAY 'LOADS WITH 03 STAT CDE ..........: ' PC-STAT-03.    17110000
068810     DISPLAY 'LOADS WITH 04 STAT CDE ..........: ' PC-STAT-04.    17120000
068900     DISPLAY 'MESSAGES ON ERROR QUEUE .........: '                17130000
068900                                         PC-MESSAGES-TO-ERR-QUEUE.17140000
069000     DISPLAY 'LOADS WITH 05 STAT CDE AND CRITICAL .: '            17150000
069100                                                  PC-STAT-05-01.  17160000
069200     DISPLAY 'LOADS WITH 05 STAT CDE AND UNCRITICAL: '            17170000
069300                                                  PC-STAT-05-02.  17180000
069400     DISPLAY 'LOADS WITH 06 STAT CDE AND CRITICAL .: '            17190000
069500                                                  PC-STAT-06-01.  17200000
069600     DISPLAY 'LOADS WITH 06 STAT CDE AND UNCRITICAL: '            17210000
069700                                                  PC-STAT-06-02.  17220000
069800     DISPLAY '*************************************************'. 17230000
069800     DISPLAY ' '.                                                 17240000
069900                                                                  17250000
070000*9000-EXIT.                                                       17260000
070100 EJECT.                                                           17270000
070200                                                                  17280000
070300*----------------------------------------------------------       17290000
070400* 9100-CLOSE-QUEUES.                                              17300000
070500*     CLOSE BUSINESS EVENT QUEUE AND ERROR QUEUE.                 17310000
070600*----------------------------------------------------------       17320000
070700 9100-CLOSE-QUEUES.                                               17330000
070800                                                                  17340000
070900     CALL MQV-MQCLOSE USING MQV-HCONN                             17350000
071000                            MQV-PROMO-HANDLE                      17360000
071100                            MQCO-NONE                             17370000
071200                            MQV-COMPLETION-CODE                   17380000
071300                            MQV-REASON.                           17390000
071400                                                                  17400000
071500     EVALUATE TRUE                                                17410000
071600        WHEN MQV-COMPLETION-CODE = MQCC-OK                        17420000
071700             CONTINUE                                             17430000
071800        WHEN MQV-COMPLETION-CODE NOT EQUAL MQCC-OK                17440000
071900             CALL MQV-MQCHECK USING MQV-REASON                    17450000
072000                                    MQV-REASON-TEXT               17460000
072010             MOVE '9100-CLOSE-QUEUES' TO PV-PARAGRAPH-NAME        17470000
072100             MOVE 'CANNOT CLOSE BUS EVENT QUEUE'                  17480000
072200                                    TO PV-OPERATION-MSG-1         17490000
072210             MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    17500000
072220             MOVE MQV-REASON             TO PV-REASON             17510000
072230             MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        17520000
072300             PERFORM 9400-MQ-ABEND                                17530000
072400     END-EVALUATE.                                                17540000
072500                                                                  17550000
072600     CALL MQV-MQCLOSE USING MQV-HCONN                             17560000
072700                            MQV-ERROR-HANDLE                      17570000
072800                            MQCO-NONE                             17580000
072900                            MQV-COMPLETION-CODE                   17590000
073000                            MQV-REASON.                           17600000
073100                                                                  17610000
073200     EVALUATE TRUE                                                17620000
073300        WHEN MQV-COMPLETION-CODE = MQCC-OK                        17630000
073400             CONTINUE                                             17640000
073500        WHEN MQV-COMPLETION-CODE NOT EQUAL MQCC-OK                17650000
073600             CALL MQV-MQCHECK USING MQV-REASON                    17660000
073700                                    MQV-REASON-TEXT               17670000
073710             MOVE '9100-CLOSE-QUEUES' TO PV-PARAGRAPH-NAME        17680000
073800             MOVE 'CANNOT CLOSE ERROR QUEUE' TO PV-OPERATION-MSG-117690000
073810             MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    17700000
073820             MOVE MQV-REASON             TO PV-REASON             17710000
073830             MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        17720000
073900             PERFORM 9400-MQ-ABEND                                17730000
074000     END-EVALUATE.                                                17740000
074100                                                                  17750000
074200*9100-EXIT.                                                       17760000
074300 EJECT.                                                           17770000
074400                                                                  17780000
074500*----------------------------------------------------------       17790000
074600* 9200-DISCONNECT-QMGR.                                           17800000
074700*     DISCONNECT FROM THE QUEUE MANAGER.                          17810000
074800*----------------------------------------------------------       17820000
074900 9200-DISCONNECT-QMGR.                                            17830000
075000                                                                  17840000
075100     CALL MQV-MQDISC USING MQV-HCONN                              17850000
075200                           MQV-COMPLETION-CODE                    17860000
075300                           MQV-REASON.                            17870000
075400                                                                  17880000
075500     EVALUATE TRUE                                                17890000
075600        WHEN MQV-COMPLETION-CODE = MQCC-OK                        17900000
075700             CONTINUE                                             17910000
075800        WHEN MQV-COMPLETION-CODE NOT EQUAL MQCC-OK                17920000
075900             CALL MQV-MQCHECK USING MQV-REASON                    17930000
076000                                    MQV-REASON-TEXT               17940000
076100             MOVE '9200-DISCONNECT-QMGR' TO PV-PARAGRAPH-NAME     17950000
076200             MOVE 'MQDISC ERROR'         TO PV-OPERATION-MSG-1    17960000
076210             MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    17970000
076220             MOVE MQV-REASON             TO PV-REASON             17980000
076230             MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        17990000
076300             PERFORM 9400-MQ-ABEND                                18000000
076400     END-EVALUATE.                                                18010000
076500                                                                  18020000
076600*9200-EXIT.                                                       18030000
076700 EJECT.                                                           18040000
076800                                                                  18050000
076900*---------------------------------------------------------        18060000
077000* 9300-ABEND.                                                     18070000
077100*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  18080000
077200*---------------------------------------------------------        18090000
077300 9300-ABEND.                                                      18100000
077400                                                                  18110000
077500     DISPLAY '** ABEND           **'.                             18120000
077600     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  18130000
077700     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        18140000
077800     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       18150000
077900     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       18160000
078000     CALL 'ILBOABN0' USING ABEND-CODE.                            18170000
078100                                                                  18180000
078200*9300-EXIT.                                                       18190000
078300 EJECT.                                                           18200000
078400                                                                  18210000
078500*----------------------------------------------------------       18220000
078600* 9400-MQ-ABEND.                                                  18230000
078700*     MQ ABEND ROUTINE.                                           18240000
078800*----------------------------------------------------------       18250000
078900 9400-MQ-ABEND.                                                   18260000
079000                                                                  18270000
079100     SET ABEND-4020-MQ-ERROR TO TRUE.                             18280000
079200     DISPLAY '**** ABEND *************************************'.  18290000
079300     DISPLAY '** MQSERIES ERROR **'.                              18300000
079400     DISPLAY '** PROGRAM:    ' PC-CURRENT-PROGRAM-NAME.           18310000
079500     DISPLAY '** ABEND CODE: ' ABEND-CODE.                        18320000
079600     DISPLAY '** PARAGRAPH:  ' PV-PARAGRAPH-NAME.                 18330000
079700     DISPLAY '** MESSAGE:    ' PV-OPERATION-MSG-1.                18340000
079800     DISPLAY '** COMP CODE:  ' PV-COMPLETION-CODE.                18350000
079900     DISPLAY '** RSN CODE:   ' PV-REASON.                         18360000
080000     DISPLAY '** RSN TEXT:   ' PV-REASON-TEXT.                    18370000
080100     DISPLAY '************************************************'.  18380000
080200     CALL 'ILBOABN0' USING ABEND-CODE.                            18390000
080300                                                                  18400000
080400*9400-EXIT.                                                       18410000
080500 EJECT.                                                           18420000
080600                                                                  18430000
080700*----------------------------------------------------------       18440000
080800* 9500-SQL-ABEND-ROUTINE.                                         18450000
080900*     SQL ABEND ROUTINE.                                          18460000
081000*----------------------------------------------------------       18470000
081100 9500-SQL-ABEND-ROUTINE.                                          18480000
081200                                                                  18490000
081210     SET ABEND-4013-DB2-ERROR TO TRUE.                            18500000
081220                                                                  18510000
081300     DISPLAY '** ABEND     **'.                                   18520000
081400     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        18530000
081500     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              18540000
081600     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               18550000
081700                                                                  18560000
081800     COPY DPPD004.                                                18570000
082000     CALL 'ILBOABN0' USING ABEND-CODE.                            18580000
082100                                                                  18590000
082200*9500-EXIT.                                                       18600000
082300 EJECT.                                                           18610000
082400                                                                  18620000
0410  *----------------------------------------------------------       18630000
0410  *  DYNAMIC ALLOCATION ROUTINE                                     18640000
0410  *----------------------------------------------------------       18650000
0410       COPY DPPD023.                                                18660000
