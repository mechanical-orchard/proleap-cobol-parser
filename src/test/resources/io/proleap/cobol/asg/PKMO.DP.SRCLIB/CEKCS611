000100 IDENTIFICATION DIVISION.                                         00010018
000200                                                                  00020018
000300 PROGRAM-ID.      CEKCS611.                                       00030018
000400 AUTHOR.          JOE LAROSA.                                     00040018
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050018
000600 DATE-WRITTEN.    12-23-1999.                                     00060018
000700                                                                  00070018
000800******************************************************************00080018
000900* PROGRAM CONTAINS A START TRANSID COMMAND SPECIFYING A TIME     *00090018
001000* INTERVAL (IN MINUTES) FROM DB2 TABLE TCOCNTL.  THIS COMMAND    *00100018
001100* WILL RE-START SUBSEQUENT TRANSACTIONS AFTER THE INITIAL START  *00110018
001200* TRANSID IS EXECUTED AT CICS STARTUP TIME.                      *00120018
001300*                                                                *00130018
001400* THE PROGRAM WILL CHECK DB2 TABLE TCEPLRQ FOR NEW PULL REQUESTS.*00140018
001500* IF A NEW PULL REQUEST IS FOUND, THE PROGRAM WILL LINK TO       *00150018
001600* PROGRAM CEKCS609 TO PRINT THE PULL REQUEST DEPENDENT ON THE    *00160018
001700* PRINT CODE FOR THE ASSOCIATED DC ON DB2 TABLE TCOCNTL.         *00170018
001800******************************************************************00180018
001900 ENVIRONMENT DIVISION.                                            00190018
002000                                                                  00200018
002100 DATA DIVISION.                                                   00210018
002200                                                                  00220018
002300******************************************************************00230018
002400*                       WORKING STORAGE                           00240018
002500******************************************************************00250018
002600 WORKING-STORAGE SECTION.                                         00260018
002700                                                                  00270018
002800 01  PS-PROGRAM-SWITCHES.                                         00280018
002900     05  PS-EOF-SW                   PIC  X(01) VALUE 'N'.        00290018
003000         88  PS-EOF-NO                          VALUE 'N'.        00300018
003100         88  PS-EOF-YES                         VALUE 'Y'.        00310018
003200     05  PS-PRINT-SW                 PIC  X(01) VALUE 'N'.        00320018
003300         88  PS-PRINT-NO                        VALUE 'N'.        00330018
003400         88  PS-PRINT-YES                       VALUE 'Y'.        00340018
003401     05  PS-EOF-SW2                  PIC  X(01) VALUE 'N'.        00350018
003402         88  PS-EOF-NO2                         VALUE 'N'.        00360018
003403         88  PS-EOF-YES2                        VALUE 'Y'.        00370018
003404     05  PS-PRINT-SW2                PIC  X(01) VALUE 'N'.        00380018
003405         88  PS-PRINT-NO2                       VALUE 'N'.        00390018
003406         88  PS-PRINT-YES2                      VALUE 'Y'.        00400018
003500                                                                  00410018
003600 01  PA-PROGRAM-ACCUMULATORS.                                     00420018
003700     05  PA-RETRY-COUNT              PIC S9(03) VALUE 0 COMP.     00430018
003800     05  PA-TOTAL-NUM-STORES         PIC S9(03) VALUE 0 COMP-3.   00440018
003900                                                                  00450018
004000 01  PC-PROGRAM-CONSTANTS.                                        00460018
004100     05  PC-CURRENT-PROGRAM-NAME     PIC  X(09) VALUE 'CEKCS611 '.00470018
004200     05  PC-S611-TRANSID             PIC  X(04) VALUE 'S611'.     00480018
004300     05  PC-ONE                      PIC S9(01) VALUE  +1.        00490018
004400     05  PC-03                       PIC  X(02) VALUE '03'.       00500018
004500     05  PC-NW                       PIC  X(02) VALUE 'NW'.       00510018
004600     05  PC-MAX-COUNT                PIC S9(03) VALUE  +3 COMP.   00520018
004700     05  PC-STAT-HOLD                PIC  X(01) VALUE 'Y'.        00530018
004800     05  PC-KOHLS-OPERATING-COMPANY  PIC  X(02) VALUE '03'.       00540018
004900     05  PC-PRINT-PGM                PIC  X(08) VALUE 'CEKCS609'. 00550018
005000     05  PC-PRINT-PGM-LENGTH         PIC S9(04) VALUE  +300       00560018
005100                                                COMP SYNC.        00570018
005200                                                                  00580018
005300 01  PV-PROGRAM-VARIABLES.                                        00590018
005400     05  PV-REQ-INTERVAL             PIC S9(07) VALUE 0 COMP-3.   00600018
005500     05  PV-CICS-RESPONSE            PIC S9(09) VALUE ZERO        00610018
005600                                                COMP SYNC.        00620018
005700     05  PV-COMMAREA-LENGTH          PIC S9(04) VALUE +0          00630018
005800                                                COMP SYNC.        00640018
005900     05  PV-OPER-UNT-ID              PIC  9(03) VALUE ZEROES.     00650018
006000     05  PV-LOCN-ID                  PIC  9(04) VALUE ZEROES.     00660018
006100     05  FILLER REDEFINES PV-LOCN-ID.                             00670018
006200         10  FILLER                  PIC  X(01).                  00680018
006300         10  PV-LOC-ID-3             PIC  X(03).                  00690018
006400                                                                  00700018
006500 01  DK-DATABASE-KEYS.                                            00710018
006600     05  DK-LOCN-ID                  PIC  9(04) VALUE ZEROES.     00720018
007000     05  DK-DB2DATE-CYMD             PIC  X(10).                  00760018
007100     05  DK-OPER-UNT-ID              PIC  S9(4) VALUE +0 COMP.    00770018
007200                                                                  00780018
007300******************************************************************00790018
007400*                      PROGRAM DATE & TIME                        00800018
007500******************************************************************00810018
007600 01  PT-SYSTEM-TIME.                                              00820018
007700     05  PT-SYS-TIME                 PIC S9(06) VALUE 0.          00830018
007800     05  FILLER                                                   00840018
007900         REDEFINES PT-SYS-TIME.                                   00850018
008000         10  PT-SYS-HHMM             PIC S9(04).                  00860018
008100         10  FILLER                  PIC X(02).                   00870018
008200                                                                  00880018
008300     05  PT-CURR-TIME                PIC S9(04) VALUE 0 COMP-3.   00890018
008400                                                                  00900018
008500     05  PT-DISPLAY-TIME             PIC  9(04).                  00910018
008600     05  FILLER REDEFINES PT-DISPLAY-TIME.                        00920018
008700         10  PT-DISPLAY-HH           PIC  9(02).                  00930018
008800         10  PT-DISPLAY-MM           PIC  9(02).                  00940018
008900                                                                  00950018
009000 01  PD-SYSTEM-DATE.                                              00960018
009100     05  PD-SYS-CC                   PIC  9(02) VALUE ZERO.       00970018
009200     05  PD-SYS-YY                   PIC  9(02) VALUE ZERO.       00980018
009300     05  PD-SYS-MM                   PIC  9(02) VALUE ZERO.       00990018
009400     05  PD-SYS-DD                   PIC  9(02) VALUE ZERO.       01000018
009500                                                                  01010018
009600 01  PD-DB2DATE-CYMD.                                             01020018
009700     05  PD-DB2DATE-CC               PIC  9(02) VALUE ZEROES.     01030018
009800     05  PD-DB2DATE-YY               PIC  9(02) VALUE ZEROES.     01040018
009900     05  FILLER                      PIC  X(01) VALUE '-'.        01050018
010000     05  PD-DB2DATE-MM               PIC  9(02) VALUE ZEROES.     01060018
010100     05  FILLER                      PIC  X(01) VALUE '-'.        01070018
010200     05  PD-DB2DATE-DD               PIC  9(02) VALUE ZEROES.     01080018
010300                                                                  01090018
010400******************************************************************01100018
010500*                       INFO MESSAGE                              01110018
010600******************************************************************01120018
010700 01  LE-PARA-MESSAGE.                                             01130018
010800     05  LE-INFO-NMBR                 PIC X(14) VALUE             01140018
010900                                      '**** S611 ****'.           01150018
011000     05  FILLER                       PIC X(03) VALUE ' / '.      01160018
011100     05  FILLER                       PIC X(28) VALUE             01170018
011200         'PROGRAM CEKCS611 PARA 2400 '.                           01180018
011201 01  LE-PARA-MESSAGE2.                                            01190018
011202     05  LE-INFO-NMBR2                PIC X(14) VALUE             01200018
011203                                      '**** S611 ****'.           01210018
011204     05  FILLER                       PIC X(03) VALUE ' / '.      01220018
011205     05  FILLER                       PIC X(28) VALUE             01230018
011206         'PROGRAM CEKCS611 PARA 2402 '.                           01240018
011207 01  LE-START-MESSAGE.                                            01250018
011208     05  LE-INFO-NMBR                 PIC X(14) VALUE             01260018
011209                                      '**** S611 ****'.           01270018
011210     05  FILLER                       PIC X(03) VALUE ' / '.      01280018
011211     05  FILLER                       PIC X(28) VALUE             01290018
011212         'PROGRAM CEKCS611 STARTED AT '.                          01300018
011300     05  LE-PRT-TIME.                                             01310018
011400         10  LE-PRT-HH                PIC 9(02).                  01320018
011500         10  FILLER                   PIC X(01) VALUE ':'.        01330018
011600         10  LE-PRT-MM                PIC 9(02).                  01340018
011700     05  FILLER                       PIC X(03) VALUE ' / '.      01350018
011800     05  FILLER                       PIC X(19) VALUE             01360018
011900         'TCOCNTL INTERVAL = '.                                   01370018
012000     05  LE-PRT-INTERVAL              PIC 9(04).                  01380018
012100     05  FILLER                       PIC X(04) VALUE SPACES.     01390018
012200                                                                  01400018
012300 01  LE-LINK-ERRORS.                                              01410018
012400     05  LE-INFO-NMBR                 PIC X(02) VALUE '01'.       01420018
012500     05  FILLER                       PIC X(01) VALUE SPACES.     01430018
012600     05  LE-INFO-MESSAGE.                                         01440018
012700         10  FILLER                   PIC X(14) VALUE             01450018
012800                                      'RETURN CODE = '.           01460018
012900         10  LE-PRT-RET-CDE           PIC X(02) VALUE SPACES.     01470018
013000         10  FILLER                   PIC X(14) VALUE             01480018
013100                                      ' RETURN MSG = '.           01490018
013200         10  LE-PRT-RET-MSG           PIC X(25) VALUE SPACES.     01500018
013300         10  FILLER                   PIC X(14) VALUE             01510018
013400                                      ' PRT REQ ID = '.           01520018
013500         10  LE-PRT-REQ-ID            PIC X(08) VALUE SPACES.     01530018
013600                                                                  01540018
013700******************************************************************01550018
013800*                      ERROR PROCESSING                           01560018
013900******************************************************************01570018
014000 01  PE-PROGRAM-ERRORS.                                           01580018
014100                                                                  01590018
014200     05  PE-DB2-ERROR-NUMBER         PIC  X(02) VALUE '02'.       01600018
014300     05  PE-DB2-ERROR-MESSAGE.                                    01610018
014400         10  FILLER                  PIC  X(11) VALUE             01620018
014500                                                'DB2 ERROR: '.    01630018
014600         10  FILLER                  PIC  X(08) VALUE             01640018
014700                                                'SQLWARN='.       01650018
014800         10  PE-DB2-WARN             PIC  X(08) VALUE SPACES.     01660018
014900         10  FILLER                  PIC  X(08) VALUE             01670018
015000                                                'SQLCODE='.       01680018
015100         10  PE-DB2-CODE             PIC Z(08)9- VALUE SPACES.    01690018
015200         10  FILLER                  PIC  X(06) VALUE             01700018
015300                                                ' PARA='.         01710018
015400         10  PE-DB2-PARAGRAPH        PIC X(18)  VALUE SPACES.     01720018
015500         10  FILLER                  PIC X(05)  VALUE             01730018
015600                                                ' ACT='.          01740018
015700         10  PE-DB2-ACTION           PIC X(20)  VALUE SPACES.     01750018
015800         10  PE-DB2-STR              PIC X(03)  VALUE SPACES.     01760018
015900                                                                  01770018
016000                                                                  01780018
016500                                                                  01830018
016600******************************************************************01840018
016700*  WORKING STORAGE AREA FOR ABEND PROCESSOR  (DPPD013)            01850018
016800******************************************************************01860018
016900     COPY DPWS013.                                                01870018
016910                                                                  01830018
016920******************************************************************01840018
016930*  WORKING STORAGE AREA TO GET CURRENT DATE  (DPPD017)            01850018
016940******************************************************************01860018
016950     COPY DPWS017.                                                01870018
017000                                                                  01880018
017010     COPY DPWS020.                                                01870018
017020                                                                  01880018
017100******************************************************************01890018
017200*    CALLED CALENDAR ROUTINE COPYBOOK                             01900018
017300******************************************************************01910018
017400     COPY DPWS500.                                                01920018
017500                                                                  01930018
017600******************************************************************01940018
017700*    CENTRAL STOCK PRINT MODULE COPYBOOK                          01950018
017800******************************************************************01960018
017900     COPY CEWS004.                                                01970018
017910                                                                  01930018
017920******************************************************************01940018
017930*    LOCATION DOMAIN ACCESS MODULE COPYBOOK                       01950018
017940******************************************************************01960018
017950     COPY XLWS071.                                                01970018
018000                                                                  01980018
018100******************************************************************01990018
018200*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                02000018
018300******************************************************************02010018
018400     EXEC SQL                                                     02020018
018500         INCLUDE SQLCA                                            02030018
018600     END-EXEC.                                                    02040018
018700                                                                  02050018
018800******************************************************************02060018
018900*  SQL AND COBOL DECL FOR THE COMPANY CONTROL TABLE.              02070018
019000******************************************************************02080018
019100     EXEC SQL                                                     02090018
019200         INCLUDE TCOCNTL                                          02100018
019300     END-EXEC.                                                    02110018
020100                                                                  02190018
020200******************************************************************02200018
020300*  SQL AND COBOL DECLARATIONS FOR CS PULL REQUESTS TABLE.         02210018
020400******************************************************************02220018
020500     EXEC SQL                                                     02230018
020600         INCLUDE TCEPLRQ                                          02240018
020700     END-EXEC.                                                    02250018
020800                                                                  02260018
020810******************************************************************02270018
020820*  SQL AND COBOL DECLARATIONS FOR CS PULL REQUESTS ITEM TABLE     02280018
020830******************************************************************02290018
020840     EXEC SQL                                                     02300018
020850         INCLUDE TCEPLIT                                          02310018
020860     END-EXEC.                                                    02320018
020870                                                                  02330018
020900******************************************************************02340018
021000*  DECLARE CURSOR CENTRAL STOCK PULL REQUESTS TABLE.              02350018
021100******************************************************************02360018
022400                                                                  02370018
022401     EXEC SQL                                                     02380018
022402         DECLARE TCEPLRQ-CSR CURSOR FOR                           02390018
022410          SELECT DISTINCT                                         02400018
022420                 A.CNSTK_REQ_PL_NBR                               02410018
022430               , A.CNSTK_LOC_ID                                   02420018
022440               , A.SRC_REF_NBR                                    02430018
022450               , A.SRC_TYP_CDE                                    02440018
022460               , A.STAT_CDE                                       02450018
022470            FROM TCEPLRQ A                                        02460018
022480                ,TCEPLIT B                                        02470018
022490           WHERE   A.STAT_CDE        IN ('NW','IP')               02480018
022491             AND   A.CNSTK_REQ_PL_NBR  =  B.CNSTK_REQ_PL_NBR      02490018
022492             AND   B.STAT_CDE          = 'NW'                     02500018
022493        ORDER BY A.CNSTK_LOC_ID                                   02510018
022494               , A.CNSTK_REQ_PL_NBR                               02520018
022495     END-EXEC.                                                    02530018
022496                                                                  02540018
022497     EXEC SQL                                                     02550018
022498         DECLARE TCEPLRQ-CSR2 CURSOR FOR                          02560018
022499          SELECT DISTINCT                                         02570018
022500                 A.CNSTK_REQ_PL_NBR                               02580018
022501               , A.CNSTK_LOC_ID                                   02590018
022502               , A.SRC_REF_NBR                                    02600018
022503               , A.SRC_TYP_CDE                                    02610018
022504               , A.STAT_CDE                                       02620018
022505               , B.PL_LNE_NBR                                     02630018
022506            FROM TCEPLRQ A                                        02640018
022507                ,TCEPLIT B                                        02650018
022508           WHERE   A.STAT_CDE          = 'IP'                     02660018
022509             AND   B.STAT_CDE          = 'NW'                     02670018
022510             AND   A.CNSTK_REQ_PL_NBR  =  B.CNSTK_REQ_PL_NBR      02680018
022511             AND   A.SRC_TYP_CDE       = 'UC'                     02690018
022512        ORDER BY A.CNSTK_LOC_ID                                   02700018
022513               , A.CNSTK_REQ_PL_NBR                               02710018
022514               , B.PL_LNE_NBR                                     02720018
022515     END-EXEC.                                                    02730018
022516                                                                  02740018
022517******************************************************************02750018
022600 PROCEDURE DIVISION.                                              02760018
022700******************************************************************02770018
022800 0000-MAINLINE.                                                   02780018
022900                                                                  02790018
023000*** PLACE AN ENQ/DEQ TO PREVENT CONTENTION                        02800018
023100     EXEC CICS                                                    02810018
023200          ENQ RESOURCE(PC-STAT-HOLD) LENGTH(1)                    02820018
023300     END-EXEC                                                     02830018
023400                                                                  02840018
023500*** GET DATE/TIME & CREATE DELAYED "START TRANSID".               02850018
023600     PERFORM 1000-INITIALIZE.                                     02860018
023700                                                                  02870018
023800*** WRITE MESSAGE TO CICS LOG W/TRAN START-UP INFO.               02880018
023900     MOVE PT-DISPLAY-HH              TO LE-PRT-HH.                02890018
024000     MOVE PT-DISPLAY-MM              TO LE-PRT-MM.                02900018
024100     MOVE COCNTL-CK-NW-PL-MNIT-QTY   TO LE-PRT-INTERVAL.          02910018
024200     MOVE LENGTH OF LE-START-MESSAGE TO PV-COMMAREA-LENGTH        02920018
024300     EXEC CICS                                                    02930018
024400         WRITEQ TD                                                02940018
024500          QUEUE  ('CSSL')                                         02950018
024600           FROM  (LE-START-MESSAGE)                               02960018
024700         LENGTH  (PV-COMMAREA-LENGTH)                             02970018
024800           RESP  (PV-CICS-RESPONSE)                               02980018
024900     END-EXEC.                                                    02990018
025000                                                                  03000018
025100*** PROCESS DATABASE.                                             03010018
025200     PERFORM 2000-PROCESS-CEPLRQ                                  03020018
025300       UNTIL PS-EOF-YES.                                          03030018
025400                                                                  03040018
025500     PERFORM 1300-CLOSE-CEPLRQ-CSR.                               03050018
026100                                                                  03060018
026200     EXEC CICS                                                    03070018
026300         SYNCPOINT                                                03080018
026400     END-EXEC.                                                    03090018
029400                                                                  03100018
029500*READ SECOND CURSOR TABLE ENTRY.                                  03110018
029600     SET PS-EOF-NO2  TO TRUE.                                     03120018
029700     SET PS-PRINT-NO2 TO TRUE.                                    03130018
029800     MOVE ZEROES     TO PV-LOCN-ID.                               03140018
029900     PERFORM 1202-OPEN-CEPLRQ-CSR2.                               03150018
030000     PERFORM 2102-FETCH-CEPLRQ-CSR2.                              03160018
030001                                                                  03170018
030002*** PROCESS DATABASE.                                             03180018
030003     PERFORM 2002-PROCESS-CEPLRQ2                                 03190018
030004       UNTIL PS-EOF-YES2.                                         03200018
030005                                                                  03210018
030006     PERFORM 1302-CLOSE-CEPLRQ-CSR2.                              03220018
030007                                                                  03230018
030008     EXEC CICS                                                    03240018
030009         SYNCPOINT                                                03250018
030010     END-EXEC.                                                    03260018
030011                                                                  03270018
030012*** PLACE AN ENQ/DEQ TO PREVENT CONTENTION                        03280018
030013     EXEC CICS                                                    03290018
030014          DEQ RESOURCE(PC-STAT-HOLD) LENGTH(1)                    03300018
030015     END-EXEC.                                                    03310018
030016                                                                  03320018
030017     EXEC CICS                                                    03330018
030018         RETURN                                                   03340018
030019     END-EXEC.                                                    03350018
030020                                                                  03360018
030021     STOP RUN.                                                    03370018
030022                                                                  03380018
030023                                                                  03390018
030024******************************************************************03400018
030025* INITIALIZATION ROUTINE                                          03410018
030026******************************************************************03420018
030027 1000-INITIALIZE.                                                 03430018
030028                                                                  03440018
030029     MOVE EIBTIME     TO PT-SYS-TIME.                             03450018
030030     MOVE PT-SYS-HHMM TO PT-CURR-TIME                             03460018
030031                         PT-DISPLAY-TIME.                         03470018
030032                                                                  03480018
030033     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       03490018
030034                                                                  03500018
030035     MOVE DP017-CURRENT-DATE-YYYYMMDD TO PD-SYSTEM-DATE.          03510018
030036                                                                  03520018
030037     MOVE PD-SYS-CC       TO PD-DB2DATE-CC.                       03530018
030038     MOVE PD-SYS-YY       TO PD-DB2DATE-YY.                       03540018
030039     MOVE PD-SYS-MM       TO PD-DB2DATE-MM.                       03550018
030040     MOVE PD-SYS-DD       TO PD-DB2DATE-DD.                       03560018
030041     MOVE PD-DB2DATE-CYMD TO DK-DB2DATE-CYMD                      03570018
030042                                                                  03580018
030043*SET UP NEXT REQUEST INTERVAL.                                    03590018
030044     PERFORM 1100-START-DELAYED-TRAN.                             03600018
030045                                                                  03610018
030046*READ FIRST CURSOR TABLE ENTRY.                                   03620018
030047     SET PS-EOF-NO   TO TRUE.                                     03630018
030048     SET PS-PRINT-NO TO TRUE.                                     03640018
030049     MOVE ZEROES     TO PV-LOCN-ID.                               03650018
030050     PERFORM 1200-OPEN-CEPLRQ-CSR.                                03660018
030060     PERFORM 2100-FETCH-CEPLRQ-CSR.                               03670018
030100                                                                  03680018
030200******************************************************************03690018
030300*               START NEXT S611 'XX' MINUTES LATER                03700018
030400*=================================================================03710018
030500* DETERMINES WHEN THE NEXT TIME THIS PROCESS IS RUN. 'XX' MINUTES 03720018
030600* IS GOTTEN FROM THE REQUEST-INTERVAL FIELD OF STORE '000' ON THE 03730018
030700* COMPANY CONTROL (TCOCNTL) TABLE.                                03740018
030800******************************************************************03750018
030900 1100-START-DELAYED-TRAN.                                         03760018
031000                                                                  03770018
031100     EXEC SQL                                                     03780018
031200         SELECT  CK_NW_PL_MNIT_QTY                                03790018
031300           INTO  :COCNTL-CK-NW-PL-MNIT-QTY                        03800018
031400           FROM  TCOCNTL                                          03810018
031500          WHERE  OPER_UNT_ID = 90                                 03820018
031600     END-EXEC.                                                    03830018
031700                                                                  03840018
031800     EVALUATE TRUE                                                03850018
031900       WHEN SQLCODE = ZERO                                        03860018
032000           CONTINUE                                               03870018
032100                                                                  03880018
032200       WHEN OTHER                                                 03890018
032300           MOVE '1100-START-DELAYED-TRAN' TO DP013-PARAGRAPH      03900018
032400           MOVE 'SELECT TCOCNTL TIME'     TO PE-DB2-ACTION        03910018
032410           MOVE SQLCA     TO DP013-SQLCA                                  
032420           MOVE 'TSOCNTL' TO DP013-DB2-TABLE-NAME (1)                     
032430           SET DP013-DB2-ABEND                                            
032440               DP013-XCTL-DISPLAY-RESTART TO TRUE                         
032500           PERFORM DP013-0000-PROCESS-ABEND                       03920018
032510                                                                  03940018
032600     END-EVALUATE.                                                03930018
032700                                                                  03940018
032800     IF COCNTL-CK-NW-PL-MNIT-QTY = ZEROES                         03950018
032900         MOVE +10000 TO PV-REQ-INTERVAL                           03960018
033000     END-IF.                                                      03970018
033100     IF COCNTL-CK-NW-PL-MNIT-QTY > ZEROES                         03980018
033200       AND COCNTL-CK-NW-PL-MNIT-QTY < 60                          03990018
033300         COMPUTE PV-REQ-INTERVAL = COCNTL-CK-NW-PL-MNIT-QTY       04000018
033400                                 * 100                            04010018
033500     END-IF.                                                      04020018
033600     IF COCNTL-CK-NW-PL-MNIT-QTY = 60                             04030018
033700         MOVE +10000 TO PV-REQ-INTERVAL                           04040018
033800     END-IF.                                                      04050018
033900     IF COCNTL-CK-NW-PL-MNIT-QTY > 60                             04060018
034000         COMPUTE PV-REQ-INTERVAL =                                04070018
034100                    ((COCNTL-CK-NW-PL-MNIT-QTY - 60) * 100)       04080018
034200                    + (+10000)                                    04090018
034300     END-IF.                                                      04100018
034400                                                                  04110018
034500     EXEC CICS                                                    04120018
034600         START TRANSID(PC-S611-TRANSID)                           04130018
034700               INTERVAL(PV-REQ-INTERVAL)                          04140018
034800     END-EXEC.                                                    04150018
034900                                                                  04160018
035000***************************************************************** 04170018
035100* OPEN CURSOR FOR CEPLRQ TABLE.                                   04180018
035200***************************************************************** 04190018
035300 1200-OPEN-CEPLRQ-CSR.                                            04200018
035400                                                                  04210018
035500     EXEC SQL                                                     04220018
035600         OPEN TCEPLRQ-CSR                                         04230018
035700     END-EXEC.                                                    04240018
035800                                                                  04250018
035900     EVALUATE TRUE                                                04260018
036000       WHEN SQLCODE = +0                                          04270018
036100           CONTINUE                                               04280018
036200                                                                  04290018
036300       WHEN SQLWARN0 NOT = SPACE                                  04300018
036400       WHEN SQLCODE  NOT = +0                                     04310018
036500           MOVE '1200-OPEN-CEPLRQ-CSR' TO DP013-PARAGRAPH         04320018
036600           MOVE 'OPEN CEPLRQ CURSOR'   TO DP013-MESSAGE-TEXT(1)   04330018
036610           MOVE SQLCA     TO DP013-SQLCA                                  
036620           MOVE 'TCEPLRQ' TO DP013-DB2-TABLE-NAME (1)                     
036630           SET DP013-DB2-ABEND                                            
036640               DP013-XCTL-DISPLAY-RESTART TO TRUE                         
036650           PERFORM DP013-0000-PROCESS-ABEND                       03920018
036800     END-EVALUATE.                                                04350018
036900                                                                  04360018
036901***************************************************************** 04370018
036902* OPEN CURSOR2 FOR CEPLRQ TABLE.                                  04380018
036903***************************************************************** 04390018
036904 1202-OPEN-CEPLRQ-CSR2.                                           04400018
036905*** WRITE MESSAGE TO CICS LOG W/TRAN START-UP INFO.               04410018
036906*    MOVE LENGTH OF LE-PARA-MESSAGE TO PV-COMMAREA-LENGTH         04420018
036907*    EXEC CICS                                                    04430018
036908*        WRITEQ TD                                                04440018
036909*         QUEUE  ('CSSL')                                         04450018
036910*          FROM  (LE-PARA-MESSAGE)                                04460018
036911*        LENGTH  (PV-COMMAREA-LENGTH)                             04470018
036912*          RESP  (PV-CICS-RESPONSE)                               04480018
036913*    END-EXEC.                                                    04490018
036914                                                                  04500018
036915     EXEC SQL                                                     04510018
036916         OPEN TCEPLRQ-CSR2                                        04520018
036917     END-EXEC.                                                    04530018
036918                                                                  04540018
036919     EVALUATE TRUE                                                04550018
036920       WHEN SQLCODE = +0                                          04560018
036921           CONTINUE                                               04570018
036922                                                                  04580018
036923       WHEN SQLWARN0 NOT = SPACE                                  04590018
036924       WHEN SQLCODE  NOT = +0                                     04600018
036925           MOVE '1202-OPEN-CEPLRQ-CSR2' TO DP013-PARAGRAPH        04610018
036926           MOVE 'OPEN CEPLRQ CURSOR2'   TO DP013-MESSAGE-TEXT(1)  04620018
036927           MOVE SQLCA     TO DP013-SQLCA                                  
036928           MOVE 'TCEPLRQ' TO DP013-DB2-TABLE-NAME (1)                     
036929           SET DP013-DB2-ABEND                                            
036930               DP013-XCTL-DISPLAY-RESTART TO TRUE                         
036931           PERFORM DP013-0000-PROCESS-ABEND                       03920018
036933     END-EVALUATE.                                                04640018
036940                                                                  04650018
037000***************************************************************** 04660018
037100* CLOSE CURSOR FOR CEPLRQ TABLE.                                  04670018
037200***************************************************************** 04680018
037300 1300-CLOSE-CEPLRQ-CSR.                                           04690018
037400                                                                  04700018
037500     EXEC SQL                                                     04710018
037600         CLOSE TCEPLRQ-CSR                                        04720018
037700     END-EXEC.                                                    04730018
037800                                                                  04740018
037900     EVALUATE TRUE                                                04750018
038000       WHEN SQLCODE = +0                                          04760018
038100           CONTINUE                                               04770018
038200                                                                  04780018
038300       WHEN SQLWARN0 NOT = SPACE                                  04790018
038400       WHEN SQLCODE  NOT = +0                                     04800018
038500           MOVE '1300-CLOSE-CEPLRQ-CSR' TO DP013-PARAGRAPH        04810018
038600           MOVE 'CLOSE CEPLRQ CURSOR'   TO DP013-MESSAGE-TEXT(1)  04820018
038610           MOVE SQLCA     TO DP013-SQLCA                                  
038620           MOVE 'TCEPLRQ' TO DP013-DB2-TABLE-NAME (1)                     
038630           SET DP013-DB2-ABEND                                            
038640               DP013-XCTL-DISPLAY-RESTART TO TRUE                         
038650           PERFORM DP013-0000-PROCESS-ABEND                       03920018
038800     END-EVALUATE.                                                04840018
038801                                                                  04850018
038802***************************************************************** 04860018
038803* CLOSE CURSOR2 FOR CEPLRQ TABLE.                                 04870018
038804***************************************************************** 04880018
038805 1302-CLOSE-CEPLRQ-CSR2.                                          04890018
038806                                                                  04900018
038807     EXEC SQL                                                     04910018
038808         CLOSE TCEPLRQ-CSR2                                       04920018
038809     END-EXEC.                                                    04930018
038810                                                                  04940018
038811     EVALUATE TRUE                                                04950018
038812       WHEN SQLCODE = +0                                          04960018
038813           CONTINUE                                               04970018
038814                                                                  04980018
038815       WHEN SQLWARN0 NOT = SPACE                                  04990018
038816       WHEN SQLCODE  NOT = +0                                     05000018
038817           MOVE '1302-CLOSE-CEPLRQ-CSR2' TO DP013-PARAGRAPH       05010018
038818           MOVE 'CLOSE CEPLRQ CURSOR2'   TO DP013-MESSAGE-TEXT(1) 05020018
038819           MOVE SQLCA     TO DP013-SQLCA                                  
038820           MOVE 'TCEPLRQ' TO DP013-DB2-TABLE-NAME (1)                     
038821           SET DP013-DB2-ABEND                                            
038822               DP013-XCTL-DISPLAY-RESTART TO TRUE                         
038823           PERFORM DP013-0000-PROCESS-ABEND                       03920018
038830     END-EVALUATE.                                                05040018
038900                                                                  05050018
039000******************************************************************05060018
039100* RETRIEVE THE NEW CENTRAL STOCK PULL REQUESTS.                   05070018
039200******************************************************************05080018
039300 2000-PROCESS-CEPLRQ.                                             05090018
039400                                                                  05100018
039500     IF CEPLRQ-CNSTK-LOC-ID NOT = PV-LOCN-ID                      05110018
039600         MOVE CEPLRQ-CNSTK-LOC-ID TO DK-LOCN-ID                   05120018
039700         PERFORM 2200-CHECK-LOC-CHANGE                            05130018
039800         MOVE CEPLRQ-CNSTK-LOC-ID TO PV-LOCN-ID                   05140018
039900     END-IF.                                                      05150018
040000                                                                  05160018
040100*REQUEST PRINT.                                                   05170018
040200     IF PS-PRINT-YES                                              05180018
040300         PERFORM 2300-FILL-PRINT-COMMAREA                         05190018
040400         PERFORM 2400-LINK-PRINT-PROGRAM                          05200018
040500     END-IF.                                                      05210018
040600                                                                  05220018
040700*READ NEXT CURSOR RECORD.                                         05230018
040800     PERFORM 2100-FETCH-CEPLRQ-CSR.                               05240018
040900                                                                  05250018
040901******************************************************************05260018
040902* RETRIEVE THE IN PROCESS CENTRAL STOCK PULL REQUESTS.            05270018
040903******************************************************************05280018
040904 2002-PROCESS-CEPLRQ2.                                            05290018
040905                                                                  05300018
040906     IF CEPLRQ-CNSTK-LOC-ID NOT = PV-LOCN-ID                      05310018
040907         MOVE CEPLRQ-CNSTK-LOC-ID TO DK-LOCN-ID                   05320018
040908         PERFORM 2200-CHECK-LOC-CHANGE                            05330018
040909         MOVE CEPLRQ-CNSTK-LOC-ID TO PV-LOCN-ID                   05340018
040910     END-IF.                                                      05350018
040911                                                                  05360018
040912*REQUEST PRINT.                                                   05370018
040913     IF PS-PRINT-YES2                                             05380018
040914         PERFORM 2300-FILL-PRINT-COMMAREA                         05390018
040915         PERFORM 2402-LINK-PRINT-PROGRAM-CSR2                     05400018
040916     END-IF.                                                      05410018
040917                                                                  05420018
040918*READ NEXT CURSOR RECORD.                                         05430018
040919     PERFORM 2102-FETCH-CEPLRQ-CSR2.                              05440018
040920                                                                  05450018
041000******************************************************************05460018
041100* ACCESS CURSOR ROW                                               05470018
041200******************************************************************05480018
041300 2100-FETCH-CEPLRQ-CSR.                                           05490018
041400                                                                  05500018
041500     EXEC SQL                                                     05510018
041600         FETCH TCEPLRQ-CSR                                        05520018
041700          INTO :CEPLRQ-CNSTK-REQ-PL-NBR                           05530018
041800             , :CEPLRQ-CNSTK-LOC-ID                               05540018
041900             , :CEPLRQ-SRC-REF-NBR                                05550018
042000             , :CEPLRQ-SRC-TYP-CDE                                05560018
042100             , :CEPLRQ-STAT-CDE                                   05570018
042200     END-EXEC.                                                    05580018
042300                                                                  05590018
042400     EVALUATE TRUE                                                05600018
042500       WHEN SQLCODE = ZEROS                                       05610018
042600           CONTINUE                                               05620018
042700                                                                  05630018
042800       WHEN SQLCODE = +100                                        05640018
042900           SET PS-EOF-YES TO TRUE                                 05650018
043000                                                                  05660018
043100       WHEN OTHER                                                 05670018
043200           MOVE '2100-FETCH-CEPLRQ-CSR' TO DP013-PARAGRAPH        05680018
043300           MOVE 'FETCH CEPLRQ CURSOR'   TO DP013-MESSAGE-TEXT(1)  05690018
043310           MOVE SQLCA     TO DP013-SQLCA                                  
043320           MOVE 'TCEPLRQ' TO DP013-DB2-TABLE-NAME (1)                     
043330           SET DP013-DB2-ABEND                                            
043340               DP013-XCTL-DISPLAY-RESTART TO TRUE                         
043350           PERFORM DP013-0000-PROCESS-ABEND                       03920018
043500     END-EVALUATE.                                                05710018
043600                                                                  05720018
043601******************************************************************05730018
043602* ACCESS CURSOR2 ROW                                              05740018
043603******************************************************************05750018
043604 2102-FETCH-CEPLRQ-CSR2.                                          05760018
043605*** WRITE MESSAGE TO CICS LOG W/TRAN START-UP INFO.               05770018
043606*    MOVE LENGTH OF LE-PARA-MESSAGE TO PV-COMMAREA-LENGTH         05780018
043607*    EXEC CICS                                                    05790018
043608*        WRITEQ TD                                                05800018
043609*         QUEUE  ('CSSL')                                         05810018
043610*          FROM  (LE-PARA-MESSAGE)                                05820018
043611*        LENGTH  (PV-COMMAREA-LENGTH)                             05830018
043612*          RESP  (PV-CICS-RESPONSE)                               05840018
043613*    END-EXEC.                                                    05850018
043614                                                                  05860018
043615     EXEC SQL                                                     05870018
043616         FETCH TCEPLRQ-CSR2                                       05880018
043617          INTO :CEPLRQ-CNSTK-REQ-PL-NBR                           05890018
043618             , :CEPLRQ-CNSTK-LOC-ID                               05900018
043619             , :CEPLRQ-SRC-REF-NBR                                05910018
043620             , :CEPLRQ-SRC-TYP-CDE                                05920018
043621             , :CEPLRQ-STAT-CDE                                   05930018
043622             , :CEPLIT-PL-LNE-NBR                                 05940018
043623     END-EXEC.                                                    05950018
043624                                                                  05960018
043625     EVALUATE TRUE                                                05970018
043626       WHEN SQLCODE = ZEROS                                       05980018
043627           CONTINUE                                               05990018
043628                                                                  06000018
043629       WHEN SQLCODE = +100                                        06010018
043630           SET PS-EOF-YES2 TO TRUE                                06020018
043631                                                                  06030018
043632       WHEN OTHER                                                 06040018
043633           MOVE '2102-FETCH-CEPLRQ-CSR2' TO DP013-PARAGRAPH       06050018
043634           MOVE 'FETCH CEPLRQ CURSOR2'   TO DP013-MESSAGE-TEXT(1) 06060018
043635           MOVE SQLCA     TO DP013-SQLCA                                  
043636           MOVE 'TCEPLRQ' TO DP013-DB2-TABLE-NAME (1)                     
043637           SET DP013-DB2-ABEND                                            
043638               DP013-XCTL-DISPLAY-RESTART TO TRUE                         
043639           PERFORM DP013-0000-PROCESS-ABEND                       03920018
043641     END-EVALUATE.                                                06080018
043642                                                                          
043643****************************************************************          
043644*    THIS PARAGRAPH RETRIEVES THE STORE INFORMATION.           *          
043645*                                                              *          
043650****************************************************************          
043660 2200-CHECK-LOC-CHANGE.                                                   
043670                                                                  06140018
043680     SET PS-PRINT-NO TO TRUE.                                     06150018
043690     SET PS-PRINT-NO2 TO TRUE.                                    06160018
043700                                                                          
043800     INITIALIZE XL071-COMMAREA.                                           
043900     MOVE DK-LOCN-ID TO XL071-LOCATION-NUMBER.                            
044000                                                                          
044100     CALL XL071-LOCATION-MODULE USING                                     
044200                                DFHEIBLK                                  
044300                                XL071-COMMAREA                            
044400                                XL071-COMMAREA-REC.                       
044500                                                                          
044600     EVALUATE TRUE                                                        
044700         WHEN XL071-NO-ERRORS                                             
044800              IF XL071-CLO-DTE > DK-DB2DATE-CYMD                        18
044900                 PERFORM 2210-CHECK-PRT-CODE                              
045000              END-IF                                                    18
045100                                                                          
045200         WHEN XL071-LOC-NOT-FOUND                                         
045210         WHEN XL071-DC-ASGMT-NOT-FND                                      
045300              CONTINUE                                                    
045400                                                                          
045500         WHEN OTHER                                                       
045600              MOVE '2200-CHECK-LOC-CHANGE' TO DP013-PARAGRAPH           80
045701              STRING 'BAD RETURN CODE IN XLKUT071 - '                     
045702                      XL071-RETURN-CODE                                   
045703                     ' - SQLCODE IS - '                                   
045704                      XL071-SQLCODE                                       
045705                     ' - TABLE - '                                        
045706                      XL071-DB2-TABLE                                     
045707                      DELIMITED BY SIZE                                   
045708                      INTO DP013-MESSAGE-TEXT (1)                         
045709              STRING 'LOCATION IS - '                                     
045710                      XL071-LOCATION-NUMBER                               
045711                      DELIMITED BY SIZE                                   
045712                      INTO DP013-MESSAGE-TEXT (2)                         
045713              MOVE XL071-SQLCA TO DP013-SQLCA                             
045714              MOVE XL071-SQLCODE TO SQLCODE                               
045720              MOVE XL071-DB2-TABLE TO DP013-DB2-TABLE-NAME (1)            
045730              SET DP013-DB2-ABEND                                         
045740                  DP013-XCTL-DISPLAY-RESTART TO TRUE                      
045750              PERFORM DP013-0000-PROCESS-ABEND                          20
045900                                                                          
046000     END-EVALUATE.                                                        
047800                                                                  06520018
047900                                                                  06530018
048000******************************************************************06540018
048100* CHECK IF PRINT REQUEST IS "A"UTOMATIC.                          06550018
048200******************************************************************06560018
048300 2210-CHECK-PRT-CODE.                                             06570018
048400                                                                  06580018
048500*DETERMINE DC.                                                    06590018
048600     MOVE ZEROES TO PV-OPER-UNT-ID                                06600018
048700                    DK-OPER-UNT-ID.                               06610018
048800                                                                  06620018
048810     IF  DK-LOCN-ID  = 847                                              18
048820         MOVE 845              TO PV-OPER-UNT-ID                  06640018
048830     ELSE                                                         06650018
048831        MOVE XL071-ASGMT-DC-NBR TO PV-OPER-UNT-ID                         
049910     END-IF.                                                      06770018
050000                                                                  06780018
050100     MOVE PV-OPER-UNT-ID TO DK-OPER-UNT-ID.                       06790018
050200                                                                  06800018
050300*CALL COMPANY CONTROL TABLE FOR SELECTED DC.                      06810018
050400     EXEC SQL                                                     06820018
050500         SELECT  OPER_UNT_ID                                      06830018
050600              ,  FCLTY_ID                                         06840018
050700              ,  DFLT_CNSTK_PRTR_ID                               06850018
050800              ,  CNSTK_PL_PRT_CD                                  06860018
050900           INTO  :COCNTL-OPER-UNT-ID                              06870018
051000              ,  :COCNTL-FCLTY-ID                                 06880018
051100              ,  :COCNTL-DFLT-CNSTK-PRTR-ID                       06890018
051200              ,  :COCNTL-CNSTK-PL-PRT-CD                          06900018
051300           FROM  TCOCNTL                                          06910018
051400          WHERE  OPER_UNT_ID = :DK-OPER-UNT-ID                    06920018
051500     END-EXEC.                                                    06930018
051600                                                                  06940018
051700     EVALUATE TRUE                                                06950018
051800       WHEN SQLCODE = ZERO                                        06960018
051900           IF COCNTL-CNSTK-PL-PRT-CD = 'A'                        06970018
052000               SET PS-PRINT-YES TO TRUE                           06980018
052010               SET PS-PRINT-YES2 TO TRUE                          06990018
052100           END-IF                                                 07000018
052200                                                                  07010018
052300       WHEN OTHER                                                 07020018
052400           MOVE '2210-CHECK-PRT-CODE' TO DP013-PARAGRAPH          07030018
052500           MOVE 'SELECT COCNTL PRINT' TO DP013-MESSAGE-TEXT(1)    07040018
052510           MOVE SQLCA     TO DP013-SQLCA                                  
052520           MOVE 'TSOCNTL' TO DP013-DB2-TABLE-NAME (1)                     
052530           SET DP013-DB2-ABEND                                            
052540               DP013-XCTL-DISPLAY-RESTART TO TRUE                         
052550           PERFORM DP013-0000-PROCESS-ABEND                       03920018
052700     END-EVALUATE.                                                07060018
052800                                                                  07070018
052900******************************************************************07080018
053000* FILL COPYBOOK COMMAREA FOR PRINT.                               07090018
053100******************************************************************07100018
053200 2300-FILL-PRINT-COMMAREA.                                        07110018
053300                                                                  07120018
053400     INITIALIZE CE004-COMMAREA-REC.                               07130018
053500                                                                  07140018
053600     SET CE004-CICS-START           TO TRUE.                      07150018
053700     SET CE004-FROM-STARTED-TASK    TO TRUE.                      07160018
053800                                                                  07170018
053900     MOVE COCNTL-OPER-UNT-ID        TO CE004-CURR-OPER-UNT-ID-N.  07180018
054000     MOVE COCNTL-FCLTY-ID           TO CE004-CURR-FCLTY-ID-N.     07190018
054100     MOVE COCNTL-DFLT-CNSTK-PRTR-ID TO CE004-CS-PRINTER-ID.       07200018
054200                                                                  07210018
054300     MOVE CEPLRQ-CNSTK-REQ-PL-NBR   TO CE004-PULL-NBR.            07220018
054400     MOVE CEPLRQ-CNSTK-LOC-ID       TO CE004-CS-LOCATION.         07230018
054500     MOVE CEPLRQ-SRC-REF-NBR        TO CE004-REF-NBR.             07240018
054600     MOVE CEPLRQ-SRC-TYP-CDE        TO CE004-PULL-SOURCE.         07250018
054700     MOVE CEPLRQ-STAT-CDE           TO CE004-PULL-STATUS.         07260018
054800     IF CEPLRQ-STAT-CDE = 'NW'                                    07270018
054900         NEXT SENTENCE                                            07280018
055000     ELSE                                                         07290018
055001     IF CEPLRQ-SRC-TYP-CDE = 'UC'                                 07300018
055002         MOVE CEPLIT-PL-LNE-NBR     TO CE004-LINE-NBR             07310018
055003     END-IF.                                                      07320018
055004                                                                  07330018
055005******************************************************************07340018
055006* LINK TO PRINT PROGRAM (CEKCS609).                               07350018
055100******************************************************************07360018
055200 2400-LINK-PRINT-PROGRAM.                                         07370018
055201*** WRITE MESSAGE TO CICS LOG W/TRAN START-UP INFO.               07380018
055202***  MOVE LENGTH OF LE-PARA-MESSAGE TO PV-COMMAREA-LENGTH         07390019
055203***  EXEC CICS                                                    07400019
055204***      WRITEQ TD                                                07410019
055205***       QUEUE  ('CSSL')                                         07420019
055206***        FROM  (LE-PARA-MESSAGE)                                07430019
055207***      LENGTH  (PV-COMMAREA-LENGTH)                             07440019
055208***        RESP  (PV-CICS-RESPONSE)                               07450019
055209***  END-EXEC.                                                    07460019
055300                                                                  07470018
055400     EXEC CICS                                                    07480018
055500         LINK PROGRAM  (PC-PRINT-PGM)                             07490018
055600         COMMAREA (CE004-COMMAREA-REC)                            07500018
055700         LENGTH   (PC-PRINT-PGM-LENGTH)                           07510018
055800         RESP     (PV-CICS-RESPONSE)                              07520018
055900     END-EXEC                                                     07530018
056000                                                                  07540018
056100     EVALUATE TRUE                                                07550018
056200       WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                   07560018
056300           CONTINUE                                               07570018
056400                                                                  07580018
056500       WHEN OTHER                                                 07590018
056600           MOVE '2400-LINK-PRINT-PGM' TO DP013-PARAGRAPH          07600018
056700           MOVE 'LINK TO PRINT PGM'   TO DP013-MESSAGE-TEXT(1)    07610018
056730           SET DP013-CICS-ABEND                                           
056740               DP013-XCTL-DISPLAY-RESTART TO TRUE                         
056750           PERFORM DP013-0000-PROCESS-ABEND                       03920018
056900     END-EVALUATE.                                                07630018
057000                                                                  07640018
057100*CHECK LINK RETURN CODE.                                          07650018
057200     IF CE004-PRT-SUCCESSFUL                                      07660018
057210         PERFORM 1200-OPEN-CEPLRQ-CSR                             07670018
057400     ELSE                                                         07680018
057500         MOVE CE004-PRT-RET-CDE  TO LE-PRT-RET-CDE                07690018
057600         MOVE CE004-PRT-RET-MSG  TO LE-PRT-RET-MSG                07700018
057700         MOVE CE004-PRT-REQ-ID   TO LE-PRT-REQ-ID                 07710018
057800         MOVE LENGTH OF LE-LINK-ERRORS TO PV-COMMAREA-LENGTH      07720018
057900         EXEC CICS                                                07730018
058000             WRITEQ TD                                            07740018
058100              QUEUE  ('CSSL')                                     07750018
058200               FROM  (LE-LINK-ERRORS)                             07760018
058300             LENGTH  (PV-COMMAREA-LENGTH)                         07770018
058400               RESP  (PV-CICS-RESPONSE)                           07780018
058500         END-EXEC                                                 07790018
058600         MOVE '2400-LINK-PRINT-PROGRAM' TO DP013-PARAGRAPH        07800018
058700         MOVE 'BAD PRINT RETURN CD'     TO DP013-MESSAGE-TEXT(1)  07810018
058701         MOVE LE-LINK-ERRORS            TO DP013-MESSAGE-TEXT(2)  07810018
058730         SET DP013-CICS-ABEND                                             
058740             DP013-XCTL-DISPLAY-RESTART TO TRUE                           
058750         PERFORM DP013-0000-PROCESS-ABEND                                 
058900     END-IF.                                                      07830018
059000                                                                  07840018
059001******************************************************************07850018
059002* LINK TO PRINT PROGRAM (CEKCS609). CSR-2                         07860018
059003******************************************************************07870018
059004 2402-LINK-PRINT-PROGRAM-CSR2.                                    07880018
059005*** WRITE MESSAGE TO CICS LOG W/TRAN START-UP INFO.               07890018
059006***  MOVE LENGTH OF LE-PARA-MESSAGE2 TO PV-COMMAREA-LENGTH        07900019
059007***  EXEC CICS                                                    07910019
059008***      WRITEQ TD                                                07920019
059009***       QUEUE  ('CSSL')                                         07930019
059010***        FROM  (LE-PARA-MESSAGE2)                               07940019
059011***      LENGTH  (PV-COMMAREA-LENGTH)                             07950019
059012***        RESP  (PV-CICS-RESPONSE)                               07960019
059013***  END-EXEC.                                                    07970019
059014                                                                  07980018
059015     EXEC CICS                                                    07990018
059016         LINK PROGRAM  (PC-PRINT-PGM)                             08000018
059017         COMMAREA (CE004-COMMAREA-REC)                            08010018
059018         LENGTH   (PC-PRINT-PGM-LENGTH)                           08020018
059019         RESP     (PV-CICS-RESPONSE)                              08030018
059020     END-EXEC                                                     08040018
059021                                                                  08050018
059022     EVALUATE TRUE                                                08060018
059023       WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                   08070018
059024           CONTINUE                                               08080018
059025                                                                  08090018
059026       WHEN OTHER                                                 08100018
059027           MOVE '2402-LINK-PRINT-PGM' TO DP013-PARAGRAPH          08110018
059028           MOVE 'LINK TO PRINT PGM'   TO DP013-MESSAGE-TEXT(1)    08120018
059031           SET DP013-CICS-ABEND                                           
059032               DP013-XCTL-DISPLAY-RESTART TO TRUE                         
059033           PERFORM DP013-0000-PROCESS-ABEND                       03920018
059035     END-EVALUATE.                                                08140018
059036                                                                  08150018
059037*CHECK LINK RETURN CODE.                                          08160018
059038     IF CE004-PRT-SUCCESSFUL                                      08170018
059039         PERFORM 1202-OPEN-CEPLRQ-CSR2                            08180018
059040     ELSE                                                         08190018
059041         MOVE CE004-PRT-RET-CDE  TO LE-PRT-RET-CDE                08200018
059042         MOVE CE004-PRT-RET-MSG  TO LE-PRT-RET-MSG                08210018
059043         MOVE CE004-PRT-REQ-ID   TO LE-PRT-REQ-ID                 08220018
059044         MOVE LENGTH OF LE-LINK-ERRORS TO PV-COMMAREA-LENGTH      08230018
059045         EXEC CICS                                                08240018
059046             WRITEQ TD                                            08250018
059047              QUEUE  ('CSSL')                                     08260018
059048               FROM  (LE-LINK-ERRORS)                             08270018
059049             LENGTH  (PV-COMMAREA-LENGTH)                         08280018
059050               RESP  (PV-CICS-RESPONSE)                           08290018
059051         END-EXEC                                                 08300018
059052         MOVE '2402-LINK-PRINT-PROGRAM' TO DP013-PARAGRAPH        08310018
059053         MOVE 'BAD PRINT RETURN CD'     TO DP013-MESSAGE-TEXT(1)  08320018
059054         MOVE LE-LINK-ERRORS            TO DP013-MESSAGE-TEXT(2)  07810018
059055         SET DP013-CICS-ABEND                                             
059059             DP013-XCTL-DISPLAY-RESTART TO TRUE                           
059060         PERFORM DP013-0000-PROCESS-ABEND                                 
059070     END-IF.                                                      08340018
059099                                                                          
062500                                                                  08700018
062600******************************************************************08710018
062700* GET CURRENT DATE ROUTINE                                        08720018
062800******************************************************************08730018
062900     COPY DPPD017.                                                08740018
062910                                                                  08700018
062920******************************************************************08710018
062930*    ABEND PROCESSOR MODUEL                                       08720018
062940******************************************************************08730018
062950     COPY DPPD013.                                                08740018
063000                                                                  08750018
063100******************************************************************08760018
063200******************************************************************08770018
