       IDENTIFICATION DIVISION.                                                 
                                                                                
       PROGRAM-ID.              INKUT101.                                       
       AUTHOR.                  TROY BIRK.                                      
       INSTALLATION.            KOHLS DEPARTMENT STORES.                        
       DATE-WRITTEN.            08/93.                                          
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      *   INVENTORY PRE-EDIT PROGRAM.                                           
      ******************************************************************        
      *                    CHANGE LOG                                  *        
      ******************************************************************        
      *   03/94  MARC BLAZICH                                                   
      *   SCAN-LINE-NUMBER LOGIC ADDED;                                         
      *   ADDED LOGIC TO MOVE LINE NUMBER CAPTURED DURING SCANNING              
      *   PROCESS TO SCAN_LINE_NBR. MOVE 0 TO INV_LINE_NUMBER - TO              
      *   BE EVALUATED AND POPULATED IN LATER PROGRAM                           
      ******************************************************************        
      *   11/94  TROY BIRK                                                      
      *   ADDED A CHECK TO MAKE SURE TOTALS IN HEADER MATCH                     
      *   COMPUTED TOTALS.                                                      
      ******************************************************************        
      *   01/95  JOHN OBERHAUSER - CPU                                          
      *   IF IN-COUNT-FILE IS EMPTY, PASS 4052 TO RETURN CODE                   
      *   AND END THE PROGRAM.                                                  
      ******************************************************************        
      *   02/96  D. HOPPA                                                       
      *   DISPLAY A MESSAGE THAT INDICATES EITHER THE STORE IS VALID            
      *   AND BEING PROCESSED OR THE STORE DATA HAS ERRORS AND IS               
      *   ERRORING OUT THE STORE                                                
      ******************************************************************        
      *   03/98  J.SEIDLER                                                      
      *   ADDED LOGIC TO ACCEPTED A SECOND INVENTORY DATA FILE FOR              
      *   SELECTED STORES.  THIS INCLUDED ADDING A NEW STORE CONTROL            
      *   FILE, BYPASSING THE EDIT CHECK AGAINST THE INV-REC-DATE,              
      *   AND OVERRIDING THE SCAN-IND PROCESSING.                               
      ******************************************************************        
      *   04/98  J.SEIDLER                                                      
      *   FOR SHEET-INVENTORY, ADDED THE FOLLOWING LOGIC:                       
      *       .. ERROR OUT DATA WHEN ALL SEQUENCE NUMBER ARE 000 OR 999         
      *       .. WHEN DIFFERENT STORE NUMBERS EXIST IN THE FILE, CHANGE         
      *          THE STORE NUMBER ON THE CURRENT RECORD TO THAT OF THE          
      *          PREVIOUS RECORD.                                               
      ******************************************************************        
      *   01/99  J.SEIDLER                                                      
      *        CHANGE LOGIC TO                                                  
      *          ERROR OUT DATA WHEN ALL SEQUENCE NUMBER ARE 000 OR 999         
      *          ONLY ON *STORE* SHEET INVENTORY.  DC SHEETS WILL BE            
      *          EXCLUDED FROM THIS EDIT CHECK.                                 
      ******************************************************************        
      *   02/99  M.KLAMIK                                                       
      *        CHANGE LOGIC TO                                                  
      *          MOVE AND EDIT NEW SCAN DATE AND TIMESTAMP.                     
      *          EXPAND COPYBOOKS INWS018 AND INWS010.                          
      ******************************************************************        
      *   06/99  J.SEIDLER                                                      
      *        CHANGE LOGIC TO                                                  
      *         ALLOW ZEROES IN THE TIMESTAMP FIELD.                            
      *         (SCANNING SERVICES START THE NEXT DAY WITH ZERO AS THE          
      *          TIMESTAMP)                                                     
      ******************************************************************        
      *   03/2000 B. MCASEY                                                     
      *        ELIMINATE ALL EDITS ON INWS018-SCAN-TIMESTAMP &                  
      *         INWS018-SCAN-DATE.  ADD NEW LOGIC TO FORMAT NEW                 
      *         FIELDS ON THE VALID-STORE-CONTROL-FILE (Z750)                   
      ******************************************************************        
W21732* 11/11/2002 CHANGED BY IGSI           WR# W21732               *         
W21732*    ADDED SKU CROSS REFERENCE TABLE FOR LOOKING UP DEPT/CLASS. *         
W21732*    CHANGED DEPT/CLASS/SKU NUMBER EDIT LOGIC TO EDIT           *         
W21732*    NON-INTELLIGENT SKU INSTEAD.EXPANDED THE OUT-COUNT-FILE'S  *         
W21732*    RECORD LENGTH.                                             *         
C21732*    ADD TUPCSKU TO PROGRAM. IF RECORD CONTAINS UPC, THEN SKU   *         
C21732*    WILL BE ZEROS. IN THIS CASE, USE UPC TO RETRIVE SKU ATTR.  *         
S21732*    FIELD PV-UPC-HIGH WAS CODED WITH CHECK-DIGIT OF 0. THIS    *         
S21732*    CHECK-DIGIT NEEDS TO BE 9 TO SPECIFY MAX INTL UPC NBR      *         
      ******************************************************************        
25248 * 25248    10-06-2003  UPC CAPABILITIES & STORE NUMBER EXPANSION          
25248 *                      -ROD JANSSEN                                       
W26600******************************************************************        
W26600*                                                                         
W26600*  W26600  06-  -2004  PHYSICAL INVENTORY STORE EXPANSION                 
W26600*                      M JOHNSON                                          
W26600*                                                                         
      ******************************************************************        
W26006* 02/24/2005 CHANGED BY ERIN SEARL     WR# W26006                *        
W26006*    REMOVE REFERENCES TO OBSOLETE STORE TABLE.                  *        
      ******************************************************************        
W28543* 06/21/2005 ALLOW 100 LOCATIONS TO BE PROCESSED (VS LIMIT OF 25)*        
W28543*    FOR AFT-INV LOCATIONS (IE. SHEETS) - PC-MAX-AFT-INV-STORES           
W28543*    AND PV-AFT-INV-STORE-TAB OCCURS 100 TIMES                            
P28545*W28545  03-24-2006 ROD JANSSEN CYCLE INVENTORY PRICE MODULE SETUP        
Z28545*W28545  08-21-2006 ROD JANSSEN SUB CLASS IN PLACE OF CLASS.              
      ******************************************************************        
W33304* 33304    06-16-2008  HILO CHANGES  -  INV_PARMS_CURSOR WHERE            
W33304*                      -CONDITIONS  PATTY JAEGER  CODEWORKS               
W33304******************************************************************        
      * CHG0281369  2/14/23  JEAN KURK                                          
      *          CHANGE CALL TO UPC CHECK DIGIT ROUTINE TO BE DYNAMIC           
      ******************************************************************        
       ENVIRONMENT DIVISION.                                                    
      *                                                                         
      *                                                                         
       CONFIGURATION SECTION.                                                   
                                                                                
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
      *                                                                         
      *                                                                         
       INPUT-OUTPUT SECTION.                                                    
                                                                                
       FILE-CONTROL.                                                            
           SELECT IN-COUNT-FILE                                                 
               ASSIGN TO INP01.                                                 
JS0398     SELECT IN-AFT-INV-STORES-CC                                          
               ASSIGN TO INP02.                                                 
           SELECT OUT-COUNT-FILE                                                
               ASSIGN TO OUT01.                                                 
           SELECT INVALID-RANGE-FILE                                            
               ASSIGN TO OUT02.                                                 
           SELECT STORE-CONTROL-FILE                                            
               ASSIGN TO OUT03.                                                 
0300RM     SELECT STORE-ERROR-FILE                                              
0300RM         ASSIGN TO OUT04.                                                 
           SELECT ERROR-REPORT-FILE                                             
               ASSIGN TO RPT01.                                                 
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  IN-COUNT-FILE                                                        
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  IN-COUNT-RECORD         PIC X(58).                                   
                                                                                
JS0398 FD  IN-AFT-INV-STORES-CC                                                 
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  IN-AFT-INV-STORES-REC   PIC X(80).                                   
                                                                                
       FD  OUT-COUNT-FILE                                                       
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
W21732 01  OUT-COUNT-RECORD        PIC X(100).                                  
                                                                                
       FD  INVALID-RANGE-FILE                                                   
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  INVALID-RANGE-RECORD    PIC X(18).                                   
                                                                                
       FD  STORE-CONTROL-FILE                                                   
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
0300RM*01  STORE-CONTROL-RECORD    PIC X(03).                                   
0300RM 01  STORE-CONTROL-RECORD    PIC X(80).                                   
                                                                                
0300RM FD  STORE-ERROR-FILE                                                     
0300RM     LABEL RECORDS ARE STANDARD                                           
0300RM     RECORDING MODE IS F                                                  
0300RM     BLOCK CONTAINS 0 RECORDS.                                            
0300RM 01  STORE-ERROR-RECORD      PIC X(80).                                   
                                                                                
       FD  ERROR-REPORT-FILE                                                    
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  ERROR-REPORT-LINE       PIC X(132).                                  
                                                                                
                                                                                
           EJECT                                                                
       WORKING-STORAGE SECTION.                                                 
      *                                                                         
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-EMPTY-DATE        PIC X(10)   VALUE '9999-09-09'.             
           05  PC-MAX-RETRIES       PIC 9(03)   VALUE 3.                        
W28543     05  PC-MAX-AFT-INV-STORES PIC 9(03)   VALUE 100.                     
      *                                                                         
       01  CC-CONTROL-CARD.                                                     
           05  CC-DATE              PIC X(10)  VALUE SPACES.                    
           05  FILLER               PIC X(72)  VALUE SPACES.                    
      *                                                                         
JS0398 01  CC-AFT-INV-STORES.                                                   
25248      05  CC-STORE             PIC X(04)  VALUE SPACES.                    
25248      05  FILLER               PIC X(76)  VALUE SPACES.                    
      *                                                                         
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-DISPLAY-QTY       PIC Z,ZZZ,ZZZ,ZZ9    VALUE ZERO.            
           05  PV-DISPLAY-RTL       PIC Z,ZZZ,ZZZ,ZZ9.99 VALUE ZERO.            
           05  PV-SQL-SUB           PIC 9(03)  VALUE ZERO.                      
JS0398     05  PV-STORE-SUB         PIC S9(05) COMP VALUE ZERO.                 
           05  PV-PARAGRAPH-NAME    PIC X(30)  VALUE SPACES.                    
           05  PV-DB2-OPER-ATTEMPTED PIC X(30)  VALUE SPACES.                   
           05  PV-RETAIL            PIC S9(09)V99 VALUE 0 COMP-3.               
           05  PV-EXT-RETAIL        PIC S9(09)V99 VALUE 0 COMP-3.               
           05  PV-QUANTITY          PIC S9(09)    VALUE 0 COMP-3.               
           05  PV-HOLD-QTY          PIC S9(09)    VALUE 0 COMP-3.               
           05  PV-HOLD-RETAIL       PIC S9(09)V99 VALUE 0 COMP-3.               
25248      05  PV-HOLD-STORE        PIC X(04)     VALUE SPACE.                  
           05  PV-INVALID-RANGE.                                                
               10  PV-RANGE-LOW     PIC 9(08)  VALUE ZERO.                      
               10  FILLER           PIC X(01)  VALUE SPACES.                    
               10  PV-RANGE-HIGH    PIC 9(08)  VALUE ZERO.                      
               10  PV-RETRY-IND     PIC X(01)  VALUE SPACES.                    
           05  PV-CURRENT-DATE.                                                 
               10  PV-CC            PIC X(02)  VALUE SPACES.                    
               10  PV-YY            PIC X(02)  VALUE SPACES.                    
               10  FILLER           PIC X(01)  VALUE '-'.                       
               10  PV-MM            PIC X(02)  VALUE SPACES.                    
               10  FILLER           PIC X(01)  VALUE '-'.                       
               10  PV-DD            PIC X(02)  VALUE SPACES.                    
W21732     05 PV-UPC-LOW.                                                       
W21732         10 FILLER            PIC 9(04)  VALUE 0400.                      
W21732         10 PV-UPC-SKU-MIN    PIC 9(08)  VALUE ZEROS.                     
W21732         10 FILLER            PIC 9      VALUE 0.                         
W21732     05 PV-SIGN-UPC-MIN REDEFINES PV-UPC-LOW                              
W21732                              PIC S9(13).                                 
W21732     05 PV-UPC-HIGH.                                                      
W21732         10 FILLER            PIC 9(04)  VALUE 0400.                      
W21732         10 PV-UPC-SKU-MAX    PIC 9(08)  VALUE ZEROS.                     
S21732         10 FILLER            PIC 9      VALUE 9.                         
W21732     05 PV-SIGN-UPC-MAX REDEFINES PV-UPC-HIGH                             
W21732                              PIC S9(13).                                 
W21732     05 PV-MDSEAR-UPC-MIN     PIC S9(13)V COMP-3.                         
W21732     05 PV-MDSEAR-UPC-MAX     PIC S9(13)V COMP-3.                         
C21732     05 PV-UPC-CODE-SIGNED    PIC S9(13).                                 
C21732     05 PV-UPC-CODE-COMP      PIC S9(13)V COMP-3.                         
25248      05 PV-EDIT-LOC-NBR       PIC S9(04) COMP VALUE ZEROS.                
P28545     05 PV-EDIT-DEPT          PIC 9(04)       VALUE ZEROS.                
P28545     05 PV-EDIT-CLASS         PIC 9(04)       VALUE ZEROS.                
P28545     05  PV-WORK-UPC-X2.                                                  
P28545         10  FILLER               PIC X(2)    VALUE ZEROES.               
P28545         10  FILLER               PIC X(4)    VALUE '0400'.               
P28545         10  PV-UPC-SKU2          PIC X(8).                               
P28545         10  PV-UPC-CHK-DIG2      PIC 9       VALUE ZERO.                 
P28545     05  PV-WORK-UPC2  REDEFINES  PV-WORK-UPC-X2                          
P28545                                  PIC 9(15).                              
P28545     05  PV-EDIT-UPC-CODE     PIC 9(15).                                  
P28545     05  PV-EDIT-UPC-CODE-ALPH REDEFINES                                  
P28545         PV-EDIT-UPC-CODE     PIC X(15).                                  
                                                                                
JS0398 01  PV-AFT-INV-TABLE.                                                    
W28543     05  PV-AFT-INV-STORE-TAB OCCURS 100 TIMES.                           
25248          10  PV-AFT-INV-STORE PIC X(04).                                  
                                                                                
       01  PA-PROGRAM-ACCUMULATORS.                                             
           05  PA-LINE-NUMBER       PIC S9(05)  VALUE ZERO   COMP-3.            
           05  PA-TOTAL-INPUT       PIC S9(07)  VALUE ZERO   COMP-3.            
           05  PA-STORE-RECORD-NUM  PIC S9(07)  VALUE +1     COMP-3.            
           05  PA-ERROR-COUNT       PIC S9(03)  VALUE ZERO   COMP-3.            
           05  PA-NUMBER-OF-HEADERS PIC S9(05)  VALUE ZERO   COMP-3.            
           05  PA-TOTAL-STORES      PIC S9(05)  VALUE ZERO   COMP-3.            
JS0699     05  PA-ZERO-TIMESTAMP    PIC S9(05)  VALUE ZERO   COMP-3.            
      *                                                                         
       01  PC-PRINT-CONTROL.                                                    
           05  PC-LINE-COUNT        PIC S9(03)  VALUE +099.                     
           05  PC-LINE-MAX          PIC S9(03)  VALUE +57.                      
           05  PC-ADVANCE           PIC S9(03)  VALUE ZERO.                     
           05  PC-PAGE              PIC S9(05)  VALUE ZERO.                     
      *                                                                         
       01  SA-SAVE-AREAS.                                                       
           05  SA-SHEET-NUMBER      PIC X(06)   VALUE SPACES.                   
25248      05  SA-STORE-NUMBER.                                                 
25248 *        10  SA-STORE-NUMBER-P1   PIC X(01)   VALUE SPACES.               
25248 *        10  SA-STORE-NUMBER-P2   PIC X(03)   VALUE SPACES.               
W26600         10  FILLER               PIC X(04)   VALUE SPACE.                
25248      05  SA-STORE-NUMBER-NUM REDEFINES                                    
25248          SA-STORE-NUMBER          PIC 9(04).                              
                                                                                
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-INVALID-STORE-IND PIC X       VALUE 'N'.                      
               88  PS-INVALID-STORE             VALUE 'Y'.                      
           05  PS-END-OF-INVENTORY  PIC X       VALUE 'N'.                      
               88  PS-EOF-INVENTORY-FILE        VALUE 'Y'.                      
           05  PS-END-OF-STORE      PIC X       VALUE 'N'.                      
               88  PS-EOF-STORE-FILE            VALUE 'Y'.                      
           05  PS-INVENTORY-TYPE    PIC X       VALUE ' '.                      
               88  PS-SCANNING-STORE            VALUE 'S'.                      
               88  PS-KEYING-STORE              VALUE 'K'.                      
               88  PS-AFT-INV-KEYING-STORE      VALUE 'A'.                      
           05  PS-STORE-OK-SW       PIC X       VALUE 'Y'.                      
               88  PS-STORE-OK                  VALUE 'Y'.                      
               88  PS-STORE-NOT-OK              VALUE 'N'.                      
           05  PS-STORE-BREAK-SW    PIC X       VALUE 'N'.                      
               88  PS-STORE-BREAK               VALUE 'Y'.                      
               88  PS-NO-STORE-BREAK            VALUE 'N'.                      
           05  PS-INVPAR-REC-EXISTS-SW PIC X    VALUE 'N'.                      
               88  PS-INVPAR-REC-EXISTS         VALUE 'Y'.                      
               88  PS-NO-INVPAR-REC-EXISTS      VALUE 'N'.                      
           05  PS-RETRY-STORE-SW       PIC X    VALUE 'N'.                      
               88  PS-DONT-RETRY-STORE          VALUE 'N'.                      
               88  PS-RETRY-STORE               VALUE 'Y'.                      
           05  PS-HDR-TOTALS-INCL-SW   PIC X    VALUE SPACE.                    
               88  PS-HDR-FIRST-HEADER          VALUE SPACE.                    
               88  PS-HDR-TOTALS-INCL           VALUE 'Y'.                      
               88  PS-HDR-TOTALS-NOT-INCL       VALUE 'N'.                      
JS0398     05  PS-AFT-INV-STORE-SW     PIC X    VALUE 'N'.                      
               88  PS-AFT-INV-STORE-FOUND       VALUE 'Y'.                      
               88  PS-AFT-INV-STORE-NOT-FOUND   VALUE 'N'.                      
JS0398     05  PS-END-OF-AFT-INV-STORE-IND PIC X VALUE 'N'.                     
               88 PS-END-OF-AFT-INV-STORE-CC    VALUE 'Y'.                      
JS0498     05  PS-SEQ-TYPES-SW         PIC X    VALUE SPACE.                    
               88  PS-SEQ-FIRST                 VALUE SPACE.                    
               88  PS-SEQ-MIX                   VALUE 'M'.                      
               88  PS-SEQ-000999                VALUE 'Z'.                      
               88  PS-SEQ-VALID                 VALUE 'V'.                      
           05  PS-INVALID-DATE-SW      PIC X    VALUE 'N'.                      
               88  PS-INVALID-DATE              VALUE 'Y'.                      
               88  PS-VALID-DATE                VALUE 'N'.                      
           05  PS-INVALID-TIME-SW      PIC X    VALUE 'N'.                      
               88  PS-INVALID-TIME              VALUE 'Y'.                      
               88  PS-VALID-TIME                VALUE 'N'.                      
JS0699     05  PS-FIRST-TIME-SW     PIC X       VALUE 'Y'.                      
               88  PS-FIRST-TIME                VALUE 'Y'.                      
               88  PS-NOT-FIRST-TIME            VALUE 'N'.                      
0300RM     05  PS-FIRST-STORE-ERROR-SW  PIC X   VALUE 'Y'.                      
0300RM         88  PS-FIRST-STORE-ERROR         VALUE 'Y'.                      
      *                                                                         
       01  IW-WORK-TIME.                                                        
           05  IW-TIME         PIC 9(8).                                        
           05  FILLER  REDEFINES IW-TIME.                                       
               10  IW-HOUR     PIC 99.                                          
               10  IW-MIN      PIC 99.                                          
               10  IW-SEC      PIC 99.                                          
               10  IW-THOUS    PIC 99.                                          
      *                                                                         
       01  CPU-DATE.                                                            
           05  CPU-YEAR        PIC 99           VALUE ZERO.                     
           05  CPU-MONTH       PIC 99           VALUE ZERO.                     
           05  CPU-DAY         PIC 99           VALUE ZERO.                     
                                                                                
       01  WS-SCAN-TIMESTAMP.                                                   
           05  WS-SCAN-TIME-HH PIC 99           VALUE ZERO.                     
           05  WS-SCAN-TIME-MM PIC 99           VALUE ZERO.                     
           05  WS-SCAN-TIME-SS PIC 99           VALUE ZERO.                     
                                                                                
       01  WS-DATE-CCYY.                                                        
           05  WS-DATE-CC      PIC 99           VALUE ZERO.                     
           05  WS-DATE-YY      PIC 99           VALUE ZERO.                     
                                                                                
0300RM*01  WS-SCAN-DATE.                                                        
0300RM*    05  WS-SCAN-DATE-MM PIC 99           VALUE ZERO.                     
0300RM*    05  WS-SCAN-DATE-DD PIC 99           VALUE ZERO.                     
                                                                                
0300RM 01  PV-MESSAGE-VARIABLE.                                                 
0300RM     05  PV-DATASET-HEADER1      PIC X(80)  VALUE                         
0300RM        'THE FOLLOWING STORES HAD BAD DATA IN THEIR INVENTORY DATA        
0300RM-       ' FILES'.                                                         
0300RM     05  PV-DATASET-HEADER2      PIC X(80)  VALUE                         
0300RM        'ERRORS ARE LISTED IN THE INK300/INKUT101 PHYSICAL COUNT E        
0300RM-       'RROR LIST'.                                                      
                                                                                
0300RM 01  SE-STORE-ERROR-AREA.                                                 
0300RM     05  SE-DATA-AREA.                                                    
0300RM         10  FILLER              PIC X(22)  VALUE SPACES.                 
25248          10  SE-STORE-NUMBER     PIC X(04).                               
0300RM         10  FILLER              PIC X(03)  VALUE ' - '.                  
0300RM         10  SE-STORE-NAME       PIC X(30).                               
25248          10  FILLER              PIC X(21)  VALUE SPACES.                 
                                                                                
       01  PC-CALENDAR-MODULE                 PIC X(8) VALUE 'DPKUT500'.        
       01  WS-CALENDAR-TYPE                   PIC X(2) VALUE 'F2'.              
                                                                                
       01  H1-HEADING.                                                          
           05  FILLER          PIC X(33)        VALUE SPACES.                   
           05  FILLER          PIC X(36)        VALUE                           
           'PHYSICAL COUNT ERROR LIST FOR STORE '.                              
           05  H1-STORE-NUMBER PIC X(4)         VALUE SPACES.                   
           05  FILLER          PIC X(01)        VALUE SPACES.                   
           05  H1-STORE-NAME   PIC X(25)        VALUE SPACES.                   
           05  FILLER          PIC X(33)        VALUE SPACES.                   
      *                                                                         
       01  H2-HEADING.                                                          
           05  FILLER          PIC X(22)        VALUE SPACES.                   
           05  FILLER          PIC X(13)        VALUE 'RECORD NUMBER'.          
           05  FILLER          PIC X(5)         VALUE SPACES.                   
           05  FILLER          PIC X(6)         VALUE 'ERROR'.                  
           05  FILLER          PIC X(86)        VALUE SPACES.                   
      *                                                                         
       01  D1-DETAIL.                                                           
           05  FILLER          PIC X(27)        VALUE SPACES.                   
           05  D1-RECORD-COUNT PIC ZZZZZZZ9     VALUE ZERO.                     
           05  FILLER          PIC X(5)         VALUE SPACES.                   
           05  D1-ERROR-HOLD   PIC X(54)        VALUE SPACES.                   
           05  FILLER          PIC X(38)        VALUE SPACES.                   
      *                                                                         
       01  D2-DETAIL.                                                           
           05  FILLER          PIC X(35)        VALUE SPACES.                   
           05  FILLER          PIC X(38)        VALUE                           
               '**** TOTAL NUMBER OF ERRORS FOR STORE '.                        
25248      05  D2-STORE        PIC X(04)        VALUE ZERO.                     
25248      05  FILLER          PIC X(03)        VALUE ' = '.                    
           05  D2-TOTAL-ERRS   PIC ZZZZZZZ9     VALUE ZERO.                     
           05  FILLER          PIC X(5)         VALUE ' ****'.                  
           05  FILLER          PIC X(5)         VALUE SPACES.                   
25248      05  FILLER          PIC X(34)        VALUE SPACES.                   
      *                                                                         
       01  MSG-MESSAGES.                                                        
           05  MSG-COUNT             PIC X(17)             VALUE                
           '  RECORD COUNT = '.                                                 
           05  MSG-MULTIPLE-STORES   PIC X(54)             VALUE                
           '**** FILE CONTAINS MULTIPLE STORES ****               '.            
           05  MSG-BAD-STORE         PIC X(54)             VALUE                
           '**** NON NUMERIC STORE NUMBER  ****                   '.            
           05  MSG-INVALID-STORE     PIC X(54)             VALUE                
           '****STORE NUMBER ON INPUT FILE NOT ON STORE TABLE**** '.            
           05  MSG-STORE-ALREADY-PROCESSED PIC X(54)       VALUE                
           '**** INVENTORY DATA HAS ALREADY BEEN PROCESSED ****   '.            
           05  MSG-BOOK-BEFORE-INV   PIC X(54)             VALUE                
           '***A BOOKING DATE HAS BEEN UPDATED BEFORE INV DATE*** '.            
           05  MSG-NO-CUTOFFS        PIC X(54)             VALUE                
           'PLANNED INV DATE > CURRENT DATE-CUTOFFS NOT PROCESSED '.            
           05  MSG-NO-INVPAR-REC     PIC X(54)             VALUE                
           '**** NO INVENTORY PARAMETER RECORD EXISTS ****        '.            
           05  MSG-BAD-SHEET         PIC X(54)             VALUE                
           '***  NON NUMERIC AREA/SHEET NUMBER ****               '.            
           05  MSG-BAD-LINE          PIC X(54)             VALUE                
           '***  NON NUMERIC LINE NUMBER ****                     '.            
           05  MSG-BAD-DEPT-CLASS    PIC X(54)             VALUE                
           '**** NON NUMERIC DEPT/CLASS ****                      '.            
           05  MSG-BAD-SEQUENCE      PIC X(54)             VALUE                
           '**** NON NUMERIC SEQUENCE NUMBER ****                 '.            
           05  MSG-BAD-QUANTITY      PIC X(54)             VALUE                
           '**** NON NUMERIC QUANTITY ****                        '.            
           05  MSG-BAD-UPC           PIC X(54)             VALUE                
           '**** NON NUMERIC UPC CODE ****                        '.            
           05  MSG-BAD-PRICE         PIC X(54)             VALUE                
           '**** NON NUMERIC PRICE *****                          '.            
           05  MSG-NO-UPC-OR-SKU     PIC X(54)             VALUE                
           '**** NO SKU OR UPC SPECIFIED *****                    '.            
           05  MSG-ZERO-AREA         PIC X(54)             VALUE                
           '**** AREA NUMBER CONTAINS ZEROS ****                  '.            
           05  MSG-ZERO-LINE    PIC X(54)                  VALUE                
           '**** LINE NUMBER CONTAINS ZEROS ****          '.                    
           05  MSG-ZERO-SHEET   PIC X(54)                  VALUE                
           '**** SHEET NUMBER CONTAINS ZEROS ****         '.                    
           05  MSG-CUTOFFS-NOT-TAKEN PIC X(54)             VALUE                
           '**** CUTOFFS HAVE NOT BEEN TAKEN FOR THIS STORE ****  '.            
           05  MSG-TOTALS-DONT-MATCH PIC X(54)          VALUE                   
           '****  COMPUTED TOTALS DO NOT MATCH HEADER RECORD ****'.             
JS0498     05  MSG-NO-SEQ-NBRS       PIC X(54)          VALUE                   
           '****  ITM SEQ NBRS ARE ALL 000/999 FOR THE STORE ****'.             
0300RM*    05  MSG-BAD-DATE          PIC X(54)          VALUE                   
0300RM*    '****  NON NUMERIC DATE  ****'.                                      
0300RM*    05  MSG-BAD-TIME          PIC X(54)          VALUE                   
0300RM*    '****  NON NUMERIC TIMESTAMP  ****'.                                 
0300RM*    05  MSG-INV-DATE-TIME     PIC X(54)          VALUE                   
0300RM*    '****  INVALID DATE AND/OR TIMESTAMP COMBINATION  ****'.             
0300RM*    05  MSG-INV-TIME          PIC X(54)          VALUE                   
0300RM*    '****  INVALID VALUE IN TIMESTAMP  ****'.                            
0300RM*    05  MSG-INV-DATE          PIC X(54)          VALUE                   
0300RM*    '****  INVALID VALUE IN DATE  ****'.                                 
0300RM*    05  MSG-ZERO-TIME-LIMIT   PIC X(54)          VALUE                   
0300RM*    '****  FILE CONTAINS MORE THAN 50 TIMESTAMPS OF ZERO *'.             
                                                                                
P28545*****************************************************************         
P28545** THE CALLING PARAMETER LIST (DPWS040) FOR THE UPC CHECK       **        
P28545** DIGIT SUBROUTINE.                                            **        
P28545*****************************************************************         
P28545     COPY DPWS040I.                                                       
P28545                                                                          
      *****************************************************************         
      * RECORD LAYOUT OF INPUT FILE FROM SCANNING OR KEYING SERVICE.            
      *****************************************************************         
25248      COPY INWS018.                                                        
                                                                                
      *****************************************************************         
      * RECORD LAYOUT FOR OUTPUT FILE, RECORD NUMBER IS APPENDED TO             
      * THE INPUT FILE.                                                         
      *****************************************************************         
           COPY INWS010.                                                        
      *                                                                         
0300RM*****************************************************************         
0300RM* RECORD LAYOUT OF OUTPUT FILE                                            
0300RM*****************************************************************         
0300RM     COPY INWS004.                                                        
                                                                                
      *****************************************************************         
      *  WORK AREA FOR FISCAL DATE SUBROUTINE.                                  
      *****************************************************************         
           COPY DPWS500.                                                        
                                                                                
      *****************************************************************         
      *  STANDARD KOHLS HEADER (132 COLUMNS)                                    
      *****************************************************************         
           COPY DPWS132O.                                                       
      *                                                                         
      *****************************************************************         
      * ERROR MESSAGE AREA FOR DB2                                              
      *****************************************************************         
           COPY DPWS004.                                                        
      *                                                                         
25248 *****************************************************************         
  |   * XMT_LOC DCLGEN                                                          
  |   *****************************************************************         
  |                                                                             
  |        EXEC SQL                                                             
  |           INCLUDE XMT00001                                                  
  |        END-EXEC.                                                            
25248                                                                           
P28545*****************************************************************         
P28545* TINCNTL DCLGEN                                                          
P28545*****************************************************************         
P28545     EXEC SQL                                                             
P28545        INCLUDE TINCNTL                                                   
P28545     END-EXEC.                                                            
P28545                                                                          
      *****************************************************************         
      * TINVPAR DCLGEN                                                          
      *****************************************************************         
           EXEC SQL                                                             
              INCLUDE TINVPAR                                                   
           END-EXEC.                                                            
                                                                                
P28545*****************************************************************         
P28545*    DB2 AREA FOR THE TUPCSKU TABLE                             * INKCS003
P28545*****************************************************************         
P28545*    EXEC SQL                                                     INKCS003
P28545*         INCLUDE TUPCSKU                                         INKCS003
P28545*    END-EXEC.                                                    INKCS003
P28545*                                                                 INKCS003
P28545*---------------------------------------------------------------* INKCS003
P28545*    DB2 AREA FOR THE TSKXREF TABLE                             * INKCS003
P28545*---------------------------------------------------------------* INKCS003
P28545*    EXEC SQL                                                     INKCS003
P28545*         INCLUDE TSKXREF                                         INKCS003
P28545*    END-EXEC.                                                    INKCS003
P28545*                                                                 INKCS003
P28545*---------------------------------------------------------------* INKCS003
P28545*    DB2 AREA FOR THE TUPC TABLE                                * INKCS003
P28545*---------------------------------------------------------------* INKCS003
P28545*    EXEC SQL                                                     INKCS003
P28545*         INCLUDE TUPC                                            INKCS003
P28545*    END-EXEC.                                                    INKCS003
P28545*                                                                 INKCS003
P28545*---------------------------------------------------------------* INKCS003
P28545*    DB2 AREA FOR THE TMDARVS TABLE                             * INKCS003
P28545*---------------------------------------------------------------* INKCS003
P28545*    EXEC SQL                                                     INKCS003
P28545*         INCLUDE TMDARVS                                         INKCS003
P28545*    END-EXEC.                                                    INKCS003
P28545*                                                                 INKCS003
      *****************************************************************         
      * SQL COMM AREA DCLGEN                                                    
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
              INCLUDE SQLCA                                                     
           END-EXEC.                                                            
                                                                                
           COPY SQLCA2.                                                         
                                                                                
      *****************************************************************         
      * DB2 INVNETORY PARAMETERS CURSOR.                                        
      *****************************************************************         
           EXEC SQL                                                             
              DECLARE INV_PARMS_CURSOR CURSOR FOR                               
                SELECT ACTL_INV_DTE,                                            
                       PLND_INV_DTE,                                            
                       ACTL_INV_RECD_DTE,                                       
                       SCAN_INV_IND,                                            
                       ACTL_UNIT_BK_DTE,                                        
                       ITM_CTOFF_IND,                                           
                       ACTL_FIN_BK_DTE                                          
P28545            FROM TINVPAR A,                                               
P28545                 TINCNTL B                                                
P28545            WHERE B.ACTV_IND = 'Y'                                        
P28545              AND B.INV_ID = A.INV_ID                                     
W33304              AND A.LOC_NBR          = :INVPAR-LOC-NBR                    
W33304              AND A.LOC_INV_STAT_CDE = 'IN'                               
W33304              AND ACTL_FIN_BK_DTE    = '9999-09-09'                       
                  ORDER BY ACTL_INV_DTE DESC                                    
P28545            WITH UR                                                       
           END-EXEC.                                                            
                                                                                
       01  ABEND-CODE               PIC S9(04)  VALUE ZERO                      
                                                COMP SYNC.                      
P28545******************************************************************        
P28545* COPYBOOK - PRICING MODULE                                               
P28545******************************************************************        
P28545     COPY INWS400.                                                        
P28545                                                                          
       LINKAGE SECTION.                                                         
       PROCEDURE DIVISION.                                                      
      ****************************************************************          
      ****************************************************************          
       A100-MAIN-MODULE.                                                        
                                                                                
           PERFORM B100-OPEN-FILES.                                             
           PERFORM B200-INITIALIZE.                                             
JS0398     PERFORM Z150-READ-AFT-INV-STORE-CC                                   
               VARYING PV-STORE-SUB FROM 1 BY 1                                 
               UNTIL PS-END-OF-AFT-INV-STORE-CC.                                
           PERFORM Z100-READ-PHYSCNT-INPUT.                                     
           IF PS-EOF-INVENTORY-FILE                                             
               MOVE 4052 TO RETURN-CODE                                         
               DISPLAY '*** EMPTY INPUT FILE ***'                               
               STOP RUN                                                         
           END-IF.                                                              
                                                                                
           IF NOT IN018-HDR-RECORD                                              
               MOVE +4008                 TO ABEND-CODE                         
               DISPLAY '**  ABEND     **'                                       
               DISPLAY '**  PROGRAM   **  =  INKUT101'                          
               DISPLAY 'NO HEADER RECORD ON INPUT FILE'                         
               CALL 'ILBOABN0'  USING ABEND-CODE                                
           END-IF.                                                              
                                                                                
           PERFORM B500-PROCESS-INVENTORY-RECORDS                               
               UNTIL PS-EOF-INVENTORY-FILE.                                     
                                                                                
JS0199     IF PS-SEQ-000999                                                     
JS019          MOVE MSG-NO-SEQ-NBRS TO D1-ERROR-HOLD                            
JS0199         ADD 1 TO PA-ERROR-COUNT                                          
JS0199         PERFORM E100-INVALID-DATA                                        
JS0199     END-IF.                                                              
                                                                                
           MOVE PV-QUANTITY TO PV-DISPLAY-QTY.                                  
           MOVE PV-RETAIL   TO PV-DISPLAY-RTL.                                  
           DISPLAY '****STORE ' PV-HOLD-STORE.                                  
           DISPLAY '      COMPUTED QTY AND RTL: '                               
                    PV-DISPLAY-QTY                                              
                    ' '                                                         
                    PV-DISPLAY-RTL.                                             
           MOVE PV-HOLD-QTY    TO PV-DISPLAY-QTY.                               
           MOVE PV-HOLD-RETAIL TO PV-DISPLAY-RTL.                               
           DISPLAY '      HEADER   QTY AND RTL: '                               
                    PV-DISPLAY-QTY                                              
                    ' '                                                         
                    PV-DISPLAY-RTL.                                             
                                                                                
           IF PS-HDR-TOTALS-NOT-INCL                                            
               CONTINUE                                                         
           ELSE                                                                 
               IF PV-RETAIL NOT = PV-HOLD-RETAIL OR                             
                  PV-QUANTITY NOT = PV-HOLD-QTY                                 
                   SET PS-STORE-NOT-OK TO TRUE                                  
                   MOVE MSG-TOTALS-DONT-MATCH TO D1-ERROR-HOLD                  
                   INITIALIZE H1-STORE-NAME                                     
                   PERFORM E100-INVALID-DATA                                    
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF PS-STORE-NOT-OK OR                                                
              PA-ERROR-COUNT > 0                                                
               PERFORM E200-WRITE-TOTAL-MESSAGE                                 
               MOVE PA-TOTAL-INPUT TO PV-RANGE-HIGH                             
               PERFORM Z700-WRITE-RANGE-RECORD                                  
           ELSE                                                                 
               IF SA-STORE-NUMBER NOT = SPACES                                  
                   PERFORM Z750-WRITE-STORE-CONTROL-REC                         
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF PA-NUMBER-OF-HEADERS NOT = PA-TOTAL-STORES                        
               MOVE +4008                 TO ABEND-CODE                         
               DISPLAY '**  ABEND     **'                                       
               DISPLAY '**  PROGRAM   **  =  INKUT101'                          
               DISPLAY 'INVALID NUMBER OF HEADER RECORDS'                       
               CALL 'ILBOABN0'  USING ABEND-CODE                                
           END-IF.                                                              
                                                                                
           PERFORM B600-CLOSE-FILES.                                            
                                                                                
           STOP RUN.                                                            
      *                                                                         
      ******************************************************************        
      *    OPEN ALL FILES.                                                      
      ******************************************************************        
       B100-OPEN-FILES.                                                         
                                                                                
           OPEN INPUT  IN-COUNT-FILE                                            
                INPUT IN-AFT-INV-STORES-CC                                      
                                                                                
                OUTPUT ERROR-REPORT-FILE                                        
                       INVALID-RANGE-FILE                                       
                       STORE-CONTROL-FILE                                       
0300RM                 STORE-ERROR-FILE                                         
                       OUT-COUNT-FILE.                                          
      *                                                                         
      ******************************************************************        
      *  INITIALIZE VALUES FOR ERROR REPORT HEADINGS.                           
      ******************************************************************        
       B200-INITIALIZE.                                                         
                                                                                
           ACCEPT CPU-DATE FROM DATE.                                           
           ACCEPT IW-TIME FROM TIME.                                            
                                                                                
           MOVE CPU-MONTH  TO DP132O-RUN-MONTH                                  
                              PV-MM.                                            
           MOVE CPU-DAY    TO DP132O-RUN-DAY                                    
                              PV-DD.                                            
           MOVE CPU-YEAR   TO DP132O-RUN-YEAR                                   
                              PV-YY.                                            
           IF CPU-YEAR < 80                                                     
               MOVE '20' TO   PV-CC                                             
           ELSE                                                                 
               MOVE '19' TO   PV-CC                                             
           END-IF.                                                              
           MOVE IW-HOUR    TO DP132O-RUN-HOUR.                                  
           MOVE IW-MIN     TO DP132O-RUN-MINUTE.                                
           MOVE 'INKUT101' TO DP132O-PROGRAM-NAME.                              
           MOVE  1         TO DP132O-REPORT-NUMBER.                             
                                                                                
           INITIALIZE IN010-INVENTORY-COUNT-RECORD.                             
           INITIALIZE IN018-INVENTORY-COUNT-RECORD.                             
      *                                                                         
      ****************************************************************          
      * THE STORE NUMBER IS CHECKED AGAINST THE DB2 STORE TABLE.                
      ****************************************************************          
       B300-VALIDATE-STORE.                                                     
                                                                                
           MOVE IN018-STORE-NUMBER TO SA-STORE-NUMBER                           
                                      H1-STORE-NUMBER.                          
                                                                                
           PERFORM Z200-READ-STORE-TABLE.                                       
                                                                                
           IF SQLCODE NOT EQUAL ZERO                                            
               SET PS-STORE-NOT-OK TO TRUE                                      
               MOVE MSG-INVALID-STORE TO D1-ERROR-HOLD                          
               INITIALIZE H1-STORE-NAME                                         
               PERFORM E100-INVALID-DATA                                        
           ELSE                                                                 
25248          MOVE XMT00001-LOC-NM TO H1-STORE-NAME                            
           END-IF.                                                              
0198JS*                                                                         
      ****************************************************************          
      *                                                                         
      ****************************************************************          
       B400-EDIT-INVENTORY-PARAMTERS.                                           
                                                                                
           SET PS-INVPAR-REC-EXISTS TO TRUE.                                    
           PERFORM Z300-OPEN-INV-PARMS-CURSOR.                                  
           PERFORM Z400-FETCH-INV-PARMS-ROW.                                    
           PERFORM Z500-CLOSE-INV-PARMS-CURSOR.                                 
                                                                                
           IF PS-NO-INVPAR-REC-EXISTS                                           
               SET PS-STORE-NOT-OK TO TRUE                                      
               MOVE MSG-NO-INVPAR-REC TO D1-ERROR-HOLD                          
               PERFORM E100-INVALID-DATA                                        
           ELSE                                                                 
      ****************************************************************          
      *  A SITUATION CAN EXIST WHERE, SHEET INVENTORY WILL BE                   
      *  PROCESSED FOR A STORE AFTER THE STORE HAS COMPLETED ITS                
      *  SCANNED INVENTORY.  IN THIS SITUATION THE DATE CHECKS                  
      *  WILL BE BY-PASSED WHEN PROCESSING THE "SECOND" SHEET INVENTORY         
      *  DATA                                                                   
      ****************************************************************          
JS0398       SET PS-AFT-INV-STORE-NOT-FOUND TO TRUE                             
             PERFORM B510-DET-AFTER-INV-STORE                                   
                 VARYING PV-STORE-SUB FROM 1 BY 1                               
                 UNTIL PV-STORE-SUB > PC-MAX-AFT-INV-STORES                     
                     OR PS-AFT-INV-STORE-FOUND                                  
JS0398       IF PS-AFT-INV-STORE-FOUND                                          
                CONTINUE                                                        
             ELSE                                                               
               IF (INVPAR-ACTL-INV-RECD-DTE NOT = PC-EMPTY-DATE) AND            
                  (INVPAR-ACTL-UNIT-BK-DTE NOT = PC-EMPTY-DATE) AND             
                  (INVPAR-ACTL-FIN-BK-DTE NOT = PC-EMPTY-DATE)                  
                   SET PS-STORE-NOT-OK TO TRUE                                  
                   MOVE MSG-NO-INVPAR-REC TO D1-ERROR-HOLD                      
                   PERFORM E100-INVALID-DATA                                    
               ELSE                                                             
                   IF (INVPAR-ACTL-INV-RECD-DTE NOT = PC-EMPTY-DATE)            
                       SET PS-STORE-NOT-OK TO TRUE                              
                       MOVE MSG-STORE-ALREADY-PROCESSED TO D1-ERROR-HOLD        
                       PERFORM E100-INVALID-DATA                                
                   ELSE                                                         
                     IF (INVPAR-ACTL-UNIT-BK-DTE NOT = PC-EMPTY-DATE) OR        
                        (INVPAR-ACTL-FIN-BK-DTE NOT = PC-EMPTY-DATE)            
                         SET PS-STORE-NOT-OK TO TRUE                            
                         MOVE MSG-BOOK-BEFORE-INV  TO D1-ERROR-HOLD             
                         PERFORM E100-INVALID-DATA                              
                     ELSE                                                       
                         IF (INVPAR-PLND-INV-DTE > PV-CURRENT-DATE)             
                             SET PS-STORE-NOT-OK TO TRUE                        
                             MOVE MSG-NO-CUTOFFS TO D1-ERROR-HOLD               
                             PERFORM E100-INVALID-DATA                          
                         END-IF                                                 
                     END-IF                                                     
                   END-IF                                                       
                 END-IF                                                         
               END-IF                                                           
           END-IF.                                                              
                                                                                
           SET PS-DONT-RETRY-STORE TO TRUE.                                     
                                                                                
           IF PS-STORE-OK                                                       
               IF INVPAR-ITM-CTOFF-IND NOT = 'Y'                                
                   SET PS-STORE-NOT-OK TO TRUE                                  
                   MOVE MSG-CUTOFFS-NOT-TAKEN TO D1-ERROR-HOLD                  
                   PERFORM E100-INVALID-DATA                                    
                   SET PS-RETRY-STORE TO TRUE                                   
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF INVPAR-SCAN-INV-IND = 'Y'                                         
JS0398        IF PS-AFT-INV-STORE-FOUND                                         
                 SET PS-AFT-INV-KEYING-STORE TO TRUE                            
              ELSE                                                              
                 SET PS-SCANNING-STORE TO TRUE                                  
              END-IF                                                            
           ELSE                                                                 
               SET PS-KEYING-STORE TO TRUE                                      
           END-IF.                                                              
                                                                                
      *                                                                         
      ****************************************************************          
      * THE CURRENT STORE NUMBER MUST MATCH THE STORE NUMBER FROM THE           
      * FIRST RECORD.                                                           
      * OTHER INPUT FIELDS ARE CHECKED FOR NUMERIC DATA.                        
      ****************************************************************          
       B500-PROCESS-INVENTORY-RECORDS.                                          
                                                                                
           IF IN018-HDR-RECORD                                                  
               ADD 1 TO PA-NUMBER-OF-HEADERS                                    
               SET PS-STORE-BREAK TO TRUE                                       
               IF PS-HDR-FIRST-HEADER                                           
                   CONTINUE                                                     
               ELSE                                                             
                   DISPLAY '****STORE ' PV-HOLD-STORE                           
                   MOVE PV-QUANTITY TO PV-DISPLAY-QTY                           
                   MOVE PV-RETAIL   TO PV-DISPLAY-RTL                           
                   DISPLAY '      COMPUTED QTY AND RTL: '                       
                            PV-DISPLAY-QTY                                      
                            ' '                                                 
                            PV-DISPLAY-RTL                                      
                   MOVE PV-HOLD-QTY    TO PV-DISPLAY-QTY                        
                   MOVE PV-HOLD-RETAIL TO PV-DISPLAY-RTL                        
                   DISPLAY '      HEADER   QTY AND RTL: '                       
                            PV-DISPLAY-QTY                                      
                            ' '                                                 
                            PV-DISPLAY-RTL                                      
                   IF PS-HDR-TOTALS-INCL                                        
                       IF PV-RETAIL   NOT = PV-HOLD-RETAIL OR                   
                          PV-QUANTITY NOT = PV-HOLD-QTY                         
                           SET PS-STORE-NOT-OK TO TRUE                          
                           MOVE MSG-TOTALS-DONT-MATCH TO D1-ERROR-HOLD          
                           INITIALIZE H1-STORE-NAME                             
                           PERFORM E100-INVALID-DATA                            
                       END-IF                                                   
                   END-IF                                                       
JS0498             IF PS-SEQ-000999                                             
JS0498                 MOVE MSG-NO-SEQ-NBRS TO D1-ERROR-HOLD                    
JS0498                 ADD 1 TO PA-ERROR-COUNT                                  
JS0498                 PERFORM E100-INVALID-DATA                                
JS0498             END-IF                                                       
               END-IF                                                           
               IF IN018-HDR-TOTALS-NOT-INCL                                     
                   SET PS-HDR-TOTALS-NOT-INCL TO TRUE                           
                   INITIALIZE PV-HOLD-RETAIL                                    
                              PV-HOLD-QTY                                       
               ELSE                                                             
                   SET PS-HDR-TOTALS-INCL TO TRUE                               
                   MOVE IN018-HDR-RETAIL  TO PV-HOLD-RETAIL                     
                   MOVE IN018-HDR-QTY     TO PV-HOLD-QTY                        
               END-IF                                                           
               INITIALIZE                                                       
                       PV-RETAIL                                                
                       PV-EXT-RETAIL                                            
                       PV-QUANTITY                                              
               MOVE IN018-HDR-STORE       TO PV-HOLD-STORE                      
           ELSE                                                                 
               ADD 1 TO PA-TOTAL-INPUT                                          
               IF PS-STORE-BREAK                                                
                   ADD 1 TO PA-TOTAL-STORES                                     
                   IF PS-STORE-NOT-OK OR                                        
                      PA-ERROR-COUNT > 0                                        
                       PERFORM E200-WRITE-TOTAL-MESSAGE                         
                       SUBTRACT 1 FROM PA-TOTAL-INPUT GIVING                    
                                       PV-RANGE-HIGH                            
                       PERFORM Z700-WRITE-RANGE-RECORD                          
                   ELSE                                                         
                       IF SA-STORE-NUMBER NOT = SPACES                          
                           PERFORM Z750-WRITE-STORE-CONTROL-REC                 
                       END-IF                                                   
                   END-IF                                                       
                   MOVE PA-TOTAL-INPUT TO PV-RANGE-LOW                          
                   MOVE +99 TO PC-LINE-COUNT                                    
                   INITIALIZE PA-STORE-RECORD-NUM                               
                              PA-ERROR-COUNT                                    
                              PA-LINE-NUMBER                                    
                   MOVE IN018-AREA-NUMBER-X TO SA-SHEET-NUMBER                  
                   SET PS-STORE-OK TO TRUE                                      
                   PERFORM B300-VALIDATE-STORE                                  
                   PERFORM B400-EDIT-INVENTORY-PARAMTERS                        
                   SET PS-NO-STORE-BREAK TO TRUE                                
JS0498             SET PS-SEQ-FIRST TO TRUE                                     
               END-IF                                                           
               ADD 1 TO PA-STORE-RECORD-NUM                                     
                                                                                
JS0498*    FOR SHEET INVENTORY, WHEN THE STORE NUMBERS ARE NOT ALL THE          
      *    SAME, IT WILL BE ASSUMED TO BE A KEYING ERROR.  THE PROGRAM          
      *    WILL USE THE STORE NUMBER FROM THE PREVIOUS RECORD.                  
                                                                                
JS0498         IF PS-SCANNING-STORE                                             
                   MOVE IN018-STORE-NUMBER   TO IN010-STORE-NUMBER              
               ELSE                                                             
JS0498             IF IN018-STORE-NUMBER-X = SA-STORE-NUMBER                    
                       MOVE IN018-STORE-NUMBER   TO IN010-STORE-NUMBER          
                   ELSE                                                         
W26600                 MOVE SA-STORE-NUMBER      TO IN010-STORE-NUMBER          
                   END-IF                                                       
               END-IF                                                           
               MOVE IN018-AREA-NUMBER        TO IN010-AREA-NUMBER               
               MOVE ZEROS                    TO IN010-LINE-NUMBER               
               MOVE IN018-LINE-NUMBER        TO IN010-SCAN-LINE-NUMBER          
               MOVE IN018-SKU                TO IN010-SKU                       
C21732         MOVE IN018-UPC-CODE           TO IN010-UPC-CODE                  
C21732         IF IN018-SKU = ALL ZEROS                                         
C21732*           THIS IS TRUE WHEN A UPC IS RECORDED (VS. SKU)                 
C21732*           CHECK IF THIS IS A DUMMY KOHL'S UPC                           
P28545*           IF IN018-UPC-CODE (10:3) = ZEROS OR 999                       
P28545*               MOVE IN018-UPC-CODE (5:3) TO IN010-DEPT                   
P28545*               MOVE IN018-UPC-CODE (8:2) TO IN010-CLASS                  
P28545*           ELSE                                                          
P28545                PERFORM B506-SELECT-UPC                                   
P28545*           END-IF                                                        
C21732         ELSE                                                             
P28545*           IF IN018-SKU (6:3) = ZEROS OR 999                             
P28545*               MOVE IN018-SKU (1:3) TO IN010-DEPT                        
P28545*               MOVE IN018-SKU (4:2) TO IN010-CLASS                       
P28545*            ELSE                                                         
P28545                PERFORM B505-SELECT-SKU                                   
P28545*            END-IF                                                       
C21732         END-IF                                                           
               MOVE IN018-QUANTITY           TO IN010-QUANTITY                  
               MOVE IN018-PRICE              TO IN010-PRICE                     
               MOVE IN018-UPC-CODE           TO IN010-UPC-CODE                  
               MOVE IN018-INVALID-INDICATOR  TO IN010-INVALID-INDICATOR         
               MOVE IN018-BLANK-SHEET-INDICATOR  TO                             
                    IN010-BLANK-SHEET-INDICATOR                                 
                                                                                
0300RM*        IF IN018-SCAN-DTE IS NUMERIC                                     
                  MOVE IN018-SCAN-DTE        TO IN010-SCAN-DTE                  
0300RM*        ELSE                                                             
0300RM*           MOVE IN018-SCAN-DTE        TO IN010-SCAN-DTE-X                
0300RM*           SET PS-INVALID-DATE TO TRUE                                   
0300RM*           MOVE MSG-BAD-DATE          TO D1-ERROR-HOLD                   
0300RM*           ADD 1 TO PA-ERROR-COUNT                                       
0300RM*           PERFORM E100-INVALID-DATA                                     
0300RM*        END-IF                                                           
                                                                                
0300RM*        IF IN018-SCAN-TIMESTAMP IS NUMERIC                               
                  MOVE IN018-SCAN-TIMESTAMP  TO IN010-SCAN-TIMESTAMP            
0300RM*        ELSE                                                             
0300RM*           MOVE IN018-SCAN-TIMESTAMP  TO IN010-SCAN-TIMESTAMP-X          
0300RM*           SET PS-INVALID-TIME TO TRUE                                   
0300RM*           MOVE MSG-BAD-TIME          TO D1-ERROR-HOLD                   
0300RM*           ADD 1 TO PA-ERROR-COUNT                                       
0300RM*           PERFORM E100-INVALID-DATA                                     
0300RM*        END-IF                                                           
                                                                                
               IF PS-STORE-OK                                                   
                   PERFORM C100-EDIT-RECORD                                     
                   MOVE INVPAR-PLND-INV-DTE TO IN010-INV-DATE                   
JS0398             IF PS-AFT-INV-STORE-FOUND                                    
                       MOVE 'N'                 TO IN010-SCAN-IND               
                   ELSE                                                         
                       MOVE INVPAR-SCAN-INV-IND TO IN010-SCAN-IND               
                   END-IF                                                       
               ELSE                                                             
                   INITIALIZE  IN010-INV-DATE                                   
                               IN010-SCAN-IND                                   
                   IF PS-KEYING-STORE OR PS-AFT-INV-KEYING-STORE                
                       INITIALIZE  IN010-SCAN-LINE-NUMBER                       
                   END-IF                                                       
               END-IF                                                           
               MOVE PA-TOTAL-INPUT TO IN010-RECORD-NUMBER                       
               PERFORM Z600-WRITE-NEW-PHYSCNT-RECORD                            
           END-IF.                                                              
                                                                                
           PERFORM Z100-READ-PHYSCNT-INPUT.                                     
W21732*                                                                         
W21732*************************************************************             
W21732*  RETRIEVING DEPT/CLASS FROM TSKXREF TABLE.                *             
W21732*************************************************************             
P28545 B505-SELECT-SKU.                                                         
P28545                                                                          
P28545     INITIALIZE IN400-PV-INPUT-AREA.                                      
P28545                                                                          
P28545     SET IN400-PV-SKU-ATTRIB-LOOK TO TRUE.                                
P28545     MOVE IN010-STORE-NUMBER  TO IN400-PV-LOC-IN.                         
P28545     MOVE INVPAR-PLND-INV-DTE TO IN400-PV-EFF-DTE-IN.                     
P28545     MOVE IN010-SKU           TO IN400-PV-SKU-IN.                         
P28545                                                                          
P28545     PERFORM IN400-LOOKUP-RETAIL.                                         
P28545                                                                          
P28545*** A.  ZERO SEQUENCE SKU.                                                
P28545*** B.  RENUMBER SKU.                                                     
P28545*** C.  REGULAR SKU.                                                      
P28545     IF IN400-PV-DUMMY-SKU                                                
P28545         MOVE IN400-ATT-DEPT-OUT TO PV-EDIT-DEPT                          
Z28545         MOVE IN400-ATT-SCL-OUT  TO PV-EDIT-CLASS                         
P28545         MOVE PV-EDIT-DEPT       TO IN010-DEPT                            
P28545         MOVE PV-EDIT-CLASS      TO IN010-CLASS                           
P28545     ELSE                                                                 
P28545     IF IN400-PV-ATT-FOUND                                                
P28545         MOVE IN400-ATT-DEPT-OUT TO PV-EDIT-DEPT                          
Z28545         MOVE IN400-ATT-SCL-OUT  TO PV-EDIT-CLASS                         
P28545         MOVE PV-EDIT-DEPT       TO IN010-DEPT                            
P28545         MOVE PV-EDIT-CLASS      TO IN010-CLASS                           
P28545     ELSE                                                                 
P28545*** D.  NOT FOUND, LOOKUP AT THE CORPORATE UPC LEVEL.....                 
P28545         INITIALIZE IN400-PV-INPUT-AREA                                   
P28545                                                                          
P28545         MOVE IN010-SKU           TO PV-UPC-SKU2                          
P28545         MOVE PV-WORK-UPC2        TO DP040I-UPC-CODE                      
P28545         SET DP040I-COMP-CHECK-DIGIT-OPTION TO TRUE                       
P28545                                                                          
P28545         CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                              
P28545                            USING DP040I-UPC-CHECK-DIGIT-PARMS            
P28545                                                                          
P28545         MOVE DP040I-COMPUTED-UPC-CHK-DIGIT                               
P28545                                  TO PV-UPC-CHK-DIG2                      
P28545                                                                          
P28545         SET IN400-PV-UPC-NBR-ATTRIB-LOOK TO TRUE                         
P28545         MOVE IN010-STORE-NUMBER  TO IN400-PV-LOC-IN                      
P28545         MOVE INVPAR-PLND-INV-DTE TO IN400-PV-EFF-DTE-IN                  
P28545         MOVE PV-WORK-UPC2        TO IN400-PV-UPC-NBR-IN                  
P28545                                                                          
P28545         PERFORM IN400-LOOKUP-RETAIL                                      
P28545                                                                          
P28545         IF IN400-PV-DUMMY-SKU                                            
P28545             MOVE IN400-ATT-DEPT-OUT TO PV-EDIT-DEPT                      
Z28545             MOVE IN400-ATT-SCL-OUT  TO PV-EDIT-CLASS                     
P28545             MOVE PV-EDIT-DEPT       TO IN010-DEPT                        
P28545             MOVE PV-EDIT-CLASS      TO IN010-CLASS                       
P28545         ELSE                                                             
P28545         IF IN400-PV-ATT-FOUND                                            
P28545             MOVE IN400-ATT-DEPT-OUT TO PV-EDIT-DEPT                      
Z28545             MOVE IN400-ATT-SCL-OUT  TO PV-EDIT-CLASS                     
P28545             MOVE PV-EDIT-DEPT       TO IN010-DEPT                        
P28545             MOVE PV-EDIT-CLASS      TO IN010-CLASS                       
P28545         ELSE                                                             
P28545*** D.  INVALID KEY CONDITION..                                           
P28545             MOVE ZEROS          TO IN010-DEPT                            
P28545                                    IN010-CLASS                           
P28545         END-IF                                                           
P28545     END-IF.                                                              
P28545                                                                          
P28545*    PERFORM                                                              
P28545*        WITH TEST AFTER                                                  
P28545*        VARYING PV-SQL-SUB                                               
P28545*        FROM 1 BY 1                                                      
P28545*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES) OR                           
P28545*             (SQLCODE = +100) OR                                         
P28545*              (SQLCODE = 0)                                              
P28545*                                                                         
P28545*      MOVE IN010-SKU TO SKXREF-SKU                                       
P28545*      EXEC SQL                                                           
P28545*         SELECT DEPT,                                                    
P28545*                SUBCLASS                                                 
P28545*          INTO  :SKXREF-DEPT,                                            
P28545*                :SKXREF-SUBCLASS                                         
P28545*          FROM TSKXREF                                                   
P28545*          WHERE SKU = :SKXREF-SKU                                        
P28545*      END-EXEC                                                           
P28545*      EVALUATE TRUE                                                      
P28545*          WHEN SQLCODE = ZERO                                            
P28545*                 MOVE SKXREF-DEPT  TO  IN010-DEPT                        
P28545*                 MOVE SKXREF-SUBCLASS TO IN010-CLASS                     
P28545*          WHEN SQLCODE = +100                                            
P28545*                 PERFORM B520-SELECT-TUPC                                
P28545*          WHEN SQLCODE = -904                                            
P28545*          WHEN SQLCODE = -911                                            
P28545*                 CONTINUE                                                
P28545*          WHEN SQLWARN0 NOT = SPACES                                     
P28545*          WHEN SQLCODE < 0                                               
P28545*          WHEN SQLCODE > 0                                               
P28545*                 MOVE 'B505-SELECT-TSKXREF'                              
P28545*                       TO PV-PARAGRAPH-NAME                              
P28545*                 MOVE 'READ ON TSKXREF TABLE'                            
P28545*                       TO PV-DB2-OPER-ATTEMPTED                          
P28545*                 PERFORM Z900-SQL-ABEND                                  
P28545*      END-EVALUATE                                                       
P28545*    END-PERFORM.                                                         
P28545*    IF PV-SQL-SUB > PC-MAX-RETRIES                                       
P28545*         MOVE 'B505-SELECT-TSKXREF'  TO PV-PARAGRAPH-NAME                
P28545*         MOVE 'EXCEEDED MAX RETRIES' TO PV-DB2-OPER-ATTEMPTED            
P28545*         PERFORM Z900-SQL-ABEND                                          
P28545*    END-IF.                                                              
P28545*                                                                         
P28545*                                                                         
C21732*************************************************************             
C21732*  RETRIEVING DEPT/CLASS FROM TSKXREF TABLE (USING UPC NBR) *             
C21732*  MOVE ZEROES TO ATTRIBUTES IF UPC IS NOT FOUND            *             
C21732*************************************************************             
P28545 B506-SELECT-UPC.                                                         
P28545                                                                          
P28545     INITIALIZE IN400-PV-INPUT-AREA.                                      
P28545                                                                          
P28545     SET IN400-PV-UPC-NBR-ATTRIB-LOOK TO TRUE.                            
P28545     MOVE IN010-STORE-NUMBER  TO IN400-PV-LOC-IN.                         
P28545     MOVE INVPAR-PLND-INV-DTE TO IN400-PV-EFF-DTE-IN.                     
P28545                                                                          
P28545     MOVE IN010-UPC-CODE        TO PV-EDIT-UPC-CODE                       
P28545     MOVE PV-EDIT-UPC-CODE-ALPH TO IN400-PV-UPC-NBR-IN                    
P28545                                                                          
P28545     PERFORM IN400-LOOKUP-RETAIL.                                         
P28545                                                                          
P28545*** A.  ZERO SEQUENCE SKU.                                                
P28545*** B.  RENUMBER SKU.                                                     
P28545*** C.  REGULAR SKU.                                                      
P28545     IF IN400-PV-DUMMY-SKU                                                
P28545         MOVE IN400-ATT-DEPT-OUT TO PV-EDIT-DEPT                          
Z28545         MOVE IN400-ATT-SCL-OUT  TO PV-EDIT-CLASS                         
P28545         MOVE PV-EDIT-DEPT       TO IN010-DEPT                            
P28545         MOVE PV-EDIT-CLASS      TO IN010-CLASS                           
P28545     ELSE                                                                 
P28545     IF IN400-PV-ATT-FOUND                                                
P28545         MOVE IN400-ATT-DEPT-OUT TO PV-EDIT-DEPT                          
Z28545         MOVE IN400-ATT-SCL-OUT  TO PV-EDIT-CLASS                         
P28545         MOVE PV-EDIT-DEPT       TO IN010-DEPT                            
P28545         MOVE PV-EDIT-CLASS      TO IN010-CLASS                           
P28545     ELSE                                                                 
P28545*** D.  INVALID KEY CONDITION..                                           
P28545         MOVE ZEROS              TO IN010-DEPT                            
P28545                                    IN010-CLASS                           
P28545     END-IF.                                                              
P28545                                                                          
P28545*    PERFORM                                                              
P28545*        WITH TEST AFTER                                                  
P28545*        VARYING PV-SQL-SUB                                               
P28545*        FROM 1 BY 1                                                      
P28545*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES) OR                           
P28545*             (SQLCODE = +100) OR                                         
P28545*              (SQLCODE = 0)                                              
P28545*                                                                         
P28545*      EXEC SQL                                                           
P28545*         SELECT DEPT,                                                    
P28545*                SUBCLASS                                                 
P28545*          INTO  :SKXREF-DEPT,                                            
P28545*                :SKXREF-SUBCLASS                                         
P28545*          FROM TSKXREF A,                                                
P28545*               TUPCSKU B                                                 
P28545*          WHERE B.UPC_NBR = :TUPCSKU-UPC-NBR                             
P28545*            AND B.ITEM_NBR = A.ITM_NBR                                   
P28545*      END-EXEC                                                           
P28545*      EVALUATE TRUE                                                      
P28545*          WHEN SQLCODE = ZERO                                            
P28545*                 MOVE SKXREF-DEPT  TO  IN010-DEPT                        
P28545*                 MOVE SKXREF-SUBCLASS TO IN010-CLASS                     
P28545*          WHEN SQLCODE = +100                                            
P28545*                 MOVE ZEROES TO IN010-DEPT                               
P28545*                 MOVE ZEROES TO IN010-CLASS                              
P28545*          WHEN SQLCODE = -904                                            
P28545*          WHEN SQLCODE = -911                                            
P28545*                 CONTINUE                                                
P28545*          WHEN SQLWARN0 NOT = SPACES                                     
P28545*          WHEN SQLCODE < 0                                               
P28545*          WHEN SQLCODE > 0                                               
P28545*                 MOVE 'B506-SELECT-TUPCSKU'                              
P28545*                       TO PV-PARAGRAPH-NAME                              
P28545*                 MOVE 'READ TSKXREF/TUPCSKU TABLE'                       
P28545*                       TO PV-DB2-OPER-ATTEMPTED                          
P28545*                 PERFORM Z900-SQL-ABEND                                  
P28545*      END-EVALUATE                                                       
P28545*    END-PERFORM.                                                         
P28545*    IF PV-SQL-SUB > PC-MAX-RETRIES                                       
P28545*         MOVE 'B506-SELECT-TUPCSKU'  TO PV-PARAGRAPH-NAME                
P28545*         MOVE 'EXCEEDED MAX RETRIES' TO PV-DB2-OPER-ATTEMPTED            
P28545*         PERFORM Z900-SQL-ABEND                                          
P28545*    END-IF.                                                              
P28545*                                                                         
      ******************************************************************        
      *   SEARCH AFTER-INV STORE TABLE                                          
      ******************************************************************        
       B510-DET-AFTER-INV-STORE.                                                
           IF IN018-STORE-NUMBER = PV-AFT-INV-STORE(PV-STORE-SUB)               
               SET PS-AFT-INV-STORE-FOUND TO TRUE.                              
                                                                                
                                                                                
P28545*************************************************************             
P28545*  RETRIEVING SUB CL MDSEAR ID AND VS ID FROM TUPC TABLE.   *             
P28545*************************************************************             
P28545*B520-SELECT-TUPC.                                                        
P28545*                                                                         
P28545*    PERFORM                                                              
P28545*        WITH TEST AFTER                                                  
P28545*        VARYING PV-SQL-SUB                                               
P28545*        FROM 1 BY 1                                                      
P28545*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES) OR                           
P28545*              (SQLCODE = +100) OR                                        
P28545*              (SQLCODE = 0)                                              
P28545*                                                                         
P28545*      INITIALIZE DCLTUPC                                                 
P28545*      MOVE SKXREF-SKU       TO PV-UPC-SKU-MIN                            
P28545*                               PV-UPC-SKU-MAX                            
P28545*      MOVE PV-SIGN-UPC-MIN  TO PV-MDSEAR-UPC-MIN                         
P28545*      MOVE PV-SIGN-UPC-MAX  TO PV-MDSEAR-UPC-MAX                         
P28545*                                                                         
P28545*      EXEC SQL                                                           
P28545*         SELECT                                                          
P28545*                SUB_CL_MDSEAR_ID                                         
P28545*              , VS_ID                                                    
P28545*          INTO                                                           
P28545*                :UPC-SUB-CL-MDSEAR-ID                                    
P28545*              , :UPC-VS-ID                                               
P28545*          FROM                                                           
P28545*                TUPC                                                     
P28545*          WHERE                                                          
P28545*                UPC_NBR BETWEEN                                          
P28545*                :PV-MDSEAR-UPC-MIN AND :PV-MDSEAR-UPC-MAX                
P28545*      END-EXEC                                                           
P28545*                                                                         
P28545*      EVALUATE TRUE                                                      
P28545*          WHEN SQLCODE = ZERO                                            
P28545*                 PERFORM B530-SELECT-TMDARVS                             
P28545*          WHEN SQLCODE = +100                                            
P28545*                 MOVE ZEROS TO IN010-DEPT                                
P28545*                               IN010-CLASS                               
P28545*          WHEN SQLCODE = -904                                            
P28545*          WHEN SQLCODE = -911                                            
P28545*                 CONTINUE                                                
P28545*          WHEN SQLWARN0 NOT = SPACES                                     
P28545*          WHEN SQLCODE < 0                                               
P28545*          WHEN SQLCODE > 0                                               
P28545*                 MOVE 'B520-SELECT-TUPC'                                 
P28545*                       TO PV-PARAGRAPH-NAME                              
P28545*                 MOVE 'READ ON TUPC TABLE'                               
P28545*                       TO PV-DB2-OPER-ATTEMPTED                          
P28545*                 PERFORM Z900-SQL-ABEND                                  
P28545*      END-EVALUATE                                                       
P28545*    END-PERFORM.                                                         
P28545*                                                                         
P28545*    IF PV-SQL-SUB > PC-MAX-RETRIES                                       
P28545*         MOVE 'B520-SELECT-TUPC'     TO PV-PARAGRAPH-NAME                
P28545*         MOVE 'EXCEEDED MAX RETRIES' TO PV-DB2-OPER-ATTEMPTED            
P28545*         PERFORM Z900-SQL-ABEND                                          
P28545*    END-IF.                                                              
P28545*************************************************************             
P28545*  RETRIEVING DEPT AND CLASS FROM TMDARVS TABLE.            *             
P28545*************************************************************             
P28545*B530-SELECT-TMDARVS.                                                     
P28545*                                                                         
P28545*    PERFORM                                                              
P28545*        WITH TEST AFTER                                                  
P28545*        VARYING PV-SQL-SUB                                               
P28545*        FROM 1 BY 1                                                      
P28545*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES) OR                           
P28545*              (SQLCODE = 100)  OR                                        
P28545*              (SQLCODE = 0)                                              
P28545*                                                                         
P28545*      INITIALIZE DCLTMDARVS                                              
P28545*      MOVE UPC-SUB-CL-MDSEAR-ID TO MDARVS-SUB-CL-MDSEAR-ID               
P28545*      MOVE UPC-VS-ID            TO MDARVS-VS-ID                          
P28545*                                                                         
P28545*      EXEC SQL                                                           
P28545*           SELECT                                                        
P28545*                  DEPT_NBR                                               
P28545*                , SUB_CL_NBR                                             
P28545*             INTO                                                        
P28545*                  :MDARVS-DEPT-NBR                                       
P28545*                , :MDARVS-SUB-CL-NBR                                     
P28545*             FROM                                                        
P28545*                  TMDARVS                                                
P28545*            WHERE                                                        
P28545*                  SUB_CL_MDSEAR_ID = :MDARVS-SUB-CL-MDSEAR-ID            
P28545*              AND VS_ID            = :MDARVS-VS-ID                       
P28545*      END-EXEC                                                           
P28545*                                                                         
P28545*      EVALUATE TRUE                                                      
P28545*          WHEN SQLCODE = ZERO                                            
P28545*                 MOVE MDARVS-DEPT-NBR   TO SKXREF-DEPT                   
P28545*                 MOVE MDARVS-SUB-CL-NBR TO SKXREF-SUBCLASS               
P28545*          WHEN SQLCODE = +100                                            
P28545*                 MOVE ZEROS TO IN010-DEPT                                
P28545*                               IN010-CLASS                               
P28545*          WHEN SQLCODE = -904                                            
P28545*          WHEN SQLCODE = -911                                            
P28545*                 CONTINUE                                                
P28545*          WHEN SQLWARN0 NOT = SPACES                                     
P28545*          WHEN SQLCODE < 0                                               
P28545*          WHEN SQLCODE > 0                                               
P28545*                 MOVE 'B530-SELECT-TMDARVS'                              
P28545*                       TO PV-PARAGRAPH-NAME                              
P28545*                 MOVE 'READ ON TMDARVS TABLE'                            
P28545*                       TO PV-DB2-OPER-ATTEMPTED                          
P28545*                 PERFORM Z900-SQL-ABEND                                  
P28545*      END-EVALUATE                                                       
P28545*    END-PERFORM.                                                         
P28545*                                                                         
P28545*    IF PV-SQL-SUB > PC-MAX-RETRIES                                       
P28545*         MOVE 'B530-SELECT-TMDARVS'  TO PV-PARAGRAPH-NAME                
P28545*         MOVE 'EXCEEDED MAX RETRIES' TO PV-DB2-OPER-ATTEMPTED            
P28545*         PERFORM Z900-SQL-ABEND                                          
P28545*    END-IF.                                                              
P28545*                                                                         
      ******************************************************************        
      *   CLOSE ALL FILES.                                                      
      ******************************************************************        
       B600-CLOSE-FILES.                                                        
                                                                                
           CLOSE   IN-COUNT-FILE                                                
                   IN-AFT-INV-STORES-CC                                         
                   INVALID-RANGE-FILE                                           
                   STORE-CONTROL-FILE                                           
                   ERROR-REPORT-FILE                                            
0300RM             STORE-ERROR-FILE                                             
                   OUT-COUNT-FILE.                                              
      *                                                                         
      ****************************************************************          
      *                                                                         
      *                                                                         
      ****************************************************************          
       C100-EDIT-RECORD.                                                        
      *                                                                         
      *    MULITPLE STORES IN THE SHEET INVENTORIES WILL ASSUME TO              
      *    TO BE KEYING ERRORS AND THE PROGRAM WILL CORRECT THEM                
      * * * * *                                                                 
           IF IN018-STORE-NUMBER-X IS NOT EQUAL TO SA-STORE-NUMBER              
JS0498         IF PS-SCANNING-STORE                                             
                   MOVE MSG-MULTIPLE-STORES TO D1-ERROR-HOLD                    
                   ADD 1 TO PA-ERROR-COUNT                                      
                   PERFORM E100-INVALID-DATA                                    
               END-IF.                                                          
                                                                                
           IF IN018-STORE-NUMBER-X IS NOT NUMERIC                               
               MOVE MSG-BAD-STORE TO D1-ERROR-HOLD                              
               ADD 1 TO PA-ERROR-COUNT                                          
               PERFORM E100-INVALID-DATA                                        
           END-IF.                                                              
                                                                                
           IF IN018-AREA-NUMBER-X IS NOT NUMERIC                                
               MOVE MSG-BAD-SHEET TO D1-ERROR-HOLD                              
               ADD 1 TO PA-ERROR-COUNT                                          
               PERFORM E100-INVALID-DATA                                        
           END-IF.                                                              
                                                                                
           IF IN018-LINE-NUMBER-X IS NOT NUMERIC                                
               MOVE MSG-BAD-LINE  TO D1-ERROR-HOLD                              
               ADD 1 TO PA-ERROR-COUNT                                          
               PERFORM E100-INVALID-DATA                                        
           END-IF.                                                              
                                                                                
W21732     IF IN018-SKU-X IS NOT NUMERIC                                        
               MOVE MSG-BAD-SEQUENCE   TO D1-ERROR-HOLD                         
               ADD 1 TO PA-ERROR-COUNT                                          
               PERFORM E100-INVALID-DATA                                        
           END-IF.                                                              
                                                                                
           IF IN018-QUANTITY-X IS NOT NUMERIC                                   
               MOVE MSG-BAD-QUANTITY TO D1-ERROR-HOLD                           
               ADD 1 TO PA-ERROR-COUNT                                          
               PERFORM E100-INVALID-DATA                                        
           ELSE                                                                 
               ADD IN018-QUANTITY TO PV-QUANTITY                                
           END-IF.                                                              
                                                                                
           IF IN018-PRICE-X IS NOT NUMERIC                                      
               ADD 1 TO PA-ERROR-COUNT                                          
               MOVE MSG-BAD-PRICE TO D1-ERROR-HOLD                              
               PERFORM E100-INVALID-DATA                                        
           ELSE                                                                 
               IF IN018-QUANTITY-X IS NOT NUMERIC                               
                   CONTINUE                                                     
               ELSE                                                             
                   COMPUTE PV-EXT-RETAIL = IN018-PRICE * IN018-QUANTITY         
                   ADD PV-EXT-RETAIL TO PV-RETAIL                               
           END-IF.                                                              
                                                                                
           IF IN018-UPC-CODE-X IS NOT NUMERIC                                   
               MOVE MSG-BAD-UPC TO D1-ERROR-HOLD                                
               ADD 1 TO PA-ERROR-COUNT                                          
               PERFORM E100-INVALID-DATA                                        
           END-IF.                                                              
                                                                                
           IF IN018-UPC-CODE-X = ZERO AND                                       
              IN018-SKU = ZERO                                                  
               IF PS-SCANNING-STORE                                             
                   MOVE MSG-NO-UPC-OR-SKU TO D1-ERROR-HOLD                      
                   ADD 1 TO PA-ERROR-COUNT                                      
                   PERFORM E100-INVALID-DATA                                    
               ELSE                                                             
                   IF IN018-BLANK-SHEET                                         
                       CONTINUE                                                 
                   ELSE                                                         
                       MOVE MSG-NO-UPC-OR-SKU TO D1-ERROR-HOLD                  
                       ADD 1 TO PA-ERROR-COUNT                                  
                       PERFORM E100-INVALID-DATA                                
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  IN018-AREA-NUMBER-X  = ZERO                                      
               IF PS-SCANNING-STORE                                             
                   MOVE MSG-ZERO-AREA      TO D1-ERROR-HOLD                     
               ELSE                                                             
                   MOVE MSG-ZERO-SHEET     TO D1-ERROR-HOLD                     
               END-IF                                                           
               ADD 1 TO PA-ERROR-COUNT                                          
               PERFORM E100-INVALID-DATA                                        
           END-IF.                                                              
                                                                                
           IF (IN018-LINE-NUMBER-X = ZERO) AND                                  
              (PS-SCANNING-STORE)                                               
               MOVE MSG-ZERO-LINE      TO D1-ERROR-HOLD                         
               ADD 1 TO PA-ERROR-COUNT                                          
               PERFORM E100-INVALID-DATA                                        
           END-IF.                                                              
                                                                                
           IF IN018-AREA-NUMBER-X = SA-SHEET-NUMBER                             
               ADD 1 TO PA-LINE-NUMBER                                          
           ELSE                                                                 
               MOVE 1 TO PA-LINE-NUMBER                                         
               MOVE IN018-AREA-NUMBER-X TO SA-SHEET-NUMBER                      
           END-IF.                                                              
                                                                                
JS0498*    AN EDIT CHECK HAS BEEN ADDED TO VERIFY THE "BATCH" OF DATA           
      *    FOR THE STORE DOES NOT CONTAIN SEQUENCE NUMBERS OF ALL               
      *    000/999                                                              
JS0498                                                                          
JS0498     IF PS-AFT-INV-KEYING-STORE                                           
JS0498         IF PS-SEQ-000999                                                 
W21732             IF IN018-SKU (6:3) = 000 OR 999                              
JS0498                 CONTINUE                                                 
JS0498             ELSE                                                         
JS0498                 SET PS-SEQ-MIX TO TRUE                                   
JS0498             END-IF                                                       
JS0498         ELSE                                                             
JS0498             IF PS-SEQ-VALID                                              
W21732                 IF IN018-SKU (6:3) = 000 OR 999                          
JS0498                     SET PS-SEQ-MIX TO TRUE                               
JS0498                 ELSE                                                     
JS0498                     CONTINUE                                             
JS0498                 END-IF                                                   
JS0498             ELSE                                                         
JS0498                 IF PS-SEQ-FIRST                                          
W21732                     IF IN018-SKU (6:3) = 000 OR 999                      
JS0498                         SET PS-SEQ-000999 TO TRUE                        
JS0498                     ELSE                                                 
JS0498                         SET PS-SEQ-VALID TO TRUE                         
JS0498                     END-IF                                               
JS0498                 END-IF                                                   
JS0498             END-IF                                                       
JS0498         END-IF                                                           
JS0498     END-IF.                                                              
                                                                                
0300RM*    IF (IN018-SCAN-DTE = ZERO) AND                                       
0300RM*       (IN018-SCAN-TIMESTAMP > ZERO)                                     
0300RM*        SET PS-INVALID-DATE TO TRUE                                      
0300RM*        MOVE MSG-INV-DATE-TIME  TO D1-ERROR-HOLD                         
0300RM*        ADD 1 TO PA-ERROR-COUNT                                          
0300RM*        PERFORM E100-INVALID-DATA                                        
0300RM*    END-IF.                                                              
0300RM*                                                                         
0300RM*    IF (IN018-SCAN-DTE > ZERO) AND                                       
0300RM*       (IN018-SCAN-TIMESTAMP = ZERO)                                     
JS0699*        ADD 1 TO PA-ZERO-TIMESTAMP                                       
0300RM*    END-IF.                                                              
0300RM*---COMMENT OUT THE FOLLOWING LOGIC RELATED TO DATE AND                   
0300RM*---TIMESTAMP                                                             
      *    **********************************************************           
JS0699*    WHEN MORE THE 50 TIMESTAMPS ARE EQUAL TO ZERO THE FILE WILL          
JS0699*    ERROR OUT                                                            
      *    **********************************************************           
JS0699*    IF PA-ZERO-TIMESTAMP > 50 AND PS-FIRST-TIME                          
0300RM*        SET PS-INVALID-DATE TO TRUE                                      
0300RM*        SET PS-NOT-FIRST-TIME TO TRUE                                    
0300RM*        MOVE MSG-ZERO-TIME-LIMIT TO D1-ERROR-HOLD                        
0300RM*        ADD 1 TO PA-ERROR-COUNT                                          
0300RM*        PERFORM E100-INVALID-DATA                                        
0300RM*    END-IF.                                                              
0300RM*                                                                         
0300RM*    IF (IN018-SCAN-DTE = ZERO) AND                                       
0300RM*       (IN018-SCAN-TIMESTAMP = ZERO) AND                                 
0300RM*       (PS-SCANNING-STORE)                                               
0300RM*        SET PS-INVALID-DATE TO TRUE                                      
0300RM*        MOVE MSG-INV-DATE-TIME  TO D1-ERROR-HOLD                         
0300RM*        ADD 1 TO PA-ERROR-COUNT                                          
0300RM*        PERFORM E100-INVALID-DATA                                        
0300RM*    END-IF.                                                              
0300RM*                                                                         
0300RM*    IF PS-VALID-TIME                                                     
0300RM*       MOVE IN018-SCAN-TIMESTAMP   TO WS-SCAN-TIMESTAMP                  
JS0599*       IF (WS-SCAN-TIME-HH <= 24) AND                                    
0300RM*          (WS-SCAN-TIME-MM <= 59) AND                                    
0300RM*          (WS-SCAN-TIME-SS <= 59)                                        
0300RM*          CONTINUE                                                       
0300RM*       ELSE                                                              
0300RM*           MOVE MSG-INV-TIME       TO D1-ERROR-HOLD                      
0300RM*           ADD 1 TO PA-ERROR-COUNT                                       
0300RM*           PERFORM E100-INVALID-DATA                                     
0300RM*       END-IF                                                            
0300RM*    ELSE                                                                 
0300RM*       MOVE 'N'                  TO PS-INVALID-TIME-SW                   
0300RM*    END-IF.                                                              
                                                                                
      *    IT IS A VALID COMBINATION IF THE DATE AND TIMESTAMP ARE              
      *    BOTH ZERO.                                                           
      *    THE DATE EDIT WILL NOT BE PERFORMED IF IT HAS BEEN PRE-              
      *    DETERMINED THAT THE DATE IS INVALID.                                 
0300RM*    IF ((IN018-SCAN-DTE = ZERO) AND                                      
0300RM*       (IN018-SCAN-TIMESTAMP = ZERO)) OR                                 
0300RM*       (PS-INVALID-DATE)                                                 
0300RM*       MOVE 'N'                  TO PS-INVALID-DATE-SW                   
0300RM*    ELSE                                                                 
0300RM*       IF PV-CC IS NUMERIC                                               
0300RM*          MOVE PV-CC             TO WS-DATE-CC                           
0300RM*       END-IF                                                            
0300RM*       IF PV-YY IS NUMERIC                                               
0300RM*          MOVE PV-YY             TO WS-DATE-YY                           
0300RM*       END-IF                                                            
0300RM*                                                                         
0300RM*       MOVE IN018-SCAN-DTE       TO WS-SCAN-DATE                         
0300RM*                                                                         
0300RM*       INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                    
0300RM*       MOVE WS-CALENDAR-TYPE     TO  DPG51-CALENDAR-TYPE                 
0300RM*       SET DPG52-LK-DTE-GREG-CC  TO  TRUE                                
0300RM*                                                                         
0300RM*       MOVE  WS-SCAN-DATE-MM     TO  DPG52-GREG-CC-DATE-MO               
0300RM*       MOVE  WS-SCAN-DATE-DD     TO  DPG52-GREG-CC-DATE-DY               
0300RM*       MOVE  WS-DATE-CCYY        TO  DPG52-GREG-CC-DATE-YR               
0300RM*                                                                         
0300RM*       CALL PC-CALENDAR-MODULE USING DPG51                               
0300RM*                                     DPG52                               
0300RM*                                     DPG53                               
0300RM*                                     DPG54                               
0300RM*                                     DPG55                               
0300RM*                                     DPG56                               
0300RM*       IF (DPG54-DATE-VALID                                              
0300RM*       AND DPG54-NO-ERROR)                                               
0300RM*           CONTINUE                                                      
0300RM*       ELSE                                                              
0300RM*           MOVE MSG-INV-DATE       TO D1-ERROR-HOLD                      
0300RM*           ADD 1 TO PA-ERROR-COUNT                                       
0300RM*           PERFORM E100-INVALID-DATA                                     
0300RM*       END-IF                                                            
0300RM*    END-IF.                                                              
                                                                                
      ****************************************************************          
      *                                                                         
      *                                                                         
      ****************************************************************          
       E100-INVALID-DATA.                                                       
                                                                                
           IF PC-LINE-COUNT > PC-LINE-MAX                                       
               PERFORM F100-CREATE-HEADINGS                                     
           END-IF.                                                              
                                                                                
           MOVE PA-STORE-RECORD-NUM TO D1-RECORD-COUNT.                         
           MOVE D1-DETAIL TO ERROR-REPORT-LINE.                                 
           MOVE 2 TO PC-ADVANCE.                                                
           PERFORM Z800-WRITE-REPORT-LINE.                                      
                                                                                
      ****************************************************************          
      *                                                                         
      *                                                                         
      ****************************************************************          
       E200-WRITE-TOTAL-MESSAGE.                                                
           IF PC-LINE-COUNT > PC-LINE-MAX                                       
               PERFORM F100-CREATE-HEADINGS                                     
           END-IF.                                                              
           MOVE SA-STORE-NUMBER TO D2-STORE.                                    
           IF PS-STORE-NOT-OK                                                   
               MOVE 1 TO D2-TOTAL-ERRS                                          
           ELSE                                                                 
               MOVE PA-ERROR-COUNT TO D2-TOTAL-ERRS                             
           END-IF.                                                              
           MOVE D2-DETAIL TO ERROR-REPORT-LINE.                                 
           MOVE 2 TO PC-ADVANCE.                                                
           PERFORM Z800-WRITE-REPORT-LINE.                                      
           DISPLAY '    STORE ' SA-STORE-NUMBER ' DATA IS INVALID - '           
               'STORE IS ERRORING OUT'.                                         
                                                                                
0300RM*** WRITE OUT ERROR FILE HERE                                             
                                                                                
0300RM     IF PS-FIRST-STORE-ERROR                                              
0300RM         WRITE STORE-ERROR-RECORD FROM PV-DATASET-HEADER1                 
0300RM         WRITE STORE-ERROR-RECORD FROM PV-DATASET-HEADER2                 
0300RM         MOVE 'N' TO PS-FIRST-STORE-ERROR-SW                              
0300RM     END-IF.                                                              
25248      MOVE SA-STORE-NUMBER      TO SE-STORE-NUMBER.                        
25248      MOVE XMT00001-LOC-NM      TO SE-STORE-NAME.                          
0300RM     WRITE  STORE-ERROR-RECORD FROM SE-DATA-AREA.                         
                                                                                
      ****************************************************************          
      * THIS ROUTINE WILL PRODUCE THE REPORT                                    
      * HEADING IF AN ERROR REPORT IS PRODUCED.                                 
      ****************************************************************          
       F100-CREATE-HEADINGS.                                                    
                                                                                
           ADD 1 TO PC-PAGE.                                                    
           MOVE PC-PAGE TO DP132O-PAGE-NUMBER.                                  
           MOVE DP132O-STANDRD-HEADER-132-COLS TO ERROR-REPORT-LINE.            
           WRITE ERROR-REPORT-LINE                                              
               AFTER ADVANCING PAGE.                                            
           MOVE 1 TO PC-ADVANCE                                                 
           MOVE 2 TO PC-LINE-COUNT.                                             
           MOVE H1-HEADING TO ERROR-REPORT-LINE.                                
           PERFORM Z800-WRITE-REPORT-LINE.                                      
           MOVE 2 TO PC-ADVANCE.                                                
           MOVE H2-HEADING TO ERROR-REPORT-LINE.                                
           PERFORM Z800-WRITE-REPORT-LINE.                                      
      *                                                                         
      ****************************************************************          
      * Z100-READ-PHYCNT-INPUT  READS THE INPUT FILE                            
      ****************************************************************          
       Z100-READ-PHYSCNT-INPUT.                                                 
                                                                                
           READ IN-COUNT-FILE                                                   
                 AT END                                                         
                   MOVE 'Y' TO PS-END-OF-INVENTORY.                             
                                                                                
           INITIALIZE IN018-INVENTORY-COUNT-RECORD.                             
           MOVE IN-COUNT-RECORD TO IN018-INVENTORY-COUNT-RECORD.                
      *                                                                         
      ****************************************************************          
      * READS THE STORES ON THE AFTER-INV-STORE-CONTROL-CARD                    
      ****************************************************************          
JS0398 Z150-READ-AFT-INV-STORE-CC.                                              
                                                                                
           READ IN-AFT-INV-STORES-CC INTO CC-AFT-INV-STORES                     
                 AT END                                                         
                   MOVE 'Y' TO PS-END-OF-AFT-INV-STORE-IND.                     
                                                                                
           IF PS-END-OF-AFT-INV-STORE-CC                                        
               CONTINUE                                                         
           ELSE                                                                 
               IF PV-STORE-SUB > PC-MAX-AFT-INV-STORES                          
                   MOVE +4008                 TO ABEND-CODE                     
                   DISPLAY '**  ABEND     **'                                   
                   DISPLAY '**  PROGRAM   **  =  INKUT101'                      
                   DISPLAY '**  '                                               
                   DISPLAY '**  '                                               
                   DISPLAY                                                      
                    'PGM CAN PROCESS ONLY 25 "AFTER-INV" STORES'                
                   DISPLAY '**  '                                               
                   DISPLAY '**  '                                               
                   CALL 'ILBOABN0'  USING ABEND-CODE                            
               ELSE                                                             
                   MOVE CC-STORE TO PV-AFT-INV-STORE(PV-STORE-SUB).             
      *                                                                         
      ****************************************************************          
      *  STORE TABLE IS READ FOR STORE NUMBER VERIFICATION.                     
      ****************************************************************          
       Z200-READ-STORE-TABLE.                                                   
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES) OR                           
                     (SQLCODE = +100) OR                                        
                     (SQLCODE = 0)                                              
                                                                                
25248          MOVE SA-STORE-NUMBER-NUM TO PV-EDIT-LOC-NBR                      
  |            MOVE PV-EDIT-LOC-NBR     TO XMT00001-LOC-NBR                     
  |                                                                             
  |            EXEC SQL                                                         
  |               SELECT LOC_NM,                                                
  |                      LOC_NBR                                                
  |               INTO :XMT00001-LOC-NM,                                        
  |                    :XMT00001-LOC-NBR                                        
  |                FROM XMT_LOC                                                 
  |               WHERE LOC_NBR = :XMT00001-LOC-NBR                             
  |            END-EXEC                                                         
25248                                                                           
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +100                                          
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = ZERO                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < 0                                             
                   WHEN SQLCODE > 0                                             
                        MOVE 'Z200-READ-STORE-TABLE'                            
                              TO PV-PARAGRAPH-NAME                              
                        MOVE 'READ ON STORE TABLE'                              
                              TO PV-DB2-OPER-ATTEMPTED                          
                        PERFORM Z900-SQL-ABEND                                  
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-SQL-SUB > PC-MAX-RETRIES                                       
                MOVE 'Z200-READ-STORE-TABLE'  TO PV-PARAGRAPH-NAME              
                MOVE 'EXCEEDED MAX RETRIES' TO PV-DB2-OPER-ATTEMPTED            
                PERFORM Z900-SQL-ABEND                                          
           END-IF.                                                              
                                                                                
      *                                                                         
      ******************************************************************        
      *    OPEN THE CURSOR WHICH WILL RETRIEVE ALL ROWS FROM THE INV            
      *    PARAMETERS TABLE FOR THE STORE ON THE INPUT FILE.                    
      ******************************************************************        
       Z300-OPEN-INV-PARMS-CURSOR.                                              
                                                                                
           INITIALIZE DCLTINVPAR.                                               
                                                                                
W26600     IF SA-STORE-NUMBER-NUM NUMERIC                                       
W26600         MOVE SA-STORE-NUMBER-NUM                                         
W26600                             TO INVPAR-LOC-NBR                            
W26600     ELSE                                                                 
W26600         MOVE ZEROS          TO INVPAR-LOC-NBR                            
W26600     END-IF.                                                              
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
                         OR SQLCODE = 0                                         
                         OR SQLCODE = +100)                                     
                                                                                
               EXEC SQL                                                         
                   OPEN INV_PARMS_CURSOR                                        
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN SQLCODE = +100                                          
                       SET PS-NO-INVPAR-REC-EXISTS TO TRUE                      
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                       MOVE 'Z300-OPEN-INV-PARMS-CURSOR'                        
                                     TO  PV-PARAGRAPH-NAME                      
                       MOVE 'OPEN ON CURSOR'                                    
                                     TO  PV-DB2-OPER-ATTEMPTED                  
                       PERFORM Z900-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                                
               MOVE 'Z300-OPEN-INV-PARMS-CURSOR'                                
                                     TO  PV-PARAGRAPH-NAME                      
               MOVE 'OPEN RETRIES EXCEEDED'                                     
                                     TO  PV-DB2-OPER-ATTEMPTED                  
               PERFORM Z900-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      *    FETCH THE NEXT ROW OF THE CURSOR.                                    
      ******************************************************************        
       Z400-FETCH-INV-PARMS-ROW.                                                
                                                                                
           EXEC SQL                                                             
               FETCH INV_PARMS_CURSOR                                           
               INTO  :INVPAR-ACTL-INV-DTE,                                      
                     :INVPAR-PLND-INV-DTE,                                      
                     :INVPAR-ACTL-INV-RECD-DTE,                                 
                     :INVPAR-SCAN-INV-IND,                                      
                     :INVPAR-ACTL-UNIT-BK-DTE,                                  
                     :INVPAR-ITM-CTOFF-IND,                                     
                     :INVPAR-ACTL-FIN-BK-DTE                                    
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = +100                                                    
               SET PS-NO-INVPAR-REC-EXISTS TO TRUE                              
           ELSE                                                                 
               IF SQLCODE NOT = 0                                               
                    MOVE 'Z400-FETCH-INV-PARMS-ROW'                             
                                             TO PV-PARAGRAPH-NAME               
                    MOVE 'FETCH ROW FROM CURSOR'                                
                                            TO PV-DB2-OPER-ATTEMPTED            
                   PERFORM Z900-SQL-ABEND                                       
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      *    CLOSE THE INVENTORY PARAMTERS CURSOR.                                
      ******************************************************************        
       Z500-CLOSE-INV-PARMS-CURSOR.                                             
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
                         OR SQLCODE = 0                                         
                         OR SQLCODE = +100)                                     
                                                                                
               EXEC SQL                                                         
                   CLOSE INV_PARMS_CURSOR                                       
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = +100                                          
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                       MOVE 'Z500-CLOSE-INV-PARMS-CURSOR'                       
                                     TO  PV-PARAGRAPH-NAME                      
                       MOVE 'CLOSE ON CURSOR'                                   
                                     TO  PV-DB2-OPER-ATTEMPTED                  
                       PERFORM Z900-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                                
               MOVE 'Z500-CLOSE-INV-PARMS-CURSOR'                               
                                     TO  PV-PARAGRAPH-NAME                      
               MOVE 'CLOSE RETRIES EXCEEDED'                                    
                                     TO  PV-DB2-OPER-ATTEMPTED                  
               PERFORM Z900-SQL-ABEND                                           
           END-IF.                                                              
098500****************************************************************  09850000
098600*                                                                 09860000
098700****************************************************************  09870000
098800 Z600-WRITE-NEW-PHYSCNT-RECORD.                                   09880000
098900                                                                  09890000
099000     WRITE OUT-COUNT-RECORD                                       09900000
099100         FROM IN010-INVENTORY-COUNT-RECORD.                       09910000
099200*                                                                 09920000
099300****************************************************************  09930000
099400*                                                                 09940000
099500****************************************************************  09950000
099600 Z700-WRITE-RANGE-RECORD.                                         09960000
099700                                                                  09970000
099800     IF PS-RETRY-STORE                                            09980000
099900         MOVE 'Y' TO PV-RETRY-IND                                 09990000
100000     ELSE                                                         10000000
100100         MOVE SPACE TO PV-RETRY-IND                               10010000
100200     END-IF.                                                      10020000
100300                                                                  10030000
100400     WRITE INVALID-RANGE-RECORD                                   10040000
100500         FROM PV-INVALID-RANGE.                                   10050000
100600*                                                                 10060000
100700****************************************************************  10070000
100800*                                                                 10080000
100900****************************************************************  10090000
101000 Z750-WRITE-STORE-CONTROL-REC.                                    10100000
101100                                                                  10110000
0300RM                                                                          
0300RM     MOVE SPACES TO IN004-INVENTORY-COUNT-RECORD.                         
0300RM     IF INVPAR-SCAN-INV-IND = 'N'                                         
0300RM         MOVE 'S'          TO IN004-PROCESS-TYPE                          
0300RM         MOVE 'DC SHEET  ' TO IN004-DATA-TYPE                             
0300RM     ELSE                                                                 
0300RM         IF INVPAR-SCAN-INV-IND = 'Y'                                     
0300RM             IF PS-AFT-INV-STORE-FOUND                                    
0300RM                 MOVE 'S'      TO IN004-PROCESS-TYPE                      
0300RM                 MOVE 'STR SHEET ' TO IN004-DATA-TYPE                     
0300RM             ELSE                                                         
0300RM                 MOVE 'N'      TO IN004-PROCESS-TYPE                      
0300RM                 MOVE 'STR SCAN  ' TO IN004-DATA-TYPE                     
0300RM             END-IF                                                       
0300RM         END-IF                                                           
0300RM     END-IF.                                                              
W26600     MOVE SA-STORE-NUMBER    TO IN004-STR-NBR.                            
101200     WRITE STORE-CONTROL-RECORD                                   10120000
0300RM         FROM IN004-INVENTORY-COUNT-RECORD.                       10130000
0300RM*        FROM SA-STORE-NUMBER.                                    10130000
101400     DISPLAY '    STORE ' SA-STORE-NUMBER ' DATA IS VALID'.       10140000
101500*                                                                 10150000
101600****************************************************************  10160000
101700* Z800-WRITE-REPORT-LINE.  ERROR REPORT LINES WRITTEN             10170000
101800****************************************************************  10180000
101900 Z800-WRITE-REPORT-LINE.                                          10190000
102000                                                                  10200000
102100     WRITE ERROR-REPORT-LINE                                      10210000
102200         AFTER ADVANCING PC-ADVANCE.                              10220000
102300     ADD PC-ADVANCE TO PC-LINE-COUNT.                             10230000
102400*                                                                 10240000
102500****************************************************************  10250000
102600*    THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.        *  10260000
102700****************************************************************  10270000
102800 Z900-SQL-ABEND.                                                  10280000
102900*                                                                 10290000
103000     MOVE +4013                 TO ABEND-CODE.                    10300000
103100     DISPLAY '**  ABEND     **'.                                  10310000
103200     DISPLAY '**  PROGRAM   **  =  INKUT101'.                     10320000
103300     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            10330000
103400     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        10340000
103500*                                                                 10350000
103600*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         10360000
103700*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        10370000
103800*                                                                 10380000
103900     COPY DPPD004.                                                10390001
104000*                                                                 10400000
104100     CALL 'ILBOABN0'  USING ABEND-CODE.                           10410000
104200*                                                                 10420000
P28545******************************************************************        
P28545*  PRICING MODULE.                                                        
P28545******************************************************************        
P28545     COPY INPD400.                                                        
P28545                                                                          
