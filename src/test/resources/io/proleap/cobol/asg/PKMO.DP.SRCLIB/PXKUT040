      *----------------------------------------------------------       00000101
       IDENTIFICATION DIVISION.                                         00000201
      *----------------------------------------------------------       00000301
       PROGRAM-ID.    PXKUT040.                                         00000401
       AUTHOR.        DAVID WELLER.                                     00000501
       DATE-WRITTEN.  JULY, 2007.                                       00000603
                                                                        00000701
      *----------------------------------------------------------       00000801
      *            EXTRACT MOS PRICE CHANGES                            00000901
      *----------------------------------------------------------       00001001
      * HISTORY LOG:                                                    00002001
      *                                                                 00003001
      *----------------------------------------------------------       00004001
      * DATE:                                                           00005001
      * WR/IR#:                                                         00006001
      * PROGRAMMER:                                                     00007001
      * DESCRIPTION:                                                    00008001
      *                                                                 00009001
      *----------------------------------------------------------       00010001
       ENVIRONMENT DIVISION.                                            00020001
      *----------------------------------------------------------       00030001
       CONFIGURATION SECTION.                                           00040001
       SOURCE-COMPUTER. IBM-3090.                                       00050001
       OBJECT-COMPUTER. IBM-3090.                                       00060001
                                                                        00070001
       INPUT-OUTPUT SECTION.                                            00080001
                                                                        00090001
       FILE-CONTROL.                                                    00100001
                                                                        00140001
           SELECT EXTRACT-FILE                                          00150001
               ASSIGN TO OUT01.                                         00160001
      *----------------------------------------------------------       00170001
       DATA DIVISION.                                                   00180001
      *----------------------------------------------------------       00190001
       FILE SECTION.                                                    00200001
                                                                        00210001
       FD  EXTRACT-FILE                                                 00220001
           RECORDING MODE IS F                                          00230001
           LABEL RECORDS ARE OMITTED                                    00240001
           RECORD CONTAINS 80 CHARACTERS                                00250002
           DATA RECORD IS EXTRACT-RECORD.                               00260001
       01  EXTRACT-RECORD              PIC X(80).                       00270002
      *---------------------------------------------------------        00360001
                                                                        00370001
       WORKING-STORAGE SECTION.                                         00380001
      *---------------------------------------------------------        00390001
      * PC- PROGRAM CONSTANTS                                           00400001
      *----------------------------------------------------------       00410001
       01  PC-PROGRAM-CONSTANTS.                                        00420001
           05  PC-PROGRAM-NAME              PIC X(08) VALUE 'PXKUT040'. 00430001
           05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00450001
           05  PC-NULL-VALUE                PIC S9(04) VALUE -1         00460001
                                                       COMP SYNC.       00470001
           05  NV-GP-AMT-NULL-IND           PIC S9(04) VALUE +0         00480001
                                                       COMP SYNC.       00490001
           05  NV-GP-QTY-NULL-IND           PIC S9(04) VALUE +0         00500001
                                                       COMP SYNC.       00510001
           05  NV-EFF-END-DTE-NULL-IND      PIC S9(04) VALUE +0         00520001
                                                       COMP SYNC.       00530001
                                                                        00540001
      *----------------------------------------------------------       00550001
      * PS- PROGRAM SWITCHES                                            00560001
      *----------------------------------------------------------       00570001
       01  PS-PROGRAM-SWITCHES.                                         00580001
           05  PS-EOF-EXTRACT-SW           PIC X(01)  VALUE SPACE.      00590001
               88  PS-EOF-EXTRACT                      VALUE 'Y'.       00600001
               88  PS-NOT-EOF-EXTRACT                  VALUE 'N'.       00610001
                                                                        00650001
      *----------------------------------------------------------       00660001
      * PV- PROGRAM VARIABLES                                           00670001
      *----------------------------------------------------------       00680001
                                                                        00730001
       01 PV-PROGRAM-VARIABLES.                                         00740001
          05  ABEND-CODE              PIC S9(4)  VALUE ZEROS COMP SYNC. 00750001
          05  PV-DB2-DATE                   PIC X(10).                  00760001
          05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   00780001
          05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         00790001
          05  PV-AD-EVNT-ID                 PIC S9(09) VALUE +0.        00800001
          05  PV-ACTION-CODE                PIC X(01).                  00810001
              88  PV-INSERT-DATA                       VALUE 'I'.       00820001
              88  PV-UPDATE-DATA                       VALUE 'U'.       00830001
                                                                        00840001
          05  PV-RECORD-COUNT               PIC 9(05) VALUE ZEROS.      00850001
          05  PV-LD-STATUS-CDE              PIC X(02).                  00860001
              88  PV-NO-ERROR                          VALUE '00'.      00870001
              88  PV-CRITICAL-ERROR                    VALUE '01'.      00880001
              88  PV-NOT-CRITICAL-ERROR                VALUE '02'.      00890001
                                                                        00900001
          05  PV-STRT-PARM.                                             00910001
              10  PV-STRT-DTE-CC            PIC X(02).                  00920001
              10  PV-STRT-DTE-YY            PIC X(02).                  00930001
              10  PV-STRT-DTE-MM            PIC X(02).                  00931001
              10  PV-STRT-DTE-DD            PIC X(02).                  00932001
              10  FILLER                    PIC X.                      00933001
              10  PV-DECREMENT              PIC X(03).                  00934001
              10  FILLER                    PIC X(68).                  00935001
                                                                        00936001
          05  PV-AD-EVNT-STRT-DTE           PIC X(10).                  00937001
                                                                        00938001
           05  PV-OPERATION-MSG             PIC  X(60)  VALUE SPACES.   00939001
           05  PV-OPERATION-MSG-1           PIC  X(40)  VALUE SPACES.   00940001
                                                                        00950001
          05  PV-AD-EVNT-END-DTE-TM.                                    00960001
              10  PV-AD-EVNT-END-DTE.                                   00970001
                  15  PV-AD-EVNT-DTE-TM2-CCYY   PIC X(04).              00980001
                  15  FILLER                    PIC X(01).              00990001
                  15  PV-AD-EVNT-DTE-TM2-MM     PIC X(02).              01000001
                  15  FILLER                    PIC X(01).              01010001
                  15  PV-AD-EVNT-DTE-TM2-DD     PIC X(02).              01020001
              10  PV-AD-EVNT-END-TM             PIC X(16).              01030001
                                                                        01040001
                                                                        01050001
       01  PV-TOTAL-RECORD.                                             01060001
           05 PV-BUSINESS-EVNT-ID              PIC 9(03) VALUE ZERO.    01070001
           05 PV-ACTION-CDE                    PIC X(01) VALUE 'T'.     01080001
           05 PV-TOTAL-NBR-OF-RECS             PIC 9(11) VALUE ZERO.    01090001
      ***************************************************************** 01100001
      *  EXTRACT RECORD LAYOUT                                          01110001
      ***************************************************************** 01120001
      *01  PXRD049-EXTRACT-RECORD.                                      01130002
           COPY PXRD049.                                                01140002
                                                                        01210001
      *----------------------------------------------------------       01220001
      * DATE ROUTINE COPY MEMBERS                                       01230001
      *----------------------------------------------------------       01240001
           COPY DPWS500.                                                01250001
                                                                        01260001
      *----------------------------------------------------------       01270001
      * VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01280001
      *----------------------------------------------------------       01290001
           COPY DPWS004.                                                01300001
                                                                        01310001
      *---------------------------------------------                    01320001
      *  DB2 COMMUNICATION AREA.                                        01330001
      *---------------------------------------------                    01340001
           EXEC SQL                                                     01350001
                INCLUDE SQLCA                                           01360001
           END-EXEC.                                                    01370001
                                                                        01380001
           COPY SQLCA2.                                                 01390001
      *---------------------------------------------                    01400001
      *  DB2 TABLE PXT00003 (PXT_MOS_SKU_STR)                           01410001
      *---------------------------------------------                    01420001
           EXEC SQL                                                     01430001
                INCLUDE PXT00003                                        01440001
           END-EXEC.                                                    01450001
                                                                        01460001
      *---------------------------------------------                    01470001
      *  DB2 TABLE XST00008 (XST_SKU_LOC)                               01471001
      *---------------------------------------------                    01472001
           EXEC SQL                                                     01473001
                INCLUDE XST00008                                        01474001
           END-EXEC.                                                    01475001
                                                                        01476001
      *---------------------------------------------                    01477001
      *  DB2 TABLE XST00010 (XST_SKU)                                   01478001
      *---------------------------------------------                    01479001
           EXEC SQL                                                     01479101
                INCLUDE XST00010                                        01479201
           END-EXEC.                                                    01479301
                                                                        01479401
      *---------------------------------------------                    01479501
      *   EXTRACT-CUR CURSOR DB2 SELECT                                 01479601
      *---------------------------------------------                    01479701
           EXEC SQL                                                     01479801
             DECLARE EXTRACT-CUR CURSOR FOR                             01479901
               SELECT A.SKU_NBR                                         01480001
                     ,A.STR_NBR                                         01490001
                     ,A.EFF_BEG_DTE                                     01500001
                     ,A.EFF_END_DTE                                     01510001
               FROM   PXT_MOS_SKU_STR   A                               01520001
               WHERE A.EFF_BEG_DTE = CURRENT DATE                       01530008
                 AND (A.EFF_END_DTE IS NULL                             01531009
                  OR  A.EFF_END_DTE >= A.EFF_BEG_DTE)                   01532009
              WITH UR                                                   01540001
           END-EXEC.                                                    01550001
                                                                        01560001
      *----------------------------------------------------------       01561001
       PROCEDURE DIVISION.                                              01562001
      *----------------------------------------------------------       01563001
       0000-MAINLINE.                                                   01564001
                                                                        01565001
           PERFORM 1000-INITIALIZATION.                                 01566001
                                                                        01567001
           PERFORM 2000-EXTRACT-DATA                                    01568001
                   UNTIL PS-EOF-EXTRACT.                                01569001
                                                                        01570001
           PERFORM 9999-WRAPUP.                                         01580001
                                                                        01590001
           GOBACK.                                                      01600001
                                                                        01610001
      *0000-EXIT.                                                       01620001
       EJECT.                                                           01630001
                                                                        01640001
      *----------------------------------------------------------       01650001
      * 1000-INITIALIZATION.                                            01660001
      *     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            01670001
      *     UPDATE OR INSERT A RECORD.                                  01680001
      *----------------------------------------------------------       01690001
       1000-INITIALIZATION.                                             01700001
           SET PS-NOT-EOF-EXTRACT TO TRUE.                              01710001
                                                                        01720001
           OPEN OUTPUT EXTRACT-FILE.                                    01740001
                                                                        01780001
           EXEC SQL                                                     01790001
               OPEN EXTRACT-CUR                                         01800001
           END-EXEC.                                                    01810001
                                                                        01820001
           IF SQLCODE < 0                                               01830001
               DISPLAY 'OPEN  UNSUCCESSFUL FOR TABLE PXT_MOS_SKU_STR'   01840001
               PERFORM U9980-SQL-ERROR                                  01850001
                  THRU U9980-EXIT.                                      01860001
                                                                        01870001
           IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               01880001
                 SQLWARN0 = 'W'                                         01890001
               DISPLAY 'FETCH WARNING FOR TABLE PXT_MOS_SKU_STR'        01900001
               PERFORM U9990-SQL-WARNING                                01910001
                  THRU U9990-EXIT.                                      01920001
                                                                        01930001
           INITIALIZE DCLPXT00003.                                      01931001
                                                                        01932001
      *1100-EXIT.                                                       01933001
       EJECT.                                                           01934001
                                                                        01935001
      *----------------------------------------------------------       01936001
      * 2000-EXTRACT-DATA.                                              01937001
      *     THIS CHECKS THE ACTION TO SEE WHETHER THE RECORD            01938001
      *     SHOULD BE INSERTED INTO THE AD EVENT TABLE OR UPDATED.      01939001
      *     IF SOMETHING IS WRONG WITH THE ACTION CODE IT WILL          01940001
      *     PROCESS AN ERROR AND EXIT THE PROGRAM.                      01950001
      *----------------------------------------------------------       01960001
       2000-EXTRACT-DATA.                                               01970001
                                                                        01980001
           PERFORM 2100-FETCH-EXTRACT                                   01990001
              THRU 2100-EXIT.                                           02000001
                                                                        02010001
           IF PS-NOT-EOF-EXTRACT                                        02020001
               PERFORM 3300-SELECT-XST-SKU                              02040002
                   THRU 3300-EXIT                                       02050002
      * LOOK FOR THE STORE PRICE FIRST                                  02051001
               MOVE PXT00003-SKU-NBR   TO XST00010-SKU-NBR              02052002
               PERFORM 3400-GET-PRICES                                  02053002
                   THRU 3400-EXIT                                       02054002
               IF SQLCODE = +100                                        02055002
      * LOOK FOR THE ZERO STORE PRICE IF STORE PRICE NOT FOUND          02056001
                   MOVE +0             TO XST00010-SKU-NBR              02056102
                   PERFORM 3400-GET-PRICES                              02056202
                       THRU 3400-EXIT                                   02056302
               END-IF                                                   02056402
               IF SQLCODE = 0                                           02056502
                   PERFORM 2200-FORMAT-EXTRACT-FILE                     02056602
                       THRU 2200-EXIT                                   02056702
                                                                        02056801
                   PERFORM 3000-WRITE-EXTRACT                           02056902
                       THRU 3000-EXIT                                   02057002
               ELSE                                                     02058002
                   DISPLAY '***'                                        02059002
                   DISPLAY 'NO PRICE ROW FOUND'                         02060002
                   DISPLAY 'STR:  ' PXT00003-STR-NBR                    02070002
                   DISPLAY 'SKU:  ' PXT00003-SKU-NBR                    02080002
               END-IF                                                   02090002
           END-IF.                                                      02110001
                                                                        02120001
      *2000-EXIT.                                                       02130001
       EJECT.                                                           02140001
       EJECT.                                                           02350001
                                                                        02360001
                                                                        02493701
       EJECT.                                                           02493801
      *------------------------------------------------------           02493901
      * 2100-FETCH-EXTRACT                                              02494001
      *     EXTRACTS THE AD EVENT RECORD.                               02495001
      *------------------------------------------------------           02496001
                                                                        02497001
       2100-FETCH-EXTRACT.                                              02498001
                                                                        02499001
           EXEC SQL                                                     02500001
               FETCH EXTRACT-CUR                                        02510001
                   INTO :PXT00003-SKU-NBR,                              02520001
                        :PXT00003-STR-NBR,                              02530001
                        :PXT00003-EFF-BEG-DTE,                          02540001
                        :PXT00003-EFF-END-DTE                           02550001
                            :NV-EFF-END-DTE-NULL-IND                    02560001
           END-EXEC.                                                    02561001
                                                                        02562001
           IF SQLCODE < 0                                               02563001
               DISPLAY 'FETCH UNSUCCESSFUL FOR TABLE PXT_MOS_SKU_STR'   02564001
               PERFORM U9980-SQL-ERROR                                  02565001
                  THRU U9980-EXIT.                                      02565101
                                                                        02565201
           IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               02565301
                 SQLWARN0 = 'W'                                         02565401
               DISPLAY 'FETCH WARNING FOR TABLE PXT_MOS_SKU_STR'        02565501
               PERFORM U9990-SQL-WARNING                                02565601
                  THRU U9990-EXIT.                                      02565701
                                                                        02565801
           IF SQLCODE = +100                                            02565901
               MOVE 'Y' TO PS-EOF-EXTRACT-SW.                           02566001
                                                                        02567001
       2100-EXIT.                                                       02568001
           EXIT.                                                        02569001
                                                                        02570001
                                                                        02571001
       EJECT.                                                           02572001
      *------------------------------------------------------           02573001
      * 2200-FORMAT-EXTRACT-FILE                                        02573101
      *     FORMATS THE AD EVENT COPY BOOK.                             02573201
      *------------------------------------------------------           02573301
       2200-FORMAT-EXTRACT-FILE.                                        02573401
                                                                        02573501
           MOVE PXT00003-EFF-BEG-DTE   TO PXRD049-EVNT-DTE.             02573604
           MOVE PXT00003-STR-NBR       TO PXRD049-STR-NBR.              02573704
           MOVE PXT00003-SKU-NBR       TO PXRD049-SKU-NBR.              02573804
           MOVE XST00008-UNT-RTL-AMT   TO PXRD049-NEW-UNT-RTL-AMT.      02573904
                                                                        02574001
      ***DETERMINES IF GROUP PRICING IS AVAILABLE FOR ITEM              02575001
           IF  NV-GP-QTY-NULL-IND  = PC-NULL-VALUE                      02576001
               MOVE ZEROS              TO PXRD049-NW-GP-RTL-QTY         02577004
           ELSE                                                         02579001
               MOVE XST00008-GP-RTL-QTY                                 02580001
                                       TO PXRD049-NW-GP-RTL-QTY         02590004
           END-IF.                                                      02600001
           MOVE NV-GP-QTY-NULL-IND     TO PXRD049-GP-RTL-QTY-NULL-IND.  02601006
                                                                        02610001
      ***DETERMINES IF GROUP PRICING IS AVAILABLE FOR ITEM              02610101
           IF  NV-GP-AMT-NULL-IND  = PC-NULL-VALUE                      02610201
               MOVE ZEROS              TO PXRD049-NW-GP-RTL-AMT         02610304
           ELSE                                                         02610501
               MOVE XST00008-GP-RTL-AMT                                 02610601
                                       TO PXRD049-NW-GP-RTL-AMT         02610704
           END-IF.                                                      02610801
           MOVE NV-GP-AMT-NULL-IND     TO PXRD049-GP-RTL-AMT-NULL-IND.  02610906
                                                                        02611001
       2200-EXIT.                                                       02611101
           EXIT.                                                        02612001
       EJECT.                                                           02613001
                                                                        02614001
      *------------------------------------------------------           02615001
      * 3000-WRITE-EXTRACT.                                             02616001
      *     WRITE EXTRACT FILE.                                         02617001
      *------------------------------------------------------           02618001
       3000-WRITE-EXTRACT.                                              02619001
           ADD 1 TO PV-RECORD-COUNT.                                    02620001
           WRITE EXTRACT-RECORD FROM PXRD049-DATA-RECORD.               02630002
                                                                        02640001
       3000-EXIT.                                                       02650001
           EXIT.                                                        02660001
       EJECT.                                                           02670001
                                                                        02680001
      ***************************************************************** 02690001
      **RETRIEVE PRICING FROM XST_SKU_LOC                               02700001
      ***************************************************************** 02710001
       3400-GET-PRICES.                                                 02720001
           IF NV-EFF-END-DTE-NULL-IND = PC-NULL-VALUE                   02730001
           EXEC SQL                                                     02740001
                SELECT UNT_RTL_AMT                                      02750001
                      ,GP_RTL_AMT                                       02760001
                      ,GP_RTL_QTY                                       02761001
                INTO  :XST00008-UNT-RTL-AMT                             02762001
                     ,:XST00008-GP-RTL-AMT  :NV-GP-AMT-NULL-IND         02763001
                     ,:XST00008-GP-RTL-QTY  :NV-GP-QTY-NULL-IND         02764001
                FROM   XST_SKU_LOC                                      02765001
                WHERE  INTR_UPC_ID       =  :XST00010-INTR-UPC-ID       02766001
                  AND  LOC_NBR           =  :XST00008-LOC-NBR           02767001
                  AND  DATE(BEG_TMST)    <= :PXT00003-EFF-BEG-DTE       02768001
                  AND  (END_TMST         IS NULL                        02769001
                   OR  END_TMST     >= CURRENT TIMESTAMP)               02770001
                WITH UR                                                 02770101
           END-EXEC                                                     02770201
           ELSE                                                         02770301
           EXEC SQL                                                     02770401
                SELECT UNT_RTL_AMT                                      02770501
                      ,GP_RTL_AMT                                       02770601
                      ,GP_RTL_QTY                                       02770701
                INTO  :XST00008-UNT-RTL-AMT                             02770801
                     ,:XST00008-GP-RTL-AMT  :NV-GP-AMT-NULL-IND         02770901
                     ,:XST00008-GP-RTL-QTY  :NV-GP-QTY-NULL-IND         02771001
                FROM   XST_SKU_LOC                                      02771101
                WHERE  INTR_UPC_ID       =  :XST00010-INTR-UPC-ID       02771201
                  AND  LOC_NBR           =  :XST00008-LOC-NBR           02771301
                  AND  DATE(BEG_TMST)    <= :PXT00003-EFF-BEG-DTE       02771401
                  AND  (END_TMST         IS NULL                        02771501
                   OR  DATE(END_TMST)    >= :PXT00003-EFF-END-DTE)      02771601
                WITH UR                                                 02771701
           END-EXEC                                                     02771801
           END-IF.                                                      02771901
           EVALUATE TRUE                                                02772001
              WHEN SQLCODE = +0                                         02772101
              WHEN SQLCODE = +100                                       02772201
                   CONTINUE                                             02772301
              WHEN OTHER                                                02772401
                DISPLAY 'SELECT FAILED FOR TABLE XST_SKU_LOC'           02772501
                DISPLAY 'INTR-UPC-ID: ' XST00010-INTR-UPC-ID            02772601
                DISPLAY 'LOC-NBR:     ' XST00008-LOC-NBR                02772701
                DISPLAY 'EFF-BEG-DTE: ' PXT00003-EFF-BEG-DTE            02772801
                DISPLAY 'NULL-IND:    ' NV-EFF-END-DTE-NULL-IND         02772901
                DISPLAY 'EFF-END-DTE: ' PXT00003-EFF-END-DTE            02773001
                PERFORM U9980-SQL-ERROR                                 02773101
                  THRU U9980-EXIT                                       02773201
           END-EVALUATE.                                                02773301
                                                                        02773401
       3400-EXIT.                                                       02773501
           EXIT.                                                        02773601
                                                                        02773701
       EJECT.                                                           02773801
                                                                        02773901
      ******************************************************************02774001
       3300-SELECT-XST-SKU.                                             02774101
      *     SELECT DOMAIN SKU TABLE. DCLGEN IS XST00010.                02774201
      ******************************************************************02774301
                                                                        02774401
           MOVE PXT00003-SKU-NBR       TO XST00010-SKU-NBR.             02774501
                                                                        02774601
           EXEC SQL                                                     02774701
               SELECT INTR_UPC_ID                                       02774801
                 INTO :XST00010-INTR-UPC-ID                             02774901
                 FROM XST_SKU                                           02775001
                WHERE SKU_NBR    = :XST00010-SKU-NBR                    02776001
                      WITH UR                                           02777001
           END-EXEC.                                                    02778001
                                                                        02779001
           EVALUATE TRUE                                                02780001
               WHEN SQLCODE = 0                                         02780101
                   CONTINUE                                             02780201
               WHEN SQLWARN NOT EQUAL SPACES                            02780301
               WHEN SQLCODE NOT EQUAL ZERO                              02780401
                DISPLAY 'SELECT FAILED FOR TABLE XST_SKU'               02780501
                PERFORM U9980-SQL-ERROR                                 02780601
                  THRU U9980-EXIT                                       02780701
           END-EVALUATE.                                                02780801
                                                                        02780901
       3300-EXIT.                                                       02781001
           EXIT.                                                        02782001
                                                                        02783001
      *----------------------------------------------------------       02784001
      * 9999-WRAPUP.                                                    02785001
      *     MOVES ALL ERROR CODES TO THE LINKAGE VARIABLES TO           02786001
      *     BE PASSED BACK TO THE CALLING PROGRAM.  EXITS THE           02787001
      *     PROGRAM.                                                    02788001
      *----------------------------------------------------------       02789001
*                                                                       02790001
      *----------------------------------------------------------       02800001
       U9980-SQL-ERROR.                                                 02810001
      *----------------------------------------------------------       02820001
                                                                        02830001
           MOVE SQLCODE    TO SQLCODE2.                                 02840001
           MOVE SQLERRD(3) TO SQLERRD3.                                 02850001
           DISPLAY '** ABEND **       ** = SQLWARNING'.                 02860001
           DISPLAY '** PROGRAM        ** = PXKUT040'.                   02870001
           DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  02880001
           DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  02890001
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   02900001
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  02910001
                                                                        02920001
           MOVE 4013 TO ABEND-CODE.                                     02930001
           CALL 'ILBOABN0' USING ABEND-CODE.                            02940001
                                                                        02950001
       U9980-EXIT.                                                      02960001
           EXIT.                                                        02970001
                                                                        02980001
      *----------------------------------------------------------       02990001
       U9990-SQL-WARNING.                                               03000001
      *----------------------------------------------------------       03010001
                                                                        03020001
           MOVE SQLCODE    TO SQLCODE2.                                 03030001
           MOVE SQLERRD(3) TO SQLERRD3.                                 03040001
           DISPLAY '** ABEND **       ** = SQLWARNING'.                 03050001
           DISPLAY '** PROGRAM        ** = PXKUT040'.                   03060001
                                                                        03070001
           MOVE 4013 TO ABEND-CODE.                                     03080001
           CALL 'ILBOABN0' USING ABEND-CODE.                            03090001
                                                                        03100001
       U9990-EXIT.                                                      03110001
           EXIT.                                                        03120001
                                                                        03130001
       9999-WRAPUP.                                                     03140001
           CLOSE EXTRACT-FILE.                                          03160001
                                                                        03170001
           EXEC SQL                                                     03180001
               CLOSE EXTRACT-CUR                                        03190001
           END-EXEC.                                                    03200001
                                                                        03210001
      *9999-EXIT.                                                       03220001
       EJECT.                                                           03230001
                                                                        03240001
      ******************************************************************03250001
      **RUN DATE ROUTINE                                                03260001
      ******************************************************************03270001
       9999-DATE-ROUTINE.                                               03280001
                                                                        03290001
           CALL DP500-KOHLS-CALENDAR-ROUTINE                            03300001
                      USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.        03310001
                                                                        03320001
           EVALUATE TRUE                                                03330001
                WHEN DPG54-NO-ERROR                                     03340001
                     CONTINUE                                           03350001
                WHEN OTHER                                              03360001
                   DISPLAY 'RETRIEVING END DATE...'                     03370001
                   DISPLAY DPG54-ERROR-MESSAGE                          03380001
                   PERFORM Z910-ABEND                                   03390001
           END-EVALUATE.                                                03400001
                                                                        03401001
      ******************************************************************03402001
      * Z910-ABEND - PERFORMS A NON-SQL-ABEND                          *03403001
      ******************************************************************03404001
       Z910-ABEND.                                                      03405001
                                                                        03406001
           DISPLAY '** ABEND           **'.                             03407001
      *    DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  03408001
      *    DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        03409001
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         03410001
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-1.       03420001
                                                                        03430001
           CALL 'ILBOABN0' USING ABEND-CODE.                            03440001
