000100***************************************************************** 00010008
000200 IDENTIFICATION DIVISION.                                         00020008
000300***************************************************************** 00030008
000400                                                                  00040008
000400 PROGRAM-ID.    SAKCS405.                                         00040008
000500 AUTHOR.        LIHUA LIANG.                                      00050008
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060008
000700 DATE-WRITTEN.  12/06/2001.                                       00070008
000800 DATE-COMPILED.                                                   00080008
000900                                                                  00090008
001000***************************************************************** 00100008
001100*    S405 - DECLINED TENDER LIST                                * 00110008
001200*                                                               * 00120008
001300*    THIS PROGRAM DISPLAY ALL DECLINED TENDERS THAT WERE PART   * 00130008
001400*    OF A SPECIFIC TRANSACTION.                                 * 00140008
001500*                                                               * 00150008
001600***************************************************************** 00160008
002800*                         CHANGES                               *         
001600***************************************************************** 00160008
003000*  CHANGED 09/27/2005 BY CAROLE MCCAMMON     WR#29309           *         
003100*       ADD KOHL'S DEBIT TO DEBIT PROCESSING.                   *         
001600***************************************************************** 00160008
C62728*  CHANGED 10/04/2013 BY COGNIZANT           WR#CHG0062728      *         
C62728*                                                               *         
C62728*  REMOVED LOGIC THAT REFERENCING THE FOLLOWING COSA HISTORY    *         
C62728*  TABLES FOR 9607 - FSH 2013-CFMC PROJECT.                     *         
C62728*                                                               *         
C62728*  EPT_DR_CRD_TNDRH,TEPATRH, TEPCHKH,TEPSVCH, TEPTNDH, TEPCRDH  *         
C62728*****************************************************************         
SEPHOR*  CHANGED 03/15/2021 BY BARB SCHULTZ        CHG0254817         *         
SEPHOR*                                                               *         
SEPHOR*  ADDED TWO NEW TENDER TYPES FOR SEPHORA - SEPHORA CHARGE CARD *         
SEPHOR*  (22) AND SEPHORA GIFT CARD (23).                             *         
SEPHOR*****************************************************************         
C00000*-----------------------------------------------------------------        
C00000*  CHANGED 09/02/2021    BY GERMAN BANDA    WR: CHG0261091                
C00000*                                                                         
C00000*  CHANGE CALL OF DPKUT100 TO                                             
C00000*  CALL DP010I-NUMERIC-EDIT-ROUTINE                                       
C00000*  MAKING THE CALL DYNAMIC VS STATIC                                      
SEPH01*****************************************************************         
SEPH01*  CHANGED 03/15/2022    BY BARB SCHULTZ    WR: CHG0268160                
SEPH01*                                                                         
SEPH01*  DELETED SEPHORA GIFT CARD (23) AND ADDED THE USE OF THE GIFT           
SEPH01*  CARD TENDER SOURCE = '14' UNDER THE SA012-GIFT-CERTIFICATE             
SEPH01*  EVALUATE STATEMENT.                                                    
SEPH01*****************************************************************         
CICS  *  CHANGED 10/12/2022    BY JIM HUNTER      WR: CHG0276153                
CICS  *                                                                         
CICS  *  ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL               
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.              
CICS  *****************************************************************         
COBRND*  CHANGED 02/22/2023    BY BARB SCHULTZ    WR: CHG0284656                
COBRND*                                                                         
COBRND*  ADDED COBRAND AS A TENDER TYPE.                                        
COBRND*****************************************************************         
PAYVEN*  CHANGED 04/14/2023    BY BARB SCHULTZ    WR: CHG0287492                
PAYVEN*                                                                         
PAYVEN*  ADDED PAYPAL AND VENMO AS A TENDER TYPES.                              
PAYVEN*****************************************************************         
002200                                                                  00170008
002300 ENVIRONMENT DIVISION.                                            00180008
002400                                                                  00190008
002500 DATA DIVISION.                                                   00200008
002600                                                                  00210008
002700 WORKING-STORAGE SECTION.                                         00220008
002800                                                                  00230008
002900 01  DB2-KEYS.                                                    00240008
003000     05  DK-STORE                       PIC S9(04)  VALUE ZERO    00250008
003100                                                    COMP.         00260008
003200     05  DK-REGISTER                    PIC S9(04)  VALUE ZERO    00270008
003300                                                    COMP.         00280008
003400     05  DK-TRANSACTION                 PIC S9(04)  VALUE ZERO    00290008
003500                                                    COMP.         00300008
003600     05  DK-PARTITION                   PIC S9(04)  VALUE ZERO    00310008
003700                                                    COMP.         00320008
003800     05  DK-START-TIME                  PIC  X(08)  VALUE SPACE.  00330008
003900     05  DK-SALES-CORR-SEQ-NBR          PIC S9(04)  VALUE ZERO    00340008
004000                                                    COMP.         00350008
004100     05  DK-SALES-DATE                  PIC  X(10)  VALUE SPACE.          
004200                                                                  00360008
004300 01  PC-PROGRAM-CONSTANTS.                                        00370008
004400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00380008
004500                                                    'SA405A  '.   00390008
004600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00400008
004700                                                    'SAKM405 '.   00410008
004800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00420008
004900                                                    'SAKCS405'.   00430008
005000     05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.      00440008
005100     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '1'.    00450008
005100     05  PC-LIST-FORMAT-DIRECT          PIC  X(01)  VALUE '2'.    00450008
005200     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10     00460008
005300                                                    COMP SYNC.    00470008
005400     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00480008
005500                                                    COMP SYNC.    00490008
005600     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00500008
005700                                                    +1000000      00510008
005800                                                    COMP-3.       00520008
005900     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00530008
006000                                                     COMP-3.      00540008
006100     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00550008
006200                                                    COMP SYNC.    00560008
009000     05  PC-KOHLS-CREDIT-LEN-10   PIC  9(02)  VALUE  10.          00900047
009100     05  PC-KOHLS-CREDIT-LEN-12   PIC  9(02)  VALUE  12.          00910047
009200     05  PC-MIN-STORED-VALUE-LEN  PIC  9(02)  VALUE  10.          00920047
006300                                                                  00600008
006400 01  PC-TSYMSG-NUMBERS.                                           00610008
006500     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  00620008
006600     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  00630008
006700     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  00640008
006800     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  00650008
006900     05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.  00660008
007000     05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.  00670008
007100     05  PC-TSYMSG-01985                PIC 9(5)    VALUE 01985.  00680008
007100     05  PC-TSYMSG-02047                PIC 9(5)    VALUE 02047.  00680008
007200     05  PC-TSYMSG-02419                PIC 9(5)    VALUE 02419.  00680008
007300                                                                  00690008
007400 01  PS-PROGRAM-SWITCHES.                                         00700008
007500     05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.   00710008
007600         88  PS-NO-ERROR                             VALUE 'Y'.   00720008
007700         88  PS-ERROR                                VALUE 'N'.   00730008
008100     05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.   00770008
008200         88  PS-LIST-END                             VALUE 'Y'.   00780008
008300         88  PS-NO-LIST-END                          VALUE 'N'.   00790008
010000     05  PS-TENDER-ID-NUMERIC-SW        PIC  X(01)   VALUE 'N'.   01000047
010100         88  PS-TENDER-ID-NUMERIC                    VALUE 'Y'.   01010047
010200         88  PS-TENDER-ID-NOT-NUMERIC                VALUE 'N'.   01020047
010300     05  PS-KOHLS-LENGTH-12-SW          PIC  X(01)   VALUE 'N'.   01030047
010400         88  PS-KOHLS-LENGTH-IS-12                   VALUE 'Y'.   01040047
010500         88  PS-KOHLS-LENGTH-IS-NOT-12               VALUE 'N'.   01050047
008400                                                                  00800008
008500 01  PV-PROGRAM-VARIABLES.                                        00810008
008600     05  PV-REMAINDER                   PIC S9(04)   VALUE +0             
008700                                                     COMP SYNC.           
008800     05  PV-READ-COUNT                  PIC S9(09)   VALUE +0     00840008
008900                                                     COMP-3.      00850008
009000     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0     00860008
009100                                                     COMP-3.      00870008
009200     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0     00880008
009300                                                     COMP-3.      00890008
009400     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0     00900008
009500                                                     COMP SYNC.   00910008
009600     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0     00920008
009700                                                     COMP SYNC.   00930008
009800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0     00940008
009900                                                     COMP SYNC.   00950008
010000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0     00960008
010100                                                     COMP SYNC.   00970008
010200     05  PV-RETRY-COUNTER               PIC S9(04)   VALUE ZERO   00980008
010300                                                     COMP SYNC.   00990008
010400     05  PV-HOLD-LNE-ITM-SEQ-NBR        PIC S9(04)   VALUE ZERO   01000008
010500                                                     COMP.        01010008
010600     05  PV-AMT-FORMATTED               PIC ZZ,ZZ9.99-.           01020008
010700     05  PV-SUB                         PIC S9(04) VALUE ZERO     01030008
010800                                                   COMP SYNC.     01040008
012200     05  PV-TENDER-ID                   PIC  X(16).               01220047
012300     05  PV-TENDER-ID-FORMATTED         REDEFINES                 01230047
012400           PV-TENDER-ID                 PIC  ZZZZZZZZZZ999999.    01240047
012500     05  PV-KOHLS-TENDER-ID-FMT-10      REDEFINES                 01250047
012600           PV-TENDER-ID                 PIC  ZZZZZZ9999999999.    01260047
012700     05  PV-KOHLS-TENDER-ID-FMT-12      REDEFINES                 01270047
012800           PV-TENDER-ID                 PIC  ZZZZ999999999999.    01280047
012900     05  PV-GIFT-CERT-FMT               REDEFINES                 01290047
013000           PV-TENDER-ID                 PIC  ZZZZZZZZZZZ99999.    01300047
013100     05  PV-AMEX-TENDER-ID-FMT          REDEFINES                 01310047
013200           PV-TENDER-ID                 PIC  Z999999999999999.    01320047
013300     05  PV-TENDER-ID-N                 PIC  9(16)  VALUE ZERO.   01330047
013400     05  PV-TENDER-ID-N-10              PIC  9(10)  VALUE ZERO.   01340047
013500     05  PV-STORED-VALUE-CARD-NBR.                                01350047
013600         10  FILLER                     PIC  X(04)  VALUE SPACE.  01360047
013700         10  PV-STORED-VALUE-2          PIC  9(02)  VALUE ZERO.   01370047
013800         10  PV-STORED-VALUE-10         PIC  9(10)  VALUE ZERO.   01380047
010900                                                                  01050008
010900     05  PV-TIME.                                                 01050008
011000         10  PV-TIME-HH                 PIC  9(02) VALUE ZERO.    01060008
011100         10  FILLER                     PIC  X(01).               01070008
011200         10  PV-TIME-MM                 PIC  9(02) VALUE ZERO.    01080008
011300         10  FILLER                     PIC  X(03).               01090008
011400     05  PV-TIME-A-P                    PIC  X(01) VALUE SPACE.   01100008
011500     05  PV-AUTH-NBR                    PIC  X(06) VALUE SPACES.          
011500     05  PV-CRD-TYP-CDE                 PIC  X(01) VALUE SPACE.           
011600     05  PV-EXP-DTE.                                                      
011700         10  PV-EXP-DTE-MM              PIC  X(02) VALUE SPACES.          
011800         10  PV-EXP-DTE-YY              PIC  X(02) VALUE SPACES.          
011900     05  PV-DL-NBR                      PIC  X(25) VALUE SPACES.          
011900     05  PV-ROWS-FETCHED          PIC S9(05)  COMP-3 VALUE ZERO.          
012100                                                                          
012200 01  HL-HEADING-LINES.                                            01130008
012300     05  HL-LEFT-HEADING                PIC  X(79)   VALUE        01140008
012400         ' TENDER TYPE     AMOUNT     KEYED    CHECK/CARD/CERT #  01150008
012500-        'AUTH CODE  EXP DATE   '.                                        
012600     05  HL-RIGHT-HEADING               PIC  X(79)   VALUE        01140008
012700         ' TENDER TYPE      MICR NUMBER                        DL 01150008
012800-        'NUMBER                '.                                        
012900                                                                  01170008
013000 01  DL-DETAIL-LINE-AREA.                                         01180008
013100     05  DL-DETAIL-LINE                 PIC  X(79)   VALUE SPACES.01190008
013200     05  FILLER REDEFINES DL-DETAIL-LINE.                         01200008
013300        10  FILLER                      PIC  X(01).               01210008
013400        10  DL-TENDER-TYPE-L            PIC  X(15).               01220008
013500        10  FILLER                      PIC  X(01).               01230008
013600        10  DL-AMOUNT-L                 PIC  X(10).               01240008
013700        10  FILLER                      PIC  X(03).               01250008
013800        10  DL-KEYED-IND-L              PIC  X(01).               01260008
013900        10  FILLER                      PIC  X(04).               01270008
014000        10  DL-ID-NBR-L                 PIC  X(19).               01280008
014100        10  FILLER                      PIC  X(04).               01290008
014200        10  DL-AUTH-CDE-L               PIC  X(06).               01300008
014300        10  FILLER                      PIC  X(03).               01310008
014400        10  DL-EXP-DTE-L                PIC  X(04).               01320008
014500        10  FILLER                      PIC  X(01).               01330008
014600        10  DL-EXP-DTE-MMYY-L           PIC  X(06).               01340008
014700        10  FILLER                      PIC  X(01).                       
014800     05  FILLER REDEFINES DL-DETAIL-LINE.                         01200008
014900        10  FILLER                      PIC  X(01).                       
015000        10  DL-TENDER-TYPE-R            PIC  X(15).                       
015100        10  FILLER                      PIC  X(02).                       
015200        10  DL-MICR-NBR-R               PIC  X(33).                       
015300        10  FILLER                      PIC  X(02).                       
015400        10  DL-DL-NBR-R                 PIC  X(25).                       
015500        10  FILLER                      PIC  X(01).                       
015600                                                                          
015700***************************************************************** 01380008
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01390008
015900***************************************************************** 01400008
016000                                                                  01410008
016100     COPY DPWS030.                                                01420008
CICS       COPY DPWS930.                                                        
016300***************************************************************** 01440008
016400*    STANDARD COMMAREA.                                         * 01450008
016500***************************************************************** 01460008
016600                                                                  01470008
016700     COPY DPWS020.                                                01480008
016800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01490008
016900                                                                  01500008
017000***************************************************************** 01510008
017100*    INTER-APPLICATION COMMAREA.                                * 01520008
017200***************************************************************** 01530008
017300                                                                  01540008
017400         10  INTER-APPL-COMM-AREA       PIC X(200).               01550008
017500     COPY SAWS004.                                                01560008
017600                                                                  01570008
017700***************************************************************** 01580008
017800*    SPECIFIC COMMMAREA FOR SAKCS405.                           * 01590008
017900***************************************************************** 01600008
018000         10  ASC-SPECIFIC-COMMAREA.                               01610008
018200             15  ASC-KEY-PARTITION               PIC S9(04) COMP. 01630008
018400             15  ASC-KEY-SALES-DATE-ISO          PIC  X(10).      01650008
018500             15  ASC-KEY-STORE                   PIC  9(05).      01660008
018600             15  ASC-KEY-REGISTER                PIC  9(04).      01670008
018700             15  ASC-KEY-TRANSACTION             PIC  9(04).      01680008
018800             15  ASC-KEY-START-TIME              PIC  X(08).      01690008
018900             15  ASC-KEY-ID                      PIC  X(06).      01700008
019100             15  ASC-KEY-SALES-CORR-SEQ-NBR      PIC S9(04) COMP. 01730008
028802             15  FILLER                          PIC  X(01).              
038000             15  ASC-KEY-TYPE                    PIC  X(02).      03800047
038000                 88  ASC-KOHLS-PAYMENT-TYPE      VALUE '30'.      03800047
038200                 88  ASC-INVALID-TYPE            VALUE '42',      03820061
038300                     '43', '44', '54', '64'.                      03830061
019600             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                01750008
019700                 20  ASC-ITEM-ARRAY.                              01760008
019900                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        01780008
020000                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)           
020100                                                     COMP-3.              
020200                         30  ASC-TENDER-TYPE         PIC  X(15).          
020300                         30  ASC-TENDER-AMOUNT      PIC S9(5)V9(2)        
020400                                                     COMP-3.      02190008
020500                         30  ASC-KEYED-IND           PIC  X(01).          
020600                             88  ASC-KEYED-TENDER    VALUE 'Y'.           
020700                         30  ASC-ID-NBR              PIC  X(19)           
020700                             JUSTIFIED RIGHT.                             
020800                         30  ASC-AUTH-NBR            PIC  X(06).          
020900                         30  ASC-EXP-DTE             PIC  X(04).          
021000                         30  ASC-MICR-NBR            PIC  X(33).          
021100                         30  ASC-DL-NBR              PIC  X(25).          
021300             15  ASC-BLK-SUB                         PIC S9(04)   02200008
021400                                                     COMP SYNC.   02210008
021600             15  ASC-ITEM-SUB                        PIC S9(04)   02230008
021700                                                     COMP SYNC.   02240008
022300             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02300008
022400                                                     COMP-3.      02310008
022500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02320008
022600                                                     COMP-3.      02330008
022700             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   02340008
022800                                                     COMP-3.      02350008
022900             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02360008
023000                                                     COMP-3.      02370008
023100             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02380008
023200                                                     COMP-3.      02390008
023300             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02400008
023400                                                     COMP-3.      02410008
023500             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02420008
023600                                                     COMP SYNC.   02430008
023800             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   02450008
023900                                                     COMP-3.      02460008
024000             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   02470008
024100                                                     COMP-3.      02480008
024200             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  02490008
024300                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   02500008
024400                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   02510008
024500             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  02520008
024600                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   02530008
024700             15  ASC-DTL-QUEUE-NAME.                              02640008
024800                 20  ASC-DTL-TERM-ID                 PIC  X(04).  02650008
024900                 20  ASC-DTL-TASK-NUMBER             PIC S9(05)   02660008
025000                                                     COMP-3.      02670008
025100                 20  ASC-DTL-SEQ                     PIC  9(01).  02680008
025200                                                                  02690008
025300             15  ASC-START-ITEM-REQUEST.                          02700008
025400                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  02710008
025500             15  ASC-TRAN-SEL-SUB                    PIC  9(02).  02720008
025600             15  ASC-NBR-OF-TRAN-SEL-ITEMS           PIC S9(09)   02730008
025700                                                     COMP-3.      02740008
025800             15  ASC-NBR-OF-TRAN-TS-ITEMS            PIC S9(05)   02750008
025900                                                     COMP-3.      02760008
026000             15  ASC-TRAN-SEL-QUEUE-NAME             PIC  X(08).  02770008
026100             15  ASC-TRAN-SEL-ITEM                   PIC S9(04)   02780008
026200                                                     COMP SYNC.   02790008
026300             15  ASC-SALES-DATE-DISPLAY              PIC  X(10).  02800008
026400             15  ASC-TRAN-TOT-AMT                    PIC  X(10).  02810008
026500             15  ASC-TRAN-TOT-AMT-N                 PIC S9(5)V9(2)02820008
026600                                                     COMP-3.      02830008
026700             15  ASC-TIME-HH                         PIC  X(02).  02840008
026800             15  ASC-TIME-MM                         PIC  X(02).  02850008
026900             15  ASC-TIME-A-P                        PIC  X(02).  02860008
027000             15  ASC-VIEW-IND                        PIC  X(01).          
027100                 88  ASC-LEFT-VIEW                   VALUE 'L'.           
027200                 88  ASC-RIGHT-VIEW                  VALUE 'R'.           
027200             15  ASC-ASSOCIATE-ID                PIC S9(9) COMP.          
027300         10  FILLER                                  PIC  X(383). 02870008
027400                                                                  02890008
027500***************************************************************** 02920008
027600*  RECORD LAYOUT FOR THE TRAN SELECTION TEMP STORAGE QUEUE        02930008
027700***************************************************************** 02940008
027800     COPY SAWS001.                                                02960008
027900                                                                  02970008
028000***************************************************************** 02920008
028100*  TENDER TYPE CONSTANTS                                          02930008
028200***************************************************************** 02940008
028300     COPY SAWS012.                                                02960008
028400                                                                  02970008
028500***************************************************************** 02980008
028600*    ABEND PROCESSING COPYBOOK.                                   02990008
028700***************************************************************** 03000008
028800     COPY DPWS013.                                                03020008
028900                                                                  03030008
029000***************************************************************** 03050008
029100*    ATTRIBUTE SETTINGS COPYBOOK.                                 03060008
029200***************************************************************** 03070008
029300     COPY DPWS015.                                                03090008
029400                                                                  03100008
029500***************************************************************** 03110008
029600*    FUNCTION KEYS COPYBOOK.                                      03120008
029700***************************************************************** 03130008
029800     COPY DPWS016.                                                03150008
029900                                                                  03160008
030000***************************************************************** 03170008
030100*    NUMERIC EDIT LAYOUT.                                         03180008
030200***************************************************************** 03190008
030300     COPY DPWS010I.                                               03210008
030400                                                                  03220008
030500***************************************************************** 03230008
030600*    MAP LAYOUT                                                   03240008
030700***************************************************************** 03250008
030800     COPY SAKM405.                                                03270008
030900                                                                  03280008
031000 01  MR-OCCURS-LAYOUT          REDEFINES  SA405AO.                03290008
031100     05  FILLER                PIC X(203).                        03300008
031200     05  MR-SCROLL-AREA OCCURS 10 TIMES.                          03310008
031300                                                                  03320008
031400         10  MR-SCROLLABLE-AREAL        PIC S9(04) COMP.          03330008
031500         10  MR-SCROLLABLE-AREAA        PIC  X(01).               03340008
031600         10  MR-SCROLLABLE-AREAC        PIC  X(01).               03350008
031700         10  MR-SCROLLABLE-AREAH        PIC  X(01).               03360008
031800         10  MR-SCROLLABLE-AREA         PIC  X(79).               03370008
031900                                                                  03820008
032000***************************************************************** 04060008
032100*    DB2 AREA FOR OPERATIONAL DEBIT CARD TABLE.                   04070008
032200***************************************************************** 04080008
032300     EXEC SQL                                                     04090008
032400         INCLUDE EPT00002                                         04100008
032500     END-EXEC.                                                    04110008
032600                                                                  04120008
032000***************************************************************** 04060008
032100*    DB2 AREA FOR OPERATIONAL TENDER TABLE                        04070008
032200***************************************************************** 04080008
032300     EXEC SQL                                                     04090008
032400         INCLUDE TEPTND                                           04100008
032500     END-EXEC.                                                    04110008
032600                                                                  04120008
033400***************************************************************** 04060008
033500*    DB2 AREA FOR OPERATIONAL CHECK TENDER TABLE                  04070008
033600***************************************************************** 04080008
033700     EXEC SQL                                                     04090008
033800         INCLUDE TEPCHK                                           04100008
033900     END-EXEC.                                                    04110008
034000                                                                  04120008
034800***************************************************************** 04060008
034900*    DB2 AREA FOR OPERATIONAL STORED VALUE TENDER TABLE           04070008
035000***************************************************************** 04080008
035100     EXEC SQL                                                     04090008
035200         INCLUDE TEPSVC                                           04100008
035300     END-EXEC.                                                    04110008
035400                                                                  04120008
036200***************************************************************** 04060008
036300*    DB2 AREA FOR OPERATIONAL CREDIT TENDER TABLE                 04070008
036400***************************************************************** 04080008
036500     EXEC SQL                                                     04090008
036600         INCLUDE TEPCRD                                           04100008
036700     END-EXEC.                                                    04110008
036800                                                                  04120008
036200***************************************************************** 04060008
036300*    DB2 AREA FOR OPERATIONAL ASSOCIATE ID TABLE                          
036400***************************************************************** 04080008
036500     EXEC SQL                                                     04090008
036600         INCLUDE TEPATR                                           04100008
036700     END-EXEC.                                                    04110008
036800                                                                  04120008
037600***************************************************************** 04060008
037700*    DB2 AREA FOR TEPPART (PARTITION TABLE)                       04070008
037800***************************************************************** 04080008
037900     EXEC SQL                                                     04090008
038000         INCLUDE TEPPART                                          04100008
038100     END-EXEC.                                                    04110008
038200                                                                  04120008
038300***************************************************************** 04130008
038400*    DB2 AREA FOR COMMUNICATIONS                                  04140008
038500***************************************************************** 04150008
038600     EXEC SQL                                                     04160008
038700          INCLUDE SQLCA                                           04170008
038800     END-EXEC.                                                    04180008
038900                                                                  04190008
058500***************************************************************** 05850047
058600*    CURSOR FOR OPERATIONAL TENDER INFORMATION RETRIEVAL          05860047
058700***************************************************************** 05870047
058800     EXEC SQL                                                     05880047
058900         DECLARE TENDER-OPER-CSR CURSOR FOR                       05890047
059000             SELECT  TNDR_SEQ_NBR                                 05900047
059100                    ,TNDR_TYP_CDE                                 05910047
059200                    ,TNDR_ID                                      05920047
059300                    ,TNDR_AMT                                     05930047
059400                    ,TNDR_ID_SRC_CDE                              05940047
059500                    ,TNDR_ID_LEN_NBR                              05950047
059600             FROM TEPTND                                          05960047
059700             WHERE   PARTN_NBR        = :DK-PARTITION             05970047
059800               AND   STR_NBR          = :DK-STORE                 05980047
059900               AND   RGST_ID          = :DK-REGISTER              05990047
060000               AND   TRN_NBR          = :DK-TRANSACTION           06000047
060100               AND   STRT_TM          = :DK-START-TIME            06010047
060200               AND   SLS_CORR_SEQ_NBR = :DK-SALES-CORR-SEQ-NBR    06020047
060300               AND   TNDR_VOID_IND    <> 'Y'                      06030047
060400             ORDER BY TNDR_SEQ_NBR                                06040047
060500             WITH UR                                              06050047
060600     END-EXEC.                                                    06060047
060700                                                                  06070047
043700 LINKAGE SECTION.                                                 05100008
043800                                                                  05110008
043900 01  DFHCOMMAREA.                                                 05120008
044000     05  FILLER                         OCCURS  1 TO 4072 TIMES   05130008
044100                                        DEPENDING ON EIBCALEN.    05140008
044200         10  FILLER                     PIC X.                    05150008
044300                                                                  05160008
061000***************************************************************** 06100056
044500 PROCEDURE DIVISION.                                              05180008
061000***************************************************************** 06100056
044600                                                                  05190008
061000***************************************************************** 06100056
044700 0000-MAIN-MODULE.                                                05200008
061000***************************************************************** 06100056
044800                                                                  05210008
044900     INITIALIZE DP030-CICS-API-FIELDS.                            05220008
045000     MOVE +1                      TO DP030-NUMBER-OF-MAPS.        05230008
045100     MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.           05240008
045200     MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).          05250008
045300     SET DP030-RECEIVE-APPL-MAP   TO TRUE.                        05260008
045400     MOVE LENGTH OF SA405AI       TO DP030-MAP-LENGTH (1).        05270008
045500     MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).      05280008
045600     PERFORM 0001-CALL-CICS-ARCH-API.                             05290008
045700                                                                  05300008
045800     PERFORM 1000-CONTROL-PROCESSING.                             05310008
045900                                                                  05320008
046000     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      05330008
046100     PERFORM 0001-CALL-CICS-ARCH-API.                             05340008
046200                                                                  05350008
046300***************************************************************** 05360008
046800 0001-CALL-CICS-ARCH-API.                                         05410008
046400*    THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    05370008
046500*    AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          05380008
046600***************************************************************** 05390008
046900                                                                  05420008
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
054400                                    DFHCOMMAREA                           
054500                                    DP030-CICS-API-FIELDS                 
054600                                    DP020-STANDARD-COMMAREA               
054700                                    SA405AI.                              
047500                                                                  05480008
047600     IF  DP030-RC-CALL-SUCCESSFUL                                 05490008
047700         CONTINUE                                                 05500008
047800     ELSE                                                         05510008
047900         SET DP013-NO-ROLLBACK TO TRUE                            05520008
048000         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   05530008
048100         SET DP013-CICS-ABEND TO TRUE                             05540008
048200         MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH        05550008
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
048500         MOVE DP030-RETURN-CODE                                   05580008
048600                               TO DP013-MESSAGE-TEXT (3)          05590008
048700         PERFORM DP013-0000-PROCESS-ABEND                         05600008
048800     END-IF.                                                      05610008
048900                                                                  05620008
049000***************************************************************** 05630008
050000 1000-CONTROL-PROCESSING.                                         05730008
049100*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT    05640008
049200*    COURSE OF ACTION IS FOR THIS TRANSACTION.                    05650008
049300*                                                                 05660008
049400*    PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE       05670008
049500*    TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS   05680008
049600*    MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS  05690008
049700*    DEFAULT WILL BE OVERRIDDEN BY SCROLLING ACTIONS.             05700008
049800***************************************************************** 05710008
050100                                                                  05740008
050200     EVALUATE TRUE                                                05750008
050300        WHEN DP020-NEXT-ACT-INITIAL                               05760008
051000           PERFORM 1100-PROCESS-INTER-APPL-COMM                   05820008
069500           IF DP020-INT-APPL-FORMAT-IND                           06950047
069600                                   = PC-LIST-FORMAT-DIRECT        06960047
069700              EVALUATE TRUE                                       06970062
069800                 WHEN ASC-KOHLS-PAYMENT-TYPE                      06980061
069900                    MOVE PC-TSYMSG-01985                          06990061
070000                                   TO DP020-MSG-NUMBER            07000047
070100                    SET DP020-MSG-FATAL                           07010061
070200                                   TO TRUE                        07020047
070300                    SET DP020-NEXT-ACT-APPL-ERROR                 07030061
070400                                   TO TRUE                        07040047
070500                    SET SA001-ERR (ASC-TRAN-SEL-SUB)              07050061
070600                                   TO TRUE                        07060047
070700                    PERFORM 9200-REWRITE-LIST-QUEUE               07070061
070800                 WHEN ASC-INVALID-TYPE                            07080061
070900                    MOVE PC-TSYMSG-02419                          07090061
071000                                   TO DP020-MSG-NUMBER            07100061
071100                    SET DP020-MSG-FATAL                           07110061
071200                                   TO TRUE                        07120061
071300                    SET DP020-NEXT-ACT-APPL-ERROR                 07130061
071400                                   TO TRUE                        07140061
071500                    SET SA001-ERR (ASC-TRAN-SEL-SUB)              07150061
071600                                   TO TRUE                        07160061
071700                    PERFORM 9200-REWRITE-LIST-QUEUE               07170061
071800                 WHEN OTHER                                       07180061
071900                    SET SA001-INQ (ASC-TRAN-SEL-SUB)              07190061
072000                                   TO TRUE                        07200047
072100                    PERFORM 9200-REWRITE-LIST-QUEUE               07210061
072200                    PERFORM 4000-BUILD-INITIAL-PANEL              07220061
072300                                                                  07230047
072400                    IF PV-ROWS-FETCHED = ZERO                     07240061
072500                       MOVE PC-TSYMSG-02047                       07250061
072600                                   TO DP020-MSG-NUMBER            07260047
072700                       SET DP020-MSG-FATAL                        07270061
072800                                   TO TRUE                        07280047
072900                       SET DP020-NEXT-ACT-APPL-ERROR              07290061
073000                                   TO TRUE                        07300047
073100                       SET SA001-ERR (ASC-TRAN-SEL-SUB)           07310061
073200                                   TO TRUE                        07320047
073300                       PERFORM 9200-REWRITE-LIST-QUEUE            07330061
073400                    END-IF                                        07340062
073500              END-EVALUATE                                        07350061
073600           ELSE                                                   07360047
073700              PERFORM 4000-BUILD-INITIAL-PANEL                    07370047
073800              IF PV-ROWS-FETCHED = ZERO                           07380047
073900                 MOVE PC-TSYMSG-02047                             07390047
074000                                   TO DP020-MSG-NUMBER            07400047
074100                 SET DP020-MSG-FATAL                              07410047
074200                                   TO TRUE                        07420047
074300                 SET DP020-NEXT-ACT-APPL-ERROR                    07430047
074400                                   TO TRUE                        07440047
074500              END-IF                                              07450047
074600                                                                  07460047
074700           END-IF                                                 07470047
074800                                                                  07480047
051100*            PERFORM 4000-BUILD-INITIAL-PANEL                             
051300         WHEN DP020-NEXT-ACT-READ-MAP                             06080008
051400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06090008
051500                               TO PV-TOP-ITEM                     06100008
051600             PERFORM 2100-CHECK-FUNCTION-KEY                      06110008
051700                                                                  06120008
051800         WHEN DP020-NEXT-ACT-RETURN                               06130008
051900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06140008
052000                               TO PV-TOP-ITEM                     06150008
052100             MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL        06160008
052200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06170008
052300                                                                  06180008
052400         WHEN OTHER                                               06190008
052500             SET DP013-LOGIC-ABEND TO TRUE                        06200008
052600             SET DP013-NO-ROLLBACK TO TRUE                        06210008
052700             MOVE '1000-CONTROL-PROCESSING'                       06220008
052800                               TO  DP013-PARAGRAPH                06230008
052900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06240008
053000                               TO  DP013-MESSAGE-TEXT(1)          06250008
053100             PERFORM DP013-0000-PROCESS-ABEND                     06260008
053200     END-EVALUATE.                                                06270008
053300                                                                  06280008
053500***************************************************************** 06300008
054000 1100-PROCESS-INTER-APPL-COMM.                                    06350008
053600*    DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR  06310008
053700*    IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.            06320008
053800***************************************************************** 06330008
054100                                                                  06360008
050400     INITIALIZE ASC-SPECIFIC-COMMAREA.                            05770008
050500     SET ASC-LEFT-VIEW                TO TRUE.                            
050600     MOVE EIBTRMID                    TO ASC-DTL-TERM-ID.         05780008
050700     MOVE DP020-SRC-TASK-NUMBER       TO ASC-DTL-TASK-NUMBER.     05790008
050900     MOVE PC-DTL-QUEUE-SEQ            TO ASC-DTL-SEQ              05810008
054300     MOVE SPACE                       TO ASC-START-ITEM-REQUEST.  06380008
054100                                                                  06360008
054400     EVALUATE TRUE                                                06390008
054500        WHEN DP020-INT-APPL-FORMAT-IND                            06400008
054600                                   = PC-LIST-FORMAT               06410008
054500        WHEN DP020-INT-APPL-FORMAT-IND                            06400008
054600                                   = PC-LIST-FORMAT-DIRECT        06410008
054700           MOVE SA004-NUMBER-OF-SELECTED-ITEMS                    06420008
054800                                   TO ASC-NBR-OF-TRAN-SEL-ITEMS   06430008
054900           MOVE SA004-NUMBER-OF-TS-ITEMS                          06440008
055000                                   TO ASC-NBR-OF-TRAN-TS-ITEMS    06450008
055100           MOVE SA004-SEL-QUEUE-NAME                              06460008
055200                                   TO ASC-TRAN-SEL-QUEUE-NAME     06470008
055300           MOVE SA004-SALES-DATE-ISO                              06480008
055400                                   TO ASC-KEY-SALES-DATE-ISO      06490008
055500                                      DK-SALES-DATE                       
055600           MOVE SA004-SALES-DATE-DISPLAY                          06500008
055700                                   TO ASC-SALES-DATE-DISPLAY      06510008
055800           PERFORM 1120-PREPARE-LIST-ENTRY                        06520008
055900                                                                  06530008
056000        WHEN OTHER                                                06540008
056100           SET DP013-LOGIC-ABEND TO TRUE                          06550008
056200           SET DP013-NO-ROLLBACK TO TRUE                          06560008
056300           MOVE '1100-PROCESS-INTER-APPL-COMM'                    06570008
056400                                   TO DP013-PARAGRAPH             06580008
056500           MOVE 'INVALID INTER APPL FORMAT INDICATOR'             06590008
056600                                   TO DP013-MESSAGE-TEXT(1)       06600008
056700           PERFORM DP013-0000-PROCESS-ABEND                       06610008
056900     END-EVALUATE.                                                06630008
057000                                                                  06640008
057100***************************************************************** 06650008
057400 1120-PREPARE-LIST-ENTRY.                                         06690008
057200*    GET READY TO START AT THE FIRST ITEM ON THE LIST.            06660008
057300***************************************************************** 06670008
057500                                                                  06700008
057600     MOVE SA001-MAX-ITEMS TO ASC-TRAN-SEL-SUB.                    06710008
057700     MOVE ZERO            TO ASC-TRAN-SEL-ITEM.                   06720008
057800     PERFORM 2140-GET-NEXT-MESSAGE.                               06730008
057900                                                                  06740008
069000******************************************************************07780008
069300 2050-DELETE-DETAIL-QUEUE.                                        07820008
069100*    DELETE THE TEMPORARY STORAGE QUEUE.                          07790008
069200******************************************************************07800008
069400                                                                  07830008
069500     EXEC CICS                                                    07840008
069600         DELETEQ TS                                               07850008
069700             QUEUE (ASC-DTL-QUEUE-NAME)                           07860008
069800             RESP  (PV-CICS-RESP)                                 07870008
069900     END-EXEC.                                                    07880008
070000                                                                  07890008
070100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07900008
070200        (PV-CICS-RESP = DFHRESP(QIDERR))                          07910008
070300         CONTINUE                                                 07920008
070400     ELSE                                                         07930008
070500         SET DP013-CICS-ABEND TO TRUE                             07940008
070600         SET DP013-NO-ROLLBACK TO TRUE                            07950008
070700                                                                  07960008
070800         MOVE '2050-DELETE-DETAIL-QUEUE' TO DP013-PARAGRAPH       07970008
070900         MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'  07980008
071000                        TO DP013-MESSAGE-TEXT (1)                 07990008
071100         PERFORM DP013-0000-PROCESS-ABEND                         08000008
071200     END-IF.                                                      08010008
071300                                                                  08020008
071400     MOVE +0 TO ASC-HIGHEST-BLOCK-WRITTEN.                        08030008
071500                                                                  08040008
058000******************************************************************06750008
058400 2100-CHECK-FUNCTION-KEY.                                         06800008
058100*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED  06760008
058200*    ON WHAT FUNCTION KEY WAS SELECTED.                           06770008
058300******************************************************************06780008
058500                                                                  06810008
058600     EVALUATE TRUE                                                06820008
058700         WHEN DP020-SRC-AID = DP016-CLEAR                         06830008
058800             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                06840008
058900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06850008
059000             PERFORM 3200-RESET-ATTRIBUTES                        06860008
059100                                                                  06870008
059200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06880008
059300             SET ASC-LEFT-VIEW     TO TRUE                                
059400             MOVE ASC-KEY-PARTITION                               06890008
059500                                   TO DK-PARTITION                06900008
059600             MOVE ASC-KEY-STORE                                   06910008
059700                                   TO DK-STORE                    06920008
059800             MOVE ASC-KEY-REGISTER                                06930008
059900                                   TO DK-REGISTER                 06940008
060000             MOVE ASC-KEY-TRANSACTION                             06950008
060100                                   TO DK-TRANSACTION              06960008
060200             MOVE ASC-KEY-START-TIME                              06970008
060300                                   TO DK-START-TIME               06980008
060400             MOVE ASC-KEY-SALES-CORR-SEQ-NBR                      06990008
060500                                   TO DK-SALES-CORR-SEQ-NBR       07000008
060600             MOVE ASC-KEY-SALES-DATE-ISO                                  
060700                                   TO DK-SALES-DATE                       
060800             PERFORM 2050-DELETE-DETAIL-QUEUE                     07010008
060900             PERFORM 4000-BUILD-INITIAL-PANEL                     07020008
061000             PERFORM 3200-RESET-ATTRIBUTES                        07030008
061100                                                                  07040008
061200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07050008
061300             IF  ASC-USE-SELECTION-QUEUE                          07060008
061400                 CONTINUE                                         07070008
061500                 PERFORM 2140-GET-NEXT-MESSAGE                    07080008
061600                 IF PS-LIST-END                                   07090008
061700                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07100008
061800                     SET PS-NO-LIST-END TO TRUE                   07110008
061900                 ELSE                                             07120008
062000                     PERFORM 2050-DELETE-DETAIL-QUEUE             07130008
062100                     PERFORM 4000-BUILD-INITIAL-PANEL             07140008
062200                 END-IF                                           07150008
062300                 PERFORM 3200-RESET-ATTRIBUTES                    07160008
062400             ELSE                                                 07170008
062500                 MOVE PC-TSYMSG-00070                             07180008
062600                                  TO DP020-MSG-NUMBER             07190008
062700                 SET DP020-MSG-INFORMATIONAL TO TRUE              07200008
062800             END-IF                                               07210008
062900                                                                  07220008
063000         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07230008
063100             IF  ASC-USE-SELECTION-QUEUE                          07240008
063200                 PERFORM 2150-GET-PREV-MESSAGE                    07250008
063300                 IF PS-LIST-END                                   07260008
063400                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07270008
063500                     SET PS-NO-LIST-END TO TRUE                   07280008
063600                 ELSE                                             07290008
063700                     PERFORM 2050-DELETE-DETAIL-QUEUE             07300008
063800                     PERFORM 4000-BUILD-INITIAL-PANEL             07310008
063900                 END-IF                                           07320008
064000                 PERFORM 3200-RESET-ATTRIBUTES                    07330008
064100             ELSE                                                 07340008
064200                 MOVE PC-TSYMSG-00069                             07350008
064300                                  TO DP020-MSG-NUMBER             07360008
064400                 SET DP020-MSG-INFORMATIONAL TO TRUE              07370008
064500             END-IF                                               07380008
064600                                                                  07390008
064700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07400008
064800             MOVE +1 TO PV-TOP-ITEM                               07410008
064900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07420008
065000             PERFORM 3200-RESET-ATTRIBUTES                        07430008
065100                                                                  07440008
065200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07450008
065300             PERFORM 2110-BROWSE-BACKWARD                         07460008
065400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07470008
065500             PERFORM 3200-RESET-ATTRIBUTES                        07480008
065600                                                                  07490008
065700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07500008
065800             PERFORM 2120-BROWSE-FORWARD                          07510008
065900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07520008
066000             PERFORM 3200-RESET-ATTRIBUTES                        07530008
066100                                                                  07540008
066200         WHEN DP020-SRC-AID = DP016-ENTER                         07550008
066300             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07560008
066400             IF  PS-ERROR                                         07570008
066500                 CONTINUE                                         07580008
066600             ELSE                                                 07590008
066700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07600008
066800                 PERFORM 3200-RESET-ATTRIBUTES                    07610008
066900             END-IF                                               07620008
067000                                                                  07630008
067100         WHEN DP020-FK-LEFT (DP020-SRC-AID)                       13840099
067200             SET ASC-LEFT-VIEW  TO TRUE                           13850099
067300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13860099
067400                                                                  13870099
067500         WHEN DP020-FK-RIGHT (DP020-SRC-AID)                      13880099
067600             SET ASC-RIGHT-VIEW TO TRUE                           13890099
067700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13900099
067800                                                                  13910099
067500         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              13880099
067600             SET DP030-CONTINUE-GO                                13890099
067700                                  TO TRUE                         13900099
067800                                                                  13910099
067900         WHEN OTHER                                               07670008
068000             SET DP013-NO-ROLLBACK TO TRUE                        07680008
068100             SET DP013-XCTL-DISPLAY-RESTART TO TRUE               07690008
068200             SET DP013-CICS-ABEND TO TRUE                         07700008
068300             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    07710008
068400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07720008
068500                                   TO DP013-MESSAGE-TEXT (1)      07730008
068600             PERFORM DP013-0000-PROCESS-ABEND                     07740008
068700                                                                  07750008
068800     END-EVALUATE.                                                07760008
068900                                                                  07770008
071600******************************************************************08050008
072200 2110-BROWSE-BACKWARD.                                            08120008
071700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP      08060008
071800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,       08070008
071900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST    08080008
072000*    MESSAGE.                                                     08090008
072100******************************************************************08100008
072300                                                                  08130008
072400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08140008
072500         GIVING PV-TOP-ITEM.                                      08150008
072600                                                                  08160008
072700     IF  PV-TOP-ITEM < +1                                         08170008
072800         MOVE +1              TO PV-TOP-ITEM                      08180008
072900*        -- TOP OF LIST --                                        08190008
073000         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                 08200008
073100         SET DP020-MSG-INFORMATIONAL TO TRUE                      08210008
073200     END-IF.                                                      08220008
073300                                                                  08230008
073400******************************************************************08260008
073900 2120-BROWSE-FORWARD.                                             08320008
073500*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP       08270008
073600*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO    08280008
073700*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.              08290008
073800******************************************************************08300008
074000                                                                  08330008
074100     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08340008
074200         GIVING PV-TOP-ITEM.                                      08350008
074300     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08360008
074400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08370008
074500                                   TO PV-TOP-ITEM                 08380008
074600*        -- BOTTOM OF LIST --                                     08390008
074700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08400008
074800         SET DP020-MSG-INFORMATIONAL                              08410008
074900                                   TO TRUE                        08420008
075000     ELSE                                                         08430008
075100         COMPUTE PV-BOTTOM-ITEM =                                 08440008
075200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08450008
075300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08460008
075400*            -- BOTTOM OF LIST --                                 08470008
075500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08480008
075600             SET DP020-MSG-INFORMATIONAL                          08490008
075700                                   TO TRUE                        08500008
075800         END-IF                                                   08510008
075900     END-IF.                                                      08520008
076000                                                                  08530008
076100******************************************************************08540008
076900 2130-CHECK-FOR-JUMP-BROWSE.                                      08630008
076200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO     08550008
076300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.    08560008
076400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST   08570008
076500*    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.       08580008
076600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT      08590008
076700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.           08600008
076800******************************************************************08610008
077000                                                                  08640008
077100     IF ASTRTITL > ZERO                                           08650008
077200         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      08660008
077300     ELSE                                                         08670008
077400         IF ASTRTITF = DP015-ERASE-EOF                            08680008
077500             INITIALIZE ASC-START-ITEM-REQUEST                    08690008
077600         END-IF                                                   08700008
077700     END-IF.                                                      08710008
077800                                                                  08720008
077900     SET PS-NO-ERROR               TO TRUE.                       08730008
078000     IF (ASC-START-ITEM-REQUEST = SPACE)                          08740008
078100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08750008
078200                                   TO PV-TOP-ITEM                 08760008
078300     ELSE                                                         08770008
078400         MOVE ASC-START-ITEM-REQUEST                              08780008
078500                                   TO DP010I-UNEDITED-FIELD       08790008
078600         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08800008
078700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08810008
078800         SET DP010I-NEGATIVE-NOT-ALLOWED                          08820008
078900                                   TO TRUE                        08830008
139218         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
139218                         USING DP010I-NUMERIC-EDIT-AREA                   
079100                                                                  08850008
079200         IF  NOT DP010I-ERROR-DETECTED                            08860008
079300             MOVE DP010I-NUMERIC-FIELD                            08870008
079400                                   TO  ASC-START-ITEM-REQUEST-N   08880008
079500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08890008
079600                 IF  ASC-START-ITEM-REQUEST-N >                   08900008
079700                                          ASC-NUMBER-OF-ITEMS-READ08910008
079800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08920008
079900                     COMPUTE PV-TOP-ITEM =                        08930008
080000                             ASC-NUMBER-OF-ITEMS-READ             08940008
080100                             - PC-ITEMS-PER-PANEL + 1             08950008
080200                     IF  PV-TOP-ITEM < +1                         08960008
080300                         MOVE +1   TO PV-TOP-ITEM                 08970008
080400                         MOVE PC-TSYMSG-00070                     08980008
080500                                   TO DP020-MSG-NUMBER            08990008
080600                         SET DP020-MSG-INFORMATIONAL              09000008
080700                                   TO TRUE                        09010008
080800                     END-IF                                       09020008
080900                 ELSE                                             09030008
081000                     MOVE ASC-START-ITEM-REQUEST-N                09040008
081100                                   TO PV-TOP-ITEM                 09050008
081200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09060008
081300                     COMPUTE PV-BOTTOM-ITEM =                     09070008
081400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09080008
081500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09090008
081600*                        -- BOTTOM OF LIST --                     09100008
081700                         MOVE PC-TSYMSG-00070                     09110008
081800                                   TO DP020-MSG-NUMBER            09120008
081900                         SET DP020-MSG-INFORMATIONAL              09130008
082000                                   TO TRUE                        09140008
082100                     END-IF                                       09150008
082200                 END-IF                                           09160008
082300             ELSE                                                 09170008
082400*                --- VALUE OUT OF RANGE ----                      09180008
082500                 MOVE PC-TSYMSG-00101                             09190008
082600                                   TO DP020-MSG-NUMBER            09200008
082700                 MOVE -1           TO ASTRTITL                    09210008
082800                 SET DP030-SET-CURSOR-APPL-1                      09220008
082900                                   TO TRUE                        09230008
083000                 MOVE DP015-REVERSE                               09240008
083100                                   TO ASTRTITH                    09250008
083200                 MOVE DP015-RED    TO ASTRTITC                    09260008
083300                 MOVE DP015-UNP-NUM-BRT-MDT                       09270008
083400                                   TO ASTRTITA                    09280008
083500                 SET DP020-MSG-FATAL                              09290008
083600                                   TO TRUE                        09300008
083700                 SET PS-ERROR      TO TRUE                        09310008
083800             END-IF                                               09320008
083900                                                                  09330008
084000         ELSE                                                     09340008
084100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09350008
084200             MOVE -1               TO ASTRTITL                    09360008
084300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09370008
084400             MOVE DP015-REVERSE    TO ASTRTITH                    09380008
084500             MOVE DP015-RED        TO ASTRTITC                    09390008
084600             MOVE DP015-UNP-NUM-BRT-MDT                           09400008
084700                                   TO ASTRTITA                    09410008
084800             SET DP020-MSG-FATAL   TO TRUE                        09420008
084900             SET PS-ERROR          TO TRUE                        09430008
085000         END-IF                                                   09440008
085100     END-IF.                                                      09450008
085300                                                                  09470008
085400******************************************************************09480008
085800 2140-GET-NEXT-MESSAGE.                                           09530008
085500*    GET THE NEXT MESSAGE IF A LIST OF MESSAGES IS BEING          09490008
085600*    PROCESSED.                                                   09500008
085700******************************************************************09510008
085900                                                                  09540008
086000     ADD +1                       TO ASC-TRAN-SEL-SUB.            09550008
086100     IF  ASC-TRAN-SEL-SUB         > SA001-MAX-ITEMS               09560008
086200         ADD +1                   TO ASC-TRAN-SEL-ITEM            09570008
086300         MOVE +1                  TO ASC-TRAN-SEL-SUB             09580008
086400     END-IF.                                                      09590008
086500     IF  ASC-TRAN-SEL-ITEM NOT > ASC-NBR-OF-TRAN-TS-ITEMS         09600008
086600         PERFORM 9100-READ-TRAN-SEL-QUEUE                         09610008
086700         IF  SA001-STORE (ASC-TRAN-SEL-SUB) > ZERO                09620008
086800             MOVE SA001-PARTITION (ASC-TRAN-SEL-SUB)              09630008
086900                                   TO DK-PARTITION                09640008
087000                                      ASC-KEY-PARTITION           09650008
087100             MOVE SA001-STORE (ASC-TRAN-SEL-SUB)                  09660008
087200                                   TO ASC-KEY-STORE               09670008
087300                                      DK-STORE                    09680008
087400             MOVE SA001-REGISTER (ASC-TRAN-SEL-SUB)               09690008
087500                                   TO ASC-KEY-REGISTER            09700008
087600                                      DK-REGISTER                 09710008
087700             MOVE SA001-TRANS (ASC-TRAN-SEL-SUB)                  09720008
087800                                   TO ASC-KEY-TRANSACTION         09730008
087900                                      DK-TRANSACTION              09740008
088000             MOVE SA001-ID (ASC-TRAN-SEL-SUB)                     09750008
088100                                   TO ASC-KEY-ID                  09760008
088200             MOVE SA001-START-TIME (ASC-TRAN-SEL-SUB)             09770008
088300                                   TO ASC-KEY-START-TIME          09780008
088400                                      DK-START-TIME               09790008
088500             MOVE SA001-SALES-CORR-SEQ-NBR (ASC-TRAN-SEL-SUB)     09800008
088600                                   TO ASC-KEY-SALES-CORR-SEQ-NBR  09810008
088700                                      DK-SALES-CORR-SEQ-NBR       09820008
088900             PERFORM 9000-SET-TRAN-TIME-DISPLAY                   09830008
089000             MOVE SA001-TYPE (ASC-TRAN-SEL-SUB)                   09840008
089100                                   TO ASC-KEY-TYPE                09850008
089200         ELSE                                                     09890008
089300             SUBTRACT +1 FROM ASC-TRAN-SEL-SUB                    09900008
089400             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             09910008
089500             SET DP020-MSG-INFORMATIONAL TO TRUE                  09920008
089600             SET PS-LIST-END             TO TRUE                  09930008
089700         END-IF                                                   09940008
089800     ELSE                                                         09950008
089900         SUBTRACT +1 FROM ASC-TRAN-SEL-ITEM                       09960008
090000         MOVE SA001-MAX-ITEMS     TO ASC-TRAN-SEL-SUB             09970008
090100         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             09980008
090200         SET DP020-MSG-INFORMATIONAL TO TRUE                      09990008
090300         SET PS-LIST-END             TO TRUE                      10000008
090400     END-IF.                                                      10010008
090500                                                                  10020008
090600******************************************************************10030008
091000 2150-GET-PREV-MESSAGE.                                           10080008
090700*    GET THE PREVIOUS MESSAGE IF A LIST OF MESSAGES IS BEING      10040008
090800*    PROCESSED.                                                   10050008
090900******************************************************************10060008
091100                                                                  10090008
091200     SUBTRACT +1 FROM ASC-TRAN-SEL-SUB.                           10100008
091300     IF  ASC-TRAN-SEL-SUB < +1                                    10110008
091400         SUBTRACT +1 FROM ASC-TRAN-SEL-ITEM                       10120008
091500         MOVE SA001-MAX-ITEMS     TO ASC-TRAN-SEL-SUB             10130008
091600     END-IF.                                                      10140008
091700                                                                  10150008
091800     IF  ASC-TRAN-SEL-ITEM > ZERO                                 10160008
091900         PERFORM 9100-READ-TRAN-SEL-QUEUE                         10170008
092000         MOVE SA001-PARTITION (ASC-TRAN-SEL-SUB)                  10180008
092100                                   TO DK-PARTITION                10190008
092200                                      ASC-KEY-PARTITION           10200008
092300         MOVE SA001-STORE (ASC-TRAN-SEL-SUB)                      10210008
092400                                   TO ASC-KEY-STORE               10220008
092500                                      DK-STORE                    10230008
092600         MOVE SA001-REGISTER (ASC-TRAN-SEL-SUB)                   10240008
092700                                   TO ASC-KEY-REGISTER            10250008
092800                                      DK-REGISTER                 10260008
092900         MOVE SA001-TRANS (ASC-TRAN-SEL-SUB)                      10270008
093000                                   TO ASC-KEY-TRANSACTION         10280008
093100                                      DK-TRANSACTION              10290008
093200         MOVE SA001-ID (ASC-TRAN-SEL-SUB)                         10300008
093300                                   TO ASC-KEY-ID                  10310008
093400         MOVE SA001-START-TIME (ASC-TRAN-SEL-SUB)                 10320008
093500                                   TO ASC-KEY-START-TIME          10330008
093600                                      DK-START-TIME               10340008
093700         MOVE SA001-SALES-CORR-SEQ-NBR (ASC-TRAN-SEL-SUB)         10350008
093800                                   TO ASC-KEY-SALES-CORR-SEQ-NBR  10360008
093900                                      DK-SALES-CORR-SEQ-NBR       10370008
094000     ELSE                                                         10380008
094100         MOVE +1                  TO ASC-TRAN-SEL-ITEM            10390008
094200                                     ASC-TRAN-SEL-SUB             10400008
094300         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             10410008
094400         SET DP020-MSG-INFORMATIONAL TO TRUE                      10420008
094500         SET PS-LIST-END             TO TRUE                      10430008
094600     END-IF.                                                      10440008
094700                                                                  10450008
094800******************************************************************10470008
094900*    RESET ATTRIBUTES.                                            10480008
095000******************************************************************10490008
095100 3200-RESET-ATTRIBUTES.                                           10510008
095200                                                                  10520008
095300     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   10530008
095400     MOVE DP015-GREEN              TO ASTRTITC.                   10540008
095500     MOVE DP015-UNDERLINE          TO ASTRTITH.                   10550008
095600     MOVE -1                       TO ASTRTITL.                   10560008
095700     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       10570008
095800                                                                  10580008
095900******************************************************************10610008
096000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                         10620008
096100*    INITIALIZE ALL COUNTERS AND FLAGS.                           10630008
096200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.   10640008
096300*    DISPLAY THE PANEL TO USER.                                   10650008
096400******************************************************************10660008
096500 4000-BUILD-INITIAL-PANEL.                                        10680008
096600                                                                  10690008
096700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            10700008
096800                                 ASC-BLOCK-ENTRIES (2).           10710008
096900     MOVE +1                 TO  ASC-BLK-SUB.                     10720008
097000     SET ASC-ITEMS-LEFT-ON-DB                                     10730008
097100                             TO  TRUE.                            10740008
097200                                                                  10750008
097300     MOVE +0                 TO  ASC-ITEM-SUB                     10760008
097400                                 ASC-NUMBER-OF-ITEMS-READ         10770008
097500                                 ASC-NUMBER-OF-SELECTED-ITEMS     10780008
097600                                 ASC-HIGHEST-BLOCK-WRITTEN        10790008
097700                                 ASC-START-OF-SELECTED-RANGE      10800008
097800                                 ASC-END-OF-SELECTED-RANGE        10810008
097900                                 ASC-ITEM-AT-TOP-OF-PANEL.        10820008
098000                                                                  10830008
           PERFORM 4500-FIND-ASSOC-ID.                                          
098100     PERFORM 4010-OPEN-CURSOR.                                    10840008
098200                                                                  10850008
098300     PERFORM 4300-READ-ITEMS-FROM-DB.                             10860008
098400                                                                  10870008
098500     PERFORM 4020-CLOSE-CURSOR.                                   10880008
098600                                                                  10890008
098700     MOVE +1                 TO  PV-TOP-ITEM.                     10900008
098800     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          10910008
098900         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    10920008
099000         SET DP020-MSG-FATAL   TO  TRUE                           10930008
099100         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               10940008
099200     ELSE                                                         10950008
099300         MOVE -1             TO ASTRTITL                          10960008
099400         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      10970008
099500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     10980008
099600     END-IF.                                                      10990008
099700                                                                  11000008
099800******************************************************************11010008
099900* OPEN THE CURSOR.                                                11020008
100000******************************************************************11030008
100100 4010-OPEN-CURSOR.                                                11050008
100200                                                                  11060008
100300     PERFORM                                                      11070008
100400         WITH TEST AFTER                                          11080008
100500         VARYING PV-RETRY-COUNTER                                 11090008
100600         FROM 1 BY 1                                              11100008
100700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11110008
100800                   OR (SQLCODE = ZERO))                           11120008
100900                                                                  11130008
101000                 MOVE 'CURSOR:  ITEMS'                            11140008
101100                                   TO DP013-MESSAGE-TEXT (2)      11150008
101300                 EXEC SQL                                         11160008
101400                      OPEN TENDER-OPER-CSR                        11170008
101500                 END-EXEC                                         11180008
102100                                                                  11210008
102200         EVALUATE TRUE                                            11220008
102300             WHEN SQLCODE = ZERO                                  11230008
102400             WHEN SQLCODE = -904                                  11240008
102500             WHEN SQLCODE = -913                                  11250008
102600                 CONTINUE                                         11260008
102700             WHEN SQLWARN0 NOT = SPACES                           11270008
102800             WHEN SQLCODE < ZERO                                  11280008
102900             WHEN SQLCODE > ZERO                                  11290008
103000                 MOVE '4010-OPEN-CURSOR'                          11300008
103100                                   TO DP013-PARAGRAPH             11310008
103200                 MOVE 'OPEN TENDER CURSOR  '                      11320008
103300                                   TO DP013-MESSAGE-TEXT (1)      11330008
103400                 MOVE SQLCA        TO DP013-SQLCA                 11340008
103500                 MOVE 'TEPTND  '   TO DP013-DB2-TABLE-NAME (1)    11350008
103600                 SET DP013-DB2-ABEND                              11360008
103700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11370008
103800                 PERFORM DP013-0000-PROCESS-ABEND                 11380008
103900         END-EVALUATE                                             11390008
104000     END-PERFORM.                                                 11400008
104100                                                                  11410008
104200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11420008
104300         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             11430008
104400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   11440008
104500                                   TO DP013-MESSAGE-TEXT (1)      11450008
104600         MOVE SQLCA                TO DP013-SQLCA                 11460008
104700         MOVE 'TEPTND '            TO DP013-DB2-TABLE-NAME (1)    11470008
104800         SET DP013-DB2-ABEND                                      11480008
104900             DP013-XCTL-DISPLAY-RESTART                           11490008
105000                                   TO TRUE                        11500008
105100         PERFORM DP013-0000-PROCESS-ABEND                         11510008
105200     END-IF.                                                      11520008
105300                                                                  11530008
105400******************************************************************11540008
105700 4020-CLOSE-CURSOR.                                               11580008
105500*     CLOSE THE CURSOR.                                           11550008
105600*********-********************************************************11560008
105800                                                                  11590008
105900     MOVE 'CURSOR:  ITEMS'         TO DP013-MESSAGE-TEXT (2).     11600008
106100     EXEC SQL                                                     11610008
106200         CLOSE TENDER-OPER-CSR                                    11620008
106300     END-EXEC.                                                    11630008
106900                                                                  11640008
107000     EVALUATE TRUE                                                11650008
107100         WHEN SQLCODE = ZERO                                      11660008
107200             CONTINUE                                             11670008
107300         WHEN SQLWARN0 NOT = SPACES                               11680008
107400         WHEN SQLCODE < ZERO                                      11690008
107500         WHEN SQLCODE > ZERO                                      11700008
107600             MOVE '4020-CLOSE-CURSOR'                             11710008
107700                               TO DP013-PARAGRAPH                 11720008
107800             MOVE 'CLOSE TENDER CURSOR '                          11730008
107900                               TO DP013-MESSAGE-TEXT (1)          11740008
108000             MOVE SQLCA        TO DP013-SQLCA                     11750008
108100             MOVE 'TEPTND '    TO DP013-DB2-TABLE-NAME (1)                
108200             SET DP013-DB2-ABEND                                  11770008
108300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               11780008
108400             PERFORM DP013-0000-PROCESS-ABEND                     11790008
108500     END-EVALUATE.                                                11800008
108600                                                                  11810008
105400******************************************************************11540008
169800 4200-FORMAT-TENDER-ID.                                           16980047
105500*     FORMAT TENDER ID.                                           11550008
105600*********-********************************************************11560008
169900                                                                  16990047
170000     SET PS-TENDER-ID-NOT-NUMERIC  TO TRUE.                       17000047
170100     MOVE PV-TENDER-ID             TO DP010I-UNEDITED-FIELD.      17010047
170200     MOVE LENGTH OF PV-TENDER-ID   TO DP010I-MAXIMUM-DIGITS.      17020047
170300     MOVE 0                        TO DP010I-MAXIMUM-DECIMALS.    17030047
170400     SET DP010I-NEGATIVE-NOT-ALLOWED                              17040047
170500                                   TO TRUE.                       17050047
170600     CALL DP010I-NUMERIC-EDIT-ROUTINE                             17060047
170700         USING DP010I-NUMERIC-EDIT-AREA.                          17070047
170800     IF DP010I-ERROR-DETECTED                                     17080047
170900         CONTINUE                                                 17090047
171000     ELSE                                                         17100047
171100         SET PS-TENDER-ID-NUMERIC  TO TRUE                        17110047
171200         EVALUATE TRUE                                            17120047
171300             WHEN SA012-KOHLS-CHARGE                              17130047
171400                 IF EPTND-TNDR-ID-LEN-NBR = PC-KOHLS-CREDIT-LEN-1217140047
171500                     SET PS-KOHLS-LENGTH-IS-12                    17150047
171600                                   TO TRUE                        17160047
171700                     MOVE DP010I-NUM-FIELD-17-DIG-0-DEC           17170047
171800                                   TO PV-KOHLS-TENDER-ID-FMT-12   17180047
171900                 ELSE                                             17190047
172000                     SET PS-KOHLS-LENGTH-IS-NOT-12                17200047
172100                                   TO TRUE                        17210047
172200                     MOVE DP010I-NUM-FIELD-17-DIG-0-DEC           17220047
172300                                   TO PV-KOHLS-TENDER-ID-FMT-10   17230047
172400                 END-IF                                           17240047
172500                                                                  17250047
172600             WHEN SA012-GIFT-CERTIFICATE                          17260047
172700                                                                  17270047
172800* GIFT CARDS AND GIFT CERTIFICATES FALL UNDER THE SAME TENDER     17280047
172900* TYPE.  THIS SECTION DETERMINES IF WE HAVE A GIFT CARD OR CERT   17290047
173000* BY COMPARING THE ID NUBMER AGAINST THE GIFT CARD CONSTANTS.     17300047
173100                                                                  17310047
173200                 MOVE ZERO         TO PV-TENDER-ID-N              17320047
173300                 IF EPTND-TNDR-ID-LEN-NBR                         17330047
173400                                   >= PC-MIN-STORED-VALUE-LEN     17340047
173500                     MOVE DP010I-NUM-FIELD-17-DIG-0-DEC           17350047
173600                                   TO PV-TENDER-ID-N              17360047
173700                     MOVE PV-TENDER-ID-N                          17370047
173800                                   TO PV-TENDER-ID-FORMATTED      17380047
173900                 ELSE                                             17390047
174000                     MOVE DP010I-NUM-FIELD-17-DIG-0-DEC           17400047
174100                                   TO PV-GIFT-CERT-FMT            17410047
174200                 END-IF                                           17420047
174300                                                                  17430047
174400             WHEN SA012-AMERICAN-EXPRESS                          17440047
174500                 MOVE DP010I-NUM-FIELD-17-DIG-0-DEC               17450047
174600                                   TO PV-AMEX-TENDER-ID-FMT       17460047
174700                                                                  17470047
174800             WHEN OTHER                                           17480047
174900                 MOVE DP010I-NUM-FIELD-17-DIG-0-DEC               17490047
175000                                   TO PV-TENDER-ID-FORMATTED      17500047
175100         END-EVALUATE                                             17510047
175200     END-IF.                                                      17520047
175300                                                                  17530047
108700******************************************************************11820008
109800 4300-READ-ITEMS-FROM-DB.                                         11940008
108800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE     11830008
108900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,      11840008
109000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND   11850008
109100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE      11860008
109200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                    11870008
109300*                                                                 11880008
109400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE     11890008
109500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM   11900008
109600*    UPON INITIALIZATION.                                         11910008
109700******************************************************************11920008
109900                                                                  11950008
110000     PERFORM                                                      11970008
110100         VARYING PV-READ-COUNT                                    11980008
110200         FROM 1 BY 1                                              11990008
110300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    12000008
110400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         12010008
110500                                                                  12020008
110600         PERFORM 4310-FETCH                                       12030008
110700         IF ASC-ITEMS-LEFT-ON-DB                                          
110800             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        
110900                 ADD +1            TO ASC-ITEM-SUB                        
111000             ELSE                                                         
111100                 ADD +1            TO ASC-BLK-SUB                         
111200                 MOVE +1           TO ASC-ITEM-SUB                        
111300                                                                          
111400                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 
111500                     MOVE +1       TO ASC-BLK-SUB                         
111600                     PERFORM 5100-WRITE-TEMP-STORAGE                      
111700                     MOVE ASC-BLOCK-ENTRIES                               
111800                                   (PC-MAX-BLOCKS-IN-ARRAY)               
111900                                   TO ASC-BLOCK-ENTRIES                   
112000                                      (ASC-BLK-SUB)                       
112100                     ADD +1        TO ASC-BLK-SUB                         
112200                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           
112300                 END-IF                                                   
112400             END-IF                                                       
112500             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ            
112600             MOVE ASC-NUMBER-OF-ITEMS-READ                                
112700                                   TO ASC-LIST-ITEM-NUMBER                
112800                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
112900             MOVE EPTND-TNDR-AMT   TO ASC-TENDER-AMOUNT                   
113000                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
113100             MOVE EPTND-TNDR-TYP-CDE                                      
113200                                   TO SA012-TNDR-TYP-CDE                  
114500             EVALUATE TRUE                                                
114600                 WHEN SA012-CASH                                          
114800                     MOVE 'CASH'   TO ASC-TENDER-TYPE                     
114900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
114600                 WHEN SA012-CHECK                                         
114700                 WHEN SA012-CASHIER-CHECK                                 
114800                     MOVE 'CHECK'  TO ASC-TENDER-TYPE                     
114900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
113400                     MOVE EPTND-TNDR-ID (28:6)                            
113500                                   TO PV-TENDER-ID                        
113700                     MOVE EPTND-TNDR-ID                                   
113800                                   TO ASC-MICR-NBR                        
113900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
114400                     PERFORM 4200-FORMAT-TENDER-ID                        
113600                     IF PS-TENDER-ID-NUMERIC                      11360047
113700                        MOVE PV-TENDER-ID-FORMATTED               11370047
113800                                   TO ASC-ID-NBR                  11380047
114900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
114000                     ELSE                                         11400047
114100                        MOVE PV-TENDER-ID                         11410047
113800                                   TO ASC-ID-NBR                  11380047
114900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
114300                     END-IF                                       11430047
115000                 WHEN SA012-MERCHANDISE-CARD                              
115100                     MOVE 'KMRC'   TO ASC-TENDER-TYPE                     
115200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
118100                     MOVE EPTND-TNDR-ID (1:EPTND-TNDR-ID-LEN-NBR) 11810047
118200                                   TO PV-TENDER-ID                11820047
118300                     PERFORM 4200-FORMAT-TENDER-ID                11830047
118400                     IF PS-TENDER-ID-NUMERIC                      11840047
118500                        MOVE PV-TENDER-ID-FORMATTED               11850047
113800                                   TO ASC-ID-NBR                  11380047
114900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
118800                     ELSE                                         11880047
118900                        MOVE EPTND-TNDR-ID                        11890047
113800                                   TO ASC-ID-NBR                  11380047
114900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
118800                     END-IF                                       11880047
115300                 WHEN SA012-KOHLS-CHARGE                                  
115400                     MOVE 'KOHLS CREDIT'                                  
115500                                   TO ASC-TENDER-TYPE                     
115600                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
121400                     MOVE EPTND-TNDR-ID (1:EPTND-TNDR-ID-LEN-NBR) 12140047
113800                                   TO ASC-ID-NBR                  11380047
114900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
115700                 WHEN SA012-VISA                                          
115900                     MOVE 'VISA'   TO ASC-TENDER-TYPE                     
116100                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
124500                     MOVE EPTND-TNDR-ID (1:EPTND-TNDR-ID-LEN-NBR) 12450047
113800                                   TO ASC-ID-NBR                  11380047
114900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
COBRND                 WHEN SA012-COBRAND-VISA                                  
COBRND                     MOVE 'COBRAND VISA' TO ASC-TENDER-TYPE               
COBRND                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
COBRND                     MOVE EPTND-TNDR-ID (1:EPTND-TNDR-ID-LEN-NBR) 12450047
COBRND                                   TO ASC-ID-NBR                  11380047
COBRND                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
PAYVEN                 WHEN SA012-PAYPAL                                        
PAYVEN                     MOVE 'PAYPAL' TO ASC-TENDER-TYPE                     
PAYVEN                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
PAYVEN                     MOVE EPTND-TNDR-ID (1:EPTND-TNDR-ID-LEN-NBR) 12450047
PAYVEN                                   TO ASC-ID-NBR                  11380047
PAYVEN                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
PAYVEN                 WHEN SA012-VENMO                                         
PAYVEN                     MOVE 'VENMO' TO ASC-TENDER-TYPE                      
PAYVEN                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
PAYVEN                     MOVE EPTND-TNDR-ID (1:EPTND-TNDR-ID-LEN-NBR) 12450047
PAYVEN                                   TO ASC-ID-NBR                  11380047
PAYVEN                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
115800                 WHEN SA012-MASTERCARD                                    
115900                     MOVE 'MASTERCARD'                                    
116000                                   TO ASC-TENDER-TYPE                     
116100                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
124500                     MOVE EPTND-TNDR-ID (1:EPTND-TNDR-ID-LEN-NBR) 12450047
113800                                   TO ASC-ID-NBR                  11380047
114900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
116200                 WHEN SA012-DISCOVER                                      
116300                     MOVE 'DISCOVER'                                      
116400                                   TO ASC-TENDER-TYPE                     
116500                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
124500                     MOVE EPTND-TNDR-ID (1:EPTND-TNDR-ID-LEN-NBR) 12450047
113800                                   TO ASC-ID-NBR                  11380047
114900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
116600                 WHEN SA012-AMERICAN-EXPRESS                              
116700                     MOVE 'AMEX'   TO ASC-TENDER-TYPE                     
116800                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
124500                     MOVE EPTND-TNDR-ID (1:EPTND-TNDR-ID-LEN-NBR) 12450047
113800                                   TO ASC-ID-NBR                  11380047
114900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
116900                 WHEN SA012-GIFT-CERTIFICATE                              
140900                    IF EPTND-TNDR-ID-LEN-NBR = 5                  14090047
117000                       MOVE 'GIFT CERT'                                   
117100                                   TO ASC-TENDER-TYPE                     
117200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
140900                    ELSE                                          14090047
SEPH01                       IF EPTND-TNDR-ID-SRC-CDE = '14'                    
SEPH01                          MOVE 'SEPHORA GFTCARD'                          
SEPH01                                   TO ASC-TENDER-TYPE                     
SEPH01                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
SEPH01                          MOVE EPTND-TNDR-ID                      12450047
SEPH01                                      (1:EPTND-TNDR-ID-LEN-NBR)   12450047
SEPH01                                   TO ASC-ID-NBR                  11380047
SEPH01                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
140900                       ELSE                                       14090047
117000                          MOVE 'GIFT CARD'                                
117100                                   TO ASC-TENDER-TYPE                     
117200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
140900                       END-IF                                     14090047
140900                    END-IF                                        14090047
SEPH01                    IF EPTND-TNDR-ID-SRC-CDE = '14'                       
SEPH01                       CONTINUE                                           
SEPH01                    ELSE                                                  
133600                       MOVE EPTND-TNDR-ID                         13360047
133600                                      (1:EPTND-TNDR-ID-LEN-NBR)   13360047
133700                                   TO PV-TENDER-ID                13370047
133800                       PERFORM 4200-FORMAT-TENDER-ID              13380047
133900                       IF PS-TENDER-ID-NUMERIC                    13390047
135700                          MOVE PV-TENDER-ID-FORMATTED             13570047
113800                                   TO ASC-ID-NBR                  11380047
114900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
125200                       ELSE                                       12520047
125200                           MOVE PV-TENDER-ID                      12520047
113800                                   TO ASC-ID-NBR                  11380047
114900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
125300                       END-IF                                     12530047
125300                    END-IF                                        12530047
116900                 WHEN SA012-MAILCHECK                                     
117000                     MOVE 'CORP RFND '                                    
117100                                   TO ASC-TENDER-TYPE                     
117200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
116900                 WHEN SA012-TRAVELERS-CHECK                               
117000                     MOVE 'TRAV CHECK'                                    
117100                                   TO ASC-TENDER-TYPE                     
117200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
116900                 WHEN SA012-VENDOR-CHECK                                  
117000                     MOVE 'VENDOR CK'                                     
117100                                   TO ASC-TENDER-TYPE                     
117200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
116900                 WHEN SA012-MALL-GIFT-CERTIFICATE                         
117000                     MOVE 'MALL CERT'                                     
117100                                   TO ASC-TENDER-TYPE                     
117200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
116900                 WHEN SA012-PURCHASE-ORDER                                
117000                     MOVE 'PUR ORDER'                                     
117100                                   TO ASC-TENDER-TYPE                     
117200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
116900                 WHEN SA012-DEBIT-CARD                                    
117000                     PERFORM 7300-SELECT-DEBIT-TYPE                       
117000                     EVALUATE PV-CRD-TYP-CDE                              
117000                        WHEN 'M'                                          
117000                           MOVE 'DEBIT M/C'                               
117100                                   TO ASC-TENDER-TYPE                     
117200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
117000                        WHEN 'V'                                          
117000                           MOVE 'DEBIT VISA'                              
117100                                   TO ASC-TENDER-TYPE                     
117200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
117000                        WHEN 'A'                                          
117000                           MOVE 'DEBIT ATM'                               
117100                                   TO ASC-TENDER-TYPE                     
117200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
117201                        WHEN 'K'                                          
117202                           MOVE 'DEBIT KOHLS'                             
117203                                   TO ASC-TENDER-TYPE                     
117204                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
117000                        WHEN 'U'                                          
117000                           MOVE 'DEBIT UNKNOWN'                           
117100                                   TO ASC-TENDER-TYPE                     
117200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
117000                     END-EVALUATE                                         
124500                     MOVE EPTND-TNDR-ID (1:EPTND-TNDR-ID-LEN-NBR) 12450047
113800                                   TO ASC-ID-NBR                  11380047
114900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
SEPHOR                 WHEN SA012-SEPHORA-CHARGE                                
SEPHOR                     MOVE 'SEPHORA CHARGE'   TO ASC-TENDER-TYPE           
SEPHOR                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
SEPHOR                     MOVE EPTND-TNDR-ID (1:EPTND-TNDR-ID-LEN-NBR) 12450047
SEPHOR                                   TO ASC-ID-NBR                  11380047
SEPHOR                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
117300             END-EVALUATE                                                 
117400                                                                          
117500             EVALUATE TRUE                                                
117600                 WHEN SA012-CHECK                                         
117700                     PERFORM 7000-GET-CHECK-AUTH                          
121900                     IF EPTND-TNDR-ID-SRC-CDE  = '00'                     
122000                        SET ASC-KEYED-TENDER                              
122000                            (ASC-BLK-SUB ASC-ITEM-SUB)                    
122100                                   TO TRUE                                
122200                     END-IF                                               
117800                 WHEN SA012-KOHLS-CHARGE                                  
117900                 WHEN SA012-VISA                                          
COBRND                 WHEN SA012-COBRAND-VISA                                  
PAYVEN                 WHEN SA012-PAYPAL                                        
PAYVEN                 WHEN SA012-VENMO                                         
118000                 WHEN SA012-MASTERCARD                                    
118100                 WHEN SA012-DISCOVER                                      
118200                 WHEN SA012-AMERICAN-EXPRESS                              
118200                 WHEN SA012-DEBIT-CARD                                    
SEPHOR                 WHEN SA012-SEPHORA-CHARGE                                
121900                     IF EPTND-TNDR-ID-SRC-CDE  = '00'                     
122000                        SET ASC-KEYED-TENDER                              
122000                            (ASC-BLK-SUB ASC-ITEM-SUB)                    
122100                                   TO TRUE                                
122200                     END-IF                                               
118300                     PERFORM 7100-GET-CREDIT-AUTH                         
118400                     IF SA012-KOHLS-CHARGE OR                             
118400                        SA012-DEBIT-CARD                                  
118500                         CONTINUE                                         
118600                     ELSE                                                 
118700                         MOVE EPCRD-EXPRN-DTE (1:2)                       
118800                                   TO PV-EXP-DTE-YY                       
118900                         MOVE EPCRD-EXPRN-DTE (3:2)                       
119000                                   TO PV-EXP-DTE-MM                       
119100                         MOVE PV-EXP-DTE                                  
119200                                   TO ASC-EXP-DTE                         
119300                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
119400                     END-IF                                               
119500                 WHEN SA012-MERCHANDISE-CARD                              
119600                 WHEN SA012-GIFT-CERTIFICATE                              
119700                     PERFORM 7200-GET-STORED-VALUE-AUTH                   
121900                     IF EPTND-TNDR-ID-SRC-CDE  = '00'                     
122000                        SET ASC-KEYED-TENDER                              
122000                            (ASC-BLK-SUB ASC-ITEM-SUB)                    
122100                                   TO TRUE                                
122200                     END-IF                                               
119800             END-EVALUATE                                                 
119900             MOVE PV-AUTH-NBR      TO ASC-AUTH-NBR                        
120000                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
120100             MOVE PV-DL-NBR        TO ASC-DL-NBR                          
120200                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
121600             MOVE SPACES           TO PV-AUTH-NBR                         
121700                                      PV-DL-NBR                           
122300         END-IF                                                           
122400     END-PERFORM.                                                         
122500                                                                  12970008
122600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          12980008
122700         MOVE +1               TO ASC-BLK-SUB                     13030008
122800         PERFORM 5100-WRITE-TEMP-STORAGE                          13040008
122900         ADD +1                TO ASC-BLK-SUB                     13050008
123000         PERFORM 5100-WRITE-TEMP-STORAGE                          13060008
123100         MOVE 1                TO ASC-BLK-SUB                     13080008
123200                                  PV-BLOCK-NUMBER                 13090008
123300         PERFORM 4410-READ-TEMP-STORAGE                           13100008
123400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             13110008
123500             MOVE 2            TO ASC-BLK-SUB                     13120008
123600                                  PV-BLOCK-NUMBER                 13130008
123700             PERFORM 4410-READ-TEMP-STORAGE                       13140008
123800         END-IF                                                   13150008
123900     END-IF.                                                      13160008
124000                                                                          
124100******************************************************************13170008
124200*    FETCH THE TEDNER CURSOR                                     *13180008
124300******************************************************************13190008
124400 4310-FETCH.                                                      13210008
124500                                                                  13220008
124700     EXEC SQL                                                     13230008
124800          FETCH TENDER-OPER-CSR                                   13240008
124900          INTO                                                    13250008
125000                :EPTND-TNDR-SEQ-NBR                                       
125100              , :EPTND-TNDR-TYP-CDE                               13260008
125200              , :EPTND-TNDR-ID                                    13270008
125300              , :EPTND-TNDR-AMT                                   13280008
125400              , :EPTND-TNDR-ID-SRC-CDE                            13290008
125400              , :EPTND-TNDR-ID-LEN-NBR                            13290008
125500     END-EXEC.                                                    13360008
126700                                                                  13370008
126800     EVALUATE TRUE                                                13380008
126900         WHEN SQLCODE = ZERO                                      13390008
126900              ADD +1             TO PV-ROWS-FETCHED               13390008
127000         WHEN SQLCODE = +100                                      13400008
127100              CONTINUE                                            13410008
127200         WHEN SQLWARN0 NOT = SPACE                                13420008
127300         WHEN SQLCODE NOT = ZERO                                  13430008
127400              MOVE '4310-FETCH-CURSOR'                            13440008
127500                               TO DP013-PARAGRAPH                 13450008
127600              MOVE 'FETCH TENDER CURSOR'                          13460008
127700                               TO DP013-MESSAGE-TEXT (1)          13470008
127800              MOVE SQLCA       TO DP013-SQLCA                     13480008
127900              SET DP013-DB2-ABEND                                 13490008
128000                               TO TRUE                            13500008
128100              PERFORM DP013-0000-PROCESS-ABEND                    13510008
128200     END-EVALUATE.                                                13520008
128300                                                                  13530008
128400     IF  SQLCODE EQUAL +100                                       13540008
128500         SET ASC-NO-ITEMS-LEFT-ON-DB                              13550008
128600                                   TO TRUE                        13560008
128700     END-IF.                                                      13570008
128800                                                                  13580008
128900******************************************************************15980008
129000*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.            15990008
129100******************************************************************16000008
129200 4400-MOVE-COMMAREA-TO-SCREEN.                                    16020008
129300                                                                  16030008
129400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             16040008
129500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          16050008
129600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          16060008
129700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             16070008
129800                 GIVING PV-BLOCK-NUMBER                           16080008
129900                 REMAINDER PV-REMAINDER                           16090008
130000             IF  PV-REMAINDER > ZERO                              16100008
130100                 ADD +1 TO PV-BLOCK-NUMBER                        16110008
130200             END-IF                                               16120008
130300             MOVE +1    TO ASC-BLK-SUB                            16130008
130400             PERFORM 4410-READ-TEMP-STORAGE                       16140008
130500             ADD +1     TO ASC-BLK-SUB                            16150008
130600                           PV-BLOCK-NUMBER                        16160008
130700             PERFORM 4410-READ-TEMP-STORAGE                       16170008
130800     END-IF.                                                      16180008
130900     MOVE +1                       TO ASC-BLK-SUB.                16190008
131000     COMPUTE ASC-ITEM-SUB =                                       16200008
131100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              16210008
131200         + PC-ITEMS-PER-PANEL).                                   16220008
131300                                                                  16230008
131400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        16240008
131500         ADD +1   TO ASC-BLK-SUB                                  16250008
131600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            16260008
131700     END-IF.                                                      16270008
131800                                                                  16280008
131900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           16290008
132000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                16300008
132100     PERFORM 4420-FORMAT-LIST-LINES                               16310008
132200         VARYING PV-SUB                                           16320008
132300         FROM PC-ITEMS-PER-PANEL BY -1                            16330008
132400         UNTIL PV-SUB < +1.                                       16340008
132500                                                                  16350008
132600     COMPUTE ASC-ITEMS-DISPLAYED =                                16360008
132700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          16370008
132800     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    16380008
132900                                      ASTRTITO.                   16390008
133000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    16400008
133100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    16410008
133200     MOVE ASC-SALES-DATE-DISPLAY   TO ASLSDTEO.                   16420008
133300     MOVE ASC-KEY-STORE            TO ASTOREO.                    16430008
133400     MOVE ASC-KEY-REGISTER         TO AREGO.                      16440008
133500     MOVE ASC-TIME-HH              TO ATIMEHHO.                   16450008
133600     MOVE ASC-TIME-MM              TO ATIMEMMO.                   16460008
133700     MOVE ASC-TIME-A-P             TO ATIMEAPO.                   16470008
133800     MOVE ASC-KEY-TRANSACTION      TO ATRANSO.                    16480008
           IF ASC-ASSOCIATE-ID = 0                                              
              MOVE SPACES                TO AASSCIDO                            
           ELSE                                                                 
133800        MOVE ASC-ASSOCIATE-ID      TO AASSCIDO                            
           END-IF.                                                              
133900                                                                  16500008
134000     IF ASC-LEFT-VIEW                                                     
134100         MOVE HL-LEFT-HEADING      TO AHEADO                              
134200     ELSE                                                                 
134300         MOVE HL-RIGHT-HEADING     TO AHEADO                              
134400     END-IF.                                                              
134500                                                                          
134600     IF  DP020-MSG-NUMBER-X = SPACE                               16510008
134700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  16520008
134800*            --- MORE ITEMS TO DISPLAY ----                       16530008
134900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            16540008
135000             SET DP020-MSG-INFORMATIONAL TO TRUE                  16550008
135100         END-IF                                                   16560008
135200     END-IF.                                                      16570008
135300                                                                  16580008
135400******************************************************************16590008
135500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.          16600008
135600******************************************************************16610008
135700 4410-READ-TEMP-STORAGE.                                          16630008
135800                                                                  16640008
135900     EXEC CICS                                                    16650008
136000         READQ TS                                                 16660008
136100             QUEUE (ASC-DTL-QUEUE-NAME)                           16670008
136200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               16680008
136300             ITEM  (PV-BLOCK-NUMBER)                              16690008
136400             RESP  (PV-CICS-RESP)                                 16700008
136500     END-EXEC.                                                    16710008
136600                                                                  16720008
136700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       16730008
136800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     16740008
136900         CONTINUE                                                 16750008
137000     ELSE                                                         16760008
137100         SET DP013-CICS-ABEND TO  TRUE                            16770008
137200         SET DP013-NO-ROLLBACK TO  TRUE                           16780008
137300         MOVE '4410-READ-TEMP-STORAGE'                            16790008
137400                               TO  DP013-PARAGRAPH                16800008
137500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      16810008
137600                               TO  DP013-MESSAGE-TEXT(1)          16820008
137700         PERFORM DP013-0000-PROCESS-ABEND                         16830008
137800     END-IF.                                                      16840008
137900                                                                  16850008
138000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         16860008
138100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               16870008
138200     END-IF.                                                      16880008
138300                                                                  16890008
138400******************************************************************16900008
138500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.     16910008
138600******************************************************************16920008
138700 4420-FORMAT-LIST-LINES.                                          16940008
138800                                                                  16950008
138900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      16960008
139000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                16970008
139100         MOVE SPACE              TO MR-SCROLLABLE-AREA (PV-SUB)   16980008
139200     ELSE                                                         16990008
139300                                                                          
139400*** THE IF STATEMENT BELOW IS COMMENTED OUT SO THAT THE SCREEN            
139500*** ALWAYS GETS REBUILT.  THIS ALLOWS THE LEFT AND RIGHT                  
139600*** FUNCTION KEYS TO OPERATE CORRECTLY.                                   
139700                                                                          
139800*        IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           17000008
139900           MOVE SPACES TO DL-DETAIL-LINE                                  
140000           IF ASC-LEFT-VIEW                                               
140100             MOVE ASC-TENDER-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)              
140200                                   TO DL-TENDER-TYPE-L                    
140300             MOVE ASC-TENDER-AMOUNT (ASC-BLK-SUB ASC-ITEM-SUB)            
140400                                   TO PV-AMT-FORMATTED            17040008
140500             MOVE PV-AMT-FORMATTED TO DL-AMOUNT-L                         
140600             MOVE ASC-KEYED-IND (ASC-BLK-SUB ASC-ITEM-SUB)                
140700                                   TO DL-KEYED-IND-L              17060008
140800             MOVE ASC-ID-NBR (ASC-BLK-SUB ASC-ITEM-SUB)                   
140900                                   TO DL-ID-NBR-L                         
142200             MOVE ASC-AUTH-NBR (ASC-BLK-SUB ASC-ITEM-SUB)                 
142300                                   TO DL-AUTH-CDE-L                       
141200             MOVE ASC-EXP-DTE (ASC-BLK-SUB ASC-ITEM-SUB)                  
141300                                   TO DL-EXP-DTE-L                17110008
141400             IF DL-EXP-DTE-L       > SPACES                               
141500                 MOVE '(MMYY)'     TO DL-EXP-DTE-MMYY-L                   
141600             END-IF                                                       
141700           ELSE                                                           
141800             MOVE ASC-TENDER-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)              
141900                                   TO DL-TENDER-TYPE-R                    
142000             MOVE ASC-MICR-NBR (ASC-BLK-SUB ASC-ITEM-SUB)                 
142100                                   TO DL-MICR-NBR-R                       
142200             MOVE ASC-DL-NBR (ASC-BLK-SUB ASC-ITEM-SUB)                   
142300                                   TO DL-DL-NBR-R                         
142400           END-IF                                                         
142500           MOVE DL-DETAIL-LINE   TO MR-SCROLLABLE-AREA (PV-SUB)           
142600*        END-IF                                                   17170008
142700     END-IF.                                                      17180008
142800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               17190008
142900     IF  ASC-ITEM-SUB < + 1                                       17200008
143000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  17210008
143100         MOVE +1                 TO ASC-BLK-SUB                   17220008
143200     END-IF.                                                      17230008
143300                                                                  17240008
094800******************************************************************10470008
       4500-FIND-ASSOC-ID.                                                      
094800******************************************************************10470008
147100     EXEC SQL                                                             
147200         SELECT CUST_ASSOC_ID                                             
147500         INTO      :ASC-ASSOCIATE-ID                                      
147800         FROM       TEPATR                                                
147900         WHERE      PARTN_NBR      = :DK-PARTITION                        
148000         AND        STR_NBR        = :DK-STORE                            
148100         AND        RGST_ID        = :DK-REGISTER                         
148200         AND        TRN_NBR        = :DK-TRANSACTION                      
148300         AND        STRT_TM        = :DK-START-TIME                       
148400         AND        SLS_CORR_SEQ_NBR                                      
148500                               = :DK-SALES-CORR-SEQ-NBR                   
148700         WITH UR                                                          
148800     END-EXEC.                                                            
151000                                                                          
151100     EVALUATE TRUE                                                        
151200         WHEN SQLCODE = ZERO                                      13390008
151300         WHEN SQLCODE = +100                                      13400008
151400              CONTINUE                                            13410008
151500         WHEN SQLWARN0 NOT = SPACE                                13420008
151600         WHEN SQLCODE NOT = ZERO                                  13430008
151700              MOVE '4500-FIND-ASSOC-ID'                                   
151800                               TO DP013-PARAGRAPH                 13450008
151900              MOVE 'FIND ASSOC ID'                                        
152000                               TO DP013-MESSAGE-TEXT (1)          13470008
152100              MOVE SQLCA       TO DP013-SQLCA                     13480008
152200              SET DP013-DB2-ABEND                                 13490008
152300                               TO TRUE                            13500008
152400              PERFORM DP013-0000-PROCESS-ABEND                    13510008
152500     END-EVALUATE.                                                13520008
152600                                                                          
143400******************************************************************17250008
143700 5100-WRITE-TEMP-STORAGE.                                         17290008
143500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.       17260008
143600******************************************************************17270008
143800                                                                  17300008
143900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     17310008
144000                               TO  PV-LIST-ITEM-NUMBER.           17320008
144100     COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                           17330008
144200         ASC-HIGHEST-BLOCK-WRITTEN + 1.                           17340008
144300                                                                  17350008
144400     EXEC CICS                                                    17360008
144500         WRITEQ TS                                                17370008
144600             QUEUE (ASC-DTL-QUEUE-NAME)                           17380008
144700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17390008
144800             ITEM  (PV-HIGHEST-BLOCK-WRITTEN)                     17400008
144900             RESP  (PV-CICS-RESP)                                 17410008
145000     END-EXEC.                                                    17420008
145100                                                                  17430008
145200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      17440008
145300         SET DP013-CICS-ABEND                                     17450008
145400                       TO  TRUE                                   17460008
145500         SET DP013-NO-ROLLBACK                                    17470008
145600                       TO  TRUE                                   17480008
145700         MOVE '5100-WRITE-TEMP-STORAGE'                           17490008
145800                       TO  DP013-PARAGRAPH                        17500008
145900         MOVE 'ATTEMPTING TO WRITE TEMP STORAGE LIST BLOCK'       17510008
146000                       TO  DP013-MESSAGE-TEXT(1)                  17520008
146100         PERFORM DP013-0000-PROCESS-ABEND                         17530008
146200     END-IF.                                                      17540008
146300     ADD +1            TO  ASC-HIGHEST-BLOCK-WRITTEN.             17550008
146400                                                                  17580008
146500******************************************************************        
146800 7000-GET-CHECK-AUTH.                                                     
146600*    GET THE CHECK AUTHORIZATION NUMBER                                   
146700******************************************************************        
146900                                                                          
147100     EXEC SQL                                                             
147200         SELECT AUTH_NBR                                                  
147300               ,DRV_LIC_NBR                                               
147500         INTO      :PV-AUTH-NBR                                           
147600              ,:PV-DL-NBR                                                 
147800         FROM       TEPCHK                                                
147900         WHERE      PARTN_NBR      = :DK-PARTITION                        
148000         AND        STR_NBR        = :DK-STORE                            
148100         AND        RGST_ID        = :DK-REGISTER                         
148200         AND        TRN_NBR        = :DK-TRANSACTION                      
148300         AND        STRT_TM        = :DK-START-TIME                       
148400         AND        SLS_CORR_SEQ_NBR                                      
148500                               = :DK-SALES-CORR-SEQ-NBR                   
148600         AND        TNDR_SEQ_NBR   = :EPTND-TNDR-SEQ-NBR                  
148700         WITH UR                                                          
148800     END-EXEC.                                                            
151000                                                                          
151100     EVALUATE TRUE                                                        
151200         WHEN SQLCODE = ZERO                                      13390008
151300         WHEN SQLCODE = +100                                      13400008
151400              CONTINUE                                            13410008
151500         WHEN SQLWARN0 NOT = SPACE                                13420008
151600         WHEN SQLCODE NOT = ZERO                                  13430008
151700              MOVE '7000-GET-CHECK-AUTH'                          13440008
151800                               TO DP013-PARAGRAPH                 13450008
151900              MOVE 'GET CHECK AUTH'                                       
152000                               TO DP013-MESSAGE-TEXT (1)          13470008
152100              MOVE SQLCA       TO DP013-SQLCA                     13480008
152200              SET DP013-DB2-ABEND                                 13490008
152300                               TO TRUE                            13500008
152400              PERFORM DP013-0000-PROCESS-ABEND                    13510008
152500     END-EVALUATE.                                                13520008
152600                                                                          
152700     IF SQLCODE                    = +100                                 
152800         MOVE SPACES               TO PV-AUTH-NBR                         
152900     END-IF.                                                              
153000                                                                          
153100******************************************************************        
153400 7100-GET-CREDIT-AUTH.                                                    
153200*    GET THE CREDIT AUTHORIZATION NUMBER                                  
153300******************************************************************        
153500                                                                          
153700     EXEC SQL                                                             
153800         SELECT AUTH_NBR                                                  
153900               ,DRV_LIC_NBR                                               
154100               ,EXPRN_DTE                                                 
154200         INTO      :PV-AUTH-NBR                                           
154300              ,:PV-DL-NBR                                                 
154500              ,:EPCRD-EXPRN-DTE                                           
154600         FROM       TEPCRD                                                
154700         WHERE      PARTN_NBR      = :DK-PARTITION                        
154800         AND        STR_NBR        = :DK-STORE                            
154900         AND        RGST_ID        = :DK-REGISTER                         
155000         AND        TRN_NBR        = :DK-TRANSACTION                      
155100         AND        STRT_TM        = :DK-START-TIME                       
155200         AND        SLS_CORR_SEQ_NBR                                      
155300                               = :DK-SALES-CORR-SEQ-NBR                   
155400         AND        TNDR_SEQ_NBR   = :EPTND-TNDR-SEQ-NBR                  
155500         WITH UR                                                          
155600     END-EXEC.                                                            
158000                                                                          
158100     EVALUATE TRUE                                                        
158200         WHEN SQLCODE = ZERO                                      13390008
158300         WHEN SQLCODE = +100                                      13400008
158400              CONTINUE                                            13410008
158500         WHEN SQLWARN0 NOT = SPACE                                13420008
158600         WHEN SQLCODE NOT = ZERO                                  13430008
158700              MOVE '7100-GET-CREDIT-AUTH'                         13440008
158800                               TO DP013-PARAGRAPH                 13450008
158900              MOVE 'GET CREDIT AUTH'                                      
159000                               TO DP013-MESSAGE-TEXT (1)          13470008
159100              MOVE SQLCA       TO DP013-SQLCA                     13480008
159200              SET DP013-DB2-ABEND                                 13490008
159300                               TO TRUE                            13500008
159400              PERFORM DP013-0000-PROCESS-ABEND                    13510008
159500     END-EVALUATE.                                                13520008
159600                                                                          
159700     IF SQLCODE                    = +100                                 
159800         MOVE SPACES               TO PV-AUTH-NBR                         
159900                                      EPCRD-EXPRN-DTE                     
160000     END-IF.                                                              
160100                                                                          
160200******************************************************************        
160500 7200-GET-STORED-VALUE-AUTH.                                              
160300*    GET THE STORED VALUE AUTHORIZATION NUMBER                            
160400******************************************************************        
160600                                                                          
160800     EXEC SQL                                                             
160900         SELECT AUTH_NBR                                                  
161100         INTO      :PV-AUTH-NBR                                           
161300         FROM       TEPSVC                                                
161400         WHERE      PARTN_NBR      = :DK-PARTITION                        
161500         AND        STR_NBR        = :DK-STORE                            
161600         AND        RGST_ID        = :DK-REGISTER                         
161700         AND        TRN_NBR        = :DK-TRANSACTION                      
161800         AND        STRT_TM        = :DK-START-TIME                       
161900         AND        SLS_CORR_SEQ_NBR                                      
162000                               = :DK-SALES-CORR-SEQ-NBR                   
162100         AND        TNDR_SEQ_NBR   = :EPTND-TNDR-SEQ-NBR                  
162200         WITH UR                                                          
162300     END-EXEC.                                                            
164300                                                                          
164400     EVALUATE TRUE                                                        
164500         WHEN SQLCODE = ZERO                                      13390008
164600         WHEN SQLCODE = +100                                      13400008
164700              CONTINUE                                            13410008
164800         WHEN SQLWARN0 NOT = SPACE                                13420008
164900         WHEN SQLCODE NOT = ZERO                                  13430008
165000              MOVE '7200-GET-STORED-VALUE-AUTH'                   13440008
165100                               TO DP013-PARAGRAPH                 13450008
165200              MOVE 'GET STORED VALUE AUTH'                                
165300                               TO DP013-MESSAGE-TEXT (1)          13470008
165400              MOVE SQLCA       TO DP013-SQLCA                     13480008
165500              SET DP013-DB2-ABEND                                 13490008
165600                               TO TRUE                            13500008
165700              PERFORM DP013-0000-PROCESS-ABEND                    13510008
165800     END-EVALUATE.                                                13520008
165900                                                                          
166000     IF SQLCODE                    = +100                                 
166100         MOVE SPACES               TO PV-AUTH-NBR                         
166200     END-IF.                                                              
166300                                                                          
160200******************************************************************        
160500 7300-SELECT-DEBIT-TYPE.                                                  
160300*    GET THE DEBIT CARD TYPE.                                             
160400******************************************************************        
160600                                                                          
160800     EXEC SQL                                                             
160900        SELECT     CRD_TYP_CDE                                            
161100          INTO :PV-CRD-TYP-CDE                                            
161300          FROM     EPT_DR_CRD_TNDR                                        
161400         WHERE     PARTN_NBR        = :DK-PARTITION                       
161500           AND     STR_NBR          = :DK-STORE                           
161600           AND     RGST_ID          = :DK-REGISTER                        
161700           AND     TRN_NBR          = :DK-TRANSACTION                     
161800           AND     STRT_TM          = :DK-START-TIME                      
161900           AND     SLS_CORR_SEQ_NBR = :DK-SALES-CORR-SEQ-NBR              
162100           AND     TNDR_SEQ_NBR     = :EPTND-TNDR-SEQ-NBR                 
162200       WITH UR                                                            
162300     END-EXEC.                                                            
164300                                                                          
164400     EVALUATE TRUE                                                        
164500         WHEN SQLCODE = ZERO                                      13390008
164700              CONTINUE                                            13410008
164600         WHEN SQLCODE = +100                                      13400008
                     MOVE 'U'         TO PV-CRD-TYP-CDE                         
164800         WHEN SQLWARN0 NOT = SPACE                                13420008
164900         WHEN SQLCODE NOT = ZERO                                  13430008
165000              MOVE '7300-SELECT-DEBIT-TYPE'                       13440008
165100                               TO DP013-PARAGRAPH                 13450008
165200              MOVE 'SELECT DEBIT TYPE'                                    
165300                               TO DP013-MESSAGE-TEXT (1)          13470008
165400              MOVE SQLCA       TO DP013-SQLCA                     13480008
165500              SET DP013-DB2-ABEND                                 13490008
165600                               TO TRUE                            13500008
165700              PERFORM DP013-0000-PROCESS-ABEND                    13510008
165800     END-EVALUATE.                                                13520008
165900                                                                          
169600******************************************************************17590008
170000 9000-SET-TRAN-TIME-DISPLAY.                                      17640008
169700*    THE TIME THAT IS DISPLAYED ON THE SCREEN SHOULD BE IN THE    17600008
169800*    FOLLOWING FORMAT, HH : MM A/P.  THIS DETERMINES THE DISPLAY  17610008
169900******************************************************************17620008
170100                                                                  17650008
170200     MOVE ASC-KEY-START-TIME       TO PV-TIME.                    17660008
170300     IF PV-TIME-HH                 >= 12                          17670008
170400         MOVE 'P'                  TO PV-TIME-A-P                 17680008
170500     ELSE                                                         17690008
170600         MOVE 'A'                  TO PV-TIME-A-P                 17700008
170700     END-IF.                                                      17710008
170800                                                                  17720008
170900     IF PV-TIME-HH                 >  12                          17730008
171000         SUBTRACT 12 FROM PV-TIME-HH                              17740008
171100     END-IF.                                                      17750008
171200                                                                  17760008
171300     MOVE PV-TIME-HH               TO ASC-TIME-HH.                17770008
171400     MOVE PV-TIME-MM               TO ASC-TIME-MM.                17780008
171500     MOVE PV-TIME-A-P              TO ASC-TIME-A-P.               17790008
171600                                                                  17800008
171700******************************************************************17810008
172000 9100-READ-TRAN-SEL-QUEUE.                                        17850008
171800*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.     17820008
171900******************************************************************17830008
172100                                                                  17860008
172200     MOVE +1                       TO ASC-TRAN-SEL-ITEM.          17870008
172300     MOVE +1                       TO ASC-TRAN-SEL-SUB.           17880008
172400                                                                  17890008
172500     EXEC CICS                                                    17900008
172600         READQ TS                                                 17910008
172700             QUEUE (ASC-TRAN-SEL-QUEUE-NAME)                      17920008
172800             INTO  (SA001-TRANSACTION-SEL-REC)                    17930008
172900             ITEM  (ASC-TRAN-SEL-ITEM)                            17940008
173000             RESP  (PV-CICS-RESP)                                 17950008
173100     END-EXEC.                                                    17960008
173200                                                                  17970008
173300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       17980008
173400         CONTINUE                                                 17990008
173500     ELSE                                                         18000008
173600         SET DP013-LOGIC-ABEND                                    18010008
173700             DP013-NO-ROLLBACK     TO TRUE                        18020008
173800         MOVE '9100-READ-SEL-QUEUE'                               18030008
173900                                   TO DP013-PARAGRAPH             18040008
174000         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   18050008
174100                                   TO DP013-MESSAGE-TEXT (1)      18060008
174200         PERFORM DP013-0000-PROCESS-ABEND                         18070008
174300     END-IF.                                                      18080008
174400******************************************************************18330008
174500*    ABEND PROCESSOR MODULE                                       18340008
174600******************************************************************18350008
174700                                                                  18360008
174800     COPY DPPD013.                                                18370008
174700                                                                  18360008
174600******************************************************************18350008
203100 9200-REWRITE-LIST-QUEUE.                                         20310047
202900*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.     20290047
174600******************************************************************18350008
174700                                                                  18360008
203200     EXEC CICS                                                    20320047
203300          WRITEQ TS                                               20330047
203400              QUEUE  (ASC-TRAN-SEL-QUEUE-NAME)                    20340047
203500              FROM   (SA001-TRANSACTION-SEL-REC)                  20350047
203600              ITEM   (ASC-TRAN-SEL-ITEM)                          20360047
203700              RESP   (PV-CICS-RESP)                               20370047
203800              REWRITE                                             20380047
203900     END-EXEC.                                                    20390047
204000                                                                  20400047
204100     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   20410047
204200         SET DP013-CICS-ABEND                                     20420047
204300             DP013-NO-ROLLBACK     TO TRUE                        20430047
204400         MOVE '9200-REWRITE-LIST-QUEUE'                           20440047
204500                                   TO DP013-PARAGRAPH             20450047
204600         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   20460047
204700                                   TO DP013-MESSAGE-TEXT (1)      20470047
204800         PERFORM DP013-0000-PROCESS-ABEND                         20480047
204900     END-IF.                                                      20490047
205000                                                                  20500047
