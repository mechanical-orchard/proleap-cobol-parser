000240*-----------------------*                                         00024001
000250 IDENTIFICATION DIVISION.                                         00025001
000260*-----------------------*                                         00026001
000270 PROGRAM-ID.    CNKCS226.                                         00027001
000280 AUTHOR.        PATRICK BURKE.                                    00028001
000290 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00029001
000300 DATE-WRITTEN.  JANUARY, 2001.                                    00030001
000400 DATE-COMPILED.                                                   00040001
000500                                                                  00050001
000600*---------------------------------------------------------------* 00060001
000700*    Y226 - VALID DOOR TYPES CURRENTLY DEFINED BY SYSTEM.       * 00070005
000800*                                                               * 00080007
000900*    THIS PROGRAM GENERATES A LIST OF DOOR TYPE DESCRIPTIONS    * 00090001
001000*    CODES. A SELECTABLE CICS ARCHITECTURE TEMPLATE WAS USED.   * 00100001
001100*    EVEN THOUGH THE PROGRAM IS NOT CURRENTLY SELECTABLE, IT    * 00110001
001200*    COULD BE CHANGED TO BE SO RELATIVELY QUICKLY SHOULD THE    * 00120001
001300*    NEED ARISE. ENTRY TO THIS PROGRAM IS FROM CNKCS224,        * 00130001
001400*    CNKCS225, CNKCS227.                                        * 00140003
001500*---------------------------------------------------------------* 00150004
263455* CHANGED 11/02/2021    BY JIM HUNTER      WR: CHG0263455         00160015
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00170015
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00180015
263455*----------------------------------------------------------------*00190015
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00200016
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00210016
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00220016
CICS  *-----------------------------------------------------------------00230016
003000 EJECT                                                            00300001
003100 ENVIRONMENT DIVISION.                                            00310001
003200                                                                  00320001
003300 DATA DIVISION.                                                   00330001
003400                                                                  00340001
003500 WORKING-STORAGE SECTION.                                         00350001
003600                                                                  00360001
003700 01  DK-DB2-KEYS.                                                 00370001
003800     15  DK-MESSAGE-TEXT                PIC  X(70)  VALUE SPACE.  00380001
003900     15  DK-MESSAGE-BYTE                REDEFINES DK-MESSAGE-TEXT 00390001
004000                                        OCCURS 70 TIMES           00400001
004100                                        PIC  X(01).               00410001
004200     15  DK-MESSAGE-NUMBER              PIC S9(05)  VALUE ZERO    00420001
004300                                                    COMP-3.       00430001
004400     15  DK-SYSTEM-ID                   PIC  X(02)  VALUE SPACE.  00440001
004500     15  DK-REVIEW-IND                  PIC  X(01)  VALUE SPACE.  00450001
004600                                                                  00460001
004700 01  PC-PROGRAM-CONSTANTS.                                        00470001
004800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00480001
004900                                                    'CN226A'.     00490013
005000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00500001
005100                                                    'CNKM226 '.   00510009
005200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00520001
005300                                                    'CNKCS226'.   00530009
005400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00540001
005500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00550001
005600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00560001
005700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15     00570013
005800                                                    COMP SYNC.    00580001
005900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00590001
006000                                                    COMP SYNC.    00600001
006100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00610001
006200                                                    +1000000      00620001
006300                                                    COMP-3.       00630001
006400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00640001
006500                                                    COMP SYNC.    00650001
006600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00660001
006700                                                    COMP-3.       00670001
006800     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00680001
006900     05  PC-D                           PIC  X(01)  VALUE 'D'.    00690014
006910     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00691014
007000     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00700001
007100     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00710001
007200     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00720001
007300*                                                                 00730001
007400     05  PC-TSYMSG-NUMBERS.                                       00740001
007500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00750001
007600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00760001
007700         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00770001
007800         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00780001
007900         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00790001
008000         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00800001
008100         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00810001
008200         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00820001
008300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00830001
008400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00840001
008500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00850001
008600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00860001
008700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00870001
008800         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00880001
008900*                                                                 00890001
009000 01  PS-PROGRAM-SWITCHES.                                         00900001
009100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00910001
009200         88  PS-NO-ERROR                            VALUE 'Y'.    00920001
009300         88  PS-ERROR                               VALUE 'N'.    00930001
009400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00940001
009500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00950001
009600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00960001
009700     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00970001
009800         88  PS-DONE                                VALUE 'Y'.    00980001
009900         88  PS-NOT-DONE                            VALUE 'N'.    00990001
010000*                                                                 01000001
010100 01  PV-PROGRAM-VARIABLES.                                        01010001
010200     05  PV-SUB                         PIC S9(04)  VALUE +0      01020001
010300                                                    COMP SYNC.    01030001
010400     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01040001
010500                                                    COMP SYNC.    01050001
010600     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01060001
010700                                                    COMP-3.       01070001
010800     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01080001
010900                                                    COMP-3.       01090001
011000     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01100001
011100                                                    COMP-3.       01110001
011200     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01120001
011300                                                    COMP-3.       01130001
011400     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01140001
011500                                                    COMP-3.       01150001
011600     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01160001
011700                                                    COMP-3.       01170001
011800     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01180001
011900                                                    COMP-3.       01190001
012000     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01200001
012100                                                    COMP SYNC.    01210001
012200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01220001
012300                                                    COMP SYNC.    01230001
012400     05  PV-ITEM                        PIC S9(04)  VALUE +0      01240001
012500                                                    COMP SYNC.    01250001
012600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01260001
012700                                                    COMP SYNC.    01270001
012800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01280001
012900                                                    COMP SYNC.    01290001
013000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01300001
013100                                                    COMP SYNC.    01310001
013200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01320001
013300                                                    COMP SYNC.    01330001
013400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01340001
013500                                                    COMP SYNC.    01350001
013600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01360001
013700                                                    COMP SYNC.    01370001
013800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01380001
013900                                                    COMP SYNC.    01390001
014000     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01400001
014100                                                    COMP SYNC.    01410001
014200     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01420001
014300                                                    COMP SYNC.    01430001
014400     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01440001
014500                                                    COMP SYNC.    01450001
014600     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01460001
014700                                                    COMP SYNC.    01470001
014800     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01480001
014900                                                    COMP SYNC.    01490001
015000     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01500001
015100                                                    COMP SYNC.    01510001
015200     05  PV-SCROLL-AREA                 OCCURS 14 TIMES.          01520001
015300         10  MR-SELECTL                 PIC S9(04) COMP.          01530001
015400         10  MR-SELECTA                 PIC  X(01).               01540001
015500         10  MR-SELECTC                 PIC  X(01).               01550001
015600         10  MR-SELECTH                 PIC  X(01).               01560001
015700         10  MR-SELECTI                 PIC  X(01).               01570001
015800                                                                  01580001
015900         10  MR-ACTIONL                 PIC S9(04) COMP.          01590001
016000         10  MR-ACTIONA                 PIC  X(01).               01600001
016100         10  MR-ACTIONC                 PIC  X(01).               01610001
016200         10  MR-ACTIONH                 PIC  X(01).               01620001
016300         10  MR-ACTION                  PIC  X(03).               01630001
016400******************************************************************01640001
016500**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01650001
016600**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE             01660001
016700**  APPLICATION-SPECIFIC COMMAREA.                                01670001
016800******************************************************************01680001
016900 01  LQW-LIST-QUEUE-WORK-AREA.                                    01690001
017000     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01700001
017100     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01710001
017200                                        INDEXED BY LQW-IDX.       01720001
017300         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01730001
017400         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01740001
017500         10  LQW-SELECTED-SW            PIC  X(01).               01750001
017600             88  LQW-SELECT                         VALUE 'S'.    01760001
017700             88  LQW-DESELECT                       VALUE ' '.    01770001
017800*        10  LQW-ACTION                 PIC  X(03).               01780001
017900         10  LQW-DOOR-TYP-CDE-DESC      PIC  X(30).               01790009
018000         10  LQW-DOOR-TYP-CDE           PIC  X(02).               01800009
018100                                                                  01810001
018200     EJECT                                                        01820001
018300*---------------------------------------------------------------* 01830001
018400*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 01840001
018500*---------------------------------------------------------------* 01850001
018600                                                                  01860001
018700     COPY DPWS057.                                                01870001
018800                                                                  01880001
018900     EJECT                                                        01890001
019000*---------------------------------------------------------------* 01900001
019100*    MAP LAYOUT                                                   01910001
019200*---------------------------------------------------------------* 01920001
019300                                                                  01930001
019400     COPY CNKM226.                                                01940009
019410*---------------------------------------------------------------* 01941009
019500*                                                                 01950001
019600 01  MR-OCCURS-LAYOUT                   REDEFINES  CN226AO.       01960013
019700     05  FILLER                         PIC X(042).               01970012
019800     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01980001
021000                                                                  02100001
021100         10  MR-DOOR-TYP-CDEL           PIC S9(04) COMP.          02110009
021200         10  MR-DOOR-TYP-CDEA           PIC  X(01).               02120009
021300         10  MR-DOOR-TYP-CDEC           PIC  X(01).               02130009
021400         10  MR-DOOR-TYP-CDEH           PIC  X(01).               02140009
021500         10  MR-DOOR-TYP-CDE            PIC  X(02).               02150009
021600                                                                  02160001
021700         10  MR-DOOR-TYP-CDE-DESCL      PIC S9(04) COMP.          02170009
021800         10  MR-DOOR-TYP-CDE-DESCA      PIC  X(01).               02180009
021900         10  MR-DOOR-TYP-CDE-DESCC      PIC  X(01).               02190009
022000         10  MR-DOOR-TYP-CDE-DESCH      PIC  X(01).               02200009
022100         10  MR-DOOR-TYP-CDE-DESC       PIC  X(30).               02210009
022200                                                                  02220001
022300     EJECT                                                        02230001
022400*---------------------------------------------------------------* 02240001
022500*    ATTRIBUTE SETTINGS COPYBOOK.                                 02250001
022600*---------------------------------------------------------------* 02260001
022700                                                                  02270001
022800     COPY DPWS015.                                                02280001
022900                                                                  02290001
023000*---------------------------------------------------------------* 02300001
023100*    FUNCTION KEYS COPYBOOK.                                      02310001
023200*---------------------------------------------------------------* 02320001
023300                                                                  02330001
023400     COPY DPWS016.                                                02340001
023500                                                                  02350001
023600*---------------------------------------------------------------* 02360001
023700*    NUMERIC EDIT LAYOUT.                                         02370001
023800*---------------------------------------------------------------* 02380001
023900                                                                  02390001
024000     COPY DPWS010I.                                               02400001
024100 EJECT                                                            02410001
024200*---------------------------------------------------------------* 02420001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02430016
024400*---------------------------------------------------------------* 02440001
024500                                                                  02450001
024600     COPY DPWS030.                                                02460001
CICS       COPY DPWS930.                                                02461016
024700 EJECT                                                            02470001
024800*---------------------------------------------------------------* 02480001
024900*    STANDARD COMMAREA.                                           02490001
025000*---------------------------------------------------------------* 02500001
025100                                                                  02510001
025200     COPY DPWS020.                                                02520001
025300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02530001
025400                                                                  02540001
025500*---------------------------------------------------------------* 02550001
025600* INTER-APPLICATION COMMAREA.                                     02560001
025700*   CNWS011 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02570002
025800*             SPEC SCREEN.                                        02580001
026100*---------------------------------------------------------------* 02610001
026200                                                                  02620001
026300         10  INTER-APPL-COMM-AREA       PIC X(200).               02630001
026400     COPY CNWS011.                                                02640002
026600*---------------------------------------------------------------* 02660001
026700*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                     02670001
026800*---------------------------------------------------------------* 02680001
026900         10  ASC-SPECIFIC-COMMAREA.                               02690001
027000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02700001
027100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02710001
027200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02720001
027300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02730001
027400                                                                  02740001
027500                 20  ASC-ITEM-ARRAY.                              02750001
027600                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02760001
027700                         30  ASC-LIST-ITEM-NUMBER                 02770001
027800                                                     PIC S9(09)   02780001
027900                                                     COMP-3.      02790001
028000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02800001
028100                             88  ASC-VALID-SELECT    VALUE ' '    02810001
028200                                                           'S'    02820001
028300                                                           'B'    02830001
028400                                                           'E'.   02840001
028500                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02850001
028600                             88  ASC-TEMP-SELECT     VALUE 'S'.   02860001
028700                             88  ASC-TEMP-BEGIN      VALUE 'B'.   02870001
028800                             88  ASC-TEMP-END        VALUE 'E'.   02880001
028900                         30  ASC-SELECTED-SW         PIC  X(01).  02890001
029000                             88  ASC-NO-SELECT       VALUE ' '.   02900001
029100                             88  ASC-SELECT          VALUE 'S'.   02910001
029200                             88  ASC-BEGIN           VALUE 'B'.   02920001
029300                             88  ASC-END             VALUE 'E'.   02930001
029400*                        30  ASC-ACTION              PIC  X(03).  02940001
029500                         30  ASC-DOOR-TYP-CDE-DESC   PIC  X(30).  02950009
029600                         30  ASC-DOOR-TYP-CDE        PIC  X(02).  02960009
029700                                                                  02970001
029800             15  ASC-BLK-SUB                         PIC S9(04)   02980001
029900                                                          COMP    02990001
030000                                                          SYNC.   03000001
030100             15  ASC-ITEM-SUB                        PIC S9(04)   03010001
030200                                                          COMP    03020001
030300                                                          SYNC.   03030001
030400             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03040001
030500                                                          COMP-3. 03050001
030600             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03060001
030700                                                          COMP-3. 03070001
030800             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03080001
030900                                                          COMP-3. 03090001
031000             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03100001
031100                                                          COMP-3. 03110001
031200             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03120001
031300                                                          COMP-3. 03130001
031400             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03140001
031500                                                          COMP    03150001
031600                                                          SYNC.   03160001
031700             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03170001
031800                                                          COMP-3. 03180001
031900             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03190001
032000                                                          COMP-3. 03200001
032100             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03210001
032200                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03220001
032300                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03230001
032400             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03240001
032500                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03250001
032600                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03260001
032700             15  ASC-LIST-QUEUE-NAME.                             03270001
032800                 20  ASC-LIST-TERM-ID                PIC  X(04).  03280001
032900                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03290001
033000                                                          COMP-3. 03300001
033100                 20  ASC-LIST-SEQ                    PIC  9(01).  03310001
033200             15  ASC-SEL-QUEUE-NAME.                              03320001
033300                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03330001
033400                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03340001
033500                                                          COMP-3. 03350001
033600                 20  ASC-SEL-SEQ                     PIC  9(01).  03360001
033700                                                                  03370001
033800             15  ASC-START-ITEM-REQUEST.                          03380001
033900                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03390001
034000     EJECT                                                        03400001
034100*---------------------------------------------------------------* 03410001
034200*    ABEND PROCESSING COPYBOOK.                                   03420001
034300*---------------------------------------------------------------* 03430001
034400                                                                  03440001
034500     COPY DPWS013.                                                03450001
034600                                                                  03460001
034700 EJECT                                                            03470001
036600*---------------------------------------------------------------* 03660001
036700*    DB2 AREA FOR COMMUNICATIONS                                  03670001
036800*---------------------------------------------------------------* 03680001
036900     EXEC SQL                                                     03690001
037000          INCLUDE SQLCA                                           03700001
037100     END-EXEC.                                                    03710001
037200                                                                  03720001
037210*---------------------------------------------------------------* 03721004
037220*    DB2 AREA FOR TCNDRTY                                         03722004
037230*---------------------------------------------------------------* 03723004
037231     EXEC SQL                                                     03723104
037232          INCLUDE TCNDRTY                                         03723204
037233     END-EXEC.                                                    03723304
037234                                                                  03723404
037235*---------------------------------------------------------------* 03723504
037236*    DOOR TYPE CURSOR                                             03723604
037237*---------------------------------------------------------------* 03723704
037238                                                                  03723804
037239     EXEC SQL                                                     03723904
037240          DECLARE   DOOR_TYP_CSR CURSOR FOR                       03724009
037241           SELECT   DOOR_TYP_CDE                                  03724104
037242                  , DOOR_TYP_CDE_DESC                             03724209
037243             FROM   TCNDRTY                                       03724304
037244            WHERE   DIVERT_TYP_CDE = :PC-D                        03724414
037245          ORDER BY  DOOR_TYP_CDE                                  03724504
037246                  , DOOR_TYP_CDE_DESC                             03724609
037247     END-EXEC.                                                    03724704
037250                                                                  03725004
037300*---------------------------------------------------------------* 03730004
037400                                                                  03740004
043600 LINKAGE SECTION.                                                 04360001
043700                                                                  04370001
043800 01  DFHCOMMAREA.                                                 04380001
043900     05  FILLER                         OCCURS  1 TO 4072 TIMES   04390001
044000                                        DEPENDING ON EIBCALEN.    04400001
044100         10  FILLER                     PIC X.                    04410001
044200                                                                  04420001
044300 EJECT                                                            04430001
044400 PROCEDURE DIVISION.                                              04440001
044500******************************************************************04450001
044600**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04460001
044700**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04470001
044800**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04480001
044900******************************************************************04490001
045000 0000-MAIN-MODULE.                                                04500001
045100     INITIALIZE DP030-CICS-API-FIELDS.                            04510001
045200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04520001
045300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04530001
045400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04540001
045500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04550001
045600     MOVE LENGTH OF CN226AI        TO DP030-MAP-LENGTH (1).       04560013
045700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04570001
045800     PERFORM 0001-CALL-CICS-ARCH-API.                             04580001
045900*                                                                 04590001
046000     PERFORM 1000-CONTROL-PROCESSING                              04600001
046100*                                                                 04610001
046200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04620001
046300     PERFORM 0001-CALL-CICS-ARCH-API.                             04630001
046400                                                                  04640001
046500******************************************************************04650001
046600**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04660001
046700**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.           04670001
046800******************************************************************04680001
046900 0001-CALL-CICS-ARCH-API.                                         04690001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04700016
047100                                    DFHCOMMAREA                   04710016
047200                                    DP030-CICS-API-FIELDS         04720016
047300                                    DP020-STANDARD-COMMAREA       04730016
047400                                    CN226AI.                      04740016
047500*                                                                 04750001
047600     IF  DP030-RC-CALL-SUCCESSFUL                                 04760001
047700         CONTINUE                                                 04770001
047800     ELSE                                                         04780001
047900         SET DP013-NO-ROLLBACK                                    04790001
048000             DP013-XCTL-DISPLAY-RESTART                           04800001
048100             DP013-CICS-ABEND      TO TRUE                        04810001
048200         MOVE '0001-CALL-CICS-ARCH-API'                           04820001
048300                                   TO DP013-PARAGRAPH             04830001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04831016
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04832016
048600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04860001
048700         PERFORM DP013-0000-PROCESS-ABEND                         04870001
048800     END-IF.                                                      04880001
048900*----------------------------------------------------------------*04890001
049000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       04900001
049100* COURSE OF ACTION IS FOR THIS TRANSACTION.                       04910001
049200*                                                                 04920001
049300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE   04930001
049400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04940001
049500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04950001
049600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04960001
049700*----------------------------------------------------------------*04970001
049800                                                                  04980001
049900 1000-CONTROL-PROCESSING.                                         04990001
050000                                                                  05000001
050100     EVALUATE TRUE                                                05010001
050200         WHEN DP020-NEXT-ACT-INITIAL                              05020001
050300             INITIALIZE ASC-SPECIFIC-COMMAREA                     05030001
050400             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05040001
050500                                      ASC-SEL-TERM-ID             05050001
050600             MOVE DP020-SRC-TASK-NUMBER                           05060001
050700                                   TO ASC-LIST-TASK-NUMBER        05070001
050800                                      ASC-SEL-TASK-NUMBER         05080001
050900             MOVE PC-LIST-QUEUE-SEQ                               05090001
051000                                   TO ASC-LIST-SEQ                05100001
051100             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05110001
051200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05120001
051300***-----$TEMPLATE NOTE$-------------------------------------------05130001
051400*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05140001
051500*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05150001
051600*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05160001
051700***---------------------------------------------------------------05170001
051800             IF  PS-COMMAREA-NOT-VALID                            05180001
052300                 SET DP020-NEXT-ACT-APPL-ERROR                    05230001
052400                                   TO TRUE                        05240001
052500             ELSE                                                 05250001
052600                 PERFORM 4000-BUILD-INITIAL-PANEL                 05260001
052700             END-IF                                               05270001
052800                                                                  05280001
052900         WHEN DP020-NEXT-ACT-READ-MAP                             05290001
053000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05300001
053100                                   TO PV-TOP-ITEM                 05310001
053200             PERFORM 2000-PROCESS-PANEL                           05320001
053300                                                                  05330001
053400         WHEN DP020-NEXT-ACT-RETURN                               05340001
053500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05350001
053600                                   TO PV-TOP-ITEM                 05360001
053700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05370001
053800             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05380001
053900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05390001
054000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05400001
054100                                                                  05410001
054200         WHEN OTHER                                               05420001
054300             SET DP013-LOGIC-ABEND TO TRUE                        05430001
054400             SET DP013-NO-ROLLBACK TO TRUE                        05440001
054500             MOVE '1000-CONTROL-PROCESSING'                       05450001
054600                                   TO DP013-PARAGRAPH             05460001
054700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05470001
054800                                   TO DP013-MESSAGE-TEXT(1)       05480001
054900             PERFORM DP013-0000-PROCESS-ABEND                     05490001
055000     END-EVALUATE.                                                05500001
055100                                                                  05510001
055200 EJECT                                                            05520001
055300*----------------------------------------------------------------*05530001
055400* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05540001
055500* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.               05550001
055600*----------------------------------------------------------------*05560001
055700                                                                  05570001
055800 1100-PROCESS-INTER-APPL-COMM.                                    05580001
055900                                                                  05590001
056000     SET PS-COMMAREA-VALID         TO TRUE.                       05600001
056100     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05610001
056200                                                                  05620001
056300 EJECT                                                            05630001
056400*----------------------------------------------------------------*05640001
056500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05650001
056600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05660001
056700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05670001
056800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID       05680001
056900* FUNCTION KEYS CAN GET THIS FAR.                                 05690001
057000*----------------------------------------------------------------*05700001
057100                                                                  05710001
057200 2000-PROCESS-PANEL.                                              05720001
057300     EVALUATE TRUE                                                05730001
057400         WHEN DP020-SRC-AID = DP016-CLEAR                         05740001
057500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05750001
057600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05760001
057700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05770001
057800                                                                  05780001
057900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05790001
058000             PERFORM 2050-DELETE-LIST-QUEUE                       05800001
058100             PERFORM 4000-BUILD-INITIAL-PANEL                     05810001
058200                                                                  05820001
059100         WHEN OTHER                                               05910001
059200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05920001
059300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05930001
059400             IF  PS-NO-ERROR                                      05940001
059500                 SET DP030-CONTINUE-GO                            05950001
059600                                 TO TRUE                          05960001
059700                 PERFORM 2100-CHECK-FUNCTION-KEY                  05970001
059800             ELSE                                                 05980001
059900                 SET DP030-OVERRIDE-GO                            05990001
060000                                 TO TRUE                          06000001
060100             END-IF                                               06010001
060200     END-EVALUATE.                                                06020001
060300 EJECT                                                            06030001
060400*----------------------------------------------------------------*06040001
060500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                      06050001
060600*----------------------------------------------------------------*06060001
060700 2050-DELETE-LIST-QUEUE.                                          06070001
060800                                                                  06080001
060900     EXEC CICS                                                    06090001
061000         DELETEQ TS                                               06100001
061100             QUEUE (ASC-LIST-QUEUE-NAME)                          06110001
061200             RESP  (PV-CICS-RESP)                                 06120001
061300     END-EXEC.                                                    06130001
061400                                                                  06140001
061500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06150001
061600        (PV-CICS-RESP = DFHRESP(QIDERR))                          06160001
061700         CONTINUE                                                 06170001
061800     ELSE                                                         06180001
061900         SET DP013-CICS-ABEND      TO TRUE                        06190001
062000         SET DP013-NO-ROLLBACK     TO TRUE                        06200001
062100                                                                  06210001
062200         MOVE '2050-DELETE-LIST-QUEUE'                            06220001
062300                                   TO DP013-PARAGRAPH             06230001
062400         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06240001
062500                                   TO DP013-MESSAGE-TEXT (1)      06250001
062600         PERFORM DP013-0000-PROCESS-ABEND                         06260001
062700     END-IF.                                                      06270001
062800                                                                  06280001
062900     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06290001
063000 EJECT                                                            06300001
063100*----------------------------------------------------------------*06310001
063200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06320001
063300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE   06330001
063400* CICS ARCHITECTURE API.                                          06340001
063500*----------------------------------------------------------------*06350001
063600 2100-CHECK-FUNCTION-KEY.                                         06360001
063700     EVALUATE TRUE                                                06370001
063800         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  06380001
063900             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              06390009
063901                 INITIALIZE CN011-INTER-APPL-COMMAREA             06390109
063920*                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                06392009
063930*                               TO DP056-NUMBER-OF-SELECTED-ITEMS 06393009
063940                 PERFORM 5000-PREPARE-SEL-QUEUE                   06394009
063950             ELSE                                                 06395009
064500                 SET DP030-OVERRIDE-GO                            06450001
064600                                   TO TRUE                        06460001
064700                 MOVE PC-TSYMSG-00057                             06470001
064800                                   TO DP020-MSG-NUMBER            06480001
064900                 SET DP020-MSG-WARNING                            06490001
065000                                   TO TRUE                        06500001
065100             END-IF                                               06510001
065200                                                                  06520001
065300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06530001
065400             MOVE -1               TO ASTRTITL                    06540001
065500             SET DP030-SET-CURSOR-APPL-1                          06550001
065600                               TO TRUE                            06560001
065700             MOVE +1               TO PV-TOP-ITEM                 06570001
065800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06580001
065900                                                                  06590001
066000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06600001
066100             MOVE -1               TO ASTRTITL                    06610001
066200             SET DP030-SET-CURSOR-APPL-1                          06620001
066300                               TO TRUE                            06630001
066400             PERFORM 2110-BROWSE-BACKWARD                         06640001
066500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06650001
066600                                                                  06660001
066700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06670001
066800             MOVE -1               TO ASTRTITL                    06680001
066900             SET DP030-SET-CURSOR-APPL-1                          06690001
067000                               TO TRUE                            06700001
067100             PERFORM 2120-BROWSE-FORWARD                          06710001
067200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06720001
067300                                                                  06730001
067400         WHEN DP020-SRC-AID = DP016-ENTER                         06740001
067500             MOVE -1               TO ASTRTITL                    06750001
067600             SET DP030-SET-CURSOR-APPL-1                          06760001
067700                               TO TRUE                            06770001
068400                                                                  06840001
068500         WHEN OTHER                                               06850001
068600             SET DP013-NO-ROLLBACK                                06860001
068700                 DP013-XCTL-DISPLAY-RESTART                       06870001
068800                 DP013-CICS-ABEND  TO TRUE                        06880001
068900             MOVE '2100-CHECK-FUNCTION-KEY'                       06890001
069000                                   TO DP013-PARAGRAPH             06900001
069100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06910001
069200                                   TO DP013-MESSAGE-TEXT (1)      06920001
069300             PERFORM DP013-0000-PROCESS-ABEND                     06930001
069400     END-EVALUATE.                                                06940001
069500*                                                                 06950001
069600*----------------------------------------------------------------*06960009
069700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06970009
069800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,       06980009
069900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06990009
070000*    MESSAGE.                                                     07000009
070100*----------------------------------------------------------------*07010009
070200                                                                  07020009
070300 2110-BROWSE-BACKWARD.                                            07030009
070400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07040009
070500         GIVING PV-TOP-ITEM.                                      07050009
070600*                                                                 07060009
070700     IF  ((PV-TOP-ITEM < +1)                                      07070009
070800       OR (PV-TOP-ITEM = +1))                                     07080009
070900         MOVE +1                   TO PV-TOP-ITEM                 07090009
071000*        -- TOP OF LIST --                                        07100009
071100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07110009
071200         SET DP020-MSG-INFORMATIONAL TO TRUE                      07120009
071300     END-IF.                                                      07130009
071400                                                                  07140009
071500 EJECT                                                            07150009
071600*----------------------------------------------------------------*07160009
071700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP       07170009
071800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO    07180009
071900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.              07190009
072000*----------------------------------------------------------------*07200009
072100                                                                  07210009
072200 2120-BROWSE-FORWARD.                                             07220009
072300                                                                  07230009
072400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07240009
072500         GIVING PV-TOP-ITEM.                                      07250009
072600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07260009
072700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07270009
072800                                   TO PV-TOP-ITEM                 07280009
072900*        -- BOTTOM OF LIST --                                     07290009
073000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07300009
073100         SET DP020-MSG-INFORMATIONAL                              07310009
073200                                   TO TRUE                        07320009
073300     ELSE                                                         07330009
073400         COMPUTE PV-BOTTOM-ITEM =                                 07340009
073500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07350009
073600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07360009
073700*            -- BOTTOM OF LIST --                                 07370009
073800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07380009
073900             SET DP020-MSG-INFORMATIONAL                          07390009
074000                                   TO TRUE                        07400009
074100         END-IF                                                   07410009
074200     END-IF.                                                      07420009
074300 EJECT                                                            07430009
074400*----------------------------------------------------------------*07440009
074500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07450009
074600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07460009
074700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07470009
074800*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.          07480009
074900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07490009
075000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.           07500009
075100*----------------------------------------------------------------*07510009
075200                                                                  07520009
075300 2130-CHECK-FOR-JUMP-BROWSE.                                      07530009
075400     SET PS-NO-ERROR               TO TRUE.                       07540009
075500     IF (ASC-START-ITEM-REQUEST = SPACE)                          07550009
075600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07560009
075700                                   TO PV-TOP-ITEM                 07570009
075800     ELSE                                                         07580009
075900         MOVE ASC-START-ITEM-REQUEST                              07590009
076000                                   TO DP010I-UNEDITED-FIELD       07600009
076100         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07610009
076200         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07620009
076300         SET DP010I-NEGATIVE-NOT-ALLOWED                          07630009
076400                                   TO TRUE                        07640009
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07651015
263455              USING DP010I-NUMERIC-EDIT-AREA                      07652015
076600                                                                  07660009
076700         IF  NOT DP010I-ERROR-DETECTED                            07670009
076800             MOVE DP010I-NUMERIC-FIELD                            07680009
076900                                   TO  ASC-START-ITEM-REQUEST-N   07690009
077000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07700009
077100                 IF  ASC-START-ITEM-REQUEST-N >                   07710009
077200                                          ASC-NUMBER-OF-ITEMS-READ07720009
077300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07730009
077400                     COMPUTE PV-TOP-ITEM =                        07740009
077500                             ASC-NUMBER-OF-ITEMS-READ             07750009
077600                             - PC-ITEMS-PER-PANEL + 1             07760009
077700                     IF  PV-TOP-ITEM < +1                         07770009
077800                         MOVE +1   TO PV-TOP-ITEM                 07780009
077900                         MOVE PC-TSYMSG-00070                     07790009
078000                                   TO DP020-MSG-NUMBER            07800009
078100                         SET DP020-MSG-INFORMATIONAL              07810009
078200                                   TO TRUE                        07820009
078300                     END-IF                                       07830009
078400                 ELSE                                             07840009
078500                     MOVE ASC-START-ITEM-REQUEST-N                07850009
078600                                   TO PV-TOP-ITEM                 07860009
078700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07870009
078800                     COMPUTE PV-BOTTOM-ITEM =                     07880009
078900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07890009
079000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07900009
079100*                        -- BOTTOM OF LIST --                     07910009
079200                         MOVE PC-TSYMSG-00070                     07920009
079300                                   TO DP020-MSG-NUMBER            07930009
079400                         SET DP020-MSG-INFORMATIONAL              07940009
079500                                   TO TRUE                        07950009
079600                     END-IF                                       07960009
079700                 END-IF                                           07970009
079800             ELSE                                                 07980009
079900*                --- VALUE OUT OF RANGE ----                      07990009
080000                 MOVE PC-TSYMSG-00101                             08000009
080100                                   TO DP020-MSG-NUMBER            08010009
080200                 MOVE -1           TO ASTRTITL                    08020009
080300                 SET DP030-SET-CURSOR-APPL-1                      08030009
080400                                   TO TRUE                        08040009
080500                 MOVE DP015-REVERSE                               08050009
080600                                   TO ASTRTITH                    08060009
080700                 MOVE DP015-RED    TO ASTRTITC                    08070009
080800                 MOVE DP015-UNP-NUM-BRT-MDT                       08080009
080900                                   TO ASTRTITA                    08090009
081000                 SET DP020-MSG-FATAL                              08100009
081100                                   TO TRUE                        08110009
081200                 SET PS-ERROR      TO TRUE                        08120009
081300             END-IF                                               08130009
081400                                                                  08140009
081500         ELSE                                                     08150009
081600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08160009
081700             MOVE -1               TO ASTRTITL                    08170009
081800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08180009
081900             MOVE DP015-REVERSE    TO ASTRTITH                    08190009
082000             MOVE DP015-RED        TO ASTRTITC                    08200009
082100             MOVE DP015-UNP-NUM-BRT-MDT                           08210009
082200                                   TO ASTRTITA                    08220009
082300             SET DP020-MSG-FATAL   TO TRUE                        08230009
082400             SET PS-ERROR          TO TRUE                        08240009
082500         END-IF                                                   08250009
082600     END-IF.                                                      08260009
082700 EJECT                                                            08270009
082800*----------------------------------------------------------------*08280009
082900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION       08290009
083000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.          08300009
083100*----------------------------------------------------------------*08310009
083200 2140-DESELECT-ALL-ITEMS.                                         08320009
083300     MOVE +1                       TO ASC-BLK-SUB.                08330009
083400                                                                  08340009
083500     PERFORM 2141-CLEAR-SELECTED-INDS                             08350009
083600         VARYING ASC-ITEM-SUB                                     08360009
083700         FROM 1 BY 1                                              08370009
083800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08380009
083900                                                                  08390009
084000     ADD +1                        TO ASC-BLK-SUB.                08400009
084100                                                                  08410009
084200     PERFORM 2141-CLEAR-SELECTED-INDS                             08420009
084300         VARYING ASC-ITEM-SUB                                     08430009
084400         FROM 1 BY 1                                              08440009
084500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08450009
084600                                                                  08460009
084700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08470009
084800                                   TO PV-LIST-ITEM-NUMBER.        08480009
084900                                                                  08490009
085000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08500009
085100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08510009
085200                                                                  08520009
085300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08530009
085400        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      08540009
085500         MOVE +1                   TO ASC-BLK-SUB                 08550009
085600                                                                  08560009
085700         PERFORM 5100-WRITE-TEMP-STORAGE                          08570009
085800                                                                  08580009
085900         MOVE +1                   TO PV-BLOCK-NUMBER             08590009
086000                                                                  08600009
086100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08610009
086200             PV-FIRST-BLOCK-IN-ARRAY - 1                          08620009
086300                                                                  08630009
086400         PERFORM                                                  08640009
086500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08650009
086600                                                                  08660009
086700             PERFORM 4410-READ-TEMP-STORAGE                       08670009
086800                                                                  08680009
086900             PERFORM 2141-CLEAR-SELECTED-INDS                     08690009
087000                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 08700009
087100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08710009
087200                                                                  08720009
087300             PERFORM 5100-WRITE-TEMP-STORAGE                      08730009
087400                                                                  08740009
087500             ADD +1                TO PV-BLOCK-NUMBER             08750009
087600                                                                  08760009
087700         END-PERFORM                                              08770009
087800                                                                  08780009
087900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08790009
088000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08800009
088100                                                                  08810009
088200         PERFORM                                                  08820009
088300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08830009
088400                   ASC-HIGHEST-BLOCK-WRITTEN                      08840009
088500                                                                  08850009
088600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08860009
088700                                   TO PV-BLOCK-NUMBER             08870009
088800                                                                  08880009
088900             PERFORM 4410-READ-TEMP-STORAGE                       08890009
089000                                                                  08900009
089100             PERFORM 2141-CLEAR-SELECTED-INDS                     08910009
089200                 VARYING ASC-ITEM-SUB                             08920009
089300                 FROM 1 BY 1                                      08930009
089400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08940009
089500                                                                  08950009
089600             PERFORM 5100-WRITE-TEMP-STORAGE                      08960009
089700                                                                  08970009
089800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08980009
089900                                                                  08990009
090000         END-PERFORM                                              09000009
090100                                                                  09010009
090200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09020009
090300                                   TO PV-BLOCK-NUMBER             09030009
090400                                                                  09040009
090500         PERFORM 4410-READ-TEMP-STORAGE                           09050009
090600     END-IF.                                                      09060009
090700                                                                  09070009
090800                                                                  09080009
090900     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 09090009
091000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.09100009
091100     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  09110009
091200                                                                  09120009
091300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09130009
091400                                                                  09140009
091500 EJECT                                                            09150009
091600*----------------------------------------------------------------*09160009
091700*    MARK EACH ITEM AS BEING NOT SELECTED.                        09170009
091800*----------------------------------------------------------------*09180009
091900                                                                  09190009
092000 2141-CLEAR-SELECTED-INDS.                                        09200009
092100                                                                  09210009
092200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09220009
092300             NOT EQUAL ZERO                                       09230009
092400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09240009
092500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09250009
092600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09260009
092700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09270009
092800                                   TO TRUE                        09280009
092900         END-IF                                                   09290009
093000     END-IF.                                                      09300009
093100                                                                  09310009
093200 EJECT                                                            09320009
093300*----------------------------------------------------------------*09330009
093400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *09340009
093500*  FOR ALL ITEMS.                                                 09350009
093600*----------------------------------------------------------------*09360009
093700                                                                  09370009
093800 2150-SELECT-ALL-ITEMS.                                           09380009
093900                                                                  09390009
094000     MOVE +1                       TO ASC-BLK-SUB.                09400009
094100                                                                  09410009
094200     PERFORM 2151-SET-SELECTED-INDS                               09420009
094300         VARYING ASC-ITEM-SUB                                     09430009
094400         FROM 1 BY 1                                              09440009
094500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09450009
094600                                                                  09460009
094700     ADD +1                        TO ASC-BLK-SUB.                09470009
094800                                                                  09480009
094900     PERFORM 2151-SET-SELECTED-INDS                               09490009
095000         VARYING ASC-ITEM-SUB                                     09500009
095100         FROM 1 BY 1                                              09510009
095200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09520009
095300                                                                  09530009
095400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09540009
095500                                   TO PV-LIST-ITEM-NUMBER.        09550009
095600                                                                  09560009
095700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09570009
095800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09580009
095900                                                                  09590009
096000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09600009
096100        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09610009
096200         MOVE +1                   TO ASC-BLK-SUB                 09620009
096300                                                                  09630009
096400         PERFORM 5100-WRITE-TEMP-STORAGE                          09640009
096500                                                                  09650009
096600         MOVE +1                   TO PV-BLOCK-NUMBER             09660009
096700                                                                  09670009
096800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09680009
096900             PV-FIRST-BLOCK-IN-ARRAY - 1                          09690009
097000                                                                  09700009
097100         PERFORM                                                  09710009
097200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09720009
097300                                                                  09730009
097400             PERFORM 4410-READ-TEMP-STORAGE                       09740009
097500                                                                  09750009
097600             PERFORM 2151-SET-SELECTED-INDS                       09760009
097700                 VARYING ASC-ITEM-SUB                             09770009
097800                 FROM 1 BY 1                                      09780009
097900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09790009
098000                                                                  09800009
098100             PERFORM 5100-WRITE-TEMP-STORAGE                      09810009
098200                                                                  09820009
098300             ADD +1                TO PV-BLOCK-NUMBER             09830009
098400                                                                  09840009
098500         END-PERFORM                                              09850009
098600                                                                  09860009
098700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09870009
098800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09880009
098900                                                                  09890009
099000         PERFORM                                                  09900009
099100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09910009
099200                   ASC-HIGHEST-BLOCK-WRITTEN                      09920009
099300                                                                  09930009
099400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09940009
099500                                   TO PV-BLOCK-NUMBER             09950009
099600                                                                  09960009
099700             PERFORM 4410-READ-TEMP-STORAGE                       09970009
099800                                                                  09980009
099900             PERFORM 2151-SET-SELECTED-INDS                       09990009
100000                 VARYING ASC-ITEM-SUB                             10000009
100100                 FROM 1 BY 1                                      10010009
100200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10020009
100300                                                                  10030009
100400             PERFORM 5100-WRITE-TEMP-STORAGE                      10040009
100500                                                                  10050009
100600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10060009
100700                                                                  10070009
100800         END-PERFORM                                              10080009
100900                                                                  10090009
101000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10100009
101100                                   TO PV-BLOCK-NUMBER             10110009
101200                                                                  10120009
101300         PERFORM 4410-READ-TEMP-STORAGE                           10130009
101400     END-IF.                                                      10140009
101500                                                                  10150009
101600                                                                  10160009
101700     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10170009
101800                       ASC-NUMBER-OF-SELECTED-ITEMS.              10180009
101900                                                                  10190009
102000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10200009
102100                                                                  10210009
102200 EJECT                                                            10220009
102300*----------------------------------------------------------------*10230009
102400*    MARK EACH ITEM AS BEING SELECTED.                            10240009
102500*----------------------------------------------------------------*10250009
102600                                                                  10260009
102700 2151-SET-SELECTED-INDS.                                          10270009
102800                                                                  10280009
102900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10290009
103000             NOT EQUAL ZERO                                       10300009
103100         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10310009
103200             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10320009
103300                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10330009
103400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10340009
103500                               TO  TRUE                           10350009
103600         END-IF                                                   10360009
103700     END-IF.                                                      10370009
103800******************************************************************10380009
103900** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10390009
104000** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10400009
104100******************************************************************10410009
104200 2200-MOVE-SCREEN-TO-COMMAREA.                                    10420009
104300                                                                  10430009
104400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10440009
104500     MOVE +1                       TO PV-SUB.                     10450009
104600*                                                                 10460009
104700     PERFORM 3100-SET-SUBSCRIPTS.                                 10470009
104800     IF  ASTRTITL > ZERO                                          10480009
104900         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10490009
105000     ELSE                                                         10500009
105100         IF  ASTRTITF = DP015-ERASE-EOF                           10510009
105200             INITIALIZE ASC-START-ITEM-REQUEST                    10520009
105300         END-IF                                                   10530009
105400     END-IF.                                                      10540009
105500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10550009
105600         VARYING PV-SUB                                           10560009
105700         FROM 1 BY 1                                              10570009
105800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10580009
105900******************************************************************10590009
106000** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**10600009
106100******************************************************************10610009
106200 2210-MOVE-LINES-TO-COMMAREA.                                     10620009
106300     IF  MR-SELECTL (PV-SUB) > ZERO                               10630009
106400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10640009
106500         MOVE MR-SELECTI (PV-SUB)                                 10650009
106600                                   TO ASC-TEMP-SELECTED-SW        10660009
106700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10670009
106800     ELSE                                                         10680009
106900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10690009
107000                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10700009
107100                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        10710009
107200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10720009
107300         END-IF                                                   10730009
107400     END-IF.                                                      10740009
107500     ADD +1                        TO ASC-ITEM-SUB.               10750009
107600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10760009
107700         ADD +1                    TO ASC-BLK-SUB                 10770009
107800         MOVE +1                   TO ASC-ITEM-SUB                10780009
107900     END-IF.                                                      10790009
108000******************************************************************10800001
108100** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE        10810001
108200** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **10820001
108300******************************************************************10830001
108400 3000-EDIT-DATA-IN-COMMAREA.                                      10840001
108500     SET PS-NO-ERROR               TO TRUE.                       10850001
108600     PERFORM 3200-RESET-ATTRIBUTES.                               10860001
108700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10870001
108800**                                                                10880001
108900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              10890001
109000* EDITTING IS DONE FROM THE BOTTOM UP.                            10900001
109100**                                                                10910001
109200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       10920001
109300         ASC-ITEMS-DISPLAYED - 1.                                 10930001
109400     PERFORM 3100-SET-SUBSCRIPTS.                                 10940001
109500     PERFORM 3300-EDIT-SELECTIONS                                 10950001
109600         VARYING PV-SUB                                           10960001
109700         FROM PV-SUB BY -1                                        10970001
109800         UNTIL PV-SUB < +1                                        10980001
109900*                                                                 10990001
110000     IF  PS-NO-ERROR                                              11000001
110100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        11010001
110200     END-IF.                                                      11020001
110300*                                                                 11030001
110400     IF  ((PS-NO-ERROR)                                           11040001
110500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11050001
110600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11060001
110700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  11070001
110800     END-IF.                                                      11080001
110900 EJECT                                                            11090001
111000*----------------------------------------------------------------*11100001
111100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM  11110001
111200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*11120001
111300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                   11130001
111400*                                                                 11140001
111500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11150001
111600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11160001
111700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11170001
111800*    US IN THE 2ND BLOCK OF THE ARRAY.                            11180001
111900*----------------------------------------------------------------*11190001
112000                                                                  11200001
112100 3100-SET-SUBSCRIPTS.                                             11210001
112200                                                                  11220001
112300     COMPUTE ASC-ITEM-SUB =                                       11230001
112400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11240001
112500                                                                  11250001
112600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11260001
112700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11270001
112800                                                                  11280001
112900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               11290001
113000     ELSE                                                         11300001
113100         MOVE +1                     TO ASC-BLK-SUB               11310001
113200     END-IF.                                                      11320001
113300******************************************************************11330001
113400** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     * 11340001
113500******************************************************************11350001
113600                                                                  11360001
113700 3200-RESET-ATTRIBUTES.                                           11370001
113800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   11380001
113900     MOVE DP015-GREEN              TO ASTRTITC.                   11390001
114000     MOVE DP015-UNDERLINE          TO ASTRTITH.                   11400001
114100*                                                                 11410001
114200     PERFORM                                                      11420001
114300         VARYING PV-SUB                                           11430001
114400         FROM 1 BY 1                                              11440001
114500         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        11450001
114600         MOVE DP015-UNP-ALP-NOR-OFF                               11460001
114700                                   TO MR-SELECTA (PV-SUB)         11470001
114800         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         11480001
114900         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         11490001
115000     END-PERFORM.                                                 11500001
115100******************************************************************11510001
115200** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **11520001
115300** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **11530001
115400** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **11540001
115500** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.               11550001
115600******************************************************************11560001
115700 3300-EDIT-SELECTIONS.                                            11570001
115800     EVALUATE TRUE                                                11580001
115900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11590001
116000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11600001
116100                 CONTINUE                                         11610001
116200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         11620001
116300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11630001
116400                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   11640001
116500                 MOVE ASC-TEMP-SELECTED-SW                        11650001
116600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11660001
116700                                TO ASC-SELECTED-SW                11670001
116800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11680001
116900             END-IF                                               11690001
117000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11700001
117100                 = SPACE                                          11710001
117200             EVALUATE TRUE                                        11720001
117300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       11730001
117400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS11740001
117500                     MOVE SPACE TO ASC-SELECTED-SW                11750001
117600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11760001
117700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        11770001
117800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    11780001
117900                     MOVE SPACE TO ASC-SELECTED-SW                11790001
118000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11800001
118100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          11810001
118200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      11820001
118300                     MOVE SPACE TO ASC-SELECTED-SW                11830001
118400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11840001
118500             END-EVALUATE                                         11850001
118600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           11860001
118700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11870001
118800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    11880001
118900             END-IF                                               11890001
119000             PERFORM 3310-EDIT-RANGE                              11900001
119100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             11910001
119200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11920001
119300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    11930001
119400             END-IF                                               11940001
119500             PERFORM 3310-EDIT-RANGE                              11950001
119600         WHEN OTHER                                               11960001
119700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           11970001
119800             SET DP020-MSG-FATAL    TO TRUE                       11980001
119900             MOVE -1                TO MR-SELECTL (PV-SUB)        11990001
120000             SET DP030-SET-CURSOR-APPL-1                          12000001
120100                                    TO TRUE                       12010001
120200             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        12020001
120300             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        12030001
120400             SET PS-ERROR TO TRUE                                 12040001
120500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12050001
120600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     12060001
120700                 MOVE SPACE         TO ASC-SELECTED-SW            12070001
120800                                        (ASC-BLK-SUB ASC-ITEM-SUB)12080001
120900             END-IF                                               12090001
121000     END-EVALUATE.                                                12100001
121100                                                                  12110001
121200     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 12120001
121300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12130001
121400     IF  ASC-ITEM-SUB < 1                                         12140001
121500         SUBTRACT +1 FROM ASC-BLK-SUB                             12150001
121600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12160001
121700     END-IF.                                                      12170001
121800******************************************************************12180001
121900** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A        12190001
122000** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **12200001
122100** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**12210001
122200** THE ENDING.                                                    12220001
122300******************************************************************12230001
122400 3310-EDIT-RANGE.                                                 12240001
122500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                12250001
122600         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   12260001
122700             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)12270001
122800                                   TO ASC-SELECTED-SW             12280001
122900                                        (ASC-BLK-SUB ASC-ITEM-SUB)12290001
123000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 12300001
123100         ELSE                                                     12310001
123200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     12320001
123300                 CONTINUE                                         12330001
123400             ELSE                                                 12340001
123500*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        12350001
123600                 MOVE PC-TSYMSG-00054                             12360001
123700                                   TO DP020-MSG-NUMBER            12370001
123800                 SET DP020-MSG-FATAL                              12380001
123900                                   TO TRUE                        12390001
124000                 MOVE -1           TO MR-SELECTL (PV-SUB)         12400001
124100                 SET DP030-SET-CURSOR-APPL-1                      12410001
124200                                   TO TRUE                        12420001
124300                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         12430001
124400                 MOVE DP015-UNDERLINE                             12440001
124500                                   TO MR-SELECTH (PV-SUB)         12450001
124600                 SET PS-ERROR      TO TRUE                        12460001
124700             END-IF                                               12470001
124800         END-IF                                                   12480001
124900     ELSE                                                         12490001
125000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     12500001
125100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 12510001
125200                                   TO ASC-SELECTED-SW             12520001
125300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12530001
125400             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   12540001
125500         ELSE                                                     12550001
125600             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       12560001
125700                 CONTINUE                                         12570001
125800             ELSE                                                 12580001
125900*                -- ONLY ONE END-OF-RANGE ALLOWED --              12590001
126000                 MOVE PC-TSYMSG-00055                             12600001
126100                                   TO DP020-MSG-NUMBER            12610001
126200                 SET DP020-MSG-FATAL                              12620001
126300                                   TO TRUE                        12630001
126400                 MOVE -1           TO MR-SELECTL (PV-SUB)         12640001
126500                 SET DP030-SET-CURSOR-APPL-1                      12650001
126600                                   TO TRUE                        12660001
126700                 SET PS-ERROR      TO TRUE                        12670001
126800             END-IF                                               12680001
126900         END-IF                                                   12690001
127000     END-IF.                                                      12700001
127100*                                                                 12710001
127200******************************************************************12720001
127300** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **12730001
127400** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **12740001
127500******************************************************************12750001
127600 3400-CHECK-RANGE-SEQUENCE.                                       12760001
127700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       12770001
127800       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      12780001
127900       AND  ASC-START-OF-SELECTED-RANGE >                         12790001
128000                                         ASC-END-OF-SELECTED-RANGE12800001
128100*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                12810001
128200         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 12820001
128300         SET DP020-MSG-FATAL TO TRUE                              12830001
128400         SET PS-ERROR TO TRUE                                     12840001
128500         PERFORM 3410-POSITION-AT-ERROR                           12850001
128600     END-IF.                                                      12860001
128700******************************************************************12870001
128800** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **12880001
128900** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **12890001
129000** SHOULD BE POSITIONED ON A RANGE ERROR.                         12900001
129100******************************************************************12910001
129200 3410-POSITION-AT-ERROR.                                          12920001
129300     SET DP030-SET-CURSOR-APPL-1                                  12930001
129400                                   TO TRUE.                       12940001
129500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 12950001
129600                    - PV-TOP-ITEM + 1.                            12960001
129700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      12970001
129800         CONTINUE                                                 12980001
129900     ELSE                                                         12990001
130000         MOVE -1                   TO MR-SELECTL (PV-SUB)         13000001
130100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13010001
130200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13020001
130300     END-IF.                                                      13030001
130400*                                                                 13040001
130500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   13050001
130600                    - PV-TOP-ITEM + 1.                            13060001
130700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13070001
130800         CONTINUE                                                 13080001
130900     ELSE                                                         13090001
131000         MOVE -1                   TO MR-SELECTL (PV-SUB)         13100001
131100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13110001
131200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13120001
131300     END-IF.                                                      13130001
131400 EJECT                                                            13140001
131500*----------------------------------------------------------------*13150001
131600*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *13160001
131700*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *13170001
131800*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.              13180001
131900*----------------------------------------------------------------*13190001
132000                                                                  13200001
132100 3500-MARK-RANGE-AS-SELECTED.                                     13210001
132200     MOVE +1                       TO  ASC-BLK-SUB.               13220001
132300     PERFORM 3510-MARK-SELECTED-INDS                              13230001
132400         VARYING ASC-ITEM-SUB                                     13240001
132500         FROM 1 BY 1                                              13250001
132600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13260001
132700                                                                  13270001
132800     ADD +1                        TO ASC-BLK-SUB.                13280001
132900     PERFORM 3510-MARK-SELECTED-INDS                              13290001
133000         VARYING ASC-ITEM-SUB                                     13300001
133100         FROM 1 BY 1                                              13310001
133200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13320001
133300                                                                  13330001
133400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13340001
133500                                   TO  PV-LIST-ITEM-NUMBER.       13350001
133600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13360001
133700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         13370001
133800               PC-ITEMS-PER-PANEL).                               13380001
133900                                                                  13390001
134000     MOVE ASC-START-OF-SELECTED-RANGE                             13400001
134100                                   TO PV-START-OF-SELECTED-RANGE. 13410001
134200     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            13420001
134300         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  13430001
134400               PC-ITEMS-PER-PANEL).                               13440001
134500                                                                  13450001
134600     MOVE ASC-END-OF-SELECTED-RANGE                               13460001
134700                                   TO  PV-END-OF-SELECTED-RANGE.  13470001
134800     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             13480001
134900         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    13490001
135000               PC-ITEMS-PER-PANEL).                               13500001
135100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             13510001
135200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             13520001
135300                                                                  13530001
135400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    13540001
135500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        13550001
135600         MOVE +1                   TO ASC-BLK-SUB                 13560001
135700         PERFORM 5100-WRITE-TEMP-STORAGE                          13570001
135800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13580001
135900             PV-FIRST-BLOCK-IN-ARRAY - 1                          13590001
136000                                                                  13600001
136100         PERFORM                                                  13610001
136200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      13620001
136300                   PV-PREV-BLOCK-IN-ARRAY                         13630001
136400             MOVE PV-FIRST-BLOCK-IN-RANGE                         13640001
136500                                   TO PV-BLOCK-NUMBER             13650001
136600             PERFORM 4410-READ-TEMP-STORAGE                       13660001
136700             PERFORM 3510-MARK-SELECTED-INDS                      13670001
136800                 VARYING ASC-ITEM-SUB                             13680001
136900                 FROM 1 BY 1                                      13690001
137000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13700001
137100             PERFORM 5100-WRITE-TEMP-STORAGE                      13710001
137200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     13720001
137300         END-PERFORM                                              13730001
137400                                                                  13740001
137500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13750001
137600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13760001
137700         PERFORM                                                  13770001
137800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13780001
137900                   PV-LAST-BLOCK-IN-RANGE                         13790001
138000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13800001
138100                                   TO PV-BLOCK-NUMBER             13810001
138200             PERFORM 4410-READ-TEMP-STORAGE                       13820001
138300             PERFORM 3510-MARK-SELECTED-INDS                      13830001
138400                 VARYING ASC-ITEM-SUB                             13840001
138500                 FROM 1 BY 1                                      13850001
138600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13860001
138700             PERFORM 5100-WRITE-TEMP-STORAGE                      13870001
138800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13880001
138900         END-PERFORM                                              13890001
139000                                                                  13900001
139100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13910001
139200                                   TO PV-BLOCK-NUMBER             13920001
139300         PERFORM 4410-READ-TEMP-STORAGE                           13930001
139400     END-IF.                                                      13940001
139500                                                                  13950001
139600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 13960001
139700                                      ASC-END-OF-SELECTED-RANGE.  13970001
139800                                                                  13980001
139900 EJECT                                                            13990001
140000*----------------------------------------------------------------*14000001
140100* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.            14010001
140200*----------------------------------------------------------------*14020001
140300                                                                  14030001
140400 3510-MARK-SELECTED-INDS.                                         14040001
140500                                                                  14050001
140600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14060001
140700                                ASC-ITEM-SUB) >                   14070001
140800         ASC-START-OF-SELECTED-RANGE)                             14080001
140900     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14090001
141000                                ASC-ITEM-SUB) =                   14100001
141100         ASC-START-OF-SELECTED-RANGE)                             14110001
141200                                                                  14120001
141300         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14130001
141400                                    ASC-ITEM-SUB) <               14140001
141500             ASC-END-OF-SELECTED-RANGE)                           14150001
141600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14160001
141700                                    ASC-ITEM-SUB) =               14170001
141800             ASC-END-OF-SELECTED-RANGE)                           14180001
141900                                                                  14190001
142000             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14200001
142100                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   14210001
142200                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   14220001
142300                               TO TRUE                            14230001
142400                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              14240001
142500                               TO TRUE                            14250001
142600                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    14260001
142700             END-IF                                               14270001
142800         END-IF                                                   14280001
142900     END-IF.                                                      14290001
143000                                                                  14300001
143100 EJECT                                                            14310001
143200*----------------------------------------------------------------*14320001
143300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                         14330001
143400*    INITIALIZE ALL COUNTERS AND FLAGS.                           14340001
143500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14350001
143600*    DISPLAY THE PANEL TO USER.                                   14360001
143700*----------------------------------------------------------------*14370001
143800                                                                  14380001
143900 4000-BUILD-INITIAL-PANEL.                                        14390001
144000                                                                  14400001
144100     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            14410001
144200                                 ASC-BLOCK-ENTRIES (2).           14420001
144300     MOVE +1                 TO ASC-BLK-SUB.                      14430001
144400     SET ASC-ITEMS-LEFT-ON-DB                                     14440001
144500                             TO TRUE.                             14450001
144600                                                                  14460001
144700     MOVE +0                 TO ASC-ITEM-SUB                      14470001
144800                                ASC-NUMBER-OF-ITEMS-READ          14480001
144900                                ASC-NUMBER-OF-SELECTED-ITEMS      14490001
145000                                ASC-HIGHEST-BLOCK-WRITTEN         14500001
145100                                ASC-START-OF-SELECTED-RANGE       14510001
145200                                ASC-END-OF-SELECTED-RANGE         14520001
145300                                ASC-ITEM-AT-TOP-OF-PANEL.         14530001
145400     PERFORM 4010-OPEN-CURSOR.                                    14540001
145500                                                                  14550001
145600     PERFORM 4300-READ-ITEMS-FROM-DB.                             14560001
145700                                                                  14570001
145800     PERFORM 4020-CLOSE-CURSOR.                                   14580001
145900                                                                  14590001
146000     MOVE +1                   TO  PV-TOP-ITEM.                   14600001
146100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          14610001
146200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    14620001
146300         SET DP020-MSG-FATAL   TO  TRUE                           14630001
146400         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               14640001
146500     ELSE                                                         14650001
146600*        MOVE -1               TO MR-SELECTL (1)                  14660001
146700         MOVE -1               TO ASTRTITL                        14670001
146800         SET DP030-SET-CURSOR-APPL-1                              14680001
146900                               TO TRUE                            14690001
147000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     14700001
147100     END-IF.                                                      14710001
147200 EJECT                                                            14720001
147300*----------------------------------------------------------------*14730001
147400* OPEN CURSOR                                                     14740008
147500*----------------------------------------------------------------*14750001
147700 4010-OPEN-CURSOR.                                                14770001
148400                                                                  14840001
148410     PERFORM                                                      14841009
148420         WITH TEST AFTER                                          14842009
148430         VARYING PV-RETRY-COUNTER                                 14843009
148440         FROM 1 BY 1                                              14844009
148450         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14845009
148460                   OR (SQLCODE = ZERO))                           14846009
148470                                                                  14847009
148500                 EXEC SQL                                         14850001
148600                      OPEN DOOR_TYP_CSR                           14860009
148700                 END-EXEC                                         14870001
148800                                                                  14880001
148900         EVALUATE TRUE                                            14890001
149000             WHEN SQLCODE = ZERO                                  14900001
149300                 CONTINUE                                         14930001
149400             WHEN SQLWARN0 NOT = SPACES                           14940001
149500             WHEN SQLCODE < ZERO                                  14950001
149600             WHEN SQLCODE > ZERO                                  14960001
149700                 MOVE '4010-OPEN-CURSOR'                          14970001
149800                                   TO DP013-PARAGRAPH             14980001
149900                 MOVE 'OPEN DOOR TYPE CURSOR - '                  14990008
150000                                   TO DP013-MESSAGE-TEXT (1)      15000001
150100                 MOVE SQLCA        TO DP013-SQLCA                 15010001
150200                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    15020001
150300                 SET DP013-DB2-ABEND                              15030001
150400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15040001
150500                 PERFORM DP013-0000-PROCESS-ABEND                 15050001
150600         END-EVALUATE                                             15060001
150700     END-PERFORM.                                                 15070001
150800                                                                  15080008
150900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15090009
151000         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             15100009
151100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   15110009
151200                                   TO DP013-MESSAGE-TEXT (1)      15120009
151300         MOVE SQLCA                TO DP013-SQLCA                 15130009
151400         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    15140009
151500         SET DP013-DB2-ABEND                                      15150009
151600             DP013-XCTL-DISPLAY-RESTART                           15160009
151700                                   TO TRUE                        15170009
151800         PERFORM DP013-0000-PROCESS-ABEND                         15180009
151900     END-IF.                                                      15190009
152000                                                                  15200009
152100 EJECT                                                            15210001
152200*----------------------------------------------------------------*15220001
152300* CLOSE THE DOOR TYPE CURSOR.                                     15230008
152400*----------------------------------------------------------------*15240001
152600 4020-CLOSE-CURSOR.                                               15260001
152700                                                                  15270001
152800             EXEC SQL                                             15280001
152900                 CLOSE DOOR_TYP_CSR                               15290009
153000             END-EXEC                                             15300001
153100                                                                  15310001
153200     EVALUATE TRUE                                                15320001
153300         WHEN SQLCODE = ZERO                                      15330001
153400             CONTINUE                                             15340001
153500         WHEN SQLWARN0 NOT = SPACES                               15350001
153600         WHEN SQLCODE < ZERO                                      15360001
153700         WHEN SQLCODE > ZERO                                      15370001
153800             MOVE '4020-CLOSE-CURSOR'                             15380001
153900                               TO DP013-PARAGRAPH                 15390001
154000             MOVE 'CLOSE DOOR TYPE CURSOR '                       15400008
154100                               TO DP013-MESSAGE-TEXT (1)          15410001
154200             MOVE SQLCA        TO DP013-SQLCA                     15420001
154300             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        15430001
154400             SET DP013-DB2-ABEND                                  15440001
154500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15450001
154600             PERFORM DP013-0000-PROCESS-ABEND                     15460001
154700     END-EVALUATE.                                                15470001
154800                                                                  15480001
154900 EJECT                                                            15490001
155000*----------------------------------------------------------------*15500001
155100*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *15510001
155200*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *15520001
155300*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND   15530001
155400*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *15540001
155500*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                    15550001
155600*                                                                 15560001
155700*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *15570001
155800*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *15580001
155900*    UPON INITIALIZATION.                                         15590001
156000*----------------------------------------------------------------*15600001
156200 4300-READ-ITEMS-FROM-DB.                                         15620001
156300                                                                  15630001
156400     PERFORM                                                      15640001
156500         VARYING PV-READ-COUNT                                    15650001
156600         FROM 1 BY 1                                              15660001
156700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    15670001
156800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         15680001
156900                                                                  15690001
157000         PERFORM 4310-FETCH                                       15700001
157100                                                                  15710001
157200         IF  ASC-ITEMS-LEFT-ON-DB                                 15720001
157300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                15730001
157400                 ADD +1            TO ASC-ITEM-SUB                15740001
157500             ELSE                                                 15750001
157600                 ADD +1            TO ASC-BLK-SUB                 15760001
157700                 MOVE +1           TO ASC-ITEM-SUB                15770001
157800                                                                  15780001
157900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         15790001
158000                     MOVE +1       TO ASC-BLK-SUB                 15800001
158100                     SET ASC-BLOCK-MODIFIED (1)                   15810001
158200                                   TO TRUE                        15820001
158300                     PERFORM 5100-WRITE-TEMP-STORAGE              15830001
158400                     MOVE ASC-BLOCK-ENTRIES                       15840001
158500                               (PC-MAX-BLOCKS-IN-ARRAY)           15850001
158600                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 15860001
158700                     ADD +1        TO ASC-BLK-SUB                 15870001
158800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   15880001
158900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      15890001
159000                                   TO TRUE                        15900001
159100                 END-IF                                           15910001
159200             END-IF                                               15920001
159300             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    15930001
159400             MOVE ASC-NUMBER-OF-ITEMS-READ                        15940001
159500                                   TO ASC-LIST-ITEM-NUMBER        15950001
159600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15960001
159700             MOVE CNDRTY-DOOR-TYP-CDE-DESC                        15970009
159800                                   TO ASC-DOOR-TYP-CDE-DESC       15980009
159900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15990001
160000             MOVE CNDRTY-DOOR-TYP-CDE                             16000009
160100                                   TO ASC-DOOR-TYP-CDE            16010009
160200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16020001
160300         END-IF                                                   16030001
160400     END-PERFORM.                                                 16040001
160500                                                                  16050001
160600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          16060001
160700         MOVE +1               TO ASC-BLK-SUB                     16070001
160800         PERFORM 5100-WRITE-TEMP-STORAGE                          16080001
160900         ADD +1                TO ASC-BLK-SUB                     16090001
161000         PERFORM 5100-WRITE-TEMP-STORAGE                          16100001
161100                                                                  16110001
161200         MOVE 1                TO ASC-BLK-SUB                     16120001
161300                                  PV-BLOCK-NUMBER                 16130001
161400         PERFORM 4410-READ-TEMP-STORAGE                           16140001
161500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             16150001
161600             MOVE 2            TO ASC-BLK-SUB                     16160001
161700                                  PV-BLOCK-NUMBER                 16170001
161800             PERFORM 4410-READ-TEMP-STORAGE                       16180001
161900         END-IF                                                   16190001
162000     END-IF.                                                      16200001
162100 EJECT                                                            16210001
162200*----------------------------------------------------------------*16220001
162300*    FETCH THE MESSAGE CURSOR.                                    16230001
162400*----------------------------------------------------------------*16240001
162500                                                                  16250001
162600 4310-FETCH.                                                      16260001
162700                                                                  16270001
162800        EXEC SQL                                                  16280001
162900             FETCH DOOR_TYP_CSR                                   16290009
163000              INTO :CNDRTY-DOOR-TYP-CDE                           16300009
163100                  ,:CNDRTY-DOOR-TYP-CDE-DESC                      16310009
163200        END-EXEC.                                                 16320001
163300                                                                  16330001
163400     EVALUATE TRUE                                                16340001
163500         WHEN SQLCODE = ZERO                                      16350001
163600         WHEN SQLCODE = +100                                      16360001
163700              CONTINUE                                            16370001
163800         WHEN SQLWARN0 NOT = SPACE                                16380001
163900         WHEN SQLCODE NOT = ZERO                                  16390001
164000              MOVE '4310-FETCH-CURSOR'                            16400001
164100                               TO DP013-PARAGRAPH                 16410001
164200              MOVE 'DOOR TYPE CURSOR'                             16420009
164300                               TO DP013-MESSAGE-TEXT (1)          16430001
164400              MOVE SQLCA       TO DP013-SQLCA                     16440001
164500              SET DP013-DB2-ABEND                                 16450001
164600                               TO TRUE                            16460001
164700              PERFORM DP013-0000-PROCESS-ABEND                    16470001
164800     END-EVALUATE.                                                16480001
164900                                                                  16490001
165000     IF  SQLCODE EQUAL +100                                       16500001
165100         SET ASC-NO-ITEMS-LEFT-ON-DB                              16510001
165200                                   TO TRUE                        16520001
165300     END-IF.                                                      16530001
165400                                                                  16540001
165500 EJECT                                                            16550001
165600*----------------------------------------------------------------*16560001
165700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *16570001
165800*----------------------------------------------------------------*16580001
165900                                                                  16590001
166000 4400-MOVE-COMMAREA-TO-SCREEN.                                    16600001
166100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             16610001
166200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          16620001
166300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          16630001
166400             MOVE +1    TO ASC-BLK-SUB                            16640001
166500             PERFORM 5100-WRITE-TEMP-STORAGE                      16650001
166600             ADD +1     TO ASC-BLK-SUB                            16660001
166700             PERFORM 5100-WRITE-TEMP-STORAGE                      16670001
166800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             16680001
166900                 GIVING PV-BLOCK-NUMBER                           16690001
167000                 REMAINDER PV-REMAINDER                           16700001
167100             IF  PV-REMAINDER > ZERO                              16710001
167200                 ADD +1 TO PV-BLOCK-NUMBER                        16720001
167300             END-IF                                               16730001
167400             MOVE +1    TO ASC-BLK-SUB                            16740001
167500             PERFORM 4410-READ-TEMP-STORAGE                       16750001
167600             ADD +1     TO ASC-BLK-SUB                            16760001
167700                           PV-BLOCK-NUMBER                        16770001
167800             PERFORM 4410-READ-TEMP-STORAGE                       16780001
167900     END-IF.                                                      16790001
168000     MOVE +1            TO ASC-BLK-SUB.                           16800001
168100     COMPUTE ASC-ITEM-SUB =                                       16810001
168200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              16820001
168300         + PC-ITEMS-PER-PANEL).                                   16830001
168400*                                                                 16840001
168500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        16850001
168600         ADD +1         TO ASC-BLK-SUB                            16860001
168700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            16870001
168800     END-IF.                                                      16880001
168900*                                                                 16890001
169000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           16900001
169100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                16910001
169200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        16920001
169300     PERFORM 4420-FORMAT-LIST-LINES                               16930001
169400         VARYING PV-SUB                                           16940001
169500         FROM PC-ITEMS-PER-PANEL BY -1                            16950001
169600         UNTIL PV-SUB < +1.                                       16960001
169700*                                                                 16970001
169800     COMPUTE ASC-ITEMS-DISPLAYED =                                16980001
169900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          16990001
170000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    17000001
170100                                      ASTRTITO.                   17010001
170200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    17020001
170300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    17030001
170400*    MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            17040001
170500*                                  TO ASELITO.                    17050001
170600*                                                                 17060001
170700     IF  DP020-MSG-NUMBER-X = SPACE                               17070001
170800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  17080001
170900*            --- MORE ITEMS TO DISPLAY ----                       17090001
171000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            17100001
171100             SET DP020-MSG-INFORMATIONAL TO TRUE                  17110001
171200         END-IF                                                   17120001
171300     END-IF.                                                      17130001
171400*----------------------------------------------------------------*17140008
171500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.          17150008
171600*----------------------------------------------------------------*17160008
171700                                                                  17170008
171800 4410-READ-TEMP-STORAGE.                                          17180008
171900                                                                  17190008
172000     EXEC CICS                                                    17200008
172100         READQ TS                                                 17210008
172200             QUEUE (ASC-LIST-QUEUE-NAME)                          17220008
172300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17230008
172400             ITEM  (PV-BLOCK-NUMBER)                              17240008
172500             RESP  (PV-CICS-RESP)                                 17250008
172600     END-EXEC.                                                    17260008
172700                                                                  17270008
172800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17280008
172900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17290008
173000         CONTINUE                                                 17300008
173100     ELSE                                                         17310008
173200         SET DP013-CICS-ABEND     TO TRUE                         17320008
173300         SET DP013-NO-ROLLBACK    TO TRUE                         17330008
173400         MOVE '4410-READ-TEMP-STORAGE'                            17340008
173500                                  TO DP013-PARAGRAPH              17350008
173600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17360008
173700                                  TO DP013-MESSAGE-TEXT(1)        17370008
173800         PERFORM DP013-0000-PROCESS-ABEND                         17380008
173900     END-IF.                                                      17390008
174000                                                                  17400008
174100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17410008
174200*                                                                 17420008
174300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         17430008
174400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               17440008
174500     END-IF.                                                      17450008
174600 EJECT                                                            17460008
174700*----------------------------------------------------------------*17470008
174800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *17480008
174900*----------------------------------------------------------------*17490008
175000                                                                  17500008
175100 4420-FORMAT-LIST-LINES.                                          17510008
175200     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      17520008
175300         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                17530008
175400         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           17540008
175500         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           17550008
175600         MOVE SPACE              TO MR-SELECTI (PV-SUB)           17560008
175700         MOVE SPACE              TO MR-SELECTI (PV-SUB)           17570008
175800         MOVE SPACE              TO MR-ACTION (PV-SUB)            17580008
175900         MOVE SPACE              TO MR-DOOR-TYP-CDE-DESC (PV-SUB) 17590009
176000                                    MR-DOOR-TYP-CDE (PV-SUB)      17600009
176100     ELSE                                                         17610008
176200         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17620008
176300                                                   > SPACE        17630008
176400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17640008
176500                                 TO MR-SELECTI (PV-SUB)           17650008
176600         ELSE                                                     17660008
176700             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17670008
176800                                 TO MR-SELECTI (PV-SUB)           17680008
176900         END-IF                                                   17690008
177000                                                                  17700008
177100         IF  DP030-SET-CURSOR-TRAILER                             17710008
177200             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)17720008
177300                 > SPACE)                                         17730008
177400               OR (PV-SUB = 1))                                   17740008
177500                SET DP030-SET-CURSOR-APPL-1 TO TRUE               17750008
177600                MOVE -1          TO MR-SELECTL (PV-SUB)           17760008
177700             END-IF                                               17770008
177800         END-IF                                                   17780008
177900                                                                  17790008
178000         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           17800008
178100*            MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           17810008
178200*                                TO MR-ACTION (PV-SUB)            17820008
178300           MOVE ASC-DOOR-TYP-CDE-DESC (ASC-BLK-SUB ASC-ITEM-SUB)  17830009
178400                                 TO MR-DOOR-TYP-CDE-DESC (PV-SUB) 17840009
178500           MOVE ASC-DOOR-TYP-CDE (ASC-BLK-SUB ASC-ITEM-SUB)       17850009
178600                                 TO MR-DOOR-TYP-CDE (PV-SUB)      17860009
178700         END-IF                                                   17870008
178800     END-IF.                                                      17880008
178900     SUBTRACT +1 FROM ASC-ITEM-SUB                                17890008
179000     IF  ASC-ITEM-SUB < + 1                                       17900008
179100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  17910008
179200         MOVE +1                 TO ASC-BLK-SUB                   17920008
179300     END-IF.                                                      17930008
179400******************************************************************17940008
179500** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **17950008
179600** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,        17960008
179700** ISSUE A WARNING.                                               17970008
179800******************************************************************17980008
179900 4430-CHECK-FOR-BEGIN-AND-END.                                    17990008
180000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       18000008
180100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18010008
180200*            -- NO END-OF-RANGE SPECFIED ---                      18020008
180300             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            18030008
180400             SET DP020-MSG-WARNING TO TRUE                        18040008
180500             PERFORM 4431-POSITION-AT-WARNING                     18050008
180600         END-IF                                                   18060008
180700     ELSE                                                         18070008
180800         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     18080008
180900*            -- NO BEGINNING-OF-RANGE SPECFIED ---                18090008
181000             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            18100008
181100             SET DP020-MSG-WARNING TO TRUE                        18110008
181200             PERFORM 4431-POSITION-AT-WARNING                     18120008
181300         END-IF                                                   18130008
181400     END-IF.                                                      18140008
181500******************************************************************18150008
181600** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **18160008
181700** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **18170008
181800** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND          18180008
181900** POSITION THE CURSOR THERE.                                     18190008
182000******************************************************************18200008
182100 4431-POSITION-AT-WARNING.                                        18210008
182200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18220008
182300                    - PV-TOP-ITEM + 1.                            18230008
182400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18240008
182500         CONTINUE                                                 18250008
182600     ELSE                                                         18260008
182700         SET DP030-SET-CURSOR-APPL-1                              18270008
182800                                   TO TRUE                        18280008
182900         MOVE -1                   TO MR-SELECTL (PV-SUB)         18290008
183000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18300008
183100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         18310008
183200     END-IF.                                                      18320008
183300*                                                                 18330008
183400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18340008
183500                    - PV-TOP-ITEM + 1.                            18350008
183600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18360008
183700         CONTINUE                                                 18370008
183800     ELSE                                                         18380008
183900         SET DP030-SET-CURSOR-APPL-1                              18390008
184000                                   TO TRUE                        18400008
184100         MOVE -1                   TO MR-SELECTL (PV-SUB)         18410008
184200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18420008
184300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         18430008
184400     END-IF.                                                      18440008
184500 EJECT                                                            18450008
184600*----------------------------------------------------------------*18460008
184700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *18470008
184800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *18480008
184900* FOR THE SELECTED ITEMS QUEUE.                                   18490008
185000*                                                                 18500008
185100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *18510008
185200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *18520008
185300* THE ARRAY IS FULL.                                              18530008
185400*----------------------------------------------------------------*18540008
185500                                                                  18550008
185600 5000-PREPARE-SEL-QUEUE.                                          18560008
185700                                                                  18570008
185800     MOVE +1                   TO  ASC-BLK-SUB.                   18580008
185900     PERFORM 5100-WRITE-TEMP-STORAGE.                             18590008
186000     ADD +1                    TO  ASC-BLK-SUB.                   18600008
186100     PERFORM 5100-WRITE-TEMP-STORAGE.                             18610008
186200                                                                  18620008
186300*    MOVE ASC-SEL-QUEUE-NAME   TO  DP056-SEL-QUEUE-NAME.          18630009
186400     PERFORM 6010-DELETE-SEL-QUEUE.                               18640008
186500                                                                  18650008
186600     SET ASC-UPDATE-TSQ        TO  TRUE.                          18660008
186700                                                                  18670008
186800     SET DP057-IDX             TO  1.                             18680008
186900*    MOVE ZERO                 TO DP056-NUMBER-OF-TS-ITEMS.       18690009
187000     INITIALIZE DP057-SELECTED-ITEM-ARRAY.                        18700008
187100                                                                  18710008
187200     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           18720008
187300             VARYING PV-ITEM                                      18730008
187400             FROM 1 BY 1                                          18740008
187500             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     18750008
187600                                                                  18760008
187700     IF  DP057-IDX > 1                                            18770008
187800         PERFORM 5205-WRITE-SEL-QUEUE                             18780008
187900*        ADD +1                TO DP056-NUMBER-OF-TS-ITEMS        18790009
188000     END-IF.                                                      18800008
188100 EJECT                                                            18810008
188200*----------------------------------------------------------------*18820008
188300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.       18830008
188400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *18840008
188500*----------------------------------------------------------------*18850008
188600                                                                  18860008
188700 5100-WRITE-TEMP-STORAGE.                                         18870008
188800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     18880008
188900                                   TO PV-LIST-ITEM-NUMBER.        18890008
189000     COMPUTE PV-BLOCK-NUMBER =                                    18900008
189100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    18910008
189200                                                                  18920008
189300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             18930008
189400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             18940008
189500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      18950008
189600             PERFORM 5105-REWRITE-ASC-LISTQ                       18960008
189700         END-IF                                                   18970008
189800     ELSE                                                         18980008
189900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       18990008
190000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            19000008
190100         PERFORM 5110-WRITE-ASC-LISTQ                             19010008
190200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   19020008
190300     END-IF.                                                      19030008
190400                                                                  19040008
190500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19050008
190600******************************************************************19060008
190700** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **19070008
190800** SPECIFIC COMMAREA.                                             19080008
190900******************************************************************19090008
191000 5105-REWRITE-ASC-LISTQ.                                          19100008
191100     EXEC CICS                                                    19110008
191200         WRITEQ TS                                                19120008
191300             QUEUE (ASC-LIST-QUEUE-NAME)                          19130008
191400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19140008
191500             ITEM  (PV-BLOCK-NUMBER)                              19150008
191600             REWRITE                                              19160008
191700             RESP  (PV-CICS-RESP)                                 19170008
191800     END-EXEC.                                                    19180008
191900                                                                  19190008
192000     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           19200008
192100         CONTINUE                                                 19210008
192200     ELSE                                                         19220008
192300         SET DP013-CICS-ABEND            TO TRUE                  19230008
192400         SET DP013-NO-ROLLBACK           TO TRUE                  19240008
192500         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       19250008
192600         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     19260008
192700                                         TO DP013-MESSAGE-TEXT(1) 19270008
192800         PERFORM DP013-0000-PROCESS-ABEND                         19280008
192900     END-IF.                                                      19290008
193000                                                                  19300008
193100******************************************************************19310008
193200** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-        19320008
193300** SPECIFIC COMMAREA.                                             19330008
193400******************************************************************19340008
193500 5110-WRITE-ASC-LISTQ.                                            19350008
193600     EXEC CICS                                                    19360008
193700         WRITEQ TS                                                19370008
193800             QUEUE (ASC-LIST-QUEUE-NAME)                          19380008
193900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19390008
194000             ITEM  (PV-BLOCK-NUMBER)                              19400008
194100             RESP  (PV-CICS-RESP)                                 19410008
194200     END-EXEC.                                                    19420008
194300     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      19430008
194400         SET DP013-CICS-ABEND      TO TRUE                        19440008
194500         SET DP013-NO-ROLLBACK     TO TRUE                        19450008
194600         MOVE '5110-WRITE-ASC-LISTQ'                              19460008
194700                                   TO DP013-PARAGRAPH             19470008
194800         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           19480008
194900                                   TO DP013-MESSAGE-TEXT(1)       19490008
195000         PERFORM DP013-0000-PROCESS-ABEND                         19500008
195100     END-IF.                                                      19510008
195200 EJECT                                                            19520008
195300*----------------------------------------------------------------*19530008
195400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *19540008
195500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.                19550008
195600*----------------------------------------------------------------*19560008
195700                                                                  19570008
195800 5200-FILL-SEL-QUEUE-RECORD.                                      19580008
195900                                                                  19590008
196000     PERFORM 6112-READ-LIST-QUEUE.                                19600008
196100                                                                  19610008
196200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       19620008
196300         PERFORM                                                  19630008
196400         VARYING LQW-IDX                                          19640008
196500         FROM 1 BY 1                                              19650008
196600         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            19660008
196700           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          19670008
196800                                                                  19680008
196900             IF  LQW-SELECT (LQW-IDX)                             19690008
197000                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              19700008
197100                                   TO DP057-ITEM (DP057-IDX)      19710008
197200*                MOVE LQW-MESSAGE-NUMBER (LQW-IDX)                19720008
197300*                                  TO DP057-MESSAGE-NUMBER        19730008
197400*                                       (DP057-IDX)               19740008
197500                 MOVE SPACE        TO DP057-ACTION-SW (DP057-IDX) 19750008
197600                 SET DP057-IDX UP BY 1                            19760008
197700                 IF  DP057-IDX > DP057-MAX-ITEMS                  19770008
197800                     PERFORM 5205-WRITE-SEL-QUEUE                 19780008
197900*                    ADD +1        TO DP056-NUMBER-OF-TS-ITEMS    19790009
198000                     INITIALIZE DP057-SELECTED-ITEM-ARRAY         19800008
198100                     SET DP057-IDX TO  1                          19810008
198200                 END-IF                                           19820008
198300             END-IF                                               19830008
198400         END-PERFORM                                              19840008
198500     END-IF.                                                      19850008
198600                                                                  19860008
198700*----------------------------------------------------------------*19870008
198800*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                 19880008
198900*----------------------------------------------------------------*19890008
199000                                                                  19900008
199100 5205-WRITE-SEL-QUEUE.                                            19910008
199200                                                                  19920008
199300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19930008
199400                                   TO DP057-SELECTED-ITEMS.       19940008
199500                                                                  19950008
199600     EXEC CICS                                                    19960008
199700          WRITEQ TS                                               19970008
199800              QUEUE (ASC-SEL-QUEUE-NAME)                          19980008
199900              FROM  (DP057-MESSAGE-SEL-REC)                       19990008
200000              ITEM  (PV-SEL-QUEUE-ITEM)                           20000008
200100              RESP  (PV-CICS-RESP)                                20010008
200200     END-EXEC.                                                    20020008
200300                                                                  20030008
200400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20040008
200500         CONTINUE                                                 20050008
200600     ELSE                                                         20060008
200700         SET DP013-CICS-ABEND      TO TRUE                        20070008
200800         SET DP013-NO-ROLLBACK     TO TRUE                        20080008
200900         MOVE '5205-WRITE-SEL-QUEUE'                              20090008
201000                                   TO DP013-PARAGRAPH             20100008
201100         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          20110008
201200                                   TO DP013-MESSAGE-TEXT(1)       20120008
201300         PERFORM DP013-0000-PROCESS-ABEND                         20130008
201400     END-IF.                                                      20140008
201500 EJECT                                                            20150008
201600******************************************************************20160008
201700** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **20170008
201800** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **20180008
201900** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **20190008
202000** THE USER.                                                      20200008
202100******************************************************************20210008
202200 6000-REFRESH-PANEL-FROM-TEMP.                                    20220008
202300     IF  ASC-UPDATE-TSQ                                           20230008
202400         SET ASC-NO-TSQ-UPDATE TO TRUE                            20240008
202500         MOVE ZERO                 TO PV-SAVE-ITEM                20250008
202600                                      PV-SEL-QUEUE-ITEM           20260008
202700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        20270008
202800                                   TO PV-HOLD-SELECTED-ITEMS      20280008
202900         MOVE +1                   TO PV-ITEMS-PROCESSED          20290008
203000         PERFORM 6100-UPDATE-TSQ                                  20300008
203100             UNTIL PV-ITEMS-PROCESSED >                           20310008
203200                                     PV-HOLD-SELECTED-ITEMS       20320008
203300         PERFORM 6010-DELETE-SEL-QUEUE                            20330008
203400         INITIALIZE ASC-BLOCK-ENTRIES (1)                         20340008
203500                    ASC-BLOCK-ENTRIES (2)                         20350008
203600     END-IF.                                                      20360008
203700                                                                  20370008
203800*----------------------------------------------------------------*20380008
203900*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.                20390008
204000*----------------------------------------------------------------*20400008
204100 6010-DELETE-SEL-QUEUE.                                           20410008
204200                                                                  20420008
204300     EXEC CICS                                                    20430008
204400         DELETEQ TS                                               20440008
204500             QUEUE (ASC-SEL-QUEUE-NAME)                           20450008
204600             RESP  (PV-CICS-RESP)                                 20460008
204700     END-EXEC.                                                    20470008
204800*                                                                 20480008
204900     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      20490008
205000        (PV-CICS-RESP = DFHRESP(QIDERR)))                         20500008
205100         CONTINUE                                                 20510008
205200     ELSE                                                         20520008
205300         SET DP013-CICS-ABEND TO TRUE                             20530008
205400         SET DP013-NO-ROLLBACK TO TRUE                            20540008
205500         MOVE '6010-DELETE-SEL-QUEUE'                             20550008
205600                        TO DP013-PARAGRAPH                        20560008
205700         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         20570008
205800                        TO DP013-MESSAGE-TEXT (1)                 20580008
205900         PERFORM DP013-0000-PROCESS-ABEND                         20590008
206000     END-IF.                                                      20600008
206100                                                                  20610008
206200*----------------------------------------------------------------*20620008
206300*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.       20630008
206400*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *20640008
206500*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *20650008
206600*    THE TEMP QUEUE.                                              20660008
206700*----------------------------------------------------------------*20670008
206800                                                                  20680008
206900 6100-UPDATE-TSQ.                                                 20690008
207000                                                                  20700008
207100     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             20710008
207200     PERFORM 6105-READ-SEL-QUEUE.                                 20720008
207300     PERFORM                                                      20730008
207400         VARYING DP057-IDX                                        20740008
207500         FROM 1 BY 1                                              20750008
207600         UNTIL ((PV-ITEMS-PROCESSED >                             20760008
207700                              PV-HOLD-SELECTED-ITEMS)             20770008
207800         OR (DP057-IDX GREATER THAN DP057-MAX-ITEMS))             20780008
207900         IF  DP057-ACTION-SW (DP057-IDX) > SPACE                  20790008
208000             PERFORM 6110-PROCESS-ITEMS                           20800008
208100         END-IF                                                   20810008
208200         ADD +1                TO PV-ITEMS-PROCESSED              20820008
208300     END-PERFORM.                                                 20830008
208400     PERFORM 6111-WRITE-LIST-QUEUE.                               20840008
208500*----------------------------------------------------------------*20850008
208600*    READ THE LIST QUEUE RECORD.                                  20860008
208700*----------------------------------------------------------------*20870008
208800                                                                  20880008
208900 6105-READ-SEL-QUEUE.                                             20890008
209000                                                                  20900008
209100     EXEC CICS                                                    20910008
209200          READQ TS                                                20920008
209300              QUEUE (ASC-SEL-QUEUE-NAME)                          20930008
209400              INTO  (DP057-MESSAGE-SEL-REC)                       20940008
209500              ITEM  (PV-SEL-QUEUE-ITEM)                           20950008
209600              RESP  (PV-CICS-RESP)                                20960008
209700     END-EXEC.                                                    20970008
209800*                                                                 20980008
209900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20990008
210000         CONTINUE                                                 21000008
210100     ELSE                                                         21010008
210200         SET DP013-CICS-ABEND      TO  TRUE                       21020008
210300         SET DP013-NO-ROLLBACK     TO  TRUE                       21030008
210400         MOVE '6105-READ-SEL-QUEUE'                               21040008
210500                                   TO  DP013-PARAGRAPH            21050008
210600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           21060008
210700                                   TO  DP013-MESSAGE-TEXT(1)      21070008
210800         PERFORM DP013-0000-PROCESS-ABEND                         21080008
210900     END-IF.                                                      21090008
211000 EJECT                                                            21100008
211100*----------------------------------------------------------------*21110008
211200*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*21120008
211300*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*21130008
211400*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.            21140008
211500*----------------------------------------------------------------*21150008
211600                                                                  21160008
211700 6110-PROCESS-ITEMS.                                              21170008
211800                                                                  21180008
211900     COMPUTE PV-ITEM = 1 + ((DP057-ITEM (DP057-IDX) - 1)          21190008
212000                     / PC-ITEMS-PER-PANEL).                       21200008
212100                                                                  21210008
212200     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           21220008
212300         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          21230008
212400             PERFORM 6111-WRITE-LIST-QUEUE                        21240008
212500         END-IF                                                   21250008
212600         MOVE PV-ITEM          TO PV-SAVE-ITEM                    21260008
212700                                                                  21270008
212800         PERFORM 6112-READ-LIST-QUEUE                             21280008
212900         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               21290008
213000             CONTINUE                                             21300008
213100         END-IF                                                   21310008
213200     END-IF.                                                      21320008
213300                                                                  21330008
213400     COMPUTE PV-SUB = (DP057-ITEM (DP057-IDX)                     21340008
213500                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              21350008
213600     SET LQW-DESELECT (PV-SUB) TO    TRUE                         21360008
213700     MOVE LQW-SELECTED-SW (PV-SUB)                                21370008
213800                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  21380008
213900*    EVALUATE TRUE                                                21390008
214000*        WHEN DP057-INQ (DP057-IDX)                               21400008
214100*             MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             21410008
214200*                                                                 21420008
214300*        WHEN DP057-UPD (DP057-IDX)                               21430008
214400*             MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             21440008
214500*                                                                 21450008
214600*        WHEN DP057-DEL (DP057-IDX)                               21460008
214700*             MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             21470008
214800*                                                                 21480008
214900*        WHEN DP057-ERR (DP057-IDX)                               21490008
215000*             MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             21500008
215100*    END-EVALUATE.                                                21510008
215200                                                                  21520008
215300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                21530008
215400                                                                  21540008
215500*----------------------------------------------------------------*21550008
215600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.              21560008
215700*----------------------------------------------------------------*21570008
215800                                                                  21580008
215900 6111-WRITE-LIST-QUEUE.                                           21590008
216000                                                                  21600008
216100     EXEC CICS                                                    21610008
216200         WRITEQ TS                                                21620008
216300             QUEUE (ASC-LIST-QUEUE-NAME)                          21630008
216400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     21640008
216500             ITEM  (PV-SAVE-ITEM)                                 21650008
216600             REWRITE                                              21660008
216700             RESP  (PV-CICS-RESP)                                 21670008
216800     END-EXEC.                                                    21680008
216900*                                                                 21690008
217000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21700008
217100         CONTINUE                                                 21710008
217200     ELSE                                                         21720008
217300         SET DP013-CICS-ABEND  TO  TRUE                           21730008
217400         SET DP013-NO-ROLLBACK TO  TRUE                           21740008
217500         MOVE '6111-WRITE-LIST-QUEUE'                             21750008
217600                               TO  DP013-PARAGRAPH                21760008
217700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  21770008
217800                               TO  DP013-MESSAGE-TEXT(1)          21780008
217900         PERFORM DP013-0000-PROCESS-ABEND                         21790008
218000     END-IF.                                                      21800008
218100                                                                  21810008
218200 EJECT                                                            21820008
218300*----------------------------------------------------------------*21830008
218400*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA. 21840008
218500*----------------------------------------------------------------*21850008
218600                                                                  21860008
218700 6112-READ-LIST-QUEUE.                                            21870008
218800                                                                  21880008
218900     EXEC CICS                                                    21890008
219000         READQ TS                                                 21900008
219100             QUEUE (ASC-LIST-QUEUE-NAME)                          21910008
219200             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     21920008
219300             ITEM  (PV-ITEM)                                      21930008
219400             RESP  (PV-CICS-RESP)                                 21940008
219500     END-EXEC.                                                    21950008
219600*                                                                 21960008
219700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21970008
219800         CONTINUE                                                 21980008
219900     ELSE                                                         21990008
220000         SET DP013-CICS-ABEND        TO TRUE                      22000008
220100         SET DP013-NO-ROLLBACK       TO TRUE                      22010008
220200         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           22020008
220300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    22030008
220400                                     TO DP013-MESSAGE-TEXT(1)     22040008
220500         PERFORM DP013-0000-PROCESS-ABEND                         22050008
220600     END-IF.                                                      22060008
220700                                                                  22070008
220800 EJECT                                                            22080008
220900*----------------------------------------------------------------*22090001
221000*    ABEND PROCESSOR MODULE                                       22100001
221100*----------------------------------------------------------------*22110001
221200                                                                  22120001
221300     COPY DPPD013.                                                22130001
