000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     DBKDM012.                                        00020003
000300 AUTHOR.         CRAIG MARTIN.                                    00030001
000400 INSTALLATION.   KOHLS.                                           00040000
000500 DATE-WRITTEN.   OCTOBER 1998.                                    00050001
000600*********************************************************         00060000
000700* THIS PROGRAM INPUTS A VIEW NAME, GOES TO SYSVIEWS,              00070000
000800* AND DISPLAYS THE SQL FOR THE VIEW.                              00080000
000900*             TSO OPTION E.K.R.9                                  00090022
001000*********************************************************         00100002
001010***********************************************************       00110015
001020* 03/08  LARRY SCHLEICHER                                         00120020
001030*     ADDED SUPPORT FOR DB2 VERSION 8.  ALLOW THE LENGTH          00130015
001040*     OF TABLE NAMES TO INCREASE FROM 18 CHARACTERS TO 128.       00140020
001050***********************************************************       00150015
001020* 05/08  LARRY SCHLEICHER                                         00160024
001030*     CHANGED THE SETTING OF THE CURSOR FROM THE CMNEKTAB         00170024
001040*     FIELD TO THE CMNEKCRE FIELD.                                00180024
001050***********************************************************       00190025
001020* 03/14  BETSY JEFFERY                                            00200025
001030*     INCREASED THE SIZE OF THE TEMPORARY FILE NAME TO            00210025
001040*     MULTI-LOGON ISPF REQUIREMENTS.                              00220025
001050***********************************************************       00230024
001050***********************************************************       00231028
001020* 08/22  BRAD DORN                                                00232028
001030*     CHANGED LOGIC TO REFERENCE COLUMN STATEMENT INSTEAD         00233028
001040*     OF TEXT ON SYSVIEWS.  TEXT IS NOT USED AND THE PANEL        00234028
001040*     IS COMING BACK BLANK.                                       00234128
001050***********************************************************       00235028
001100 ENVIRONMENT DIVISION.                                            00240002
001200 CONFIGURATION SECTION.                                           00250002
001300 SOURCE-COMPUTER.        IBM.                                     00260002
001400 OBJECT-COMPUTER.        IBM.                                     00270002
001500 INPUT-OUTPUT SECTION.                                            00280002
001600                                                                  00290002
001700 FILE-CONTROL.                                                    00300002
001800                                                                  00310002
001900     SELECT BROWSE-FILE ASSIGN TO VIEWDATA.                       00320007
002000                                                                  00330000
002100 DATA DIVISION.                                                   00340000
002200 FILE SECTION.                                                    00350000
002300 FD  BROWSE-FILE                                                  00360000
002400     RECORDING MODE IS F                                          00370000
002500     LABEL RECORDS ARE STANDARD                                   00380000
002600     RECORD CONTAINS 080 CHARACTERS                               00390000
002700     BLOCK CONTAINS 0 RECORDS                                     00400000
002800     DATA RECORD IS BROWSE-RECORD.                                00410000
002900 01  BROWSE-RECORD           PIC X(080).                          00420000
003000                                                                  00430000
003100*                                                                 00440000
003200     EJECT                                                        00450000
003300 WORKING-STORAGE SECTION.                                         00460000
003400*                                                                 00470000
003500 01  REPORT-TITLE1.                                               00480000
003600     05  FILLER            PIC X(34)   VALUE SPACES.              00490007
003700     05  FILLER            PIC X(12)   VALUE 'DB2 VIEW SQL'.      00500007
003800     05  FILLER            PIC X(34)   VALUE SPACES.              00510007
003900                                                                  00520000
004000 01  REPORT-TITLE2.                                               00530000
004100     05  FILLER            PIC X(01)   VALUE SPACES.              00540000
004200     05  FILLER            PIC X(12)   VALUE 'VIEW NAME = '.      00550000
004300     05  TITLE-VIEW-NAME1  PIC X(67)   VALUE SPACES.              00560018
004500                                                                  00570000
004510 01  REPORT-TITLE3.                                               00580018
004520     05  FILLER            PIC X(01)   VALUE SPACES.              00590018
004540     05  TITLE-VIEW-NAME2  PIC X(79)   VALUE SPACES.              00600018
004550                                                                  00610018
004600 01  REPORT-LINE-1.                                               00620000
004700     05  FILLER            PIC X(04)   VALUE SPACES.              00630000
004800     05  RPT-VIEW-SQL      PIC X(72)   VALUE SPACES.              00640000
004900     05  FILLER            PIC X(04)   VALUE SPACES.              00650000
005000                                                                  00660000
005100 01  NO-MATCH-INFO.                                               00670000
005200     05  FILLER            PIC X(02)   VALUE  SPACES.             00680000
005300     05  FILLER            PIC X(78)                              00690000
005400         VALUE  'VIEW DOES NOT EXIST'.                            00700000
005500                                                                  00710000
005600 01  END-OF-REPORT.                                               00720000
005700     05  FILLER            PIC X(02)   VALUE  SPACES.             00730000
005800     05  FILLER            PIC X(78)                              00740000
005900         VALUE  '         *** END OF LISTING ***'.                00750000
006000                                                                  00760000
006100 01  ISP-FUNCTIONS.                                               00770000
006200     05  ISP-DISPLAY     PIC X(8) VALUE 'DISPLAY'.                00780000
006300     05  ISP-ADDPOP      PIC X(8) VALUE 'ADDPOP  '.               00790000
006400     05  ISP-REMPOP      PIC X(8) VALUE 'REMPOP  '.               00800000
006500     05  ISP-VDEFINE     PIC X(8) VALUE 'VDEFINE'.                00810000
006600     05  ISP-VDELETE     PIC X(8) VALUE 'VDELETE'.                00820000
006700     05  ISP-VGET        PIC X(8) VALUE 'VGET'.                   00830000
006800     05  ISP-VPUT        PIC X(8) VALUE 'VPUT'.                   00840000
006900     05  ISP-VRESET      PIC X(8) VALUE 'VRESET'.                 00850000
007000     05  ISP-VCOPY       PIC X(8) VALUE 'VCOPY'.                  00860000
007100     05  ISP-VREPLACE    PIC X(8) VALUE 'VREPLACE'.               00870000
007200     05  ISP-TBOPEN      PIC X(8) VALUE 'TBOPEN'.                 00880000
007300     05  ISP-TBCREATE    PIC X(8) VALUE 'TBCREATE'.               00890000
007400     05  ISP-TBCLOSE     PIC X(8) VALUE 'TBCLOSE'.                00900000
007500     05  ISP-TBEND       PIC X(8) VALUE 'TBEND  '.                00910000
007600     05  ISP-TBDISPL     PIC X(8) VALUE 'TBDISPL'.                00920000
007700     05  ISP-TBSORT      PIC X(8) VALUE 'TBSORT'.                 00930000
007800     05  ISP-TBTOP       PIC X(8) VALUE 'TBTOP'.                  00940000
007900     05  ISP-TBBOTTOM    PIC X(8) VALUE 'TBBOTTOM'.               00950000
008000     05  ISP-TBSKIP      PIC X(8) VALUE 'TBSKIP'.                 00960000
008100     05  ISP-TBADD       PIC X(8) VALUE 'TBADD '.                 00970000
008200     05  ISP-TBPUT       PIC X(8) VALUE 'TBPUT '.                 00980000
008300     05  ISP-TBMOD       PIC X(8) VALUE 'TBMOD '.                 00990000
008400     05  ISP-TBDELETE    PIC X(8) VALUE 'TBDELETE'.               01000000
008500     05  ISP-TBEXIST     PIC X(8) VALUE 'TBEXIST '.               01010000
008600     05  ISP-TBSCAN      PIC X(8) VALUE 'TBSCAN'.                 01020000
008700     05  ISP-TBPAD       PIC 9(8) COMP VALUE 0.                   01030000
008800     05  ISP-NEWCOPY     PIC X(8) VALUE 'NEWCOPY'.                01040000
008900     05  ISP-FTOPEN      PIC X(8) VALUE 'FTOPEN'.                 01050000
009000     05  ISP-FTINCL      PIC X(8) VALUE 'FTINCL'.                 01060000
009100     05  ISP-FTCLOSE     PIC X(8) VALUE 'FTCLOSE'.                01070000
009200     05  ISP-SELECT      PIC X(8) VALUE 'SELECT'.                 01080000
009300     05  ISP-BROWSE      PIC X(8) VALUE 'BROWSE'.                 01090000
009400     05  ISP-SETMSG      PIC X(8) VALUE 'SETMSG'.                 01100000
009500     05  ISP-CONTROL     PIC X(8) VALUE 'CONTROL'.                01110000
009600     05  ISP-NONDISPL    PIC X(8) VALUE 'NONDISPL'.               01120000
009700     05  ISP-SPLIT       PIC X(8) VALUE 'SPLIT'.                  01130000
009800     05  ISP-DISABLE     PIC X(8) VALUE 'DISABLE'.                01140000
009900     05  ISP-ENABLE      PIC X(8) VALUE 'ENABLE'.                 01150000
010000     05  ISP-NO          PIC X(8) VALUE 'NO'.                     01160000
010100     05  ISP-YES         PIC X(8) VALUE 'YES'.                    01170000
010200*                                                                 01180000
010300 01  ISP-MISC-DEFS.                                               01190000
010400     05  ISP-FORMAT      PIC X(8) VALUE 'CHAR'.                   01200000
010500     05  ISP-MOVE        PIC X(8) VALUE 'MOVE'.                   01210000
010600     05  ISP-WRITE       PIC X(8) VALUE 'WRITE'.                  01220000
010700     05  ISP-NOWRITE     PIC X(8) VALUE 'NOWRITE'.                01230000
010800     05  ISP-REPLACE     PIC X(8) VALUE 'REPLACE'.                01240000
010900     05  ISP-ORDERED     PIC X(8) VALUE 'ORDERED'.                01250000
011000     05  ISP-SHARED      PIC X(8) VALUE 'SHARED'.                 01260000
011100     05  ISP-PROFILE     PIC X(8) VALUE 'PROFILE'.                01270000
011200     05  ISP-ASIS        PIC X(8) VALUE 'ASIS'.                   01280000
011300     05  ISP-NOREAD      PIC X(8) VALUE 'NOREAD'.                 01290000
011400     05  ISP-NEXT        PIC X(8) VALUE 'NEXT'.                   01300000
011500     05  ISP-TEMP        PIC X(8) VALUE 'TEMP'.                   01310000
011600     05  ISP-PANEL       PIC X(8) VALUE  SPACES.                  01320000
011700     05  ISP-DUMMY       PIC X(8) VALUE  SPACES.                  01330000
011800     05  ISP-MSG         PIC X(8) VALUE  'CMN000  '.              01340000
011900     05  ISP-CSR         PIC X(8) VALUE  SPACES.                  01350000
012000     05  ISP-FIELD       PIC X(8) VALUE  SPACES.                  01360000
012100     05  ISP-SKEL        PIC X(8) VALUE  SPACES.                  01370000
012200     05  ISP-ERRORS      PIC X(8) VALUE 'ERRORS'.                 01380000
012300     05  ISP-RETURN      PIC X(8) VALUE 'RETURN'.                 01390000
012400     05  ISP-CANCEL      PIC X(8) VALUE 'CANCEL'.                 01400000
012500     05  ISP-SAVE        PIC X(8) VALUE 'SAVE'.                   01410000
012600     05  ISP-RESTORE     PIC X(8) VALUE 'RESTORE'.                01420000
012700     05  TBL-LIST-GT     PIC X(4) VALUE '(GT)'.                   01430000
012800*                                                                 01440000
012900***  DEFINE DATA TYPE PARAMETER FOR VARIABLE DEFINE SERVICE CALL. 01450000
013000*                                                                 01460000
013100 01  CHAR                PIC X(08)     VALUE 'CHAR    '.          01470000
013200                                                                  01480007
013300*                                                                 01490007
013400*  PARAMETER LIST FOR THE DYNAMIC ALLOCATION ROUTINE              01500007
013500*                                                                 01510007
013600     COPY DPWS023.                                                01520007
013700                                                                  01530007
013800*                                                                 01540007
013900*  PARAMETER LIST FOR THE ISPF PRINT PANEL ROUTINE                01550007
014000*                                                                 01560007
014100     COPY DPWS300.                                                01570007
014200                                                                  01580007
014300 01  VAR-SMSG                    PIC X(24)   VALUE SPACES.        01590011
014400 01  FILLER                      REDEFINES VAR-SMSG.              01600011
014500     05  VAR-SMSG-FILLER         PIC X(20).                       01610011
014600     05  VAR-SMSG-SQLCODE        PIC 9(4).                        01620011
014700 01  VAR-LMSG                    PIC X(72)   VALUE SPACES.        01630011
014800 01  PV-PROGRAM-VARIABLES.                                        01640007
014900     05  VAR-ZTEMPF              PIC X(44)   VALUE SPACES.        01650007
015000     05  VAR-DSNAME              PIC X(46)   VALUE SPACES.        01660007
015100     05  VAR-VOLUME              PIC X(06)   VALUE SPACES.        01670007
015200     05  VAR-PASSWORD            PIC X(08)   VALUE SPACES.        01680007
015300     05  PV-DYNALC-ROUTINE-ERROR-MSG.                             01690007
015400         10  FILLER              PIC X(13)    VALUE               01700007
015500             'DYNALC ERROR '.                                     01710007
015600         10  PV-DR-RETURN-CODE   PIC 9999     VALUE ZEROS.        01720007
015700         10  FILLER              PIC X(2)     VALUE '; '.         01730007
015800         10  PV-DR-DDNAME        PIC X(8)     VALUE SPACES.       01740007
015900         10  FILLER              PIC X(5)     VALUE ' DD; '.      01750007
016000         10  PV-DR-ERROR-DESC    PIC X(41)    VALUE SPACES.       01760007
016100     05  PV-BROWSE-DSNAME        PIC X(44)   VALUE SPACES.        01770010
016200     05  PV-COUNTR               PIC S9(4)   COMP.                01780007
016300     05  PV-FIELD-LENGTH         PIC 9(8)     VALUE ZEROS         01790011
016400                                              COMP SYNC.          01800011
016300     05  PV-LENGTH-STATEMENT     PIC S9(9)    VALUE ZEROS         01801030
016400                                              COMP SYNC.          01802027
016600                                                                  01820007
016700 01  WS-SYSVIEWS-STATEMENT  PIC X(12000) VALUE SPACES.            01830033
       01  FILLER    REDEFINES WS-SYSVIEWS-STATEMENT.                   01831031
016800     05  WS-SYSVIEWS-STATEMENT-TBL    OCCURS 12000 TIMES          01840033
016900                                      INDEXED BY SV-INDEX         01850000
017000                                      PIC X(01).                  01860000
017100                                                                  01870000
017200 01  WS-VIEW-LINE.                                                01880000
017300     05  WS-VIEW-TBL                  OCCURS 72 TIMES             01890000
017400                                      INDEXED BY VL-INDEX         01900000
017500                                      PIC X(01).                  01910000
017501                                                                  01920019
017510 01  WS-VIEW-NAME      PIC X(150)  VALUE SPACES.                  01930019
017600*                                                                 01940000
017700***  DEFINE STORAGE FOR DIALOG VARIABLES.                         01950000
017800*                                                                 01960000
017900 01  VAR-CMNEKTAB        PIC X(43)     VALUE SPACES.              01970013
018000 01  VAR-CMNEKTB2        PIC X(43)     VALUE SPACES.              01980013
018100 01  VAR-CMNEKTB3        PIC X(42)     VALUE SPACES.              01990013
018200 01  VAR-128-TABLE-NAME  PIC X(128)    VALUE SPACES.              02000013
018300 01  VAR-CMNEKCRE        PIC X(08)     VALUE SPACES.              02010000
018400 01  FREE-SPACE          PIC X(80)     VALUE SPACES.              02020000
018500 01  ABEND-CODE                    PIC S9(4) VALUE ZERO           02030000
018600                                             COMP.                02040000
018700     88  ABEND-4013                          VALUE 4013.          02050000
018800                                                                  02060000
018900 01  PS-PRINT-SWITCH               PIC X(1)  VALUE 'N'.           02070000
019000     88  PS-EOF-PRINT                        VALUE 'Y'.           02080000
019100     88  PS-NOT-EOF-PRINT                    VALUE 'N'.           02090000
019200 01  PS-TABLE-VALIDITY             PIC X(1)  VALUE 'N'.           02100000
019300     88  PS-TABLE-IS-VALID                   VALUE 'Y'.           02110000
019400     88  PS-TABLE-IS-NOT-VALID               VALUE 'N'.           02120000
019500 01  PS-ALLOCATE-SW                PIC X(1)  VALUE 'N'.           02130000
019600     88  PS-IS-ALLOCATED                     VALUE 'Y'.           02140000
019700     88  PS-IS-NOT-ALLOCATED                 VALUE 'N'.           02150000
019800 01  PS-DB2-ERROR-INDICATOR        PIC X(1)  VALUE 'N'.           02160000
019900     88  PS-DB2-ERROR                        VALUE 'Y'.           02170000
020000     88  PS-NO-DB2-ERROR                     VALUE 'N'.           02180000
020100 01  PS-USER-INPUT                 PIC X(1)  VALUE 'N'.           02190000
020200     88  PS-USER-INPUT-VALID                 VALUE 'Y'.           02200000
020300     88  PS-USER-INPUT-NOT-VALID             VALUE 'N'.           02210000
020400 01  PS-KEY-COLUMN-SELECT          PIC X(1)  VALUE 'N'.           02220000
020500     88  PS-KEY-COLUMN-SELECTED              VALUE 'Y'.           02230000
020600     88  PS-KEY-COLUMN-NOT-SELECTED          VALUE 'N'.           02240000
020700                                                                  02250000
020800**                                                                02260000
020900 01  PROGRAM-CONSTANTS.                                           02270000
021000     05  PC-CURRENT-PROGRAM-NAME   PIC X(08)  VALUE 'DBKDM012'.   02280006
021100     05  PC-BROWSE-DDNAME          PIC X(08)  VALUE 'VIEWDATA'.   02290010
021200     05  PC-BROWSE-DSNAME-SUFFIX   PIC X(05)  VALUE '.VIEW'.      02300010
021300     05  PC-MAX-RETRIES            PIC S9(3)  VALUE +3            02310000
021400                                              COMP-3.             02320000
021500     05  PC-COMMIT-MAX             PIC S9(3)  VALUE +49           02330000
021600                                              COMP-3.             02340000
021700*                                                                 02350000
021800 01  COMMON-NAMELIST.                                             02360000
021900     05  NAM-ZTEMPF      PIC X(08)     VALUE 'ZTEMPF'.            02370000
022000     05  NAM-SMSG        PIC X(08)     VALUE 'SMSG'.              02380000
022100     05  NAM-LMSG        PIC X(08)     VALUE 'LMSG'.              02390000
022200*                                                                 02400000
022300***  DEFINE DIALOG VARIABLE NAMES FOR DIALOG SERVICE CALLS.       02410000
022400*                                                                 02420000
022500 01  NAM-CMNEKTAB        PIC X(08)     VALUE 'CMNEKTAB'.          02430000
022600 01  NAM-CMNEKTB2        PIC X(08)     VALUE 'CMNEKTB2'.          02440013
022700 01  NAM-CMNEKTB3        PIC X(08)     VALUE 'CMNEKTB3'.          02450013
022800 01  NAM-CMNEKCRE        PIC X(08)     VALUE 'CMNEKCRE'.          02460000
022900*                                                                 02470000
023000***                                                               02480000
023100************************************************************      02490000
023200**   DCLGEN FOR TABLE SYSVIEWS    (INDEXED)                       02500000
023300************************************************************      02510000
023400                                                                  02520000
023500     EXEC SQL                                                     02530000
023600         INCLUDE SYSVIEWS                                         02540000
023700     END-EXEC.                                                    02550000
023800*                                                                 02560000
025400************************************************************      02570000
025500*    SQL COMMUNICATIONS AREA DCLGEN                        *      02580000
025600************************************************************      02590000
025700*                                                                 02600000
025800     EXEC SQL                                                     02610000
025900         INCLUDE SQLCA                                            02620000
026000     END-EXEC.                                                    02630000
026100*                                                                 02640000
026200*                                                                 02650000
026300 PROCEDURE DIVISION.                                              02660000
026400                                                                  02670000
026500************************************************************      02680000
026600*    VDEFINES FOR PANEL                                    *      02690000
026700************************************************************      02700000
026800     MOVE LENGTH OF VAR-ZTEMPF TO PV-FIELD-LENGTH.                02710012
026900     CALL 'ISPLINK' USING ISP-VDEFINE NAM-ZTEMPF VAR-ZTEMPF       02720012
027000                          ISP-FORMAT PV-FIELD-LENGTH.             02730012
027100     MOVE LENGTH OF VAR-SMSG TO PV-FIELD-LENGTH.                  02740012
027200     CALL 'ISPLINK' USING ISP-VDEFINE NAM-SMSG VAR-SMSG           02750012
027300                          ISP-FORMAT PV-FIELD-LENGTH.             02760012
027400     MOVE LENGTH OF VAR-LMSG TO PV-FIELD-LENGTH.                  02770012
027500     CALL 'ISPLINK' USING ISP-VDEFINE NAM-LMSG VAR-LMSG           02780012
027600                          ISP-FORMAT PV-FIELD-LENGTH.             02790012
027700     MOVE LENGTH OF VAR-CMNEKTAB TO PV-FIELD-LENGTH.              02800012
027800     CALL 'ISPLINK' USING ISP-VDEFINE                             02810012
027900         NAM-CMNEKTAB  VAR-CMNEKTAB  CHAR  PV-FIELD-LENGTH.       02820012
028000     MOVE LENGTH OF VAR-CMNEKTB2 TO PV-FIELD-LENGTH.              02830013
028100     CALL 'ISPLINK' USING ISP-VDEFINE                             02840013
028200         NAM-CMNEKTB2  VAR-CMNEKTB2  CHAR  PV-FIELD-LENGTH.       02850013
028300     MOVE LENGTH OF VAR-CMNEKTB3 TO PV-FIELD-LENGTH.              02860013
028400     CALL 'ISPLINK' USING ISP-VDEFINE                             02870013
028500         NAM-CMNEKTB3  VAR-CMNEKTB3  CHAR  PV-FIELD-LENGTH.       02880013
028600     MOVE LENGTH OF VAR-CMNEKCRE TO PV-FIELD-LENGTH.              02890012
028700     CALL 'ISPLINK' USING ISP-VDEFINE                             02900012
028800         NAM-CMNEKCRE  VAR-CMNEKCRE  CHAR  PV-FIELD-LENGTH.       02910012
028900                                                                  02920000
029000************************************************************      02930000
029100*    VGETS FROM PROFILES                                   *      02940000
029200************************************************************      02950000
029300                                                                  02960000
029400     CALL 'ISPLINK' USING ISP-VGET NAM-ZTEMPF ISP-SHARED.         02970000
029500     MOVE SPACES TO ISP-MSG.                                      02980000
029600                                                                  02990007
029700     INSPECT VAR-ZTEMPF TALLYING PV-COUNTR FOR CHARACTERS         03000007
029800                 BEFORE INITIAL '.CNTL'.                          03010007
029900     MOVE VAR-ZTEMPF (1:PV-COUNTR)  TO PV-BROWSE-DSNAME.          03020010
030000     ADD 1 TO PV-COUNTR.                                          03030007
030100     MOVE PC-BROWSE-DSNAME-SUFFIX TO                              03040009
030200               PV-BROWSE-DSNAME (PV-COUNTR:5).                    03050010
030300                                                                  03060000
030400     PERFORM 1700-DISPLAY-PANEL THRU 1700-EXIT UNTIL              03070000
030500          RETURN-CODE NOT = 0.                                    03080000
030600                                                                  03090000
030700     IF PS-IS-ALLOCATED                                           03100007
030800         PERFORM 9100-DELETE-FILE                                 03110007
030900     END-IF.                                                      03120007
031000                                                                  03130000
031100     GOBACK.                                                      03140000
031200                                                                  03150000
031300************************************************************      03160000
031400*    DISPLAY THE PANEL                                     *      03170000
031500************************************************************      03180000
031600*                                                                 03190000
031700 1700-DISPLAY-PANEL.                                              03200000
031800                                                                  03210000
031900     MOVE 'CMNEKCRE' TO ISP-CSR.                                  03220023
032000     MOVE 'CMNEKRC'  TO ISP-PANEL.                                03230000
032100     CALL 'ISPLINK' USING ISP-DISPLAY,                            03240000
032200                          ISP-PANEL,                              03250000
032300                          ISP-MSG,                                03260000
032400                          ISP-CSR.                                03270000
032500                                                                  03280000
032600     MOVE SPACES TO ISP-MSG.                                      03290000
032700     MOVE SPACES TO VAR-SMSG.                                     03300000
032800     MOVE SPACES TO VAR-LMSG.                                     03310000
032900                                                                  03320000
033000     IF RETURN-CODE NOT = 0                                       03330000
033100         GO TO 1700-EXIT.                                         03340000
033200                                                                  03350000
033300     PERFORM 2100-EDIT-INPUT THRU 2100-EXIT.                      03360000
033400     IF PS-USER-INPUT-NOT-VALID                                   03370000
033500         GO TO 1700-EXIT.                                         03380000
033600                                                                  03390000
033700     IF PS-IS-NOT-ALLOCATED                                       03400007
033800         PERFORM 3000-ALLOCATE-TEMP-FILE                          03410007
033900     END-IF.                                                      03420007
034000                                                                  03430000
034100     IF PS-IS-ALLOCATED                                           03440000
034200         OPEN OUTPUT BROWSE-FILE                                  03450000
034300         WRITE BROWSE-RECORD FROM REPORT-TITLE1                   03460000
034400         MOVE SPACES TO BROWSE-RECORD                             03470000
034500         WRITE BROWSE-RECORD                                      03480000
034600         MOVE SPACES TO TITLE-VIEW-NAME1                          03490018
034610         MOVE SPACES TO TITLE-VIEW-NAME2                          03500018
034610         MOVE SPACES TO WS-VIEW-NAME                              03501035
034700         STRING VAR-CMNEKCRE DELIMITED BY SPACE                   03510000
034800                '.'          DELIMITED BY SIZE                    03520000
034900                VAR-128-TABLE-NAME DELIMITED BY SPACE             03530013
035000             INTO WS-VIEW-NAME                                    03540018
035010         MOVE WS-VIEW-NAME (1:67)   TO  TITLE-VIEW-NAME1          03550018
035020         MOVE WS-VIEW-NAME (68:79)  TO  TITLE-VIEW-NAME2          03560018
035100         WRITE BROWSE-RECORD FROM REPORT-TITLE2                   03570000
035101         MOVE SPACES TO BROWSE-RECORD                             03580018
035110         IF TITLE-VIEW-NAME2 NOT = SPACES                         03590018
035120             WRITE BROWSE-RECORD FROM REPORT-TITLE3               03600018
035121             MOVE SPACES TO BROWSE-RECORD                         03610018
035130         END-IF                                                   03620018
035300         WRITE BROWSE-RECORD                                      03630000
035400         MOVE SPACES TO BROWSE-RECORD                             03640000
035500         WRITE BROWSE-RECORD                                      03650000
035600         PERFORM 4000-DB2-TABLE-FUNCTIONS                         03660000
035700             THRU 4000-EXIT                                       03670000
035800         MOVE SPACES TO BROWSE-RECORD                             03680000
035900         WRITE BROWSE-RECORD                                      03690000
036000         WRITE BROWSE-RECORD FROM END-OF-REPORT                   03700000
036100         CLOSE BROWSE-FILE                                        03710007
036200     END-IF.                                                      03720007
036300                                                                  03730007
036400     IF ((PS-IS-ALLOCATED)                                        03740007
036500             AND (PS-NO-DB2-ERROR))                               03750007
036600         PERFORM 8000-BROWSE-FILE                                 03760007
036700     END-IF.                                                      03770007
036800                                                                  03780000
036900 1700-EXIT.                                                       03790000
037000     EXIT.                                                        03800000
037100     EJECT                                                        03810000
037200************************************************************      03820000
037300* SET SWITCHES TO INDICATE WHAT OPTION HAS BEEN SPECIFIED  *      03830000
037400* BY THE USER                                              *      03840000
037500************************************************************      03850000
037600 2100-EDIT-INPUT.                                                 03860000
037700                                                                  03870000
037800     SET PS-NOT-EOF-PRINT TO TRUE.                                03880000
037900     SET PS-NO-DB2-ERROR TO TRUE.                                 03890000
038000     MOVE 'Y' TO PS-USER-INPUT.                                   03900000
038100                                                                  03910000
038200     IF (VAR-CMNEKTAB = SPACES  AND                               03920013
038300         VAR-CMNEKTB2 = SPACES  AND                               03930013
038400         VAR-CMNEKTB3 = SPACES) OR                                03940013
038500        VAR-CMNEKCRE = SPACES                                     03950013
038600          MOVE 'N' TO PS-USER-INPUT                               03960013
038700          MOVE 'SPECIFY REQUIRED PARM' TO VAR-SMSG                03970013
039010          MOVE 'SUPPLY THE VIEW NAME' TO VAR-LMSG                 03980014
039100          MOVE 'CMN000  ' TO ISP-MSG                              03990013
039200     ELSE                                                         04000013
039300         MOVE 'Y' TO PS-USER-INPUT                                04010014
039400         IF VAR-CMNEKTB2 NOT = SPACES                             04020014
039500             STRING VAR-CMNEKTAB        DELIMITED BY ' ',         04030014
039600                    VAR-CMNEKTB2        DELIMITED BY ' '          04040014
039700                 INTO VAR-128-TABLE-NAME                          04050014
039800             IF VAR-CMNEKTB3 NOT = SPACES                         04060014
039900                 STRING VAR-128-TABLE-NAME  DELIMITED BY ' '      04070014
040000                        VAR-CMNEKTB3        DELIMITED BY ' '      04080014
040100                     INTO VAR-128-TABLE-NAME                      04090014
040200             END-IF                                               04100014
040300         ELSE                                                     04110014
040400             IF VAR-CMNEKTB3 NOT = SPACES                         04120014
040500                 STRING VAR-CMNEKTAB        DELIMITED BY ' ',     04130014
040600                        VAR-CMNEKTB3        DELIMITED BY ' '      04140014
040700                     INTO VAR-128-TABLE-NAME                      04150014
040800             ELSE                                                 04160014
040900                 MOVE VAR-CMNEKTAB   TO VAR-128-TABLE-NAME        04170014
041000             END-IF                                               04180021
041010         END-IF                                                   04190021
041100     END-IF.                                                      04200014
041200                                                                  04210000
041300 2100-EXIT.                                                       04220000
041400     EXIT.                                                        04230000
041500     EJECT                                                        04240000
041600************************************************************      04250000
041700* USE DYNALLOC TO ALLOCATE TEMP FILE THAT WILL BE DISPLAYED*      04260000
041800************************************************************      04270000
041900 3000-ALLOCATE-TEMP-FILE.                                         04280000
042000     PERFORM 9100-DELETE-FILE.                                    04290007
042100                                                                  04300007
042200     IF ((DP023-LASTRC = ZERO)                                    04310007
042300             OR (DP023-LASTRC = DP023-RC-DATASET-DOESNT-EXIST))   04320007
042400         INITIALIZE DP023-DYNALC-PARMS                            04330007
042500         MOVE PC-BROWSE-DDNAME TO DP023-DDNAME                    04340010
042600         MOVE PV-BROWSE-DSNAME TO DP023-DSNAME                    04350010
042700         SET DP023-DISP-NEW TO TRUE                               04360007
042800         SET DP023-FREE-CLOSE-NO TO TRUE                          04370007
042900         SET DP023-RECFM-FIXED-BLOCK TO TRUE                      04380007
043000         MOVE LENGTH OF BROWSE-RECORD TO DP023-RECSZ              04390012
043100         MOVE 2000 TO DP023-RECOUNT                               04400007
043200                                                                  04410007
043300         SET DP023-DISABLE-DISPLAY-ABEND TO TRUE                  04420007
043400                                                                  04430007
043500         PERFORM DP023-0000-DYNALC                                04440007
043600         IF DP023-LASTRC = ZERO                                   04450007
043700             SET PS-IS-ALLOCATED TO TRUE                          04460007
043800         ELSE                                                     04470007
043900             SET PS-IS-NOT-ALLOCATED TO TRUE                      04480007
044000             MOVE DP023-DDNAME TO PV-DR-DDNAME                    04490007
044100             MOVE DP023-RC (DP023-SUB) TO PV-DR-RETURN-CODE       04500007
044200             MOVE DP023-DESC (DP023-SUB) TO PV-DR-ERROR-DESC      04510007
044300             MOVE PV-DYNALC-ROUTINE-ERROR-MSG TO VAR-LMSG         04520007
044400             MOVE 'CMN000  ' TO ISP-MSG                           04530007
044500         END-IF                                                   04540007
044600     ELSE                                                         04550007
044700         SET PS-IS-NOT-ALLOCATED TO TRUE                          04560007
044800         MOVE DP023-DDNAME TO PV-DR-DDNAME                        04570007
044900         MOVE DP023-RC (DP023-SUB) TO PV-DR-RETURN-CODE           04580007
045000         MOVE DP023-DESC (DP023-SUB) TO PV-DR-ERROR-DESC          04590007
045100         MOVE PV-DYNALC-ROUTINE-ERROR-MSG TO VAR-LMSG             04600007
045200         MOVE 'CMN000  ' TO ISP-MSG                               04610007
045300     END-IF.                                                      04620007
045400                                                                  04630007
045500************************************************************      04640000
045600* MAIN-LINE LOGIC                                          *      04650000
045700************************************************************      04660000
045800 4000-DB2-TABLE-FUNCTIONS.                                        04670000
045900                                                                  04680026
48400      SET VL-INDEX TO 1.                                           04700027
48500      MOVE SPACES  TO WS-VIEW-LINE.                                04710027
05070      INITIALIZE DCLSYSVIEWS.                                      04720027
04860                                                                   04730027
02430      EXEC SQL                                                     04740027
             SELECT LENGTH(STATEMENT),                                  04750027
                    CAST(SUBSTR(STATEMENT,1,12000)                      04760033
                      AS VARCHAR(12000))                                04761033
               INTO :PV-LENGTH-STATEMENT,                               04770027
                    :WS-SYSVIEWS-STATEMENT                              04780028
             FROM SYSIBM.SYSVIEWS                                       04790027
               WHERE NAME       = :VAR-128-TABLE-NAME                   04800027
                 AND CREATOR    = :VAR-CMNEKCRE                         04810027
                 AND SEQNO      = 0                                     04820027
                 AND TYPE       = 'V'                                   04830027
025100       WITH UR                                                    04840027
025200     END-EXEC.                                                    04850026
045900                                                                  04860026
051500     IF SQLCODE = ZERO                                            04870027
051700         PERFORM 4010-WRITE-LINE THRU 4010-EXIT                   04890028
051800     ELSE                                                         04900027
051900     IF SQLCODE = +100                                            04910027
               MOVE SPACES TO BROWSE-RECORD                             04930028
               WRITE BROWSE-RECORD                                      04940028
               WRITE BROWSE-RECORD FROM NO-MATCH-INFO                   04950028
052800     ELSE                                                         05000027
052900         SET PS-DB2-ERROR TO TRUE                                 05010027
053000         MOVE 'SQLCODE =' TO VAR-SMSG-FILLER                      05020027
053100         MOVE SQLCODE TO VAR-SMSG-SQLCODE                         05030027
053200         MOVE                                                     05040027
053300         '4300-FETCH-VIEW ABEND, CONTACT DATA RESOURCE'           05050027
053400             TO VAR-LMSG                                          05060027
053500         MOVE 'CMN000  ' TO ISP-MSG                               05070027
053700     END-IF.                                                      05090027
053800                                                                  05100027
047400                                                                  05150000
047500 4000-EXIT.                                                       05160000
047600     EXIT.                                                        05170000
047700     EJECT                                                        05180000
054200************************************************************      05190000
054300*                                                          *      05200000
054400************************************************************      05210000
054500 4010-WRITE-LINE.                                                 05220028
054600                                                                  05230000
055000     PERFORM 4011-PROCESS-ROW THRU 4011-EXIT                      05270028
055100        VARYING SV-INDEX FROM 1 BY 1                              05280000
055200        UNTIL SV-INDEX GREATER THAN PV-LENGTH-STATEMENT.          05290028
055300                                                                  05300000
055400 4010-EXIT.                                                       05310028
055500     EXIT.                                                        05320000
055600     EJECT                                                        05330000
055700************************************************************      05340000
055800* PROCESS THE CURRENT ROW                                  *      05350000
055900************************************************************      05360000
056000 4011-PROCESS-ROW.                                                05370028
056100                                                                  05380000
056200     MOVE WS-SYSVIEWS-STATEMENT-TBL (SV-INDEX) TO                 05390028
056300          WS-VIEW-TBL (VL-INDEX).                                 05400000
056400                                                                  05410000
056500     SET VL-INDEX UP BY 1.                                        05420000
056600                                                                  05430000
056700     IF VL-INDEX GREATER THAN 72                                  05440000
055200       OR SV-INDEX EQUAL TO PV-LENGTH-STATEMENT                   05440134
056800         MOVE WS-VIEW-LINE TO RPT-VIEW-SQL                        05450000
056900         WRITE BROWSE-RECORD FROM REPORT-LINE-1                   05460000
057000         SET VL-INDEX TO 1                                        05470000
057100         MOVE SPACES TO WS-VIEW-LINE                              05480000
057200     END-IF.                                                      05490000
057300                                                                  05500000
057400 4011-EXIT.                                                       05510028
057500     EXIT.                                                        05520000
057600     EJECT                                                        05530000
059700                                                                  05540000
059800                                                                  05550000
059900************************************************************      05560000
060000* DISPLAY BROWSE-FILE                                      *      05570000
060100************************************************************      05580000
060200 8000-BROWSE-FILE.                                                05590000
060300     MOVE ZERO TO PV-COUNTR.                                      05600007
060400     INSPECT PV-BROWSE-DSNAME TALLYING PV-COUNTR FOR              05610010
060500                 CHARACTERS BEFORE INITIAL '.'.                   05620007
060600     ADD 2 TO PV-COUNTR.                                          05630007
060700*BLJ MOVE PV-BROWSE-DSNAME (PV-COUNTR:13) TO VAR-DSNAME.          05640025
060700     MOVE PV-BROWSE-DSNAME (PV-COUNTR:21) TO VAR-DSNAME.          05650025
060800     MOVE 'CMNEKRCD' TO ISP-PANEL.                                05660007
060900     CALL 'ISPLINK' USING ISP-BROWSE,                             05670007
061000                          VAR-DSNAME,                             05680007
061100                          VAR-VOLUME,                             05690007
061200                          VAR-PASSWORD,                           05700007
061300                          ISP-PANEL.                              05710007
061400*                                                                 05720007
061500*  CALL THE COMMON PRINT REQUEST PANEL PROGRAM TO ALLOW THE OPTION05730007
061600*  OF PRINTING THE FILE THAT WAS JUST BROWSED.                    05740007
061700*                                                                 05750007
061800     INITIALIZE DP300-ISPF-PRINT-PARMS.                           05760007
061900     MOVE PC-CURRENT-PROGRAM-NAME TO                              05770007
062000               DP300-CALLING-PROGRAM-NAME.                        05780007
062100     MOVE 1 TO DP300-CALLING-REPORT-NUMBER.                       05790007
062200     MOVE PV-BROWSE-DSNAME TO DP300-FILE-DSNAME.                  05800010
062300     SET DP300-FR-FIXED-BLOCK TO TRUE.                            05810007
062400     MOVE 80 TO DP300-FILE-LRECL.                                 05820007
062500     SET DP300-PT-PRINT-TITLE-LINE                                05830007
062600         DP300-RH-REPEAT-HEADINGS TO TRUE.                        05840007
062700     MOVE 5 TO DP300-HEADING-LINE-COUNT.                          05850008
062800     CALL DP300-ISPF-PRINT-REQ-PROGRAM                            05860007
062900               USING DP300-ISPF-PRINT-PARMS.                      05870007
063000     MOVE 'CMN000  ' TO ISP-MSG                                   05880007
063100     MOVE DP300-ERROR-MESSAGE TO VAR-LMSG.                        05890007
063200     IF DP300-RI-PRINT-REQUESTED                                  05900007
063300         MOVE DP300-ERROR-MESSAGE TO VAR-SMSG                     05910007
063400     END-IF.                                                      05920007
063500                                                                  05930007
063600************************************************************      05940007
063700* DELETE BROWSE FILE                                       *      05950007
063800************************************************************      05960007
063900 9100-DELETE-FILE.                                                05970007
064000     INITIALIZE DP023-DYNALC-PARMS.                               05980007
064100     MOVE PC-BROWSE-DDNAME TO DP023-DDNAME.                       05990010
064200     MOVE PV-BROWSE-DSNAME TO DP023-DSNAME.                       06000010
064300     SET DP023-DISP-DELETE TO TRUE.                               06010007
064400     SET DP023-FREE-CLOSE-NO TO TRUE.                             06020007
064500     SET DP023-RECFM-FIXED-BLOCK TO TRUE.                         06030007
064600     MOVE LENGTH OF BROWSE-RECORD TO DP023-RECSZ.                 06040012
064700     MOVE ZEROES TO DP023-RECOUNT.                                06050012
064800                                                                  06060007
064900     SET DP023-DISABLE-DISPLAY-ABEND TO TRUE.                     06070007
065000                                                                  06080007
065100     PERFORM DP023-0000-DYNALC.                                   06090007
065200                                                                  06100007
065300     SET PS-IS-NOT-ALLOCATED TO TRUE.                             06110007
065400                                                                  06120007
065500*                                                                 06130007
065600*  DYNAMIC ALLOCATION ROUTINE                                     06140007
065700*                                                                 06150007
065800     COPY DPPD023.                                                06160007
