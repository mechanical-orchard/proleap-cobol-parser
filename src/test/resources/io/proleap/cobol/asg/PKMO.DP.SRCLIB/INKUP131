       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    INKUP131.                                                 
       AUTHOR.        M JOHNSON.                                                
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  08-2004.                                                  
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      * PURPOSE: - INTERROGATE THE FASHION SALES AUDIT TABLE FOR STORES         
      *          IN AN INVENTORY STATUS AND THE UNT_BKG_STAT_CDE IS             
W33304*          EQUAL TO 'TC' - COMPLETED.                                     
      *            IF THE STORES TOTAL SUCCESSFUL ADJUSTMENTS EXCEEDS           
      *          THE TOTAL FAILED ADJUSTMENTS, CHANGE THE                       
W33304*          UNT_BKG_STAT_CDE TO 'TP' - PROCESSED.                          
      *            GENERATE AN AUDIT REPORT WHICH PROVIDES AN AUDIT             
      *          TO LOSS PREVENTION REGARDING UNITS BOOKED TO FASHION           
      *          SALES. THE REPORT INFORMATION COINCIDES WITH THE               
      *          INVENTORY UNITS BOOKED REPORTS AND THE FASHION SALES           
      *          ADJUSTMENT AUDIT REPORTS.                                      
      *                                                                         
      *CHANGE HISTORY:                                                          
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES                   
      * ------- ---------- ----------- --------------------------------         
W26600* W26600  08-01-2004 COMPUWARE/  INVENTORY STORE EXPANSION                
W26600*                    KOHLS       (CREATION)                               
730046* P730046 01-24-2005 R. JANSSEN  TINVPAR CONTENTION ISSUE WITH            
730046*                                OTHER INVENTORY JOBS                     
W28545* W28545  07-19-2006 J. SELWITSCHKA / STRATAGEM                           
W28545*                                DEPARTMENT LEVEL INVENTORY.              
W28545*                                INCORPORATE INVENTORY ID.                
W33304* W33304  05-01-2008  JILL LIN                                            
W33304*                     HOLDING INVENTORY LEDGER OPEN ACROSS                
W33304*                     PERIODS INVENTORY SHORTAGE REPORTING                
      ******************************************************************        
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER.    IBM-3090.                                            
       OBJECT-COMPUTER.    IBM-3090.                                            
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT FASHION-SLS-ADJ-SUM-RPT-FILE                                  
             ASSIGN TO RPT01.                                                   
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  FASHION-SLS-ADJ-SUM-RPT-FILE                                         
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
                                                                                
       01  FASHION-SLS-ADJ-SUM-RPT-DTL PIC  X(133).                             
                                                                                
      ******************************************************************        
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
       01  NI-NULL-INDICATORS.                                                  
           05  NI-ADJ-QTY              PIC S9(04)          VALUE +0             
                                                           COMP.                
           05  NI-CNT-NBR-RCDS         PIC S9(04)          VALUE +0             
                                                           COMP.                
           05  NI-LOC-10-ABBR-NM       PIC S9(04)          VALUE +0             
                                                           COMP.                
                                                                                
      ******************************************************************        
       01  ABEND-CODE                  PIC S9(04)          VALUE +0             
                                                           COMP SYNC.           
                                                                                
       01  SDT-SYSTEM-DATE-TIME.                                                
           05  SDT-YYYYMMDD            PIC  X(10)          VALUE SPACE.         
           05  FILLER REDEFINES SDT-YYYYMMDD.                                   
               10  SDT-YYYYMMDD-CCYY.                                           
                   15  SDT-YYYYMMDD-CC PIC  X(02).                              
                   15  SDT-YYYYMMDD-YY PIC  X(02).                              
               10  FILLER              PIC  X(01).                              
               10  SDT-YYYYMMDD-MM     PIC  X(02).                              
               10  FILLER              PIC  X(01).                              
               10  SDT-YYYYMMDD-DD     PIC  X(02).                              
           05  SDT-HHMMSS              PIC  X(08)          VALUE SPACE.         
           05  FILLER REDEFINES SDT-HHMMSS.                                     
               10  SDT-HHMMSS-HH       PIC  X(02).                              
               10  FILLER              PIC  X(01).                              
               10  SDT-HHMMSS-MM       PIC  X(02).                              
               10  FILLER              PIC  X(01).                              
               10  SDT-HHMMSS-SS       PIC  X(02).                              
                                                                                
      ******************************************************************        
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-EDIT-ERROR-SW        PIC  X(01)          VALUE 'N'.           
               88  PS-EDIT-ERROR                           VALUE 'Y'.           
           05  PS-TINVPAR-CSR-OPEN-SW  PIC  X(01)          VALUE 'C'.           
               88  PS-TINVPAR-CSR-OPEN                     VALUE 'O'.           
               88  PS-TINVPAR-CSR-CLOSED                   VALUE 'C'.           
           05  PS-TINVPAR-CSR-EOF-SW   PIC  X(01)          VALUE 'N'.           
               88  PS-TINVPAR-CSR-EOF                      VALUE 'Y'.           
           05  PS-XMT-LOC-FND-SW       PIC  X(01)          VALUE 'N'.           
               88  PS-XMT-LOC-FND                          VALUE 'Y'.           
           05  PS-FSOHADJ-CSR-OPEN-SW  PIC  X(01)          VALUE 'C'.           
               88  PS-FSOHADJ-CSR-OPEN                     VALUE 'O'.           
               88  PS-FSOHADJ-CSR-CLOSED                   VALUE 'C'.           
           05  PS-FSOHADJ-CSR-EOF-SW   PIC  X(01)          VALUE 'N'.           
               88  PS-FSOHADJ-CSR-EOF                      VALUE 'Y'.           
           05  PS-TCKRSTCNTL-RCD-FND-SW                                         
                                       PIC  X(01)          VALUE 'N'.           
               88  PS-TCKRSTCNTL-RCD-FND                   VALUE 'Y'.           
           05  PS-TCKRSTINF-RCD-FND-SW                                          
                                       PIC  X(01)          VALUE 'N'.           
               88  PS-TCKRSTINF-RCD-FND                    VALUE 'Y'.           
                                                                                
      ******************************************************************        
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-MAX-RETRIES          PIC S9(04)          VALUE +3             
                                                           COMP SYNC.           
           05  PC-CKPT-JOB-NAME        PIC  X(08)          VALUE                
               'INK300  '.                                                      
           05  PC-CKPT-PLAN-NAME       PIC  X(08)          VALUE                
               'INKUP131'.                                                      
           05  PC-EMPTY-DATE           PIC  X(10)          VALUE                
               '9999-09-09'.                                                    
           05  PC-PROGRAM-NAME         PIC  X(08)          VALUE                
               'INKUP131'.                                                      
                                                                                
      ******************************************************************        
       01  PT-PROGRAM-TOTALS.                                                   
           05  PT-NBR-INVPAR-READ      PIC S9(09)          VALUE +0             
                                                           COMP-3.              
           05  PT-NBR-INVPAR-UPDTD     PIC S9(09)          VALUE +0             
                                                           COMP-3.              
           05  PT-NBR-SUCCESSFUL-TRANS PIC S9(09)          VALUE +0             
                                                           COMP-3.              
           05  PT-UNITS-TOT-SUCCESS-TRAN                                        
                                       PIC S9(09)          VALUE +0             
                                                           COMP-3.              
           05  PT-NBR-FAILED-TRANS     PIC S9(09)          VALUE +0             
                                                           COMP-3.              
           05  PT-UNITS-TOT-FAIL-TRAN  PIC S9(09)          VALUE +0             
                                                           COMP-3.              
           05  PT-NBR-LOC-POSTED       PIC S9(09)          VALUE +0             
                                                           COMP-3.              
           05  PT-NBR-FAILED-GT        PIC S9(09)          VALUE +0             
                                                           COMP-3.              
           05  PT-NBR-NO-ADJUSTMENTS   PIC S9(09)          VALUE +0             
                                                           COMP-3.              
                                                                                
      ******************************************************************        
730046 01  PV-LOC-SUB                      PIC S9(05) COMP-3 VALUE 0.           
730046 01  PV-LOC-TABLE.                                                        
730046     05  PV-LOC-ELEMENTS             OCCURS 10000 TIMES.                  
730046         10  PV-LT-LOC-NBR           PIC S9(4) COMP.                      
W28545         10  PV-LT-INV-ID            PIC S9(9) COMP.                      
730046         10  PV-LT-ACTL-INV-DTE      PIC X(10).                           
730046         10  PV-LT-ACTL-UNIT-BK-DTE  PIC X(10).                           
730046         10  PV-LT-ACTL-FIN-BK-DTE   PIC X(10).                           
W33304         10  PV-LT-UNT-BKG-STAT-CDE  PIC X(02).                           
730046                                                                          
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-DISPLAY-FIELD11-C    PIC ZZZZZZZZZZZ-.                        
           05  PV-DISPLAY-FIELD11-E    PIC ZZZZZZZZZZZ-.                        
           05  PV-DISPLAY-FIELD17      PIC ZZZZZZZZZZZZZZZZZ-.                  
           05  PV-SQL-SUB              PIC  9(03)          VALUE ZEROS.         
           05  PV-RETRY-COUNT          PIC  9(03)          VALUE ZEROS.         
           05  PV-PARAGRAPH-NAME       PIC  X(30)          VALUE SPACE.         
           05  PV-DB2-OPERATION-ATTEMPTED                                       
                                       PIC  X(30)          VALUE SPACE.         
           05  PV-LOC-NBR              PIC S9(04)          VALUE +0             
                                                           COMP.                
W28545     05  PV-INV-ID               PIC S9(09)          VALUE +0             
W28545                                                     COMP.                
           05  PV-TRN-STAT-CDE         PIC  X(01)          VALUE SPACE.         
               88  PV-TRN-STAT-CDE-SUCCESS                 VALUE 'C'.           
               88  PV-TRN-STAT-CDE-FAIL                    VALUE 'E'.           
           05  PV-CNT-NBR-RCDS         PIC S9(09)          VALUE +0             
                                                           COMP-4.              
           05  PV-NBR-SUCCESSFUL-TRANS PIC S9(09)          VALUE +0             
                                                           COMP-3.              
           05  PV-UNITS-TOT-SUCCESS-TRAN                                        
                                       PIC S9(09)          VALUE +0             
                                                           COMP-3.              
           05  PV-NBR-FAILED-TRANS     PIC S9(09)          VALUE +0             
                                                           COMP-3.              
           05  PV-UNITS-TOT-FAIL-TRAN  PIC S9(09)          VALUE +0             
                                                           COMP-3.              
           05  PV-PAGE-NBR             PIC S9(05)          VALUE +0             
                                                           COMP-3.              
           05  PV-LINE-NBR             PIC S9(03)          VALUE +99            
                                                           COMP-3.              
           05  PV-MAX-LINE-NBR         PIC S9(03)          VALUE +66            
                                                           COMP-3.              
           05  PV-HL-LOC-NBR           PIC  9(04)          VALUE ZEROS.         
           05  PV-DTDB2-DATE-DB2       PIC  X(10)          VALUE SPACE.         
           05  FILLER REDEFINES PV-DTDB2-DATE-DB2.                              
               10  PV-DTDB2-YYYY       PIC  X(04).                              
               10  FILLER              PIC  X(01).                              
               10  PV-DTDB2-MM         PIC  X(02).                              
               10  FILLER              PIC  X(01).                              
               10  PV-DTDB2-DD         PIC  X(02).                              
           05  PV-DD-DISPLAY-DATE.                                              
               10  PV-DD-MM            PIC  X(02)          VALUE SPACE.         
               10  FILLER              PIC  X(01)          VALUE '/'.           
               10  PV-DD-DD            PIC  X(02)          VALUE SPACE.         
               10  FILLER              PIC  X(01)          VALUE '/'.           
               10  PV-DD-YYYY          PIC  X(04)          VALUE SPACE.         
                                                                                
      *****************************************************************         
      *  COPY FOR STANDARD HEADER                                               
      *****************************************************************         
           COPY DPWS132O.                                                       
                                                                                
      *****************************************************************         
       01  HL1-HEADING-LINE-1.                                                  
           05  FILLER                  PIC  X(57)          VALUE SPACE.         
           05  FILLER                  PIC  X(18)          VALUE                
               'PHYSICAL INVENTORY'.                                            
                                                                                
      *****************************************************************         
       01  HL2-HEADING-LINE-2.                                                  
           05  FILLER                  PIC  X(54)          VALUE SPACE.         
           05  FILLER                  PIC  X(24)          VALUE                
               'UNIT BOOK POSTING STATUS'.                                      
                                                                                
      *****************************************************************         
       01  SHL1-SUB-HEADING-LINE-1.                                             
           05  FILLER                  PIC  X(43)          VALUE SPACE.         
           05  FILLER                  PIC  X(24)          VALUE                
               '*******SUCCESSFUL*******'.                                      
           05  FILLER                  PIC  X(02)          VALUE SPACE.         
           05  FILLER                  PIC  X(24)          VALUE                
               '********FAILED**********'.                                      
                                                                                
      *****************************************************************         
       01  SHL2-SUB-HEADING-LINE-2.                                             
           05  FILLER                  PIC  X(19)          VALUE SPACE.         
           05  FILLER                  PIC  X(09)          VALUE                
               'INVENTORY'.                                                     
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  FILLER                  PIC  X(09)          VALUE                
               'UNIT BOOK'.                                                     
           05  FILLER                  PIC  X(04)          VALUE SPACE.         
           05  FILLER                  PIC  X(09)          VALUE                
               'NUMBER OF'.                                                     
           05  FILLER                  PIC  X(04)          VALUE SPACE.         
           05  FILLER                  PIC  X(10)          VALUE                
               'ADJUSTMENT'.                                                    
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  FILLER                  PIC  X(09)          VALUE                
               'NUMBER OF'.                                                     
           05  FILLER                  PIC  X(04)          VALUE SPACE.         
           05  FILLER                  PIC  X(10)          VALUE                
               'ADJUSTMENT'.                                                    
                                                                                
      *****************************************************************         
       01  SHL3-SUB-HEADING-LINE-3.                                             
           05  FILLER                  PIC  X(05)          VALUE                
               'STORE'.                                                         
           05  FILLER                  PIC  X(17)          VALUE SPACE.         
           05  FILLER                  PIC  X(04)          VALUE                
               'DATE'.                                                          
           05  FILLER                  PIC  X(08)          VALUE SPACE.         
           05  FILLER                  PIC  X(04)          VALUE                
               'DATE'.                                                          
           05  FILLER                  PIC  X(05)          VALUE SPACE.         
           05  FILLER                  PIC  X(12)          VALUE                
               'TRANSACTIONS'.                                                  
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  FILLER                  PIC  X(08)          VALUE                
               'QUANTITY'.                                                      
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  FILLER                  PIC  X(12)          VALUE                
               'TRANSACTIONS'.                                                  
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  FILLER                  PIC  X(08)          VALUE                
               'QUANTITY'.                                                      
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  FILLER                  PIC  X(19)          VALUE                
               'UNIT BOOKING STATUS'.                                           
                                                                                
      *****************************************************************         
       01  SHL4-SUB-HEADING-LINE-4.                                             
           05  FILLER                  PIC  X(17)          VALUE                
               '-----------------'.                                             
           05  FILLER                  PIC  X(02)          VALUE SPACE.         
           05  FILLER                  PIC  X(10)          VALUE                
               '----------'.                                                    
           05  FILLER                  PIC  X(02)          VALUE SPACE.         
           05  FILLER                  PIC  X(10)          VALUE                
               '----------'.                                                    
           05  FILLER                  PIC  X(02)          VALUE SPACE.         
           05  FILLER                  PIC  X(12)          VALUE                
               '------------'.                                                  
           05  FILLER                  PIC  X(02)          VALUE SPACE.         
           05  FILLER                  PIC  X(10)          VALUE                
               '----------'.                                                    
           05  FILLER                  PIC  X(02)          VALUE SPACE.         
           05  FILLER                  PIC  X(12)          VALUE                
               '------------'.                                                  
           05  FILLER                  PIC  X(02)          VALUE SPACE.         
           05  FILLER                  PIC  X(10)          VALUE                
               '----------'.                                                    
           05  FILLER                  PIC  X(02)          VALUE SPACE.         
           05  FILLER                  PIC  X(35)          VALUE                
               '-----------------------------------'.                           
                                                                                
      *****************************************************************         
       01  RL1-RPT-LINE-1.                                                      
           05  RL1-HEADER              PIC  X(41)          VALUE SPACE.         
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  RL1-CNT-NBR-RCDS-SUCCESS                                         
                                       PIC  Z(08)9(01)-    VALUE ZEROS          
                                                           BLANK ZEROS.         
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  RL1-ADJ-QTY-SUCCESS     PIC  Z(08)9(01)-    VALUE ZEROS          
                                                           BLANK ZEROS.         
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  RL1-CNT-NBR-RCDS-FAIL   PIC  Z(08)9(01)-    VALUE ZEROS          
                                                           BLANK ZEROS.         
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  RL1-ADJ-QTY-FAIL        PIC  Z(08)9(01)-    VALUE ZEROS          
                                                           BLANK ZEROS.         
           05  FILLER                  PIC  X(02)          VALUE SPACE.         
           05  RL1-DSUB-DESC-STAT-UNT-BK                                        
                                       PIC  X(35)          VALUE SPACE.         
               88  RL1-DSUB-POSTED                         VALUE                
                   'CHANGED TO POSTED'.                                         
               88  RL1-DSUB-FAILED-GT                      VALUE                
                   'NOT CHANGED - FAILED > SUCCESS'.                            
               88  RL1-DSUB-NO-ADJUSTMENTS                 VALUE                
                   'NOT CHANGED - NO ADJUSTMENTS'.                              
                                                                                
      *****************************************************************         
       01  RLH1-RPT-LINE-HEADER-1.                                              
           05  RLH1-LOC-NBR            PIC  9(04)          VALUE ZEROS.         
           05  FILLER                  PIC  X(03)          VALUE ' - '.         
           05  RLH1-LOC-NAME           PIC  X(10)          VALUE SPACE.         
           05  FILLER                  PIC  X(02)          VALUE SPACE.         
           05  RLH1-ACTL-INV-DTE       PIC  X(10)          VALUE SPACE.         
           05  FILLER                  PIC  X(02)          VALUE SPACE.         
           05  RLH1-ACTL-UNIT-BK-DTE   PIC  X(10)          VALUE SPACE.         
                                                                                
      *****************************************************************         
       01  CTL1-COMPANY-TOTAL-LINE-1.                                           
           05  FILLER                  PIC  X(14)          VALUE                
               'COMPANY TOTALS'.                                                
           05  FILLER                  PIC  X(30)          VALUE SPACE.         
           05  CTL1-CNT-NBR-RCDS-SUCCESS                                        
                                       PIC  Z(08)9(01)-    VALUE ZEROS          
                                                           BLANK ZEROS.         
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  CTL1-ADJ-QTY-SUCCESS    PIC  Z(08)9(01)-    VALUE ZEROS          
                                                           BLANK ZEROS.         
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  CTL1-CNT-NBR-RCDS-FAIL  PIC  Z(08)9(01)-    VALUE ZEROS          
                                                           BLANK ZEROS.         
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  CTL1-ADJ-QTY-FAIL       PIC  Z(08)9(01)-    VALUE ZEROS          
                                                           BLANK ZEROS.         
                                                                                
      *****************************************************************         
       01  PSL1-POSTING-STATUS-LINE-1.                                          
           05  PSL1-HEADER             PIC  X(10)          VALUE SPACE.         
           05  PSL1-NBR-LOC-POSTED REDEFINES PSL1-HEADER                        
                                       PIC  Z(08)9(01)-.                        
           05  FILLER                  PIC  X(02)          VALUE SPACE.         
           05  PSL1-DP-DESC-POSTED     PIC  X(40)          VALUE SPACE.         
               88  PSL1-DP-HEADER                          VALUE                
                   'POSTING STATUS TOTALS'.                                     
               88  PSL1-DP-LOC-POSTED                      VALUE                
                   'NUMBER - LOCATIONS POSTED'.                                 
               88  PSL1-DP-FAILED-GT                       VALUE                
                   'NUMBER - NOT CHANGED - FAILED > SUCCESS'.                   
               88  PSL1-DP-NO-ADJUSTMENTS                  VALUE                
                   'NUMBER - NOT CHANGED - NO ADJUSTMENTS'.                     
                                                                                
      *****************************************************************         
      *  DCLGEN LAYOUT AND COBOL DECLARATION OF                                 
      *  DB2 TABLE.                                                             
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TMLCNTL                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DB2 ML DATE ATTRIBUTES                                                  
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TDTATTR                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  DCLGEN LAYOUT AND COBOL DECLARATION OF INVENTORY PARAMETERS            
      *  DB2 TABLE.                                                             
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TINVPAR                                                  
           END-EXEC.                                                            
                                                                                
W28545*****************************************************************         
W28545*  DCLGEN LAYOUT AND COBOL DECLARATION OF INVENTORY CONTROL               
W28545*  DB2 TABLE.                                                             
W28545*****************************************************************         
W28545     EXEC SQL                                                             
W28545         INCLUDE TINCNTL                                                  
W28545     END-EXEC.                                                            
W28545                                                                          
      *****************************************************************         
      *  DCLGEN LAYOUT AND COBOL DECLARATION OF LOCATION DB2 TABLE              
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE XMT00001                                                 
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  DCLGEN LAYOUT AND COBOL DECLARATION OF FASHION SALES ON HAND           
      *  ADJUSTMENT AUDIT DB2 TABLE.                                            
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE FST00003                                                 
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  CHECKPOINT RESTART CONTROL AND INFORMATION TABLES                      
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TCKRSTCN                                                 
           END-EXEC.                                                            
                                                                                
           EXEC SQL                                                             
               INCLUDE TCKRSTIN                                                 
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
           EXEC SQL                                                             
             DECLARE TINVPAR_CSR CURSOR FOR                                     
             SELECT LOC_NBR,                                                    
W28545              A.INV_ID,                                                   
                    ACTL_INV_DTE,                                               
                    ACTL_UNIT_BK_DTE,                                           
                    ACTL_FIN_BK_DTE,                                            
                    UNT_BKG_STAT_CDE                                            
W28545       FROM TINVPAR A                                                     
W28545           ,TINCNTL B                                                     
W26600       WHERE ACTL_FIN_BK_DTE = '9999-09-09'                               
W33304         AND UNT_BKG_STAT_CDE = 'TC'                                      
W28545         AND B.ACTV_IND       = 'Y'                                       
W28545         AND A.INV_ID         = B.INV_ID                                  
W33304         AND A.LOC_INV_STAT_CDE = 'IN'                                    
730046       WITH UR                                                            
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
           EXEC SQL                                                             
             DECLARE FSOHADJ_CSR CURSOR FOR                                     
             SELECT SUM.LOC_NBR,                                                
                    SUM.TRN_STAT_CDE,                                           
                    SUM.ADJ_QTY,                                                
                    SUM.CNT_NBR_RCDS                                            
             FROM (SELECT R.LOC_NBR,                                            
                          R.TRN_STAT_CDE,                                       
                          SUM(R.ADJ_QTY) AS ADJ_QTY,                            
                          COUNT(*) AS CNT_NBR_RCDS                              
                   FROM (SELECT LOC_NBR,                                        
                                TRN_STAT_CDE,                                   
                                CASE                                            
                                  WHEN ACTN_CDE = '+'                           
                                    THEN (ADJ_QTY * 1)                          
                                  WHEN ACTN_CDE = '-'                           
                                    THEN (ADJ_QTY * -1)                         
                                END AS ADJ_QTY                                  
                         FROM FSTT_OH_ADJ_AUD                                   
                         WHERE TRN_STAT_CDE = :PV-TRN-STAT-CDE                  
W26600                     AND LOC_NBR = :PV-LOC-NBR                            
W26600                     AND ADJ_TYP_CDE = '121'                              
W26600                     AND BTCH_NBR = 'INAD') AS R                          
                   GROUP BY LOC_NBR, TRN_STAT_CDE) AS SUM                       
             ORDER BY LOC_NBR                                                   
             WITH UR                                                            
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  COMMUNICATIONS AREA FOR DB2                                   *        
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  COMMUNICATIONS AREA FOR DB2                                            
      ******************************************************************        
           COPY SQLCA2.                                                         
                                                                                
      ******************************************************************        
      *  DB2 FORMATTED ERROR MESSAGE                                            
      ******************************************************************        
           COPY DPWS004.                                                        
                                                                                
      ******************************************************************        
       PROCEDURE DIVISION.                                                      
                                                                                
      ******************************************************************        
      *  CONTROLS THE MAIN PROCESSING OF THE PROGRAM                            
      ******************************************************************        
       0000-RPT-FS-ADJ-POST-INVPAR.                                             
      *                                                                         
           PERFORM 0100-INITIALIZE.                                             
           PERFORM 8000-OPEN-FILES.                                             
                                                                                
730046*    PERFORM 7050-OPEN-TINVPAR-CSR.                                       
730046*                                                                         
730046*    IF PS-TINVPAR-CSR-OPEN                                               
730046*        PERFORM 7051-FETCH-TINVPAR-DTL                                   
730046*    END-IF.                                                              
730046*                                                                         
730046     MOVE ZEROS          TO PV-LOC-SUB.                                   
           PERFORM 1000-PROCESS-TINVPAR                                         
730046       VARYING PV-LOC-SUB FROM 1 BY 1                                     
730046         UNTIL PV-LOC-SUB GREATER 10000                                   
730046            OR PS-EDIT-ERROR.                                             
730046*        UNTIL PS-TINVPAR-CSR-EOF                                         
730046*        OR PS-EDIT-ERROR.                                                
730046                                                                          
730046*    IF PS-TINVPAR-CSR-OPEN                                               
730046*        PERFORM 7052-CLOSE-TINVPAR-CSR                                   
730046*    END-IF.                                                              
730046*                                                                         
           PERFORM 3020-FMT-COMPANY-TOTAL-LINE.                                 
           PERFORM 3030-FMT-POSTING-STAT-LINE.                                  
                                                                                
           PERFORM 8900-CLOSE-FILES.                                            
                                                                                
           GOBACK.                                                              
                                                                                
      ******************************************************************        
      * 0100-INITIALIZE.                                                        
      ******************************************************************        
       0100-INITIALIZE.                                                         
                                                                                
           PERFORM 7600-SELECT-DATE-TIME.                                       
                                                                                
W26600     DISPLAY '* INKUP131 SUMMARY *******'.                                
W26600     DISPLAY 'DATES: ' SDT-YYYYMMDD ' - ' SDT-HHMMSS.                     
W26600     DISPLAY ' '.                                                         
W26600                                                                          
           MOVE SDT-YYYYMMDD-YY        TO DP132O-RUN-YEAR.                      
           MOVE SDT-YYYYMMDD-MM        TO DP132O-RUN-MONTH.                     
           MOVE SDT-YYYYMMDD-DD        TO DP132O-RUN-DAY.                       
           MOVE SDT-HHMMSS-HH          TO DP132O-RUN-HOUR.                      
           MOVE SDT-HHMMSS-MM          TO DP132O-RUN-MINUTE.                    
           MOVE PC-PROGRAM-NAME        TO DP132O-PROGRAM-NAME.                  
           MOVE 1                      TO DP132O-REPORT-NUMBER.                 
                                                                                
730046** LOAD THE LOCATION TABLE FOR STORES WITH BOOK IND = 'C'.                
730046     INITIALIZE PV-LOC-TABLE.                                             
730046                                                                          
730046     PERFORM 7050-OPEN-TINVPAR-CSR.                                       
730046                                                                          
730046     IF PS-TINVPAR-CSR-OPEN                                               
730046       MOVE ZEROS          TO PV-LOC-SUB                                  
730046       PERFORM 7051-FETCH-TINVPAR-DTL                                     
730046         UNTIL PS-TINVPAR-CSR-EOF                                         
730046     END-IF.                                                              
730046                                                                          
730046     IF PS-TINVPAR-CSR-OPEN                                               
730046         PERFORM 7052-CLOSE-TINVPAR-CSR                                   
730046     END-IF.                                                              
730046                                                                          
      /*****************************************************************        
      * 1000-PROCESS-TINVPAR.                                                   
      ******************************************************************        
       1000-PROCESS-TINVPAR.                                                    
                                                                                
730046     IF PV-LT-LOC-NBR (PV-LOC-SUB) EQUAL ZEROS AND                        
W28545        PV-LT-INV-ID  (PV-LOC-SUB) EQUAL ZEROS AND                        
730046        PV-LT-ACTL-INV-DTE (PV-LOC-SUB) EQUAL SPACES AND                  
730046        PV-LT-ACTL-UNIT-BK-DTE (PV-LOC-SUB) EQUAL SPACES AND              
730046        PV-LT-ACTL-FIN-BK-DTE (PV-LOC-SUB) EQUAL SPACES AND               
730046        PV-LT-UNT-BKG-STAT-CDE (PV-LOC-SUB) EQUAL SPACE                   
730046         NEXT SENTENCE                                                    
730046     ELSE                                                                 
730046         PERFORM 1500-PROCESS-FASHION                                     
730046     END-IF.                                                              
730046                                                                          
730046/*****************************************************************        
730046* 1500-PROCESS-FASHION.                                                   
730046******************************************************************        
730046 1500-PROCESS-FASHION.                                                    
730046                                                                          
730046     DISPLAY 'STORE: ',                                                   
730046        PV-LT-LOC-NBR (PV-LOC-SUB) ' ',                                   
W28545        PV-LT-INV-ID  (PV-LOC-SUB) ' ',                                   
730046        PV-LT-ACTL-INV-DTE (PV-LOC-SUB) ' ',                              
730046        PV-LT-ACTL-UNIT-BK-DTE (PV-LOC-SUB) ' ',                          
730046        PV-LT-ACTL-FIN-BK-DTE (PV-LOC-SUB) ' ',                           
730046        PV-LT-UNT-BKG-STAT-CDE (PV-LOC-SUB).                              
                                                                                
730046** INITIALIZATION...                                                      
           INITIALIZE                  PV-NBR-SUCCESSFUL-TRANS                  
                                       PV-UNITS-TOT-SUCCESS-TRAN                
                                       PV-NBR-FAILED-TRANS                      
                                       PV-UNITS-TOT-FAIL-TRAN.                  
W26600                                                                          
W26600** PROCESS LOCATIONS TAGGED AS C - COMPLETE. DETERMINE IF THE             
W26600** BOOKING PROCESS WAS SUCCESSFUL. UPDATE THE UNIT BOOK STATUS TO         
W26600** P - PROCESSED WHEN MORE ADJUSTMENTS WERE SUCCEFUL THAN FAILED.         
W26600                                                                          
730046     IF PV-LT-LOC-NBR (PV-LOC-SUB) NOT = PV-LOC-NBR                       
               PERFORM 3000-FMT-RPT-DTL-HEADER                                  
730046         MOVE PV-LT-LOC-NBR (PV-LOC-SUB) TO PV-LOC-NBR                    
W28545         MOVE PV-LT-INV-ID  (PV-LOC-SUB) TO PV-INV-ID                     
               SET PV-TRN-STAT-CDE-SUCCESS TO TRUE                              
               INITIALIZE              PS-FSOHADJ-CSR-OPEN-SW                   
W26600                                                                          
W26600** READ THE FASHION SALES AUDIT TABLE TO DETERMINE WHAT BOOKED            
W26600** AND WHAT DID NOT BOOK...                                               
               PERFORM 7150-OPEN-FSOHADJ-CSR                                    
               IF PS-FSOHADJ-CSR-OPEN                                           
                 INITIALIZE            PS-FSOHADJ-CSR-EOF-SW                    
                 PERFORM 7151-FETCH-FSOHADJ-DTL                                 
                 PERFORM 2000-PRCSS-SUCCESS-FSOHADJ                             
                   UNTIL PS-FSOHADJ-CSR-EOF                                     
                   OR PS-EDIT-ERROR                                             
                 PERFORM 7152-CLOSE-FSOHADJ-CSR                                 
               END-IF                                                           
               SET PV-TRN-STAT-CDE-FAIL                                         
                                       TO TRUE                                  
               INITIALIZE              PS-FSOHADJ-CSR-OPEN-SW                   
               PERFORM 7150-OPEN-FSOHADJ-CSR                                    
               IF PS-FSOHADJ-CSR-OPEN                                           
                 INITIALIZE            PS-FSOHADJ-CSR-EOF-SW                    
                 PERFORM 7151-FETCH-FSOHADJ-DTL                                 
                 PERFORM 2000-PRCSS-SUCCESS-FSOHADJ                             
                   UNTIL PS-FSOHADJ-CSR-EOF                                     
                   OR PS-EDIT-ERROR                                             
                 PERFORM 7152-CLOSE-FSOHADJ-CSR                                 
               END-IF                                                           
W26600                                                                          
W26600** UPDATE TINVPAR WHEN MORE ADJUSTMENTS WERE SUCCESSFUL THAN              
W26600** FAILED.                                                                
               IF PV-NBR-SUCCESSFUL-TRANS > 0                                   
               OR PV-NBR-FAILED-TRANS > 0                                       
                 IF PV-NBR-SUCCESSFUL-TRANS > PV-NBR-FAILED-TRANS               
730046             MOVE PV-LOC-NBR  TO INVPAR-LOC-NBR                           
W28545             MOVE PV-INV-ID   TO INVPAR-INV-ID                            
                   PERFORM 7000-UPDATE-TINVPAR-ROW                              
                 END-IF                                                         
               END-IF                                                           
W26600                                                                          
W26600** WRITE DETAIL REGARDING THE LOCATION UNIT BOOK STATUS.                  
               PERFORM 3010-FMT-RPT-DTL-LINE                                    
                                                                                
           END-IF.                                                              
                                                                                
730046** READ NEXT TINVPAR LOCATION...                                          
730046*    PERFORM 7051-FETCH-TINVPAR-DTL.                                      
730046                                                                          
      /*****************************************************************        
      * 2000-PRCSS-SUCCESS-FSOHADJ.                                             
      ******************************************************************        
       2000-PRCSS-SUCCESS-FSOHADJ.                                              
                                                                                
           EVALUATE TRUE                                                        
             WHEN PV-TRN-STAT-CDE-SUCCESS                                       
               COMPUTE PV-NBR-SUCCESSFUL-TRANS =                                
                 PV-NBR-SUCCESSFUL-TRANS + PV-CNT-NBR-RCDS                      
               COMPUTE PT-NBR-SUCCESSFUL-TRANS =                                
                 PT-NBR-SUCCESSFUL-TRANS + PV-NBR-SUCCESSFUL-TRANS              
               COMPUTE PV-UNITS-TOT-SUCCESS-TRAN =                              
                 PV-UNITS-TOT-SUCCESS-TRAN + FST00003-ADJ-QTY                   
               COMPUTE PT-UNITS-TOT-SUCCESS-TRAN =                              
                 PT-UNITS-TOT-SUCCESS-TRAN + PV-UNITS-TOT-SUCCESS-TRAN          
             WHEN OTHER                                                         
               COMPUTE PV-NBR-FAILED-TRANS =                                    
                 PV-NBR-FAILED-TRANS + PV-CNT-NBR-RCDS                          
               COMPUTE PT-NBR-FAILED-TRANS =                                    
                 PT-NBR-FAILED-TRANS + PV-NBR-FAILED-TRANS                      
               COMPUTE  PV-UNITS-TOT-FAIL-TRAN =                                
                 PV-UNITS-TOT-FAIL-TRAN + FST00003-ADJ-QTY                      
               COMPUTE  PT-UNITS-TOT-FAIL-TRAN =                                
                 PT-UNITS-TOT-FAIL-TRAN + PV-UNITS-TOT-FAIL-TRAN                
           END-EVALUATE.                                                        
                                                                                
                                                                                
           PERFORM 7151-FETCH-FSOHADJ-DTL.                                      
                                                                                
      /*****************************************************************        
      * 3000-FMT-RPT-DTL-HEADER.                                                
      ******************************************************************        
       3000-FMT-RPT-DTL-HEADER.                                                 
                                                                                
730046     MOVE PV-LT-LOC-NBR (PV-LOC-SUB) TO RLH1-LOC-NBR.                     
730046     MOVE PV-LT-LOC-NBR (PV-LOC-SUB) TO XMT00001-LOC-NBR.                 
           INITIALIZE                  PS-XMT-LOC-FND-SW.                       
           PERFORM 7200-SELECT-XMT-LOC.                                         
                                                                                
           IF PS-XMT-LOC-FND                                                    
               MOVE XMT00001-LOC-10-ABBR-NM                                     
                                       TO RLH1-LOC-NAME                         
           ELSE                                                                 
               MOVE 'UNKNOWN'          TO RLH1-LOC-NAME                         
           END-IF.                                                              
                                                                                
730046     MOVE PV-LT-ACTL-INV-DTE (PV-LOC-SUB)                                 
                                      TO PV-DTDB2-DATE-DB2.                     
           PERFORM 4000-FMT-DB2-DISPLAY-DATE.                                   
           MOVE PV-DD-DISPLAY-DATE     TO RLH1-ACTL-INV-DTE.                    
730046     MOVE PV-LT-ACTL-UNIT-BK-DTE (PV-LOC-SUB)                             
                                       TO PV-DTDB2-DATE-DB2.                    
           PERFORM 4000-FMT-DB2-DISPLAY-DATE.                                   
           MOVE PV-DD-DISPLAY-DATE     TO RLH1-ACTL-UNIT-BK-DTE.                
                                                                                
      ******************************************************************        
      * 3010-FMT-RPT-DTL-LINE.                                                  
      ******************************************************************        
       3010-FMT-RPT-DTL-LINE.                                                   
                                                                                
           INITIALIZE                  RL1-RPT-LINE-1.                          
                                                                                
           MOVE RLH1-RPT-LINE-HEADER-1 TO RL1-HEADER.                           
                                                                                
           MOVE PV-NBR-SUCCESSFUL-TRANS                                         
                                       TO RL1-CNT-NBR-RCDS-SUCCESS.             
           MOVE PV-UNITS-TOT-SUCCESS-TRAN                                       
                                       TO RL1-ADJ-QTY-SUCCESS.                  
           MOVE PV-NBR-FAILED-TRANS    TO RL1-CNT-NBR-RCDS-FAIL                 
           MOVE PV-UNITS-TOT-FAIL-TRAN TO RL1-ADJ-QTY-FAIL.                     
                                                                                
           IF PV-NBR-SUCCESSFUL-TRANS > 0                                       
           OR PV-NBR-FAILED-TRANS > 0                                           
               IF PV-NBR-SUCCESSFUL-TRANS > PV-NBR-FAILED-TRANS                 
                 SET RL1-DSUB-POSTED   TO TRUE                                  
                 ADD +1                TO PT-NBR-LOC-POSTED                     
               ELSE                                                             
                 SET RL1-DSUB-FAILED-GT                                         
                                       TO TRUE                                  
                 ADD +1                TO PT-NBR-FAILED-GT                      
               END-IF                                                           
           ELSE                                                                 
               SET RL1-DSUB-NO-ADJUSTMENTS                                      
                                       TO TRUE                                  
               ADD +1                  TO PT-NBR-NO-ADJUSTMENTS                 
           END-IF.                                                              
                                                                                
           PERFORM 8100-WRITE-FSHN-SLS-ADJ-DTL.                                 
           MOVE RLH1-LOC-NBR           TO PV-HL-LOC-NBR.                        
                                                                                
      ******************************************************************        
      * 3020-FMT-COMPANY-TOTAL-LINE.                                            
      ******************************************************************        
       3020-FMT-COMPANY-TOTAL-LINE.                                             
                                                                                
           INITIALIZE                  CTL1-COMPANY-TOTAL-LINE-1.               
           MOVE PT-NBR-SUCCESSFUL-TRANS                                         
                                       TO CTL1-CNT-NBR-RCDS-SUCCESS.            
           MOVE PT-UNITS-TOT-SUCCESS-TRAN                                       
                                       TO CTL1-ADJ-QTY-SUCCESS.                 
           MOVE PT-NBR-FAILED-TRANS    TO CTL1-CNT-NBR-RCDS-FAIL.               
           MOVE PT-UNITS-TOT-FAIL-TRAN TO CTL1-ADJ-QTY-FAIL.                    
                                                                                
           PERFORM 8110-WRITE-FSHN-SLS-ADJ-COTTL.                               
                                                                                
      ******************************************************************        
      * 3030-FMT-POSTING-STAT-LINE.                                             
      ******************************************************************        
       3030-FMT-POSTING-STAT-LINE.                                              
                                                                                
           INITIALIZE                  PSL1-POSTING-STATUS-LINE-1.              
           SET PSL1-DP-HEADER          TO TRUE.                                 
           PERFORM 8120-WRITE-FSHN-SLS-ADJ-PSTTL.                               
                                                                                
           SET PSL1-DP-LOC-POSTED      TO TRUE.                                 
           MOVE PT-NBR-LOC-POSTED      TO PSL1-NBR-LOC-POSTED.                  
           PERFORM 8120-WRITE-FSHN-SLS-ADJ-PSTTL.                               
                                                                                
           SET PSL1-DP-FAILED-GT       TO TRUE.                                 
           MOVE PT-NBR-FAILED-GT       TO PSL1-NBR-LOC-POSTED.                  
           PERFORM 8120-WRITE-FSHN-SLS-ADJ-PSTTL.                               
                                                                                
           SET PSL1-DP-NO-ADJUSTMENTS  TO TRUE.                                 
           MOVE PT-NBR-NO-ADJUSTMENTS  TO PSL1-NBR-LOC-POSTED.                  
           PERFORM 8120-WRITE-FSHN-SLS-ADJ-PSTTL.                               
                                                                                
      /*****************************************************************        
      * 4000-FMT-DB2-DISPLAY-DATE.                                              
      ******************************************************************        
       4000-FMT-DB2-DISPLAY-DATE.                                               
                                                                                
           MOVE PV-DTDB2-YYYY          TO PV-DD-YYYY.                           
           MOVE PV-DTDB2-MM            TO PV-DD-MM.                             
           MOVE PV-DTDB2-DD            TO PV-DD-DD.                             
                                                                                
      /*****************************************************************        
      * 7000-UPDATE-TINVPAR-ROW.                                                
      ******************************************************************        
       7000-UPDATE-TINVPAR-ROW.                                                 
                                                                                
           PERFORM                                                              
             WITH TEST AFTER                                                    
             VARYING PV-SQL-SUB                                                 
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
                         OR SQLCODE = 0)                                        
                                                                                
             EXEC SQL                                                           
                 UPDATE TINVPAR                                                 
S26600           SET CHG_TMST =         CURRENT TIMESTAMP,                      
                     CHG_ID_NBR =       :PC-PROGRAM-NAME,                       
W33304               UNT_BKG_STAT_CDE = 'TP'                                    
730046           WHERE LOC_NBR = :INVPAR-LOC-NBR                                
W28545             AND INV_ID  = :INVPAR-INV-ID                                 
730046             AND ACTL_FIN_BK_DTE = '9999-09-09'                           
             END-EXEC                                                           
                                                                                
             EVALUATE TRUE                                                      
               WHEN SQLCODE = 0                                                 
730046           PERFORM 7900-COMMIT-WORK                                       
               WHEN SQLCODE = -904                                              
                 CONTINUE                                                       
               WHEN SQLWARN0 NOT = SPACES                                       
               WHEN SQLCODE < 0                                                 
               WHEN SQLCODE > 0                                                 
                 DISPLAY 'INKUP131 - INVALID LOC NBR ', INVPAR-LOC-NBR          
                 MOVE '7000-UPDATE-TINVPAR-ROW'                                 
                                       TO PV-PARAGRAPH-NAME                     
                 MOVE 'UPDATING TINVPAR TABLE'                                  
                                       TO PV-DB2-OPERATION-ATTEMPTED            
                 PERFORM 9900-SQL-ABEND                                         
             END-EVALUATE                                                       
           END-PERFORM.                                                         
                                                                                
           IF PV-SQL-SUB > PC-MAX-RETRIES                                       
               MOVE '7000-UPDATE-TINVPAR-ROW'                                   
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'MAX RETRIES EXCEEDED'                                      
                                       TO PV-DB2-OPERATION-ATTEMPTED            
               PERFORM 9900-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * 7050-OPEN-TINVPAR-CSR.                                                  
      ******************************************************************        
       7050-OPEN-TINVPAR-CSR.                                                   
                                                                                
           PERFORM                                                              
             WITH TEST AFTER                                                    
             VARYING PV-SQL-SUB                                                 
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
               OR SQLCODE = 0)                                                  
                                                                                
             EXEC SQL                                                           
               OPEN TINVPAR_CSR                                                 
             END-EXEC                                                           
                                                                                
             EVALUATE TRUE                                                      
               WHEN SQLCODE = 0                                                 
                 SET PS-TINVPAR-CSR-OPEN                                        
                                       TO TRUE                                  
               WHEN SQLCODE = -904                                              
                 CONTINUE                                                       
               WHEN SQLWARN0 NOT = SPACES                                       
               WHEN SQLCODE < 0                                                 
               WHEN SQLCODE > 0                                                 
                 MOVE '7050-OPEN-TINVPAR-CSR'                                   
                                       TO PV-PARAGRAPH-NAME                     
                 MOVE 'OPEN TINVPAR_CSR'                                        
                                       TO PV-DB2-OPERATION-ATTEMPTED            
                 PERFORM 9900-SQL-ABEND                                         
             END-EVALUATE                                                       
                                                                                
           END-PERFORM.                                                         
                                                                                
           IF PV-SQL-SUB > PC-MAX-RETRIES                                       
               MOVE '7050-OPEN-TINVPAR-CSR'                                     
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'MAX RETRIES EXCEEDED   '                                   
                                       TO PV-DB2-OPERATION-ATTEMPTED            
               PERFORM 9900-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * 7051-FETCH-TINVPAR-DTL.                                                 
      ******************************************************************        
       7051-FETCH-TINVPAR-DTL.                                                  
                                                                                
730046     ADD 1               TO PV-LOC-SUB.                                   
730046                                                                          
           PERFORM                                                              
             WITH TEST AFTER                                                    
             VARYING PV-SQL-SUB                                                 
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
               OR SQLCODE = 0                                                   
               OR SQLCODE = +100)                                               
                                                                                
             EXEC SQL                                                           
               FETCH TINVPAR_CSR                                                
               INTO :INVPAR-LOC-NBR,                                            
W28545              :INVPAR-INV-ID,                                             
                    :INVPAR-ACTL-INV-DTE,                                       
                    :INVPAR-ACTL-UNIT-BK-DTE,                                   
                    :INVPAR-ACTL-FIN-BK-DTE,                                    
                    :INVPAR-UNT-BKG-STAT-CDE                                    
             END-EXEC                                                           
                                                                                
             EVALUATE TRUE                                                      
               WHEN SQLCODE = -904                                              
               WHEN SQLCODE = 0                                                 
730046             MOVE INVPAR-LOC-NBR                                          
730046                         TO PV-LT-LOC-NBR (PV-LOC-SUB)                    
W28545             MOVE INVPAR-INV-ID                                           
W28545                         TO PV-LT-INV-ID  (PV-LOC-SUB)                    
730046             MOVE INVPAR-ACTL-INV-DTE                                     
730046                         TO PV-LT-ACTL-INV-DTE (PV-LOC-SUB)               
730046             MOVE INVPAR-ACTL-UNIT-BK-DTE                                 
730046                         TO PV-LT-ACTL-UNIT-BK-DTE (PV-LOC-SUB)           
730046             MOVE INVPAR-ACTL-FIN-BK-DTE                                  
730046                         TO PV-LT-ACTL-FIN-BK-DTE (PV-LOC-SUB)            
730046             MOVE INVPAR-UNT-BKG-STAT-CDE                                 
730046                         TO PV-LT-UNT-BKG-STAT-CDE (PV-LOC-SUB)           
               WHEN SQLCODE = +100                                              
                 SET PS-TINVPAR-CSR-EOF                                         
                                       TO TRUE                                  
               WHEN SQLWARN0 NOT = SPACES                                       
               WHEN SQLCODE < 0                                                 
               WHEN SQLCODE > 0                                                 
                 MOVE '7051-FETCH-TINVPAR-DTL'                                  
                                       TO PV-PARAGRAPH-NAME                     
                 MOVE 'FETCH TINVPAR_CSR'                                       
                                       TO PV-DB2-OPERATION-ATTEMPTED            
                 PERFORM 9900-SQL-ABEND                                         
             END-EVALUATE                                                       
                                                                                
           END-PERFORM.                                                         
                                                                                
           IF PV-SQL-SUB > PC-MAX-RETRIES                                       
               MOVE '7051-FETCH-TINVPAR-DTL'                                    
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'MAX RETRIES EXCEEDED   '                                   
                                       TO PV-DB2-OPERATION-ATTEMPTED            
               PERFORM 9900-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * 7052-CLOSE-TINVPAR-CSR.                                                 
      ******************************************************************        
       7052-CLOSE-TINVPAR-CSR.                                                  
                                                                                
           PERFORM                                                              
             WITH TEST AFTER                                                    
             VARYING PV-SQL-SUB                                                 
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
               OR SQLCODE = 0)                                                  
      *        OR SQLCODE = -100)                                               
                                                                                
             EXEC SQL                                                           
               CLOSE TINVPAR_CSR                                                
             END-EXEC                                                           
                                                                                
             EVALUATE TRUE                                                      
               WHEN SQLCODE = 0                                                 
                 SET PS-TINVPAR-CSR-OPEN                                        
                                       TO TRUE                                  
               WHEN SQLCODE = -904                                              
                 CONTINUE                                                       
               WHEN SQLWARN0 NOT = SPACES                                       
               WHEN SQLCODE < 0                                                 
               WHEN SQLCODE > 0                                                 
                 MOVE '7052-OPEN-TINVPAR-CSR'                                   
                                       TO PV-PARAGRAPH-NAME                     
                 MOVE 'OPEN TINVPAR_CSR'                                        
                                       TO PV-DB2-OPERATION-ATTEMPTED            
                 PERFORM 9900-SQL-ABEND                                         
             END-EVALUATE                                                       
                                                                                
           END-PERFORM.                                                         
                                                                                
           IF PV-SQL-SUB > PC-MAX-RETRIES                                       
               MOVE '7052-OPEN-TINVPAR-CSR'                                     
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'MAX RETRIES EXCEEDED   '                                   
                                       TO PV-DB2-OPERATION-ATTEMPTED            
               PERFORM 9900-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * 7150-OPEN-FSOHADJ-CSR.                                                  
      ******************************************************************        
       7150-OPEN-FSOHADJ-CSR.                                                   
                                                                                
           PERFORM                                                              
             WITH TEST AFTER                                                    
             VARYING PV-SQL-SUB                                                 
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
               OR SQLCODE = 0)                                                  
                                                                                
             EXEC SQL                                                           
               OPEN FSOHADJ_CSR                                                 
             END-EXEC                                                           
                                                                                
             EVALUATE TRUE                                                      
               WHEN SQLCODE = 0                                                 
                 SET PS-FSOHADJ-CSR-OPEN                                        
                                       TO TRUE                                  
               WHEN SQLCODE = -904                                              
                 CONTINUE                                                       
               WHEN SQLWARN0 NOT = SPACES                                       
               WHEN SQLCODE < 0                                                 
               WHEN SQLCODE > 0                                                 
                 MOVE '7150-OPEN-FSOHADJ-CSR'                                   
                                       TO PV-PARAGRAPH-NAME                     
                 MOVE 'OPEN FSOHADJ_CSR'                                        
                                       TO PV-DB2-OPERATION-ATTEMPTED            
                 PERFORM 9900-SQL-ABEND                                         
             END-EVALUATE                                                       
                                                                                
           END-PERFORM.                                                         
                                                                                
           IF PV-SQL-SUB > PC-MAX-RETRIES                                       
               MOVE '7150-OPEN-FSOHADJ-CSR'                                     
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'MAX RETRIES EXCEEDED   '                                   
                                       TO PV-DB2-OPERATION-ATTEMPTED            
               PERFORM 9900-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * 7150-OPEN-FSOHADJ-CSR.                                                  
      ******************************************************************        
       7151-FETCH-FSOHADJ-DTL.                                                  
                                                                                
           PERFORM                                                              
             WITH TEST AFTER                                                    
             VARYING PV-SQL-SUB                                                 
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
               OR SQLCODE = 0                                                   
               OR SQLCODE = +100)                                               
                                                                                
             EXEC SQL                                                           
               FETCH FSOHADJ_CSR                                                
               INTO :FST00003-LOC-NBR,                                          
                    :FST00003-TRN-STAT-CDE,                                     
                    :FST00003-ADJ-QTY,                                          
                    :PV-CNT-NBR-RCDS                                            
             END-EXEC                                                           
                                                                                
             EVALUATE TRUE                                                      
               WHEN SQLCODE = -904                                              
               WHEN SQLCODE = 0                                                 
                 CONTINUE                                                       
               WHEN SQLCODE = +100                                              
                 SET PS-FSOHADJ-CSR-EOF                                         
                                       TO TRUE                                  
               WHEN SQLWARN0 NOT = SPACES                                       
               WHEN SQLCODE < 0                                                 
               WHEN SQLCODE > 0                                                 
                 SET PS-FSOHADJ-CSR-EOF                                         
                                       TO TRUE                                  
                 MOVE '7151-FETCH-FSOHADJ-DTL'                                  
                                       TO PV-PARAGRAPH-NAME                     
                 MOVE 'FETCH FSOHADJ_CSR'                                       
                                       TO PV-DB2-OPERATION-ATTEMPTED            
                 PERFORM 9900-SQL-ABEND                                         
             END-EVALUATE                                                       
                                                                                
           END-PERFORM.                                                         
                                                                                
           IF PV-SQL-SUB > PC-MAX-RETRIES                                       
               SET PS-FSOHADJ-CSR-EOF  TO TRUE                                  
               MOVE '7151-FETCH-FSOHADJ-DTL'                                    
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'MAX RETRIES EXCEEDED   '                                   
                                       TO PV-DB2-OPERATION-ATTEMPTED            
               PERFORM 9900-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * 7152-CLOSE-FSOHADJ-CSR.                                                 
      ******************************************************************        
       7152-CLOSE-FSOHADJ-CSR.                                                  
                                                                                
           PERFORM                                                              
             WITH TEST AFTER                                                    
             VARYING PV-SQL-SUB                                                 
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
               OR SQLCODE = 0)                                                  
                                                                                
             EXEC SQL                                                           
               CLOSE FSOHADJ_CSR                                                
             END-EXEC                                                           
                                                                                
             EVALUATE TRUE                                                      
               WHEN SQLCODE = 0                                                 
                 SET PS-FSOHADJ-CSR-CLOSED                                      
                                       TO TRUE                                  
               WHEN SQLCODE = -904                                              
                 CONTINUE                                                       
               WHEN SQLWARN0 NOT = SPACES                                       
               WHEN SQLCODE < 0                                                 
               WHEN SQLCODE > 0                                                 
                 MOVE '7152-CLOSE-FSOHADJ-CSR'                                  
                                       TO PV-PARAGRAPH-NAME                     
                 MOVE 'CLOSE FSOHADJ_CSR'                                       
                                       TO PV-DB2-OPERATION-ATTEMPTED            
                 PERFORM 9900-SQL-ABEND                                         
             END-EVALUATE                                                       
                                                                                
           END-PERFORM.                                                         
                                                                                
           IF PV-SQL-SUB > PC-MAX-RETRIES                                       
               MOVE '7152-CLOSE-FSOHADJ-CSR'                                    
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'MAX RETRIES EXCEEDED   '                                   
                                       TO PV-DB2-OPERATION-ATTEMPTED            
               PERFORM 9900-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * 7200-SELECT-XMT-LOC.                                                    
      ******************************************************************        
       7200-SELECT-XMT-LOC.                                                     
                                                                                
           PERFORM                                                              
             WITH TEST AFTER                                                    
             VARYING PV-SQL-SUB                                                 
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
               OR SQLCODE = 0                                                   
               OR SQLCODE = +100)                                               
                                                                                
             EXEC SQL                                                           
               SELECT LOC_NBR,                                                  
                      LOC_TYP_CDE,                                              
                      LOC_NM,                                                   
                      LOC_10_ABBR_NM                                            
               INTO :XMT00001-LOC-NBR,                                          
                    :XMT00001-LOC-TYP-CDE,                                      
                    :XMT00001-LOC-NM,                                           
                    :XMT00001-LOC-10-ABBR-NM:NI-LOC-10-ABBR-NM                  
               FROM XMT_LOC                                                     
               WHERE LOC_NBR = :XMT00001-LOC-NBR                                
               WITH UR                                                          
             END-EXEC                                                           
                                                                                
             EVALUATE TRUE                                                      
               WHEN SQLCODE = 0                                                 
                 SET PS-XMT-LOC-FND    TO TRUE                                  
               WHEN SQLCODE = +100                                              
               WHEN SQLCODE = -904                                              
                 CONTINUE                                                       
               WHEN SQLWARN0 NOT = SPACES                                       
               WHEN SQLCODE < 0                                                 
               WHEN SQLCODE > 0                                                 
                 SET PS-FSOHADJ-CSR-EOF                                         
                                       TO TRUE                                  
                 MOVE '7200-SELECT-XMT-LOC'                                     
                                       TO PV-PARAGRAPH-NAME                     
                 MOVE 'SELECT XMT_LOC' TO PV-DB2-OPERATION-ATTEMPTED            
                 PERFORM 9900-SQL-ABEND                                         
             END-EVALUATE                                                       
                                                                                
           END-PERFORM.                                                         
                                                                                
           IF PV-SQL-SUB > PC-MAX-RETRIES                                       
               MOVE '7200-SELECT-XMT-LOC'                                       
                                       TO PV-PARAGRAPH-NAME                     
               MOVE 'MAX RETRIES EXCEEDED   '                                   
                                       TO PV-DB2-OPERATION-ATTEMPTED            
               PERFORM 9900-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * 7600-SELECT-DATE-TIME.                                                  
      ******************************************************************        
       7600-SELECT-DATE-TIME.                                                   
                                                                                
           EXEC SQL                                                             
             SELECT CURRENT DATE,                                               
                    CURRENT TIME                                                
             INTO :SDT-YYYYMMDD,                                                
                   :SDT-HHMMSS                                                  
             FROM SYSIBM.SYSDUMMY1                                              
             WITH UR                                                            
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      * 7900-COMMIT-WORK.                                                       
      ******************************************************************        
730046 7900-COMMIT-WORK.                                                        
                                                                                
           EXEC SQL                                                             
               COMMIT WORK                                                      
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = +0                                                  
               CONTINUE                                                         
             WHEN OTHER                                                         
               MOVE '7900-COMMIT-WORK'                                  INKUP101
                                       TO PV-PARAGRAPH-NAME             INKUP101
               MOVE 'DB2 COMMIT'                                        INKUP101
                                       TO PV-DB2-OPERATION-ATTEMPTED            
               PERFORM 9900-SQL-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      * 7910-ROLLBACK-WORK.                                                     
      ******************************************************************        
       7910-ROLLBACK-WORK.                                                      
                                                                                
           EXEC SQL                                                             
               ROLLBACK WORK                                                    
           END-EXEC.                                                            
                                                                                
      /*****************************************************************        
      * 8000-OPEN-FILES.                                                        
      ******************************************************************        
       8000-OPEN-FILES.                                                         
                                                                                
           OPEN OUTPUT FASHION-SLS-ADJ-SUM-RPT-FILE.                            
                                                                                
      ******************************************************************        
      * 8100-WRITE-FSHN-SLS-ADJ-DTL.                                            
      ******************************************************************        
       8100-WRITE-FSHN-SLS-ADJ-DTL.                                             
                                                                                
           IF PV-LINE-NBR >= PV-MAX-LINE-NBR                                    
               PERFORM 8150-WRITE-FSHN-SLS-ADJ-HDR                              
           END-IF.                                                              
                                                                                
           WRITE FASHION-SLS-ADJ-SUM-RPT-DTL                                    
             FROM RL1-RPT-LINE-1                                                
               AFTER ADVANCING 2 LINE.                                          
           ADD +2                      TO PV-LINE-NBR.                          
                                                                                
      ******************************************************************        
      * 8110-WRITE-FSHN-SLS-ADJ-COTTL.                                          
      ******************************************************************        
       8110-WRITE-FSHN-SLS-ADJ-COTTL.                                           
                                                                                
           IF PV-LINE-NBR >= PV-MAX-LINE-NBR                                    
               PERFORM 8150-WRITE-FSHN-SLS-ADJ-HDR                              
           END-IF.                                                              
                                                                                
           WRITE FASHION-SLS-ADJ-SUM-RPT-DTL                                    
             FROM CTL1-COMPANY-TOTAL-LINE-1                                     
               AFTER ADVANCING 2 LINE.                                          
           ADD +2                      TO PV-LINE-NBR.                          
                                                                                
      ******************************************************************        
      * 8120-WRITE-FSHN-SLS-ADJ-PSTTL.                                          
      ******************************************************************        
       8120-WRITE-FSHN-SLS-ADJ-PSTTL.                                           
                                                                                
           IF PV-LINE-NBR + 5 >= PV-MAX-LINE-NBR                                
               PERFORM 8150-WRITE-FSHN-SLS-ADJ-HDR                              
               MOVE SPACE               TO FASHION-SLS-ADJ-SUM-RPT-DTL          
               WRITE FASHION-SLS-ADJ-SUM-RPT-DTL                                
                 AFTER ADVANCING 1 LINE                                         
           ELSE                                                                 
           IF PSL1-DP-HEADER                                                    
               MOVE SPACE               TO FASHION-SLS-ADJ-SUM-RPT-DTL          
               WRITE FASHION-SLS-ADJ-SUM-RPT-DTL                                
                 AFTER ADVANCING 1 LINE                                         
           END-IF                                                               
           END-IF.                                                              
                                                                                
           WRITE FASHION-SLS-ADJ-SUM-RPT-DTL                                    
             FROM PSL1-POSTING-STATUS-LINE-1                                    
               AFTER ADVANCING 1 LINE.                                          
           ADD +1                      TO PV-LINE-NBR.                          
                                                                                
      ******************************************************************        
      * 8150-WRITE-FSHN-SLS-ADJ-HDR.                                            
      ******************************************************************        
       8150-WRITE-FSHN-SLS-ADJ-HDR.                                             
                                                                                
           ADD +1                      TO PV-PAGE-NBR.                          
           MOVE PV-PAGE-NBR            TO DP132O-PAGE-NUMBER.                   
                                                                                
           WRITE FASHION-SLS-ADJ-SUM-RPT-DTL                                    
             FROM DP132O-STANDRD-HEADER-132-COLS                                
               AFTER ADVANCING PAGE.                                            
                                                                                
           WRITE FASHION-SLS-ADJ-SUM-RPT-DTL                                    
             FROM HL1-HEADING-LINE-1                                            
               AFTER ADVANCING 1 LINE.                                          
                                                                                
           WRITE FASHION-SLS-ADJ-SUM-RPT-DTL                                    
             FROM HL2-HEADING-LINE-2                                            
               AFTER ADVANCING 1 LINE.                                          
                                                                                
           WRITE FASHION-SLS-ADJ-SUM-RPT-DTL                                    
             FROM SHL1-SUB-HEADING-LINE-1                                       
               AFTER ADVANCING 2 LINE.                                          
                                                                                
           WRITE FASHION-SLS-ADJ-SUM-RPT-DTL                                    
             FROM SHL2-SUB-HEADING-LINE-2                                       
               AFTER ADVANCING 1 LINE.                                          
                                                                                
           WRITE FASHION-SLS-ADJ-SUM-RPT-DTL                                    
             FROM SHL3-SUB-HEADING-LINE-3                                       
               AFTER ADVANCING 1 LINE.                                          
                                                                                
           WRITE FASHION-SLS-ADJ-SUM-RPT-DTL                                    
             FROM SHL4-SUB-HEADING-LINE-4                                       
               AFTER ADVANCING 1 LINE.                                          
                                                                                
           MOVE +8                     TO PV-LINE-NBR.                          
                                                                                
      ******************************************************************        
      * 8900-CLOSE-FILES.                                                       
      ******************************************************************        
       8900-CLOSE-FILES.                                                        
                                                                                
W26600     DISPLAY '* END ********************'.                                
W26600                                                                          
           CLOSE FASHION-SLS-ADJ-SUM-RPT-FILE.                                  
                                                                                
      ******************************************************************        
      * PERFORMS THE ABEND FOR THE PROGRAM IN THE                               
      * EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                         
      ******************************************************************        
       9900-SQL-ABEND.                                                          
                                                                                
           DISPLAY '** ABEND     **'.                                           
           DISPLAY '** PROGRAM   ** = INKUP131'.                                
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.                      
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.             
                                                                                
      ******************************************************************        
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-            
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE                 
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE             
      * FORMAT.                                                                 
      ******************************************************************        
           COPY DPPD004.                                                        
                                                                                
           IF SQLCODE NOT = -911                                                
W26600         PERFORM 7910-ROLLBACK-WORK                                       
           END-IF.                                                              
                                                                                
           MOVE +4013                  TO ABEND-CODE.                           
           CALL 'ILBOABN0'             USING ABEND-CODE.                        
                                                                                
