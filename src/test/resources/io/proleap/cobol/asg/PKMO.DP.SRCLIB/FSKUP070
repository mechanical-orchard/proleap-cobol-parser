000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400*                                                                 00040000
000500 PROGRAM-ID.    FSKUP070.                                         00050000
000600 AUTHOR.        KRISTIN PETERSON.                                 00060000
000700 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00070000
000800 DATE-WRITTEN.  02-14-2003.                                       00080000
000900 DATE-COMPILED.                                                   00090000
001000*                                                                 00100000
001100******************************************************************00110000
001200*       FSKUP070 - ON-HAND INVENTORY UPDATE                       00120000
001300******************************************************************00130000
001400*                                                                 00140000
001500*   THIS PROGRAM UPDATES ON-HANDS FOR ADJUSTMENTS, RECEIPTS,      00150000
001600*   AND SALES.  THE EDITED TRANSACTIONS ARE RETRIEVED FROM        00160000
001700*   SEPARATE WORK TABLES.                                         00170000
001800*                                                                 00180000
001900*   INPUT FILES:    NONE                                          00190000
002000*                                                                 00200000
002100*   OUTPUT FILES:   NONE                                          00210000
002200*                                                                 00220000
002300*   I/O:   FSTT_OH_ADJ_AUD    DB2 TABLE   SELECT/UPDATE           00230000
002400*          FSTT_OH_RCPT_AUD   DB2 TABLE   SELECT/UPDATE           00240000
002500*          FSTT_OH_SLS_AUD    DB2 TABLE   SELECT/UPDATE           00250000
002600*          TSKST              DB2 TABLE   SELECT/UPDATE/INSERT    00260000
002700*                                                                 00270000
002800*   GENERAL LOGIC DESCRIPTION:                                    00280000
002900*                                                                 00290000
003000*   THIS PROGRAM RETRIEVES EDITED TRANSACTIONS FROM THE           00300000
003100*   ADJUSTMENT, RECEIPT, AND SALES AUDIT TABLES AND UPDATES       00310000
003200*   ON-HAND ON TSKST.  ONCE THE TRANSACTION HAS BEEN APPLIED,     00320000
003300*   THE TRANSACTION STATUS CODE ON THE AUDIT TABLE IS UPDATED     00330000
003400*   TO 'C' (COMPLETE).                                            00340000
003500*                                                                 00350000
003600******************************************************************00360000
003700*  CHANGE LOG:                                                    00370000
003800*                                                                 00380000
003900*  02/14/03 - KRISTIN PETERSON                                    00390000
004000*             (WR #23946) NEW PROGRAM FOR NIS CORE UPDATES -      00400000
004100*             CONVERGENCE PROJECT.  THIS PROGRAM PERFORMS ALL     00410000
004200*             ON-HAND UPDATES FOR ADJUSTMENTS, RECEIPTS, AND      00420000
004300*             SALES.                                              00430000
004400*                                                                 00440000
004500*  04/26/04 - MARIA KLAMIK                                        00450000
004600*             (WR #26355) STORE NUMBER EXPANSION PROJECT -        00460000
004700*             A 5 DIGIT (SMALLINT) LOCATION NUMBER (LOC_NBR) AND  00470000
004800*             LAST UPDATED TIMESTAMP (LAST_UPD_TMST) ADDED TO TSKS00480000
004900*             REMOVE PROCESSING/REFERENCES OF CUTOFF ON-HAND AND P00490000
005000*             FLUSH RECEIPTS.  REMOVE ALL REFERENCES TO           00500000
005100*             TINVPAR(INVENTORY PARMS)                            00510000
005200*             TKRPRPM(RETEK - MANIFESTING)                        00520000
005300*             TSTR000(STORE).                                     00530000
005400*             CHANGE TO HAVE RECEIPTS PROCESS PRIOR TO THE        00540000
005500*             ADJUSTMENTS.                                        00550000
005600*                                                                 00560000
005700*  08/30/04 - MARIA KLAMIK                                        00570000
005800*             (WR #27494) CHANGE TO DISPLAY TIMESTAMP AFTER       00580000
005900*             EACH AUDIT TABLE HAS COMPLETED PROCESSING.          00590000
005910*  06/15/05 - JIM LEIKNESS                                        00600000
005920*             (WR #25984) CHANGE TO REMOVE REFERENCES TO          00610000
005930*             STORE_NMBR COLUMN ON TSKST TABLE.                   00620000
PE5823*  06/17/11 - LALITHA (COGNIZANT)                                 00630000
PE5823*             CHANGED THE PROGRAM FOR NOT RETRYING THE READ/UPDATE00640000
PE5823*             /INSERT DB2 OPERATION WHEN CONTENTION OCCURS I.E.   00650000
PE5823*             FOR SQLCODE OF -911                                 00660000
PE7819*  06/18/11 - LALITHA (COGNIZANT)                                 00670000
PE7819*           1.CHANGED TO HANDLE THE SCENARIO WHEN                 00680000
PE7819*             IMK025 RUNS PARALLELY AND DELETES THE SAME SKU      00690000
PE7819*             PROCESSED BY FSKUP070                               00700000
PE7819*           2.YTD FIELDS WILL NO LONGER BE PROCESSED. VALUE '0'   00710000
PE7819*             WILL BE UPDATED FOR ALL THE STORE '0' RECORDS       00720000
PE9054*  09/14/11 - COGNIZANT                                           00730000
PE9054*             REVERTING BACK THE CHANGES TO YTD FIELDS AS THE     00740000
PE9054*             BUSINESS USERS NEED TO REFER THESE FIELDS           00750000
OCFSFS*  08/27/13 - RACHEL GRAMANN                                      00760000
OCFSFS*             OCF SHIP FROM STORE PROJECT TO FEED MERCHANDISE     00770000
OCFSFS*             CHANGES TO FASHION SALES                            00780000
P43627*  10/02/13 - COGNIZANT                                           00790004
P43627*             1.MODIFIED OH_ADJ_CSR,OH_RCPT_CSR & OH_SLS_CSR      00800004
P43627*             TO USE THE ITEM NUMBER RANGE FROM THE INPUT FILE    00810004
P43627*             AS A PART OF FSK028 MULTI THREADING.                00820004
P43627*             2.MODIFIED THE PROGRAM TO USE THE JOB NAME FOR      00830004
P43627*             CHECKPOINT RESTART TABLE FROM THE CONTROL CARD      00840004
P43627*             INSTAED OF CONSTANT FSK028.                         00850004
111890*--------------------------------------------------------------*  00860006
111890* 05/21/2015 CHANGED BY:  JIM HUNTER        CHG0111890            00870006
111890* DESCRIPTION: CHANGED FOR RFID PROJECT.  RFID COUNTS WILL NOW    00880006
111890*              PASS 'RFID' IN THE BATCH NUMBER.  USA COUNTS       00890006
111890*              WILL CONTINUE TO PASS '9988' IN THE BATCH NUMBER.  00900006
111890*              THIS WILL ALLOW THE FASHION PROGRAMS TO            00910006
111890*              DISTINGUISH RFID COUNTS FROM USA COUNTS ON THE     00920006
111890*              FASHION REPORTS.                                   00930006
GIV2FS*  10/16/17 - JIM HUNTER   CHG0180589 (FIND GIV2FS)               00940008
GIV2FS*             CHANGED TO ALLOW FASHION TO ACCEPT UPDATES FROM GIV.00950007
GIV2FS*             GIV ADJUSTMENTS WILL BE DISTINGUISHED FROM OTHER    00960007
GIV2FS*             ADJUSTMENTS BY THE BATCH NUMBER WHICH WILL CONTAIN  00970007
GIV2FS*             'GIV'.                                              00980007
RONNA *  03/07/2019 RONNA MCDONALD - PRB0073247 - FIX BOSS RECEIPTS     00981009
RONNA *                              AND RECEIPTS FROM SO THAT          00982009
RONNA *                              THE FIRST AND LAST RECEIPT         00983009
RONNA *                              DATES DO NOT GET UPDATED           00984009
262959*  10/01/2021 SRINIVASAN SIVARAJ                                  00981009
262959*             CHANGED THE PROGRAM LOGIC TO ALLOW THE ON HAND TO   00982009
262959*             GO NEGATIVE FOR ADJUSTMENTS WITH BATCH 888 AND      00983009
262959*             ADJ TYP CODE 121 WHEN THERE IS NO ROW FOR THE       00984009
262959*             STORE,SO THAT NEW ADJUSTMENT ROW WILL NE INSERTED IN00984009
262959*             TSKST TABLE.                                        00984009
005940******************************************************************00990000
005950 ENVIRONMENT DIVISION.                                            01000000
005960******************************************************************01010000
005970*                                                                 01020000
005980 CONFIGURATION SECTION.                                           01030000
005990 SOURCE-COMPUTER.  IBM-3090.                                      01040000
006000 OBJECT-COMPUTER.  IBM-3090.                                      01050000
006100                                                                  01060000
006200 INPUT-OUTPUT SECTION.                                            01070000
006300                                                                  01080000
006400 FILE-CONTROL.                                                    01090000
006500                                                                  01100000
006600     SELECT CONTROL-CARD-FILE                                     01110000
006700         ASSIGN TO INP01.                                         01120000
P43627     SELECT INPUT-RANGE-FILE                                      01130000
P43627         ASSIGN TO INP02.                                         01140000
006800                                                                  01150000
006900******************************************************************01160000
007000 DATA DIVISION.                                                   01170000
007100******************************************************************01180000
007200                                                                  01190000
007300 FILE SECTION.                                                    01200000
007400                                                                  01210000
007500 FD  CONTROL-CARD-FILE                                            01220000
007600     RECORDING MODE IS F                                          01230000
007700     LABEL RECORDS ARE STANDARD                                   01240000
007800     RECORD CONTAINS 80 CHARACTERS                                01250000
007900     BLOCK CONTAINS 0 RECORDS.                                    01260000
008000                                                                  01270000
008100 01  CC-CONTROL-CARD-RECORD        PIC X(80).                     01280000
008200                                                                  01290000
P43627                                                                  01300000
P43627 FD  INPUT-RANGE-FILE                                             01310000
P43627     RECORDING MODE IS F                                          01320000
P43627     LABEL RECORDS ARE STANDARD                                   01330000
P43627     RECORD CONTAINS 16 CHARACTERS                                01340000
P43627     BLOCK CONTAINS 0 RECORDS.                                    01350000
P43627                                                                  01360000
P43627 01  INPUT-RANGE-FILE-RECORD        PIC X(16).                    01370000
P43627                                                                  01380002
008400 WORKING-STORAGE SECTION.                                         01390000
008500                                                                  01400000
008600 01  ABEND-CODE                    PIC S9(04)    VALUE ZERO       01410000
008700                                                 COMP             01420000
008800                                                 SYNC.            01430000
008900                                                                  01440000
009000* WORKING-STORAGE FOR FORMATTING DB2 ERROR MESSAGES               01450000
009100                                                                  01460000
009200     COPY DPWS004.                                                01470000
009300                                                                  01480000
009400* WORKING-STORAGE FOR CALENDAR ROUTINE                            01490000
009500                                                                  01500000
009600     COPY DPWS500.                                                01510000
009700                                                                  01520000
009800* CONTROL CARD FILE LAYOUT.                                       01530000
009900                                                                  01540000
010000 01  CC-CONTROL-CARD.                                             01550000
010100     05  CC-PROCESS-DATE           PIC X(10).                     01560000
P43627     05  FILLER                    PIC X(01).                     01570000
P43627     05  CC-JOB-NAME               PIC X(07).                     01580000
P43627     05  FILLER                    PIC X(62).                     01590000
010300                                                                  01600000
P43627 01  PV-INPUT-ITEM-RANGE-REC.                                     01610000
P43627     05  PV-ITEM-RANGE-LOWER       PIC S9(15)V COMP-3.            01620000
P43627     05  PV-ITEM-RANGE-HIGHER      PIC S9(15)V COMP-3.            01630000
P43627                                                                  01640000
010400 01  PC-PROGRAM-CONSTANTS.                                        01650000
010500     05  PC-PROGRAM-NAME           PIC X(08)     VALUE 'FSKUP070'.01660000
P43627*    05  PC-JOB-NAME               PIC X(08)     VALUE 'FSK028  '.01670001
010700     05  PC-MAX-RETRY-CNT          PIC S9(04)    VALUE  3         01680000
010800                                                 COMP SYNC.       01690000
010900     05  PC-MORE-THAN-MAX-RETRY    PIC S9(04)    VALUE  4         01700000
011000                                                 COMP SYNC.       01710000
011100                                                                  01720000
011200     05  PC-ADJ-ACTN-CODES.                                       01730000
011300         10  PC-ACTN-REPLACE       PIC X(01)     VALUE 'R'.       01740000
011400         10  PC-ACTN-ADD           PIC X(01)     VALUE '+'.       01750000
011500         10  PC-ACTN-SUBTRACT      PIC X(01)     VALUE '-'.       01760000
011600                                                                  01770000
011700     05  PC-INV-BATCH-NBRS.                                       01780000
011800         10  PC-MSI-BATCH-NMBR     PIC X(04)     VALUE '9988'.    01790000
011900         10  PC-INV-BATCH-NMBR     PIC X(04)     VALUE '9999'.    01800000
012000         10  PC-INV-ADJ-BATCH-NMBR PIC X(04)     VALUE 'INAD'.    01810000
OCFSFS         10  PC-SFS-ADJ-BATCH-NMBR PIC X(04)     VALUE 'SFS '.    01820000
111890         10  PC-RFID-BATCH-NMBR    PIC X(04)     VALUE 'RFID'.    01830006
GIV2FS         10  PC-GIV-BATCH-NMBR     PIC X(04)     VALUE 'GIV '.    01840007
262959         10  PC-PX-BATCH-NMBR      PIC X(04)     VALUE ' 888'.    01840007
262959         10  PC-PE-BATCH-NMBR      PIC X(04)     VALUE '888 '.    01840007
012100                                                                  01850000
012200     05  PC-ADJ-TYP.                                              01860000
012300         10  PC-OH-ADJ             PIC X(03)     VALUE '121'.     01870000
012400         10  PC-RCPT-ADJ           PIC X(03)     VALUE '123'.     01880000
OCFSFS         10  PC-SFS-ADJ            PIC X(03)     VALUE '125'.     01890000
OCFSFS         10  PC-SFS-SALES-ADJ      PIC X(03)     VALUE '126'.     01900000
012500         10  PC-OH-ADJ-ONLY        PIC X(03)     VALUE '143'.     01910000
012600                                                                  01920000
012700 01  CR-CHECKPOINT-RESTART-AREA.                                  01930000
012800     05  CR-AREA-LEN               PIC S9(04)    VALUE +87  COMP. 01940000
012900                                                                  01950000
013000     05  CR-CHECKPOINT-RESTART-VAR.                               01960000
013100         10  CR-OH-ADJ-FETCH-CNT   PIC S9(09)    VALUE +0 COMP-3. 01970000
013200         10  CR-OH-RCPT-FETCH-CNT  PIC S9(09)    VALUE +0 COMP-3. 01980000
RONNA          10  CR-OH-RCPT2-FETCH-CNT PIC S9(09)    VALUE +0 COMP-3. 01981010
013300         10  CR-OH-SLS-FETCH-CNT   PIC S9(09)    VALUE +0 COMP-3. 01990000
013400         10  CR-TSKST-READ-CNT     PIC S9(09)    VALUE +0 COMP-3. 02000000
013500         10  CR-TOT-TSKST-READ-CNT PIC S9(09)    VALUE +0 COMP-3. 02010000
013600         10  CR-LOC-TSKST-UPDT-CNT PIC S9(09)    VALUE +0 COMP-3. 02020000
013700         10  CR-000-TSKST-UPDT-CNT PIC S9(09)    VALUE +0 COMP-3. 02030000
013800         10  CR-TOT-LOC-TSKST-UPDT-CNT                            02040000
013900                                   PIC S9(09)    VALUE +0 COMP-3. 02050000
014000         10  CR-TOT-000-TSKST-UPDT-CNT                            02060000
014100                                   PIC S9(09)    VALUE +0 COMP-3. 02070000
014200         10  CR-TSKST-ISRT-CNT     PIC S9(09)    VALUE +0 COMP-3. 02080000
014300         10  CR-TOT-TSKST-ISRT-CNT PIC S9(09)    VALUE +0 COMP-3. 02090000
014400         10  CR-OH-ADJ-UPDT-C-CNT  PIC S9(09)    VALUE +0 COMP-3. 02100000
014500         10  CR-OH-ADJ-UPDT-E-CNT  PIC S9(09)    VALUE +0 COMP-3. 02110000
014600         10  CR-OH-RCPT-UPDT-C-CNT PIC S9(09)    VALUE +0 COMP-3. 02120000
RONNA          10  CR-OH-RCPT2-UPDT-C-CNT                               02121015
RONNA                                    PIC S9(09)    VALUE +0 COMP-3. 02122015
014700         10  CR-OH-SLS-UPDT-C-CNT  PIC S9(09)    VALUE +0 COMP-3. 02130000
014800         10  CR-TOT-SLS-AMT        PIC S9(11)V99 VALUE +0 COMP-3. 02140000
014900         10  CR-COMMIT-CNT         PIC S9(09)    VALUE +0 COMP-3. 02150000
015000                                                                  02160000
015100 01  WS-OH-TBL-SUMMED-VALUES.                                     02170000
015200     05  WS-MIN-VRFD-DTE           PIC  X(10)    VALUE SPACES.    02180000
015300     05  WS-MAX-VRFD-DTE           PIC  X(10)    VALUE SPACES.    02190000
015400     05  WS-MIN-SALE-DTE           PIC  X(10)    VALUE SPACES.    02200000
015500     05  WS-MAX-SALE-DTE           PIC  X(10)    VALUE SPACES.    02210000
015600     05  WS-SUM-LOC-RCPT-QTY       PIC S9(09)    VALUE +0 COMP-3. 02220000
015700     05  WS-SUM-TOT-SLD-QTY        PIC S9(09)    VALUE +0 COMP-3. 02230000
015800     05  WS-SUM-TOT-CHRGD-AMT      PIC S9(9)V99  VALUE +0 COMP-3. 02240000
015900                                                                  02250000
016000 01  PS-PROGRAM-SWITCHES.                                         02260000
016100     05  PS-ADJ-CSR-SW             PIC X(01)     VALUE 'Y'.       02270000
016200         88  PS-ADJ-CSR-START                    VALUE 'Y'.       02280000
016300         88  PS-ADJ-CSR-END                      VALUE 'N'.       02290000
016400     05  PS-RCPT-CSR-SW            PIC X(01)     VALUE 'Y'.       02300000
016500         88  PS-RCPT-CSR-START                   VALUE 'Y'.       02310000
016600         88  PS-RCPT-CSR-END                     VALUE 'N'.       02320000
RONNA      05  PS-RCPT2-CSR-SW           PIC X(01)     VALUE 'Y'.       02321013
RONNA          88  PS-RCPT2-CSR-START                  VALUE 'Y'.       02322013
RONNA          88  PS-RCPT2-CSR-END                    VALUE 'N'.       02323013
016700     05  PS-SLS-CSR-SW             PIC X(01)     VALUE 'Y'.       02330000
016800         88  PS-SLS-CSR-START                    VALUE 'Y'.       02340000
016900         88  PS-SLS-CSR-END                      VALUE 'N'.       02350000
017000     05  PS-FIRST-COMMIT-SW        PIC X(01)     VALUE 'N'.       02360000
017100         88  PS-FIRST-COMMIT                     VALUE 'Y'.       02370000
017200     05  PS-ADJ-TRAN-ERROR-SW      PIC X(01)     VALUE 'N'.       02380000
017300         88  PS-NO-ADJ-ERROR                     VALUE 'N'.       02390000
017400         88  PS-ADJ-TRAN-ERROR                   VALUE 'Y'.       02400000
PE7819     05  PS-DELETE-TSKST-ITM-SW    PIC X(01)     VALUE 'N'.       02410000
PE7819         88  PS-DELETE-TSKST-ITM                 VALUE 'Y'.       02420000
PE7819     05  PS-ITM-IN-TSKXREF-SW      PIC X(01)     VALUE 'N'.       02430000
PE7819         88  PS-ITM-NOT-IN-TSKXREF               VALUE 'N'.       02440000
PE7819         88  PS-ITM-IN-TSKXREF                   VALUE 'Y'.       02450000
P43627     05  PS-RANGE-FILE-SW          PIC X(01)     VALUE 'N'.       02460000
P43627         88  PS-END-OF-RANGE-FILE                VALUE 'Y'.       02470000
017500                                                                  02480000
017600 01  PV-PROGRAM-VARIABLES.                                        02490000
017700     05  PV-PARAGRAPH-NAME         PIC X(30)     VALUE SPACES.    02500000
017800     05  PV-DB2-OPERATION-ATTEMPTED                               02510000
017900                                   PIC X(30)     VALUE SPACES.    02520000
018000     05  PV-COMMIT-TIMESTAMP       PIC X(26)     VALUE SPACES.    02530000
018100     05  PV-CURRENT-TIMESTAMP      PIC X(26)     VALUE SPACES.    02540000
018200     05  PV-RETRY-CNT              PIC S9(04)    VALUE +0.        02550000
018300     05  PV-ONHAND-QTY             PIC S9(07)V   VALUE +0 COMP-3. 02560000
018400     05  PV-PREV-ITM-NBR           PIC S9(15)V   VALUE +0 COMP-3. 02570000
PE7819     05  PV-ITEM-NBR-HOLD          PIC S9(15)V   VALUE +0 COMP-3. 02580000
018500     05  PV-ITEM-TOT-RCPT-QTY      PIC S9(11)    VALUE +0 COMP-3. 02590000
018600     05  PV-ITEM-TOT-SLD-QTY       PIC S9(11)    VALUE +0 COMP-3. 02600000
018700     05  PV-ITEM-TOT-CHRGD-AMT     PIC S9(11)V99 VALUE +0 COMP-3. 02610000
018800     05  PV-FIRST-RCVD-DATE        PIC X(10)     VALUE SPACES.    02620000
018900     05  PV-LAST-RCVD-DATE         PIC X(10)     VALUE SPACES.    02630000
019000     05  PV-FIRST-SALE-DATE        PIC X(10)     VALUE SPACES.    02640000
019100     05  PV-LAST-SALE-DATE         PIC X(10)     VALUE SPACES.    02650000
019200                                                                  02660000
019300     05  PV-PROCESS-DATE.                                         02670000
019400         10  PV-PROCESS-YEAR       PIC X(04)     VALUE SPACES.    02680000
019500         10  FILLER                PIC X(01)     VALUE '-'.       02690000
019600         10  PV-PROCESS-MONTH      PIC X(02)     VALUE SPACES.    02700000
019700         10  FILLER                PIC X(01)     VALUE '-'.       02710000
019800         10  PV-PROCESS-DAY        PIC X(02)     VALUE SPACES.    02720000
019900                                                                  02730000
020000     05  PV-PROCESS-DATE-10        PIC X(10)     VALUE SPACES.    02740000
020100                                                                  02750000
020200**** TSKST DATE FORMAT                                            02760000
020300     05  PV-TSKST-DATE.                                           02770000
020400         10  PV-TSKST-DATE-YYMMDD  PIC 9(06)     VALUE ZERO.      02780000
020500         10  FILLER   REDEFINES                                   02790000
020600             PV-TSKST-DATE-YYMMDD.                                02800000
020700             15  PV-TSKST-DATE-YY  PIC 9(02).                     02810000
020800             15  PV-TSKST-DATE-MM  PIC 9(02).                     02820000
020900             15  PV-TSKST-DATE-DD  PIC 9(02).                     02830000
021000                                                                  02840000
021100**** HOLDS TSKST DATE CONVERTED TO STANDARD DB2 DATE FORMAT       02850000
021200     05  PV-TSKST-CONVERTED-DATE.                                 02860000
021300         10  PV-TSKST-DATE-X10.                                   02870000
021400             15  PV-TSKST-X10-CC   PIC X(02)     VALUE SPACES.    02880000
021500             15  PV-TSKST-X10-YY   PIC X(02)     VALUE SPACES.    02890000
021600             15  FILLER            PIC X(01)     VALUE '-'.       02900000
021700             15  PV-TSKST-X10-MM   PIC X(02)     VALUE SPACES.    02910000
021800             15  FILLER            PIC X(01)     VALUE '-'.       02920000
021900             15  PV-TSKST-X10-DD   PIC X(02)     VALUE SPACES.    02930000
022000                                                                  02940000
022100     05  PV-ADJ-ACTN-CDE           PIC X(01)     VALUE SPACES.    02950000
022200         88  PV-ACTN-REPLACE                     VALUE  'R'.      02960000
022300         88  PV-ACTN-ADD                         VALUE  '+'.      02970000
022400         88  PV-ACTN-SUBTRACT                    VALUE  '-'.      02980000
022500                                                                  02990000
023200******************************************************************03000000
023300*  FORMATTED FIELDS FOR END OF JOB DISPLAY COUNTS                 03010000
023400******************************************************************03020000
023500     05  PV-DISPLAY-COUNT         PIC ZZZ,ZZZ,ZZ9                 03030000
023600                                                 VALUE ZEROES.    03040000
023700     05  PV-DISPLAY-COUNT-11      PIC $$,$$$,$$$,$$9.99           03050000
023800                                                 VALUE ZEROES.    03060000
023900                                                                  03070000
024000******************************************************************03080000
024100*  DCLGEN MEMBER FOR TABLE FSTT_OH_ADJ_AUD                        03090000
024200*  (FASHION SALES ON-HAND ADJUSTMENT AUDIT WORK TABLE)            03100000
024300******************************************************************03110000
024400     EXEC SQL                                                     03120000
024500         INCLUDE FST00003                                         03130000
024600     END-EXEC.                                                    03140000
024700                                                                  03150000
024800******************************************************************03160000
024900*  DCLGEN MEMBER FOR TABLE FSTT_OH_RCPT_AUD                       03170000
025000*  (FASHION SALES ON-HAND RECEIPT AUDIT WORK TABLE)               03180000
025100******************************************************************03190000
025200     EXEC SQL                                                     03200000
025300         INCLUDE FST00004                                         03210000
025400     END-EXEC.                                                    03220000
025500                                                                  03230000
025600******************************************************************03240000
025700*  DCLGEN MEMBER FOR TABLE FSTT_OH_SLS_AUD                        03250000
025800*  (FASHION SALES ON-HAND SALES AUDIT WORK TABLE)                 03260000
025900******************************************************************03270000
026000     EXEC SQL                                                     03280000
026100         INCLUDE FST00005                                         03290000
026200     END-EXEC.                                                    03300000
026300                                                                  03310000
026400******************************************************************03320000
026500*  DCLGEN MEMBER FOR TABLE TSKST                                  03330000
026600******************************************************************03340000
026700     EXEC SQL                                                     03350000
026800         INCLUDE TSKST                                            03360000
026900     END-EXEC.                                                    03370000
027000                                                                  03380000
PE7819******************************************************************03390000
PE7819*  DCLGEN MEMBER FOR TABLE TSKXREF                                03400000
PE7819******************************************************************03410000
PE7819     EXEC SQL                                                     03420000
PE7819         INCLUDE TSKXREF                                          03430000
PE7819     END-EXEC.                                                    03440000
PE7819                                                                  03450000
027100******************************************************************03460000
027200*  DCLGEN FOR CHECKPOINT RESTART CONTROL TABLE                    03470000
027300******************************************************************03480000
027400     EXEC SQL                                                     03490000
027500         INCLUDE TCKRSTCN                                         03500000
027600     END-EXEC.                                                    03510000
027700                                                                  03520000
027800******************************************************************03530000
027900*  DCLGEN FOR CHECKPOINT RESTART INFORMATION TABLE                03540000
028000******************************************************************03550000
028100     EXEC SQL                                                     03560000
028200         INCLUDE TCKRSTIN                                         03570000
028300     END-EXEC.                                                    03580000
028400                                                                  03590000
028500******************************************************************03600000
028600*  COMMUNICATIONS AREA FOR DB2                                    03610000
028700******************************************************************03620000
028800     EXEC SQL                                                     03630000
028900         INCLUDE SQLCA                                            03640000
029000     END-EXEC.                                                    03650000
029100                                                                  03660000
029200******************************************************************03670000
029300*  SQL ERROR AREA                                                 03680000
029400******************************************************************03690000
029500     COPY SQLCA2.                                                 03700000
029600                                                                  03710000
029700******************************************************************03720000
029800*  CURSOR TO RETRIEVE ADJUSTMENT TRANSACTIONS FROM THE            03730000
029900*  ON-HAND ADJUSTMENT AUDIT TABLE                                 03740000
030000******************************************************************03750000
030100     EXEC SQL                                                     03760000
030200                                                                  03770000
030300     DECLARE OH_ADJ_CSR CURSOR WITH HOLD FOR                      03780000
030400                                                                  03790000
030500         SELECT ITM_NBR                                           03800000
030600              , LOC_NBR                                           03810000
030700              , ADJ_TYP_CDE                                       03820000
030800              , ACTN_CDE                                          03830000
030900              , ADJ_QTY                                           03840000
031000              , BTCH_NBR                                          03850000
031100              , UNT_BKG_CDE                                       03860000
031200              , CRE_TMST                                          03870000
031300           FROM FSTT_OH_ADJ_AUD                                   03880000
031400          WHERE PRCG_DTE = :PV-PROCESS-DATE-10                    03890000
031500            AND TRN_STAT_CDE = 'A'                                03900000
P43627            AND ITM_NBR BETWEEN :PV-ITEM-RANGE-LOWER              03910000
P43627                            AND :PV-ITEM-RANGE-HIGHER             03920001
031600       ORDER BY ITM_NBR                                           03930000
031700              , LOC_NBR                                           03940000
031800                                                                  03950000
031900     END-EXEC.                                                    03960000
032000                                                                  03970000
032100******************************************************************03980000
032200*  CURSOR TO RETRIEVE RECEIPT TRANSACTIONS FROM THE ON-HAND       03990000
032300*  RECEIPT AUDIT TABLE                                            04000000
RONNA *  CHANGE THE CURSOR TO ONLY INCLUDE RECEIPTS WHERE THE           04001009
RONNA *  RECEIPT DATES NEED TO BE UPDATED                               04002009
032400******************************************************************04010000
032500     EXEC SQL                                                     04020000
032600                                                                  04030000
032700     DECLARE OH_RCPT_CSR CURSOR WITH HOLD FOR                     04040000
032800                                                                  04050000
032900         SELECT ITM_NBR                                           04060000
033000              , LOC_NBR                                           04070000
033100              , MIN(VRFD_DTE)     AS MIN_VRFD_DTE                 04080000
033200              , MAX(VRFD_DTE)     AS MAX_VRFD_DTE                 04090000
033300              , SUM(LOC_RCPT_QTY) AS RCPT_QTY                     04100000
033400           FROM FSTT_OH_RCPT_AUD                                  04110000
033500          WHERE PRCG_DTE = :PV-PROCESS-DATE-10                    04120000
033600            AND TRN_STAT_CDE = 'A'                                04130000
P43627            AND ITM_NBR BETWEEN :PV-ITEM-RANGE-LOWER              04140000
P43627                            AND :PV-ITEM-RANGE-HIGHER             04150001
RONNA             AND SRC_PGM_NM NOT IN ('GVKUT015')                    04151010
033700       GROUP BY ITM_NBR                                           04160000
033800              , LOC_NBR                                           04170000
033900       ORDER BY ITM_NBR                                           04180000
034000              , LOC_NBR                                           04190000
034100                                                                  04200000
034200     END-EXEC.                                                    04210000
034300                                                                  04220000
RONNA ******************************************************************04221009
RONNA *  CURSOR TO RETRIEVE RECEIPT TRANSACTIONS FROM THE ON-HAND       04222009
RONNA *  RECEIPT AUDIT TABLE FOR TRANSACTIONS WHERE THE RECEIPT DATES   04223009
RONNA *  DO NOT GET UPDATED                                             04223109
RONNA ******************************************************************04224009
RONNA      EXEC SQL                                                     04225009
RONNA                                                                   04226009
RONNA      DECLARE OH_RCPT2_CSR CURSOR WITH HOLD FOR                    04227010
RONNA                                                                   04228009
RONNA          SELECT ITM_NBR                                           04229009
RONNA               , LOC_NBR                                           04229109
RONNA               , MIN(VRFD_DTE)     AS MIN_VRFD_DTE                 04229209
RONNA               , MAX(VRFD_DTE)     AS MAX_VRFD_DTE                 04229309
RONNA               , SUM(LOC_RCPT_QTY) AS RCPT_QTY                     04229409
RONNA            FROM FSTT_OH_RCPT_AUD                                  04229509
RONNA           WHERE PRCG_DTE = :PV-PROCESS-DATE-10                    04229609
RONNA             AND TRN_STAT_CDE = 'A'                                04229709
RONNA             AND ITM_NBR BETWEEN :PV-ITEM-RANGE-LOWER              04229809
RONNA                             AND :PV-ITEM-RANGE-HIGHER             04229909
RONNA             AND SRC_PGM_NM IN ('GVKUT015')                        04230010
RONNA        GROUP BY ITM_NBR                                           04230109
RONNA               , LOC_NBR                                           04230209
RONNA        ORDER BY ITM_NBR                                           04230309
RONNA               , LOC_NBR                                           04230409
RONNA                                                                   04230509
RONNA      END-EXEC.                                                    04230609
RONNA                                                                   04230709
034400******************************************************************04231000
034500*  CURSOR TO RETRIEVE SALES TRANSACTIONS FROM THE ON-HAND         04240000
034600*  SALES AUDIT TABLE                                              04250000
034700******************************************************************04260000
034800     EXEC SQL                                                     04270000
034900                                                                  04280000
035000     DECLARE OH_SLS_CSR CURSOR WITH HOLD FOR                      04290000
035100                                                                  04300000
035200         SELECT ITM_NBR                                           04310000
035300              , LOC_NBR                                           04320000
035400              , MIN(SLS_DTE)       AS MIN_SLS_DTE                 04330000
035500              , MAX(SLS_DTE)       AS MAX_SLS_DTE                 04340000
035600              , SUM(SLD_QTY)       AS TOT_SLD_QTY                 04350000
035700              , SUM(NET_CHRGD_AMT) AS TOT_CHRGD_AMT               04360000
035800           FROM FSTT_OH_SLS_AUD                                   04370000
035900          WHERE PRCG_DTE = :PV-PROCESS-DATE-10                    04380000
036000            AND TRN_STAT_CDE = 'A'                                04390000
P43627            AND ITM_NBR BETWEEN :PV-ITEM-RANGE-LOWER              04400000
P43627                            AND :PV-ITEM-RANGE-HIGHER             04410001
036100       GROUP BY ITM_NBR                                           04420000
036200              , LOC_NBR                                           04430000
036300       ORDER BY ITM_NBR                                           04440000
036400              , LOC_NBR                                           04450000
036500                                                                  04460000
036600     END-EXEC.                                                    04470000
036700                                                                  04480000
036800                                                                  04490000
036900 PROCEDURE DIVISION.                                              04500000
037000                                                                  04510000
037100 0000-MAINLINE-PROCESSING.                                        04520000
037200                                                                  04530000
037300     PERFORM 1000-INITIALIZATION.                                 04540000
037400**  STORE EXPANSION CHANGE - PROCESS RECEIPTS BEFORE              04550000
037500**  ADJUSTMENTS.                                                  04560000
RONNA **   THESE ARE THE RECEIPTS THAT NEED TO HAVE THE RECEIPTS        04561010
RONNA **   DATES UPDATED                                                04562010
037600     PERFORM 3000-RECEIPTS-UPDATE.                                04570000
037700                                                                  04580000
037800     PERFORM 2000-ADJUSTMENTS-UPDATE.                             04590000
037900                                                                  04600000
038000     PERFORM 4000-SALES-UPDATE.                                   04610000
038100                                                                  04620000
RONNA **   THESE ARE THE RECEIPTS DO NOT NEED TO HAVE THE RECEIPTS      04620110
RONNA **   DATE UPDATED                                                 04620210
RONNA      PERFORM 5000-RECEIPTS-WO-RCPT-DATE.                          04621011
RONNA                                                                   04622010
038200     PERFORM 9900-END-OF-JOB.                                     04630000
038300                                                                  04640000
038400     GOBACK.                                                      04650000
038500                                                                  04660000
038600******************************************************************04670000
038700* PERFORM ALL PROGRAM INITIALIZATION                              04680000
038800******************************************************************04690000
038900 1000-INITIALIZATION.                                             04700000
039000                                                                  04710000
P43627     OPEN INPUT CONTROL-CARD-FILE                                 04720001
P43627                INPUT-RANGE-FILE.                                 04730001
039200                                                                  04740000
039300     PERFORM 1100-PROCESS-CONTROL-CARD.                           04750000
039400                                                                  04760000
P43627     PERFORM 1200-READ-ITEM-RANGE-FILE.                           04770003
039500**** INITIALIZE THE DCLGEN FIELDS FOR TABLES ACCESSED             04780000
039600     INITIALIZE DCLFST00003                                       04790000
039700                DCLFST00004                                       04800000
039800                DCLFST00005                                       04810000
039900                DCLTSKST                                          04820000
PE7819                DCLTSKXREF                                        04830000
040000                DCLTCKRSTCNTL                                     04840000
040100                DCLTCKRSTINF.                                     04850000
040200                                                                  04860000
040300     PERFORM 8000-INIT-CHECKPOINT-SELECT.                         04870000
040400                                                                  04880000
040500******************************************************************04890000
040600*  IF THE PROGRAM IS IN A RESTART STATUS, SELECT SAVED DATA       04900000
040700*  FROM THE RESTART INFO TABLE.                                   04910000
040800******************************************************************04920000
040900     IF  TCKRSTCNTL-CKPT-STAT-CODE = '9'                          04930000
041000         PERFORM 8100-SELECT-RESTART-INFO                         04940000
041100         MOVE TCKRSTINF-WORK-STRG-DESC-TEXT                       04950000
041200           TO CR-CHECKPOINT-RESTART-VAR                           04960000
041300         DISPLAY SPACES                                           04970000
041400         DISPLAY '** FSKUP070 IS BEING RESTARTED'                 04980000
041500     ELSE                                                         04990000
041600         SET PS-FIRST-COMMIT TO TRUE                              05000000
041700     END-IF.                                                      05010000
041800                                                                  05020000
041900     PERFORM 8400-GET-COMMIT-TIMESTAMP.                           05030000
042000                                                                  05040000
042100******************************************************************05050000
042200* VALIDATE THE CONTROL CARD DATE                                  05060000
042300******************************************************************05070000
042400 1100-PROCESS-CONTROL-CARD.                                       05080000
042500                                                                  05090000
042600     READ CONTROL-CARD-FILE INTO CC-CONTROL-CARD                  05100000
042700         AT END DISPLAY '** ABEND ** IN PROGRAM FSKUP070'         05110000
042800                DISPLAY '** CONTROL-CARD-FILE EMPTY'              05120000
042900                MOVE +4003 TO ABEND-CODE                          05130000
043000                CALL 'ILBOABN0' USING ABEND-CODE.                 05140000
043100                                                                  05150000
043200     DISPLAY SPACES.                                              05160000
043300     DISPLAY '** FSKUP070 CONTROL-CARD: ' CC-PROCESS-DATE.        05170000
043400                                                                  05180000
043500     PERFORM 1110-VALIDATE-CC-DATE.                               05190000
043600                                                                  05200000
043700                                                                  05210000
043800******************************************************************05220000
043900*  CHECK THAT THE CONTROL CARD DATE IS A VALID DATE               05230000
044000******************************************************************05240000
044100 1110-VALIDATE-CC-DATE.                                           05250000
044200                                                                  05260000
044300     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05270000
044400*    SET DPG51-FISCAL-454-CALENDAR                                05280000
044500     SET DPG51-FISCAL-JAN-DEC-F2                                  05290000
044600         DPG51-DO-NOT-INCR-DECR-DATE                              05300000
044700         DPG52-LK-DTE-ISO-FMT        TO TRUE.                     05310000
044800                                                                  05320000
044900     MOVE CC-PROCESS-DATE TO DPG52-LK-DATE-INPUT                  05330000
045000                                                                  05340000
045100     CALL DP500-KOHLS-CALENDAR-ROUTINE                            05350000
045200         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               05360000
045300                                                                  05370000
045400     IF DPG54-DATE-INVALID                                        05380000
045500         DISPLAY '** ABEND ** IN FSKUP070'                        05390000
045600         DISPLAY '** PARAGRAPH: 1110-VALIDATE-CC-DATE.'           05400000
045700         DISPLAY '** INVALID PROCESS DATE ON CONTROL CARD.'       05410000
045800         DISPLAY '** CALENDAR ROUTINE ERROR MESSAGE = '           05420000
045900                     DPG54-ERROR-MESSAGE                          05430000
046000         DISPLAY '** DPG51 = ' DPG51                              05440000
046100         DISPLAY '** DPG52 = ' DPG52                              05450000
046200         DISPLAY '** DPG53 = ' DPG53                              05460000
046300         DISPLAY '** DPG54 = ' DPG54                              05470000
046400         DISPLAY '** DPG55 = ' DPG55                              05480000
046500         DISPLAY '** DPG56 = ' DPG56                              05490000
046600         MOVE +4003 TO ABEND-CODE                                 05500000
046700         CALL 'ILBOABN0' USING ABEND-CODE                         05510000
046800     ELSE                                                         05520000
046900         IF DPG54-SEVERE-ERROR                                    05530000
047000             DISPLAY '** ABEND ** IN FSKUP070'                    05540000
047100             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE.'   05550000
047200             DISPLAY '** CALLED BY 1110-VALIDATE-CC-DATE.'        05560000
047300             DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE    05570000
047400             DISPLAY '** DPG51 = ' DPG51                          05580000
047500             DISPLAY '** DPG52 = ' DPG52                          05590000
047600             DISPLAY '** DPG53 = ' DPG53                          05600000
047700             DISPLAY '** DPG54 = ' DPG54                          05610000
047800             DISPLAY '** DPG55 = ' DPG55                          05620000
047900             DISPLAY '** DPG56 = ' DPG56                          05630000
048000             MOVE +4003 TO ABEND-CODE                             05640000
048100             CALL 'ILBOABN0' USING ABEND-CODE                     05650000
048200         ELSE                                                     05660000
048300             IF DPG54-WARNING-ERROR                               05670000
048400                 DISPLAY                                          05680000
048500                       '** WARNING RETURNED BY CALENDAR ROUTINE.' 05690000
048600                 DISPLAY                                          05700000
048700                       '** CALLED BY 1110-VALIDATE-CC-DATE.'      05710000
048800                 DISPLAY                                          05720000
048900                       '** WARNING MESSAGE = ' DPG54-ERROR-MESSAGE05730000
049000             END-IF                                               05740000
049100         END-IF                                                   05750000
049200     END-IF.                                                      05760000
049300                                                                  05770000
049400     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-PROCESS-DATE-10.           05780000
049500                                                                  05790000
P43627******************************************************************05800000
P43627*  READ SALES INPUT FILE                                          05810000
P43627******************************************************************05820000
P43627 1200-READ-ITEM-RANGE-FILE.                                       05830000
P43627                                                                  05840000
P43627     READ INPUT-RANGE-FILE INTO PV-INPUT-ITEM-RANGE-REC           05850000
P43627          AT END DISPLAY '** ABEND ** IN PROGRAM FSKUP070'        05860003
P43627                 DISPLAY '** ITEM-RANGED-FILE EMPTY'              05870003
P43627                 MOVE +4003 TO ABEND-CODE                         05880003
P43627                 CALL 'ILBOABN0' USING ABEND-CODE.                05890003
P43627                                                                  05900003
P43627     DISPLAY 'ITEM NBR RANGE : ',                                 05910003
P43627                PV-ITEM-RANGE-LOWER ' TO ' PV-ITEM-RANGE-HIGHER.  05920003
P43627                                                                  05930000
P43627                                                                  05940000
049700******************************************************************05950000
049800*  APPLY ADJUSTMENTS TO TSKST ON-HAND                             05960000
049900******************************************************************05970000
050000 2000-ADJUSTMENTS-UPDATE.                                         05980000
050100                                                                  05990000
050200     PERFORM 2100-OPEN-ADJ-CSR.                                   06000000
050300     PERFORM 2300-FETCH-ADJ-CSR.                                  06010000
050400                                                                  06020000
050500     IF  PS-ADJ-CSR-END                                           06030000
050600         DISPLAY ' '                                              06040000
050700         DISPLAY '*****************************************'      06050000
050800         DISPLAY ' NO ADJUSTMENTS PROCESSED FOR '                 06060000
050900                   PV-PROCESS-DATE-10                             06070000
051000         DISPLAY '*****************************************'      06080000
051100         DISPLAY ' '                                              06090000
051200     ELSE                                                         06100000
051300         PERFORM 2200-PROCESS-ADJ-TRANS                           06110000
051400             UNTIL PS-ADJ-CSR-END                                 06120000
051500         PERFORM 9100-END-OF-ADJ                                  06130000
051600     END-IF.                                                      06140000
051700                                                                  06150000
051800     PERFORM 2400-CLOSE-ADJ-CSR.                                  06160000
051900                                                                  06170000
052000                                                                  06180000
052100******************************************************************06190000
052200*  OPEN THE ON-HAND ADJUSTMENTS CURSOR                            06200000
052300******************************************************************06210000
052400 2100-OPEN-ADJ-CSR.                                               06220000
052500                                                                  06230000
052600     EXEC SQL                                                     06240000
052700         OPEN OH_ADJ_CSR                                          06250000
052800     END-EXEC.                                                    06260000
052900                                                                  06270000
053000     EVALUATE TRUE                                                06280000
053100         WHEN SQLCODE = +0                                        06290000
053200             CONTINUE                                             06300000
053300         WHEN OTHER                                               06310000
053400             MOVE '2100-OPEN-ADJ-CSR '                            06320000
053500               TO  PV-PARAGRAPH-NAME                              06330000
053600             MOVE 'OPEN ON ADJUSTMENTS CURSOR '                   06340000
053700               TO  PV-DB2-OPERATION-ATTEMPTED                     06350000
053800             PERFORM 9999-SQL-ABEND                               06360000
053900     END-EVALUATE.                                                06370000
054000                                                                  06380000
054100                                                                  06390000
054200******************************************************************06400000
054300*  PROCESS THE ADJUSTMENT TRANSACTIONS BY TYPE                    06410000
054400******************************************************************06420000
054500 2200-PROCESS-ADJ-TRANS.                                          06430000
054600                                                                  06440000
054700     EVALUATE FST00003-ADJ-TYP-CDE                                06450000
054800         WHEN PC-OH-ADJ                                           06460000
054900              PERFORM 2210-ADJUST-ONHAND                          06470000
055000         WHEN PC-RCPT-ADJ                                         06480000
055100              PERFORM 2220-ADJUST-RECEIPT                         06490000
OCFSFS         WHEN PC-SFS-ADJ                                          06500000
OCFSFS              PERFORM 2210-ADJUST-ONHAND                          06510000
OCFSFS         WHEN PC-SFS-SALES-ADJ                                    06520000
OCFSFS              PERFORM 2210-ADJUST-ONHAND                          06530000
055200         WHEN PC-OH-ADJ-ONLY                                      06540000
055300              PERFORM 2250-ADJUST-DSS-ONHAND                      06550000
055400     END-EVALUATE.                                                06560000
055500                                                                  06570000
055600**** UPDATE TRAN STATUS ON THE ADJUSTMENT AUDIT TABLE             06580000
055700     IF  PS-NO-ADJ-ERROR                                          06590000
055800         PERFORM 7600-UPDT-ADJ-TRAN-TO-CMPLT                      06600000
055900     ELSE                                                         06610000
056000         SET PS-NO-ADJ-ERROR TO TRUE                              06620000
056100     END-IF.                                                      06630000
056200                                                                  06640000
056300**** AT THIS POINT A LOGICAL UNIT OF WORK HAS BEEN COMPLETED      06650000
056400**** (COMPLETED PROCESSING OF ONE ADJUSTMENT TRANSACTION).        06660000
056500**** THEREFORE, PERFORM CHECKPOINT PROCESSING.                    06670000
056600     PERFORM 8200-COMMIT-PROCESSING.                              06680000
056700                                                                  06690000
056800     PERFORM 2300-FETCH-ADJ-CSR.                                  06700000
056900                                                                  06710000
057000                                                                  06720000
057100******************************************************************06730000
057200*  APPLY THE ON-HAND ADJUSTMENT (ADJ TYPE 121)                    06740000
057300******************************************************************06750000
057400 2210-ADJUST-ONHAND.                                              06760000
057500                                                                  06770000
PE7819     MOVE 'N' TO PS-DELETE-TSKST-ITM-SW.                          06780000
057600**** SELECT THE SPECIFIC ITEM/STORE ROW FROM TSKST                06790000
057700     MOVE FST00003-ITM-NBR TO TSKST-ITEM-NMBR.                    06800000
057800     MOVE FST00003-LOC-NBR TO TSKST-LOC-NBR.                      06810000
058000     PERFORM 7000-READ-TSKST-FOR-ADJ-RCPT.                        06820000
058100                                                                  06830000
058200     EVALUATE SQLCODE                                             06840000
058300         WHEN 000                                                 06850000
058400********      UPDATE THE SPECIFIC ITEM/STORE ROW                  06860000
058500              PERFORM 6000-ADJUST-TSKST-OH-QTY                    06870000
058600              PERFORM 7100-UPDT-TSKST-FOR-ADJ-RCPT                06880000
058700********      UPDATE THE CORPORATE ROW FOR THIS ITEM              06890000
058800              MOVE ZERO          TO TSKST-LOC-NBR                 06900000
058900              PERFORM 7000-READ-TSKST-FOR-ADJ-RCPT                06910000
059000              PERFORM 6000-ADJUST-TSKST-OH-QTY                    06920000
059100              PERFORM 7100-UPDT-TSKST-FOR-ADJ-RCPT                06930000
059200         WHEN +100                                                06940000
059300              PERFORM 6100-CHECK-IF-VALID-TRAN                    06950000
059400              IF  FST00003-ERR-TYP-CDE = '000'                    06960000
059500********          NO ERROR MEANS THIS IS A VALID TRAN             06970000
059600********          INSERT THE SPECIFIC ITEM/STORE ROW              06980000
059700                  INITIALIZE DCLTSKST                             06990000
059800                  MOVE FST00003-ITM-NBR TO TSKST-ITEM-NMBR        07000000
059900                  MOVE FST00003-LOC-NBR TO TSKST-LOC-NBR          07010000
060100                  PERFORM 6000-ADJUST-TSKST-OH-QTY                07020000
060200                  PERFORM 7200-ISRT-TSKST-FOR-ADJ-RCPT            07030000
060300********          UPDATE THE CORPORATE ROW FOR THIS ITEM          07040000
060400                  MOVE ZERO          TO TSKST-LOC-NBR             07050000
060500                  PERFORM 7000-READ-TSKST-FOR-ADJ-RCPT            07060000
PE7819                  IF PS-DELETE-TSKST-ITM-SW = 'N'                 07070000
060600                     PERFORM 6000-ADJUST-TSKST-OH-QTY             07080000
060700                     PERFORM 7100-UPDT-TSKST-FOR-ADJ-RCPT         07090000
PE7819                  ELSE                                            07100000
PE7819                     MOVE '004' TO FST00003-ERR-TYP-CDE           07110000
PE7819                     SET PS-ADJ-TRAN-ERROR TO TRUE                07120000
PE7819                     PERFORM 7700-UPDT-ADJ-AUD-ERROR              07130000
PE7819                  END-IF                                          07140000
060800              ELSE                                                07150000
060900********          AN ERROR MEANS THAT THIS IS AN INVALID TRAN -   07160000
061000********          DO NOT INSERT TO TSKST                          07170000
061100                  SET PS-ADJ-TRAN-ERROR TO TRUE                   07180000
061200                  PERFORM 7700-UPDT-ADJ-AUD-ERROR                 07190000
061300              END-IF                                              07200000
061400     END-EVALUATE.                                                07210000
061500                                                                  07220000
061600                                                                  07230000
061700******************************************************************07240000
061800*  APPLY THE RECEIPT ADJUSTMENT (ADJ TYPE 123)                    07250000
061900******************************************************************07260000
062000 2220-ADJUST-RECEIPT.                                             07270000
062100                                                                  07280000
PE7819     MOVE 'N' TO PS-DELETE-TSKST-ITM-SW.                          07290000
062200**** SELECT THE SPECIFIC ITEM/STORE ROW FROM TSKST                07300000
062300     MOVE FST00003-ITM-NBR TO TSKST-ITEM-NMBR.                    07310000
062410     MOVE FST00003-LOC-NBR TO TSKST-LOC-NBR.                      07320000
062600     PERFORM 7000-READ-TSKST-FOR-ADJ-RCPT.                        07330000
062700                                                                  07340000
062800     EVALUATE SQLCODE                                             07350000
062900         WHEN 000                                                 07360000
063000********      UPDATE THE SPECIFIC ITEM/STORE ROW                  07370000
063100              PERFORM 6000-ADJUST-TSKST-OH-QTY                    07380000
063200              PERFORM 7100-UPDT-TSKST-FOR-ADJ-RCPT                07390000
063300         WHEN +100                                                07400000
063400********      INSERT THE SPECIFIC ITEM/STORE ROW                  07410000
063500              INITIALIZE DCLTSKST                                 07420000
063600              MOVE FST00003-ITM-NBR TO TSKST-ITEM-NMBR            07430000
063710              MOVE FST00003-LOC-NBR TO TSKST-LOC-NBR              07440000
063900              PERFORM 6000-ADJUST-TSKST-OH-QTY                    07450000
064000              PERFORM 7200-ISRT-TSKST-FOR-ADJ-RCPT                07460000
064100     END-EVALUATE.                                                07470000
064200                                                                  07480000
064300**** UPDATE THE CORPORATE ROW FOR THIS ITEM                       07490000
064400     MOVE ZERO          TO TSKST-LOC-NBR.                         07500000
064500     PERFORM 7000-READ-TSKST-FOR-ADJ-RCPT.                        07510000
PE7819     IF PS-DELETE-TSKST-ITM-SW = 'N'                              07520000
064600        PERFORM 6000-ADJUST-TSKST-OH-QTY                          07530000
064700        PERFORM 7100-UPDT-TSKST-FOR-ADJ-RCPT                      07540000
PE7819     ELSE                                                         07550000
PE7819        MOVE '004' TO FST00003-ERR-TYP-CDE                        07560000
PE7819        SET PS-ADJ-TRAN-ERROR TO TRUE                             07570000
PE7819        PERFORM 7700-UPDT-ADJ-AUD-ERROR                           07580000
PE7819     END-IF.                                                      07590000
064800                                                                  07600000
064900******************************************************************07610000
065000*  APPLY THE DSS ON-HAND ADJUSTMENT (ADJ TYPE 143)                07620000
065100******************************************************************07630000
065200 2250-ADJUST-DSS-ONHAND.                                          07640000
065300                                                                  07650000
PE7819     MOVE 'N' TO PS-DELETE-TSKST-ITM-SW.                          07660000
065400**** SELECT THE SPECIFIC ITEM/STORE ROW FROM TSKST                07670000
065500     MOVE FST00003-ITM-NBR TO TSKST-ITEM-NMBR.                    07680000
065600     MOVE FST00003-LOC-NBR TO TSKST-LOC-NBR.                      07690000
065800     PERFORM 7000-READ-TSKST-FOR-ADJ-RCPT.                        07700000
065900                                                                  07710000
066000     EVALUATE SQLCODE                                             07720000
066100         WHEN 000                                                 07730000
066200********      UPDATE THE SPECIFIC ITEM/STORE ROW                  07740000
066300              SUBTRACT FST00003-ADJ-QTY                           07750000
066400                  FROM TSKST-ONHAND-QTY                           07760000
066500              PERFORM 7100-UPDT-TSKST-FOR-ADJ-RCPT                07770000
066600********      UPDATE THE CORPORATE ROW FOR THIS ITEM              07780000
066700              MOVE ZERO          TO TSKST-LOC-NBR                 07790000
066800              PERFORM 7000-READ-TSKST-FOR-ADJ-RCPT                07800000
066900              SUBTRACT FST00003-ADJ-QTY                           07810000
067000                  FROM TSKST-ONHAND-QTY                           07820000
067100              PERFORM 7100-UPDT-TSKST-FOR-ADJ-RCPT                07830000
067200         WHEN +100                                                07840000
067300********      THIS IS AN ERROR - WHEN CORRECTING DOUBLE BOOKING   07850000
067400********      THE ROW SHOULD HAVE PREVIOUSLY EXISTED              07860000
067500              SET PS-ADJ-TRAN-ERROR TO TRUE                       07870000
067600              MOVE '025' TO FST00003-ERR-TYP-CDE                  07880000
067700              PERFORM 7700-UPDT-ADJ-AUD-ERROR                     07890000
067800     END-EVALUATE.                                                07900000
067900                                                                  07910000
068000                                                                  07920000
068100******************************************************************07930000
068200*  FETCH THE ADJUSTMENTS CURSOR                                   07940000
068300******************************************************************07950000
068400 2300-FETCH-ADJ-CSR.                                              07960000
068500                                                                  07970000
068600     EXEC SQL                                                     07980000
068700         FETCH OH_ADJ_CSR                                         07990000
068800         INTO :FST00003-ITM-NBR                                   08000000
068900            , :FST00003-LOC-NBR                                   08010000
069000            , :FST00003-ADJ-TYP-CDE                               08020000
069100            , :FST00003-ACTN-CDE                                  08030000
069200            , :FST00003-ADJ-QTY                                   08040000
069300            , :FST00003-BTCH-NBR                                  08050000
069400            , :FST00003-UNT-BKG-CDE                               08060000
069500            , :FST00003-CRE-TMST                                  08070000
069600     END-EXEC.                                                    08080000
069700                                                                  08090000
069800     EVALUATE SQLCODE                                             08100000
069900       WHEN +0                                                    08110000
070000            ADD +1 TO CR-OH-ADJ-FETCH-CNT                         08120000
070100       WHEN +100                                                  08130000
070200            SET PS-ADJ-CSR-END TO TRUE                            08140000
070300       WHEN OTHER                                                 08150000
070400            MOVE '2300-FETCH-ADJ-CSR' TO PV-PARAGRAPH-NAME        08160000
070500            MOVE 'FETCH ON ADJUSTMENTS CURSOR' TO                 08170000
070600                  PV-DB2-OPERATION-ATTEMPTED                      08180000
070700            PERFORM 9999-SQL-ABEND                                08190000
070800     END-EVALUATE.                                                08200000
070900                                                                  08210000
071000                                                                  08220000
071100******************************************************************08230000
071200*  CLOSE THE ON-HAND ADJUSTMENTS CURSOR                           08240000
071300******************************************************************08250000
071400 2400-CLOSE-ADJ-CSR.                                              08260000
071500                                                                  08270000
071600     EXEC SQL                                                     08280000
071700         CLOSE OH_ADJ_CSR                                         08290000
071800     END-EXEC.                                                    08300000
071900                                                                  08310000
072000     EVALUATE TRUE                                                08320000
072100         WHEN SQLCODE = +0                                        08330000
072200             CONTINUE                                             08340000
072300         WHEN OTHER                                               08350000
072400             MOVE '2400-CLOSE-ADJ-CSR '                           08360000
072500               TO  PV-PARAGRAPH-NAME                              08370000
072600             MOVE 'CLOSE ON ADJUSTMENTS CURSOR '                  08380000
072700               TO  PV-DB2-OPERATION-ATTEMPTED                     08390000
072800             PERFORM 9999-SQL-ABEND                               08400000
072900     END-EVALUATE.                                                08410000
073000                                                                  08420000
073100                                                                  08430000
073200******************************************************************08440000
073300*  APPLY RECEIPTS TO TSKST ON-HAND                                08450000
073400******************************************************************08460000
073500 3000-RECEIPTS-UPDATE.                                            08470000
073600                                                                  08480000
073700     PERFORM 3100-OPEN-RCPT-CSR.                                  08490000
073800     PERFORM 3300-FETCH-RCPT-CSR.                                 08500000
073900                                                                  08510000
074000     IF  PS-RCPT-CSR-END                                          08520000
074100         DISPLAY ' '                                              08530000
074200         DISPLAY '*****************************************'      08540000
074200         DISPLAY ' NO RECEIPTS PROCESSED FOR ' PV-PROCESS-DATE-10 08550009
RONNA          DISPLAY ' WHERE RECEIPT DATES NEED TO BE UPDATED  '      08560010
074400         DISPLAY '*****************************************'      08561009
074500         DISPLAY ' '                                              08570000
074600     ELSE                                                         08580000
074700         PERFORM 3200-PROCESS-RCPT-TRANS                          08590000
074800             UNTIL PS-RCPT-CSR-END                                08600000
074900         PERFORM 9200-END-OF-RCPT                                 08610000
075000     END-IF.                                                      08620000
075100                                                                  08630000
075200     PERFORM 3400-CLOSE-RCPT-CSR.                                 08640000
075300                                                                  08650000
075400                                                                  08660000
075500******************************************************************08670000
075600*  OPEN THE ON-HAND RECEIPTS CURSOR                               08680000
075700******************************************************************08690000
075800 3100-OPEN-RCPT-CSR.                                              08700000
075900                                                                  08710000
076000     EXEC SQL                                                     08720000
076100         OPEN OH_RCPT_CSR                                         08730000
076200     END-EXEC.                                                    08740000
076300                                                                  08750000
076400     EVALUATE TRUE                                                08760000
076500         WHEN SQLCODE = +0                                        08770000
076600             CONTINUE                                             08780000
076700         WHEN OTHER                                               08790000
076800             MOVE '3100-OPEN-RCPT-CSR '                           08800000
076900               TO  PV-PARAGRAPH-NAME                              08810000
077000             MOVE 'OPEN ON RECEIPTS CURSOR '                      08820000
077100               TO  PV-DB2-OPERATION-ATTEMPTED                     08830000
077200             PERFORM 9999-SQL-ABEND                               08840000
077300     END-EVALUATE.                                                08850000
077400                                                                  08860000
077500                                                                  08870000
077600******************************************************************08880000
077700*  PROCESS THE RECEIPT DATA FOR THE CURRENT ITEM/LOCATION         08890000
077800******************************************************************08900000
077900 3200-PROCESS-RCPT-TRANS.                                         08910000
078000                                                                  08920000
PE7819     MOVE 'N' TO PS-DELETE-TSKST-ITM-SW.                          08930000
078100**** SELECT THE SPECIFIC ITEM/STORE ROW FROM TSKST                08940000
078200     MOVE FST00004-ITM-NBR TO TSKST-ITEM-NMBR.                    08950000
078300     MOVE FST00004-LOC-NBR TO TSKST-LOC-NBR.                      08960000
078500     PERFORM 7000-READ-TSKST-FOR-ADJ-RCPT.                        08970000
078600                                                                  08980000
078700     EVALUATE SQLCODE                                             08990000
078800         WHEN 000                                                 09000000
078900********      UPDATE THE SPECIFIC ITEM/STORE ROW                  09010000
079000              PERFORM 3210-FORMAT-RCPT-FOR-UPDT                   09020000
079100              PERFORM 7100-UPDT-TSKST-FOR-ADJ-RCPT                09030000
079200         WHEN +100                                                09040000
079300********      INSERT THE SPECIFIC ITEM/STORE ROW                  09050000
079400              PERFORM 3220-FORMAT-RCPT-FOR-ISRT                   09060000
079500              PERFORM 7200-ISRT-TSKST-FOR-ADJ-RCPT                09070000
079600     END-EVALUATE.                                                09080000
079700                                                                  09090000
079800**** SAVE THE ITEM NUMBER TO COMPARE AGAINST THE NEXT ITEM        09100000
079900**** NUMBER FETCHED                                               09110000
080000     MOVE FST00004-ITM-NBR TO PV-PREV-ITM-NBR.                    09120000
080100                                                                  09130000
080200**** ACCUMULATE THE TOTAL ITEM RECEIPT QTY TO USE WHEN            09140000
080300**** UPDATING STORE 000                                           09150000
080400     ADD WS-SUM-LOC-RCPT-QTY TO PV-ITEM-TOT-RCPT-QTY.             09160000
080500                                                                  09170000
080600**** KEEP THIS ITEM'S EARLIEST FIRST RECEIPT DATE TO USE WHEN     09180000
080700**** UPDATING STORE 000                                           09190000
080800     IF  PV-FIRST-RCVD-DATE = SPACES                              09200000
080900         MOVE WS-MIN-VRFD-DTE TO PV-FIRST-RCVD-DATE               09210000
081000     ELSE                                                         09220000
081100         IF  WS-MIN-VRFD-DTE < PV-FIRST-RCVD-DATE                 09230000
081200             MOVE WS-MIN-VRFD-DTE TO PV-FIRST-RCVD-DATE           09240000
081300         END-IF                                                   09250000
081400     END-IF.                                                      09260000
081500                                                                  09270000
081600**** KEEP THIS ITEM'S LATEST LAST RECEIPT DATE TO USE WHEN        09280000
081700**** UPDATING STORE 000                                           09290000
081800     IF  PV-LAST-RCVD-DATE = SPACES                               09300000
081900         MOVE WS-MAX-VRFD-DTE TO PV-LAST-RCVD-DATE                09310000
082000     ELSE                                                         09320000
082100         IF  WS-MAX-VRFD-DTE > PV-LAST-RCVD-DATE                  09330000
082200             MOVE WS-MAX-VRFD-DTE TO PV-LAST-RCVD-DATE            09340000
082300         END-IF                                                   09350000
082400     END-IF.                                                      09360000
082500                                                                  09370000
082600**** FETCH RECEIPT DATA FOR THE NEXT ITEM/LOCATION                09380000
082700     PERFORM 3300-FETCH-RCPT-CSR.                                 09390000
082800                                                                  09400000
082900**** WHEN A NEW ITEM IS ENCOUNTERED, UPDATE THE CORPORATE ROW     09410000
083000**** (STORE 000) FOR THE PREVIOUS ITEM.                           09420000
083100                                                                  09430000
083200**** ALSO, AT THIS POINT A LOGICAL UNIT OF WORK HAS BEEN          09440000
083300**** COMPLETED (COMPLETED UPDATING RECEIPTS FOR ONE ITEM).        09450000
083400**** THEREFORE, PERFORM CHECKPOINT PROCESSING.                    09460000
083500                                                                  09470000
083600     IF  FST00004-ITM-NBR NOT = PV-PREV-ITM-NBR                   09480000
083700     OR  PS-RCPT-CSR-END                                          09490000
083800****     UPDATE THE CORPORATE ROW FOR THIS ITEM                   09500000
083900         MOVE PV-PREV-ITM-NBR TO TSKST-ITEM-NMBR                  09510000
084000         MOVE ZERO            TO TSKST-LOC-NBR                    09520000
084100         PERFORM 7000-READ-TSKST-FOR-ADJ-RCPT                     09530000
PE7819         IF PS-DELETE-TSKST-ITM-SW = 'N'                          09540000
084200            PERFORM 3230-FORMAT-RCPT-CORP-UPDT                    09550000
084300            PERFORM 7100-UPDT-TSKST-FOR-ADJ-RCPT                  09560000
084400****     UPDATE TRAN STATUS ON THE RECEIPT AUDIT TABLE            09570000
084500            PERFORM 7800-UPDT-RCPT-TRAN-TO-CMPLT                  09580000
PE7819         ELSE                                                     09590000
PE7819            PERFORM 4250-UPDATE-RCT-AUDIT-TBL                     09600000
PE7819         END-IF                                                   09610000
084600****     PERFORM CHECKPOINT PROCESSING                            09620000
084700         PERFORM 8200-COMMIT-PROCESSING                           09630000
084800****     INITIALIZE ITEM RECEIPT VARIABLES                        09640000
084900         MOVE FST00004-ITM-NBR TO PV-PREV-ITM-NBR                 09650000
085000         MOVE +0     TO PV-ITEM-TOT-RCPT-QTY                      09660000
085100         MOVE SPACES TO PV-FIRST-RCVD-DATE                        09670000
085200                        PV-LAST-RCVD-DATE                         09680000
085300     END-IF.                                                      09690000
085400                                                                  09700000
085500                                                                  09710000
085600******************************************************************09720000
085700*  FORMAT THE RECEIPT DATA TO UPDATE A SPECIFIC ITEM/STORE ROW    09730000
085800*  ON TSKST.                                                      09740000
085900******************************************************************09750000
086000 3210-FORMAT-RCPT-FOR-UPDT.                                       09760000
086100                                                                  09770000
086200     ADD WS-SUM-LOC-RCPT-QTY TO TSKST-ONHAND-QTY.                 09780000
086300                                                                  09790000
086400     IF  TSKST-FIRST-RCVD-DATE = 0                                09800000
086500****     CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT           09810000
086600         MOVE WS-MIN-VRFD-DTE TO PV-TSKST-DATE-X10                09820000
086700         PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                    09830000
086800         MOVE PV-TSKST-DATE-YYMMDD TO TSKST-FIRST-RCVD-DATE       09840000
086900     ELSE                                                         09850000
087000****     CONVERT TSKST DATE TO STANDARD DB2 DATE FORMAT           09860000
087100         MOVE TSKST-FIRST-RCVD-DATE TO PV-TSKST-DATE-YYMMDD       09870000
087200         PERFORM 6200-CONVERT-DATE-DEC7-TO-X10                    09880000
087300         IF  WS-MIN-VRFD-DTE < PV-TSKST-DATE-X10                  09890000
087400****         CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT       09900000
087500             MOVE WS-MIN-VRFD-DTE TO PV-TSKST-DATE-X10            09910000
087600             PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                09920000
087700             MOVE PV-TSKST-DATE-YYMMDD TO TSKST-FIRST-RCVD-DATE   09930000
087800         END-IF                                                   09940000
087900     END-IF.                                                      09950000
088000                                                                  09960000
088100     IF  TSKST-LAST-RCVD-DATE = 0                                 09970000
088200****     CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT           09980000
088300         MOVE WS-MAX-VRFD-DTE TO PV-TSKST-DATE-X10                09990000
088400         PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                    10000000
088500         MOVE PV-TSKST-DATE-YYMMDD TO TSKST-LAST-RCVD-DATE        10010000
088600     ELSE                                                         10020000
088700****     CONVERT TSKST DATE TO STANDARD DB2 DATE FORMAT           10030000
088800         MOVE TSKST-LAST-RCVD-DATE TO PV-TSKST-DATE-YYMMDD        10040000
088900         PERFORM 6200-CONVERT-DATE-DEC7-TO-X10                    10050000
089000         IF  WS-MAX-VRFD-DTE > PV-TSKST-DATE-X10                  10060000
089100****         CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT       10070000
089200             MOVE WS-MAX-VRFD-DTE TO PV-TSKST-DATE-X10            10080000
089300             PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                10090000
089400             MOVE PV-TSKST-DATE-YYMMDD TO TSKST-LAST-RCVD-DATE    10100000
089500                                                                  10110000
089600     END-IF.                                                      10120000
089700                                                                  10130000
089800                                                                  10140000
089900******************************************************************10150000
090000*  FORMAT THE RECEIPT DATA TO INSERT A SPECIFIC ITEM/STORE ROW    10160000
090100*  TO TSKST.                                                      10170000
090200******************************************************************10180000
090300 3220-FORMAT-RCPT-FOR-ISRT.                                       10190000
090400                                                                  10200000
090500     INITIALIZE DCLTSKST.                                         10210000
090600                                                                  10220000
090700     MOVE FST00004-ITM-NBR TO TSKST-ITEM-NMBR.                    10230000
090800     MOVE FST00004-LOC-NBR TO TSKST-LOC-NBR.                      10240000
091000                                                                  10250000
091100     MOVE WS-SUM-LOC-RCPT-QTY TO TSKST-ONHAND-QTY.                10260000
091200                                                                  10270000
091300**** CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT               10280000
091400     MOVE WS-MIN-VRFD-DTE TO PV-TSKST-DATE-X10.                   10290000
091500     PERFORM 6300-CONVERT-DATE-X10-TO-DEC7.                       10300000
091600     MOVE PV-TSKST-DATE-YYMMDD TO TSKST-FIRST-RCVD-DATE.          10310000
091700                                                                  10320000
091800**** CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT               10330000
091900     MOVE WS-MAX-VRFD-DTE TO PV-TSKST-DATE-X10.                   10340000
092000     PERFORM 6300-CONVERT-DATE-X10-TO-DEC7.                       10350000
092100     MOVE PV-TSKST-DATE-YYMMDD TO TSKST-LAST-RCVD-DATE.           10360000
092200                                                                  10370000
092300                                                                  10380000
092400******************************************************************10390000
092500*  FORMAT THE RECEIPT DATA TO UPDATE THE CORPORATE ROW            10400000
092600*  (STORE 000) FOR THE ITEM.                                      10410000
092700******************************************************************10420000
092800 3230-FORMAT-RCPT-CORP-UPDT.                                      10430000
092900                                                                  10440000
093000     ADD PV-ITEM-TOT-RCPT-QTY TO TSKST-ONHAND-QTY.                10450000
093100                                                                  10460000
093200**** UPDATE THE STORE 000 ROW WITH THE EARLIEST FIRST RCVD DATE   10470000
093300     IF  TSKST-FIRST-RCVD-DATE = 0                                10480000
093400****     CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT           10490000
093500         MOVE PV-FIRST-RCVD-DATE TO PV-TSKST-DATE-X10             10500000
093600         PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                    10510000
093700         MOVE PV-TSKST-DATE-YYMMDD TO TSKST-FIRST-RCVD-DATE       10520000
093800     ELSE                                                         10530000
093900****     CONVERT TSKST DATE TO STANDARD DB2 DATE FORMAT           10540000
094000         MOVE TSKST-FIRST-RCVD-DATE TO PV-TSKST-DATE-YYMMDD       10550000
094100         PERFORM 6200-CONVERT-DATE-DEC7-TO-X10                    10560000
094200         IF  PV-FIRST-RCVD-DATE < PV-TSKST-DATE-X10               10570000
094300****         CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT       10580000
094400             MOVE PV-FIRST-RCVD-DATE TO PV-TSKST-DATE-X10         10590000
094500             PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                10600000
094600             MOVE PV-TSKST-DATE-YYMMDD TO TSKST-FIRST-RCVD-DATE   10610000
094700         END-IF                                                   10620000
094800     END-IF.                                                      10630000
094900                                                                  10640000
095000**** UPDATE THE STORE 000 ROW WITH THE LATEST LAST RCVD DATE      10650000
095100     IF  TSKST-LAST-RCVD-DATE = 0                                 10660000
095200****     CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT           10670000
095300         MOVE PV-LAST-RCVD-DATE TO PV-TSKST-DATE-X10              10680000
095400         PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                    10690000
095500         MOVE PV-TSKST-DATE-YYMMDD TO TSKST-LAST-RCVD-DATE        10700000
095600     ELSE                                                         10710000
095700****     CONVERT TSKST DATE TO STANDARD DB2 DATE FORMAT           10720000
095800         MOVE TSKST-LAST-RCVD-DATE TO PV-TSKST-DATE-YYMMDD        10730000
095900         PERFORM 6200-CONVERT-DATE-DEC7-TO-X10                    10740000
096000         IF  PV-LAST-RCVD-DATE > PV-TSKST-DATE-X10                10750000
096100****         CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT       10760000
096200             MOVE PV-LAST-RCVD-DATE TO PV-TSKST-DATE-X10          10770000
096300             PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                10780000
096400             MOVE PV-TSKST-DATE-YYMMDD TO TSKST-LAST-RCVD-DATE    10790000
096500         END-IF                                                   10800000
096600     END-IF.                                                      10810000
096700                                                                  10820000
096800                                                                  10830000
096900******************************************************************10840000
097000*  FETCH THE RECEIPTS CURSOR                                      10850000
097100******************************************************************10860000
097200 3300-FETCH-RCPT-CSR.                                             10870000
097300                                                                  10880000
097400     EXEC SQL                                                     10890000
097500         FETCH OH_RCPT_CSR                                        10900000
097600         INTO :FST00004-ITM-NBR                                   10910000
097700            , :FST00004-LOC-NBR                                   10920000
097800            , :WS-MIN-VRFD-DTE                                    10930000
097900            , :WS-MAX-VRFD-DTE                                    10940000
098000            , :WS-SUM-LOC-RCPT-QTY                                10950000
098100     END-EXEC.                                                    10960000
098200                                                                  10970000
098300     EVALUATE SQLCODE                                             10980000
098400       WHEN +0                                                    10990000
098500            ADD +1 TO CR-OH-RCPT-FETCH-CNT                        11000000
098600       WHEN +100                                                  11010000
098700            SET PS-RCPT-CSR-END TO TRUE                           11020000
098800       WHEN OTHER                                                 11030000
098900            MOVE '3300-FETCH-RCPT-CSR' TO PV-PARAGRAPH-NAME       11040000
099000            MOVE 'FETCH ON RECEIPTS CURSOR' TO                    11050000
099100                  PV-DB2-OPERATION-ATTEMPTED                      11060000
099200            PERFORM 9999-SQL-ABEND                                11070000
099300     END-EVALUATE.                                                11080000
099400                                                                  11090000
099500                                                                  11100000
099600******************************************************************11110000
099700*  CLOSE THE ON-HAND RECEIPTS CURSOR                              11120000
099800******************************************************************11130000
099900 3400-CLOSE-RCPT-CSR.                                             11140000
100000                                                                  11150000
100100     EXEC SQL                                                     11160000
100200         CLOSE OH_RCPT_CSR                                        11170000
100300     END-EXEC.                                                    11180000
100400                                                                  11190000
100500     EVALUATE TRUE                                                11200000
100600         WHEN SQLCODE = +0                                        11210000
100700             CONTINUE                                             11220000
100800         WHEN OTHER                                               11230000
100900             MOVE '3400-CLOSE-RCPT-CSR '                          11240000
101000               TO  PV-PARAGRAPH-NAME                              11250000
101100             MOVE 'CLOSE ON RECEIPTS CURSOR '                     11260000
101200               TO  PV-DB2-OPERATION-ATTEMPTED                     11270000
101300             PERFORM 9999-SQL-ABEND                               11280000
101400     END-EVALUATE.                                                11290000
101500                                                                  11300000
101600                                                                  11310000
101700******************************************************************11320000
101800*  APPLY SALES TO TSKST ON-HAND                                   11330000
101900******************************************************************11340000
102000 4000-SALES-UPDATE.                                               11350000
102100                                                                  11360000
102200     MOVE +0 TO PV-PREV-ITM-NBR                                   11370000
102300     PERFORM 4100-OPEN-SLS-CSR.                                   11380000
102400     PERFORM 4300-FETCH-SLS-CSR.                                  11390000
102500                                                                  11400000
102600     IF  PS-SLS-CSR-END                                           11410000
102700         DISPLAY ' '                                              11420000
102800         DISPLAY '*****************************************'      11430000
102900         DISPLAY ' NO SALES PROCESSED FOR ' PV-PROCESS-DATE-10    11440000
103000         DISPLAY '*****************************************'      11450000
103100         DISPLAY ' '                                              11460000
103200     ELSE                                                         11470000
103300         PERFORM 4200-PROCESS-SLS-TRANS                           11480000
103400             UNTIL PS-SLS-CSR-END                                 11490000
103500         PERFORM 9300-END-OF-SALES                                11500000
103600     END-IF.                                                      11510000
103700                                                                  11520000
103800     PERFORM 4400-CLOSE-SLS-CSR.                                  11530000
103900                                                                  11540000
104000                                                                  11550000
104100******************************************************************11560000
104200*  OPEN THE ON-HAND SALES CURSOR                                  11570000
104300******************************************************************11580000
104400 4100-OPEN-SLS-CSR.                                               11590000
104500                                                                  11600000
104600     EXEC SQL                                                     11610000
104700         OPEN OH_SLS_CSR                                          11620000
104800     END-EXEC.                                                    11630000
104900                                                                  11640000
105000     EVALUATE TRUE                                                11650000
105100         WHEN SQLCODE = +0                                        11660000
105200             CONTINUE                                             11670000
105300         WHEN OTHER                                               11680000
105400             MOVE '4100-OPEN-SLS-CSR '                            11690000
105500               TO  PV-PARAGRAPH-NAME                              11700000
105600             MOVE 'OPEN ON SALES CURSOR '                         11710000
105700               TO  PV-DB2-OPERATION-ATTEMPTED                     11720000
105800             PERFORM 9999-SQL-ABEND                               11730000
105900     END-EVALUATE.                                                11740000
106000                                                                  11750000
106100                                                                  11760000
106200******************************************************************11770000
106300*  PROCESS THE SALES DATA FOR THE CURRENT ITEM/LOCATION           11780000
106400******************************************************************11790000
106500 4200-PROCESS-SLS-TRANS.                                          11800000
106600                                                                  11810000
PE7819     MOVE 'N' TO PS-DELETE-TSKST-ITM-SW.                          11820000
106700**** SELECT THE SPECIFIC ITEM/STORE ROW FROM TSKST                11830000
106800     MOVE FST00005-ITM-NBR TO TSKST-ITEM-NMBR.                    11840000
106900     MOVE FST00005-LOC-NBR TO TSKST-LOC-NBR.                      11850000
107100     PERFORM 7300-READ-TSKST-FOR-SALES.                           11860000
107200                                                                  11870000
107300     EVALUATE SQLCODE                                             11880000
107400         WHEN 000                                                 11890000
107500********      UPDATE THE SPECIFIC ITEM/STORE ROW                  11900000
107600              PERFORM 4210-FORMAT-SLS-FOR-UPDT                    11910000
107700              PERFORM 7400-UPDT-TSKST-FOR-SALES                   11920000
107800         WHEN +100                                                11930000
107900********      INSERT THE SPECIFIC ITEM/STORE ROW                  11940000
108000              PERFORM 4220-FORMAT-SLS-FOR-ISRT                    11950000
108100              PERFORM 7500-ISRT-TSKST-FOR-SALES                   11960000
108200     END-EVALUATE.                                                11970000
108300                                                                  11980000
108400**** SAVE THE ITEM NUMBER TO COMPARE AGAINST THE NEXT ITEM        11990000
108500**** NUMBER FETCHED                                               12000000
108600     MOVE FST00005-ITM-NBR TO PV-PREV-ITM-NBR.                    12010000
108700                                                                  12020000
108800**** ACCUMULATE THE TOTAL ITEM SOLD QTY AND SOLD AMT TO USE       12030000
108900**** WHEN UPDATING STORE 000                                      12040000
109000     ADD WS-SUM-TOT-SLD-QTY   TO PV-ITEM-TOT-SLD-QTY.             12050000
109100     ADD WS-SUM-TOT-CHRGD-AMT TO PV-ITEM-TOT-CHRGD-AMT.           12060000
109200                                                                  12070000
109300**** KEEP THIS ITEM'S EARLIEST FIRST SALE DATE TO USE WHEN        12080000
109400**** UPDATING STORE 000                                           12090000
109500     IF  PV-FIRST-SALE-DATE = SPACES                              12100000
109600         MOVE WS-MIN-SALE-DTE TO PV-FIRST-SALE-DATE               12110000
109700     ELSE                                                         12120000
109800         IF  WS-MIN-SALE-DTE < PV-FIRST-SALE-DATE                 12130000
109900             MOVE WS-MIN-SALE-DTE TO PV-FIRST-SALE-DATE           12140000
110000         END-IF                                                   12150000
110100     END-IF.                                                      12160000
110200                                                                  12170000
110300**** KEEP THIS ITEM'S LATEST LAST SALE DATE TO USE WHEN           12180000
110400**** UPDATING STORE 000                                           12190000
110500     IF  PV-LAST-SALE-DATE = SPACES                               12200000
110600         MOVE WS-MAX-SALE-DTE TO PV-LAST-SALE-DATE                12210000
110700     ELSE                                                         12220000
110800         IF  WS-MAX-SALE-DTE > PV-LAST-SALE-DATE                  12230000
110900             MOVE WS-MAX-SALE-DTE TO PV-LAST-SALE-DATE            12240000
111000         END-IF                                                   12250000
111100     END-IF.                                                      12260000
111200                                                                  12270000
111300**** FETCH RECEIPT DATA FOR THE NEXT ITEM/LOCATION                12280000
111400     PERFORM 4300-FETCH-SLS-CSR.                                  12290000
111500                                                                  12300000
111600**** WHEN A NEW ITEM IS ENCOUNTERED, UPDATE THE CORPORATE ROW     12310000
111700**** (STORE 000) FOR THE PREVIOUS ITEM.                           12320000
111800                                                                  12330000
111900**** ALSO, AT THIS POINT A LOGICAL UNIT OF WORK HAS BEEN          12340000
112000**** COMPLETED (COMPLETED UPDATING SALES FOR ONE ITEM).           12350000
112100**** THEREFORE, PERFORM CHECKPOINT PROCESSING.                    12360000
112200                                                                  12370000
112300     IF  FST00005-ITM-NBR NOT = PV-PREV-ITM-NBR                   12380000
112400     OR  PS-SLS-CSR-END                                           12390000
112500****     UPDATE THE CORPORATE ROW FOR THIS ITEM                   12400000
112600         MOVE PV-PREV-ITM-NBR TO TSKST-ITEM-NMBR                  12410000
112700         MOVE ZERO            TO TSKST-LOC-NBR                    12420000
112800         PERFORM 7300-READ-TSKST-FOR-SALES                        12430000
PE7819         IF PS-DELETE-TSKST-ITM-SW = 'N'                          12440000
112900            PERFORM 4230-FORMAT-SLS-CORP-UPDT                     12450000
113000            PERFORM 7400-UPDT-TSKST-FOR-SALES                     12460000
113100****     UPDATE TRAN STATUS ON THE SALES AUDIT TABLE              12470000
113200            PERFORM 7900-UPDT-SLS-TRAN-TO-CMPLT                   12480000
PE7819         ELSE                                                     12490000
PE7819            PERFORM 4240-UPDATE-SLS-AUDIT-TBL                     12500000
PE7819         END-IF                                                   12510000
113300****     PERFORM CHECKPOINT PROCESSING                            12520000
113400         ADD  PV-ITEM-TOT-CHRGD-AMT TO CR-TOT-SLS-AMT             12530000
113500         PERFORM 8200-COMMIT-PROCESSING                           12540000
113600****     INITIALIZE ITEM SALES VARIABLES                          12550000
113700         MOVE FST00005-ITM-NBR TO PV-PREV-ITM-NBR                 12560000
113800         MOVE +0     TO PV-ITEM-TOT-SLD-QTY                       12570000
113900                        PV-ITEM-TOT-CHRGD-AMT                     12580000
114000         MOVE SPACES TO PV-FIRST-SALE-DATE                        12590000
114100                        PV-LAST-SALE-DATE                         12600000
114200     END-IF.                                                      12610000
114300                                                                  12620000
114400                                                                  12630000
114500******************************************************************12640000
114600*  FORMAT THE SALES DATA TO UPDATE A SPECIFIC ITEM/STORE ROW      12650000
114700*  ON TSKST.                                                      12660000
114800******************************************************************12670000
114900 4210-FORMAT-SLS-FOR-UPDT.                                        12680000
115000                                                                  12690000
115100     SUBTRACT WS-SUM-TOT-SLD-QTY FROM TSKST-ONHAND-QTY.           12700000
115200                                                                  12710000
PE9054     ADD WS-SUM-TOT-SLD-QTY   TO TSKST-YTD-SALES-UNIT-QTY.        12720000
PE9054     ADD WS-SUM-TOT-CHRGD-AMT TO TSKST-YTD-SALES-AMT.             12730000
115500                                                                  12740000
115600     IF  TSKST-FIRST-SALE-DATE = 0                                12750000
115700****     CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT           12760000
115800         MOVE WS-MIN-SALE-DTE TO PV-TSKST-DATE-X10                12770000
115900         PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                    12780000
116000         MOVE PV-TSKST-DATE-YYMMDD TO TSKST-FIRST-SALE-DATE       12790000
116100     ELSE                                                         12800000
116200****     CONVERT TSKST DATE TO STANDARD DB2 DATE FORMAT           12810000
116300         MOVE TSKST-FIRST-SALE-DATE TO PV-TSKST-DATE-YYMMDD       12820000
116400         PERFORM 6200-CONVERT-DATE-DEC7-TO-X10                    12830000
116500         IF  WS-MIN-SALE-DTE < PV-TSKST-DATE-X10                  12840000
116600****         CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT       12850000
116700             MOVE WS-MIN-SALE-DTE TO PV-TSKST-DATE-X10            12860000
116800             PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                12870000
116900             MOVE PV-TSKST-DATE-YYMMDD TO TSKST-FIRST-SALE-DATE   12880000
117000         END-IF                                                   12890000
117100     END-IF.                                                      12900000
117200                                                                  12910000
117300     IF  TSKST-LAST-SALE-DATE = 0                                 12920000
117400****     CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT           12930000
117500         MOVE WS-MAX-SALE-DTE TO PV-TSKST-DATE-X10                12940000
117600         PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                    12950000
117700         MOVE PV-TSKST-DATE-YYMMDD TO TSKST-LAST-SALE-DATE        12960000
117800     ELSE                                                         12970000
117900****     CONVERT TSKST DATE TO STANDARD DB2 DATE FORMAT           12980000
118000         MOVE TSKST-LAST-SALE-DATE TO PV-TSKST-DATE-YYMMDD        12990000
118100         PERFORM 6200-CONVERT-DATE-DEC7-TO-X10                    13000000
118200         IF  WS-MAX-SALE-DTE > PV-TSKST-DATE-X10                  13010000
118300****         CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT       13020000
118400             MOVE WS-MAX-SALE-DTE TO PV-TSKST-DATE-X10            13030000
118500             PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                13040000
118600             MOVE PV-TSKST-DATE-YYMMDD TO TSKST-LAST-SALE-DATE    13050000
118700         END-IF                                                   13060000
118800     END-IF.                                                      13070000
118900                                                                  13080000
119000                                                                  13090000
119100******************************************************************13100000
119200*  FORMAT THE SALES DATA TO INSERT A SPECIFIC ITEM/STORE ROW      13110000
119300*  TO TSKST.                                                      13120000
119400******************************************************************13130000
119500 4220-FORMAT-SLS-FOR-ISRT.                                        13140000
119600                                                                  13150000
119700     INITIALIZE DCLTSKST.                                         13160000
119800                                                                  13170000
119900     MOVE FST00005-ITM-NBR TO TSKST-ITEM-NMBR.                    13180000
120000     MOVE FST00005-LOC-NBR TO TSKST-LOC-NBR.                      13190000
120200                                                                  13200000
120300     SUBTRACT WS-SUM-TOT-SLD-QTY FROM TSKST-ONHAND-QTY.           13210000
120400                                                                  13220000
PE9054     ADD WS-SUM-TOT-SLD-QTY   TO TSKST-YTD-SALES-UNIT-QTY.        13230000
PE9054     ADD WS-SUM-TOT-CHRGD-AMT TO TSKST-YTD-SALES-AMT.             13240000
120700                                                                  13250000
120800**** CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT               13260000
120900     MOVE WS-MIN-SALE-DTE TO PV-TSKST-DATE-X10.                   13270000
121000     PERFORM 6300-CONVERT-DATE-X10-TO-DEC7.                       13280000
121100     MOVE PV-TSKST-DATE-YYMMDD TO TSKST-FIRST-SALE-DATE.          13290000
121200                                                                  13300000
121300**** CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT               13310000
121400     MOVE WS-MAX-SALE-DTE TO PV-TSKST-DATE-X10.                   13320000
121500     PERFORM 6300-CONVERT-DATE-X10-TO-DEC7.                       13330000
121600     MOVE PV-TSKST-DATE-YYMMDD TO TSKST-LAST-SALE-DATE.           13340000
121700                                                                  13350000
121800                                                                  13360000
121900******************************************************************13370000
122000*  FORMAT THE SALES DATA TO UPDATE THE CORPORATE ROW              13380000
122100*  (STORE 000) FOR THE ITEM.                                      13390000
122200******************************************************************13400000
122300 4230-FORMAT-SLS-CORP-UPDT.                                       13410000
122400                                                                  13420000
122500     SUBTRACT PV-ITEM-TOT-SLD-QTY FROM TSKST-ONHAND-QTY.          13430000
122600                                                                  13440000
PE9054     ADD PV-ITEM-TOT-SLD-QTY   TO TSKST-YTD-SALES-UNIT-QTY.       13450000
PE9054     ADD PV-ITEM-TOT-CHRGD-AMT TO TSKST-YTD-SALES-AMT.            13460000
122900                                                                  13470000
123000**** UPDATE THE STORE 000 ROW WITH THE EARLIEST FIRST SALE DATE   13480000
123100     IF  TSKST-FIRST-SALE-DATE = 0                                13490000
123200****     CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT           13500000
123300         MOVE PV-FIRST-SALE-DATE TO PV-TSKST-DATE-X10             13510000
123400         PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                    13520000
123500         MOVE PV-TSKST-DATE-YYMMDD TO TSKST-FIRST-SALE-DATE       13530000
123600     ELSE                                                         13540000
123700****     CONVERT TSKST DATE TO STANDARD DB2 DATE FORMAT           13550000
123800         MOVE TSKST-FIRST-SALE-DATE TO PV-TSKST-DATE-YYMMDD       13560000
123900         PERFORM 6200-CONVERT-DATE-DEC7-TO-X10                    13570000
124000         IF  PV-FIRST-SALE-DATE < PV-TSKST-DATE-X10               13580000
124100****         CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT       13590000
124200             MOVE PV-FIRST-SALE-DATE TO PV-TSKST-DATE-X10         13600000
124300             PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                13610000
124400             MOVE PV-TSKST-DATE-YYMMDD TO TSKST-FIRST-SALE-DATE   13620000
124500         END-IF                                                   13630000
124600     END-IF.                                                      13640000
124700                                                                  13650000
124800**** UPDATE THE STORE 000 ROW WITH THE LATEST LAST SALE DATE      13660000
124900     IF  TSKST-LAST-SALE-DATE = 0                                 13670000
125000****     CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT           13680000
125100         MOVE PV-LAST-SALE-DATE TO PV-TSKST-DATE-X10              13690000
125200         PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                    13700000
125300         MOVE PV-TSKST-DATE-YYMMDD TO TSKST-LAST-SALE-DATE        13710000
125400     ELSE                                                         13720000
125500****     CONVERT TSKST DATE TO STANDARD DB2 DATE FORMAT           13730000
125600         MOVE TSKST-LAST-SALE-DATE TO PV-TSKST-DATE-YYMMDD        13740000
125700         PERFORM 6200-CONVERT-DATE-DEC7-TO-X10                    13750000
125800         IF  PV-LAST-SALE-DATE > PV-TSKST-DATE-X10                13760000
125900****         CONVERT STANDARD DB2 DATE TO TSKST DATE FORMAT       13770000
126000             MOVE PV-LAST-SALE-DATE TO PV-TSKST-DATE-X10          13780000
126100             PERFORM 6300-CONVERT-DATE-X10-TO-DEC7                13790000
126200             MOVE PV-TSKST-DATE-YYMMDD TO TSKST-LAST-SALE-DATE    13800000
126300         END-IF                                                   13810000
126400     END-IF.                                                      13820000
126500                                                                  13830000
126600                                                                  13840000
PE7819******************************************************************13850000
PE7819*  UPDATE THE SALES AUDIT TABLE WITH STATUS CODE OF ERROR 004 TYPE13860000
PE7819******************************************************************13870000
PE7819 4240-UPDATE-SLS-AUDIT-TBL.                                       13880000
PE7819                                                                  13890000
PE7819     PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     13900000
PE7819       UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      13910000
PE7819                                                                  13920000
PE7819       EXEC SQL                                                   13930000
PE7819         UPDATE FSTT_OH_SLS_AUD                                   13940000
PE7819          SET TRN_STAT_CDE  = 'E'                                 13950000
PE7819           , ERR_TYP_CDE   = '004'                                13960000
PE7819           , LAST_UPD_TMST =  CURRENT TIMESTAMP                   13970000
PE7819         WHERE PRCG_DTE = :PV-PROCESS-DATE-10                     13980000
PE7819          AND ITM_NBR  = :TSKST-ITEM-NMBR                         13990000
PE7819          AND TRN_STAT_CDE = 'A'                                  14000000
PE7819       END-EXEC                                                   14010000
PE7819                                                                  14020000
PE7819       EVALUATE TRUE                                              14030000
PE7819                                                                  14040000
PE7819          WHEN SQLCODE = +0                                       14050000
PE7819              MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT         14060000
PE7819          WHEN SQLCODE = -904                                     14070000
PE7819          WHEN SQLCODE = -913                                     14080000
PE7819              CONTINUE                                            14090000
PE7819          WHEN OTHER                                              14100000
PE7819              DISPLAY 'SQLCODE IS ' SQLCODE                       14110000
PE7819              MOVE '4240-UPDATE-SLS-AUDIT-TBL' TO                 14120000
PE7819                                      PV-PARAGRAPH-NAME           14130000
PE7819              MOVE 'UPDATE OF SALES AUDIT TABLE' TO               14140000
PE7819                  PV-DB2-OPERATION-ATTEMPTED                      14150000
PE7819              PERFORM 9999-SQL-ABEND                              14160000
PE7819       END-EVALUATE                                               14170000
PE7819     END-PERFORM.                                                 14180000
PE7819                                                                  14190000
PE7819     IF (SQLCODE > 0                                              14200000
PE7819     OR  SQLCODE < 0)                                             14210000
PE7819         DISPLAY '**********************************'             14220000
PE7819         DISPLAY 'ITM_NBR = ' SKXREF-ITM-NBR                      14230000
PE7819         DISPLAY '**********************************'             14240000
PE7819         MOVE '4240-UPDATE-SLS-AUDIT-TBL'                         14250000
PE7819           TO  PV-PARAGRAPH-NAME                                  14260000
PE7819         MOVE 'MAX RETRIES EXCEEDED'                              14270000
PE7819           TO  PV-DB2-OPERATION-ATTEMPTED                         14280000
PE7819         PERFORM 9999-SQL-ABEND                                   14290000
PE7819     END-IF.                                                      14300000
PE7819                                                                  14310000
PE7819                                                                  14320000
PE7819******************************************************************14330000
PE7819* UPDATE THE RECEIPT AUDIT TABLE WITH STATUS CODE OF ERROR 004 TYP14340000
PE7819******************************************************************14350000
PE7819 4250-UPDATE-RCT-AUDIT-TBL.                                       14360000
PE7819                                                                  14370000
PE7819     PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     14380000
PE7819       UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      14390000
PE7819                                                                  14400000
PE7819       EXEC SQL                                                   14410000
PE7819         UPDATE FSTT_OH_RCPT_AUD                                  14420000
PE7819           SET TRN_STAT_CDE  = 'E'                                14430000
PE7819            , ERR_TYP_CDE   = '004'                               14440000
PE7819            , LAST_UPD_TMST =  CURRENT TIMESTAMP                  14450000
PE7819         WHERE PRCG_DTE = :PV-PROCESS-DATE-10                     14460000
PE7819         AND ITM_NBR  = :TSKST-ITEM-NMBR                          14470000
PE7819         AND TRN_STAT_CDE = 'A'                                   14480000
RONNA          AND SRC_PGM_NM NOT IN ('GVKUT015')                       14481010
PE7819       END-EXEC                                                   14490000
PE7819                                                                  14500000
PE7819       EVALUATE TRUE                                              14510000
PE7819                                                                  14520000
PE7819          WHEN SQLCODE = +0                                       14530000
PE7819              MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT         14540000
PE7819          WHEN SQLCODE = -904                                     14550000
PE7819          WHEN SQLCODE = -913                                     14560000
PE7819              CONTINUE                                            14570000
PE7819          WHEN OTHER                                              14580000
PE7819              DISPLAY 'SQLCODE IS ' SQLCODE                       14590000
PE7819              MOVE '4250-UPDATE-RCT-AUDIT-TBL' TO                 14600000
PE7819                                     PV-PARAGRAPH-NAME            14610000
PE7819              MOVE 'UPDATE OF RECEIPT AUDIT TABLE' TO             14620000
PE7819                  PV-DB2-OPERATION-ATTEMPTED                      14630000
PE7819              PERFORM 9999-SQL-ABEND                              14640000
PE7819       END-EVALUATE                                               14650000
PE7819     END-PERFORM.                                                 14660000
PE7819                                                                  14670000
PE7819     IF (SQLCODE > 0                                              14680000
PE7819     OR  SQLCODE < 0)                                             14690000
PE7819         DISPLAY '**********************************'             14700000
PE7819         DISPLAY 'ITM_NBR = ' SKXREF-ITM-NBR                      14710000
PE7819         DISPLAY '**********************************'             14720000
PE7819         MOVE '4250-UPDATE-RCT-AUDIT-TBL'                         14730000
PE7819           TO  PV-PARAGRAPH-NAME                                  14740000
PE7819         MOVE 'MAX RETRIES EXCEEDED'                              14750000
PE7819           TO  PV-DB2-OPERATION-ATTEMPTED                         14760000
PE7819         PERFORM 9999-SQL-ABEND                                   14770000
PE7819     END-IF.                                                      14780000
PE7819                                                                  14790000
RONNA ******************************************************************14791010
RONNA * UPDATE THE RECEIPT AUDIT TABLE WITH STATUS CODE OF ERROR 004 TYP14792010
RONNA ******************************************************************14793010
RONNA  4255-UPDATE-RCT2-AUDIT-TBL.                                      14794010
RONNA                                                                   14795010
RONNA      PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     14796010
RONNA        UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      14797010
RONNA                                                                   14798010
RONNA        EXEC SQL                                                   14799010
RONNA          UPDATE FSTT_OH_RCPT_AUD                                  14799110
RONNA            SET TRN_STAT_CDE  = 'E'                                14799210
RONNA             , ERR_TYP_CDE   = '004'                               14799310
RONNA             , LAST_UPD_TMST =  CURRENT TIMESTAMP                  14799410
RONNA          WHERE PRCG_DTE = :PV-PROCESS-DATE-10                     14799510
RONNA          AND ITM_NBR  = :TSKST-ITEM-NMBR                          14799610
RONNA          AND TRN_STAT_CDE = 'A'                                   14799710
RONNA          AND SRC_PGM_NM IN ('GVKUT015')                           14799810
RONNA        END-EXEC                                                   14799910
RONNA                                                                   14800010
RONNA        EVALUATE TRUE                                              14800110
RONNA                                                                   14800210
RONNA           WHEN SQLCODE = +0                                       14800310
RONNA               MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT         14800410
RONNA           WHEN SQLCODE = -904                                     14800510
RONNA           WHEN SQLCODE = -913                                     14800610
RONNA               CONTINUE                                            14800710
RONNA           WHEN OTHER                                              14800810
RONNA               DISPLAY 'SQLCODE IS ' SQLCODE                       14800910
RONNA               MOVE '4255-UPDATE-RCT2-AUDIT-TBL' TO                14801010
RONNA                                      PV-PARAGRAPH-NAME            14801110
RONNA               MOVE 'UPDATE OF RECEIPT AUDIT TABLE' TO             14801210
RONNA                   PV-DB2-OPERATION-ATTEMPTED                      14801310
RONNA               PERFORM 9999-SQL-ABEND                              14801410
RONNA        END-EVALUATE                                               14801510
RONNA      END-PERFORM.                                                 14801610
RONNA                                                                   14801710
RONNA      IF (SQLCODE > 0                                              14801810
RONNA      OR  SQLCODE < 0)                                             14801910
RONNA          DISPLAY '**********************************'             14802010
RONNA          DISPLAY 'ITM_NBR = ' SKXREF-ITM-NBR                      14802110
RONNA          DISPLAY '**********************************'             14802210
RONNA          MOVE '4255-UPDATE-RCT2-AUDIT-TBL'                        14802310
RONNA            TO  PV-PARAGRAPH-NAME                                  14802410
RONNA          MOVE 'MAX RETRIES EXCEEDED'                              14802510
RONNA            TO  PV-DB2-OPERATION-ATTEMPTED                         14802610
RONNA          PERFORM 9999-SQL-ABEND                                   14802710
RONNA      END-IF.                                                      14802810
RONNA                                                                   14802910
126700******************************************************************14803000
126800*  FETCH THE SALES CURSOR                                         14810000
126900******************************************************************14820000
127000 4300-FETCH-SLS-CSR.                                              14830000
127100                                                                  14840000
127200     EXEC SQL                                                     14850000
127300         FETCH OH_SLS_CSR                                         14860000
127400         INTO :FST00005-ITM-NBR                                   14870000
127500            , :FST00005-LOC-NBR                                   14880000
127600            , :WS-MIN-SALE-DTE                                    14890000
127700            , :WS-MAX-SALE-DTE                                    14900000
127800            , :WS-SUM-TOT-SLD-QTY                                 14910000
127900            , :WS-SUM-TOT-CHRGD-AMT                               14920000
128000     END-EXEC.                                                    14930000
128100                                                                  14940000
128200     EVALUATE SQLCODE                                             14950000
128300       WHEN +0                                                    14960000
128400            ADD +1 TO CR-OH-SLS-FETCH-CNT                         14970000
128500       WHEN +100                                                  14980000
128600            SET PS-SLS-CSR-END TO TRUE                            14990000
128700       WHEN OTHER                                                 15000000
128800            MOVE '4300-FETCH-SLS-CSR' TO PV-PARAGRAPH-NAME        15010000
128900            MOVE 'FETCH ON SALES CURSOR' TO                       15020000
129000                  PV-DB2-OPERATION-ATTEMPTED                      15030000
129100            PERFORM 9999-SQL-ABEND                                15040000
129200     END-EVALUATE.                                                15050000
129300                                                                  15060000
129400                                                                  15070000
129500******************************************************************15080000
129600*  CLOSE THE ON-HAND SALES CURSOR                                 15090000
129700******************************************************************15100000
129800 4400-CLOSE-SLS-CSR.                                              15110000
129900                                                                  15120000
130000     EXEC SQL                                                     15130000
130100         CLOSE OH_SLS_CSR                                         15140000
130200     END-EXEC.                                                    15150000
130300                                                                  15160000
130400     EVALUATE TRUE                                                15170000
130500         WHEN SQLCODE = +0                                        15180000
130600             CONTINUE                                             15190000
130700         WHEN OTHER                                               15200000
130800             MOVE '4400-CLOSE-SLS-CSR '                           15210000
130900               TO  PV-PARAGRAPH-NAME                              15220000
131000             MOVE 'CLOSE ON SALES CURSOR '                        15230000
131100               TO  PV-DB2-OPERATION-ATTEMPTED                     15240000
131200             PERFORM 9999-SQL-ABEND                               15250000
131300     END-EVALUATE.                                                15260000
131400                                                                  15270000
131500                                                                  15280000
131600******************************************************************15290000
131700*  ADJUST THE TSKST ON-HAND QTY BASED ON THE ACTION CODE          15300000
131800******************************************************************15310000
131900 6000-ADJUST-TSKST-OH-QTY.                                        15320000
132000                                                                  15330000
132100     EVALUATE FST00003-ACTN-CDE                                   15340000
132200         WHEN PC-ACTN-ADD                                         15350000
132300              ADD FST00003-ADJ-QTY TO TSKST-ONHAND-QTY            15360000
132400         WHEN PC-ACTN-SUBTRACT                                    15370000
132500              SUBTRACT FST00003-ADJ-QTY FROM TSKST-ONHAND-QTY     15380000
132600         WHEN PC-ACTN-REPLACE                                     15390000
132700              IF  TSKST-LOC-NBR = ZERO                            15400000
132800                  SUBTRACT PV-ONHAND-QTY FROM TSKST-ONHAND-QTY    15410000
132900                  ADD  FST00003-ADJ-QTY  TO   TSKST-ONHAND-QTY    15420000
133000              ELSE                                                15430000
133100                  MOVE FST00003-ADJ-QTY TO TSKST-ONHAND-QTY       15440000
133200              END-IF                                              15450000
133300     END-EVALUATE.                                                15460000
133400                                                                  15470000
133500                                                                  15480000
RONNA ******************************************************************15481010
RONNA *  APPLY RECEIPTS TO TSKST ON-HAND WITHOUT UPDATING RECEIPT DATE  15482010
RONNA ******************************************************************15483010
RONNA  5000-RECEIPTS-WO-RCPT-DATE.                                      15484011
RONNA                                                                   15485010
RONNA      PERFORM 5100-OPEN-RCPT-CSR.                                  15486010
RONNA      PERFORM 5300-FETCH-RCPT-CSR.                                 15487010
RONNA                                                                   15488010
RONNA      IF  PS-RCPT2-CSR-END                                         15489013
RONNA          DISPLAY ' '                                              15489110
RONNA          DISPLAY '*****************************************'      15489210
RONNA          DISPLAY ' NO RECEIPTS PROCESSED FOR ' PV-PROCESS-DATE-10 15489310
RONNA          DISPLAY ' WHERE RECEIPT DATES DO NOT NEED TO BE   '      15489410
RONNA          DISPLAY ' BE UPDATED                              '      15489510
RONNA          DISPLAY '*****************************************'      15489610
RONNA          DISPLAY ' '                                              15489710
RONNA      ELSE                                                         15489810
RONNA          PERFORM 5200-PROCESS-RCPT-TRANS                          15489910
RONNA              UNTIL PS-RCPT2-CSR-END                               15490013
RONNA          PERFORM 9250-END-OF-RCPT                                 15490110
RONNA      END-IF.                                                      15490210
RONNA                                                                   15490310
RONNA      PERFORM 5400-CLOSE-RCPT-CSR.                                 15490410
RONNA                                                                   15490510
RONNA                                                                   15490610
RONNA ******************************************************************15490710
RONNA *  OPEN THE ON-HAND RECEIPTS CURSOR                               15490810
RONNA ******************************************************************15490910
RONNA  5100-OPEN-RCPT-CSR.                                              15491010
RONNA                                                                   15491110
RONNA      EXEC SQL                                                     15491210
RONNA          OPEN OH_RCPT2_CSR                                        15491310
RONNA      END-EXEC.                                                    15491410
RONNA                                                                   15491510
RONNA      EVALUATE TRUE                                                15491610
RONNA          WHEN SQLCODE = +0                                        15491710
RONNA              CONTINUE                                             15491810
RONNA          WHEN OTHER                                               15491910
RONNA              MOVE '5100-OPEN-RCPT-CSR '                           15492010
RONNA                TO  PV-PARAGRAPH-NAME                              15492110
RONNA              MOVE 'OPEN ON RECEIPTS CURSOR '                      15492210
RONNA                TO  PV-DB2-OPERATION-ATTEMPTED                     15492310
RONNA              PERFORM 9999-SQL-ABEND                               15492410
RONNA      END-EVALUATE.                                                15492510
RONNA                                                                   15492610
RONNA                                                                   15492710
RONNA ******************************************************************15492810
RONNA *  PROCESS THE RECEIPT DATA FOR THE CURRENT ITEM/LOCATION         15492910
RONNA ******************************************************************15493010
RONNA  5200-PROCESS-RCPT-TRANS.                                         15493110
RONNA                                                                   15493210
RONNA      MOVE 'N' TO PS-DELETE-TSKST-ITM-SW.                          15493310
RONNA **** SELECT THE SPECIFIC ITEM/STORE ROW FROM TSKST                15493410
RONNA      MOVE FST00004-ITM-NBR TO TSKST-ITEM-NMBR.                    15493510
RONNA      MOVE FST00004-LOC-NBR TO TSKST-LOC-NBR.                      15493610
RONNA      PERFORM 7000-READ-TSKST-FOR-ADJ-RCPT.                        15493710
RONNA                                                                   15493810
RONNA      EVALUATE SQLCODE                                             15493910
RONNA          WHEN 000                                                 15494010
RONNA ********      UPDATE THE SPECIFIC ITEM/STORE ROW                  15494110
RONNA               PERFORM 5210-FORMAT-RCPT-FOR-UPDT                   15494210
RONNA               PERFORM 7100-UPDT-TSKST-FOR-ADJ-RCPT                15494310
RONNA          WHEN +100                                                15494410
RONNA ********      INSERT THE SPECIFIC ITEM/STORE ROW                  15494510
RONNA               PERFORM 5220-FORMAT-RCPT-FOR-ISRT                   15494610
RONNA               PERFORM 7200-ISRT-TSKST-FOR-ADJ-RCPT                15494710
RONNA      END-EVALUATE.                                                15494810
RONNA                                                                   15494910
RONNA **** SAVE THE ITEM NUMBER TO COMPARE AGAINST THE NEXT ITEM        15495010
RONNA **** NUMBER FETCHED                                               15495110
RONNA      MOVE FST00004-ITM-NBR TO PV-PREV-ITM-NBR.                    15495210
RONNA                                                                   15495310
RONNA **** ACCUMULATE THE TOTAL ITEM RECEIPT QTY TO USE WHEN            15495410
RONNA **** UPDATING STORE 000                                           15495510
RONNA      ADD WS-SUM-LOC-RCPT-QTY TO PV-ITEM-TOT-RCPT-QTY.             15495610
RONNA                                                                   15495710
RONNA **** KEEP THIS ITEM'S EARLIEST FIRST RECEIPT DATE TO USE WHEN     15495810
RONNA **** UPDATING STORE 000                                           15495910
RONNA      IF  PV-FIRST-RCVD-DATE = SPACES                              15496010
RONNA          MOVE WS-MIN-VRFD-DTE TO PV-FIRST-RCVD-DATE               15496110
RONNA      ELSE                                                         15496210
RONNA          IF  WS-MIN-VRFD-DTE < PV-FIRST-RCVD-DATE                 15496310
RONNA              MOVE WS-MIN-VRFD-DTE TO PV-FIRST-RCVD-DATE           15496410
RONNA          END-IF                                                   15496510
RONNA      END-IF.                                                      15496610
RONNA                                                                   15496710
RONNA **** KEEP THIS ITEM'S LATEST LAST RECEIPT DATE TO USE WHEN        15496810
RONNA **** UPDATING STORE 000                                           15496910
RONNA      IF  PV-LAST-RCVD-DATE = SPACES                               15497010
RONNA          MOVE WS-MAX-VRFD-DTE TO PV-LAST-RCVD-DATE                15497110
RONNA      ELSE                                                         15497210
RONNA          IF  WS-MAX-VRFD-DTE > PV-LAST-RCVD-DATE                  15497310
RONNA              MOVE WS-MAX-VRFD-DTE TO PV-LAST-RCVD-DATE            15497410
RONNA          END-IF                                                   15497510
RONNA      END-IF.                                                      15497610
RONNA                                                                   15497710
RONNA **** FETCH RECEIPT DATA FOR THE NEXT ITEM/LOCATION                15497810
RONNA      PERFORM 5300-FETCH-RCPT-CSR.                                 15497910
RONNA                                                                   15498010
RONNA **** WHEN A NEW ITEM IS ENCOUNTERED, UPDATE THE CORPORATE ROW     15498110
RONNA **** (STORE 000) FOR THE PREVIOUS ITEM.                           15498210
RONNA                                                                   15498310
RONNA **** ALSO, AT THIS POINT A LOGICAL UNIT OF WORK HAS BEEN          15498410
RONNA **** COMPLETED (COMPLETED UPDATING RECEIPTS FOR ONE ITEM).        15498510
RONNA **** THEREFORE, PERFORM CHECKPOINT PROCESSING.                    15498610
RONNA                                                                   15498710
RONNA      IF  FST00004-ITM-NBR NOT = PV-PREV-ITM-NBR                   15498810
RONNA      OR  PS-RCPT2-CSR-END                                         15498913
RONNA ****     UPDATE THE CORPORATE ROW FOR THIS ITEM                   15499010
RONNA          MOVE PV-PREV-ITM-NBR TO TSKST-ITEM-NMBR                  15499110
RONNA          MOVE ZERO            TO TSKST-LOC-NBR                    15499210
RONNA          PERFORM 7000-READ-TSKST-FOR-ADJ-RCPT                     15499310
RONNA          IF PS-DELETE-TSKST-ITM-SW = 'N'                          15499410
RONNA             PERFORM 5230-FORMAT-RCPT-CORP-UPDT                    15499510
RONNA             PERFORM 7100-UPDT-TSKST-FOR-ADJ-RCPT                  15499610
RONNA ****     UPDATE TRAN STATUS ON THE RECEIPT AUDIT TABLE            15499710
RONNA             PERFORM 7850-UPDT-RCPT2-TRAN-TO-CMPLT                 15499814
RONNA          ELSE                                                     15499910
RONNA             PERFORM 4250-UPDATE-RCT-AUDIT-TBL                     15500010
RONNA          END-IF                                                   15500110
RONNA ****     PERFORM CHECKPOINT PROCESSING                            15500210
RONNA          PERFORM 8200-COMMIT-PROCESSING                           15500310
RONNA ****     INITIALIZE ITEM RECEIPT VARIABLES                        15500410
RONNA          MOVE FST00004-ITM-NBR TO PV-PREV-ITM-NBR                 15500510
RONNA          MOVE +0     TO PV-ITEM-TOT-RCPT-QTY                      15500610
RONNA          MOVE SPACES TO PV-FIRST-RCVD-DATE                        15500710
RONNA                         PV-LAST-RCVD-DATE                         15500810
RONNA      END-IF.                                                      15500910
RONNA                                                                   15501010
RONNA                                                                   15501110
RONNA ******************************************************************15501210
RONNA *  FORMAT THE RECEIPT DATA TO UPDATE A SPECIFIC ITEM/STORE ROW    15501310
RONNA *  ON TSKST.                                                      15501410
RONNA *  THE FIRST AND LAST RECEIPT DATES SHOULD STAY THE SAME          15501512
RONNA *  NOT MAPPING NEW VALUES TO THE RECEIPT DATES                    15501612
RONNA ******************************************************************15501712
RONNA  5210-FORMAT-RCPT-FOR-UPDT.                                       15501812
RONNA                                                                   15501912
RONNA      ADD WS-SUM-LOC-RCPT-QTY TO TSKST-ONHAND-QTY.                 15502012
RONNA                                                                   15502112
RONNA *                                                                 15502212
RONNA                                                                   15505612
RONNA                                                                   15505712
RONNA ******************************************************************15505812
RONNA *  FORMAT THE RECEIPT DATA TO INSERT A SPECIFIC ITEM/STORE ROW    15505912
RONNA *  TO TSKST.                                                      15506012
RONNA *  FOR AN INSERT THE FIRST AND LAST RECEIPT DATES WILL BE 0       15506112
RONNA *  BECAUSE THIS TYPE OF RECEIPT TRANSACTION DOES NOT NEED         15506212
RONNA *  THE FIRST AND LAST RECEIPT DATE UPDATED.                       15506312
RONNA ******************************************************************15506412
RONNA  5220-FORMAT-RCPT-FOR-ISRT.                                       15506512
RONNA                                                                   15506612
RONNA      INITIALIZE DCLTSKST.                                         15506712
RONNA                                                                   15506812
RONNA      MOVE FST00004-ITM-NBR TO TSKST-ITEM-NMBR.                    15506912
RONNA      MOVE FST00004-LOC-NBR TO TSKST-LOC-NBR.                      15507012
RONNA                                                                   15507112
RONNA      MOVE WS-SUM-LOC-RCPT-QTY TO TSKST-ONHAND-QTY.                15507212
RONNA                                                                   15507312
RONNA **** MOVE ZERO TO FIRST RECEIVED DATE                             15507412
RONNA      MOVE ZERO                 TO TSKST-FIRST-RCVD-DATE.          15507712
RONNA                                                                   15507812
RONNA **** MOVE ZERO TO LAST RECEIVED DATE                              15507912
RONNA      MOVE ZERO                 TO TSKST-LAST-RCVD-DATE.           15508212
RONNA                                                                   15508312
RONNA                                                                   15508412
RONNA ******************************************************************15508512
RONNA *  FORMAT THE RECEIPT DATA TO UPDATE THE CORPORATE ROW            15508612
RONNA *  (STORE 000) FOR THE ITEM.                                      15508712
RONNA ******************************************************************15508812
RONNA  5230-FORMAT-RCPT-CORP-UPDT.                                      15508912
RONNA                                                                   15509012
RONNA      ADD PV-ITEM-TOT-RCPT-QTY TO TSKST-ONHAND-QTY.                15509112
RONNA                                                                   15509212
RONNA                                                                   15512812
RONNA                                                                   15512912
RONNA ******************************************************************15513012
RONNA *  FETCH THE RECEIPTS CURSOR                                      15513112
RONNA ******************************************************************15513212
RONNA  5300-FETCH-RCPT-CSR.                                             15513312
RONNA                                                                   15513412
RONNA      EXEC SQL                                                     15513512
RONNA          FETCH OH_RCPT2_CSR                                       15513612
RONNA          INTO :FST00004-ITM-NBR                                   15513712
RONNA             , :FST00004-LOC-NBR                                   15513812
RONNA             , :WS-MIN-VRFD-DTE                                    15513912
RONNA             , :WS-MAX-VRFD-DTE                                    15514012
RONNA             , :WS-SUM-LOC-RCPT-QTY                                15514112
RONNA      END-EXEC.                                                    15514212
RONNA                                                                   15514312
RONNA      EVALUATE SQLCODE                                             15514412
RONNA        WHEN +0                                                    15514512
RONNA             ADD +1 TO CR-OH-RCPT2-FETCH-CNT                       15514612
RONNA        WHEN +100                                                  15514712
RONNA             SET PS-RCPT2-CSR-END TO TRUE                          15514813
RONNA        WHEN OTHER                                                 15514912
RONNA             MOVE '5300-FETCH-RCPT-CSR' TO PV-PARAGRAPH-NAME       15515012
RONNA             MOVE 'FETCH ON RECEIPTS CURSOR' TO                    15515112
RONNA                   PV-DB2-OPERATION-ATTEMPTED                      15515212
RONNA             PERFORM 9999-SQL-ABEND                                15515312
RONNA      END-EVALUATE.                                                15515412
RONNA                                                                   15515512
RONNA                                                                   15515612
RONNA ******************************************************************15515712
RONNA *  CLOSE THE ON-HAND RECEIPTS CURSOR                              15515812
RONNA ******************************************************************15515912
RONNA  5400-CLOSE-RCPT-CSR.                                             15516012
RONNA                                                                   15516112
RONNA      EXEC SQL                                                     15516212
RONNA          CLOSE OH_RCPT2_CSR                                       15516312
RONNA      END-EXEC.                                                    15516412
RONNA                                                                   15516512
RONNA      EVALUATE TRUE                                                15516612
RONNA          WHEN SQLCODE = +0                                        15516712
RONNA              CONTINUE                                             15516812
RONNA          WHEN OTHER                                               15516912
RONNA              MOVE '5400-CLOSE-RCPT-CSR '                          15517012
RONNA                TO  PV-PARAGRAPH-NAME                              15517112
RONNA              MOVE 'CLOSE ON RECEIPTS CURSOR '                     15517212
RONNA                TO  PV-DB2-OPERATION-ATTEMPTED                     15517312
RONNA              PERFORM 9999-SQL-ABEND                               15517412
RONNA      END-EVALUATE.                                                15517512
RONNA                                                                   15517612
RONNA                                                                   15517712
133600******************************************************************15517812
133700*  CHECK IF THIS IS A PHYSICAL INVENTORY ADJUSTMENT               15517912
133800******************************************************************15518000
133900 6100-CHECK-IF-VALID-TRAN.                                        15520000
134000                                                                  15530000
134100     MOVE '000' TO FST00003-ERR-TYP-CDE.                          15540000
134200                                                                  15550000
134300     IF  FST00003-BTCH-NBR = PC-MSI-BATCH-NMBR                    15560000
134400     OR  FST00003-BTCH-NBR = PC-INV-BATCH-NMBR                    15570000
134500     OR  FST00003-BTCH-NBR = PC-INV-ADJ-BATCH-NMBR                15580000
OCFSFS     OR  FST00003-BTCH-NBR = PC-SFS-ADJ-BATCH-NMBR                15590000
111890     OR  FST00003-BTCH-NBR = PC-RFID-BATCH-NMBR                   15600006
GIV2FS     OR  FST00003-BTCH-NBR = PC-GIV-BATCH-NMBR                    15610007
262959     OR (FST00003-BTCH-NBR = PC-PX-BATCH-NMBR AND                 15610007
262959         PC-OH-ADJ = '121')                                       15610007
262959     OR (FST00003-BTCH-NBR = PC-PE-BATCH-NMBR AND                 15610007
262959         PC-OH-ADJ = '121')                                       15610007
134600         IF  FST00003-ADJ-QTY > ZERO                              15620000
134700             CONTINUE                                             15630000
134800         ELSE                                                     15640000
134900             MOVE '024' TO FST00003-ERR-TYP-CDE                   15650000
135000         END-IF                                                   15660000
135100     ELSE                                                         15670000
135200         MOVE '023' TO FST00003-ERR-TYP-CDE                       15680000
135300     END-IF.                                                      15690000
135400                                                                  15700000
135500                                                                  15710000
135600******************************************************************15720000
135700*  CONVERT THE TSKST DATE (DECIMAL 7,0) TO THE STANDARD DB2       15730000
135800*  DATE FORMAT (CCYY-MM-DD) FOR COMPARISON PURPOSES.              15740000
135900******************************************************************15750000
136000 6200-CONVERT-DATE-DEC7-TO-X10.                                   15760000
136100                                                                  15770000
136200     IF PV-TSKST-DATE-YY > 80                                     15780000
136300        MOVE 19 TO PV-TSKST-X10-CC                                15790000
136400     ELSE                                                         15800000
136500        MOVE 20 TO PV-TSKST-X10-CC                                15810000
136600     END-IF.                                                      15820000
136700                                                                  15830000
136800     MOVE PV-TSKST-DATE-YY TO PV-TSKST-X10-YY.                    15840000
136900     MOVE PV-TSKST-DATE-MM TO PV-TSKST-X10-MM.                    15850000
137000     MOVE PV-TSKST-DATE-DD TO PV-TSKST-X10-DD.                    15860000
137100                                                                  15870000
137200                                                                  15880000
137300******************************************************************15890000
137400*  CONVERT A DATE IN THE STANDARD DB2 DATE FORMAT (CCYY-MM-DD)    15900000
137500*  TO THE TSKST DATE FORMAT (DECIMAL 7,0).                        15910000
137600******************************************************************15920000
137700 6300-CONVERT-DATE-X10-TO-DEC7.                                   15930000
137800                                                                  15940000
137900     MOVE PV-TSKST-X10-YY TO PV-TSKST-DATE-YY.                    15950000
138000     MOVE PV-TSKST-X10-MM TO PV-TSKST-DATE-MM.                    15960000
138100     MOVE PV-TSKST-X10-DD TO PV-TSKST-DATE-DD.                    15970000
138200                                                                  15980000
138300                                                                  15990000
138400******************************************************************16000000
138500*  SELECT ONE ROW FROM TSKST FOR A SPECIFIC ITEM/STORE.           16010000
138600*  THIS PARAGRAPH IS USED FOR BOTH ADJUSTMENTS AND RECEIPTS.      16020000
138700******************************************************************16030000
138800 7000-READ-TSKST-FOR-ADJ-RCPT.                                    16040000
138900                                                                  16050000
139000     PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     16060000
139100         UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                    16070000
139200                                                                  16080000
139300       EXEC SQL                                                   16090000
139400           SELECT LAST_RCVD_DATE                                  16100000
139500                , ONHAND_QTY                                      16110000
139600                , FIRST_RCVD_DATE                                 16120000
139700             INTO :TSKST-LAST-RCVD-DATE                           16130000
139800                , :TSKST-ONHAND-QTY                               16140000
139900                , :TSKST-FIRST-RCVD-DATE                          16150000
140000             FROM TSKST                                           16160000
140100            WHERE ITEM_NMBR  = :TSKST-ITEM-NMBR                   16170000
140200              AND LOC_NBR    = :TSKST-LOC-NBR                     16180000
140300       END-EXEC                                                   16190000
140400                                                                  16200000
140500       EVALUATE TRUE                                              16210000
140600           WHEN SQLWARN0 NOT = SPACES                             16220000
140700                MOVE '7000-READ-TSKST-FOR-ADJ-RCPT'               16230000
140800                  TO  PV-PARAGRAPH-NAME                           16240000
140900                MOVE 'READ TSKST RECORD'                          16250000
141000                  TO  PV-DB2-OPERATION-ATTEMPTED                  16260000
141100                PERFORM 9999-SQL-ABEND                            16270000
141200           WHEN SQLCODE = ZERO                                    16280000
141300                IF  TSKST-LOC-NBR NOT = ZERO                      16290000
141400                    MOVE TSKST-ONHAND-QTY TO PV-ONHAND-QTY        16300000
141500                END-IF                                            16310000
141600                ADD  +1 TO CR-TSKST-READ-CNT                      16320000
141700                MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT       16330000
141800           WHEN SQLCODE = +100                                    16340000
141900                MOVE +0 TO PV-ONHAND-QTY                          16350000
142000                ADD  +1 TO CR-TSKST-READ-CNT                      16360000
142100                MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT       16370000
142200           WHEN SQLCODE = -904                                    16380000
PE5823*          WHEN SQLCODE = -911                                    16390000
142400           WHEN SQLCODE = -913                                    16400000
142500                CONTINUE                                          16410000
142600           WHEN ANY                                               16420000
142700                MOVE '7000-READ-TSKST-FOR-ADJ-RCPT'               16430000
142800                  TO  PV-PARAGRAPH-NAME                           16440000
142900                MOVE 'READ TSKST RECORD'                          16450000
143000                  TO  PV-DB2-OPERATION-ATTEMPTED                  16460000
143100                PERFORM 9999-SQL-ABEND                            16470000
143200       END-EVALUATE                                               16480000
143300                                                                  16490000
143400     END-PERFORM.                                                 16500000
143500                                                                  16510000
143600     IF  SQLCODE = +100                                           16520000
143700     AND TSKST-LOC-NBR = ZERO                                     16530000
PE7819         PERFORM 7310-CHECK-TSKXREF                               16540000
PE7819         IF PS-ITM-NOT-IN-TSKXREF                                 16550000
PE7819            PERFORM 7320-DELETE-TSKST                             16560000
PE7819            MOVE 'Y' TO PS-DELETE-TSKST-ITM-SW                    16570000
PE7819            DISPLAY '*** 7000-READ-TSKST-FOR-ADJ-RCPT: '          16580000
PE7819            'TSKST CORPORATE ROW NOT FOUND'                       16590000
PE7819            DISPLAY '*** AUDIT TRANSACTION ERRED OUT FOR '        16600000
PE7819            'ITEM_NMBR = ' TSKST-ITEM-NMBR                        16610000
PE7819         ELSE                                                     16620000
PE7819            DISPLAY '**********************************'          16630000
PE7819            DISPLAY 'ITEM_NMBR  = ' TSKST-ITEM-NMBR               16640000
PE7819            DISPLAY 'LOC_NBR = ' TSKST-LOC-NBR                    16650000
PE7819            DISPLAY '**********************************'          16660000
PE7819            MOVE '7000-READ-TSKST-FOR-ADJ-RCPT'                   16670000
PE7819                 TO  PV-PARAGRAPH-NAME                            16680000
PE7819            MOVE 'TSKST CORPORATE ROW NOT FOUND'                  16690000
PE7819                 TO  PV-DB2-OPERATION-ATTEMPTED                   16700000
PE7819            PERFORM 9999-SQL-ABEND                                16710000
PE7819         END-IF                                                   16720000
144700     END-IF.                                                      16730000
144800                                                                  16740000
144900     IF  (SQLWARN0 NOT = SPACES                                   16750000
145000     OR  (SQLCODE > 0 AND SQLCODE NOT = +100)                     16760000
145100     OR   SQLCODE < 0)                                            16770000
145200         DISPLAY '**********************************'             16780000
145300         DISPLAY 'ITEM_NMBR  = ' TSKST-ITEM-NMBR                  16790000
145400         DISPLAY 'LOC_NBR = ' TSKST-LOC-NBR                       16800000
145500         DISPLAY '**********************************'             16810000
145600         MOVE '7000-READ-TSKST-FOR-ADJ-RCPT'                      16820000
145700           TO  PV-PARAGRAPH-NAME                                  16830000
145800         MOVE 'MAX RETRIES EXCEEDED'                              16840000
145900           TO  PV-DB2-OPERATION-ATTEMPTED                         16850000
146000         PERFORM 9999-SQL-ABEND                                   16860000
146100     END-IF.                                                      16870000
146200                                                                  16880000
146300                                                                  16890000
146400******************************************************************16900000
146500*  UPDATE THE SPECIFIC ITEM/STORE ROW ON TSKST.                   16910000
146600*  THIS PARAGRAPH IS USED FOR PROCESSING ADJUSTMENTS AND RECEIPTS.16920000
146700******************************************************************16930000
146800 7100-UPDT-TSKST-FOR-ADJ-RCPT.                                    16940000
146900                                                                  16950000
147000     PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     16960000
147100       UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      16970000
147200                                                                  16980000
147300       EXEC SQL                                                   16990000
147400           UPDATE TSKST                                           17000000
147500              SET LAST_RCVD_DATE     = :TSKST-LAST-RCVD-DATE      17010000
147600                , ONHAND_QTY         = :TSKST-ONHAND-QTY          17020000
147700                , FIRST_RCVD_DATE    = :TSKST-FIRST-RCVD-DATE     17030000
147800                , LAST_UPD_TMST      = CURRENT TIMESTAMP          17040000
147900            WHERE ITEM_NMBR   = :TSKST-ITEM-NMBR                  17050000
148000              AND LOC_NBR     = :TSKST-LOC-NBR                    17060000
148100       END-EXEC                                                   17070000
148200                                                                  17080000
148300       EVALUATE TRUE                                              17090000
148400           WHEN SQLWARN0 NOT = SPACES                             17100000
148500                MOVE '7100-UPDT-TSKST-FOR-ADJ-RCPT'               17110000
148600                  TO  PV-PARAGRAPH-NAME                           17120000
148700                MOVE 'UPDATE TSKST RECORD'                        17130000
148800                  TO  PV-DB2-OPERATION-ATTEMPTED                  17140000
148900                PERFORM 9999-SQL-ABEND                            17150000
149000           WHEN SQLCODE = ZERO                                    17160000
149100                IF  TSKST-LOC-NBR = ZERO                          17170000
149200                    ADD +1 TO CR-000-TSKST-UPDT-CNT               17180000
149300                ELSE                                              17190000
149400                    ADD +1 TO CR-LOC-TSKST-UPDT-CNT               17200000
149500                END-IF                                            17210000
149600                MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT       17220000
149700           WHEN SQLCODE = -904                                    17230000
PE5823*          WHEN SQLCODE = -911                                    17240000
149900           WHEN SQLCODE = -913                                    17250000
150000                CONTINUE                                          17260000
150100           WHEN ANY                                               17270000
150200                DISPLAY '**********************************'      17280000
150300                DISPLAY 'ITEM_NMBR  = ' TSKST-ITEM-NMBR           17290000
150400                DISPLAY 'LOC_NBR = ' TSKST-LOC-NBR                17300000
150500                DISPLAY '**********************************'      17310000
150600                MOVE '7100-UPDT-TSKST-FOR-ADJ-RCPT'               17320000
150700                  TO  PV-PARAGRAPH-NAME                           17330000
150800                MOVE 'UPDATE TSKST RECORD'                        17340000
150900                  TO  PV-DB2-OPERATION-ATTEMPTED                  17350000
151000                PERFORM 9999-SQL-ABEND                            17360000
151100       END-EVALUATE                                               17370000
151200     END-PERFORM.                                                 17380000
151300                                                                  17390000
151400     IF (SQLWARN0 NOT = SPACES                                    17400000
151500     OR  SQLCODE > 0                                              17410000
151600     OR  SQLCODE < 0)                                             17420000
151700         DISPLAY '**********************************'             17430000
151800         DISPLAY 'ITEM_NMBR  = ' TSKST-ITEM-NMBR                  17440000
151900         DISPLAY 'LOC_NBR = ' TSKST-LOC-NBR                       17450000
152000         DISPLAY '**********************************'             17460000
152100         MOVE '7100-UPDT-TSKST-FOR-ADJ-RCPT'                      17470000
152200           TO  PV-PARAGRAPH-NAME                                  17480000
152300         MOVE 'MAX RETRIES EXCEEDED'                              17490000
152400           TO  PV-DB2-OPERATION-ATTEMPTED                         17500000
152500         PERFORM 9999-SQL-ABEND                                   17510000
152600     END-IF.                                                      17520000
152700                                                                  17530000
152800                                                                  17540000
152900******************************************************************17550000
153000*  INSERT A SPECIFIC ITEM/STORE ROW TO TSKST.                     17560000
153100*  THIS PARAGRAPH IS USED FOR PROCESSING ADJUSTMENTS AND RECEIPTS.17570000
153200******************************************************************17580000
153300 7200-ISRT-TSKST-FOR-ADJ-RCPT.                                    17590000
153400                                                                  17600000
153500     PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     17610000
153600       UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      17620000
153700                                                                  17630000
153800       EXEC SQL                                                   17640000
153900            INSERT INTO TSKST                                     17650000
154000                   (ITEM_NMBR                                     17660000
154100                  , LAST_RCVD_DATE                                17670000
154200                  , ONHAND_QTY                                    17680000
154300                  , FIRST_RCVD_DATE                               17690000
154400                  , LOC_NBR                                       17700000
154500                  , LAST_UPD_TMST)                                17710000
154600            VALUES (:TSKST-ITEM-NMBR                              17720000
154700                  , :TSKST-LAST-RCVD-DATE                         17730000
154800                  , :TSKST-ONHAND-QTY                             17740000
154900                  , :TSKST-FIRST-RCVD-DATE                        17750000
155000                  , :TSKST-LOC-NBR                                17760000
155100                  , CURRENT TIMESTAMP)                            17770000
155200       END-EXEC                                                   17780000
155300                                                                  17790000
155400       EVALUATE TRUE                                              17800000
155500           WHEN SQLWARN0 NOT = SPACES                             17810000
155600                MOVE '7200-ISRT-TSKST-FOR-ADJ-RCPT'               17820000
155700                  TO  PV-PARAGRAPH-NAME                           17830000
155800                MOVE 'INSERT TSKST RECORD'                        17840000
155900                  TO  PV-DB2-OPERATION-ATTEMPTED                  17850000
156000                PERFORM 9999-SQL-ABEND                            17860000
156100           WHEN SQLCODE = ZERO                                    17870000
156200                ADD  +1 TO CR-TSKST-ISRT-CNT                      17880000
156300                MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT       17890000
156400           WHEN SQLCODE = -904                                    17900000
PE5823*          WHEN SQLCODE = -911                                    17910000
156600           WHEN SQLCODE = -913                                    17920000
156700                CONTINUE                                          17930000
156800           WHEN ANY                                               17940000
156900                MOVE '7200-ISRT-TSKST-FOR-ADJ-RCPT'               17950000
157000                  TO  PV-PARAGRAPH-NAME                           17960000
157100                MOVE 'INSERT TSKST RECORD'                        17970000
157200                  TO  PV-DB2-OPERATION-ATTEMPTED                  17980000
157300                PERFORM 9999-SQL-ABEND                            17990000
157400       END-EVALUATE                                               18000000
157500     END-PERFORM.                                                 18010000
157600                                                                  18020000
157700     IF (SQLWARN0 NOT = SPACES                                    18030000
157800     OR  SQLCODE > 0                                              18040000
157900     OR  SQLCODE < 0)                                             18050000
158000         MOVE '7200-ISRT-TSKST-FOR-ADJ-RCPT'                      18060000
158100           TO  PV-PARAGRAPH-NAME                                  18070000
158200         MOVE 'MAX RETRIES EXCEEDED'                              18080000
158300           TO  PV-DB2-OPERATION-ATTEMPTED                         18090000
158400         PERFORM 9999-SQL-ABEND                                   18100000
158500     END-IF.                                                      18110000
158600                                                                  18120000
158700                                                                  18130000
158800******************************************************************18140000
158900*  SELECT ONE ROW FROM TSKST FOR A SPECIFIC ITEM/STORE.           18150000
159000*  THIS PARAGRAPH IS USED FOR PROCESSING SALES.                   18160000
159100******************************************************************18170000
159200 7300-READ-TSKST-FOR-SALES.                                       18180000
159300                                                                  18190000
159400     PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     18200000
159500         UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                    18210000
159600                                                                  18220000
159700       EXEC SQL                                                   18230000
159800           SELECT LAST_SALE_DATE                                  18240000
159900                , ONHAND_QTY                                      18250000
160000                , FIRST_SALE_DATE                                 18260000
PE9054                , YTD_SALES_UNIT_QTY                              18270000
PE9054                , YTD_SALES_AMT                                   18280000
160300             INTO :TSKST-LAST-SALE-DATE                           18290000
160400                , :TSKST-ONHAND-QTY                               18300000
160500                , :TSKST-FIRST-SALE-DATE                          18310000
PE9054                , :TSKST-YTD-SALES-UNIT-QTY                       18320000
PE9054                , :TSKST-YTD-SALES-AMT                            18330000
160800             FROM TSKST                                           18340000
160900            WHERE ITEM_NMBR  = :TSKST-ITEM-NMBR                   18350000
161000              AND LOC_NBR    = :TSKST-LOC-NBR                     18360000
161100       END-EXEC                                                   18370000
161200                                                                  18380000
161300       EVALUATE TRUE                                              18390000
161400           WHEN SQLWARN0 NOT = SPACES                             18400000
161500                MOVE '7300-READ-TSKST-FOR-SALES'                  18410000
161600                  TO  PV-PARAGRAPH-NAME                           18420000
161700                MOVE 'READ TSKST RECORD'                          18430000
161800                  TO  PV-DB2-OPERATION-ATTEMPTED                  18440000
161900                PERFORM 9999-SQL-ABEND                            18450000
162000           WHEN SQLCODE = ZERO                                    18460000
162100                ADD  +1 TO CR-TSKST-READ-CNT                      18470000
162200                MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT       18480000
162300           WHEN SQLCODE = +100                                    18490000
162400                ADD  +1 TO CR-TSKST-READ-CNT                      18500000
162500                MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT       18510000
162600           WHEN SQLCODE = -904                                    18520000
PE5823*          WHEN SQLCODE = -911                                    18530000
162800           WHEN SQLCODE = -913                                    18540000
162900                CONTINUE                                          18550000
163000           WHEN ANY                                               18560000
163100                MOVE '7300-READ-TSKST-FOR-SALES'                  18570000
163200                  TO  PV-PARAGRAPH-NAME                           18580000
163300                MOVE 'READ TSKST RECORD'                          18590000
163400                  TO  PV-DB2-OPERATION-ATTEMPTED                  18600000
163500                PERFORM 9999-SQL-ABEND                            18610000
163600       END-EVALUATE                                               18620000
163700                                                                  18630000
163800     END-PERFORM.                                                 18640000
163900                                                                  18650000
164000     IF  SQLCODE = +100                                           18660000
PE7819     AND TSKST-LOC-NBR = ZERO                                     18670000
PE7819         PERFORM 7310-CHECK-TSKXREF                               18680000
PE7819         IF PS-ITM-NOT-IN-TSKXREF                                 18690000
PE7819            PERFORM 7320-DELETE-TSKST                             18700000
PE7819            MOVE 'Y' TO PS-DELETE-TSKST-ITM-SW                    18710000
PE7819            DISPLAY '*** 7300-READ-TSKST-FOR-SALES: '             18720000
PE7819            'TSKST CORPORATE ROW NOT FOUND'                       18730000
PE7819            DISPLAY '*** AUDIT TRANSACTION ERRED OUT FOR '        18740000
PE7819            'ITEM_NMBR = ' TSKST-ITEM-NMBR                        18750000
PE7819         ELSE                                                     18760000
PE7819            DISPLAY '**********************************'          18770000
PE7819            DISPLAY 'ITEM_NMBR  = ' TSKST-ITEM-NMBR               18780000
PE7819            DISPLAY 'LOC_NBR = ' TSKST-LOC-NBR                    18790000
PE7819            DISPLAY '**********************************'          18800000
PE7819            MOVE '7300-READ-TSKST-FOR-SALES'                      18810000
PE7819                 TO  PV-PARAGRAPH-NAME                            18820000
PE7819            MOVE 'TSKST CORPORATE ROW NOT FOUND'                  18830000
PE7819                 TO  PV-DB2-OPERATION-ATTEMPTED                   18840000
PE7819            PERFORM 9999-SQL-ABEND                                18850000
PE7819         END-IF                                                   18860000
165100     END-IF.                                                      18870000
165200                                                                  18880000
165300     IF  (SQLWARN0 NOT = SPACES                                   18890000
165400     OR  (SQLCODE > 0 AND SQLCODE NOT = +100)                     18900000
165500     OR   SQLCODE < 0)                                            18910000
165600         DISPLAY '**********************************'             18920000
165700         DISPLAY 'ITEM_NMBR  = ' TSKST-ITEM-NMBR                  18930000
165800         DISPLAY 'LOC_NBR = ' TSKST-LOC-NBR                       18940000
165900         DISPLAY '**********************************'             18950000
166000         MOVE '7300-READ-TSKST-FOR-SALES'                         18960000
166100           TO  PV-PARAGRAPH-NAME                                  18970000
166200         MOVE 'MAX RETRIES EXCEEDED'                              18980000
166300           TO  PV-DB2-OPERATION-ATTEMPTED                         18990000
166400         PERFORM 9999-SQL-ABEND                                   19000000
166500     END-IF.                                                      19010000
166700                                                                  19020000
PE7819******************************************************************19030000
PE7819*  CHECK FOR THE EXISTENCE OF THE ITEM NUMBER IN TSKXREF TABLE    19040000
PE7819******************************************************************19050000
PE7819 7310-CHECK-TSKXREF.                                              19060000
PE7819                                                                  19070000
PE7819     MOVE TSKST-ITEM-NMBR TO SKXREF-ITM-NBR                       19080000
PE7819                                                                  19090000
PE7819     PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     19100000
PE7819       UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      19110000
PE7819                                                                  19120000
PE7819       EXEC SQL                                                   19130000
PE7819          SELECT ITM_NBR                                          19140000
PE7819             INTO :PV-ITEM-NBR-HOLD                               19150000
PE7819          FROM TSKXREF                                            19160000
PE7819          WHERE ITM_NBR = :SKXREF-ITM-NBR                         19170000
PE7819       END-EXEC                                                   19180000
PE7819                                                                  19190000
PE7819       EVALUATE TRUE                                              19200000
PE7819                                                                  19210000
PE7819          WHEN SQLCODE = +0                                       19220000
PE7819              SET PS-ITM-IN-TSKXREF TO TRUE                       19230000
PE7819              MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT         19240000
PE7819          WHEN SQLCODE = +100                                     19250000
PE7819              SET PS-ITM-NOT-IN-TSKXREF TO TRUE                   19260000
PE7819              MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT         19270000
PE7819          WHEN SQLCODE = -904                                     19280000
PE7819          WHEN SQLCODE = -913                                     19290000
PE7819              CONTINUE                                            19300000
PE7819          WHEN OTHER                                              19310000
PE7819              DISPLAY 'SQLCODE IS ' SQLCODE                       19320000
PE7819              MOVE '7310-CHECK-TSKXREF' TO PV-PARAGRAPH-NAME      19330000
PE7819              MOVE 'CHECK ITEM IN TSKXREF' TO                     19340000
PE7819                  PV-DB2-OPERATION-ATTEMPTED                      19350000
PE7819              PERFORM 9999-SQL-ABEND                              19360000
PE7819       END-EVALUATE                                               19370000
171800     END-PERFORM.                                                 19380000
PE7819                                                                  19390000
PE7819     IF ((SQLCODE > 0 AND SQLCODE NOT = +100)                     19400000
PE7819     OR  SQLCODE < 0)                                             19410000
PE7819         DISPLAY '**********************************'             19420000
PE7819         DISPLAY 'ITM_NBR = ' SKXREF-ITM-NBR                      19430000
PE7819         DISPLAY '**********************************'             19440000
PE7819         MOVE '7310-CHECK-TSKXREF'                                19450000
PE7819           TO  PV-PARAGRAPH-NAME                                  19460000
PE7819         MOVE 'MAX RETRIES EXCEEDED'                              19470000
PE7819           TO  PV-DB2-OPERATION-ATTEMPTED                         19480000
PE7819         PERFORM 9999-SQL-ABEND                                   19490000
PE7819     END-IF.                                                      19500000
PE7819                                                                  19510000
PE7819******************************************************************19520000
PE7819*  DELETE ITEM NUMBER FROM TSKST TABLE WHICH WAS INSERTED INTO    19530000
PE7819*  TSKST TABLE WITH STORE 000.                                    19540000
PE7819******************************************************************19550000
PE7819 7320-DELETE-TSKST.                                               19560000
PE7819                                                                  19570000
PE7819     PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     19580000
PE7819       UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      19590000
PE7819                                                                  19600000
PE7819       EXEC SQL                                                   19610000
PE7819          DELETE FROM TSKST                                       19620000
PE7819          WHERE ITEM_NMBR = :TSKST-ITEM-NMBR                      19630000
PE7819       END-EXEC                                                   19640000
PE7819                                                                  19650000
PE7819       EVALUATE TRUE                                              19660000
PE7819                                                                  19670000
PE7819          WHEN SQLCODE = +0                                       19680000
PE7819              MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT         19690000
PE7819          WHEN SQLCODE = -904                                     19700000
PE7819          WHEN SQLCODE = -913                                     19710000
PE7819              CONTINUE                                            19720000
PE7819          WHEN OTHER                                              19730000
PE7819              DISPLAY 'SQLCODE IS ' SQLCODE                       19740000
PE7819              MOVE '7320-DELETE-TSKST' TO PV-PARAGRAPH-NAME       19750000
PE7819              MOVE 'DELETE FROM TSKST' TO                         19760000
PE7819                    PV-DB2-OPERATION-ATTEMPTED                    19770000
PE7819              PERFORM 9999-SQL-ABEND                              19780000
PE7819       END-EVALUATE                                               19790000
PE7819     END-PERFORM.                                                 19800000
PE7819                                                                  19810000
PE7819     IF (SQLCODE > 0                                              19820000
PE7819     OR  SQLCODE < 0)                                             19830000
PE7819         DISPLAY '**********************************'             19840000
PE7819         DISPLAY 'ITM_NBR = ' TSKST-ITEM-NMBR                     19850000
PE7819         DISPLAY '**********************************'             19860000
PE7819         MOVE '7320-DELETE-TSKST'                                 19870000
PE7819           TO  PV-PARAGRAPH-NAME                                  19880000
PE7819         MOVE 'MAX RETRIES EXCEEDED'                              19890000
PE7819           TO  PV-DB2-OPERATION-ATTEMPTED                         19900000
PE7819         PERFORM 9999-SQL-ABEND                                   19910000
PE7819     END-IF.                                                      19920000
PE7819                                                                  19930000
166800******************************************************************19940000
166900*  UPDATE THE SPECIFIC ITEM/STORE ROW ON TSKST.                   19950000
167000*  THIS PARAGRAPH IS USED FOR PROCESSING SALES.                   19960000
167100******************************************************************19970000
167200 7400-UPDT-TSKST-FOR-SALES.                                       19980000
167300                                                                  19990000
167400     PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     20000000
167500       UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      20010000
167600                                                                  20020000
167700       EXEC SQL                                                   20030000
167800           UPDATE TSKST                                           20040000
167900              SET LAST_SALE_DATE     = :TSKST-LAST-SALE-DATE      20050000
168000                , ONHAND_QTY         = :TSKST-ONHAND-QTY          20060000
168100                , FIRST_SALE_DATE    = :TSKST-FIRST-SALE-DATE     20070000
PE9054                , YTD_SALES_UNIT_QTY = :TSKST-YTD-SALES-UNIT-QTY  20080000
PE9054                , YTD_SALES_AMT      = :TSKST-YTD-SALES-AMT       20090000
168400                , LAST_UPD_TMST      = CURRENT TIMESTAMP          20100000
168500            WHERE ITEM_NMBR   = :TSKST-ITEM-NMBR                  20110000
168600              AND LOC_NBR  = :TSKST-LOC-NBR                       20120000
168700       END-EXEC                                                   20130000
168800                                                                  20140000
168900       EVALUATE TRUE                                              20150000
169000           WHEN SQLWARN0 NOT = SPACES                             20160000
169100                MOVE '7400-UPDT-TSKST-FOR-SALES'                  20170000
169200                  TO  PV-PARAGRAPH-NAME                           20180000
169300                MOVE 'UPDATE TSKST RECORD'                        20190000
169400                  TO  PV-DB2-OPERATION-ATTEMPTED                  20200000
169500                PERFORM 9999-SQL-ABEND                            20210000
169600           WHEN SQLCODE = ZERO                                    20220000
169700                IF  TSKST-LOC-NBR = ZERO                          20230000
169800                    ADD +1 TO CR-000-TSKST-UPDT-CNT               20240000
169900                ELSE                                              20250000
170000                    ADD +1 TO CR-LOC-TSKST-UPDT-CNT               20260000
170100                END-IF                                            20270000
170200                MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT       20280000
170300           WHEN SQLCODE = -904                                    20290000
PE5823*          WHEN SQLCODE = -911                                    20300000
170500           WHEN SQLCODE = -913                                    20310000
170600                CONTINUE                                          20320000
170700           WHEN ANY                                               20330000
170800                DISPLAY '**********************************'      20340000
170900                DISPLAY 'ITEM_NMBR  = ' TSKST-ITEM-NMBR           20350000
171000                DISPLAY 'LOC_NBR = ' TSKST-LOC-NBR                20360000
171100                DISPLAY '**********************************'      20370000
171200                MOVE '7400-UPDT-TSKST-FOR-SALES'                  20380000
171300                  TO  PV-PARAGRAPH-NAME                           20390000
171400                MOVE 'UPDATE TSKST RECORD'                        20400000
171500                  TO  PV-DB2-OPERATION-ATTEMPTED                  20410000
171600                PERFORM 9999-SQL-ABEND                            20420000
171700       END-EVALUATE                                               20430000
171800     END-PERFORM.                                                 20440000
171900                                                                  20450000
172000     IF (SQLWARN0 NOT = SPACES                                    20460000
172100     OR  SQLCODE > 0                                              20470000
172200     OR  SQLCODE < 0)                                             20480000
172300         DISPLAY '**********************************'             20490000
172400         DISPLAY 'ITEM_NMBR  = ' TSKST-ITEM-NMBR                  20500000
172500         DISPLAY 'LOC_NBR = ' TSKST-LOC-NBR                       20510000
172600         DISPLAY '**********************************'             20520000
172700         MOVE '7400-UPDT-TSKST-FOR-SALES'                         20530000
172800           TO  PV-PARAGRAPH-NAME                                  20540000
172900         MOVE 'MAX RETRIES EXCEEDED'                              20550000
173000           TO  PV-DB2-OPERATION-ATTEMPTED                         20560000
173100         PERFORM 9999-SQL-ABEND                                   20570000
173200     END-IF.                                                      20580000
173300                                                                  20590000
173400                                                                  20600000
173500******************************************************************20610000
173600*  INSERT A SPECIFIC ITEM/STORE ROW TO TSKST.                     20620000
173700*  THIS PARAGRAPH IS USED FOR PROCESSING SALES.                   20630000
173800******************************************************************20640000
173900 7500-ISRT-TSKST-FOR-SALES.                                       20650000
174000                                                                  20660000
174100     PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     20670000
174200       UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      20680000
174300                                                                  20690000
174400       EXEC SQL                                                   20700000
174500            INSERT INTO TSKST                                     20710000
174600                   (ITEM_NMBR                                     20720000
174700                  , LAST_SALE_DATE                                20730000
174800                  , ONHAND_QTY                                    20740000
174900                  , FIRST_SALE_DATE                               20750000
PE9054                  , YTD_SALES_UNIT_QTY                            20760000
PE9054                  , YTD_SALES_AMT                                 20770000
175200                  , LOC_NBR                                       20780000
175300                  , LAST_UPD_TMST)                                20790000
175400            VALUES (:TSKST-ITEM-NMBR                              20800000
175500                  , :TSKST-LAST-SALE-DATE                         20810000
175600                  , :TSKST-ONHAND-QTY                             20820000
175700                  , :TSKST-FIRST-SALE-DATE                        20830000
PE9054                  , :TSKST-YTD-SALES-UNIT-QTY                     20840000
PE9054                  , :TSKST-YTD-SALES-AMT                          20850000
176000                  , :TSKST-LOC-NBR                                20860000
176100                  , CURRENT TIMESTAMP)                            20870000
176200       END-EXEC                                                   20880000
176300                                                                  20890000
176400       EVALUATE TRUE                                              20900000
176500           WHEN SQLWARN0 NOT = SPACES                             20910000
176600                MOVE '7500-ISRT-TSKST-FOR-SALES'                  20920000
176700                  TO  PV-PARAGRAPH-NAME                           20930000
176800                MOVE 'INSERT TSKST RECORD'                        20940000
176900                  TO  PV-DB2-OPERATION-ATTEMPTED                  20950000
177000                PERFORM 9999-SQL-ABEND                            20960000
177100           WHEN SQLCODE = ZERO                                    20970000
177200                ADD  +1 TO CR-TSKST-ISRT-CNT                      20980000
177300                MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT       20990000
177400           WHEN SQLCODE = -904                                    21000000
PE5823*          WHEN SQLCODE = -911                                    21010000
177600           WHEN SQLCODE = -913                                    21020000
177700                CONTINUE                                          21030000
177800           WHEN ANY                                               21040000
177900                MOVE '7500-ISRT-TSKST-FOR-SALES'                  21050000
178000                  TO  PV-PARAGRAPH-NAME                           21060000
178100                MOVE 'INSERT TSKST RECORD'                        21070000
178200                  TO  PV-DB2-OPERATION-ATTEMPTED                  21080000
178300                PERFORM 9999-SQL-ABEND                            21090000
178400       END-EVALUATE                                               21100000
178500     END-PERFORM.                                                 21110000
178600                                                                  21120000
178700     IF (SQLWARN0 NOT = SPACES                                    21130000
178800     OR  SQLCODE > 0                                              21140000
178900     OR  SQLCODE < 0)                                             21150000
179000         MOVE '7500-ISRT-TSKST-FOR-SALES'                         21160000
179100           TO  PV-PARAGRAPH-NAME                                  21170000
179200         MOVE 'MAX RETRIES EXCEEDED'                              21180000
179300           TO  PV-DB2-OPERATION-ATTEMPTED                         21190000
179400         PERFORM 9999-SQL-ABEND                                   21200000
179500     END-IF.                                                      21210000
179600                                                                  21220000
179700                                                                  21230000
179800******************************************************************21240000
179900*  UPDATE THE ADJUSTMENT TRANSACTION ON THE ON-HAND ADJUSTMENT    21250000
180000*  AUDIT TABLE TO A STATUS OF 'COMPLETE'.                         21260000
180100******************************************************************21270000
180200 7600-UPDT-ADJ-TRAN-TO-CMPLT.                                     21280000
180300                                                                  21290000
180400     PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     21300000
180500       UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      21310000
180600                                                                  21320000
180700       EXEC SQL                                                   21330000
180800           UPDATE FSTT_OH_ADJ_AUD                                 21340000
180900              SET TRN_STAT_CDE  = 'C'                             21350000
181000                , LAST_UPD_TMST =  CURRENT TIMESTAMP              21360000
181100            WHERE PRCG_DTE = :PV-PROCESS-DATE-10                  21370000
181200              AND ITM_NBR  = :FST00003-ITM-NBR                    21380000
181300              AND LOC_NBR  = :FST00003-LOC-NBR                    21390000
181400              AND CRE_TMST = :FST00003-CRE-TMST                   21400000
181500              AND TRN_STAT_CDE = 'A'                              21410000
181600       END-EXEC                                                   21420000
181700                                                                  21430000
181800       EVALUATE SQLCODE                                           21440000
181900           WHEN +0                                                21450000
182000                ADD SQLERRD(3) TO CR-OH-ADJ-UPDT-C-CNT            21460000
182100                MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT       21470000
182200           WHEN -904                                              21480000
PE5823*          WHEN -911                                              21490000
182400           WHEN -913                                              21500000
182500                CONTINUE                                          21510000
182600           WHEN OTHER                                             21520000
182700                DISPLAY '**********************************'      21530000
182800                DISPLAY 'ITM_NBR = ' FST00003-ITM-NBR             21540000
182900                DISPLAY 'LOC_NBR = ' FST00003-LOC-NBR             21550000
183000                DISPLAY '**********************************'      21560000
183100                MOVE '7600-UPDT-ADJ-TRAN-TO-CMPLT'                21570000
183200                  TO  PV-PARAGRAPH-NAME                           21580000
183300                MOVE 'UPDATE ADJ TRAN TO COMPLETE'                21590000
183400                  TO  PV-DB2-OPERATION-ATTEMPTED                  21600000
183500                PERFORM 9999-SQL-ABEND                            21610000
183600       END-EVALUATE                                               21620000
183700     END-PERFORM.                                                 21630000
183800                                                                  21640000
183900     IF (SQLCODE > 0                                              21650000
184000     OR  SQLCODE < 0)                                             21660000
184100         DISPLAY '**********************************'             21670000
184200         DISPLAY 'ITM_NBR = ' FST00003-ITM-NBR                    21680000
184300         DISPLAY 'LOC_NBR = ' FST00003-LOC-NBR                    21690000
184400         DISPLAY '**********************************'             21700000
184500         MOVE '7600-UPDT-ADJ-TRAN-TO-CMPLT'                       21710000
184600           TO  PV-PARAGRAPH-NAME                                  21720000
184700         MOVE 'MAX RETRIES EXCEEDED'                              21730000
184800           TO  PV-DB2-OPERATION-ATTEMPTED                         21740000
184900         PERFORM 9999-SQL-ABEND                                   21750000
185000     END-IF.                                                      21760000
185100                                                                  21770000
185200                                                                  21780000
185300******************************************************************21790000
185400*  UPDATE THE ADJUSTMENT TRANSACTION ON THE ON-HAND ADJUSTMENT    21800000
185500*  AUDIT TABLE TO AN 'ERROR' STATUS.                              21810000
185600******************************************************************21820000
185700 7700-UPDT-ADJ-AUD-ERROR.                                         21830000
185800                                                                  21840000
185900     PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     21850000
186000       UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      21860000
186100                                                                  21870000
186200       EXEC SQL                                                   21880000
186300           UPDATE FSTT_OH_ADJ_AUD                                 21890000
186400              SET TRN_STAT_CDE  = 'E'                             21900000
186500                , ERR_TYP_CDE   = :FST00003-ERR-TYP-CDE           21910000
186600                , LAST_UPD_TMST =  CURRENT TIMESTAMP              21920000
186700            WHERE PRCG_DTE = :PV-PROCESS-DATE-10                  21930000
186800              AND ITM_NBR  = :FST00003-ITM-NBR                    21940000
186900              AND LOC_NBR  = :FST00003-LOC-NBR                    21950000
187000              AND CRE_TMST = :FST00003-CRE-TMST                   21960000
187100              AND TRN_STAT_CDE = 'A'                              21970000
187200       END-EXEC                                                   21980000
187300                                                                  21990000
187400       EVALUATE SQLCODE                                           22000000
187500           WHEN +0                                                22010000
187600                ADD  +1 TO CR-OH-ADJ-UPDT-E-CNT                   22020000
187700                MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT       22030000
187800           WHEN -904                                              22040000
PE5823*          WHEN -911                                              22050000
188000           WHEN -913                                              22060000
188100                CONTINUE                                          22070000
188200           WHEN OTHER                                             22080000
188300                DISPLAY '**********************************'      22090000
188400                DISPLAY 'ITM_NBR = ' FST00003-ITM-NBR             22100000
188500                DISPLAY 'LOC_NBR = ' FST00003-LOC-NBR             22110000
188600                DISPLAY '**********************************'      22120000
188700                MOVE '7700-UPDT-ADJ-AUD-ERROR'                    22130000
188800                  TO  PV-PARAGRAPH-NAME                           22140000
188900                MOVE 'UPDT ADJ TRAN TO ERROR STATUS'              22150000
189000                  TO  PV-DB2-OPERATION-ATTEMPTED                  22160000
189100                PERFORM 9999-SQL-ABEND                            22170000
189200       END-EVALUATE                                               22180000
189300     END-PERFORM.                                                 22190000
189400                                                                  22200000
189500     IF (SQLCODE > 0                                              22210000
189600     OR  SQLCODE < 0)                                             22220000
189700         DISPLAY '**********************************'             22230000
189800         DISPLAY 'ITM_NBR = ' FST00003-ITM-NBR                    22240000
189900         DISPLAY 'LOC_NBR = ' FST00003-LOC-NBR                    22250000
190000         DISPLAY '**********************************'             22260000
190100         MOVE '7700-UPDT-ADJ-AUD-ERROR'                           22270000
190200           TO  PV-PARAGRAPH-NAME                                  22280000
190300         MOVE 'MAX RETRIES EXCEEDED'                              22290000
190400           TO  PV-DB2-OPERATION-ATTEMPTED                         22300000
190500         PERFORM 9999-SQL-ABEND                                   22310000
190600     END-IF.                                                      22320000
190700                                                                  22330000
190800                                                                  22340000
190900******************************************************************22350000
191000*  UPDATE MULTIPLE RECEIPT TRANSACTIONS FOR THE SAME ITEM ON THE  22360000
191100*  ON-HAND RECEIPT AUDIT TABLE TO A STATUS OF 'COMPLETE'.         22370000
191200******************************************************************22380000
191300 7800-UPDT-RCPT-TRAN-TO-CMPLT.                                    22390000
191400                                                                  22400000
191500     PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     22410000
191600       UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      22420000
191700                                                                  22430000
191800       EXEC SQL                                                   22440000
191900           UPDATE FSTT_OH_RCPT_AUD                                22450000
192000              SET TRN_STAT_CDE  = 'C'                             22460000
192100                , LAST_UPD_TMST =  CURRENT TIMESTAMP              22470000
192200            WHERE PRCG_DTE = :PV-PROCESS-DATE-10                  22480000
192300              AND ITM_NBR  = :PV-PREV-ITM-NBR                     22490000
192400              AND TRN_STAT_CDE = 'A'                              22500000
RONNA               AND SRC_PGM_NM NOT IN ('GVKUT015')                  22501010
192500       END-EXEC                                                   22510000
192600                                                                  22520000
192700       EVALUATE SQLCODE                                           22530000
192800           WHEN +0                                                22540000
192900                ADD SQLERRD(3) TO CR-OH-RCPT-UPDT-C-CNT           22550000
193000                MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT       22560000
193100           WHEN -904                                              22570000
PE5823*          WHEN -911                                              22580000
193300           WHEN -913                                              22590000
193400                CONTINUE                                          22600000
193500           WHEN OTHER                                             22610000
193600                DISPLAY '**********************************'      22620000
193700                DISPLAY 'ITM_NBR = ' FST00004-ITM-NBR             22630000
193800                DISPLAY '**********************************'      22640000
193900                MOVE '7800-UPDT-RCPT-TRAN-TO-CMPLT'               22650000
194000                  TO  PV-PARAGRAPH-NAME                           22660000
194100                MOVE 'UPDATE RCPT TRAN TO COMPLETE'               22670000
194200                  TO  PV-DB2-OPERATION-ATTEMPTED                  22680000
194300                PERFORM 9999-SQL-ABEND                            22690000
194400       END-EVALUATE                                               22700000
194500     END-PERFORM.                                                 22710000
194600                                                                  22720000
194700     IF (SQLCODE > 0                                              22730000
194800     OR  SQLCODE < 0)                                             22740000
194900         DISPLAY '**********************************'             22750000
195000         DISPLAY 'ITM_NBR = ' FST00004-ITM-NBR                    22760000
195100         DISPLAY '**********************************'             22770000
195200         MOVE '7800-UPDT-RCPT-TRAN-TO-CMPLT'                      22780000
195300           TO  PV-PARAGRAPH-NAME                                  22790000
195400         MOVE 'MAX RETRIES EXCEEDED'                              22800000
195500           TO  PV-DB2-OPERATION-ATTEMPTED                         22810000
195600         PERFORM 9999-SQL-ABEND                                   22820000
195700     END-IF.                                                      22830000
195800                                                                  22840000
195900                                                                  22850000
RONNA ******************************************************************22851010
RONNA *  UPDATE MULTIPLE RECEIPT TRANSACTIONS FOR THE SAME ITEM ON THE  22852010
RONNA *  ON-HAND RECEIPT AUDIT TABLE TO A STATUS OF 'COMPLETE'.         22853010
RONNA ******************************************************************22854010
RONNA  7850-UPDT-RCPT2-TRAN-TO-CMPLT.                                   22855010
RONNA                                                                   22856010
RONNA      PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     22857010
RONNA        UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      22858010
RONNA                                                                   22859010
RONNA        EXEC SQL                                                   22859110
RONNA            UPDATE FSTT_OH_RCPT_AUD                                22859210
RONNA               SET TRN_STAT_CDE  = 'C'                             22859310
RONNA                 , LAST_UPD_TMST =  CURRENT TIMESTAMP              22859410
RONNA             WHERE PRCG_DTE = :PV-PROCESS-DATE-10                  22859510
RONNA               AND ITM_NBR  = :PV-PREV-ITM-NBR                     22859610
RONNA               AND TRN_STAT_CDE = 'A'                              22859710
RONNA               AND SRC_PGM_NM IN ('GVKUT015')                      22859810
RONNA        END-EXEC                                                   22859910
RONNA                                                                   22860010
RONNA        EVALUATE SQLCODE                                           22860110
RONNA            WHEN +0                                                22860210
RONNA                 ADD SQLERRD(3) TO CR-OH-RCPT2-UPDT-C-CNT          22860315
RONNA                 MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT       22860410
RONNA            WHEN -904                                              22860510
RONNA *          WHEN -911                                              22860610
RONNA            WHEN -913                                              22860710
RONNA                 CONTINUE                                          22860810
RONNA            WHEN OTHER                                             22860910
RONNA                 DISPLAY '**********************************'      22861010
RONNA                 DISPLAY 'ITM_NBR = ' FST00004-ITM-NBR             22861110
RONNA                 DISPLAY '**********************************'      22861210
RONNA                 MOVE '7850-UPDT-RCPT2-TRAN-TO-CMPLT'              22861310
RONNA                   TO  PV-PARAGRAPH-NAME                           22861410
RONNA                 MOVE 'UPDATE RCPT TRAN TO COMPLETE'               22861510
RONNA                   TO  PV-DB2-OPERATION-ATTEMPTED                  22861610
RONNA                 PERFORM 9999-SQL-ABEND                            22861710
RONNA        END-EVALUATE                                               22861810
RONNA      END-PERFORM.                                                 22861910
RONNA                                                                   22862010
RONNA      IF (SQLCODE > 0                                              22862110
RONNA      OR  SQLCODE < 0)                                             22862210
RONNA          DISPLAY '**********************************'             22862310
RONNA          DISPLAY 'ITM_NBR = ' FST00004-ITM-NBR                    22862410
RONNA          DISPLAY '**********************************'             22862510
RONNA          MOVE '7850-UPDT-RCPT2-TRAN-TO-CMPLT'                     22862610
RONNA            TO  PV-PARAGRAPH-NAME                                  22862710
RONNA          MOVE 'MAX RETRIES EXCEEDED'                              22862810
RONNA            TO  PV-DB2-OPERATION-ATTEMPTED                         22862910
RONNA          PERFORM 9999-SQL-ABEND                                   22863010
RONNA      END-IF.                                                      22863110
RONNA                                                                   22863210
RONNA                                                                   22863310
196000******************************************************************22864000
196100*  UPDATE MULTIPLE SALES TRANSACTIONS FOR THE SAME ITEM ON THE    22870000
196200*  ON-HAND SALES AUDIT TABLE TO A STATUS OF 'COMPLETE'.           22880000
196300******************************************************************22890000
196400 7900-UPDT-SLS-TRAN-TO-CMPLT.                                     22900000
196500                                                                  22910000
196600     PERFORM VARYING PV-RETRY-CNT FROM 1 BY 1                     22920000
196700       UNTIL PV-RETRY-CNT > PC-MAX-RETRY-CNT                      22930000
196800                                                                  22940000
196900       EXEC SQL                                                   22950000
197000           UPDATE FSTT_OH_SLS_AUD                                 22960000
197100              SET TRN_STAT_CDE  = 'C'                             22970000
197200                , LAST_UPD_TMST =  CURRENT TIMESTAMP              22980000
197300            WHERE PRCG_DTE = :PV-PROCESS-DATE-10                  22990000
197400              AND ITM_NBR  = :PV-PREV-ITM-NBR                     23000000
197500              AND TRN_STAT_CDE = 'A'                              23010000
197600       END-EXEC                                                   23020000
197700                                                                  23030000
197800       EVALUATE SQLCODE                                           23040000
197900           WHEN +0                                                23050000
198000                ADD SQLERRD(3) TO CR-OH-SLS-UPDT-C-CNT            23060000
198100                MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-CNT       23070000
198200           WHEN -904                                              23080000
PE5823*          WHEN -911                                              23090000
198400           WHEN -913                                              23100000
198500                CONTINUE                                          23110000
198600           WHEN OTHER                                             23120000
198700                DISPLAY '**********************************'      23130000
198800                DISPLAY 'ITM_NBR = ' FST00005-ITM-NBR             23140000
198900                DISPLAY '**********************************'      23150000
199000                MOVE '7900-UPDT-SLS-TRAN-TO-CMPLT'                23160000
199100                  TO  PV-PARAGRAPH-NAME                           23170000
199200                MOVE 'UPDATE SALES TRAN TO COMPLETE'              23180000
199300                  TO  PV-DB2-OPERATION-ATTEMPTED                  23190000
199400                PERFORM 9999-SQL-ABEND                            23200000
199500       END-EVALUATE                                               23210000
199600     END-PERFORM.                                                 23220000
199700                                                                  23230000
199800     IF (SQLCODE > 0                                              23240000
199900     OR  SQLCODE < 0)                                             23250000
200000         DISPLAY '**********************************'             23260000
200100         DISPLAY 'ITM_NBR = ' FST00005-ITM-NBR                    23270000
200200         DISPLAY '**********************************'             23280000
200300         MOVE '7900-UPDT-SLS-TRAN-TO-CMPLT'                       23290000
200400           TO  PV-PARAGRAPH-NAME                                  23300000
200500         MOVE 'MAX RETRIES EXCEEDED'                              23310000
200600           TO  PV-DB2-OPERATION-ATTEMPTED                         23320000
200700         PERFORM 9999-SQL-ABEND                                   23330000
200800     END-IF.                                                      23340000
200900                                                                  23350000
201000                                                                  23360000
201100******************************************************************23370000
201200*  SELECT FROM THE CHECKPOINT RESTART CONTROL TABLE TO SEE IF     23380000
201300*  THE PROGRAM IS IN A RESTART CONDITION.                         23390000
201400******************************************************************23400000
201500 8000-INIT-CHECKPOINT-SELECT.                                     23410000
201600                                                                  23420000
201700     EXEC SQL                                                     23430000
201800       SELECT                                                     23440000
201900            CKPT_STAT_CODE                                        23450000
202000         INTO                                                     23460000
202100           :TCKRSTCNTL-CKPT-STAT-CODE                             23470000
202200         FROM  TCKRSTCNTL                                         23480000
P43627        WHERE  JOB_NAME  = :CC-JOB-NAME                           23490000
202400          AND  PLAN_NAME = :PC-PROGRAM-NAME                       23500000
202500     END-EXEC.                                                    23510000
202600                                                                  23520000
202700     EVALUATE TRUE                                                23530000
202800         WHEN SQLCODE = ZERO                                      23540000
202900             CONTINUE                                             23550000
203000         WHEN OTHER                                               23560000
203100             MOVE '8000-INIT-CHECKPOINT-SELECT '                  23570000
203200               TO  PV-PARAGRAPH-NAME                              23580000
203300             MOVE 'ERROR ON SELECT OF TCKRSTCNTL '                23590000
203400               TO  PV-DB2-OPERATION-ATTEMPTED                     23600000
203500             PERFORM 9999-SQL-ABEND                               23610000
203600     END-EVALUATE.                                                23620000
203700                                                                  23630000
203800******************************************************************23640000
203900*  SELECT FROM THE CHECKPOINT RESTART INFORMATION TABLE TO        23650000
204000*  OBTAIN THE PROGRAMS SAVED VARIABLES.                           23660000
204100******************************************************************23670000
204200 8100-SELECT-RESTART-INFO.                                        23680000
204300                                                                  23690000
204400     EXEC SQL                                                     23700000
204500         SELECT                                                   23710000
204600            WORK_STRG_DESC                                        23720000
204700         INTO                                                     23730000
204800           :TCKRSTINF-WORK-STRG-DESC                              23740000
204900         FROM  TCKRSTINF                                          23750000
P43627        WHERE  JOB_NAME  = :CC-JOB-NAME                           23760000
205100          AND  PLAN_NAME = :PC-PROGRAM-NAME                       23770000
205200     END-EXEC.                                                    23780000
205300                                                                  23790000
205400     EVALUATE TRUE                                                23800000
205500         WHEN SQLCODE = ZERO                                      23810000
205600             CONTINUE                                             23820000
205700         WHEN OTHER                                               23830000
205800             MOVE '8100-SELECT-RESTART-INFO '                     23840000
205900               TO  PV-PARAGRAPH-NAME                              23850000
206000             MOVE 'ERROR ON SELECT OF TCKRSTINF '                 23860000
206100               TO  PV-DB2-OPERATION-ATTEMPTED                     23870000
206200             PERFORM 9999-SQL-ABEND                               23880000
206300     END-EVALUATE.                                                23890000
206400                                                                  23900000
206500     EJECT                                                        23910000
206600******************************************************************23920000
206700*  CHECK IF WE NEED TO TAKE A COMMIT.  IF SO, COMMIT THIS UNIT    23930000
206800*  OF WORK.                                                       23940000
206900******************************************************************23950000
207000 8200-COMMIT-PROCESSING.                                          23960000
207100                                                                  23970000
207200     PERFORM 8500-SET-CURRENT-TIMESTAMP.                          23980000
207300                                                                  23990000
207400     IF PV-CURRENT-TIMESTAMP > PV-COMMIT-TIMESTAMP                24000000
207500         IF PS-FIRST-COMMIT                                       24010000
207600             MOVE '9'        TO TCKRSTCNTL-CKPT-STAT-CODE         24020000
207700             PERFORM 8300-UPDATE-CHECKPOINT-STATUS                24030000
207800             MOVE 'N'        TO PS-FIRST-COMMIT-SW                24040000
207900         END-IF                                                   24050000
208000         PERFORM 8600-COMMIT                                      24060000
208100         PERFORM 8400-GET-COMMIT-TIMESTAMP                        24070000
208200     END-IF.                                                      24080000
208300                                                                  24090000
208400******************************************************************24100000
208500*  UPDATE THE STATUS ON THE CHECKPOINT CONTROL TABLE              24110000
208600******************************************************************24120000
208700 8300-UPDATE-CHECKPOINT-STATUS.                                   24130000
208800                                                                  24140000
208900     EXEC SQL                                                     24150000
209000       UPDATE  TCKRSTCNTL                                         24160000
209100          SET  CKPT_STAT_CODE = :TCKRSTCNTL-CKPT-STAT-CODE        24170000
P43627        WHERE  JOB_NAME  = :CC-JOB-NAME                           24180000
209300          AND  PLAN_NAME = :PC-PROGRAM-NAME                       24190000
209400     END-EXEC.                                                    24200000
209500                                                                  24210000
209600     EVALUATE TRUE                                                24220000
209700         WHEN SQLCODE = ZERO                                      24230000
209800             CONTINUE                                             24240000
209900         WHEN OTHER                                               24250000
210000             MOVE '8300-UPDATE-CHECKPOINT-STATUS '                24260000
210100               TO  PV-PARAGRAPH-NAME                              24270000
210200             MOVE 'ERROR ON UPDATE OF TCKRSTCNTL '                24280000
210300               TO  PV-DB2-OPERATION-ATTEMPTED                     24290000
210400             PERFORM 9999-SQL-ABEND                               24300000
210500     END-EVALUATE.                                                24310000
210600                                                                  24320000
210700                                                                  24330000
210800******************************************************************24340000
210900*  GET THE COMMIT TIMESTAMP FROM THE CHECKPOINT CONTROL TABLE     24350000
211000******************************************************************24360000
211100 8400-GET-COMMIT-TIMESTAMP.                                       24370000
211200                                                                  24380000
211300     EXEC SQL                                                     24390000
211400       SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)       24400000
211500         INTO :PV-COMMIT-TIMESTAMP                                24410000
211600         FROM TCKRSTCNTL                                          24420000
P43627        WHERE JOB_NAME  = :CC-JOB-NAME                            24430000
211800          AND PLAN_NAME = :PC-PROGRAM-NAME                        24440000
211900     END-EXEC.                                                    24450000
212000                                                                  24460000
212100     IF SQLCODE = 0                                               24470000
212200         CONTINUE                                                 24480000
212300     ELSE                                                         24490000
212400         MOVE '8400-GET-COMMIT-TIMESTAMP '                        24500000
212500           TO  PV-PARAGRAPH-NAME                                  24510000
212600         MOVE 'ERROR ON SELECT OF TIMESTAMP '                     24520000
212700           TO  PV-DB2-OPERATION-ATTEMPTED                         24530000
212800         PERFORM 9999-SQL-ABEND                                   24540000
212900     END-IF.                                                      24550000
213000                                                                  24560000
213100                                                                  24570000
213200******************************************************************24580000
213300*  GET THE CURRENT TIMESTAMP FROM DB2                             24590000
213400******************************************************************24600000
213500 8500-SET-CURRENT-TIMESTAMP.                                      24610000
213600                                                                  24620000
213700     EXEC SQL                                                     24630000
213800          SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP           24640000
213900     END-EXEC.                                                    24650000
214000                                                                  24660000
214100     IF SQLCODE = 0                                               24670000
214200         CONTINUE                                                 24680000
214300     ELSE                                                         24690000
214400         MOVE '8500-SET-CURRENT-TIMESTAMP '                       24700000
214500           TO  PV-PARAGRAPH-NAME                                  24710000
214600         MOVE 'ERROR ON SET OF TIMESTAMP '                        24720000
214700           TO  PV-DB2-OPERATION-ATTEMPTED                         24730000
214800         PERFORM 9999-SQL-ABEND                                   24740000
214900     END-IF.                                                      24750000
215000                                                                  24760000
215100                                                                  24770000
215200******************************************************************24780000
215300*  PERFORM UPDATE OF CHECKPOINT INFORMATION TABLE.                24790000
215400*  TAKE A COMMIT.                                                 24800000
215500******************************************************************24810000
215600 8600-COMMIT.                                                     24820000
215700                                                                  24830000
215800     MOVE CR-CHECKPOINT-RESTART-AREA TO TCKRSTINF-WORK-STRG-DESC. 24840000
215900                                                                  24850000
216000     EXEC SQL                                                     24860000
216100       UPDATE TCKRSTINF                                           24870000
216200          SET WORK_STRG_DESC = :TCKRSTINF-WORK-STRG-DESC          24880000
P43627        WHERE JOB_NAME  = :CC-JOB-NAME                            24890000
216400          AND PLAN_NAME = :PC-PROGRAM-NAME                        24900000
216500     END-EXEC.                                                    24910000
216600                                                                  24920000
216700     IF SQLCODE = 0                                               24930000
216800         CONTINUE                                                 24940000
216900     ELSE                                                         24950000
217000         MOVE '8600-COMMIT '                                      24960000
217100           TO  PV-PARAGRAPH-NAME                                  24970000
217200         MOVE 'ERROR ON UPDATE OF TCKRSTINF '                     24980000
217300           TO  PV-DB2-OPERATION-ATTEMPTED                         24990000
217400         PERFORM 9999-SQL-ABEND                                   25000000
217500     END-IF.                                                      25010000
217600                                                                  25020000
217700     EXEC SQL                                                     25030000
217800         COMMIT                                                   25040000
217900     END-EXEC.                                                    25050000
218000                                                                  25060000
218100     IF SQLCODE = 0                                               25070000
218200         ADD +1 TO CR-COMMIT-CNT                                  25080000
218300     ELSE                                                         25090000
218400         MOVE '8600-COMMIT '                                      25100000
218500           TO  PV-PARAGRAPH-NAME                                  25110000
218600         MOVE 'ERROR ON COMMIT '                                  25120000
218700           TO  PV-DB2-OPERATION-ATTEMPTED                         25130000
218800         PERFORM 9999-SQL-ABEND                                   25140000
218900     END-IF.                                                      25150000
219000                                                                  25160000
219100     EJECT                                                        25170000
219200                                                                  25180000
219300                                                                  25190000
219400******************************************************************25200000
219500*  DISPLAY ADJUSTMENT PROCESSING TOTALS                           25210000
219600******************************************************************25220000
219700 9100-END-OF-ADJ.                                                 25230000
219800                                                                  25240000
219900     DISPLAY SPACES.                                              25250000
220000     DISPLAY '****************************************'.          25260000
220100     DISPLAY '***** ADJUSTMENT PROCESSING TOTALS *****'.          25270000
220200     DISPLAY '****************************************'.          25280000
220300                                                                  25290000
220400     MOVE CR-OH-ADJ-FETCH-CNT     TO PV-DISPLAY-COUNT.            25300000
220500     DISPLAY 'NBR OF FETCHES ON FSTT_OH_ADJ_AUD          = '      25310000
220600                                     PV-DISPLAY-COUNT.            25320000
220700                                                                  25330000
220800     MOVE CR-TSKST-READ-CNT       TO PV-DISPLAY-COUNT.            25340000
220900     DISPLAY 'NBR OF TSKST SELECTS                       = '      25350000
221000                                     PV-DISPLAY-COUNT.            25360000
221100                                                                  25370000
221200     MOVE CR-LOC-TSKST-UPDT-CNT   TO PV-DISPLAY-COUNT.            25380000
221300     DISPLAY 'NBR OF TSKST ITM/LOC UPDATES               = '      25390000
221400                                     PV-DISPLAY-COUNT.            25400000
221500                                                                  25410000
221600     MOVE CR-000-TSKST-UPDT-CNT   TO PV-DISPLAY-COUNT.            25420000
221700     DISPLAY 'NBR OF TSKST STR 000 UPDATES               = '      25430000
221800                                     PV-DISPLAY-COUNT.            25440000
221900                                                                  25450000
222000     MOVE CR-TSKST-ISRT-CNT       TO PV-DISPLAY-COUNT.            25460000
222100     DISPLAY 'NBR OF TSKST INSERTS                       = '      25470000
222200                                     PV-DISPLAY-COUNT.            25480000
222300                                                                  25490000
222400     MOVE CR-OH-ADJ-UPDT-C-CNT    TO PV-DISPLAY-COUNT.            25500000
222500     DISPLAY 'NBR OF FSTT_OH_ADJ_AUD UPDATES TO STATUS C = '      25510000
222600                                     PV-DISPLAY-COUNT.            25520000
222700                                                                  25530000
222800     MOVE CR-OH-ADJ-UPDT-E-CNT    TO PV-DISPLAY-COUNT.            25540000
222900     DISPLAY 'NBR OF FSTT_OH_ADJ_AUD UPDATES TO STATUS E = '      25550000
223000                                     PV-DISPLAY-COUNT.            25560000
223100     DISPLAY SPACES.                                              25570000
223200                                                                  25580000
223300     PERFORM 8500-SET-CURRENT-TIMESTAMP.                          25590000
223400     DISPLAY '*************************************'.             25600000
223500     DISPLAY '*ADJUSTMENT PROCESSING END TIMESTAMP*'.             25610000
223600     DISPLAY '     ' PV-CURRENT-TIMESTAMP.                        25620000
223700     DISPLAY '*************************************'.             25630000
223800                                                                  25640000
223900     ADD CR-TSKST-READ-CNT     TO CR-TOT-TSKST-READ-CNT.          25650000
224000     ADD CR-LOC-TSKST-UPDT-CNT TO CR-TOT-LOC-TSKST-UPDT-CNT.      25660000
224100     ADD CR-000-TSKST-UPDT-CNT TO CR-TOT-000-TSKST-UPDT-CNT.      25670000
224200     ADD CR-TSKST-ISRT-CNT     TO CR-TOT-TSKST-ISRT-CNT.          25680000
224300                                                                  25690000
224400     MOVE +0 TO CR-TSKST-READ-CNT                                 25700000
224500                CR-LOC-TSKST-UPDT-CNT                             25710000
224600                CR-000-TSKST-UPDT-CNT                             25720000
224700                CR-TSKST-ISRT-CNT.                                25730000
224800                                                                  25740000
224900                                                                  25750000
225000******************************************************************25760000
225100*  DISPLAY RECEIPT PROCESSING TOTALS                              25770000
225200******************************************************************25780000
225300 9200-END-OF-RCPT.                                                25790000
225400                                                                  25800000
225500     DISPLAY SPACES.                                              25810000
225600     DISPLAY '*************************************'.             25820000
225700     DISPLAY '***** RECEIPT PROCESSING TOTALS *****'.             25830000
RONNA      DISPLAY '***** FOR RECEIPTS THAT UPDATE  *****'.             25831010
RONNA      DISPLAY '***** LAST RECEIPT DATES        *****'.             25832010
225800     DISPLAY '*************************************'.             25840000
225900                                                                  25850000
226000     MOVE CR-OH-RCPT-FETCH-CNT    TO PV-DISPLAY-COUNT.            25860000
226100     DISPLAY 'NBR OF FETCHES ON FSTT_OH_RCPT_AUD          = '     25870000
226200                                     PV-DISPLAY-COUNT.            25880000
226300                                                                  25890000
226400     MOVE CR-TSKST-READ-CNT       TO PV-DISPLAY-COUNT.            25900000
226500     DISPLAY 'NBR OF TSKST SELECTS                        = '     25910000
226600                                     PV-DISPLAY-COUNT.            25920000
226700                                                                  25930000
226800     MOVE CR-LOC-TSKST-UPDT-CNT   TO PV-DISPLAY-COUNT.            25940000
226900     DISPLAY 'NBR OF TSKST ITM/LOC UPDATES                = '     25950000
227000                                     PV-DISPLAY-COUNT.            25960000
227100                                                                  25970000
227200     MOVE CR-000-TSKST-UPDT-CNT   TO PV-DISPLAY-COUNT.            25980000
227300     DISPLAY 'NBR OF TSKST STR 000 UPDATES                = '     25990000
227400                                     PV-DISPLAY-COUNT.            26000000
227500                                                                  26010000
227600     MOVE CR-TSKST-ISRT-CNT       TO PV-DISPLAY-COUNT.            26020000
227700     DISPLAY 'NBR OF TSKST INSERTS                        = '     26030000
227800                                     PV-DISPLAY-COUNT.            26040000
227900                                                                  26050000
228000     MOVE CR-OH-RCPT-UPDT-C-CNT   TO PV-DISPLAY-COUNT.            26060000
228100     DISPLAY 'NBR OF FSTT_OH_RCPT_AUD UPDATES TO STATUS C = '     26070000
228200                                     PV-DISPLAY-COUNT.            26080000
228300     DISPLAY SPACES.                                              26090000
228400                                                                  26100000
228500     PERFORM 8500-SET-CURRENT-TIMESTAMP.                          26110000
228600     DISPLAY '*************************************'.             26120000
228700     DISPLAY '* RECEIPT PROCESSING END TIMESTAMP  *'.             26130000
228800     DISPLAY '     ' PV-CURRENT-TIMESTAMP.                        26140000
228900     DISPLAY '*************************************'.             26150000
229000                                                                  26160000
229100     ADD CR-TSKST-READ-CNT     TO CR-TOT-TSKST-READ-CNT.          26170000
229200     ADD CR-LOC-TSKST-UPDT-CNT TO CR-TOT-LOC-TSKST-UPDT-CNT.      26180000
229300     ADD CR-000-TSKST-UPDT-CNT TO CR-TOT-000-TSKST-UPDT-CNT.      26190000
229400     ADD CR-TSKST-ISRT-CNT     TO CR-TOT-TSKST-ISRT-CNT.          26200000
229500                                                                  26210000
229600     MOVE +0 TO CR-TSKST-READ-CNT                                 26220000
229700                CR-LOC-TSKST-UPDT-CNT                             26230000
229800                CR-000-TSKST-UPDT-CNT                             26240000
229900                CR-TSKST-ISRT-CNT.                                26250000
230000                                                                  26260000
RONNA ******************************************************************26261010
RONNA *  DISPLAY RECEIPT PROCESSING TOTALS FOR RECEIPTS THAT DO         26262010
RONNA *  DO NOT UPDATE THE RECEIPT DATES                                26262110
RONNA ******************************************************************26263010
RONNA  9250-END-OF-RCPT.                                                26264010
RONNA                                                                   26265010
RONNA      DISPLAY SPACES.                                              26266010
RONNA      DISPLAY '*************************************'.             26267010
RONNA      DISPLAY '***** RECEIPT PROCESSING TOTALS *****'.             26268010
RONNA      DISPLAY '***** FOR CURSOR WITH NO RECEIPT DATE'.             26268110
RONNA      DISPLAY '***** UPDATES                        '.             26268210
RONNA      DISPLAY '*************************************'.             26269010
RONNA                                                                   26269110
RONNA      MOVE CR-OH-RCPT2-FETCH-CNT    TO PV-DISPLAY-COUNT.           26269210
RONNA      DISPLAY 'NBR OF FETCHES ON FSTT_OH_RCPT_AUD          = '     26269310
RONNA                                      PV-DISPLAY-COUNT.            26269410
RONNA                                                                   26269510
RONNA      MOVE CR-TSKST-READ-CNT       TO PV-DISPLAY-COUNT.            26269610
RONNA      DISPLAY 'NBR OF TSKST SELECTS                        = '     26269710
RONNA                                      PV-DISPLAY-COUNT.            26269810
RONNA                                                                   26269910
RONNA      MOVE CR-LOC-TSKST-UPDT-CNT   TO PV-DISPLAY-COUNT.            26270010
RONNA      DISPLAY 'NBR OF TSKST ITM/LOC UPDATES                = '     26270110
RONNA                                      PV-DISPLAY-COUNT.            26270210
RONNA                                                                   26270310
RONNA      MOVE CR-000-TSKST-UPDT-CNT   TO PV-DISPLAY-COUNT.            26270410
RONNA      DISPLAY 'NBR OF TSKST STR 000 UPDATES                = '     26270510
RONNA                                      PV-DISPLAY-COUNT.            26270610
RONNA                                                                   26270710
RONNA      MOVE CR-TSKST-ISRT-CNT       TO PV-DISPLAY-COUNT.            26270810
RONNA      DISPLAY 'NBR OF TSKST INSERTS                        = '     26270910
RONNA                                      PV-DISPLAY-COUNT.            26271010
RONNA                                                                   26271110
RONNA      MOVE CR-OH-RCPT2-UPDT-C-CNT   TO PV-DISPLAY-COUNT.           26271216
RONNA      DISPLAY 'NBR OF FSTT_OH_RCPT_AUD UPDATES TO STATUS C = '     26271310
RONNA                                      PV-DISPLAY-COUNT.            26271410
RONNA      DISPLAY SPACES.                                              26271510
RONNA                                                                   26271610
RONNA      PERFORM 8500-SET-CURRENT-TIMESTAMP.                          26271710
RONNA      DISPLAY '*************************************'.             26271810
RONNA      DISPLAY '* RECEIPT PROCESSING END TIMESTAMP  *'.             26271910
RONNA      DISPLAY '* FOR BOSS                          *'.             26272015
RONNA      DISPLAY '     ' PV-CURRENT-TIMESTAMP.                        26272115
RONNA      DISPLAY '*************************************'.             26272215
RONNA                                                                   26272315
RONNA      ADD CR-TSKST-READ-CNT     TO CR-TOT-TSKST-READ-CNT.          26272415
RONNA      ADD CR-LOC-TSKST-UPDT-CNT TO CR-TOT-LOC-TSKST-UPDT-CNT.      26272515
RONNA      ADD CR-000-TSKST-UPDT-CNT TO CR-TOT-000-TSKST-UPDT-CNT.      26272615
RONNA      ADD CR-TSKST-ISRT-CNT     TO CR-TOT-TSKST-ISRT-CNT.          26272715
RONNA                                                                   26272815
RONNA      MOVE +0 TO CR-TSKST-READ-CNT                                 26272915
RONNA                 CR-LOC-TSKST-UPDT-CNT                             26273015
RONNA                 CR-000-TSKST-UPDT-CNT                             26273115
RONNA                 CR-TSKST-ISRT-CNT.                                26273215
RONNA                                                                   26273315
230100******************************************************************26274000
230200*  DISPLAY SALES UPDATE PROCESSING TOTALS                         26280000
230300******************************************************************26290000
230400 9300-END-OF-SALES.                                               26300000
230500                                                                  26310000
230600     DISPLAY SPACES.                                              26320000
230700     DISPLAY '***********************************'.               26330000
230800     DISPLAY '***** SALES PROCESSING TOTALS *****'.               26340000
230900     DISPLAY '***********************************'.               26350000
231000                                                                  26360000
231100                                                                  26370000
231200     MOVE CR-OH-SLS-FETCH-CNT     TO PV-DISPLAY-COUNT.            26380000
231300     DISPLAY 'NBR OF FETCHES ON FSTT_OH_SLS_AUD          = '      26390000
231400                                     PV-DISPLAY-COUNT.            26400000
231500                                                                  26410000
231600     MOVE CR-TSKST-READ-CNT       TO PV-DISPLAY-COUNT.            26420000
231700     DISPLAY 'NBR OF TSKST SELECTS                       = '      26430000
231800                                     PV-DISPLAY-COUNT.            26440000
231900                                                                  26450000
232000     MOVE CR-LOC-TSKST-UPDT-CNT   TO PV-DISPLAY-COUNT.            26460000
232100     DISPLAY 'NBR OF TSKST ITM/LOC UPDATES               = '      26470000
232200                                     PV-DISPLAY-COUNT.            26480000
232300                                                                  26490000
232400     MOVE CR-000-TSKST-UPDT-CNT   TO PV-DISPLAY-COUNT.            26500000
232500     DISPLAY 'NBR OF TSKST STR 000 UPDATES               = '      26510000
232600                                     PV-DISPLAY-COUNT.            26520000
232700                                                                  26530000
232800     MOVE CR-TSKST-ISRT-CNT       TO PV-DISPLAY-COUNT.            26540000
232900     DISPLAY 'NBR OF TSKST INSERTS                       = '      26550000
233000                                     PV-DISPLAY-COUNT.            26560000
233100                                                                  26570000
233200     MOVE CR-OH-SLS-UPDT-C-CNT    TO PV-DISPLAY-COUNT.            26580000
233300     DISPLAY 'NBR OF FSTT_OH_SLS_AUD UPDATES TO STATUS C = '      26590000
233400                                     PV-DISPLAY-COUNT.            26600000
233500                                                                  26610000
233600     MOVE CR-TOT-SLS-AMT          TO PV-DISPLAY-COUNT-11.         26620000
233700     DISPLAY 'TOTAL SALES AMOUNT                   = '            26630000
233800                                     PV-DISPLAY-COUNT-11.         26640000
233900     DISPLAY SPACES.                                              26650000
234000                                                                  26660000
234100     PERFORM 8500-SET-CURRENT-TIMESTAMP.                          26670000
234200     DISPLAY '*************************************'.             26680000
234300     DISPLAY '*   SALES PROCESSING END TIMESTAMP  *'.             26690000
234400     DISPLAY '     ' PV-CURRENT-TIMESTAMP.                        26700000
234500     DISPLAY '*************************************'.             26710000
234600                                                                  26720000
234700     ADD CR-TSKST-READ-CNT     TO CR-TOT-TSKST-READ-CNT.          26730000
234800     ADD CR-LOC-TSKST-UPDT-CNT TO CR-TOT-LOC-TSKST-UPDT-CNT.      26740000
234900     ADD CR-000-TSKST-UPDT-CNT TO CR-TOT-000-TSKST-UPDT-CNT.      26750000
235000     ADD CR-TSKST-ISRT-CNT     TO CR-TOT-TSKST-ISRT-CNT.          26760000
235100                                                                  26770000
235200     MOVE +0 TO CR-TSKST-READ-CNT                                 26780000
235300                CR-LOC-TSKST-UPDT-CNT                             26790000
235400                CR-000-TSKST-UPDT-CNT                             26800000
235500                CR-TSKST-ISRT-CNT                                 26810000
235600                CR-TOT-SLS-AMT.                                   26820000
235700                                                                  26830000
235800                                                                  26840000
235900******************************************************************26850000
236000*  DISPLAY REMAINING COUNTS, CLOSE FILES, & UPDATE CKPT STATUS    26860000
236100******************************************************************26870000
236200 9900-END-OF-JOB.                                                 26880000
236300                                                                  26890000
236400     DISPLAY SPACES.                                              26900000
236500     DISPLAY '*********************************************'.     26910000
236600     DISPLAY '***** TOTAL COUNTS FOR PROGRAM FSKUP070 *****'.     26920000
236700     DISPLAY '*********************************************'.     26930000
236800                                                                  26940000
236900     MOVE CR-TOT-TSKST-READ-CNT   TO PV-DISPLAY-COUNT.            26950000
237000     DISPLAY 'TOT NBR OF TSKST SELECTS         = '                26960000
237100                                               PV-DISPLAY-COUNT.  26970000
237200                                                                  26980000
237300     MOVE CR-TOT-LOC-TSKST-UPDT-CNT  TO PV-DISPLAY-COUNT.         26990000
237400     DISPLAY 'TOT NBR OF TSKST ITM/LOC UPDATES = '                27000000
237500                                               PV-DISPLAY-COUNT.  27010000
237600                                                                  27020000
237700     MOVE CR-TOT-000-TSKST-UPDT-CNT  TO PV-DISPLAY-COUNT.         27030000
237800     DISPLAY 'TOT NBR OF TSKST STR 000 UPDATES = '                27040000
237900                                               PV-DISPLAY-COUNT.  27050000
238000                                                                  27060000
238100     MOVE CR-TOT-TSKST-ISRT-CNT   TO PV-DISPLAY-COUNT.            27070000
238200     DISPLAY 'TOT NBR TSKST INSERTS            = '                27080000
238300                                               PV-DISPLAY-COUNT.  27090000
238400                                                                  27100000
238500     MOVE CR-COMMIT-CNT           TO PV-DISPLAY-COUNT.            27110000
238600     DISPLAY 'TOT NBR OF COMMITS TAKEN         = '                27120000
238700                                               PV-DISPLAY-COUNT.  27130000
238800                                                                  27140000
238900     DISPLAY SPACES.                                              27150000
239000                                                                  27160000
P43627     CLOSE CONTROL-CARD-FILE                                      27170001
P43627           INPUT-RANGE-FILE.                                      27180001
239200                                                                  27190000
239300     MOVE '0' TO TCKRSTCNTL-CKPT-STAT-CODE.                       27200000
239400     PERFORM 8300-UPDATE-CHECKPOINT-STATUS.                       27210000
239500                                                                  27220000
239600***************************************************************** 27230000
239700* 9999-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      27240000
239800* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 27250000
239900***************************************************************** 27260000
240000 9999-SQL-ABEND.                                                  27270000
240100                                                                  27280000
240200     DISPLAY '** ABEND     **'.                                   27290000
240300     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                27300000
240400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              27310000
240500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     27320000
240600                                                                  27330000
240700***************************************************************** 27340000
240800* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    27350000
240900* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         27360000
241000* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     27370000
241100* FORMAT.                                                         27380000
241200***************************************************************** 27390000
241300     COPY DPPD004.                                                27400000
241400                                                                  27410000
241500     MOVE +4013 TO ABEND-CODE.                                    27420000
241600     CALL 'ILBOABN0' USING ABEND-CODE.                            27430009
