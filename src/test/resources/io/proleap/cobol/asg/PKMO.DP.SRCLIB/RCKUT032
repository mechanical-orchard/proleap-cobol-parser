000100******************************************************************00010012
000200 IDENTIFICATION DIVISION.                                         00020012
000300******************************************************************00030012
000400                                                                  00040012
000500 PROGRAM-ID.    RCKUT032.                                         00050012
000600 AUTHOR.        MARY SARDINA.                                     00060012
000700 INSTALLATION.  KOHLS.                                            00070012
000800 DATE-WRITTEN   JANUARY, 1996.                                    00080012
000900 DATE-COMPILED.                                                   00090012
001000                                                                  00100012
001100******************************************************************00110012
001200*  THIS PROGRAM CREATES AN EXTRACT FILE OF DATA FORM THE RECEIVER 00120012
001300*  AUDIT TABLE.  IT ALSO CREATES A TIMESTAMP CONTROL FILE.        00130012
001400******************************************************************00140012
001500                                                                  00150012
001600******************************************************************00160012
001700 ENVIRONMENT DIVISION.                                            00170012
001800******************************************************************00180012
001900                                                                  00190012
002000 CONFIGURATION SECTION.                                           00200012
002100                                                                  00210012
002200 SOURCE-COMPUTER.        IBM-3090.                                00220012
002300 OBJECT-COMPUTER.        IBM-3090.                                00230012
002400                                                                  00240012
002500 INPUT-OUTPUT SECTION.                                            00250012
002600                                                                  00260012
002700 FILE-CONTROL.                                                    00270012
002800                                                                  00280012
002900                                                                  00290012
003000     SELECT TIMESTAMP-FILE                                        00300012
003100         ASSIGN TO OUT01.                                         00310012
003200                                                                  00320012
003300     SELECT RECEIVER-AUDIT-FILE                                   00330012
003400         ASSIGN TO OUT02.                                         00340012
003500******************************************************************00350012
003600 DATA DIVISION.                                                   00360012
003700******************************************************************00370012
003800                                                                  00380012
003900 FILE SECTION.                                                    00390012
004000                                                                  00400012
004100 FD  TIMESTAMP-FILE                                               00410012
004200     RECORDING MODE IS F                                          00420012
004300     LABEL RECORDS ARE STANDARD                                   00430012
004400     BLOCK CONTAINS 0 RECORDS.                                    00440012
004500                                                                  00450012
004600 01  TIMESTAMP-RECORD           PIC  X(50).                       00460012
004700                                                                  00470012
004800 FD  RECEIVER-AUDIT-FILE                                          00480012
004900     RECORDING MODE IS F                                          00490012
005000     LABEL RECORDS ARE STANDARD                                   00500012
005100     BLOCK CONTAINS 0 RECORDS.                                    00510012
005200                                                                  00520012
005300 01  RECEIVER-AUDIT-RECORD      PIC  X(400).                      00530012
005400*                                                                 00540012
005500*                                                                 00550012
005600******************************************************************00560012
005700 WORKING-STORAGE SECTION.                                         00570012
005800******************************************************************00580012
005900*                                                                 00590012
006000*                                                                 00600012
006100*                                                                 00610012
006200******************************************************************00620012
006300*  RECORD LAYOUT FOR THE TIMESTAMP FILE.                          00630012
006400******************************************************************00640012
006500     COPY RCRD011.                                                00650012
006600*                                                                 00660012
006700*                                                                 00670012
006800******************************************************************00680012
006900*  RECORD LAYOUT FOR THE RECEIVER AUDIT TABLE FILE.               00690012
007000******************************************************************00700012
007100     COPY RCRD012.                                                00710012
007200*                                                                 00720012
007300*                                                                 00730012
007400******************************************************************00740012
007500*  DB2 FORMATTED MESSAGE AREA                                     00750012
007600******************************************************************00760012
007700     COPY DPWS004.                                                00770012
007800*                                                                 00780012
007900*                                                                 00790012
008000*                                                                 00800012
008100******************************************************************00810012
008200*  COMMUNICATIONS AREA FOR DB2                                    00820012
008300******************************************************************00830012
008400     EXEC SQL                                                     00840012
008500          INCLUDE SQLCA                                           00850012
008600     END-EXEC.                                                    00860012
008700*                                                                 00870012
008800*                                                                 00880012
008900******************************************************************00890012
009000*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE ?????????????????  00900012
009100*  TABLE                                                          00910012
009200******************************************************************00920012
009300     EXEC SQL                                                     00930012
009400          INCLUDE TCOCNTL                                         00940012
009500     END-EXEC.                                                    00950012
009600                                                                  00960012
009700*                                                                 00970012
009800*                                                                 00980012
009900******************************************************************00990012
010000*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE RECEIVER AUDIT     01000012
010100*  TABLE                                                          01010012
010200******************************************************************01020012
010300     EXEC SQL                                                     01030012
010400          INCLUDE TAURECV                                         01040012
010500     END-EXEC.                                                    01050012
010600*                                                                 01060012
010700 01  ABEND-CODE                      PIC S9(04)    VALUE +0       01070012
010800                                                   COMP SYNC.     01080012
010900                                                                  01090012
011000 01  PS-PROGRAM-SWITCHES.                                         01100012
011100     05  PS-USE-SHIPPED-ITEM-SW      PIC  X(01)    VALUE SPACE.   01110012
011200         88  PS-USE-SHIPPED-ITEM                   VALUE 'Y'.     01120012
011300     05  PS-EOF-AUDIT-RECV-CSR-SW    PIC  X(01)    VALUE 'N'.     01130012
011400         88  PS-EOF-AUDIT-RECV-CSR                 VALUE 'Y'.     01140012
011500         88  PS-MORE-AUDIT-RECV-CSR                VALUE 'N'.     01150012
011600                                                                  01160012
011700                                                                  01170012
011800 01  PC-PROGRAM-CONSTANTS.                                        01180012
011900     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01190012
012000                                                   COMP SYNC.     01200012
012100     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01210012
012200         'RCKUT032'.                                              01220012
012300     05  PC-CURRENT-OPERATING-COMPANY                             01230012
012400                                     PIC  X(02)    VALUE '03'.    01240012
012500     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       01250012
012600                                                   COMP SYNC.     01260012
012700     05  PC-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  01270012
012800     05  PC-PROCESS-DATE             PIC  X(10)    VALUE SPACES.  01280012
012900     05  PC-PROCESS-TMST             PIC  X(26)    VALUE SPACES.  01290012
013000                                                                  01300012
013100 01  PV-PROGRAM-VARIABLES.                                        01310012
013200     05  PV-ITEM-NBR                 PIC  9(15)    VALUE ZERO.    01320012
013300     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01330012
013400     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01340012
013500     05  PV-AURECV-REC-COUNT          PIC S9(09) VALUE ZERO       01350012
013600                                                 COMP SYNC.       01360012
013700     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01370012
013800     05  PV-OPEN-COUNTER             PIC S9(04)    VALUE ZERO     01380012
013900                                                   COMP SYNC.     01390012
014000     05  PV-CLOSE-COUNTER            PIC S9(04)    VALUE ZERO     01400012
014100                                                   COMP SYNC.     01410012
014200     05  PV-FETCH-COUNTER            PIC S9(04)    VALUE ZERO     01420012
014300                                                   COMP SYNC.     01430012
014400     05  PV-WRITE-COUNTER            PIC S9(04)    VALUE ZERO     01440012
014500                                                   COMP SYNC.     01450012
014600     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     01460012
014700                                                   COMP-3.        01470012
014800     05  PV-OPER-UNT-ID              PIC 9(04)     VALUE ZERO.    01480012
014900                                                                  01490012
015000     05  PV-RECV-SEQ-NBR             PIC 9(03)     VALUE ZERO.    01500012
015100                                                                  01510012
015200     05  PV-PO-NBR                   PIC S9(08)    VALUE ZERO.    01520012
015300                                                                  01530012
015400     05  PV-PO-LNE-NBR               PIC 9(03)     VALUE ZERO.    01540012
015500                                                                  01550012
015600     05  PV-PROCESS-TIMESTAMP.                                    01560012
015700         10  PV-PROCESS-DATE         PIC X(10).                   01570012
015800         10  FILLER                  PIC X(16)     VALUE          01580012
015900                                     '-23.59.59.999999'.          01590012
016000*                                                                 01600012
016100*                                                                 01610012
016200 01  SD-SYSTEM-DATE.                                              01620012
016300     05  SD-SYSTEM-DATE-YY           PIC  9(02)      VALUE ZERO.  01630012
016400     05  SD-SYSTEM-DATE-MM           PIC  9(02)      VALUE ZERO.  01640012
016500     05  SD-SYSTEM-DATE-DD           PIC  9(02)      VALUE ZERO.  01650012
016600                                                                  01660012
016700*                                                                 01670012
016800*  CURSOR DECLARATION FOR ALL EXCEPTION ACTIVITY ON THE           01680012
016900*  UPC CERTIFICATION ACTIVITY LOG TABLE                           01690012
017000*                                                                 01700012
017100                                                                  01710012
017200     EXEC SQL                                                     01720012
017300          DECLARE AUDIT_RECV_CURSOR CURSOR FOR                    01730012
017400           SELECT                                                 01740012
017500             ORD_NBR                                              01750012
017600            ,REC_SEQ_NBR                                          01760012
017700            ,CRE_TMST                                             01770012
017800            ,CRE_UID                                              01780012
017900            ,PO_VER_NBR                                           01790012
018000            ,OPER_UNT_ID                                          01800012
018100            ,FCLTY_ID                                             01810012
018200            ,STATUS_CDE                                           01820012
018300            ,SYST_CRE_CDE                                         01830012
018400            ,REC_TYP_CDE                                          01840012
018500            ,VER_STATUS_CDE                                       01850012
018600            ,PACK_BY_ST_IND                                       01860012
018700            ,REC_TMST                                             01870012
018800            ,EXPTED_CART_CNT                                      01880012
018900            ,ACTL_CART_CNT                                        01890012
019000            ,EXPTED_ITM_QTY                                       01900012
019100            ,ACTL_ITM_QTY                                         01910012
019200            ,RCVR_NBR                                             01920012
019300            ,ML_POST_TMST                                         01930012
019400            ,FS_POST_TMST                                         01940012
019500            ,PRE_TKT_IND                                          01950012
019600            ,AD_INFO_DESC                                         01960012
019700            ,IN_TRBL_TMST                                         01970012
019800            ,IN_TRBL_MIN_CNT                                      01980012
019900            ,IN_TRBL_HOUR_CNT                                     01990012
020000            ,VERFYD_TMST                                          02000012
020100            ,RCVG_CLERK_INIT_ID                                   02010012
020200            ,REFER_BACK_SEQ_NBR                                   02020012
020300            ,AP_PRC_CDE                                           02030012
020400            ,AP_PRC_DTE                                           02040012
020500            ,MIS_DIRECT_IND                                       02050012
020600            ,IMPRT_IND                                            02060012
020700            ,CRE_OPER_UNT_ID                                      02070012
020800            ,CRE_FCLTY_ID                                         02080012
020900            ,CURR_OPER_UNT_ID                                     02090012
021000            ,CURR_FCLTY_ID                                        02100012
021100            ,UPD_TMST                                             02110012
021200            ,UPD_UID                                              02120012
021300            ,UPD_PGM_ID                                           02130012
021400            ,APRON_LOC_DESC                                       02140012
021500            ,MKNG_APRN_PRT_TMST                                   02150012
021600            ,GOH_IND                                              02160012
021700            ,AUD_TYP_CDE                                          02170012
021800            ,AUD_FUNC_CDE                                         02180012
021900            ,NOTIF_NBR                                            02190012
022000            ,VRFD_USR_ID                                          02200012
022100            ,AP_RVRSL_IND                                         02210012
022200            ,AP_RVRSL_DTE                                         02220012
022300            ,PKGNG_CDE                                            02230012
022310            ,FRE_ASTRA_IND                                        02231013
022400             FROM TAURECV                                         02240012
022500            WHERE UPD_TMST  <= :PC-PROCESS-TMST                   02250012
022600                                                                  02260012
022700     END-EXEC.                                                    02270012
022800                                                                  02280012
022900                                                                  02290012
023000******************************************************************02300012
023100 PROCEDURE DIVISION.                                              02310012
023200******************************************************************02320012
023300                                                                  02330012
023400 0000-PROGRAM-MAINLINE.                                           02340012
023500******************************************************************02350012
023600* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     02360012
023700*      PROGRAM.                                                   02370012
023800******************************************************************02380012
023900                                                                  02390012
024000     PERFORM 1000-INITIALIZE.                                     02400012
024100     IF PS-MORE-AUDIT-RECV-CSR                                    02410012
024200         PERFORM 2000-PROCESS-AUDIT-RECEIVERS                     02420012
024300            UNTIL PS-EOF-AUDIT-RECV-CSR                           02430012
024400     END-IF.                                                      02440012
024500     PERFORM 9000-EOJ-ROUTINE.                                    02450012
024600                                                                  02460012
024700     STOP RUN.                                                    02470012
024800*0000-EXIT.                                                       02480012
024900*                                                                 02490012
025000*                                                                 02500012
025100 1000-INITIALIZE.                                                 02510012
025200******************************************************************02520012
025300*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    02530012
025400*    -- OPEN OUTPUT FILE                                          02540012
025500*    -- OPEN CURSOR                                               02550012
025600*    -- FETCH CURSOR                                              02560012
025700******************************************************************02570012
025800*                                                                 02580012
025900     ACCEPT SD-SYSTEM-DATE FROM DATE.                             02590012
026000*                                                                 02600012
026100     OPEN OUTPUT RECEIVER-AUDIT-FILE                              02610012
026200                 TIMESTAMP-FILE.                                  02620012
026300                                                                  02630012
026400     PERFORM 1100-CREATE-CONTROL-CARD.                            02640012
026500     PERFORM 7000-OPEN-AUDIT-RECV-CURSOR.                         02650012
026600     PERFORM 7100-FETCH-AUDIT-RECV-CURSOR.                        02660012
026700*1000-EXIT.                                                       02670012
026800*                                                                 02680012
026900 1100-CREATE-CONTROL-CARD.                                        02690012
027000******************************************************************02700012
027100*  CREATE THE CONTROL CARD.                                       02710012
027200******************************************************************02720012
027300                                                                  02730012
027400     EXEC SQL                                                     02740012
027500          SELECT DISTINCT                                         02750012
027600                 BTCH_PRC_DTE                                     02760012
027700            INTO                                                  02770012
027800                 :PC-PROCESS-DATE                                 02780012
027900            FROM                                                  02790012
028000                 TCOCNTL                                          02800012
028100     END-EXEC.                                                    02810012
028200                                                                  02820012
028300     EVALUATE TRUE                                                02830012
028400         WHEN SQLCODE = ZERO                                      02840012
028500             CONTINUE                                             02850012
028600         WHEN SQLWARN0 NOT = SPACES                               02860012
028700         WHEN SQLCODE < ZERO                                      02870012
028800         WHEN SQLCODE > ZERO                                      02880012
028900             MOVE '1100-CREATE CONTROL CARD'                      02890012
029000                                 TO PV-PARAGRAPH-NAME             02900012
029100             MOVE 'ATTEMPTING TO SELECT CURRENT TIMESTAMP         02910012
029200-                 'FROM TCOCNTL'                                  02920012
029300                                 TO PV-DB2-OPERATION-ATTEMPTED    02930012
029400             PERFORM 9100-SQL-ABEND                               02940012
029500     END-EVALUATE.                                                02950012
029600     INITIALIZE RC011-CONTROL-RECORD.                             02960012
029700     INITIALIZE TIMESTAMP-RECORD.                                 02970012
029800     MOVE PC-PROCESS-DATE      TO PV-PROCESS-DATE.                02980012
029900     MOVE PV-PROCESS-TIMESTAMP TO RC011-CONTROL-RECORD            02990012
030000                                  PC-PROCESS-TMST.                03000012
030100     DISPLAY 'RCKUT032 CONTROL CARD -- ' RC011-CONTROL-TMST.      03010012
030200     PERFORM 8100-WRITE-TIMESTAMP-RECORD.                         03020012
030300*                                                                 03030012
030400*1100-EXIT.                                                       03040012
030500*                                                                 03050012
030600*                                                                 03060012
030700 2000-PROCESS-AUDIT-RECEIVERS.                                    03070012
030800******************************************************************03080012
030900*  PROCESS THE CERTIFICATION REQUESTS (LOOP THROUGH THE RESULTS   03090012
031000*  TABLE).  FORMAT THE OUTPUT RECORD.  WRITE THE RECORDS THAT     03100012
031100*  MEET THE CRITERIA.                                             03110012
031200******************************************************************03120012
031300                                                                  03130012
031400     PERFORM 8000-WRITE-AUDIT-RECV-RECORD.                        03140012
031500     PERFORM 7100-FETCH-AUDIT-RECV-CURSOR.                        03150012
031600*2000-EXIT.                                                       03160012
031700                                                                  03170012
031800 7000-OPEN-AUDIT-RECV-CURSOR.                                     03180012
031900******************************************************************03190012
032000*  OPEN THE CURSOR.                                               03200012
032100******************************************************************03210012
032200     PERFORM WITH TEST AFTER                                      03220012
032300       VARYING PV-OPEN-COUNTER FROM 1 BY 1                        03230012
032400         UNTIL (PV-OPEN-COUNTER > PC-MAX-RETRIES                  03240012
032500                OR                                                03250012
032600                SQLCODE = ZERO)                                   03260012
032700                                                                  03270012
032800         EXEC SQL                                                 03280012
032900              OPEN AUDIT_RECV_CURSOR                              03290012
033000         END-EXEC                                                 03300012
033100                                                                  03310012
033200         EVALUATE TRUE                                            03320012
033300             WHEN SQLCODE = -904                                  03330012
033400             WHEN SQLCODE = -911                                  03340012
033500                 CONTINUE                                         03350012
033600             WHEN SQLWARN0 NOT = SPACES                           03360012
033700             WHEN SQLCODE < ZERO                                  03370012
033800             WHEN SQLCODE > ZERO                                  03380012
033900                 MOVE '7000-OPEN-AUDIT-RECV-CURSOR    '           03390012
034000                                 TO PV-PARAGRAPH-NAME             03400012
034100                 MOVE 'OPEN THE AUDIT_RECV_CURSOR    '            03410012
034200                                 TO PV-DB2-OPERATION-ATTEMPTED    03420012
034300                 PERFORM 9100-SQL-ABEND                           03430012
034400             WHEN SQLCODE = ZERO                                  03440012
034500                 CONTINUE                                         03450012
034600         END-EVALUATE                                             03460012
034700     END-PERFORM.                                                 03470012
034800                                                                  03480012
034900     IF PV-OPEN-COUNTER > PC-MAX-RETRIES                          03490012
035000         MOVE '7000-OPEN-AUDIT-RECV-CURSOR   '                    03500012
035100                                 TO PV-PARAGRAPH-NAME             03510012
035200         MOVE 'OPEN MAX RETRIES EXCEEDED     '                    03520012
035300                                 TO PV-DB2-OPERATION-ATTEMPTED    03530012
035400         PERFORM 9100-SQL-ABEND                                   03540012
035500     END-IF.                                                      03550012
035600*7000-EXIT.                                                       03560012
035700*                                                                 03570012
035800*                                                                 03580012
035900 7100-FETCH-AUDIT-RECV-CURSOR.                                    03590012
036000******************************************************************03600012
036100*  FETCH THE ROW FROM THE RESULTS TABLE USING THE CURSOR.         03610012
036200******************************************************************03620012
036300     EXEC SQL                                                     03630012
036400          FETCH AUDIT_RECV_CURSOR                                 03640012
036500           INTO :AURECV-ORD-NBR,                                  03650012
036600                :AURECV-REC-SEQ-NBR,                              03660012
036700                :AURECV-CRE-TMST,                                 03670012
036800                :AURECV-CRE-UID,                                  03680012
036900                :AURECV-PO-VER-NBR,                               03690012
037000                :AURECV-OPER-UNT-ID,                              03700012
037100                :AURECV-FCLTY-ID,                                 03710012
037200                :AURECV-STATUS-CDE,                               03720012
037300                :AURECV-SYST-CRE-CDE,                             03730012
037400                :AURECV-REC-TYP-CDE,                              03740012
037500                :AURECV-VER-STATUS-CDE,                           03750012
037600                :AURECV-PACK-BY-ST-IND,                           03760012
037700                :AURECV-REC-TMST,                                 03770012
037800                :AURECV-EXPTED-CART-CNT,                          03780012
037900                :AURECV-ACTL-CART-CNT,                            03790012
038000                :AURECV-EXPTED-ITM-QTY,                           03800012
038100                :AURECV-ACTL-ITM-QTY,                             03810012
038200                :AURECV-RCVR-NBR,                                 03820012
038300                :AURECV-ML-POST-TMST,                             03830012
038400                :AURECV-FS-POST-TMST,                             03840012
038500                :AURECV-PRE-TKT-IND,                              03850012
038600                :AURECV-AD-INFO-DESC,                             03860012
038700                :AURECV-IN-TRBL-TMST,                             03870012
038800                :AURECV-IN-TRBL-MIN-CNT,                          03880012
038900                :AURECV-IN-TRBL-HOUR-CNT,                         03890012
039000                :AURECV-VERFYD-TMST,                              03900012
039100                :AURECV-RCVG-CLERK-INIT-ID,                       03910012
039200                :AURECV-REFER-BACK-SEQ-NBR,                       03920012
039300                :AURECV-AP-PRC-CDE,                               03930012
039400                :AURECV-AP-PRC-DTE,                               03940012
039500                :AURECV-MIS-DIRECT-IND,                           03950012
039600                :AURECV-IMPRT-IND,                                03960012
039700                :AURECV-CRE-OPER-UNT-ID,                          03970012
039800                :AURECV-CRE-FCLTY-ID,                             03980012
039900                :AURECV-CURR-OPER-UNT-ID,                         03990012
040000                :AURECV-CURR-FCLTY-ID,                            04000012
040100                :AURECV-UPD-TMST,                                 04010012
040200                :AURECV-UPD-UID,                                  04020012
040300                :AURECV-UPD-PGM-ID,                               04030012
040400                :AURECV-APRON-LOC-DESC,                           04040012
040500                :AURECV-MKNG-APRN-PRT-TMST,                       04050012
040600                :AURECV-GOH-IND,                                  04060012
040700                :AURECV-AUD-TYP-CDE,                              04070012
040800                :AURECV-AUD-FUNC-CDE,                             04080012
040900                :AURECV-NOTIF-NBR,                                04090014
041000                :AURECV-VRFD-USR-ID,                              04100014
041100                :AURECV-AP-RVRSL-IND,                             04110014
041200                :AURECV-AP-RVRSL-DTE,                             04120014
041300                :AURECV-PKGNG-CDE,                                04130014
041310                :AURECV-FRE-ASTRA-IND                             04131014
041400     END-EXEC.                                                    04140012
041500                                                                  04150012
041600     EVALUATE TRUE                                                04160012
041700         WHEN SQLCODE = ZERO                                      04170012
041800             ADD +1 TO PV-AURECV-REC-COUNT                        04180012
041900         WHEN SQLCODE = +100                                      04190012
042000             SET PS-EOF-AUDIT-RECV-CSR                            04200012
042100                                 TO TRUE                          04210012
042200         WHEN SQLWARN0 NOT = SPACES                               04220012
042300         WHEN SQLCODE < ZERO                                      04230012
042400         WHEN SQLCODE > ZERO                                      04240012
042500             MOVE '7100-FETCH-AUDIT-RECV-CURSOR  '                04250012
042600                                 TO PV-PARAGRAPH-NAME             04260012
042700             MOVE 'FETCH THE AUDIT-RECV-CURSOR   '                04270012
042800                                 TO PV-DB2-OPERATION-ATTEMPTED    04280012
042900             PERFORM 9100-SQL-ABEND                               04290012
043000     END-EVALUATE.                                                04300012
043100*7100-EXIT.                                                       04310012
043200*                                                                 04320012
043300*                                                                 04330012
043400*                                                                 04340012
043500 8000-WRITE-AUDIT-RECV-RECORD.                                    04350012
043600******************************************************************04360012
043700*  WRITE THE RECEIVER-AUDIT-RECORD                                04370012
043800******************************************************************04380012
043900     PERFORM 8010-BUILD-RC012-RECORD.                             04390012
044000     WRITE RECEIVER-AUDIT-RECORD                                  04400012
044100         FROM RC012-TRECEIV-AUDIT-RECORD.                         04410012
044200     ADD +1 TO PV-WRITE-COUNTER.                                  04420012
044300*8000-EXIT.                                                       04430012
044400*                                                                 04440012
044500*                                                                 04450012
044600 8010-BUILD-RC012-RECORD.                                         04460012
044700                                                                  04470012
044800     INITIALIZE RC012-TRECEIV-AUDIT-RECORD.                       04480012
044900     MOVE AURECV-ORD-NBR              TO RC012-ORD-NBR            04490012
045000     MOVE AURECV-REC-SEQ-NBR          TO RC012-REC-SEQ-NBR        04500012
045100     MOVE AURECV-CRE-TMST             TO RC012-CRE-TMST           04510012
045200     MOVE AURECV-CRE-UID              TO RC012-CRE-UID            04520012
045300     MOVE AURECV-PO-VER-NBR           TO RC012-PO-VER-NBR         04530012
045400     MOVE AURECV-OPER-UNT-ID          TO RC012-OPER-UNT-ID        04540012
045500     MOVE AURECV-FCLTY-ID             TO RC012-FCLTY-ID           04550012
045600     MOVE AURECV-STATUS-CDE           TO RC012-STATUS-CDE         04560012
045700     MOVE AURECV-SYST-CRE-CDE         TO RC012-SYST-CRE-CDE       04570012
045800     MOVE AURECV-REC-TYP-CDE          TO RC012-REC-TYP-CDE        04580012
045900     MOVE AURECV-VER-STATUS-CDE       TO RC012-VER-STATUS-CDE     04590012
046000     MOVE AURECV-PACK-BY-ST-IND       TO RC012-PACK-BY-ST-IND     04600012
046100     MOVE AURECV-REC-TMST             TO RC012-REC-TMST           04610012
046200     MOVE AURECV-EXPTED-CART-CNT      TO RC012-EXPTED-CART-CNT    04620012
046300     MOVE AURECV-ACTL-CART-CNT        TO RC012-ACTL-CART-CNT      04630012
046400     MOVE AURECV-EXPTED-ITM-QTY       TO RC012-EXPTED-ITM-QTY     04640012
046500     MOVE AURECV-ACTL-ITM-QTY         TO RC012-ACTL-ITM-QTY       04650012
046600     MOVE AURECV-RCVR-NBR             TO RC012-RCVR-NBR           04660012
046700     MOVE AURECV-ML-POST-TMST         TO RC012-ML-POST-TMST       04670012
046800     MOVE AURECV-FS-POST-TMST         TO RC012-FS-POST-TMST       04680012
046900     MOVE AURECV-PRE-TKT-IND          TO RC012-PRE-TKT-IND        04690012
047000     MOVE AURECV-AD-INFO-DESC         TO RC012-AD-INFO-DESC       04700012
047100     MOVE AURECV-IN-TRBL-TMST         TO RC012-IN-TRBL-TMST       04710012
047200     MOVE AURECV-IN-TRBL-MIN-CNT      TO RC012-IN-TRBL-MIN-CNT    04720012
047300     MOVE AURECV-IN-TRBL-HOUR-CNT     TO RC012-IN-TRBL-HOUR-CNT   04730012
047400     MOVE AURECV-VERFYD-TMST          TO RC012-VERFYD-TMST        04740012
047500     MOVE AURECV-RCVG-CLERK-INIT-ID   TO RC012-RCVG-CLERK-INIT-ID 04750012
047600     MOVE AURECV-REFER-BACK-SEQ-NBR   TO RC012-REFER-BACK-SEQ-NBR 04760012
047700     MOVE AURECV-AP-PRC-CDE           TO RC012-AP-PRC-CDE         04770012
047800     MOVE AURECV-AP-PRC-DTE           TO RC012-AP-PRC-DTE         04780012
047900     MOVE AURECV-MIS-DIRECT-IND       TO RC012-MIS-DIRECT-IND     04790012
048000     MOVE AURECV-IMPRT-IND            TO RC012-IMPRT-IND          04800012
048100     MOVE AURECV-CRE-OPER-UNT-ID      TO RC012-CRE-OPER-UNT-ID    04810012
048200     MOVE AURECV-CRE-FCLTY-ID         TO RC012-CRE-FCLTY-ID       04820012
048300     MOVE AURECV-CURR-OPER-UNT-ID     TO RC012-CURR-OPER-UNT-ID   04830012
048400     MOVE AURECV-CURR-FCLTY-ID        TO RC012-CURR-FCLTY-ID      04840012
048500     MOVE AURECV-UPD-TMST             TO RC012-UPD-TMST           04850012
048600     MOVE AURECV-UPD-UID              TO RC012-UPD-UID            04860012
048700     MOVE AURECV-UPD-PGM-ID           TO RC012-UPD-PGM-ID         04870012
048800     MOVE AURECV-APRON-LOC-DESC       TO RC012-APRON-LOC-DESC     04880012
048900     MOVE AURECV-MKNG-APRN-PRT-TMST   TO RC012-MKNG-APRN-PRT-TMST 04890012
049000     MOVE AURECV-GOH-IND              TO RC012-GOH-IND            04900012
049100     MOVE AURECV-AUD-TYP-CDE          TO RC012-AUD-TYP-CDE        04910012
049200     MOVE AURECV-AUD-FUNC-CDE         TO RC012-FUNC-CDE           04920012
049300     MOVE AURECV-NOTIF-NBR            TO RC012-NOTIF-NBR          04930012
049400     MOVE AURECV-VRFD-USR-ID          TO RC012-VRFD-USR-ID        04940012
049500     MOVE AURECV-AP-RVRSL-IND         TO RC012-AP-RVRSL-IND       04950012
049600     MOVE AURECV-AP-RVRSL-DTE         TO RC012-AP-RVRSL-DTE       04960012
049700     MOVE AURECV-PKGNG-CDE            TO RC012-PKGNG-CDE          04970012
049710     MOVE AURECV-FRE-ASTRA-IND        TO RC012-FRE-ASTRA-IND      04971013
049800                                                                  04980012
049900     MOVE SPACES                      TO RC012-AP-TMST.           04990012
050000 8100-WRITE-TIMESTAMP-RECORD.                                     05000012
050100******************************************************************05010012
050200*  WRITE THE TIMESTAMP RECORD                                     05020012
050300******************************************************************05030012
050400     WRITE TIMESTAMP-RECORD                                       05040012
050500         FROM RC011-CONTROL-RECORD.                               05050012
050600                                                                  05060012
050700*8100-EXIT.                                                       05070012
050800*                                                                 05080012
050900*                                                                 05090012
051000 9000-EOJ-ROUTINE.                                                05100012
051100******************************************************************05110012
051200*  CLOSE OUTPUT FILE.  CLOSE THE CURSOR.                          05120012
051300******************************************************************05130012
051400     CLOSE RECEIVER-AUDIT-FILE                                    05140012
051500           TIMESTAMP-FILE.                                        05150012
051600                                                                  05160012
051700     MOVE PV-AURECV-REC-COUNT TO PV-DISPLAY-COUNT.                05170012
051800     DISPLAY 'TOTAL AUDIT RECORDS SELECTED ' PV-DISPLAY-COUNT.    05180012
051900     MOVE PV-WRITE-COUNTER TO PV-DISPLAY-COUNT.                   05190012
052000     DISPLAY 'TOTAL AUDIT RECORDS WRITTEN  ' PV-DISPLAY-COUNT.    05200012
052100                                                                  05210012
052200     PERFORM WITH TEST AFTER                                      05220012
052300       VARYING PV-CLOSE-COUNTER FROM 1 BY 1                       05230012
052400         UNTIL (PV-CLOSE-COUNTER > PC-MAX-RETRIES                 05240012
052500                OR                                                05250012
052600                SQLCODE = ZERO)                                   05260012
052700                                                                  05270012
052800         EXEC SQL                                                 05280012
052900              CLOSE AUDIT_RECV_CURSOR                             05290012
053000         END-EXEC                                                 05300012
053100                                                                  05310012
053200         EVALUATE TRUE                                            05320012
053300             WHEN SQLCODE = -904                                  05330012
053400             WHEN SQLCODE = -911                                  05340012
053500                 CONTINUE                                         05350012
053600             WHEN SQLWARN0 NOT = SPACES                           05360012
053700             WHEN SQLCODE < ZERO                                  05370012
053800             WHEN SQLCODE > ZERO                                  05380012
053900                 MOVE '9000-EOJ-ROUTINE               '           05390012
054000                                 TO PV-PARAGRAPH-NAME             05400012
054100                 MOVE 'CLOSE THE AUDIT_RECV_CURSOR    '           05410012
054200                                 TO PV-DB2-OPERATION-ATTEMPTED    05420012
054300                 PERFORM 9100-SQL-ABEND                           05430012
054400             WHEN SQLCODE = ZERO                                  05440012
054500                 CONTINUE                                         05450012
054600         END-EVALUATE                                             05460012
054700     END-PERFORM.                                                 05470012
054800                                                                  05480012
054900     IF PV-CLOSE-COUNTER > PC-MAX-RETRIES                         05490012
055000         MOVE '9000-EOJ-ROUTINE               '                   05500012
055100                                 TO PV-PARAGRAPH-NAME             05510012
055200         MOVE 'CLOSE MAX RETRIES EXCEEDED     '                   05520012
055300                                 TO PV-DB2-OPERATION-ATTEMPTED    05530012
055400         PERFORM 9100-SQL-ABEND                                   05540012
055500     END-IF.                                                      05550012
055600*9000-EXIT.                                                       05560012
055700*                                                                 05570012
055800*                                                                 05580012
055900 9100-SQL-ABEND.                                                  05590012
056000******************************************************************05600012
056100*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    05610012
056200*  ERROR OR WARNING CODE OCCURS.                                  05620012
056300******************************************************************05630012
056400     DISPLAY '9100-SQL-ABEND'.                                    05640012
056500     DISPLAY '** ABEND     **'.                                   05650012
056600     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05660012
056700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05670012
056800     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     05680012
056900                                                                  05690012
057000******************************************************************05700012
057100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    05710012
057200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05720012
057300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05730012
057400* FORMAT.                                                         05740012
057500******************************************************************05750012
057600     COPY DPPD004.                                                05760012
057700                                                                  05770012
057800     MOVE +4013                  TO ABEND-CODE.                   05780012
057900     CALL 'ILBOABN0' USING ABEND-CODE.                            05790012
058000*9100-EXIT.                                                       05800012
