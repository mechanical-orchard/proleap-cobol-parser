       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    MLKUP971.                                         00020010
       AUTHOR.        B. GRAHAM - STRATAGEM.                            00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  07/08/07.                                         00050000
       DATE-COMPILED.                                                   00060000
                                                                        00070000
      ******************************************************************00080000
      * THIS PROGRAM WILL INSERT EIC 2 CORRECTIONS FOR UNKNOWN /        00090000
      * UNKNOWN USING LOCATION 400 SUB CLASS 10                         00100000
      ******************************************************************00110000
                                                                        00120000
      ******************************************************************00130000
       ENVIRONMENT DIVISION.                                            00140000
      ******************************************************************00150000
                                                                        00160000
       CONFIGURATION SECTION.                                           00170000
                                                                        00180000
       SOURCE-COMPUTER.        IBM-3090.                                00190000
       OBJECT-COMPUTER.        IMB-3090.                                00200000
                                                                        00210000
       INPUT-OUTPUT SECTION.                                            00220000
                                                                        00230000
       FILE-CONTROL.                                                    00240000
           SELECT CNTL-DATE-FILE                                        00250000
               ASSIGN TO INP01.                                         00260000
           SELECT EIC-2-INPUT-FILE                                      00270000
               ASSIGN TO INP02.                                         00280000
      ******************************************************************00290000
       DATA DIVISION.                                                   00300000
      ******************************************************************00310000
                                                                        00320000
       FILE SECTION.                                                    00330000
                                                                        00340000
       FD  CNTL-DATE-FILE                                               00350000
           RECORDING  MODE IS F.                                        00360000
       01  CNTL-DATE-REC                    PIC X(80).                  00370000
                                                                        00380000
       FD  EIC-2-INPUT-FILE                                             00390000
           RECORDING  MODE IS F.                                        00400000
       01  EIC-2-INPUT-REC                  PIC X(017).                 00410000
                                                                        00420000
       WORKING-STORAGE SECTION.                                         00430000
                                                                        00440000
       01  ABEND-CODE                        PIC S9(4) VALUE ZEROS      00450000
                                                       COMP SYNC.       00460000
           88  AC-OTHER-ERROR                          VALUE +4003.     00470000
           88  AC-SQL-ERROR                            VALUE +4013.     00480000
                                                                        00490000
       01  PS-PROGRAM-SWITCHES.                                         00500000
           05  PS-EIC-2-AT-END-SW            PIC X     VALUE 'N'.       00530001
               88  PS-EIC-2-AT-END-YES                 VALUE 'Y'.       00540001
               88  PS-EIC-2-AT-END-NO                  VALUE 'N'.       00550001
                                                                        00560000
       01  ABEND-CODE-SQL              PIC S9(04)  VALUE ZERO COMP SYNC.00570000
                                                                        00580000
       01  PC-PROGRAM-CONSTANTS.                                        00590000
           05 PC-PGM-NAME                  PIC X(8)  VALUE 'MLKUP971'.  00600010
           05 PC-MAX-RETRIES               PIC S9(03) VALUE 3 COMP-3.   00630000
           05 PC-M                         PIC X(01) VALUE 'M'.         00650000
                                                                        00680000
       01  PV-PROGRAM-VARIABLES.                                        00690000
           05 PV-DATE-FIELDS.                                           00700000
              10 PV-PROCESS-DATE             PIC   X(10).               00710000
           05 PV-GET-END-INV-COST2-AMT       PIC S9(11)V99 COMP-3       00711002
                                                        VALUE ZEROS.    00712001
           05 PV-GET-INV-COST-ADJ2-AMT       PIC S9(11)V99 COMP-3       00713005
                                                        VALUE ZEROS.    00714005
           05 PV-MISC.                                                  00720000
              10 PV-RETRY-COUNTER            PIC S9(04) COMP.           00730000
              10 PV-PARAGRAPH-NAME           PIC X(30)  VALUE SPACES.   00750000
              10 PV-DB2-DATE-EXISTS          PIC X(01).                 00760000
              10 PV-DEPT-9                  PIC S9(04)V COMP-3 VALUE 0. 00780000
              10 PV-DISP-MDSE-LVL-ID         PIC 9(09).                 00790000
              10 PV-DISP-DEPT-NBR            PIC 9(05).                 00800000
              10 PV-DISP-PARTN-NBR           PIC 9(04).                 00810000
              10 PV-SAVE-PARTN-NBR           PIC S9(04) COMP VALUE 0.   00820001
           05 PV-SQLCODE                     PIC S9(04) VALUE ZERO.     00840000
           05 PV-TOTALS.                                                00850000
              10  PA-INPUT-COUNT             PIC   9(11) VALUE ZEROS.   00860001
              10  PA-INSERT-COUNT            PIC  9(11) VALUE ZEROS.    00870001
              10  PA-UPDATE-COUNT            PIC  9(11)                 00880004
                                                     VALUE ZERO.        00890000
                                                                        00900000
       01  PV-EIC-2-INPUT-REC.                                          00910000
           10 PV-EIC-TYPE-REV               PIC   X(03).                00920001
           10 PV-EIC-DEPT-NBR               PIC   S9(04)V COMP-3.       00930000
           10 PV-EIC-ML-LO-MDSE-LVL-ID      PIC  S9(9) COMP.            00940000
           10 PV-EIC-END-INV-COST2-AMT      PIC  S9(11)V9(2) COMP-3.    00950000
                                                                        00960000
                                                                        00970000
                                                                        00980000
      ***************************************************************** 00990000
      *  CONTROL CARD WITH DATE FOR CURSOR.                             01000000
      ***************************************************************** 01010000
       01  CC-CONTROL-CARD.                                             01020000
           05  CC-PROC-DATE-ISO                PIC X(10).               01030000
           05  CC-PROC-DATE-RDF  REDEFINES                              01040000
               CC-PROC-DATE-ISO.                                        01050000
               10  CC-PROC-CC                  PIC X(02).               01060000
               10  CC-PROC-YY                  PIC X(02).               01070000
               10  FILLER                      PIC X(01).               01080000
               10  CC-PROC-MM                  PIC X(02).               01090000
               10  FILLER                      PIC X(01).               01100000
               10  CC-PROC-DD                  PIC X(02).               01110000
           05  FILLER                          PIC X(70).               01120000
                                                                        01130000
      ******************************************************************01140000
      *  DB2 SQL ERROR MESSAGE FORMAT AREA                              01150000
      ******************************************************************01160000
           COPY DPWS004.                                                01170000
                                                                        01180000
      ******************************************************************01190000
      * DATE ATTRIBUTE TABLE                                            01200000
      ******************************************************************01210000
           EXEC SQL                                                     01220000
             INCLUDE TDTATTR                                            01230000
           END-EXEC.                                                    01240000
      ******************************************************************01250000
      * PARTITION NUMBER TABLE                                          01260000
      ******************************************************************01270000
           EXEC SQL                                                     01280000
             INCLUDE MLT00003                                           01290000
           END-EXEC.                                                    01300000
      ******************************************************************01310000
      * PARTITION BAL TABLE                                             01320000
      ******************************************************************01330000
           EXEC SQL                                                     01340000
             INCLUDE MLT00002                                           01350000
           END-EXEC.                                                    01360000
      ******************************************************************01370000
      * MLT_MNLY_SUM TABLE                                              01380000
      ******************************************************************01390000
           EXEC SQL                                                     01400000
             INCLUDE MLT00004                                           01410000
           END-EXEC.                                                    01420000
      ***************************************************************** 01430000
      *    DB2 AREA FOR COMMUNICATIONS                                * 01440000
      ***************************************************************** 01450000
           EXEC SQL                                                     01460000
                INCLUDE SQLCA                                           01470000
           END-EXEC.                                                    01480000
                                                                        01490000
                                                                        02350000
      ******************************************************************02360000
       PROCEDURE DIVISION.                                              02370000
      ******************************************************************02380000
                                                                        02390000
       0000-MAINLINE.                                                   02400000
                                                                        02410000
           PERFORM 1000-INITIALIZE                                      02420000
                                                                        02430000
           SET PS-EIC-2-AT-END-NO TO TRUE.                              02440000
                                                                        02450000
           PERFORM 2000-PROCESS-EIC-2                                   02460000
               UNTIL PS-EIC-2-AT-END-YES.                               02470000
                                                                        02480000
           DISPLAY 'PA-INPUT-COUNT    ' PA-INPUT-COUNT.                 02490001
           DISPLAY 'PA-INSERT-COUNT   ' PA-INSERT-COUNT.                02500001
           DISPLAY 'PA-UPDATE-COUNT   ' PA-UPDATE-COUNT.                02510001
                                                                        02520000
           CLOSE CNTL-DATE-FILE                                         02530000
                 EIC-2-INPUT-FILE.                                      02540000
                                                                        02550000
           STOP RUN.                                                    02560000
                                                                        02570000
      ******************************************************************02580000
      *  PERFORM THE NECESSARY INITIALIZATION STEPS                     02590000
      ******************************************************************02600000
       1000-INITIALIZE.                                                 02610000
                                                                        02620000
           OPEN INPUT  CNTL-DATE-FILE                                   02630000
                       EIC-2-INPUT-FILE.                                02640000
                                                                        02650000
           PERFORM 9000-READ-CNTL-DTE.                                  02660000
                                                                        02670000
           PERFORM 3000-GET-PROCESS-DATE-INFO.                          02680000
                                                                        02690000
                                                                        02700000
      ******************************************************************02710000
      *  PROCESS EIC 2 CORRECTIONS FOR UNKNOWN/UNKNOWN                  02720000
      ******************************************************************02730000
                                                                        02740000
       2000-PROCESS-EIC-2.                                              02750000
                                                                        02760000
           PERFORM 2900-READ-EIC-2-REC.                                 02770000
                                                                        02780000
           IF PS-EIC-2-AT-END-NO                                        02790000
               PERFORM 2050-BUILD-UPDATE-REC                            02800000
               PERFORM 2100-DO-INSERT-UPDATE                            02810000
            END-IF.                                                     02820000
                                                                        02830000
                                                                        02960000
       2050-BUILD-UPDATE-REC.                                           02970000
                                                                        02980000
           INITIALIZE DCLMLT00004.                                      02990000
                                                                        03000000
           MOVE PV-EIC-DEPT-NBR           TO MLT00004-DEPT-NBR.         03010000
           MOVE PV-EIC-ML-LO-MDSE-LVL-ID  TO                            03020000
                                     MLT00004-ML-LO-MDSE-LVL-ID.        03030000
           MOVE PV-EIC-END-INV-COST2-AMT  TO                            03040000
                                     MLT00004-END-INV-COST2-AMT.        03050000
           MOVE PV-EIC-END-INV-COST2-AMT  TO                            03051005
                                     MLT00004-INV-COST-ADJ2-AMT.        03052005
           MOVE CC-PROC-DATE-ISO          TO  MLT00004-FSCL-MN-END-DTE. 03060000
           MOVE 10                        TO  MLT00004-MAJ-CL-NBR.      03070001
           MOVE 10                        TO  MLT00004-SUB-CL-NBR.      03080001
           MOVE 400                       TO  MLT00004-LOC-NBR.         03090001
                                                                        03100001
           IF PV-EIC-DEPT-NBR = PV-DEPT-9                               03110001
               MOVE PV-SAVE-PARTN-NBR     TO  MLT00004-PARTN-NBR        03120002
           ELSE                                                         03130001
               PERFORM 2075-LOOK-UP-PARTN                               03140001
               MOVE PV-EIC-DEPT-NBR TO PV-DEPT-9                        03150001
               MOVE MLT00004-PARTN-NBR  TO PV-SAVE-PARTN-NBR            03160002
               MOVE PV-DEPT-9           TO PV-DISP-DEPT-NBR             03161003
               MOVE MLT00004-PARTN-NBR  TO PV-DISP-PARTN-NBR            03162003
               DISPLAY 'PV-DISP-DEPT-NBR  ' PV-DISP-DEPT-NBR            03163003
               DISPLAY 'PV-DISP-PARTN-NBR ' PV-SAVE-PARTN-NBR           03164003
           END-IF.                                                      03170001
                                                                        03180001
       2075-LOOK-UP-PARTN.                                              03190001
                                                                        03200001
           EXEC SQL                                                     03210001
                SELECT PARTN_NBR                                        03220001
                    INTO   :MLT00004-PARTN-NBR                          03230002
                FROM MLT_PARTN_CNTL A                                   03240001
                    ,MLT_PARTN_BAL  B                                   03250001
                WHERE B.DEPT_NBR = :MLT00004-DEPT-NBR                   03260001
                  AND A.TBL_TM_LVL_CDE = B.TBL_TM_LVL_CDE               03270001
                  AND A.TBL_TM_LVL_CDE = :PC-M                          03280001
                  AND A.DEPT_GP_CDE = B.DEPT_GP_CDE                     03290001
                  AND A.FSCL_DTE = :MLT00004-FSCL-MN-END-DTE            03300001
                  AND B.EFF_BEG_DTE <= :MLT00004-FSCL-MN-END-DTE        03310001
                  AND B.EFF_END_DTE >= :MLT00004-FSCL-MN-END-DTE        03320001
                                                                        03330001
           END-EXEC.                                                    03340001
                                                                        03350001
           EVALUATE TRUE                                                03360001
               WHEN SQLCODE = 0                                         03370001
                    CONTINUE                                            03380001
               WHEN SQLWARN0 NOT = SPACES                               03390000
               WHEN SQLCODE < +0                                        03400000
               WHEN SQLCODE > +0                                        03410000
                    MOVE '2075-LOOK-UP-PARTN        '                   03420000
                          TO PV-PARAGRAPH-NAME                          03430000
                    PERFORM 9999-SQL-ABEND                              03440000
           END-EVALUATE.                                                03450000
                                                                        03460001
       2100-DO-INSERT-UPDATE.                                           03470001
                                                                        03481001
           EXEC SQL                                                     03482001
               INSERT INTO MLT_MNLY_SUM                                 03483001
                    (  PARTN_NBR                                        03484001
                     , DEPT_NBR                                         03485001
                     , MAJ_CL_NBR                                       03486001
                     , SUB_CL_NBR                                       03487001
                     , LOC_NBR                                          03488001
                     , ML_LO_MDSE_LVL_ID                                03489001
                     , FSCL_MN_END_DTE                                  03489201
                     , SLS_REG_RTL_AMT                                  03489301
                     , SLS_PROMO_RTL_AMT                                03489401
                     , SLS_PROCLR_RTL_AMT                               03489501
                     , SLS_CLR_RTL_AMT                                  03489601
                     , SLS_OTH_RTL_AMT                                  03489701
                     , MKDN_PLU_RTL_AMT                                 03489801
                     , MKDN_PROMO_RTL_AMT                               03489901
                     , MKDN_RGST_RTL_AMT                                03490001
                     , MKDN_GLDST_RTL_AMT                               03490101
                     , MKDN_UMTCH_RTL_AMT                               03490201
                     , MKDN_BYR_RTL_AMT                                 03490301
                     , MKDN_STR_RTL_AMT                                 03490401
                     , MKDN_PRPT_RTL_AMT                                03490501
                     , MKDN_OTH_RTL_AMT                                 03490601
                     , MKDN_RTL_AMT                                     03490701
                     , MKUP_RTL_AMT                                     03490801
                     , XFER_IN_RTL_AMT                                  03490901
                     , XFER_OUT_RTL_AMT                                 03491001
                     , RCPT_RTL_AMT                                     03491101
                     , RCPT_NET_COST_AMT                                03491201
                     , RCPT_GRO_COST_AMT                                03491301
                     , PADJ_RTL_AMT                                     03491401
                     , PADJ_FRGT_COST_AMT                               03491501
                     , PADJ_DISC_COST_AMT                               03491601
                     , PADJ_RTV_COST_AMT                                03491701
                     , PADJ_RTV_RTL_AMT                                 03491801
                     , PADJ_DA_COST_AMT                                 03491901
                     , PADJ_DA_RTL_AMT                                  03492001
                     , PADJ_NET_COST_AMT                                03492101
                     , PADJ_OTH_COST_AMT                                03492201
                     , PADJ_OTH_RTL_AMT                                 03492301
                     , DR_ALW_RTL_AMT                                   03492401
                     , RTV_RTL_AMT                                      03492501
                     , MKUP_INIT_AMT                                    03492601
                     , MKUP_NET_AMT                                     03492701
                     , INV_ADJ_RTL_AMT                                  03492801
                     , ONORD_RTL_AMT                                    03492901
                     , ONORD_COST_AMT                                   03493001
                     , SHNK_RTL_AMT                                     03493101
                     , END_INV_RTL_AMT                                  03493201
                     , END_INV_COST_AMT                                 03493301
                     , INV_COST_ADJ1_AMT                                03493401
                     , INV_COST_ADJ2_AMT                                03493501
                     , END_INV_COST1_AMT                                03493601
                     , END_INV_COST2_AMT                                03493701
                     , ADJ_GRO_MRGN_AMT )                               03493801
               VALUES (:MLT00004-PARTN-NBR                              03493901
                      ,:MLT00004-DEPT-NBR                               03494001
                      ,:MLT00004-MAJ-CL-NBR                             03494101
                      ,:MLT00004-SUB-CL-NBR                             03494201
                      ,:MLT00004-LOC-NBR                                03494301
                      ,:MLT00004-ML-LO-MDSE-LVL-ID                      03494401
                      ,:MLT00004-FSCL-MN-END-DTE                        03494601
                      ,:MLT00004-SLS-REG-RTL-AMT                        03494701
                      ,:MLT00004-SLS-PROMO-RTL-AMT                      03494801
                      ,:MLT00004-SLS-PROCLR-RTL-AMT                     03494901
                      ,:MLT00004-SLS-CLR-RTL-AMT                        03495001
                      ,:MLT00004-SLS-OTH-RTL-AMT                        03495101
                      ,:MLT00004-MKDN-PLU-RTL-AMT                       03495201
                      ,:MLT00004-MKDN-PROMO-RTL-AMT                     03495301
                      ,:MLT00004-MKDN-RGST-RTL-AMT                      03495401
                      ,:MLT00004-MKDN-GLDST-RTL-AMT                     03495501
                      ,:MLT00004-MKDN-UMTCH-RTL-AMT                     03495601
                      ,:MLT00004-MKDN-BYR-RTL-AMT                       03495701
                      ,:MLT00004-MKDN-STR-RTL-AMT                       03495801
                      ,:MLT00004-MKDN-PRPT-RTL-AMT                      03495901
                      ,:MLT00004-MKDN-OTH-RTL-AMT                       03496001
                      ,:MLT00004-MKDN-RTL-AMT                           03496101
                      ,:MLT00004-MKUP-RTL-AMT                           03496201
                      ,:MLT00004-XFER-IN-RTL-AMT                        03496301
                      ,:MLT00004-XFER-OUT-RTL-AMT                       03496401
                      ,:MLT00004-RCPT-RTL-AMT                           03496501
                      ,:MLT00004-RCPT-NET-COST-AMT                      03496601
                      ,:MLT00004-RCPT-GRO-COST-AMT                      03496701
                      ,:MLT00004-PADJ-RTL-AMT                           03496801
                      ,:MLT00004-PADJ-FRGT-COST-AMT                     03496901
                      ,:MLT00004-PADJ-DISC-COST-AMT                     03497001
                      ,:MLT00004-PADJ-RTV-COST-AMT                      03497101
                      ,:MLT00004-PADJ-RTV-RTL-AMT                       03497201
                      ,:MLT00004-PADJ-DA-COST-AMT                       03497301
                      ,:MLT00004-PADJ-DA-RTL-AMT                        03497401
                      ,:MLT00004-PADJ-NET-COST-AMT                      03497501
                      ,:MLT00004-PADJ-OTH-COST-AMT                      03497601
                      ,:MLT00004-PADJ-OTH-RTL-AMT                       03497701
                      ,:MLT00004-DR-ALW-RTL-AMT                         03497801
                      ,:MLT00004-RTV-RTL-AMT                            03497901
                      ,:MLT00004-MKUP-INIT-AMT                          03498001
                      ,:MLT00004-MKUP-NET-AMT                           03498101
                      ,:MLT00004-INV-ADJ-RTL-AMT                        03498201
                      ,:MLT00004-ONORD-RTL-AMT                          03498301
                      ,:MLT00004-ONORD-COST-AMT                         03498401
                      ,:MLT00004-SHNK-RTL-AMT                           03498501
                      ,:MLT00004-END-INV-RTL-AMT                        03498601
                      ,:MLT00004-END-INV-COST-AMT                       03498701
                      ,:MLT00004-INV-COST-ADJ1-AMT                      03498801
                      ,:MLT00004-INV-COST-ADJ2-AMT                      03498901
                      ,:MLT00004-END-INV-COST1-AMT                      03499001
                      ,:MLT00004-END-INV-COST2-AMT                      03499101
                      ,:MLT00004-ADJ-GRO-MRGN-AMT )                     03499201
           END-EXEC.                                                    03499301
                                                                        03499401
           EVALUATE TRUE                                                03499501
               WHEN SQLCODE = 0                                         03499601
                   ADD 1                      TO PA-INSERT-COUNT        03499701
               WHEN SQLCODE = -803                                      03499801
                   PERFORM 2200-GET-EIC-2                               03500001
                   PERFORM 2300-REPLACE-EIC-2                           03500101
               WHEN OTHER                                               03500201
                   DISPLAY                                              03500301
                        ' PA-INPUT-COUNT ' PA-INPUT-COUNT               03500401
                        ' PARTN: ' MLT00004-PARTN-NBR,                  03500501
                        ' DEPT:  ' MLT00004-DEPT-NBR,                   03500601
                        ' MAJCL: ' MLT00004-MAJ-CL-NBR,                 03500701
                        ' SUBCL: ' MLT00004-SUB-CL-NBR,                 03500801
                        ' LOC:   ' MLT00004-LOC-NBR,                    03500901
                        ' ML-LWST-ID: ' MLT00004-ML-LO-MDSE-LVL-ID      03501001
                   MOVE '2100-DO-INSERT-UPDATE    '                     03501101
                                         TO PV-PARAGRAPH-NAME           03501201
                   PERFORM 9999-SQL-ABEND                               03501401
           END-EVALUATE.                                                03501501
                                                                        03501601
                                                                        03502001
       2200-GET-EIC-2.                                                  03503001
                                                                        03510001
           EXEC SQL                                                     03512001
               SELECT                                                   03513001
                       END_INV_COST2_AMT                                03519101
                      ,INV_COST_ADJ2_AMT                                03519205
                 INTO                                                   03519301
                       :PV-GET-END-INV-COST2-AMT                        03519402
                      ,:PV-GET-INV-COST-ADJ2-AMT                        03519506
                 FROM                                                   03520201
                       MLT_MNLY_SUM                                     03520301
                 WHERE PARTN_NBR       = :MLT00004-PARTN-NBR            03520401
                   AND DEPT_NBR        = :MLT00004-DEPT-NBR             03520501
                   AND MAJ_CL_NBR      = :MLT00004-MAJ-CL-NBR           03520601
                   AND SUB_CL_NBR      = :MLT00004-SUB-CL-NBR           03520701
                   AND LOC_NBR         = :MLT00004-LOC-NBR              03520801
                   AND ML_LO_MDSE_LVL_ID = :MLT00004-ML-LO-MDSE-LVL-ID  03520901
           END-EXEC.                                                    03521101
                                                                        03521201
           EVALUATE SQLCODE                                             03521301
               WHEN 0                                                   03521401
                   CONTINUE                                             03521501
               WHEN OTHER                                               03521701
                    DISPLAY '*************************************'     03521801
                    DISPLAY 'ROW IN PROCESS : '                         03521901
                    DISPLAY  PA-INPUT-COUNT                             03522001
                         ' PARTN: ' MLT00004-PARTN-NBR,                 03522101
                         ' DEPT:  ' MLT00004-DEPT-NBR,                  03522201
                         ' MAJCL: ' MLT00004-MAJ-CL-NBR,                03522301
                         ' SUBCL: ' MLT00004-SUB-CL-NBR,                03522401
                         ' LOC:   ' MLT00004-LOC-NBR,                   03522501
                         ' ML-LWST-ID: ' MLT00004-ML-LO-MDSE-LVL-ID     03522601
                    DISPLAY '*************************************'     03522801
                    MOVE '2200-GET-EIC-2 '                              03523101
                                          TO PV-PARAGRAPH-NAME          03523201
                    PERFORM 9999-SQL-ABEND                              03523301
           END-EVALUATE.                                                03523401
                                                                        03523501
      ******************************************************************03523601
      * 2300-REPLACE-EIC-2                                              03523701
      * REPLACE EIC-2  ( ADD INPUT TO EXISTING AMOUNT RETRIEVED ABOVE)  03523801
      ******************************************************************03523901
       2300-REPLACE-EIC-2.                                              03524001
                                                                        03524101
           COMPUTE MLT00004-END-INV-COST2-AMT =                         03524201
                 PV-GET-END-INV-COST2-AMT + PV-EIC-END-INV-COST2-AMT.   03524302
           COMPUTE MLT00004-INV-COST-ADJ2-AMT =                         03524405
                 PV-GET-INV-COST-ADJ2-AMT + PV-EIC-END-INV-COST2-AMT.   03524505
                                                                        03524901
           EXEC SQL                                                     03525001
               UPDATE MLT_MNLY_SUM                                      03525101
                  SET                                                   03525201
                     END_INV_COST2_AMT = :MLT00004-END-INV-COST2-AMT    03525901
                    ,INV_COST_ADJ2_AMT = :MLT00004-INV-COST-ADJ2-AMT    03526009
                 WHERE PARTN_NBR       = :MLT00004-PARTN-NBR            03526101
                   AND DEPT_NBR        = :MLT00004-DEPT-NBR             03526201
                   AND MAJ_CL_NBR      = :MLT00004-MAJ-CL-NBR           03526301
                   AND SUB_CL_NBR      = :MLT00004-SUB-CL-NBR           03526401
                   AND LOC_NBR         = :MLT00004-LOC-NBR              03526501
                   AND ML_LO_MDSE_LVL_ID = :MLT00004-ML-LO-MDSE-LVL-ID  03526601
           END-EXEC.                                                    03526801
                                                                        03526901
           EVALUATE SQLCODE                                             03527001
               WHEN 0                                                   03527101
                    ADD 1                TO PA-UPDATE-COUNT             03527201
               WHEN OTHER                                               03527301
                    DISPLAY '*************************************'     03527401
                    DISPLAY 'ROW IN PROCESS : '                         03527501
                    DISPLAY  PA-INPUT-COUNT                             03527601
                         ' PARTN: ' MLT00004-PARTN-NBR,                 03527801
                         ' DEPT:  ' MLT00004-DEPT-NBR,                  03527901
                         ' MAJCL: ' MLT00004-MAJ-CL-NBR,                03528001
                         ' SUBCL: ' MLT00004-SUB-CL-NBR,                03528101
                         ' LOC:   ' MLT00004-LOC-NBR,                   03528201
                         ' ML-LWST-ID: ' MLT00004-ML-LO-MDSE-LVL-ID     03528301
                    DISPLAY '*************************************'     03528501
                    MOVE '2300-REPLACE-EIC-2    '                       03528801
                                          TO PV-PARAGRAPH-NAME          03528901
                    PERFORM 9999-SQL-ABEND                              03529001
           END-EVALUATE.                                                03529101
                                                                        03529201
                                                                        03529302
                                                                        03529402
       2900-READ-EIC-2-REC.                                             03529502
                                                                        03529602
           READ EIC-2-INPUT-FILE INTO PV-EIC-2-INPUT-REC                03529702
               AT END                                                   03529802
                   SET PS-EIC-2-AT-END-YES TO TRUE.                     03529902
                                                                        03530002
           IF PS-EIC-2-AT-END-NO                                        03530102
               ADD 1 TO PA-INPUT-COUNT                                  03530202
           END-IF.                                                      03530302
                                                                        03530402
                                                                        03531001
      ****************************************************************  03540000
      * VALIDATE THE PROCESS DATE.                                      03550000
      ****************************************************************  03560000
       3000-GET-PROCESS-DATE-INFO.                                      03570000
           PERFORM                                                      03580000
               WITH TEST AFTER                                          03590000
               VARYING PV-RETRY-COUNTER                                 03600000
               FROM 1 BY 1                                              03610000
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03620000
                         OR (SQLCODE = ZERO)                            03630000
                         OR (SQLCODE = 100))                            03640000
                  EXEC SQL                                              03650000
                      SELECT 'Y'                                        03660000
                        INTO :PV-DB2-DATE-EXISTS                        03670000
                        FROM TDTATTR                                    03680000
                       WHERE KY_DTE = :PV-PROCESS-DATE                  03690000
                  END-EXEC                                              03700000
                                                                        03710000
                  EVALUATE TRUE                                         03720000
                      WHEN SQLCODE = 0                                  03730000
                           DISPLAY 'DATE SELECT: '                      03740000
                                  PV-PROCESS-DATE                       03750000
                                  ' SUCCESSFUL'                         03760000
                           CONTINUE                                     03770000
                      WHEN SQLCODE = -904                               03780000
                      WHEN SQLCODE = -913                               03790000
                           CONTINUE                                     03800000
                      WHEN SQLWARN0 NOT = SPACES                        03810000
                      WHEN SQLCODE < +0                                 03820000
                      WHEN SQLCODE > +0                                 03830000
                           MOVE '3000-GET-PROCESS-DATE-INFO'            03840000
                                 TO PV-PARAGRAPH-NAME                   03850000
                           PERFORM 9999-SQL-ABEND                       03860000
                  END-EVALUATE                                          03870000
           END-PERFORM.                                                 03880000
                                                                        03890000
           IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         03900000
              DISPLAY 'RETRIES EXCEEDED FOR PROCESS DATE '              03910000
           END-IF.                                                      03920000
                                                                        03930000
                                                                        03940000
      ******************************************************************03950000
      * 9000-READ-CNTL-DTE.                                             03960000
      ******************************************************************03970000
       9000-READ-CNTL-DTE.                                              03980000
           READ CNTL-DATE-FILE INTO CC-CONTROL-CARD                     03990000
               AT END                                                   04000000
                   DISPLAY '** PROGRAM ABEND **'                        04010000
                   DISPLAY 'MLKUP971  - CONTROL DATE EMPTY'             04020010
                   SET AC-OTHER-ERROR TO TRUE                           04030000
                   CALL 'ILBOABN0' USING ABEND-CODE.                    04040000
                                                                        04050000
           DISPLAY '** MLKUP971 CONTROL CARD:' CNTL-DATE-REC.           04060010
                                                                        04070000
           MOVE CC-PROC-DATE-ISO TO PV-PROCESS-DATE.                    04080000
                                                                        04090000
                                                                        04170000
      ******************************************************************04180000
      *  STANDARD DB2 ERROR ABEND ROUTINE                               04190000
      *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.             04200000
      ******************************************************************04210000
       9999-SQL-ABEND.                                                  04220000
                                                                        04230000
           SET AC-SQL-ERROR           TO TRUE.                          04240000
           DISPLAY '**  ABEND     **'.                                  04250000
           DISPLAY '**  PROGRAM   **  = ' PC-PGM-NAME.                  04260000
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            04270000
                                                                        04280000
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         04290000
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        04300000
                                                                        04310000
           COPY DPPD004.                                                04320000
                                                                        04330000
           CALL 'ILBOABN0'  USING ABEND-CODE.                           04340000
                                                                        04350000
