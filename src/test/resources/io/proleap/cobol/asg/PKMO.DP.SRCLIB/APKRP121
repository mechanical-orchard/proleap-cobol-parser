000100 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.    APKRP121.                                         00020002
000300 AUTHOR.        NANCY EILBES.                                     00030002
000400 INSTALLATION.  KOHLS.                                            00040002
000500 DATE-WRITTEN   NOVEMBER 2003.                                    00050002
000600 DATE-COMPILED.                                                   00060002
000700                                                                  00070002
000800******************************************************************00080002
000900*  VENDOR ALLOWANCE AGREEMENTS REPORT PROGRAM.                   *00090002
001000*                                                                *00100002
001100*  PURPOSE:                                                      *00110002
001200*  THIS PROGRAM CREATES A REPORT OF ALL OF THE VENDOR ALLOWANCE  *00120002
001300*  AGREEMENTS THAT ARE IN EFFECT IN THE VENDOR MANAGMENT SYSTEM. *00130002
001400*----------------------------------------------------------------*00140002
001500* DB2 TABLES:                                                    *00150002
001600*  1. VENDOR AGREEMENT TABLE                  TVNDAGR            *00160002
001700*  2. EXTERNAL ENTITY TABLE                   TEXTENT            *00170002
001800*  3. ENTITY NAME TABLE                       TENTNME            *00180002
001900*  4. TRANCODE MASTER TABLE                   TTRNCDE            *00190002
002000*  5. MERCHANDISE AREA TABLE                  TMDSEAR            *00200002
002100*                                                                *00210002
002200* OUTPUT:                                                        *00220002
002300*                                                                *00230002
002400*  1. VENDOR AGREEMENTS REPORT                                   *00240002
002500*                                                                *00250002
002600*----------------------------------------------------------------*00260002
002700******************************************************************00270002
002800* CHANGE LOG:                                                    *00280002
002900*   DATE  04/12/2004                                             *00290010
003000*       CHANGE MADE: ADDED EFFECTIVE DATING TO THE AGREEMENT_CSR *00300010
003100*       FOR THE TMDSEAR TABLE.                                   *00310010
003200*       MADE BY: MIKE BESKE              WR/IR #: P000647746     *00320010
003300*                                                                *00330010
003400******************************************************************00340002
003500 ENVIRONMENT DIVISION.                                            00350002
003600 CONFIGURATION SECTION.                                           00360002
003700 SOURCE-COMPUTER.        IBM-3090.                                00370002
003800 OBJECT-COMPUTER.        IBM-3090.                                00380002
003900                                                                  00390002
004000 INPUT-OUTPUT SECTION.                                            00400002
004100 FILE-CONTROL.                                                    00410002
004200                                                                  00420002
004300     SELECT REPORT-FILE                  ASSIGN TO RPT01.         00430002
004400                                                                  00440002
004500 DATA DIVISION.                                                   00450002
004600 FILE SECTION.                                                    00460002
004700                                                                  00470002
004800 FD  REPORT-FILE                                                  00480002
004900     RECORDING MODE IS F                                          00490002
005000     LABEL RECORDS ARE STANDARD                                   00500002
005100     BLOCK CONTAINS 0 RECORDS                                     00510002
005200     DATA RECORD IS REPORT-REC.                                   00520002
005300 01  REPORT-REC                  PIC  X(132).                     00530002
005400                                                                  00540002
005500 WORKING-STORAGE SECTION.                                         00550002
005600                                                                  00560002
005700 01  PC-PROGRAM-CONSTANTS.                                        00570002
005800     05  PC-PROGRAM-NAME     PIC X(08) VALUE 'APKRP121'.          00580002
005900     05  PC-ABEND-INFO.                                           00590002
006000         10  PC-ABEND                PIC X(11) VALUE              00600002
006100                                               '** ABEND **'.     00610002
006200         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00620002
006300                                               '- PARA       : '. 00630002
006400         10  PC-ABEND-MSG-DISPLAY-PARA                            00640002
006500                                     PIC X(15) VALUE              00650002
006600                                               '  CALLED PARA: '. 00660002
006700         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00670002
006800                                               '  FOR ABEND# : '. 00680002
006900         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00690002
007000                                               '- ERROR IS   : '. 00700002
007100         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00710002
007200         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00720002
007300                                               '- ACTION     : '. 00730002
007400     05  PC-TEST-AND-SET-NULL-IND.                                00740002
007500         10  PC-NOT-NULL             PIC S9(4) COMP               00750002
007600                                               VALUE ZERO.        00760002
007700         10  PC-NULL                 PIC S9(4) COMP               00770002
007800                                               VALUE -1.          00780002
007900         10  PC-NULL-CONV-ERR        PIC S9(4) COMP               00790002
008000                                               VALUE -2.          00800002
008100         10  PC-NULLIF-QUESTION-MARK PIC X(01) VALUE '?'.         00810002
008200     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 100.         00820002
008300                                                                  00830002
008400 01  PS-PROGRAM-SWITCHES.                                         00840002
008500     05  PS-END-OF-CSR-SW        PIC  X         VALUE 'N'.        00850002
008600         88  NOT-END-OF-CSR                     VALUE 'N'.        00860002
008700         88  END-OF-CSR                         VALUE 'Y'.        00870002
008800     05  PS-INVOICE-FOUND-SW         PIC X(01) VALUE 'N'.         00880002
008900         88  INVOIC-FOUND                      VALUE 'Y'.         00890002
009000         88  INVOIC-NOT-FOUND                  VALUE 'N'.         00900002
009100                                                                  00910002
009200 01  PV-REPORT-CONTROLS.                                          00920002
009300     05  PV-POINVC-UNIT          PIC S99        VALUE +3.         00930002
009400     05  PV-LINE-COUNT           PIC S999       VALUE +0.         00940002
009500     05  PC-LINES-PER-PAGE-MAX   PIC S999       VALUE +60.        00950002
009600     05  PV-PAGE-COUNT           PIC S9(05) VALUE +0.             00960004
009700                                                                  00970002
009800 01  PV-PROGRAM-VARIABLES.                                        00980002
009900     05  SAVE-DMA-NBR                PIC  X(02) VALUE SPACES.     00990004
010000     05  SAVE-VND-NAME               PIC  X(30) VALUE SPACES.     01000004
010100     05  PV-DISCOUNT-PCT             PIC S99V99 COMP-3.           01010004
010200     05  PV-AGR-CSR-COUNT            PIC  9(08) VALUE ZEROS.      01020004
010300     05  DMA-COUNT                   PIC  9(08) VALUE ZEROS.      01030005
010400     05  TOTAL-AGR-COUNT             PIC  9(08) VALUE ZEROS.      01040006
010500     05  WS-HEADER-DATE              PIC X(10).                   01050002
010600     05  WS-HEADER-DATE-RED REDEFINES WS-HEADER-DATE.             01060002
010700         10  WS-HEADER-MM            PIC 9(2).                    01070002
010800         10  WS-HD-SLASH-1           PIC X(1).                    01080002
010900         10  WS-HEADER-DD            PIC 9(2).                    01090002
011000         10  WS-HD-SLASH-2           PIC X(1).                    01100002
011100         10  WS-HEADER-CCYY          PIC 9(4).                    01110002
011200                                                                  01120002
011300     05  PV-CURRENT-DATE.                                         01130002
011400         10  PV-CURRENT-CCYY.                                     01140002
011500             15  PV-CURRENT-CC     PIC  9(02) VALUE ZEROES.       01150004
011600             15  PV-CURRENT-YEAR   PIC  9(02) VALUE ZEROES.       01160004
011700         10  PV-CURRENT-MONTH      PIC  9(02) VALUE ZEROES.       01170004
011800         10  PV-CURRENT-DAY        PIC  9(02) VALUE ZEROES.       01180004
011900     05  PV-CURRENT-TIME.                                         01190002
012000         10  PV-CURRENT-HOUR       PIC  9(02) VALUE ZEROES.       01200004
012100         10  PV-CURRENT-MINUTE     PIC  9(02) VALUE ZEROES.       01210004
012200         10  FILLER                PIC  9(02) VALUE ZEROES.       01220004
012300                                                                  01230002
012400                                                                  01240002
012500*----------------------------------------------------------------*01250002
012600*    STANDARD HEADER LAYOUT                                       01260002
012700*----------------------------------------------------------------*01270002
012800     COPY DPWS132.                                                01280002
012900                                                                  01290002
013000                                                                  01300002
013100*----------------------------------------------------------------*01310002
013200*    REPORT LAYOUT                                                01320002
013300*----------------------------------------------------------------*01330002
013400                                                                  01340002
013500 01  HEADING-LINE-1.                                              01350004
013600     05  FILLER                  PIC  X(49) VALUE SPACES.         01360004
013700     05  H1-TITLE                PIC  X(34) VALUE                 01370004
013800         'VENDOR ALLOWANCE AGREEMENTS REPORT'.                    01380002
013900     05  FILLER                  PIC  X(49) VALUE SPACES.         01390004
014000                                                                  01400002
014100 01  HEADING-LINE-2.                                              01410004
014200     05  FILLER                  PIC  X(58) VALUE SPACES.         01420004
014300     05  FILLER                  PIC  X(06) VALUE                 01430004
014400         'AS OF '.                                                01440002
014500     05  H2-DATE                 PIC  X(10).                      01450002
014600     05  FILLER                  PIC  X(58) VALUE SPACES.         01460004
014700                                                                  01470004
014800 01  DIVISION-HEADING.                                            01480004
014900     05  FILLER                  PIC X(10) VALUE 'DIVISION: '.    01490008
015000     05  DH-DMA-NBR              PIC X(02) VALUE SPACES.          01500004
015100                                                                  01510002
015200 01  DETAIL-HEADING-LINE.                                         01520007
015300     05  FILLER                  PIC X(30) VALUE 'VENDOR NAME'.   01530002
015400     05  FILLER                  PIC X(02) VALUE SPACES.          01540004
015500     05  FILLER                  PIC X(09) VALUE 'VENDOR # '.     01550004
015600     05  FILLER                  PIC X(02) VALUE SPACES.          01560004
015700     05  FILLER                  PIC X(04) VALUE 'DEPT'.          01570004
015800     05  FILLER                  PIC X(05) VALUE SPACES.          01580004
015900     05  FILLER                  PIC X(18) VALUE 'ALLOWANCE TYPE'.01590004
016000     05  FILLER                  PIC X(02) VALUE SPACES.          01600004
016100     05  FILLER                  PIC X(05) VALUE 'PCNT '.         01610004
016200     05  FILLER                  PIC X(01) VALUE SPACES.          01620004
016300     05  FILLER                  PIC X(03) VALUE 'RTV'.           01630004
016400     05  FILLER                  PIC X(01) VALUE SPACES.          01640004
016500     05  FILLER                  PIC X(03) VALUE 'DSC'.           01650004
016600     05  FILLER                  PIC X(01) VALUE SPACES.          01660004
016700     05  FILLER                  PIC X(04) VALUE 'FREQ'.          01670004
016800     05  FILLER                  PIC X(02) VALUE SPACES.          01680004
016900     05  FILLER                  PIC X(10) VALUE 'EFFECTIVE '.    01690002
017000     05  FILLER                  PIC X(02) VALUE SPACES.          01700004
017100     05  FILLER                  PIC X(10) VALUE 'EXPIRES   '.    01710004
017200     05  FILLER                  PIC X(02) VALUE SPACES.          01720004
017300                                                                  01730002
017400 01  BLANK-LINE                  PIC X(132) VALUE SPACES.         01740005
017500                                                                  01750002
017600 01  DETAIL-LINE.                                                 01760004
017700     05  DL-VENDOR-NAME          PIC X(30) VALUE SPACES.          01770004
017800     05  FILLER                  PIC X(02) VALUE SPACES.          01780004
017900     05  DL-VENDOR-NBR           PIC X(09) VALUE SPACES.          01790004
018000     05  FILLER                  PIC X(02) VALUE SPACES.          01800004
018100     05  DL-DEPT-NBR             PIC X(03) VALUE SPACES.          01810004
018200     05  FILLER                  PIC X(06) VALUE SPACES.          01820004
018300     05  DL-DESCRIPTION          PIC X(18) VALUE SPACES.          01830004
018400     05  FILLER                  PIC X(02) VALUE SPACES.          01840004
018500     05  DL-DISCOUNT-PCT         PIC ZZ.99.                       01850004
018600     05  FILLER                  PIC X(02) VALUE SPACES.          01860004
018700     05  DL-RTV-IND              PIC X(01).                       01870004
018800     05  FILLER                  PIC X(03) VALUE SPACES.          01880004
018900     05  DL-DSC-IND              PIC X(01).                       01890004
019000     05  FILLER                  PIC X(03) VALUE SPACES.          01900004
019100     05  DL-POSTING-FREQUENCY    PIC X(02).                       01910004
019200     05  FILLER                  PIC X(03) VALUE SPACES.          01920004
019300     05  DL-EFFECTIVE-DATE       PIC X(10).                       01930004
019400     05  FILLER                  PIC X(02) VALUE SPACES.          01940004
019500     05  DL-EXPIRATION-DATE      PIC X(10).                       01950004
019600     05  FILLER                  PIC X(02) VALUE SPACES.          01960004
019700                                                                  01970002
019800 01  DL-DMA-LINE.                                                 01980002
019900     05  FILLER                  PIC X(14)                        01990002
020000                                    VALUE 'COUNT FOR DMA '.       02000002
020100     05  DL-DMA-NBR              PIC X(02).                       02010002
020200     05  FILLER                  PIC X(02) VALUE ': '.            02020002
020300     05  DL-COUNT                PIC ZZZZZZZZ9.                   02030002
020400     05  FILLER                  PIC X(105) VALUE SPACES.         02040004
020500                                                                  02050002
020600 01  DL-DMA-DASH-LINE2.                                           02060002
020700     05  FILLER                  PIC X(26) VALUE                  02070002
020800                             '--------------------------'.        02080002
020900     05  FILLER                  PIC X(106) VALUE SPACES.         02090004
021000                                                                  02100002
021100 01  TOTAL-LINE.                                                  02110002
021200     05  FILLER                  PIC  X(13) VALUE 'TOTAL COUNT: '.02120002
021300     05  TL-COUNT                PIC  ZZZZZZZZ9.                  02130002
021400     05  FILLER                  PIC  X(110) VALUE SPACES.        02140004
021500                                                                  02150002
021600 01  END-OF-REPORT.                                               02160002
021700     05  FILLER                  PIC  X(49) VALUE SPACES.         02170004
021800     05  FILLER                  PIC  X(33) VALUE                 02180004
021900         '***  E N D  O F  R E P O R T  ***'.                     02190002
022000     05  FILLER                  PIC  X(50) VALUE SPACES.         02200004
022100                                                                  02210002
022200*---------------------------------------------------------------* 02220002
022300*    DB2 AREA FOR TEXTENT                                       * 02230002
022400*---------------------------------------------------------------* 02240002
022500     EXEC SQL                                                     02250002
022600          INCLUDE TEXTENT                                         02260002
022700     END-EXEC.                                                    02270002
022800                                                                  02280002
022900*---------------------------------------------------------------* 02290002
023000*    DB2 AREA FOR TENTNME                                       * 02300002
023100*---------------------------------------------------------------* 02310002
023200     EXEC SQL                                                     02320002
023300          INCLUDE TENTNME                                         02330002
023400     END-EXEC.                                                    02340002
023500                                                                  02350002
023600*---------------------------------------------------------------* 02360002
023700*    DB2 AREA FOR TTRNCDE                                       * 02370002
023800*---------------------------------------------------------------* 02380002
023900     EXEC SQL                                                     02390002
024000          INCLUDE TTRNCDE                                         02400002
024100     END-EXEC.                                                    02410002
024200                                                                  02420002
024300*---------------------------------------------------------------* 02430002
024400*    DB2 AREA FOR TVNDAGR                                       * 02440002
024500*---------------------------------------------------------------* 02450002
024600     EXEC SQL                                                     02460002
024700          INCLUDE TVNDAGR                                         02470002
024800     END-EXEC.                                                    02480002
024900                                                                  02490002
025000*---------------------------------------------------------------* 02500002
025100*    DB2 AREA FOR TMDSEAR                                       * 02510002
025200*---------------------------------------------------------------* 02520002
025300     EXEC SQL                                                     02530002
025400          INCLUDE TMDSEAR                                         02540002
025500     END-EXEC.                                                    02550002
025600                                                                  02560002
025700*---------------------------------------------------------------* 02570002
025800*    DB2 AREA FOR COMMUNICATIONS                                * 02580002
025900*---------------------------------------------------------------* 02590002
026000     EXEC SQL                                                     02600002
026100          INCLUDE SQLCA                                           02610002
026200     END-EXEC.                                                    02620002
026300                                                                  02630002
026400*----------------------------------------------------------------*02640002
026500*                                                                 02650002
026600*----------------------------------------------------------------*02660002
026700     EXEC SQL                                                     02670002
026800        DECLARE AGREEMENT_CSR CURSOR FOR                          02680002
026900        SELECT A.AP_TRN_CDE                                       02690002
027000             , A.DISCOUNT_PCT                                     02700003
027100             , CHAR(A.EFFECTIVE_DATE,USA)                         02710003
027200             , CHAR(A.EXPIRATION_DATE,USA)                        02720003
027300             , A.PSTG_FRQ_CDE                                     02730003
027400             , A.DED_DISC_IND                                     02740003
027500             , A.DED_RTV_IND                                      02750003
027600             , B.TRN_SHRT_DESC                                    02760003
027700             , D.ENT_NAME_DESC                                    02770003
027800             , C.DUN_NBR                                          02780003
027900             , A.DEPT_NBR                                         02790003
028000             , E.DMA_NBR                                          02800003
028100          FROM TVNDAGR A                                          02810002
028200             , TTRNCDE B                                          02820003
028300             , TEXTENT C                                          02830003
028400             , TENTNME D                                          02840003
028500             , TMDSEAR E                                          02850003
028600         WHERE A.AP_TRN_CDE      = B.AP_TRN_CDE                   02860002
028700           AND A.AGRMT_TYP_ID    = '6'                            02870002
028800           AND A.TYP_CDE         = 6                              02880002
028900           AND CURRENT DATE BETWEEN A.EFFECTIVE_DATE              02890002
029000                                AND A.EXPIRATION_DATE             02900002
029100           AND B.EFF_STRT_DTE =                                   02910002
029200               (SELECT MIN(T.EFF_STRT_DTE)                        02920002
029300                  FROM TTRNCDE T                                  02930002
029400                 WHERE T.AP_TRN_CDE  = B.AP_TRN_CDE               02940002
029500                   AND (A.EFFECTIVE_DATE  BETWEEN T.EFF_STRT_DTE  02950002
029600                                               AND T.EFF_END_DTE  02960002
029700                  AND (A.EXPIRATION_DATE  BETWEEN T.EFF_STRT_DTE  02970002
029800                                              AND T.EFF_END_DTE)  02980002
029900                     OR  (A.EFFECTIVE_DATE < T.EFF_STRT_DTE AND   02990002
030000                          A.EFFECTIVE_DATE < T.EFF_END_DTE)))     03000002
030100           AND  A.ENT_ID     = C.ENT_ID                           03010002
030200           AND  C.ENT_ID     = D.ENT_ID                           03020002
030300           AND  A.DEPT_NBR   = E.DEPT_NBR                         03030002
030400           AND  D.TYPE_CDE   = '01'                               03040002
030500           AND  E.MDSELV_CDE = 'DPT'                              03050002
030600           AND  CURRENT DATE BETWEEN E.STRT_DTE AND E.END_DTE     03060010
030700         ORDER BY E.DMA_NBR                                       03070002
030800                 ,D.ENT_NAME_DESC                                 03080002
030900                 ,A.DEPT_NBR                                      03090002
031000                 ,A.AP_TRN_CDE                                    03100002
031100                 ,A.EXPIRATION_DATE DESC                          03110002
031200                 ,A.EFFECTIVE_DATE ASC                            03120002
031300     END-EXEC.                                                    03130002
031400                                                                  03140002
031500*----------------------------------------------------------------*03150002
031600*    ABEND DATA AREAS                                             03160002
031700*----------------------------------------------------------------*03170002
031800 01  ABEND-CODE                    PIC S9(4) VALUE ZEROES         03180004
031900                                   COMP         SYNC.             03190002
032000                                                                  03200002
032100     88  AC-ANY-ERROR                           VALUE  +4001      03210002
032200                                                THRU   +4019.     03220002
032300     88  AC-OPEN-ERROR                          VALUE  +4005.     03230002
032400     88  AC-CLOSE-ERROR                         VALUE  +4006.     03240002
032500     88  AC-INVALID-DATA                        VALUE  +4008.     03250002
032600     88  AC-DB2-ERROR                           VALUE  +4013.     03260002
032700     88  AC-UNSUCCESSFUL-SELECT                 VALUE  +4015.     03270002
032800     88  AC-MAX-RETRIES-EXCEEDED                VALUE  +4016.     03280002
032900                                                                  03290002
033000 01  ABEND-AREAS.                                                 03300002
033100     05  AA-ABEND-LIT              PIC  X(40) VALUE               03310004
033200             '*****       ABEND'.                                 03320002
033300     05  AA-PROGRAM-LIT            PIC  X(40) VALUE               03330004
033400             '*****   PROGRAM: APKRPOFF'.                         03340002
033500     05  AA-PARAGRAPH-LIT.                                        03350002
033600         10  FILLER                PIC  X(17) VALUE               03360004
033700             '***** PARAGRAPH: '.                                 03370002
033800         10  AA-PARAGRAPH-NAME     PIC  X(35) VALUE SPACES.       03380004
033900     05  AA-MESSAGE-LINE-1.                                       03390002
034000         10  FILLER                PIC  X(06) VALUE '*****'.      03400004
034100         10  AA-MESSAGE-1          PIC  X(80) VALUE SPACES.       03410004
034200     05  AA-MESSAGE-LINE-2.                                       03420002
034300         10  FILLER                PIC  X(06) VALUE '*****'.      03430004
034400         10  AA-MESSAGE-2          PIC  X(80) VALUE SPACES.       03440004
034500     05  AA-DB2-ERROR-LIT          PIC  X(40) VALUE               03450004
034600             '*****    DB2 ERROR'.                                03460002
034700     05  AA-DB2-OPERATION-LIT.                                    03470002
034800         10  FILLER                PIC  X(17) VALUE               03480004
034900             '***** OPERATION: '.                                 03490002
035000         10  AA-DB2-OPERATION.                                    03500002
035100             15  AA-DB2-OP-1       PIC  X(25) VALUE SPACES.       03510004
035200             15  AA-DB2-OP-2       PIC  X(25) VALUE SPACES.       03520004
035300     05  AA-DB2-TABLE-1            PIC  X(08) VALUE SPACES.       03530004
035400     05  AA-DB2-TABLE-2            PIC  X(08) VALUE SPACES.       03540004
035500     05  AA-DB2-TABLE-3            PIC  X(08) VALUE SPACES.       03550004
035600     05  AA-DB2-TABLE-4            PIC  X(08) VALUE SPACES.       03560004
035700     05  AA-DB2-TABLE-5            PIC  X(08) VALUE SPACES.       03570004
035800     05  AA-DB2-TABLE-6            PIC  X(08) VALUE SPACES.       03580004
035900                                                                  03590002
036000                                                                  03600002
036100*---------------------------------------------------------------* 03610002
036200*  DB2 FORMATTED MESSAGE AREA                                     03620002
036300*---------------------------------------------------------------* 03630002
036400     COPY DPWS004.                                                03640002
036500                                                                  03650002
036600                                                                  03660002
036700 PROCEDURE DIVISION.                                              03670002
036800                                                                  03680002
036900 A100-PROGRAM-MAINLINE.                                           03690002
037000                                                                  03700002
037100     PERFORM B100-INITIALIZE.                                     03710002
037200                                                                  03720002
037300     PERFORM B200-CREATE-REPORT                                   03730002
037400         UNTIL END-OF-CSR.                                        03740002
037500                                                                  03750002
037600     PERFORM B300-EOJ-ROUTINE.                                    03760002
037700                                                                  03770002
037800     GOBACK.                                                      03780002
037900                                                                  03790002
038000                                                                  03800002
038100******************************************************************03810002
038200*  INITIALIZATIONS                                               *03820002
038300******************************************************************03830002
038400 B100-INITIALIZE.                                                 03840002
038500                                                                  03850002
038600     OPEN OUTPUT REPORT-FILE.                                     03860002
038700                                                                  03870002
038800     INITIALIZE DCLTEXTENT                                        03880002
038900                DCLTENTNME                                        03890002
039000                DCLTTRNCDE                                        03900002
039100                DCLTVNDAGR                                        03910002
039200                DCLTMDSEAR.                                       03920002
039300                                                                  03930002
039400                                                                  03940002
039500*    FORMAT HEADING DATA                                          03950002
039600     MOVE FUNCTION CURRENT-DATE       TO PV-CURRENT-DATE.         03960002
039700     MOVE PV-CURRENT-MONTH            TO DP132-RUN-MONTH          03970002
039800                                         WS-HEADER-MM.            03980002
039900     MOVE PV-CURRENT-DAY              TO DP132-RUN-DAY            03990002
040000                                         WS-HEADER-DD.            04000002
040100     MOVE PV-CURRENT-CCYY             TO DP132-RUN-YEAR           04010002
040200                                         WS-HEADER-CCYY.          04020002
040300     MOVE '/'                         TO WS-HD-SLASH-1            04030002
040400                                         WS-HD-SLASH-2.           04040002
040500     MOVE WS-HEADER-DATE              TO H2-DATE.                 04050002
040600                                                                  04060002
040700     ACCEPT PV-CURRENT-TIME           FROM TIME.                  04070002
040800     MOVE PV-CURRENT-HOUR             TO DP132-RUN-HOUR.          04080002
040900     MOVE PV-CURRENT-MINUTE           TO DP132-RUN-MINUTE.        04090002
041000     MOVE PC-PROGRAM-NAME             TO DP132-PROGRAM-NAME.      04100002
041100     MOVE 1                           TO DP132-REPORT-NUMBER.     04110002
041200                                                                  04120002
041300*    PERFORM OPEN AND INITIAL FETCH OF THE AGREEMENTS CURSOR      04130002
041400     PERFORM X100-OPEN-AGREEMENTS-CSR.                            04140002
041500                                                                  04150002
041600     PERFORM S200-FETCH-AGREEMENTS-CSR.                           04160002
041700                                                                  04170002
041800     IF END-OF-CSR                                                04180002
041900        DISPLAY 'NO RECORDS FOUND WITH CURSOR!!!'                 04190002
042000     END-IF.                                                      04200002
042100                                                                  04210002
042200     MOVE MDSEAR-DMA-NBR TO SAVE-DMA-NBR.                         04220002
042300     PERFORM W100-WRITE-HEADINGS.                                 04230007
042400                                                                  04240002
042500                                                                  04250002
042600******************************************************************04260002
042700*  CREATE REPORT DETAILS FROM ROWS FETCHED FROM CURSOR.           04270002
042800******************************************************************04280002
042900 B200-CREATE-REPORT.                                              04290002
043000                                                                  04300002
043100     IF SAVE-DMA-NBR NOT = MDSEAR-DMA-NBR                         04310002
043200        PERFORM T100-POPULATE-DMA-LINE                            04320002
043300        MOVE MDSEAR-DMA-NBR TO SAVE-DMA-NBR                       04330002
043400        PERFORM W500-WRITE-DMA-HEADER                             04340002
043500     END-IF.                                                      04350002
043600                                                                  04360002
043700     PERFORM C100-POPULATE-REPORT-RECORD.                         04370002
043800     PERFORM W200-WRITE-REPORT-RECORD.                            04380002
043900                                                                  04390002
044000     PERFORM S200-FETCH-AGREEMENTS-CSR.                           04400002
044100                                                                  04410002
044200                                                                  04420002
044300******************************************************************04430002
044400*  CLOSE CURSOR & OUTPUT FILE, DISPLAY END OF RUN MESSAGE.       *04440002
044500******************************************************************04450002
044600 B300-EOJ-ROUTINE.                                                04460002
044700                                                                  04470002
044800     PERFORM T100-POPULATE-DMA-LINE.                              04480002
044900     PERFORM W300-WRITE-TOTAL-LINE.                               04490002
045000     PERFORM W400-WRITE-EOR.                                      04500002
045100                                                                  04510002
045200     PERFORM X200-CLOSE-AGREEMENTS-CSR.                           04520002
045300                                                                  04530002
045400     CLOSE REPORT-FILE.                                           04540002
045500                                                                  04550002
045600     DISPLAY '** TOTAL RECORDS FETCHED= ' PV-AGR-CSR-COUNT.       04560002
045700                                                                  04570002
045800******************************************************************04580002
045900*  FORMAT REPORT DETAIL                                           04590002
046000******************************************************************04600002
046100 C100-POPULATE-REPORT-RECORD.                                     04610002
046200                                                                  04620002
046300     IF  ENTNME-ENT-NAME-DESC = SAVE-VND-NAME                     04630002
046400         MOVE SPACES                TO DL-VENDOR-NAME             04640004
046500                                       DL-VENDOR-NBR              04650004
046600     ELSE                                                         04660002
046700         MOVE ENTNME-ENT-NAME-DESC  TO DL-VENDOR-NAME             04670004
046800                                       SAVE-VND-NAME              04680002
046900         MOVE EXTENT-DUN-NBR        TO DL-VENDOR-NBR              04690004
047000         PERFORM W600-WRITE-BLANK-LINE                            04700007
047100     END-IF.                                                      04710002
047200                                                                  04720002
047300     MOVE VNDAGR-DEPT-NBR           TO DL-DEPT-NBR.               04730004
047400     MULTIPLY VNDAGR-DISCOUNT-PCT BY 100 GIVING PV-DISCOUNT-PCT.  04740004
047500     MOVE PV-DISCOUNT-PCT           TO DL-DISCOUNT-PCT.           04750004
047600     MOVE TRNCDE-TRN-SHRT-DESC      TO DL-DESCRIPTION.            04760004
047700     MOVE VNDAGR-DED-RTV-IND        TO DL-RTV-IND.                04770004
047800     MOVE VNDAGR-DED-DISC-IND       TO DL-DSC-IND.                04780004
047900     MOVE VNDAGR-PSTG-FRQ-CDE       TO DL-POSTING-FREQUENCY.      04790004
048000     MOVE VNDAGR-EFFECTIVE-DATE     TO DL-EFFECTIVE-DATE.         04800004
048100     MOVE VNDAGR-EXPIRATION-DATE    TO DL-EXPIRATION-DATE.        04810004
048200     MOVE MDSEAR-DMA-NBR            TO DL-DMA-NBR.                04820004
048300                                                                  04830002
048400     ADD 1 TO DMA-COUNT                                           04840006
048500              TOTAL-AGR-COUNT.                                    04850006
048600                                                                  04860002
048700*---------------------------------------------------------------- 04870002
048800*    FETCH THE AGREEMENT_CSR CURSOR.                              04880002
048900*---------------------------------------------------------------- 04890002
049000 S200-FETCH-AGREEMENTS-CSR.                                       04900002
049100                                                                  04910002
049200     EXEC SQL                                                     04920002
049300         FETCH  AGREEMENT_CSR                                     04930002
049400         INTO  :VNDAGR-AP-TRN-CDE                                 04940002
049500             , :VNDAGR-DISCOUNT-PCT                               04950002
049600             , :VNDAGR-EFFECTIVE-DATE                             04960002
049700             , :VNDAGR-EXPIRATION-DATE                            04970002
049800             , :VNDAGR-PSTG-FRQ-CDE                               04980002
049900             , :VNDAGR-DED-DISC-IND                               04990002
050000             , :VNDAGR-DED-RTV-IND                                05000002
050100             , :TRNCDE-TRN-SHRT-DESC                              05010002
050200             , :ENTNME-ENT-NAME-DESC                              05020002
050300             , :EXTENT-DUN-NBR                                    05030002
050400             , :VNDAGR-DEPT-NBR                                   05040002
050500             , :MDSEAR-DMA-NBR                                    05050002
050600     END-EXEC.                                                    05060002
050700                                                                  05070002
050800     EVALUATE TRUE                                                05080002
050900         WHEN SQLCODE = ZERO                                      05090002
051000             ADD 1 TO PV-AGR-CSR-COUNT                            05100002
051100                                                                  05110002
051200         WHEN SQLCODE = +100                                      05120002
051300             SET END-OF-CSR TO TRUE                               05130002
051400                                                                  05140002
051500         WHEN SQLWARN0 NOT = SPACES                               05150002
051600         WHEN SQLCODE  NOT = ZERO                                 05160002
051700             MOVE 'S200-FETCH-AGREEMENTS-CSR'                     05170002
051800                                 TO AA-PARAGRAPH-NAME             05180002
051900             MOVE 'UNSUCCESSFUL FETCH FROM AGREEMENT_CSR'         05190002
052000                                 TO AA-DB2-OPERATION              05200002
052100             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                05210002
052200             MOVE 'TTRNCDE'      TO AA-DB2-TABLE-2                05220002
052300             MOVE 'TEXTENT'      TO AA-DB2-TABLE-3                05230002
052400             MOVE 'TENTNME'      TO AA-DB2-TABLE-4                05240002
052500             MOVE 'TMDSEAR'      TO AA-DB2-TABLE-5                05250002
052600             PERFORM Z999-DB2-ABEND                               05260002
052700     END-EVALUATE.                                                05270002
052800                                                                  05280002
052900******************************************************************05290002
053000*  FORMAT DMA DETAIL                                              05300002
053100******************************************************************05310002
053200 T100-POPULATE-DMA-LINE.                                          05320002
053300                                                                  05330002
053400     MOVE SAVE-DMA-NBR TO DL-DMA-NBR.                             05340007
053500     MOVE DMA-COUNT    TO DL-COUNT.                               05350007
053600                                                                  05360002
053700     WRITE REPORT-REC FROM DL-DMA-DASH-LINE2                      05370002
053800       AFTER ADVANCING +1 LINES.                                  05380002
053900                                                                  05390002
054000     WRITE REPORT-REC FROM DL-DMA-LINE                            05400002
054100       AFTER ADVANCING +1 LINES.                                  05410002
054200                                                                  05420002
054300     ADD +2 TO PV-LINE-COUNT.                                     05430007
054400                                                                  05440002
054500     MOVE ZEROES TO DMA-COUNT.                                    05450002
054600                                                                  05460002
054700     IF (PV-LINE-COUNT + 3) > PC-LINES-PER-PAGE-MAX               05470002
054800         PERFORM W100-WRITE-HEADINGS                              05480002
054900     END-IF.                                                      05490002
055000                                                                  05500002
055100                                                                  05510002
055200*----------------------------------------------------------------*05520002
055300*    WRITE PAGE HEADING LINES                                    *05530002
055400*----------------------------------------------------------------*05540002
055500 W100-WRITE-HEADINGS.                                             05550002
055600                                                                  05560002
055700     ADD +1             TO PV-PAGE-COUNT.                         05570007
055800     MOVE PV-PAGE-COUNT TO DP132-PAGE-NUMBER.                     05580007
055900                                                                  05590002
056000* HEADING LINE 1 (STANDARD)                                       05600002
056100     WRITE REPORT-REC FROM DP132-STANDRD-HEADER-132-COLS          05610002
056200       AFTER ADVANCING PAGE.                                      05620002
056300                                                                  05630002
056400     WRITE REPORT-REC FROM HEADING-LINE-1                         05640004
056500       AFTER ADVANCING +1 LINES.                                  05650007
056600                                                                  05660002
056700     WRITE REPORT-REC FROM HEADING-LINE-2                         05670004
056800       AFTER ADVANCING +1 LINES.                                  05680002
056900                                                                  05690002
057000     WRITE REPORT-REC FROM DETAIL-HEADING-LINE                    05700007
057100       AFTER ADVANCING +2 LINES.                                  05710002
057200                                                                  05720002
057300     WRITE REPORT-REC FROM BLANK-LINE                             05730005
057400       AFTER ADVANCING +1 LINES.                                  05740002
057500                                                                  05750007
057600     MOVE SAVE-DMA-NBR TO DH-DMA-NBR.                             05760007
057700                                                                  05770007
057800     WRITE REPORT-REC FROM DIVISION-HEADING                       05780007
057900       AFTER ADVANCING +1 LINES.                                  05790007
058000                                                                  05800007
058100     WRITE REPORT-REC FROM BLANK-LINE                             05810007
058200       AFTER ADVANCING +1 LINES.                                  05820007
058300                                                                  05830002
058400     MOVE +8 TO PV-LINE-COUNT.                                    05840007
058500                                                                  05850002
058600     MOVE ENTNME-ENT-NAME-DESC  TO DL-VENDOR-NAME.                05860009
058700     MOVE EXTENT-DUN-NBR        TO DL-VENDOR-NBR.                 05870009
058800                                                                  05880009
058900******************************************************************05890002
059000*  WRITE OUT REPORT DETAIL LINE                                  *05900002
059100******************************************************************05910002
059200 W200-WRITE-REPORT-RECORD.                                        05920002
059300                                                                  05930002
059400     IF PV-LINE-COUNT > PC-LINES-PER-PAGE-MAX                     05940002
059500         PERFORM W100-WRITE-HEADINGS                              05950002
059600     END-IF.                                                      05960002
059700                                                                  05970002
059800     WRITE REPORT-REC FROM DETAIL-LINE                            05980004
059900       AFTER ADVANCING +1 LINES.                                  05990002
060000                                                                  06000002
060100     ADD +1 TO PV-LINE-COUNT.                                     06010007
060200                                                                  06020002
060300     INITIALIZE DETAIL-LINE.                                      06030004
060400                                                                  06040002
060500******************************************************************06050002
060600*  WRITE OUT TOTAL DETAIL LINE                                   *06060002
060700******************************************************************06070002
060800 W300-WRITE-TOTAL-LINE.                                           06080002
060900                                                                  06090002
061000     IF PV-LINE-COUNT > PC-LINES-PER-PAGE-MAX                     06100002
061100         PERFORM W100-WRITE-HEADINGS                              06110002
061200     END-IF.                                                      06120002
061300                                                                  06130002
061400     MOVE TOTAL-AGR-COUNT TO TL-COUNT.                            06140006
061500     WRITE REPORT-REC FROM TOTAL-LINE                             06150002
061600       AFTER ADVANCING +2 LINES.                                  06160002
061700                                                                  06170002
061800     ADD +2 TO PV-LINE-COUNT.                                     06180007
061900                                                                  06190002
062000                                                                  06200002
062100*----------------------------------------------------------------*06210002
062200*    WRITE END OF REPORT LINE                                    *06220002
062300*----------------------------------------------------------------*06230002
062400 W400-WRITE-EOR.                                                  06240002
062500                                                                  06250002
062600     IF (PV-LINE-COUNT + 3) > PC-LINES-PER-PAGE-MAX               06260002
062700         PERFORM W100-WRITE-HEADINGS                              06270002
062800     END-IF.                                                      06280002
062900                                                                  06290002
063000     WRITE REPORT-REC FROM END-OF-REPORT                          06300002
063100       AFTER ADVANCING +3 LINES.                                  06310002
063200                                                                  06320002
063300                                                                  06330002
063400*----------------------------------------------------------------*06340002
063500*    WRITE DMA HEADER LINE                                       *06350002
063600*----------------------------------------------------------------*06360002
063700 W500-WRITE-DMA-HEADER.                                           06370002
063800                                                                  06380002
063900     IF (PV-LINE-COUNT + 3) > PC-LINES-PER-PAGE-MAX               06390002
064000         PERFORM W100-WRITE-HEADINGS                              06400002
064100     END-IF.                                                      06410002
064200                                                                  06420002
064300     MOVE SAVE-DMA-NBR TO DH-DMA-NBR.                             06430004
064400                                                                  06440002
064500     WRITE REPORT-REC FROM DIVISION-HEADING                       06450004
064600       AFTER ADVANCING +2 LINES.                                  06460002
064700                                                                  06470002
064800     WRITE REPORT-REC FROM BLANK-LINE                             06480004
064900       AFTER ADVANCING +1 LINES.                                  06490002
065000                                                                  06500002
065100     ADD +3 TO PV-LINE-COUNT.                                     06510007
065200                                                                  06520002
065300                                                                  06530007
065400*----------------------------------------------------------------*06540007
065500*    WRITE BLANK LINE                                            *06550007
065600*----------------------------------------------------------------*06560007
065700 W600-WRITE-BLANK-LINE.                                           06570007
065800                                                                  06580007
065900     IF (PV-LINE-COUNT + 2) > PC-LINES-PER-PAGE-MAX               06590007
066000         PERFORM W100-WRITE-HEADINGS                              06600007
066100     ELSE                                                         06610007
066200         WRITE REPORT-REC FROM BLANK-LINE                         06620007
066300           AFTER ADVANCING +1 LINES                               06630007
066400         ADD +1 TO PV-LINE-COUNT                                  06640007
066500     END-IF.                                                      06650007
066600                                                                  06660007
066700*---------------------------------------------------------------- 06670007
066800*    OPEN AGREEMENT_CSR CURSOR                                    06680002
066900*---------------------------------------------------------------- 06690002
067000 X100-OPEN-AGREEMENTS-CSR.                                        06700002
067100                                                                  06710002
067200     EXEC SQL                                                     06720002
067300         OPEN AGREEMENT_CSR                                       06730002
067400     END-EXEC.                                                    06740002
067500                                                                  06750002
067600     EVALUATE TRUE                                                06760002
067700         WHEN SQLCODE = ZERO                                      06770002
067800             CONTINUE                                             06780002
067900                                                                  06790002
068000         WHEN SQLWARN0 NOT = SPACES                               06800002
068100         WHEN SQLCODE  NOT = ZERO                                 06810002
068200             MOVE 'X100-OPEN-AGREEMENTS-CSR'                      06820002
068300                                 TO AA-PARAGRAPH-NAME             06830002
068400             MOVE 'UNSUCCESSFUL OPEN ON AGREEMENT_CSR'            06840002
068500                                 TO AA-DB2-OPERATION              06850002
068600             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                06860002
068700             MOVE 'TTRNCDE'      TO AA-DB2-TABLE-2                06870002
068800             MOVE 'TEXTENT'      TO AA-DB2-TABLE-3                06880002
068900             MOVE 'TENTNME'      TO AA-DB2-TABLE-4                06890002
069000             MOVE 'TMDSEAR'      TO AA-DB2-TABLE-5                06900002
069100             PERFORM Z999-DB2-ABEND                               06910002
069200     END-EVALUATE.                                                06920002
069300                                                                  06930002
069400                                                                  06940002
069500*---------------------------------------------------------------- 06950002
069600*    CLOSE THE AGREEMENT_CSR CURSOR                               06960002
069700*---------------------------------------------------------------- 06970002
069800 X200-CLOSE-AGREEMENTS-CSR.                                       06980002
069900                                                                  06990002
070000     EXEC SQL                                                     07000002
070100         CLOSE AGREEMENT_CSR                                      07010002
070200     END-EXEC.                                                    07020002
070300                                                                  07030002
070400     EVALUATE TRUE                                                07040002
070500         WHEN SQLCODE = ZERO                                      07050002
070600             CONTINUE                                             07060002
070700                                                                  07070002
070800         WHEN SQLWARN0 NOT = SPACES                               07080002
070900         WHEN SQLCODE  NOT = ZERO                                 07090002
071000             MOVE 'X200-CLOSE-AGREEMENTS-CSR'                     07100002
071100                                 TO AA-PARAGRAPH-NAME             07110002
071200             MOVE 'UNSUCCESSFUL CLOSE ON AGREEMENT_CSR'           07120002
071300                                 TO AA-DB2-OPERATION              07130002
071400             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                07140002
071500             MOVE 'TTRNCDE'      TO AA-DB2-TABLE-2                07150002
071600             MOVE 'TEXTENT'      TO AA-DB2-TABLE-3                07160002
071700             MOVE 'TENTNME'      TO AA-DB2-TABLE-4                07170002
071800             MOVE 'TMDSEAR'      TO AA-DB2-TABLE-5                07180002
071900             PERFORM Z999-DB2-ABEND                               07190002
072000       END-EVALUATE.                                              07200002
072100                                                                  07210002
072200                                                                  07220002
072300******************************************************************07230002
072400*  DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT  *07240002
072500*  AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN             *07250002
072600*  SQL ERROR OR WARNING CODE OCCURS.                             *07260002
072700******************************************************************07270002
072800 Z999-DB2-ABEND.                                                  07280002
072900                                                                  07290002
073000     DISPLAY AA-ABEND-LIT.                                        07300002
073100     DISPLAY AA-MESSAGE-LINE-1.                                   07310002
073200     DISPLAY AA-MESSAGE-LINE-2.                                   07320002
073300     DISPLAY AA-DB2-ERROR-LIT.                                    07330002
073400     DISPLAY AA-PROGRAM-LIT.                                      07340002
073500     DISPLAY AA-PARAGRAPH-LIT.                                    07350002
073600     DISPLAY AA-DB2-OPERATION-LIT.                                07360002
073700     DISPLAY AA-DB2-TABLE-1.                                      07370002
073800     DISPLAY AA-DB2-TABLE-2.                                      07380002
073900     DISPLAY AA-DB2-TABLE-3.                                      07390002
074000     DISPLAY AA-DB2-TABLE-4.                                      07400002
074100     DISPLAY AA-DB2-TABLE-5.                                      07410002
074200                                                                  07420002
074300*----------------------------------------------------------------*07430002
074400* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *07440002
074500* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *07450002
074600* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *07460002
074700* FORMAT.                                                        *07470002
074800*----------------------------------------------------------------*07480002
074900     COPY DPPD004.                                                07490002
075000                                                                  07500002
075100*----------------------------------------------------------------*07510002
075200* CALL ABEND                                                     *07520002
075300*----------------------------------------------------------------*07530002
075400     MOVE +4013                  TO ABEND-CODE.                   07540002
075500     CALL 'ILBOABN0' USING ABEND-CODE.                            07550002
075600*                                                                 07560002
