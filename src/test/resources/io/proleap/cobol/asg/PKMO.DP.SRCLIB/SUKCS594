D00100******************************************************************00010012
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.             SUKCS594.                                00040000
000500 AUTHOR.                 LARRY SCHLEICHER.                        00050000
000600 INSTALLATION.           KOHLS DEPARTMENT STORE.                  00060000
000700 DATE-WRITTEN            JAN, 2002.                               00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000* THIS PROGRAM WILL SUMMARIZE THE STATUS OF AN AUDIT OR A GROUP   00100000
001100* OF AUDITS.  THE SUMMARY DATA WILL BE RETURNED TO THE CALLING    00110000
001200* PROGRAM.                                                        00120000
000500******************************************************************00130000
      * 11/05/13 DW BEG                                                 00140000
      * 11/05/2013 DAVE WELLER CHG00????? TKID: TKMA602                 00150000
      *            HANDLE 'RF' PACKAGING TYPE LIKE 'PS' TYPE.           00160000
      * 11/05/13 DW END                                                 00170000
001300******************************************************************00180000
001400 ENVIRONMENT DIVISION.                                            00190000
001500 DATA DIVISION.                                                   00200000
001600******************************************************************00210000
001700 WORKING-STORAGE SECTION.                                         00220000
001800                                                                  00230000
001900 01  DK-DB2-KEYS.                                                 00240000
002000     05  DK-PO-NBR                PIC S9(09) COMP.                00250000
002100     05  DK-PO-LINE-NBR           PIC S9(09)  COMP.               00260000
002200     05  DK-PO-DRIVER-LINE        PIC S9(09)  COMP.               00270000
002300     05  DK-PREPK-ID              PIC S9(04)  COMP.               00280000
002400     05  DK-OPER-UNT-ID           PIC S9(04)  COMP.               00290000
002500     05  DK-INBND-TRIP-ID         PIC S9(09)  COMP.               00300000
002600     05  DK-RCVR-SEQ-NBR          PIC S9(09)  COMP.               00310000
002700     05  DK-SHIPT-UNT-ID          PIC S9(18)V COMP-3.             00320000
002800     05  DK-ENT-ID                PIC S9(09)  COMP.               00330000
002900     05  DK-DEPT-NBR              PIC S9(04)  COMP-4.             00340000
003000     05  DK-PKGNG-TYP-CDE         PIC  X(02).                     00350000
003100     05  DK-AUD-CNTL-NBR          PIC S9(09) COMP.                00360000
003200     05  DK-AUDIT-CNTL-NBR        PIC S9(09) COMP.                00370000
003300                                                                  00380000
003400 01  DN-DB2-NULL-INDICATORS.                                      00390000
003500     05  DN-SUM-NULL-IND            PIC S9(04) COMP VALUE ZEROES. 00400009
003600*                                                                 00410000
003700*----------------------------------------------------------------*00420000
003800* COMMAREA USED WHEN LINKING FROM A CALLING PROGRAM               00430000
003900*----------------------------------------------------------------*00440000
004000     COPY SUWS026.                                                00450000
004100                                                                  00460000
004200******************************************************************00470000
004300*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00480000
004400******************************************************************00490000
004500     COPY DPWS013.                                                00500000
004600                                                                  00510000
004700*----------------------------------------------------------------*00520000
004800*  PROGRAM CONSTANTS                                             *00530000
004900*----------------------------------------------------------------*00540000
005000 01  PC-PROGRAM-CONSTANTS.                                        00550000
005100     05  PC-F                     PIC  X(01)  VALUE 'F'.          00560000
005200     05  PC-I                     PIC  X(01)  VALUE 'I'.          00570000
005300     05  PC-N                     PIC  X(01)  VALUE 'N'.          00580000
005400     05  PC-P                     PIC  X(01)  VALUE 'P'.          00590000
005500     05  PC-D                     PIC  X(01)  VALUE 'D'.          00600000
005600     05  PC-PICKING               PIC  X(01)  VALUE 'P'.          00610000
005700     05  PC-TICKET                PIC  X(01)  VALUE 'T'.          00620000
005800     05  PC-PACKING               PIC  X(01)  VALUE 'A'.          00630000
005900     05  PC-02                    PIC  X(02)  VALUE '02'.         00640000
006000     05  PC-LOG-QUEUE             PIC  X(04)  VALUE 'CSSL'.       00650000
006100     05  PC-MSG-TABLE-SIZE            PIC S9(03) COMP-3 VALUE 200.00660000
006200                                                                  00670000
006300*----------------------------------------------------------------*00680000
006400*  PROGRAM SWITCHES                                              *00690000
006500*----------------------------------------------------------------*00700000
006600 01  PS-PROGRAM-SWITCHES.                                         00710000
006700     05  PS-EOC-TICKET-CURSOR-IND        PIC  X(01)  VALUE 'N'.   00720000
006800         88  PS-EOC-TICKET-CURSOR                    VALUE 'Y'.   00730000
006900         88  PS-NOT-EOC-TICKET-CURSOR                VALUE 'N'.   00740000
      *11/08/13 DW BEG                                                  00750000
007000     05  PS-EOC-RFID-CURSOR-IND          PIC  X(01)  VALUE 'N'.   00760000
007100         88  PS-EOC-RFID-CURSOR                      VALUE 'Y'.   00770000
007200         88  PS-NOT-EOC-RFID-CURSOR                  VALUE 'N'.   00780000
      *11/08/13 DW END                                                  00790000
007000     05  PS-EOC-PICK-CURSOR-IND          PIC  X(01)  VALUE 'N'.   00800000
007100         88  PS-EOC-PICK-CURSOR                      VALUE 'Y'.   00810000
007200         88  PS-NOT-EOC-PICK-CURSOR                  VALUE 'N'.   00820000
007300     05  PS-VALID-AUDIT-NBR-IND          PIC  X(01)  VALUE 'N'.   00830000
007400         88  PS-VALID-AUDIT-NBR                      VALUE 'Y'.   00840000
007500         88  PS-INVALID-AUDIT-NBR                    VALUE 'N'.   00850000
007600     05  PS-EOC-FAIL-CURSOR-IND          PIC  X(01)  VALUE 'N'.   00860000
007700         88  PS-EOC-FAIL-CURSOR                      VALUE 'Y'.   00870000
007800         88  PS-NOT-EOC-FAIL-CURSOR                  VALUE 'N'.   00880000
007900     05  PS-SHOW-DEBUG-SW                PIC  X(01)  VALUE 'N'.   00890000
008000         88  PS-DONT-SHOW-DEBUG-INFO                 VALUE 'N'.   00900000
008100         88  PS-SHOW-DEBUG-INFO                      VALUE 'Y'.   00910000
008200     05  PS-REQ-REC-FOUND-SW             PIC  X(01)  VALUE 'N'.   00920000
008300         88  PS-REQ-REC-FOUND                        VALUE 'Y'.   00930000
008400         88  PS-NO-REQ-REC-FOUND                     VALUE 'N'.   00940000
008500     05  PS-NO-AUDIT-STARTED-SW          PIC  X(01)  VALUE 'N'.   00950000
008600         88  PS-AUDIT-STARTED                        VALUE 'Y'.   00960000
008700         88  PS-NO-AUDIT-STARTED                     VALUE 'N'.   00970000
008800     05  PS-DEPT-RANK-FOUND-SW           PIC  X(01)  VALUE 'N'.   00980000
008900         88  PS-DEPT-RANK-FOUND                      VALUE 'Y'.   00990000
009000         88  PS-NO-DEPT-RANK-FOUND                   VALUE 'N'.   01000000
009100     05  PS-PASSED-AUDITS-FOUND-SW       PIC  X(01)  VALUE 'N'.   01010000
009200         88  PS-PASSED-AUDITS-FOUND                  VALUE 'Y'.   01020000
009300         88  PS-NO-PASSED-AUDITS-FOUND               VALUE 'N'.   01030000
009400     05  PS-END-FAILED-AUDITS-SW         PIC  X(01)  VALUE 'N'.   01040000
009500         88  PS-NOT-END-FAILED-AUDITS                VALUE 'N'.   01050000
009600         88  PS-END-FAILED-AUDITS                    VALUE 'Y'.   01060000
009700     05  PS-AUDIT-NBR-IND                PIC  X(01)  VALUE 'N'.   01070000
009800         88  PS-AUDIT-NBR-EXISTS                     VALUE 'Y'.   01080000
009900         88  PS-AUDIT-NBR-NOT-EXISTS                 VALUE 'N'.   01090000
010000     05  PS-VEND-RANK-FOUND-SW           PIC  X(01)  VALUE 'N'.   01100000
010100         88  PS-VEND-RANK-FOUND                      VALUE 'Y'.   01110000
010200         88  PS-NO-VEND-RANK-FOUND                   VALUE 'N'.   01120000
010300     05  PS-DEFAULT-RANK-FOUND-SW        PIC  X(01)  VALUE 'N'.   01130000
010400         88  PS-DEFAULT-RANK-FOUND                   VALUE 'Y'.   01140000
010500         88  PS-NO-DEFAULT-RANK-FOUND                VALUE 'N'.   01150000
010600     05  PS-PO-INFO-FOUND-SW             PIC  X(01)  VALUE 'N'.   01160000
010700         88  PS-PO-INFO-FOUND                        VALUE 'Y'.   01170000
010800         88  PS-NO-PO-INFO-FOUND                     VALUE 'N'.   01180000
010900     05  PS-LINE-LEVEL-FOUND-SW          PIC  X(01)  VALUE 'N'.   01190000
011000         88  PS-LINE-LEVEL-FOUND                     VALUE 'Y'.   01200000
011100         88  PS-NO-LINE-LEVEL-FOUND                  VALUE 'N'.   01210000
011200     05  PS-PO-LEVEL-FOUND-SW            PIC  X(01)  VALUE 'N'.   01220000
011300         88  PS-PO-LEVEL-FOUND                       VALUE 'Y'.   01230000
011400         88  PS-NO-PO-LEVEL-FOUND                    VALUE 'N'.   01240000
011500     05  PS-AUDIT-IS-REQUIRED-SW         PIC  X(01)  VALUE 'N'.   01250000
011600         88  PS-AUDIT-IS-REQUIRED                    VALUE 'Y'.   01260000
011700         88  PS-AUDIT-IS-NOT-REQUIRED                VALUE 'N'.   01270000
011800     05  PS-ERROR-SW                     PIC  X(01)  VALUE 'N'.   01280000
011900         88  PS-ERROR                                VALUE 'Y'.   01290000
012000         88  PS-ERROR-NO                             VALUE 'N'.   01300000
012100     05  PS-DUMP-TO-LOG-SW               PIC X(01)   VALUE 'N'.   01310000
012200         88  PS-DONT-DUMP-TO-LOG                     VALUE 'N'.   01320000
012300         88  PS-DUMP-TO-LOG                          VALUE 'Y'.   01330000
012400                                                                  01340000
012500*----------------------------------------------------------------*01350000
012600*  PROGRAM VARIABLES                                             *01360000
012700*----------------------------------------------------------------*01370000
012800 01  PV-PROGRAM-VARIABLES.                                        01380000
012900                                                                  01390000
013000     05  PV-SAVE-SCN-TMST                PIC  X(26).              01400000
      *11/08/13 DW BEG                                                  01410000
013100     05  PV-RFID-ERRORS                  PIC S9(09) COMP          01420000
013200                                         VALUE 0.                 01430000
      *11/08/13 DW END                                                  01440000
013100     05  PV-PICK-ERRORS                  PIC S9(09) COMP          01450000
013200                                         VALUE 0.                 01460000
013300     05  PV-DB2-ERROR-COUNT              PIC S9(09) COMP.         01470000
013400     05  PV-TOTAL-EXPECTED-UNITS         PIC S9(09) COMP.         01480000
013500     05  PV-AVERAGE-UNIT-COUNT           PIC S9(09) COMP.         01490000
013600     05  PV-AVERAGE-TOTAL-COUNT          PIC S9(09) COMP.         01500000
013700     05  PV-REMAINDER                    PIC S9(09) COMP.         01510000
013800     05  PV-DB2-TCKT-ERR-COUNT           PIC S9(09) COMP.         01520000
013900     05  PV-DB2-I-PACK-ERR-COUNT         PIC S9(09) COMP.         01530000
014000     05  PV-DB2-PO-STR-ERR-COUNT         PIC S9(09) COMP.         01540000
014100     05  PV-LIMIT-DAYS                   PIC S9(09) COMP.         01550000
014200     05  PV-HOLD-UPC-NBR                 PIC S9(15) COMP-3.       01560000
014300     05  PV-DB2-TICKET-COUNT             PIC S9(09) COMP.         01570000
014400     05  PV-TOTAL-TICKET-COUNT           PIC S9(09) COMP.         01580000
014500     05  PV-DISPLAY-PO-NBR               PIC 9(09).               01590000
014600     05  PV-DISPLAY-PO-LINE-NBR          PIC 9(09).               01600000
014700     05  PV-DISPLAY-PREPK-ID             PIC 9(04).               01610000
014800     05  PV-DISPLAY-OPER-UNT-ID          PIC 9(04).               01620000
014900     05  PV-DISPLAY-INBND-TRIP-ID        PIC 9(09).               01630000
015000     05  PV-DISPLAY-RCVR-SEQ-NBR         PIC 9(09).               01640000
015100     05  PV-DISPLAY-SHIPT-UNT-ID         PIC 9(18).               01650000
015200     05  PV-DISPLAY-ENT-ID               PIC 9(09).               01660000
015300     05  PV-DISPLAY-AUDIT-CNTL-NBR       PIC 9(09).               01670000
015400     05  PV-DISPLAY-DEPT-NBR             PIC 9(04).               01680000
015500     05  PV-DISPLAY-CK-AFT-DAY-QTY       PIC 9(04).               01690000
015600     05  PV-DISPLAY-LIMIT-DAYS           PIC 9(09).               01700000
015700     05  PV-DISPLAY-TASK                 PIC 9(07).               01710000
015800     05  PV-DISPLAY-MSG-NBR              PIC 9(03).               01720000
015900                                                                  01730000
016000     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACES.01740000
016100                                                                  01750000
016200     05  PV-PASSED-COUNT                 PIC S9(4)  COMP.         01760000
016300     05  PV-DB2-COUNT-EXP-SCN            PIC S9(4)  VALUE +0      01770000
016400                                                    COMP.         01780000
016500     05  PV-CARTONS-TO-AUDIT             PIC S9(9)  VALUE +0      01790000
016600                                                    COMP.         01800000
016700     05  PV-UNITS-TO-AUDIT               PIC S9(9)  VALUE +0      01810000
016800                                                    COMP.         01820000
016900     05  PV-TOTAL-CARTONS                PIC S9(9)  VALUE +0      01830000
017000                                                    COMP.         01840000
017100     05  PV-TOTAL-UNITS                  PIC S9(9)  VALUE +0      01850000
017200                                                    COMP.         01860000
017300     05  PV-SUM-EXPTD-ALLOC              PIC S9(9)  VALUE +0      01870000
017400                                                    COMP.         01880000
017500     05  PV-SUM-OF-ALL-LINES             PIC S9(9)  VALUE +0      01890000
017600                                                    COMP.         01900000
017700     05  PV-SUM-SHPD-QTY                 PIC S9(9)  VALUE +0      01910000
017800                                                    COMP.         01920000
017900     05  PV-AUDIT-CNTL-NBR-X             PIC  X(09) VALUE SPACE.  01930000
018000     05  PV-AUDIT-CNTL-NBR  REDEFINES                             01940000
018100         PV-AUDIT-CNTL-NBR-X             PIC  9(09).              01950000
018200     05  PV-SHPD-QTY-SUM                 PIC S9(09) COMP-3.       01960000
018300     05  PV-CARTON-COUNT                 PIC S9(09) COMP.         01970000
018400     05  PV-CICS-MSG-AREA                PIC  X(80) VALUE SPACE.  01980000
018500     05  PV-CICS-RESPONSE                PIC S9(08) VALUE ZEROS   01990000
018600                                                    COMP SYNC.    02000000
018700     05  PV-EIBTASKN                     PIC Z(06)9.              02010000
018800     05  PV-PREV-SEQUENCE                PIC S9(05) COMP-3        02020000
018900                                                     VALUE ZERO.  02030000
019000     05  PV-NEXT-SEQUENCE                PIC S9(05) COMP-3        02040000
019100                                                     VALUE ZERO.  02050000
019200     05  PV-DISP-CARTON-COUNT            PIC  9(09)-.             02060000
019300     05  PV-DISP-SUM-SHPD-QTY            PIC  9(09)-.             02070000
019400     05  PV-DISP-REMAINDER               PIC  9(09)-.             02080000
019500     05  PV-DISP-SUT15-CART-QTY          PIC  9(09)-.             02090000
003100     05  PV-COMBO-AUD-CNTL-NBR           PIC S9(09) COMP.         02100004
019600/                                                                 02110000
019700 01  PT-MSG-TABLE.                                                02120000
019800     05  PT-MSG-LINES OCCURS 200 TIMES                            02130000
019900                              INDEXED BY PT-MSG-IDX.              02140000
020000         10  PT-MSG-SEQ                  PIC S9(05) COMP-3.       02150000
020100         10  PT-MSG-LINE                 PIC X(69).               02160000
020200                                                                  02170000
020300     05  PV-COMMAREA-LENGTH              PIC S9(04)  COMP         02180000
020400                                                     VALUE ZERO.  02190000
020500     05  PV-CICS-RESP                    PIC S9(08)  VALUE ZEROS  02200000
020600                                                     COMP SYNC.   02210000
020700                                                                  02220000
020800*---------------------------------------------------------------* 02230000
020900*    DB2 AREA FOR THE SHIPPING UNIT AUDIT TABLE                 * 02240000
021000*---------------------------------------------------------------* 02250000
021100     EXEC SQL                                                     02260000
021200         INCLUDE TSUNAUD                                          02270000
021300     END-EXEC.                                                    02280000
021400******************************************************************02290000
021500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      02300000
021600*  AUDIT CONTENT TABLE (TSUAUPC)                                  02310000
021700******************************************************************02320000
021800     EXEC SQL                                                     02330000
021900         INCLUDE TSUAUPC                                          02340000
022000     END-EXEC.                                                    02350000
022100                                                                  02360000
022200*---------------------------------------------------------------* 02370000
022300*    DB2 AREA FOR THE SHIPPING UNIT AUDIT TRANSACTION TABLE     * 02380000
022400*---------------------------------------------------------------* 02390000
022500     EXEC SQL                                                     02400000
022600         INCLUDE TSUATRN                                          02410000
022700     END-EXEC.                                                    02420000
022800******************************************************************02430000
022900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      02440000
023000*  UPC TABLE (TSHUUPC)                                            02450000
023100******************************************************************02460000
023200     EXEC SQL                                                     02470000
023300         INCLUDE TSHUUPC                                          02480000
023400     END-EXEC.                                                    02490000
023500                                                                  02500000
023600*---------------------------------------------------------------* 02510000
023700*    DB2 AREA FOR THE SHIPPING UNIT EXCEPTION TABLE             * 02520000
023800*---------------------------------------------------------------* 02530000
023900     EXEC SQL                                                     02540000
024000         INCLUDE TSUEXCP                                          02550000
024100     END-EXEC.                                                    02560000
024200******************************************************************02570000
024300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      02580000
024400*  AUDIT TRANSACTION EXCEPTION TABLE                              02590000
024500******************************************************************02600000
024600     EXEC SQL                                                     02610000
024700         INCLUDE TCTEXCP                                          02620000
024800     END-EXEC.                                                    02630000
024900                                                                  02640000
025000*---------------------------------------------------------------* 02650000
025100*    DB2 AREA FOR THE AUDIT VIOLATION REASON CODE TABLE         * 02660000
025200*---------------------------------------------------------------* 02670000
025300     EXEC SQL                                                     02680000
025400          INCLUDE TVILNCD                                         02690000
025500     END-EXEC.                                                    02700000
025600*---------------------------------------------------------------* 02710000
025700*    DB2 AREA FOR THE PO AUDIT REQUEST TABLE (SUT_PO_AUD_REQ)   * 02720000
025800*---------------------------------------------------------------* 02730000
025900     EXEC SQL                                                     02740000
026000         INCLUDE SUT00015                                         02750000
026100     END-EXEC.                                                    02760000
026200*---------------------------------------------------------------* 02770000
026300*    DB2 AREA FOR THE VENDOR AUDIT PARM TABLE (SUT_PO_AUD_PARM) * 02780000
026400*---------------------------------------------------------------* 02790000
026500     EXEC SQL                                                     02800000
026600         INCLUDE SUT00017                                         02810000
026700     END-EXEC.                                                    02820000
026800*---------------------------------------------------------------* 02830000
026900*    DB2 AREA FOR THE VENDOR RANKING TABLE (SUT_VND_RNKG)       * 02840000
027000*---------------------------------------------------------------* 02850000
027100     EXEC SQL                                                     02860000
027200         INCLUDE SUT00019                                         02870000
027300     END-EXEC.                                                    02880000
027400*---------------------------------------------------------------* 02890000
027500*    DB2 AREA FOR THE RECEIVING SYSTEM PARM TABLE               * 02900000
027600*---------------------------------------------------------------* 02910000
027700     EXEC SQL                                                     02920000
027800         INCLUDE TKRPRPM                                          02930000
027900     END-EXEC.                                                    02940000
028000*----------------------------------------------------------------*02950000
028100*  COMMUNICATIONS AREA FOR DB2                                   *02960000
028200*----------------------------------------------------------------*02970000
028300     EXEC SQL                                                     02980000
028400         INCLUDE SQLCA                                            02990000
028500     END-EXEC.                                                    03000000
028600                                                                  03010000
028700     EXEC SQL                                                     03020000
028800         DECLARE FAIL-CSR CURSOR FOR                              03030000
028900          SELECT AUD_CNTL_NBR                                     03040000
029000             ,   OPER_UNT_ID                                      03050000
029100          FROM   SUT_PO_AUD_REQ                                   03060000
029200          WHERE  PO_NBR         = :DK-PO-NBR                      03070000
029300            AND  PO_PREPK_ID    = :DK-PREPK-ID                    03080000
029400            AND  AUD_STAT_CDE   = :PC-F                           03090000
029500            AND  DAYS(CRE_TMST) > :PV-LIMIT-DAYS                  03100000
029600     END-EXEC.                                                    03110000
029700                                                                  03120000
029800     EXEC SQL                                                     03130000
029900         DECLARE TICKET_CURSOR CURSOR FOR                         03140000
030000         SELECT  A.UPC_NBR                                        03150000
030100              ,  B.VILN_GP_SEQ_NBR                                03160000
030200              ,  SUM(A.SCND_UNT_QTY) AS SUMA                      03170000
030300         FROM    TSUAUPC A                                        03180000
030400              ,  TSUEXCP B                                        03190000
030500              ,  TVILNCD C                                        03200000
030600              ,  TSUATRN D                                        03210000
030700         WHERE                                                    03220000
030800             A.AUD_CNTL_NBR       = :DK-AUD-CNTL-NBR              03230000
030900         AND A.AUD_CNTL_NBR       = B.AUD_CNTL_NBR                03240000
031000         AND A.SCN_TMST           = B.SCN_TMST                    03250000
031100         AND C.VILN_GP_CDE        = 'VA'                          03260000
031200         AND B.VILN_GP_CDE        = C.VILN_GP_CDE                 03270000
031300         AND B.VILN_GP_SEQ_NBR    = C.VILN_GP_SEQ_NBR             03280000
031400         AND C.VILN_CTG_CDE       = 'T'                           03290000
031500         AND A.AUD_CNTL_NBR       = D.AUD_CNTL_NBR                03300000
031600         AND A.SHIPT_UNT_ID       = D.SHIPT_UNT_ID                03310000
031700         AND D.UNT_AUD_STAT_CDE   = 'CM'                          03320000
031800         GROUP BY                                                 03330000
031900                 A.UPC_NBR                                        03340000
032000              ,  B.VILN_GP_SEQ_NBR                                03350000
032100         ORDER BY                                                 03360000
032200                 A.UPC_NBR                                        03370000
032300              ,  SUMA   DESC                                      03380000
032400              ,  B.VILN_GP_SEQ_NBR                                03390000
032500     END-EXEC.                                                    03400000
032600                                                                  03410000
032700     EXEC SQL                                                     03420000
032800         DECLARE PICK_CURSOR CURSOR FOR                           03430000
032900         SELECT  B.SCN_TMST                                       03440000
033000              ,  C.VILN_GP_SEQ_NBR                                03450000
033100              ,  SUM(A.SCND_UNT_QTY)                              03460000
033200         FROM    TSUAUPC A                                        03470000
033300              ,  TSUEXCP B                                        03480000
033400              ,  TVILNCD C                                        03490000
033500              ,  TSUATRN D                                        03500000
033600         WHERE                                                    03510000
033700             A.AUD_CNTL_NBR       = :DK-AUD-CNTL-NBR              03520000
033800         AND A.AUD_CNTL_NBR       = B.AUD_CNTL_NBR                03530000
033900         AND A.SCN_TMST           = B.SCN_TMST                    03540000
034000         AND C.VILN_GP_CDE        = 'VA'                          03550000
034100         AND C.FALR_IND           = 'Y'                           03560000
034200         AND B.VILN_GP_CDE        = C.VILN_GP_CDE                 03570000
034300         AND B.VILN_GP_SEQ_NBR    = C.VILN_GP_SEQ_NBR             03580000
034400         AND C.VILN_CTG_CDE       = 'P'                           03590000
034500         AND A.AUD_CNTL_NBR       = D.AUD_CNTL_NBR                03600000
034600         AND A.SHIPT_UNT_ID       = D.SHIPT_UNT_ID                03610000
034700         AND D.UNT_AUD_STAT_CDE   = 'CM'                          03620000
034800         GROUP BY                                                 03630000
034900                 B.SCN_TMST                                       03640000
035000              ,  C.VILN_GP_SEQ_NBR                                03650000
035100         ORDER BY                                                 03660000
035200                 B.SCN_TMST                                       03670000
035300              ,  C.VILN_GP_SEQ_NBR                                03680000
035400     END-EXEC.                                                    03690000
032600                                                                  03700000
      *11/08/13 DW BEG                                                  03710000
      *** CURSOR TO COUNT THE NUMBER OF EXCEPTIONS.                     03720001
032700     EXEC SQL                                                     03730000
032800         DECLARE RFID_CURSOR CURSOR FOR                           03740000
032900         SELECT  B.SCN_TMST                                       03750000
033000              ,  C.VILN_GP_SEQ_NBR                                03760000
033100              ,  COUNT(B.SHIPT_UNT_ID)                            03770001
033200         FROM    TSUAUPC A                                        03780000
033300              ,  TSUEXCP B                                        03790000
033400              ,  TVILNCD C                                        03800000
033500              ,  TSUATRN D                                        03810000
033600         WHERE                                                    03820000
033700             A.AUD_CNTL_NBR       = :DK-AUD-CNTL-NBR              03830000
033800         AND A.AUD_CNTL_NBR       = B.AUD_CNTL_NBR                03840000
033900         AND A.SCN_TMST           = B.SCN_TMST                    03850000
034000         AND C.VILN_GP_CDE        = 'VA'                          03860000
034100         AND C.FALR_IND           = 'Y'                           03870000
034200         AND B.VILN_GP_CDE        = C.VILN_GP_CDE                 03880000
034300         AND B.VILN_GP_SEQ_NBR    = C.VILN_GP_SEQ_NBR             03890000
034400         AND C.VILN_CTG_CDE       = 'R'                           03900011
034500         AND A.AUD_CNTL_NBR       = D.AUD_CNTL_NBR                03910000
034600         AND A.SHIPT_UNT_ID       = D.SHIPT_UNT_ID                03920000
034700         AND D.UNT_AUD_STAT_CDE   = 'CM'                          03930000
034800         GROUP BY                                                 03940000
034900                 B.SCN_TMST                                       03950000
035000              ,  C.VILN_GP_SEQ_NBR                                03960000
035100         ORDER BY                                                 03970000
035200                 B.SCN_TMST                                       03980000
035300              ,  C.VILN_GP_SEQ_NBR                                03990000
035400     END-EXEC.                                                    04000000
      *11/08/13 DW END                                                  04010000
035500******************************************************************04020000
035600 LINKAGE SECTION.                                                 04030000
035700******************************************************************04040000
035800 01  DFHCOMMAREA.                                                 04050000
035900     05  FILLER                         OCCURS  1 TO 4072 TIMES   04060000
036000                                      DEPENDING ON EIBCALEN.      04070000
036100         10  FILLER                   PIC X.                      04080000
036200                                                                  04090000
036300******************************************************************04100000
036400 PROCEDURE DIVISION.                                              04110000
036500******************************************************************04120000
036600 0000-PROGRAM-MAINLINE.                                           04130000
036700     MOVE EIBTASKN                 TO  PV-EIBTASKN.               04140000
036800     INITIALIZE                        SU026-CARTON-AUDIT-RECORD. 04150000
036900     MOVE DFHCOMMAREA              TO  SU026-CARTON-AUDIT-RECORD. 04160000
037000                                                                  04170000
037100     MOVE SPACES                   TO PV-CICS-MSG-AREA.           04180000
037200     INITIALIZE PT-MSG-TABLE.                                     04190000
037300     MOVE 1                        TO PT-MSG-SEQ (PT-MSG-IDX).    04200000
037400                                                                  04210000
037500     MOVE SU026-OPER-UNIT-ID       TO DK-OPER-UNT-ID.             04220000
037600     PERFORM 8850-SELECT-TKRPRPM.                                 04230000
037700     STRING ' PS-SHOW-DEBUG-SW= ' PS-SHOW-DEBUG-SW                04240000
037800         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  04250000
037900     PERFORM 9990-WRITE-CICS.                                     04260000
038000                                                                  04270000
038100* RESERVE THE LOG QUEUE FOR THE EXCLUSIVE USE OF THIS TRANSACTION 04280000
038200* TO KEEP OTHER TRANSACTIONS FROM INTERUPTING THE DISPLAY.        04290000
038300* THIS IS DONE ONLY IF THE DEBUGGING FLAG FOR THE DC IS           04300000
038400* SWITCHED ON.  IF AN ERROR OCCURS WHEN THE FLAG IS OFF,          04310000
038500* WE WILL ENQ THE LOG BEFORE DUMPING THE MESSAGE TABLE.           04320000
038600                                                                  04330000
038700     IF PS-SHOW-DEBUG-INFO                                        04340000
038800         EXEC CICS ENQ                                            04350000
038900             RESOURCE(PC-LOG-QUEUE)                               04360000
039000         END-EXEC                                                 04370000
039100     END-IF.                                                      04380000
039200                                                                  04390000
039300     PERFORM 1000-DETERMINE-SUMMARY-DATA.                         04400000
039400                                                                  04410000
039500*-----------------------------------------------------------------04420000
039600*DETERMINE IF AN AUDIT IS NEEDED FOR THIS PO                      04430000
039700*-----------------------------------------------------------------04440000
039800 1000-DETERMINE-SUMMARY-DATA.                                     04450000
039900     STRING ' 1000-DETERMINE-SUMMARY-DATA'                        04460000
040000         DELIMITED BY SIZE                                        04470000
040100         INTO PV-CICS-MSG-AREA.                                   04480000
040200     PERFORM 9990-WRITE-CICS.                                     04490000
040300     MOVE SU026-CARTON-AUDIT-RECORD   TO PV-CICS-MSG-AREA.        04500000
040400     PERFORM 9990-WRITE-CICS.                                     04510000
040500     MOVE SU026-AUDIT-NUMBER          TO DK-AUDIT-CNTL-NBR.       04520000
040600     PERFORM 7000-SELECT-AUDIT-NBR.                               04530000
040700     IF PS-VALID-AUDIT-NBR                                        04540000
040800         MOVE SUT00015-OPER-UNT-ID    TO SU026-OPER-UNIT-ID       04550000
040900         MOVE SUT00015-AUD-UNT-QTY    TO SU026-AUDITED-UNITS      04560000
041000         IF SUT00015-PKGNG-TYP-CDE = 'PS'                         04570002
041100             PERFORM 8900-SUM-UNITS                               04580000
041200             MOVE PV-SUM-SHPD-QTY     TO SU026-TOTAL-UNITS        04590000
041300                                         PV-TOTAL-EXPECTED-UNITS  04600000
041400         ELSE                                                     04610002
041000         IF SUT00015-PKGNG-TYP-CDE = 'RF'                         04620002
041100             PERFORM 8910-SUM-RFID-UNITS                          04630004
041200             MOVE PV-SUM-SHPD-QTY     TO SU026-TOTAL-UNITS        04640002
041300                                         PV-TOTAL-EXPECTED-UNITS  04650002
041400         ELSE                                                     04660000
041500             MOVE SUT00015-UNT-QTY    TO SU026-TOTAL-UNITS        04670000
041600             PERFORM 8900-SUM-UNITS                               04680000
041700             PERFORM 9000-COUNT-CARTONS                           04690000
041800             IF SUT00015-CART-PRMPT-CDE = PC-D OR                 04700000
041900                PV-CARTON-COUNT = 0                               04710000
042000                 MOVE PV-SUM-SHPD-QTY   TO PV-TOTAL-EXPECTED-UNITS04720000
042100             ELSE                                                 04730000
042200                 COMPUTE PV-AVERAGE-UNIT-COUNT =                  04740000
042300                    (PV-SUM-SHPD-QTY /  PV-CARTON-COUNT)          04750000
042400                                                                  04760000
042500                 DIVIDE PV-AVERAGE-UNIT-COUNT INTO                04770000
042600                        SUT00015-UNT-QTY GIVING                   04780000
042700                        PV-AVERAGE-TOTAL-COUNT REMAINDER          04790000
042800                        PV-REMAINDER                              04800000
042900                 IF PV-REMAINDER > 0                              04810000
043000                     COMPUTE PV-AVERAGE-TOTAL-COUNT =             04820000
043100                        PV-AVERAGE-TOTAL-COUNT + 1                04830000
043200                 END-IF                                           04840000
043300                 IF PV-AVERAGE-TOTAL-COUNT > SUT00015-CART-QTY    04850000
043400                     MOVE SUT00015-CART-QTY TO                    04860000
043500                                          PV-AVERAGE-TOTAL-COUNT  04870000
043600                 END-IF                                           04880000
043700                 COMPUTE PV-TOTAL-EXPECTED-UNITS =                04890000
043800                    PV-AVERAGE-UNIT-COUNT                         04900000
043900                           * PV-AVERAGE-TOTAL-COUNT               04910000
044000             END-IF                                               04920000
044100         END-IF.                                                  04930007
040700     IF PS-VALID-AUDIT-NBR                                        04940007
044200         MOVE SUT00015-AUD-CART-QTY   TO SU026-AUDITED-CARTONS    04950000
044300         MOVE SUT00015-CART-QTY       TO SU026-TOTAL-CARTONS      04960000
044400         IF SUT00015-AUD-STAT-CDE = PC-I                          04970000
044500             MOVE 'IN PROC'       TO SU026-AUDIT-STATUS-DESC      04980000
044600         ELSE                                                     04990000
044700             IF SUT00015-AUD-STAT-CDE = PC-N                      05000000
044800                 MOVE 'COMPLET'       TO SU026-AUDIT-STATUS-DESC  05010000
044900             ELSE                                                 05020000
045000                 IF SUT00015-AUD-STAT-CDE = PC-F                  05030000
045100                     MOVE 'FAILED '   TO SU026-AUDIT-STATUS-DESC  05040000
045200                 ELSE                                             05050000
045300                     IF SUT00015-AUD-STAT-CDE = PC-P              05060000
045400                         MOVE 'PASS   '                           05070000
045500                                      TO SU026-AUDIT-STATUS-DESC  05080000
045600                     END-IF                                       05090000
045700                 END-IF                                           05100000
045800             END-IF                                               05110000
045900         END-IF                                                   05120000
046000     END-IF.                                                      05130000
046100     MOVE ZERO                 TO SU026-PICK-ERRORS               05140000
046200                                  SU026-PACK-ERRORS               05150000
046300                                  SU026-TICKET-ERRORS.            05160000
      *11/08/13 DW BEG                                                  05170000
046100     MOVE ZERO                 TO SU026-RFID-ERRORS.              05180000
      *11/08/13 DW END                                                  05190000
046400     IF SU026-COMPLETE                                            05200000
046500         PERFORM 1500-CHECK-FAILED-AUDITS                         05210000
046600         MOVE 'FAILED '       TO SU026-AUDIT-STATUS-DESC          05220000
046700     ELSE                                                         05230000
046800         MOVE SU026-AUDIT-NUMBER                                  05240000
046900                               TO DK-AUD-CNTL-NBR                 05250000
047000         PERFORM 2000-CHECK-VIOLATIONS                            05260000
047100         PERFORM 1700-COUNT-ERRORS                                05270000
047200     END-IF.                                                      05280000
047300     PERFORM 9998-RETURN.                                         05290000
047400                                                                  05300000
047500*-----------------------------------------------------------------05310000
047600 1500-CHECK-FAILED-AUDITS.                                        05320000
047700     MOVE SUT00015-PO-NBR      TO DK-PO-NBR.                      05330000
047800     MOVE SUT00015-PO-PREPK-ID TO DK-PREPK-ID.                    05340000
047900     MOVE SUT00015-PO-LNE-NBR  TO DK-PO-LINE-NBR.                 05350000
048000     SET PS-NOT-END-FAILED-AUDITS TO TRUE.                        05360000
048100     PERFORM 1600-PROCESS-CURSOR.                                 05370000
048200                                                                  05380000
048300 1600-PROCESS-CURSOR.                                             05390000
048400                                                                  05400000
048500     SET PS-NOT-EOC-FAIL-CURSOR TO TRUE.                          05410000
048600     PERFORM 1630-OPEN-CURSOR                                     05420000
048700     PERFORM 1660-FETCH-CURSOR                                    05430000
048800                                                                  05440000
048900     PERFORM UNTIL PS-EOC-FAIL-CURSOR                             05450000
049000         PERFORM 1660-FETCH-CURSOR                                05460000
049100     END-PERFORM.                                                 05470000
049200                                                                  05480000
049300     PERFORM 1690-CLOSE-CURSOR.                                   05490000
049400                                                                  05500000
049500 1630-OPEN-CURSOR.                                                05510000
049600                                                                  05520000
049700     EXEC SQL                                                     05530000
049800         OPEN FAIL-CSR                                            05540000
049900     END-EXEC.                                                    05550000
050000                                                                  05560000
050100     EVALUATE TRUE                                                05570000
050200         WHEN SQLCODE = ZERO                                      05580000
050300             CONTINUE                                             05590000
050400         WHEN SQLWARN0 NOT EQUAL SPACE                            05600000
050500         WHEN SQLCODE NOT EQUAL ZERO                              05610000
050600             MOVE '1630-OPEN-CURSOR'                              05620000
050700                             TO DP013-PARAGRAPH                   05630000
050800             MOVE 'SUKCS594 - OPEN CURSOR'                        05640000
050900                             TO DP013-MESSAGE-TEXT(1)             05650000
051000             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 05660000
051100             STRING 'PO NBR: '         DELIMITED BY SIZE          05670000
051200                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          05680000
051300                           INTO DP013-MESSAGE-TEXT(2)             05690000
051400             MOVE DK-PREPK-ID    TO PV-DISPLAY-PREPK-ID           05700000
051500             STRING 'PRE PACK ID: '    DELIMITED BY SIZE          05710000
051600                PV-DISPLAY-PREPK-ID    DELIMITED BY SIZE          05720000
051700                           INTO DP013-MESSAGE-TEXT(3)             05730000
051800             MOVE DK-PO-LINE-NBR TO PV-DISPLAY-PO-LINE-NBR        05740000
051900             STRING 'PO LINE NBR: '    DELIMITED BY SIZE          05750000
052000                PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE          05760000
052100                           INTO DP013-MESSAGE-TEXT(4)             05770000
052200             MOVE SQLCA      TO DP013-SQLCA                       05780000
052300             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           05790000
052400             SET DP013-DB2-ABEND                                  05800000
052500                             TO TRUE                              05810000
052600             SET DP013-NO-ROLLBACK                                05820000
052700                             TO TRUE                              05830000
052800             PERFORM 9999-WRITE-CICS-LOG-MSG                      05840000
052900     END-EVALUATE.                                                05850000
053000                                                                  05860000
053100 1660-FETCH-CURSOR.                                               05870000
053200                                                                  05880000
053300                                                                  05890000
053400     EXEC SQL                                                     05900000
053500         FETCH FAIL-CSR                                           05910000
053600          INTO   :SUT00015-AUD-CNTL-NBR                           05920000
053700             ,   :SUT00015-OPER-UNT-ID                            05930000
053800     END-EXEC.                                                    05940000
053900                                                                  05950000
054000     EVALUATE TRUE                                                05960000
054100         WHEN SQLCODE = ZERO                                      05970000
054200             MOVE SUT00015-AUD-CNTL-NBR  TO DK-AUD-CNTL-NBR       05980000
054300             MOVE SUT00015-OPER-UNT-ID   TO SU026-OPER-UNIT-ID    05990000
054400             PERFORM 2000-CHECK-VIOLATIONS                        06000000
054500             PERFORM 1700-COUNT-ERRORS                            06010000
054600         WHEN SQLCODE = +100                                      06020000
054700             SET PS-EOC-FAIL-CURSOR   TO TRUE                     06030000
054800         WHEN SQLWARN0 NOT = SPACES                               06040000
054900         WHEN SQLCODE NOT EQUAL ZERO                              06050000
055000             MOVE '1660-FETCH-CURSOR'                             06060000
055100                             TO DP013-PARAGRAPH                   06070000
055200             MOVE 'SUKCS594 - FETCH PP_CURSOR'                    06080000
055300                             TO DP013-MESSAGE-TEXT(1)             06090000
055400             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 06100000
055500             STRING 'PO NBR: '         DELIMITED BY SIZE          06110000
055600                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          06120000
055700                           INTO DP013-MESSAGE-TEXT(2)             06130000
055800             MOVE DK-PREPK-ID    TO PV-DISPLAY-PREPK-ID           06140000
055900             STRING 'PRE PACK ID: '    DELIMITED BY SIZE          06150000
056000                PV-DISPLAY-PREPK-ID    DELIMITED BY SIZE          06160000
056100                           INTO DP013-MESSAGE-TEXT(3)             06170000
056200             MOVE SQLCA      TO DP013-SQLCA                       06180000
056300             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           06190000
056400             SET DP013-DB2-ABEND                                  06200000
056500                             TO TRUE                              06210000
056600             SET DP013-NO-ROLLBACK                                06220000
056700                             TO TRUE                              06230000
056800             PERFORM 9999-WRITE-CICS-LOG-MSG                      06240000
056900     END-EVALUATE.                                                06250000
057000                                                                  06260000
057100 1690-CLOSE-CURSOR.                                               06270000
057200                                                                  06280000
057300     EXEC SQL                                                     06290000
057400         CLOSE FAIL-CSR                                           06300000
057500     END-EXEC.                                                    06310000
057600                                                                  06320000
057700     EVALUATE TRUE                                                06330000
057800         WHEN SQLCODE = ZERO                                      06340000
057900             CONTINUE                                             06350000
058000                                                                  06360000
058100         WHEN SQLWARN0 NOT EQUAL SPACE                            06370000
058200         WHEN SQLCODE NOT EQUAL ZERO                              06380000
058300             MOVE '1690-CLOSE-CURSOR'                             06390000
058400                             TO DP013-PARAGRAPH                   06400000
058500             MOVE 'SUKCS594 - CLOSE PP_CURSOR'                    06410000
058600                             TO DP013-MESSAGE-TEXT(1)             06420000
058700             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 06430000
058800             STRING 'PO NBR: '         DELIMITED BY SIZE          06440000
058900                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          06450000
059000                           INTO DP013-MESSAGE-TEXT(2)             06460000
059100             MOVE DK-PREPK-ID    TO PV-DISPLAY-PREPK-ID           06470000
059200             STRING 'PRE PACK ID: '    DELIMITED BY SIZE          06480000
059300                PV-DISPLAY-PREPK-ID    DELIMITED BY SIZE          06490000
059400                           INTO DP013-MESSAGE-TEXT(3)             06500000
059500             MOVE SQLCA      TO DP013-SQLCA                       06510000
059600             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           06520000
059700             SET DP013-DB2-ABEND                                  06530000
059800                             TO TRUE                              06540000
059900             SET DP013-NO-ROLLBACK                                06550000
060000                             TO TRUE                              06560000
060100             PERFORM 9999-WRITE-CICS-LOG-MSG                      06570000
060200     END-EVALUATE.                                                06580000
060300                                                                  06590000
060400 1700-COUNT-ERRORS.                                               06600000
060500     PERFORM 7200-SUM-TICKET-FAILURES.                            06610000
060600     PERFORM 7300-SELECT-I-PACK-ERRORS.                           06620000
060700     PERFORM 7400-SELECT-PO-STR-ERRORS.                           06630000
060800     MOVE PV-DB2-I-PACK-ERR-COUNT  TO SU026-PACK-ERRORS.          06640000
060900     IF PV-DB2-PO-STR-ERR-COUNT > 0                               06650000
061000         SET SU026-PO-STR-ERROR TO TRUE                           06660000
061100     ELSE                                                         06670000
061200         SET SU026-NO-PO-STR-ERROR TO TRUE                        06680000
061300     END-IF.                                                      06690000
061400     IF PV-DB2-TCKT-ERR-COUNT > 0 AND                             06700000
061500        SU026-AUDITED-UNITS > 0                                   06710000
061600         COMPUTE SU026-TOT-TCKT-ERROR-PCT ROUNDED =               06720000
061700             PV-DB2-TCKT-ERR-COUNT / SU026-AUDITED-UNITS          06730000
061800     ELSE                                                         06740000
061900         MOVE 0          TO SU026-TOT-TCKT-ERROR-PCT              06750000
062000     END-IF.                                                      06760000
062100     IF SU026-TICKET-ERRORS > 0 AND                               06770000
062200        PV-TOTAL-EXPECTED-UNITS > 0                               06780000
062300         COMPUTE SU026-TCKT-ERROR-PCT ROUNDED =                   06790000
062400             SU026-TICKET-ERRORS / PV-TOTAL-EXPECTED-UNITS        06800000
062500     ELSE                                                         06810000
062600         MOVE 0          TO SU026-TCKT-ERROR-PCT                  06820000
062700     END-IF.                                                      06830000
062800     IF SU026-PICK-ERRORS > 0 AND                                 06840000
062900        PV-TOTAL-EXPECTED-UNITS > 0                               06850000
063000         COMPUTE SU026-PICK-ERROR-PCT ROUNDED =                   06860000
063100             SU026-PICK-ERRORS  / PV-TOTAL-EXPECTED-UNITS         06870000
063200     ELSE                                                         06880000
063300         MOVE 0          TO SU026-PICK-ERROR-PCT                  06890000
063400     END-IF.                                                      06900000
063500     COMPUTE SU026-AUDIT-ERROR-PCT ROUNDED =                      06910000
063600             SU026-TCKT-ERROR-PCT + SU026-PICK-ERROR-PCT.         06920000
063700                                                                  06930000
063800******************************************************************06940000
063900* 2000-CHECK-VIOLATIONS. -- GET THE SUM OF THE VIOLATIONS BY TYPE 06950000
064000******************************************************************06960000
064100 2000-CHECK-VIOLATIONS.                                           06970000
064200                                                                  06980000
064300     PERFORM 2100-SUM-PICK-ERRORS.                                06990000
064400     MOVE PV-PICK-ERRORS           TO SU026-PICK-ERRORS.          07000000
064500     PERFORM 2200-COUNT-TICKET-ERRORS.                            07010000
064600     MOVE PV-TOTAL-TICKET-COUNT    TO SU026-TICKET-ERRORS.        07020000
064700     PERFORM 2191-SUM-RFID-ERRORS.                                07030000
           MOVE PV-RFID-ERRORS           TO SU026-RFID-ERRORS.          07040000
064800                                                                  07050000
064900 2100-SUM-PICK-ERRORS.                                            07060000
065000                                                                  07070000
065100     PERFORM 2130-OPEN-PICK-CURSOR.                               07080000
065200     MOVE SPACES                TO PV-SAVE-SCN-TMST.              07090000
065300     PERFORM 2160-FETCH-PICK-CURSOR.                              07100000
065400     PERFORM UNTIL PS-EOC-PICK-CURSOR                             07110000
065500         IF SUEXCP-SCN-TMST NOT = PV-SAVE-SCN-TMST                07120000
065600             ADD PV-DB2-ERROR-COUNT                               07130000
065700                                   TO PV-PICK-ERRORS              07140000
065800             MOVE SUEXCP-SCN-TMST  TO PV-SAVE-SCN-TMST            07150000
065900         END-IF                                                   07160000
066000         PERFORM 2160-FETCH-PICK-CURSOR                           07170000
066100     END-PERFORM.                                                 07180000
066200                                                                  07190000
066300     PERFORM 2190-CLOSE-PICK-CURSOR.                              07200000
066400                                                                  07210000
066500 2130-OPEN-PICK-CURSOR.                                           07220000
066600                                                                  07230000
066700     EXEC SQL                                                     07240000
066800         OPEN PICK_CURSOR                                         07250000
066900     END-EXEC.                                                    07260000
067000                                                                  07270000
067100     EVALUATE TRUE                                                07280000
067200         WHEN SQLCODE = ZERO                                      07290000
067300             SET PS-NOT-EOC-PICK-CURSOR TO TRUE                   07300000
067400                                                                  07310000
067500         WHEN SQLWARN0 NOT = SPACE                                07320000
067600         WHEN SQLCODE < +0                                        07330000
067700         WHEN SQLCODE > +0                                        07340000
067800             MOVE '2130-OPEN-PICK-CURSOR'                         07350000
067900                             TO DP013-PARAGRAPH                   07360000
068000             MOVE 'SUKCS594 - OPEN TICKET CURSOR'                 07370000
068100                             TO DP013-MESSAGE-TEXT (1)            07380000
068200             MOVE DK-AUD-CNTL-NBR  TO PV-DISPLAY-AUDIT-CNTL-NBR   07390000
068300             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          07400000
068400                 PV-DISPLAY-AUDIT-CNTL-NBR                        07410000
068500                                       DELIMITED BY SIZE          07420000
068600                           INTO DP013-MESSAGE-TEXT(2)             07430000
068700             MOVE SQLCA      TO DP013-SQLCA                       07440000
068800             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           07450000
068900             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           07460000
069000             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           07470000
069100             SET DP013-DB2-ABEND                                  07480000
069200                             TO TRUE                              07490000
069300             SET DP013-NO-ROLLBACK                                07500000
069400                             TO TRUE                              07510000
069500             PERFORM 9999-WRITE-CICS-LOG-MSG                      07520000
069600     END-EVALUATE.                                                07530000
069700                                                                  07540000
069800                                                                  07550000
069900******************************************************************07560000
070000* 2160-FETCH-PICK-CURSOR                                         *07570000
070100*  FETCH THE NEXT OCCURANCE OF THE PICK_CURSOR                   *07580000
070200******************************************************************07590000
070300 2160-FETCH-PICK-CURSOR.                                          07600000
070400                                                                  07610000
070500     EXEC SQL                                                     07620000
070600         FETCH PICK_CURSOR                                        07630000
070700         INTO    :SUEXCP-SCN-TMST                                 07640000
070800              ,  :VILNCD-VILN-GP-SEQ-NBR                          07650000
070900              ,  :PV-DB2-ERROR-COUNT                              07660000
071000     END-EXEC.                                                    07670000
071100                                                                  07680000
071200     EVALUATE TRUE                                                07690000
071300         WHEN SQLCODE = ZERO                                      07700000
071400             CONTINUE                                             07710000
071500                                                                  07720000
071600         WHEN SQLCODE = +100                                      07730000
071700             SET PS-EOC-PICK-CURSOR          TO TRUE              07740000
071800                                                                  07750000
071900         WHEN SQLWARN0 NOT = SPACE                                07760000
072000         WHEN SQLCODE < +0                                        07770000
072100         WHEN SQLCODE > +0                                        07780000
072200             MOVE '2160-FETCH-PICK-CURSOR'                        07790000
072300                             TO DP013-PARAGRAPH                   07800000
072400             MOVE 'SUKCS594 - FETCH PICK_CURSOR'                  07810000
072500                             TO DP013-MESSAGE-TEXT (1)            07820000
072600             MOVE DK-AUD-CNTL-NBR  TO PV-DISPLAY-AUDIT-CNTL-NBR   07830000
072700             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          07840000
072800                 PV-DISPLAY-AUDIT-CNTL-NBR                        07850000
072900                                       DELIMITED BY SIZE          07860000
073000                           INTO DP013-MESSAGE-TEXT(2)             07870000
073100             MOVE SQLCA      TO DP013-SQLCA                       07880000
073200             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           07890000
073300             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           07900000
073400             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           07910000
073500             SET DP013-DB2-ABEND                                  07920000
073600                             TO TRUE                              07930000
073700             SET DP013-NO-ROLLBACK                                07940000
073800                             TO TRUE                              07950000
073900             PERFORM 9999-WRITE-CICS-LOG-MSG                      07960000
074000     END-EVALUATE.                                                07970000
074100                                                                  07980000
074200                                                                  07990000
074300******************************************************************08000000
074400* 2190-CLOSE-PICK-CURSOR                                         *08010000
074500*  CLOSE THE PO LINE CURSOR                                      *08020000
074600******************************************************************08030000
074700 2190-CLOSE-PICK-CURSOR.                                          08040000
074800                                                                  08050000
074900     EXEC SQL                                                     08060000
075000         CLOSE PICK_CURSOR                                        08070000
075100     END-EXEC.                                                    08080000
075200                                                                  08090000
075300     EVALUATE TRUE                                                08100000
075400         WHEN SQLCODE = ZERO                                      08110000
075500             CONTINUE                                             08120000
075600                                                                  08130000
075700         WHEN SQLWARN0 NOT = SPACE                                08140000
075800         WHEN SQLCODE < +0                                        08150000
075900         WHEN SQLCODE > +0                                        08160000
076000             MOVE '2190-CLOSE-PICK-CURSOR'                        08170000
076100                             TO DP013-PARAGRAPH                   08180000
076200             MOVE 'SUKCS594 - CLOSE PICK_CURSOR'                  08190000
076300                             TO DP013-MESSAGE-TEXT (1)            08200000
076400             MOVE DK-AUD-CNTL-NBR  TO PV-DISPLAY-AUDIT-CNTL-NBR   08210000
076500             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          08220000
076600                 PV-DISPLAY-AUDIT-CNTL-NBR                        08230000
076700                                       DELIMITED BY SIZE          08240000
076800                           INTO DP013-MESSAGE-TEXT(2)             08250000
076900             MOVE SQLCA      TO DP013-SQLCA                       08260000
077000             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           08270000
077100             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           08280000
077200             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           08290000
077300             SET DP013-DB2-ABEND                                  08300000
077400                             TO TRUE                              08310000
077500             SET DP013-NO-ROLLBACK                                08320000
077600                             TO TRUE                              08330000
077700             PERFORM 9999-WRITE-CICS-LOG-MSG                      08340000
077800     END-EVALUATE.                                                08350000
077900                                                                  08360000
      *11/08/13 DW BEG                                                  08370000
064800                                                                  08380000
064900 2191-SUM-RFID-ERRORS.                                            08390000
065000                                                                  08400000
065100     PERFORM 2193-OPEN-RFID-CURSOR.                               08410000
065200     MOVE SPACES                   TO PV-SAVE-SCN-TMST.           08420000
065300     PERFORM 2195-FETCH-RFID-CURSOR.                              08430000
065400     PERFORM UNTIL PS-EOC-RFID-CURSOR                             08440000
065500         IF SUEXCP-SCN-TMST NOT = PV-SAVE-SCN-TMST                08450000
065600             ADD PV-DB2-ERROR-COUNT                               08460000
065700                                   TO PV-RFID-ERRORS              08470000
065800             MOVE SUEXCP-SCN-TMST  TO PV-SAVE-SCN-TMST            08480000
065900         END-IF                                                   08490000
066000         PERFORM 2195-FETCH-RFID-CURSOR                           08500000
066100     END-PERFORM.                                                 08510000
066200                                                                  08520000
066300     PERFORM 2197-CLOSE-RFID-CURSOR.                              08530000
066400                                                                  08540000
066500 2193-OPEN-RFID-CURSOR.                                           08550000
066600                                                                  08560000
066700     EXEC SQL                                                     08570000
066800         OPEN RFID_CURSOR                                         08580000
066900     END-EXEC.                                                    08590000
067000                                                                  08600000
067100     EVALUATE TRUE                                                08610000
067200         WHEN SQLCODE = ZERO                                      08620000
067300             SET PS-NOT-EOC-RFID-CURSOR TO TRUE                   08630000
067400                                                                  08640000
067500         WHEN SQLWARN0 NOT = SPACE                                08650000
067600         WHEN SQLCODE < +0                                        08660000
067700         WHEN SQLCODE > +0                                        08670000
067800             MOVE '2193-OPEN-RFID-CURSOR'                         08680000
067900                             TO DP013-PARAGRAPH                   08690000
068000             MOVE 'SUKCS594 - OPEN RFID CURSOR'                   08700000
068100                             TO DP013-MESSAGE-TEXT (1)            08710000
068200             MOVE DK-AUD-CNTL-NBR  TO PV-DISPLAY-AUDIT-CNTL-NBR   08720000
068300             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          08730000
068400                 PV-DISPLAY-AUDIT-CNTL-NBR                        08740000
068500                                       DELIMITED BY SIZE          08750000
068600                           INTO DP013-MESSAGE-TEXT(2)             08760000
068700             MOVE SQLCA      TO DP013-SQLCA                       08770000
068800             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           08780000
068900             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           08790000
069000             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           08800000
069100             SET DP013-DB2-ABEND                                  08810000
069200                             TO TRUE                              08820000
069300             SET DP013-NO-ROLLBACK                                08830000
069400                             TO TRUE                              08840000
069500             PERFORM 9999-WRITE-CICS-LOG-MSG                      08850000
069600     END-EVALUATE.                                                08860000
069800                                                                  08870000
069900******************************************************************08880000
070000* 2195-FETCH-RFID-CURSOR                                         *08890000
070100*  FETCH THE NEXT OCCURANCE OF THE RFID_CURSOR                   *08900000
070200******************************************************************08910000
070300 2195-FETCH-RFID-CURSOR.                                          08920000
070400                                                                  08930000
070500     EXEC SQL                                                     08940000
070600         FETCH RFID_CURSOR                                        08950000
070700         INTO    :SUEXCP-SCN-TMST                                 08960000
070800              ,  :VILNCD-VILN-GP-SEQ-NBR                          08970000
070900              ,  :PV-DB2-ERROR-COUNT                              08980000
071000     END-EXEC.                                                    08990000
071100                                                                  09000000
071200     EVALUATE TRUE                                                09010000
071300         WHEN SQLCODE = ZERO                                      09020000
071400             CONTINUE                                             09030000
071500                                                                  09040000
071600         WHEN SQLCODE = +100                                      09050000
071700             SET PS-EOC-RFID-CURSOR          TO TRUE              09060000
071800                                                                  09070000
071900         WHEN SQLWARN0 NOT = SPACE                                09080000
072000         WHEN SQLCODE < +0                                        09090000
072100         WHEN SQLCODE > +0                                        09100000
072200             MOVE '2195-FETCH-RFID-CURSOR'                        09110000
072300                             TO DP013-PARAGRAPH                   09120000
072400             MOVE 'SUKCS594 - FETCH RFID_CURSOR'                  09130000
072500                             TO DP013-MESSAGE-TEXT (1)            09140000
072600             MOVE DK-AUD-CNTL-NBR  TO PV-DISPLAY-AUDIT-CNTL-NBR   09150000
072700             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          09160000
072800                 PV-DISPLAY-AUDIT-CNTL-NBR                        09170000
072900                                       DELIMITED BY SIZE          09180000
073000                           INTO DP013-MESSAGE-TEXT(2)             09190000
073100             MOVE SQLCA      TO DP013-SQLCA                       09200000
073200             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           09210000
073300             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           09220000
073400             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           09230000
073500             SET DP013-DB2-ABEND                                  09240000
073600                             TO TRUE                              09250000
073700             SET DP013-NO-ROLLBACK                                09260000
073800                             TO TRUE                              09270000
073900             PERFORM 9999-WRITE-CICS-LOG-MSG                      09280000
074000     END-EVALUATE.                                                09290000
074200                                                                  09300000
074300******************************************************************09310000
074400* 2197-CLOSE-RFID-CURSOR                                         *09320000
074500*  CLOSE THE PO LINE CURSOR                                      *09330000
074600******************************************************************09340000
074700 2197-CLOSE-RFID-CURSOR.                                          09350000
074800                                                                  09360000
074900     EXEC SQL                                                     09370000
075000         CLOSE RFID_CURSOR                                        09380000
075100     END-EXEC.                                                    09390000
075200                                                                  09400000
075300     EVALUATE TRUE                                                09410000
075400         WHEN SQLCODE = ZERO                                      09420000
075500             CONTINUE                                             09430000
075600                                                                  09440000
075700         WHEN SQLWARN0 NOT = SPACE                                09450000
075800         WHEN SQLCODE < +0                                        09460000
075900         WHEN SQLCODE > +0                                        09470000
076000             MOVE '2197-CLOSE-RFID-CURSOR'                        09480000
076100                             TO DP013-PARAGRAPH                   09490000
076200             MOVE 'SUKCS594 - CLOSE PICK_CURSOR'                  09500000
076300                             TO DP013-MESSAGE-TEXT (1)            09510000
076400             MOVE DK-AUD-CNTL-NBR  TO PV-DISPLAY-AUDIT-CNTL-NBR   09520000
076500             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          09530000
076600                 PV-DISPLAY-AUDIT-CNTL-NBR                        09540000
076700                                       DELIMITED BY SIZE          09550000
076800                           INTO DP013-MESSAGE-TEXT(2)             09560000
076900             MOVE SQLCA      TO DP013-SQLCA                       09570000
077000             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           09580000
077100             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           09590000
077200             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           09600000
077300             SET DP013-DB2-ABEND                                  09610000
077400                             TO TRUE                              09620000
077500             SET DP013-NO-ROLLBACK                                09630000
077600                             TO TRUE                              09640000
077700             PERFORM 9999-WRITE-CICS-LOG-MSG                      09650000
077800     END-EVALUATE.                                                09660000
      *11/08/13 DW END                                                  09670000
077900                                                                  09680000
078000 2200-COUNT-TICKET-ERRORS.                                        09690000
078100                                                                  09700000
078200     PERFORM 2230-OPEN-TICKET-CURSOR                              09710000
078300     PERFORM 2260-FETCH-TICKET-CURSOR                             09720000
078400     MOVE 0                     TO PV-HOLD-UPC-NBR                09730000
078500                                   PV-TOTAL-TICKET-COUNT          09740000
078600     PERFORM UNTIL PS-EOC-TICKET-CURSOR                           09750000
078700**   THE ITEMS FROM THE CURSOR ARE IN UPC, TICKET-COUNT (DESC)    09760000
078800**   ORDER, THEREFORE ONLY THE FIRST FETCH FOR THE UPC IS ADDED   09770000
078900         IF SUAUPC-UPC-NBR NOT = PV-HOLD-UPC-NBR                  09780000
079000             ADD  PV-DB2-TICKET-COUNT   TO PV-TOTAL-TICKET-COUNT  09790000
079100             MOVE SUAUPC-UPC-NBR TO  PV-HOLD-UPC-NBR              09800000
079200         END-IF                                                   09810000
079300         PERFORM 2260-FETCH-TICKET-CURSOR                         09820000
079400     END-PERFORM.                                                 09830000
079500                                                                  09840000
079600     PERFORM 2290-CLOSE-TICKET-CURSOR.                            09850000
079700                                                                  09860000
079800 2230-OPEN-TICKET-CURSOR.                                         09870000
079900                                                                  09880000
080000     EXEC SQL                                                     09890000
080100         OPEN TICKET_CURSOR                                       09900000
080200     END-EXEC.                                                    09910000
080300                                                                  09920000
080400     EVALUATE TRUE                                                09930000
080500         WHEN SQLCODE = ZERO                                      09940000
080600             SET PS-NOT-EOC-TICKET-CURSOR TO TRUE                 09950000
080700                                                                  09960000
080800         WHEN SQLWARN0 NOT = SPACE                                09970000
080900         WHEN SQLCODE < +0                                        09980000
081000         WHEN SQLCODE > +0                                        09990000
081100             MOVE '2230-OPEN-TICKET-CURSOR'                       10000000
081200                             TO DP013-PARAGRAPH                   10010000
081300             MOVE 'SUKCS594 - OPEN TICKET CURSOR'                 10020000
081400                             TO DP013-MESSAGE-TEXT (1)            10030000
081500             MOVE DK-AUD-CNTL-NBR  TO PV-DISPLAY-AUDIT-CNTL-NBR   10040000
081600             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          10050000
081700                 PV-DISPLAY-AUDIT-CNTL-NBR                        10060000
081800                                       DELIMITED BY SIZE          10070000
081900                           INTO DP013-MESSAGE-TEXT(2)             10080000
082000             MOVE SQLCA      TO DP013-SQLCA                       10090000
082100             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           10100000
082200             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           10110000
082300             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           10120000
082400             SET DP013-DB2-ABEND                                  10130000
082500                             TO TRUE                              10140000
082600             SET DP013-NO-ROLLBACK                                10150000
082700                             TO TRUE                              10160000
082800             PERFORM 9999-WRITE-CICS-LOG-MSG                      10170000
082900     END-EVALUATE.                                                10180000
083000                                                                  10190000
083100                                                                  10200000
083200******************************************************************10210000
083300* 2260-FETCH-TICKET-CURSOR                                       *10220000
083400*  FETCH THE NEXT OCCURANCE OF THE TICKET_CURSOR                 *10230000
083500******************************************************************10240000
083600 2260-FETCH-TICKET-CURSOR.                                        10250000
083700                                                                  10260000
083800     EXEC SQL                                                     10270000
083900         FETCH TICKET_CURSOR                                      10280000
084000         INTO    :SUAUPC-UPC-NBR                                  10290000
084100              ,  :SUEXCP-VILN-GP-SEQ-NBR                          10300000
084200               , :PV-DB2-TICKET-COUNT                             10310000
084300     END-EXEC.                                                    10320000
084400                                                                  10330000
084500     EVALUATE TRUE                                                10340000
084600         WHEN SQLCODE = ZERO                                      10350000
084700             CONTINUE                                             10360000
084800                                                                  10370000
084900         WHEN SQLCODE = +100                                      10380000
085000             SET PS-EOC-TICKET-CURSOR        TO TRUE              10390000
085100                                                                  10400000
085200         WHEN SQLWARN0 NOT = SPACE                                10410000
085300         WHEN SQLCODE < +0                                        10420000
085400         WHEN SQLCODE > +0                                        10430000
085500             MOVE '2260-FETCH-TICKET-CURSOR'                      10440000
085600                             TO DP013-PARAGRAPH                   10450000
085700             MOVE 'SUKCS594 - FETCH TICKET_CURSOR'                10460000
085800                             TO DP013-MESSAGE-TEXT (1)            10470000
085900             MOVE DK-AUD-CNTL-NBR  TO PV-DISPLAY-AUDIT-CNTL-NBR   10480000
086000             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          10490000
086100                 PV-DISPLAY-AUDIT-CNTL-NBR                        10500000
086200                                       DELIMITED BY SIZE          10510000
086300                           INTO DP013-MESSAGE-TEXT(2)             10520000
086400             MOVE SQLCA      TO DP013-SQLCA                       10530000
086500             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           10540000
086600             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           10550000
086700             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           10560000
086800             SET DP013-DB2-ABEND                                  10570000
086900                             TO TRUE                              10580000
087000             SET DP013-NO-ROLLBACK                                10590000
087100                             TO TRUE                              10600000
087200             PERFORM 9999-WRITE-CICS-LOG-MSG                      10610000
087300     END-EVALUATE.                                                10620000
087400                                                                  10630000
087500                                                                  10640000
087600******************************************************************10650000
087700* 2290-CLOSE-TICKET-CURSOR                                       *10660000
087800*  CLOSE THE PO LINE CURSOR                                      *10670000
087900******************************************************************10680000
088000 2290-CLOSE-TICKET-CURSOR.                                        10690000
088100                                                                  10700000
088200     EXEC SQL                                                     10710000
088300         CLOSE TICKET_CURSOR                                      10720000
088400     END-EXEC.                                                    10730000
088500                                                                  10740000
088600     EVALUATE TRUE                                                10750000
088700         WHEN SQLCODE = ZERO                                      10760000
088800             CONTINUE                                             10770000
088900                                                                  10780000
089000         WHEN SQLWARN0 NOT = SPACE                                10790000
089100         WHEN SQLCODE < +0                                        10800000
089200         WHEN SQLCODE > +0                                        10810000
089300             MOVE '2290-CLOSE-TICKET-CURSOR'                      10820000
089400                             TO DP013-PARAGRAPH                   10830000
089500             MOVE 'SUKCS594 - CLOSE TICKET_CURSOR'                10840000
089600                             TO DP013-MESSAGE-TEXT (1)            10850000
089700             MOVE DK-AUD-CNTL-NBR  TO PV-DISPLAY-AUDIT-CNTL-NBR   10860000
089800             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          10870000
089900                 PV-DISPLAY-AUDIT-CNTL-NBR                        10880000
090000                                       DELIMITED BY SIZE          10890000
090100                           INTO DP013-MESSAGE-TEXT(2)             10900000
090200             MOVE SQLCA      TO DP013-SQLCA                       10910000
090300             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           10920000
090400             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           10930000
090500             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           10940000
090600             SET DP013-DB2-ABEND                                  10950000
090700                             TO TRUE                              10960000
090800             SET DP013-NO-ROLLBACK                                10970000
090900                             TO TRUE                              10980000
091000             PERFORM 9999-WRITE-CICS-LOG-MSG                      10990000
091100     END-EVALUATE.                                                11000000
091200*                                                                 11010000
091300 7000-SELECT-AUDIT-NBR.                                           11020000
091400                                                                  11030000
091500     MOVE SU026-AUDIT-NUMBER       TO DK-AUDIT-CNTL-NBR.          11040000
091600                                                                  11050000
091700     EXEC SQL                                                     11060000
091800       SELECT PO_NBR                                              11070000
091900           ,  PO_LNE_NBR                                          11080000
092000           ,  PO_PREPK_ID                                         11090000
092100           ,  OPER_UNT_ID                                         11100000
092200           ,  CART_QTY                                            11110000
092300           ,  UNT_QTY                                             11120000
092400           ,  AUD_CART_QTY                                        11130000
092500           ,  AUD_UNT_QTY                                         11140000
092600           ,  AUD_STAT_CDE                                        11150000
092700           ,  CART_PRMPT_CDE                                      11160000
092800           ,  A.PKGNG_TYP_CDE                                     11170000
092900           ,  DAYS(CURRENT DATE) - (B.CK_AFT_DAY_QTY + 1)         11180000
093000       INTO   :SUT00015-PO-NBR                                    11190000
093100           ,  :SUT00015-PO-LNE-NBR                                11200000
093200           ,  :SUT00015-PO-PREPK-ID                               11210000
093300           ,  :SUT00015-OPER-UNT-ID                               11220000
093400           ,  :SUT00015-CART-QTY                                  11230000
093500           ,  :SUT00015-UNT-QTY                                   11240000
093600           ,  :SUT00015-AUD-CART-QTY                              11250000
093700           ,  :SUT00015-AUD-UNT-QTY                               11260000
093800           ,  :SUT00015-AUD-STAT-CDE                              11270000
093900           ,  :SUT00015-CART-PRMPT-CDE                            11280000
094000           ,  :SUT00015-PKGNG-TYP-CDE                             11290000
094100           ,  :PV-LIMIT-DAYS                                      11300000
094200       FROM   SUT_PO_AUD_REQ  A                                   11310000
094300           ,  SUT_PO_AUD_PARM B                                   11320000
094400       WHERE  A.AUD_CNTL_NBR  = :DK-AUDIT-CNTL-NBR                11330000
094500         AND  A.VND_RNKG_CDE  = B.VND_RNKG_CDE                    11340000
094600         AND  A.PKGNG_TYP_CDE = B.PKGNG_TYP_CDE                   11350000
094700         AND  A.EFF_BEG_TMST  = B.EFF_BEG_TMST                    11360000
094800     END-EXEC.                                                    11370000
094900                                                                  11380000
095000     EVALUATE TRUE                                                11390000
095100         WHEN SQLCODE = ZERO                                      11400000
095200             SET PS-VALID-AUDIT-NBR TO TRUE                       11410000
095300         WHEN SQLCODE = +100                                      11420000
095400             SET PS-INVALID-AUDIT-NBR TO TRUE                     11430000
095500         WHEN SQLWARN0 NOT = SPACES                               11440000
095600         WHEN SQLCODE NOT EQUAL ZERO                              11450000
095700             MOVE '7000-SELECT-AUDIT-NBR'                         11460000
095800                             TO DP013-PARAGRAPH                   11470000
095900             MOVE 'RETRIEVE AUDIT INFO '                          11480000
096000                             TO DP013-MESSAGE-TEXT(1)             11490000
096100             MOVE DK-AUDIT-CNTL-NBR TO PV-DISPLAY-AUDIT-CNTL-NBR  11500000
096200             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          11510000
096300                 PV-DISPLAY-AUDIT-CNTL-NBR                        11520000
096400                                       DELIMITED BY SIZE          11530000
096500                           INTO DP013-MESSAGE-TEXT(2)             11540000
096600             MOVE SQLCA      TO DP013-SQLCA                       11550000
096700             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           11560000
096800             MOVE 'SUT00017' TO DP013-DB2-TABLE-NAME(2)           11570000
096900             SET DP013-DB2-ABEND   TO TRUE                        11580000
097000             SET DP013-NO-ROLLBACK TO TRUE                        11590000
097100             PERFORM 9999-WRITE-CICS-LOG-MSG                      11600000
097200     END-EVALUATE.                                                11610000
097300                                                                  11620000
097400 7100-SELECT-TSUNAUD.                                             11630000
097500                                                                  11640000
097600     INITIALIZE DCLTSUNAUD.                                       11650000
097700                                                                  11660000
097800     EXEC SQL                                                     11670000
097900         SELECT  AUD_STAT_CDE                                     11680000
098000              ,  PRC_FCLTY_AREA_ID                                11690000
098100           INTO  :SUNAUD-AUD-STAT-CDE                             11700000
098200             ,   :SUNAUD-PRC-FCLTY-AREA-ID                        11710000
098300           FROM  TSUNAUD                                          11720000
098400          WHERE  AUD_CNTL_NBR      =  :DK-AUDIT-CNTL-NBR          11730000
098500     END-EXEC.                                                    11740000
098600                                                                  11750000
098700     EVALUATE TRUE                                                11760000
098800         WHEN SQLCODE = ZERO                                      11770000
098900             CONTINUE                                             11780000
099000         WHEN SQLWARN0 NOT = SPACES                               11790000
099100         WHEN SQLCODE < ZERO                                      11800000
099200         WHEN SQLCODE > ZERO                                      11810000
099300             MOVE '7100-SELECT-TSUNAUD'                           11820000
099400                 TO DP013-PARAGRAPH                               11830000
099500             MOVE 'SELECT OF TSUNAUD TABLE'                       11840000
099600                 TO DP013-MESSAGE-TEXT (1)                        11850000
099700             MOVE DK-AUDIT-CNTL-NBR  TO PV-DISPLAY-AUDIT-CNTL-NBR 11860000
099800             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          11870000
099900                 PV-DISPLAY-AUDIT-CNTL-NBR                        11880000
100000                                       DELIMITED BY SIZE          11890000
100100                           INTO DP013-MESSAGE-TEXT(2)             11900000
100200             MOVE SQLCA            TO DP013-SQLCA                 11910000
100300             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    11920000
100400             SET DP013-DB2-ABEND   TO TRUE                        11930000
100500             SET DP013-NO-ROLLBACK TO TRUE                        11940000
100600             PERFORM 9999-WRITE-CICS-LOG-MSG                      11950000
100700     END-EVALUATE.                                                11960000
100800                                                                  11970000
100900 7200-SUM-TICKET-FAILURES.                                        11980000
101000     EXEC SQL                                                     11990000
101100         SELECT COUNT (DISTINCT C.UPC_NBR)                        12000000
101200         INTO  :PV-DB2-TCKT-ERR-COUNT                             12010000
101300         FROM    TSUATRN A                                        12020000
101400              ,  TSUAUPC B                                        12030000
101500              ,  TSUEXCP C                                        12040000
101600              ,  TVILNCD D                                        12050000
101700         WHERE                                                    12060000
101800             A.AUD_CNTL_NBR       = :DK-AUD-CNTL-NBR              12070000
101900         AND A.AUD_CNTL_NBR       = B.AUD_CNTL_NBR                12080000
102000         AND A.SHIPT_UNT_ID       = B.SHIPT_UNT_ID                12090000
102100         AND B.AUD_CNTL_NBR       = C.AUD_CNTL_NBR                12100000
102200         AND B.SCN_TMST           = C.SCN_TMST                    12110000
102300         AND D.VILN_GP_CDE        = 'VA'                          12120000
102400         AND D.FALR_IND           = 'Y'                           12130000
102500         AND D.VILN_CTG_CDE       = :PC-TICKET                    12140000
102600         AND C.VILN_GP_CDE        = D.VILN_GP_CDE                 12150000
102700         AND C.VILN_GP_SEQ_NBR    = D.VILN_GP_SEQ_NBR             12160000
102800     END-EXEC.                                                    12170000
102900                                                                  12180000
103000     EVALUATE TRUE                                                12190000
103100         WHEN SQLCODE = ZERO                                      12200000
103200             CONTINUE                                             12210000
103300         WHEN SQLWARN0 NOT = SPACES                               12220000
103400         WHEN SQLCODE < ZERO                                      12230000
103500         WHEN SQLCODE > ZERO                                      12240000
103600             MOVE '7200-SUM-TICKET-FAILURES'                      12250000
103700                 TO DP013-PARAGRAPH                               12260000
103800             MOVE 'SUM OF TICKET FAILURES'                        12270000
103900                 TO DP013-MESSAGE-TEXT (1)                        12280000
104000             MOVE DK-AUD-CNTL-NBR  TO PV-DISPLAY-AUDIT-CNTL-NBR   12290000
104100             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          12300000
104200                 PV-DISPLAY-AUDIT-CNTL-NBR                        12310000
104300                                       DELIMITED BY SIZE          12320000
104400                           INTO DP013-MESSAGE-TEXT(2)             12330000
104500             MOVE SQLCA            TO DP013-SQLCA                 12340000
104600             MOVE 'TSUEXCP'        TO DP013-DB2-TABLE-NAME (1)    12350000
104700             MOVE 'TVILNCD'        TO DP013-DB2-TABLE-NAME (2)    12360000
104800             SET DP013-DB2-ABEND   TO TRUE                        12370000
104900             SET DP013-NO-ROLLBACK TO TRUE                        12380000
105000             PERFORM 9999-WRITE-CICS-LOG-MSG                      12390000
105100     END-EVALUATE.                                                12400000
105200                                                                  12410000
105300                                                                  12420000
105400 7300-SELECT-I-PACK-ERRORS.                                       12430000
105500                                                                  12440000
105600     EXEC SQL                                                     12450000
105700         SELECT COUNT (DISTINCT B.SHIPT_UNT_ID)                   12460000
105800         INTO  :PV-DB2-I-PACK-ERR-COUNT                           12470000
105900         FROM    TSUATRN A                                        12480000
106000              ,  TCTEXCP B                                        12490000
106100              ,  TVILNCD C                                        12500000
106200         WHERE                                                    12510000
106300             A.AUD_CNTL_NBR       = :DK-AUD-CNTL-NBR              12520000
106400         AND A.AUD_CNTL_NBR       = B.AUD_CNTL_NBR                12530000
106500         AND A.SHIPT_UNT_ID       = B.SHIPT_UNT_ID                12540000
106600         AND C.VILN_GP_CDE        = 'VA'                          12550000
106700         AND C.FALR_IND           = 'Y'                           12560000
106800         AND C.VILN_CTG_CDE       = :PC-PACKING                   12570000
106900         AND B.VILN_GP_CDE        = C.VILN_GP_CDE                 12580000
107000         AND B.VILN_GP_SEQ_NBR    = C.VILN_GP_SEQ_NBR             12590000
107100     END-EXEC.                                                    12600000
107200                                                                  12610000
107300     EVALUATE TRUE                                                12620000
107400         WHEN SQLCODE = ZERO                                      12630000
107500             CONTINUE                                             12640000
107600         WHEN SQLWARN0 NOT = SPACES                               12650000
107700         WHEN SQLCODE < ZERO                                      12660000
107800         WHEN SQLCODE > ZERO                                      12670000
107900             MOVE '7300-SELECT-I-PACK-ERRORS'                     12680000
108000                 TO DP013-PARAGRAPH                               12690000
108100             MOVE 'SUM OF I PACK ERRORS'                          12700000
108200                 TO DP013-MESSAGE-TEXT (1)                        12710000
108300             MOVE DK-AUD-CNTL-NBR  TO PV-DISPLAY-AUDIT-CNTL-NBR   12720000
108400             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          12730000
108500                 PV-DISPLAY-AUDIT-CNTL-NBR                        12740000
108600                                       DELIMITED BY SIZE          12750000
108700                           INTO DP013-MESSAGE-TEXT(2)             12760000
108800             MOVE SQLCA            TO DP013-SQLCA                 12770000
108900             MOVE 'TCTEXCP'        TO DP013-DB2-TABLE-NAME (1)    12780000
109000             MOVE 'TVILNCD'        TO DP013-DB2-TABLE-NAME (2)    12790000
109100             SET DP013-DB2-ABEND   TO TRUE                        12800000
109200             SET DP013-NO-ROLLBACK TO TRUE                        12810000
109300             PERFORM 9999-WRITE-CICS-LOG-MSG                      12820000
109400     END-EVALUATE.                                                12830000
109500                                                                  12840000
109600 7400-SELECT-PO-STR-ERRORS.                                       12850000
109700                                                                  12860000
109800     EXEC SQL                                                     12870000
109900         SELECT COUNT (DISTINCT B.SHIPT_UNT_ID)                   12880000
110000         INTO  :PV-DB2-PO-STR-ERR-COUNT                           12890000
110100         FROM    TSUATRN A                                        12900000
110200              ,  TCTEXCP B                                        12910000
110300              ,  TVILNCD C                                        12920000
110400         WHERE                                                    12930000
110500             A.AUD_CNTL_NBR       = :DK-AUD-CNTL-NBR              12940000
110600         AND A.AUD_CNTL_NBR       = B.AUD_CNTL_NBR                12950000
110700         AND A.SHIPT_UNT_ID       = B.SHIPT_UNT_ID                12960000
110800         AND C.VILN_GP_CDE        = 'VA'                          12970000
110900         AND C.FALR_IND           = 'Y'                           12980000
111000         AND C.VILN_CTG_CDE       = ' '                           12990000
111100         AND B.VILN_GP_CDE        = C.VILN_GP_CDE                 13000000
111200         AND B.VILN_GP_SEQ_NBR    = C.VILN_GP_SEQ_NBR             13010000
111300     END-EXEC.                                                    13020000
111400                                                                  13030000
111500     EVALUATE TRUE                                                13040000
111600         WHEN SQLCODE = ZERO                                      13050000
111700             CONTINUE                                             13060000
111800         WHEN SQLWARN0 NOT = SPACES                               13070000
111900         WHEN SQLCODE < ZERO                                      13080000
112000         WHEN SQLCODE > ZERO                                      13090000
112100             MOVE '7400-SELECT-PO-STR-ERRORS'                     13100000
112200                 TO DP013-PARAGRAPH                               13110000
112300             MOVE 'SUM OF PO/STORE ERRORS'                        13120000
112400                 TO DP013-MESSAGE-TEXT (1)                        13130000
112500             MOVE DK-AUD-CNTL-NBR  TO PV-DISPLAY-AUDIT-CNTL-NBR   13140000
112600             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          13150000
112700                 PV-DISPLAY-AUDIT-CNTL-NBR                        13160000
112800                                       DELIMITED BY SIZE          13170000
112900                           INTO DP013-MESSAGE-TEXT(2)             13180000
113000             MOVE SQLCA            TO DP013-SQLCA                 13190000
113100             MOVE 'TCTEXCP'        TO DP013-DB2-TABLE-NAME (1)    13200000
113200             MOVE 'TVILNCD'        TO DP013-DB2-TABLE-NAME (2)    13210000
113300             SET DP013-DB2-ABEND   TO TRUE                        13220000
113400             SET DP013-NO-ROLLBACK TO TRUE                        13230000
113500             PERFORM 9999-WRITE-CICS-LOG-MSG                      13240000
113600     END-EVALUATE.                                                13250000
113700                                                                  13260000
113800*                                                                 13270000
113900 8850-SELECT-TKRPRPM.                                             13280000
114000                                                                  13290000
114100     STRING ' 8850-SELECT-TKRPRPM'                                13300000
114200         DELIMITED BY SIZE                                        13310000
114300         INTO PV-CICS-MSG-AREA.                                   13320000
114400     PERFORM 9990-WRITE-CICS.                                     13330000
114500                                                                  13340000
114600     EXEC SQL                                                     13350000
114700          SELECT FUNC_TXT                                         13360000
114800            INTO :KRPRPM-FUNC-TXT                                 13370000
114900            FROM TKRPRPM                                          13380000
115000           WHERE LOC_ID            = :DK-OPER-UNT-ID              13390000
115100             AND INTFC_SYS_CDE    = 'AUD'                         13400000
115200             AND SYS_PRC_FUNC_CDE = 'DMPAUD'                      13410000
115300             AND FUNC_PRC_STAT_CDE = 'AC'                         13420000
115400     END-EXEC.                                                    13430000
115500                                                                  13440000
115600     EVALUATE TRUE                                                13450000
115700         WHEN SQLCODE = ZERO                                      13460000
115800             IF KRPRPM-FUNC-TXT = 'Y'                             13470000
115900                 SET PS-SHOW-DEBUG-INFO                           13480000
116000                                      TO TRUE                     13490000
116100             ELSE                                                 13500000
116200                 SET PS-DONT-SHOW-DEBUG-INFO                      13510000
116300                                      TO TRUE                     13520000
116400             END-IF                                               13530000
116500         WHEN SQLWARN0 NOT = SPACES                               13540000
116600         WHEN SQLCODE NOT EQUAL ZERO                              13550000
116700             MOVE '8850-SELECT-TKRPRPM'                           13560000
116800                             TO DP013-PARAGRAPH                   13570000
116900             MOVE DK-OPER-UNT-ID TO PV-DISPLAY-OPER-UNT-ID        13580000
117000             STRING 'OPER UNIT: '      DELIMITED BY SIZE          13590000
117100                PV-DISPLAY-OPER-UNT-ID DELIMITED BY SIZE          13600000
117200                           INTO DP013-MESSAGE-TEXT(1)             13610000
117300             MOVE SQLCA      TO DP013-SQLCA                       13620000
117400             MOVE 'TKRPRPM ' TO DP013-DB2-TABLE-NAME(1)           13630000
117500             SET DP013-DB2-ABEND                                  13640000
117600                             TO TRUE                              13650000
117700             SET DP013-NO-ROLLBACK                                13660000
117800                             TO TRUE                              13670000
117900             PERFORM 9999-WRITE-CICS-LOG-MSG                      13680000
118000             SET PS-DUMP-TO-LOG       TO TRUE                     13690000
118100             SET SU026-DB2-ERROR TO TRUE                          13700000
118200     END-EVALUATE.                                                13710000
118300                                                                  13720000
118400                                                                  13730000
118500 8900-SUM-UNITS.                                                  13740000
118600     EXEC SQL                                                     13750000
118700             SELECT                                               13760000
118800                 SUM(B.SHPD_QTY)                                  13770000
118900             INTO                                                 13780000
119000                  :PV-SUM-SHPD-QTY                                13790000
119100             FROM TSUATRN A                                       13800000
119200              ,   TSHUUPC B                                       13810000
119300         WHERE                                                    13820000
119400                A.AUD_CNTL_NBR   = :DK-AUDIT-CNTL-NBR             13830000
119500           AND  A.SHIPT_UNT_ID   = B.SHIPT_UNT_ID                 13840000
119600     END-EXEC.                                                    13850000
119700                                                                  13860000
119800     EVALUATE TRUE                                                13870000
119900         WHEN SQLCODE = ZERO                                      13880000
120000             CONTINUE                                             13890000
120100         WHEN SQLCODE = +100                                      13900000
120200             MOVE 0      TO PV-SUM-SHPD-QTY                       13910000
120300         WHEN SQLWARN0 NOT = SPACES                               13920000
120400         WHEN SQLCODE NOT EQUAL ZERO                              13930000
120500             MOVE '8900-SUM-UNITS'                                13940000
120600                             TO DP013-PARAGRAPH                   13950000
120700             MOVE DK-AUDIT-CNTL-NBR TO PV-DISPLAY-AUDIT-CNTL-NBR  13960000
120800             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          13970000
120900                PV-DISPLAY-AUDIT-CNTL-NBR                         13980000
121000                                       DELIMITED BY SIZE          13990000
121100                           INTO DP013-MESSAGE-TEXT(1)             14000000
121200             MOVE SQLCA      TO DP013-SQLCA                       14010000
121300             MOVE 'TSUATRN ' TO DP013-DB2-TABLE-NAME(1)           14020000
121400             MOVE 'TSHUUPC ' TO DP013-DB2-TABLE-NAME(2)           14030000
121500             SET DP013-DB2-ABEND                                  14040000
121600                             TO TRUE                              14050000
121700             SET DP013-NO-ROLLBACK                                14060000
121800                             TO TRUE                              14070000
121900             PERFORM 9999-WRITE-CICS-LOG-MSG                      14080000
122000             SET PS-DUMP-TO-LOG       TO TRUE                     14090000
122100             SET SU026-DB2-ERROR TO TRUE                          14100000
122200     END-EVALUATE.                                                14110000
122300                                                                  14120009
087600******************************************************************14130009
118500 8910-SUM-RFID-UNITS.                                             14140002
                                                                        14150010
      * THIS SQL WILL CHECK IF THIS IS AN RF ONLY AUDIT                 14160010
           IF SUT00015-PO-PREPK-ID < 0                                  14170010
              PERFORM 8930-GET-RF-MAN-QTY                               14180009
           ELSE                                                         14190009
      * THIS SQL WILL SEE IF A COMBO (QC) AUDIT EXISTS FOR THIS RF      14200010
      * AUDIT                                                           14210010
              PERFORM 8940-GET-RF-EXPCTD-QTY                            14220009
           END-IF.                                                      14230009
                                                                        14240009
122300                                                                  14250005
087600******************************************************************14260009
118500 8930-GET-RF-MAN-QTY.                                             14270009
      *** FOR RF AUDITS THE EXPCTD QTY IS THE 'SCANNED' QTY ASSOCIATED  14280005
      *** WITH THE QC AUDIT.                                            14290005
122300                                                                  14300009
118600     EXEC SQL                                                     14310005
                SELECT SUM(SCND_UNT_QTY)                                14320009
                  INTO :PV-SUM-SHPD-QTY                                 14330009
                       :DN-SUM-NULL-IND                                 14340009
                  FROM TSUAUPC                                          14350009
                 WHERE SCN_TYP_CDE  <> 'E'                              14360009
                   AND AUD_CNTL_NBR  = :DK-AUDIT-CNTL-NBR               14370009
119600     END-EXEC.                                                    14380005
119700                                                                  14390005
119800     EVALUATE TRUE                                                14400005
119900         WHEN SQLCODE = ZERO                                      14410005
                    IF DN-SUM-NULL-IND < ZERO                           14420009
120200                 MOVE 0 TO PV-SUM-SHPD-QTY                        14430009
                    END-IF                                              14440009
119700                                                                  14450009
120100         WHEN SQLCODE = +100                                      14460005
120100         WHEN SQLCODE = -305                                      14470009
120200             MOVE 0 TO PV-SUM-SHPD-QTY                            14480005
119700                                                                  14490009
120300         WHEN SQLWARN0 NOT = SPACES                               14500005
120400         WHEN SQLCODE NOT EQUAL ZERO                              14510005
120500             MOVE '8930-GET-RF-MAN-QTY'                           14520009
120600                             TO DP013-PARAGRAPH                   14530005
120700             MOVE DK-AUDIT-CNTL-NBR TO PV-DISPLAY-AUDIT-CNTL-NBR  14540005
120800             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          14550005
120900                PV-DISPLAY-AUDIT-CNTL-NBR                         14560005
121000                                       DELIMITED BY SIZE          14570005
121100                           INTO DP013-MESSAGE-TEXT(1)             14580005
121200             MOVE SQLCA      TO DP013-SQLCA                       14590005
121300             MOVE 'TSUAUPC'  TO DP013-DB2-TABLE-NAME(1)           14600009
121500             SET DP013-DB2-ABEND                                  14610005
121600                             TO TRUE                              14620005
121700             SET DP013-NO-ROLLBACK                                14630005
121800                             TO TRUE                              14640005
121900             PERFORM 9999-WRITE-CICS-LOG-MSG                      14650005
122000             SET PS-DUMP-TO-LOG       TO TRUE                     14660005
122100             SET SU026-DB2-ERROR TO TRUE                          14670005
122200     END-EVALUATE.                                                14680005
122300                                                                  14690005
087600******************************************************************14700009
118500 8940-GET-RF-EXPCTD-QTY.                                          14710009
      *** FOR RF AUDITS THE EXPCTD QTY IS THE 'SCANNED' QTY ASSOCIATED  14720009
      *** WITH THE QC AUDIT.                                            14730009
118600     EXEC SQL                                                     14740009
                   SELECT SUM(SCND_UNT_QTY)                             14750009
                     INTO :PV-SUM-SHPD-QTY                              14760009
                          :DN-SUM-NULL-IND                              14770009
                     FROM TSUAUPC                                       14780009
                    WHERE SCN_TYP_CDE <> 'E'                            14790009
                      AND AUD_CNTL_NBR  IN                              14800009
                     (SELECT AUD_CNTL_NBR                               14810009
                        FROM SUT_PO_AUD_REQ                             14820009
                       WHERE PO_NBR            = :SUT00015-PO-NBR       14830009
                         AND PO_LNE_NBR        = :SUT00015-PO-LNE-NBR   14840009
                         AND OPER_UNT_ID       = :SUT00015-OPER-UNT-ID  14850009
                         AND RWRK_AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR)    14860009
119600     END-EXEC.                                                    14870009
119700                                                                  14880009
119800     EVALUATE TRUE                                                14890009
119900         WHEN SQLCODE = ZERO                                      14900009
                   IF DN-SUM-NULL-IND < ZERO                            14910009
120200                MOVE 0 TO PV-SUM-SHPD-QTY                         14920009
                   END-IF                                               14930009
119700                                                                  14940009
120100         WHEN SQLCODE = +100                                      14950009
120100         WHEN SQLCODE = -305                                      14960009
120200             MOVE 0    TO PV-SUM-SHPD-QTY                         14970009
119700                                                                  14980009
120300         WHEN SQLWARN0 NOT = SPACES                               14990009
120400         WHEN SQLCODE NOT EQUAL ZERO                              15000009
120500             MOVE '8940-GET-RF-EXPCTD-QTY'                        15010009
120600                                  TO DP013-PARAGRAPH              15020009
116900             MOVE SUT00015-OPER-UNT-ID TO PV-DISPLAY-OPER-UNT-ID  15030009
117000             STRING 'OPER UNIT: '      DELIMITED BY SIZE          15040009
117100                PV-DISPLAY-OPER-UNT-ID DELIMITED BY SIZE          15050009
117200                           INTO DP013-MESSAGE-TEXT(1)             15060009
120700             MOVE DK-AUDIT-CNTL-NBR TO PV-DISPLAY-AUDIT-CNTL-NBR  15070009
120800             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          15080009
120900                PV-DISPLAY-AUDIT-CNTL-NBR                         15090009
121000                                       DELIMITED BY SIZE          15100009
121100                           INTO DP013-MESSAGE-TEXT(2)             15110009
055400             MOVE SUT00015-PO-NBR TO PV-DISPLAY-PO-NBR            15120009
055500             STRING 'PO NBR: '         DELIMITED BY SIZE          15130009
055600                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          15140009
055700                           INTO DP013-MESSAGE-TEXT(3)             15150009
051800             MOVE SUT00015-PO-LNE-NBR TO PV-DISPLAY-PO-LINE-NBR   15160009
051900             STRING 'PO LINE NBR: '    DELIMITED BY SIZE          15170009
052000                PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE          15180009
052100                           INTO DP013-MESSAGE-TEXT(4)             15190009
121200             MOVE SQLCA      TO DP013-SQLCA                       15200009
121300             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME(1)     15210009
121300             MOVE 'SUT_PO_AUD_REQ' TO DP013-DB2-TABLE-NAME(2)     15220009
121500             SET DP013-DB2-ABEND   TO TRUE                        15230009
121700             SET DP013-NO-ROLLBACK TO TRUE                        15240009
121900             PERFORM 9999-WRITE-CICS-LOG-MSG                      15250009
122000             SET PS-DUMP-TO-LOG       TO TRUE                     15260009
122100             SET SU026-DB2-ERROR TO TRUE                          15270009
122200     END-EVALUATE.                                                15280009
122300                                                                  15290009
087600******************************************************************15300009
122400 9000-COUNT-CARTONS.                                              15310003
122500     EXEC SQL                                                     15320000
122600             SELECT                                               15330000
122700                 COUNT(*)                                         15340000
122800             INTO                                                 15350000
122900                  :PV-CARTON-COUNT                                15360000
123000             FROM TSUATRN                                         15370000
123100         WHERE                                                    15380000
123200                AUD_CNTL_NBR   = :DK-AUDIT-CNTL-NBR               15390000
123300     END-EXEC.                                                    15400000
123400                                                                  15410000
123500     EVALUATE TRUE                                                15420000
123600         WHEN SQLCODE = ZERO                                      15430000
123700             CONTINUE                                             15440000
123800         WHEN SQLCODE = +100                                      15450000
123900             MOVE 0      TO PV-CARTON-COUNT                       15460000
124000         WHEN SQLWARN0 NOT = SPACES                               15470000
124100         WHEN SQLCODE NOT EQUAL ZERO                              15480000
124200             MOVE '9000-COUNT-CARTONS'                            15490000
124300                             TO DP013-PARAGRAPH                   15500000
124400             MOVE DK-AUDIT-CNTL-NBR TO PV-DISPLAY-AUDIT-CNTL-NBR  15510000
124500             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          15520000
124600                PV-DISPLAY-AUDIT-CNTL-NBR                         15530000
124700                                       DELIMITED BY SIZE          15540000
124800                           INTO DP013-MESSAGE-TEXT(1)             15550000
124900             MOVE SQLCA      TO DP013-SQLCA                       15560000
125000             MOVE 'TSUATRN ' TO DP013-DB2-TABLE-NAME(1)           15570000
125100             SET DP013-DB2-ABEND                                  15580000
125200                             TO TRUE                              15590000
125300             SET DP013-NO-ROLLBACK                                15600000
125400                             TO TRUE                              15610000
125500             PERFORM 9999-WRITE-CICS-LOG-MSG                      15620000
125600             SET PS-DUMP-TO-LOG       TO TRUE                     15630000
125700             SET SU026-DB2-ERROR TO TRUE                          15640000
125800     END-EVALUATE.                                                15650000
125900                                                                  15660000
126000                                                                  15670000
126100 9990-WRITE-CICS.                                                 15680000
126200                                                                  15690000
126300* IF YOU'RE AT THE LAST OCCURRENCE OF THE TABLE,                  15700000
126400* THE NEXT MESSAGE WILL GO INTO THE FIRST OCCURRENCE.  KEEP       15710000
126500* INCREMENTING THE SEQUENCE SO THAT IF THE TABLE IS DUMPED TO THE 15720000
126600* LOG YOU WILL BE ABLE TO SEE THE LAST 200 LINES AND HOW THEY     15730000
126700* WRAPPED AROUND.                                                 15740000
126800                                                                  15750000
126900     EVALUATE TRUE                                                15760000
127000     WHEN PT-MSG-IDX < PC-MSG-TABLE-SIZE                          15770000
127100         MOVE PV-CICS-MSG-AREA        TO PT-MSG-LINE (PT-MSG-IDX) 15780000
127200         MOVE PT-MSG-SEQ (PT-MSG-IDX) TO PV-PREV-SEQUENCE         15790000
127300         SET PT-MSG-IDX UP BY 1                                   15800000
127400     WHEN PT-MSG-IDX = PC-MSG-TABLE-SIZE                          15810000
127500         MOVE PV-CICS-MSG-AREA        TO PT-MSG-LINE (PT-MSG-IDX) 15820000
127600         MOVE PT-MSG-SEQ (PT-MSG-IDX) TO PV-PREV-SEQUENCE         15830000
127700         SET PT-MSG-IDX               TO 1                        15840000
127800     END-EVALUATE                                                 15850000
127900                                                                  15860000
128000     COMPUTE PV-NEXT-SEQUENCE = PV-PREV-SEQUENCE + 1              15870000
128100     MOVE PV-NEXT-SEQUENCE            TO PT-MSG-SEQ (PT-MSG-IDX)  15880000
128200                                                                  15890000
128300                                                                  15900000
128400*  IF THE DC HAS TRACE PROCESSING TURNED ON, ALL MESSAGES WILL    15910000
128500*  BE DISPLAYED AS THEY OCCUR.  DUMPING THE MESSAGE TABLE WILL    15920000
128600*  BE UNNECESSARY BECAUSE OF THE REAL-TIME DISPLAYS.              15930000
128700*                                                                 15940000
128800     IF PS-SHOW-DEBUG-INFO                                        15950000
128900         PERFORM 9991-WRITEQ                                      15960000
129000     END-IF                                                       15970000
129100     MOVE SPACES                      TO PV-CICS-MSG-AREA.        15980000
129200                                                                  15990000
129300                                                                  16000000
129400 9991-WRITEQ.                                                     16010000
129500     EXEC CICS                                                    16020000
129600         WRITEQ TD                                                16030000
129700         QUEUE(PC-LOG-QUEUE)                                      16040000
129800         FROM(PV-CICS-MSG-AREA)                                   16050000
129900         RESP(PV-CICS-RESPONSE)                                   16060000
130000     END-EXEC.                                                    16070000
130100                                                                  16080000
130200*-----------------------------------------------------------------16090000
130300*  RETURN TO CALLING PROGRAM                                      16100000
130400*-----------------------------------------------------------------16110000
130500 9998-RETURN.                                                     16120000
130600                                                                  16130000
130700     STRING ' 9998-RETURN'                                        16140000
130800         DELIMITED BY SIZE                                        16150000
130900         INTO PV-CICS-MSG-AREA.                                   16160000
131000     PERFORM 9990-WRITE-CICS.                                     16170000
131100                                                                  16180000
131200     MOVE SU026-CARTON-AUDIT-RECORD     TO DFHCOMMAREA.           16190000
131300                                                                  16200000
131400     EXEC CICS                                                    16210000
131500          RETURN                                                  16220000
131600     END-EXEC.                                                    16230000
131700                                                                  16240000
131800                                                                  16250000
131900 9999-WRITE-TO-CSSL.                                              16260000
132000     STRING ' 9999-WRITE-TO-CSSL'                                 16270000
132100         DELIMITED BY SIZE                                        16280000
132200         INTO PV-CICS-MSG-AREA.                                   16290000
132300     PERFORM 9990-WRITE-CICS.                                     16300000
132400     MOVE LENGTH OF PV-CICS-MSG-AREA2                             16310000
132500       TO PV-COMMAREA-LENGTH                                      16320000
132600     EXEC CICS                                                    16330000
132700          WRITEQ TD                                               16340000
132800           QUEUE   ('CSSL')                                       16350000
132900            FROM   (PV-CICS-MSG-AREA2)                            16360000
133000          LENGTH   (PV-COMMAREA-LENGTH)                           16370000
133100            RESP   (PV-CICS-RESP)                                 16380000
133200     END-EXEC.                                                    16390000
133300                                                                  16400000
133400*                                                                 16410000
133500 9999-WRITE-CICS-LOG-MSG.                                         16420000
133600     STRING ' 9999-WRITE-CICS-LOG-MSG'                            16430000
133700         DELIMITED BY SIZE                                        16440000
133800         INTO PV-CICS-MSG-AREA.                                   16450000
133900     PERFORM 9990-WRITE-CICS.                                     16460000
134000     MOVE 'SUKCS594'                 TO DP013-PROGRAM.            16470000
134100     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           16480000
134200     INITIALIZE DP013-SRC-TASK-NUMBER                             16490000
134300                DP013-STACK.                                      16500000
134400     SET DP013-LINK-RETURN           TO TRUE.                     16510000
134500                                                                  16520000
134600     EXEC CICS                                                    16530000
134700         LINK                                                     16540000
134800             PROGRAM   (DP013-NAME)                               16550000
134900             COMMAREA  (DP013-PARAMETERS)                         16560000
135000             LENGTH    (DP013-LENGTH)                             16570000
135100     END-EXEC.                                                    16580000
135200                                                                  16590000
135300                                                                  16600000
135400 9999-FINAL-DUMP.                                                 16610000
135500*  IF AN ERROR HAS OCCURRED, DUMP THE MESSAGE TABLE WHICH WILL    16620000
135600*  CONTAIN THE LAST 200 TRACE DISPLAYS.  IF THE TABLE EVER        16630000
135700*  OVERFLOW, YOU WILL SEE THE SEQUENCE NUMBERS WRAP.  UNUSED      16640000
135800*  OCCRENCES ARE NOT DISPLAYED.                                   16650000
135900*                                                                 16660000
136000                                                                  16670000
136100     STRING ' 9999-FINAL-DUMP'                                    16680000
136200         DELIMITED BY SIZE                                        16690000
136300         INTO PV-CICS-MSG-AREA                                    16700000
136400     PERFORM 9990-WRITE-CICS.                                     16710000
136500                                                                  16720000
136600     EXEC CICS ENQ                                                16730000
136700         RESOURCE(PC-LOG-QUEUE)                                   16740000
136800     END-EXEC                                                     16750000
136900                                                                  16760000
137000     MOVE PV-EIBTASKN             TO PV-DISPLAY-TASK.             16770000
137100     PERFORM VARYING PT-MSG-IDX FROM 1 BY 1 UNTIL                 16780000
137200                     PT-MSG-IDX > PC-MSG-TABLE-SIZE               16790000
137300         IF PT-MSG-SEQ (PT-MSG-IDX) > ZERO                        16800000
137400             MOVE PT-MSG-SEQ (PT-MSG-IDX)                         16810000
137500                                  TO PV-DISPLAY-MSG-NBR           16820000
137600             STRING ' ' PV-DISPLAY-TASK ' '                       16830000
137700                  PV-DISPLAY-MSG-NBR ' '                          16840000
137800                  PT-MSG-LINE (PT-MSG-IDX)                        16850000
137900                  DELIMITED BY SIZE                               16860000
138000                                INTO PV-CICS-MSG-AREA             16870000
138100             PERFORM 9991-WRITEQ                                  16880000
138200         END-IF                                                   16890000
138300     END-PERFORM.                                                 16900000
138400                                                                  16910000
138500     SET PT-MSG-IDX               TO 1.                           16920000
138600     SET PS-DONT-DUMP-TO-LOG      TO TRUE.                        16930000
138700                                                                  16940000
138800     EXEC CICS DEQ                                                16950000
138900         RESOURCE(PC-LOG-QUEUE)                                   16960000
139000     END-EXEC.                                                    16970000
139100                                                                  16980000
