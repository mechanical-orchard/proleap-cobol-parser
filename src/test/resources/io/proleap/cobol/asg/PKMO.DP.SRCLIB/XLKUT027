000100 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.    XLKUT027.                                         00020002
000300 AUTHOR.        RON KRIER.                                        00030002
000400 INSTALLATION.  KOHLS.                                            00040002
000500 DATE-WRITTEN   MARCH, 29, 2003.                                  00050002
000600 DATE-COMPILED.                                                   00060002
000700                                                                  00070002
000800* ************************************************************** *00080002
000900* * XLKUT027.  "PURCHASE ORDER DOMAIN INTEGRITY"               * *00090002
001000* *                                                            * *00100002
001100* * PURPOSE:                                                   * *00110002
001200* * THIS PROGRAM CREATES AN EXTRACT FILE FROM: TPURCHS.        * *00120002
001300* * THIS EXTRACT FILE CONSISTS OF ROWS ELIGIBLE TO BE TO PART  * *00130002
001400* * OF THE INTEGRITY PROCESS BETWEEN THE RMS PURCHASE ORDER    * *00140002
001500* * SYSTEM AND THE LOGISTICS DOMAIN PURCHASE ORDER TABLES.     * *00150002
001600* *                                                            * *00160002
001700* * PROCESSING OVERVIEW:                                       * *00170002
001800* *   THIS PROGRAM WILL READ THE INPUT DRIVER FILE AND THEN    * *00180002
001900* *   PERFORM A SELECT ON THE TPURCHS TABLE.  DATA RETRIEVED   * *00190002
002000* *   FROM THE SELECT WILL THEN BE WRITTEN TO THE OUTPUT FILE. * *00200002
      * ****************************************************************        
      * CHANGE DESCRIPTION                                                      
      * ****************************************************************        
      * DATE  05/12/2010                                                        
      *  CHANGE MADE: ADDED A NEW IR INDICATOR(WHSE_RPLNT_IND) IN               
      *  TPURCHS TABLE UNDER IMPORT REPLENISHMENT PROJECT. CHANGES MADE         
      *  ACCORDINGLY FOR THE SELECT CALL FOR TPURCHS TABLE.                     
      * MADE BY: MONIKA SACHDEVA         TKID: TKMAW78                          
      * CHANGES TAGGED AS MS 05/12/2010                                         
002100**************************************************************** *00390002
002200 ENVIRONMENT DIVISION.                                            00395002
002300 CONFIGURATION SECTION.                                           00396002
002400 SOURCE-COMPUTER.        IBM-3090.                                00397002
002500 OBJECT-COMPUTER.        IBM-3090.                                00398002
002600                                                                  00399002
002700 INPUT-OUTPUT SECTION.                                            00400002
002800 FILE-CONTROL.                                                    00410002
002900                                                                  00420002
003000     SELECT IN-DRIVER-FILE                ASSIGN TO IN01.         00430002
003100     SELECT OUT-EXTRACT-FILE              ASSIGN TO OUT01.        00440002
003200     SELECT OUT-ERROR-FILE                ASSIGN TO OUT02.        00310002
003300                                                                  00450002
003400******************************************************************00460002
003500 DATA DIVISION.                                                   00470002
003600 FILE SECTION.                                                    00480002
003700                                                                  00490002
003800 FD  IN-DRIVER-FILE                                               00500002
003900     RECORDING MODE IS F                                          00510002
004000     LABEL RECORDS ARE STANDARD                                   00520002
004100     BLOCK CONTAINS 0 RECORDS.                                    00530002
004200 01  IN-DRIVER-RECORD                PIC  X(030).                 00540002
004300                                                                  00550002
004400**** TPURCHS:                                                     00560002
004500 FD  OUT-EXTRACT-FILE                                             00570002
004600     RECORDING MODE IS F                                          00580002
004700     LABEL RECORDS ARE STANDARD                                   00590002
004800     BLOCK CONTAINS 0 RECORDS.                                    00600002
004900*01  OUT-EXTRACT-RECORD              PIC  X(479).                 00610005
      ** CHANGE THE RECORD LENGTH TO ACCOMODATE THE NEW INDICATOR **            
      ** MS 05/12/2010 BEG                                                      
004900*01  OUT-EXTRACT-RECORD              PIC  X(481).                 00610005
       01  OUT-EXTRACT-RECORD              PIC  X(482).                 00610005
      ** MS 05/12/2010 END                                                      
005000                                                                  00620002
005100 FD  OUT-ERROR-FILE                                               00440002
005200     RECORDING MODE IS F                                          00450002
005300     LABEL RECORDS ARE STANDARD                                   00460002
005400     BLOCK CONTAINS 0 RECORDS.                                    00470002
005500 01  OUT-ERROR-RECORD                PIC  X(200).                 00480002
005600                                                                  00640002
005700 WORKING-STORAGE SECTION.                                         00650002
005800                                                                  00660002
005900 01  PC-PROGRAM-CONSTANTS.                                        00670002
006000     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'XLKUT027'.  00680002
006100     05  PC-PGM-PROGRESS-DESC.                                    00690002
006200         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00700002
006300         10  PC-CONTINUING           PIC X(10) VALUE              00710002
006400                                               'CONTINUING'.      00720002
006500         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00730002
006600         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00740002
006700     05  PC-ABEND-INFO.                                           00750002
006800         10  PC-ABEND                PIC X(11) VALUE              00760002
006900                                               '** ABEND **'.     00770002
007000         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00780002
007100                                               '- PARA       : '. 00790002
007200         10  PC-ABEND-MSG-DISPLAY-PARA                            00800002
007300                                     PIC X(15) VALUE              00810002
007400                                               '  CALLED PARA: '. 00820002
007500         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00830002
007600                                               '  FOR ABEND# : '. 00840002
007700         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00850002
007800                                               '- ERROR IS   : '. 00860002
007900         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00870002
008000         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00880002
008100                                               '- ACTION     : '. 00890002
008200     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 5000.        00900002
008300                                                                  00910002
008400 01  PS-PROGRAM-SWITCHES.                                         00920002
008500     05  PS-IN-DRIVER-EOF-SW         PIC X(01) VALUE 'N'.         00930002
008600         88  PS-IN-DRIVER-EOF                  VALUE 'Y'.         00940002
008700         88  PS-IN-DRIVER-NOT-EOF              VALUE 'N'.         00950002
008800     05  PS-TABLE-DATA-FOUND-SW      PIC X(01) VALUE 'N'.         01011002
008900         88  PS-TABLE-DATA-FOUND               VALUE 'Y'.         01012002
009000         88  PS-TABLE-DATA-NOT-FOUND           VALUE 'N'.         01013003
009100                                                                  01020002
009200 01  PV-PROGRAM-VARIABLES.                                        01030002
009300     05  PV-PO-NBR-COMP              PIC S9(9) VALUE 0 COMP.      01040002
009400     05  PV-PO-NBR-NUM               PIC  9(9) VALUE 0.           01050002
009500     05  PV-IN-DRIVER-RECS-READ-CNT  PIC  9(9) VALUE 0.           01060002
009600     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           01070002
009700     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           01080002
009800     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01090002
009900     05  PV-ERROR-WRITTEN-CNT        PIC  9(9) VALUE 0.           01090002
010000                                                                  01100002
010100     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01110002
010200     05  PV-ERROR-RECORD             PIC X(200) VALUE SPACES.     01110002
010300     05  FILLER                      PIC X(01) VALUE SPACES.      01111006
010400     05  PV-PO-NBR                   PIC X(09) VALUE SPACES.      01112006
010500     05  FILLER                      PIC X(01) VALUE SPACES.      01113006
010600     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      01120002
010700     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01130002
010800     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01140002
010900     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01150002
011000     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01160002
011100                                                                  01170002
011200     05  PV-TMST                     PIC X(26) VALUE SPACES.      01180002
011300     05  PV-TIMESTAMP-DETAIL                                      01190002
011400         REDEFINES                                                01200002
011500         PV-TMST.                                                 01210002
011600         10  PV-TIMESTAMP-19.                                     01220002
011700             15  PV-TMS-DATE.                                     01230002
011800                 20  PV-TMS-YEAR.                                 01240002
011900                     25  PV-TMS-CC   PIC X(02).                   01250002
012000                     25  PV-TMS-YY   PIC X(02).                   01260002
012100                 20  FILLER          PIC X(01).                   01270002
012200                 20  PV-TMS-MONTH    PIC X(02).                   01280002
012300                 20  FILLER          PIC X(01).                   01290002
012400                 20  PV-TMS-DAY      PIC X(02).                   01300002
012500             15  FILLER              PIC X(01).                   01310002
012600             15  PV-TMS-HOUR         PIC X(02).                   01320002
012700             15  FILLER              PIC X(01).                   01330002
012800             15  PV-TMS-MINUTE       PIC X(02).                   01340002
012900             15  FILLER              PIC X(01).                   01350002
013000             15  PV-TMS-SECOND       PIC X(02).                   01360002
013100         10  FILLER                  PIC X(01).                   01370002
013200         10  PV-TMS-MSECOND          PIC X(06).                   01380002
013300                                                                          
013400 01  DN-NULL-INDICATORS.                                                  
013500     05  DN-NULL-IND                  PIC S9(04) COMP                     
013600                                          VALUE ZERO.                     
013700                                                                  01390002
013800 01  DM-DISPLAY-MESSAGE.                                          01400002
013900     05  DM-01-10.                                                01410002
014000         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01420002
014100         10  FILLER                  PIC X(02) VALUE ': '.        01430002
014200     05  DM-11-80.                                                01440002
014300         10  FILLER                  PIC X(37) VALUE              01450002
014400                        'SELECT ROWS MATCHING PO DRIVER FILE, '.  01460002
014500         10  FILLER                  PIC X(30) VALUE              01470002
014600                        'CREATING TPURCHS EXTRACT FILE.'.         01480002
014700         10  FILLER                  PIC X(01) VALUE SPACE.       01490002
014800         10  FILLER                  PIC X(01) VALUE ALL '*'.     01500002
014900     05  DM-81-120.                                               01510002
015000         10  FILLER                  PIC X(40) VALUE ALL '*'.     01520002
015100                                                                  01530002
015200 01  DP-DISPLAY-PROGRESS-MSG.                                     01540002
015300     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01550002
015400     05  FILLER                      PIC X(02) VALUE SPACE.       01560002
015500     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       01570002
015600     05  FILLER                      PIC X(04) VALUE ' AT '.      01580002
015700     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       01590002
015800     05  FILLER                      PIC X(03) VALUE '.  '.       01600002
015900     05  FILLER                      PIC X(03) VALUE              01610002
016000                                         'IN:'.                   01620002
016100     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              01630002
016200                                               VALUE ZERO.        01640002
016300     05  FILLER                      PIC X(02) VALUE ', '.        01650002
016400*    05  FILLER                      PIC X(16) VALUE              01660002
016500*                                        'DRIVER W/ROW(S):'.      01670002
016600*    05  DP-MATCHES-FOUND-CNT        PIC ZZZ,ZZZ,ZZ9              01680002
016700*                                              VALUE ZERO.        01690002
016800*    05  FILLER                      PIC X(02) VALUE ', '.        01700002
016900     05  FILLER                      PIC X(14) VALUE              01710002
017000                                         'ROWS SELECTED:'.        01720002
017100     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              01730002
017200                                               VALUE ZERO.        01740002
017300     05  FILLER                      PIC X(02) VALUE ', '.        01750002
017400     05  FILLER                      PIC X(04) VALUE              01760002
017500                                         'OUT:'.                  01770002
017600     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01780002
017700                                               VALUE ZERO.        01790002
017800     05  FILLER                      PIC X(01) VALUE '.'.         01800002
017900                                                                  01810002
018000 01  ABEND-CODE                      PIC S9(04)                   01820002
018100                                               VALUE ZEROES       01830002
018200                                               COMP SYNC.         01840002
018300                                                                  01850002
018400*---------------------------------------------------------------* 01860002
018500*  DB2 FORMATTED MESSAGE AREA                                     01870002
018600*---------------------------------------------------------------* 01880002
018700     COPY DPWS004.                                                01890002
018800                                                                  01900002
018900                                                                  01910002
019000*---------------------------------------------------------------* 01920002
019100*  XLRD013 - RECORD LAYOUT FOR PO DRIVER FILE, INPUT.             01930002
019200*---------------------------------------------------------------* 01940002
019300     COPY XLRD013.                                                01950002
019400                                                                  01960002
019500*---------------------------------------------------------------* 01920002
019600*  XLRD063 - COPY OF TPURCHS DCLGEN WITH NULL IND                 01930002
019700*---------------------------------------------------------------* 01940002
019800     COPY XLRD063.                                                01950002
019900                                                                  01960002
020000                                                                  01970002
020100*---------------------------------------------------------------* 01980002
020200*    DB2 AREA FOR TPURCHS                                       * 01990002
020300*---------------------------------------------------------------* 02000002
020400     EXEC SQL                                                     02010002
020500          INCLUDE TPURCHS                                         02020002
020600     END-EXEC.                                                    02030002
020700                                                                  02040002
020800*---------------------------------------------------------------* 02050002
020900*    DB2 AREA FOR COMMUNICATIONS                                * 02060002
021000*---------------------------------------------------------------* 02070002
021100     EXEC SQL                                                     02080002
021200          INCLUDE SQLCA                                           02090002
021300     END-EXEC.                                                    02100002
021400                                                                  02110002
021500                                                                  02699002
021600 PROCEDURE DIVISION.                                              02700002
021700********************                                              02710002
021800                                                                  02720002
021900 0000-PROGRAM-MAINLINE.                                           02730002
022000                                                                  02740002
022100     PERFORM 1000-INITIALIZE.                                     02750002
022200                                                                  02760002
022300     SET PS-IN-DRIVER-NOT-EOF TO TRUE.                            02770002
022400     PERFORM 2000-PROCESS-DRIVER-FILE                             02780002
022500         UNTIL PS-IN-DRIVER-EOF.                                  02790002
022600                                                                  02800002
022700     PERFORM 6000-EOJ-ROUTINE.                                    02810002
022800     STOP RUN.                                                    02820002
022900                                                                  02830002
023000                                                                  02840002
023100* ************************************************************** *02850002
023200* * INITIALIZATIONS                                            * *02860002
023300* ************************************************************** *02870002
023400                                                                  02871002
023500 1000-INITIALIZE.                                                 02880002
023600                                                                  02890002
023700     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02900002
023800     DISPLAY DM-DISPLAY-MESSAGE.                                  02910002
023900                                                                  02920002
024000     MOVE PC-BEGINNING              TO DP-STATUS-DESCRIPTION.     02930002
024100     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02940002
024200                                                                  02950002
024300     PERFORM 9000-OPEN-IN-DRIVER-FILE.                            02960002
024400     PERFORM 9700-OPEN-OUT-EXTRACT-FILE.                          02970002
024500     PERFORM 9800-OPEN-OUT-ERROR-FILE.                            02970002
024600                                                                  02980002
024700                                                                  02990002
024800* ************************************************************** *03000002
024900* * READ DRIVER FILE                                           * *03010002
025000* * SELECT DATA FROM TPURCHS BASED ON PO NUMBER FROM DRIVER    * *03020002
025100* * FILE                                                       * *03030002
025200* * WRITE DATA FROM TPURCHS TO THE OUTPUT FILE                 * *03040002
025300* *        ROWS FOR THIS INPUT DRIVER RECORD                   * *03050002
025400* ************************************************************** *03100002
025500                                                                  03101002
025600 2000-PROCESS-DRIVER-FILE.                                        03110002
025700                                                                  03120002
025800     PERFORM 9050-READ-IN-DRIVER-FILE.                            03130002
025900                                                                  03131002
026000     IF  PS-IN-DRIVER-EOF                                         03140002
026100         CONTINUE                                                 03150002
026200     ELSE                                                         03160002
026300         MOVE XL013-PO-NBR TO         PV-PO-NBR-COMP              03170002
026400                                      PV-PO-NBR-NUM               03180002
026500         PERFORM 2100-CHECK-PGM-PROGRESS                          03190002
026600         INITIALIZE DCLTPURCHS                                    03211002
026700                    XL063-DCLTPURCHS                                      
026800         SET PS-TABLE-DATA-NOT-FOUND TO TRUE                      03212002
026900         PERFORM 9100-SELECT-TABLE                                03220002
027000         IF  PS-TABLE-DATA-NOT-FOUND                              03230002
027100             CONTINUE                                             03240002
027200         ELSE                                                     03250002
027300             PERFORM 9750-WRITE-EXTRACT-RECORD                    03251002
027400         END-IF                                                   03260002
027500     END-IF.                                                      03261002
027600                                                                  03270002
027700                                                                  03280002
027800* ************************************************************** *03290002
027900* *    EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT     * *03300002
028000* *    RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST   * *03310002
028100* *    WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.   * *03320002
028200* ************************************************************** *03330002
028300                                                                  03331002
028400 2100-CHECK-PGM-PROGRESS.                                         03340002
028500     DIVIDE    PV-IN-DRIVER-RECS-READ-CNT                         03350002
028600         BY        PC-HOW-OFTEN-TO-DISPLAY                        03360002
028700         GIVING    PV-DISPLAY-NTH-MULTIPLE                        03370002
028800         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      03380002
028900                                                                  03390002
029000     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           03400002
029100         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      03410002
029200         PERFORM 6200-DISPLAY-PGM-PROGRESS                        03420002
029300     END-IF.                                                      03430002
029400                                                                  03440002
029500                                                                  03450002
029600* ************************************************************** *03590002
029700* * DISPLAY END OF RUN MESSAGE, CLOSE THE OUTPUT FILES         * *03600002
029800* ************************************************************** *03610002
029900                                                                  03611002
030000 6000-EOJ-ROUTINE.                                                03620002
030100                                                                  03630002
030200     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           03640002
030300     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         03650002
030400                                                                  03660002
030500     MOVE PC-ENDING                 TO DP-STATUS-DESCRIPTION.     03670002
030600     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           03680002
030700                                                                  03690002
030800                                                                  03700002
030900* ************************************************************** *03710002
031000* * DISPLAY PROGRAM PROGRESS.                                  * *03720002
031100* ************************************************************** *03730002
031200                                                                  03731002
031300 6200-DISPLAY-PGM-PROGRESS.                                       03740002
031400                                                                  03750002
031500     EXEC SQL                                                     03760002
031600          SET :PV-TMST = CURRENT TIMESTAMP                        03770002
031700     END-EXEC.                                                    03780002
031800                                                                  03790002
031900     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                03800002
032000     MOVE PV-TIMESTAMP-19           TO DP-TIMESTAMP-19.           03810002
032100     MOVE PV-IN-DRIVER-RECS-READ-CNT                              03820002
032200                                    TO DP-IN-CNT.                 03830002
032300*    MOVE PV-RECS-WITH-MATCHES-CNT  TO DP-MATCHES-FOUND-CNT.      03840002
032400     MOVE PV-TABLE-ROW-SELECT-CNT   TO DP-ROWS-SELECTED-CNT.      03850002
032500     MOVE PV-EXTRACT-WRITTEN-CNT    TO DP-OUT-CNT.                03860002
032600                                                                  03870002
032700     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03880002
032800                                                                  03890002
032900                                                                  03900002
033000* ************************************************************** *03980002
033100* * OPEN  INPUT DRIVER FILE                                    * *03990002
033200* ************************************************************** *04000002
033300                                                                  04001002
033400 9000-OPEN-IN-DRIVER-FILE.                                        04010002
033500                                                                  04011002
033600     OPEN  INPUT  IN-DRIVER-FILE.                                 04020002
033700                                                                  04030002
033800                                                                  04040002
033900* ************************************************************** *04050002
034000* * READ  INPUT DRIVER FILE OF ELIGIBLE DATA TO EXTRACT        * *04060002
034100* ************************************************************** *04070002
034200                                                                  04071002
034300 9050-READ-IN-DRIVER-FILE.                                        04080002
034400                                                                  04081002
034500     READ IN-DRIVER-FILE                                          04090002
034600          INTO XL013-DRIVER-RECORD-LAYOUT                         04100002
034700          AT END                                                  04110002
034800              SET PS-IN-DRIVER-EOF TO TRUE.                       04120002
034900                                                                  04130002
035000     IF PS-IN-DRIVER-EOF                                          04140002
035100         CONTINUE                                                 04150002
035200     ELSE                                                         04160002
035300         ADD +1 TO PV-IN-DRIVER-RECS-READ-CNT                     04170002
035400     END-IF.                                                      04180002
035500                                                                  04190002
035600                                                                  04200002
035700* ************************************************************** *04210002
035800* * CLOSE INPUT DRIVER FILE                                    * *04220002
035900* ************************************************************** *04230002
036000                                                                  04231002
036100 9090-CLOSE-IN-DRIVER-FILE.                                       04240002
036200                                                                  04241002
036300     CLOSE IN-DRIVER-FILE.                                        04250002
036400                                                                  04260002
036500                                                                  04270002
036600* ************************************************************** *04280002
036700* * OPEN  TABLE CURSOR                                         * *04290002
036800* ************************************************************** *04300002
036900                                                                  04300102
      ** INCLUDE THE NEW WAREHOUSE INDICATOR **                                 
      ** MS 05/12/2010                                                          
037000 9100-SELECT-TABLE.                                               04301002
037100                                                                  04302002
037200     EXEC SQL                                                     04340002
037300           SELECT PO_NBR                                          04341002
037400                 ,VER_NBR                                         04342002
037500                 ,VER_STATUS_CDE                                  04343002
037600                 ,PO_TYP_CDE                                      04344002
037700                 ,PO_CATEG_CDE                                    04345002
037800                 ,EDI_IND                                         04346002
037900                 ,TOT_UNT_QTY                                     04347002
038000                 ,TOT_VAL_COST_AMT                                04348002
038100                 ,TOT_VAL_RTL_AMT                                 04349002
038200                 ,TOT_MU_PCT                                      04349102
038300                 ,TOT_SKUS_QTY                                    04349202
038400                 ,IMPRT_AGNT_PO_NBR                               04349302
038500                 ,IMPRT_ORD_OFF_NAME                              04349402
038600                 ,IMPRT_VEND_NAME                                 04349502
038700                 ,IMPRT_FCTRY_NAME                                04349602
038800                 ,IMPRT_CNTRY_NAME                                04349702
038900                 ,VEND_CNTRY_NAME                                 04349802
039000                 ,NEW_STR_PO_IND                                  04349902
039100                 ,IMPRT_PO_IND                                    04350002
039200                 ,IMPRT_AGNT_PO_IND                               04351002
039300                 ,STATUS_TMST                                     04352002
039400                 ,LAST_UPD_TMST                                   04353002
039500                 ,EDI_REXMIT_IND                                  04354002
039600                 ,EDI_REXMIT_TMST                                 04355002
039700                 ,DIR_STR_IND                                     04356002
039800                 ,LAST_UPD_BY_UID                                 04357002
039900                 ,APP_BY_UID                                      04358002
040000                 ,OTB_PER_NBR                                     04359002
040100                 ,DEPT_NBR                                        04359102
040200                 ,ENT_ID                                          04359202
040300                 ,STATUS_CDE                                      04359302
040400                 ,CRE_BY_UID                                      04359402
040500                 ,REJ_CT                                          04359502
040600                 ,REJ_UID                                         04359602
040700                 ,ORD_DTE                                         04359702
040800                 ,REVISION_CT                                     04359802
040900                 ,ADR_SEQ_NBR                                     04359902
041000                 ,DEST_KNOWN_IND                                  04360002
041100                 ,RLSE_IND                                        04361002
041200                 ,RLSE_DTE                                        04362002
041300                 ,ANLYS_HOLD_IND                                  04363002
041400                 ,PLCMNT_CNTRY_CDE                                04364002
041500                 ,PROD_CNTRY_CDE                                  04365002
041600                 ,UNT_PER_CBMT_QTY                                04366002
041700                 ,TKT_FMT_NBR                                     04367002
041800                 ,TKT_FMT_DESC                                    04368002
041900                 ,CRE_TMST                                        04369002
042000                 ,PRG_LAST_ACTVY_DTE                              04369102
042100                 ,PKGNG_CDE                                       04369202
042200                 ,SEASET_YR                                       04369302
042300                 ,SEASET_SHRT_NM                                  04369402
042400                 ,QTA_CTG_CDE                                     04369502
042500                 ,PO_IN_RMS_IND                                   04369602
042600                 ,RMS_PO_UPD_TMST                                 04369705
042700                 ,DUP_SKU_IND                                     04369805
042800                 ,ORIG_PKGNG_CDE                                  04369905
042900                 ,IMPRT_VND_ID                                            
043000                 ,IMPRT_FCTRY_ID                                          
043100                 ,DERVD_LBL_TYP_CDE                                       
043200*                ,SUBSTR(CHAR(INT(DELY_ID)),1,10)                         
043200*                ,CHAR(INT(DELY_ID))                                      
043200*                ,CHAR(DELY_ID)                                           
043200                 , DELY_ID                                                
043300                 ,PO_SHRT_CYC_IND                                         
                       ,WHSE_RPLNT_IND                                          
043400          INTO  :XL063-PO-NBR                                     04590002
043500               ,:XL063-VER-NBR                                    04600002
043600               ,:XL063-VER-STATUS-CDE                             04610002
043700               ,:XL063-PO-TYP-CDE                                 04620002
043800               ,:XL063-PO-CATEG-CDE                               04630002
043900               ,:XL063-EDI-IND                                    04640002
044000               ,:XL063-TOT-UNT-QTY                                04650002
044100               ,:XL063-TOT-VAL-COST-AMT                           04660002
044200               ,:XL063-TOT-VAL-RTL-AMT                            04670002
044300               ,:XL063-TOT-MU-PCT                                 04680002
044400               ,:XL063-TOT-SKUS-QTY                               04690002
044500               ,:XL063-IMPRT-AGNT-PO-NBR                          04700002
044600               ,:XL063-IMPRT-ORD-OFF-NAME                         04710002
044700               ,:XL063-IMPRT-VEND-NAME                            04720002
044800               ,:XL063-IMPRT-FCTRY-NAME                           04730002
044900               ,:XL063-IMPRT-CNTRY-NAME                           04740002
045000               ,:XL063-VEND-CNTRY-NAME                            04750002
045100               ,:XL063-NEW-STR-PO-IND                             04760002
045200               ,:XL063-IMPRT-PO-IND                               04770002
045300               ,:XL063-IMPRT-AGNT-PO-IND                          04780002
045400               ,:XL063-STATUS-TMST                                04790002
045500               ,:XL063-LAST-UPD-TMST                              04800002
045600               ,:XL063-EDI-REXMIT-IND                             04810002
045700               ,:XL063-EDI-REXMIT-TMST                            04820002
045800               ,:XL063-DIR-STR-IND                                04830002
045900               ,:XL063-LAST-UPD-BY-UID                            04840002
046000               ,:XL063-APP-BY-UID                                 04850002
046100               ,:XL063-OTB-PER-NBR                                04860002
046200               ,:XL063-DEPT-NBR                                   04870002
046300               ,:XL063-ENT-ID                                     04880002
046400               ,:XL063-STATUS-CDE                                 04890002
046500               ,:XL063-CRE-BY-UID                                 04900002
046600               ,:XL063-REJ-CT                                     04910002
046700               ,:XL063-REJ-UID                                    04920002
046800               ,:XL063-ORD-DTE                                    04930002
046900               ,:XL063-REVISION-CT                                04940002
047000               ,:XL063-ADR-SEQ-NBR                                04950002
047100               ,:XL063-DEST-KNOWN-IND                             04960002
047200               ,:XL063-RLSE-IND                                   04970002
047300               ,:XL063-RLSE-DTE                                   04980002
047400               ,:XL063-ANLYS-HOLD-IND                             04990002
047500               ,:XL063-PLCMNT-CNTRY-CDE                           05000002
047600               ,:XL063-PROD-CNTRY-CDE                             05010002
047700               ,:XL063-UNT-PER-CBMT-QTY                           05020002
047800               ,:XL063-TKT-FMT-NBR                                05030002
047900               ,:XL063-TKT-FMT-DESC                               05040002
048000               ,:XL063-CRE-TMST                                   05050002
048100               ,:XL063-PRG-LAST-ACTVY-DTE                         05060002
048200               ,:XL063-PKGNG-CDE                                  05070002
048300               ,:XL063-SEASET-YR                                  05080002
048400               ,:XL063-SEASET-SHRT-NM                             05090002
048500               ,:XL063-QTA-CTG-CDE                                05100002
048600               ,:XL063-PO-IN-RMS-IND                              05110002
048700               ,:XL063-RMS-PO-UPD-TMST                            05110105
048800               ,:XL063-DUP-SKU-IND                                05110205
048900               ,:XL063-ORIG-PKGNG-CDE                             05110305
049000               ,:XL063-IMPRT-VND-ID                                       
049100               ,:XL063-IMPRT-FCTRY-ID                                     
049200               ,:XL063-DERVD-LBL-TYP-CDE                                  
049300               ,:XL063-DELY-ID:XL063-DELY-ID-NULL                         
049400               ,:XL063-PO-SHRT-CYC-IND                                    
                     ,:XL063-WHSE-RPLNT-IND                                     
049500           FROM   TPURCHS                                         05111002
049600          WHERE  PO_NBR = :PV-PO-NBR-COMP                         05112002
049700            AND  VER_STATUS_CDE = 'A'                             05113002
049800           WITH  UR                                               05114002
049900     END-EXEC.                                                    05115002
050000                                                                  05130002
050100     EVALUATE TRUE                                                05140002
050200         WHEN SQLCODE = ZERO                                      05150002
050300              ADD +1                  TO PV-TABLE-ROW-SELECT-CNT  05160002
050400              SET PS-TABLE-DATA-FOUND TO TRUE                     05170002
050500         WHEN SQLCODE = +100                                      05180002
050600              CONTINUE                                            05190002
050700         WHEN SQLWARN0 NOT EQUAL SPACE                            05200002
050800         WHEN SQLCODE NOT EQUAL ZERO                              05210002
050900              MOVE '9100-SELECT-TABLE' TO PV-PARAGRAPH-NAME       05220006
051000              MOVE PV-PO-NBR-COMP TO PV-PO-NBR                    05231007
051100              MOVE 'SELECT DATA'  TO PV-DB2-OPERATION-MSG-1       05240006
051200              MOVE 'TPURCHS'      TO PV-DB2-TABLE-NAME            05260006
051300              PERFORM 9999-DB2-ABEND                              05270002
051400     END-EVALUATE.                                                05280002
051500                                                                  05290002
051600                                                                  05300002
051700                                                                  05520002
051800* ************************************************************** *05530002
051900* * OPEN OUTPUT EXTRACT FILE                                   * *05540002
052000* ************************************************************** *05550002
052100                                                                  05551002
052200 9700-OPEN-OUT-EXTRACT-FILE.                                      05560002
052300                                                                  05561002
052400     OPEN OUTPUT OUT-EXTRACT-FILE.                                05570002
052500                                                                  05580002
052600                                                                  05590002
052700* ************************************************************** *05600002
052800* * WRITE A RECORD TO THE TABLE EXTRACT FILE                   * *05610002
052900* ************************************************************** *05620002
053000                                                                  05621002
053100 9750-WRITE-EXTRACT-RECORD.                                       05630002
053200                                                                  05631002
053300     WRITE  OUT-EXTRACT-RECORD  FROM  XL063-DCLTPURCHS            05640002
053400     ADD +1 TO PV-EXTRACT-WRITTEN-CNT.                            05650002
053500                                                                  05660002
053600                                                                  05670002
053700* ************************************************************** *05680002
053800* * CLOSE OUTPUT EXTRACT FILE                                  * *05690002
053900* ************************************************************** *05700002
054000                                                                  05701002
054100 9790-CLOSE-OUT-EXTRACT-FILE.                                     05710002
054200                                                                  05711002
054300     CLOSE OUT-EXTRACT-FILE.                                      05720002
054400                                                                  05730002
054500                                                                  04830002
054600* ************************************************************** *04840002
054700* * OPEN OUTPUT ERROR FILE                                     * *04850002
054800* ************************************************************** *04860002
054900                                                                  04870002
055000 9800-OPEN-OUT-ERROR-FILE.                                        04880002
055100                                                                  04890002
055200     OPEN OUTPUT OUT-ERROR-FILE.                                  04900002
055300                                                                  04910002
055400                                                                  04920002
055500* ************************************************************** *04930002
055600* * WRITE A RECORD TO THE TABLE ERROR FILE                     * *04940002
055700* ************************************************************** *04950002
055800                                                                  04960002
055900 9850-WRITE-ERROR-RECORD.                                         04970002
056000                                                                  04980002
056100     WRITE  OUT-ERROR-RECORD    FROM  PV-ERROR-RECORD.            04990002
056200     ADD +1 TO PV-ERROR-WRITTEN-CNT.                              05000002
056300                                                                  05010002
056400                                                                  05020002
056500* ************************************************************** *05030002
056600* * CLOSE OUTPUT ERROR FILE                                    * *05040002
056700* ************************************************************** *05050002
056800                                                                  05060002
056900 9890-CLOSE-OUT-ERROR-FILE.                                       05070002
057000                                                                  05080002
057100     CLOSE OUT-ERROR-FILE.                                        05090002
057200                                                                  05100002
057300                                                                  05110002
057400* ************************************************************** *05120002
057500* * DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *05130002
057600* * AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN          * *05140002
057700* * SQL ERROR OR WARNING CODE OCCURS.                          * *05150002
057800* ************************************************************** *05160002
057900                                                                  05170002
058000 9999-DB2-ABEND.                                                  05180002
058100                                                                  05190002
058200     MOVE SQLCODE TO PV-SQLCODE.                                        02
058300     STRING  'PROGRAM - '    PC-CURRENT-PROGRAM-NAME                    02
058400             ' PARAGRAPH - ' PV-PARAGRAPH-NAME                          02
058500             ' TABLE - '     PV-DB2-TABLE-NAME                          02
058600             ' OPERATION - ' PV-DB2-OPERATION-MSG-1 (1:30)              02
058700             ' SQLCODE --- ' PV-SQLCODE                                 02
058800             ' PO NBR ---- ' PV-PO-NBR-NUM                              04
058900             DELIMITED BY SIZE                                            
059000             INTO PV-ERROR-RECORD.                                        
059100                                                                        03
059200     PERFORM 9850-WRITE-ERROR-RECORD.                                     
059300                                                                        02
