      ******************************************************************00010022
       IDENTIFICATION DIVISION.                                         00020022
      ******************************************************************00030022
                                                                        00040022
       PROGRAM-ID.             TFKUT492.                                00050022
       AUTHOR.                 JACK KRAMER.                             00060022
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070022
       DATE-WRITTEN            MAY 1997.                                00080022
       DATE-COMPILED.                                                   00090022
                                                                        00100022
      ******************************************************************00110022
      *    THIS PROGRAM EXTRACTS DATA FROM THE TRANSFER TABLES AND      00120022
      *  WRITES AN OUTPUT SEQUENTIAL FILE TO BE PASSED TO THE           00130022
      *  ASSUMPTIVE VERSUS POSITIVE RECEIPT REPORT.                     00140022
      ******************************************************************00150022
100404** 10/04/2004 CHANGED BY: RAY GRAF                                00151022
100404**     EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                00152022
081204***************************************************************** 00153022
081204** 12/04/2008 CHANGED BY: DAVID WELLER                            00154022
081204**     EXPAND DISTRICT NUMBER.                                    00155022
      ***************************************************************** 00156022
092811** 09/28/2011 CHANGED BY: CHERI PARMLEY                           00156122
092811**     ADD XST_RTV_LOC_RLTNSHP TABLE TO GET THE RTV LOCATIONS     00156222
      ***************************************************************** 00156322
                                                                        00157022
      ******************************************************************00158022
       ENVIRONMENT DIVISION.                                            00159022
      ******************************************************************00160022
                                                                        00170022
       CONFIGURATION SECTION.                                           00180022
                                                                        00190022
       SOURCE-COMPUTER.        IBM-3090.                                00200022
       OBJECT-COMPUTER.        IBM-3090.                                00210022
                                                                        00220022
       INPUT-OUTPUT SECTION.                                            00230022
                                                                        00240022
       FILE-CONTROL.                                                    00250022
                                                                        00260022
           SELECT TRANSFER-RECEIPTS-FILE                                00270022
               ASSIGN TO OUT01.                                         00280022
                                                                        00290022
           SELECT PROCESS-DATES-FILE                                    00300022
               ASSIGN TO INP01.                                         00310022
      *                                                                 00320022
      ******************************************************************00330022
       DATA DIVISION.                                                   00340022
      ******************************************************************00350022
                                                                        00360022
       FILE SECTION.                                                    00370022
                                                                        00380022
       FD  TRANSFER-RECEIPTS-FILE                                       00390022
           LABEL RECORDS ARE STANDARD                                   00400022
           RECORDING MODE IS F                                          00410022
           BLOCK CONTAINS 0 RECORDS                                     00420022
           RECORD CONTAINS 40 CHARACTERS                                00430022
           DATA RECORD IS TRANSFER-RECEIPTS-RECORD.                     00440022
                                                                        00450022
       01  TRANSFER-RECEIPTS-RECORD PIC X(40).                          00460022
                                                                        00470022
       FD  PROCESS-DATES-FILE                                           00480022
           LABEL RECORDS ARE STANDARD                                   00490022
           RECORDING MODE IS F                                          00500022
           BLOCK CONTAINS 0 RECORDS                                     00510022
           RECORD CONTAINS 16 CHARACTERS.                               00520022
       01  PROCESS-DATES-RECORD            PIC X(16).                   00530022
      *                                                                 00540022
       WORKING-STORAGE SECTION.                                         00550022
                                                                        00560022
      *                                                                 00570022
      *  STANDARD REPORT HEADER FOR A 132 COLUMN REPORT                 00580022
           COPY DPWS132O.                                               00590022
      *                                                                 00600022
      *----------------------------------------------------------------*00610022
      *  DATE VALIDATION CALLING PARAMETER LIST                        *00620022
      *----------------------------------------------------------------*00630022
           COPY DPWS500.                                                00640022
                                                                        00650022
      *                                                                 00660022
      *  RECORD LAYOUT FOR THE PROCESS DATES FILE                       00670022
      *                                                                 00680022
           COPY TFRD029.                                                00690022
                                                                        00700022
      *                                                                 00710022
      *  RECORD LAYOUT FOR THE TRANSFER RECEIPTS FILE                   00720022
      *                                                                 00730022
           COPY TFRD039.                                                00740022
           EJECT                                                        00750022
      *                                                                 00760022
       01  ABEND-CODE                  PIC S9(4)    VALUE ZERO          00770022
                                       COMP SYNC.                       00780022
                                                                        00790022
       01  PS-PROGRAM-SWITCHES.                                         00800022
           05  PS-FIRST-TIME-SW        PIC X(01)    VALUE 'Y'.          00810022
               88  PS-FIRST-TIME                    VALUE 'Y'.          00820022
               88  PS-NOT-FIRST-TIME                VALUE 'N'.          00830022
           05  PS-ITEMS-READ-SW        PIC  X(01)   VALUE 'N'.          00840022
               88  PS-ITEMS-READ                    VALUE 'Y'.          00850022
               88  PS-NO-ITEMS-READ                 VALUE 'N'.          00860022
           05  PS-MORE-DATA-SW         PIC  X(01)   VALUE 'Y'.          00870022
               88  PS-MORE-DATA                     VALUE 'Y'.          00880022
               88  PS-NO-MORE-DATA                  VALUE 'N'.          00890022
092811     05  PS-IS-RTV-LOCS-SW       PIC X(01)    VALUE 'N'.          00891029
092811         88  PS-RTV-LOCS-AT-END               VALUE 'Y'.          00892023
092811         88  PS-NOT-RTV-LOCS-AT-END           VALUE 'N'.          00893023
092811     05  PS-IS-ABBR-FOUND        PIC X(01)    VALUE 'N'.          00894029
092811         88  PS-ABBR-FOUND                    VALUE 'Y'.          00895023
092811         88  PS-NOT-ABBR-FOUND                VALUE 'N'.          00896023
                                                                        00900022
       01  PC-PROGRAM-CONSTANTS.                                        00910022
           05  PC-PROGRAM-NAME         PIC X(08)    VALUE 'TFKUT492'.   00920022
           05  PC-ASSUMPTIVE             PIC  X(02)  VALUE  'AR'.       00930022
           05  PC-POSITIVE               PIC  X(02)  VALUE  'PR'.       00940022
           05  PC-VOIDED                 PIC  X(02)  VALUE  'VD'.       00950022
           05  PC-YES                    PIC  X(01)  VALUE  'Y'.        00960022
           05  PC-NO                     PIC  X(01)  VALUE  'N'.        00970022
           05  PC-1-DAY                  PIC  S9(03) VALUE  +1  COMP-3. 00980022
           05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00990022
                                                           COMP-3.      01000022
           05  PC-MF                     PIC  X(02)  VALUE 'MF'.        01010022
           05  PC-FY                     PIC  X(02)  VALUE 'FY'.        01020022
           05  PC-WN                     PIC  X(02)  VALUE 'WN'.        01030022
100404*    05  PC-MF-RTV-NBR             PIC  S9(03) VALUE +801 COMP-3. 01040022
100404     05  PC-MF-RTV-NBR             PIC  S9(04) VALUE +801 COMP-3. 01050022
100404*    05  PC-WN-RTV-NBR             PIC  S9(03) VALUE +831 COMP-3. 01080022
100404     05  PC-WN-RTV-NBR             PIC  S9(04) VALUE +831 COMP-3. 01090022
                                                                        01100022
       01  PV-PROGRAM-VARIABLES.                                        01110022
           05  PV-RETRY-COUNT          PIC S9(4)    VALUE ZERO          01120022
                                       COMP SYNC.                       01130022
           05  PV-ITEMS-READ           PIC 9(8)    VALUE ZERO.          01140022
           05  PV-NULL-IND             PIC S9(04)  COMP.                01150022
           05  PV-PARAGRAPH-NAME               PIC X(30)   VALUE SPACE. 01160022
           05  PV-DB2-OPERATION                PIC X(30)   VALUE SPACE. 01170022
           05  PV-BEG-POS-TIMESTAMP.                                    01180022
               10  PV-BEG-POS-DATE.                                     01190022
                   15  PV-BEG-POS-CC   PIC 9(02).                       01200022
                   15  PV-BEG-POS-YY   PIC 9(02).                       01210022
                   15  FILLER          PIC X(01)      VALUE '-'.        01220022
                   15  PV-BEG-POS-MM   PIC 9(02).                       01230022
                   15  FILLER          PIC X(01)      VALUE '-'.        01240022
                   15  PV-BEG-POS-DD   PIC 9(02).                       01250022
               10                      PIC X(16) VALUE                  01260022
                                       '-00.00.00.000000'.              01270022
           05  PV-BEG-POS-TMST REDEFINES                                01280022
                               PV-BEG-POS-TIMESTAMP  PIC X(26).         01290022
           05  PV-END-POS-TIMESTAMP.                                    01300022
               10  PV-END-POS-DATE.                                     01310022
                   15  PV-END-POS-CC   PIC 9(02).                       01320022
                   15  PV-END-POS-YY   PIC 9(02).                       01330022
                   15  FILLER          PIC X(01)      VALUE '-'.        01340022
                   15  PV-END-POS-MM   PIC 9(02).                       01350022
                   15  FILLER          PIC X(01)      VALUE '-'.        01360022
                   15  PV-END-POS-DD   PIC 9(02).                       01370022
               10                      PIC X(16) VALUE                  01380022
                                       '-23.59.59.999999'.              01390022
           05  PV-END-POS-TMST REDEFINES                                01400022
                               PV-END-POS-TIMESTAMP  PIC X(26).         01410022
           05  PV-BEG-ASM-TIMESTAMP.                                    01420022
               10  PV-BEG-ASM-DATE     PIC X(10).                       01430022
               10                      PIC X(16) VALUE                  01440022
                                       '-00.00.00.000000'.              01450022
           05  PV-BEG-ASM-TMST REDEFINES                                01460022
                               PV-BEG-ASM-TIMESTAMP  PIC X(26).         01470022
           05  PV-END-ASM-TIMESTAMP.                                    01480022
               10  PV-END-ASM-DATE     PIC X(10).                       01490022
               10                      PIC X(16) VALUE                  01500022
                                       '-23.59.59.999999'.              01510022
           05  PV-END-ASM-TMST REDEFINES                                01520022
                               PV-END-ASM-TIMESTAMP  PIC X(26).         01530022
           05  PV-COUNT                PIC S9(08)    VALUE ZERO COMP-3. 01540022
                                                                        01550022
092811******************************************************************01551022
092811 01  PV-RTV-LOC-TBL.                                              01552022
092811     10  PV-RTV-LOC-ENTRIES OCCURS 10 TIMES.                      01553022
092811         15  PV-RTV-LOC             PIC 9(04).                    01554022
092811         15  PV-RTV-ABBR            PIC X(02).                    01555022
092811 01  SUB                            PIC 9(02) VALUE ZERO.         01558022
092811 01  MAX-SUB                        PIC 9(02) VALUE 10.           01559022
092811 01  NO-RTVS                        PIC 9(02) VALUE ZERO.         01559122
                                                                        01559222
      *---------------------------------------------------------------* 01560022
      *    DB2 AREA FOR TRANSFER MASTER TABLE                         * 01570022
      *---------------------------------------------------------------* 01580022
           EXEC SQL                                                     01590022
                INCLUDE TTFMSTR                                         01600022
           END-EXEC.                                                    01610022
      *---------------------------------------------------------------* 01620022
      *    DB2 AREA FOR TRANSFER TYPE CODE TABLE                      * 01630022
      *---------------------------------------------------------------* 01640022
           EXEC SQL                                                     01650022
                INCLUDE TTFTYCD                                         01660022
           END-EXEC.                                                    01670022
      *---------------------------------------------------------------* 01680022
      *    DB2 AREA FOR TRANSFER RECEIPT TABLE                        * 01690022
      *---------------------------------------------------------------* 01700022
           EXEC SQL                                                     01710022
                INCLUDE TTFRCPT                                         01720022
           END-EXEC.                                                    01730022
      *---------------------------------------------------------------* 01740022
      *    DB2 AREA FOR TRANSFER STATUS TABLE                         * 01750022
      *---------------------------------------------------------------* 01760022
           EXEC SQL                                                     01770022
                INCLUDE TTFSTAT                                         01780022
           END-EXEC.                                                    01790022
      *---------------------------------------------------------------* 01800022
100404*    DB2 AREA FOR XST_LOC TABLE                                 * 01810022
      *---------------------------------------------------------------* 01820022
           EXEC SQL                                                     01821022
100404          INCLUDE XST00001                                        01822022
           END-EXEC.                                                    01823022
      *---------------------------------------------------------------* 01824022
100404*    DB2 AREA FOR XST_LOC_DIST TABLE                            * 01825022
      *---------------------------------------------------------------* 01826022
           EXEC SQL                                                     01827022
100404          INCLUDE XST00002                                        01828022
           END-EXEC.                                                    01829022
                                                                        01830022
092811*----------------------------------------------------------------*01831022
092811* XST_RTV_LOC_RLTNSHP                                             01832022
092811*----------------------------------------------------------------*01833022
092811     EXEC SQL                                                     01834022
092811         INCLUDE XST00135                                         01835022
092811     END-EXEC.                                                    01836022
092811                                                                  01837022
092811*----------------------------------------------------------------*01838022
092811* CURSOR FOR GETTING RTV LOCATIONS FROM XST_RTV_LOC_RLTNSHP       01839022
092811*----------------------------------------------------------------*01839122
092811                                                                  01839222
092811     EXEC SQL                                                     01839322
092811          DECLARE RTV-LOCS-CSR CURSOR FOR                         01839422
092811             SELECT DISTINCT A.RTV_LOC_NBR                        01839522
092811                 FROM  XST_RTV_LOC_RLTNSHP A                      01839622
092811                  WHERE A.EFF_BEG_DTE = (SELECT MAX(EFF_BEG_DTE)  01839722
092811                  FROM  XST_RTV_LOC_RLTNSHP B                     01839822
092811                    WHERE A.RTV_LOC_NBR = B.RTV_LOC_NBR)          01839922
092811                  WITH UR                                         01840022
092811     END-EXEC.                                                    01840122
                                                                        01840222
           EXEC SQL                                                     01841022
               INCLUDE SQLCA                                            01850022
           END-EXEC.                                                    01860022
      *                                                                 01870022
      *  EXTENSION TO THE SQL COMMUNICATIONS AREA FOR EDITING           01880022
      *  SQL CODES FOR DISPLAY                                          01890022
      *                                                                 01900022
           COPY SQLCA2.                                                 01910022
      *                                                                 01920022
      *---------------------------------------------------------------* 01930022
      *  CURSOR TO RETRIEVE THE COUNT OF POSITIVELY RECEIVED TRANSFERS* 01940022
      *  FOR WHICH THERE WAS AN ASSUMPTIVE RECEIPT DURING THE         * 01950022
      *  ASSUMPTIVE TIME FRAME.                                       * 01960022
      *---------------------------------------------------------------* 01970022
           EXEC SQL                                                     01980022
             DECLARE POS-ASM-CSR CURSOR FOR                             01990022
100404             SELECT D.DIST_NBR                                    02000022
                         ,R.STR_NBR                                     02010022
                         ,R.BYP_DTL_CK_IND                              02020022
                         ,COUNT(*)                                      02030022
                   FROM   TTFRCPT      R                                02040022
                         ,TTFSTAT      S                                02050022
                         ,TTFMSTR      M                                02060022
                         ,TTFTYCD      T                                02070022
100404                   ,XST_LOC      L                                02080022
100404                   ,XST_LOC_DIST D                                02090022
                   WHERE  M.XFER_DKEY_ID       = R.XFER_DKEY_ID   AND   02100022
                          S.XFER_DKEY_ID       = R.XFER_DKEY_ID   AND   02110022
                          M.XFER_TYP_CDE       = T.XFER_TYP_CDE   AND   02120022
                          T.BYP_ASMTV_RCPT_IND = :PC-NO           AND   02130022
                          R.RCV_XFER_BEG_TMST  = S.XFER_STAT_TMST AND   02140022
100404                    R.STR_NBR            = L.LOC_NBR        AND   02150022
100404                    L.LOC_NBR            = D.LOC_NBR        AND   02160022
100404                    D.END_DTE           IS NULL             AND   02170022
                          S.XFER_STAT_CDE      = :PC-POSITIVE     AND   02180022
                          S.XFER_DKEY_ID       =                        02190022
                   (SELECT B.XFER_DKEY_ID                               02200022
                     FROM   TTFRCPT A                                   02210022
                           ,TTFSTAT B                                   02220022
                    WHERE  S.XFER_DKEY_ID      = A.XFER_DKEY_ID   AND   02230022
                           A.XFER_DKEY_ID      = B.XFER_DKEY_ID   AND   02240022
                           A.RCV_XFER_BEG_TMST = B.XFER_STAT_TMST AND   02250022
                           B.XFER_STAT_CDE     = :PC-ASSUMPTIVE   AND   02260022
                           A.RCV_XFER_BEG_TMST BETWEEN                  02270022
                                              :PV-BEG-ASM-TMST AND      02280022
                                              :PV-END-ASM-TMST)         02290022
100404           GROUP BY D.DIST_NBR                                    02300022
                         ,R.STR_NBR                                     02310022
                         ,R.BYP_DTL_CK_IND                              02320022
                 WITH UR                                                02330022
               END-EXEC.                                                02340022
                                                                        02350022
      *---------------------------------------------------------------* 02360022
      *  CURSOR TO RETRIEVE THE COUNT OF POSITIVELY RECEIVED TRANSFERS* 02370022
      *  FOR WHICH THERE WAS NO ASSUMPTIVE RECEIPT.                   * 02380022
      *---------------------------------------------------------------* 02390022
           EXEC SQL                                                     02400022
             DECLARE POS-CSR CURSOR FOR                                 02410022
100404             SELECT D.DIST_NBR                                    02420022
                         ,R.STR_NBR                                     02430022
                         ,R.BYP_DTL_CK_IND                              02440022
                         ,COUNT(*)                                      02450022
                   FROM   TTFRCPT      R                                02460022
                         ,TTFSTAT      S                                02470022
                         ,TTFMSTR      M                                02480022
                         ,TTFTYCD      T                                02490022
100404                   ,XST_LOC      L                                02500022
100404                   ,XST_LOC_DIST D                                02510022
                   WHERE  M.XFER_DKEY_ID       = R.XFER_DKEY_ID   AND   02520022
                          S.XFER_DKEY_ID       = R.XFER_DKEY_ID   AND   02530022
                          M.XFER_TYP_CDE       = T.XFER_TYP_CDE   AND   02540022
                          T.BYP_ASMTV_RCPT_IND = :PC-NO           AND   02550022
                          R.RCV_XFER_BEG_TMST  = S.XFER_STAT_TMST AND   02560022
100404                    R.STR_NBR            = L.LOC_NBR        AND   02570022
100404                    L.LOC_NBR            = D.LOC_NBR        AND   02571022
100404                    D.END_DTE           IS NULL             AND   02572022
                          S.XFER_STAT_CDE      = :PC-POSITIVE     AND   02573022
                          R.RCV_XFER_BEG_TMST BETWEEN                   02574022
                                              :PV-BEG-POS-TMST AND      02575022
                                              :PV-END-POS-TMST AND      02576022
                   NOT EXISTS                                           02577022
                     (SELECT *                                          02578022
                      FROM   TTFSTAT B                                  02579022
                      WHERE  B.XFER_DKEY_ID      = R.XFER_DKEY_ID   AND 02580022
                             B.XFER_STAT_CDE     = :PC-ASSUMPTIVE)      02590022
100404           GROUP BY D.DIST_NBR                                    02600022
                         ,R.STR_NBR                                     02610022
                         ,R.BYP_DTL_CK_IND                              02620022
                 WITH UR                                                02630022
               END-EXEC.                                                02640022
                                                                        02650022
      *---------------------------------------------------------------* 02660022
      *  CURSOR TO RETRIEVE THE COUNT OF ASSUMPTIVELY RECEIVED        * 02670022
      *  TRANSFERS FOR WHICH THERE IS NO VOID OR POSITIVE RECEIPT.    * 02680022
      *---------------------------------------------------------------* 02690022
           EXEC SQL                                                     02700022
             DECLARE ASM-CSR CURSOR FOR                                 02710022
100404             SELECT D.DIST_NBR                                    02720022
                         ,R.STR_NBR                                     02730022
                         ,COUNT(*)                                      02740022
                   FROM   TTFRCPT      R                                02750022
                         ,TTFSTAT      S                                02760022
                         ,TTFMSTR      M                                02770022
                         ,TTFTYCD      T                                02780022
100404                   ,XST_LOC      L                                02790022
100404                   ,XST_LOC_DIST D                                02800022
                   WHERE  M.XFER_DKEY_ID       = R.XFER_DKEY_ID   AND   02810022
                          S.XFER_DKEY_ID       = R.XFER_DKEY_ID   AND   02820022
                          M.XFER_TYP_CDE       = T.XFER_TYP_CDE   AND   02830022
                          T.BYP_ASMTV_RCPT_IND = :PC-NO           AND   02840022
                          R.RCV_XFER_BEG_TMST  = S.XFER_STAT_TMST AND   02850022
100404                    R.STR_NBR            = L.LOC_NBR        AND   02860022
100404                    L.LOC_NBR            = D.LOC_NBR        AND   02870022
100404                    D.END_DTE           IS NULL             AND   02880022
                          S.XFER_STAT_CDE      = :PC-ASSUMPTIVE   AND   02890022
                          R.RCV_XFER_BEG_TMST BETWEEN                   02900022
                                              :PV-BEG-ASM-TMST AND      02910022
                                              :PV-END-ASM-TMST AND      02920022
                   NOT EXISTS                                           02930022
                     (SELECT *                                          02940022
                      FROM   TTFSTAT B                                  02950022
                      WHERE  B.XFER_DKEY_ID      = S.XFER_DKEY_ID   AND 02960022
                             B.XFER_STAT_CDE     IN (:PC-VOIDED,        02970022
                                                     :PC-POSITIVE))     02980022
100404           GROUP BY D.DIST_NBR                                    02990022
                         ,R.STR_NBR                                     03000022
                 WITH UR                                                03010022
               END-EXEC.                                                03020022
                                                                        03030022
      *---------------------------------------------------------------* 03040022
      *  CURSOR TO RETRIEVE THE COUNT OF VOIDED TRANSFERS.            * 03050022
      *---------------------------------------------------------------* 03060022
           EXEC SQL                                                     03070022
             DECLARE VOID-CSR CURSOR FOR                                03080022
100404             SELECT D.DIST_NBR                                    03090022
                         ,M.TO_STR_NBR                                  03100022
                         ,COUNT(*)                                      03110022
                   FROM   TTFSTAT      S                                03120022
                         ,TTFMSTR      M                                03130022
                         ,TTFTYCD      T                                03140022
100404                   ,XST_LOC      L                                03150022
100404                   ,XST_LOC_DIST D                                03160022
                   WHERE  M.XFER_DKEY_ID       = S.XFER_DKEY_ID   AND   03170022
                          M.XFER_TYP_CDE       = T.XFER_TYP_CDE   AND   03180022
                          T.BYP_ASMTV_RCPT_IND = :PC-NO           AND   03190022
100404                    M.TO_STR_NBR         = L.LOC_NBR        AND   03200022
100404                    L.LOC_NBR            = D.LOC_NBR        AND   03210022
100404                    D.END_DTE           IS NULL             AND   03220022
                          M.CMPT_XFER_BEG_TMST BETWEEN                  03230022
                                              :PV-BEG-POS-TMST AND      03240022
                                              :PV-END-POS-TMST    AND   03250022
                 S.XFER_STAT_TMST =                                     03260022
                       (SELECT MAX(XFER_STAT_TMST)                      03270022
                        FROM   TTFSTAT                                  03280022
                        WHERE  XFER_DKEY_ID   = M.XFER_DKEY_ID      AND 03290022
                               XFER_STAT_CDE  = :PC-VOIDED)             03300022
100404           GROUP BY D.DIST_NBR                                    03310022
                         ,M.TO_STR_NBR                                  03320022
                 WITH UR                                                03321022
               END-EXEC.                                                03322022
      *----------------------------------------------------------------*03323022
       PROCEDURE DIVISION.                                              03324022
      *----------------------------------------------------------------*03325022
       0000-MAINLINE.                                                   03326022
           PERFORM 1000-INITIALIZE.                                     03327022
           SET PS-MORE-DATA                   TO TRUE.                  03328022
           PERFORM 2000-ASM.                                            03329022
           SET PS-MORE-DATA                   TO TRUE.                  03330022
           PERFORM 3000-POS.                                            03340022
           SET PS-MORE-DATA                   TO TRUE.                  03350022
           PERFORM 4000-POS-ASM.                                        03360022
           SET PS-MORE-DATA                   TO TRUE.                  03370022
           PERFORM 5000-VOID.                                           03380022
                                                                        03390022
           CLOSE TRANSFER-RECEIPTS-FILE                                 03400022
                 PROCESS-DATES-FILE.                                    03410022
           STOP RUN.                                                    03420022
                                                                        03430022
      *----------------------------------------------------------------*03440022
      *  SET UP FOR PROGRAM PROCESSING BY OPENING ALL FILES/ CURSOR     03450022
      *  FILLING THE FIELDS OF THE STANDARD REPORT HEADER,              03460022
      *  READING FIRST RECORD, PRINT HEADINGS.                          03470022
      *----------------------------------------------------------------*03480022
                                                                        03490022
       1000-INITIALIZE.                                                 03500022
           OPEN OUTPUT TRANSFER-RECEIPTS-FILE                           03510022
                INPUT  PROCESS-DATES-FILE.                              03520022
                                                                        03530022
           PERFORM 7000-READ-PROCESS-DATES-FILE.                        03540022
           DISPLAY 'TF029-PROCESS-DATES-RECORD = '                      03550022
               TF029-PROCESS-DATES-RECORD.                              03560022
           MOVE TF029-PROCESS-START-MONTH    TO PV-BEG-POS-MM.          03570022
           MOVE TF029-PROCESS-START-DAY      TO PV-BEG-POS-DD.          03580022
           MOVE TF029-PROCESS-START-CENTURY  TO PV-BEG-POS-CC.          03590022
           MOVE TF029-PROCESS-START-YEAR     TO PV-BEG-POS-YY.          03600022
           MOVE TF029-PROCESS-END-MONTH      TO PV-END-POS-MM.          03610022
           MOVE TF029-PROCESS-END-DAY        TO PV-END-POS-DD.          03620022
           MOVE TF029-PROCESS-END-CENTURY    TO PV-END-POS-CC.          03630022
           MOVE TF029-PROCESS-END-YEAR       TO PV-END-POS-YY.          03640022
      *  ADD 1 TO THE BEGIN POSITIVE RECEIPT DATE TO GET THE BEGIN      03650022
      *  ASSUMPTIVE RECEIPT DATE.                                       03660022
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03670022
           MOVE PV-BEG-POS-DATE           TO DPG52-DB2-ISO-DATE-FMT.    03680022
           SET DPG51-FISCAL-454-CALENDAR                                03690022
               DPG51-INCREMENT-DATE                                     03700022
               DPG52-LK-DTE-ISO-FMT        TO TRUE.                     03710022
           MOVE PC-1-DAY                   TO DPG51-INCR-DECR-DAYS-9.   03720022
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          03730022
                                                   DPG53 DPG54          03740022
                                                   DPG55 DPG56.         03750022
           EVALUATE TRUE                                                03760022
               WHEN DPG54-DATE-VALID                                    03770022
                   MOVE DPG55-DB2-ISO-DATE-FMT TO PV-BEG-ASM-DATE       03780022
               WHEN OTHER                                               03790022
                   DISPLAY '** ABEND **'                                03800022
                   DISPLAY '** PGM = ' PC-PROGRAM-NAME                  03810022
                   DISPLAY '** 1000-INITIALIZE - 1 **'                  03820022
                   DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE. '  03830022
                   DISPLAY '** ERROR MESSAGE = '                        03840022
                           DPG54-ERROR-MESSAGE                          03850022
                   DISPLAY '** DPG51 = ' DPG51                          03860022
                   DISPLAY '** DPG52 = ' DPG52                          03870022
                   DISPLAY '** DPG53 = ' DPG53                          03880022
                   DISPLAY '** DPG54 = ' DPG54                          03890022
                   MOVE +4019 TO ABEND-CODE                             03900022
                   CALL 'ILBOABN0' USING ABEND-CODE                     03910022
           END-EVALUATE.                                                03920022
      *  ADD 1 TO THE END POSITIVE RECEIPT DATE TO GET THE END          03930022
      *  ASSUMPTIVE RECEIPT DATE.                                       03940022
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03950022
           MOVE PV-END-POS-DATE           TO DPG52-DB2-ISO-DATE-FMT.    03960022
           SET DPG51-FISCAL-454-CALENDAR                                03970022
               DPG51-INCREMENT-DATE                                     03980022
               DPG52-LK-DTE-ISO-FMT        TO TRUE.                     03990022
           MOVE PC-1-DAY                   TO DPG51-INCR-DECR-DAYS-9.   04000022
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          04010022
                                                   DPG53 DPG54          04020022
                                                   DPG55 DPG56.         04030022
           EVALUATE TRUE                                                04040022
               WHEN DPG54-DATE-VALID                                    04050022
                   MOVE DPG55-DB2-ISO-DATE-FMT TO PV-END-ASM-DATE       04060022
               WHEN OTHER                                               04070022
                   DISPLAY '** ABEND **'                                04080022
                   DISPLAY '** PGM = ' PC-PROGRAM-NAME                  04090022
                   DISPLAY '** 1000-INITIALIZE - 2 **'                  04100022
                   DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE. '  04110022
                   DISPLAY '** ERROR MESSAGE = '                        04120022
                           DPG54-ERROR-MESSAGE                          04130022
                   DISPLAY '** DPG51 = ' DPG51                          04140022
                   DISPLAY '** DPG52 = ' DPG52                          04150022
                   DISPLAY '** DPG53 = ' DPG53                          04160022
                   DISPLAY '** DPG54 = ' DPG54                          04170022
                   MOVE +4019 TO ABEND-CODE                             04180022
                   CALL 'ILBOABN0' USING ABEND-CODE                     04190022
           END-EVALUATE.                                                04200022
                                                                        04200122
           PERFORM 1300-INITIALIZE-TABLE VARYING SUB                    04201022
               FROM 1 BY 1 UNTIL SUB > MAX-SUB.                         04202022
                                                                        04203022
           MOVE ZERO TO SUB.                                            04204022
                                                                        04205022
           PERFORM 1400-OPEN-RTV-CURSOR.                                04206022
           PERFORM 1500-FETCH-RTV-LOCS                                  04207022
                   UNTIL PS-RTV-LOCS-AT-END OR SUB > MAX-SUB.           04208022
           PERFORM 1600-CLOSE-RTV-CURSOR.                               04209022
                                                                        04209137
092811******************************************************************04209932
092811*  INITIALIZE RTV TABLE                                           04210032
092811******************************************************************04210132
092811 1300-INITIALIZE-TABLE.                                           04210232
092811                                                                  04210332
092811     MOVE ZERO TO PV-RTV-LOC    (SUB)                             04210432
092811                  PV-RTV-ABBR   (SUB).                            04210532
092811                                                                  04210622
092811******************************************************************04210722
092811*  OPEN RTV TABLE                                                 04210822
092811******************************************************************04210922
092811 1400-OPEN-RTV-CURSOR.                                            04211022
092811                                                                  04211122
092811     EXEC SQL                                                     04211222
092811        OPEN RTV-LOCS-CSR                                         04211322
092811     END-EXEC.                                                    04211422
092811                                                                  04211522
092811     EVALUATE TRUE                                                04211622
092811         WHEN SQLCODE = +0                                        04211722
092811             CONTINUE                                             04211822
092811         WHEN SQLCODE = +100                                      04211922
092811             CONTINUE                                             04212022
092811         WHEN OTHER                                               04212122
092811             MOVE '1400-OPEN-RTV-CURSOR '   TO PV-PARAGRAPH-NAME  04212222
092811             MOVE 'OPEN RTV CURSOR       ' TO PV-DB2-OPERATION    04212322
092811             PERFORM 9100-SQL-ERROR                               04212422
092811     END-EVALUATE.                                                04212522
                                                                        04212622
092811******************************************************************04212722
092811*  GET THE RTV LOCATIONS LOAD TO A TABLE                          04212822
092811******************************************************************04212922
092811 1500-FETCH-RTV-LOCS.                                             04213022
                                                                        04213222
092811     ADD +1 TO SUB.                                               04213322
                                                                        04213422
092811     EXEC SQL                                                     04213522
092811         FETCH RTV-LOCS-CSR                                       04213622
092811         INTO   :XST00135-RTV-LOC-NBR                             04213722
092811     END-EXEC                                                     04213822
                                                                        04213922
092811     EVALUATE TRUE                                                04214022
092811         WHEN SQLCODE = +0                                        04214122
092811             MOVE XST00135-RTV-LOC-NBR TO PV-RTV-LOC(SUB)         04214222
092811             MOVE SUB                  TO NO-RTVS                 04214322
092811         WHEN SQLCODE = +100                                      04214422
092811             SET PS-RTV-LOCS-AT-END TO TRUE                       04214522
092811         WHEN OTHER                                               04214622
092811             MOVE '1500-FETCH-RTV-LOCS  '   TO PV-PARAGRAPH-NAME  04214722
092811             MOVE 'FETCH RTV CURSOR      ' TO PV-DB2-OPERATION    04214822
092811             PERFORM 9100-SQL-ERROR                               04214922
092811     END-EVALUATE.                                                04215022
                                                                        04215122
092811     IF PS-NOT-RTV-LOCS-AT-END                                    04215222
092811         EXEC SQL                                                 04215322
092811            SELECT LOC_5_ABBR_NM                                  04215422
092811             INTO :XST00001-LOC-5-ABBR-NM                         04215522
092811              FROM XST_LOC                                        04215622
092811            WHERE LOC_NBR = :XST00135-RTV-LOC-NBR                 04215722
092811              WITH UR                                             04215822
092811         END-EXEC                                                 04215922
                                                                        04216022
092811         EVALUATE TRUE                                            04216122
092811            WHEN SQLCODE = +0                                     04216222
092811               MOVE XST00001-LOC-5-ABBR-NM(4:2) TO                04216330
092811                                           PV-RTV-ABBR(SUB)       04216431
092811            WHEN OTHER                                            04216622
092811               MOVE '1500-FETCH-RTV-LOCS  '   TO PV-PARAGRAPH-NAME04216722
092811               MOVE 'GET XST_LOC ABBREV    ' TO PV-DB2-OPERATION  04216822
092811               PERFORM 9100-SQL-ERROR                             04216922
092811       END-EVALUATE                                               04217022
092811     END-IF.                                                      04217122
                                                                        04217222
092811******************************************************************04217322
092811* CLOSE RTV CURSOR                                                04217422
092811******************************************************************04217522
092811 1600-CLOSE-RTV-CURSOR.                                           04217622
                                                                        04217722
092811     EXEC SQL                                                     04217822
092811         CLOSE RTV-LOCS-CSR                                       04217922
092811     END-EXEC.                                                    04218022
                                                                        04218122
092811     EVALUATE TRUE                                                04218222
092811         WHEN SQLCODE = +0                                        04218322
092811             CONTINUE                                             04218422
092811         WHEN OTHER                                               04218522
092811             MOVE '1600-CLOSE-RTV-CURSOR'   TO PV-PARAGRAPH-NAME  04218622
092811             MOVE 'CLOSE RTV CURSOR      ' TO PV-DB2-OPERATION    04218722
092811             PERFORM 9100-SQL-ERROR                               04218822
092811     END-EVALUATE.                                                04218922
                                                                        04219022
      *----------------------------------------------------------------*04219122
      * CONTROL THE PROCESSING OF THE ASSUMPTIVE RECEIPTS.              04220022
      *----------------------------------------------------------------*04230022
       2000-ASM.                                                        04240022
           PERFORM 2100-OPEN-ASM-CURSOR.                                04250022
           PERFORM                                                      04260022
               UNTIL (PS-NO-MORE-DATA)                                  04270022
               PERFORM 2200-FETCH-ASM                                   04280022
               IF  PS-MORE-DATA                                         04290022
                   PERFORM 2300-PROCESS-ASM                             04300022
               END-IF                                                   04310022
           END-PERFORM.                                                 04320022
           PERFORM 2400-CLOSE-ASM-CURSOR.                               04330022
      *----------------------------------------------------------------*04340022
      * OPEN ASSUMPTIVE RECEIPT CURSOR                                  04350022
      *----------------------------------------------------------------*04360022
       2100-OPEN-ASM-CURSOR.                                            04370022
           EXEC SQL                                                     04380022
                OPEN ASM-CSR                                            04390022
           END-EXEC.                                                    04400022
                                                                        04410022
           EVALUATE TRUE                                                04420022
               WHEN SQLCODE = ZERO                                      04430022
                    CONTINUE                                            04440022
               WHEN OTHER                                               04450022
                   MOVE '2100-OPEN-ASM-CURSOR'   TO PV-PARAGRAPH-NAME   04460022
                   MOVE 'OPEN ASSUMPTIVE CURSOR' TO PV-DB2-OPERATION    04470022
                   PERFORM 9100-SQL-ERROR                               04480022
           END-EVALUATE.                                                04490022
      *----------------------------------------------------------------*04500022
      *    FETCH THE NEXT RECEIPT.                                      04510022
      *----------------------------------------------------------------*04520022
       2200-FETCH-ASM.                                                  04530022
           PERFORM                                                      04540022
               WITH TEST AFTER                                          04550022
               VARYING PV-RETRY-COUNT                                   04560022
               FROM 1 BY 1                                              04570022
               UNTIL PV-RETRY-COUNT GREATER THAN PC-MAX-RETRIES         04580022
                  OR SQLCODE = 0                                        04590022
                  OR SQLCODE = +100                                     04600022
               EXEC SQL                                                 04610022
                    FETCH ASM-CSR                                       04620022
100404              INTO  :XST00002-DIST-NBR                            04630022
100404                   ,:XST00002-LOC-NBR                             04640022
                         ,:PV-COUNT                                     04650022
                          :PV-NULL-IND                                  04660022
               END-EXEC                                                 04670022
                                                                        04680022
               EVALUATE TRUE                                            04690022
                   WHEN SQLCODE = ZERO                                  04700022
                   WHEN SQLCODE = -904                                  04710022
                   WHEN SQLCODE = -913                                  04720022
                        CONTINUE                                        04730022
                   WHEN SQLCODE = +100                                  04740022
                        SET PS-NO-MORE-DATA       TO TRUE               04750022
                   WHEN OTHER                                           04760022
                        MOVE '2200-FETCH-ASM'                           04770022
                                     TO  PV-PARAGRAPH-NAME              04780022
                        MOVE 'FETCH FROM ASSUMPTIVE CURSOR'             04790022
                                            TO PV-DB2-OPERATION         04800022
                       PERFORM 9100-SQL-ERROR                           04810022
               END-EVALUATE                                             04820022
           END-PERFORM.                                                 04830022
           IF  PV-RETRY-COUNT GREATER THAN PC-MAX-RETRIES               04840022
               MOVE '2200-FETCH-ASM'        TO  PV-PARAGRAPH-NAME       04850022
               MOVE 'MAX RETRIES FETCHING CURSOR'                       04860022
                                            TO PV-DB2-OPERATION         04870022
               PERFORM 9100-SQL-ERROR                                   04880022
           END-IF.                                                      04890022
           IF  PV-NULL-IND < ZERO                                       04900022
               MOVE ZEROES                  TO  PV-COUNT                04910022
           END-IF.                                                      04920022
      *----------------------------------------------------------------*04930022
      * PROCESS THE ASSUMPTIVE RECEIPT DATA.                            04940022
      *----------------------------------------------------------------*04950022
       2300-PROCESS-ASM.                                                04960022
           INITIALIZE TF039-XFER-RECEIPTS-RECORD.                       04970022
100404     MOVE XST00002-LOC-NBR             TO TF039-RECV-STR-NBR.     04980022
                                                                        04980422
092811     SET PS-NOT-ABBR-FOUND TO TRUE.                               04980523
092811     PERFORM 5500-FIND-LOC-ABBR                                   04983123
092811         VARYING SUB FROM 1 BY 1                                  04983222
092811         UNTIL   SUB > NO-RTVS OR PS-ABBR-FOUND.                  04983323
092811                                                                  04983523
092811     IF  PS-NOT-ABBR-FOUND                                        04983623
100404         EVALUATE XST00002-LOC-NBR                                04990023
                  WHEN PC-MF-RTV-NBR                                    05000023
081204                MOVE PC-MF                TO TF039-DISTRICT-NMBR-X05010023
                                                                        05020022
                  WHEN PC-WN-RTV-NBR                                    05060023
081204                MOVE PC-WN                TO TF039-DISTRICT-NMBR-X05070023
                                                                        05080022
                  WHEN OTHER                                            05090023
081204                MOVE XST00002-DIST-NBR    TO TF039-DISTRICT-NMBR  05100023
               END-EVALUATE                                             05110023
092811     END-IF.                                                      05111023
                                                                        05120022
           SET TF039-AR                      TO TRUE.                   05130022
           MOVE PV-COUNT                     TO TF039-XFER-COUNT.       05140022
           PERFORM 6000-WRITE-OUTPUT-RECORD.                            05150022
                                                                        05150123
      *----------------------------------------------------------------*05160022
      * CLOSE THE ASSUMPTIVE RECEIPT CURSOR.                            05170022
      *----------------------------------------------------------------*05180022
       2400-CLOSE-ASM-CURSOR.                                           05190022
           EXEC SQL                                                     05200022
                CLOSE ASM-CSR                                           05210022
           END-EXEC.                                                    05220022
      *----------------------------------------------------------------*05230022
      * CONTROL THE PROCESSING OF THE POSITIVE RECEIPTS.                05240022
      *----------------------------------------------------------------*05250022
       3000-POS.                                                        05260022
           PERFORM 3100-OPEN-POS-CURSOR.                                05270022
           PERFORM                                                      05280022
               UNTIL (PS-NO-MORE-DATA)                                  05290022
               PERFORM 3200-FETCH-POS                                   05300022
               IF  PS-MORE-DATA                                         05310022
                   PERFORM 3300-PROCESS-POS                             05320022
               END-IF                                                   05330022
           END-PERFORM.                                                 05340022
           PERFORM 3400-CLOSE-POS-CURSOR.                               05350022
      *----------------------------------------------------------------*05360022
      * OPEN POSITIVE RECEIPT CURSOR                                    05370022
      *----------------------------------------------------------------*05380022
       3100-OPEN-POS-CURSOR.                                            05390022
           EXEC SQL                                                     05400022
                OPEN POS-CSR                                            05410022
           END-EXEC.                                                    05420022
                                                                        05430022
           EVALUATE TRUE                                                05440022
               WHEN SQLCODE = ZERO                                      05450022
                    CONTINUE                                            05460022
               WHEN OTHER                                               05470022
                   MOVE '3100-OPEN-POS-CURSOR'   TO PV-PARAGRAPH-NAME   05480022
                   MOVE 'OPEN POSITIVE CURSOR' TO PV-DB2-OPERATION      05490022
                   PERFORM 9100-SQL-ERROR                               05500022
           END-EVALUATE.                                                05510022
      *----------------------------------------------------------------*05520022
      *    FETCH THE NEXT RECEIPT.                                      05530022
      *----------------------------------------------------------------*05540022
       3200-FETCH-POS.                                                  05550022
           PERFORM                                                      05560022
               WITH TEST AFTER                                          05570022
               VARYING PV-RETRY-COUNT                                   05580022
               FROM 1 BY 1                                              05590022
               UNTIL PV-RETRY-COUNT GREATER THAN PC-MAX-RETRIES         05600022
                  OR SQLCODE = 0                                        05610022
                  OR SQLCODE = +100                                     05620022
               EXEC SQL                                                 05630022
                    FETCH POS-CSR                                       05640022
100404              INTO  :XST00002-DIST-NBR                            05650022
100404                   ,:XST00002-LOC-NBR                             05660022
                         ,:TFRCPT-BYP-DTL-CK-IND                        05670022
                         ,:PV-COUNT                                     05680022
                          :PV-NULL-IND                                  05690022
               END-EXEC                                                 05700022
                                                                        05710022
               EVALUATE TRUE                                            05720022
                   WHEN SQLCODE = ZERO                                  05730022
                   WHEN SQLCODE = -904                                  05740022
                   WHEN SQLCODE = -913                                  05750022
                        CONTINUE                                        05760022
                   WHEN SQLCODE = +100                                  05770022
                        SET PS-NO-MORE-DATA       TO TRUE               05780022
                   WHEN OTHER                                           05790022
                        MOVE '3200-FETCH-POS'                           05800022
                                     TO  PV-PARAGRAPH-NAME              05810022
                        MOVE 'FETCH FROM POSITIVE CURSOR'               05820022
                                            TO PV-DB2-OPERATION         05830022
                       PERFORM 9100-SQL-ERROR                           05840022
               END-EVALUATE                                             05850022
           END-PERFORM.                                                 05860022
           IF  PV-RETRY-COUNT GREATER THAN PC-MAX-RETRIES               05870022
               MOVE '3200-FETCH-POS'        TO  PV-PARAGRAPH-NAME       05880022
               MOVE 'MAX RETRIES FETCHING CURSOR'                       05890022
                                            TO PV-DB2-OPERATION         05900022
               PERFORM 9100-SQL-ERROR                                   05910022
           END-IF.                                                      05920022
           IF  PV-NULL-IND < ZERO                                       05930022
               MOVE ZEROES                  TO  PV-COUNT                05940022
           END-IF.                                                      05950022
      *----------------------------------------------------------------*05960022
      * PROCESS THE POSITIVE RECEIPT DATA.                              05970022
      *----------------------------------------------------------------*05980022
       3300-PROCESS-POS.                                                05990022
           INITIALIZE TF039-XFER-RECEIPTS-RECORD.                       06000022
100404     MOVE XST00002-LOC-NBR             TO TF039-RECV-STR-NBR.     06010022
                                                                        06010324
092811     SET PS-NOT-ABBR-FOUND TO TRUE.                               06011024
092811     PERFORM 5500-FIND-LOC-ABBR                                   06012024
092811         VARYING SUB FROM 1 BY 1                                  06013024
092811         UNTIL   SUB > NO-RTVS OR PS-ABBR-FOUND.                  06014024
092811                                                                  06015024
092811     IF  PS-NOT-ABBR-FOUND                                        06016024
100404         EVALUATE XST00002-LOC-NBR                                06020024
                   WHEN PC-MF-RTV-NBR                                   06030024
081204                MOVE PC-MF                TO TF039-DISTRICT-NMBR-X06040024
                                                                        06050022
                                                                        06080022
                   WHEN PC-WN-RTV-NBR                                   06090024
081204                MOVE PC-WN                TO TF039-DISTRICT-NMBR-X06100024
                                                                        06110022
                   WHEN OTHER                                           06120024
081204                MOVE XST00002-DIST-NBR    TO TF039-DISTRICT-NMBR  06130024
               END-EVALUATE                                             06140024
092811     END-IF.                                                      06141024
                                                                        06142024
           IF TFRCPT-BYP-DTL-CK-IND = PC-YES                            06150022
               SET TF039-PR-AND-NO-DTL-CHK   TO TRUE                    06160022
           ELSE                                                         06170022
               SET TF039-PR-AND-DTL-CHK      TO TRUE                    06180022
           END-IF.                                                      06190022
           MOVE PV-COUNT                     TO TF039-XFER-COUNT.       06200022
           PERFORM 6000-WRITE-OUTPUT-RECORD.                            06210022
      *----------------------------------------------------------------*06220022
      * CLOSE THE POSITIVE RECEIPT CURSOR.                              06230022
      *----------------------------------------------------------------*06240022
       3400-CLOSE-POS-CURSOR.                                           06250022
           EXEC SQL                                                     06260022
                CLOSE POS-CSR                                           06270022
           END-EXEC.                                                    06280022
      *----------------------------------------------------------------*06290022
      * CONTROL THE PROCESSING OF THE POS-ASM RECEIPTS.                 06300022
      *----------------------------------------------------------------*06310022
       4000-POS-ASM.                                                    06320022
           PERFORM 4100-OPEN-POS-ASM-CURSOR.                            06330022
           PERFORM                                                      06340022
               UNTIL (PS-NO-MORE-DATA)                                  06350022
               PERFORM 4200-FETCH-POS-ASM                               06360022
               IF  PS-MORE-DATA                                         06370022
                   PERFORM 4300-PROCESS-POS-ASM                         06380022
               END-IF                                                   06390022
           END-PERFORM.                                                 06400022
           PERFORM 4400-CLOSE-POS-ASM-CURSOR.                           06410022
      *----------------------------------------------------------------*06420022
      * OPEN POS-ASM RECEIPT CURSOR                                     06430022
      *----------------------------------------------------------------*06440022
       4100-OPEN-POS-ASM-CURSOR.                                        06450022
           EXEC SQL                                                     06460022
                OPEN POS-ASM-CSR                                        06470022
           END-EXEC.                                                    06480022
                                                                        06490022
           EVALUATE TRUE                                                06500022
               WHEN SQLCODE = ZERO                                      06510022
                    CONTINUE                                            06520022
               WHEN OTHER                                               06530022
                   MOVE '4100-OPEN-POS-ASM-CURSOR' TO PV-PARAGRAPH-NAME 06540022
                   MOVE 'OPEN POS-ASM CURSOR' TO PV-DB2-OPERATION       06550022
                   PERFORM 9100-SQL-ERROR                               06560022
           END-EVALUATE.                                                06570022
      *----------------------------------------------------------------*06580022
      *    FETCH THE NEXT RECEIPT.                                      06590022
      *----------------------------------------------------------------*06600022
       4200-FETCH-POS-ASM.                                              06610022
           PERFORM                                                      06620022
               WITH TEST AFTER                                          06630022
               VARYING PV-RETRY-COUNT                                   06640022
               FROM 1 BY 1                                              06650022
               UNTIL PV-RETRY-COUNT GREATER THAN PC-MAX-RETRIES         06660022
                  OR SQLCODE = 0                                        06670022
                  OR SQLCODE = +100                                     06680022
               EXEC SQL                                                 06690022
                    FETCH POS-ASM-CSR                                   06700022
100404              INTO  :XST00002-DIST-NBR                            06710022
100404                   ,:XST00002-LOC-NBR                             06720022
                         ,:TFRCPT-BYP-DTL-CK-IND                        06730022
                         ,:PV-COUNT                                     06740022
                          :PV-NULL-IND                                  06750022
               END-EXEC                                                 06760022
                                                                        06770022
               EVALUATE TRUE                                            06780022
                   WHEN SQLCODE = ZERO                                  06790022
                   WHEN SQLCODE = -904                                  06800022
                   WHEN SQLCODE = -913                                  06810022
                        CONTINUE                                        06820022
                   WHEN SQLCODE = +100                                  06830022
                        SET PS-NO-MORE-DATA       TO TRUE               06840022
                   WHEN OTHER                                           06850022
                        MOVE '4200-FETCH-POS-ASM'                       06860022
                                     TO  PV-PARAGRAPH-NAME              06870022
                        MOVE 'FETCH FROM POS-ASM CURSOR'                06880022
                                            TO PV-DB2-OPERATION         06890022
                       PERFORM 9100-SQL-ERROR                           06900022
               END-EVALUATE                                             06910022
           END-PERFORM.                                                 06920022
           IF  PV-RETRY-COUNT GREATER THAN PC-MAX-RETRIES               06930022
               MOVE '4200-FETCH-POS-ASM'    TO  PV-PARAGRAPH-NAME       06940022
               MOVE 'MAX RETRIES FETCHING CURSOR'                       06950022
                                            TO PV-DB2-OPERATION         06960022
               PERFORM 9100-SQL-ERROR                                   06970022
           END-IF.                                                      06980022
           IF  PV-NULL-IND < ZERO                                       06990022
               MOVE ZEROES                  TO  PV-COUNT                07000022
           END-IF.                                                      07010022
      *----------------------------------------------------------------*07020022
      * PROCESS THE POS-ASM RECEIPT DATA.                               07030022
      *----------------------------------------------------------------*07040022
       4300-PROCESS-POS-ASM.                                            07050022
           INITIALIZE TF039-XFER-RECEIPTS-RECORD.                       07060022
100404     MOVE XST00002-LOC-NBR             TO TF039-RECV-STR-NBR.     07070022
                                                                        07070324
092811     SET PS-NOT-ABBR-FOUND TO TRUE.                               07071024
092811     PERFORM 5500-FIND-LOC-ABBR                                   07072024
092811         VARYING SUB FROM 1 BY 1                                  07073024
092811         UNTIL   SUB > NO-RTVS OR PS-ABBR-FOUND.                  07074024
092811                                                                  07075024
092811     IF  PS-NOT-ABBR-FOUND                                        07076024
100404         EVALUATE XST00002-LOC-NBR                                07080024
                   WHEN PC-MF-RTV-NBR                                   07090024
081204                MOVE PC-MF                TO TF039-DISTRICT-NMBR-X07100024
                                                                        07110022
                   WHEN PC-WN-RTV-NBR                                   07150024
081204                MOVE PC-WN                TO TF039-DISTRICT-NMBR-X07160024
                                                                        07170022
                   WHEN OTHER                                           07180024
081204                MOVE XST00002-DIST-NBR    TO TF039-DISTRICT-NMBR  07190024
              END-EVALUATE                                              07200024
092811     END-IF.                                                      07201024
                                                                        07202024
           IF TFRCPT-BYP-DTL-CK-IND = PC-YES                            07210022
               SET TF039-PR-AND-NO-DTL-CHK   TO TRUE                    07220022
           ELSE                                                         07230022
               SET TF039-PR-AND-DTL-CHK      TO TRUE                    07240022
           END-IF.                                                      07250022
           MOVE PV-COUNT                     TO TF039-XFER-COUNT.       07260022
           PERFORM 6000-WRITE-OUTPUT-RECORD.                            07270022
      *----------------------------------------------------------------*07280022
      * CLOSE THE POS-ASM RECEIPT CURSOR.                               07290022
      *----------------------------------------------------------------*07300022
       4400-CLOSE-POS-ASM-CURSOR.                                       07310022
           EXEC SQL                                                     07320022
                CLOSE POS-ASM-CSR                                       07330022
           END-EXEC.                                                    07340022
      *----------------------------------------------------------------*07350022
      * CONTROL THE PROCESSING OF THE VOIDED TRANSFERS.                 07360022
      *----------------------------------------------------------------*07370022
       5000-VOID.                                                       07380022
           PERFORM 5100-OPEN-VOID-CURSOR.                               07390022
           PERFORM                                                      07400022
               UNTIL (PS-NO-MORE-DATA)                                  07410022
               PERFORM 5200-FETCH-VOID                                  07420022
               IF  PS-MORE-DATA                                         07430022
                   PERFORM 5300-PROCESS-VOID                            07440022
               END-IF                                                   07450022
           END-PERFORM.                                                 07460022
           PERFORM 5400-CLOSE-VOID-CURSOR.                              07470022
      *----------------------------------------------------------------*07480022
      * OPEN VOID TRANSFER CURSOR                                       07490022
      *----------------------------------------------------------------*07500022
       5100-OPEN-VOID-CURSOR.                                           07510022
           EXEC SQL                                                     07520022
                OPEN VOID-CSR                                           07530022
           END-EXEC.                                                    07540022
                                                                        07550022
           EVALUATE TRUE                                                07560022
               WHEN SQLCODE = ZERO                                      07570022
                    CONTINUE                                            07580022
               WHEN OTHER                                               07590022
                   MOVE '5100-OPEN-VOID-CURSOR' TO PV-PARAGRAPH-NAME    07600022
                   MOVE 'OPEN VOID CURSOR' TO PV-DB2-OPERATION          07610022
                   PERFORM 9100-SQL-ERROR                               07620022
           END-EVALUATE.                                                07630022
      *----------------------------------------------------------------*07640022
      *    FETCH THE NEXT VOID.                                         07650022
      *----------------------------------------------------------------*07660022
       5200-FETCH-VOID.                                                 07670022
           PERFORM                                                      07680022
               WITH TEST AFTER                                          07690022
               VARYING PV-RETRY-COUNT                                   07700022
               FROM 1 BY 1                                              07710022
               UNTIL PV-RETRY-COUNT GREATER THAN PC-MAX-RETRIES         07720022
                  OR SQLCODE = 0                                        07730022
                  OR SQLCODE = +100                                     07740022
               EXEC SQL                                                 07750022
                    FETCH VOID-CSR                                      07760022
100404              INTO  :XST00002-DIST-NBR                            07770022
100404                   ,:XST00002-LOC-NBR                             07780022
                         ,:PV-COUNT                                     07790022
                          :PV-NULL-IND                                  07800022
               END-EXEC                                                 07810022
                                                                        07820022
               EVALUATE TRUE                                            07830022
                   WHEN SQLCODE = ZERO                                  07840022
                   WHEN SQLCODE = -904                                  07850022
                   WHEN SQLCODE = -913                                  07860022
                        CONTINUE                                        07870022
                   WHEN SQLCODE = +100                                  07880022
                        SET PS-NO-MORE-DATA       TO TRUE               07890022
                   WHEN OTHER                                           07900022
                        MOVE '5200-FETCH-VOID'                          07910022
                                     TO  PV-PARAGRAPH-NAME              07920022
                        MOVE 'FETCH FROM VOID CURSOR'                   07930022
                                            TO PV-DB2-OPERATION         07940022
                       PERFORM 9100-SQL-ERROR                           07950022
               END-EVALUATE                                             07960022
           END-PERFORM.                                                 07970022
           IF  PV-RETRY-COUNT GREATER THAN PC-MAX-RETRIES               07980022
               MOVE '5200-FETCH-VOID'       TO  PV-PARAGRAPH-NAME       07990022
               MOVE 'MAX RETRIES FETCHING CURSOR'                       08000022
                                            TO PV-DB2-OPERATION         08010022
               PERFORM 9100-SQL-ERROR                                   08020022
           END-IF.                                                      08030022
           IF  PV-NULL-IND < ZERO                                       08040022
               MOVE ZEROES                  TO  PV-COUNT                08050022
           END-IF.                                                      08060022
      *----------------------------------------------------------------*08070022
      * PROCESS THE VOID TRANSFER DATA.                                 08080022
      *----------------------------------------------------------------*08090022
       5300-PROCESS-VOID.                                               08100022
           INITIALIZE TF039-XFER-RECEIPTS-RECORD.                       08110022
100404     MOVE XST00002-LOC-NBR             TO TF039-RECV-STR-NBR.     08120022
092811     SET PS-NOT-ABBR-FOUND TO TRUE.                               08121024
092811     PERFORM 5500-FIND-LOC-ABBR                                   08122024
092811         VARYING SUB FROM 1 BY 1                                  08123024
092811         UNTIL   SUB > NO-RTVS OR PS-ABBR-FOUND.                  08124024
092811                                                                  08125024
092811     IF  PS-NOT-ABBR-FOUND                                        08126024
100404         EVALUATE XST00002-LOC-NBR                                08130024
                   WHEN PC-MF-RTV-NBR                                   08140024
                      MOVE PC-MF                TO TF039-DISTRICT-NMBR-X08150024
                                                                        08160022
                   WHEN PC-WN-RTV-NBR                                   08200024
081204                MOVE PC-WN                TO TF039-DISTRICT-NMBR-X08210024
                                                                        08220022
                   WHEN OTHER                                           08230024
081204                MOVE XST00002-DIST-NBR    TO TF039-DISTRICT-NMBR  08240024
               END-EVALUATE                                             08250024
092811     END-IF.                                                      08251024
                                                                        08252024
           SET TF039-VOID                    TO TRUE.                   08260022
           MOVE PV-COUNT                     TO TF039-XFER-COUNT.       08270022
           PERFORM 6000-WRITE-OUTPUT-RECORD.                            08280022
      *----------------------------------------------------------------*08290022
      * CLOSE THE VOID TRANSFER CURSOR.                                 08300022
      *----------------------------------------------------------------*08310022
       5400-CLOSE-VOID-CURSOR.                                          08320022
           EXEC SQL                                                     08330022
                CLOSE VOID-CSR                                          08340022
           END-EXEC.                                                    08350022
                                                                        08350123
      *----------------------------------------------------------------*08351023
      * FIND THE RTV LOCATIONS ABBREVIATION                             08352023
      *----------------------------------------------------------------*08353023
092811 5500-FIND-LOC-ABBR.                                              08354023
                                                                        08354323
092811     IF XST00002-LOC-NBR = PV-RTV-LOC(SUB)                        08355023
092811         MOVE PV-RTV-ABBR(SUB) TO TF039-DISTRICT-NMBR-X           08356023
092811         SET PS-ABBR-FOUND TO TRUE                                08356237
092811     END-IF.                                                      08357023
                                                                        08358023
      *----------------------------------------------------------------*08360022
      *  WRITE A RECORD TO THE OUTPUT FILE.                            *08370022
      *----------------------------------------------------------------*08380022
       6000-WRITE-OUTPUT-RECORD.                                        08390022
           WRITE TRANSFER-RECEIPTS-RECORD                               08400022
               FROM TF039-XFER-RECEIPTS-RECORD                          08410022
           END-WRITE.                                                   08420022
      *----------------------------------------------------------------*08430022
      *  READ THE SCHEDULE DATE CONTROL CARD.                          *08440022
      *----------------------------------------------------------------*08450022
       7000-READ-PROCESS-DATES-FILE.                                    08460022
           READ PROCESS-DATES-FILE                                      08470022
               INTO TF029-PROCESS-DATES-RECORD                          08480022
           END-READ.                                                    08490022
      ******************************************************************08500022
      *  FORMAT A DB2 ERROR MESSAGE, RELEASE ALL LOCKS, AND ABEND THE  *08510022
      *  PROGRAM.                                                      *08520022
      ******************************************************************08530022
       9100-SQL-ERROR.                                                  08540022
           MOVE SQLCODE TO SQLCODE2.                                    08550022
           MOVE SQLERRD(3) TO SQLERRD3.                                 08560022
           DISPLAY '** ABEND **'.                                       08570022
           DISPLAY 'TFKUT492 - SQL ERROR'.                              08580022
           DISPLAY '       SQLCODE = ' SQLCODE2.                        08590022
           DISPLAY '      SQLWARN0 = ' SQLWARN0.                        08600022
           DISPLAY '      SQLWARN1 = ' SQLWARN1.                        08610022
           DISPLAY '      SQLWARN2 = ' SQLWARN2.                        08620022
           DISPLAY '      SQLWARN3 = ' SQLWARN3.                        08630022
           DISPLAY '      SQLWARN4 = ' SQLWARN4.                        08640022
           DISPLAY '      SQLWARN5 = ' SQLWARN5.                        08650022
           DISPLAY '      SQLWARN6 = ' SQLWARN6.                        08660022
           DISPLAY '      SQLWARN7 = ' SQLWARN7.                        08670022
           DISPLAY 'ROWS PROCESSED = ' SQLERRD3.                        08680022
           DISPLAY                    '** PARAGRAPH ** = '              08690022
                                       PV-PARAGRAPH-NAME.               08700022
           DISPLAY                    '** OPERATION ** = '              08710022
                                       PV-DB2-OPERATION.                08720022
                                                                        08730022
           EXEC SQL                                                     08740022
               COMMIT                                                   08750022
           END-EXEC.                                                    08760022
                                                                        08770022
           MOVE +4013 TO ABEND-CODE.                                    08780022
           CALL 'ILBOABN0' USING ABEND-CODE.                            08790022
                                                                        08800022
