       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    MLKUP972.                                         00020008
       AUTHOR.        B. GRAHAM - STRATAGEM.                            00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  07/08/07.                                         00050000
       DATE-COMPILED.                                                   00060000
                                                                        00070000
      ******************************************************************00080000
      * THIS PROGRAM WILL INSERT EIC 2 CORRECTIONS FOR UNKNOWN /        00090000
      * UNKNOWN USING LOCATION 400 SUB CLASS 10                         00100000
      ******************************************************************00110000
                                                                        00120000
      ******************************************************************00130000
       ENVIRONMENT DIVISION.                                            00140000
      ******************************************************************00150000
                                                                        00160000
       CONFIGURATION SECTION.                                           00170000
                                                                        00180000
       SOURCE-COMPUTER.        IBM-3090.                                00190000
       OBJECT-COMPUTER.        IMB-3090.                                00200000
                                                                        00210000
       INPUT-OUTPUT SECTION.                                            00220000
                                                                        00230000
       FILE-CONTROL.                                                    00240000
           SELECT CNTL-DATE-FILE                                        00250000
               ASSIGN TO INP01.                                         00260000
           SELECT EIC-2-INPUT-FILE                                      00270000
               ASSIGN TO INP02.                                         00280000
      ******************************************************************00290000
       DATA DIVISION.                                                   00300000
      ******************************************************************00310000
                                                                        00320000
       FILE SECTION.                                                    00330000
                                                                        00340000
       FD  CNTL-DATE-FILE                                               00350000
           RECORDING  MODE IS F.                                        00360000
       01  CNTL-DATE-REC                    PIC X(80).                  00370000
                                                                        00380000
       FD  EIC-2-INPUT-FILE                                             00390000
           RECORDING  MODE IS F.                                        00400000
       01  EIC-2-INPUT-REC                  PIC X(017).                 00410000
                                                                        00420000
       WORKING-STORAGE SECTION.                                         00430000
                                                                        00440000
       01  ABEND-CODE                        PIC S9(4) VALUE ZEROS      00450000
                                                       COMP SYNC.       00460000
           88  AC-OTHER-ERROR                          VALUE +4003.     00470000
           88  AC-SQL-ERROR                            VALUE +4013.     00480000
                                                                        00490000
       01  PS-PROGRAM-SWITCHES.                                         00500000
           05  PS-EIC-2-AT-END-SW            PIC X     VALUE 'N'.       00510000
               88  PS-EIC-2-AT-END-YES                 VALUE 'Y'.       00520000
               88  PS-EIC-2-AT-END-NO                  VALUE 'N'.       00530000
                                                                        00540000
       01  ABEND-CODE-SQL              PIC S9(04)  VALUE ZERO COMP SYNC.00550000
                                                                        00560000
       01  PC-PROGRAM-CONSTANTS.                                        00570000
           05 PC-PGM-NAME                  PIC X(8)  VALUE 'MLKUP972'.  00580008
           05 PC-MAX-RETRIES               PIC S9(03) VALUE 3 COMP-3.   00590000
           05 PC-W                         PIC X(01) VALUE 'W'.         00600000
                                                                        00610000
       01  PV-PROGRAM-VARIABLES.                                        00620000
           05 PV-DATE-FIELDS.                                           00630000
              10 PV-PROCESS-DATE             PIC   X(10).               00640000
           05 PV-GET-END-INV-COST2-AMT       PIC S9(11)V99 COMP-3       00650000
                                                        VALUE ZEROS.    00660000
           05 PV-GET-INV-COST-ADJ2-AMT       PIC S9(11)V99 COMP-3       00661003
                                                        VALUE ZEROS.    00662003
           05 PV-MISC.                                                  00670000
              10 PV-RETRY-COUNTER            PIC S9(04) COMP.           00680000
              10 PV-PARAGRAPH-NAME           PIC X(30)  VALUE SPACES.   00690000
              10 PV-DB2-DATE-EXISTS          PIC X(01).                 00700000
              10 PV-DEPT-9                  PIC S9(04)V COMP-3 VALUE 0. 00710000
              10 PV-DISP-MDSE-LVL-ID         PIC 9(09).                 00720000
              10 PV-DISP-DEPT-NBR            PIC 9(05).                 00730000
              10 PV-DISP-PARTN-NBR           PIC 9(04).                 00740000
              10 PV-SAVE-PARTN-NBR           PIC S9(04) COMP VALUE 0.   00750000
           05 PV-SQLCODE                     PIC S9(04) VALUE ZERO.     00760000
           05 PV-TOTALS.                                                00770000
              10  PA-INPUT-COUNT             PIC   9(11) VALUE ZEROS.   00780000
              10  PA-INSERT-COUNT            PIC  9(11) VALUE ZEROS.    00790000
              10  PA-UPDATE-COUNT            PIC  9(11)                 00800000
                                                     VALUE ZERO.        00810000
                                                                        00820000
       01  PV-EIC-2-INPUT-REC.                                          00830000
           10 PV-EIC-TYPE-REV               PIC   X(03).                00840000
           10 PV-EIC-DEPT-NBR               PIC   S9(04)V COMP-3.       00850000
           10 PV-EIC-ML-LO-MDSE-LVL-ID      PIC  S9(9) COMP.            00860000
           10 PV-EIC-END-INV-COST2-AMT      PIC  S9(11)V9(2) COMP-3.    00870000
                                                                        00880000
                                                                        00890000
                                                                        00900000
      ***************************************************************** 00910000
      *  CONTROL CARD WITH DATE FOR CURSOR.                             00920000
      ***************************************************************** 00930000
       01  CC-CONTROL-CARD.                                             00940000
           05  CC-PROC-DATE-ISO                PIC X(10).               00950000
           05  CC-PROC-DATE-RDF  REDEFINES                              00960000
               CC-PROC-DATE-ISO.                                        00970000
               10  CC-PROC-CC                  PIC X(02).               00980000
               10  CC-PROC-YY                  PIC X(02).               00990000
               10  FILLER                      PIC X(01).               01000000
               10  CC-PROC-MM                  PIC X(02).               01010000
               10  FILLER                      PIC X(01).               01020000
               10  CC-PROC-DD                  PIC X(02).               01030000
           05  FILLER                          PIC X(70).               01040000
                                                                        01050000
      ******************************************************************01060000
      *  DB2 SQL ERROR MESSAGE FORMAT AREA                              01070000
      ******************************************************************01080000
           COPY DPWS004.                                                01090000
                                                                        01100000
      ******************************************************************01110000
      * DATE ATTRIBUTE TABLE                                            01120000
      ******************************************************************01130000
           EXEC SQL                                                     01140000
             INCLUDE TDTATTR                                            01150000
           END-EXEC.                                                    01160000
      ******************************************************************01170000
      * PARTITION NUMBER TABLE                                          01180000
      ******************************************************************01190000
           EXEC SQL                                                     01200000
             INCLUDE MLT00003                                           01210000
           END-EXEC.                                                    01220000
      ******************************************************************01230000
      * PARTITION BAL TABLE                                             01240000
      ******************************************************************01250000
           EXEC SQL                                                     01260000
             INCLUDE MLT00002                                           01270000
           END-EXEC.                                                    01280000
      ******************************************************************01290000
      * MLT_WKLY_SUM TABLE                                              01300001
      ******************************************************************01310000
           EXEC SQL                                                     01320000
             INCLUDE MLT00005                                           01330000
           END-EXEC.                                                    01340000
      ***************************************************************** 01350000
      *    DB2 AREA FOR COMMUNICATIONS                                * 01360000
      ***************************************************************** 01370000
           EXEC SQL                                                     01380000
                INCLUDE SQLCA                                           01390000
           END-EXEC.                                                    01400000
                                                                        01410000
                                                                        01420000
      ******************************************************************01430000
       PROCEDURE DIVISION.                                              01440000
      ******************************************************************01450000
                                                                        01460000
       0000-MAINLINE.                                                   01470000
                                                                        01480000
           PERFORM 1000-INITIALIZE                                      01490000
                                                                        01500000
           SET PS-EIC-2-AT-END-NO TO TRUE.                              01510000
                                                                        01520000
           PERFORM 2000-PROCESS-EIC-2                                   01530000
               UNTIL PS-EIC-2-AT-END-YES.                               01540000
                                                                        01550000
           DISPLAY 'PA-INPUT-COUNT    ' PA-INPUT-COUNT.                 01560000
           DISPLAY 'PA-INSERT-COUNT   ' PA-INSERT-COUNT.                01570000
           DISPLAY 'PA-UPDATE-COUNT   ' PA-UPDATE-COUNT.                01580000
                                                                        01590000
           CLOSE CNTL-DATE-FILE                                         01600000
                 EIC-2-INPUT-FILE.                                      01610000
                                                                        01620000
           STOP RUN.                                                    01630000
                                                                        01640000
      ******************************************************************01650000
      *  PERFORM THE NECESSARY INITIALIZATION STEPS                     01660000
      ******************************************************************01670000
       1000-INITIALIZE.                                                 01680000
                                                                        01690000
           OPEN INPUT  CNTL-DATE-FILE                                   01700000
                       EIC-2-INPUT-FILE.                                01710000
                                                                        01720000
           PERFORM 9000-READ-CNTL-DTE.                                  01730000
                                                                        01740000
           PERFORM 3000-GET-PROCESS-DATE-INFO.                          01750000
                                                                        01760000
                                                                        01770000
      ******************************************************************01780000
      *  PROCESS EIC 2 CORRECTIONS FOR UNKNOWN/UNKNOWN                  01790000
      ******************************************************************01800000
                                                                        01810000
       2000-PROCESS-EIC-2.                                              01820000
                                                                        01830000
           PERFORM 2900-READ-EIC-2-REC.                                 01840000
                                                                        01850000
           IF PS-EIC-2-AT-END-NO                                        01860000
               PERFORM 2050-BUILD-UPDATE-REC                            01870000
               PERFORM 2100-DO-INSERT-UPDATE                            01880000
            END-IF.                                                     01890000
                                                                        01900000
                                                                        01910000
       2050-BUILD-UPDATE-REC.                                           01920000
                                                                        01930000
           INITIALIZE DCLMLT00005.                                      01940000
                                                                        01950000
           MOVE PV-EIC-DEPT-NBR           TO MLT00005-DEPT-NBR.         01960000
           MOVE PV-EIC-ML-LO-MDSE-LVL-ID  TO                            01970000
                                     MLT00005-ML-LO-MDSE-LVL-ID.        01980000
           MOVE PV-EIC-END-INV-COST2-AMT  TO                            01990000
                                     MLT00005-END-INV-COST2-AMT.        02000000
           MOVE PV-EIC-END-INV-COST2-AMT  TO                            02001003
                                     MLT00005-INV-COST-ADJ2-AMT.        02002003
           MOVE CC-PROC-DATE-ISO          TO  MLT00005-FSCL-WK-END-DTE. 02010000
           MOVE 10                        TO  MLT00005-MAJ-CL-NBR.      02020000
           MOVE 10                        TO  MLT00005-SUB-CL-NBR.      02030000
           MOVE 400                       TO  MLT00005-LOC-NBR.         02040000
                                                                        02050000
           IF PV-EIC-DEPT-NBR = PV-DEPT-9                               02060000
               MOVE PV-SAVE-PARTN-NBR     TO  MLT00005-PARTN-NBR        02070000
           ELSE                                                         02080000
               PERFORM 2075-LOOK-UP-PARTN                               02090000
               MOVE PV-EIC-DEPT-NBR TO PV-DEPT-9                        02100000
               MOVE MLT00005-PARTN-NBR  TO PV-SAVE-PARTN-NBR            02110000
               MOVE PV-DEPT-9           TO PV-DISP-DEPT-NBR             02120000
               MOVE MLT00005-PARTN-NBR  TO PV-DISP-PARTN-NBR            02130000
               DISPLAY 'PV-DISP-DEPT-NBR  ' PV-DISP-DEPT-NBR            02140000
               DISPLAY 'PV-DISP-PARTN-NBR ' PV-SAVE-PARTN-NBR           02150000
           END-IF.                                                      02160000
                                                                        02170000
       2075-LOOK-UP-PARTN.                                              02180000
                                                                        02190000
           EXEC SQL                                                     02200000
                SELECT PARTN_NBR                                        02210000
                    INTO   :MLT00005-PARTN-NBR                          02220000
                FROM MLT_PARTN_CNTL A                                   02230000
                    ,MLT_PARTN_BAL  B                                   02240000
                WHERE B.DEPT_NBR = :MLT00005-DEPT-NBR                   02250000
                  AND A.TBL_TM_LVL_CDE = B.TBL_TM_LVL_CDE               02260000
                  AND A.TBL_TM_LVL_CDE = :PC-W                          02270000
                  AND A.DEPT_GP_CDE = B.DEPT_GP_CDE                     02280000
                  AND A.FSCL_DTE = :MLT00005-FSCL-WK-END-DTE            02290000
                  AND B.EFF_BEG_DTE <= :MLT00005-FSCL-WK-END-DTE        02300000
                  AND B.EFF_END_DTE >= :MLT00005-FSCL-WK-END-DTE        02310000
                                                                        02320000
           END-EXEC.                                                    02330000
                                                                        02340000
           EVALUATE TRUE                                                02350000
               WHEN SQLCODE = 0                                         02360000
                    CONTINUE                                            02370000
               WHEN SQLWARN0 NOT = SPACES                               02380000
               WHEN SQLCODE < +0                                        02390000
               WHEN SQLCODE > +0                                        02400000
                    MOVE '2075-LOOK-UP-PARTN        '                   02410000
                          TO PV-PARAGRAPH-NAME                          02420000
                    PERFORM 9999-SQL-ABEND                              02430000
           END-EVALUATE.                                                02440000
                                                                        02450000
       2100-DO-INSERT-UPDATE.                                           02460000
                                                                        02470000
           EXEC SQL                                                     02480000
               INSERT INTO MLT_WKLY_SUM                                 02490001
                    (  PARTN_NBR                                        02500000
                     , DEPT_NBR                                         02510000
                     , MAJ_CL_NBR                                       02520000
                     , SUB_CL_NBR                                       02530000
                     , LOC_NBR                                          02540000
                     , ML_LO_MDSE_LVL_ID                                02550000
                     , FSCL_WK_END_DTE                                  02560002
                     , SLS_REG_RTL_AMT                                  02570000
                     , SLS_PROMO_RTL_AMT                                02580000
                     , SLS_PROCLR_RTL_AMT                               02590000
                     , SLS_CLR_RTL_AMT                                  02600000
                     , SLS_OTH_RTL_AMT                                  02610000
                     , MKDN_PLU_RTL_AMT                                 02620000
                     , MKDN_PROMO_RTL_AMT                               02630000
                     , MKDN_RGST_RTL_AMT                                02640000
                     , MKDN_GLDST_RTL_AMT                               02650000
                     , MKDN_UMTCH_RTL_AMT                               02660000
                     , MKDN_BYR_RTL_AMT                                 02670000
                     , MKDN_STR_RTL_AMT                                 02680000
                     , MKDN_PRPT_RTL_AMT                                02690000
                     , MKDN_OTH_RTL_AMT                                 02700000
                     , MKDN_RTL_AMT                                     02710000
                     , MKUP_RTL_AMT                                     02720000
                     , XFER_IN_RTL_AMT                                  02730000
                     , XFER_OUT_RTL_AMT                                 02740000
                     , RCPT_RTL_AMT                                     02750000
                     , RCPT_NET_COST_AMT                                02760000
                     , RCPT_GRO_COST_AMT                                02770000
                     , PADJ_RTL_AMT                                     02780000
                     , PADJ_FRGT_COST_AMT                               02790000
                     , PADJ_DISC_COST_AMT                               02800000
                     , PADJ_RTV_COST_AMT                                02810000
                     , PADJ_RTV_RTL_AMT                                 02820000
                     , PADJ_DA_COST_AMT                                 02830000
                     , PADJ_DA_RTL_AMT                                  02840000
                     , PADJ_NET_COST_AMT                                02850000
                     , PADJ_OTH_COST_AMT                                02860000
                     , PADJ_OTH_RTL_AMT                                 02870000
                     , DR_ALW_RTL_AMT                                   02880000
                     , RTV_RTL_AMT                                      02890000
                     , MKUP_INIT_AMT                                    02900000
                     , MKUP_NET_AMT                                     02910000
                     , INV_ADJ_RTL_AMT                                  02920000
                     , ONORD_RTL_AMT                                    02930000
                     , ONORD_COST_AMT                                   02940000
                     , SHNK_RTL_AMT                                     02950000
                     , END_INV_RTL_AMT                                  02960000
                     , END_INV_COST_AMT                                 02970000
                     , INV_COST_ADJ1_AMT                                02980000
                     , INV_COST_ADJ2_AMT                                02990000
                     , END_INV_COST1_AMT                                03000000
                     , END_INV_COST2_AMT                                03010000
                     , ADJ_GRO_MRGN_AMT )                               03020000
               VALUES (:MLT00005-PARTN-NBR                              03030000
                      ,:MLT00005-DEPT-NBR                               03040000
                      ,:MLT00005-MAJ-CL-NBR                             03050000
                      ,:MLT00005-SUB-CL-NBR                             03060000
                      ,:MLT00005-LOC-NBR                                03070000
                      ,:MLT00005-ML-LO-MDSE-LVL-ID                      03080000
                      ,:MLT00005-FSCL-WK-END-DTE                        03090000
                      ,:MLT00005-SLS-REG-RTL-AMT                        03100000
                      ,:MLT00005-SLS-PROMO-RTL-AMT                      03110000
                      ,:MLT00005-SLS-PROCLR-RTL-AMT                     03120000
                      ,:MLT00005-SLS-CLR-RTL-AMT                        03130000
                      ,:MLT00005-SLS-OTH-RTL-AMT                        03140000
                      ,:MLT00005-MKDN-PLU-RTL-AMT                       03150000
                      ,:MLT00005-MKDN-PROMO-RTL-AMT                     03160000
                      ,:MLT00005-MKDN-RGST-RTL-AMT                      03170000
                      ,:MLT00005-MKDN-GLDST-RTL-AMT                     03180000
                      ,:MLT00005-MKDN-UMTCH-RTL-AMT                     03190000
                      ,:MLT00005-MKDN-BYR-RTL-AMT                       03200000
                      ,:MLT00005-MKDN-STR-RTL-AMT                       03210000
                      ,:MLT00005-MKDN-PRPT-RTL-AMT                      03220000
                      ,:MLT00005-MKDN-OTH-RTL-AMT                       03230000
                      ,:MLT00005-MKDN-RTL-AMT                           03240000
                      ,:MLT00005-MKUP-RTL-AMT                           03250000
                      ,:MLT00005-XFER-IN-RTL-AMT                        03260000
                      ,:MLT00005-XFER-OUT-RTL-AMT                       03270000
                      ,:MLT00005-RCPT-RTL-AMT                           03280000
                      ,:MLT00005-RCPT-NET-COST-AMT                      03290000
                      ,:MLT00005-RCPT-GRO-COST-AMT                      03300000
                      ,:MLT00005-PADJ-RTL-AMT                           03310000
                      ,:MLT00005-PADJ-FRGT-COST-AMT                     03320000
                      ,:MLT00005-PADJ-DISC-COST-AMT                     03330000
                      ,:MLT00005-PADJ-RTV-COST-AMT                      03340000
                      ,:MLT00005-PADJ-RTV-RTL-AMT                       03350000
                      ,:MLT00005-PADJ-DA-COST-AMT                       03360000
                      ,:MLT00005-PADJ-DA-RTL-AMT                        03370000
                      ,:MLT00005-PADJ-NET-COST-AMT                      03380000
                      ,:MLT00005-PADJ-OTH-COST-AMT                      03390000
                      ,:MLT00005-PADJ-OTH-RTL-AMT                       03400000
                      ,:MLT00005-DR-ALW-RTL-AMT                         03410000
                      ,:MLT00005-RTV-RTL-AMT                            03420000
                      ,:MLT00005-MKUP-INIT-AMT                          03430000
                      ,:MLT00005-MKUP-NET-AMT                           03440000
                      ,:MLT00005-INV-ADJ-RTL-AMT                        03450000
                      ,:MLT00005-ONORD-RTL-AMT                          03460000
                      ,:MLT00005-ONORD-COST-AMT                         03470000
                      ,:MLT00005-SHNK-RTL-AMT                           03480000
                      ,:MLT00005-END-INV-RTL-AMT                        03490000
                      ,:MLT00005-END-INV-COST-AMT                       03491000
                      ,:MLT00005-INV-COST-ADJ1-AMT                      03492000
                      ,:MLT00005-INV-COST-ADJ2-AMT                      03493000
                      ,:MLT00005-END-INV-COST1-AMT                      03494000
                      ,:MLT00005-END-INV-COST2-AMT                      03495000
                      ,:MLT00005-ADJ-GRO-MRGN-AMT )                     03496000
           END-EXEC.                                                    03497000
                                                                        03498000
           EVALUATE TRUE                                                03499000
               WHEN SQLCODE = 0                                         03499100
                   ADD 1                      TO PA-INSERT-COUNT        03499200
               WHEN SQLCODE = -803                                      03499300
                   PERFORM 2200-GET-EIC-2                               03499400
                   PERFORM 2300-REPLACE-EIC-2                           03499500
               WHEN OTHER                                               03499600
                   DISPLAY                                              03499700
                        ' PA-INPUT-COUNT ' PA-INPUT-COUNT               03499800
                        ' PARTN: ' MLT00005-PARTN-NBR,                  03499900
                        ' DEPT:  ' MLT00005-DEPT-NBR,                   03500000
                        ' MAJCL: ' MLT00005-MAJ-CL-NBR,                 03500100
                        ' SUBCL: ' MLT00005-SUB-CL-NBR,                 03500200
                        ' LOC:   ' MLT00005-LOC-NBR,                    03500300
                        ' ML-LWST-ID: ' MLT00005-ML-LO-MDSE-LVL-ID      03500400
                   MOVE '2100-DO-INSERT-UPDATE    '                     03500500
                                         TO PV-PARAGRAPH-NAME           03500600
                   PERFORM 9999-SQL-ABEND                               03500700
           END-EVALUATE.                                                03500800
                                                                        03500900
                                                                        03501000
       2200-GET-EIC-2.                                                  03502000
                                                                        03503000
           EXEC SQL                                                     03504000
               SELECT                                                   03505000
                       END_INV_COST2_AMT                                03506000
                      ,INV_COST_ADJ2_AMT                                03506105
                 INTO                                                   03507000
                       :PV-GET-END-INV-COST2-AMT                        03508000
                      ,:PV-GET-INV-COST-ADJ2-AMT                        03508103
                 FROM                                                   03509000
                       MLT_WKLY_SUM                                     03510001
                 WHERE PARTN_NBR       = :MLT00005-PARTN-NBR            03520000
                   AND DEPT_NBR        = :MLT00005-DEPT-NBR             03520100
                   AND MAJ_CL_NBR      = :MLT00005-MAJ-CL-NBR           03520200
                   AND SUB_CL_NBR      = :MLT00005-SUB-CL-NBR           03520300
                   AND LOC_NBR         = :MLT00005-LOC-NBR              03520400
                   AND ML_LO_MDSE_LVL_ID = :MLT00005-ML-LO-MDSE-LVL-ID  03520500
           END-EXEC.                                                    03520600
                                                                        03520700
           EVALUATE SQLCODE                                             03520800
               WHEN 0                                                   03520900
                   CONTINUE                                             03521000
               WHEN OTHER                                               03521100
                    DISPLAY '*************************************'     03521200
                    DISPLAY 'ROW IN PROCESS : '                         03521300
                    DISPLAY  PA-INPUT-COUNT                             03521400
                         ' PARTN: ' MLT00005-PARTN-NBR,                 03521500
                         ' DEPT:  ' MLT00005-DEPT-NBR,                  03521600
                         ' MAJCL: ' MLT00005-MAJ-CL-NBR,                03521700
                         ' SUBCL: ' MLT00005-SUB-CL-NBR,                03521800
                         ' LOC:   ' MLT00005-LOC-NBR,                   03521900
                         ' ML-LWST-ID: ' MLT00005-ML-LO-MDSE-LVL-ID     03522000
                    DISPLAY '*************************************'     03523000
                    MOVE '2200-GET-EIC-2 '                              03523100
                                          TO PV-PARAGRAPH-NAME          03523200
                    PERFORM 9999-SQL-ABEND                              03523300
           END-EVALUATE.                                                03523400
                                                                        03523500
      ******************************************************************03523600
      * 2300-REPLACE-EIC-2                                              03523700
      * REPLACE EIC-2  ( ADD INPUT TO EXISTING AMOUNT RETRIEVED ABOVE)  03523800
      ******************************************************************03523900
       2300-REPLACE-EIC-2.                                              03524000
                                                                        03524100
           COMPUTE MLT00005-END-INV-COST2-AMT =                         03524200
                 PV-GET-END-INV-COST2-AMT + PV-EIC-END-INV-COST2-AMT.   03524300
           COMPUTE MLT00005-INV-COST-ADJ2-AMT =                         03524403
                 PV-GET-INV-COST-ADJ2-AMT + PV-EIC-END-INV-COST2-AMT.   03524503
                                                                        03524603
           EXEC SQL                                                     03524703
               UPDATE MLT_WKLY_SUM                                      03524803
                  SET                                                   03524903
                     END_INV_COST2_AMT = :MLT00005-END-INV-COST2-AMT    03525003
                    ,INV_COST_ADJ2_AMT = :MLT00005-INV-COST-ADJ2-AMT    03525107
                 WHERE PARTN_NBR       = :MLT00005-PARTN-NBR            03525206
                   AND DEPT_NBR        = :MLT00005-DEPT-NBR             03525306
                   AND MAJ_CL_NBR      = :MLT00005-MAJ-CL-NBR           03526000
                   AND SUB_CL_NBR      = :MLT00005-SUB-CL-NBR           03526100
                   AND LOC_NBR         = :MLT00005-LOC-NBR              03526200
                   AND ML_LO_MDSE_LVL_ID = :MLT00005-ML-LO-MDSE-LVL-ID  03526300
           END-EXEC.                                                    03526400
                                                                        03526500
           EVALUATE SQLCODE                                             03526600
               WHEN 0                                                   03526700
                    ADD 1                TO PA-UPDATE-COUNT             03526800
               WHEN OTHER                                               03526900
                    DISPLAY '*************************************'     03527000
                    DISPLAY 'ROW IN PROCESS : '                         03527100
                    DISPLAY  PA-INPUT-COUNT                             03527200
                         ' PARTN: ' MLT00005-PARTN-NBR,                 03527300
                         ' DEPT:  ' MLT00005-DEPT-NBR,                  03527400
                         ' MAJCL: ' MLT00005-MAJ-CL-NBR,                03527500
                         ' SUBCL: ' MLT00005-SUB-CL-NBR,                03527600
                         ' LOC:   ' MLT00005-LOC-NBR,                   03527700
                         ' ML-LWST-ID: ' MLT00005-ML-LO-MDSE-LVL-ID     03527800
                    DISPLAY '*************************************'     03527900
                    MOVE '2300-REPLACE-EIC-2    '                       03528000
                                          TO PV-PARAGRAPH-NAME          03528100
                    PERFORM 9999-SQL-ABEND                              03528200
           END-EVALUATE.                                                03528300
                                                                        03528400
                                                                        03528500
                                                                        03528600
       2900-READ-EIC-2-REC.                                             03528700
                                                                        03528800
           READ EIC-2-INPUT-FILE INTO PV-EIC-2-INPUT-REC                03528900
               AT END                                                   03529000
                   SET PS-EIC-2-AT-END-YES TO TRUE.                     03529100
                                                                        03529200
           IF PS-EIC-2-AT-END-NO                                        03529300
               ADD 1 TO PA-INPUT-COUNT                                  03529400
           END-IF.                                                      03529500
                                                                        03529600
                                                                        03529700
      ****************************************************************  03529800
      * VALIDATE THE PROCESS DATE.                                      03529900
      ****************************************************************  03530000
       3000-GET-PROCESS-DATE-INFO.                                      03540000
           PERFORM                                                      03550000
               WITH TEST AFTER                                          03560000
               VARYING PV-RETRY-COUNTER                                 03570000
               FROM 1 BY 1                                              03580000
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03590000
                         OR (SQLCODE = ZERO)                            03600000
                         OR (SQLCODE = 100))                            03610000
                  EXEC SQL                                              03620000
                      SELECT 'Y'                                        03630000
                        INTO :PV-DB2-DATE-EXISTS                        03640000
                        FROM TDTATTR                                    03650000
                       WHERE KY_DTE = :PV-PROCESS-DATE                  03660000
                  END-EXEC                                              03670000
                                                                        03680000
                  EVALUATE TRUE                                         03690000
                      WHEN SQLCODE = 0                                  03700000
                           DISPLAY 'DATE SELECT: '                      03710000
                                  PV-PROCESS-DATE                       03720000
                                  ' SUCCESSFUL'                         03730000
                           CONTINUE                                     03740000
                      WHEN SQLCODE = -904                               03750000
                      WHEN SQLCODE = -913                               03760000
                           CONTINUE                                     03770000
                      WHEN SQLWARN0 NOT = SPACES                        03780000
                      WHEN SQLCODE < +0                                 03790000
                      WHEN SQLCODE > +0                                 03800000
                           MOVE '3000-GET-PROCESS-DATE-INFO'            03810000
                                 TO PV-PARAGRAPH-NAME                   03820000
                           PERFORM 9999-SQL-ABEND                       03830000
                  END-EVALUATE                                          03840000
           END-PERFORM.                                                 03850000
                                                                        03860000
           IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         03870000
              DISPLAY 'RETRIES EXCEEDED FOR PROCESS DATE '              03880000
           END-IF.                                                      03890000
                                                                        03900000
                                                                        03910000
      ******************************************************************03920000
      * 9000-READ-CNTL-DTE.                                             03930000
      ******************************************************************03940000
       9000-READ-CNTL-DTE.                                              03950000
           READ CNTL-DATE-FILE INTO CC-CONTROL-CARD                     03960000
               AT END                                                   03970000
                   DISPLAY '** PROGRAM ABEND **'                        03980000
                   DISPLAY 'MLKUP972  - CONTROL DATE EMPTY'             03990008
                   SET AC-OTHER-ERROR TO TRUE                           04000000
                   CALL 'ILBOABN0' USING ABEND-CODE.                    04010000
                                                                        04020000
           DISPLAY '** MLKUP972 CONTROL CARD:' CNTL-DATE-REC.           04030008
                                                                        04040000
           MOVE CC-PROC-DATE-ISO TO PV-PROCESS-DATE.                    04050000
                                                                        04060000
                                                                        04070000
      ******************************************************************04080000
      *  STANDARD DB2 ERROR ABEND ROUTINE                               04090000
      *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.             04100000
      ******************************************************************04110000
       9999-SQL-ABEND.                                                  04120000
                                                                        04130000
           SET AC-SQL-ERROR           TO TRUE.                          04140000
           DISPLAY '**  ABEND     **'.                                  04150000
           DISPLAY '**  PROGRAM   **  = ' PC-PGM-NAME.                  04160000
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            04170000
                                                                        04180000
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         04190000
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        04200000
                                                                        04210000
           COPY DPPD004.                                                04220000
                                                                        04230000
           CALL 'ILBOABN0'  USING ABEND-CODE.                           04240000
                                                                        04250000
