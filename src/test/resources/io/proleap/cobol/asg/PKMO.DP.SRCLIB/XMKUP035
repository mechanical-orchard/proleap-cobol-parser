      ***************************************************************** 00010001
       IDENTIFICATION DIVISION.                                         00020001
      ***************************************************************** 00030001
                                                                        00040001
       PROGRAM-ID.             XMKUP035.                                00050006
       AUTHOR.                 SUNNY CHEON.                             00060006
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070001
       DATE-WRITTEN            NOVEMBER 2005.                           00080001
       DATE-COMPILED.                                                   00090001
                                                                        00100001
      ******************************************************************00110007
      *  THIS PROGRAM LOAD DATA FROM PLANNING CATEGORY FILE INTO DB2 TAB00120007
      ******************************************************************00240001
      *---------------------------------------------------------------*         
      *    WR/PITS#     DATE        DESCRIPTION                       *         
      *    --------   ----------   ---------------------------------  *         
      *---------------------------------------------------------------*         
                                                                        00250001
      ***************************************************************** 00260001
       ENVIRONMENT DIVISION.                                            00270001
      ***************************************************************** 00280001
                                                                        00290001
       CONFIGURATION SECTION.                                           00300001
                                                                        00310001
       SOURCE-COMPUTER.        IBM-3090.                                00320001
       OBJECT-COMPUTER.        IBM-3090.                                00330001
                                                                        00340001
       INPUT-OUTPUT SECTION.                                            00350001
                                                                        00360001
       FILE-CONTROL.                                                    00370001
                                                                        00380001
           SELECT CATEGORY-DATA-FILE                                    00390008
               ASSIGN TO INP01.                                         00400008
                                                                        00410001
      ******************************************************************00420001
       DATA DIVISION.                                                   00430001
      ******************************************************************00440001
                                                                        00450001
       FILE SECTION.                                                    00460001
                                                                        00470001
       FD  CATEGORY-DATA-FILE                                           00480008
           RECORDING MODE IS F                                          00490001
           BLOCK CONTAINS 0 RECORDS                                     00500001
           LABEL RECORDS ARE STANDARD.                                  00510001
                                                                        00520001
       01  CATEGORY-DATA-RECORD    PIC X(34).                           00530008
                                                                        00540001
      ******************************************************************00550001
       WORKING-STORAGE SECTION.                                         00560001
      ******************************************************************00570001
                                                                        00580001
       01  FILLER                       PIC X(50)  VALUE                00610001
           ' *** WORKING STORAGE STARTS HERE FOR LOADPLAN *** '.        00620006
                                                                        00630007
                                                                        00640007
       01  ABEND-CODE                   PIC S9(04)   VALUE ZERO         00650007
                                                     COMP SYNC.         00660007
       01  PA-PROGRAM-ACCUMULATORS.                                             
                                                                                
           05  PA-RECORDS-READ          PIC 9(07)    VALUE ZERO.                
           05  PA-ROWS-INSERTED         PIC 9(07)    VALUE ZERO.                
                                                                                
       01  PC-PROGRAM-CONSTANTS.                                        00720007
           05  PC-CURRENT-PROGRAM-NAME  PIC X(8)     VALUE 'LOADPLAN'.  00730007
                                                                        00740007
       01  PS-PROGRAM-SWITCHES.                                         00750007
           05  PS-END-OF-FILE-SW                                        00760007
                                        PIC X(1)     VALUE 'N'.         00770007
               88  PS-NOT-END-OF-FILE                VALUE 'N'.         00780007
               88  PS-END-OF-FILE                    VALUE 'Y'.         00790007
                                                                        00800007
      ***************************************************************** 00810007
      *  SQL AND COBOL DECLARATIONS FOR THE CATEGORY TABLE.             00820007
      *  (XMT_PLN_CTG)                                                  00830008
      ***************************************************************** 00840007
           EXEC SQL                                                     00860007
               INCLUDE XMT00014                                         00870008
           END-EXEC.                                                    00880007
      ******************************************************************00900007
      *  FILE LAYOUT FOR CATEGORY DESCRIPTION COPYBOOK.               * 00910007
      ******************************************************************00920007
           COPY HORD024.                                                00930007
      ******************************************************************00950007
      *  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                00960007
      ******************************************************************00970007
           EXEC SQL                                                     00990007
               INCLUDE SQLCA                                            01000007
           END-EXEC.                                                    01010007
      ******************************************************************01030007
      *  DB2 FORMATTED ERROR MESSAGE                                   *01040007
      ******************************************************************01050007
           COPY DPWS004.                                                01060007
      ******************************************************************01080009
       PROCEDURE DIVISION.                                              01090009
      ******************************************************************01100009
                                                                        01110009
       0000-MAINLINE.                                                   01120010
                                                                        01130009
           OPEN INPUT  CATEGORY-DATA-FILE.                              01140009
           PERFORM 1000-DELETE-TABLE.                                           
           PERFORM 2000-READ-CATE-DATA-FILE.                            01160010
                                                                        01170009
           PERFORM 1000-PROCESS-CATE-DATA-FILE                          01180009
               UNTIL PS-END-OF-FILE.                                    01190009
                                                                        01200009
           PERFORM 5000-COMMIT.                                                 
                                                                                
           DISPLAY 'INPUT RECORDS READ: ' PA-RECORDS-READ.                      
           DISPLAY 'ROWS INSERTED:      ' PA-ROWS-INSERTED.                     
                                                                                
           CLOSE       CATEGORY-DATA-FILE.                              01210009
                                                                        01220009
           GOBACK.                                                      01230009
                                                                        01240009
      ******************************************************************01350009
      * 1000-PROCESS-CATE-DATA-FILE                                     01360009
      *  PERFORM MAIN FILE PROCESSING.                                  01370009
      ******************************************************************01380009
       1000-PROCESS-CATE-DATA-FILE.                                     01390009
                                                                        01400009
           MOVE HO024-PLN-CTG-CDE       TO XMT00014-PLN-CTG-CDE                 
           MOVE HO024-PLN-CTG-DESC      TO XMT00014-PLN-CTG-DESC                
                                                                                
           PERFORM 2500-INSERT-TABLE.                                           
                                                                                
           PERFORM 2000-READ-CATE-DATA-FILE.                                    
      ******************************************************************01250009
      * 1000-DELTE-ATE-DATA-FILE.                                       01260010
      ******************************************************************01280009
       1000-DELETE-TABLE.                                               01290010
           EXEC SQL                                                             
               DELETE FROM XMT_PLN_CTG                                          
           END-EXEC                                                             
                                                                                
           EVALUATE SQLCODE                                                     
              WHEN ZERO                                                         
                  DISPLAY 'SUCCESSFULLY DELETE XMT_PLN_CTG'                     
                  DISPLAY HO024-PLN-CTG-CDE ' '                                 
                          HO024-PLN-CTG-DESC ' '                                
                                                                                
              WHEN OTHER                                                        
                  DISPLAY '1000-DELETE-TABLE  '                                 
                  DISPLAY 'ERROR ON DELETE TO XMT_PLN_CTG'                      
                  DISPLAY HO024-PLN-CTG-CDE ' '                                 
                          HO024-PLN-CTG-DESC ' '                                
                  PERFORM 9999-SQL-ABEND                                        
           END-EVALUATE.                                                        
                                                                        01300009
                                                                                
      ******************************************************************01250009
      * 2000-READ-CATE-DATA-FILE.                                       01260010
      *  READ CATEGORY-DATA-FILE.                                       01270009
      ******************************************************************01280009
       2000-READ-CATE-DATA-FILE.                                        01290010
                                                                        01300009
           READ CATEGORY-DATA-FILE INTO HO024-PLAN-CTG-CDE-DATA         01310009
              AT END                                                    01320009
                 SET PS-END-OF-FILE TO TRUE.                            01330009
                                                                                
           IF PS-END-OF-FILE                                                    
               CONTINUE                                                         
           ELSE                                                                 
               ADD 1 TO PA-RECORDS-READ                                         
           END-IF.                                                              
      ******************************************************************01250009
      * 2500-INSERT-TABLE.                                              01260010
      *  INSERT INTO XMT_CATE TABLE                                     01270009
      ******************************************************************01280009
       2500-INSERT-TABLE.                                               01290010
                                                                                
           EXEC SQL                                                             
               INSERT INTO XMT_PLN_CTG                                          
                   (PLN_CTG_CDE                                                 
                  , PLN_CTG_DESC)                                               
               VALUES (: XMT00014-PLN-CTG-CDE                                   
                     , : XMT00014-PLN-CTG-DESC)                                 
           END-EXEC                                                             
                                                                                
           EVALUATE SQLCODE                                                     
              WHEN ZERO                                                         
                  ADD 1 TO PA-ROWS-INSERTED                                     
              WHEN OTHER                                                        
                  DISPLAY '2500-INSERT-TABLE  '                                 
                  DISPLAY 'ERROR ON INSERT TO XMT_PLN_CTG'                      
                  DISPLAY HO024-PLN-CTG-CDE ' '                                 
                          HO024-PLN-CTG-DESC ' '                                
                  PERFORM 9999-SQL-ABEND                                        
           END-EVALUATE.                                                        
      ******************************************************************        
      *  5000-COMMIT.                                                           
      *  COMMIT ALL UPDATES.                                           *        
      ******************************************************************        
       5000-COMMIT.                                                             
                                                                                
           EXEC SQL                                                             
               COMMIT                                                           
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
                CONTINUE                                                        
             WHEN OTHER                                                         
               DISPLAY '5000-COMMIT '                                           
               DISPLAY 'ERROR ON COMMIT '                                       
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
                                                                                
      ******************************************************************        
      *  ABEND THE PROGRAM IN THE EVENT THAT A SQL ERROR OR WARNING    *        
      *  CODE OCCURS.                                                  *        
      ******************************************************************        
       9999-SQL-ABEND.                                                          
                                                                                
           DISPLAY '** ABEND     **'.                                           
      ******************************************************************        
      *  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-  *        
      *  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE       *        
      *  'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE   *        
      *  FORMAT.                                                       *        
      ******************************************************************        
           COPY DPPD004.                                                        
                                                                                
           MOVE +4013 TO ABEND-CODE.                                            
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
