000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    RCKUT121.                                         00040000
000500 AUTHOR.        GERMAN BANDA.                                     00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   MARCH 2003.                                       00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS BATCH DB2 PROGRAM READS A FILE CONTAINING ERRORS CREATED* 00100000
001100*  FROM READING ASN PACKSLIP INFORMATION. THE PROGRAM WILL      * 00110000
001200*  INSERT A ROW TO TSHUNLO TABLE WITH A PBS ERROR CODE IN THE   * 00120000
001300*  SCAN LOC ID. THE PROGRAM WILL ALSO RECYCLE CARTONS THAT WERE * 00130000
001400*  PREVIOUSLY FLAGGED BUT HAVE NOW BEEN CORRECTED IN RCKUP007   * 00140000
001500***************************************************************** 00150000
001807* CHANGE HISTORY                                                * 00160000
001300*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)              * 00170000
001300*     DATE:    11/12/2014                                       * 00180000
001300*      RECOMPILE THE PROGRAM AS THE PO NUMBER FIELD IN THE      * 00190000
001300*      COPYBOOK RCRD052 AND RCRD053 IS INCREASED TO 9 FROM 7.   * 00200000
001400***************************************************************** 00210000
001600 ENVIRONMENT DIVISION.                                            00220000
001700 INPUT-OUTPUT SECTION.                                            00230000
001800                                                                  00240000
001900 FILE-CONTROL.                                                    00250000
002000                                                                  00260000
002100     SELECT INPUT-FILE     ASSIGN TO UT-S-INP01.                  00270000
002200     SELECT ASN-CRTN-UPC-ADD-OUTPUT ASSIGN TO OUT01.              00280000
002300                                                                  00290000
002400***************************************************************** 00300000
002500 DATA DIVISION.                                                   00310000
002600***************************************************************** 00320000
002700 FILE SECTION.                                                    00330000
002800                                                                  00340000
002900 FD  INPUT-FILE                                                   00350000
003000     RECORDING MODE IS F                                          00360000
003100     LABEL RECORDS ARE STANDARD                                   00370000
003200     RECORD CONTAINS 300                                          00380000
003300     BLOCK CONTAINS 0 RECORDS                                     00390000
003400     DATA RECORD IS INPUT-RECORD.                                 00400000
003500 01  INPUT-RECORD                PIC X(300).                      00410000
003600                                                                  00420000
003700 FD  ASN-CRTN-UPC-ADD-OUTPUT                                      00430000
003800     RECORDING MODE IS F                                          00440000
003900     LABEL RECORDS ARE STANDARD                                   00450000
004000     RECORD CONTAINS 150 CHARACTERS                               00460000
004100     BLOCK CONTAINS 0  RECORDS.                                   00470000
004200                                                                  00480000
004300 01  ASN-CRTN-UPC-ADD-OUTPUT-REC   PIC  X(150).                   00490000
004400                                                                  00500000
004500***************************************************************** 00510000
004600 WORKING-STORAGE SECTION.                                         00520000
004700                                                                  00530000
004800 01  PS-PROGRAM-SWITCHES.                                         00540000
004900     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00550000
005000         88  PS-EOF-INPUT-YES                    VALUE 'Y'.       00560000
005100         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00570000
005200     05  PS-INPKSU-CSR-SW             PIC X(01)  VALUE 'N'.       00580000
005300         88  PS-INPKSU-CSR-EOF-YES               VALUE 'Y'.       00590000
005400         88  PS-INPKSU-CSR-EOF-NO                VALUE 'N'.       00600000
005500     05  PS-PBSERR-PROCESS-SW         PIC X(01)  VALUE 'N'.       00610000
005600         88  PS-PBSERR-PROCESS-YES               VALUE 'Y'.       00620000
005700         88  PS-PBSERR-PROCESS-NO                VALUE 'N'.       00630000
005800     05  PS-CARTON-ROWS-INSERTED-SW   PIC X(01)  VALUE 'N'.       00640000
005900         88  PS-CRTN-ROWS-INSERTED-YES           VALUE 'Y'.       00650000
006000         88  PS-CRTN-ROWS-INSERTED-NO            VALUE 'N'.       00660000
006100                                                                  00670000
006200 01  PC-PROGRAM-CONSTANTS.                                        00680000
006300     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'RCKUT121'.00690000
006400     05  PC-MAX-RETRIES               PIC S9(4)  VALUE +3         00700000
006500                                                 COMP SYNC.       00710000
006600     05  PC-DEFAULT-CC-DATE           PIC X(10)  VALUE            00720000
006700                                                     '9999-09-09'.00730000
006800     05  PC-NINES                     PIC S9(09)                  00740000
006900                                                  VALUE +99999999.00750000
007000     05  PC-SYSTEM-DATE               PIC 9(06)  VALUE ZERO.      00760000
007100     05  PC-PBSA                      PIC X(4)   VALUE 'PBSA'.    00770000
007200     05  PC-PBSB                      PIC X(4)   VALUE 'PBSB'.    00780000
007300     05  PC-PBSC                      PIC X(4)   VALUE 'PBSC'.    00790000
007400     05  PC-PBSD                      PIC X(4)   VALUE 'PBSD'.    00800000
007500     05  PC-PBSE                      PIC X(4)   VALUE 'PBSE'.    00810000
007600                                                                  00820000
007700 01  PV-PROGRAM-VARIABLES.                                        00830000
007800     05  PV-RETRY-COUNTER             PIC S9(4)  VALUE +0         00840000
007900                                                 COMP SYNC.       00850000
008000     05  PV-SUB                       PIC S9(3)  VALUE +0         00860000
008100                                                 COMP-3.          00870000
008200     05  PV-DISP-PO                   PIC 999999999.              00880000
008300     05  PV-DISP-SEQ                  PIC 9999.                   00890000
008400     05  PV-DISP-CRTN                 PIC 9(18).                  00900000
008500     05  PV-DISP-STORE                PIC 9(04).                  00910000
008600     05  PV-DISP-DC                   PIC 9(04).                  00920000
008700     05  PV-DISP-VENDOR               PIC X(25).                  00930000
008800     05  PV-DISP-LINE-PKSLIP          PIC 99999.                  00940000
008900     05  PV-DISP-LINE-CRTN            PIC 99999.                  00950000
009000     05  PV-SQLCODE                   PIC S9(9)  VALUE +0.        00960000
009100     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               00970000
009200     05  PV-DISP-COUNT                PIC Z,ZZZ,ZZ9.              00980000
009300     05  PV-DISP-ERRS                 PIC ZZ,ZZ9.                 00990000
009400     05  PV-DISP-ITMS                 PIC ZZ,ZZ9.                 01000000
009500     05  PV-DISP-PKITEM-QTY           PIC ZZ,ZZ9.                 01010000
009600     05  PV-DISP-SHUUPC-QTY-LNE       PIC ZZ,ZZ9.                 01020000
009700     05  PV-DISP-SHUUPC-QTY-CRTN      PIC ZZ,ZZ9.                 01030000
009800     05  PV-RECORDS-READ              PIC S9(9)  VALUE +0.        01040000
009900     05  PV-RECORDS-WRITTEN           PIC S9(9)  VALUE +0.        01050000
010000     05  PV-VENDORS-WRITTEN           PIC S9(9)  VALUE +0.        01060000
010100     05  PV-CARTON-MISMATCH           PIC S9(9)  VALUE +0.        01070000
010200     05  PV-INVALID-IND-CNT           PIC S9(9)  VALUE +0.        01080000
010300     05  PV-STORE-RECORDS-WRITTEN     PIC S9(9)  VALUE +0.        01090000
010400     05  PV-PO-RECORDS-WRITTEN        PIC S9(9)  VALUE +0.        01100000
010500     05  PV-INPKSU-COUNT              PIC S9(9)  VALUE +0 COMP.   01110000
010600     05  PV-PREV-PO                   PIC  S9(9) COMP.            01120000
010700     05  PV-PREV-STORE                PIC  S9(4) COMP.            01130000
010800     05  PV-HOLD-VEND-NME             PIC X(25).                  01140000
010900                                                                  01150000
011000     05  PV-DB2-COUNT                    PIC S9(09)   VALUE +0    01160000
011100                                                      COMP-3.     01170000
011200     05  PV-DB2-COUNT-2                  PIC S9(09)   VALUE +0    01180000
011300                                                      COMP-3.     01190000
011400     05  PV-TROUBLE-COUNT                PIC S9(09)   COMP.       01200000
011500     05  PV-SCN-LOC-ID                   PIC  X(4).               01210000
011600                                                                  01220000
011700 01  DK-DATABASE-KEYS.                                            01230000
011800     05  DK-PO-NBR                    PIC S9(9)  VALUE +0 COMP.   01240000
011900     05  DK-SEQ-NBR                   PIC S9(4)  VALUE +0 COMP.   01250000
012000                                                                  01260000
012100 01  PV-ABEND-FIELDS.                                             01270000
012200     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         01280000
012300                                                 COMP SYNC.       01290000
012400     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'RCKUT121'.01300000
012500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01310000
012600     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01320000
012700     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    01330000
012800     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    01340000
012900     05  PV-ABEND-STRUCTURE-3         PIC  X(08) VALUE SPACES.    01350000
013000     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01360000
013100     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01370000
013200     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01380000
013300     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01390000
013400     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    01400000
013500                                                                  01410000
013600***********************************************************       01420000
013700*  COPYBOOK USED FOR THE INPUT FILE.                     *        01430000
013800***********************************************************       01440000
013900     COPY RCRD053.                                                01450000
014000                                                                  01460000
014100***********************************************************       01470000
014200*  COPYBOOK USED FOR THE OTUPUT FILE.                     *       01480000
014300***********************************************************       01490000
014400     COPY RCRD052.                                                01500000
014500                                                                  01510000
014600***********************************************************       01520000
014700*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       01530000
014800***********************************************************       01540000
014900     COPY DPWS004.                                                01550000
015000                                                                  01560000
015100***********************************************************       01570000
015200*  DB2 SQL COMMUNICATION AREA                             *       01580000
015300***********************************************************       01590000
015400     EXEC SQL                                                     01600000
015500          INCLUDE SQLCA                                           01610000
015600     END-EXEC.                                                    01620000
015700                                                                  01630000
015800***********************************************************       01640000
015900*  DB2 DCLGEN FOR SU - INBOUND EDI PACKLIST/VENDOR        *       01650000
016000*                      SHIPMENT UNIT ASSOCIATION          *       01660000
016100***********************************************************       01670000
016200     EXEC SQL                                                     01680000
016300          INCLUDE TINPKSU                                         01690000
016400     END-EXEC.                                                    01700000
016500                                                                  01710000
016600***********************************************************       01720000
016700*  DB2 DCLGEN FOR SU - SHIPMENT UNIT/UPC ASSOCIATION      *       01730000
016800***********************************************************       01740000
016900     EXEC SQL                                                     01750000
017000          INCLUDE TSHUUPC                                         01760000
017100     END-EXEC.                                                    01770000
017200                                                                  01780000
017300***********************************************************       01790000
017400*  DB2 DCLGEN FOR SHIPMENT TABLE                          *       01800000
017500***********************************************************       01810000
017600     EXEC SQL                                                     01820000
017700          INCLUDE TSHPUNT                                         01830000
017800     END-EXEC.                                                    01840000
017900                                                                  01850000
018000***********************************************************       01860000
018100*  DB2 DCLGEN FOR SU - SHIPT UNIT LOCATION TABLE          *       01870000
018200***********************************************************       01880000
018300     EXEC SQL                                                     01890000
018400          INCLUDE TSHUNLO                                         01900000
018500     END-EXEC.                                                    01910000
018600                                                                  01920000
018700***************************************************************** 01930000
018800*  DB2 DCLGEN FOR PARAMETER TABLE                         *       01940000
018900***********************************************************       01950000
019000     EXEC SQL                                                     01960000
019100          INCLUDE TKRPRPM                                         01970000
019200     END-EXEC.                                                    01980000
019300                                                                  01990000
019400******************************************************************02000000
019500* INPKSU CURSOR                                                  *02010000
019600******************************************************************02020000
019700     EXEC SQL                                                     02030000
019800       DECLARE INPKSU-CSR CURSOR FOR                              02040000
019900         SELECT DISTINCT(A.SHIPT_UNT_ID)                          02050000
020000              , SUM(SHPD_QTY)                                     02060000
020100           FROM TINPKSU A                                         02070000
020200              , TSHUUPC B                                         02080000
020300          WHERE A.PO_NBR        = :INPKSU-PO-NBR                  02090000
020400            AND A.SEQ_NBR       = :INPKSU-SEQ-NBR                 02100000
020500            AND A.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                  02110000
020600            GROUP BY A.SHIPT_UNT_ID                               02120000
020700     END-EXEC.                                                    02130000
020800                                                                  02140000
020900***************************************************************** 02150000
021000 PROCEDURE DIVISION.                                              02160000
021100***************************************************************** 02170000
021200     DISPLAY '**** BEGINNING RCKUT121 ****'.                      02180000
021300     DISPLAY ' '.                                                 02190000
021400                                                                  02200000
021500     OPEN INPUT  INPUT-FILE.                                      02210000
021600     OPEN OUTPUT ASN-CRTN-UPC-ADD-OUTPUT.                         02220000
021700                                                                  02230000
021800     PERFORM 1000-READ-INPUT-FILE.                                02240000
021900                                                                  02250000
022000     IF PS-EOF-INPUT-NO                                           02260000
022100        PERFORM 1100-CHECK-RECYCLE-COUNT                          02270000
022200     END-IF                                                       02280000
022300                                                                  02290000
022400     PERFORM 2000-PROCESS-INPUT-FILE                              02300000
022500       UNTIL PS-EOF-INPUT-YES.                                    02310000
022600                                                                  02320000
022700     CLOSE INPUT-FILE                                             02330000
022800           ASN-CRTN-UPC-ADD-OUTPUT.                               02340000
022900                                                                  02350000
023000     MOVE PV-INVALID-IND-CNT TO PV-DISP-COUNT.                    02360000
023100     DISPLAY 'CARTON ERROR RECORDS     = ' PV-DISP-COUNT.         02370000
023200     MOVE PV-STORE-RECORDS-WRITTEN TO PV-DISP-COUNT.              02380000
023300     DISPLAY 'PO/STORE ERROR COUNT     = ' PV-DISP-COUNT.         02390000
023400     DISPLAY ' '.                                                 02400000
023500     MOVE PV-PO-RECORDS-WRITTEN  TO  PV-DISP-COUNT.               02410000
023600     DISPLAY 'PURCHASE ORDERS FLAGGED  = ' PV-DISP-COUNT.         02420000
023700                                                                  02430000
023800     DISPLAY ' '.                                                 02440000
023900     DISPLAY '****  END OF  RCKUT121  ****'.                      02450000
024000                                                                  02460000
024100     GOBACK.                                                      02470000
024200                                                                  02480000
024300***************************************************************** 02490000
024400 1000-READ-INPUT-FILE.                                            02500000
024500***************************************************************** 02510000
024600     MOVE '1000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       02520000
024700                                                                  02530000
024800     READ INPUT-FILE                                              02540000
024900       INTO RC053-ASN-RECVR-PKSLIP-ERRREC                         02550000
025000         AT END                                                   02560000
025100             SET PS-EOF-INPUT-YES TO TRUE                         02570000
025200                                                                  02580000
025300         NOT AT END                                               02590000
025400             SET PS-EOF-INPUT-NO  TO TRUE                         02600000
025500             ADD +1 TO PV-RECORDS-READ                            02610000
025600             IF RC053-PO-NBR  = INPKSU-PO-NBR                     02620000
025700                 CONTINUE                                         02630000
025800             ELSE                                                 02640000
025900                ADD +1 TO PV-PO-RECORDS-WRITTEN                   02650000
026000             END-IF                                               02660000
026100             MOVE RC053-PO-NBR     TO INPKSU-PO-NBR               02670000
026200             MOVE RC053-SEQ-NBR    TO INPKSU-SEQ-NBR              02680000
026300     END-READ.                                                    02690000
026400                                                                  02700000
026500*----------------------------------------------------------------*02710000
026600* CHECK THE MAXIMUM NUMBER OF TIMES A CARTON WILL BE RECYCLED    *02720000
026700* AND CHECKED FOR ERROR CORRECTIONS                              *02730000
026800*----------------------------------------------------------------*02740000
026900 1100-CHECK-RECYCLE-COUNT.                                        02750000
027000                                                                  02760000
027100     EXEC SQL                                                     02770000
027200          SELECT FUNC_QTY                                         02780000
027300          INTO  :KRPRPM-FUNC-QTY                                  02790000
027400          FROM   TKRPRPM                                          02800000
027500          WHERE  SYS_PRC_FUNC_CDE  = 'PBSRCY'                     02810000
027600            AND  LOC_ID            = 090                          02820000
027700            AND  INTFC_SYS_CDE     = 'KHL'                        02830000
027800            AND  FUNC_PRC_STAT_CDE = 'AC'                         02840000
027900     END-EXEC.                                                    02850000
028000                                                                  02860000
028100     EVALUATE TRUE                                                02870000
028200         WHEN SQLCODE = +0                                        02880000
028300         WHEN SQLCODE = +100                                      02890000
028400             CONTINUE                                             02900000
028500         WHEN SQLWARN0 NOT = SPACE                                02910000
028600         WHEN SQLCODE  NOT = +0                                   02920000
028700             MOVE '1100-CHECK-RECYCLE-COUNT'                      02930000
028800                                          TO PV-ABEND-PARAGRAPH   02940000
028900             MOVE 'SELECT TKRPRPM TABLE'  TO PV-ABEND-STRUCTURE-1 02950000
029000             PERFORM Z999-SQL-ABEND                               02960000
029100     END-EVALUATE.                                                02970000
029200*----------------------------------------------------------------*02980000
029300* PARM VALUE TO DETERMINE IF DC IS TURNED ON TO INSERT INVALID   *02990000
029400* PACK BY STORE ERROR CARTONS ON SHUNLO                          *03000000
029500*----------------------------------------------------------------*03010000
029600 1200-CHECK-TKRPRPM-DC-PBSERR.                                    03020000
029700     MOVE RC053-DC              TO KRPRPM-LOC-ID                  03030000
029800                                                                  03040000
029900     EXEC SQL                                                     03050000
030000          SELECT FUNC_END_TMST                                    03060000
030100          INTO  :KRPRPM-FUNC-END-TMST                             03070000
030200          FROM   TKRPRPM                                          03080000
030300          WHERE  SYS_PRC_FUNC_CDE  = 'PBSERR'                     03090000
030400            AND  LOC_ID            = :KRPRPM-LOC-ID               03100000
030500            AND  INTFC_SYS_CDE     = 'KHL'                        03110000
030600            AND  FUNC_PRC_STAT_CDE = 'AC'                         03120000
030700            AND  FUNC_TXT          = 'Y'                          03130000
030800     END-EXEC.                                                    03140000
030900                                                                  03150000
031000     EVALUATE TRUE                                                03160000
031100         WHEN SQLCODE = +0                                        03170000
031200             SET PS-PBSERR-PROCESS-YES TO TRUE                    03180000
031300         WHEN SQLCODE = +100                                      03190000
031400             SET PS-PBSERR-PROCESS-NO  TO TRUE                    03200000
031500         WHEN SQLWARN0 NOT = SPACE                                03210000
031600         WHEN SQLCODE  NOT = +0                                   03220000
031700             MOVE '1200-CHECK-TKRPRPM-DC-PBSERR'                  03230000
031800                                          TO PV-ABEND-PARAGRAPH   03240000
031900             MOVE 'SELECT TKRPRPM TABLE'  TO PV-ABEND-STRUCTURE-1 03250000
032000             PERFORM Z999-SQL-ABEND                               03260000
032100     END-EVALUATE.                                                03270000
032200***************************************************************** 03280000
032300 2000-PROCESS-INPUT-FILE.                                         03290000
032400***************************************************************** 03300000
032500     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       03310000
032600                                                                  03320000
032700     ADD +1 TO PV-STORE-RECORDS-WRITTEN                           03330000
032800     PERFORM 2120-OPEN-INPKSU-CSR                                 03340000
032900     PERFORM 2160-FETCH-INPKSU-CSR                                03350000
033000       UNTIL PS-INPKSU-CSR-EOF-YES                                03360000
033100     PERFORM 2140-CLOSE-INPKSU-CSR                                03370000
033200                                                                  03380000
033300*COMMIT AFTER INSERTS FOR A NEW PO/SEQ                            03390000
033400     IF PS-CRTN-ROWS-INSERTED-YES                                 03400000
033500         EXEC SQL                                                 03410000
033600            COMMIT                                                03420000
033700         END-EXEC                                                 03430000
033800                                                                  03440000
033900         IF  SQLCODE NOT = +0                                     03450000
034000             DISPLAY '**************************************'     03460000
034100             DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '     03470000
034200             DISPLAY 'INSERT TSHUNLO                        '     03480000
034300             DISPLAY 'RC053-PO-NBR: '                             03490000
034400                      RC053-PO-NBR                                03500000
034500             DISPLAY '**************************************'     03510000
034600             MOVE '2000-PROCESS-INPUT-FILE '                      03520000
034700                                      TO PV-ABEND-PARAGRAPH       03530000
034800             MOVE 'COMMIT FAILED-TSHUNLO'  TO PV-ABEND-STRUCTURE-103540000
034900             PERFORM Z999-SQL-ABEND                               03550000
035000         END-IF                                                   03560000
035100     END-IF                                                       03570000
035200                                                                  03580000
035300     SET PS-CRTN-ROWS-INSERTED-NO TO TRUE.                        03590000
035400                                                                  03600000
035500* GET NEXT INPUT RECORD.                                          03610000
035600     MOVE RC053-PO-NBR     TO PV-PREV-PO.                         03620000
035700     MOVE RC053-DEST-STORE TO PV-PREV-STORE.                      03630000
035800                                                                  03640000
035900     PERFORM 1000-READ-INPUT-FILE.                                03650000
036000                                                                  03660000
036100***************************************************************** 03670000
036200*                                                                 03680000
036300***************************************************************** 03690000
036400 2120-OPEN-INPKSU-CSR.                                            03700000
036500***************************************************************** 03710000
036600     MOVE '2120-OPEN-INPKSU-CSR    ' TO PV-ABEND-PARAGRAPH.       03720000
036700                                                                  03730000
036800     EXEC SQL                                                     03740000
036900         OPEN INPKSU-CSR                                          03750000
037000     END-EXEC                                                     03760000
037100                                                                  03770000
037200     EVALUATE TRUE                                                03780000
037300         WHEN SQLCODE = ZERO                                      03790000
037400             SET PS-INPKSU-CSR-EOF-NO TO TRUE                     03800000
037500                                                                  03810000
037600         WHEN OTHER                                               03820000
037700             PERFORM Z999-SQL-ABEND                               03830000
037800       END-EVALUATE.                                              03840000
037900                                                                  03850000
038000***************************************************************** 03860000
038100 2140-CLOSE-INPKSU-CSR.                                           03870000
038200***************************************************************** 03880000
038300     MOVE '2140-CLOSE-INPKSU-CSR   ' TO PV-ABEND-PARAGRAPH.       03890000
038400                                                                  03900000
038500     EXEC SQL                                                     03910000
038600         CLOSE INPKSU-CSR                                         03920000
038700     END-EXEC                                                     03930000
038800                                                                  03940000
038900     EVALUATE TRUE                                                03950000
039000         WHEN SQLCODE = ZERO                                      03960000
039100             CONTINUE                                             03970000
039200         WHEN OTHER                                               03980000
039300             PERFORM Z999-SQL-ABEND                               03990000
039400       END-EVALUATE.                                              04000000
039500                                                                  04010000
039600***************************************************************** 04020000
039700 2160-FETCH-INPKSU-CSR.                                           04030000
039800***************************************************************** 04040000
039900     MOVE '2160-FETCH-INPKSU-CSR   ' TO PV-ABEND-PARAGRAPH.       04050000
040000                                                                  04060000
040100     EXEC SQL                                                     04070000
040200         FETCH INPKSU-CSR                                         04080000
040300          INTO :INPKSU-SHIPT-UNT-ID                               04090000
040400             , :SHUUPC-SHPD-QTY                                   04100000
040500     END-EXEC.                                                    04110000
040600                                                                  04120000
040700     EVALUATE TRUE                                                04130000
040800         WHEN SQLCODE = +0                                        04140000
040900             SET PS-INPKSU-CSR-EOF-NO  TO TRUE                    04150000
041000**** ***********************************************************  04160000
041100**** IF THE RECORD WAS CREATED FROM THE BAD CARTN FILE            04170000
041200****     CHECK TO SEE IF LNE ERRORS RESOLVED AND UPDATE SHUNLO    04180000
041300****     IF NOT RESOLVED WRITE TO OUPUT FILE                      04190000
041400**** ELSE                                                         04200000
041500****     CREATE PBS  TSHUNLO ENTRIES AND DISPLAY TO LOG           04210000
041600****************************************************************  04220000
041610             IF RC053-UPC-BAD-CRTN-REC = 'Y' AND                  04230000
041620                RC053-UPC-RECYCLE-COUNT > 1                       04240000
041800                PERFORM 2400-PROCESS-UPC-RECYCLE                  04250000
041900             ELSE                                                 04260000
042000                ADD +1 TO PV-INVALID-IND-CNT                      04270000
042100                PERFORM 8000-DISPLAY-ERROR-DATA                   04280000
042200                PERFORM 1200-CHECK-TKRPRPM-DC-PBSERR              04290000
042300                IF PS-PBSERR-PROCESS-YES                          04300000
042400                   PERFORM 3100-INSERT-SHUNLO-RECORD              04310000
042500                END-IF                                            04320000
042600             END-IF                                               04330000
042700         WHEN SQLCODE = +100                                      04340000
042800             SET PS-INPKSU-CSR-EOF-YES TO TRUE                    04350000
042900                                                                  04360000
043000         WHEN SQLWARN0 NOT = SPACE                                04370000
043100         WHEN SQLCODE  NOT = +0                                   04380000
043200             MOVE '2160-FETCH-INPKSU-CSR' TO PV-ABEND-PARAGRAPH   04390000
043300             MOVE PV-DISP-PO              TO PV-ABEND-OPERATION   04400000
043400             MOVE 'FETCH INPKSU CURSOR'   TO PV-ABEND-STRUCTURE-1 04410000
043500             MOVE 'TINPKSU'               TO PV-ABEND-STRUCTURE-2 04420000
043600             PERFORM Z999-SQL-ABEND                               04430000
043700     END-EVALUATE.                                                04440000
043800                                                                  04450000
043900 2400-PROCESS-UPC-RECYCLE.                                        04460000
044000******************************************************************04470000
044100* TROUBLE CHECK -  IF A ROW EXISTS ON TSHUNLO WITH AN ERROR CDE  *04480000
044200* OF 'PBSA''PBSB' OR 'PBSC','PBSD''PBSE'  IF THE CARTON WAS      *04490000
044300* CHECK TO SEE IF THE CARTON WAS                                 *04500000
044400* SCANNED IN CHECK-IN. IF SO, TROUBLE WAS CREATED IN CHECK-IN AND*04510000
044500* THE CARTON WILL NOT BE RECYCLED                                *04520000
044600******************************************************************04530000
044700      IF RC053-UPC-RECYCLE-COUNT  <  KRPRPM-FUNC-QTY              04540001
044800         PERFORM 2600-CHECK-TSHUNLO                               04550000
044900         IF SQLCODE = +0                                          04560000
045000            PERFORM 2610-CHECK-TSHUNLO-2                          04570000
045100            IF PV-DB2-COUNT-2 > 0                                 04580000
045200*TROUBLE CREATED                                                  04590000
045300               CONTINUE                                           04600000
045400            ELSE                                                  04610000
045500               IF RC053-UPC-UPD-RESOLVED                          04620000
045600                  PERFORM 2700-UPD-SHUNLO-SCN-LOC                 04630000
045700               ELSE                                               04640000
045800                  EVALUATE TRUE                                   04650000
045900                    WHEN RC053-PBS-UNITS-ERR                      04660000
046000                         MOVE  PC-PBSA       TO SHUNLO-SCN-LOC-ID 04670000
046100                    WHEN RC053-PBS-UPC-NOT-ON-PO-ERR              04680000
046200                         MOVE  PC-PBSB       TO SHUNLO-SCN-LOC-ID 04690000
046300                    WHEN RC053-PBS-LNE-ZERO-ERR                   04700000
046400                         MOVE  PC-PBSC       TO SHUNLO-SCN-LOC-ID 04710000
046500                    WHEN RC053-PBS-UPC-CTN-ERR                    04720000
046600                         MOVE  PC-PBSD       TO SHUNLO-SCN-LOC-ID 04730000
046700                    WHEN RC053-PBS-UPC-PKSL-ERR                   04740000
046800                         MOVE  PC-PBSE       TO SHUNLO-SCN-LOC-ID 04750000
046900                  END-EVALUATE                                    04760000
047000                  IF SHUNLO-SCN-LOC-ID   = PV-SCN-LOC-ID          04770000
047100                       CONTINUE                                   04780000
047200                  ELSE                                            04790000
047300**FIRST ERROR WAS CORRECTED, BUT NOW A DIFF ERROR TYPE WAS FOUND  04800000
047400                     PERFORM 2730-UPD-ERROR-TYPE                  04810000
047500                  END-IF                                          04820000
047600                  PERFORM 8100-WRITE-BAD-CRTN-OUTPUT              04830000
047700               END-IF                                             04840000
047800            END-IF                                                04850000
047900         END-IF                                                   04860000
048000      END-IF.                                                     04870000
048100                                                                  04880000
048200******************************************************************04890000
048300**CHECK IF PBS  ERROR RECORDS HAVE BEEN PREVIOUSLY CREATED *******04900000
048400******************************************************************04910000
048500 2600-CHECK-TSHUNLO.                                              04920000
048600******************************************************************04930000
048700     INITIALIZE PV-DB2-COUNT                                      04940000
048800                PV-DB2-COUNT-2.                                   04950000
048900                                                                  04960000
049000     EXEC SQL                                                     04970000
049100         SELECT  SCN_LOC_ID                                       04980000
049200         INTO   :PV-SCN-LOC-ID                                    04990000
049300         FROM   TSHUNLO                                           05000000
049400         WHERE  SHIPT_UNT_ID   = :INPKSU-SHIPT-UNT-ID             05010000
049500           AND  SCN_LOC_ID    IN                                  05020000
049600                 ('PBSA', 'PBSB', 'PBSC','PBSD','PBSE')           05030000
049700     END-EXEC.                                                    05040000
049800                                                                  05050000
049900     EVALUATE TRUE                                                05060000
050000         WHEN SQLCODE = +0                                        05070000
050100         WHEN SQLCODE = +100                                      05080000
050200         WHEN SQLCODE = -811                                      05090000
050300             CONTINUE                                             05100000
050400         WHEN SQLWARN0 NOT = SPACE                                05110000
050500         WHEN SQLCODE  NOT = +0                                   05120000
050600             MOVE INPKSU-SHIPT-UNT-ID TO PV-DISP-CRTN             05130000
050700             MOVE '2600-CHECK-TSHUNLO    '                        05140000
050800                                          TO PV-ABEND-PARAGRAPH   05150000
050900             MOVE PV-DISP-CRTN            TO PV-ABEND-OPERATION   05160000
051000             MOVE 'SELECT TSHUNLO TABLE'  TO PV-ABEND-STRUCTURE-1 05170000
051100             PERFORM Z999-SQL-ABEND                               05180000
051200     END-EVALUATE.                                                05190000
051300                                                                  05200000
051400*                                                                 05210000
051500******************************************************************05220000
051600 2610-CHECK-TSHUNLO-2.                                            05230000
051700******************************************************************05240000
051800     INITIALIZE PV-DB2-COUNT-2.                                   05250000
051900                                                                  05260000
052000     EXEC SQL                                                     05270000
052100         SELECT  COUNT(*)                                         05280000
052200         INTO   :PV-DB2-COUNT-2                                   05290000
052300         FROM   TSHUNLO                                           05300000
052400         WHERE  SHIPT_UNT_ID   = :INPKSU-SHIPT-UNT-ID             05310000
052500           AND  SCN_LOC_ID     =  'RECV'                          05320000
052600     END-EXEC.                                                    05330000
052700                                                                  05340000
052800     EVALUATE TRUE                                                05350000
052900         WHEN SQLCODE = +0                                        05360000
053000         WHEN SQLCODE = +100                                      05370000
053100             CONTINUE                                             05380000
053200         WHEN SQLWARN0 NOT = SPACE                                05390000
053300         WHEN SQLCODE  NOT = +0                                   05400000
053400             MOVE INPKSU-SHIPT-UNT-ID TO PV-DISP-CRTN             05410000
053500             MOVE '2610-CHECK-TSHUNLO-2  '                        05420000
053600                                          TO PV-ABEND-PARAGRAPH   05430000
053700             MOVE PV-DISP-CRTN            TO PV-ABEND-OPERATION   05440000
053800             MOVE 'SELECT TSHUNLO TABLE'  TO PV-ABEND-STRUCTURE-1 05450000
053900             PERFORM Z999-SQL-ABEND                               05460000
054000     END-EVALUATE.                                                05470000
054100                                                                  05480000
054200*                                                                 05490000
054300******************************************************************05500000
054400 2700-UPD-SHUNLO-SCN-LOC.                                         05510000
054500******************************************************************05520000
054600                                                                  05530000
054700     PERFORM                                                      05540000
054800         WITH TEST AFTER                                          05550000
054900         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     05560000
055000         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            05570000
055100                 SQLCODE = ZERO OR                                05580000
055200                 SQLCODE = +100                                   05590000
055300                                                                  05600000
055400       EXEC SQL                                                   05610000
055500            UPDATE TSHUNLO                                        05620000
055600               SET                                                05630000
055700                    SCN_LOC_ID         = 'PBSR'                   05640000
055800             WHERE  SHIPT_UNT_ID       = :INPKSU-SHIPT-UNT-ID     05650000
055900               AND  SCN_LOC_ID        IN                          05660000
056000                          ('PBSA', 'PBSB', 'PBSC', 'PBSD','PBSE') 05670000
056100       END-EXEC                                                   05680000
056200                                                                  05690000
056300       EVALUATE TRUE                                              05700000
056400           WHEN SQLCODE = +0                                      05710000
056500           WHEN SQLCODE = +100                                    05720000
056600               CONTINUE                                           05730000
056700           WHEN SQLWARN0 NOT = SPACE                              05740000
056800           WHEN SQLCODE  NOT = +0                                 05750000
056900               MOVE INPKSU-SHIPT-UNT-ID TO PV-DISP-CRTN           05760000
057000               MOVE '2700-UPD-SHUNLO-SCN-LOC'                     05770000
057100                                         TO PV-ABEND-PARAGRAPH    05780000
057200               MOVE PV-DISP-CRTN         TO PV-ABEND-OPERATION    05790000
057300               MOVE 'SELECT TSHUNLO TABLE'                        05800000
057400                                    TO PV-ABEND-STRUCTURE-1       05810000
057500               PERFORM Z999-SQL-ABEND                             05820000
057600       END-EVALUATE                                               05830000
057700     END-PERFORM.                                                 05840000
057800                                                                  05850000
057900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05860000
058000        (SQLCODE NOT = +0 OR                                      05870000
058100         SQLCODE NOT = +100)                                      05880000
058200         DISPLAY '**************************************'         05890000
058300         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         05900000
058400         DISPLAY 'UPDATE TSHUNLO                        '         05910000
058500         DISPLAY 'RC053-PO-NBR: '                                 05920000
058600                  RC053-PO-NBR                                    05930000
058700         DISPLAY '**************************************'         05940000
058800         MOVE INPKSU-SHIPT-UNT-ID TO PV-DISP-CRTN                 05950000
058900         MOVE '2700-UPD-SHUNLO-SCN-LOC '                          05960000
059000                                      TO PV-ABEND-PARAGRAPH       05970000
059100         MOVE PV-DISP-CRTN            TO PV-ABEND-OPERATION       05980000
059200         MOVE 'INSERT TSHUNLO TABLE'  TO PV-ABEND-STRUCTURE-1     05990000
059300         PERFORM Z999-SQL-ABEND                                   06000000
059400     END-IF.                                                      06010000
059500                                                                  06020000
059600******************************************************************06030000
059700 2730-UPD-ERROR-TYPE.                                             06040000
059800******************************************************************06050000
059900                                                                  06060000
060000     PERFORM                                                      06070000
060100         WITH TEST AFTER                                          06080000
060200         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     06090000
060300         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            06100000
060400                 SQLCODE = ZERO OR                                06110000
060500                 SQLCODE = +100                                   06120000
060600                                                                  06130000
060700       EXEC SQL                                                   06140000
060800            UPDATE TSHUNLO                                        06150000
060900               SET                                                06160000
061000                    SCN_LOC_ID         = :SHUNLO-SCN-LOC-ID       06170000
061100                  , CRE_TMST           = CURRENT TIMESTAMP        06180000
061200             WHERE  SHIPT_UNT_ID       = :INPKSU-SHIPT-UNT-ID     06190000
061300       END-EXEC                                                   06200000
061400                                                                  06210000
061500       EVALUATE TRUE                                              06220000
061600           WHEN SQLCODE = +0                                      06230000
061700           WHEN SQLCODE = +100                                    06240000
061800               CONTINUE                                           06250000
061900           WHEN SQLWARN0 NOT = SPACE                              06260000
062000           WHEN SQLCODE  NOT = +0                                 06270000
062100               MOVE INPKSU-SHIPT-UNT-ID TO PV-DISP-CRTN           06280000
062200               MOVE '2730-UPD-ERROR-TYPE    '                     06290000
062300                                            TO PV-ABEND-PARAGRAPH 06300000
062400               MOVE PV-DISP-CRTN            TO PV-ABEND-OPERATION 06310000
062500               MOVE 'UPDATE TSHUNLO TABLE'  TO                    06320000
062600                                        PV-ABEND-STRUCTURE-1      06330000
062700               PERFORM Z999-SQL-ABEND                             06340000
062800       END-EVALUATE                                               06350000
062900     END-PERFORM.                                                 06360000
063000                                                                  06370000
063100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    06380000
063200        (SQLCODE NOT = +0 OR                                      06390000
063300         SQLCODE NOT = +100)                                      06400000
063400         DISPLAY '**************************************'         06410000
063500         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         06420000
063600         DISPLAY 'UPDATE TSHUNLO                        '         06430000
063700         DISPLAY 'RC053-PO-NBR: '                                 06440000
063800                  RC053-PO-NBR                                    06450000
063900         DISPLAY '**************************************'         06460000
064000         MOVE INPKSU-SHIPT-UNT-ID TO PV-DISP-CRTN                 06470000
064100         MOVE '2730-UPD-ERROR-TYPE '                              06480000
064200                                      TO PV-ABEND-PARAGRAPH       06490000
064300         MOVE PV-DISP-CRTN            TO PV-ABEND-OPERATION       06500000
064400         MOVE 'INSERT TSHUNLO TABLE'  TO PV-ABEND-STRUCTURE-1     06510000
064500         PERFORM Z999-SQL-ABEND                                   06520000
064600     END-IF.                                                      06530000
064700***************************************************************** 06540000
064800 3100-INSERT-SHUNLO-RECORD.                                       06550000
064900***************************************************************** 06560000
065000                                                                  06570000
065100     MOVE  RC053-DC             TO SHUNLO-OPER-UNT-ID.            06580000
065200     MOVE  1                    TO SHUNLO-FCLTY-ID.               06590000
065300     MOVE  PC-PROGRAM-NAME      TO SHUNLO-CRE-USR-ID.             06600000
065400     MOVE  PC-NINES             TO SHUNLO-TRIP-ID.                06610000
065500                                                                  06620000
065600     EVALUATE TRUE                                                06630000
065700       WHEN RC053-PBS-UNITS-ERR                                   06640000
065800            MOVE  PC-PBSA       TO SHUNLO-SCN-LOC-ID              06650000
065900       WHEN RC053-PBS-UPC-NOT-ON-PO-ERR                           06660000
066000            MOVE  PC-PBSB       TO SHUNLO-SCN-LOC-ID              06670000
066100       WHEN RC053-PBS-LNE-ZERO-ERR                                06680000
066200            MOVE  PC-PBSC       TO SHUNLO-SCN-LOC-ID              06690000
066300       WHEN RC053-PBS-UPC-CTN-ERR                                 06700000
066400            MOVE  PC-PBSD       TO SHUNLO-SCN-LOC-ID              06710000
066500       WHEN RC053-PBS-UPC-PKSL-ERR                                06720000
066600            MOVE  PC-PBSE       TO SHUNLO-SCN-LOC-ID              06730000
066700     END-EVALUATE                                                 06740000
066800                                                                  06750000
066900     PERFORM                                                      06760000
067000         WITH TEST AFTER                                          06770000
067100         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     06780000
067200         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            06790000
067300                 SQLCODE = ZERO OR                                06800000
067400                 SQLCODE = +100                                   06810000
067500       EXEC SQL                                                   06820000
067600           INSERT INTO TSHUNLO                                    06830000
067700                 (SHIPT_UNT_ID                                    06840000
067800                , OPER_UNT_ID                                     06850000
067900                , FCLTY_ID                                        06860000
068000                , SCN_LOC_ID                                      06870000
068100                , CRE_USR_ID                                      06880000
068200                , CRE_TMST                                        06890000
068300                , TRIP_ID                                         06900000
068400                , PRTR_TYP_CDE                                    06910000
068500                , LBL_PRT_BTCH_ID                                 06920000
068600                , ACTV_CDE)                                       06930000
068700           VALUES (:INPKSU-SHIPT-UNT-ID                           06940000
068800                 , :SHUNLO-OPER-UNT-ID                            06950000
068900                 , :SHUNLO-FCLTY-ID                               06960000
069000                 , :SHUNLO-SCN-LOC-ID                             06970000
069100                 , :SHUNLO-CRE-USR-ID                             06980000
069200                 ,  CURRENT TIMESTAMP                             06990000
069300                 , :SHUNLO-TRIP-ID                                07000000
069400                 , 'N'                                            07010000
069500                 ,  0                                             07020000
069600                 , 'I')                                           07030000
069700       END-EXEC                                                   07040000
069800                                                                  07050000
069900       EVALUATE TRUE                                              07060000
070000           WHEN SQLCODE = +0                                      07070000
070100               SET PS-CRTN-ROWS-INSERTED-YES TO TRUE              07080000
070200           WHEN SQLCODE = +100                                    07090000
070300               CONTINUE                                           07100000
070400           WHEN SQLWARN0 NOT = SPACE                              07110000
070500           WHEN SQLCODE  NOT = +0                                 07120000
070600               MOVE INPKSU-SHIPT-UNT-ID TO PV-DISP-CRTN           07130000
070700               MOVE '3100-INSERT-SHUNLO-RECORDS'                  07140000
070800                                            TO PV-ABEND-PARAGRAPH 07150000
070900               MOVE PV-DISP-CRTN            TO PV-ABEND-OPERATION 07160000
071000               MOVE 'INSERT TSHUNLO TABLE'  TO                    07170000
071100                                            PV-ABEND-STRUCTURE-1  07180000
071200               PERFORM Z999-SQL-ABEND                             07190000
071300       END-EVALUATE                                               07200000
071400     END-PERFORM.                                                 07210000
071500                                                                  07220000
071600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    07230000
071700        (SQLCODE NOT = +0 OR                                      07240000
071800         SQLCODE NOT = +100)                                      07250000
071900         DISPLAY '**************************************'         07260000
072000         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         07270000
072100         DISPLAY 'INSERT TSHUNLO                        '         07280000
072200         DISPLAY 'RC053-PO-NBR: '                                 07290000
072300                  RC053-PO-NBR                                    07300000
072400         DISPLAY '**************************************'         07310000
072500         MOVE INPKSU-SHIPT-UNT-ID TO PV-DISP-CRTN                 07320000
072600         MOVE '3100-INSERT-SHUNLO-RECORDS'                        07330000
072700                                      TO PV-ABEND-PARAGRAPH       07340000
072800         MOVE PV-DISP-CRTN            TO PV-ABEND-OPERATION       07350000
072900         MOVE 'INSERT TSHUNLO TABLE'  TO PV-ABEND-STRUCTURE-1     07360000
073000         PERFORM Z999-SQL-ABEND                                   07370000
073100     END-IF.                                                      07380000
073200                                                                  07390000
073300***************************************************************** 07400000
073400 8000-DISPLAY-ERROR-DATA.                                         07410000
073500***************************************************************** 07420000
073600     IF RC053-VENDOR-NAME   =      PV-HOLD-VEND-NME               07430000
073700        MOVE INPKSU-SHIPT-UNT-ID   TO PV-DISP-CRTN                07440000
073800        MOVE RC053-PO-NBR          TO PV-DISP-PO                  07450000
073900        MOVE RC053-DEST-STORE      TO PV-DISP-STORE               07460000
074000        MOVE RC053-DC              TO PV-DISP-DC                  07470000
074100        MOVE RC053-TPKITEM-EXP-QTY TO PV-DISP-PKITEM-QTY          07480000
074200        MOVE RC053-TSHUUPC-SHP-QTY TO PV-DISP-SHUUPC-QTY-LNE      07490000
074300        MOVE RC053-PKSL-LINE-NBR   TO PV-DISP-LINE-PKSLIP         07500000
074400        MOVE RC053-TRN-LINE-NBR    TO PV-DISP-LINE-CRTN           07510000
074500        MOVE SHUUPC-SHPD-QTY       TO PV-DISP-SHUUPC-QTY-CRTN     07520000
074600        DISPLAY PV-DISP-CRTN                                      07530000
074700          ' / '                                                   07540000
074800          PV-DISP-PO                                              07550000
074900          ' /   '                                                 07560000
075000          PV-DISP-STORE                                           07570000
075100          ' / '                                                   07580000
075200          PV-DISP-DC                                              07590000
075300          ' / '                                                   07600000
075400          PV-DISP-PKITEM-QTY                                      07610000
075500          '    / '                                                07620000
075600          PV-DISP-SHUUPC-QTY-LNE                                  07630000
075700          ':'                                                     07640000
075800          PV-DISP-SHUUPC-QTY-CRTN                                 07650000
075900          ' / '                                                   07660000
076000          PV-DISP-LINE-PKSLIP                                     07670000
076100          '      / '                                              07680000
076200          PV-DISP-LINE-CRTN                                       07690000
076300          '/'                                                     07700000
076400          RC053-ASN-PBS-ERROR-IND                                 07710000
076500     ELSE                                                         07720000
076600        ADD +1                    TO PV-VENDORS-WRITTEN           07730000
076700        MOVE RC053-VENDOR-NAME    TO PV-DISP-VENDOR               07740000
076800                                     PV-HOLD-VEND-NME             07750000
076900        MOVE INPKSU-SHIPT-UNT-ID  TO PV-DISP-CRTN                 07760000
077000        MOVE RC053-PO-NBR         TO PV-DISP-PO                   07770000
077100        MOVE RC053-DEST-STORE     TO PV-DISP-STORE                07780000
077200        MOVE RC053-DC              TO PV-DISP-DC                  07790000
077300        MOVE RC053-TPKITEM-EXP-QTY TO PV-DISP-PKITEM-QTY          07800000
077400        MOVE RC053-TSHUUPC-SHP-QTY TO PV-DISP-SHUUPC-QTY-LNE      07810000
077500        MOVE RC053-PKSL-LINE-NBR   TO PV-DISP-LINE-PKSLIP         07820000
077600        MOVE RC053-TRN-LINE-NBR    TO PV-DISP-LINE-CRTN           07830000
077700        MOVE SHUUPC-SHPD-QTY       TO PV-DISP-SHUUPC-QTY-CRTN     07840000
077800        DISPLAY ' '                                               07850000
077900        DISPLAY '  VENDOR NAME   '  PV-DISP-VENDOR                07860000
078000        DISPLAY                                                   07870000
078100         'INACTIVE CRTN '                                         07880000
078200          ' / '                                                   07890000
078300        ' PURCHASE ORDER'                                         07900000
078400          ' / '                                                   07910000
078500         'STORE'                                                  07920000
078600          ' / '                                                   07930000
078700         'DC '                                                    07940000
078800          ' / '                                                   07950000
078900         'PKSLIP QTY'                                             07960000
079000          ' / '                                                   07970000
079100         'CARTON QTY'                                             07980000
079200          '   / '                                                 07990000
079300         'PKSLIP LNE'                                             08000000
079400          ' / '                                                   08010000
079500         'CARTON LNE'                                             08020000
079600        DISPLAY PV-DISP-CRTN                                      08030000
079700          ' / '                                                   08040000
079800          PV-DISP-PO                                              08050000
079900          ' /   '                                                 08060000
080000          PV-DISP-STORE                                           08070000
080100          ' / '                                                   08080000
080200          PV-DISP-DC                                              08090000
080300          ' / '                                                   08100000
080400          PV-DISP-PKITEM-QTY                                      08110000
080500          '    / '                                                08120000
080600          PV-DISP-SHUUPC-QTY-LNE                                  08130000
080700          ':'                                                     08140000
080800          PV-DISP-SHUUPC-QTY-CRTN                                 08150000
080900          ' / '                                                   08160000
081000          PV-DISP-LINE-PKSLIP                                     08170000
081100          '      / '                                              08180000
081200          PV-DISP-LINE-CRTN                                       08190000
081300          '/'                                                     08200000
081400          RC053-ASN-PBS-ERROR-IND                                 08210000
081500     END-IF.                                                      08220000
081600                                                                  08230000
081700                                                                  08240000
081800******************************************************************08250000
081900 8100-WRITE-BAD-CRTN-OUTPUT.                                      08260000
082000                                                                  08270000
082100                                                                  08280000
082200     MOVE RC053-PO-NBR              TO  RC052-PO-NBR.             08290000
082300     MOVE RC053-SEQ-NBR             TO  RC052-SEQ-NBR.            08300000
082400     MOVE 'Y'                       TO  RC052-UPC-BAD-CRTN-REC.   08310000
082500     MOVE RC053-UPC-RECYCLE-COUNT   TO  RC052-UPC-RECYCLE-COUNT.  08320000
082600                                                                  08330000
082700     WRITE ASN-CRTN-UPC-ADD-OUTPUT-REC                            08340000
082800         FROM RC052-ASN-RECVR-PKSLIP-RECORD.                      08350000
082900                                                                  08360000
083000***************************************************************** 08370000
083100 Z999-SQL-ABEND.                                                  08380000
083200***************************************************************** 08390000
083300     MOVE SQLCODE TO PV-SQLCODE.                                  08400000
083400     MOVE PV-SQLCODE TO PV-DISP-SQLCODE.                          08410000
083500     DISPLAY '*** DB2 ERROR '.                                    08420000
083600     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  08430000
083700     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 08440000
083800     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               08450000
083900     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               08460000
084000     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       08470000
084100     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       08480000
084200     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       08490000
084300                                                                  08500000
084400                                                                  08510000
084500     COPY DPPD004.                                                08520000
084600                                                                  08530000
084700     MOVE +4013         TO PV-ABEND-CODE.                         08540000
084800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08550000
