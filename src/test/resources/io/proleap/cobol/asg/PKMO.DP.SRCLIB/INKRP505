       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.              INKRP505.                                       
       AUTHOR.                  LEE YANG.                                       
       INSTALLATION.            KOHLS DEPARTMENT STORES.                        
       DATE-WRITTEN.            12/27/2002.                                     
       DATE-COMPILED.                                                           
      ******************************************************************        
      *                                                                *        
      *  CREATES A REPORT LIST OF OLDEST ITEMS/UPCS/SKUS WITHIN EACH   *        
      *  DEPARTMENT.                                                   *        
      *                                                                *        
      ******************** HISTORY OF CHANGES **************************        
      * CHG ID/                                                        *        
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *        
      * -------  ----------  ----------------------------------------  *        
      *                                                                *        
      ******************************************************************        
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT OPTIONAL RPT-REQUEST-CNTL-FILE                                
               ASSIGN TO INP01.                                                 
                                                                                
           SELECT SKU-ITEMS-RPT                                                 
               ASSIGN TO RPT01.                                                 
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  RPT-REQUEST-CNTL-FILE                                                
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
       01  RPT-REQUEST-CNTL-REC            PIC X(080).                          
                                                                                
       FD  SKU-ITEMS-RPT                                                        
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE OMITTED                                            
           RECORD CONTAINS 132 CHARACTERS                                       
           DATA RECORD IS REPORT-LINE.                                          
       01  REPORT-LINE                     PIC X(132).                          
                                                                                
       EJECT                                                                    
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** WORKING STORAGE AREA BEGIN ***'.                                
                                                                                
      ******************************************************************        
      *  HEADER LINE                                                            
      ******************************************************************        
      *01  DP132O-STANDRD-HEADER-132-COLS.                                      
      *01  01  DP132O-CNFDL-HDR-132-COLS.                                       
           COPY DPWS132O.                                                       
                                                                                
       01  RP-REPORT-TITLE-1.                                                   
           05  FILLER                      PIC X(54)       VALUE SPACES.        
           05  FILLER                      PIC X(26)       VALUE                
               'SKU/ITEM/UPC BY DEPARTMENT'.                                    
                                                                                
       01  RP-REPORT-HEADER-1.                                                  
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(04)       VALUE 'DEPT'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(08)       VALUE                
               '   SKU  '.                                                      
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(15)       VALUE                
               '      UPC      '.                                               
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(15)       VALUE                
               '     ITEM      '.                                               
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(04)       VALUE 'STAT'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(10)       VALUE                
               ' CORP QTY '.                                                    
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(30)       VALUE                
               '     DEPT/UPC DESCRIPTION     '.                                
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(11)       VALUE                
               '  EARLIEST '.                                                   
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(11)       VALUE                
               '   LATEST  '.                                                   
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(10)       VALUE                
               ' LAST RCVD'.                                                    
           05  FILLER                      PIC X(04)       VALUE SPACES.        
                                                                                
       01  RP-REPORT-HEADER-2.                                                  
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(04)      VALUE ALL '-'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(08)      VALUE ALL '-'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(15)      VALUE ALL '-'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(15)      VALUE ALL '-'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(04)      VALUE ALL '-'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(10)      VALUE ALL '-'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(30)      VALUE ALL '-'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(11)      VALUE ALL '-'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(11)      VALUE ALL '-'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(10)      VALUE ALL '-'.        
           05  FILLER                      PIC X(04)       VALUE SPACES.        
                                                                                
       01  RP-REPORT-DETAIL.                                                    
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-DEPT                     PIC 9(04)       VALUE ZEROES.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RP-SKU                      PIC 9(08)       VALUE ZEROES.        
           05  RP-SKU-X REDEFINES RP-SKU   PIC X(08).                           
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RP-UPC-NBR                  PIC 9(15)       VALUE ZEROES.        
           05  RP-UPC-NBR-X REDEFINES RP-UPC-NBR                                
                                           PIC X(15).                           
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RP-ITEM-NBR                 PIC 9(15)       VALUE ZEROES.        
           05  RP-ITEM-NBR-X REDEFINES RP-ITEM-NBR                              
                                           PIC X(15).                           
           05  FILLER                      PIC X(03)       VALUE SPACES.        
           05  RP-STATUS                   PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RP-QTY                      PIC Z,ZZZ,ZZ9-  VALUE ZEROES.        
           05  RP-QTY-X REDEFINES RP-QTY   PIC X(10).                           
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RP-UPC-DESC                 PIC X(30)       VALUE SPACES.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RP-MIN-CREATE-DATE          PIC X(10)       VALUE SPACES.        
           05  RP-MIN-CREATE-DATE-USE-SW   PIC X(01)       VALUE SPACES.        
               88  RP-MIN-CREATE-DATE-USE                  VALUE '*'.           
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RP-MAX-CREATE-DATE          PIC X(10)       VALUE SPACES.        
           05  RP-MAX-CREATE-DATE-USE-SW   PIC X(01)       VALUE SPACES.        
               88  RP-MAX-CREATE-DATE-USE                  VALUE '*'.           
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RP-LAST-RCVD-DATE           PIC X(10)       VALUE SPACES.        
           05  FILLER                      PIC X(04)       VALUE SPACES.        
                                                                                
       01  RP-REPORT-END.                                                       
           05  FILLER                      PIC X(46)       VALUE SPACES.        
           05  FILLER                      PIC X(39)       VALUE                
               '*****  E N D   O F   R E P O R T  *****'.                       
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** PROGRAMMING CONSTANT BEGIN ***'.                                
                                                                                
       01  PC-PROGRAM-CONSTANTS-AREA.                                           
           05  PC-PRINT-LINE-MAX           PIC S9(04)      VALUE +57            
                               COMP.                                            
           05  PC-PLACE-HOLDER-STAT        PIC X(02)       VALUE '00'.          
           05  PC-RENUMBERED-STAT          PIC X(02)       VALUE '98'.          
           05  PC-REGULAR-STAT             PIC X(02)       VALUE '20'.          
           05  PC-VENDOR-UPC-TYPE          PIC X(01)       VALUE 'V'.           
           05  PC-COMPANY-OPERCO           PIC X(02)       VALUE '03'.          
           05  PC-DEPT-CODE                PIC X(03)       VALUE 'DPT'.         
           05  PC-INCOMPLETE-DATE          PIC X(10)       VALUE                
               '9999-09-09'.                                                    
           05  PC-DEPT-NOT-FOUND           PIC X(25)       VALUE                
               'DEPT NOT FOUND IN SYSTEM.'.                                     
      *    05  PC-FS-ROLLUP-STORE          PIC X(03)       VALUE ZEROES.        
           05  PC-FS-ROLLUP-STORE          PIC S9(4)       VALUE ZEROES         
                               COMP.                                            
           05  PC-FS-CUTOFF-YEAR-DATE      PIC S9(07)V     VALUE +700000        
                               COMP-3.                                          
           05  PC-19                       PIC S9(02)      VALUE +19            
                               COMP-3.                                          
           05  PC-20                       PIC S9(02)      VALUE +20            
                               COMP-3.                                          
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** PROGRAMMING SWITCHES BEGIN ***'.                                
                                                                                
       01  PS-SWITCHES-AREA.                                                    
           05  PS-END-OF-RPT-REQUEST-CNTL  PIC X           VALUE 'N'.           
               88  END-OF-RPT-REQUEST-CNTL                 VALUE 'Y'.           
               88  NOT-END-OF-RPT-REQUEST-CNTL             VALUE 'N'.           
           05  PS-END-OF-TSKXREF           PIC X           VALUE 'N'.           
               88  END-OF-TSKXREF                          VALUE 'Y'.           
               88  NOT-END-OF-TSKXREF                      VALUE 'N'.           
           05  PS-END-OF-TUPC              PIC X           VALUE 'N'.           
               88  END-OF-TUPC                             VALUE 'Y'.           
               88  NOT-END-OF-TUPC                         VALUE 'N'.           
           05  PS-SKU-FOUND-SW             PIC X           VALUE 'N'.           
               88  SKU-FOUND                               VALUE 'Y'.           
               88  SKU-NOT-FOUND                           VALUE 'N'.           
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** REPORT REQUEST CONTROL REC ***'.                                
                                                                                
       01  RQ-RPT-CNTL-AREA.                                                    
           05  RQ-RPT-TYPE                 PIC X(25)       VALUE SPACES.        
           05  RQ-RPT-TYPE-RDF REDEFINES RQ-RPT-TYPE.                           
               10  RQ-RPT-TYPE14           PIC X(14).                           
                   88  RQ-RPT-REQUESTED                    VALUE                
                       'RPT REQUESTED '.                                        
                   88  RQ-RPT-INVENTORY                    VALUE                
                       'RPT INVENTORY '.                                        
               10  RQ-RPT-TYPE14-DATE      PIC X(10).                           
               10  FILLER                  PIC X(01).                           
           05  RQ-RPT-INV-AREA-LOW         PIC X(09)       VALUE ZEROES.        
           05  RQ-RPT-INV-AREA-LOW-9 REDEFINES RQ-RPT-INV-AREA-LOW              
                                           PIC 9(09).                           
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RQ-RPT-INV-AREA-HIGH        PIC X(09)       VALUE ZEROES.        
           05  RQ-RPT-INV-AREA-HIGH-9 REDEFINES RQ-RPT-INV-AREA-HIGH            
                                           PIC 9(09).                           
           05  FILLER                      PIC X(36)       VALUE SPACES.        
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** PROGRAMMING VARIABLE BEGIN ***'.                                
                                                                                
       01  PV-PROGRAM-VARIABLES-AREA.                                           
           05  PV-MDSEAR-DEPT-NBR          PIC 9(03)       VALUE ZEROES.        
           05  PV-MDSEAR-DEPT-NBR-X REDEFINES PV-MDSEAR-DEPT-NBR                
                                           PIC X(03).                           
           05  PV-DEPT-DESC.                                                    
               10  FILLER                  PIC X(06)       VALUE                
                   'DEPT: '.                                                    
               10  PV-MDSEAR-DESC          PIC X(25)       VALUE SPACES.        
           05  PV-XREF-CRE-TMST.                                                
               10  PV-XREF-CRE-DTE         PIC X(10)       VALUE SPACES.        
               10  FILLER                  PIC X(16)       VALUE                
                   '-23.59.59.999999'.                                          
           05  PV-XREF-CRE-TMST-RDF REDEFINES PV-XREF-CRE-TMST                  
                                           PIC X(26).                           
           05  PV-MIN-XREF-CRE-DTE         PIC X(10)       VALUE SPACES.        
           05  PV-MAX-XREF-CRE-DTE         PIC X(10)       VALUE SPACES.        
           05  PV-PAGE-COUNT               PIC S9(05)      VALUE ZEROES         
                               COMP.                                            
           05  PV-PRINT-LINE-COUNT         PIC S9(04)      VALUE ZEROES         
                               COMP.                                            
           05  PV-ADVANCE-LINE             PIC S9(04)      VALUE ZEROES         
                               COMP.                                            
           05  PV-OPER-ATTEMPTED           PIC X(25)       VALUE SPACES.        
           05  PV-PROCESSING-DATE          PIC X(10)       VALUE SPACES.        
           05  PV-PROCESSING-DATE-RDF REDEFINES PV-PROCESSING-DATE.             
               10  PV-PROCESSING-CC        PIC X(02).                           
               10  PV-PROCESSING-YY        PIC X(02).                           
               10  PV-PROC-DSH1            PIC X(01).                           
               10  PV-PROCESSING-MM        PIC X(02).                           
               10  PV-PROC-DSH2            PIC X(01).                           
               10  PV-PROCESSING-DD        PIC X(02).                           
           05  PV-TODAYS-DATE.                                                  
               10  PV-TODAYS-DATE-YY       PIC 9(02)       VALUE ZEROES.        
               10  PV-TODAYS-DATE-MM       PIC 9(02)       VALUE ZEROES.        
               10  PV-TODAYS-DATE-DD       PIC 9(02)       VALUE ZEROES.        
           05  PV-TODAYS-TIME.                                                  
               10  PV-TODAYS-TIME-HR       PIC 9(02)       VALUE ZEROES.        
               10  PV-TODAYS-TIME-MIN      PIC 9(02)       VALUE ZEROES.        
               10  PV-TODAYS-TIME-SEC      PIC 9(02)       VALUE ZEROES.        
               10  FILLER                  PIC 9(02)       VALUE ZEROES.        
           05  PV-LAST-RCVD-DATE-FMT.                                           
               10  PV-LAST-RCVD-DATE-FMT-CCYY                                   
                                           PIC X(04)       VALUE SPACES.        
               10  FILLER                  PIC X(01)       VALUE '-'.           
               10  PV-LAST-RCVD-DATE-FMT-MM                                     
                                           PIC X(02)       VALUE SPACES.        
               10  FILLER                  PIC X(01)       VALUE '-'.           
               10  PV-LAST-RCVD-DATE-FMT-DD                                     
                                           PIC X(02)       VALUE SPACES.        
           05  PV-LAST-RCVD-FULL-DATE.                                          
               10  PV-LAST-RCVD-DATE-CC    PIC 9(02)       VALUE ZEROES.        
               10  PV-LAST-RCVD-DATE       PIC 9(06)       VALUE ZEROES.        
           05  FILLER REDEFINES PV-LAST-RCVD-FULL-DATE.                         
               10  PV-LAST-RCVD-DATE-CCYY  PIC 9(04).                           
               10  PV-LAST-RCVD-DATE-MM    PIC 9(02).                           
               10  PV-LAST-RCVD-DATE-DD    PIC 9(02).                           
           05  PV-USING-EARLIEST           PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-USING-LATEST             PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-USING-NO-DATE            PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-DEPT-FOUND               PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-DEPT-NOT-FOUND           PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-DEPT-PROCESSED           PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** SQL WORK AREA BEGIN ***'.                                       
                                                                                
      *****************************************************************         
      *  SQL ABEND ROUTINE WORKING STORAGE                                      
      *****************************************************************         
      *01  DP004-DB2-ERROR-FIELDS.                                              
           COPY DPWS004.                                                        
                                                                                
       01  ABEND-CODE                      PIC S9(04)      VALUE ZEROES         
                               COMP SYNC.                                       
           88  ABEND-4003                                  VALUE +4003.         
           88  ABEND-4013                                  VALUE +4013.         
                                                                                
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
      *---------------------------------------------------------------* INKCS046
      *    TSKST   - SKU STORE ONHAND TABLE                           * INKCS046
      *---------------------------------------------------------------* INKCS046
           EXEC SQL                                                     INKCS046
               INCLUDE TSKST                                            INKCS046
           END-EXEC.                                                    INKCS046
                                                                        INKCS046
      *---------------------------------------------------------------* INKCS046
      *    TSKXREF - STORE SKU CROSS-REFERENCE TABLE                  * INKCS046
      *---------------------------------------------------------------* INKCS046
           EXEC SQL                                                     INKCS046
               INCLUDE TSKXREF                                          INKCS046
           END-EXEC.                                                    INKCS046
                                                                        INKCS046
      *---------------------------------------------------------------* INKCS046
      *    TUPC    - UPC TABLE                                        * INKCS046
      *---------------------------------------------------------------* INKCS046
           EXEC SQL                                                     INKCS046
               INCLUDE TUPC                                             INKCS046
           END-EXEC.                                                    INKCS046
                                                                        INKCS046
      *---------------------------------------------------------------* INKCS046
      *    TMDSEAR - MERCHANDISE HIERARCHY DESCRIPTION TABLE          * INKCS046
      *---------------------------------------------------------------* INKCS046
           EXEC SQL                                                     INKCS046
               INCLUDE TMDSEAR                                          INKCS046
           END-EXEC.                                                    INKCS046
                                                                        INKCS046
      *---------------------------------------------------------------*         
      *    TSKXREF - SKU CROSS-REFERENCE CURSOR                       *         
      *---------------------------------------------------------------*         
           EXEC SQL   DECLARE TSKXREF-CURSOR CURSOR FOR                         
               SELECT  DISTINCT                                                 
                       A.DEPT                                                   
                      ,MIN(B.EFF_BEG_DTE)                                       
                      ,MAX(B.EFF_BEG_DTE)                                       
               FROM  TSKXREF A                                                  
                    ,TUPC    B                                                  
               WHERE SKU_STAT_CDE         = :PC-REGULAR-STAT                    
                 AND A.INTR_UPC_ID        = B.INTR_UPC_ID                       
               GROUP BY A.DEPT                                                  
               FOR READ ONLY                                                    
           END-EXEC.                                                            
                                                                                
      *---------------------------------------------------------------*         
      *    TUPC    - UPC AND SKU CROSS-REFERENCE CURSOR               *         
      *---------------------------------------------------------------*         
           EXEC SQL   DECLARE TUPC-CURSOR CURSOR FOR                            
               SELECT                                                           
                       B.UPC_NBR                                                
                      ,A.ITM_NBR                                                
                      ,A.SKU_STAT_CDE                                           
                      ,A.SKU                                                    
                      ,B.INTR_UPC_DESC                                          
                      ,B.UPC_TYP_CDE                                            
                      ,C.LAST_RCVD_DATE                                         
                      ,C.ONHAND_QTY                                             
                 FROM  TSKXREF A                                                
                      ,TUPC    B                                                
                      ,TSKST   C                                                
                 WHERE A.DEPT             = :SKXREF-DEPT                        
                   AND A.SKU_STAT_CDE     = :PC-REGULAR-STAT                    
                   AND (YEAR(B.EFF_BEG_DTE) = YEAR(:PV-XREF-CRE-DTE)            
                        OR :PV-XREF-CRE-DTE = :PC-INCOMPLETE-DATE)              
                   AND C.ITEM_NMBR        = A.ITM_NBR                           
                   AND C.ONHAND_QTY      ^= 0                                   
                   AND C.LAST_RCVD_DATE   < :PC-FS-CUTOFF-YEAR-DATE             
                   AND C.LAST_RCVD_DATE   > 0                                   
      *            AND C.STORE_NMBR       = :PC-FS-ROLLUP-STORE                 
                   AND C.LOC_NBR          = :PC-FS-ROLLUP-STORE                 
                   AND A.INTR_UPC_ID      = B.INTR_UPC_ID                       
                   AND B.EFF_BEG_DTE     <= CURRENT DATE                        
                   AND (B.EFF_END_DTE    >= CURRENT DATE                        
                        OR B.EFF_END_DTE IS NULL)                               
                 ORDER BY  B.UPC_TYP_CDE DESC                                   
                          ,C.LAST_RCVD_DATE DESC                                
               FETCH FIRST 1 ROW ONLY                                           
               FOR READ ONLY                                                    
           END-EXEC.                                                            
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** WORKING STORAGE END ***'.                                       
                                                                                
       EJECT                                                                    
       PROCEDURE DIVISION.                                                      
                                                                                
       A100-MAIN-MODULE.                                                        
      ******************************************************************        
      *  MAIN RPOCESSING.                                                       
      ******************************************************************        
                                                                                
           PERFORM B100-HOUSEKEEPING.                                           
                                                                                
           PERFORM B300-PROCESS-EXTRACT                                         
               UNTIL END-OF-TSKXREF.                                            
                                                                                
           PERFORM B400-FINALIZE.                                               
                                                                                
           STOP RUN.                                                            
                                                                                
      ******************************************************************        
      * GET THE SYSTEM TIME AND MOVE IT TO THE REPORT HEADING. SET              
      * THE REPORT NAME AND NUMBER.                                             
      ******************************************************************        
       B100-HOUSEKEEPING.                                                       
                                                                                
           ACCEPT PV-TODAYS-DATE FROM DATE.                                     
           ACCEPT PV-TODAYS-TIME FROM TIME.                                     
                                                                                
           MOVE PV-TODAYS-DATE-YY TO PV-PROCESSING-YY.                          
           MOVE PV-TODAYS-DATE-MM TO PV-PROCESSING-MM.                          
           MOVE PV-TODAYS-DATE-DD TO PV-PROCESSING-DD.                          
                                                                                
           MOVE '-' TO PV-PROC-DSH1.                                            
           MOVE '-' TO PV-PROC-DSH2.                                            
                                                                                
           IF PV-TODAYS-DATE-YY > '80'                                          
               MOVE '19' TO PV-PROCESSING-CC                                    
           ELSE                                                                 
               MOVE '20' TO PV-PROCESSING-CC.                                   
                                                                                
           MOVE PV-TODAYS-DATE-MM  TO DP132O-RUN-MONTH.                         
           MOVE PV-TODAYS-DATE-DD  TO DP132O-RUN-DAY.                           
           MOVE PV-TODAYS-DATE-YY  TO DP132O-RUN-YEAR.                          
           MOVE PV-TODAYS-TIME-HR  TO DP132O-RUN-HOUR.                          
           MOVE PV-TODAYS-TIME-MIN TO DP132O-RUN-MINUTE.                        
           MOVE 'INKRP505'         TO DP132O-PROGRAM-NAME.                      
                                                                                
           OPEN INPUT  RPT-REQUEST-CNTL-FILE                                    
                OUTPUT SKU-ITEMS-RPT.                                           
                                                                                
           READ RPT-REQUEST-CNTL-FILE                                           
               INTO RQ-RPT-CNTL-AREA                                            
               AT END                                                           
                   SET END-OF-RPT-REQUEST-CNTL TO TRUE.                         
           IF NOT-END-OF-RPT-REQUEST-CNTL                                       
               DISPLAY 'REPORT REQUESTED:'                                      
               DISPLAY '  ' RQ-RPT-CNTL-AREA                                    
               DISPLAY '  ----+----1----+----2----+----3----+----4'             
                       '----+----5----+----6----+----7'                         
           END-IF.                                                              
                                                                                
           PERFORM Z100-OPEN-TSKXREF.                                           
           PERFORM Z200-FETCH-TSKXREF.                                          
                                                                                
      ******************************************************************        
      *    SELECT AND PRODUCE THE VARIOUS REPORTS                               
      ******************************************************************        
       B300-PROCESS-EXTRACT.                                                    
                                                                                
           ADD +1                     TO PV-DEPT-PROCESSED.                     
           MOVE PV-MIN-XREF-CRE-DTE   TO RP-MIN-CREATE-DATE.                    
           MOVE PV-MAX-XREF-CRE-DTE   TO RP-MAX-CREATE-DATE.                    
                                                                                
           MOVE PV-MIN-XREF-CRE-DTE   TO PV-XREF-CRE-DTE.                       
           PERFORM Z400-OPEN-TUPC.                                              
           PERFORM Z500-FETCH-TUPC.                                             
           PERFORM C100-PROCESS-TUPC                                            
               UNTIL END-OF-TUPC.                                               
           PERFORM Z600-CLOSE-TUPC.                                             
                                                                                
           IF SKU-FOUND                                                         
               ADD +1                     TO PV-USING-EARLIEST                  
           ELSE                                                                 
               MOVE PV-MAX-XREF-CRE-DTE   TO PV-XREF-CRE-DTE                    
               PERFORM Z400-OPEN-TUPC                                           
               PERFORM Z500-FETCH-TUPC                                          
               PERFORM C100-PROCESS-TUPC                                        
                   UNTIL END-OF-TUPC                                            
               PERFORM Z600-CLOSE-TUPC                                          
               IF SKU-FOUND                                                     
                   ADD +1                     TO PV-USING-LATEST                
               ELSE                                                             
                   MOVE PC-INCOMPLETE-DATE    TO PV-XREF-CRE-DTE                
                   PERFORM Z400-OPEN-TUPC                                       
                   PERFORM Z500-FETCH-TUPC                                      
                   PERFORM C100-PROCESS-TUPC                                    
                       UNTIL END-OF-TUPC                                        
                   PERFORM Z600-CLOSE-TUPC                                      
                   IF SKU-FOUND                                                 
                       ADD +1                 TO PV-USING-NO-DATE               
                   ELSE                                                         
                       ADD +1                 TO PV-DEPT-NOT-FOUND              
                       MOVE SPACES            TO SKXREF-SKU-STAT-CDE            
                                                 UPC-INTR-UPC-DESC              
                       MOVE ZEROES            TO SKXREF-SKU                     
                                                 UPC-UPC-NBR                    
                                                 SKXREF-ITM-NBR                 
                                                 PV-LAST-RCVD-DATE-CC           
                                                 PV-LAST-RCVD-DATE              
                       PERFORM C200-PRODUCE-REPORT                              
                       DISPLAY ' *** COULD NOT FIND APPROPRIATE SKU'            
                               ' INFORMATION FOR DEPT: ' SKXREF-DEPT            
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
           PERFORM Z200-FETCH-TSKXREF.                                          
                                                                                
      ******************************************************************        
      *    FINALIZE THE REPORT AND CLOSE OUT FILES                              
      ******************************************************************        
       B400-FINALIZE.                                                           
                                                                                
           PERFORM Z300-CLOSE-TSKXREF.                                          
                                                                                
           MOVE RP-REPORT-END TO RP-REPORT-DETAIL.                              
           MOVE +3                   TO PV-ADVANCE-LINE.                        
           PERFORM Z700-PRINT-DETAILS.                                          
                                                                                
           DISPLAY ' '.                                                         
           DISPLAY '  DEPT PROCESSED: ' PV-DEPT-PROCESSED.                      
           DISPLAY '    DEPT FOUND:     ' PV-DEPT-FOUND.                        
           DISPLAY '      USING EARLIEST: ' PV-USING-EARLIEST.                  
           DISPLAY '      USING LATEST:   ' PV-USING-LATEST.                    
           DISPLAY '      USING NO DATE:  ' PV-USING-NO-DATE.                   
           DISPLAY '    DEPT NOT FOUND: ' PV-DEPT-NOT-FOUND.                    
                                                                                
           CLOSE   RPT-REQUEST-CNTL-FILE                                        
                   SKU-ITEMS-RPT.                                               
                                                                                
      ******************************************************************        
      *    PROCESS UPC AND PRODUCE REPORT                                       
      ******************************************************************        
       C100-PROCESS-TUPC.                                                       
                                                                                
           SET SKU-FOUND              TO TRUE.                                  
           ADD +1                     TO PV-DEPT-FOUND.                         
                                                                                
           IF PV-MIN-XREF-CRE-DTE = PV-XREF-CRE-DTE                             
               SET RP-MIN-CREATE-DATE-USE TO TRUE                               
           ELSE                                                                 
               IF PV-MAX-XREF-CRE-DTE = PV-XREF-CRE-DTE                         
                   SET RP-MAX-CREATE-DATE-USE TO TRUE                           
               END-IF                                                           
           END-IF.                                                              
                                                                                
           PERFORM C200-PRODUCE-REPORT                                          
                                                                                
           PERFORM Z500-FETCH-TUPC.                                             
                                                                                
      ******************************************************************        
      *    PRODUCE REPORT                                                       
      ******************************************************************        
       C200-PRODUCE-REPORT.                                                     
                                                                                
           MOVE SKXREF-DEPT           TO RP-DEPT.                               
           MOVE SKXREF-SKU-STAT-CDE   TO RP-STATUS.                             
                                                                                
           IF SKXREF-SKU            = ZEROES                                    
               AND UPC-UPC-NBR      = ZEROES                                    
               AND SKXREF-ITM-NBR   = ZEROES                                    
               MOVE SPACES                TO RP-SKU-X                           
                                             RP-UPC-NBR-X                       
                                             RP-ITEM-NBR-X                      
                                             RP-LAST-RCVD-DATE                  
                                             RP-QTY-X                           
                                                                                
               MOVE SKXREF-DEPT           TO PV-MDSEAR-DEPT-NBR                 
               EXEC SQL                                                         
                   SELECT  MDSEAR_DESC                                          
                     INTO  :MDSEAR-DESC                                         
                     FROM  TMDSEAR                                              
                     WHERE OPERCO_NBR        = :PC-COMPANY-OPERCO               
                       AND MDSELV_CDE        = :PC-DEPT-CODE                    
                       AND DEPT_NBR          = :PV-MDSEAR-DEPT-NBR-X            
                       AND STRT_DTE         <= CURRENT DATE                     
                       AND (END_DTE         >= CURRENT DATE                     
                            OR END_DTE       = :PC-INCOMPLETE-DATE)             
               END-EXEC                                                         
               IF SQLCODE = +0                                                  
                   MOVE MDSEAR-DESC           TO PV-MDSEAR-DESC                 
               ELSE                                                             
                   MOVE PC-DEPT-NOT-FOUND     TO PV-MDSEAR-DESC                 
               END-IF                                                           
               MOVE PV-DEPT-DESC          TO RP-UPC-DESC                        
           ELSE                                                                 
               MOVE SKXREF-SKU            TO RP-SKU                             
               MOVE UPC-UPC-NBR           TO RP-UPC-NBR                         
               MOVE SKXREF-ITM-NBR        TO RP-ITEM-NBR                        
               MOVE UPC-INTR-UPC-DESC     TO RP-UPC-DESC                        
               MOVE TSKST-ONHAND-QTY      TO RP-QTY                             
                                                                                
               MOVE PV-LAST-RCVD-DATE-CCYY TO PV-LAST-RCVD-DATE-FMT-CCYY        
               MOVE PV-LAST-RCVD-DATE-MM  TO PV-LAST-RCVD-DATE-FMT-MM           
               MOVE PV-LAST-RCVD-DATE-MM  TO PV-LAST-RCVD-DATE-FMT-DD           
               MOVE PV-LAST-RCVD-DATE-FMT TO RP-LAST-RCVD-DATE                  
           END-IF.                                                              
                                                                                
           PERFORM Z700-PRINT-DETAILS.                                          
                                                                                
      ******************************************************************        
      *    OPEN THE DRIVING CURSOR                                              
      ******************************************************************        
       Z100-OPEN-TSKXREF.                                                       
                                                                                
           EXEC SQL                                                             
              OPEN TSKXREF-CURSOR                                               
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = +0                                                      
               SET NOT-END-OF-TSKXREF TO TRUE                                   
           ELSE                                                                 
               DISPLAY '  *** Z100-OPEN-TSKXREF ***'                            
               MOVE 'OPEN TSKXREF-CURSOR' TO  PV-OPER-ATTEMPTED                 
               PERFORM Z990-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *    GET/FETCH ROW FROM TSKXREF CURSOR                                    
      ******************************************************************        
       Z200-FETCH-TSKXREF.                                                      
                                                                                
           EXEC SQL FETCH TSKXREF-CURSOR                                        
               INTO  :SKXREF-DEPT                                               
                    ,:PV-MIN-XREF-CRE-DTE                                       
                    ,:PV-MAX-XREF-CRE-DTE                                       
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN +0                                                          
                   CONTINUE                                                     
               WHEN +100                                                        
                   SET END-OF-TSKXREF          TO TRUE                          
               WHEN OTHER                                                       
                   DISPLAY '  *** Z200-FETCH-TSKXREF ***'                       
                   MOVE 'FETCH TSKXREF-CURSOR' TO  PV-OPER-ATTEMPTED            
                   PERFORM Z990-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *    CLOSE THE DRIVING CURSOR                                             
      ******************************************************************        
       Z300-CLOSE-TSKXREF.                                                      
                                                                                
           EXEC SQL                                                             
              CLOSE TSKXREF-CURSOR                                              
           END-EXEC.                                                            
                                                                                
           IF SQLCODE NOT = +0                                                  
               DISPLAY '  *** Z300-CLOSE-TSKXREF ***'                           
               MOVE 'CLOSE TSKXREF-CURSOR' TO  PV-OPER-ATTEMPTED                
               PERFORM Z990-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *    OPEN TUPC/SKXREF CURSOR                                              
      ******************************************************************        
       Z400-OPEN-TUPC.                                                          
                                                                                
           EXEC SQL                                                             
              OPEN TUPC-CURSOR                                                  
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = +0                                                      
               SET NOT-END-OF-TUPC TO TRUE                                      
               SET SKU-NOT-FOUND      TO TRUE                                   
           ELSE                                                                 
               DISPLAY '  *** Z100-OPEN-TUPC ***'                               
               DISPLAY '  XREF CRE DATE: ' PV-XREF-CRE-DTE                      
               MOVE 'OPEN TUPC-CURSOR' TO     PV-OPER-ATTEMPTED                 
               PERFORM Z990-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *    GET MORE INFORMATION FROM VARIOUS TABLES                             
      ******************************************************************        
       Z500-FETCH-TUPC.                                                         
                                                                                
           EXEC SQL FETCH TUPC-CURSOR                                           
               INTO  :UPC-UPC-NBR                                               
                    ,:SKXREF-ITM-NBR                                            
                    ,:SKXREF-SKU-STAT-CDE                                       
                    ,:SKXREF-SKU                                                
                    ,:UPC-INTR-UPC-DESC                                         
                    ,:UPC-UPC-TYP-CDE                                           
                    ,:TSKST-LAST-RCVD-DATE                                      
                    ,:TSKST-ONHAND-QTY                                          
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN +0                                                          
                   MOVE TSKST-LAST-RCVD-DATE   TO PV-LAST-RCVD-DATE             
                   IF TSKST-LAST-RCVD-DATE > PC-FS-CUTOFF-YEAR-DATE             
                       MOVE PC-19              TO PV-LAST-RCVD-DATE-CC          
                   ELSE                                                         
                       MOVE PC-20              TO PV-LAST-RCVD-DATE-CC          
                   END-IF                                                       
               WHEN +100                                                        
                   SET END-OF-TUPC             TO TRUE                          
               WHEN OTHER                                                       
                   DISPLAY '  *** Z500-FETCH-TUPC ***'                          
                   DISPLAY '  XREF CRE DATE: ' PV-XREF-CRE-DTE                  
                   MOVE 'FETCH TUPC-CURSOR' TO     PV-OPER-ATTEMPTED            
                   PERFORM Z990-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *    CLOSE TUPC/SKXREF CURSOR                                             
      ******************************************************************        
       Z600-CLOSE-TUPC.                                                         
                                                                                
           EXEC SQL                                                             
              CLOSE TUPC-CURSOR                                                 
           END-EXEC.                                                            
                                                                                
           IF SQLCODE NOT = +0                                                  
               DISPLAY '  *** Z300-CLOSE-TUPC ***'                              
               DISPLAY '  XREF CRE DATE: ' PV-XREF-CRE-DTE                      
               MOVE 'CLOSE TUPC-CURSOR' TO     PV-OPER-ATTEMPTED                
               PERFORM Z990-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *    PRINT THE REPORT DETAILS                                             
      ******************************************************************        
       Z700-PRINT-DETAILS.                                                      
                                                                                
           IF PV-PRINT-LINE-COUNT > PC-PRINT-LINE-MAX                           
               OR PV-PRINT-LINE-COUNT = 0                                       
               PERFORM Z725-PRINT-HEADINGS                                      
           END-IF.                                                              
                                                                                
           WRITE REPORT-LINE FROM RP-REPORT-DETAIL                              
               AFTER ADVANCING PV-ADVANCE-LINE LINES.                           
                                                                                
           ADD  PV-ADVANCE-LINE TO PV-PRINT-LINE-COUNT.                         
           MOVE +1              TO PV-ADVANCE-LINE.                             
           MOVE SPACES TO RP-REPORT-DETAIL.                                     
                                                                                
      ******************************************************************        
      *    PRINT THE REPORT HEADINGS                                            
      ******************************************************************        
       Z725-PRINT-HEADINGS.                                                     
                                                                                
           ADD 1 TO PV-PAGE-COUNT.                                              
           MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                            
           MOVE 1             TO DP132O-REPORT-NUMBER.                          
           WRITE REPORT-LINE FROM DP132O-STANDRD-HEADER-132-COLS                
               AFTER ADVANCING PAGE.                                            
                                                                                
           WRITE REPORT-LINE FROM RP-REPORT-TITLE-1.                            
                                                                                
           WRITE REPORT-LINE FROM RP-REPORT-HEADER-1                            
               AFTER ADVANCING 2 LINES.                                         
           WRITE REPORT-LINE FROM RP-REPORT-HEADER-2.                           
                                                                                
           MOVE +6 TO PV-PRINT-LINE-COUNT.                                      
           MOVE +2 TO PV-ADVANCE-LINE.                                          
                                                                                
      ******************************************************************        
      *    SQL ERROR - ABEND                                                    
      ******************************************************************        
       Z990-SQL-ABEND.                                                          
                                                                                
           SET ABEND-4013             TO TRUE.                                  
           DISPLAY '**  ABEND     **'.                                          
           DISPLAY '**  PROGRAM   **  =  INKRP505'.                             
           DISPLAY '**  OPERATION **  = '  PV-OPER-ATTEMPTED                    
                                                                                
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE                 
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.                
                                                                                
           COPY DPPD004.                                                        
                                                                                
           PERFORM Z999-ABEND.                                                  
                                                                                
      ******************************************************************        
      *    CALL ABEND ROUTINE                                                   
      ******************************************************************        
       Z999-ABEND.                                                              
                                                                                
           CALL 'ILBOABN0'  USING ABEND-CODE.                                   
                                                                                
