000100******************************************************************00010000
000110 IDENTIFICATION DIVISION.                                         00011000
000120******************************************************************00012000
000130                                                                  00013000
000140 PROGRAM-ID.    SUKUT208.                                         00014000
000150 AUTHOR.        DENISE HAHN.                                      00015000
000160 INSTALLATION.  KOHLS.                                            00016000
000170 DATE-WRITTEN   AUGUST, 2022.                                     00017000
000180 DATE-COMPILED.                                                   00018000
000190                                                                  00019000
000191******************************************************************00019100
000192*  THIS PROGRAM WILL CHECK ANY OUTBOUND TRAILERS THAT ARE OLDER   00019200
000193*  X DAYS OLD (PARM)  AND ARE NOT IN A COMPLETED STATUS.          00019300
000194*  (DR-DC RELEASED, SU-STORE UNLOADED, AR-AUDIT RELEASED)         00019400
000195*                                                                 00019500
000196*  AN EXTRACT FILE WILL BE CREATED WITH THE TRIP INFORMATION.     00019600
000197*  THE NEXT PROGRAM WILL UPDATE THE TRIP TO A DR OR SU STATUS     00019700
000198*  TO ALLOW THE TRIP TO BE PURGED AND THE TRAILER TO BE ABLE      00019800
000199*  TO BE REUSED.                                                  00019900
000200******************************************************************00020000
000201******************************************************************00020100
000202 ENVIRONMENT DIVISION.                                            00020200
000203******************************************************************00020300
000204 CONFIGURATION SECTION.                                           00020400
000205                                                                  00020500
000206 SOURCE-COMPUTER.        IBM-3090.                                00020600
000207 OBJECT-COMPUTER.        IBM-3090.                                00020700
000208                                                                  00020800
000209 INPUT-OUTPUT SECTION.                                            00020900
000210                                                                  00021000
000211 FILE-CONTROL.                                                    00021100
000212*                                                                 00021200
000216     SELECT EXTRACT-FILE                                          00021600
000217         ASSIGN TO OUT01.                                         00021700
000218                                                                  00021800
000219*                                                                 00021900
000220******************************************************************00022000
000221 DATA DIVISION.                                                   00022100
000222******************************************************************00022200
000223                                                                  00022301
000224 FILE SECTION.                                                    00022400
000225                                                                  00022501
000236 FD  EXTRACT-FILE                                                 00023600
000237     RECORDING MODE IS F                                          00023700
000238     RECORD CONTAINS 200 CHARACTERS                               00023819
000239     LABEL RECORDS ARE STANDARD.                                  00023901
000241 01  EXTRACT-RECORD                 PIC X(200).                   00024119
000242                                                                  00024200
000243******************************************************************00024300
000244 WORKING-STORAGE SECTION.                                         00024400
000245******************************************************************00024500
000246*                                                                 00024600
000247******************************************************************00024700
000248*  DB2 FORMATTED MESSAGE AREA                                     00024800
000249******************************************************************00024900
000250     COPY DPWS004.                                                00025000
000251                                                                  00025100
000252******************************************************************00025200
000253*    COMMUNICATIONS AREA FOR DB2                                  00025300
000254******************************************************************00025400
000255                                                                  00025500
000256     EXEC SQL                                                     00025600
000257          INCLUDE SQLCA                                           00025700
000258     END-EXEC.                                                    00025800
000259                                                                  00025900
000260******************************************************************00026000
000261*                                                                 00026100
000262 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00026200
000263                                                   COMP SYNC.     00026300
000264 01  DK-DB2-KEYS.                                                 00026401
000265     05  DK-TMST                     PIC X(26).                   00026501
000266                                                                  00026600
000267 01  PS-PROGRAM-SWITCHES.                                         00026700
000268     05  PS-END-OF-CURSOR-SW         PIC X(03)     VALUE 'N'.     00026800
000269         88  PS-END-OF-CURSOR-YES                  VALUE 'Y'.     00026900
000270         88  PS-END-OF-CURSOR-NO                   VALUE 'N'.     00027000
000271     05  PS-FIRST-TIME-SW            PIC X(01)     VALUE 'N'.     00027100
000272         88  PS-FIRST-TIME-YES                     VALUE 'Y'.     00027200
000273         88  PS-FIRST-TIME-NO                      VALUE 'N'.     00027300
000274     05  PS-EOF-PROCESS-SW           PIC  X(01)    VALUE 'N'.     00027400
000275         88  PS-EOF-PROCESS-YES                    VALUE 'Y'.     00027500
000276         88  PS-EOF-PROCESS-NO                     VALUE 'N'.     00027600
000277                                                                  00027700
000278                                                                  00027800
000279 01  PC-PROGRAM-CONSTANTS.                                        00027900
000282     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       00028200
000283                                                   COMP SYNC.     00028300
000284                                                                  00028400
000285 01  PV-PROGRAM-VARIABLES.                                        00028500
000286     05  PV-CURRENT-TMST             PIC X(26).                   00028602
000287     05  PV-SQL-RETURN-CD            PIC 999-.                    00028702
000288     05  PV-CICS-MSG-AREA            PIC  X(80)    VALUE SPACES.  00028802
000289     05  PV-COMMAREA-LENGTH          PIC S9(04)    VALUE +0       00028902
000290                                                   COMP SYNC.     00029002
000291     05  PV-CICS-RESPONSE            PIC S9(9)     VALUE ZERO     00029102
000300                                                   COMP SYNC.     00030000
000301                                                                  00030100
000302     05  PV-OTBND-TRIP-ID-MSG.                                    00030200
000303         10  FILLER                  PIC  X(13)    VALUE          00030300
000304         'OTBND TRIP = '.                                         00030400
000305         10  PV-OTBND-TRIP-ID        PIC  9(15).                  00030500
000306     05  PV-DONE-PROCESSING-SW       PIC  X(01)    VALUE 'N'.     00030600
000307         88  PV-DONE-PROCESSING                    VALUE 'Y'.     00030700
000308     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACE.   00030800
000309     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00030900
000310     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00031000
000311                                                                  00031100
000312     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     00031200
000313                                                   COMP SYNC.     00031300
000314     05  PV-ABEND-PARA-NAME          PIC X(30)     VALUE SPACES.  00031400
000315     05  PV-DB2-OPERATION-MSG-1      PIC X(40)     VALUE SPACES.  00031500
000316     05  PV-DB2-OPERATION-MSG-2      PIC X(40)     VALUE SPACES.  00031600
000317     05  PV-DB2-OPERATION-MSG-3      PIC X(40)     VALUE SPACES.  00031700
000318     05  PV-DB2-TABLE-NAME           PIC X(17)     VALUE SPACES.  00031800
000319     05  PV-SQLCODE                  PIC Z(8)9-.                  00031900
000320     05  PV-RETRY-COUNTER            PIC S9(04)    VALUE ZERO     00032000
000321                                                   COMP SYNC.     00032100
000322                                                                  00032200
000323     05  PV-DAYS-TO-DELETE           PIC S9(04)    COMP.          00032300
000324     05  PV-DAYS-TO-DELETE-DSPLY     PIC  9(04).                  00032400
000325     05  PV-DAYS                     PIC  9(04).                  00032507
000326     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             00032607
000327                                                                  00032707
000328     05  PV-RECORDS-READ             PIC S9(07)    COMP-3         00032807
000329                                                   VALUE ZEROS.   00032907
000330     05  PV-RECORDS-WRITTEN          PIC S9(07)    COMP-3         00033007
000340                                                   VALUE ZEROS.   00034007
000350     05  PV-NULL-IND-1               PIC S9(04)  VALUE ZEROS      00035021
000360                                                   COMP SYNC.     00036021
000361     05  PV-NULL-IND-2               PIC S9(04)  VALUE ZEROS      00036121
000362                                                   COMP SYNC.     00036221
000363     05  PV-NULL-IND-3               PIC S9(04)  VALUE ZEROS      00036321
000364                                                   COMP SYNC.     00036421
000368******************************************************************00036800
000369*    ABEND PROCESSING COPYBOOK.                                   00036900
000370******************************************************************00037000
000371                                                                  00037100
000372     COPY DPWS013.                                                00037200
000373                                                                  00037300
000379******************************************************************00037900
000380*    OUTPUT EXTRACT RECORD                                        00038000
000381******************************************************************00038100
000382     COPY SURD174.                                                00038206
000383                                                                  00038300
000384*----------------------------------------------------------------*00038400
000385*  PARM TABLE                                                    *00038501
000386*----------------------------------------------------------------*00038600
000387     EXEC SQL                                                     00038700
000388         INCLUDE TKRPRPM                                          00038801
000389     END-EXEC.                                                    00038900
000390                                                                  00039000
000391*----------------------------------------------------------------*00039101
000392*  OUTBOUND TRIP                                                 *00039201
000393*----------------------------------------------------------------*00039301
000394     EXEC SQL                                                     00039401
000395         INCLUDE TSUOBTR                                          00039501
000396     END-EXEC.                                                    00039601
000397                                                                  00039701
000398*----------------------------------------------------------------*00039800
000399*  OUTBOUND TRIP STATUS                                          *00039900
000400*----------------------------------------------------------------*00040000
000401     EXEC SQL                                                     00040100
000402         INCLUDE TSUOBTS                                          00040200
000403     END-EXEC.                                                    00040300
000404                                                                  00040400
000412*----------------------------------------------------------------*00041200
000413*  OUTBOUND TRIP SUM  - SUT_TRIP_SUM                             *00041300
000414*----------------------------------------------------------------*00041400
000415     EXEC SQL                                                     00041500
000416         INCLUDE SUT00007                                         00041600
000417     END-EXEC.                                                    00041700
000418                                                                  00041800
000419*----------------------------------------------------------------*00041900
000420*  OUTBOUND CONVEYOR CUTOFF - TSUCDOT                            *00042000
000421*----------------------------------------------------------------*00042100
000422     EXEC SQL                                                     00042200
000423         INCLUDE TSUCDOT                                          00042300
000424     END-EXEC.                                                    00042400
000425                                                                  00042500
000426*----------------------------------------------------------------*00042600
000427*  CARTON DIVERTS                                                *00042700
000428*----------------------------------------------------------------*00042800
000429     EXEC SQL                                                     00042900
000430         INCLUDE TSUCRDV                                          00043000
000431     END-EXEC.                                                    00043100
000432                                                                  00043200
000433*----------------------------------------------------------------*00043300
000434*  OUTBOUND LOCATION - SUT_OTBND_LOC                             *00043400
000435*----------------------------------------------------------------*00043500
000436     EXEC SQL                                                     00043600
000437         INCLUDE SUT00027                                         00043700
000438     END-EXEC.                                                    00043800
000439                                                                  00043900
000440*----------------------------------------------------------------*00044000
000441*                                                                *00044100
000442*----------------------------------------------------------------*00044200
000443     EXEC SQL                                                     00044300
000444          DECLARE TRIP-STATUS-CSR                                 00044400
000445           CURSOR FOR                                             00044500
000446           SELECT T1.OTBND_TRIP_ID                                00044600
000447                , T1.ORGN_OPER_UNT_ID                             00044700
000448                , T1.DEST_OPER_UNT_ID                             00044800
000449                , T1.TRLR_SRL_NBR                                 00044900
000450                , T1.DOOR_TYP_CDE                                 00045000
000451                , T1.OTBND_STAT_TMST                              00045100
000452                , T1.TRIP_STAT_CDE                                00045200
000453                , T1.STAT_OPER_UNT_ID                             00045300
000454                , T1.OTBND_STAT_USR_ID                            00045400
000455                , T1.TRLR_SEAL_ID                                 00045500
000456                , T1.DOOR_ID                                      00045600
000457                , T2.UNT_QTY                                      00045713
000458                , T2.SKU_QTY                                      00045813
000459                , T2.CART_QTY                                     00045913
000460                , T1.OTBND_STAT_TMST + 1 DAYS                     00046017
000461                , T1.OTBND_STAT_TMST + 2 DAYS                     00046117
000462                , T1.OTBND_STAT_TMST + 3 DAYS                     00046217
000463             FROM                                                 00046317
000464                 (SELECT A.OTBND_TRIP_ID                          00046417
000465                       , A.ORGN_OPER_UNT_ID                       00046517
000466                       , A.DEST_OPER_UNT_ID                       00046617
000467                       , A.TRLR_SRL_NBR                           00046717
000468                       , A.DOOR_TYP_CDE                           00046817
000469                       , B.OTBND_STAT_TMST                        00046900
000470                       , B.TRIP_STAT_CDE                          00047000
000471                       , B.STAT_OPER_UNT_ID                       00047100
000472                       , B.OTBND_STAT_USR_ID                      00047200
000473                       , B.TRLR_SEAL_ID                           00047300
000474                       , B.DOOR_ID                                00047400
000475                    FROM TSUOBTR A                                00047500
000476                       , TSUOBTS B                                00047600
000478                   WHERE A.OTBND_TRIP_ID  =  B.OTBND_TRIP_ID      00047800
000479                     AND B.OTBND_STAT_TMST IN                     00047900
000480                        (SELECT MAX(BB.OTBND_STAT_TMST)           00048000
000481                           FROM TSUOBTS BB                        00048100
000482                          WHERE B.OTBND_TRIP_ID =                 00048200
000483                                BB.OTBND_TRIP_ID)                 00048300
000484                     AND NOT B.TRIP_STAT_CDE IN ('DR','SU','AR')  00048400
000485                     AND B.OTBND_STAT_TMST < :DK-TMST             00048500
000487                 ) AS T1                                          00048700
000488                                                                  00048813
000489                 LEFT OUTER JOIN                                  00048913
000490                                                                  00049013
000491                 (SELECT A2.OTBND_TRIP_ID                         00049113
000492                       , C2.UNT_QTY                               00049213
000493                       , C2.SKU_QTY                               00049313
000494                       , C2.CART_QTY                              00049413
000495                    FROM TSUOBTR A2                               00049513
000496                       , TSUOBTS B2                               00049613
000497                       , SUT_TRIP_SUM C2                          00049713
000498                   WHERE A2.OTBND_TRIP_ID  =  B2.OTBND_TRIP_ID    00049813
000499                     AND B2.OTBND_STAT_TMST IN                    00049913
000500                         (SELECT MAX(BB2.OTBND_STAT_TMST)         00050013
000501                            FROM TSUOBTS BB2                      00050113
000502                           WHERE B2.OTBND_TRIP_ID  =              00050213
000503                                 BB2.OTBND_TRIP_ID)               00050313
000504                     AND NOT B2.TRIP_STAT_CDE IN ('DR','SU','AR') 00050413
000505                     AND B2.OTBND_STAT_TMST < :DK-TMST            00050513
000506                     AND A2.OTBND_TRIP_ID  =  C2.OTBND_TRIP_ID    00050613
000507                     AND C2.CRE_TMST  IN                          00050724
000508                         (SELECT MAX(CC2.CRE_TMST)                00050824
000509                           FROM SUT_TRIP_SUM CC2                  00050924
000510                          WHERE C2.OTBND_TRIP_ID  =               00051024
000511                                CC2.OTBND_TRIP_ID)                00051124
000512                 ) AS T2                                          00051213
000513                                                                  00051313
000520                 ON T1.OTBND_TRIP_ID  = T2.OTBND_TRIP_ID          00052013
000572            ORDER BY 6                                            00057223
000573             WITH UR                                              00057300
000574     END-EXEC.                                                    00057400
000575                                                                  00057500
000576******************************************************************00057600
000577 PROCEDURE DIVISION.                                              00057700
000578******************************************************************00057800
000579*                                                                 00057900
000580******************************************************************00058000
000581* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     00058100
000582*      PROGRAM.                                                   00058200
000583******************************************************************00058300
000584 0000-PROGRAM-MAINLINE.                                           00058400
000585*                                                                 00058500
000586     DISPLAY ' '.                                                 00058600
000587     DISPLAY '* START OF SUKUT208 - TRIP EXTRACT              *'. 00058700
000588     DISPLAY ' '.                                                 00058800
000589                                                                  00058900
000590      PERFORM 1000-INITIALIZE                                     00059000
000591                                                                  00059100
000592      PERFORM 2000-MAIN-PROCESS                                   00059200
000593              UNTIL PS-END-OF-CURSOR-YES                          00059300
000594                                                                  00059400
000595      PERFORM 9000-END-PROCESS.                                   00059500
000596                                                                  00059600
000597     STOP RUN.                                                    00059700
000598                                                                  00059800
000599*----------------------------------------------------------------*00059900
000600*    -- OPEN FILES                                                00060000
000601*----------------------------------------------------------------*00060100
000602 1000-INITIALIZE.                                                 00060200
000603                                                                  00060300
000604     OPEN OUTPUT EXTRACT-FILE.                                    00060400
000605                                                                  00060500
000606     PERFORM 1010-SELECT-PURGE-DATES.                             00060600
000607                                                                  00060700
000608     DISPLAY ' PARM:  OTTRDY'.                                    00060800
000609     MOVE KRPRPM-FUNC-QTY  TO  PV-DAYS                            00060900
000610     DISPLAY ' DAYS: ' PV-DAYS                                    00061000
000611     DISPLAY ' CURRENT TIMESTAMP: ' PV-CURRENT-TMST               00061100
000612     DISPLAY ' PROCESS TIMESTAMP: ' DK-TMST                       00061200
000613     DISPLAY ' '.                                                 00061307
000614                                                                  00061400
000615*----------------------------------------------------------------*00061500
000616*    -- SELECT THE PURGE THRU DATE OTTRDY                         00061600
000617*----------------------------------------------------------------*00061700
000618 1010-SELECT-PURGE-DATES.                                         00061800
000619                                                                  00061900
000620     PERFORM WITH TEST AFTER                                      00062000
000621       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       00062100
000622         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 00062200
000623                OR                                                00062300
000624                SQLCODE = +0)                                     00062400
000625                                                                  00062500
000626         EXEC SQL                                                 00062600
000627              SELECT SYS_PRC_FUNC_CDE                             00062704
000628                   , FUNC_QTY                                     00062804
000629                   , CURRENT TIMESTAMP                            00062904
000630                   , CURRENT TIMESTAMP - FUNC_QTY DAYS            00063004
000631               INTO :KRPRPM-SYS-PRC-FUNC-CDE                      00063104
000632                   ,:KRPRPM-FUNC-QTY                              00063204
000633                   ,:PV-CURRENT-TMST                              00063304
000634                   ,:DK-TMST                                      00063404
000635               FROM TKRPRPM                                       00063505
000636              WHERE LOC_ID            = 90                        00063605
000637                AND INTFC_SYS_CDE     = 'KHL'                     00063705
000638                AND SYS_PRC_FUNC_CDE  = 'OTTRDT'                  00063820
000639                AND FUNC_PRC_STAT_CDE = 'AC'                      00063905
000640                AND FUNC_BEG_TMST     <= CURRENT TIMESTAMP        00064005
000641                AND FUNC_END_TMST     >= CURRENT TIMESTAMP        00064105
000642         END-EXEC                                                 00064205
000643                                                                  00064305
000644         EVALUATE TRUE                                            00064405
000645             WHEN SQLCODE = +0                                    00064505
000646             WHEN SQLCODE = -904                                  00064605
000647             WHEN SQLCODE = -911                                  00064705
000648                 CONTINUE                                         00064805
000649                                                                  00064905
000650             WHEN SQLWARN0 NOT = SPACES                           00065005
000651             WHEN SQLCODE < +0                                    00065105
000652             WHEN SQLCODE > +0                                    00065205
000653                 MOVE '1010-SELECT-PURGE-DATES    '               00065305
000654                                    TO PV-ABEND-PARA-NAME         00065405
000656                 MOVE 'SELECT PARM: OTTRDT'                       00065605
000657                                    TO PV-DB2-OPERATION-MSG-1     00065705
000658                 MOVE 'TKRPRPM'                                   00065805
000659                                    TO PV-DB2-TABLE-NAME          00065905
000660                 PERFORM 9998-SQL-ABEND                           00066005
000670         END-EVALUATE                                             00067005
000675     END-PERFORM.                                                 00067500
000676                                                                  00067600
000677     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         00067700
000678         MOVE '1010-SELECT-PURGE-DATES   '                        00067800
000679                                    TO PV-ABEND-PARA-NAME         00067900
000682         MOVE 'SELECT PARM: OTTRDT'                               00068200
000683                                    TO PV-DB2-OPERATION-MSG-1     00068300
000684         MOVE 'MAX RETRIES EXCEEDED'                              00068400
000685                                    TO PV-DB2-OPERATION-MSG-2     00068500
000686         MOVE 'TKRPRPM'             TO PV-DB2-TABLE-NAME          00068600
000687         PERFORM 9998-SQL-ABEND                                   00068700
000688     END-IF.                                                      00068800
000689                                                                  00068900
000690                                                                  00069000
000692*----------------------------------------------------------------*00069200
000693*                                                                 00069300
000694*----------------------------------------------------------------*00069400
000695 2000-MAIN-PROCESS.                                               00069500
000696                                                                  00069600
000697     SET PS-END-OF-CURSOR-NO  TO TRUE.                            00069700
000698                                                                  00069800
000699     PERFORM 4000-OPEN-CURSOR.                                    00069900
000700                                                                  00070000
000701     PERFORM 4100-FETCH-CURSOR.                                   00070100
000702                                                                  00070200
000703     IF PS-END-OF-CURSOR-NO                                       00070300
000704         PERFORM 3000-WRITE-EXTRACT-OUT                           00070400
000705             UNTIL PS-END-OF-CURSOR-YES                           00070500
000706     END-IF.                                                      00070600
000707                                                                  00070700
000708     PERFORM 4200-CLOSE-CURSOR.                                   00070800
000709                                                                  00070900
000711                                                                  00071100
000712                                                                  00071200
000713 3000-WRITE-EXTRACT-OUT.                                          00071300
000714                                                                  00071400
000715     WRITE EXTRACT-RECORD                                         00071500
000716         FROM SU174-TRIP-RECORD.                                  00071607
000717     ADD  +1         TO PV-RECORDS-WRITTEN.                       00071700
000718                                                                  00071800
000719     PERFORM 4100-FETCH-CURSOR.                                   00071900
000720                                                                  00072000
000721                                                                  00072100
000722 4000-OPEN-CURSOR.                                                00072200
000723                                                                  00072300
000724     PERFORM WITH TEST AFTER                                      00072400
000725       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       00072500
000726         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 00072600
000727                OR                                                00072700
000728                SQLCODE = +0)                                     00072800
000729                                                                  00072900
000730         EXEC SQL                                                 00073000
000731              OPEN TRIP-STATUS-CSR                                00073100
000732         END-EXEC                                                 00073200
000733                                                                  00073300
000734         EVALUATE TRUE                                            00073400
000735             WHEN SQLCODE = +0                                    00073500
000736             WHEN SQLCODE = -904                                  00073600
000737             WHEN SQLCODE = -911                                  00073700
000738                 CONTINUE                                         00073800
000739             WHEN SQLWARN0 NOT = SPACES                           00073900
000740             WHEN SQLCODE < +0                                    00074000
000741             WHEN SQLCODE > +0                                    00074100
000742                 MOVE '4000-OPEN-CURSOR          '                00074200
000743                                    TO PV-ABEND-PARA-NAME         00074300
000744                 MOVE 'OPEN CURSOR -  TRIP-STATUS-CSR'            00074400
000747                                    TO PV-DB2-OPERATION-MSG-1     00074700
000748                 MOVE 'TSUOBTR '                                  00074800
000749                                    TO PV-DB2-TABLE-NAME          00074900
000750                 PERFORM 9998-SQL-ABEND                           00075000
000751         END-EVALUATE                                             00075100
000752     END-PERFORM.                                                 00075200
000753                                                                  00075300
000754     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         00075400
000755          MOVE '4000-OPEN-CURSOR          '                       00075500
000756                                    TO PV-ABEND-PARA-NAME         00075600
000757          MOVE 'OPEN CURSOR -  TRIP-STATUS-CSR'                   00075700
000758                                    TO PV-DB2-OPERATION-MSG-1     00075800
000760          MOVE 'MAX RETRIES EXCEEDED'                             00076000
000761                                    TO PV-DB2-OPERATION-MSG-2     00076100
000762          MOVE 'TSUOBTR          '  TO PV-DB2-TABLE-NAME          00076200
000763          PERFORM 9998-SQL-ABEND                                  00076300
000764     END-IF.                                                      00076400
000765                                                                  00076500
000766 4100-FETCH-CURSOR.                                               00076600
000767                                                                  00076700
000768     PERFORM WITH TEST AFTER                                      00076800
000769       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       00076900
000770         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 00077000
000771                OR SQLCODE = +0                                   00077100
000772                OR PS-END-OF-CURSOR-YES)                          00077200
000773                                                                  00077300
000774         EXEC SQL                                                 00077400
000775             FETCH TRIP-STATUS-CSR                                00077500
000780              INTO :SU174-OTBND-TRIP-ID                           00078000
000781                  ,:SU174-ORIG-OPER                               00078100
000782                  ,:SU174-DEST-OPER                               00078200
000783                  ,:SU174-TRLR-SRL-NBR                            00078300
000784                  ,:SU174-DOOR-TYPE                               00078400
000788                  ,:SU174-STATUS-TMST                             00078817
000789                  ,:SU174-TRIP-STATUS                             00078900
000796                  ,:SU174-STATUS-OPER                             00079600
000797                  ,:SU174-STATUS-USR-ID                           00079700
000798                  ,:SU174-TRLR-SEAL                               00079800
000799                  ,:SU174-DOOR-ID                                 00079900
000800                  ,:SU174-UNT-QTY  :PV-NULL-IND-1                 00080021
000801                  ,:SU174-SKU-QTY  :PV-NULL-IND-2                 00080121
000802                  ,:SU174-CART-QTY :PV-NULL-IND-3                 00080221
000803                  ,:SU174-STATUS-TMST-1DAYS                       00080318
000804                  ,:SU174-STATUS-TMST-2DAYS                       00080418
000805                  ,:SU174-STATUS-TMST-3DAYS                       00080518
000806         END-EXEC                                                 00080617
000807                                                                  00080717
000808         EVALUATE TRUE                                            00080817
000809             WHEN SQLCODE = +0                                    00080917
000810                  IF  PV-NULL-IND-1  =  -1                        00081021
000811                      MOVE ZEROES  TO  SU174-UNT-QTY              00081121
000812                  END-IF                                          00081222
000813                                                                  00081321
000814                  IF  PV-NULL-IND-2  =  -1                        00081421
000815                      MOVE ZEROES  TO  SU174-SKU-QTY              00081521
000816                  END-IF                                          00081622
000817                                                                  00081721
000818                  IF  PV-NULL-IND-3  =  -1                        00081821
000819                      MOVE ZEROES  TO  SU174-CART-QTY             00081921
000820                  END-IF                                          00082022
000821                                                                  00082121
000822             WHEN SQLCODE = -904                                  00082221
000823             WHEN SQLCODE = -911                                  00082321
000824                 CONTINUE                                         00082421
000825             WHEN SQLCODE = +100                                  00082521
000826                 SET PS-END-OF-CURSOR-YES                         00082621
000827                                    TO TRUE                       00082721
000828             WHEN SQLWARN0 NOT = SPACES                           00082821
000829             WHEN SQLCODE < +0                                    00082921
000830             WHEN SQLCODE > +0                                    00083021
000831                 MOVE '4100-FETCH-CURSOR          '               00083121
000832                                    TO PV-ABEND-PARA-NAME         00083221
000833                 MOVE 'TSUOBTR'                                   00083300
000834                                    TO PV-DB2-TABLE-NAME          00083400
000835                 PERFORM 9998-SQL-ABEND                           00083500
000836         END-EVALUATE                                             00083600
000837     END-PERFORM.                                                 00083700
000838                                                                  00083800
000839     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         00083900
000840          MOVE '4100-FETCH-CURSOR          '                      00084000
000841                                    TO PV-ABEND-PARA-NAME         00084100
000842          MOVE 'MAX RETRIES EXCEEDED'                             00084200
000843                                    TO PV-DB2-OPERATION-MSG-2     00084300
000844          MOVE 'TSUOBTR'            TO PV-DB2-TABLE-NAME          00084400
000845          PERFORM 9998-SQL-ABEND                                  00084500
000846     END-IF.                                                      00084600
000847                                                                  00084700
000848 4200-CLOSE-CURSOR.                                               00084800
000849                                                                  00084900
000850     PERFORM WITH TEST AFTER                                      00085000
000851       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       00085100
000852         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 00085200
000853                OR                                                00085300
000854                SQLCODE = +0)                                     00085400
000855                                                                  00085500
000856         EXEC SQL                                                 00085600
000857              CLOSE TRIP-STATUS-CSR                               00085700
000858         END-EXEC                                                 00085800
000859                                                                  00085900
000860         EVALUATE TRUE                                            00086000
000861             WHEN SQLCODE = +0                                    00086100
000862             WHEN SQLCODE = -904                                  00086200
000863             WHEN SQLCODE = -911                                  00086300
000864                 CONTINUE                                         00086400
000865             WHEN SQLWARN0 NOT = SPACES                           00086500
000866             WHEN SQLCODE < +0                                    00086600
000867             WHEN SQLCODE > +0                                    00086700
000868                 MOVE '4200-CLOSE-CURSOR          '               00086800
000869                                         TO PV-ABEND-PARA-NAME    00086900
000870                 MOVE 'TSUOBTR'                                   00087000
000871                                         TO PV-DB2-TABLE-NAME     00087100
000872                 PERFORM 9998-SQL-ABEND                           00087200
000873         END-EVALUATE                                             00087300
000874     END-PERFORM.                                                 00087400
000875                                                                  00087500
000876     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         00087600
000877          MOVE '4200-CLOSE-CURSOR          '                      00087700
000878                                    TO PV-ABEND-PARA-NAME         00087800
000879          MOVE 'MAX RETRIES EXCEEDED'                             00087900
000880                                    TO PV-DB2-OPERATION-MSG-2     00088000
000890          MOVE 'TSUOBTR'            TO PV-DB2-TABLE-NAME          00089000
000900          PERFORM 9998-SQL-ABEND                                  00090000
001000     END-IF.                                                      00100000
001100                                                                  00110000
002200******************************************************************00220000
002300*     CLOSE FILES.                                              **00230000
002400******************************************************************00240000
002500 9000-END-PROCESS.                                                00250000
002600                                                                  00260000
002700     CLOSE EXTRACT-FILE.                                          00270000
002900                                                                  00290000
003000     PERFORM 9999-FINAL-DISPLAYS.                                 00300000
003100                                                                  00310000
003200******************************************************************00320000
003300*     SQL ERROR PROCESSING                                      **00330000
003400******************************************************************00340000
003500 9998-SQL-ABEND.                                                  00350000
003600     PERFORM 9999-FINAL-DISPLAYS.                                 00360000
003700     MOVE SQLCODE     TO PV-SQLCODE.                              00370000
003800     DISPLAY '** ABEND           ** = SQLABEND'.                  00380000
003900     DISPLAY '** PROGRAM         ** = SUKUT208'.                  00390010
004000     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARA-NAME        00400000
004100     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        00410000
004200     DISPLAY '** OPERATIONAL MSG ** = ' PV-DB2-OPERATION-MSG-1.   00420000
004300     DISPLAY '** OPERATIONAL MSG ** = ' PV-DB2-OPERATION-MSG-2.   00430000
004400     DISPLAY '** OPERATIONAL MSG ** = ' PV-DB2-OPERATION-MSG-3.   00440000
004500     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               00450000
004600     COPY DPPD004.                                                00460000
004700                                                                  00470000
004800     MOVE +4013                  TO PV-ABEND-CODE.                00480000
004900     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       00490000
005000*                                                                 00500000
005100 9999-FINAL-DISPLAYS.                                             00510000
005200     DISPLAY '*--------------------------------*'.                00520000
005300     DISPLAY '** SUKUT208 SUMMARY **'.                            00530000
005400     DISPLAY ' '.                                                 00540001
005600     MOVE PV-RECORDS-WRITTEN    TO PV-DISPLAY-COUNT               00560000
005700     DISPLAY 'TOTAL EXTRACT RECORDS       = ' PV-DISPLAY-COUNT   .00570000
005800     DISPLAY '**********************************'.                00580000
