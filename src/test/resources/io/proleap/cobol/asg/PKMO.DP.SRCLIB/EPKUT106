       IDENTIFICATION DIVISION.                                         00010030
       PROGRAM-ID.      EPKUT106.                                       00020030
       AUTHOR.          PAUL OMAN.                                      00030030
       DATE-WRITTEN.    APRIL 2003.                                     00040030
                                                                        00050030
      *--------------------------------------------------------------*  00060030
      *    EXTRACT PLU CHANGES - SKU AND STYLE CHANGES               *  00070030
      *                                                              *  00080030
      *  INPUTS:                                                     *  00090030
      *      EPCC105   CONTAINS TIMESTAMP WHEN PROCESS WAS LAST RUN. *  00100030
      *     (EPWS105)  USED IN CURSORS.                              *  00110030
      *                                                              *  00120030
      *      EPCC112   CONTAINS TOMORROW'S DATE, BASED ON THE JOB    *  00130030
      *     (EPWS112)  SCHEDULED DATE.                               *  00140030
      *                                                              *  00150030
      *      EPRD075   FILE OF SKUS THAT HAVE BEEN REACTIVATED AND   *  00160030
      *     (EPRD075)  MUST BE TREATED LIKE ADDED SKUS. FILE COMES   *  00170030
      *                FROM EPKUP102.                                *  00180030
      *                                                              *  00190030
      * OUTPUTS:                                                     *  00200030
      *      EPRD122   FILE OF ADDED OR REACTIVATED SKUS WHERE       *  00210030
      *     (EPRD122)  RCP IS IN EFFECT, SO STORE SPECIFIC DATA      *  00220030
      *                MUST BE EXTRACTED. USED BY PROGRAM EPKUT108.  *  00230030
      * W35484                                                       *  00240030
      *      EPRD219   SKU CHANGE GLOBAL - SKU DATA OF CHANGED       *  00250030
      *     (EPRD219)  OR ADDED SKUS SINCE LAST RUN.                 *  00260030
      *                                                              *  00270030
      *      EPRD220   SKU PRICING CHANGE GLOBAL - PRICING DATA      *  00280030
      *     (EPRD220)  OF CHANGED OR ADDED SKUS SINCE LAST RUN.      *  00290030
      *                                                              *  00300030
      *      EPRD220   SKU PRICING CHANGE AD VERSION -               *  00310030
      *     (EPRD220)  SAME FORMAT AS SKU PRICING CHANGE GLOBAL      *  00320030
      *                FOR SKUS ADDED OR REACTIVATED SINCE THE LAST  *  00330030
      *                RUN, THESE RECORDS PROVIDE RETURN PRICING     *  00340030
      *                LOWEST 13-WEEK PRICING) FOR EACH AD VERSION.  *  00350040
      *                                                              *  00360030
      * DESCRIPTION:                                                 *  00370030
      *                                                              *  00380030
      *      PROGRAM EXTRACTS CHANGES FROM THE SKU, SKU ATTRIBUTE,   *  00390030
      *  AND VENDOR STYLE TABLES SINCE THE LAST RUN OF THE PROGRAM.  *  00400030
      *  IF A SKU IS ADDED OR CHANGED, A RECORD SPECIFIC TO THAT     *  00410030
      *  SKU IS CREATED.  IF A VENDOR STYLE CHANGES, ALL SKUS WITH   *  00420030
      *  THAT VENDOR STYLE MUST HAVE RECORDS CREATED.                *  00430030
      *      IF A SKU IS ADDED (CREATE DATE > CONTROL DATE), AN      *  00440030
      *  PLU ADD RECORD IS PUT OUT FOR THE SKU AND A PLU AD VERSION  *  00450030
      *  RECORD MAY ALSO BE PUT OUT FOR THE RETURN PRICE.            *  00460030
      *  ONE ADD RECORD FOR EACH OF THE SKU GLOBAL AND SKU PRICING   *  00470030
      *  GLOBAL CHANGE FILES WILL BE PRODUCED FOR EACH SUCH SKU,     *  00480030
      *  AND ONE OR MORE SKU PRICING AD VERSION RECORDS MAY ALSO     *  00490030
      *  BE PRODUCED FOR THE RETURN PRICE.                           *  00500030
      *      IF THE SKU, SKU ATTR, OR VENDOR STYLE HAS BEEN UPDATED  *  00510030
      *  (LAST UPDATE TIMESTAMP > CONTROL DATE), AN UPDATE RECORD    *  00520030
      *  WITH ALL APPROPRIATE DATA WILL BE CREATED ALONG WITH 1 OR   *  00530030
      *  2 FLAGWORD RECORDS.                                         *  00540030
      *  FOR THE NEW SQL SERVER TABLE FILES (SKU AND SKU PRICING):   *  00550030
      *      IF THE SKU HAS BEEN UPDATED, AN UPDATE RECORD WITH ALL  *  00560030
      *  APPROPRIATE DATA WILL BE CREATED FOR THE SKU GLOBAL FILE.   *  00570030
      *  IF THE SKU ATTRIBUTE HAS BEEN UPDATED, AN UPDATE RECORD FOR *  00580030
      *  THE SKU PRICING GLOBAL FILE WILL BE CREATED, WITH THE SKU,  *  00590030
      *  EFFECTIVE DATE, AND THE LAST NON-CLEARANCE RETAIL AMOUNT.   *  00600030
      *  IF THE VENDOR STYLE HAS BEEN UPDATED, NO RECORD IS OUTPUT   *  00610030
      *  BY THIS PROGRAM FOR THE SQL SERVER TABLES.  THE MERCHANDISE *  00620030
      *  HIERARCHY UPDATE PROCESS WILL CAPTURE THESE CHANGES.        *  00630030
      *      FINALLY THERE IS A PROCESS TO READ A FILE OF            *  00640030
      *  REACTIVATED SKUS THAT JUST HAD THEIR PLU DOWNLOAD INDICATOR *  00650030
      *  SET OFF. INPUT FILE IS CREATED BY EPKUP102. ALL OF THESE    *  00660030
      *  SKUS WILL BE TREATED AS THEY WERE JUST ADDED BECAUSE THEY   *  00670030
      *  MAY NOT BE ON THE STORE FILE ANY LONGER.                    *  00680030
      *  ONE ADD RECORD FOR EACH OF THE SKU GLOBAL AND SKU PRICING   *  00690030
      *  GLOBAL CHANGE FILES WILL BE PRODUCED FOR EACH SUCH SKU.     *  00700030
      *                                                              *  00710030
      *--------------------------------------------------------------*  00720030
      *--------------------------------------------------------------*  00730030
      * HISTORY LOG:                                                    00740030
10APR *--------------------------------------------------------------*  00750032
10APR * DATE:  APRIL 2010                                               00760032
10APR * WR/IR#: WR38172                                                 00770032
10APR * PROGRAMMER: DAVE WELLER                                         00780032
10APR * DESCRIPTION: - E_BUS_ITM_IND SENT TO STORES SET TO              00790032
10APR *                TWEBITM COLUMN WEB_EXCLV_IND                     00800032
      *--------------------------------------------------------------*  00810030
      * DATE:   18 MARCH 2009                                           00820030
      * WR/IR#: WR#35484                                                00830030
      * PROGRAMMER: CHUCK HERO                                          00840030
      * DESCRIPTION: ADD OUTPUT FILES FOR SKU AND SKU PRICING DATA      00850030
      *              FOR SQL SERVER STORE DATABASES                     00860030
      *              POS 2009 FALL - PRICING INFRASTRUCTURE PROJECT     00870030
      *                                                                 00880030
      *--------------------------------------------------------------*  00890030
PK8048* DATE:   07 JUNE 2011                                            00900037
PK8048* WR/IR#: PKE#8048                                                00910036
PK8048* PROGRAMMER: COGNIZANT                                           00920035
PK8048* DESCRIPTION: CHANGED THE CURSORS (WHICH IDENTIFIES THE CHANGES) 00930035
PK8048*              TO ALSO CHECK THE LAST UPDATED TIMESTAMP WITH      00940035
PK8048*              CURRENT EXTRACT RUN TIMESTAMP.                     00950035
      *                                                                 00960034
LRP111*-----------------------------------------------------------      00970044
LRP111* DATE:        12/05/11                                           00980044
LRP111* WR/IR#:                                                         00990044
LRP111* PROGRAMMER:  ROB SWAGER                                         01000044
LRP111* DESCRIPTION: EXTEND LOWEST 6 WEEK RETURN PRICE PROCESSING       01010044
LRP111*              TO 13 WEEKS AND SELECT LOWEST RETAIL PRICE         01020044
LRP111*              FOR EACH UNIQUE SKU. SEE LRP111                    01030044
      *--------------------------------------------------------------*  01040034
       ENVIRONMENT DIVISION.                                            01050030
      *--------------------------------------------------------------*  01060030
       CONFIGURATION SECTION.                                           01070030
       SOURCE-COMPUTER.        IBM-3090.                                01080030
       OBJECT-COMPUTER.        IBM-3090.                                01090030
                                                                        01100030
       INPUT-OUTPUT SECTION.                                            01110030
                                                                        01120030
       FILE-CONTROL.                                                    01130030
                                                                        01140030
           SELECT CONTROL-CARD-TIMESTAMP                                01150030
                  ASSIGN TO INP01.                                      01160030
                                                                        01170030
           SELECT CONTROL-CARD-TOMORROW                                 01180030
                  ASSIGN TO INP02.                                      01190030
                                                                        01200030
           SELECT CONTROL-CARD-DAYS                                     01210030
                  ASSIGN TO INP03.                                      01220030
                                                                        01230030
           SELECT CONTROL-CARD-TODAY                                    01240030
                  ASSIGN TO INP04.                                      01250030
                                                                        01260030
           SELECT REACTIVATED-SKUS                                      01270030
                  ASSIGN TO INP05.                                      01280030
                                                                        01290030
           SELECT RCP-OVERRIDE-DRIVER                                   01300030
                  ASSIGN TO OUT01.                                      01310052
                                                                        01320030
           SELECT SKU-GLOBAL-CHG-FILE                                   01330030
                  ASSIGN TO OUT02.                                      01340052
                                                                        01350030
           SELECT SKU-PRICING-GLOBAL-CHG-FILE                           01360030
                  ASSIGN TO OUT03.                                      01370052
                                                                        01380030
           SELECT SKU-PRICING-AD-VERSION-FILE                           01390030
                  ASSIGN TO OUT04.                                      01400052
                                                                        01410030
       DATA DIVISION.                                                   01420030
       FILE SECTION.                                                    01430030
                                                                        01440030
       FD  CONTROL-CARD-TOMORROW                                        01450030
           RECORDING MODE F                                             01460030
           BLOCK CONTAINS 0 RECORDS                                     01470030
           LABEL RECORDS ARE OMITTED                                    01480030
           DATA RECORD IS CONTROL-TOMORROW-RECORD.                      01490030
       01  CONTROL-TOMORROW-RECORD      PIC  X(080).                    01500030
                                                                        01510030
       FD  CONTROL-CARD-TIMESTAMP                                       01520030
           RECORDING MODE F                                             01530030
           BLOCK CONTAINS 0 RECORDS                                     01540030
           LABEL RECORDS ARE OMITTED                                    01550030
           DATA RECORD IS CONTROL-TIMESTAMP-RECORD.                     01560030
       01  CONTROL-TIMESTAMP-RECORD     PIC  X(080).                    01570030
                                                                        01580030
       FD  CONTROL-CARD-DAYS                                            01590030
           RECORDING MODE F                                             01600030
           BLOCK CONTAINS 0 RECORDS                                     01610030
           LABEL RECORDS ARE OMITTED                                    01620030
           DATA RECORD IS CONTROL-DAYS-RECORD.                          01630030
       01  CONTROL-DAYS-RECORD          PIC  X(080).                    01640030
                                                                        01650030
       FD  CONTROL-CARD-TODAY                                           01660030
           RECORDING MODE F                                             01670030
           BLOCK CONTAINS 0 RECORDS                                     01680030
           LABEL RECORDS ARE OMITTED                                    01690030
           DATA RECORD IS CONTROL-TODAY-RECORD.                         01700030
       01  CONTROL-TODAY-RECORD         PIC  X(080).                    01710030
                                                                        01720030
       FD  REACTIVATED-SKUS                                             01730030
           RECORDING MODE F                                             01740030
           BLOCK CONTAINS 0 RECORDS                                     01750030
           LABEL RECORDS ARE OMITTED                                    01760030
           DATA RECORD IS REACTIVATED-SKU-RECORD.                       01770030
       01  REACTIVATED-SKU-RECORD       PIC  X(050).                    01780030
                                                                        01790030
       FD  RCP-OVERRIDE-DRIVER                                          01800030
           RECORDING MODE F                                             01810030
           BLOCK CONTAINS 0 RECORDS                                     01820030
           LABEL RECORDS ARE OMITTED                                    01830030
           DATA RECORD IS RCP-OVERRIDE-RECORD.                          01840030
       01  RCP-OVERRIDE-RECORD          PIC  X(050).                    01850030
                                                                        01860030
       FD  SKU-GLOBAL-CHG-FILE                                          01870030
           RECORDING MODE F                                             01880030
           BLOCK CONTAINS 0 RECORDS                                     01890030
           LABEL RECORDS ARE OMITTED                                    01900030
           DATA RECORD IS SKU-GLOBAL-CHG-RECORD.                        01910030
       01  SKU-GLOBAL-CHG-RECORD           PIC X(170).                  01920030
                                                                        01930030
       FD  SKU-PRICING-GLOBAL-CHG-FILE                                  01940030
           RECORDING MODE F                                             01950030
           BLOCK CONTAINS 0 RECORDS                                     01960030
           LABEL RECORDS ARE OMITTED                                    01970030
           DATA RECORD IS SKU-PRICING-GLOBAL-CHG-RECORD.                01980030
       01  SKU-PRICING-GLOBAL-CHG-RECORD   PIC X(260).                  01990030
                                                                        02000030
       FD  SKU-PRICING-AD-VERSION-FILE                                  02010030
           RECORDING MODE F                                             02020030
           BLOCK CONTAINS 0 RECORDS                                     02030030
           LABEL RECORDS ARE OMITTED                                    02040030
           DATA RECORD IS SKU-PRICING-AD-VERSION-RECORD.                02050030
       01  SKU-PRICING-AD-VERSION-RECORD   PIC X(260).                  02060030
                                                                        02070030
       WORKING-STORAGE SECTION.                                         02080030
      *--------------------------------------------------------------*  02090030
      * PS - PROGRAM SWITCHES                                           02100030
      *--------------------------------------------------------------*  02110030
       01  PS-PROGRAM-SWITCHES.                                         02120030
           05  PS-END-OF-CNTL-CRD-SW        PIC  X(001).                02130030
               88  PS-END-OF-CNTL-CRD-FILE              VALUE 'Y'.      02140030
               88  PS-NOT-END-OF-CNTL-CRD-FILE          VALUE 'N'.      02150030
           05  PS-END-OF-REACTIVATED-SKU-SW PIC  X(001).                02160030
               88  PS-END-OF-REACTIVATED-SKUS           VALUE 'Y'.      02170030
               88  PS-NOT-END-OF-REACTIVATED-SKUS       VALUE 'N'.      02180030
                                                                        02190030
10APR      05  PS-TWEBITM-FOUND-SW            PIC  X(001).              02200030
10APR          88  PS-TWEBITM-NOT-FOUND                   VALUE 'N'.    02210030
10APR          88  PS-TWEBITM-FOUND                       VALUE 'Y'.    02220030
                                                                        02230030
           05  PS-END-OF-STYLE-SKU-CHGS-SW  PIC  X(001).                02240030
               88  PS-END-OF-STYLE-SKU-CHGS             VALUE 'Y'.      02250030
               88  PS-NOT-END-OF-STYLE-SKU-CHGS         VALUE 'N'.      02260030
                                                                        02270030
           05  PS-MIN-UNIT-RETAIL-SW          PIC  X(001).              02280030
               88  PS-MIN-UNIT-RETAIL-FOUND               VALUE 'Y'.    02290030
               88  PS-MIN-UNIT-RETAIL-NOT-FOUND           VALUE 'N'.    02300030
           05  PS-LOWEST-PRICE-SW             PIC  X(001).              02310030
               88  PS-LOWEST-PRICE-FOUND                  VALUE 'Y'.    02320030
               88  PS-LOWEST-PRICE-NOT-FOUND              VALUE 'N'.    02330030
           05  PS-RECORD-TYPE-SW              PIC  X(001).              02340030
               88  PS-ADD-RECORD                          VALUE 'A'.    02350030
               88  PS-SKU-UPDATE                          VALUE 'S'.    02360030
               88  PS-SKU-ATTR-UPDATE                     VALUE 'U'.    02370030
                                                                        02380030
                                                                        02390030
      *--------------------------------------------------------------*  02400030
      * PROGRAM CONSTANTS                                               02410030
      *--------------------------------------------------------------*  02420030
       01  PC-PROGRAM-CONSTANTS.                                        02430030
           05  PC-PROGRAM-NAME          PIC X(08) VALUE 'EPKUT106'.     02440030
           05  PC-MAX-RETRIES           PIC 9(9) VALUE 5.               02450030
           05  PC-FIVE-BLANKS           PIC X(05) VALUE SPACES.         02460030
           05  PC-ASTERISK-LINE         PIC X(80) VALUE ALL '*'.        02470030
           05  PC-ACTIVE-STATUS         PIC X(02) VALUE '20'.           02480030
           05  PC-MIXED-STATUS          PIC X(02) VALUE '25'.           02490030
           05  PC-CLEARANCE-STATUS      PIC X(02) VALUE '30'.           02500030
                                                                        02510030
           05  PC-STR-GRP-TYP-CDE-CORP  PIC 9(05) VALUE 1000.           02520030
           05  PC-STR-GRP-ID-CORP       PIC 9(10) VALUE 0000000001.     02530030
           05  PC-PRIC-EFF-TIME-STD     PIC X(08) VALUE '03:00:00'.     02540030
           05  PC-SQLS-START-TIME       PIC X(08) VALUE '03:00:00'.     02550030
           05  PC-MDSE-HIER-SKU         PIC X(03) VALUE 'SKU'.          02560030
           05  PC-NULL-CHAR             PIC X(01) VALUE '~'.            02570030
                                                                        02580030
      *--------------------------------------------------------------*  02590030
      * PV- PROGRAM VARIABLES                                           02600030
      *--------------------------------------------------------------*  02610030
       01  PV-PROGRAM-VARIABLES.                                        02620030
           05  PV-PARAGRAPH-NAME        PIC X(40)   VALUE SPACES.       02630030
           05  PD-DB2-OPERATION         PIC X(15)   VALUE SPACES.       02640030
           05  PV-SQL-SUB               PIC S9(04)  VALUE 0  COMP.      02650030
10APR      05  PV-RETRY-COUNT           PIC S9(04)  VALUE ZERO          02660030
10APR                                               COMP SYNC.          02670030
10APR      05  PV-DISPLAY-INTERNAL      PIC  9(10) VALUE ZERO.          02680030
                                                                        02690030
           05  PV-GP-PRIC-ID-IND        PIC S9(4) VALUE 0  COMP.        02700030
               88  PV-GP-PRIC-ID-NULL             VALUE -1.             02710030
           05  PV-GP-RTL-QTY-IND        PIC S9(4) VALUE 0  COMP.        02720030
               88  PV-GP-RTL-QTY-NULL             VALUE -1.             02730030
           05  PV-GP-RTL-AMT-IND        PIC S9(4) VALUE 0  COMP.        02740030
               88  PV-GP-RTL-AMT-NULL             VALUE -1.             02750030
           05  PV-LAST-NCLR-RTL-AMT-IND PIC S9(4) VALUE 0  COMP.        02760030
               88  PV-LAST-NCLR-RTL-AMT-NULL      VALUE -1.             02770030
           05  PV-MKDN-CDE-IND          PIC S9(4) VALUE 0  COMP.        02780030
               88  PV-MKDN-CDE-NULL               VALUE -1.             02790030
           05  PV-ORIG-CLR-DTE-IND      PIC S9(4) VALUE 0  COMP.        02800030
               88  PV-ORIG-CLR-DTE-NULL           VALUE -1.             02810030
                                                                        02820030
           05  PV-MIN-UNT-RTL-AMT       PIC S9(7)V99 COMP-3 VALUE 0.    02830030
           05  PV-LOWEST-RETAIL-PRICE   PIC S9(7)V99 COMP-3 VALUE 0.    02840030
           05  PV-CORPORATE-RETURN-PRICE PIC S9(7)V99 COMP-3 VALUE 0.   02850030
           05  PV-INTR-UPC-ID-TMP        PIC S9(10)  COMP   VALUE 0.    02860030
           05  PV-DB2-INTR-UPC-ID        PIC S9(9)   COMP   VALUE 0.    02870030
           05  PV-INTR-UPC-ID-CONV       PIC S9(11)  COMP   VALUE 0.    02880030
                                                                        02890030
           05  PV-PRIC-EFF-TMST.                                        02900030
               10  PV-PRIC-EFF-DTE      PIC X(10).                      02910030
               10  FILLER               PIC X(01) VALUE SPACE.          02920030
               10  PV-PRIC-EFF-TIME     PIC X(08).                      02930030
                                                                        02940030
           05  PV-LAST-PRCHG-TMST.                                      02950030
               10  PV-LAST-PRCHG-DTE    PIC X(10).                      02960030
               10  FILLER               PIC X(01) VALUE SPACE.          02970030
               10  PV-LAST-PRCHG-TIME   PIC X(08).                      02980030
                                                                        02990030
      *--------------------------------------------------------------*  03000030
      * EPWS075 CONTROL CARD LAYOUT - REACTIVATED SKUS                  03010030
      *--------------------------------------------------------------*  03020030
           COPY EPRD075.                                                03030030
                                                                        03040030
      *--------------------------------------------------------------*  03050030
      * EPWS105 CONTROL CARD LAYOUT - TIMESTAMP CONTROL CARD            03060030
      *--------------------------------------------------------------*  03070030
           COPY EPWS105.                                                03080030
                                                                        03090030
      *--------------------------------------------------------------*  03100030
      * EPWS112 CONTROL CARD LAYOUT - TOMORROW BASED ON RUN DATE        03110030
      *--------------------------------------------------------------*  03120030
           COPY EPWS112.                                                03130030
                                                                        03140030
      *--------------------------------------------------------------*  03150030
      * EPRD045 CONTROL CARD LAYOUT - DAYS BEFORE OPEN TO INCLUDE STORE 03160030
      *--------------------------------------------------------------*  03170030
           COPY EPRD045.                                                03180030
                                                                        03190030
      *--------------------------------------------------------------*  03200030
      * EPWS140 CONTROL CARD LAYOUT - TODAY BASED ON RUN DATE           03210030
      *--------------------------------------------------------------*  03220030
           COPY EPWS140.                                                03230030
                                                                        03240030
      *--------------------------------------------------------------*  03250030
      * EPRD122 RCP OVERRIDE DRIVER                                     03260030
      *--------------------------------------------------------------*  03270030
           COPY EPRD122.                                                03280030
                                                                        03290030
      *--------------------------------------------------------------*  03300030
      * EPRD219 SKU DATA RECORD LAYOUT                                  03310030
      *--------------------------------------------------------------*  03320030
           COPY EPRD219.                                                03330030
                                                                        03340030
      *--------------------------------------------------------------*  03350030
      * EPRD220 SKU PRICING DATA RECORD LAYOUT                          03360030
      *--------------------------------------------------------------*  03370030
           COPY EPRD220.                                                03380030
                                                                        03390030
      *--------------------------------------------------------------*  03400030
      * DATE ROUTINE COPY MEMBERS                                       03410030
      *--------------------------------------------------------------*  03420030
           COPY DPWS500.                                                03430030
                                                                        03440030
      *--------------------------------------------------------------*  03450030
      * VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         03460030
      *--------------------------------------------------------------*  03470030
           COPY DPWS004.                                                03480030
                                                                        03490030
      *--------------------------------------------------------------*  03500030
      * DB2 ABEND COPYBOOK                                              03510030
      *--------------------------------------------------------------*  03520030
           COPY DPWS900.                                                03530030
                                                                        03540030
      *--------------------------------------------------------------*  03550030
      * DB2 MESSAGE AREA                                                03560030
      *--------------------------------------------------------------*  03570030
           COPY SQLCA2.                                                 03580030
                                                                        03590030
      *--------------------------------------------------------------*  03600030
      * PROGRAM COUNTERS                                                03610030
      *--------------------------------------------------------------*  03620030
       01  PV-PROGRAM-COUNTERS         COMP-3.                          03630030
           05  PV-CNT-REACTIVE-RECS    PIC 9(9) VALUE 0.                03640030
                                                                        03650030
           05  PV-STYLE-SKU-CHGS-FETCHS PIC 9(9) VALUE 0.               03660030
           05  PV-SKU-ATTRB-SELECT      PIC 9(9) VALUE 0.               03670030
           05  PV-RETURN-PRICE-FOUND    PIC 9(9) VALUE 0.               03680030
           05  PV-RETURN-PRICE-NOT-FOUND PIC 9(9) VALUE 0.              03690030
           05  PV-LOWEST-RETAIL-FOUND   PIC 9(9) VALUE 0.               03700030
           05  PV-LOWEST-RETAIL-NOT-FOUND PIC 9(9) VALUE 0.             03710030
                                                                        03720030
           05  PV-CNT-SKU-DATA-UPD      PIC 9(9) VALUE 0.               03730030
           05  PV-CNT-SKU-ATTR-UPD      PIC 9(9) VALUE 0.               03740030
                                                                        03750030
           05  PV-CNT-OUTPUT-RECORDS    PIC 9(9) VALUE 0.               03760030
           05  PV-CNT-EP122-RECORDS     PIC 9(9) VALUE 0.               03770030
                                                                        03780030
           05  PV-CNT-SKU-GLOBAL        PIC 9(9) VALUE 0.               03790030
           05  PV-CNT-SKU-PRICG-GLOBAL  PIC 9(9) VALUE 0.               03800030
           05  PV-CNT-SKU-PRICG-AD-VS   PIC 9(9) VALUE 0.               03810030
           05  PV-CNT-SKU-GLBL-ADD      PIC 9(9) VALUE 0.               03820030
           05  PV-CNT-SKU-GLBL-UPDT     PIC 9(9) VALUE 0.               03830030
           05  PV-CNT-SKU-PRICG-GLBL-A  PIC 9(9) VALUE 0.               03840030
           05  PV-CNT-SKU-PRICG-GLBL-U  PIC 9(9) VALUE 0.               03850030
                                                                        03860030
      *--------------------------------------------------------------*  03870030
      * ERROR HANDLING                                                  03880030
      *--------------------------------------------------------------*  03890030
       01  PV-MISC-ABEND-FIELDS.                                        03900030
           05  PV-OPERATION-MSG-1      PIC X(40) VALUE SPACES.          03910030
           05  PV-OPERATION-MSG-2      PIC X(40) VALUE SPACES.          03920030
           05  PV-DB2-OPERATION        PIC X(30) VALUE SPACES.          03930030
                                                                        03940030
       01  ABEND-CODE                  PIC S9(4) VALUE 0  COMP SYNC.    03950030
           88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           03960030
           88  ABEND-4013-DB2-ERROR              VALUE +4013.           03970030
           88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           03980030
           88  ABEND-4020-MQ-ERROR               VALUE +4020.           03990030
           88  ABEND-4444-FORCED-ABEND           VALUE +4444.           04000030
           88  ABEND-4008                        VALUE +4008.           04010030
           88  ABEND-4005                        VALUE +4005.           04020030
                                                                        04030030
      *--------------------------------------------------------------*  04040030
      * DB2 COMMUNICATIONS AREA                                         04050030
      *--------------------------------------------------------------*  04060030
           EXEC SQL                                                     04070030
             INCLUDE SQLCA                                              04080030
           END-EXEC.                                                    04090030
                                                                        04100030
      *--------------------------------------------------------------*  04110030
      * DB2 TABLE EPT00011 (EPT_LO_RTL) - LOWEST RETAIL                 04120030
      *--------------------------------------------------------------*  04130030
           EXEC SQL                                                     04140030
             INCLUDE EPT00011                                           04150030
           END-EXEC.                                                    04160030
                                                                        04170030
      *--------------------------------------------------------------*  04180030
      * DB2 TABLE XST00008 (XST_SKU_LOC) - SKU LOCATION TABLE           04190030
      *--------------------------------------------------------------*  04200030
           EXEC SQL                                                     04210030
             INCLUDE XST00008                                           04220030
           END-EXEC.                                                    04230030
                                                                        04240030
      *--------------------------------------------------------------*  04250030
      * DB2 TABLE XST00010 (XST_SKU) - SKU TABLE                        04260030
      *--------------------------------------------------------------*  04270030
           EXEC SQL                                                     04280030
             INCLUDE XST00010                                           04290030
           END-EXEC.                                                    04300030
                                                                        04310030
10APR *--------------------------------------------------               04320030
10APR *  WEB ITEM ATTRIBUTES TABLE                                      04330030
10APR *--------------------------------------------------               04340030
10APR      EXEC SQL                                                     04350030
10APR          INCLUDE TWEBITM                                          04360030
10APR      END-EXEC.                                                    04370030
                                                                        04380030
      *--------------------------------------------------------------*  04390030
      * DB2 TABLE XST00011 (XST_SKU_ATTR) - SKU ATTRIBUTE TABLE         04400030
      *--------------------------------------------------------------*  04410030
           EXEC SQL                                                     04420030
             INCLUDE XST00011                                           04430030
           END-EXEC.                                                    04440030
                                                                        04450030
      *--------------------------------------------------------------*  04460030
      * DB2 TABLE XST00041 (XST_SKU_LOC_ATTR) - SKU LOCATION ATTRIBUTES 04470030
      *--------------------------------------------------------------*  04480030
           EXEC SQL                                                     04490030
             INCLUDE XST00041                                           04500030
           END-EXEC.                                                    04510030
                                                                        04520030
      *--------------------------------------------------------------*  04530030
      *    STYLE SKU CHANGES CURSOR                                  *  04540030
      *--------------------------------------------------------------*  04550030
           EXEC SQL                                                     04560030
             DECLARE STYLE-SKU-CHGS-CSR CURSOR FOR                      04570030
                                                                        04580030
                 SELECT  SKU.INTR_UPC_ID                                04590030
                        ,SKU.STYL_ID                                    04600030
                        ,SKU.SKU_NBR                                    04610030
                        ,SKU.SKU_DESC                                   04620030
                        ,SKU.SIZE_DESC                                  04630030
                        ,SKU.REGN_PRIC_IND                              04640030
                        ,SKU.TX_PRD_CDE_DESC                            04650030
                        ,SKU.E_BUS_PRD_GP_NBR                           04660030
                        ,SKU.NRF_CLOR_DESC                              04670030
                        ,SKU.CRE_TMST                                   04680030
                        ,SKU.LAST_UPD_TMST                              04690030
                        ,SKUATTR.PLU_DWNLD_EXCL_IND                     04700030
                        ,SKUATTR.LAST_NCLR_RTL_AMT                      04710030
                        ,SKUATTR.LAST_UPD_TMST                          04720030
                 FROM  XST_SKU       SKU                                04730030
                      ,XST_SKU_ATTR  SKUATTR                            04740030
                 WHERE SKUATTR.LAST_UPD_TMST >                          04750030
                       :CC-EPCC105-PREV-TIMESTAMP                       04760030
PK8048             AND SKUATTR.LAST_UPD_TMST <=                         04770035
PK8048                 :CC-EPCC105-CRNT-TIMESTAMP                       04780035
                   AND SKU.INTR_UPC_ID    = SKUATTR.INTR_UPC_ID         04790030
                                                                        04800030
               UNION                                                    04810030
                 SELECT  SKU.INTR_UPC_ID                                04820030
                        ,SKU.STYL_ID                                    04830030
                        ,SKU.SKU_NBR                                    04840030
                        ,SKU.SKU_DESC                                   04850030
                        ,SKU.SIZE_DESC                                  04860030
                        ,SKU.REGN_PRIC_IND                              04870030
                        ,SKU.TX_PRD_CDE_DESC                            04880030
                        ,SKU.E_BUS_PRD_GP_NBR                           04890030
                        ,SKU.NRF_CLOR_DESC                              04900030
                        ,SKU.CRE_TMST                                   04910030
                        ,SKU.LAST_UPD_TMST                              04920030
                        ,SKUATTR.PLU_DWNLD_EXCL_IND                     04930030
                        ,SKUATTR.LAST_NCLR_RTL_AMT                      04940030
                        ,SKUATTR.LAST_UPD_TMST                          04950030
                 FROM  XST_SKU       SKU                                04960030
                      ,XST_SKU_ATTR  SKUATTR                            04970030
                 WHERE SKU.LAST_UPD_TMST > :CC-EPCC105-PREV-TIMESTAMP   04980030
PK8048             AND SKU.LAST_UPD_TMST <= :CC-EPCC105-CRNT-TIMESTAMP  04990035
                   AND SKU.INTR_UPC_ID    = SKUATTR.INTR_UPC_ID         05000030
               WITH UR                                                  05010030
                                                                        05020030
           END-EXEC.                                                    05030030
                                                                        05040030
                                                                        05050030
       LINKAGE SECTION.                                                 05060030
                                                                        05070030
      *--------------------------------------------------------------*  05080030
       PROCEDURE DIVISION.                                              05090030
      *--------------------------------------------------------------*  05100030
       0000-MAINLINE.                                                   05110030
                                                                        05120030
           PERFORM 1000-INITIALIZATION.                                 05130030
                                                                        05140030
           PERFORM 2000-EXTRACT-SKU-STYLE-CHANGES.                      05150030
                                                                        05160030
           PERFORM 2400-EXTRACT-REACTIVATED-SKUS.                       05170030
                                                                        05180030
           PERFORM 9999-WRAPUP.                                         05190030
                                                                        05200030
           GOBACK.                                                      05210030
                                                                        05220030
      *0000-EXIT.                                                       05230030
                                                                        05240030
                                                                        05250030
      *--------------------------------------------------------------*  05260030
      * 1000-INITIALIZATION.                                            05270030
      *     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      05280030
      *     FILES, READS CONTROL CARD FILES AND CALCULATES A FUTURE     05290030
      *     DATE BASED ON CONTROL CARD VALUES.                          05300030
      *--------------------------------------------------------------*  05310030
       1000-INITIALIZATION.                                             05320030
                                                                        05330030
           OPEN INPUT  CONTROL-CARD-TOMORROW                            05340030
                       CONTROL-CARD-TIMESTAMP                           05350030
                       CONTROL-CARD-DAYS                                05360030
                       CONTROL-CARD-TODAY                               05370030
                       REACTIVATED-SKUS.                                05380030
           OPEN OUTPUT RCP-OVERRIDE-DRIVER                              05390052
                       SKU-GLOBAL-CHG-FILE                              05400052
                       SKU-PRICING-GLOBAL-CHG-FILE                      05410052
                       SKU-PRICING-AD-VERSION-FILE.                     05420052
           DISPLAY ' '.                                                 05430030
           DISPLAY '*********************************************'.     05440030
           DISPLAY '       PROGRAM NAME: ' PC-PROGRAM-NAME.             05450030
           DISPLAY '*********************************************'.     05460030
           DISPLAY ' '.                                                 05470030
                                                                        05480030
           PERFORM 1030-READ-TOMORROW-RECORD.                           05490030
           PERFORM 1040-READ-TIMESTAMP-RECORD.                          05500030
           PERFORM 1050-READ-DAYS-RECORD.                               05510030
           PERFORM 1060-READ-TODAY-RECORD.                              05520030
                                                                        05530030
           PERFORM 1070-CALC-DAYS-DATE.                                 05540030
                                                                        05550030
           MOVE CC-EPCC112-TOMORROW-DATE  TO PV-PRIC-EFF-DTE.           05560030
           MOVE PC-PRIC-EFF-TIME-STD      TO PV-PRIC-EFF-TIME.          05570030
           DISPLAY 'PRIC EFF TMST TO SQLS: ' PV-PRIC-EFF-TMST.          05580030
                                                                        05590030
           CLOSE CONTROL-CARD-TOMORROW                                  05600030
                 CONTROL-CARD-TIMESTAMP                                 05610030
                 CONTROL-CARD-DAYS                                      05620030
                 CONTROL-CARD-TODAY.                                    05630030
                                                                        05640030
      *1000-EXIT.                                                       05650030
                                                                        05660030
      *--------------------------------------------------------------*  05670030
      * 1030-READ-TOMORROW-RECORD.                                      05680030
      *     READ CONTROL CARD EPCC112. THIS CONTROL CARD CONTAINS       05690030
      *     TOMORROW'S DATE BASED ON THE JOB RUN DATE.                  05700030
      *--------------------------------------------------------------*  05710030
       1030-READ-TOMORROW-RECORD.                                       05720030
                                                                        05730030
           READ CONTROL-CARD-TOMORROW                                   05740030
                                     INTO CC-EPCC112-CONTROL-CARD       05750030
             AT END                                                     05760030
                SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    05770030
                                                                        05780030
           IF PS-END-OF-CNTL-CRD-FILE                                   05790030
             MOVE '1030-READ-TOMORROW-RECORD' TO PV-PARAGRAPH-NAME      05800030
             MOVE '** CONTROL FILE IS EMPTY'  TO PV-OPERATION-MSG-1     05810030
             MOVE +4002                       TO ABEND-CODE             05820030
             PERFORM 9800-ABEND                                         05830030
           ELSE                                                         05840030
             DISPLAY '** TOMORROW DATE CONTROL CARD    **'              05850030
             DISPLAY '** EPCC112       **  = ' CC-EPCC112-TOMORROW-DATE 05860030
           END-IF.                                                      05870030
                                                                        05880030
      *1030-EXIT.                                                       05890030
                                                                        05900030
      *--------------------------------------------------------------*  05910030
      * 1040-READ-TIMESTAMP-RECORD.                                     05920030
      *     READ CONTROL CARD EPCC105. THIS CONTROL CARD CONTAINS       05930030
      *     THE PREVIOUS RUNS TIMESTAMP                                 05940030
      *--------------------------------------------------------------*  05950030
       1040-READ-TIMESTAMP-RECORD.                                      05960030
                                                                        05970030
           READ CONTROL-CARD-TIMESTAMP                                  05980030
                                     INTO CC-EPCC105-CONTROL-CARD       05990030
             AT END                                                     06000030
                SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    06010030
                                                                        06020030
           IF PS-END-OF-CNTL-CRD-FILE                                   06030030
             MOVE '1040-READ-TIMESTAMP-RECORD' TO PV-PARAGRAPH-NAME     06040030
             MOVE '** CONTROL FILE IS EMPTY  ' TO PV-OPERATION-MSG-1    06050030
             MOVE +4002                        TO ABEND-CODE            06060030
             PERFORM 9800-ABEND                                         06070030
           ELSE                                                         06080030
             DISPLAY '** TIMESTAMP CONTROL CARD               **'       06090030
             DISPLAY '** EPCC105       **  = '                          06100030
                      CC-EPCC105-PREV-TIMESTAMP                         06110030
                     ' - '                                              06120030
                      CC-EPCC105-CRNT-TIMESTAMP                         06130030
             DISPLAY ' '                                                06140030
           END-IF.                                                      06150030
                                                                        06160030
      *1040-EXIT.                                                       06170030
                                                                        06180030
      *--------------------------------------------------------------*  06190030
      * 1050-READ-DAYS-RECORD.                                          06200030
      *     READ CONTROL CARD EPCC045. THIS CONTROL CARD CONTAINS       06210030
      *     NUMBER OF DAYS BEFORE A STORE OPENS THAT IT SHOULD BE       06220030
      *     CONSIDERED VALID FOR PLU EXTRACT PROCESSING.                06230030
      *--------------------------------------------------------------*  06240030
       1050-READ-DAYS-RECORD.                                           06250030
                                                                        06260030
           READ CONTROL-CARD-DAYS INTO EP045-ADVDAYS-TO-SND-RECORD      06270030
             AT END                                                     06280030
                SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    06290030
                                                                        06300030
           IF PS-END-OF-CNTL-CRD-FILE                                   06310030
             MOVE '1050-READ-DAYS-RECORD'    TO PV-PARAGRAPH-NAME       06320030
             MOVE '** CONTROL FILE IS EMPTY' TO PV-OPERATION-MSG-1      06330030
             MOVE +4002                      TO ABEND-CODE              06340030
             PERFORM 9800-ABEND                                         06350030
           ELSE                                                         06360030
             DISPLAY '** DAYS IN ADVANCE OF OPEN TO INCLUDE STORE **'   06370030
             DISPLAY '** EPCC045       **  = '                          06380030
                     EP045-ADVDAYS-TO-SND-RECORD                        06390030
             DISPLAY ' '                                                06400030
           END-IF.                                                      06410030
                                                                        06420030
           IF EP045-DAYS-TILL-STORE-OPN NOT NUMERIC                     06430030
              DISPLAY 'INVALID CONTROL CARD 045 - DAYS'                 06440030
              DISPLAY '   DAYS UNTIL OPEN: ',                           06450030
                               EP045-DAYS-TILL-STORE-OPN                06460030
              MOVE '1050-READ-DAYS-RECORD'                              06470030
                                TO PV-PARAGRAPH-NAME                    06480030
              MOVE 'CONTROL CARD 3 IS INVALID' TO PV-OPERATION-MSG-1    06490030
              SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                    06500030
              PERFORM 9800-ABEND                                        06510030
           END-IF.                                                      06520030
                                                                        06530030
      *1050-EXIT.                                                       06540030
                                                                        06550030
      *--------------------------------------------------------------*  06560030
      * 1060-READ-TODAY-RECORD.                                         06570030
      *     READ CONTROL CARD EPCC140. THIS CONTROL CARD CONTAINS       06580030
      *     TODAY'S DATE BASED ON THE JOB RUN DATE.                     06590030
      *--------------------------------------------------------------*  06600030
       1060-READ-TODAY-RECORD.                                          06610030
                                                                        06620030
           READ CONTROL-CARD-TODAY   INTO CC-EPCC140-CONTROL-CARD       06630030
             AT END                                                     06640030
                SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    06650030
                                                                        06660030
           IF PS-END-OF-CNTL-CRD-FILE                                   06670030
             MOVE '1060-READ-TODAY-RECORD'   TO PV-PARAGRAPH-NAME       06680030
             MOVE '** CONTROL FILE IS EMPTY' TO PV-OPERATION-MSG-1      06690030
             MOVE +4002                      TO ABEND-CODE              06700030
             PERFORM 9800-ABEND                                         06710030
           ELSE                                                         06720030
             DISPLAY '** TODAY DATE CONTROL CARD    **'                 06730030
             DISPLAY '** EPCC140       **  = ' CC-EPCC140-TODAY-DATE    06740030
             DISPLAY ' '                                                06750030
           END-IF.                                                      06760030
                                                                        06770030
      *1060-EXIT.                                                       06780030
                                                                        06790030
      *--------------------------------------------------------------*  06800030
      * 1070-CALC-DAYS-DATE.                                            06810030
      *     CALCULATE THE DATE THAT TODAY PLUS THE NUMBER OF DAYS       06820030
      *     VALUE COME OUT TO, USING DATE ROUTINE.                      06830030
      *--------------------------------------------------------------*  06840030
       1070-CALC-DAYS-DATE.                                             06850030
                                                                        06860030
      *    * ADD "DAYS" (BEFORE OPENING TO SEND DATA)                   06870030
      *    * TO "TODAY" (RUN DATE)                                      06880030
      *    *  TO GET DATE FOR NEW STORES DATE CHECKING                  06890030
           INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         06900030
           SET  DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                     06910030
           SET  DPG52-LK-DTE-ISO-FMT       TO TRUE.                     06920030
           SET  DPG51-INCREMENT-DATE       TO TRUE.                     06930030
           MOVE CC-EPCC140-TODAY-DATE      TO DPG52-LK-DATE-INPUT.      06940030
           MOVE EP045-DAYS-TILL-STORE-OPN  TO DPG51-INCR-DECR-DAYS-9.   06950030
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    06960030
                                                   DPG54 DPG55 DPG56.   06970030
           EVALUATE TRUE                                                06980030
               WHEN DPG54-NO-ERROR                                      06990030
                   DISPLAY 'CALCULATED DATE FOR FUTURE STORES',         07000030
                           ' (USING DPKUT500):',                        07010030
                      DPG55-DB2-ISO-DATE-FMT                            07020030
                   DISPLAY '      TODAY + DAYS = FUTURE DATE'           07030030
               WHEN DPG54-SEVERE-ERROR                                  07040030
                   DISPLAY ' '                                          07050030
                   DISPLAY '** ABEND ** IN EPKUT106'                    07060030
                   DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    07070030
                   DISPLAY '** CALLED BY 1070-CALC-DAYS-DATE'           07080030
                   DISPLAY '** ERROR MESSAGE = '                        07090030
                                     DPG54-ERROR-MESSAGE                07100030
                   DISPLAY '** DPG51 = ' DPG51                          07110030
                   DISPLAY '** DPG52 = ' DPG52                          07120030
                   DISPLAY '** DPG53 = ' DPG53                          07130030
                   DISPLAY '** DPG54 = ' DPG54                          07140030
                   DISPLAY '** DPG55 = ' DPG55                          07150030
                   DISPLAY '** DPG56 = ' DPG56                          07160030
                   MOVE '1070-CALC-DAYS-DATE'                           07170030
                                        TO PV-PARAGRAPH-NAME            07180030
                   MOVE 'ERROR CALCULATING NEW STORE DATE'              07190030
                                        TO PV-OPERATION-MSG-1           07200030
                   MOVE DPG54-ERROR-MESSAGE  TO PV-OPERATION-MSG-2      07210030
                   SET ABEND-4019-CAL-SUB-ERROR TO TRUE                 07220030
                   PERFORM 9800-ABEND                                   07230030
           END-EVALUATE.                                                07240030
                                                                        07250030
      *1070-EXIT.                                                       07260030
                                                                        07270030
      *--------------------------------------------------------------*  07280030
      * 2000-EXTRACT-SKU-STYLE-CHANGES                               *  07290030
      *                                                              *  07300030
      *--------------------------------------------------------------*  07310030
       2000-EXTRACT-SKU-STYLE-CHANGES.                                  07320030
                                                                        07330030
           DISPLAY ' '.                                                 07340030
           DISPLAY PC-ASTERISK-LINE.                                    07350030
           DISPLAY '     START OF STYLE SKU CHANGES CURSOR'.            07360030
           DISPLAY PC-ASTERISK-LINE.                                    07370030
           DISPLAY ' '.                                                 07380030
                                                                        07390030
           PERFORM 6600-OPEN-STYLE-SKU-CHGS-CSR.                        07400030
                                                                        07410030
           SET PS-NOT-END-OF-STYLE-SKU-CHGS TO TRUE.                    07420030
                                                                        07430030
           PERFORM 2200-FETCH-STYLE-SKU-CHGS-CSR.                       07440030
                                                                        07450030
           PERFORM UNTIL PS-END-OF-STYLE-SKU-CHGS                       07460030
                                                                        07470030
             IF XST00011-PLU-DWNLD-EXCL-IND = 'Y'                       07480030
                CONTINUE                                                07490030
             ELSE                                                       07500030
               MOVE XST00010-INTR-UPC-ID TO PV-DB2-INTR-UPC-ID          07510030
                                            PV-INTR-UPC-ID-CONV         07520030
                                                                        07530030
               PERFORM 3000-PROCESS-SKU                                 07540030
             END-IF                                                     07550030
                                                                        07560030
             PERFORM 2200-FETCH-STYLE-SKU-CHGS-CSR                      07570030
                                                                        07580030
           END-PERFORM.                                                 07590030
                                                                        07600030
           PERFORM 6800-CLOSE-STYLE-SKU-CHGS-CSR.                       07610030
                                                                        07620030
      *2000-EXIT.                                                       07630030
                                                                        07640030
                                                                        07650030
      *--------------------------------------------------------------*  07660030
      * 2200-FETCH-STYLE-SKU-CHGS-CSR.                               *  07670030
      *    EXTRACT ALL SKUS WHO HAVE HAD CHANGES TO THE SKU ATTR,    *  07680030
      *    SKU, OR VENDOR STYLE SINCE THE LAST RUN TIMESTAMP.        *  07690030
      *    CURSOR ALSO EXTRACTS ALL RELATED DATA FROM THE DEPARTMENT,*  07700030
      *    SUB CLASS, VENDOR, AND VENDOR DEPARTMENT TABLES AT THE    *  07710030
      *    SAME TIME.                                                *  07720030
      *                                                              *  07730030
      *--------------------------------------------------------------*  07740030
       2200-FETCH-STYLE-SKU-CHGS-CSR.                                   07750030
                                                                        07760030
           MOVE '2200-FETCH-STYLE-SKU-CHGS-CSR' TO PV-PARAGRAPH-NAME.   07770030
                                                                        07780030
           EXEC SQL                                                     07790030
                FETCH  STYLE-SKU-CHGS-CSR                               07800030
                 INTO  :XST00010-INTR-UPC-ID                            07810030
                      ,:XST00010-STYL-ID                                07820030
                      ,:XST00010-SKU-NBR                                07830030
                      ,:XST00010-SKU-DESC                               07840030
                      ,:XST00010-SIZE-DESC                              07850030
                      ,:XST00010-REGN-PRIC-IND                          07860030
                      ,:XST00010-TX-PRD-CDE-DESC                        07870030
                      ,:XST00010-E-BUS-PRD-GP-NBR                       07880030
                      ,:XST00010-NRF-CLOR-DESC                          07890030
                      ,:XST00010-CRE-TMST                               07900030
                      ,:XST00010-LAST-UPD-TMST                          07910030
                      ,:XST00011-PLU-DWNLD-EXCL-IND                     07920030
                      ,:XST00011-LAST-NCLR-RTL-AMT                      07930030
                                       :PV-LAST-NCLR-RTL-AMT-IND        07940030
                      ,:XST00011-LAST-UPD-TMST                          07950030
                                                                        07960030
           END-EXEC.                                                    07970030
                                                                        07980030
           EVALUATE TRUE                                                07990030
             WHEN SQLCODE = 0                                           08000030
               ADD 1 TO PV-STYLE-SKU-CHGS-FETCHS                        08010030
                                                                        08020030
             WHEN SQLCODE = +100                                        08030030
               SET PS-END-OF-STYLE-SKU-CHGS TO TRUE                     08040030
                                                                        08050030
             WHEN OTHER                                                 08060030
               MOVE 'ERROR ON FETCH OF STYLE-SKU-CHGS-CSR CURSOR'       08070030
                                  TO PV-DB2-OPERATION                   08080030
               PERFORM 9900-SQL-ABEND-ROUTINE                           08090030
                                                                        08100030
           END-EVALUATE.                                                08110030
                                                                        08120030
      *2200-EXIT.                                                       08130030
                                                                        08140030
      *--------------------------------------------------------------*  08150030
      * 2400-EXTRACT-REACTIVATED-SKUS.                               *  08160030
      *    READ A FILE OF REACTIVATED SKUS THAT HAVE JUST HAD        *  08170030
      *    THEIR PLU DOWNLOAD INDICATOR SET OFF.  INPUT FILE IS      *  08180030
      *    CREATED BY EPKUP102.  ALL OF THESE WILL BE TREATED AS     *  08190030
      *    THEY WERE JUST ADDED BECAUSE THEY MAY NOT BE ON THE       *  08200030
      *    STORE FILE ANY LONGER.                                    *  08210030
      *                                                              *  08220030
      *--------------------------------------------------------------*  08230030
       2400-EXTRACT-REACTIVATED-SKUS.                                   08240030
                                                                        08250030
           MOVE '2400-EXTRACT-REACTIVATED-SKUS' TO PV-PARAGRAPH-NAME.   08260030
           DISPLAY 'START OF: ' PV-PARAGRAPH-NAME.                      08270030
           DISPLAY PC-ASTERISK-LINE.                                    08280030
           DISPLAY ' '.                                                 08290030
                                                                        08300030
           SET PS-NOT-END-OF-REACTIVATED-SKUS TO TRUE.                  08310030
                                                                        08320030
           PERFORM 2500-READ-REACTIVATED-SKUS.                          08330030
                                                                        08340030
           PERFORM UNTIL PS-END-OF-REACTIVATED-SKUS                     08350030
                                                                        08360030
             MOVE EP075-INTERNAL-UPC-ID TO PV-INTR-UPC-ID-CONV          08370030
                                           PV-INTR-UPC-ID-TMP           08380030
             MOVE PV-INTR-UPC-ID-TMP    TO PV-DB2-INTR-UPC-ID           08390030
                                                                        08400030
             PERFORM 2800-SELECT-STYLE-SKU-DATA                         08410030
                                                                        08420030
             IF XST00011-PLU-DWNLD-EXCL-IND = 'Y'                       08430030
                CONTINUE                                                08440030
             ELSE                                                       08450030
                                                                        08460030
               PERFORM 3400-CREATE-ADD-RECORD                           08470030
             END-IF                                                     08480030
                                                                        08490030
             PERFORM 2500-READ-REACTIVATED-SKUS                         08500030
                                                                        08510030
           END-PERFORM.                                                 08520030
                                                                        08530030
      *2400-EXIT.                                                       08540030
                                                                        08550030
      *--------------------------------------------------------------*  08560030
      * 2500-READ-REACTIVATED-SKUS.                                  *  08570030
      *--------------------------------------------------------------*  08580030
       2500-READ-REACTIVATED-SKUS.                                      08590030
                                                                        08600030
           MOVE '2500-READ-REACTIVATED-SKUS' TO PV-PARAGRAPH-NAME.      08610030
                                                                        08620030
           READ REACTIVATED-SKUS INTO EP075-XREF-SKU-CHG-REC            08630030
             AT END                                                     08640030
                SET PS-END-OF-REACTIVATED-SKUS TO TRUE.                 08650030
                                                                        08660030
           IF PS-END-OF-REACTIVATED-SKUS                                08670030
             CONTINUE                                                   08680030
           ELSE                                                         08690030
             ADD 1 TO PV-CNT-REACTIVE-RECS                              08700030
           END-IF.                                                      08710030
                                                                        08720030
      *2500-EXIT.                                                       08730030
                                                                        08740030
      *--------------------------------------------------------------*  08750030
      * 2800-SELECT-STYLE-SKU-DATA.                                  *  08760030
      *    EXTRACT ALL OF THE DATA FOR REACTIVATED SKUS. THIS        *  08770030
      *    SELECT IS JUST LIKE THE STYL-SKU-CHGS-CSR EXCEPT THAT     *  08780030
      *    THIS CURSOR USES THE INTERNAL UPC ID TO FIND WHAT IT      *  08790030
      *    NEEDS.                                                    *  08800030
      *                                                              *  08810030
      *--------------------------------------------------------------*  08820030
       2800-SELECT-STYLE-SKU-DATA.                                      08830030
                                                                        08840030
           MOVE '2800-SELECT-STYLE-SKU-DATA    ' TO PV-PARAGRAPH-NAME.  08850030
                                                                        08860030
           EXEC SQL                                                     08870030
               SELECT  SKU.INTR_UPC_ID                                  08880030
                      ,SKU.STYL_ID                                      08890030
                      ,SKU.SKU_NBR                                      08900030
                      ,SKU.SKU_DESC                                     08910030
                      ,SKU.SIZE_DESC                                    08920030
                      ,SKU.REGN_PRIC_IND                                08930030
                      ,SKU.TX_PRD_CDE_DESC                              08940030
                      ,SKU.E_BUS_PRD_GP_NBR                             08950030
                      ,SKU.NRF_CLOR_DESC                                08960030
                      ,SKU.CRE_TMST                                     08970030
                      ,SKU.LAST_UPD_TMST                                08980030
                                                                        08990030
                      ,SKUATTR.PLU_DWNLD_EXCL_IND                       09000030
                      ,SKUATTR.LAST_NCLR_RTL_AMT                        09010030
                      ,SKUATTR.LAST_UPD_TMST                            09020030
                                                                        09030030
                 INTO  :XST00010-INTR-UPC-ID                            09040030
                      ,:XST00010-STYL-ID                                09050030
                      ,:XST00010-SKU-NBR                                09060030
                      ,:XST00010-SKU-DESC                               09070030
                      ,:XST00010-SIZE-DESC                              09080030
                      ,:XST00010-REGN-PRIC-IND                          09090030
                      ,:XST00010-TX-PRD-CDE-DESC                        09100030
                      ,:XST00010-E-BUS-PRD-GP-NBR                       09110030
                      ,:XST00010-NRF-CLOR-DESC                          09120030
                      ,:XST00010-CRE-TMST                               09130030
                      ,:XST00010-LAST-UPD-TMST                          09140030
                                                                        09150030
                      ,:XST00011-PLU-DWNLD-EXCL-IND                     09160030
                      ,:XST00011-LAST-NCLR-RTL-AMT                      09170030
                                       :PV-LAST-NCLR-RTL-AMT-IND        09180030
                      ,:XST00011-LAST-UPD-TMST                          09190030
                                                                        09200030
                 FROM  XST_SKU       SKU                                09210030
                      ,XST_SKU_ATTR  SKUATTR                            09220030
                                                                        09230030
              WHERE SKU.INTR_UPC_ID = :PV-DB2-INTR-UPC-ID               09240030
                 AND  SKU.INTR_UPC_ID    = SKUATTR.INTR_UPC_ID          09250030
                                                                        09260030
           END-EXEC.                                                    09270030
                                                                        09280030
           EVALUATE TRUE                                                09290030
             WHEN SQLCODE = 0                                           09300030
               ADD 1 TO PV-STYLE-SKU-CHGS-FETCHS                        09310030
                                                                        09320030
             WHEN OTHER                                                 09330030
               DISPLAY 'INTR_UPC_ID = ' PV-DB2-INTR-UPC-ID              09340030
               MOVE 'ERROR ON SELECT OF REACTIVATED SKU '               09350030
                                  TO PV-DB2-OPERATION                   09360030
               PERFORM 9900-SQL-ABEND-ROUTINE                           09370030
                                                                        09380030
           END-EVALUATE.                                                09390030
                                                                        09400030
      *2800-EXIT.                                                       09410030
                                                                        09420030
      *--------------------------------------------------------------*  09430030
      * 3000-PROCESS-SKU.                                            *  09440030
      *    NOTE: WHEN A RECORD IS FIRST ADDED, THE XST00010-CRE-TMST *  09450030
      *          AND XST00010-LAST-UPD-TMST ARE THE SAME.  THAT IS   *  09460030
      *          WHY IT IS IMPORTANT TO CHECK THE XST00010-CRE-TMST  *  09470030
      *          FIRST.                                              *  09480030
      *                                                              *  09490030
      *--------------------------------------------------------------*  09500030
       3000-PROCESS-SKU.                                                09510030
                                                                        09520030
           MOVE '3000-PROCESS-SKU         ' TO PV-PARAGRAPH-NAME.       09530030
                                                                        09540030
           IF XST00010-CRE-TMST > CC-EPCC105-PREV-TIMESTAMP             09550030
             PERFORM 3400-CREATE-ADD-RECORD                             09560030
           ELSE                                                         09570030
             PERFORM 3800-CREATE-UPDATE-RECORD.                         09580030
                                                                        09590030
      *3000-EXIT.                                                       09600030
                                                                        09610030
                                                                        09620030
      *--------------------------------------------------------------*  09630030
      * 3400-CREATE-ADD-RECORD.                                      *  09640030
      *                                                              *  09650030
      *--------------------------------------------------------------*  09660030
       3400-CREATE-ADD-RECORD.                                          09670030
                                                                        09680030
           MOVE '3400-CREATE-ADD-RECORD   ' TO PV-PARAGRAPH-NAME.       09690030
                                                                        09700030
           PERFORM 5700-SELECT-SKU-ATTRS.                               09710030
                                                                        09720030
           IF XST00010-REGN-PRIC-IND = 'Y'                              09730030
             PERFORM 7900-FORMAT-RCP-OVERRIDE                           09740030
           END-IF.                                                      09750030
                                                                        09760030
           SET PS-ADD-RECORD TO TRUE.                                   09770030
           PERFORM 4000-FORMAT-SKU-GLBL.                                09780030
           PERFORM 4100-FORMAT-SKU-PRICG-GLBL.                          09790030
                                                                        09800030
LRP111     PERFORM 5400-SELECT-LOWEST-13-WK-PRICE.                      09810051
                                                                        09820051
LRP111     IF PS-LOWEST-PRICE-FOUND                                     09830051
LRP111        PERFORM 4200-FORMAT-SKU-PRICG-AD-VS                       09840051
LRP111     ELSE                                                         09850051
LRP111         PERFORM 5600-SELECT-MIN-UNT-RTL-AMT                      09860051
LRP111         IF PS-MIN-UNIT-RETAIL-FOUND                              09870051
LRP111            IF PV-MIN-UNT-RTL-AMT <                               09880051
LRP111                                 PV-CORPORATE-RETURN-PRICE        09890051
LRP111               MOVE PV-MIN-UNT-RTL-AMT TO                         09900051
LRP111                               PV-CORPORATE-RETURN-PRICE          09910051
LRP111               PERFORM 4200-FORMAT-SKU-PRICG-AD-VS                09920051
LRP111            END-IF                                                09930051
LRP111         END-IF                                                   09940051
           END-IF.                                                      09950051
                                                                        09960030
      *3400-EXIT.                                                       09970030
      *--------------------------------------------------------------*  09980030
      * 3800-CREATE-UPDATE-RECORD.                                   *  09990030
      *    WHEN FORMATING THE PLU UPDATE RECORD, ONLY FORMAT THOSE   *  10000030
      *    FIELDS CONTAINED IN TABLES THAT HAVE BEEN UPDATED SINCE   *  10010030
      *    THE LAST RUN.                                             *  10020030
      *                                                              *  10030030
      *--------------------------------------------------------------*  10040030
       3800-CREATE-UPDATE-RECORD.                                       10050030
                                                                        10060030
           MOVE '3800-CREATE-UPDATE-RECORD' TO PV-PARAGRAPH-NAME.       10070030
                                                                        10080030
           IF XST00010-LAST-UPD-TMST  > CC-EPCC105-PREV-TIMESTAMP       10090030
              SET PS-SKU-UPDATE TO TRUE                                 10100030
              PERFORM 4000-FORMAT-SKU-GLBL                              10110030
              ADD +1 TO PV-CNT-SKU-DATA-UPD                             10120030
           END-IF.                                                      10130030
                                                                        10140030
           IF XST00011-LAST-UPD-TMST  > CC-EPCC105-PREV-TIMESTAMP       10150030
              SET PS-SKU-ATTR-UPDATE TO TRUE                            10160030
              PERFORM 4100-FORMAT-SKU-PRICG-GLBL                        10170030
              ADD +1 TO PV-CNT-SKU-ATTR-UPD                             10180030
           END-IF.                                                      10190030
                                                                        10200030
      *3800-EXIT.                                                       10210030
                                                                        10220030
      *--------------------------------------------------------------*  10230030
      * 4000-FORMAT-SKU-GLBL.                                        *  10240030
      *    POPULATE AND OUTPUT SKU RECORD.                           *  10250030
      *    POPULATES ADD AND UPDATE RECORDS.                         *  10260030
      *--------------------------------------------------------------*  10270030
       4000-FORMAT-SKU-GLBL.                                            10280030
                                                                        10290030
           MOVE '4000-FORMAT-SKU-GLBL'      TO PV-PARAGRAPH-NAME.       10300030
                                                                        10310030
           PERFORM 4800-FORMAT-SKU-COMMON.                              10320030
                                                                        10330030
           SET EP219-SKU-NBR-YES          TO TRUE.                      10340030
           MOVE XST00010-SKU-NBR          TO EP219-SKU-NBR.             10350030
                                                                        10360030
           SET EP219-INTR-UPC-ID-YES      TO TRUE.                      10370030
           MOVE PV-INTR-UPC-ID-CONV       TO EP219-INTR-UPC-ID.         10380030
                                                                        10390030
           SET EP219-SKU-DESC-YES         TO TRUE.                      10400030
           MOVE XST00010-SKU-DESC         TO EP219-SKU-DESC.            10410030
                                                                        10420030
           SET EP219-E-BUS-ITM-IND-YES    TO TRUE.                      10430030
10APR      PERFORM 5900-SELECT-TWEBITM.                                 10440032
10APR      IF PS-TWEBITM-FOUND                                          10450032
10APR          MOVE WEBITM-WEB-EXCLV-IND  TO EP219-E-BUS-ITM-IND        10460032
10APR      ELSE                                                         10470032
10APR          MOVE 'N'                   TO EP219-E-BUS-ITM-IND        10480032
10APR      END-IF.                                                      10490032
                                                                        10500031
           SET EP219-E-BUS-PRD-GP-NBR-YES TO TRUE.                      10510030
           MOVE XST00010-E-BUS-PRD-GP-NBR TO EP219-E-BUS-PRD-GP-NBR.    10520030
                                                                        10530030
           SET EP219-NRF-CLOR-DESC-YES    TO TRUE.                      10540030
           MOVE XST00010-NRF-CLOR-DESC    TO EP219-NRF-CLOR-DESC        10550030
                                                                        10560030
           SET EP219-SIZE-DESC-YES        TO TRUE.                      10570030
           MOVE XST00010-SIZE-DESC        TO EP219-SIZE-DESC.           10580030
                                                                        10590030
           SET EP219-TAX-PRD-CDE-YES      TO TRUE.                      10600030
           MOVE XST00010-TX-PRD-CDE-DESC (1:5) TO EP219-TAX-PRD-CDE.    10610030
                                                                        10620030
           SET EP219-STYL-ID-YES          TO TRUE.                      10630030
           MOVE XST00010-STYL-ID          TO EP219-STYL-ID.             10640030
                                                                        10650030
           IF PS-ADD-RECORD                                             10660030
              ADD +1 TO PV-CNT-SKU-GLBL-ADD                             10670030
              SET EP219-RECORD-ADD TO TRUE                              10680030
                                                                        10690030
              SET EP219-MDSE-TX-CDE-YES   TO TRUE                       10700030
              MOVE '01'                   TO EP219-MDSE-TX-CDE          10710030
                                                                        10720030
              SET EP219-MKDN-SGN-CDE-YES  TO TRUE                       10730030
              MOVE PC-NULL-CHAR           TO EP219-MKDN-SGN-CDE         10740030
                                                                        10750030
              SET EP219-DMY-SKU-IND-YES   TO TRUE                       10760030
              SET EP219-NOT-DUMMY-SKU     TO TRUE                       10770030
           ELSE                                                         10780030
              ADD +1 TO PV-CNT-SKU-GLBL-UPDT                            10790030
              SET PS-SKU-UPDATE TO TRUE                                 10800030
              SET EP219-RECORD-UPDATE TO TRUE                           10810030
           END-IF.                                                      10820030
                                                                        10830030
           PERFORM 8300-WRITE-SKU-GLBL-REC.                             10840030
                                                                        10850030
      *4000-EXIT.                                                       10860030
      *--------------------------------------------------------------*  10870030
      * 4100-FORMAT-SKU-PRICG-GLBL.                                  *  10880030
      *   POPULATE AND OUTPUT SKU PRICING RECORD - ADD OR ATTR UPDTE *  10890030
      *--------------------------------------------------------------*  10900030
       4100-FORMAT-SKU-PRICG-GLBL.                                      10910030
                                                                        10920030
           MOVE '4100-FORMAT-SKU-PRICG-GLBL' TO PV-PARAGRAPH-NAME.      10930030
                                                                        10940030
           PERFORM 4900-FORMAT-SKU-PRICG-COMMON.                        10950030
                                                                        10960030
           IF PS-ADD-RECORD                                             10970030
              ADD +1 TO PV-CNT-SKU-PRICG-GLBL-A                         10980030
              SET EP220-RECORD-ADD TO TRUE                              10990030
                                                                        11000030
              SET EP220-SKU-PRICG-ID-NO          TO TRUE                11010030
              SET EP220-DEPT-NBR-YES           TO TRUE                  11020030
              SET EP220-MAJ-CL-NBR-YES         TO TRUE                  11030030
              SET EP220-SUB-CL-NBR-YES         TO TRUE                  11040030
              SET EP220-STYL-ID-YES            TO TRUE                  11050030
              MOVE PC-NULL-CHAR       TO EP220-DEPT-NBR-NUL             11060030
                                         EP220-MAJ-CL-NBR-NUL           11070030
                                         EP220-SUB-CL-NBR-NUL           11080030
                                         EP220-STYL-ID-NUL              11090030
                                                                        11100030
              SET EP220-EXCL-MDSE-IND-YES      TO TRUE                  11110030
              MOVE PC-NULL-CHAR       TO EP220-EXCL-MDSE-IND            11120030
                                                                        11130030
              SET EP220-UNT-RTL-AMT-YES        TO TRUE                  11140030
              MOVE XST00008-UNT-RTL-AMT  TO EP220-UNT-RTL-AMT           11150030
                                                                        11160030
              SET EP220-LAST-NCLR-RTL-AMT-YES  TO TRUE                  11170030
              IF PV-LAST-NCLR-RTL-AMT-NULL                              11180030
                 MOVE PC-NULL-CHAR    TO EP220-LAST-NCLR-RTL-AMT-NUL    11190030
              ELSE                                                      11200030
                 MOVE XST00011-LAST-NCLR-RTL-AMT                        11210030
                                      TO EP220-LAST-NCLR-RTL-AMT        11220030
              END-IF                                                    11230030
                                                                        11240030
              SET EP220-N-RCPT-RT-RTL-AMT-Y    TO TRUE                  11250030
              MOVE PV-CORPORATE-RETURN-PRICE                            11260030
                                      TO EP220-N-RCPT-RT-UNT-RTL-AMT    11270030
                                                                        11280030
              SET EP220-LO-UNT-RTL-AMT-YES     TO TRUE                  11290030
              SET EP220-HGH-UNT-RTL-AMT-YES    TO TRUE                  11300030
              MOVE PC-NULL-CHAR       TO EP220-LO-UNT-RTL-AMT-NUL       11310030
                                         EP220-HGH-UNT-RTL-AMT-NUL      11320030
                                                                        11330030
      *       GRP PRICING FIELDS SENT AS NULL, IF NOT APPLICABLE        11340030
              IF PV-GP-PRIC-ID-NULL                                     11350030
                 SET EP220-GP-RTL-AMT-YES      TO TRUE                  11360030
                 SET EP220-GP-RTL-QTY-YES      TO TRUE                  11370030
                 SET EP220-GP-PRIC-ID-YES      TO TRUE                  11380030
                 MOVE PC-NULL-CHAR         TO EP220-GP-RTL-AMT-NUL      11390030
                                              EP220-GP-RTL-QTY-NUL      11400030
                                              EP220-GP-PRIC-ID-NUL      11410030
              ELSE                                                      11420030
                 SET EP220-GP-RTL-AMT-YES      TO TRUE                  11430030
                 MOVE XST00008-GP-RTL-AMT  TO EP220-GP-RTL-AMT          11440030
                 SET EP220-GP-RTL-QTY-YES      TO TRUE                  11450030
                 MOVE XST00008-GP-RTL-QTY  TO EP220-GP-RTL-QTY          11460030
                 SET EP220-GP-PRIC-ID-YES      TO TRUE                  11470030
                 MOVE XST00008-GP-PRIC-ID  TO EP220-GP-PRIC-ID          11480030
              END-IF                                                    11490030
                                                                        11500030
              SET EP220-LOC-SKU-STAT-CDE-YES   TO TRUE                  11510030
              IF  XST00008-LOC-SKU-STAT-CDE = PC-MIXED-STATUS           11520030
                 MOVE PC-ACTIVE-STATUS    TO EP220-LOC-SKU-STAT-CDE     11530030
              ELSE                                                      11540030
                 MOVE XST00008-LOC-SKU-STAT-CDE                         11550030
                                          TO EP220-LOC-SKU-STAT-CDE     11560030
              END-IF                                                    11570030
                                                                        11580030
              SET EP220-TKT-CLOR-CDE-YES       TO TRUE                  11590030
              IF  XST00008-LOC-SKU-STAT-CDE = PC-CLEARANCE-STATUS       11600030
                 MOVE 'Y'                 TO EP220-TKT-CLOR-CDE         11610030
              ELSE                                                      11620030
                 MOVE 'W'                 TO EP220-TKT-CLOR-CDE         11630030
              END-IF                                                    11640030
                                                                        11650030
              SET EP220-LAST-PRCHG-TMST-YES    TO TRUE                  11660030
              MOVE XST00008-UNT-RTL-CHG-DTE TO PV-LAST-PRCHG-DTE        11670030
              MOVE PC-SQLS-START-TIME       TO PV-LAST-PRCHG-TIME       11680030
              MOVE PV-LAST-PRCHG-TMST       TO EP220-LAST-PRCHG-TMST    11690030
                                                                        11700030
              SET EP220-PRMPT-FOR-PRIC-IND-YES   TO TRUE                11710030
              MOVE XST00041-PRMPT-FOR-PRIC-IND                          11720030
                                      TO EP220-PRMPT-FOR-PRIC-IND       11730030
                                                                        11740030
              SET EP220-PERM-PRCHG-DIRN-CDE-YES TO TRUE                 11750030
              MOVE 'N'                    TO EP220-PERM-PRCHG-DIRN-CDE  11760030
                                                                        11770030
              SET EP220-MLT-PRPT-IND-YES       TO TRUE                  11780030
              MOVE 'N'                    TO EP220-MLT-PRPT-IND         11790030
                                                                        11800030
              SET EP220-PRCHG-APL-TKT-CLR-CD-Y TO TRUE                  11810030
              MOVE PC-NULL-CHAR       TO EP220-PRCHG-APLBL-TKT-CLOR-CDE 11820030
           ELSE                                                         11830030
              IF PS-SKU-ATTR-UPDATE                                     11840030
                 ADD +1 TO PV-CNT-SKU-PRICG-GLBL-U                      11850030
                 SET EP220-RECORD-UPDATE         TO TRUE                11860030
                 SET EP220-LAST-NCLR-RTL-AMT-YES TO TRUE                11870030
                 IF PV-LAST-NCLR-RTL-AMT-NULL                           11880030
                    MOVE PC-NULL-CHAR TO EP220-LAST-NCLR-RTL-AMT-NUL    11890030
                 ELSE                                                   11900030
                    MOVE XST00011-LAST-NCLR-RTL-AMT                     11910030
                                      TO EP220-LAST-NCLR-RTL-AMT        11920030
                 END-IF                                                 11930030
              ELSE                                                      11940030
                 DISPLAY '*** SKU PRICING - NEITHER ADD NOR ATTRIBUTE'  11950030
                         ' - NOT AD VERSION.  *** '                     11960030
              END-IF                                                    11970030
           END-IF.                                                      11980030
                                                                        11990030
           PERFORM 8400-WRITE-SKU-PRICG-GLBL-REC.                       12000030
                                                                        12010030
      *4100-EXIT.                                                       12020030
      *--------------------------------------------------------------*  12030030
      * 4200-FORMAT-SKU-PRICG-AD-VS.                                 *  12040030
      *   POPULATE AND OUTPUT SKU PRICING RECORD - AD VERSION        *  12050030
      *--------------------------------------------------------------*  12060030
       4200-FORMAT-SKU-PRICG-AD-VS.                                     12070030
                                                                        12080030
           MOVE '4200-FORMAT-SKU-PRICG-AD-VS' TO PV-PARAGRAPH-NAME.     12090030
                                                                        12100030
           PERFORM 4900-FORMAT-SKU-PRICG-COMMON.                        12110030
                                                                        12120030
LRP111     MOVE 1000                    TO EP220-STR-GRP-TYP-CDE.       12130048
LRP111     MOVE 1                       TO EP220-STR-GRP-ID.            12140048
                                                                        12150030
           SET EP220-RECORD-UPDATE            TO TRUE.                  12160030
                                                                        12170030
           SET EP220-N-RCPT-RT-RTL-AMT-Y      TO TRUE.                  12180030
           MOVE PV-CORPORATE-RETURN-PRICE                               12190030
                                        TO EP220-N-RCPT-RT-UNT-RTL-AMT. 12200030
                                                                        12210030
           PERFORM 8500-WRITE-SKU-PRICG-AD-VS-REC.                      12220030
                                                                        12230030
      *4200-EXIT.                                                       12240030
      *--------------------------------------------------------------*  12250030
      * 4800-FORMAT-SKU-COMMON.                                      *  12260030
      *   POPULATE AND OUTPUT SKU PRICING RECORD - ADD OR ATTR UPDTE *  12270030
      *--------------------------------------------------------------*  12280030
       4800-FORMAT-SKU-COMMON.                                          12290030
                                                                        12300030
           MOVE '4800-FORMAT-SKU-COMMON'     TO PV-PARAGRAPH-NAME.      12310030
                                                                        12320030
           INITIALIZE EP219-XST-SKU-RECORD.                             12330030
                                                                        12340030
           MOVE CC-EPCC112-TOMORROW-DATE TO EP219-PRICG-EFFECT-DTE.     12350030
                                                                        12360030
           MOVE PC-STR-GRP-TYP-CDE-CORP  TO EP219-STR-GRP-TYP-CDE.      12370030
           MOVE PC-STR-GRP-ID-CORP       TO EP219-STR-GRP-ID.           12380030
                                                                        12390030
           SET EP219-FILE-CHANGE         TO TRUE.                       12400030
           SET EP219-APPLY-NIGHTLY       TO TRUE.                       12410030
                                                                        12420030
           SET EP219-SKU-NBR-NO           TO TRUE.                      12430030
           SET EP219-INTR-UPC-ID-NO       TO TRUE.                      12440030
           SET EP219-SKU-DESC-NO          TO TRUE.                      12450030
           SET EP219-E-BUS-ITM-IND-NO     TO TRUE.                      12460030
           SET EP219-E-BUS-PRD-GP-NBR-NO  TO TRUE.                      12470030
           SET EP219-NRF-CLOR-DESC-NO     TO TRUE.                      12480030
           SET EP219-SIZE-DESC-NO         TO TRUE.                      12490030
           SET EP219-TAX-PRD-CDE-NO       TO TRUE.                      12500030
           SET EP219-MDSE-TX-CDE-NO       TO TRUE.                      12510030
           SET EP219-MKDN-SGN-CDE-NO      TO TRUE.                      12520030
           SET EP219-STYL-ID-NO           TO TRUE.                      12530030
           SET EP219-DMY-SKU-IND-NO       TO TRUE.                      12540030
                                                                        12550030
      *4800-EXIT.                                                       12560030
      *--------------------------------------------------------------*  12570030
      * 4900-FORMAT-SKU-PRICG-COMMON.                                *  12580030
      *   INITIALIZE SKU PRICING RECORD LAYOUT AND DATA ITEM INCLUDE *  12590030
      *   INDICATORS, AND POPULATE SKU PRICING RECORD COMMON FIELDS. *  12600030
      *--------------------------------------------------------------*  12610030
       4900-FORMAT-SKU-PRICG-COMMON.                                    12620030
                                                                        12630030
           MOVE '4900-FORMAT-SKU-PRICG-COMMON' TO PV-PARAGRAPH-NAME.    12640030
                                                                        12650030
           INITIALIZE EP220-XST-SKU-PRICG-RECORD.                       12660030
                                                                        12670030
           MOVE CC-EPCC112-TOMORROW-DATE TO EP220-PRICG-EFFECT-DTE.     12680030
           IF PS-ADD-RECORD                                             12690030
             OR  PS-SKU-ATTR-UPDATE                                     12700030
                MOVE PC-STR-GRP-TYP-CDE-CORP TO EP220-STR-GRP-TYP-CDE   12710030
                MOVE PC-STR-GRP-ID-CORP      TO EP220-STR-GRP-ID        12720030
           END-IF.                                                      12730030
                                                                        12740030
           SET EP220-FILE-CHANGE         TO TRUE.                       12750030
           SET EP220-APPLY-NIGHTLY       TO TRUE.                       12760030
           SET EP220-RECORD-UPDATE       TO TRUE.                       12770030
                                                                        12780030
           SET EP220-PRIC-EFF-TMST-YES      TO TRUE.                    12790030
           MOVE PV-PRIC-EFF-TMST      TO EP220-PRIC-EFF-TMST.           12800030
                                                                        12810030
      *    SET MDSE-HIER-CDE TO 'SKU' FOR ALL CURRENT PRICING RECORDS   12820030
           SET EP220-MDSE-HIER-CDE-YES      TO TRUE.                    12830030
           MOVE PC-MDSE-HIER-SKU      TO EP220-MDSE-HIER-CDE.           12840030
                                                                        12850030
      *    CURRENT PRICING IS ALWAYS AT SKU LEVEL                       12860030
           SET EP220-SKU-NBR-YES            TO TRUE.                    12870030
           MOVE XST00010-SKU-NBR      TO EP220-SKU-NBR.                 12880030
                                                                        12890030
      *    SET REST OF DATA ITEM INCLUSION INDICATORS TO NO             12900030
           SET EP220-SKU-PRICG-ID-NO        TO TRUE.                    12910030
           SET EP220-DEPT-NBR-NO            TO TRUE.                    12920030
           SET EP220-MAJ-CL-NBR-NO          TO TRUE.                    12930030
           SET EP220-SUB-CL-NBR-NO          TO TRUE.                    12940030
           SET EP220-STYL-ID-NO             TO TRUE.                    12950030
           SET EP220-EXCL-MDSE-IND-NO       TO TRUE.                    12960030
           SET EP220-UNT-RTL-AMT-NO         TO TRUE.                    12970030
           SET EP220-LAST-NCLR-RTL-AMT-NO   TO TRUE.                    12980030
           SET EP220-N-RCPT-RT-RTL-AMT-N    TO TRUE.                    12990030
           SET EP220-GP-RTL-AMT-NO          TO TRUE.                    13000030
           SET EP220-LO-UNT-RTL-AMT-NO      TO TRUE.                    13010030
           SET EP220-HGH-UNT-RTL-AMT-NO     TO TRUE.                    13020030
           SET EP220-GP-RTL-QTY-NO          TO TRUE.                    13030030
           SET EP220-GP-PRIC-ID-NO          TO TRUE.                    13040030
           SET EP220-LOC-SKU-STAT-CDE-NO    TO TRUE.                    13050030
           SET EP220-TKT-CLOR-CDE-NO        TO TRUE.                    13060030
           SET EP220-LAST-PRCHG-TMST-NO     TO TRUE.                    13070030
           SET EP220-PRMPT-FOR-PRIC-IND-NO  TO TRUE.                    13080030
           SET EP220-PERM-PRCHG-DIRN-CDE-NO TO TRUE.                    13090030
           SET EP220-MLT-PRPT-IND-NO        TO TRUE.                    13100030
           SET EP220-PRCHG-APL-TKT-CLR-CD-N TO TRUE.                    13110030
                                                                        13120030
      *4900-EXIT.                                                       13130030
      *--------------------------------------------------------------*  13140030
      * 5400-SELECT-LOWEST-13-WK-PRICE.                                 13150038
      *     SELECTS THE LOWEST 13-WEEK PRICE DETERMINED FOR THE         13160038
      *     SKU ACROSS ALL AD VERSION LEVELS.                           13170042
      *--------------------------------------------------------------*  13180030
       5400-SELECT-LOWEST-13-WK-PRICE.                                  13190038
                                                                        13200030
           MOVE '5400-SELECT-LOWEST-13WK-PRICE ' TO PV-PARAGRAPH-NAME.  13210038
                                                                        13220030
           PERFORM                                                      13230030
               WITH TEST AFTER                                          13240030
               VARYING PV-SQL-SUB                                       13250030
               FROM 1 BY 1                                              13260030
               UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 13270030
                         OR  SQLCODE = 0                                13280030
                         OR  SQLCODE = +100                             13290030
                         OR  SQLCODE = -305)                            13300030
                                                                        13310030
                EXEC SQL                                                13320030
                     SELECT  MIN(UNT_RTL_AMT)                           13330030
                       INTO :PV-LOWEST-RETAIL-PRICE                     13340030
                       FROM EPT_LO_RTL                                  13350030
                                                                        13360030
                      WHERE INTR_UPC_ID    = :PV-DB2-INTR-UPC-ID        13370030
                        AND STR_GP_TYP_CDE = 4000                       13380041
                                                                        13390030
                      WITH UR                                           13400030
                END-EXEC                                                13410030
                                                                        13420030
                EVALUATE TRUE                                           13430030
                    WHEN SQLCODE = -904                                 13440030
                    WHEN SQLCODE = -911                                 13450030
                    WHEN SQLCODE = -913                                 13460030
                        CONTINUE                                        13470030
                    WHEN SQLCODE = ZERO                                 13480030
                         SET PS-LOWEST-PRICE-FOUND TO TRUE              13490030
                         ADD 1 TO PV-LOWEST-RETAIL-FOUND                13500030
                         MOVE PV-LOWEST-RETAIL-PRICE TO                 13510030
                                  PV-CORPORATE-RETURN-PRICE             13520030
                                                                        13530030
                    WHEN SQLCODE = +100 OR -305                         13540030
                         SET PS-LOWEST-PRICE-NOT-FOUND TO TRUE          13550030
                         ADD 1 TO PV-LOWEST-RETAIL-NOT-FOUND            13560030
                                                                        13570030
                    WHEN SQLCODE NOT EQUAL ZERO                         13580030
                         MOVE 'SELECT MIN UNIT RETAIL'                  13590030
                                             TO PV-DB2-OPERATION        13600030
                         PERFORM 9900-SQL-ABEND-ROUTINE                 13610030
                END-EVALUATE                                            13620030
           END-PERFORM.                                                 13630030
                                                                        13640030
           IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13650030
              MOVE 'SELECT RETRIES EXCEEDED'  TO PV-DB2-OPERATION       13660030
              PERFORM 9900-SQL-ABEND-ROUTINE                            13670030
           END-IF.                                                      13680030
                                                                        13690030
      *5400-EXIT.                                                       13700030
                                                                        13710030
      *--------------------------------------------------------------*  13720030
      * 5600-SELECT-MIN-UNT-RTL-AMT.                                    13730030
      *     SELECTS THE MINIMUM UNIT RETAIL AMOUNT FOR THE              13740030
LRP111*     INTR_UPC_ID ACROSS ALL STORE GROUP IDS.                     13750045
      *--------------------------------------------------------------*  13760030
       5600-SELECT-MIN-UNT-RTL-AMT.                                     13770030
                                                                        13780030
           MOVE '5600-SELECT-MIN-UNT-RTL-AMT  ' TO PV-PARAGRAPH-NAME.   13790030
                                                                        13800030
           PERFORM                                                      13810030
               WITH TEST AFTER                                          13820030
               VARYING PV-SQL-SUB                                       13830030
               FROM 1 BY 1                                              13840030
               UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 13850030
                         OR  SQLCODE = 0                                13860030
                         OR  SQLCODE = +100                             13870030
                         OR  SQLCODE = -305)                            13880030
                                                                        13890030
                EXEC SQL                                                13900030
LRP111               SELECT  MIN(UNT_RTL_AMT)                           13910047
                       INTO :PV-MIN-UNT-RTL-AMT                         13920046
                                                                        13930030
LRP111                 FROM XST_SKU_LOC                                 13940047
                                                                        13950030
LRP111                WHERE INTR_UPC_ID = :PV-DB2-INTR-UPC-ID           13960047
LRP111                  AND END_TMST IS NULL                            13970047
                      WITH UR                                           13980030
                END-EXEC                                                13990030
                                                                        14000030
                EVALUATE TRUE                                           14010030
                    WHEN SQLCODE = -904                                 14020030
                    WHEN SQLCODE = -911                                 14030030
                    WHEN SQLCODE = -913                                 14040030
                        CONTINUE                                        14050030
                                                                        14060030
                    WHEN SQLCODE = ZERO                                 14070030
                         SET PS-MIN-UNIT-RETAIL-FOUND TO TRUE           14080030
                         ADD 1 TO PV-RETURN-PRICE-FOUND                 14090030
                                                                        14100030
                    WHEN SQLCODE = +100 OR -305                         14110030
                         SET PS-MIN-UNIT-RETAIL-NOT-FOUND TO TRUE       14120030
                         ADD 1 TO PV-RETURN-PRICE-NOT-FOUND             14130030
                                                                        14140030
                    WHEN SQLCODE NOT EQUAL ZERO                         14150030
                         MOVE 'SELECT MIN RTL AMT'                      14160030
                                             TO PV-DB2-OPERATION        14170030
                         DISPLAY 'INTR UPC ID: ' PV-DB2-INTR-UPC-ID     14180030
                         PERFORM 9900-SQL-ABEND-ROUTINE                 14190030
                END-EVALUATE                                            14200030
           END-PERFORM.                                                 14210030
                                                                        14220030
           IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         14230030
              MOVE 'SELECT RETRIES EXCEEDED'  TO PV-DB2-OPERATION       14240030
              PERFORM 9900-SQL-ABEND-ROUTINE                            14250030
           END-IF.                                                      14260030
                                                                        14270030
      *5600-EXIT.                                                       14280030
                                                                        14290030
      *--------------------------------------------------------------*  14300030
      * 5700-SELECT-SKU-ATTRS.                                       *  14310030
      *                                                              *  14320030
      *--------------------------------------------------------------*  14330030
       5700-SELECT-SKU-ATTRS.                                           14340030
                                                                        14350030
           MOVE '5700-SELECT-SKU-ATTRS        ' TO PV-PARAGRAPH-NAME.   14360030
                                                                        14370030
           EXEC SQL                                                     14380030
               SELECT  SKULOC.INTR_UPC_ID                               14390030
                      ,SKULOC.UNT_RTL_AMT                               14400030
                      ,SKULOC.LOC_SKU_STAT_CDE                          14410030
                      ,SKULOC.UPC_STAT_CHG_DTE                          14420030
                      ,SKULOC.UNT_RTL_CHG_DTE                           14430030
                      ,SKULOC.GP_PRIC_ID                                14440030
                      ,SKULOC.GP_RTL_QTY                                14450030
                      ,SKULOC.GP_RTL_AMT                                14460030
                      ,SKULOC.MKDN_CDE                                  14470030
                      ,SKULOC.ORIG_CLR_DTE                              14480030
                                                                        14490030
                      ,SKULOCATTR.PRMPT_FOR_PRIC_IND                    14500030
                                                                        14510030
                 INTO  :XST00008-INTR-UPC-ID                            14520030
                      ,:XST00008-UNT-RTL-AMT                            14530030
                      ,:XST00008-LOC-SKU-STAT-CDE                       14540030
                      ,:XST00008-UPC-STAT-CHG-DTE                       14550030
                      ,:XST00008-UNT-RTL-CHG-DTE                        14560030
                      ,:XST00008-GP-PRIC-ID  :PV-GP-PRIC-ID-IND         14570030
                      ,:XST00008-GP-RTL-QTY  :PV-GP-RTL-QTY-IND         14580030
                      ,:XST00008-GP-RTL-AMT  :PV-GP-RTL-AMT-IND         14590030
                      ,:XST00008-MKDN-CDE    :PV-MKDN-CDE-IND           14600030
                      ,:XST00008-ORIG-CLR-DTE:PV-ORIG-CLR-DTE-IND       14610030
                                                                        14620030
                      ,:XST00041-PRMPT-FOR-PRIC-IND                     14630030
                                                                        14640030
                 FROM  XST_SKU_LOC       SKULOC                         14650030
                      ,XST_SKU_LOC_ATTR  SKULOCATTR                     14660030
                                                                        14670030
              WHERE SKULOC.INTR_UPC_ID = :PV-DB2-INTR-UPC-ID            14680030
                AND SKULOC.INTR_UPC_ID = SKULOCATTR.INTR_UPC_ID         14690030
                AND SKULOC.LOC_NBR     = 0                              14700030
                AND SKULOC.LOC_NBR     = SKULOCATTR.LOC_NBR             14710030
                AND SKULOC.END_TMST  IS NULL                            14720030
                                                                        14730030
           END-EXEC.                                                    14740030
                                                                        14750030
           EVALUATE TRUE                                                14760030
             WHEN SQLCODE = 0                                           14770030
               ADD 1 TO PV-SKU-ATTRB-SELECT                             14780030
               MOVE XST00008-UNT-RTL-AMT TO PV-CORPORATE-RETURN-PRICE   14790030
                                                                        14800030
             WHEN OTHER                                                 14810030
               DISPLAY 'PV DB2 INTR UPC ID: ' PV-DB2-INTR-UPC-ID        14820030
               MOVE 'ERROR ON SELECT OF SKU LOC, SKU LOC ATTR '         14830030
                                  TO PV-DB2-OPERATION                   14840030
               PERFORM 9900-SQL-ABEND-ROUTINE                           14850030
                                                                        14860030
           END-EVALUATE.                                                14870030
                                                                        14880030
                                                                        14890030
      *5700-EXIT.                                                       14900030
                                                                        14910030
10APR *----------------------------------------------------------       14920031
10APR * 5900-SELECT-TWEBITM.                                            14930031
10APR *     RETRIEVE TWEBITM.                                           14940031
10APR *----------------------------------------------------------       14950031
10APR  5900-SELECT-TWEBITM.                                             14960031
10APR                                                                   14970031
10APR      MOVE PV-DB2-INTR-UPC-ID TO WEBITM-INTR-UPC-ID.               14980032
10APR                                                                   14990031
10APR      PERFORM WITH TEST AFTER                                      15000031
10APR          VARYING PV-RETRY-COUNT FROM 1 BY 1                       15010031
10APR            UNTIL SQLCODE = +0                                     15020031
10APR               OR SQLCODE = +100                                   15030031
10APR               OR PV-RETRY-COUNT > PC-MAX-RETRIES                  15040031
10APR          EXEC SQL                                                 15050031
10APR              SELECT W.WEB_EXCLV_IND                               15060031
10APR                INTO :WEBITM-WEB-EXCLV-IND                         15070031
10APR              FROM TWEBITM W                                       15080031
10APR              WHERE W.INTR_UPC_ID = :WEBITM-INTR-UPC-ID            15090032
10APR                AND W.EFF_BEG_TMST <= CURRENT TIMESTAMP            15100031
10APR                AND W.EFF_END_TMST IS NULL                         15110031
10APR              WITH UR                                              15120031
10APR          END-EXEC                                                 15130031
10APR                                                                   15140031
10APR          EVALUATE TRUE                                            15150031
10APR              WHEN SQLCODE = -904                                  15160031
10APR              WHEN SQLCODE = -913                                  15170031
10APR                  CONTINUE                                         15180031
10APR              WHEN SQLCODE = ZERO                                  15190031
10APR                  SET PS-TWEBITM-FOUND     TO TRUE                 15200031
10APR              WHEN SQLCODE = +100                                  15210031
10APR                  SET PS-TWEBITM-NOT-FOUND TO TRUE                 15220031
10APR              WHEN OTHER                                           15230031
10APR                  MOVE WEBITM-INTR-UPC-ID    TO PV-DISPLAY-INTERNAL15240032
10APR                  DISPLAY '** '                                    15250031
10APR                          PC-PROGRAM-NAME                          15260031
10APR                          ' - INTR UPC ID: '                       15270031
10APR                          PV-DISPLAY-INTERNAL                      15280031
10APR                  MOVE '5900-SELECT-TWEBITM' TO PV-PARAGRAPH-NAME  15290031
10APR                  MOVE 'SELECT FROM TWEBITM' TO PV-DB2-OPERATION   15300031
10APR                  PERFORM 9900-SQL-ABEND-ROUTINE                   15310031
10APR          END-EVALUATE                                             15320031
10APR      END-PERFORM.                                                 15330031
10APR                                                                   15340031
10APR      IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          15350031
10APR          MOVE WEBITM-INTR-UPC-ID            TO PV-DISPLAY-INTERNAL15360032
10APR          DISPLAY '** '                                            15370031
10APR                  PC-PROGRAM-NAME                                  15380031
10APR                  ' - INTR UPC ID: '                               15390031
10APR                  PV-DISPLAY-INTERNAL                              15400031
10APR          MOVE '5900-SELECT-TWEBITM'         TO PV-PARAGRAPH-NAME  15410031
10APR          MOVE 'SELECT FROM TWEBITM'         TO PV-DB2-OPERATION   15420031
10APR          PERFORM 9900-SQL-ABEND-ROUTINE                           15430031
10APR      END-IF.                                                      15440031
10APR                                                                   15450031
      *--------------------------------------------------------------*  15460030
      * 6600-OPEN-SKU-CHGS-CSR                                       *  15470030
      *    TRY TO OPEN THE STYLE SKU CHGS CURSOR UP TO FIVE TIMES.   *  15480030
      *--------------------------------------------------------------*  15490030
       6600-OPEN-STYLE-SKU-CHGS-CSR.                                    15500030
                                                                        15510030
           MOVE '6600-OPEN-STYLE-SKU-CHGS-CSR' TO PV-PARAGRAPH-NAME.    15520030
                                                                        15530030
           PERFORM                                                      15540030
               WITH TEST AFTER                                          15550030
               VARYING PV-SQL-SUB                                       15560030
               FROM 1 BY 1                                              15570030
               UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 15580030
                         OR  SQLCODE = 0)                               15590030
                                                                        15600030
               EXEC SQL                                                 15610030
                  OPEN STYLE-SKU-CHGS-CSR                               15620030
               END-EXEC                                                 15630030
                                                                        15640030
               EVALUATE TRUE                                            15650030
                 WHEN SQLCODE = -904                                    15660030
                 WHEN SQLCODE = -911                                    15670030
                 WHEN SQLCODE = -913                                    15680030
                   CONTINUE                                             15690030
                                                                        15700030
                 WHEN SQLCODE = 0                                       15710030
                   CONTINUE                                             15720030
                                                                        15730030
                 WHEN SQLWARN0 NOT EQUAL SPACE                          15740030
                 WHEN SQLCODE NOT EQUAL ZERO                            15750030
                   MOVE 'ERROR ON OPEN OF STYLE SKU CHGS CSR' TO        15760030
                        PV-DB2-OPERATION                                15770030
                   PERFORM 9900-SQL-ABEND-ROUTINE                       15780030
                                                                        15790030
               END-EVALUATE                                             15800030
           END-PERFORM.                                                 15810030
                                                                        15820030
           IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15830030
             MOVE 'OPEN RETRIES EXCEEDED FOR STYLE SKU CHGS CSR' TO     15840030
                  PV-DB2-OPERATION                                      15850030
             PERFORM 9900-SQL-ABEND-ROUTINE                             15860030
           END-IF.                                                      15870030
                                                                        15880030
      *6600-EXIT.                                                       15890030
                                                                        15900030
                                                                        15910030
      *--------------------------------------------------------------*  15920030
      * 6800-CLOSE-STYLE-SKU-CHGS-CSR.                               *  15930030
      *    TRY TO CLOSE THE CURSOR UP TO FIVE TIMES.                 *  15940030
      *--------------------------------------------------------------*  15950030
       6800-CLOSE-STYLE-SKU-CHGS-CSR.                                   15960030
                                                                        15970030
           MOVE '6800-CLOSE-STYLE-SKU-CHGS-CSR' TO PV-PARAGRAPH-NAME.   15980030
                                                                        15990030
           PERFORM                                                      16000030
               WITH TEST AFTER                                          16010030
               VARYING PV-SQL-SUB                                       16020030
               FROM 1 BY 1                                              16030030
               UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 16040030
                         OR  SQLCODE = 0)                               16050030
                                                                        16060030
               EXEC SQL                                                 16070030
                  CLOSE STYLE-SKU-CHGS-CSR                              16080030
               END-EXEC                                                 16090030
                                                                        16100030
               EVALUATE TRUE                                            16110030
                 WHEN SQLCODE = -904                                    16120030
                 WHEN SQLCODE = -911                                    16130030
                 WHEN SQLCODE = -913                                    16140030
                   CONTINUE                                             16150030
                                                                        16160030
                 WHEN SQLCODE = 0                                       16170030
                   CONTINUE                                             16180030
                                                                        16190030
                 WHEN SQLWARN0 NOT EQUAL SPACE                          16200030
                 WHEN SQLCODE NOT EQUAL ZERO                            16210030
                   MOVE 'ERROR ON CLOSE OF STYLE SKU CHGS CSR' TO       16220030
                        PV-DB2-OPERATION                                16230030
                   PERFORM 9900-SQL-ABEND-ROUTINE                       16240030
               END-EVALUATE                                             16250030
           END-PERFORM.                                                 16260030
                                                                        16270030
           IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         16280030
             MOVE 'CLOSE RETRIES EXCEEDED FOR STYLE SKU CHGS CSR' TO    16290030
                  PV-DB2-OPERATION                                      16300030
             PERFORM 9900-SQL-ABEND-ROUTINE                             16310030
           END-IF.                                                      16320030
                                                                        16330030
      *6800-EXIT.                                                       16340030
                                                                        16350030
      *----------------------------------------------------------       16360030
      * 7900-FORMAT-RCP-OVERRIDE.                                       16370030
      *                                                                 16380030
      *----------------------------------------------------------       16390030
       7900-FORMAT-RCP-OVERRIDE.                                        16400030
                                                                        16410030
           INITIALIZE EP122-RCP-DRIVE-RECORD.                           16420030
                                                                        16430030
           MOVE PV-INTR-UPC-ID-CONV TO EP122-INTERNAL-UPC-ID.           16440030
           SET EP122-BOTH-OVERRIDE  TO TRUE.                            16450030
                                                                        16460030
           PERFORM 8200-WRITE-RCP-OVERRIDE.                             16470030
                                                                        16480030
      *7900-EXIT.                                                       16490030
                                                                        16500030
      *--------------------------------------------------------------*  16510030
      * 8200-WRITE-RCP-OVERRIDE.                                        16520030
      *--------------------------------------------------------------*  16530030
       8200-WRITE-RCP-OVERRIDE.                                         16540030
                                                                        16550030
           MOVE '8200-WRITE-RCP-OVERRIDE  ' TO PV-PARAGRAPH-NAME.       16560030
                                                                        16570030
           WRITE RCP-OVERRIDE-RECORD FROM EP122-RCP-DRIVE-RECORD.       16580030
                                                                        16590030
           ADD 1           TO PV-CNT-OUTPUT-RECORDS                     16600030
                              PV-CNT-EP122-RECORDS.                     16610030
                                                                        16620030
      *8200-EXIT.                                                       16630030
      *--------------------------------------------------------------*  16640030
      * 8300-WRITE-SKU-GLBL-REC.                                        16650030
      *  WRITE OUT THE SKU GLOBAL RECORD.                               16660030
      *--------------------------------------------------------------*  16670030
       8300-WRITE-SKU-GLBL-REC.                                         16680030
                                                                        16690030
           MOVE '8300-WRITE-SKU-GLBL-REC  ' TO PV-PARAGRAPH-NAME.       16700030
                                                                        16710030
           WRITE SKU-GLOBAL-CHG-RECORD FROM EP219-XST-SKU-RECORD.       16720030
                                                                        16730030
           ADD 1           TO PV-CNT-OUTPUT-RECORDS                     16740030
                              PV-CNT-SKU-GLOBAL.                        16750030
                                                                        16760030
      *8300-EXIT.                                                       16770030
      *--------------------------------------------------------------*  16780030
      * 8400-WRITE-SKU-PRICG-GLBL-REC.                                  16790030
      *  WRITE OUT THE GLOBAL UPDATE RECORD FOR SKU PRICING.            16800030
      *--------------------------------------------------------------*  16810030
       8400-WRITE-SKU-PRICG-GLBL-REC.                                   16820030
                                                                        16830030
           MOVE '8400-WRITE-SKU-PRICG-GLBL-REC' TO PV-PARAGRAPH-NAME.   16840030
                                                                        16850030
           WRITE SKU-PRICING-GLOBAL-CHG-RECORD                          16860030
                                      FROM EP220-XST-SKU-PRICG-RECORD.  16870030
                                                                        16880030
           ADD 1           TO PV-CNT-OUTPUT-RECORDS                     16890030
                              PV-CNT-SKU-PRICG-GLOBAL.                  16900030
                                                                        16910030
      *8400-EXIT.                                                       16920030
      *--------------------------------------------------------------*  16930030
      * 8500-WRITE-SKU-PRICG-AD-VS-REC.                                 16940030
      *  WRITE OUT THE GLOBAL UPDATE RECORD FOR SKU PRICING.            16950030
      *--------------------------------------------------------------*  16960030
       8500-WRITE-SKU-PRICG-AD-VS-REC.                                  16970030
                                                                        16980030
           MOVE '8500-WRITE-SKU-PRICG-AD-VS-REC' TO PV-PARAGRAPH-NAME.  16990030
                                                                        17000030
           WRITE SKU-PRICING-AD-VERSION-RECORD                          17010030
                                      FROM EP220-XST-SKU-PRICG-RECORD.  17020030
                                                                        17030030
           ADD 1           TO PV-CNT-OUTPUT-RECORDS                     17040030
                              PV-CNT-SKU-PRICG-AD-VS.                   17050030
                                                                        17060030
      *8500-EXIT.                                                       17070030
      *--------------------------------------------------------------*  17080030
      * 9000-GET-FISCAL-WEEK.                                           17090030
      *     CALCULATE THE DATE THAT TODAY PLUS THE NUMBER OF DAYS       17100030
      *     VALUE COME OUT TO, USING DATE ROUTINE.                      17110030
      *--------------------------------------------------------------*  17120030
       9000-GET-FISCAL-WEEK.                                            17130030
                                                                        17140030
      *    * DETERMINE FISCAL WEEK NUMBER FOR ORIGINAL CLEARANCE DATE   17150030
           INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         17160030
           SET  DPG51-FISCAL-454-CALENDAR   TO TRUE.                    17170030
           SET  DPG52-LK-DTE-ISO-FMT        TO TRUE.                    17180030
           SET  DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                    17190030
           MOVE XST00008-ORIG-CLR-DTE       TO DPG52-LK-DATE-INPUT.     17200030
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    17210030
                                                   DPG54 DPG55 DPG56.   17220030
           EVALUATE TRUE                                                17230030
               WHEN DPG54-NO-ERROR                                      17240030
               WHEN DPG54-WARNING-ERROR                                 17250030
                   CONTINUE                                             17260030
               WHEN DPG54-SEVERE-ERROR                                  17270030
                   DISPLAY ' '                                          17280030
                   DISPLAY '** ABEND ** IN '  PC-PROGRAM-NAME           17290030
                   DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    17300030
                   DISPLAY '** CALLED BY 9000-GET-FISCAL-WEEK'          17310030
                   DISPLAY '** ERROR MESSAGE = '                        17320030
                           DPG54-ERROR-MESSAGE                          17330030
                   DISPLAY '** DPG51 = ' DPG51                          17340030
                   DISPLAY '** DPG52 = ' DPG52                          17350030
                   DISPLAY '** DPG53 = ' DPG53                          17360030
                   DISPLAY '** DPG54 = ' DPG54                          17370030
                   DISPLAY '** DPG55 = ' DPG55                          17380030
                   DISPLAY '** DPG56 = ' DPG56                          17390030
                   MOVE '9000-GET-FISCAL-WEEK'  TO PV-PARAGRAPH-NAME    17400030
                   MOVE 'ERROR CALCULATING FISCAL WEEK' TO              17410030
                        PV-OPERATION-MSG-1                              17420030
                   MOVE DPG54-ERROR-MESSAGE     TO PV-OPERATION-MSG-2   17430030
                   SET ABEND-4019-CAL-SUB-ERROR TO TRUE                 17440030
                   PERFORM 9800-ABEND                                   17450030
           END-EVALUATE.                                                17460030
                                                                        17470030
      *9000-EXIT.                                                       17480030
                                                                        17490030
      *----------------------------------------------------------       17500030
      * 9800-ABEND.                                                     17510030
      *     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  17520030
      *----------------------------------------------------------       17530030
       9800-ABEND.                                                      17540030
                                                                        17550030
           DISPLAY '** ABEND           **'.                             17560030
           DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          17570030
           DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        17580030
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       17590030
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       17600030
           CALL 'ILBOABN0' USING ABEND-CODE.                            17610030
                                                                        17620030
      *9800-EXIT.                                                       17630030
       EJECT.                                                           17640030
                                                                        17650030
      *--------------------------------------------------------------*  17660030
      * 9900-SQL-ABEND-ROUTINE.                                         17670030
      *     SQL ABEND ROUTINE.                                          17680030
      *--------------------------------------------------------------*  17690030
       9900-SQL-ABEND-ROUTINE.                                          17700030
                                                                        17710030
           DISPLAY '** ABEND     **'.                                   17720030
           DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                17730030
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              17740030
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               17750030
                                                                        17760030
           COPY DPPD004.                                                17770030
           SET ABEND-4013-DB2-ERROR TO TRUE.                            17780030
           CALL 'ILBOABN0' USING ABEND-CODE.                            17790030
                                                                        17800030
      *9900-EXIT.                                                       17810030
                                                                        17820030
                                                                        17830030
      *--------------------------------------------------------------*  17840030
      * 9999-WRAPUP.                                                    17850030
      *     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      17860030
      *     ANY DATA FROM THE PROGRAM.                                  17870030
      *--------------------------------------------------------------*  17880030
       9999-WRAPUP.                                                     17890030
                                                                        17900030
           CLOSE REACTIVATED-SKUS                                       17910030
                 RCP-OVERRIDE-DRIVER                                    17920030
                 SKU-GLOBAL-CHG-FILE                                    17930030
                 SKU-PRICING-GLOBAL-CHG-FILE                            17940030
                 SKU-PRICING-AD-VERSION-FILE.                           17950030
                                                                        17960030
           DISPLAY ' '.                                                 17970030
           DISPLAY '*********************************************'.     17980030
           DISPLAY '    PROGRAM COUNTS FOR ' PC-PROGRAM-NAME.           17990030
           DISPLAY '*********************************************'.     18000030
           DISPLAY ' '.                                                 18010030
           DISPLAY 'NUMBER OF REACTIVATED SKUS READ        : '          18020030
                    PV-CNT-REACTIVE-RECS.                               18030030
           DISPLAY ' '.                                                 18040030
           DISPLAY 'NUMBER OF STYLE SKU CHGS FETCHES       : '          18050030
                    PV-STYLE-SKU-CHGS-FETCHS.                           18060030
           DISPLAY ' '.                                                 18070030
           DISPLAY ' NUMBER OF SKU DATA UPDATES (SKU UPD RCD): '        18080030
                    PV-CNT-SKU-DATA-UPD.                                18090030
           DISPLAY 'NBR OF SKU ATTR UPDTS (SKU PRICG UPD RCD): '        18100030
                    PV-CNT-SKU-ATTR-UPD.                                18110030
           DISPLAY ' '.                                                 18120030
           DISPLAY 'NUMBER OF SKU ATTRIBUTE SELECTS        : '          18130030
                    PV-SKU-ATTRB-SELECT                                 18140030
                   ' - 5700-SELECT-SKU-ATTRS'.                          18150030
           DISPLAY ' '.                                                 18160030
           DISPLAY PC-FIVE-BLANKS                                       18170030
                   'NUMBER LOWEST PRICE FOUND              : '          18180030
                    PV-LOWEST-RETAIL-FOUND                              18190030
                   ' - 5400-SELECT-LWST-13-WK-PRC'.                     18200038
           DISPLAY PC-FIVE-BLANKS                                       18210030
                   'NUMBER LOWEST PRICE NOT FOUND          : '          18220030
                    PV-LOWEST-RETAIL-NOT-FOUND                          18230030
                   ' - 5400-SELECT-LWST-13-WK-PRC'.                     18240038
           DISPLAY ' '.                                                 18250030
           DISPLAY PC-FIVE-BLANKS                                       18260030
                   'NUMBER RETURN PRICE FOUND              : '          18270030
                    PV-RETURN-PRICE-FOUND                               18280030
                   ' - 5600-SELECT-MIN-UNT-RTL-AMT '.                   18290030
           DISPLAY PC-FIVE-BLANKS                                       18300030
                   'NUMBER RETURN PRICE NOT FOUND          : '          18310030
                    PV-RETURN-PRICE-NOT-FOUND                           18320030
                   ' - 5600-SELECT-MIN-UNT-RTL-AMT '.                   18330030
           DISPLAY ' '.                                                 18340030
           DISPLAY '    NUMBER OF OUTPUT RECORDS WRITTEN: '             18350030
                    PV-CNT-OUTPUT-RECORDS.                              18360030
           DISPLAY PC-FIVE-BLANKS.                                      18370030
           DISPLAY PC-FIVE-BLANKS                                       18380030
                   '     NUMBER OF EP122 RECORDS WRITTEN: '             18390030
                    PV-CNT-EP122-RECORDS                                18400030
                   ' - DD OUT01'.                                       18410053
                                                                        18420030
           DISPLAY PC-FIVE-BLANKS                                       18430030
                   'NUMBER OF SKU GLOBAL RECORDS WRITTEN: '             18440030
                    PV-CNT-SKU-GLOBAL                                   18450030
                   ' - DD OUT02'.                                       18460053
           DISPLAY PC-FIVE-BLANKS                                       18470030
                   'NBR OF SKU PRICING GLBL RCDS WRITTEN: '             18480030
                    PV-CNT-SKU-PRICG-GLOBAL                             18490030
                   ' - DD OUT03'.                                       18500053
           DISPLAY PC-FIVE-BLANKS                                       18510030
                   'NBR OF SKU PRICG AD VRS RCDS WRITTEN: '             18520030
                    PV-CNT-SKU-PRICG-AD-VS                              18530030
                   ' - DD OUT04'.                                       18540053
           DISPLAY PC-FIVE-BLANKS.                                      18550030
           DISPLAY PC-FIVE-BLANKS                                       18560030
                   ' NUMBER OF SKU GLBL ADD RCDS WRITTEN: '             18570030
                    PV-CNT-SKU-GLBL-ADD.                                18580030
           DISPLAY PC-FIVE-BLANKS                                       18590030
                   'NUMBER OF SKU GLBL UPDT RCDS WRITTEN: '             18600030
                    PV-CNT-SKU-GLBL-UPDT.                               18610030
           DISPLAY PC-FIVE-BLANKS                                       18620030
                   ' NBR SKU PRICG GLBL ADD RCDS WRITTEN: '             18630030
                    PV-CNT-SKU-PRICG-GLBL-A.                            18640030
           DISPLAY PC-FIVE-BLANKS                                       18650030
                   'NBR SKU PRICG GLBL UPDT RCDS WRITTEN: '             18660030
                    PV-CNT-SKU-PRICG-GLBL-U.                            18670030
                                                                        18680030
      *9999-EXIT.                                                       18690030
      **********************  END PROGRAM  *****************************18700030
