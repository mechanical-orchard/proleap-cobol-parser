       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    MLKUT433.                                         00020000
       AUTHOR.        SCOTT JACKSON.                                    00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  05-24-99.                                         00050000
       DATE-COMPILED.                                                   00060000
      ******************************************************************00070000
      *                                                                 00080000
      * MLKUT433 - DESCRIPTION.............                             00090000
      *                                                                 00100000
      * THIS PROGRAM WILL CREATE THE DATA INTEGRITY EXTRACT FILE FOR    00110000
      * DB2 TABLE TWKSHNK.                                              00120000
      *                                                                 00130000
      *CHANGE HISTORY:                                                  00131012
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES           00132012
      * ------- ---------- ----------- -------------------------------- 00133012
W26603* W26603  03-08-2004 ROD JANSSEN MERCH LEDGER STORE EXPANSION     00134012
      ******************************************************************00140000
      *                                                                 00150000
       ENVIRONMENT DIVISION.                                            00160000
      *                                                                 00170000
       CONFIGURATION SECTION.                                           00180000
      *                                                                 00190000
       SOURCE-COMPUTER.        IBM-3090.                                00200000
       OBJECT-COMPUTER.        IBM-3090.                                00210000
      *                                                                 00220000
       INPUT-OUTPUT SECTION.                                            00230000
       FILE-CONTROL.                                                    00240000
                                                                        00250000
           SELECT DATA-INTEGRITY-EXTR-FILE                              00260000
               ASSIGN TO OUT01.                                         00270000
                                                                        00280000
      ******************************************************************00290000
       DATA DIVISION.                                                   00300000
      ******************************************************************00310000
                                                                        00320000
       FILE SECTION.                                                    00330000
                                                                        00340000
      *                                                                 00350004
       FD  DATA-INTEGRITY-EXTR-FILE                                     00360000
           RECORDING MODE IS F                                          00370000
           LABEL RECORDS ARE STANDARD                                   00380000
           BLOCK CONTAINS 0 RECORDS.                                    00390000
                                                                        00400000
W26603 01  DATA-INTEGRITY-EXTR-REC     PIC X(80).                       00410012
                                                                        00420000
      ******************************************************************00440000
       WORKING-STORAGE SECTION.                                         00450000
      ******************************************************************00460000
                                                                        00470000
       01  PS-PROGRAM-SWITCHES.                                         00480000
           05  PS-TWKSHNK-DONE         PIC X       VALUE 'N'.           00490000
               88  PS-TWKSHNK-IS-DONE              VALUE 'Y'.           00500000
               88  PS-TWKSHNK-IS-NOT-DONE          VALUE 'N'.           00510000
                                                                        00520000
       01  PA-PROGRAM-ACCUMULATORS                 COMP-3.              00530000
           05  PA-TWKSHNK-ROWS-FETCHED PIC S9(13)  VALUE ZERO.          00540000
           05  PA-TDTATTR-ROWS-SELECTED                                 00550000
                                       PIC S9(13)  VALUE ZERO.          00560000
           05  PA-OUTPUT-RECS-WRITTEN  PIC S9(13)  VALUE ZERO.          00570000
                                                                        00580000
       01  PC-PROGRAM-CONSTANTS.                                        00590000
           05  PC-MAX-TBL-ROWS         PIC S9(03)  VALUE +120.          00600000
                                                                        00610000
       01  PV-PROGRAM-VARIABLES.                                        00620000
           05  PV-OPN-MONTH-FIRST-WEEK PIC X(10).                       00630000
           05  PV-FSCL-WK-END-DTE      PIC X(10).                       00640000
           05  PV-FSCL-MN-END-DTE      PIC X(10).                       00650000
           05  PV-FSCL-MN-NBR          PIC X(02).                       00660000
                                                                        00670000
           05  PV-SPLIT-SUB-CL-NBR.                                     00680000
               10  PV-SPLIT-SUB-CL-NBR-1                                00690000
                                       PIC X.                           00700000
               10  FILLER              PIC X.                           00710000
           05  PV-FRMT-MAJ-CL-NBR.                                      00720000
               10  PV-FRMT-MAJ-CL-NBR-1                                 00730000
                                       PIC X.                           00740000
               10  PV-FRMT-MAJ-CL-NBR-2                                 00750000
                                       PIC X.                           00760000
      *                                                                 00770004
       01  CD-COUNTER-DISPLAY.                                          00780000
           05  CD-COUNT-HOLD1          PIC Z,ZZZ,ZZZ,ZZZ,ZZ9.           00790000
                                                                        00800000
       01 ABEND-AREAS.                                                  00810000
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           00820000
                                                   COMP SYNC.           00830000
               88  AC-BAD-DATA                     VALUE +4003.         00840000
               88  AC-DB2-ERROR                    VALUE +4013.         00850000
           05  AA-ABEND-LIT            PIC X(40)   VALUE                00860000
                 '*****       ABEND'.                                   00870000
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                00880000
                   '*****   PROGRAM: MLKUT433'.                         00890000
           05  AA-PARAGRAPH-LIT.                                        00900000
               10  FILLER              PIC X(17)   VALUE                00910000
                   '***** PARAGRAPH: '.                                 00920000
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        00930000
           05  AA-MESSAGE-LINE.                                         00940000
               10  FILLER              PIC X(06)   VALUE '*****'.       00950000
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        00960000
           05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                00970000
                   '*****    DB2 ERROR'.                                00980000
           05  AA-DB2-OPERATION-LIT.                                    00990000
               10  FILLER              PIC X(17)   VALUE                01000000
                   '***** OPERATION: '.                                 01010000
               10  AA-DB2-OPERATION.                                    01020000
                   15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        01030000
                   15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        01040000
           05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        01050000
           05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        01060000
           05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        01070000
           05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        01080000
                                                                        01090000
       EJECT                                                            01100000
                                                                        01110000
      *** DATA INTEGRITY CONTROL CARD                                   01120000
           COPY MLRD110.                                                01130000
                                                                        01140000
                                                                        01150000
      *** DATA INTEGRITY TWKSHNK EXTRACT FILE                           01160000
W26603     COPY MLRD125.                                                01170012
                                                                        01180000
       EJECT                                                            01190000
                                                                        01200000
      ******************************************************************01210000
      *  DB2 ERROR MESSAGES FORMAT AREA.                                01220000
      ******************************************************************01230000
           COPY DPWS004.                                                01240000
                                                                        01250000
      ******************************************************************01260000
      *  DB2 ERRORS                                                     01270000
      ******************************************************************01280000
           COPY SQLCA2.                                                 01290000
                                                                        01300000
      ******************************************************************01310000
      *  DB2 COMMUNICATION AREA                                         01320000
      ******************************************************************01330000
           EXEC SQL                                                     01340000
                INCLUDE SQLCA                                           01350000
           END-EXEC.                                                    01360000
                                                                        01370000
      ******************************************************************01380000
      *  DB2 TWKSHNK TABLE LAYOUT                                       01390000
      ******************************************************************01400000
           EXEC SQL                                                     01410000
                INCLUDE TWKSHNK                                         01420000
           END-EXEC.                                                    01430000
                                                                        01440000
      *                                                                 01450009
      ******************************************************************01460000
      *  DB2 TWKSHNK CURSOR                                             01470000
      ******************************************************************01480000
           EXEC SQL                                                     01490000
               DECLARE TWKSHNK_CURSOR CURSOR FOR                        01500000
                SELECT FSCL_WK_END_DTE,                                 01510000
                       DEPT_NBR,                                        01520000
                       SUB_CL_NBR,                                      01530000
                       STR_NBR,                                         01540000
                       FSCL_MN_END_DTE,                                 01550001
                       SLS_RTL_AMT,                                     01560001
                       SHNK_RTL_AMT                                     01570001
                  FROM TWKSHNK                                          01580000
              ORDER BY FSCL_WK_END_DTE,                                 01590000
                       DEPT_NBR,                                        01600000
                       SUB_CL_NBR,                                      01610000
                       STR_NBR                                          01620000
W26603        WITH UR                                                   01621012
           END-EXEC.                                                    01630000
                                                                        01640000
       EJECT                                                            01650000
                                                                        01660000
      ******************************************************************01670000
       PROCEDURE DIVISION.                                              01680000
      ******************************************************************01690000
                                                                        01700000
      ******************************************************************01710000
       0000-MAINLINE-MLKUT433.                                          01720000
      ******************************************************************01730000
      *                                                                 01740000
           PERFORM 1000-INITIALIZATION.                                 01750000
                                                                        01760000
           PERFORM 2000-MAIN-PROCESS.                                   01770000
                                                                        01780000
           PERFORM 8000-EOJ.                                            01790000
                                                                        01800000
           STOP RUN.                                                    01810000
                                                                        01820000
       EJECT                                                            01830000
                                                                        01840000
      ******************************************************************01850000
       1000-INITIALIZATION.                                             01860000
      ******************************************************************01870000
      *                                                                 01880000
           OPEN OUTPUT DATA-INTEGRITY-EXTR-FILE.                        01890000
      *                                                                 01900000
           INITIALIZE PA-PROGRAM-ACCUMULATORS.                          01910000
           INITIALIZE PV-PROGRAM-VARIABLES.                             01920000
                                                                        01930000
      ******************************************************************01940000
       2000-MAIN-PROCESS.                                               01950000
      ******************************************************************01960000
      *                                                                 01970000
           PERFORM 7100-OPEN-CURSOR-TWKSHNK.                            01980000
                                                                        01990000
           PERFORM 7200-FETCH-TWKSHNK.                                  02000000
                                                                        02010000
           PERFORM                                                      02020000
             UNTIL PS-TWKSHNK-IS-DONE                                   02030000
               PERFORM 5000-WRITE-EXTRACT                               02040000
               PERFORM 7200-FETCH-TWKSHNK                               02050000
           END-PERFORM.                                                 02060000
                                                                        02070000
           PERFORM 7300-CLOSE-CURSOR-TWKSHNK.                           02080000
                                                                        02090000
      *                                                                 02100003
      ******************************************************************02110000
       5000-WRITE-EXTRACT.                                              02120000
      ******************************************************************02130000
      *                                                                 02140000
           MOVE WKSHNK-FSCL-WK-END-DTE TO ML125-FSCL-WK-END-DTE.        02150010
           MOVE WKSHNK-DEPT-NBR        TO ML125-DEPT-NBR.               02160002
           MOVE WKSHNK-SUB-CL-NBR      TO ML125-SUB-CL-NBR.             02170002
           MOVE WKSHNK-STR-NBR         TO ML125-STR-NBR.                02180002
           MOVE WKSHNK-FSCL-MN-END-DTE TO ML125-FSCL-MN-END-DTE.        02190008
           MOVE WKSHNK-SLS-RTL-AMT     TO ML125-SLS-RTL-AMT.            02200002
           MOVE WKSHNK-SHNK-RTL-AMT    TO ML125-SHNK-RTL-AMT.           02210002
                                                                        02220000
           WRITE DATA-INTEGRITY-EXTR-REC                                02230000
               FROM ML125-DATA-INTEGRITY-EXTR-REC.                      02240002
           ADD 1                       TO PA-OUTPUT-RECS-WRITTEN.       02250000
                                                                        02260000
      *                                                                 02270001
      *                                                                 02280002
      ******************************************************************02290000
       7100-OPEN-CURSOR-TWKSHNK.                                        02300000
      ******************************************************************02310000
      *                                                                 02320000
           EXEC SQL                                                     02330000
               OPEN TWKSHNK_CURSOR                                      02340000
           END-EXEC.                                                    02350000
                                                                        02360000
           EVALUATE TRUE                                                02370000
               WHEN SQLCODE = 0                                         02380000
                   CONTINUE                                             02390000
               WHEN OTHER                                               02400000
                   MOVE '7100-OPEN-CURSOR-TWKSHNK'                      02410000
                                       TO AA-PARAGRAPH-NAME             02420000
                   MOVE 'TWKSHNK TABLE ERROR'                           02430000
                                       TO AA-MESSAGE                    02440000
                   MOVE 'OPEN CURSOR'  TO AA-DB2-OPERATION              02450000
                   PERFORM 9901-SQL-ERROR                               02460000
           END-EVALUATE.                                                02470000
                                                                        02480000
       EJECT                                                            02490000
                                                                        02500000
      ******************************************************************02510000
       7200-FETCH-TWKSHNK.                                              02520000
      ******************************************************************02530000
      *                                                                 02540000
           EXEC SQL                                                     02550000
               FETCH TWKSHNK_CURSOR                                     02560000
                INTO :WKSHNK-FSCL-WK-END-DTE,                           02570002
                     :WKSHNK-DEPT-NBR,                                  02580002
                     :WKSHNK-SUB-CL-NBR,                                02590002
                     :WKSHNK-STR-NBR,                                   02600002
                     :WKSHNK-FSCL-MN-END-DTE,                           02610002
                     :WKSHNK-SLS-RTL-AMT,                               02620002
                     :WKSHNK-SHNK-RTL-AMT                               02630002
           END-EXEC.                                                    02640000
                                                                        02650000
           EVALUATE TRUE                                                02660000
               WHEN SQLCODE = 0                                         02670000
                   ADD +1              TO PA-TWKSHNK-ROWS-FETCHED       02680000
               WHEN SQLCODE = +100                                      02690000
                   MOVE 'Y'            TO PS-TWKSHNK-DONE               02700000
               WHEN OTHER                                               02710000
                   MOVE '7200-FETCH-TWKSHNK'                            02720000
                                       TO AA-PARAGRAPH-NAME             02730000
                   MOVE 'TWKSHNK TABLE ERROR'                           02740000
                                       TO AA-MESSAGE                    02750000
                   MOVE 'FETCH'        TO AA-DB2-OPERATION              02760000
                   PERFORM 9901-SQL-ERROR                               02770000
           END-EVALUATE.                                                02780000
                                                                        02790000
       EJECT                                                            02800000
                                                                        02810000
      ******************************************************************02820000
       7300-CLOSE-CURSOR-TWKSHNK.                                       02830000
      ******************************************************************02840000
      *                                                                 02850000
           EXEC SQL                                                     02860000
               CLOSE TWKSHNK_CURSOR                                     02870000
           END-EXEC.                                                    02880000
                                                                        02890000
           EVALUATE TRUE                                                02900000
               WHEN SQLCODE = 0                                         02910000
                   CONTINUE                                             02920000
               WHEN OTHER                                               02930000
                   MOVE '7300-CLOSE-CURSOR-TWKSHNK'                     02940000
                                       TO AA-PARAGRAPH-NAME             02950000
                   MOVE 'TWKSHNK TABLE ERROR'                           02960000
                                       TO AA-MESSAGE                    02970000
                   MOVE 'CLOSE CURSOR' TO AA-DB2-OPERATION              02980000
                   PERFORM 9901-SQL-ERROR                               02990000
           END-EVALUATE.                                                03000000
                                                                        03010000
       EJECT                                                            03020000
                                                                        03030000
      *                                                                 03040006
      ******************************************************************03050000
       8000-EOJ.                                                        03060000
      ******************************************************************03070000
      *                                                                 03080000
           DISPLAY ' '.                                                 03090000
           DISPLAY '  PROGRAM MLKUT433 PROCESSING SUMMARY'.             03100000
           DISPLAY '  -----------------------------------'.             03110000
           DISPLAY ' '.                                                 03120000
      *                                                                 03130000
           MOVE PA-TWKSHNK-ROWS-FETCHED TO CD-COUNT-HOLD1.              03140000
           DISPLAY 'TWKSHNK ROWS FETCHED =      ' CD-COUNT-HOLD1.       03150000
      *                                                                 03160000
           DISPLAY '                            '.                      03170009
                                                                        03180009
           MOVE PA-OUTPUT-RECS-WRITTEN TO CD-COUNT-HOLD1.               03190000
           DISPLAY 'EXTRACT RECORDS WRITTEN =   ' CD-COUNT-HOLD1.       03200000
      *                                                                 03210000
           DISPLAY ' '.                                                 03220000
                                                                        03230000
           CLOSE DATA-INTEGRITY-EXTR-FILE.                              03240000
                                                                        03250000
      *                                                                 03260006
      ******************************************************************03270000
       9901-SQL-ERROR.                                                  03280000
      ******************************************************************03290000
      *                                                                 03300000
           CLOSE DATA-INTEGRITY-EXTR-FILE.                              03310005
                                                                        03320000
           DISPLAY AA-ABEND-LIT.                                        03330000
           DISPLAY AA-DB2-ERROR-LIT.                                    03340000
           DISPLAY AA-PROGRAM-LIT.                                      03350000
           DISPLAY AA-PARAGRAPH-LIT.                                    03360000
           DISPLAY AA-MESSAGE-LINE.                                     03370000
           DISPLAY AA-DB2-OPERATION-LIT.                                03380000
           SET AC-DB2-ERROR TO TRUE.                                    03390000
           MOVE +4013                  TO ABEND-CODE.                   03400000
                                                                        03410000
           COPY DPPD004.                                                03420000
           CALL 'ILBOABN0' USING ABEND-CODE.                            03430000
                                                                        03440000
